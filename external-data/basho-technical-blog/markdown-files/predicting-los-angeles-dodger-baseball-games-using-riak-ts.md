---
title: "Predicting Los Angeles Dodger Baseball Games Using Riak TS"
description: "Riak TS 1.3 launch is just days away and since 1.3 will include the first Open Source release we thought we’d set the stage, give you access to some fun time series data and guide you through an example of a practical Riak TS use case. This demo shows how Riak TS can be used for analysis of historic"
project: community
lastmod: 2016-04-21T21:09:41+00:00
sitemap:
  priority: 0.2
project_section: technicalblogpost
author_name: "Seema Jethani"
pub_date: 2016-04-11T09:39:14+00:00
---
Riak TS 1.3 launch is just days away and since 1.3 will include the first Open Source release we thought we’d set the stage, give you access to some fun time series data and guide you through an example of a practical Riak TS use case. This demo shows how Riak TS can be used for analysis of historical time series data being generated by sensors to predict the occurrence of an event.
Our goal is to predict the presence of a baseball game at Dodgers stadium using the traffic data from ramp sensors on the 101 North freeway in Los Angeles. The dataset used can be found here. The ramp is close enough to the stadium to see unusual traffic after a Dodgers game. But not so close, and therefore heavily used by game traffic, so that the signal for the extra traffic is overly obvious.
First, let’s create the tables for the sensor data and the event data respectively. We can use the following schema for the data we have

CREATE TABLE SENSOR\_TABLE (
 ramp varchar not null,
 city varchar not null,
 daytime timestamp not null,
 count double,
 PRIMARY KEY((ramp, city, quantum(daytime, 60, d)), ramp, city, daytime))

CREATE TABLE GAMES\_TABLE (home\_team varchar not null,
 home\_team varchar not null,
 city varchar not null,
 date\_begin timestamp not null,
 date\_end timestamp not null,
 attendance sint64,
 away\_team varchar,
 PRIMARY KEY((home\_team, city, quantum(date\_begin, 60, d)), home\_team, city, date\_begin))

After creating the tables, we bulk load the data in the database using the store api.
For example in Python:

table = rc.table(GAMES\_TABLE)
ts\_obj = table.new(events\_raw.values.tolist())
result = ts\_obj.store()

table = rc.table(SENSOR\_TABLE)
ts\_obj = table.new(traffic\_df.values.tolist())
result = ts\_obj.store()

Next we query the data using select queries to see how the traffic data plots against the event data.
Let’s now fetch some of the data and see how it plots
We can use the following queries and plug in dates for t1 and t2

select daytime, count from {table} where daytime > {t1} and daytime < {t2} and ramp = '101 North freeway' and city='LA' 
select date\_begin, date\_end, attendance from {table} where date\_begin > {t1} and date\_begin < {t2} and home\_team = 'Dodgers' and city='LA'


We can see that traffic peaks are following game events.
Now let’s build the model. We chunk the data in one-hour interval and extract features – mean, min, max, standard deviation and median traffic along with whether there was a game in this time interval. We then randomly split the data between train and test sets and use the Random Forest Classifier model to fit the data.
RandomForestClassifier(bootstrap=True, class\_weight=None, criterion='gini',
max\_depth=None, max\_features='auto', max\_leaf\_nodes=None,
min\_samples\_leaf=1, min\_samples\_split=2,
min\_weight\_fraction\_leaf=0.0, n\_estimators=100, n\_jobs=1,
oob\_score=False, random\_state=None, verbose=0,
warm\_start=False)

With this model we get an accuracy score of 0.94 which indicates that we can quite accurately predict a game based on sensor data. A similar approach can be used for other machine learning problems. You can find the notebook for this demo here.
Riak TS is the only enterprise-grade NoSQL database optimized for IoT and Time Series data. It will ingest, transform, store and analyze massive amounts of time series data. We are seeing some very exciting performance data from our testing – Riak TS is so much faster Cassandra in our performance testing!
Looking forward to your feedback on Riak TS. Please visit riak.com/products/riak-ts/ to find out more information and take the new Riak TS Tour that you can navigate to from that page. If you’d like to find out more information or schedule a tech talk send us an email here.
Seema Jethani
Riak Product Manager
@seemmaj
