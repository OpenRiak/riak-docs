
<!doctype html>
<html class="no-js"  xmlns="http://www.w3.org/1999/xhtml" prefix="" lang="en-US" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://ogp.me/ns/fb#" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/content/themes/basho-v2/dist/images/favicon.ico" />
    
<!-- BEGIN Metadata added by the Add-Meta-Tags WordPress plugin -->
<link rel="alternate" hreflang="en-US" href="/posts/technical/riak-core-the-coordinator/index.html?p=6091.html" />
<meta name="description" content="Logically speaking, a coordinator is just what it sounds like. It&#039;s job is to coordinate incoming requests. It enforces the consistency semantics of N, R and W and performs anti-entropy services like read repair ..." />
<meta name="keywords" content="technical blog, availability, blog, cluster, nodes, riak, vnodes" />
<!-- END Metadata added by the Add-Meta-Tags WordPress plugin -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39891693-3"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-39891693-3');
</script>
<!-- END Global site tag (gtag.js) - Google Analytics -->
<title>Riak Core &#8211; The Coordinator &#8211; Riak</title>
<link rel='dns-prefetch' href='https://ajax.googleapis.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel='stylesheet' id='contact-form-7-css'  href='/content/plugins/contact-form-7/includes/css/styles.css?ver=4.9' type='text/css' media='all' />
<link rel='stylesheet' id='popup-maker-site-css'  href='/content/plugins/popup-maker/assets/css/site.min.css?ver=1.6.6' type='text/css' media='all' />
<link rel='stylesheet' id='rs-plugin-settings-css'  href='/content/plugins/revslider/public/assets/css/settings.css?ver=5.4.6.1' type='text/css' media='all' />
<style id='rs-plugin-settings-inline-css' type='text/css'>
.regmark{font-size:15px;  position:relative;  top:-10px}@media screen and (max-width:700px){.regmark{font-size:13px;  top:-4px}}
</style>
<link rel='stylesheet' id='megamenu-css'  href='/content/uploads/maxmegamenu/style.css?ver=a8ce69' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='/includes/css/dashicons.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='megamenu-fontawesome-css'  href='/content/plugins/megamenu-pro/icons/fontawesome/css/font-awesome.min.css?ver=1.4.5' type='text/css' media='all' />
<link rel='stylesheet' id='megamenu-genericons-css'  href='/content/plugins/megamenu-pro/icons/genericons/genericons/genericons.css?ver=1.4.5' type='text/css' media='all' />
<link rel='stylesheet' id='evcal_cal_default-css'  href='/content/plugins/eventON/assets/css/eventon_styles.css?ver=2.3.15' type='text/css' media='all' />
<!-- inject:css -->
<link rel="stylesheet" href="/content/themes/basho-v2/dist/styles/styles-846178cbe9.min.css">
<!-- endinject -->
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'></script>
<script>window.jQuery || document.write('<script src="/content/themes/basho-v2/dist/scripts/jquery.js"><\/script>')</script>
<script type='text/javascript' src='/content/plugins/revslider/public/assets/js/jquery.themepunch.tools.min.js?ver=5.4.6.1'></script>
<script type='text/javascript' src='/content/plugins/revslider/public/assets/js/jquery.themepunch.revolution.min.js?ver=5.4.6.1'></script>
<link rel='https://api.w.org/' href='/json/index.html' />
<link rel='prev' title='Jared Morrow Is Now A Member Of The Riak Team' href='/posts/business/jared-morrow-is-now-a-member-of-the-basho-team/index.html?p=6090.html' />
<link rel='next' title='Why MapReduce Is Hard' href='/posts/technical/why-mapreduce-is-hard/index.html?p=6083.html' />
<link rel="canonical" href="/posts/technical/riak-core-the-coordinator/index.html?p=6091.html" />
<link rel='shortlink' href='/index.html?p=6091.html' />



<script type="text/javascript">function setREVStartSize(e){
				try{ var i=jQuery(window).width(),t=9999,r=0,n=0,l=0,f=0,s=0,h=0;					
					if(e.responsiveLevels&&(jQuery.each(e.responsiveLevels,function(e,f){f>i&&(t=r=f,l=e),i>f&&f>r&&(r=f,n=e)}),t>r&&(l=n)),f=e.gridheight[l]||e.gridheight[0]||e.gridheight,s=e.gridwidth[l]||e.gridwidth[0]||e.gridwidth,h=i/s,h=h>1?1:h,f=Math.round(h*f),"fullscreen"==e.sliderLayout){var u=(e.c.width(),jQuery(window).height());if(void 0!=e.fullScreenOffsetContainer){var c=e.fullScreenOffsetContainer.split(",");if (c) jQuery.each(c,function(e,i){u=jQuery(i).length>0?u-jQuery(i).outerHeight(!0):u}),e.fullScreenOffset.split("%").length>1&&void 0!=e.fullScreenOffset&&e.fullScreenOffset.length>0?u-=jQuery(window).height()*parseInt(e.fullScreenOffset,0)/100:void 0!=e.fullScreenOffset&&e.fullScreenOffset.length>0&&(u-=parseInt(e.fullScreenOffset,0))}f=u}else void 0!=e.minHeight&&f<e.minHeight&&(f=e.minHeight);e.c.closest(".rev_slider_wrapper").css({height:f})					
				}catch(d){console.log("Failure at Presize of Slider:"+d)}
			};</script>
<style type="text/css">/** Mega Menu CSS Disabled **/</style>
	<style id="pum-styles" type="text/css" media="all">
	/* Popup Google Fonts */
@import url('https://fonts.googleapis.com/css?family=Acme|Montserrat');

/* Popup Theme 12762: Blank Center */
.pum-theme-12762, .pum-theme-blank-center { background: none } 
.pum-theme-12762 .pum-container, .pum-theme-blank-center .pum-container { padding: 0px; border-radius: 0px; border: 1px none #000000; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 1 ); background-color: rgba( 249, 249, 249, 1 ); background: none } 
.pum-theme-12762 .pum-title, .pum-theme-blank-center .pum-title { color: #000000; text-align: center; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: inherit; font-size: 16px; line-height: 16px } 
.pum-theme-12762 .pum-content, .pum-theme-blank-center .pum-content { color: #8c8c8c; font-family: inherit } 
.pum-theme-12762 .pum-content + .pum-close, .pum-theme-blank-center .pum-content + .pum-close { height: auto; width: auto; left: auto; right: 0px; bottom: auto; top: 10px; padding: 4px; color: #ffffff; font-family: inherit; font-size: 12px; line-height: 14px; border: 1px none #ffffff; border-radius: 0px; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0.23 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 255, 158, 1, 1 ) } 
/* Popup Theme 11529: Default No Padding */
.pum-theme-11529, .pum-theme-default-no-padding { background-color: rgba( 255, 255, 255, 1 ) } 
.pum-theme-11529 .pum-container, .pum-theme-default-no-padding .pum-container { padding: 0px; border-radius: 0px; border: 1px none #000000; box-shadow: 1px 1px 3px 0px rgba( 2, 2, 2, 0.23 ); background-color: rgba( 255, 255, 255, 1 ) } 
.pum-theme-11529 .pum-title, .pum-theme-default-no-padding .pum-title { color: #000000; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: inherit; font-size: 32px; line-height: 36px } 
.pum-theme-11529 .pum-content, .pum-theme-default-no-padding .pum-content { color: #8c8c8c; font-family: inherit } 
.pum-theme-11529 .pum-content + .pum-close, .pum-theme-default-no-padding .pum-content + .pum-close { height: auto; width: auto; left: auto; right: 0px; bottom: auto; top: 0px; padding: 8px; color: #ffffff; font-family: inherit; font-size: 12px; line-height: 14px; border: 1px none #ffffff; border-radius: 0px; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0.23 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 255, 158, 1, 1 ) } 
/* Popup Theme 11527: Framed Border */
.pum-theme-11527, .pum-theme-framed-border { background-color: rgba( 255, 255, 255, 0.5 ) } 
.pum-theme-11527 .pum-container, .pum-theme-framed-border .pum-container { padding: 18px; border-radius: 0px; border: 20px outset #dd3333; box-shadow: 1px 1px 3px 0px rgba( 2, 2, 2, 0.97 ) inset; background-color: rgba( 255, 251, 239, 1 ) } 
.pum-theme-11527 .pum-title, .pum-theme-framed-border .pum-title { color: #000000; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: inherit; font-size: 32px; line-height: 36px } 
.pum-theme-11527 .pum-content, .pum-theme-framed-border .pum-content { color: #2d2d2d; font-family: inherit } 
.pum-theme-11527 .pum-content + .pum-close, .pum-theme-framed-border .pum-content + .pum-close { height: 20px; width: 20px; left: auto; right: -20px; bottom: auto; top: -20px; padding: 0px; color: #ffffff; font-family: Acme; font-size: 20px; line-height: 20px; border: 1px none #ffffff; border-radius: 0px; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0.23 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 0, 0, 0, 0.55 ) } 
/* Popup Theme 11526: Cutting Edge */
.pum-theme-11526, .pum-theme-cutting-edge { background-color: rgba( 0, 0, 0, 0.5 ) } 
.pum-theme-11526 .pum-container, .pum-theme-cutting-edge .pum-container { padding: 18px; border-radius: 0px; border: 1px none #000000; box-shadow: 0px 10px 25px 0px rgba( 2, 2, 2, 0.5 ); background-color: rgba( 30, 115, 190, 1 ) } 
.pum-theme-11526 .pum-title, .pum-theme-cutting-edge .pum-title { color: #ffffff; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: Sans-Serif; font-size: 26px; line-height: 28px } 
.pum-theme-11526 .pum-content, .pum-theme-cutting-edge .pum-content { color: #ffffff; font-family: inherit } 
.pum-theme-11526 .pum-content + .pum-close, .pum-theme-cutting-edge .pum-content + .pum-close { height: 24px; width: 24px; left: auto; right: 0px; bottom: auto; top: 0px; padding: 0px; color: #1e73be; font-family: inherit; font-size: 32px; line-height: 24px; border: 1px none #ffffff; border-radius: 0px; box-shadow: -1px 1px 1px 0px rgba( 2, 2, 2, 0.1 ); text-shadow: -1px 1px 1px rgba( 0, 0, 0, 0.1 ); background-color: rgba( 238, 238, 34, 1 ) } 
/* Popup Theme 11525: Hello Box */
.pum-theme-11525, .pum-theme-hello-box { background-color: rgba( 0, 0, 0, 0.75 ) } 
.pum-theme-11525 .pum-container, .pum-theme-hello-box .pum-container { padding: 30px; border-radius: 80px; border: 14px solid #81d742; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0 ); background-color: rgba( 255, 255, 255, 1 ) } 
.pum-theme-11525 .pum-title, .pum-theme-hello-box .pum-title { color: #2d2d2d; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: Montserrat; font-size: 32px; line-height: 36px } 
.pum-theme-11525 .pum-content, .pum-theme-hello-box .pum-content { color: #2d2d2d; font-family: inherit } 
.pum-theme-11525 .pum-content + .pum-close, .pum-theme-hello-box .pum-content + .pum-close { height: auto; width: auto; left: auto; right: -30px; bottom: auto; top: -30px; padding: 0px; color: #2d2d2d; font-family: inherit; font-size: 32px; line-height: 28px; border: 1px none #ffffff; border-radius: 28px; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0.23 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 255, 255, 255, 1 ) } 
/* Popup Theme 11524: Enterprise Blue */
.pum-theme-11524, .pum-theme-enterprise-blue { background-color: rgba( 0, 0, 0, 0.7 ) } 
.pum-theme-11524 .pum-container, .pum-theme-enterprise-blue .pum-container { padding: 28px; border-radius: 5px; border: 1px none #000000; box-shadow: 0px 10px 25px 4px rgba( 2, 2, 2, 0.5 ); background-color: rgba( 255, 255, 255, 1 ) } 
.pum-theme-11524 .pum-title, .pum-theme-enterprise-blue .pum-title { color: #315b7c; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: inherit; font-size: 34px; line-height: 36px } 
.pum-theme-11524 .pum-content, .pum-theme-enterprise-blue .pum-content { color: #2d2d2d; font-family: inherit } 
.pum-theme-11524 .pum-content + .pum-close, .pum-theme-enterprise-blue .pum-content + .pum-close { height: 28px; width: 28px; left: auto; right: 8px; bottom: auto; top: 8px; padding: 4px; color: #ffffff; font-family: inherit; font-size: 20px; line-height: 20px; border: 1px none #ffffff; border-radius: 42px; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0.23 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 49, 91, 124, 1 ) } 
/* Popup Theme 11523: Light Box */
.pum-theme-11523, .pum-theme-lightbox { background-color: rgba( 0, 0, 0, 0.6 ) } 
.pum-theme-11523 .pum-container, .pum-theme-lightbox .pum-container { padding: 18px; border-radius: 3px; border: 8px solid #000000; box-shadow: 0px 0px 30px 0px rgba( 2, 2, 2, 1 ); background-color: rgba( 255, 255, 255, 1 ) } 
.pum-theme-11523 .pum-title, .pum-theme-lightbox .pum-title { color: #000000; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: inherit; font-size: 32px; line-height: 36px } 
.pum-theme-11523 .pum-content, .pum-theme-lightbox .pum-content { color: #000000; font-family: inherit } 
.pum-theme-11523 .pum-content + .pum-close, .pum-theme-lightbox .pum-content + .pum-close { height: 30px; width: 30px; left: auto; right: -24px; bottom: auto; top: -24px; padding: 0px; color: #ffffff; font-family: inherit; font-size: 24px; line-height: 26px; border: 2px solid #ffffff; border-radius: 30px; box-shadow: 0px 0px 15px 1px rgba( 2, 2, 2, 0.75 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 0, 0, 0, 1 ) } 
/* Popup Theme 11522: Default Theme */
.pum-theme-11522, .pum-theme-default-theme { background-color: rgba( 255, 255, 255, 1 ) } 
.pum-theme-11522 .pum-container, .pum-theme-default-theme .pum-container { padding: 15px; border-radius: 3px; border: 1px none #000000; box-shadow: 1px 1px 3px 0px rgba( 2, 2, 2, 0.23 ); background-color: rgba( 255, 255, 255, 1 ) } 
.pum-theme-11522 .pum-title, .pum-theme-default-theme .pum-title { color: #000000; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: inherit; font-size: 28px; line-height: 30px } 
.pum-theme-11522 .pum-content, .pum-theme-default-theme .pum-content { color: #8c8c8c; font-family: inherit } 
.pum-theme-11522 .pum-content + .pum-close, .pum-theme-default-theme .pum-content + .pum-close { height: auto; width: auto; left: auto; right: 0px; bottom: auto; top: 0px; padding: 8px; color: #ffffff; font-family: inherit; font-weight: 400; font-size: 11px; line-height: 13px; border: 1px none #ffffff; border-radius: 0px; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0.23 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 255, 158, 1, 1 ) } 

	
		</style>
<!-- START - Facebook Open Graph, Google+ and Twitter Card Tags 2.1.2 -->
 <!-- Facebook Open Graph -->
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Riak"/>
  <meta property="og:title" content="Riak Core - The Coordinator"/>
  <meta property="og:url" content="/posts/technical/riak-core-the-coordinator/"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Logically speaking, a coordinator is just what it sounds like.  It&#039;s job is to coordinate incoming requests.  It enforces the consistency semantics of N, R and W and performs anti-entropy services like read repair ..."/>
  <meta property="og:image" content="/content/uploads/2015/06/basho_og.png"/>
  <meta property="article:published_time" content="2011-04-19T22:39:30+00:00"/>
  <meta property="article:modified_time" content="2015-05-28T19:24:15+00:00" />
  <meta property="og:updated_time" content="2015-05-28T19:24:15+00:00" />
  <meta property="article:section" content="Technical Blog"/>
 <!-- Google+ / Schema.org -->
  <meta itemprop="name" content="Riak Core - The Coordinator"/>
  <meta itemprop="description" content="Logically speaking, a coordinator is just what it sounds like.  It&#039;s job is to coordinate incoming requests.  It enforces the consistency semantics of N, R and W and performs anti-entropy services like read repair ..."/>
  <meta itemprop="image" content="/content/uploads/2015/06/basho_og.png"/>
 <!-- Twitter Cards -->
 <!-- SEO -->
 <!-- Misc. tags -->
<!-- END - Facebook Open Graph, Google+ and Twitter Card Tags 2.1.2 -->
	
	<style>
	_:-ms-input-placeholder, :root .page-template-tpl-riakkv .title_ph {  margin-left:16%; }
	_:-ms-input-placeholder, :root .page-template-tpl-products .home_3_data .title_ph {  margin-left:28.5%; }
	_:-ms-input-placeholder, :root .page-template-tpl-products .home_4_data .title_ph {  margin-left:20.5%; }
	</style>
	 </head>
  <body class="post-template-default single single-post postid-6091 single-format-standard mega-menu-primary-navigation riak-core-the-coordinator sidebar-primary">
    <!--[if lt IE 9]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    


<div id="screen_viewport">
	
	<div id="head_container" class="row">
		<header>
			
			<div class="row upper">
				
				<div class="header-contain">
				
					<div class="col-sm-3 header-upper-left">
						
						<div class="logo_home">
							<a href="/index.html"><img alt="Riak logo" src="/content/themes/basho-v2/dist/images/riak.png"></a>
						</div>
	
					</div><!-- end header-upper-left-->
					<div class="col-sm-9 header-upper-right">
					
		
						<div class="quick_tools">
	<ul class="quick_links">
								<li><a href="https://docs.riak.com/index.html" target="_blank">DOWNLOAD RIAK</a></li><li><a href="https://docs.riak.com/index.html">DOCS</a></li>								<li class="lang_menu sling_lang"><a href="javascript: void(0);" class="language_choice">ENGLISH</a>
									<ul>
										<li class="language sling_lang"><a href="http://www.riak.com/index.html" rel="http://www.riak.com">English</a></li>
										<li class="language sling_lang"><a href="http://jp.riak.com/posts/technical/riak-core-the-coordinator/" rel="http://jp.riak.com">日本語</a></li>
										<li class="language sling_lang"><a href="http://de.riak.com/posts/technical/riak-core-the-coordinator/" rel="http://de.riak.com">Deutsch</a></li>
										<li class="language sling_lang"><a href="http://fr.riak.com/posts/technical/riak-core-the-coordinator/" rel="http://fr.riak.com">Fran&ccedil;ais</a></li>
									</ul>
								</li>
							</ul>
						</div>
		
					</div><!-- end header-upper-right-->
					<div class="cf clearfix"></div>
				</div>	<!-- end header-contain -->
		</div><!-- end row -->
		<div class="col-sm-12 row header-lower">

			<div class="header-contain">

				<div class="main_nav">
					<ul class="main_nav_top">

						<div id="mega-menu-wrap-primary_navigation" class="mega-menu-wrap"><div class="mega-menu-toggle" tabindex="0"><div class='mega-toggle-block mega-menu-toggle-block mega-toggle-block-right mega-toggle-block-1' id='mega-toggle-block-1'></div></div><ul id="mega-menu-primary_navigation" class="mega-menu mega-menu-horizontal mega-no-js" data-event="hover_intent" data-effect="slide" data-effect-speed="200" data-second-click="close" data-document-click="collapse" data-vertical-behaviour="standard" data-breakpoint="600" data-unbind="true"><li class='mega-add-arrow mega-m-products mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-megamenu mega-hide-arrow mega-menu-item-11815' id='mega-menu-item-11815'><a class="mega-menu-link" href="/products/" aria-haspopup="true" tabindex="0">Products</a>
	<ul class="mega-sub-menu">
	<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-columns-1-of-3 mega-menu-item-11816' id='mega-menu-item-11816'><a class="mega-menu-link" href="/products/">Overview</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-menu-columns-1-of-3 mega-menu-item-11817' id='mega-menu-item-11817'><a class="mega-menu-link" href="/products/riak-kv/" aria-haspopup="true">Riak<sup>®</sup> KV</a>
	<ul class="mega-sub-menu">
	<li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-11819' id='mega-menu-item-11819'><a class="mega-menu-link" href="/products/riak-kv/index.html#features">Features</a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-11820' id='mega-menu-item-11820'><a class="mega-menu-link" href="/products/riak-kv/index.html#commercial">Commercial V. OSS</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-icon mega-menu-item-11821' id='mega-menu-item-11821'><a class="fa-sign-out mega-menu-link" href="/products/riak-kv/resiliency/index.html?p=10906.html">Take Feature Tour</a></li>	</ul>
	</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-menu-columns-1-of-3 mega-menu-item-11822' id='mega-menu-item-11822'><a class="mega-menu-link" href="/products/riak-ts/" aria-haspopup="true">Riak<sup>®</sup> TS</a>
	<ul class="mega-sub-menu">
	<li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-11824' id='mega-menu-item-11824'><a class="mega-menu-link" href="/products/riak-ts/index.html#features">Features</a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-11825' id='mega-menu-item-11825'><a class="mega-menu-link" href="/products/riak-ts/index.html#commercial">Commercial V. OSS</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-icon mega-menu-item-11826' id='mega-menu-item-11826'><a class="fa-sign-out mega-menu-link" href="/products/riak-ts/resiliency/index.html?p=10650.html">Take Feature Tour</a></li>	</ul>
	</li></ul>
	</li><li class='mega-m-integrations mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-megamenu mega-hide-arrow mega-menu-item-11827' id='mega-menu-item-11827'><a class="mega-menu-link" href="/products/integrations/" aria-haspopup="true" tabindex="0">Integrations</a>
	<ul class="mega-sub-menu">
	<li class='mega-menu-item mega-menu-item-type-widget widget_nav_menu mega-menu-columns-1-of-2 mega-menu-item-nav_menu-10' id='mega-menu-item-nav_menu-10'><ul id="menu-integrations-column-1" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11990"><a href="/products/apache-spark/">Apache Spark</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11885"><a href="/products/solr/">Apache Solr</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11883"><a href="/products/apache-mesos/index.html?p=11511.html">Apache Mesos</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11886"><a href="/products/redis/index.html?p=6927.html">Redis Caching</a></li>
	</ul></li><li class='mega-menu-item mega-menu-item-type-widget widget_nav_menu mega-menu-columns-1-of-2 mega-menu-item-nav_menu-11' id='mega-menu-item-nav_menu-11'><ul id="menu-integrations-column-2" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-11887"><a href="/products/riak-s2/index.html?p=6196.html">Riak S2</a>
	<ul  class="sub-menu">
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11888"><a href="/products/riak-s2/index.html?p=6196.html#features">Features</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11889"><a href="/products/riak-s2/index.html?p=6196.html#commercial">Commercial V. OSS</a></li>
	</ul>
	</li>
	</ul></li></ul>
	</li><li class='mega-m-resources mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-megamenu mega-hide-arrow mega-menu-item-11837' id='mega-menu-item-11837'><a class="mega-menu-link" href="/resources/" aria-haspopup="true" tabindex="0">Resources</a>
	<ul class="mega-sub-menu">
	<li class='mega-menu-item mega-menu-item-type-widget widget_nav_menu mega-menu-columns-1-of-2 mega-menu-item-nav_menu-2' id='mega-menu-item-nav_menu-2'><ul id="menu-resources-column-1" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-11890"><a href="/resources/">Resource Center</a>
	<ul  class="sub-menu">
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11892"><a href="/resources/index.html?resource=types&amp;t=DATASHEET">DataSheets</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11893"><a href="/resources/index.html?resource=types&amp;t=WHITEPAPER">WhitePapers</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11894"><a href="/resources/index.html?resource=types&amp;t=SOLUTION BRIEF">Solution Briefs</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11895"><a href="/resources/index.html?resource=types&amp;t=CASE STUDY">Case Studies</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11896"><a href="/resources/index.html?resource=types&amp;t=USER STORY">User Stories</a></li>
	<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11897"><a href="/resources/index.html?resource=types&amp;t=CUSTOMER TESTIMONIAL">Customer Testimonials</a></li>
	</ul>
	</li>
	</ul></li><li class='mega-menu-item mega-menu-item-type-widget widget_nav_menu mega-menu-columns-1-of-2 mega-menu-item-nav_menu-3' id='mega-menu-item-nav_menu-3'><ul id="menu-resources-column-2" class="menu">
	</ul></li></ul>
	</li><li class='mega-add-arrow mega-m-blog mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-right mega-menu-flyout mega-hide-arrow mega-menu-item-11839' id='mega-menu-item-11839'><a class="mega-menu-link" href="/blog/" aria-haspopup="true" tabindex="0">Blog</a>
	<ul class="mega-sub-menu">
	<li class='mega-menu-item mega-menu-item-type-taxonomy mega-menu-item-object-category mega-menu-item-11841' id='mega-menu-item-11841'><a class="mega-menu-link" href="/category/technical/">Technical</a></li><li class='mega-menu-item mega-menu-item-type-taxonomy mega-menu-item-object-category mega-menu-item-11840' id='mega-menu-item-11840'><a class="mega-menu-link" href="/category/business/">Business</a></li></ul>
	</li></ul></div>						</ul>
				</div>
				<div class="cf clearfix"></div>
			</div>	<!-- end header-contain -->	

			</div><!-- end header-lower-->

			
		</header>
	</div>
	    <div class="wrap container" role="document">
      <div class="content row">
        <main class="main" role="main">
          
<div id="subpage_nav">
	<div class="subpage_nav_content">
				<h1>Riak Blog</h1>
				<div class="right_side">
					<ul>
						<li><a class="home_link" href="/index.html">Home</a></li>
						<li><a class="home_link" href="/blog/index.html">Blog</a></li>
					</ul>
				</div>
		</div>
	</div>
</div>
<div id="fb-root"></div>
<script>(function (d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id))
			return;
		js = d.createElement(s);
		js.id = id;
		js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=291833560991925";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>
	<div id="content_blogsingle" class="row">
		<div class="tier_1 tier">
			<div class="content_home_1">
				<article class="post-6091 post type-post status-publish format-standard hentry category-technical tag-availability tag-blog tag-cluster tag-nodes tag-riak tag-vnodes">
					<header> 
												<h1 class="entry-title">Riak Core &#8211; The Coordinator</h1>
						<div class="entry-meta">
							<time class="updated" datetime="2011-04-19T22:39:30+00:00">Posted April 19, 2011</time>
							<p class="byline author vcard"> <a href="/posts/author/ryan-zezeski/index.html" rel="author" class="fn">by Ryan Zezeski</a></p>							<p class="category">Category: <a href="/category/technical/index.html" rel="category tag">Technical Blog</a></p>
													</div>
					</header>
					<div class="entry-content">
						<p><em>April 19, 2011</em></p>
<p>This was originally posted on <a href="https://twitter.com/rzezeski">Ryan Zezeski&#8217;s</a> working blog <a href="https://github.com/rzezeski/try-try-try/tree/master/2011/riak-core-the-coordinator">Try Try Try</a>.</p>
<p>At the end of my <a href="https://github.com/rzezeski/try-try-try/tree/master/2011/riak-core-the-vnode">vnode</a> post I asked the question <em>Where&#8217;s the redundancy?</em> There is none in RTS, thus far. Riak Core isn&#8217;t magic but rather a suite of tools for building distributed, highly available systems. You have to build your own redundancy. In this post I&#8217;ll talk about the <em>coordinator</em> and show how to implement one.</p>
<h2>What is a Coordinator?</h2>
<p>Logically speaking, a <em>coordinator</em> is just what it sounds like. It&#8217;s job is to coordinate incoming requests. It enforces the consistency semantics of <a href="http://wiki.riak.com/Riak-Glossary.html#Quorum">N, R and W</a> and performs anti-entropy services like <a href="http://wiki.riak.com/Riak-Glossary.html#Read-Repair">read repair</a>. In simpler terms, it&#8217;s responsible for distributing data across the cluster and re-syncing data when it finds conflicts. You could think of vnodes as the things that Get Shit Done (TM) and the coordinators as the other things telling them what to do and overseeing the work. They work in tandem to make sure your request is being handled as best as it can.</p>
<p>To be more concrete a coordinator is a <a href="http://www.erlang.org/doc/man/gen_fsm.html">gen_fsm</a>. Each request is handled in it&#8217;s own Erlang process. A coordinator communicates with the vnode instances to fulfill requests.</p>
<p>To wrap up, a coordinator</p>
<ul>
<li>coordinates requests</li>
<li>enforces the consistency requirements</li>
<li>performs anti-entropy</li>
<li>is an Erlang process that implements the <code>gen_fsm</code> behavior</li>
<li>and communicates with the vnode instances to execute the request</li>
</ul>
<h2>Implementing a Coordinator</h2>
<p>Unlike the vnode, Riak Core doesn&#8217;t define a coordinator behavior. You have to roll your own each time. I used Riak&#8217;s <a href="https://github.com/basho/riak_kv/blob/master/src/riak_kv_get_fsm.erl">get</a> and <a href="https://github.com/basho/riak_kv/blob/master/src/riak_kv_put_fsm.erl">put</a> coordinators for guidance. You&#8217;ll notice they both have a similar structure. I&#8217;m going to propose a general structure here that you can use as your guide, but remember that there&#8217;s nothing set in stone on how to write a coordinator.</p>
<p>Before moving forward it&#8217;s worth mentioning that you&#8217;ll want to instantiate these coordinators under a <a href="http://www.erlang.org/doc/design_principles/sup_princ.html#id69831">simple_one_for_one</a> supervisor. If you&#8217;ve never heard of <code>simple_one_for_one</code> before then think of it as a factory for Erlang processes of the same type. An incoming request will at some point call <code>supervisor:start_child/2</code> to instantiate a new FSM dedicated to handling this specific request.</p>
<h3>init(Args) -&gt; {ok, InitialState, SD, Timeout}</h3>
<p><code>erlang<br />
Args = term()<br />
InitialState = atom()<br />
SD = term()<br />
Timeout = integer()</code></p>
<p>This is actually part of the <code>gen_fsm</code> behavior, i.e. it&#8217;s a callback you must implement. It&#8217;s job is to specify the <code>InitialState</code> name and it&#8217;s data (<code>SD</code>). In this case you&#8217;ll also want to specify a <code>Timeout</code> value of <code>0</code> in order to immediately go to the <code>InitialState</code>, <code>prepare</code>.</p>
<p>A get coordinator for RTS is passed four arguments.</p>
<ol>
<li><code>ReqId</code>: A unique id for this request.</li>
<li><code>From</code>: Who to send the reply to.</li>
<li><code>Client</code>: The name of the client entity &#8212; the entity that is writing log events to RTS.</li>
<li><code>StatName</code>: The name of the statistic the requester is interested in.</li>
</ol>
<p>All this data will be passed as a list to init and the only work that needs to be done is to build the initial state record and tell the FSM to proceed to the <code>prepare</code> state.</p>
<p><code>erlang<br />
init([ReqId, From, Client, StatName]) -&gt;<br />
SD = #state{req_id=ReqId,<br />
from=From,<br />
client=Client,<br />
stat_name=StatName},<br />
{ok, prepare, SD, 0}.</code></p>
<p>The write coordinator for RTS is very similar but has two additional arguments.</p>
<ol>
<li><code>Op</code>: The operation to be performed, one of <code>set</code>, <code>append</code>, <code>incr</code>,<br />
<code>incrby</code> or <code>sadd</code>.</li>
<li><code>Val</code>: The value of the operation. For the <code>incr</code> op this is <code>undefined</code>.</li>
</ol>
<p>Here is the code.</p>
<p><code>erlang<br />
init([ReqID, From, Client, StatName, Op, Val]) -&gt;<br />
SD = #state{req_id=ReqID,<br />
from=From,<br />
client=Client,<br />
stat_name=StatName,<br />
op=Op,<br />
val=Val},<br />
{ok, prepare, SD, 0}.</code></p>
<h3>prepare(timeout, SD0) -&gt; {next_state, NextState, SD, Timeout}</h3>
<p><code>erlang<br />
SD0 = SD = term()<br />
NextState = atom()<br />
Timeout = integer()</code><br />
The job of <code>prepare</code> is to build the <em>preference list</em>. The preference list is the preferred set of vnodes that should participate in this request. Most of the work is actually done by <code>riak_core_util:chash_key/1</code> and <code>riak_core_apl:get_apl/3</code>. Both the get and write coordinators do the same thing here.</p>
<ol>
<li>Calculate the index in the ring that this request falls on.</li>
<li>From this index determine the <code>N</code> preferred partitions that should handle the request.</li>
</ol>
<p>Here is the code.</p>
<p><code>erlang<br />
prepare(timeout, SD0=#state{client=Client,<br />
stat_name=StatName}) -&gt;<br />
DocIdx = riak_core_util:chash_key({list_to_binary(Client),<br />
list_to_binary(StatName)}),<br />
Prelist = riak_core_apl:get_apl(DocIdx, ?N, rts_stat),<br />
SD = SD0#state{preflist=Prelist},<br />
{next_state, execute, SD, 0}.</code></p>
<p>The fact that the key is a two-tuple is simply a consequence of the fact that Riak Core was extracted from Riak and some of it&#8217;s key-value semantics crossed during the extraction. In the future things like this may change.</p>
<h3>execute(timeout, SD0) -&gt; {next_state, NextState, SD}</h3>
<p><code>erlang<br />
SD0 = SD = term()<br />
NextState = atom()</code></p>
<p>The <code>execute</code> state executes the request by sending commands to the vnodes in the preflist and then putting the coordinator into a waiting state. The code to do this in RTS is really simple; call the vnode command passing it the preference list. Under the covers the vnode has been changed to use <code>riak_core_vnode_master:command/4</code> which will distribute the commands across the <code>Preflist</code> for you. I&#8217;ll talk about this later in the post.</p>
<p>Here&#8217;s the code for the get coordinator.</p>
<p><code>erlang<br />
execute(timeout, SD0=#state{req_id=ReqId,<br />
stat_name=StatName,<br />
preflist=Prelist}) -&gt;<br />
rts_stat_vnode:get(Prelist, ReqId, StatName),<br />
{next_state, waiting, SD0}.</code></p>
<p>The code for the write coordinator is almost identical except it&#8217;s parameterized on <code>Op</code>.</p>
<p><code>erlang<br />
execute(timeout, SD0=#state{req_id=ReqID,<br />
stat_name=StatName,<br />
op=Op,<br />
val=undefined,<br />
preflist=Preflist}) -&gt;<br />
rts_stat_vnode:Op(Preflist, ReqID, StatName),<br />
{next_state, waiting, SD0}.</code></p>
<h3>waiting(Reply, SD0) -&gt; Result</h3>
<p><code>erlang<br />
Reply = {ok, ReqID}<br />
Result = {next_state, NextState, SD}<br />
| {stop, normal, SD}<br />
NextState = atom()<br />
SD0 = SD = term()</code></p>
<p>This is probably the most interesting state in the coordinator as it&#8217;s job is to enforce the consistency requirements and possibly perform anti-entropy in the case of a get. The coordinator waits for replies from the various vnode instances it called in <code>execute</code> and stops once it&#8217;s requirements have been met. The typical shape of this function is to pattern match on the <code>Reply</code>, check the state data <code>SD0</code>, and then either continue waiting or stop depending on the current state data.</p>
<p>The get coordinator waits for replies with the correct <code>ReqId</code>, increments the reply count and adds the <code>Val</code> to the list of <code>Replies</code>. If the quorum <code>R</code> has been met then return the <code>Val</code> to the requester and stop the coordinator. If the vnodes didn&#8217;t agree on the value then return all observed values. In this post I am punting on the conflict resolution and anti-entropy part of the coordinator and exposing the inconsistent state to the client application. I&#8217;ll implement them in my next post. If the quorum hasn&#8217;t been met then continue waiting for more replies.</p>
<p><code>erlang<br />
waiting({ok, ReqID, Val}, SD0=#state{from=From, num_r=NumR0, replies=Replies0}) -&gt;<br />
NumR = NumR0 + 1,<br />
Replies = [Val|Replies0],<br />
SD = SD0#state{num_r=NumR,replies=Replies},<br />
if<br />
NumR =:= ?R -&gt;<br />
Reply =<br />
case lists:any(different(Val), Replies) of<br />
true -&gt;<br />
Replies;<br />
false -&gt;<br />
Val<br />
end,<br />
From ! {ReqID, ok, Reply},<br />
{stop, normal, SD};<br />
true -&gt; {next_state, waiting, SD}<br />
end.</code></p>
<p>The write coordinator has things a little easier here cause all it cares about is knowing that <code>W</code> vnodes executed it&#8217;s write request.</p>
<p><code>erlang<br />
waiting({ok, ReqID}, SD0=#state{from=From, num_w=NumW0}) -&gt;<br />
NumW = NumW0 + 1,<br />
SD = SD0#state{num_w=NumW},<br />
if<br />
NumW =:= ?W -&gt;<br />
From ! {ReqID, ok},<br />
{stop, normal, SD};<br />
true -&gt; {next_state, waiting, SD}<br />
end.</code></p>
<h2>What About the Entry Coordinator?</h2>
<p>Some of you may be wondering why I didn&#8217;t write a coordinator for the <a href="https://github.com/rzezeski/try-try-try/blob/master/2011/riak-core-the-coordinator/rts/src/rts_entry_vnode.erl">entry vnode</a>? If you don&#8217;t remember this is responsible for matching an incoming log entry and then executing it&#8217;s trigger function. For example, any incoming log entry from an access log in combined logging format will cause the <code>total_reqs</code> stat to be incremented by one. I only want this action to occur at maximum once per entry. There is no notion of <code>N</code>. I could write a coordinator that tries to make some guarentees about it&#8217;s execution but for now I&#8217;m ok with possibly dropping data occasionally.</p>
<h2>Changes to rts.erl and rts_stat_vnode</h2>
<p>Now that we&#8217;ve written coordinators to handle requests to RTS we need to refactor the old <a href="https://github.com/rzezeski/try-try-try/blob/master/2011/riak-core-the-vnode/rts/src/rts.erl">rts.erl</a> and <a href="https://github.com/rzezeski/try-try-try/blob/master/2011/riak-core-the-vnode/rts/src/rts_stat_vnode.erl">rts_stat_vnode</a>. The model has changed from rts calling the vnode directly to delegating the work to <a href="https://github.com/rzezeski/try-try-try/blob/master/2011/riak-core-the-coordinator/rts/src/rts_get_fsm.erl">rts_get_fsm</a> which will call the various vnodes and collect responses.</p>
<p>&#8220;`text<br />
rts:get &#8212;-&gt; rts_stat_vnode:get (local)</p>
<pre><code>                                                       /--&gt; stat_vnode@rts1
</code></pre>
<p>rts:get &#8212;-&gt; rts_get_fsm:get &#8212;-&gt; riak_stat_vnode:get &#8211;|&#8212;&gt; stat_vnode@rts2<br />
&#8211;&gt; stat_vnode@rts3<br />
&#8220;`</p>
<p>Instead of performing a synchronous request the <code>rts:get/2</code> function now calls the get coordinator and then waits for a response.</p>
<p><code>erlang<br />
get(Calient, StatName) -&gt;<br />
{ok, ReqID} = rts_get_fsm:get(Client, StatName),<br />
wait_for_reqid(ReqID, ?TIMEOUT).</code></p>
<p>The write requests underwent a similar refactoring.</p>
<p>&#8220;`erlang<br />
do_write(Client, StatName, Op) -&gt;<br />
{ok, ReqID} = rts_write_fsm:write(Client, StatName, Op),<br />
wait_for_reqid(ReqID, ?TIMEOUT).</p>
<p>do_write(Client, StatName, Op, Val) -&gt;<br />
{ok, ReqID} = rts_write_fsm:write(Client, StatName, Op, Val),<br />
wait_for_reqid(ReqID, ?TIMEOUT).<br />
&#8220;`</p>
<p>The <code>rts_stat_vnode</code> was refactored to use <code>riak_core_vnode_master:command/4</code> which takes a <code>Preflist</code>, <code>Msg</code>, <code>Sender</code> and <code>VMaster</code> as argument.</p>
<p><code>Preflist</code>: The list of vnodes to send the command to.</p>
<p><code>Msg</code>: The command to send.</p>
<p><code>Sender</code>: A value describing who sent the request, in this case the coordinator. This is used by the vnode to correctly address the reply message.</p>
<p><code>VMaster</code>: The name of the vnode master for the vnode type to send this command to.</p>
<p><code>erlang<br />
get(Preflist, ReqID, StatName) -&gt;<br />
riak_core_vnode_master:command(Preflist,<br />
{get, ReqID, StatName},<br />
{fsm, undefined, self()},<br />
?MASTER).</code></p>
<h2>Coordinators in Action</h2>
<p>Talk is cheap, let&#8217;s see it in action. Towards the end of the vnode post I made the following statement:</p>
<p>&#8220;If you start taking down nodes you&#8217;ll find that stats start to disappear.&#8221;</p>
<p>One of the main objectives of the coordinator is to fix this problem. Lets see if it worked.</p>
<h3>Build the devrel</h3>
<p><code>bash<br />
make<br />
make devrel</code></p>
<h3>Start the Cluster</h3>
<p><code>bash<br />
for d in dev/dev*; do $d/bin/rts start; done<br />
for d in dev/dev{2,3}; do $d/bin/rts-admin join rts1@127.0.0.1; done</code></p>
<h3>Feed in Some Data</h3>
<p><code>bash<br />
gunzip -c progski.access.log.gz | head -100 | ./replay --devrel progski</code></p>
<h3>Get Some Stats</h3>
<p><code>text<br />
./dev/dev1/bin/rts attach<br />
(rts1@127.0.0.1)1&gt; rts:get("progski", "total_reqs").<br />
{ok,97}<br />
(rts1@127.0.0.1)2&gt; rts:get("progski", "GET").<br />
{ok,91}<br />
(rts1@127.0.0.1)3&gt; rts:get("progski", "total_sent").<br />
{ok,445972}<br />
(rts1@127.0.0.1)4&gt; rts:get("progski", "HEAD").<br />
{ok,6}<br />
(rts1@127.0.0.1)5&gt; rts:get("progski", "PUT").<br />
{ok,not_found}<br />
(rts1@127.0.0.1)6&gt; rts:get_dbg_preflist("progski", "total_reqs").<br />
[{730750818665451459101842416358141509827966271488,<br />
'rts3@127.0.0.1'},<br />
{753586781748746817198774991869333432010090217472,<br />
'rts1@127.0.0.1'},<br />
{776422744832042175295707567380525354192214163456,<br />
'rts2@127.0.0.1'}]<br />
(rts1@127.0.0.1)7&gt; rts:get_dbg_preflist("progski", "GET").<br />
[{274031556999544297163190906134303066185487351808,<br />
'rts1@127.0.0.1'},<br />
{296867520082839655260123481645494988367611297792,<br />
'rts2@127.0.0.1'},<br />
{319703483166135013357056057156686910549735243776,<br />
'rts3@127.0.0.1'}]</code></p>
<p>Don&#8217;t worry about what I did on lines 6 and 7 yet, I&#8217;ll explain in a second.</p>
<h3>Kill a Node</h3>
<p><code>text<br />
(rts1@127.0.0.1)8&gt; os:getpid().<br />
"91461"<br />
Ctrl^D<br />
kill -9 91461</code></p>
<h3>Verify it&#8217;s Down</h3>
<p><code>bash<br />
$ ./dev/dev1/bin/rts ping<br />
Node 'rts1@127.0.0.1' not responding to pings.</code></p>
<h3>Get Stats on rts2</h3>
<p>You&#8217;re results my not exactly match mine as it depends on which vnode instances responded first. The coordinator only cares about getting <code>R</code> responses.</p>
<p><code>text<br />
./dev/dev2/bin/rts attach<br />
(rts2@127.0.0.1)1&gt; rts:get("progski", "total_reqs").<br />
{ok,97}<br />
(rts2@127.0.0.1)2&gt; rts:get("progski", "GET").<br />
{ok,[not_found,91]}<br />
(rts2@127.0.0.1)3&gt; rts:get("progski", "total_sent").<br />
{ok,445972}<br />
(rts2@127.0.0.1)4&gt; rts:get("progski", "HEAD").<br />
{ok,[not_found,6]}<br />
(rts2@127.0.0.1)5&gt; rts:get("progski", "PUT").<br />
{ok,not_found}</code></p>
<h3>Let&#8217;s Compare the Before and After Preflist</h3>
<p>Notice that some gets on <code>rts2</code> return a single value as before whereas others return a list of values. The reason for this is because the <code>Preflist</code> calculation is now including <em>fallback</em> vnodes. A fallback vnode is one that is not on it&#8217;s appropriate physical node. Since we killed <code>rts1</code> it&#8217;s vnode requests must be routed somewhere else. That somewhere else is a fallback vnode. Since the request-reply model between the coordinator and vnode is asynchronous our reply value will depend on which vnode instances reply first. If the instances with values reply first then you get a single value, otherwise you get a list of values. My next post will improve this behavior slightly to take advantage of the fact that we <strong>know</strong> there are still two nodes with the data and there should be no reason to return conflicting values.</p>
<p><code>text<br />
(rts2@127.0.0.1)6&gt; rts:get_dbg_preflist("progski", "total_reqs").<br />
[{730750818665451459101842416358141509827966271488,<br />
'rts3@127.0.0.1'},<br />
{776422744832042175295707567380525354192214163456,<br />
'rts2@127.0.0.1'},<br />
{753586781748746817198774991869333432010090217472,<br />
'rts3@127.0.0.1'}]<br />
(rts2@127.0.0.1)7&gt; rts:get_dbg_preflist("progski", "GET").<br />
[{296867520082839655260123481645494988367611297792,<br />
'rts2@127.0.0.1'},<br />
{319703483166135013357056057156686910549735243776,<br />
'rts3@127.0.0.1'},<br />
{274031556999544297163190906134303066185487351808,<br />
'rts2@127.0.0.1'}]</code></p>
<p>In both cases either <code>rts2</code> or <code>rts3</code> stepped in for the missing <code>rts1</code>. Also, in each case, one of these vnodes is going to return <code>not_found</code> since it&#8217;s a fallback. I added another debug function to determine which one.</p>
<p><code>text<br />
(rts2@127.0.0.1)8&gt; rts:get_dbg_preflist("progski", "total_reqs", 1).<br />
[{730750818665451459101842416358141509827966271488,<br />
'rts3@127.0.0.1'},<br />
97]<br />
(rts2@127.0.0.1)9&gt; rts:get_dbg_preflist("progski", "total_reqs", 2).<br />
[{776422744832042175295707567380525354192214163456,<br />
'rts2@127.0.0.1'},<br />
97]<br />
(rts2@127.0.0.1)10&gt; rts:get_dbg_preflist("progski", "total_reqs", 3).<br />
[{753586781748746817198774991869333432010090217472,<br />
'rts3@127.0.0.1'},<br />
not_found]<br />
(rts2@127.0.0.1)11&gt; rts:get_dbg_preflist("progski", "GET", 1).<br />
[{296867520082839655260123481645494988367611297792,<br />
'rts2@127.0.0.1'},<br />
91]<br />
(rts2@127.0.0.1)12&gt; rts:get_dbg_preflist("progski", "GET", 2).<br />
[{319703483166135013357056057156686910549735243776,<br />
'rts3@127.0.0.1'},<br />
91]<br />
(rts2@127.0.0.1)13&gt; rts:get_dbg_preflist("progski", "GET", 3).<br />
[{274031556999544297163190906134303066185487351808,<br />
'rts2@127.0.0.1'},<br />
not_found]</code></p>
<p>Notice the fallbacks are at the end of each list. Also notice that since we&#8217;re on <code>rts2</code> that <code>total_reqs</code> will almost always return a single value because it&#8217;s fallback is on another node whereas <code>GET</code> has a local fallback and will be more likely to return first.</p>
<h2>Conflict Resolution &amp; Read Repair</h2>
<p>In the next post I&#8217;ll be making several enhancements to the get coordinator by performing basic conflict resolution and implementing read repair.</p>
<p><a href="https://twitter.com/rzezeski">Ryan</a></p>
													
					</div>
				</article>
				</div></div><div class="tier_2 tier">
		<div class="content_home_2 row">
			<h1>Recent Articles</h1>
			<div class="divider_line">
				<img alt="" src="/content/themes/basho-v2/assets/images/blog/divider-line.png">
			</div>
			
<div class="col-sm-6 col-md-3 single_blog">
	<article class="post-13488 post type-post status-publish format-standard hentry category-technical tag-apache-mesos tag-mesosphere tag-riak">
				<header>
						<h2 class="entry-title"><a href="/posts/technical/dcos-and-riak-mesos-framework/index.html?p=13488.html">DC/OS 1.9 and Riak Mesos Framework</a></h2>
			<time class="updated" datetime="2017-03-13T09:47:39+00:00">March 13, 2017</time>
							<p class="byline author vcard"> <a href="/posts/author/pavelhardak/index.html" rel="author" class="fn">Pavel Hardak</a></p>
					</header>
		<div class="entry-summary">
			<p>We are pleased today to announce with Mesosphere, the launch of DC/OS 1.9 and a major upgrade of the integration&#8230; </p>
<div class="learn_more_btn"><a href="/posts/technical/dcos-and-riak-mesos-framework/index.html?p=13488.html">Read More</a></div>
		</div>
	</article>
</div>

<div class="col-sm-6 col-md-3 single_blog">
	<article class="post-13441 post type-post status-publish format-standard hentry category-technical tag-iot tag-riak tag-riak-ts tag-the-weather-company">
				<header>
						<h2 class="entry-title"><a href="/posts/technical/traditional-data-lake-approach-may-not-be-a-good-choice-for-iot-data/index.html?p=13441.html">Traditional “Data Lake” Approach May Not Be A Good Choice for IoT Data</a></h2>
			<time class="updated" datetime="2017-03-01T16:46:22+00:00">March 1, 2017</time>
							<p class="byline author vcard"> <a href="/posts/author/dorothy-pults/index.html" rel="author" class="fn">Dorothy Pults</a></p>
					</header>
		<div class="entry-summary">
			<p>The momentum around Apache Spark continues. Spark Summit East was a big success and Riak’s own Pavel Hardak was among&#8230; </p>
<div class="learn_more_btn"><a href="/posts/technical/traditional-data-lake-approach-may-not-be-a-good-choice-for-iot-data/index.html?p=13441.html">Read More</a></div>
		</div>
	</article>
</div>

<div class="col-sm-6 col-md-3 single_blog">
	<article class="post-13409 post type-post status-publish format-standard hentry category-technical tag-basho-academy tag-riak tag-riak-kv tag-riak-ts">
				<header>
						<h2 class="entry-title"><a href="/posts/technical/basho-academy-install-code-and-go/index.html?p=13409.html">Riak Academy: Install, Code and Go</a></h2>
			<time class="updated" datetime="2017-02-27T10:25:05+00:00">February 27, 2017</time>
							<p class="byline author vcard"> <a href="/posts/author/dorothy-pults/index.html" rel="author" class="fn">Dorothy Pults</a></p>
					</header>
		<div class="entry-summary">
			<p>Are you new to NoSQL and want to find out more about Riak? Riak Academy may be the right place for&#8230; </p>
<div class="learn_more_btn"><a href="/posts/technical/basho-academy-install-code-and-go/index.html?p=13409.html">Read More</a></div>
		</div>
	</article>
</div>

<div class="col-sm-6 col-md-3 single_blog">
	<article class="post-13356 post type-post status-publish format-standard hentry category-technical tag-iot tag-riak-ts">
				<header>
						<h2 class="entry-title"><a href="/posts/technical/create-your-first-riak-ts-table/index.html?p=13356.html">Create Your First Riak TS Table</a></h2>
			<time class="updated" datetime="2017-02-21T19:05:56+00:00">February 21, 2017</time>
							<p class="byline author vcard"> <a href="/posts/author/dorothy-pults/index.html" rel="author" class="fn">Dorothy Pults</a></p>
					</header>
		<div class="entry-summary">
			<p>Customers like Intellicore are doing real-time analysis of IoT data using Riak TS. We want to make it easy for&#8230; </p>
<div class="learn_more_btn"><a href="/posts/technical/create-your-first-riak-ts-table/index.html?p=13356.html">Read More</a></div>
		</div>
	</article>
</div>
		</div>
	</div>
		
	<div class="divider_bar shadow"></div>
</div>         </main><!-- /.main -->
                  <aside class="sidebar" role="complementary">
                      </aside><!-- /.sidebar -->
              </div><!-- /.content -->
    </div><!-- /.wrap -->
    <footer class="content-info" role="contentinfo">
	<div class="container">
		<div class="footer_menu row">
			<div class="footer-content row">

				<div class="col-sm-12 col-md-8">

					<div class="four-menus">

	<div class="col-xs-6 col-sm-3 menu_col left">
		<ul>
		<li><a href="/products/">Products</a></li><li><a href="/products/integrations/">Integrations</a></li><li><a href="/resources/">Resources</a></li><li><a href="/resources/nosql-databases/index.html?p=9937.html">NoSQL Explained</a></li>							</ul>
	</div>
	<div class="col-xs-6 col-sm-3 menu_col middle">
		<ul>
		<li><a href="/about/">About Riak</a></li><li><a href="/newsroom/">Newsroom</a></li>							</ul>
	</div>
	<div class="col-xs-6 col-sm-3 menu_col middle">
		<ul>
		<li><a href="/blog/">Blog</a></li><li><a href="/community/">DEVELOPERS</a></li>							</ul>
	</div>
	<div class="col-xs-6  col-sm-3 menu_col right">
		<ul>
									</ul>

	</div>

</div>
<div class="copyright col-xs-12">
						
											</div>
				</div>
				<div class="col-sm-12 col-md-3 footer-right">

					<div class="logo">
						<a href="/index.html"><img alt="" src="/content/themes/basho-v2/dist/images/riak-footer-logo.png"></a>
					</div>

										<div class="cf clearfix"></div>

				</div>

				<div class="back_top">
					<img alt="" src="/content/themes/basho-v2/dist/images/back-top.png">
				</div>


			</div>


		</div>
	</div>
</footer>
<div class="sidenav">
 

</div>


</div>


<!-- google analytics code here -->
<link rel='stylesheet' id='eventon_dynamic_styles-css'  href='/content/plugins/eventON/assets/css/eventon_dynamic_styles.css?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"http:\/\/riak.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='/content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9'></script>
<script type='text/javascript' src='/includes/js/hoverIntent.min.js?ver=1.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var megamenu = {"timeout":"300","interval":"100","effect":{"fadeUp":{"in":{"animate":{"opacity":"show","margin-top":"0"},"css":{"margin-top":"10px"}},"out":{"animate":{"opacity":"hide","margin-top":"10px"}}}}};
/* ]]> */
</script>
<script type='text/javascript' src='/content/plugins/megamenu/js/maxmegamenu.js?ver=2.3.8'></script>
<script type='text/javascript' src='/content/plugins/megamenu-pro/assets/public.js?ver=1.4.5'></script>
<script type='text/javascript' src='/includes/js/jquery/ui/core.min.js?ver=1.11.4'></script>
<script type='text/javascript' src='/includes/js/jquery/ui/position.min.js?ver=1.11.4'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pum_vars = {"ajaxurl":"http:\/\/riak.com\/wp-admin\/admin-ajax.php","restapi":"http:\/\/riak.com\/wp-json\/pum\/v1","rest_nonce":null,"default_theme":"11522","debug_mode":"","disable_open_tracking":""};
var pum_debug_vars = {"debug_mode_enabled":"Popup Maker Debug Mode Enabled","debug_started_at":"Debug started at:","debug_more_info":"For more information on how to use this information visit http:\/\/docs.wppopupmaker.com\/?utm_medium=js-debug-info&utm_campaign=ContextualHelp&utm_source=browser-console&utm_content=more-info","global_info":"Global Information","localized_vars":"Localized variables","popups_initializing":"Popups Initializing","popups_initialized":"Popups Initialized","single_popup_label":"Popup: #","theme_id":"Theme ID: ","label_method_call":"Method Call:","label_method_args":"Method Arguments:","label_popup_settings":"Settings","label_triggers":"Triggers","label_cookies":"Cookies","label_delay":"Delay:","label_conditions":"Conditions","label_cookie":"Cookie:","label_settings":"Settings:","label_selector":"Selector:","label_mobile_disabled":"Mobile Disabled:","label_tablet_disabled":"Tablet Disabled:","label_display_settings":"Display Settings:","label_close_settings":"Close Settings:","label_event_before_open":"Event: Before Open","label_event_after_open":"Event: After Open","label_event_open_prevented":"Event: Open Prevented","label_event_setup_close":"Event: Setup Close","label_event_close_prevented":"Event: Close Prevented","label_event_before_close":"Event: Before Close","label_event_after_close":"Event: After Close","label_event_before_reposition":"Event: Before Reposition","label_event_after_reposition":"Event: After Reposition","label_event_checking_condition":"Event: Checking Condition","triggers":{"click_open":{"name":"Click Open","modal_title":"Click Trigger Settings","settings_column":"<strong>Extra Selectors<\/strong>: {{data.extra_selectors}}"},"auto_open":{"name":"Auto Open","modal_title":"Auto Open Settings","settings_column":"<strong>Delay<\/strong>: {{data.delay}}"},"scroll":{"name":"Scroll","modal_title":"Scroll Trigger Settings","settings_column":"<strong>Trigger<\/strong>: {{data.trigger}}"}},"cookies":{"on_popup_open":{"name":"On Popup Open","modal_title":"On Popup Open Settings"},"on_popup_close":{"name":"On Popup Close","modal_title":"On Popup Close Settings"},"manual":{"name":"Manual JavaScript","modal_title":"Click Trigger Settings"}}};
var ajaxurl = "http:\/\/riak.com\/wp-admin\/admin-ajax.php";
var popmake_default_theme = "11522";
/* ]]> */
</script>
<script type='text/javascript' src='/content/plugins/popup-maker/assets/js/site.min.js?defer&amp;ver=1.6.6.js' defer='defer'></script>
<script type='text/javascript' src='/content/plugins/popup-maker-scroll-triggered-popups/assets/js/site.min.js?defer&amp;ver=1.2.3.js' defer='defer'></script>

<!-- inject:js -->
<script src="/content/themes/basho-v2/dist/scripts/scripts-cd91f277db.min.js"></script>
<!-- endinject -->
<script type='text/javascript' src='/includes/js/embed.min.js?ver=4.8.2'></script>
  </body>
</html>
