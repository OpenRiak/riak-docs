---
title: "Re: Java Riak client can't handle a Riak node failure?"
description: ""
project: community
lastmod: 2015-10-07T05:30:21-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16615"
mailinglist_parent_id: "msg16613"
author_name: "Dmitri Zagidulin"
project_section: "mailinglistitem"
sent_date: 2015-10-07T05:30:21-07:00
---


Hi Vanessa,

Riak is definitely meant to run behind a load balancer. (Or, at the worst
case, to be load-balanced on the client side. That is, all clients connect
to all 4 nodes).

When you say "we did try putting all 4 Riak nodes behind a load-balancer
and pointing the clients at it, but it didn't help." -- what do you mean
exactly, by "it didn't help"? What happened when you tried using the load
balancer?



On Wed, Oct 7, 2015 at 1:57 PM, Vanessa Williams &lt;
vanessa.willi...@thoughtwire.ca&gt; wrote:

&gt; Hi all, we are still (for a while longer) using Riak 1.4 and the matching
&gt; Java client. The client(s) connect to one node in the cluster (since that's
&gt; all it can do in this client version). The cluster itself has 4 nodes
&gt; (sorry, we can't use 5 in this scenario). There are 2 separate clients.
&gt;
&gt; We've tried both n\_val = 3 and n\_val=4. We achieve consistency-by-writes
&gt; by setting w=all. Therefore, we only require one successful read (r=1).
&gt;
&gt; When all nodes are up, everything is fine. If one node fails, the clients
&gt; can no longer read any keys at all. There's an exception like this:
&gt;
&gt; com.basho.riak.client.RiakRetryFailedException:
&gt; java.net.ConnectException: Connection refused
&gt;
&gt; Now, it isn't possible that Riak can't operate when one node fails, so
&gt; we're clearly missing something here.
&gt;
&gt; Note: we did try putting all 4 Riak nodes behind a load-balancer and
&gt; pointing the clients at it, but it didn't help.
&gt;
&gt; Riak is a high-availability key-value store, so... why are we failing to
&gt; achieve high-availability? Any suggestions greatly appreciated, and if more
&gt; info is required I'll do my best to provide it.
&gt;
&gt; Thanks in advance,
&gt; Vanessa
&gt;
&gt; --
&gt; Vanessa Williams
&gt; ThoughtWire Corporation
&gt; http://www.thoughtwire.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

