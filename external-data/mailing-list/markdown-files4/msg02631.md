---
title: "Re: Putting Specific Bucket/Key Combination Gives Timeout"
description: ""
project: community
lastmod: 2011-03-14T05:44:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02631"
mailinglist_parent_id: "msg02630"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-03-14T05:44:36-07:00
---


We are aware of some race-conditions caused by repeatedly accessing a key 
around DELETE requests. Here's one bug:

https://issues.basho.com/show\_bug.cgi?id=555

If you need to clear the data after a test run, I would suggest using the 
'riak\_kv\_test\_backend' from the Ripple project, or simply shut down Riak and 
delete the contents of the bitcask directory.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Mar 14, 2011, at 8:27 AM, Runar Jordahl wrote:

&gt; I am running unit tests against my single-node Riak database installed
&gt; on Ubuntu 10.10 64 bit. The tests write a few objects (key/value) to
&gt; the database, and then end by deleting all keys in the test bucket.
&gt; The test bucket is named “epigenttest”, the key I use is “test”.
&gt; 
&gt; Today the database entered a state where my default bucket/key used
&gt; for tests failed: If I tried doing a PUT using the following URL, I
&gt; got a timeout:
&gt; http://riaktest:8098/riak/epigenttest/test
&gt; 
&gt; However, if I modified the bucket or the key, the operation worked.
&gt; 
&gt; I could always reproduce the problem using bucket/key
&gt; epigenttest/test. I suspect that the database had corrupt data, which
&gt; prevented me from putting epigenttest/test.
&gt; 
&gt; Before running the unit test, Riak reported that the database was empty:
&gt; http://riaktest:8098/riak?buckets=true
&gt; {"buckets":[]}
&gt; 
&gt; I managed to get out of the problem by running “riak reboot”. I cannot
&gt; reproduce the problem again.
&gt; 
&gt; Could there be a bug in Riak when adding/deleting/putting the same
&gt; key? Below I include the result of running Riak Stats.
&gt; 
&gt; 
&gt; Kind regards
&gt; Runar Jordahl
&gt; 
&gt; 
&gt; 
&gt; http://riaktest:8098/stats
&gt; {
&gt; "vnode\_gets": 3,
&gt; "vnode\_puts": 0,
&gt; "read\_repairs": 0,
&gt; "vnode\_gets\_total": 1277,
&gt; "vnode\_puts\_total": 511,
&gt; "node\_gets": 1,
&gt; "node\_gets\_total": 427,
&gt; "node\_get\_fsm\_time\_mean": 25691.0,
&gt; "node\_get\_fsm\_time\_median": 25691,
&gt; "node\_get\_fsm\_time\_95": 25691,
&gt; "node\_get\_fsm\_time\_99": 25691,
&gt; "node\_get\_fsm\_time\_100": 25691,
&gt; "node\_puts": 1,
&gt; "node\_puts\_total": 201,
&gt; "node\_put\_fsm\_time\_mean": 60000872.0,
&gt; "node\_put\_fsm\_time\_median": 60000872,
&gt; "node\_put\_fsm\_time\_95": 60000872,
&gt; "node\_put\_fsm\_time\_99": 60000872,
&gt; "node\_put\_fsm\_time\_100": 60000872,
&gt; "read\_repairs\_total": 5,
&gt; "cpu\_nprocs": 292,
&gt; "cpu\_avg1": 56,
&gt; "cpu\_avg5": 61,
&gt; "cpu\_avg15": 64,
&gt; "mem\_total": 1050324992,
&gt; "mem\_allocated": 521408512,
&gt; "nodename": "riak@127.0.0.1",
&gt; "connected\_nodes": [
&gt; 
&gt; ],
&gt; "sys\_driver\_version": "1.5",
&gt; "sys\_global\_heaps\_size": 0,
&gt; "sys\_heap\_type": "private",
&gt; "sys\_logical\_processors": 1,
&gt; "sys\_otp\_release": "R13B04",
&gt; "sys\_process\_count": 212,
&gt; "sys\_smp\_support": false,
&gt; "sys\_system\_version": "Erlang R13B04 (erts-5.7.5) [source] [rq:1]
&gt; [async-threads:64] [kernel-poll:true]",
&gt; "sys\_system\_architecture": "i486-pc-linux-gnu",
&gt; "sys\_threads\_enabled": true,
&gt; "sys\_thread\_pool\_size": 64,
&gt; "sys\_wordsize": 4,
&gt; "ring\_members": [
&gt; "riak@127.0.0.1"
&gt; ],
&gt; "ring\_num\_partitions": 64,
&gt; "ring\_ownership": "[{'riak@127.0.0.1',64}]",
&gt; "ring\_creation\_size": 64,
&gt; "storage\_backend": "riak\_kv\_bitcask\_backend",
&gt; "pbc\_connects\_total": 0,
&gt; "pbc\_connects": 0,
&gt; "pbc\_active": 0,
&gt; "cluster\_info\_version": "1.0.0",
&gt; "luwak\_version": "1.0.0",
&gt; "skerl\_version": "1.0.0",
&gt; "riak\_kv\_version": "0.14.0",
&gt; "riak\_core\_version": "0.14.0",
&gt; "bitcask\_version": "1.1.5",
&gt; "luke\_version": "0.2.3",
&gt; "webmachine\_version": "1.8.0",
&gt; "mochiweb\_version": "1.7.1",
&gt; "erlang\_js\_version": "0.5.0",
&gt; "runtime\_tools\_version": "1.8.3",
&gt; "crypto\_version": "1.6.4",
&gt; "os\_mon\_version": "2.2.5",
&gt; "riak\_err\_version": "1.0.0",
&gt; "sasl\_version": "2.1.9",
&gt; "stdlib\_version": "1.16.5",
&gt; "kernel\_version": "2.13.5",
&gt; "executing\_mappers": 0
&gt; }
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

