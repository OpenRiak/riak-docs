---
title: "Re: Riak Search Map Reduce error"
description: ""
project: community
lastmod: 2013-11-20T09:48:02-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13034"
mailinglist_parent_id: "msg13031"
author_name: "Todd Tyree"
project_section: "mailinglistitem"
sent_date: 2013-11-20T09:48:02-08:00
---


Hi Roger,

Sorry, meant to reply to the mailing list, but accidentally replied
directly to you.

Before I can say whether or not secondary indexes are suitable, I need to
know more about your data, access patterns and query patterns.

Can you share this information with me here? What kind of data is being
searched and how frequently is it updated?

Best,
Todd


On Wed, Nov 20, 2013 at 5:05 PM, Roger Diller  wrote:

&gt; Do you have any other suggestions on how we can find data in real time
&gt; from a bucket (without moving to 2.0)? What about secondary indexes?
&gt;
&gt;
&gt; On Wed, Nov 20, 2013 at 11:59 AM, Todd Tyree  wrote:
&gt;
&gt;&gt; Hi Roger,
&gt;&gt;
&gt;&gt; You are essentially correct in that map reduce was never designed as a
&gt;&gt; realtime query tool.
&gt;&gt;
&gt;&gt; However, we do have a solution in a technology preview release stage that
&gt;&gt; may solve this problem for you: Yokozuna [0]. It is a tight integration of
&gt;&gt; Riak and Solr and brings the best of both technologies together.
&gt;&gt;
&gt;&gt; It is currently scheduled for release as part of Riak 2.0, but you can
&gt;&gt; clone the repo and build it now if you would like. Just be aware it is
&gt;&gt; still undergoing development and the API may be subject to change before
&gt;&gt; the final release.
&gt;&gt;
&gt;&gt; [0] https://github.com/basho/yokozuna
&gt;&gt;
&gt;&gt; Best,
&gt;&gt; Todd
&gt;&gt;
&gt;

On Wed, Nov 20, 2013 at 4:45 PM, Roger Diller  wrote:

&gt; I could dig up all our nitty gritty Riak details but I don't think that
&gt; will help really.
&gt;
&gt; The point I think is this: Using search map reduce is not a viable way to
&gt; do real time search queries. Especially ones that may have 2000+ plus
&gt; results each. Couple that with search requests coming in every few seconds
&gt; from 300+ customer app instances and you literally bring Riak to it's
&gt; knees.
&gt;
&gt; Not that Riak is the problem really, it's just we are using it in a way it
&gt; was not designed for. In essence, we are using Riak as a search engine for
&gt; our application data. Correct me if I'm wrong but Riak is more for storing
&gt; large amounts of KV data, but not really for finding that data in a search
&gt; sense.
&gt;
&gt; Am I missing something here? Is there a viable way for doing real time
&gt; search queries on a bucket with 1 million keys?
&gt;
&gt;
&gt; On Mon, Nov 18, 2013 at 5:29 PM, Alexander Sicular wrote:
&gt;
&gt;&gt; More info please...
&gt;&gt;
&gt;&gt; Version
&gt;&gt; Current config
&gt;&gt; Hardware
&gt;&gt; Data size
&gt;&gt; Search Schema
&gt;&gt; Etc.
&gt;&gt;
&gt;&gt; But I would probably say that your search is returning too many keys to
&gt;&gt; your mr. More inline.
&gt;&gt;
&gt;&gt; @siculars
&gt;&gt; http://siculars.posthaven.com
&gt;&gt;
&gt;&gt; Sent from my iRotaryPhone
&gt;&gt;
&gt;&gt; On Nov 18, 2013, at 13:59, Roger Diller 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt; Using the Riak Java client, I am executing a search map reduce like this:
&gt;&gt;
&gt;&gt; MapReduceResult result = riakClient.mapReduce(SEARCH\_BUCKET,
&gt;&gt; search).execute();
&gt;&gt;
&gt;&gt;
&gt;&gt; ^is this part a typo. Cause otherwise it looks like you do a s&gt;mr, set
&gt;&gt; the search and then another s&gt;mr.
&gt;&gt;
&gt;&gt;
&gt;&gt; String search = "systemId:" + systemName + " AND indexId:" + indexId;
&gt;&gt;
&gt;&gt; MapReduceResult result = riakClient.mapReduce(SEARCH\_BUCKET,
&gt;&gt; search).execute();
&gt;&gt;
&gt;&gt; This worked fine when the bucket contained a few thousand keys. Now that
&gt;&gt; we have far more data stored in the bucket (at least 250K keys), it's
&gt;&gt; throwing this generic error:
&gt;&gt;
&gt;&gt; com.basho.riak.client.RiakException: java.io.IOException:
&gt;&gt; {"error":"map\_reduce\_error"}
&gt;&gt;
&gt;&gt; We've also noticed that storing new key/values in the bucket has slowed
&gt;&gt; WAY down.
&gt;&gt;
&gt;&gt; Any idea what's going on?
&gt;&gt;
&gt;&gt;
&gt;&gt; Your data set is incorrectly sized to your production config.
&gt;&gt;
&gt;&gt; Are there limitations to Search Map Reduce?
&gt;&gt;
&gt;&gt;
&gt;&gt; Certainly
&gt;&gt;
&gt;&gt; Are there configuration options that need changed?
&gt;&gt;
&gt;&gt;
&gt;&gt; Possibly
&gt;&gt;
&gt;&gt; Any help would be greatly appreciated.
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Roger Diller
&gt;&gt; Flex Rental Solutions, LLC
&gt;&gt; Email: ro...@flexrentalsolutions.com
&gt;&gt; Skype: rogerdiller
&gt;&gt; Time Zone: Eastern Time
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Roger Diller
&gt; Flex Rental Solutions, LLC
&gt; Email: ro...@flexrentalsolutions.com
&gt; Skype: rogerdiller
&gt; Time Zone: Eastern Time
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
\*Todd Tyree\*
Client Services Engineer Basho 

mobile: +44(0)7861 220 182
web: www.basho.com
github: tatyree 
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

