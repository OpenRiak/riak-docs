---
title: "Re: Receiving ulimit warning despite setting it"
description: ""
project: community
lastmod: 2013-05-15T21:41:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11087"
mailinglist_parent_id: "msg11086"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2013-05-15T21:41:26-07:00
---



On 16/05/13 14:24, Jared Morrow wrote:

Well the riak-cs / riak / stanchion scripts all drop privileges using
sudo. On RHEL/Centos this sudo exec carries the settings from the
calling user (in the case of init.d, root) so things are fine there. On
Ubuntu/Debian that does not always work. So if you set the ulimit for
the root user, it might not propagate through to the riak-cs / riak /
stanchion users.

So to change that, you should try to change it in /etc/security/limits.conf.


My understanding is that only sessions opened through PAM will be 
effected by the limits.d/\* config files. ie. Not daemon processes.
(I've checked this anyway with the following 
/etc/security/limits.d/riakcs.conf:

riak-cs hard nofile 32002
riak-cs soft nofile 32001
)

As noted previously, this problem was not occurring on the current 
Ubuntu LTS nodes; just the Debian Squeeze ones. Which makes it 
particularly odd.


Thanks for your help so far; I'll continue to investigate and report 
back if I find a solution.


-T


On Wed, May 15, 2013 at 9:54 PM, Toby Corkindale
&gt; wrote:

 I added some debugging to the /etc/init.d/riak-cs script.
 As far as it's concerned the ulimit has been successfully increased
 in there, right before it calls start-stop-daemon.

 Is it possible that part of the Debian infrastructure is dropping
 privileges?


 On 16/05/13 12:34, Toby Corkindale wrote:

 I'm confused -- I'm still seeing some warnings from Riak/RiakCS
 about
 the ulimit being set too low, even though I \*am\* increasing it.

 What am I doing wrong here?


 # cat /etc/default/riak-cs
 ulimit -n 32000

 # ulimit -n 8192
 # service riak-cs start
 !!!!
 !!!! WARNING: ulimit -n is 1024; 4096 is the recommended minimum.
 !!!!

 \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
 riak-users mailing list
 riak-users@lists.basho.com 
 http://lists.basho.com/\_\_mailman/listinfo/riak-users\_\_\_lists.basho.com
 



 \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
 riak-users mailing list
 riak-users@lists.basho.com 
 http://lists.basho.com/\_\_mailman/listinfo/riak-users\_\_\_lists.basho.com
 





\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

