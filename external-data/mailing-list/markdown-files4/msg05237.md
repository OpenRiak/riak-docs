---
title: "Search failure: stream_timeout"
description: ""
project: community
lastmod: 2011-10-21T14:23:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05237"
author_name: "Elias Levy"
project_section: "mailinglistitem"
sent_date: 2011-10-21T14:23:51-07:00
---


I am trying to make use of search in a Riak 1.0.0 cluster loaded with some
data using the leveldb backend through the multibackend, with search turned,
and I am having some trouble.

I am getting the following error:

2011-10-21 20:47:49.268 [error] emulator Error in process &lt;0.32444.102&gt; on
node 'riak@10.214.219.175' with exit value:
{{nocatch,stream\_timeout},[{riak\_search\_op\_utils,gather\_stream\_results,4}]}

The Ruby client dies with a EOFError: end of file reached.

There are also a few of these in the logs:

2011-10-21 20:47:45.624 [info]
&lt;0.88.0&gt;@riak\_core\_sysmon\_handler:handle\_event:85 monitor long\_gc
&lt;0.32535.102&gt; [{initial\_call,{mi\_server,range,10erator/2-fun-1-',2}}]
[{timeout,51},{old\_heap\_block\_size,0},{heap\_block\_size,1346269},{mbuf\_size,0},{stack\_size,13},{old\_heap\_size,0},{heap\_size,931549}]
2011-10-21 20:47:45.873 [info]
&lt;0.88.0&gt;@riak\_core\_sysmon\_handler:handle\_event:85 monitor long\_gc
&lt;0.32523.102&gt; [{initial\_call,{mi\_server,range,10ator,2}}]
[{timeout,54},{old\_heap\_block\_size,0},{heap\_block\_size,2103540},{mbuf\_size,0},{stack\_size,19},{old\_heap\_size,0},{heap\_size,903282}]

I tracked down the issue to part of my query where I try to limited the
results by time using a range. Depending how the query is generated, I may
want a specific range, or records with a timestamp less than some value or
timestamps greater than some value.

I found that if I limited the timestamps to a range that covers a reasonable
number of records the query succeeds. But if the query is of the
form 'ts:[0 TO 1319228408]', then Riak generates that error and the client
connection it shutdown. I am guessing that that queries covers too many
records, which is causing the nodes to take longer than expected to respond,
and that some timeout is being reached and Riak kills the query. Is that
correct?

If so, is there a way to execute a query matching an integer field with a &lt;
or &gt; that may match many records (millions)?

Is there a way to increase whatever timeout is being reached?

Also, while looking at the Solr query syntax I notice that you can use '\*'
instead of trying to use a min or max value in the range to emulate &lt; or &gt;,
e.g. 'ts:\* TO 1319228408]', but Riak does not support this syntax.

Elias Levy
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

