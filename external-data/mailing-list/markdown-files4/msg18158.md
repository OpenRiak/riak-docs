---
title: "Re: Siblings on first write to a key"
description: ""
project: community
lastmod: 2017-04-18T05:29:35-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18158"
mailinglist_parent_id: "msg18157"
author_name: "Daniel Abrahamsson"
project_section: "mailinglistitem"
sent_date: 2017-04-18T05:29:35-07:00
---


Hi Magnus,

This cluster has been running in production for a few months. Key
generation is based on flake (https://github.com/boundary/flake); we
have never experienced a collision in the 3+ years we have been using
it heavily in production. However, I will look into that possibility
as well.

I just noticed that one of the Riak nodes logged this at the time:

2017-04-13 17:42:40.567 [error]
&lt;0.3624.28&gt;@riak\_api\_pb\_server:handle\_info:331 Unrecognized message
{30320806,{ok,{r\_object,&lt;&lt;"session"&gt;&gt;,&lt;&lt;".12011742tWzDvu8mk5WAdfYihfV\_T3DcnJ5VDyXC0c"&gt;&gt;,[{r\_content,{dict,3,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;"X-Riak-VTag"&gt;&gt;,53,114,86,115,108,71,120,112,73,55,108,118,114,100,105,114,107,104,50,66,105,119]],[[&lt;&lt;"index"&gt;&gt;]],[],[[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|{1492,105357,453143}]],[],[]}}},&lt;&lt;...
(actual value removed).

I also have another example (from the same cluster) where there is a
\*single\* writer to a key, but after a few writes/updates, it also got
a sibling error. Also at that time, the write+read took significantly
longer than normal. I'll check if we had any "unrecognized messages"
in the Riak logs at that time as well.

To answer your second question, we are talking to the riak cluster
over protocol buffers, using the official Erlang client.

//Daniel

On Tue, Apr 18, 2017 at 1:51 PM, Magnus Kessler  wrote:
&gt; On 18 April 2017 at 08:20, Daniel Abrahamsson  wrote:
&gt;&gt;
&gt;&gt; I've run into a case where I got a sbiling error/response on the first
&gt;&gt; ever write to a key. I would like to understand how this could happen.
&gt;&gt; Normally when you get siblings, it is because you have written a value
&gt;&gt; with an out-of-date vclock. But since this is the first write, there
&gt;&gt; is no vclock. Could someone shed some light on this for me?
&gt;&gt;
&gt;&gt; It is worth to mention that the it took 3 seconds for Riak to deliver
&gt;&gt; the response, so it is possible there was some kind of network issue
&gt;&gt; at the time.
&gt;&gt;
&gt;&gt; Here are some details about my setup:
&gt;&gt; Number of nodes: 8.
&gt;&gt; n\_val: 5
&gt;&gt; write options: pw: 3 (quorum), return\_body
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; Daniel Abrahamsson
&gt;&gt;
&gt;
&gt;
&gt; Hi Daniel,
&gt;
&gt; Please let me know if all nodes in this cluster were set up completely
&gt; fresh, with empty backend directories, or if any of them had been used
&gt; before for a Riak installation. If the latter is the case, it may be that
&gt; the key in question had already been used once before. Cluster nodes pick up
&gt; data from pre-existing backends.
&gt;
&gt; How do you access the key for read and write operations?
&gt;
&gt; Kind Regards,
&gt;
&gt; Magnus
&gt;
&gt;
&gt; Magnus Kessler
&gt; Client Services Engineer
&gt; Basho Technologies Limited
&gt;
&gt; Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

