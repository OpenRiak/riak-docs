---
title: "Re: A script to check bitcask keydir sizes"
description: ""
project: community
lastmod: 2011-03-24T10:49:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02739"
mailinglist_parent_id: "msg02738"
author_name: "Justin Sheehy"
project_section: "mailinglistitem"
sent_date: 2011-03-24T10:49:16-07:00
---


Hi, Greg.

On Thu, Mar 24, 2011 at 10:17 AM, Greg Nelson  wrote:
&gt; Wouldn't it be the common case that
&gt; there are relatively few buckets?  And so wouldn't it save a lot of memory
&gt; to keep a reference to an interned bucket name string in each entry, instead
&gt; of the whole bucket name?

One reason this isn't done is that bitcask is an independent
application, used-by rather than part-of Riak. It's just a local kv
store, and knows nothing of higher-level concepts like buckets.
Another reason is that there are also users with very many buckets in
use, a situation that makes the proposed solution uncomfortable.

In cases where there are truly few buckets and one knows it would stay
that way, one could plausibly modify riak\_kv\_bitcask\_backend (the part
of Riak that talks to Bitcask) to use a bitcask per bucket on each
vnode instead of a single bitcask per vnode. One downside of that
approach would be that if the number of buckets did grow then the file
descriptor consumption would be large and the node-wide I/O profile
might be much worse as well.

Everything has tradeoffs.

-Justin

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

