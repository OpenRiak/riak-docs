---
title: "Re: What's the maximum seconds to set index on bucket after creating	the index"
description: ""
project: community
lastmod: 2015-09-02T08:28:53-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16486"
mailinglist_parent_id: "msg16485"
author_name: "Fred Dushin"
project_section: "mailinglistitem"
sent_date: 2015-09-02T08:28:53-07:00
---


I apologize, I was wrong about the timeouts -- they are configurable, either 
through the client, or in the advanced config on the Riak server(s).

The timeout gets set in the server here:

https://github.com/basho/yokozuna/blob/2.1.1/src/yz\_pb\_admin.erl#L114 


This means you can set the timeout in the PB client, as in

riakc\_pb\_socket:create\_search\_index(Pid, Index, Schema, [{timeout, Timeout}, 
...])

where timeout is in milliseconds (or the atom 'infinity').

cf. http://basho.github.io/riak-erlang-client/ 


The order of precedence is:

1. client-defined
2. riak config
3. default (45 seconds)

-Fred

&gt; On Sep 2, 2015, at 8:13 AM, Fred Dushin  wrote:
&gt; 
&gt; What is the return value you are getting from 
&gt; rick\_pb\_socket:create\_search\_index? If it's ok, then the Solr cores should 
&gt; have been created on all nodes. Otherwise, you should check the logs for 
&gt; timeout messages, e.g.,
&gt; 
&gt; https://github.com/basho/yokozuna/blob/2.1.1/src/yz\_index.erl#L443 
&gt; 
&gt; 
&gt; If you are getting timeouts, instead of sleeping, you should probably query 
&gt; your cluster for the search index, along the lines of what is done in one of 
&gt; the riak tests, e.g.,
&gt; 
&gt; https://github.com/basho/yokozuna/blob/2.1.1/riak\_test/yz\_pb.erl#L100 
&gt; 
&gt; 
&gt; If necessary, you might want to fold over all nodes in your cluster, to 
&gt; ensure the index has been propagated to all nodes, and possibly use the 
&gt; wait\_for patterns used in the tests.
&gt; 
&gt; Unfortunately, it looks like the internal timeout used to wait for 
&gt; propagation of indexes to all nodes is not configurable -- it defaults to 45 
&gt; seconds:
&gt; 
&gt; https://github.com/basho/yokozuna/blob/2.1.1/include/yokozuna.hrl#L134 
&gt; 
&gt; 
&gt; I hope that helps,
&gt; 
&gt; -Fred
&gt; 
&gt;&gt; On Sep 2, 2015, at 6:27 AM, Hao &gt; 
&gt;&gt; wrote:
&gt;&gt; 
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; What's the maximum seconds to wait after creating an search index and before 
&gt;&gt; setting it on the bucket?
&gt;&gt; 
&gt;&gt; On my local machine, I only need to wait 1 second, sometimes I feel I don't 
&gt;&gt; need to wait at all, but on a production server which is basically zero 
&gt;&gt; traffic, I have to wait about 10 seconds(definitely over 5s) before I can 
&gt;&gt; set the index on a bucket.
&gt;&gt; 
&gt;&gt; I am using riakc\_pb\_socket client. At first I thought something wrong with 
&gt;&gt; my function to "create" and "set" the index but then when I split the 
&gt;&gt; process, it's fine. So seems it's the interval in between that matters.
&gt;&gt; 
&gt;&gt; I need to know how long is the maximum because I need to restore a lot of 
&gt;&gt; buckets and set index on them via a script. I don't care how long it takes 
&gt;&gt; but I don't want it to miss any index not being set on the bucket.
&gt;&gt; 
&gt;&gt; The exact error on the console when I set the index on a bucket is
&gt;&gt; 
&gt;&gt; &lt;&lt;"Invalid bucket properties: [{search\_index,\n 
&gt;&gt; &lt;&lt;\"application\_test\_player\_idx does not exist\"&gt;&gt;}]"&gt;&gt;
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; Hao
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com 
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

