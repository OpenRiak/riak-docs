---
title: "Re: Java map-reduce and result keys"
description: ""
project: community
lastmod: 2012-09-14T06:46:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08535"
mailinglist_parent_id: "msg08533"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2012-09-14T06:46:48-07:00
---



On 14 Sep 2012, at 14:24, Deepak Balasubramanyam wrote:

&gt; Hi,
&gt; 
&gt; I've written a map reduce query on the riak java client like so...
&gt; 
&gt; client.mapReduce(BUCKET).addKeyFilter(keyFilter)
&gt; .addLinkPhase(BUCKET, "\_", false)
&gt; .addMapPhase(new NamedJSFunction("Riak.mapValuesJson"), 
&gt; false)
&gt; .addReducePhase(phaseFunction).execute();
&gt; Collection types = result.getResult(MyType.class);
&gt; 
&gt; This is the class definition for MyType
&gt; 
&gt; public class MyType
&gt; {
&gt; @RiakKey
&gt; private String myKey;
&gt; private String property1;
&gt; private String property2;
&gt; 
&gt; /\* Getters / Setters go here \*/
&gt; }
&gt; 
&gt; When the object mapper deserializes the results into Collection, none 
&gt; of the types have the myKey property populated in them. When I debugged the 
&gt; calls made by riak I realized that the result of the /mapred call does not 
&gt; contain any key information in the body. It only contains the value that each 
&gt; key represents. So that explains why the keys are null in the result.

The Java client doesn't add the value of the @RiakKey field to the value stored 
in riak.

&gt; 
&gt; On the contrary, a link walk in riak returns the Location header for each 
&gt; multipart form entry in the response (Location: /riak/bucket/key). So I guess 
&gt; there is at least some way to tweak a client to parse the location to get the 
&gt; keys, but you lose out on the map-reduce goodness. 
&gt; 
&gt; Is there some way a map-reduce query can be formed to allow the resulting 
&gt; type's RiakKey to be populated ? What are my options ?

A custom Map function may do what you want. Get the Key from the Key Data 
passed to the Map function and add it to the JSON value returned. Jackson 
should then take care of de-serialising it into your values.

Cheers

Russell

&gt; 
&gt; Thanks
&gt; Deepak Bala
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

