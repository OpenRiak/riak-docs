---
title: "Re: mapreduce"
description: ""
project: community
lastmod: 2010-11-10T11:05:41-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01518"
mailinglist_parent_id: "msg01514"
author_name: "francisco treacy"
project_section: "mailinglistitem"
sent_date: 2010-11-10T11:05:41-08:00
---


What version of Riak are you using?

I tried it on 0.13, and I get [] as a result.

Not sure what happens when you don't return though. I would've written:

function(value, keyData, arg){var data =
Riak.mapValuesJson(value)[0];if(data.expires === 0){return
[value.key]} else { return [] } }


2010/11/9 Andrea Campolonghi :
&gt; Thanks Kevin.
&gt; I am testing in this way and I submit this:
&gt;
&gt; {
&gt;
&gt;   "inputs": "bucket",
&gt;
&gt;   "query": [
&gt;
&gt;      {
&gt;
&gt;       "map": {
&gt;
&gt;         "language": "javascript",
&gt;
&gt;         "source": "function(value, keyData, arg){var data =
&gt; Riak.mapValuesJson(value)[0];if(data.expires == 0){return [value.key];}}",
&gt;
&gt; "keep":true
&gt;
&gt;       }
&gt;
&gt;     }
&gt;
&gt;   ]
&gt;
&gt; }
&gt;
&gt; As result I get a generic error like :
&gt;
&gt; {"lineno":483,"message":"JSON.parse","source":"unknown"}
&gt;
&gt; I am having hard time to find a way to debug this.
&gt;
&gt; Any suggestion?
&gt;
&gt; Thanks
&gt;
&gt; Andrea
&gt;
&gt; 2010/11/9 Kevin Smith 
&gt;&gt;
&gt;&gt; That is the JSON format for a MapReduce job. You need to POST it to the
&gt;&gt; mapred end point like so:
&gt;&gt;
&gt;&gt; curl -XPOST -H"content-type=application/json" -d -
&gt;&gt; http://localhost:8098/mapred
&gt;&gt;
&gt;&gt; --Kevin
&gt;&gt; On Nov 9, 2010, at 5:54 AM, Andrea Campolonghi wrote:
&gt;&gt;
&gt;&gt; &gt; I am testing the riak mapreduce syntax.
&gt;&gt; &gt;
&gt;&gt; &gt; I am using the default bucket and I am sure I have something inside in
&gt;&gt; &gt; json format.
&gt;&gt; &gt;
&gt;&gt; &gt; curl -v GET http://localhost:8098/riak/bucket/susi
&gt;&gt; &gt;
&gt;&gt; &gt; get me back :
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; {"idleTime":0,"expires":0,"timeIdle":0,"created":1289247328234,"hits":0,"lastModified":1289247328234,"exprires":1289247328234,"value":"'Susanne'","lifeSpan":0}
&gt;&gt; &gt;
&gt;&gt; &gt; Now When I try to run this from the riak console I do  not get any
&gt;&gt; &gt; result:
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; {"input":"bucket","query":[{"map":{"language":"javascript","source":"function(v)
&gt;&gt; &gt; { return [v]; }","keep":true}}]};
&gt;&gt; &gt;
&gt;&gt; &gt; Any suggestion?
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks
&gt;&gt; &gt;
&gt;&gt; &gt; --
&gt;&gt; &gt; Andrea Campolonghi
&gt;&gt; &gt;
&gt;&gt; &gt; Cell : +39 347 2298435
&gt;&gt; &gt; and...@andreacfm.com
&gt;&gt; &gt; http://www.andreacfm.com
&gt;&gt; &gt;
&gt;&gt; &gt; Railo Team
&gt;&gt; &gt; and...@getrailo.org
&gt;&gt; &gt; http://getrailo.org
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Andrea Campolonghi
&gt;
&gt; Cell : +39 347 2298435
&gt; and...@andreacfm.com
&gt; http://www.andreacfm.com
&gt;
&gt; Railo Team
&gt; and...@getrailo.org
&gt; http://getrailo.org
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

