---
title: "Re: how to really delete keys from Riak"
description: ""
project: community
lastmod: 2016-04-20T14:42:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17246"
mailinglist_parent_id: "msg17243"
author_name: "Shifeng Xiao"
project_section: "mailinglistitem"
sent_date: 2016-04-20T14:42:12-07:00
---


Thanks for the information Alexander and Daniel, I appreciated it.

We are using Riak2.0 and bitcask as backend, and we are writing the keys
once into bucket, keep it for a few hours, then delete it, never update the
existing data.

On Wed, Apr 20, 2016 at 11:32 AM, Alexander Sicular 
wrote:

&gt; Hello Shifeng,
&gt;
&gt; Riak uses Bitcask as its default data backend, it may also use leveldb
&gt; as a backend but must be configured to do so[0][1]. Both bitcask[2]
&gt; and leveldb[3] do not reclaim disk space immediately when a delete is
&gt; issued. Incidentally, neither do updates. Because Riak is
&gt; non-destructive, aka append only, aka no in-place updates, mutation
&gt; operations like updates or deletes are actually writes. For example, a
&gt; 10KB object that is updated four times in some short interval will
&gt; consume 50KB space (original 10KB + 4 x 10KB updates) until
&gt; merge/compaction occurs. A delete is actually a special zero byte
&gt; value write indicating a key is marked for deletion, aka a tombstone.
&gt; Bitcask will reclaim disk space via merge operations which may be
&gt; controlled by the user. Leveldb reclaims disk space via compaction
&gt; operations.
&gt;
&gt; Architects and Developers should take into account their update/delete
&gt; ratios and consider how those will affect disk space consumption and
&gt; consider how deletes operate in distributed systems in general and
&gt; Riak in specific from an application perspective. John Daily wrote a
&gt; must read four part series on Riak's configurable behaviors that all
&gt; Riak developers should be familiar with. Part 3 deals specifically
&gt; with delete related considerations[4].
&gt;
&gt; Thank you,
&gt; Alexander
&gt;
&gt; [0]
&gt; http://docs.basho.com/riak/kv/latest/setup/planning/backend/leveldb/#installing-eleveldb
&gt; [1] http://docs.basho.com/riak/kv/latest/configuring/backend/
&gt; [2] http://docs.basho.com/riak/kv/latest/setup/planning/backend/bitcask/
&gt; [3] http://docs.basho.com/riak/kv/latest/setup/planning/backend/leveldb/
&gt; [4] http://basho.com/posts/technical/riaks-config-behaviors-part-3/
&gt;
&gt; On Wed, Apr 20, 2016 at 8:17 AM, Daniel Abrahamsson
&gt;  wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; What riak version and what riak backend are you using? For leveldb you
&gt; have
&gt; &gt; to take compaction into account, and for older bitcask versions there are
&gt; &gt; known issues with data not being properly deleted.
&gt; &gt;
&gt; &gt; //Daniel
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

