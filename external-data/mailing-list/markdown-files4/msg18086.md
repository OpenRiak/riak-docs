---
title: "Re: 2.2 CPU usage"
description: ""
project: community
lastmod: 2017-03-11T02:01:11-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18086"
mailinglist_parent_id: "msg18059"
author_name: "Magnus Kessler"
project_section: "mailinglistitem"
sent_date: 2017-03-11T02:01:11-08:00
---


On 6 March 2017 at 11:24, Alexander Popov  wrote:

&gt; Did Upgrade production cluster to 2.2.0
&gt; looks that it eat more CPU,
&gt; in idle time 10-30% always( on 2.1.4 was up to 10% with same load )
&gt; in Peaks it takes up to 100% ( on 2.1.4 was peaks was up to 75% )
&gt;

Hi Alexander,

There have been significant changes in Riak-2.2 regarding the Active
Anti-Entropy (AAE) implementation. Please see the upgrading documentation
[0] for more details. When you first upgrade to Riak-2.2, all AAE trees
need to be rebuilt and it may be that the additional CPU load is caused by
this process. Depending on your AAE settings, and data volume this may take
a few days to complete. You can monitor progress with the 'riak-admin
aae-status' command.

I would also recommend to check that there are no other 'beam.smp'
processes running on your system. We have observed elevated CPU load when
the beam process created by running 'riak attach' gets detached from it's
controlling TTY. If you find additional 'beam.smp' processes that are not
otherwise accounted for, it is safe to kill these.

Let us know if this answers your question, and if after a few days the CPU
load returned to normal levels.

Kind Regards,

Magnus

[0]: http://docs.basho.com/riak/kv/2.2.0/setup/upgrading/version/

-- 
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

