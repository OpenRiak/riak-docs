---
title: "Re: crash after single insert"
description: ""
project: community
lastmod: 2011-05-07T08:25:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03280"
mailinglist_parent_id: "msg03276"
author_name: "Gary William Flake"
project_section: "mailinglistitem"
sent_date: 2011-05-07T08:25:24-07:00
---


That was it, Nico. Thanks.

I know we did a forced shutdown this week, which was probably the cause. But I 
would have thought that riak would have taken care of its own lock file 
bookkeeping on restarting.




On May 7, 2011, at 12:45 AM, Nico Meyer wrote:

&gt; Hi Gary,
&gt; 
&gt; I had this problem before a few times.
&gt; It is cause by leftover files named 'bitcask.write.lock'. Normally theey 
&gt; should be cleared automatically after a crash. They contain the OS process ID 
&gt; of the erlang VM which created them, and if there is no such process bitcask 
&gt; deletes the file.
&gt; I believe that there might exists another process with the same process ID as 
&gt; the old riak process. Did you reboot the machine by any chance? since then 
&gt; the PIDs start counting up from 1 again.
&gt; 
&gt; The easy fix for your problem is to delete all bitcask.write.lock files in 
&gt; your bitcask directory (e.g. 'rm /var/lib/bitcask/\*/bitcask.write.lock').
&gt; If you are curious you could check if my hunch is right beforehand. Just look 
&gt; at the contents of any of these files (which looks like: PID 
&gt; /path/to/current/bitcaskfile/123456.bitcask.data), and see if there is 
&gt; another process with the PID.
&gt; 
&gt; Cheers Nico
&gt; 
&gt; 
&gt; On 06.05.2011 23:08, Gary William Flake wrote:
&gt;&gt; Now trying 500 lines.
&gt;&gt; -- GWF
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On May 6, 2011, at 2:05 PM, Gary William Flake wrote:
&gt;&gt; 
&gt;&gt;&gt; Resending with only the last 1000 lines from the log file, so that the list 
&gt;&gt;&gt; server doesn't reject it.
&gt;&gt;&gt; 
&gt;&gt;&gt; Any insights would be greatly appreciated.
&gt;&gt;&gt; 
&gt;&gt;&gt; -- GWF
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On May 6, 2011, at 1:48 PM, Gary William Flake wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Today, after running fine for a couple of weeks, I had erlang crash, 
&gt;&gt;&gt;&gt; making it so that riaksearch can only do reads but no writes.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Nothing has changed with the code and it had been running fine for weeks 
&gt;&gt;&gt;&gt; without a problem. The sasl-error.log is attached.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Any ideas what's going on?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; -- GWF
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

