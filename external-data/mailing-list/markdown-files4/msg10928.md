---
title: "Re: \"expected_binaries\" error in search"
description: ""
project: community
lastmod: 2013-04-17T13:53:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10928"
mailinglist_parent_id: "msg10901"
author_name: "Rob Speer"
project_section: "mailinglistitem"
sent_date: 2013-04-17T13:53:08-07:00
---


I reproduced this at the command line. Here I'm storing two documents, with
IDs 'doc8' and 'doc9', into a search-enabled bucket named 'test-search'.

# This command works, even though 'lsh' is empty. I believe this is because
I've never put a field named 'lsh' in this bucket, 'test-search'.
curl -v -XPUT -H "Content-Type: application/json" -d '{"terms": "empty|en
string|en test|en", "lsh": "", "segments": "d do doc docs"}' '
http://riak.lumi:8098/riak/test-search/doc8?returnbody=true'

# However, if I use the empty string for a field that has ever been indexed
before, \*then\* I get a crash.
curl -v -XPUT -H "Content-Type: application/json" -d '{"terms": "",
"segments": "d do doc docs"}' '
http://riak.lumi:8098/riak/test-search/doc9?returnbody=true'


As requested, I typed that redbug command into the Erlang console, and at
the moment of the crash I get some output. The output baffles me, though.
The included ID is in the style of ID we use for actual documents, which
are stored in totally different buckets, and which I didn't refer to at all
in my testing.

16:42:24 &lt;{mochiweb\_acceptor,init,3}&gt; {riak\_solr\_xml\_xform,xform,
 [&lt;&lt;"xml version=\"1.0\"
?uuid-10f1a788ead64125bd7251ffc5308882"&gt;&gt;]}

16:42:24 &lt;{mochiweb\_acceptor,init,3}&gt; {riak\_solr\_xml\_xform,xform,1} -&gt; {ok,

delete,

[{&lt;&lt;"id"&gt;&gt;,

&lt;&lt;"uuid-10f1a788ead64125bd7251ffc5308882"&gt;&gt;}]}




On Tue, Apr 16, 2013 at 2:55 PM, Ryan Zezeski  wrote:

&gt; Rob,
&gt;
&gt; I don't know what the exact data is. The thing is that it doesn't seem to
&gt;&gt; cause an error on the client side; it just shows up in the server logs to
&gt;&gt; be noticed later.
&gt;&gt;
&gt;
&gt; A non-2XX response will be returned. Verify that the response is 200. If
&gt; it isn't log an error in your app with the exact data passed.
&gt;
&gt;
&gt;&gt; I have a suspicion, though. Is it possible that when I set one of the
&gt;&gt; search fields to the empty string, some protocol along the way turns that
&gt;&gt; into the empty list, which then fails the type-check?
&gt;&gt;
&gt;
&gt; This is my initial suspicion as well. If you can figure out the data
&gt; causing the issue then run that redbug line while inserting the data. From
&gt; the output of that I should be able to figure out what is happening.
&gt;
&gt; -Z
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

