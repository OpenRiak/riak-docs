---
title: "Re: Counters inside Maps"
description: ""
project: community
lastmod: 2014-08-19T15:39:53-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14750"
mailinglist_parent_id: "msg14748"
author_name: "Alex De la rosa"
project_section: "mailinglistitem"
sent_date: 2014-08-19T15:39:53-07:00
---


Hi Luc,

Thanks for your link to the documentation; that was exactly what I saw on
the data dump some time ago, didn't know it was published there :)

Just one question regarding your example in contrast with Sean's...

x.registers['name'].assign('Messi')
x.registers['name\_s'].assign('Messi')

You added "\_s" to the field while Sean removed it and said it will be
"name\_register" automatically... in your case would turn into
"name\_s\_register" I supposed, right?

Thanks!
Alex


On Wed, Aug 20, 2014 at 12:27 AM, Luc Perkins  wrote:

&gt; Alex,
&gt;
&gt; Do you mean a map as in a Python dict or as in a Riak map? If you want to
&gt; create \*footballers\* as a Riak map, skip to the \*Maps\* section in this doc
&gt; . That
&gt; provides a full tutorial for dealing with other Data Types, such as
&gt; counters, within maps, and has Python code samples.
&gt;
&gt; If you're storing Python dicts as JSON in Riak, as in your example, you
&gt; will have to GET the map from Riak and manipulate it client side. So if you
&gt; wanted to add a \*goals\_i\* counter that starts at 0, you'd have to do
&gt; something like this:
&gt;
&gt; \*obj = bucket.get('lionelmessi')\*
&gt; \*obj.data['goals\_i'] = 0\*
&gt; \*obj.store()\*
&gt;
&gt; To increment the counter, you could do so in a function like this:
&gt;
&gt; \*def increment(bucket, key, n):\*
&gt; \* obj = bucket.get(key)\*
&gt; \* obj['goals\_i'] = obj['goals\_i'] + n\*
&gt; \* obj.store()\*
&gt;
&gt; That's of course a very rough example. But you can probably see from this
&gt; example that using Riak maps can be a very nice option if you're using a
&gt; data model that fits. Here's an example of storing your \*lionelmessi\* object
&gt; as a Riak map:
&gt;
&gt; \*riak-admin bucket-type create maps '{"props":{"datatype":"map"}}'\*
&gt; \*riak-admin bucket-type activate maps\*
&gt;
&gt; \*from riak.datatypes import Map\*
&gt;
&gt; \*bucket = client.bucket\_type('maps').bucket('footballers')\*
&gt; \*messi\_map = Map(bucket, 'lionelmessi')\*
&gt; \*messi\_map.registers['name\_s'].assign('Messi')\*
&gt; \*messi\_map.registers['team\_s'].assign('Barcelona')\*
&gt; \*messi\_map.registers['number\_i'].assign(str(10))\*
&gt; \*messi\_map.counters['goals\_i'].increment()\*
&gt; \*messi\_map.store()\*
&gt;
&gt; Luc
&gt;
&gt;
&gt; On Tue, Aug 19, 2014 at 2:59 PM, Alex De la rosa 
&gt; wrote:
&gt;
&gt;&gt; Imagine I have a Riak object "footballer" with some static fields: name,
&gt;&gt; team, number. I store them like this now:
&gt;&gt;
&gt;&gt; 1: CREATE INDEX FOR RIAK SEARCH
&gt;&gt; curl -XPUT "http://148.251.140.229:8098/search/index/ix\_footballers"
&gt;&gt;
&gt;&gt; 2: CREATE BUCKET TYPE
&gt;&gt; riak-admin bucket-type create tp\_footballers
&gt;&gt; '{"props":{"allow\_mult":false,"search\_index":"ix\_footballers"}}'
&gt;&gt; riak-admin bucket-type activate tp\_footballers
&gt;&gt;
&gt;&gt; 3: INSERT A PLAYER
&gt;&gt; bucket = client.bucket\_type('tp\_footballers').bucket('footballers')
&gt;&gt; key = bucket.new('lionelmessi', data={'name\_s':'Messi',
&gt;&gt; 'team\_s':'Barcelona', 'number\_i':10}, content\_type='application/json')
&gt;&gt; key.store()
&gt;&gt;
&gt;&gt; 4: SEARCH FOR BARCELONA PLAYERS
&gt;&gt; r = client.fulltext\_search('ix\_footballers', 'team\_s:Barcelona')
&gt;&gt;
&gt;&gt; So far so good :) BUT... what if I want to have a field "goals\_i" that is
&gt;&gt; a counter that will be incremented each match day with the number of goals
&gt;&gt; he scored? What is the syntax/steps to do to set up "footballers" as a MAP
&gt;&gt; and then put a COUNTER inside? I know is possible as I read it in some data
&gt;&gt; dump some Basho employee passed me some time ago, but I can't manage to see
&gt;&gt; how to do it now.
&gt;&gt;
&gt;&gt; Thanks!
&gt;&gt; Alex
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

