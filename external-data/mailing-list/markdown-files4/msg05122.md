---
title: "Re: precommit - a newbie question"
description: ""
project: community
lastmod: 2011-10-11T01:55:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05122"
mailinglist_parent_id: "msg05121"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-10-11T01:55:19-07:00
---


Hi Hal,
Welcome to Riak!

On 11 Oct 2011, at 09:01, Hal Eisen wrote:

&gt; Greetings!
&gt; 
&gt; I am a new user of Riak, so please forgive me if this has been addressed
&gt; before. I've spent an hour or so reading through the wiki, but couldn't
&gt; find the answer to my question.
&gt; 
&gt; I am trying to install a precommit hook in my test bucket. For now, I
&gt; am storing documents of type text/plain. I can store and retrieve them
&gt; verbatim just fine. As a first attempt at a precommit hook (later
&gt; things will get much more complicated), I would like to apply
&gt; JavaScript's string.toUpperCase() method to my documents. I am having
&gt; trouble getting this to work.
&gt; 
&gt; I gather I need to phrase my precommit something like this:
&gt; 
&gt; curl -X PUT -H "Content-Type: application/json"
&gt; http://127.0.0.1:8098/riak/test -d '{"props":{"precommit":[function(obj)
&gt; { return(obj.toUpperCase()); }; ]}}'
&gt; 
&gt; When I do that, I get a silent failure. I can inspect my bucket:
&gt; 
&gt; curl http://127.0.0.1:8098/riak/test
&gt; 
&gt; but my precommit hook is unmodified.
&gt; 
&gt; Any help would be appreciated.

Your pre-commit hook needs to be a named erlang or Javascript function[1]. You 
define your function in a js file, put the js file on your Riak server(s) 
somewhere and set the app.config riak\_kv env parameter 'js\_source\_dir'[2] to 
the directory that contains the file. We recommend that you namespace your 
functions. You can then define a pre-commit hook like:

{"props": {"precommit": [{"name": "YourNameSpace.yourFun"}]}}

[1] http://wiki.basho.com/Commit-Hooks.html#Configuration
[2] http://wiki.basho.com/Configuration-Files.html#js\_source\_dir

Cheers

Russell

&gt; 
&gt; Thank you,
&gt; Hal
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

