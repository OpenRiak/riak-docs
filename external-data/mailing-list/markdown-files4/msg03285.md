---
title: "riak_kv_multi_backend + custom backend"
description: ""
project: community
lastmod: 2011-05-08T14:38:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03285"
mailinglist_parent_id: "msg02075"
author_name: "Todd"
project_section: "mailinglistitem"
sent_date: 2011-05-08T14:38:44-07:00
---



---------------------------
1. Minor doc suggestion
---------------------------

http://wiki.basho.com/Configuration-Files.html

"""
# riak\_kv\_fs\_backend
Data is stored in binary files on the filesystem

 \* riak\_kv\_fs\_backendroot
 Root directory where the files are stored (ex: /var/lib/riak/data)
"""

"riak\_kv\_fs\_backendroot" should be "riak\_kv\_fs\_backend\_root"


Note: these docs correctly point that out:
http://doc.erlagner.org/riak\_kv/riak\_kv\_fs\_backend.html

-----------------------------------
2. Working example of multi backend
-----------------------------------

Following the previous thread on this, I was able to noodle out how to 
make this work:


a) edit the app.config
++++++++++++++++++++++

user@erlang32:~/projects/riak/riak/rel/riak$ vim etc/app.config

 42 %% Riak KV config
 43 {riak\_kv, [
 44 %% Storage\_backend specifies the Erlang module defining 
the storage

 45 %% mechanism that will be used on this node.
 46 {storage\_backend, riak\_kv\_multi\_backend},
 47 {multi\_backend\_default, &lt;&lt;"cache"&gt;&gt;},
 48 {multi\_backend, [
 49 {&lt;&lt;"bitcask"&gt;&gt;, riak\_kv\_bitcask\_backend, [
 50 {data\_root, "/var/riak/data/bitcask"}
 51 ]},
 52 {&lt;&lt;"filesystem"&gt;&gt;, riak\_kv\_fs\_backend, [
 53 {riak\_kv\_fs\_backend\_root, 
"/var/riak/data/filesystem"}

 54 ]},
 55 {&lt;&lt;"cache"&gt;&gt;, riak\_kv\_cache\_backend, [
 56 {riak\_kv\_cache\_backend\_memory, 1024},
 57 {riak\_kv\_cache\_backend\_ttl, 600},
 58 {riak\_kv\_cache\_backend\_max\_ttl, 3600}
 59 ]}
 60 ]},


b) try to persist data into the filestore backend
+++++++++++++++++++++++++++++++++++++++++++++++++

user@erlang32:~/projects/riak/riak/rel/riak$ ./erts-5.8.3/bin/erl -name 
'riaktest@127.0.0.1' -setcookie riak


Erlang R14B02 (erts-5.8.3) [source] [rq:1] [async-threads:0] 
[kernel-poll:false]


Eshell V5.8.3 (abort with ^G)

(riaktest@127.0.0.1)1&gt; RiakNode = 'riak@127.0.0.1'.
'riak@127.0.0.1'
(riaktest@127.0.0.1)2&gt; net\_adm:ping(RiakNode).
pong
(riaktest@127.0.0.1)3&gt; {ok, C} = riak:client\_connect(RiakNode).
{ok,{riak\_client,'riak@127.0.0.1',&lt;&lt;3,169,233,111&gt;&gt;}}
(riaktest@127.0.0.1)4&gt; C:set\_bucket(&lt;&lt;"Blobs"&gt;&gt;, [{backend, 
&lt;&lt;"filesystem"&gt;&gt;}]).

ok
(riaktest@127.0.0.1)5&gt; Blob=riak\_object:new(&lt;&lt;"Blobs"&gt;&gt;, &lt;&lt;"file1"&gt;&gt;, 
[&lt;&lt;"data blob 1"&gt;&gt;]).

{r\_object,&lt;&lt;"Blobs"&gt;&gt;,&lt;&lt;"file1"&gt;&gt;,
 [{r\_content,{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
 {{[],[],[],[],[],[],[],[],[],[],[],[],...}}},
 [&lt;&lt;"data blob 1"&gt;&gt;]}],
 [],
 {dict,1,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
 {{[],[],[],[],[],[],[],[],[],[],[],[],[],...}}},
 undefined}
(riaktest@127.0.0.1)6&gt; C:put(Blob, 1).
ok

c) retrieve the persisted data
++++++++++++++++++++++++++++++


(riaktest@127.0.0.1)7&gt; {ok, Retrieved} = C:get(&lt;&lt;"Blobs"&gt;&gt;, &lt;&lt;"file1"&gt;&gt;, 1).
{ok,{r\_object,&lt;&lt;"Blobs"&gt;&gt;,&lt;&lt;"file1"&gt;&gt;,
 [{r\_content,{dict,2,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],...},
 {{[],[],[],[],[],[],[],[],[],[],...}}},
 [&lt;&lt;"data blob 1"&gt;&gt;]}],
 [{&lt;&lt;3,169,233,111&gt;&gt;,{1,63472109206}}],
 {dict,1,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],...},
 {{[],[],[],[],[],[],[],[],[],[],[],...}}},
 undefined}}
(riaktest@127.0.0.1)9&gt; riak\_object:get\_value(Retrieved).
[&lt;&lt;"data blob 1"&gt;&gt;]

Hope that helps.

-Todd

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

