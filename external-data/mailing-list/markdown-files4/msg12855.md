---
title: "Re: Configuring Riak 2.0"
description: ""
project: community
lastmod: 2013-11-05T10:50:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12855"
mailinglist_parent_id: "msg12854"
author_name: "Chris Read"
project_section: "mailinglistitem"
sent_date: 2013-11-05T10:50:59-08:00
---


Thanks for the detailed follow up Joe!

I think being able to get the "start time" config is perfect, and just
enough for what I'm after. Ultimately what I want to be able to do is see
if the config we started with is different from the config in the file, and
then perhaps run a diff to see how it has changed.

I guess a little script that would either attach to a running riak or parse
a riak.conf file and spit out the generated erlang is enough for that...

Chris


On Tue, Nov 5, 2013 at 12:13 PM, Joe DeVivo  wrote:

&gt; Chris,
&gt;
&gt; That’s a great question, and unfortunately there’s not a simple answer. I
&gt; am happy to get into the complex answer.
&gt;
&gt; At this point I would actually say that there is no way to get the true
&gt; running configuration of a Riak node. That’s because Riak has two types of
&gt; configuration settings: those that are read every time they’re used, and
&gt; those that are read once when some process starts. Both types live in
&gt; application context, so you can change any of them while running, but those
&gt; changes might not take effect ever.
&gt;
&gt; An example would be when configuring lager. If you were to change the
&gt; lager handlers of a running node to [], you would expect logging to stop
&gt; because you changed the configuration of lager. Lager has actually already
&gt; set up all the handlers at launch, and you’d need to interact with Lager’s
&gt; API to change them. So, now you’re operating in a state where the
&gt; application configuration has changed, but the effective configuration has
&gt; not. In this case, application:get\_all\_env() won’t return the true running
&gt; configuration of Riak. In my opinion, this is an edge case, but not edgy
&gt; enough to ignore.
&gt;
&gt; There are other settings like riak\_core’s handoff\_concurrency, which can
&gt; be changed at runtime by attaching and calling application:set\_env. So what
&gt; we know is that you can change the running configuration, but that doesn’t
&gt; always change what Riak is actually doing.
&gt;
&gt; Now, if we were to ignore this case, and make the assumption that people
&gt; aren’t attaching and changing settings, then we have a couple of options in
&gt; the 2.0 world. Every setting mapped by Cuttlefish has an explicit default
&gt; value (unless that default is supposed to be ‘undefined’). When the
&gt; app.config is generated it is generated as a “complete” app.config. What I
&gt; mean is that every possible configuration setting will be defined, which
&gt; means you don’t have to dig through source to find out what a specific
&gt; application environment variable defaulted to. It will all be in one place.
&gt; Here’s an example generated app.config:
&gt; https://gist.github.com/joedevivo/7320800
&gt;
&gt; Actually, that’s the best you can do right now to see the “start time”
&gt; configuration in Riak 2.0. Unfortunately, that’s still an Erlang
&gt; configuration file, which goes against the spirit of Cuttlefish. I’m hoping
&gt; to add some command line tools in the near future that will make reading
&gt; your configuration easier. One would be to output the “start time” config
&gt; in Cuttlefish’s syntax. The second I am considering is a kind of man-page
&gt; looking thing, but it would output the documentation for a setting and
&gt; include the default value and your value if you have changed it in your
&gt; riak.conf file.
&gt;
&gt; I hope that’s enough to answer your question. Follow up questions welcome,
&gt; as well as opinions on the command line interface that’s still in the
&gt; design phase.
&gt;
&gt; —joe
&gt;
&gt;
&gt;
&gt; On November 5, 2013 at 7:39:30 AM, Chris Read 
&gt; (chris.r...@gmail.com)
&gt; wrote:
&gt;
&gt; Glad someone there is thinking about configuration :D
&gt;
&gt; Question - are you planning on making it just as easy to find out what the
&gt; \_running\_ configuration is? Currently I have to resort to the:
&gt;
&gt; riak-attach
&gt; application:get\_all\_env(...).
&gt;
&gt; incantation to find out settings riak is actually using at the time. While
&gt; I don't mind using attach, it's not always obvious what env you should be
&gt; asking for in the first place...
&gt;
&gt; Thanks,
&gt;
&gt; Chris
&gt;
&gt;
&gt; On Mon, Nov 4, 2013 at 11:36 AM, Joe DeVivo  wrote:
&gt;
&gt;&gt; Riak Users,
&gt;&gt;
&gt;&gt; We've been kind of tiptoeing around the configuration changes for Riak
&gt;&gt; 2.0. Mostly it was because I wanted to have a dramatic reveal at
&gt;&gt; RICON|West. Now that you can see that here (http://ricon.io/west2013.htmlDay 
&gt;&gt; 1, Track 1, 7:08:22), it's time for me to talk to you all about
&gt;&gt; configuration.
&gt;&gt;
&gt;&gt; A lot of what I want to say, I've already written in a cool blog post
&gt;&gt; with fancy features like "syntax highlighting" and "hyperlinks". I
&gt;&gt; encourage you to read my story here:
&gt;&gt; https://github.com/joedevivo/ricon/blob/master/cuttlefish.md
&gt;&gt;
&gt;&gt; The biggest issue I have with the state of configuration in the 2.0 tech
&gt;&gt; preview is the lack of documentation. Changing how we do configuration is
&gt;&gt; going to affect almost all of the documentation. We're working on that
&gt;&gt; already, but in the interim, here's a gist of mappings from old config
&gt;&gt; style to new style: https://gist.github.com/joedevivo/7305410 I'll do my
&gt;&gt; best to keep updating that gist as we make changes to the configuration
&gt;&gt; settings.
&gt;&gt;
&gt;&gt; As you thumb through that gist, please note that some variable names in
&gt;&gt; the 2.0 configuration file may change before release. Cuttlefish makes
&gt;&gt; changing the names of these variables easy, and some names were just
&gt;&gt; transposed from their Erlang counterparts. If you have a better name for
&gt;&gt; some setting in Riak, please reach out to me. While I can't promise to use
&gt;&gt; your suggestion, I'm always interested in how people are actually thinking
&gt;&gt; about configuration.
&gt;&gt;
&gt;&gt; Stay rad,
&gt;&gt; --joe
&gt;&gt;
&gt;&gt; ---
&gt;&gt; Software Engineer at Basho
&gt;&gt; @joedevivo
&gt;&gt; jdev...@basho.com
&gt;&gt; irc: joedevivo
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

