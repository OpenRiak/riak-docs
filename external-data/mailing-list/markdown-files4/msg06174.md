---
title: "Re: Attempting to use secondary indexes"
description: ""
project: community
lastmod: 2012-01-09T00:23:00-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06174"
mailinglist_parent_id: "msg04226"
author_name: "Daniel Rathbone"
project_section: "mailinglistitem"
sent_date: 2012-01-09T00:23:00-08:00
---


I'm trying out 2i, and I'm having a little trouble similar to this old
thread. I don't see any keys returned when I try and query a secondary
index.

My storage\_backend is set to riak\_kv\_eleveldb\_backend. I seem to have
added values to the secondary index well enough - I can see a header
"X-Riak-Meta-All: 2" returned when I request the object by it's regular
key. When I try and query the 2i,

curl -v "127.0.0.1:8071/buckets/cpg\_mb/index/all\_int/0/5"

I simply get

{"keys":[]}

Is there any other configuration I need to set? I simply changed my
backend to ELevelDB and restarted my (single) node. Any other ideas?

Thanks,
Daniel

On Thu, Aug 4, 2011 at 10:35 AM, Craig Muth  wrote:

&gt; &gt; you'll need to look in etc/app.config in the release directory and
&gt; change the value for the storage\_backend setting to riak\_kv\_index\_backend
&gt;
&gt; Thanks.
&gt;
&gt; How stable is the riak\_kv\_index\_backend? If we're aiming to go to prod in
&gt; a couple months would we be better advised to use riak search? It seems as
&gt; though it's functionality is a superset of secondary indexing, though more
&gt; painful to implement.
&gt;
&gt; --Craig
&gt;
&gt;
&gt;
&gt; On Wed, Aug 3, 2011 at 9:48 PM, Jeremiah Peschka &lt;
&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;
&gt;&gt; I believe 1.0 is scheduled for November.
&gt;&gt;
&gt;&gt; ---
&gt;&gt; Jeremiah Peschka
&gt;&gt; Founder, Brent Ozar PLF, LLC
&gt;&gt;
&gt;&gt; On Aug 3, 2011, at 9:47 PM, Antonio Rohman Fernandez wrote:
&gt;&gt;
&gt;&gt; &gt; Another question... the old problem of querying smaller buckets with
&gt;&gt; MapReduce is resolved with secondary indexes?
&gt;&gt; &gt; following this pattern =&gt; curl
&gt;&gt; http://127.0.0.1:8098/buckets/loot/index/category\_bin/eq/armor i think
&gt;&gt; Riak doesn't have to check all the buckets/keys in memory to match the one
&gt;&gt; you look for as it happened on a MapReduce, right? so
&gt;&gt; http://127.0.0.1:8098/buckets/rohman\_messages/index/date\_int/eq/20110801would
&gt;&gt; give me all messages from Rohman ( in a personalized bucket ) for the
&gt;&gt; day 1st of August of 2011 in a much faster way, right?
&gt;&gt; &gt; thanks
&gt;&gt; &gt;
&gt;&gt; &gt; Rohman
&gt;&gt; &gt;
&gt;&gt; &gt; On Thu, 04 Aug 2011 12:38:17 +0800, Antonio Rohman Fernandez wrote:
&gt;&gt; &gt;
&gt;&gt; &gt;&gt; seeing OSCON's PDF... when will we be able to have Riak 1.0 with
&gt;&gt; secondary indexes out? This is an improvement that can help me pretty well
&gt;&gt; out on my project. Any ETA?
&gt;&gt; &gt;&gt; thanks
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Rohman
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On Wed, 3 Aug 2011 22:02:53 -0600, Kelly McLaughlin wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Craig,
&gt;&gt; &gt;&gt; The default backend is bit cask and if you want to use the indexes
&gt;&gt; you'll need to look in etc/app.config in the release directory and change
&gt;&gt; the value for the storage\_backend setting to riak\_kv\_index\_backend instead
&gt;&gt; of riak\_kv\_bitcask\_backend. I suspect that's the problem. Cheers.
&gt;&gt; &gt;&gt; Kelly
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On Aug 3, 2011, at 9:42 PM, Craig Muth wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; I'm running the code example from
&gt;&gt; http://rusty.basho.com.s3.amazonaws.com/Presentations/2011-OSCONData-Portland.pdf
&gt;&gt; &gt;&gt; This succeeds:
&gt;&gt; &gt;&gt; curl \
&gt;&gt; &gt;&gt; -X PUT \
&gt;&gt; &gt;&gt; -d "OPAQUE\_VALUE" \
&gt;&gt; &gt;&gt; -H "x-riak-index-category\_bin: armor" \
&gt;&gt; &gt;&gt; -H "x-riak-index-price\_int: 400" \
&gt;&gt; &gt;&gt; http://127.0.0.1:8098/buckets/loot/keys/gauntlet24
&gt;&gt; &gt;&gt; This verifies it's getting there:
&gt;&gt; &gt;&gt; curl http://127.0.0.1:8098/riak/loot/gauntlet24
&gt;&gt; &gt;&gt; =&gt; OPAQUE\_VALUE
&gt;&gt; &gt;&gt; However, this finds nothing:
&gt;&gt; &gt;&gt; curl http://127.0.0.1:8098/buckets/loot/index/category\_bin/eq/armor
&gt;&gt; &gt;&gt; =&gt; {"keys":[]}
&gt;&gt; &gt;&gt; Whereas in the presentation it says it should return
&gt;&gt; {"keys":["gauntlet24"]}
&gt;&gt; &gt;&gt; Any ideas? Just grabbed the latest from github master.
&gt;&gt; &gt;&gt; --Craig
&gt;&gt; &gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; &gt;&gt; --
&gt;&gt; &gt;&gt; 
&gt;&gt; &gt;&gt;  Antonio Rohman Fernandez
&gt;&gt; &gt;&gt; CEO, Founder & Lead Engineer
&gt;&gt; &gt;&gt; roh...@mahalostudio.com Projects
&gt;&gt; &gt;&gt; MaruBatsu.es
&gt;&gt; &gt;&gt; PupCloud.com
&gt;&gt; &gt;&gt; Wedding Album
&gt;&gt; &gt; --
&gt;&gt; &gt;
&gt;&gt; &gt; Antonio Rohman Fernandez
&gt;&gt; &gt; CEO, Founder & Lead Engineer
&gt;&gt; &gt; roh...@mahalostudio.com Projects
&gt;&gt; &gt; MaruBatsu.es
&gt;&gt; &gt; PupCloud.com
&gt;&gt; &gt; Wedding Album
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
sent from Dan Rathbone's personal email account
http://danrathbone.com -- personal site
http://eastlakeblog.org -- neighborhood blog
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

