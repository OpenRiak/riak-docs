---
title: "Re: CorrugatedIron & Idle Connection"
description: ""
project: community
lastmod: 2013-07-11T17:05:30-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11485"
mailinglist_parent_id: "msg11480"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-07-11T17:05:30-07:00
---


We're aware of problems in our implementation of connection disposal on
time out and we're working to implement fixes for common error scenarios
before we ship 1.4.0 and a hot fix for 1.3.x - while not a complete
solution for the unbounded connection pool that you're seeing, this should
alleviate some of the pain, especially on idle socket timeouts.

I have a few questions for you so we can better direct our fixes and
functionality (both right now and going forward):

What are the data access patterns you're primarily using?
Are you using the streaming APIs?
Are you getting rid of/fully enumerating collections before moving on?
How are you handling errors processing individual items in the IEnumerable?
(This is primarily a concern if you're using the streaming interfaces)

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Thu, Jul 11, 2013 at 7:46 AM, Amir Halatzi wrote:

&gt; We’ve tried that. The result was 3K open connections per Riak node, and
&gt; as you can guess – this is not an improvement.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Do you have other recommendations?\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Thanks,\*\*\*\*
&gt;
&gt; Amir\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*From:\* OJ Reeves [mailto:o...@buffered.io]
&gt; \*Sent:\* 11 July 2013 17:31
&gt; \*To:\* Amir Halatzi
&gt; \*Cc:\* Jeremiah Peschka; riak-users@lists.basho.com
&gt;
&gt; \*Subject:\* Re: CorrugatedIron & Idle Connection\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; This is a discussion we really need to have. Thanks for opening the Github
&gt; issue.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; In the short term, you can "turn off" pooling by setting the pool size to
&gt; zero. This will mean all the connections are done "on the fly".\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Fri, Jul 12, 2013 at 12:26 AM, Amir Halatzi 
&gt; wrote:\*\*\*\*
&gt;
&gt; Just did: https://github.com/DistributedNonsense/CorrugatedIron/issues/153
&gt; \*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; Still, if we’d like to manage it ourselves - how would you recommend going
&gt; about it? Should we interfere with the way you handle the connection, or
&gt; just retry the action on ‘network failure’?\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; BR,\*\*\*\*
&gt;
&gt; Amir\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*From:\* Jeremiah Peschka [mailto:jeremiah.pesc...@gmail.com]
&gt; \*Sent:\* 11 July 2013 17:11
&gt; \*To:\* Amir Halatzi
&gt; \*Cc:\* riak-users@lists.basho.com
&gt; \*Subject:\* Re: CorrugatedIron & Idle Connection\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; We're in the process of figuring out how to best handle killing off idle
&gt; connections inside of CorrugatedIron. If you can head over to
&gt; https://github.com/DistributedNonsense/CorrugatedIron/issues and file a
&gt; new bug report, that would be fantastic.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; We've avoided killing off connections until now because we don't want to
&gt; introduce locking into our connection management. Truthfully, we haven't
&gt; run into a bug report where the network team was killing off connections.\*
&gt; \*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; So, anyway, if you can submit a bug report we'll get on it. It won't make
&gt; it out for the 1.4.0 release, but we can put that in a point release.\*\*\*\*
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; ---\*\*\*\*
&gt;
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\*\*\*\*
&gt;
&gt; MCITP: SQL Server 2008, MVP\*\*\*\*
&gt;
&gt; Cloudera Certified Developer for Apache Hadoop\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; On Thu, Jul 11, 2013 at 6:59 AM, Amir Halatzi 
&gt; wrote:\*\*\*\*
&gt;
&gt; Hi all,
&gt;
&gt; Trying to optimize our application connection pool, we encountered and
&gt; issue with Corrugated Iron and identifying idle/reset connections. Namely,
&gt; if our network infrastructure (firewall/proxy/etc) closes an idle
&gt; connection - we're getting a 'cluster is offline' error code.
&gt;
&gt; I saw that this is a feature in the making (for the past 8 months), but I
&gt; was wondering if any of you found a way around it?
&gt;
&gt; Thank you,
&gt; Amir Halatzi,
&gt; ooVoo
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; --
&gt;
&gt; OJ Reeves\*\*\*\*
&gt;
&gt; +61 431 952 586
&gt; http://buffered.io/\*\*\*\*
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

