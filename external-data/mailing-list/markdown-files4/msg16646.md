---
title: "Re: riak health check"
description: ""
project: community
lastmod: 2015-10-08T23:56:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16646"
mailinglist_parent_id: "msg16631"
author_name: "Ali Rıza KELEŞ"
project_section: "mailinglistitem"
sent_date: 2015-10-08T23:56:26-07:00
---


Hi,

On 8 October 2015 at 12:26, Sargun Dhillon  wrote:
&gt; It's possible that during the strongly consistent joined, there was some
&gt; leader instability. Do you have any logs of the event? Can you recreate the
&gt; event? Also, the recommendation for SC, is to either turn off tree
&gt; verification, or run with 7 nodes, and n=5.

Even I add two more nodes, in my case haproxy would get wrong state.
"GET /ping" is not valid method to identify whether the node is ready
to be responsible for cluster. Is that right?

What about parsing "GET /stats"? Has it any key to help me?

Thanks.


&gt;
&gt; On Thu, Oct 8, 2015 at 2:23 AM, Ali Rıza KELEŞ 
&gt; wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I have a riak cluster of 5 nodes, runinng strong consistent and behind
&gt;&gt; an HaProxy. Yesterday I needed to replace a node which was misplaced.
&gt;&gt; I removed the node and all was OK. Other nodes responded all requests
&gt;&gt; properly and my application continued to run well.
&gt;&gt;
&gt;&gt; I created a new node and make it join the cluster. Application logged
&gt;&gt; some riak errors for 10 or 15 seconds, just after re-clustering. After
&gt;&gt; this period of errors, everything was OK again.
&gt;&gt;
&gt;&gt; I have an idea why I encountered this stiuation but i am not sure.
&gt;&gt; HaProxy health checks got OK from the new node, unless it wasn't ready
&gt;&gt; or even it wasn't a member of riak cluster. And some requests
&gt;&gt; redirected by haproxy to this new alive node.
&gt;&gt;
&gt;&gt; If this scenario is correct, then i need to make haproxy more clever
&gt;&gt; by tuning health check. "option httpchk GET /ping" is not enough to
&gt;&gt; identify a node is really ready for requests. Is there any fine tuned
&gt;&gt; way to achieve this.
&gt;&gt;
&gt;&gt; Thanks for any suggestions.
&gt;&gt;
&gt;&gt; --
&gt;&gt; --
&gt;&gt; Ali Rıza Keleş
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;



-- 
--
Ali Rıza Keleş

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

