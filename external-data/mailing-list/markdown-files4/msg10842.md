---
title: "Re: RIAK-CS crashing with many HEAD requests"
description: ""
project: community
lastmod: 2013-04-10T16:44:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10842"
mailinglist_parent_id: "msg10823"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2013-04-10T16:44:13-07:00
---


Stefan,

Thanks for the report. We will investigate this and let you know what we
find.

Kelly

On Wed, Apr 10, 2013 at 5:05 AM, Silasi Stefan wrote:

&gt; Hello,
&gt;
&gt; I'm testing RIAK-CS as an S3 alternative and I get some strange crashing
&gt; when reading data from it. The following is reproducible with each run of
&gt; the python script.
&gt;
&gt; conn = boto.connect\_s3(
&gt; aws\_access\_key\_id = access\_key,
&gt; aws\_secret\_access\_key = secret\_key,
&gt; host = riak\_host,
&gt; proxy = riak\_host,
&gt; proxy\_port = 8080,
&gt; calling\_format = boto.s3.connection.OrdinaryCallingFormat(),
&gt; debug = 2,
&gt; is\_secure = False,
&gt; )
&gt;
&gt; bucket = conn.create\_bucket('bucket\_name')
&gt;
&gt; for row in rows:
&gt; key=bucket.new\_key(valid\_key\_name)
&gt; if key.exists():
&gt; key.open\_read()
&gt;
&gt;
&gt; If I monitor the riak-cs memory usage, it is growing and growing until
&gt; it's using all RAM+SWAP, then it crashes.
&gt; In the console log, the following line is appended before RIAK-CS crashes:
&gt;
&gt; 2013-04-10 08:28:40.802 [info] &lt;0.41.0&gt; alarm\_handler:
&gt; {set,{system\_memory\_high\_watermark,[]}}
&gt;
&gt; Nothing related in the error.log.
&gt; In access.log I see a lot of HEAD requests for the objects stored.
&gt;
&gt; Current architecture looks like this:
&gt; - 3 virtual machines with 4 cores, 4gb ram, 2gb swap and 1tb disk each
&gt; - RIAK installed on all of them, configured as cluster
&gt; - stanchion installed on all of them
&gt; - RIAK-CS installed on all of them, configured to "speak" only with local
&gt; RIAK
&gt; - about 10GB of data storred in each RIAK with N=3.
&gt;
&gt; The strange thing is that if I move the connect-to part in the FOR loop,
&gt; RIAK-CS memory usage doesn't go over 300MB. Any ideas what could be wrong?
&gt;
&gt; Thank you,
&gt; Stefan.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

