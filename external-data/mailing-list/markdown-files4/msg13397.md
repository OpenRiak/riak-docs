---
title: "Re: riak-2.0.0 preview refuses to start when nodename is changed to	the ip or hostname of the machine"
description: ""
project: community
lastmod: 2014-01-17T03:56:51-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13397"
mailinglist_parent_id: "msg13396"
author_name: "John Shen"
project_section: "mailinglistitem"
sent_date: 2014-01-17T03:56:51-08:00
---


Hector, thanks for getting back to me. Sorry I did not make it clear.

If I start clean, with the only difference in riak.conf being listening to
all ips (0.0.0.0 instead of 127.0.0.1) and nodename changed to the server
name or ip, it does not work. It is not a matter of old data. If I start
with the default nodename 127.0.0.1 it works.

It is a fresh install and there was no previous clustering configuration. I
tried to uninstall riak, remove all riak-related directories, and start
over, the result is the same.

Please let me know what else I should look at.

Thanks!

John Shen


On Thu, Jan 16, 2014 at 3:24 PM, Hector Castro  wrote:

&gt; Hi John,
&gt;
&gt; Did you start this Riak instance successfully with `riak@127.0.0.1`
&gt; before changing `nodename`? If you did, changing the `nodename` can
&gt; cause a failure similar to what you're seeing.
&gt;
&gt; From here your options are:
&gt;
&gt; 1. Discard the existing ring metadata by removing the contents of the
&gt; ring directory. This will require rejoining all nodes into a cluster
&gt; again.
&gt; 2. Rename the node using the riak-admin cluster replace command. This
&gt; will not work if you have previously only started riak with a single
&gt; node.
&gt;
&gt; More details on this (although it references the &lt; 2.0 configuration
&gt; file format) can be found here:
&gt;
&gt; http://docs.basho.com/riak/latest/ops/building/basic-cluster-setup/
&gt;
&gt; --
&gt; Hector
&gt;
&gt;
&gt; On Thu, Jan 16, 2014 at 3:11 PM, John Shen  wrote:
&gt; &gt; i downloaded riak-2.0.0pre5-1.el6.x86\_64.rpm
&gt; &gt; riak node starts fine with
&gt; &gt;
&gt; &gt; ## Name of the riak node
&gt; &gt; # this fails
&gt; &gt; #nodename = riak@myhost.mydomain
&gt; &gt; #this works
&gt; &gt; #nodename = riak@127.0.0.1
&gt; &gt; #this also fails
&gt; &gt; nodename = riak@10.10.10.10
&gt; &gt;
&gt; &gt; the riak processes seem to start still despite the FAILED message, but
&gt; &gt; riak-admin says node is not running.
&gt; &gt;
&gt; &gt; this is RHEL 6
&gt; &gt;
&gt; &gt; thanks for any hint as how to debug
&gt; &gt;
&gt; &gt; Starting riak: riak failed to start within 15 seconds,
&gt; &gt; see the output of 'riak console' for more information.
&gt; &gt; If you want to wait longer, set the environment variable
&gt; &gt; WAIT\_FOR\_ERLANG to the number of seconds to wait.
&gt; &gt; [FAILED]
&gt; &gt;
&gt; &gt; # ps -ef | grep ria[k]
&gt; &gt; riak 28771 1 0 11:53 ? 00:00:00
&gt; &gt; /usr/lib64/riak/erts-5.10.3/bin/epmd -daemon
&gt; &gt; riak 28779 1 0 11:53 ? 00:00:00
&gt; &gt; /usr/lib64/riak/erts-5.10.3/bin/run\_erl -daemon /var/run/riak//
&gt; &gt; /var/log/riak exec /usr/sbin/riak console
&gt; &gt; riak 28782 28779 2 11:53 pts/1 00:01:36
&gt; &gt; /usr/lib64/riak/erts-5.10.3/bin/beam.smp -W w -K true -A 64 -P 256000 --
&gt; &gt; -root /usr/lib64/riak -progname riak -- -home /var/lib/riak -- -boot
&gt; &gt; /usr/lib64/riak/releases/2.0.0pre5/riak -config
&gt; &gt; /var/lib/riak/generated.configs/app.2014.01.16.11.53.05.config -smp
&gt; enable
&gt; &gt; -name riak@10.10.10.10 -setcookie riak -vm\_args
&gt; &gt; /var/lib/riak/generated.configs/vm.2014.01.16.11.53.05.args -pa
&gt; &gt; /usr/lib64/riak/lib/basho-patches -- console
&gt; &gt; riak 28999 28782 0 11:53 ? 00:00:00 sh -s disksup
&gt; &gt; riak 29001 28782 0 11:53 ? 00:00:00
&gt; &gt; /usr/lib64/riak/lib/os\_mon-2.2.13/priv/bin/memsup
&gt; &gt; riak 29002 28782 0 11:53 ? 00:00:00
&gt; &gt; /usr/lib64/riak/lib/os\_mon-2.2.13/priv/bin/cpu\_sup
&gt; &gt;
&gt; &gt; # riak console
&gt; &gt; 13:10:15.193 [info] Application lager started on node nonode@nohost
&gt; &gt; 13:10:15.193 [info] Checking /etc/riak/app.config exists... false
&gt; &gt; 13:10:15.193 [info] Checking /etc/riak/vm.args exists... false
&gt; &gt; 13:10:15.193 [info] No app.config or vm.args detected in /etc/riak,
&gt; &gt; activating cuttlefish
&gt; &gt; 13:10:15.385 [info] Adding Defaults
&gt; &gt; 13:10:15.387 [info] Applying Datatypes
&gt; &gt; 13:10:15.404 [info] Validation
&gt; &gt; 13:10:15.407 [info] Applied 1:1 Mappings
&gt; &gt; 13:10:15.408 [info] Applied Translations
&gt; &gt; config is OK
&gt; &gt; -config /var/lib/riak/generated.configs/app.2014.01.16.13.10.15.config
&gt; &gt; -args\_file /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args
&gt; &gt; -vm\_args /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args
&gt; &gt; Exec: /usr/lib64/riak/erts-5.10.3/bin/erlexec -boot
&gt; &gt; /usr/lib64/riak/releases/2.0.0pre5/riak -config
&gt; &gt; /var/lib/riak/generated.configs/app.2014.01.16.13.10.15.config -args\_file
&gt; &gt; /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args -vm\_args
&gt; &gt; /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args
&gt; -pa
&gt; &gt; /usr/lib64/riak/lib/basho-patches -- console
&gt; &gt; Root: /usr/lib64/riak
&gt; &gt; Erlang R16B02-basho3 (erts-5.10.3) [source] [64-bit] [smp:2:2]
&gt; &gt; [async-threads:64] [kernel-poll:true]
&gt; &gt;
&gt; &gt; Eshell V5.10.3 (abort with ^G)
&gt; &gt; (riak@10.10.10.10)1&gt;
&gt; &gt;
&gt; &gt; not sure how to proceed at this point.
&gt; &gt;
&gt; &gt; Thanks!
&gt; &gt;
&gt; &gt; John Shen
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

