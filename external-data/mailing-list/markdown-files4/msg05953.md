---
title: "Re: some really weird stuff with python client's delete..."
description: ""
project: community
lastmod: 2011-12-15T07:22:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05953"
mailinglist_parent_id: "msg05952"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2011-12-15T07:22:06-08:00
---


Shuhau,

Try adding this to your Riak app.config, under the riak\_kv section:

{delete\_mode, immediate}


On Thu, Dec 15, 2011 at 10:15 AM, Jon Meredith  wrote:

&gt; I was suggesting something like this - keys was being built from two
&gt; buckets, but only deleted on one. Moving your code around a little, would
&gt; something like this work?
&gt;
&gt; # Clean up
&gt; import riak
&gt; print "Clean up time!"
&gt; client = riak.RiakClient()
&gt; bucket = client.bucket("blog")
&gt; keys = bucket.get\_keys()
&gt;
&gt; print "Keys to be cleaned: " + str(keys)
&gt; for key in keys:
&gt; print ("Deleting %s..." % key), not bucket.get(key).delete().exists()
&gt;
&gt; for key in keys:
&gt; print "Verifying %s deleted: %s" % (key, not bucket.get(key).exists())
&gt;
&gt; bucket = client.bucket("users")
&gt; keys = bucket.get\_keys()
&gt;
&gt; print "Keys to be cleaned: " + str(keys)
&gt;
&gt; for key in keys:
&gt; print ("Deleting %s..." % key), not bucket.get(key).delete().exists()
&gt;
&gt; for key in keys:
&gt; print "Verifying %s deleted: %s" % (key, not bucket.get(key).exists())
&gt;
&gt; print "Deleted %d keys!" % len(keys)
&gt;
&gt; On Thu, Dec 15, 2011 at 8:06 AM, Shuhao Wu  wrote:
&gt;
&gt;&gt; I'm trying to delete all the keys from the users bucket and the blog
&gt;&gt; bucket because they are all created by my doctests. I don't want these in
&gt;&gt; my database (they are garbage.. essentially).
&gt;&gt;
&gt;&gt; Shuhao
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Dec 15, 2011 at 9:40 AM, Jon Meredith wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Shuhau,
&gt;&gt;&gt;
&gt;&gt;&gt; Do you intentionally try and delete all of the keys from the users
&gt;&gt;&gt; bucket? The keys list is built from the keys in the blog and the users
&gt;&gt;&gt; bucket. Would changing the code to list the blog bucket, delete then
&gt;&gt;&gt; verify before moving on to the users bucket do what you want?
&gt;&gt;&gt;
&gt;&gt;&gt; Jon
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Dec 14, 2011 at 7:54 PM, Shuhao Wu  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I'm trying to delete all the keys i've created after running some
&gt;&gt;&gt;&gt; doctests. (I know i should be using the test server.. but it appears that i
&gt;&gt;&gt;&gt; need to be root to run that...)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Here's the script:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; #!/usr/bin/python
&gt;&gt;&gt;&gt; if \_\_name\_\_ == "\_\_main\_\_":
&gt;&gt;&gt;&gt; import doctest
&gt;&gt;&gt;&gt; print "Running tests...."
&gt;&gt;&gt;&gt; #doctest.testfile("README.md") # I commented this out because my
&gt;&gt;&gt;&gt; cleanup is not deleting...
&gt;&gt;&gt;&gt; print "If nothing happened, success.. otherwise.. DEBUG HOUR!"
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; # Clean up
&gt;&gt;&gt;&gt; import riak
&gt;&gt;&gt;&gt; print "Clean up time!"
&gt;&gt;&gt;&gt; client = riak.RiakClient()
&gt;&gt;&gt;&gt; bucket = client.bucket("blog")
&gt;&gt;&gt;&gt; keys = bucket.get\_keys()
&gt;&gt;&gt;&gt; bucket = client.bucket("users")
&gt;&gt;&gt;&gt; keys.extend(bucket.get\_keys())
&gt;&gt;&gt;&gt; print "Keys to be cleaned: " + str(keys)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; for key in keys:
&gt;&gt;&gt;&gt; print ("Deleting %s..." % key), not
&gt;&gt;&gt;&gt; bucket.get(key).delete().exists()
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; for key in keys:
&gt;&gt;&gt;&gt; print "Verifying %s deleted: %s" % (key, not
&gt;&gt;&gt;&gt; bucket.get(key).exists())
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; print "Deleted %d keys!" % len(keys)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Here's the output:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Running tests....
&gt;&gt;&gt;&gt; If nothing happened, success.. otherwise.. DEBUG HOUR!
&gt;&gt;&gt;&gt; Clean up time!
&gt;&gt;&gt;&gt; Keys to be cleaned: [u'534c8cda268b11e1b1b68ca982440b40',
&gt;&gt;&gt;&gt; u'b8eb84e8268a11e195748ca982440b40', u'6fa5b678268a11e1bf8d8ca982440b40',
&gt;&gt;&gt;&gt; u'dada10a6268a11e1a0888ca982440b40', u'549e0e2a268a11e1be1e8ca982440b40',
&gt;&gt;&gt;&gt; u'4957347e268a11e196e68ca982440b40', u'c03e2df8268b11e1ae5e8ca982440b40',
&gt;&gt;&gt;&gt; u'ddadfe28268a11e1ad0b8ca982440b40', u'7d54bb7a268a11e187718ca982440b40']
&gt;&gt;&gt;&gt; Deleting 534c8cda268b11e1b1b68ca982440b40... True
&gt;&gt;&gt;&gt; Deleting b8eb84e8268a11e195748ca982440b40... True
&gt;&gt;&gt;&gt; Deleting 6fa5b678268a11e1bf8d8ca982440b40... True
&gt;&gt;&gt;&gt; Deleting dada10a6268a11e1a0888ca982440b40... True
&gt;&gt;&gt;&gt; Deleting 549e0e2a268a11e1be1e8ca982440b40... True
&gt;&gt;&gt;&gt; Deleting 4957347e268a11e196e68ca982440b40... True
&gt;&gt;&gt;&gt; Deleting c03e2df8268b11e1ae5e8ca982440b40... True
&gt;&gt;&gt;&gt; Deleting ddadfe28268a11e1ad0b8ca982440b40... True
&gt;&gt;&gt;&gt; Deleting 7d54bb7a268a11e187718ca982440b40... True
&gt;&gt;&gt;&gt; Verifying 534c8cda268b11e1b1b68ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying b8eb84e8268a11e195748ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying 6fa5b678268a11e1bf8d8ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying dada10a6268a11e1a0888ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying 549e0e2a268a11e1be1e8ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying 4957347e268a11e196e68ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying c03e2df8268b11e1ae5e8ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying ddadfe28268a11e1ad0b8ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Verifying 7d54bb7a268a11e187718ca982440b40 deleted: True
&gt;&gt;&gt;&gt; Deleted 9 keys!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I can run this multiple times and it doesn't delete it and always show
&gt;&gt;&gt;&gt; the exact same output... but if i open a separate python console and delete
&gt;&gt;&gt;&gt; one of these keys via the same method (create a client, get a bucket, get
&gt;&gt;&gt;&gt; the object via key, delete the object...), this will go down to 9 keys...
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What's wrong? I'm so confused by this thing..
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Shuhao
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Jon Meredith
&gt;&gt;&gt; Platform Engineering Manager
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; jmered...@basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Jon Meredith
&gt; Platform Engineering Manager
&gt; Basho Technologies, Inc.
&gt; jmered...@basho.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

