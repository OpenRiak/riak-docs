---
title: "Re: Issues with capacity planning pages on wiki"
description: ""
project: community
lastmod: 2011-05-26T15:43:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03445"
mailinglist_parent_id: "msg03406"
author_name: "Anthony Molinaro"
project_section: "mailinglistitem"
sent_date: 2011-05-26T15:43:09-07:00
---



Hi Justin,

 Thanks for the reply. Good to know you may have some partial
solutions for the sizings of items. Out use case may long term
require us to write out own backend just for space efficiency, but
I'm hoping we can make it quite far with bitcask. I've got enough on
my plate at the moment so am unlikely to get to this before you guys
do, but as I recently forked riak\_kv for something else, you never
know.

Thanks

-Anthony

On Wed, May 25, 2011 at 08:10:29PM -0400, Justin Sheehy wrote:
&gt; Hi, Anthony.
&gt; 
&gt; There are really three different things below:
&gt; 
&gt; 1- reducing the minimum overhead of the {Bucket, Key} encoding when
&gt; riak is storing into bitcask
&gt; 
&gt; 2- reducing the size of the vector clock encoding
&gt; 
&gt; 3- reducing the size of the overall riak\_object structure and metadata
&gt; 
&gt; All three of these are worth doing. The reason they are the way they
&gt; are now is that the initial assumptions for most Riak deployments was
&gt; of a high enough mean object size that these few bytes per object
&gt; would proportionally be small noise -- but that's just history and not
&gt; a reason to avoid improvements.
&gt; 
&gt; In fact, preliminary work has been done on all three of these. It
&gt; just hasn't yet been such a high priority that it got pushed through
&gt; to the finish. One tricky part with all three is backward
&gt; compatibility, as most production Riak clusters do not expect to need
&gt; a full stop every time we want to make an improvement like these.
&gt; 
&gt; Solving #1, by the way, isn't really in bitcask itself but rather in
&gt; riak\_kv\_bitcask\_backend. I can take a swing at that (with backward
&gt; compatibility) shortly. I might also be able to help dig up some of
&gt; the old work on #2 that is nearly a year old, and I think Andy Gross
&gt; may have done some of what's needed for #3.
&gt; 
&gt; With less words: I agree, all this should be made smaller.
&gt; 
&gt; And don't let this stop you if you want to jump ahead and give some of it a 
&gt; try!
&gt; 
&gt; -Justin
&gt; 
&gt; 
&gt; 
&gt; On Wed, May 25, 2011 at 1:50 PM, Anthony Molinaro
&gt;  wrote:
&gt; 
&gt; &gt; Anyway, things make a lot more sense now, and I'm thinking I may need
&gt; &gt; to fork bitcask and get rid of some of that extra overhead.  For instance
&gt; &gt; 13 bytes of overhead to store a tuple of binaries seems unnecessary, it's
&gt; &gt; probably better to just have a single binary with the bucket size as a
&gt; &gt; prefix, so something like
&gt; &gt;
&gt; &gt; &lt;&gt;
&gt; &gt;
&gt; &gt; That way you turn 13 bytes of overhead to 2.
&gt; &gt;
&gt; &gt; Of course I'd need some way to work with old data, but a one time migration
&gt; &gt; shouldn't be too bad.
&gt; &gt;
&gt; &gt; It also seems like there should be some way to trim down some of that on
&gt; &gt; disk usage.  I mean 300+ bytes to store 36 bytes is a lot.

-- 
------------------------------------------------------------------------
Anthony Molinaro 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

