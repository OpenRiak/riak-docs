---
title: "Re: ACLs not being set correctly for riak-cs"
description: ""
project: community
lastmod: 2015-02-27T14:21:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15807"
mailinglist_parent_id: "msg15779"
author_name: "Seema Jethani"
project_section: "mailinglistitem"
sent_date: 2015-02-27T14:21:06-08:00
---


Shawn

Would you be able to open a github issue for this? We will look into this
issue for you. Thanks!



&gt; Date: Mon, 23 Feb 2015 20:41:16 +0000
&gt; From: Shawn Debnath 
&gt; To: "riak-users@lists.basho.com" 
&gt; Subject: ACLs not being set correctly for riak-cs
&gt; Message-ID: &lt;8ab97aa2-f38f-423a-bf8a-98f915806...@debnath.net&gt;
&gt; Content-Type: text/plain; charset="utf-8"
&gt;
&gt; Hi there,
&gt;
&gt; I can't seem to be able to get ACLs set properly on newly created buckets
&gt; in riak-cs. I am using s3curl to push the payload up via PUT /?acl and it
&gt; returns 200 OK. However, a GET /?acl returns an xml payload with missing
&gt; IDs. Without manually pushing new ACLs, the default ACLs correctly gives
&gt; access to the owner, but as soon as I push a custom ACL set, it screws up
&gt; the grants for both the owner and the other users.
&gt;
&gt; NOTE: The keys below are for a private test environment so substitute your
&gt; values accordingly.
&gt;
&gt; Any help appreciated on pointing me to the right direction!
&gt;
&gt; Thanks,
&gt; Shawn
&gt;
&gt;
&gt;
&gt; Here are the three user IDs, keys and secrets. I want the owner to retain
&gt; full control while I want to grant WRITE privileges to publisher and READ
&gt; privileges to reader.
&gt;
&gt;
&gt; admin\_id:
&gt; feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e
&gt; admin\_key: 1049V\_JJHPH7TO\_QPWVC
&gt; admin\_secret: lMQsnn3Cukk1UR28FAtoZiap9KEOjBRgYKiVVg==
&gt; publisher\_id:
&gt; 5efc8fb59754a6d11eb1a36c501a8ef7b1be44b0300fbe3df354423b7a115ac5
&gt; publisher\_key: D-YBO-QHCHU9MEHNZR1D
&gt; publisher\_secret: nin5LA4WHEuJeTuzN-qCWBXsOvTyUbdPuDQ3eg==
&gt; reader\_id:
&gt; de6831d6da88df325d474f7f6c1f708596998c54fc0817685f8c67f1d8cab239
&gt; reader\_key: \_QOKYEHYM6S-YDDHGSYF
&gt; reader\_secret: sFc1HBhjQzfr70Yda-ke257LHkVCPNAN0chs9A==
&gt;
&gt; 
&gt;  xsi:type="CanonicalUser"&gt;
&gt;
&gt; feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e
&gt; 
&gt; FULL\_CONTROL
&gt; 
&gt; 
&gt; 
&gt;
&gt; 5efc8fb59754a6d11eb1a36c501a8ef7b1be44b0300fbe3df354423b7a115ac5
&gt; 
&gt; WRITE
&gt; 
&gt; 
&gt; 
&gt;
&gt; de6831d6da88df325d474f7f6c1f708596998c54fc0817685f8c67f1d8cab239
&gt; 
&gt; READ
&gt; 
&gt; 
&gt; 
&gt;
&gt; 
&gt; $ bin/s3curl.pl --debug --id ${RIAK\_ADMIN\_KEY} --key ${RIAK\_ADMIN\_SECRET}
&gt; --acl private -- -s -v -x localhost:50201 -X PUT
&gt; http://social-media.cs.domain.com/
&gt;
&gt; s3curl: Found the url: host=social-media.cs.domain.com; port=; uri=/;
&gt; query=;
&gt; s3curl: vanity endpoint signing case
&gt; s3curl: StringToSign='PUT\n\n\nMon, 23 Feb 2015 20:03:15
&gt; +0000\nx-amz-acl:private\n/social-media/'
&gt; s3curl: signature='v48ovqQBnqfEcBZ7kPedpbs1Xt4='
&gt; s3curl: exec curl -H Date: Mon, 23 Feb 2015 20:03:15 +0000 -H
&gt; Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:v48ovqQBnqfEcBZ7kPedpbs1Xt4= -H
&gt; x-amz-acl: private -L -s -v -x localhost:50201 -X PUT
&gt; http://social-media.cs.domain.com/
&gt; \* Hostname was NOT found in DNS cache
&gt; \* Trying 127.0.0.1...
&gt; \* Connected to localhost (127.0.0.1) port 50201 (#0)
&gt; &gt; PUT http://social-media.cs.domain.com/ HTTP/1.1
&gt; &gt; User-Agent: curl/7.37.1
&gt; &gt; Host: social-media.cs.domain.com
&gt; &gt; Accept: \*/\*
&gt; &gt; Proxy-Connection: Keep-Alive
&gt; &gt; Date: Mon, 23 Feb 2015 20:03:15 +0000
&gt; &gt; Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:v48ovqQBnqfEcBZ7kPedpbs1Xt4=
&gt; &gt; x-amz-acl: private
&gt; &gt;
&gt; &lt; HTTP/1.1 200 OK
&gt; \* Server Riak CS is not blacklisted
&gt; &lt; Server: Riak CS
&gt; &lt; Date: Mon, 23 Feb 2015 20:03:16 GMT
&gt; &lt; Content-Type: application/xml
&gt; &lt; Content-Length: 0
&gt; &lt;
&gt; \* Connection #0 to host localhost left intact
&gt;
&gt;
&gt; 
&gt; $ bin/s3curl.pl --debug --id ${RIAK\_ADMIN\_KEY} --key
&gt; ${RIAK\_ADMIN\_SECRET} --put /tmp/riak-cs-bucket-policy.xml -- -s -v -x
&gt; localhost:50201 -X PUT http://social-media.cs.domain.com/?acl
&gt;
&gt; s3curl: Found the url: host=social-media.cs.domain.com; port=; uri=/;
&gt; query=acl;
&gt; s3curl: vanity endpoint signing case
&gt; s3curl: StringToSign='PUT\n\n\nMon, 23 Feb 2015 20:03:21
&gt; +0000\n/social-media/?acl'
&gt; s3curl: signature='QAcPGgB1tZO2+U4M0TvP4Q4uyxQ='
&gt; s3curl: exec curl -H Date: Mon, 23 Feb 2015 20:03:21 +0000 -H
&gt; Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:QAcPGgB1tZO2+U4M0TvP4Q4uyxQ= -L -T
&gt; /tmp/riak-cs-bucket-policy.xml -s -v -x localhost:50201 -X PUT
&gt; http://social-media.cs.domain.com/?acl
&gt; \* Hostname was NOT found in DNS cache
&gt; \* Trying 127.0.0.1...
&gt; \* Connected to localhost (127.0.0.1) port 50201 (#0)
&gt; &gt; PUT http://social-media.cs.domain.com/?acl HTTP/1.1
&gt; &gt; User-Agent: curl/7.37.1
&gt; &gt; Host: social-media.cs.domain.com
&gt; &gt; Accept: \*/\*
&gt; &gt; Proxy-Connection: Keep-Alive
&gt; &gt; Date: Mon, 23 Feb 2015 20:03:21 +0000
&gt; &gt; Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:QAcPGgB1tZO2+U4M0TvP4Q4uyxQ=
&gt; &gt; Content-Length: 1003
&gt; &gt; Expect: 100-continue
&gt; &gt;
&gt; &lt; HTTP/1.1 100 Continue
&gt; \* We are completely uploaded and fine
&gt; &lt; HTTP/1.1 200 OK
&gt; \* Server Riak CS is not blacklisted
&gt; &lt; Server: Riak CS
&gt; &lt; Date: Mon, 23 Feb 2015 20:03:21 GMT
&gt; &lt; Content-Type: application/xml
&gt; &lt; Content-Length: 0
&gt; &lt;
&gt; \* Connection #0 to host localhost left intact
&gt;
&gt;
&gt; 
&gt; bin/s3curl.pl --debug --id ${RIAK\_ADMIN\_KEY} --key ${RIAK\_ADMIN\_SECRET}
&gt; -- -s -v -x localhost:50201 -X GET http://social-media.cs.domain.com/?acl
&gt;
&gt; xml version="1.0" encoding="UTF-8"?
&gt; 
&gt; 
&gt;
&gt; feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e
&gt; riak-cs-admin
&gt; 
&gt; 
&gt; 
&gt;  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
&gt; xsi:type="CanonicalUser"&gt;
&gt; 
&gt; 
&gt; 
&gt; FULL\_CONTROL
&gt; 
&gt; 
&gt;  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
&gt; xsi:type="CanonicalUser"&gt;
&gt; 
&gt; 
&gt; 
&gt; READ
&gt; 
&gt; 
&gt;  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
&gt; xsi:type="CanonicalUser"&gt;
&gt; 
&gt; 
&gt; 
&gt; WRITE
&gt; 
&gt; 
&gt; 
&gt;
&gt; 
&gt; s3curl: Found the url: host=riak-cs.cs.domain.com; port=; uri=/users;
&gt; query=;
&gt; s3curl: vanity endpoint signing case
&gt; s3curl: StringToSign='GET\n\n\nMon, 23 Feb 2015 20:30:30
&gt; +0000\n/riak-cs/users'
&gt; s3curl: signature='mOcYNLzS/3PFkXhU8tnM14HQVoI='
&gt; s3curl: exec curl -H Date: Mon, 23 Feb 2015 20:30:30 +0000 -H
&gt; Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:mOcYNLzS/3PFkXhU8tnM14HQVoI= -L -s
&gt; -v -x localhost:50201 -X GET http://riak-cs.cs.domain.com/users
&gt; \* Hostname was NOT found in DNS cache
&gt; \* Trying 127.0.0.1...
&gt; \* Connected to localhost (127.0.0.1) port 50201 (#0)
&gt; &gt; GET http://riak-cs.cs.domain.com/users HTTP/1.1
&gt; &gt; User-Agent: curl/7.37.1
&gt; &gt; Host: riak-cs.cs.domain.com
&gt; &gt; Accept: \*/\*
&gt; &gt; Proxy-Connection: Keep-Alive
&gt; &gt; Date: Mon, 23 Feb 2015 20:30:30 +0000
&gt; &gt; Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:mOcYNLzS/3PFkXhU8tnM14HQVoI=
&gt; &gt;
&gt; &lt; HTTP/1.1 200 OK
&gt; &lt; Vary: Accept
&gt; &lt; Transfer-Encoding: chunked
&gt; \* Server Riak CS is not blacklisted
&gt; &lt; Server: Riak CS
&gt; &lt; Date: Mon, 23 Feb 2015 20:30:30 GMT
&gt; &lt; Content-Type: multipart/mixed; boundary=TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
&gt; &lt;
&gt; --TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
&gt; Content-Type: application/xml
&gt;
&gt;
&gt; xml version="1.0" encoding="UTF-8"?
&gt; 
&gt; 
&gt; riak-cs-publis...@domain.com
&gt; riak-cs-publisher
&gt; publisher
&gt; D-YBO-QHCHU9MEHNZR1D
&gt; nin5LA4WHEuJeTuzN-qCWBXsOvTyUbdPuDQ3eg==
&gt;
&gt; 5efc8fb59754a6d11eb1a36c501a8ef7b1be44b0300fbe3df354423b7a115ac5
&gt; enabled
&gt; 
&gt; 
&gt; riak-cs-rea...@domain.com
&gt; riak-cs-reader
&gt; reader
&gt; \_QOKYEHYM6S-YDDHGSYF
&gt; sFc1HBhjQzfr70Yda-ke257LHkVCPNAN0chs9A==
&gt;
&gt; de6831d6da88df325d474f7f6c1f708596998c54fc0817685f8c67f1d8cab239
&gt; enabled
&gt; 
&gt; 
&gt; --TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
&gt; Content-Type: application/xml
&gt;
&gt;
&gt; xml version="1.0" encoding="UTF-8"?
&gt; 
&gt; 
&gt; riak-cs-ad...@domain.com
&gt; riak-cs-admin
&gt; admin
&gt; 1049V\_JJHPH7TO\_QPWVC
&gt; lMQsnn3Cukk1UR28FAtoZiap9KEOjBRgYKiVVg==
&gt;
&gt; feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e
&gt; enabled
&gt; 
&gt; 
&gt; --TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
&gt; Content-Type: application/xml
&gt;
&gt;
&gt; xml version="1.0" encoding="UTF-8"?
&gt; 
&gt; \* Connection #0 to host localhost left intact
&gt; --TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O--
&gt;
&gt; -------------- next part --------------
&gt; An HTML attachment was scrubbed...
&gt; URL: &lt;
&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/attachments/20150223/e9e70db8/attachment-0001.html
&gt; &gt;
&gt;
&gt;
&gt;


-- 
Seema Jethani
Director of Product Management, Basho 
4083455739 | @seemaj 
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

