---
title: "Re: Erlang Map/Reduce error"
description: ""
project: community
lastmod: 2011-10-04T06:23:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05028"
mailinglist_parent_id: "msg05019"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-10-04T06:23:52-07:00
---


Note that add\_paths must be a list of paths, e.g. {add\_paths,
["/path/to/your/ebin","/path/to/your/other/ebin"]}.

On Tue, Oct 4, 2011 at 5:24 AM, Kresten Krab Thorup wrote:

&gt; The error badfun most likely means that the function's code is not
&gt; available inside Riak.
&gt;
&gt; You need to add {add\_paths, "/path/to/your/ebin"} in the riak\_kv section in
&gt; app.config. Read more about it here
&gt; http://wiki.basho.com/MapReduce.html#MapReduce-via-the-Erlang-API
&gt;
&gt; For an explanation of why the badfun happens, you can read this blog:
&gt; http://www.javalimit.com/2010/05/passing-funs-to-other-erlang-nodes.html
&gt; ... which can also give you an idea to how to do it without loading the
&gt; code into riak, i.e. something like this may likely work, but will invoke
&gt; the interpreter inside riak; which may be too slow for your needs.
&gt;
&gt; Kresten
&gt;
&gt;
&gt; 1&gt; FunStr = "fun(O, undefined, none) -&gt; [riak\_object:get\_value(O)] end.".
&gt; 2&gt; {ok, Tokens, \_} = erl\_scan:string(FunStr).
&gt; 3&gt; {ok, [Form]} = erl\_parse:parse\_exprs(Tokens).
&gt; 4&gt; Bindings = erl\_eval:add\_binding('B', 2, erl\_eval:new\_bindings()).
&gt; 5&gt; {value, Fun, \_} = erl\_eval:expr(Form, Bindings).
&gt; 6&gt; C:mapred([{&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;}, {&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key2"&gt;&gt;}], [{map,
&gt; {qfun, Fun}, none, true}]).
&gt;
&gt;
&gt; Kresten
&gt;
&gt;
&gt;
&gt;
&gt; On Oct 4, 2011, at 11:00 AM, Lyes Amazouz wrote:
&gt;
&gt; Hi everybody,
&gt;
&gt; I'm learning how to execute a map/reduce using the riak\_client module, so I
&gt; tried this:
&gt;
&gt; &gt;Map = fun(O, undefined, none) -&gt; [riak\_object:get\_value(O)] end.
&gt; &gt;C:mapred([{&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;}, {&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key2"&gt;&gt;}], [{map,
&gt; {qfun, Map}, none, true}]).
&gt;
&gt; but I got this error:
&gt;
&gt; {error,{error,{badfun,#Fun},
&gt; [{riak\_kv\_mapper,run\_map,9},
&gt; {riak\_kv\_mapper,'-do\_map/2-fun-0-',9},
&gt; {lists,foldl,3},
&gt; {riak\_kv\_mapper,do\_map,2},
&gt; {gen\_fsm,handle\_msg,7},
&gt; {proc\_lib,init\_p\_do\_apply,3}]}}
&gt;
&gt; What is wring with my code??
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://www.basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

