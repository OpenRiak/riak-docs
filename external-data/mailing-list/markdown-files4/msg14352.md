---
title: "Re: About Protocol Buffers"
description: ""
project: community
lastmod: 2014-06-23T08:56:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14352"
mailinglist_parent_id: "msg14349"
author_name: "Alex De la rosa"
project_section: "mailinglistitem"
sent_date: 2014-06-23T08:56:43-07:00
---


Hi Luc,

Cool, thanks! I can see how to do it now:

bucket = client.bucket\_type('counter\_bucket').bucket('counters')

Will be checking it more to see what can I do that is not yet documented.

The Python documentation says at one point: "Some requests are only valid
over 'http', and will always be sent via those transports, regardless of
which protocol is preferred.". Can I know which requests are HTTP only? is
it for something in particular? or they will be made into PBC at some point?

Thanks,
Alex


On Mon, Jun 23, 2014 at 5:29 PM, Luc Perkins  wrote:

&gt; Alex,
&gt;
&gt; It sounds like you're working mostly with the lower-level Python API at
&gt; the moment, but if you want to use the higher-level parts of the client for
&gt; interacting with Riak Data Types (sets, maps, and counters), there is a
&gt; tutorial here:
&gt;
&gt;
&gt; https://raw.githubusercontent.com/basho/basho\_docs/2.0.0/source/languages/en/riak/dev/using/data-types.md
&gt;
&gt; You'll see the Python samples interspersed throughout. I know it's
&gt; annoying because it's just raw Markdown at the moment, but this will be
&gt; deployed to our normal docs site 
&gt; soon.
&gt;
&gt; Hope that helps!
&gt;
&gt; Luc
&gt;
&gt;
&gt; On Mon, Jun 23, 2014 at 4:54 PM, Alex De la rosa 
&gt; wrote:
&gt;
&gt;&gt; Hi Sean,
&gt;&gt;
&gt;&gt; Thanks for your quick reply, is what i suspected, moreover after checking
&gt;&gt; riak.proto file in the source. So mainly the contents to store (json or not
&gt;&gt; json) is not PB encoded semantically, but is encoded as a "body" field in
&gt;&gt; the Message. That's good though.
&gt;&gt;
&gt;&gt; Another question... is there any estimated date for Riak 2.0 to be
&gt;&gt; released? I'm playing with 2.0 beta 1 and the "list" object is a must-have
&gt;&gt; for me (same as the "counter" object that can be found in Riak 1.4).
&gt;&gt;
&gt;&gt; Is crucial for me to decide which technologies to use in my new project;
&gt;&gt; so far Riak 2.0 seems a great option, but I can not build under a beta.
&gt;&gt;
&gt;&gt; Another question now that I talk about "counters"... how do you do it
&gt;&gt; with Python's PBC? I can see the functions: RiakClient.get\_counter()
&gt;&gt; and RiakClient.update\_counter()... but... how do you create a new counter?
&gt;&gt; how do you specify the special connotations to the bucket?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Alex
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Jun 23, 2014 at 4:38 PM, Sean Cribbs  wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Alex,
&gt;&gt;&gt;
&gt;&gt;&gt; By default, the client assumes new objects use JSON as the encoding. The
&gt;&gt;&gt; protocol buffers are only used on the wire to encode Riak's protocol. If
&gt;&gt;&gt; you want to use your own protobuffs messages, I suggest two things:
&gt;&gt;&gt;
&gt;&gt;&gt; 1. Decide on a `content\_type` property for each of your data types and
&gt;&gt;&gt; be sure to assign that to each key as you create it. I've used
&gt;&gt;&gt; 'application/pb-person' as an example below.
&gt;&gt;&gt; 2. Register encoder and decoder functions [1] on the RiakClient object,
&gt;&gt;&gt; like so:
&gt;&gt;&gt;
&gt;&gt;&gt; client.set\_decoder('application/pb-person', Person.ParseFromString)
&gt;&gt;&gt; client.set\_encoder('application/pb-person', lambda x:
&gt;&gt;&gt; x.SerializeToString())
&gt;&gt;&gt;
&gt;&gt;&gt; [1]
&gt;&gt;&gt; http://riak-python-client.readthedocs.org/en/latest/client.html#serialization
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon, Jun 23, 2014 at 9:19 AM, Alex De la rosa &lt;
&gt;&gt;&gt; alex.rosa....@gmail.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi there,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I just installed RIAK 2.0 beta 1 and was playing with the Python
&gt;&gt;&gt;&gt; library using 'pbc' (Protocol Buffers).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; test.py
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt; import riak
&gt;&gt;&gt;&gt; client = riak.RiakClient(host ='127.0.0.1', http\_port = 8098, pb\_port =
&gt;&gt;&gt;&gt; 8087, protocol = 'pbc')
&gt;&gt;&gt;&gt; bucket = client.bucket('people')
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; key = bucket.new('alex', data={"username":"Alex","age":33})
&gt;&gt;&gt;&gt; key.store()
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; print bucket.get('alex').encoded\_data
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; it works perfectly and it prints {"username": "Alex", "age": 33} as it
&gt;&gt;&gt;&gt; should print.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; However, I'm not using a proto file (person.proto) and compiling it
&gt;&gt;&gt;&gt; into binary for Python to use it... something like:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; person.proto
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt; message Person {
&gt;&gt;&gt;&gt; required string username = 1;
&gt;&gt;&gt;&gt; required int32 age = 2;
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; xxx.py
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt; import person\_pb2
&gt;&gt;&gt;&gt; person = person\_pb2.Person()
&gt;&gt;&gt;&gt; person.username = "Alex"
&gt;&gt;&gt;&gt; person.age = 33
&gt;&gt;&gt;&gt; data = person.SerializeToString()
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Am I using the 'pbc' interface wrong? however, on Riak's examples page
&gt;&gt;&gt;&gt; is done also without the "proto" file... I'm a bit confused at the moment
&gt;&gt;&gt;&gt; as it changed the way I normally would use Protocol Buffers.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; Alex
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

