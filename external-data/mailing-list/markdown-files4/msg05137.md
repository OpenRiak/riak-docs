---
title: "Basho Bench HTTP Inserts Causing Innostore Crashes"
description: ""
project: community
lastmod: 2011-10-12T08:49:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05137"
author_name: "Brian Bickerton"
project_section: "mailinglistitem"
sent_date: 2011-10-12T08:49:34-07:00
---


Riak version: 1.0.0
Backend: InnoStore 1.0.3.1
4-node cluster

I've gotten http basho bench to run successfully with the Bitcask and
LevelDB backends, but I'm having trouble with Innostore. I get no throughput
and all errors. The logs show children crashing due to a "bad argument in
call to erlang:size(undefined)". Basic inserts from curl work and I was able
to install rekon, which leads me to believe it's an issue with the bench
testing itself. Rate and concurrency don't appear to matter.

Error log snip:

2011-10-12 15:28:49.060 [error] &lt;0.4751.1&gt; gen\_fsm &lt;0.4751.1&gt; in state
active terminated with reason: bad argument in call to
erlang:size(undefined) in innostore:get/2
2011-10-12 15:28:49.061 [error] &lt;0.4751.1&gt; CRASH REPORT Process &lt;0.4751.1&gt;
with 0 neighbours crashed with reason: bad argument in call to
erlang:size(undefined) in innostore:get/2
2011-10-12 15:28:49.061 [error] &lt;0.95.0&gt; Supervisor riak\_core\_vnode\_sup had
child undefined started with {riak\_core\_vnode,start\_link,undefined} at
&lt;0.4751.1&gt; exit with reason bad argument in call to erlang:size(undefined)
in innostore:get/2 in context child\_terminated

Crash Log snip:

2011-10-12 15:28:43 =CRASH REPORT====
 crasher:
 initial call: riak\_core\_vnode:init/1
 pid: &lt;0.4734.1&gt;
 registered\_name: []
 exception exit:
{badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak\_kv\_innostore\_backend,get,3},{riak\_kv\_vnode,do\_get\_term,3},{riak\_kv\_vnode,do\_get,4},{riak\_core\_vnode,vnode\_command,3},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
 in function gen\_fsm:terminate/7
 in call from proc\_lib:init\_p\_do\_apply/3
 ancestors: [riak\_core\_vnode\_sup,riak\_core\_sup,&lt;0.91.0&gt;]
 messages: [{'EXIT',&lt;0.4736.1&gt;,shutdown},{'EXIT',#Port&lt;0.14591&gt;,normal}]
 links: [&lt;0.95.0&gt;]
 dictionary:
[{{innostore,{store,#Port&lt;0.14591&gt;,&lt;&lt;105,0,0,0,0,0,0,0&gt;&gt;,0}},{store,#Port&lt;0.14591&gt;,&lt;&lt;105,0,0,0,0,0,0,0&gt;&gt;,0}}]
 trap\_exit: true
 status: running
 heap\_size: 610
 stack\_size: 24
 reductions: 3941
 neighbours:
2011-10-12 15:28:43 =SUPERVISOR REPORT====
 Supervisor: {local,riak\_core\_vnode\_sup}
 Context: child\_terminated
 Reason:
{badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak\_kv\_innostore\_backend,get,3},{riak\_kv\_vnode,do\_get\_term,3},{riak\_kv\_vnode,do\_get,4},{riak\_core\_vnode,vnode\_command,3},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
 Offender:
[{pid,&lt;0.4734.1&gt;},{name,undefined},{mfargs,{riak\_core\_vnode,start\_link,undefined}},{restart\_type,temporary},{shutdown,300000},{child\_type,worker}]

Basho Bench config (worked with Bitcask and LevelDB):

{mode, max}
{duration, 300}.
{concurrent, 1000}.
{driver, basho\_bench\_driver\_http\_raw}.
{code\_paths, ["deps/ibrowse"]}.
{http\_raw\_ips, [the, four, node, addresses]}.
{key\_generator, {partitioned\_sequential\_int, 500000000}}.
{value\_generator, {fixed\_bin, 15}}.
{http\_raw\_port, 8098}.
{http\_raw\_path, "/riak/holder"}.
{operations, [{insert, 1}]}.

Any help would be greatly appreciated.

Brian Bickerton
Web Engineer
OmniTI Computer Consulting, Inc.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

