---
title: "Re: Secondary Index Map and reduce order and performance"
description: ""
project: community
lastmod: 2011-11-30T13:33:23-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05820"
mailinglist_parent_id: "msg05818"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2011-11-30T13:33:23-08:00
---


Do you get the \*same\* results in both cases?

-Alexander Sicular

@siculars
http://siculars.posterous.com

On Nov 30, 2011, at 4:28 PM, Sajithkumar Kizhakkiniyil wrote:

&gt; Hello
&gt; Probably my understanding of M/R might be wrong. But I am getting drastic 
&gt; performance difference when running secondary index query on PB with map and 
&gt; reduce function in different order.
&gt; If my understanding is correct a reduce phase with 
&gt; riak\_kv\_mapreduce.reduce\_identity is needed for secondary index query. I 
&gt; added one map phase to get the value instead of the key
&gt; 
&gt; But if I send the reduce before the map as you see in the map reduce payload 
&gt; JSON the values are return much faster than the other way. In my test it 251 
&gt; ms vs 700ms. Anyone can explain this behavior.
&gt; 
&gt; Reduce before map (Faster)
&gt; -------
&gt; {"inputs":{"index":"PERFTEST\_INDEX\_NAME\_bin","bucket":"\_ITEST\_SI\_BUCKET","key":"PERFTEST\_INDEX\_VALUE"},"query":[{"reduce":{"arg":"{reduce\_phase\_only\_1,
&gt; 
&gt; true}","module":"riak\_kv\_mapreduce","language":"erlang","keep":false,"function":"reduce\_identity"}},{"map":{"source":"function(value,keyData,arg){
&gt; return [value.values[0].data]; }","language":"javascript","keep":true}}]}
&gt; 
&gt; Map before reduce (Slower)
&gt; --------------
&gt; {"inputs":{"index":"PERFTEST\_INDEX\_NAME\_bin","bucket":"\_ITEST\_SI\_BUCKET","key":"PERFTEST\_INDEX\_VALUE"},"query":[{"map":{"source":"function(value,keyData,arg){
&gt; return [value.values[0].data]; 
&gt; }","language":"javascript","keep":true}},{"reduce":{"arg":"{reduce\_phase\_only\_1,
&gt; 
&gt; true}","module":"riak\_kv\_mapreduce","language":"erlang","keep":false,"function":"reduce\_identity"}}]}
&gt; 
&gt; 
&gt; This message is private and confidential. If you have received it in error, 
&gt; please notify the sender and remove it from your system.
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

