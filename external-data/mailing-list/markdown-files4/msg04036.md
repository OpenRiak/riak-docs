---
title: "Re: riak_search: custom extractor syntax"
description: ""
project: community
lastmod: 2011-07-20T11:04:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04036"
mailinglist_parent_id: "msg04032"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2011-07-20T11:04:55-07:00
---


Hey Greg,

So here's what looks like is going on:

Everything that requires JS in Riak has to declare a pool of VMs. Each
pool needs to be initialized for functions that depend on them to have
access. In this case, it looks like the Riak Search custom extractor
functionality depends on a pool that's not being initialized. This
would be "riak\_search\_js\_extract". Sorry for the time you've spent
toiling with this, but it looks like it's a bug.

I've gone ahead and filed an issue on your behalf.

https://issues.basho.com/show\_bug.cgi?id=1144

Please add any additional details that you think would be worthwhile,
and thanks for uncovering this.

Mark


On Tue, Jul 19, 2011 at 10:40 AM, Greg Pascale  wrote:
&gt; I've been debugging through the riak code, and it looks like the
&gt; riak\_search\_js\_extract process is not running, so it's not even getting to
&gt; the point of executing my JS. Has this feature ever worked?
&gt; =ERROR REPORT==== 19-Jul-2011::10:25:24 ===
&gt; problem invoking hook riak\_search\_kv\_hook:precommit -&gt; exit:{noproc,
&gt;                                                              {gen\_server,
&gt;                                                               call,
&gt;
&gt; [riak\_search\_js\_extract,
&gt;                                                                reserve\_vm,
&gt;                                                                infinity]}}
&gt; [{gen\_server,call,3},
&gt;  {riak\_kv\_js\_manager,blocking\_dispatch,4},
&gt;  {riak\_search\_kv\_hook,run\_extract,3},
&gt;  {riak\_search\_kv\_hook,make\_indexed\_doc,4},
&gt;  {riak\_search\_kv\_hook,index\_object,2},
&gt;  {riak\_search\_kv\_hook,precommit,1},
&gt;  {riak\_kv\_put\_fsm,invoke\_hook,4},
&gt;  {riak\_kv\_put\_fsm,precommit,2}]
&gt; -Greg
&gt;
&gt; On Mon, Jul 18, 2011 at 6:22 PM, Greg Pascale  wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt; I'm trying to use a custom extractor, but I can't for the life of me seem
&gt;&gt; to get the syntax right. Even the simplest thing I can think to try won't
&gt;&gt; work.
&gt;&gt; I've tried setting the rs\_extractfun property as described in the
&gt;&gt; documentation - both of these methods
&gt;&gt;
&gt;&gt;
&gt;&gt; {jsanon, {Bucket, Key}}, where Bucket and Key name a Riak object that
&gt;&gt; contains the source of a Javascript function to call for extraction.
&gt;&gt; {jsanon, Source}, where Source is the source of a Javascript function to
&gt;&gt; call for extraction.
&gt;&gt;
&gt;&gt; &gt; Client:set\_bucket(&lt;&lt;"extractTest"&gt;&gt;, [{rs\_extractfun, {jsanon,
&gt;&gt; &gt; &lt;&lt;"function(){return{'name':'greg', 'login':'gpascale'};}"&gt;&gt;}}]).
&gt;&gt; &gt; Client:set\_bucket(&lt;&lt;"extractTest"&gt;&gt;, [{rs\_extractfun, {jsanon,
&gt;&gt; &gt; {&lt;&lt;"extractors"&gt;&gt;, &lt;&lt;"myextractor"&gt;&gt;}}}]).
&gt;&gt; but neither of these work.
&gt;&gt; Can somebody point out where I'm going wrong?
&gt;&gt; --
&gt;&gt; Greg
&gt;&gt; Clipboard is hiring!
&gt;
&gt;
&gt;
&gt; --
&gt; Greg
&gt; Clipboard is hiring!
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

