---
title: "Re: Partition distribution between nodes"
description: ""
project: community
lastmod: 2014-06-05T06:57:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14289"
mailinglist_parent_id: "msg14284"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2014-06-05T06:57:18-07:00
---


Hi Manu,

Partition distribution is determined by the claim algorithm. In this case
it more evenly distributes partitions in a "from scratch" scenario vs.
adding nodes. There has been work to improve the algorithm that you can
find here: https://github.com/basho/riak\_core/pull/183

--
Luke Bakken
CSE
lbak...@basho.com


On Mon, Jun 2, 2014 at 11:51 PM, Manu Mäki - Compare Group &lt;
m.m...@comparegroup.eu&gt; wrote:

&gt; Hi Luke,
&gt;
&gt; Do you have any idea why creating the cluster from scratch creates “more
&gt; balanced” cluster? Is this because of the actual partition sizes not being
&gt; of equal size?
&gt;
&gt;
&gt; Manu
&gt;
&gt; From: Luke Bakken 
&gt; Date: Monday 2 June 2014 19:34
&gt; To: Manu Maki 
&gt; Cc: "riak-users@lists.basho.com" 
&gt; Subject: Re: Partition distribution between nodes
&gt;
&gt; Hi Manu,
&gt;
&gt; I see similar vnode distribution in my local dev cluster. This is due to
&gt; 64 not being evenly divisible by 5.
&gt;
&gt; 4 nodes:
&gt;
&gt; $ dev1/bin/riak-admin member-status
&gt; ================================= Membership
&gt; ==================================
&gt; Status Ring Pending Node
&gt;
&gt; -------------------------------------------------------------------------------
&gt; valid 25.0% -- 'dev1@127.0.0.1'
&gt; valid 25.0% -- 'dev2@127.0.0.1'
&gt; valid 25.0% -- 'dev3@127.0.0.1'
&gt; valid 25.0% -- 'dev4@127.0.0.1'
&gt;
&gt; -------------------------------------------------------------------------------
&gt;
&gt; 5th node added:
&gt;
&gt; $ dev1/bin/riak-admin member-status
&gt; ================================= Membership
&gt; ==================================
&gt; Status Ring Pending Node
&gt;
&gt; -------------------------------------------------------------------------------
&gt; valid 18.8% -- 'dev1@127.0.0.1'
&gt; valid 18.8% -- 'dev2@127.0.0.1'
&gt; valid 18.8% -- 'dev3@127.0.0.1'
&gt; valid 25.0% -- 'dev4@127.0.0.1'
&gt; valid 18.8% -- 'dev5@127.0.0.1'
&gt;
&gt; -------------------------------------------------------------------------------
&gt;
&gt; Cluster \*from scratch\* with 5 nodes:
&gt;
&gt; $ dev1/bin/riak-admin member-status
&gt; ================================= Membership
&gt; ==================================
&gt; Status Ring Pending Node
&gt;
&gt; -------------------------------------------------------------------------------
&gt; valid 20.3% -- 'dev1@127.0.0.1'
&gt; valid 20.3% -- 'dev2@127.0.0.1'
&gt; valid 20.3% -- 'dev3@127.0.0.1'
&gt; valid 20.3% -- 'dev4@127.0.0.1'
&gt; valid 18.8% -- 'dev5@127.0.0.1'
&gt;
&gt; -------------------------------------------------------------------------------
&gt;
&gt; --
&gt; Luke Bakken
&gt; CSE
&gt; lbak...@basho.com
&gt;
&gt;
&gt; On Mon, Jun 2, 2014 at 6:52 AM, Manu Mäki - Compare Group &lt;
&gt; m.m...@comparegroup.eu&gt; wrote:
&gt;
&gt;&gt; Hi all,
&gt;&gt;
&gt;&gt; In the beginning we were running four nodes with n-value of 2. The
&gt;&gt; partitions were distributed 25% for each node. Now when we added fifth node
&gt;&gt; (still having n-value of 2), the partitions are distributed in following
&gt;&gt; way: 25%, 19%, 19%, 19% and 19%. The ring size in use is 64. Is this normal
&gt;&gt; behavior? The cluster seems to be working correctly. However I was
&gt;&gt; expecting each node to have 20% of the partitions.
&gt;&gt;
&gt;&gt;
&gt;&gt; Best regards,
&gt;&gt; Manu Mäki
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

