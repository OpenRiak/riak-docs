---
title: "Re: Update metadata of entries in bucket"
description: ""
project: community
lastmod: 2017-02-25T01:18:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18034"
mailinglist_parent_id: "msg18033"
author_name: "Grigory Fateyev"
project_section: "mailinglistitem"
sent_date: 2017-02-25T01:18:36-08:00
---


Luke, thank you for the answer!

I did this, my code is:

```
update\_users(Item) -&gt;
 Value = binary\_to\_term(riak\_object:get\_value(Item)),
 [{\_Key, Value}] = statebox:value(Item),
 Record = project\_schema\_user:new(Value),
 NewMetadata = project\_schema\_user:riak\_metadata(Record),
 NewItem = riak\_object:update\_metadata(Item, NewMetadata),
 AItem = riak\_object:apply\_updates(NewItem),
 RiakcObj = to\_riakc\_obj(AItem),
 %% lager:info("Item ~p", [RiakcObj]),
 ok = redgage\_riak\_client:put(RiakcObj),
 [].

to\_riakc\_obj(Object) when element(1, Object) =:= r\_object -&gt;
 #riakc\_obj{
 bucket = riak\_object:bucket(Object),
 key = riak\_object:key(Object),
 vclock = riak\_object:encode\_vclock(riak\_object:vclock(Object)),
 contents = riak\_object:get\_contents(Object)
 %% updatemetadata = riak\_object:get\_update\_metadata(Object),
 %% updatevalue = riak\_object:get\_update\_value(Object)
 }.

```

It works! I had a problem with vclock. I got vclock from r\_object, but it's
vclock:vclock()
type. Now I encode it. As you can see commented out two record's fields:
updatemetadata
and updatevalue. How do these fields work?


2017-02-25 0:40 GMT+03:00 Luke Bakken :

&gt; Hi Grigory,
&gt;
&gt; Check out this article:
&gt; http://basho.com/posts/technical/webinar-recap-mapreduce-querying-in-riak/
&gt;
&gt; Specifically, the use of riak:local\_client() and C:put
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt;
&gt; On Thu, Feb 23, 2017 at 10:38 AM, Grigory Fateyev 
&gt; wrote:
&gt; &gt; Hello!
&gt; &gt;
&gt; &gt; I'm trying to write riak\_pipe command that updates metadata, the code:
&gt; &gt; https://gist.github.com/greggy/7d7fa3102d89673019410c6e244650cd
&gt; &gt;
&gt; &gt; I'm getting every entry in update\_metadata/1 then creating a new
&gt; metadata,
&gt; &gt; updating it in Item.
&gt; &gt;
&gt; &gt; My question is how to update r\_object in a bucket?
&gt; &gt;
&gt; &gt; Thank you!
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

