---
title: "Re: Escape characters in MapReduce?"
description: ""
project: community
lastmod: 2013-02-10T17:15:33-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10083"
mailinglist_parent_id: "msg10082"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2013-02-10T17:15:33-08:00
---


What is p.Department not supposed to equal?


@siculars
http://siculars.posterous.com

Sent from my iRotaryPhone

On Feb 10, 2013, at 18:36, "Kevin Burton"  wrote:

&gt; I have a query that is made from a CorrugatedIron client that looks like:
&gt; 
&gt; IRiakClient riakClient = cluster.CreateClient();
&gt; var query = new RiakMapReduceQuery()
&gt; .Inputs(productBucketName)
&gt; .MapJs(m =&gt; m.Source(@"function(v,d,a) {" +
&gt; "var p = JSON.parse(v.values[0].data);" +
&gt; "var r = [];" +
&gt; "if(p.Department != '') {" +
&gt; "var o = {};" +
&gt; "o[p.Department] = 1;" +
&gt; "r.push(o);" +
&gt; "}" +
&gt; "return r;" +
&gt; "}"))
&gt; .ReduceJs(m =&gt; m.Source(@"function(v,d,a) {" +
&gt; "var r = {};" +
&gt; "for(var i in v) {" +
&gt; " for(var w in v[i]) {" +
&gt; " if(w in r) r[w] += v[i][w];" +
&gt; " else r[w] = v[i][w];" +
&gt; " }" +
&gt; "}" +
&gt; "return [r];" +
&gt; "}")
&gt; .Keep(true));
&gt; 
&gt; This query returns the error:
&gt; 
&gt; Query failed with Riak returned an error. Code '0'. Message: 
&gt; {"phase":"listkeys","error":"{badmatch,{'EXIT',timeout}}","input":"{cover,[],&lt;&lt;\"buyseasons-products\"&gt;&gt;}","type":"error","stack":"[{riak\_core\_vnode\_proxy,call,2,[{file,\"src/riak\_core\_vnode\_proxy.erl\"},{line,52}]},{riak\_pipe\_vnode,queue\_work\_send,4,[{file,\"src/riak\_pipe\_vnode.erl\"},{line,331}]},{riak\_pipe\_vnode,queue\_work\_erracc,6,[{file,\"src/riak\_pipe\_vnode.erl\"},{line,279}]},{riak\_kv\_pipe\_listkeys,keysend,4,[{file,\"src/riak\_kv\_pipe\_listkeys.erl\"},{line,112}]},{riak\_kv\_pipe\_listkeys,keysend\_loop,3,[{file,\"src/riak\_kv\_pipe\_listkeys.erl\"},{line,89}]},{riak\_kv\_pipe\_listkeys,process,3,[{file,\"src/riak\_kv\_pipe\_listkeys.erl\"},...]},...]"}
&gt; - CommunicationError
&gt; 
&gt; I can read the error and it is a “badmatch” but the rest of the details I 
&gt; don’t know how to use. The purpose of these query is to count all of the 
&gt; different Departments in the database. I was wondering if this requires that 
&gt; the Department name be escaped somehow. One of the department names is 
&gt; ‘Accessories & Makeup’, ‘Decorations & Props’, or ‘Hats, Wigs & Masks’. 
&gt; Does the ‘&’ need to be escaped when putting it into the database (this 
&gt; string is a property that is part of the object that is JSON serialized)? 
&gt; Anything else? If it needs to be escaped and I am using this value as a 
&gt; secondary index should I set the index before or after the escape is done? 
&gt; Could this be the source of a “badmatch”?
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

