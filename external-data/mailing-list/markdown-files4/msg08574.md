---
title: "Re: 404 Error in Live Cluster"
description: ""
project: community
lastmod: 2012-09-17T09:59:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08574"
mailinglist_parent_id: "msg08567"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-09-17T09:59:09-07:00
---


Hi Praveen,

There are a few things that could be contributing the to 404s.

The most likely issue has to do with your "n" and "r" values. With an
"r" of 1, and a laggy node in your cluster, you could have a situation
that resembled a netsplit. (At the moment, Riak does better with
downed nodes than laggy ones.) Laggy responses will result in you
returning a notfound to the client if you're only waiting for 1 of 2
existing replicas and have "{notfound\_ok, true}".

Potential solutions to this (assuming it's the problem):

\* consider retrying a number of times with your client logic; there is
some information about why you might want to do this on the wiki [0]
\* change to "{notfound\_ok, false}" because otherwise if a "not\_found"
comes back on the first response, it'll be treated as valid
\* increase R to 2.

There are a few other potential culprits, but this is the most-likely.
Let us know if any of that helps.

Mark

[0] http://wiki.basho.com/Client-Implementation-Guide.html


On Mon, Sep 17, 2012 at 4:01 AM, Praveen Baratam
 wrote:
&gt; The frequency of error is now more common. Upto 1 failed request in 10. This
&gt; is breaking everything.
&gt;
&gt;
&gt; On Mon, Sep 17, 2012 at 3:04 PM, Praveen Baratam 
&gt; wrote:
&gt;&gt;
&gt;&gt; Here are some more details about the cluster.
&gt;&gt;
&gt;&gt; {ring\_creation\_size, 1024},
&gt;&gt;
&gt;&gt; {default\_bucket\_props, [
&gt;&gt; {n\_val, 2},
&gt;&gt; {r, 1},
&gt;&gt; {w, 1},
&gt;&gt; {allow\_mult, false},
&gt;&gt; {last\_write\_wins, false},
&gt;&gt; {precommit, []},
&gt;&gt; {postcommit, []},
&gt;&gt; {chash\_keyfun, {riak\_core\_util, chash\_std\_keyfun}},
&gt;&gt; {linkfun, {modfun, riak\_kv\_wm\_link\_walker, mapreduce\_linkfun}}
&gt;&gt; ]},
&gt;&gt;
&gt;&gt; {storage\_backend, riak\_kv\_multi\_backend},
&gt;&gt; {multi\_backend\_default, &lt;&lt;"store"&gt;&gt;},
&gt;&gt; {multi\_backend, [
&gt;&gt; {&lt;&lt;"store"&gt;&gt;, riak\_kv\_bitcask\_backend, [
&gt;&gt; {data\_root, "/var/lib/riak/bitcask/store"}
&gt;&gt; ]},
&gt;&gt; {&lt;&lt;"cache"&gt;&gt;, riak\_kv\_bitcask\_backend, [
&gt;&gt; {data\_root, "/var/lib/riak/bitcask/cache"},
&gt;&gt; {expiry\_secs, 21600}
&gt;&gt; ]}
&gt;&gt; ]},
&gt;&gt;
&gt;&gt; On using Riaknostic I am seeing these errors.
&gt;&gt;
&gt;&gt; [warning] The following preflists do not satisfy the n\_val:
&gt;&gt; [[{973382926425464638881751031164555683013033197568,'riak@178.238.237.241'},.....
&gt;&gt; a big list similar to this...]
&gt;&gt;
&gt;&gt; Please help. We are stuck.
&gt;&gt;
&gt;&gt; Praveen
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Sep 17, 2012 at 4:18 AM, Praveen Baratam
&gt;&gt;  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hello Everybody,
&gt;&gt;&gt;
&gt;&gt;&gt; We are currently alpha testing out our Webapp which uses Riak for storing
&gt;&gt;&gt; binary files (&lt; 2 MB) with n\_val as 2. We currently have 3 nodes in the
&gt;&gt;&gt; cluster and all files are stored in the same bucket. We are using Bitcask
&gt;&gt;&gt; engine.
&gt;&gt;&gt;
&gt;&gt;&gt; Sometimes we see 404 error cropping up when accessing these keys. This
&gt;&gt;&gt; happens only once in a day or so and all existing keys are accessible most
&gt;&gt;&gt; of the time. We are only trying to access the keys that we have put in Riak
&gt;&gt;&gt; so there is no doubt of their existence.
&gt;&gt;&gt;
&gt;&gt;&gt; Can a network split cause such an error? Is there anything we can do to
&gt;&gt;&gt; avoid such corner cases.
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you
&gt;&gt;&gt;
&gt;&gt;&gt; Praveen
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

