---
title: "Re: A bunch of Erlang client questions"
description: ""
project: community
lastmod: 2012-11-27T08:41:40-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09387"
mailinglist_parent_id: "msg09386"
author_name: "Alex Rønne Petersen"
project_section: "mailinglistitem"
sent_date: 2012-11-27T08:41:40-08:00
---


Hi Bryan,

Thanks for the answers! A few more questions inline:

On Tue, Nov 27, 2012 at 2:16 PM, Bryan Fink  wrote:
&gt; Hi, Alex. I'm sorry you weren't able to find your answers in our docs.
&gt; Some of them assume that you've read all of the other docs as well.
&gt; I'll see what I can do to clear things up inline.
&gt;
&gt; On Mon, Nov 26, 2012 at 7:23 PM, Alex Rønne Petersen
&gt;  wrote:
&gt;&gt; \* Is the proper way to replace the object associated with a bucket/key
&gt;&gt; pair to simply do a riakc\_pb\_socket:put/2 with the same bucket/key
&gt;&gt; pair (with a new object)?
&gt;
&gt; This one is answered in the "Modifying Data" section of the README:
&gt;
&gt; https://github.com/basho/riak-erlang-client/blob/master/README.md#modifying-data

I don't know how I managed to miss that. Thanks!

&gt;
&gt; In short, the proper way to replace an object is to first fetch the
&gt; existing object, then update the value of what you fetched, then use
&gt; riakc\_pb\_socket:put to write the new value. The reason for doing this
&gt; is to comply with Riak's consistency system (the vector clocks) - it
&gt; needs to know what value you were starting from in order to overwrite
&gt; it correctly.

OK, makes sense. Just out of curiosity, though, is updating values via
put without an update a supported scenario in some way or is it
generally considered a Bad Idea (tm)?

&gt;
&gt;&gt; \* What exactly is the purpose of riakc\_obj:update\_value/2 (with
&gt;&gt; regards to the above question)?
&gt;
&gt; The riakc\_obj structure stores two different things: the
&gt; value+metadata you read, and the value+metadata you want to write. The
&gt; update\_value and update\_metadata functions set the value+metadata you
&gt; want to write. The same can be said about get\_value/get\_metadata and
&gt; get\_update\_value/get\_update\_metadata - they each access one part of
&gt; the riakc\_obj structure. Although, as was discussed recently on this
&gt; list, get\_update\_value will return the result of get\_value if no
&gt; update value has been set.
&gt;
&gt;&gt; \* How does one associate a secondary index with an object? Is this
&gt;&gt; done via riakc\_obj:update\_metadata/2?
&gt;
&gt; Yes, you need to set the "index" metadata entry to associate a
&gt; secondary index with an object. For example, to set values the
&gt; "myidx\_bin" and "youridx\_int" indexes:
&gt;
&gt; Obj = riakc\_obj:new(Bucket, Key, Value).
&gt; Idx = [{"myidx\_bin", "hello"},{"youridx\_int","9876"}].
&gt; MD = dict:store(&lt;&lt;"index"&gt;&gt;, Idx, dict:new()).
&gt; ObjIndexed = riakc\_obj:update\_metadata(Obj, MD).
&gt; riakc\_pb\_socket:put(Socket, ObjIndexed).
&gt;
&gt; If overwriting a value, you would use the result of
&gt; riakc\_obj:get\_metadata/1 instead of dict:new/0 for building your new
&gt; metadata.

Does Riak figure out based on the name of the index what type it is?
That is, \*\_int = integer, \*\_bin = string?

Is there any physical limit to how many secondary indexes can be
created for an object? Or perhaps a recommended limit?

&gt;
&gt;&gt; \* Is there any particular reason the Erlang client doesn't yet support
&gt;&gt; all bucket properties?
&gt;
&gt; Yes, it does not support the bucket properties that the Protocol
&gt; Buffers interface to Riak does not support. It's a known problem. You
&gt; can follow work on it here:
&gt;
&gt; https://github.com/basho/riak\_pb/issues/5
&gt;
&gt; In the meantime, the riak-erlang-http-client can be used to set other
&gt; bucket properties:
&gt;
&gt; https://github.com/basho/riak-erlang-http-client
&gt;
&gt;&gt; \* What exactly do the various get and put options do? Specifically,
&gt;&gt; if\_modified, notfound\_ok, basic\_quorum, head, and deletedvclock for
&gt;&gt; the former
&gt;
&gt; These answers can be found in the docs for the Protocol Buffers get message:
&gt;
&gt; http://docs.basho.com/riak/latest/references/apis/protocol-buffers/PBC-Fetch-Object/
&gt;
&gt; and return\_body, return\_head, if\_not\_modified, and
&gt;&gt; if\_none\_match for the former.
&gt;
&gt; And these answers are in the docs for the Protocol Buffers put message:
&gt;
&gt; http://docs.basho.com/riak/latest/references/apis/protocol-buffers/PBC-Store-Object/

When if\_none\_match is enabled, will riakc\_pb\_socket:put/3 return ok
regardless of whether the value was stored?

&gt;
&gt;&gt; \* How will riakc\_pb\_socket:get/3 behave when queue\_if\_disconnected is
&gt;&gt; enabled? Will it fail immediately if the socket is disconnected or
&gt;&gt; block until it has reconnected?
&gt;
&gt; With queue\_if\_disconnected enabled, riakc\_pb\_socket:get/3 will block
&gt; until the socket is reconnected.
&gt;
&gt; HTH,
&gt; Bryan

Regards,
Alex

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

