---
title: "Re: Reg:Continuous Periodic crashes after long operation"
description: ""
project: community
lastmod: 2017-01-26T08:08:23-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17886"
mailinglist_parent_id: "msg17885"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2017-01-26T08:08:23-08:00
---


FYI: this is the function that is crashing:

get\_uint32\_measurement(Request, #internal{os\_type = {unix, linux}}) -&gt;
 {ok,F} = file:open("/proc/loadavg",[read,raw]), %% &lt;--- 
crash line
 {ok,D} = file:read(F,24),
 ok = file:close(F),
 {ok,[Load1,Load5,Load15,\_PRun,PTotal],\_} = io\_lib:fread("~f ~f ~f ~d/~d", 
D),
 case Request of
 ?avg1 -&gt; sunify(Load1);
 ?avg5 -&gt; sunify(Load5);
 ?avg15 -&gt; sunify(Load15);
 ?ping -&gt; 4711;
 ?nprocs -&gt; PTotal
 end;

Is there something unique about that open?

Matthew

&gt; On Jan 26, 2017, at 10:37 AM, Luke Bakken  wrote:
&gt; 
&gt; Steven,
&gt; 
&gt; You may be able to get information via the lsof command as to what
&gt; process(es) are using many file handles (if that is the cause).
&gt; 
&gt; I searched for that particular error and found this GH issue:
&gt; https://github.com/emqtt/emqttd/issues/426
&gt; 
&gt; Which directed me to this page:
&gt; https://github.com/emqtt/emqttd/wiki/linux-kernel-tuning
&gt; 
&gt; Basho also has a set of recommended tuning parameters:
&gt; http://docs.basho.com/riak/kv/2.2.0/using/performance/
&gt; 
&gt; Do you have other error entries in any of Riak's logs at around the
&gt; same time as these messages? Particularly crash.log.
&gt; 
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt; 
&gt; On Thu, Jan 26, 2017 at 4:42 AM, Steven Joseph  wrote:
&gt;&gt; Hi Shaun,
&gt;&gt; 
&gt;&gt; I have already set this to a very high value
&gt;&gt; 
&gt;&gt; (r...@hawk1.streethawk.com)1&gt; os:cmd("ulimit -n").
&gt;&gt; "20000500\n"
&gt;&gt; (r...@hawk1.streethawk.com)2&gt;
&gt;&gt; 
&gt;&gt; 
&gt;&gt; So the issue is not that the limit is low, but maybe a resource leak ? As I
&gt;&gt; mentioned our application processes continuously run queries on the cluster.
&gt;&gt; 
&gt;&gt; Kind Regards
&gt;&gt; 
&gt;&gt; Steven
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

