---
title: "Re: riak-2.0.0 preview refuses to start when nodename is changed to	the ip or hostname of the machine"
description: ""
project: community
lastmod: 2014-01-17T04:08:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13398"
mailinglist_parent_id: "msg13397"
author_name: "John Shen"
project_section: "mailinglistitem"
sent_date: 2014-01-17T04:08:52-08:00
---


Hector, thanks a lot! I figured it out. It does not like the hostname, but
fqdn when I retested. With fqdn it works now.

John Shen


On Fri, Jan 17, 2014 at 3:55 AM, John Shen  wrote:

&gt; Hector, thanks for getting back to me. Sorry I did not make it clear.
&gt;
&gt; If I start clean, with the only difference in riak.conf being listening to
&gt; all ips (0.0.0.0 instead of 127.0.0.1) and nodename changed to the server
&gt; name or ip, it does not work. It is not a matter of old data. If I start
&gt; with the default nodename 127.0.0.1 it works.
&gt;
&gt; It is a fresh install and there was no previous clustering configuration.
&gt; I tried to uninstall riak, remove all riak-related directories, and start
&gt; over, the result is the same.
&gt;
&gt; Please let me know what else I should look at.
&gt;
&gt; Thanks!
&gt;
&gt; John Shen
&gt;
&gt;
&gt; On Thu, Jan 16, 2014 at 3:24 PM, Hector Castro  wrote:
&gt;
&gt;&gt; Hi John,
&gt;&gt;
&gt;&gt; Did you start this Riak instance successfully with `riak@127.0.0.1`
&gt;&gt; before changing `nodename`? If you did, changing the `nodename` can
&gt;&gt; cause a failure similar to what you're seeing.
&gt;&gt;
&gt;&gt; From here your options are:
&gt;&gt;
&gt;&gt; 1. Discard the existing ring metadata by removing the contents of the
&gt;&gt; ring directory. This will require rejoining all nodes into a cluster
&gt;&gt; again.
&gt;&gt; 2. Rename the node using the riak-admin cluster replace command. This
&gt;&gt; will not work if you have previously only started riak with a single
&gt;&gt; node.
&gt;&gt;
&gt;&gt; More details on this (although it references the &lt; 2.0 configuration
&gt;&gt; file format) can be found here:
&gt;&gt;
&gt;&gt; http://docs.basho.com/riak/latest/ops/building/basic-cluster-setup/
&gt;&gt;
&gt;&gt; --
&gt;&gt; Hector
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Jan 16, 2014 at 3:11 PM, John Shen  wrote:
&gt;&gt; &gt; i downloaded riak-2.0.0pre5-1.el6.x86\_64.rpm
&gt;&gt; &gt; riak node starts fine with
&gt;&gt; &gt;
&gt;&gt; &gt; ## Name of the riak node
&gt;&gt; &gt; # this fails
&gt;&gt; &gt; #nodename = riak@myhost.mydomain
&gt;&gt; &gt; #this works
&gt;&gt; &gt; #nodename = riak@127.0.0.1
&gt;&gt; &gt; #this also fails
&gt;&gt; &gt; nodename = riak@10.10.10.10
&gt;&gt; &gt;
&gt;&gt; &gt; the riak processes seem to start still despite the FAILED message, but
&gt;&gt; &gt; riak-admin says node is not running.
&gt;&gt; &gt;
&gt;&gt; &gt; this is RHEL 6
&gt;&gt; &gt;
&gt;&gt; &gt; thanks for any hint as how to debug
&gt;&gt; &gt;
&gt;&gt; &gt; Starting riak: riak failed to start within 15 seconds,
&gt;&gt; &gt; see the output of 'riak console' for more information.
&gt;&gt; &gt; If you want to wait longer, set the environment variable
&gt;&gt; &gt; WAIT\_FOR\_ERLANG to the number of seconds to wait.
&gt;&gt; &gt; [FAILED]
&gt;&gt; &gt;
&gt;&gt; &gt; # ps -ef | grep ria[k]
&gt;&gt; &gt; riak 28771 1 0 11:53 ? 00:00:00
&gt;&gt; &gt; /usr/lib64/riak/erts-5.10.3/bin/epmd -daemon
&gt;&gt; &gt; riak 28779 1 0 11:53 ? 00:00:00
&gt;&gt; &gt; /usr/lib64/riak/erts-5.10.3/bin/run\_erl -daemon /var/run/riak//
&gt;&gt; &gt; /var/log/riak exec /usr/sbin/riak console
&gt;&gt; &gt; riak 28782 28779 2 11:53 pts/1 00:01:36
&gt;&gt; &gt; /usr/lib64/riak/erts-5.10.3/bin/beam.smp -W w -K true -A 64 -P 256000 --
&gt;&gt; &gt; -root /usr/lib64/riak -progname riak -- -home /var/lib/riak -- -boot
&gt;&gt; &gt; /usr/lib64/riak/releases/2.0.0pre5/riak -config
&gt;&gt; &gt; /var/lib/riak/generated.configs/app.2014.01.16.11.53.05.config -smp
&gt;&gt; enable
&gt;&gt; &gt; -name riak@10.10.10.10 -setcookie riak -vm\_args
&gt;&gt; &gt; /var/lib/riak/generated.configs/vm.2014.01.16.11.53.05.args -pa
&gt;&gt; &gt; /usr/lib64/riak/lib/basho-patches -- console
&gt;&gt; &gt; riak 28999 28782 0 11:53 ? 00:00:00 sh -s disksup
&gt;&gt; &gt; riak 29001 28782 0 11:53 ? 00:00:00
&gt;&gt; &gt; /usr/lib64/riak/lib/os\_mon-2.2.13/priv/bin/memsup
&gt;&gt; &gt; riak 29002 28782 0 11:53 ? 00:00:00
&gt;&gt; &gt; /usr/lib64/riak/lib/os\_mon-2.2.13/priv/bin/cpu\_sup
&gt;&gt; &gt;
&gt;&gt; &gt; # riak console
&gt;&gt; &gt; 13:10:15.193 [info] Application lager started on node nonode@nohost
&gt;&gt; &gt; 13:10:15.193 [info] Checking /etc/riak/app.config exists... false
&gt;&gt; &gt; 13:10:15.193 [info] Checking /etc/riak/vm.args exists... false
&gt;&gt; &gt; 13:10:15.193 [info] No app.config or vm.args detected in /etc/riak,
&gt;&gt; &gt; activating cuttlefish
&gt;&gt; &gt; 13:10:15.385 [info] Adding Defaults
&gt;&gt; &gt; 13:10:15.387 [info] Applying Datatypes
&gt;&gt; &gt; 13:10:15.404 [info] Validation
&gt;&gt; &gt; 13:10:15.407 [info] Applied 1:1 Mappings
&gt;&gt; &gt; 13:10:15.408 [info] Applied Translations
&gt;&gt; &gt; config is OK
&gt;&gt; &gt; -config /var/lib/riak/generated.configs/app.2014.01.16.13.10.15.config
&gt;&gt; &gt; -args\_file /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args
&gt;&gt; &gt; -vm\_args /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args
&gt;&gt; &gt; Exec: /usr/lib64/riak/erts-5.10.3/bin/erlexec -boot
&gt;&gt; &gt; /usr/lib64/riak/releases/2.0.0pre5/riak -config
&gt;&gt; &gt; /var/lib/riak/generated.configs/app.2014.01.16.13.10.15.config
&gt;&gt; -args\_file
&gt;&gt; &gt; /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args -vm\_args
&gt;&gt; &gt; /var/lib/riak/generated.configs/vm.2014.01.16.13.10.15.args
&gt;&gt; -pa
&gt;&gt; &gt; /usr/lib64/riak/lib/basho-patches -- console
&gt;&gt; &gt; Root: /usr/lib64/riak
&gt;&gt; &gt; Erlang R16B02-basho3 (erts-5.10.3) [source] [64-bit] [smp:2:2]
&gt;&gt; &gt; [async-threads:64] [kernel-poll:true]
&gt;&gt; &gt;
&gt;&gt; &gt; Eshell V5.10.3 (abort with ^G)
&gt;&gt; &gt; (riak@10.10.10.10)1&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; not sure how to proceed at this point.
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks!
&gt;&gt; &gt;
&gt;&gt; &gt; John Shen
&gt;&gt; &gt;
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

