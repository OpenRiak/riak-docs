---
title: "Re: Multiple nodes leaving cluster"
description: ""
project: community
lastmod: 2017-02-08T05:01:01-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17938"
mailinglist_parent_id: "msg17937"
author_name: "Daniel Miller"
project_section: "mailinglistitem"
sent_date: 2017-02-08T05:01:01-08:00
---


Thanks Magnus and Shaun, that's very helpful.

Daniel

On Wed, Feb 8, 2017 at 4:00 AM, Magnus Kessler  wrote:

&gt; On 7 February 2017 at 23:25, Daniel Miller  wrote:
&gt;
&gt;&gt; Hi Riak Users,
&gt;&gt;
&gt;&gt; In the documentation
&gt;&gt;  for 
&gt;&gt; riak-admin
&gt;&gt; cluster leave it says “You can stage multiple leave command before
&gt;&gt; planning/committing.” This implies that it is safe to stage multiple nodes
&gt;&gt; leaving the cluster simultaneously. Is that true? Will all data in the
&gt;&gt; cluster be continuously available during the removal period if, for
&gt;&gt; example, I setup and commit a plan for 3 nodes to be leave a 9-node cluster
&gt;&gt; (assuming there is enough space for the data on the remaining 6 nodes)?
&gt;&gt;
&gt;&gt; I had asked a similar question on IRC a couple weeks ago. In that case I
&gt;&gt; was asking about replacing multiple nodes simultaneously using riak-admin
&gt;&gt; cluster replace. The answer I got there left some doubt in my mind as to
&gt;&gt; whether it is safe (i.e., will not result in a period data availability) to
&gt;&gt; have multiple nodes leaving the cluster at once. The documentation for
&gt;&gt; replace implies that it is safe to replace multiple nodes simultaneously as
&gt;&gt; well: “You can stage multiple replace actions before planning/committing.”
&gt;&gt;
&gt;&gt; Note that I am not asking about force-remove or force-replace, which I
&gt;&gt; would expect to result in permanent data loss if multiple nodes are
&gt;&gt; force-removed/replaced simultaneously.
&gt;&gt;
&gt;&gt; My cluster is running Riak 2.1.1 with standard nval of 3.
&gt;&gt;
&gt;&gt; Thanks!
&gt;&gt; Daniel
&gt;&gt; ​
&gt;&gt;
&gt;
&gt; Hi Daniel,
&gt;
&gt; Yes, staging several riak-admin cluster leave steps before riak-admin
&gt; cluster commit is safe. The leaving nodes will perform an ownership
&gt; handoff of all their partitions to other nodes in the cluster before
&gt; shutting themselves down. While this is happening, these nodes remain in
&gt; the cluster as fully functional nodes. The same is true for riak-admin
&gt; cluster replace.
&gt;
&gt; The reason we recommend staging of multiple leave or join operations is
&gt; that this minimises reshuffling data throughout the cluster. Only set of
&gt; ownership handoffs needs to happen, whereas if you were to perform several
&gt; consecutive leave or join operations, on each commit a substantial amount
&gt; of handoffs throughout the cluster is needed.
&gt;
&gt; Kind Regards,
&gt;
&gt; Magnus
&gt;
&gt;
&gt; --
&gt; Magnus Kessler
&gt; Client Services Engineer
&gt; Basho Technologies Limited
&gt;
&gt; Registered Office - 8 Lincoln’s Inn Fields London WC2A 3BP Reg 07970431
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

