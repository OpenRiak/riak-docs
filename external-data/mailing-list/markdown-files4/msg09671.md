---
title: "Re: Keyfilters. I cant get date ranges to work using key filters"
description: ""
project: community
lastmod: 2012-12-23T23:16:53-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09671"
mailinglist_parent_id: "msg09670"
author_name: "David Montgomery"
project_section: "mailinglistitem"
sent_date: 2012-12-23T23:16:53-08:00
---


Thanks,

If I use a logical & I get no data.

If I just use a greater than than it works.

 date\_start = '2012122300'
 date\_end = '2012122323'

 filters = key\_filter.tokenize(":",
filter\_map['date']).greater\_than\_eq(date\_start) & key\_filter.tokenize(":",
filter\_map['date']).less\_than\_eq(date\_end)
 query.add\_key\_filters(filters)


filters = key\_filter.tokenize(":", 4) +
(key\_filter.string\_to\_int().greater\_than\_eq(date\_start))
query.add\_key\_filters(filters)

I event tried between

 filters = key\_filter.tokenize(":", 4) +
(key\_filter.between(date\_start,date\_end))
 query.add\_key\_filters(filters)
 print filters

These are the results for one day. I am really at a loss as to why I cant
get riak to work with what should be very simple logical conditions

cid5989410021||null||2012122314 1
cid5989410021||null||2012122306 1
cid5989410021||www.sonems.net||2012122305 1
cid5989410021||www.ke5ter.com||2012122406 1
cid5989410021||mobile.brothersoft.com||2012122315 1
cid5989410021||www.renotalk.com||2012122315 1



query.map('''
 function(value, keyData, arg) {

 if(value.length == 0){
 return [];
 }else{
 var data = Riak.mapValuesJson(value)[0];
 var obj = {};
 var xs = value.key.split(':');
 var dt = xs[3];
 if(data['adx']=='gdn'){
 try{
 var matches =
data['url'].match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);
 var domain = matches && matches[1];
 var alt\_key = data['campaign\_id'] + '||' + domain +
'||' + dt;
 }
 catch(err){
 var alt\_key = 'error';
 }
 var obj = {};
 obj[alt\_key] = 1;
 return [ obj ];
 }else{
 return [];
 }
 }
 }''')

reducer = """
 function(values, arg){

 if(values.length == 0){
 return [{}]
 }
 return [ values.reduce( function(acc, item) {
 for (var state in item) {
 if (acc[state])
 acc[state] += item[state];
 else
 acc[state] = item[state];
 }
 return acc;
 })];
 }








On Mon, Dec 24, 2012 at 7:19 AM, Evan Vigil-McClanahan &lt;
emcclana...@basho.com&gt; wrote:

&gt; It looks to me like your error is here:
&gt;
&gt; &gt; filters = key\_filter.tokenize(":", 4) +
&gt; (key\_filter.starts\_with('20121223') and key\_filter.string\_to\_int().less\_than
&gt; (2012122423))
&gt;
&gt; The 'and' there is getting interpreted as a logical and:
&gt;
&gt; &gt;&gt;&gt; key\_filter.starts\_with('20121223') and
&gt; key\_filter.string\_to\_int().less\_than(2012122423)
&gt; [['string\_to\_int'], ['less\_than', 2012122423]]
&gt;
&gt; You have to use the sadly non-idiomatic '&' to get it to do what
&gt; you're trying to do:
&gt;
&gt; &gt;&gt;&gt; key\_filter.tokenize(":", 4) + (key\_filter.starts\_with('20121223') &
&gt; key\_filter.string\_to\_int().less\_than(2012122423))
&gt; [['tokenize', ':', 4], ['and', [['starts\_with', '20121223']],
&gt; [['string\_to\_int'], ['less\_than', 2012122423]]]]
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

