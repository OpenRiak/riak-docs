---
title: "Re: empty sibling after a DELETE then PUT"
description: ""
project: community
lastmod: 2011-10-05T15:28:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05058"
mailinglist_parent_id: "msg05057"
author_name: "Eric Moritz"
project_section: "mailinglistitem"
sent_date: 2011-10-05T15:28:33-07:00
---


What I am trying to model is a concurrent DELETE and a concurrent PUT
where both operations use the same source VClock. When I do a GET
after those concurrent operations is an object with two siblings; One
blank and one with the data.

Is the reconciliation of those two values, the responsibility of the
application and if so, do we need to treat empty bodies as tombstones?

Thanks,
Eric.

On Wed, Oct 5, 2011 at 6:21 PM, Jon Meredith  wrote:
&gt; Hi Eric,
&gt; What you are seeing is probably a result of some changes we've made to
&gt; deletes.  After you issue the DELETE, Riak creates a tombstone object first
&gt; and then removes it.  1.0 now adds a delay of 3s by default.  If you do a
&gt; get during that time you should see an X-Riak-Vclock line for the 404
&gt; message after the delete.
&gt; If you use that vclock with the put then the tombstone will be removed.  The
&gt; feature wasn't well publicized so has not made it into the clients yet.
&gt;  There should be more info to follow on deletes soon.  If you really want
&gt; the old behavior, add {delete\_mode, immediate} to the riak\_kv section of
&gt; your app.config
&gt; Jon Meredith
&gt; Basho Technologies.
&gt; On Wed, Oct 5, 2011 at 1:13 PM, Eric Moritz 
&gt; wrote:
&gt;&gt;
&gt;&gt; If I enabled allow\_multi on a bucket and do I DELETE followed by a PUT
&gt;&gt; I am getting a 300 response with one sibling having the body of the
&gt;&gt; PUT and a second sibling with an empty body.  If that the expected
&gt;&gt; behavior?
&gt;&gt;
&gt;&gt; I wrote a script that would start with a reconciled value.  Get the
&gt;&gt; VClock of the current value.  Then do every permutation of  a PUT with
&gt;&gt; (Pv) and without (P) the VClock and a DELETE with (Dv) and without (D)
&gt;&gt; the vClock and I see the following result:
&gt;&gt;
&gt;&gt; Pv      Dv      404
&gt;&gt; Dv      Pv      300
&gt;&gt; Pv      D        404
&gt;&gt; D       Pv       300
&gt;&gt;
&gt;&gt; Is it expected that a delete creates a blank sibling like that and
&gt;&gt; therefore we should treat empty body's as deleted?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Eric Moritz.
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

