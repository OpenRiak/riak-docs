---
title: "RE: preflist_exhausted error"
description: ""
project: community
lastmod: 2012-04-25T15:49:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07327"
mailinglist_parent_id: "msg07310"
author_name: "Sati, Mohit"
project_section: "mailinglistitem"
sent_date: 2012-04-25T15:49:23-07:00
---


Sean,

We installed riak 1.1.1 and selected storage\_backend setting to 
riak\_kv\_eleveldb\_backend. The indexes were enabled by default. I did some 
testing and they are sending me the keys back. I used the link below which has 
examples.

http://basho.com/blog/technical/2011/09/14/Secondary-Indexes-in-Riak/

To create an index on objects in the existing bucket, we need to retreive and 
re-insert. If we need to index a field in future, we need retreive all objects 
and then re-insert.

Thanks
Mohit
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
From: Sean Cribbs [s...@basho.com]
Sent: Tuesday, April 24, 2012 11:58 AM
To: Sati, Mohit
Cc: riak-users@lists.basho.com
Subject: Re: preflist\_exhausted error

Mohit,

Be aware that key filters are just a thin layer on top of full-bucket key 
listings. You'd be better off storing the field you want to filter in a 
secondary index, which more efficiently supports range queries (note that only 
the LevelDB storage engine currently supports secondary indexes). Barring that, 
you could use the special "$key" index for a range query on the key.

On Tue, Apr 24, 2012 at 1:07 PM, Sati, Mohit 
&gt; wrote:
Hello All,

I'm getting the below error in my queries. I'm using riak 1.1.1

Riak Version:
============
$rpm -qa | grep riak
riak-1.1.1-1.el6.x86\_64

Riak Error:
========
HTTP/1.1 100 Continue
HTTP/1.1 500 Internal Server Error
Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
Date: Tue, 24 Apr 2012 16:58:53 GMT
Content-Type: application/json
Content-Length: 625
{"phase":0,"error":"[preflist\_exhausted]"

Query:
==========
My query is doing a range scan. I can only get data for 1 day. For 2 or more 
days it is throwing the error posted above.

{"inputs":{ "bucket":"tagg\_dsquery",
 "key\_filters":[["and",
 [["starts\_with", "dsquery-us\_prm"]],
 [["and",
 [["tokenize", "-", 5], ["greater\_than\_eq", "20120312"]],
 [["tokenize", "-", 5], ["less\_than\_eq", "20120314"]]
 ]]
 ]]},
...
...


app.config changes:
=============
map\_js\_vm\_count - increased to 32,64,128 and 256 but not helping
js\_max\_vm\_mem - increased to 32,64,128,256,512 and 1024.
js\_thread\_stack - increased to 64,128,256,512,1024 and 2048 (cannot go beyond) 
- riak would not start

Can anyone help me to debug this issue. My queries cannot go beyond 1 day

Thanks
Mohit

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com




--
Sean Cribbs &gt;
Software Engineer
Basho Technologies, Inc.
http://basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

