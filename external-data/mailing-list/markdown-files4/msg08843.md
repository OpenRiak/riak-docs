---
title: "Re: How to search objects using riak_search method"
description: ""
project: community
lastmod: 2012-10-09T04:49:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08843"
mailinglist_parent_id: "msg08406"
author_name: "郎咸武"
project_section: "mailinglistitem"
sent_date: 2012-10-09T04:49:58-07:00
---


Hi, Joe Caswell
I have a new question.

((ejabberd@meta)19&gt; f(O),O=riakc\_obj:new(&lt;&lt;"user1"&gt;&gt;, &lt;&lt;"jason3"&gt;&gt;,
list\_to\_binary("[{\"name\":\"\\u00e9\\u0083\\u008e\\u00e5\\u0093\\u00b2\"},{\"sex\":\"male1\"}]"),
"application/json").
{riakc\_obj,&lt;&lt;"user1"&gt;&gt;,&lt;&lt;"jason3"&gt;&gt;,undefined,[],
 {dict,1,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},

 {{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;...&gt;&gt;|...]],[],[],...}}},

 
&lt;&lt;"[{\"name\":\"\\u00e9\\u0083\\u008e\\u00e5\\u0093\\u00b2\"},{\"sex\":\"male1\"}]"&gt;&gt;}

(ejabberd@meta)20&gt; riakc\_pb\_socket:put(Pid, O).
ok

(ejabberd@meta)28&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;,
list\_to\_binary("\"sex\":male1\*")). \* The operation is ok.\*
{ok,{search\_results,[{&lt;&lt;"user1"&gt;&gt;,
 [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason3"&gt;&gt;},
 {&lt;&lt;"name"&gt;&gt;,

&lt;&lt;195,169,194,131,194,142,195,165,194,147,194,178&gt;&gt;},
 {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male1"&gt;&gt;}]}],
 0.0,1}}

(ejabberd@meta)29&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;,
list\_to\_binary("\"name\":\\u00e9\\u0083\\u008e\\u00e5\\u0093\\u00b2")).

{ok,{search\_results,[],0.0,0}} \*%% But there is empty. Why?\*
(ejabberd@meta)30&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;,
list\_to\_binary("\"name\":\\u00e9\\u0083\\u008e\\u00e5\\u0093\\u00b2\*")).

{ok,{search\_results,[],0.0,0}} \*%% There is empty,too. Why?\*

Thanks in advance.

2012/9/7 郎咸武 

&gt; Thanks a lot. That is ok
&gt;
&gt;
&gt; 2012/9/6 Joe Caswell 
&gt;
&gt;&gt; Try without the extra quotes
&gt;&gt;
&gt;&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user2"&gt;&gt;, list\_to\_binary("sex:mal\*")).
&gt;&gt;
&gt;&gt; Joe Caswell
&gt;&gt;
&gt;&gt; From: 郎咸武 
&gt;&gt; Date: Friday, August 31, 2012 3:14 AM
&gt;&gt; To: riak-users 
&gt;&gt; Subject: Re: How to search objects using riak\_search method
&gt;&gt;
&gt;&gt; Creating object like this:
&gt;&gt; f(O),O=riakc\_obj:new(&lt;&lt;"user"&gt;&gt;, &lt;&lt;"jason"&gt;&gt;,
&gt;&gt; list\_to\_binary("[{\"name\":\"jason\"},{\"sex\":\"male\"}]"),
&gt;&gt; "application/json").
&gt;&gt;
&gt;&gt;
&gt;&gt; 72&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user2"&gt;&gt;,
&gt;&gt; list\_to\_binary("\"sex\":\"male\"")).
&gt;&gt; {ok,{search\_results,[{&lt;&lt;"user2"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
&gt;&gt; {&lt;&lt;"name"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
&gt;&gt; {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male"&gt;&gt;}]}],
&gt;&gt; 0.35355299711227417,1}}
&gt;&gt; 73&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user2"&gt;&gt;,
&gt;&gt; list\_to\_binary("\"sex\":\"mal\*\"")). \*%% But this is empty. Why?\*
&gt;&gt; {ok,{search\_results,[],0.0,0}}
&gt;&gt; 74&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user2"&gt;&gt;,
&gt;&gt; list\_to\_binary("\"sex\":\"male\"")).
&gt;&gt; {ok,{search\_results,[{&lt;&lt;"user2"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
&gt;&gt; {&lt;&lt;"name"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
&gt;&gt; {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male"&gt;&gt;}]}],
&gt;&gt; 0.35355299711227417,1}}
&gt;&gt;
&gt;&gt;
&gt;&gt; 2012/8/31 郎咸武 
&gt;&gt;
&gt;&gt;&gt; anyone may reply me,thanks a lot.
&gt;&gt;&gt;
&gt;&gt;&gt; 在 2012年8月30日星期四，郎咸武 写道：
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; who can give me some idea
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 在 2012年8月30日星期四，郎咸武 写道：
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi guys,
&gt;&gt;&gt;&gt; I need your help.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Version:
&gt;&gt;&gt;&gt; 1)riak-erlang-client-1.3
&gt;&gt;&gt;&gt; 2)riak-1.2
&gt;&gt;&gt;&gt; 3)Erlang R14B04 (erts-5.8.5) [source] [64-bit]
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This is my bucket attributs in the following
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; (riak@127.0.0.1)52&gt; {ok,C} = riak:local\_client().
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {ok,{riak\_client,'riak@127.0.0.1',undefined}}
&gt;&gt;&gt;&gt; (riak@127.0.0.1)53&gt; C:set\_bucket(&lt;&lt;"user"&gt;&gt;,[{precommit,
&gt;&gt;&gt;&gt; [{struct,[{&lt;&lt;"mod"&gt;&gt;,&lt;&lt;"riak\_search\_kv\_hook"&gt;&gt;},{&lt;&lt;"fun"&gt;&gt;,&lt;&lt;"precommit"&gt;&gt;}]}]}]).
&gt;&gt;&gt;&gt; ok
&gt;&gt;&gt;&gt; (riak@127.0.0.1)54&gt; C:get\_bucket(&lt;&lt;"user"&gt;&gt;).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [{search,true},
&gt;&gt;&gt;&gt; {allow\_mult,false},
&gt;&gt;&gt;&gt; {basic\_quorum,false},
&gt;&gt;&gt;&gt; {big\_vclock,50},
&gt;&gt;&gt;&gt; {chash\_keyfun,{riak\_core\_util,chash\_std\_keyfun}},
&gt;&gt;&gt;&gt; {dw,quorum},
&gt;&gt;&gt;&gt; {last\_write\_wins,false},
&gt;&gt;&gt;&gt; {linkfun,{modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}},
&gt;&gt;&gt;&gt; {n\_val,3},
&gt;&gt;&gt;&gt; {name,&lt;&lt;"user"&gt;&gt;},
&gt;&gt;&gt;&gt; {notfound\_ok,true},
&gt;&gt;&gt;&gt; {old\_vclock,86400},
&gt;&gt;&gt;&gt; {postcommit,[]},
&gt;&gt;&gt;&gt; {pr,0},
&gt;&gt;&gt;&gt; \* {precommit,[{struct,[{&lt;&lt;"mod"&gt;&gt;,&lt;&lt;"riak\_search\_kv\_hook"&gt;&gt;},\*
&gt;&gt;&gt;&gt; \* {&lt;&lt;"fun"&gt;&gt;,&lt;&lt;"precommit"&gt;&gt;}]}]},\*
&gt;&gt;&gt;&gt; {pw,0},
&gt;&gt;&gt;&gt; {r,quorum},
&gt;&gt;&gt;&gt; {rw,quorum},
&gt;&gt;&gt;&gt; {small\_vclock,50},
&gt;&gt;&gt;&gt; {w,quorum},
&gt;&gt;&gt;&gt; {young\_vclock,20}]
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \*------------------\*
&gt;&gt;&gt;&gt; \*In the client\*
&gt;&gt;&gt;&gt; \*To new a object and search it\*
&gt;&gt;&gt;&gt; 147&gt; f(O),O=riakc\_obj:new(&lt;&lt;"user"&gt;&gt;, &lt;&lt;"jason"&gt;&gt;, &lt;&lt;"jasonlang"&gt;&gt;)
&gt;&gt;&gt;&gt; 147&gt; .
&gt;&gt;&gt;&gt; {riakc\_obj,&lt;&lt;"user"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;,undefined,[],undefined,
&gt;&gt;&gt;&gt; &lt;&lt;"jasonlang"&gt;&gt;}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 150&gt; riakc\_pb\_socket:put(Pid,O).
&gt;&gt;&gt;&gt; ok
&gt;&gt;&gt;&gt; 151&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user"&gt;&gt;, "jason\*")
&gt;&gt;&gt;&gt; 151&gt; .
&gt;&gt;&gt;&gt; {ok,{search\_results,[{&lt;&lt;"user"&gt;&gt;,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"jasonlang"&gt;&gt;}]}],
&gt;&gt;&gt;&gt; 0.0,1}}
&gt;&gt;&gt;&gt; 152&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \*This search operator is ok\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \*TO new another object and search it\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 152&gt; f(O),O=riakc\_obj:new(&lt;&lt;"user"&gt;&gt;, &lt;&lt;"lang"&gt;&gt;, &lt;&lt;"langzhe"&gt;&gt;)
&gt;&gt;&gt;&gt; 152&gt; .
&gt;&gt;&gt;&gt; {riakc\_obj,&lt;&lt;"user"&gt;&gt;,&lt;&lt;"lang"&gt;&gt;,undefined,[],undefined,
&gt;&gt;&gt;&gt; &lt;&lt;"langzhe"&gt;&gt;}
&gt;&gt;&gt;&gt; 153&gt; riakc\_pb\_socket:put(Pid,O).
&gt;&gt;&gt;&gt; ok
&gt;&gt;&gt;&gt; 154&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user"&gt;&gt;, "langzh\*")
&gt;&gt;&gt;&gt; 154&gt; .
&gt;&gt;&gt;&gt; {ok,{search\_results,[{&lt;&lt;"user"&gt;&gt;,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"lang"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"langzhe"&gt;&gt;}]}],
&gt;&gt;&gt;&gt; 0.0,1}}
&gt;&gt;&gt;&gt; \*This is ok too\*
&gt;&gt;&gt;&gt; \*
&gt;&gt;&gt;&gt; \*
&gt;&gt;&gt;&gt; \*Search the objects:\*
&gt;&gt;&gt;&gt; 157&gt; riakc\_pb\_socket:search(Pid, &lt;&lt;"user"&gt;&gt;, "langzh\*\"\"jason\*")
&gt;&gt;&gt;&gt; 157&gt; .
&gt;&gt;&gt;&gt; {ok,{search\_results,[{&lt;&lt;"user"&gt;&gt;,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"jasonlang"&gt;&gt;}]},
&gt;&gt;&gt;&gt; {&lt;&lt;"user"&gt;&gt;,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"lang"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"langzhe"&gt;&gt;}]}],
&gt;&gt;&gt;&gt; 0.0,2}}
&gt;&gt;&gt;&gt; 158&gt;
&gt;&gt;&gt;&gt; This is ok too.
&gt;&gt;&gt;&gt; -------------------------------------------------------------------
&gt;&gt;&gt;&gt; \*In the above is ok.\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; 只为成功找方法，不为失败找理由
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; 只为成功找方法，不为失败找理由
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; 只为成功找方法，不为失败找理由
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; 只为成功找方法，不为失败找理由
&gt;



-- 
只为成功找方法，不为失败找理由
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

