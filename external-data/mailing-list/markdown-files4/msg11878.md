---
title: "Re: performance"
description: ""
project: community
lastmod: 2013-08-02T17:10:35-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11878"
mailinglist_parent_id: "msg11861"
author_name: "John Daily"
project_section: "mailinglistitem"
sent_date: 2013-08-02T17:10:35-07:00
---


50k definitely is a fair few. What's the objective for that many, if I may
ask? Always interesting to hear about different data models.

Sent from my iPhone

On Aug 2, 2013, at 7:56 PM, Paul Ingalls  wrote:

Not that many, I didn't let it run that long since the performance was so
poor. Maybe 50k or so...

Paul Ingalls
Founder & CEO Fanzo
p...@fanzo.me
@paulingalls
http://www.linkedin.com/in/paulingalls



On Aug 2, 2013, at 3:54 PM, John Daily  wrote:

Excellent news. How many buckets with custom settings did you create?

Sent from my iPhone

On Aug 2, 2013, at 6:51 PM, Paul Ingalls  wrote:

For those interested, I identified my performance problem.

I was creating a lot of buckets, and the properties did not match the
default bucket properties of the node. So getting the bucket was taking
between 300-400 milliseconds instead of 3-4. Apparently creating buckets
with non default bucket properties is not just a bad idea, but a REALLY bad
idea.

I changed the default to be what I wanted for most of my buckets
(allow\_mult=true) and tweaked the code to handle siblings where I wasn't
before, and now I'm getting lots of operations per second.

Thanks the for help every one!

Paul

Paul Ingalls
Founder & CEO Fanzo
p...@fanzo.me
@paulingalls
http://www.linkedin.com/in/paulingalls



On Aug 2, 2013, at 12:00 AM, Paul Ingalls  wrote:

One thing I am doing different than the benchmark is creating a lot of
bucketsâ€¦


Paul Ingalls
Founder & CEO Fanzo
p...@fanzo.me
@paulingalls
http://www.linkedin.com/in/paulingalls



On Aug 1, 2013, at 11:52 PM, Paul Ingalls  wrote:

The objects are either tweet jsons, so between 1-2k, or simple strings with
some links.

I am using secondary indexes with timestamps so I can do range queries.
 Would this significantly impact performance? I am not indexing for
search...

Here are some more bench results. Obviously using the azure load balancer
is a bad idea. Fortunately I'm not.

This was run from my laptop using 8 concurrent connections and the pb
client, using the load balancer in azure. Lots of errors.





this was run on a vm in the same cloud service using 8 concurrent workers
and the pb client, but clustered directly (i input all the IP addresses
to riakc\_pb\_ips). Much better ops. So it must be something with my usage
that isn't getting captured by the benchmark.



Paul Ingalls
Founder & CEO Fanzo
p...@fanzo.me
@paulingalls
http://www.linkedin.com/in/paulingalls



On Aug 1, 2013, at 10:46 PM, Jeremy Ong  wrote:

What is the average size of one of your objects? Are you indexing?


On Thu, Aug 1, 2013 at 10:23 PM, Paul Ingalls  wrote:

&gt; Running them on separate machines.
&gt;
&gt; I just ran basho bench against the service from my laptop. here is the
&gt; result. in this case I am just hitting one node. will try it again
&gt; shortly using a load balancer to hit all the nodes.
&gt;
&gt; 
&gt;
&gt; Paul Ingalls
&gt; Founder & CEO Fanzo
&gt; p...@fanzo.me
&gt; @paulingalls
&gt; http://www.linkedin.com/in/paulingalls
&gt;
&gt;
&gt;
&gt; On Aug 1, 2013, at 8:57 PM, Jared Morrow  wrote:
&gt;
&gt; Also, are you generating the load from the same VMs that Riak is running
&gt; on or do you have separate machines generating load?
&gt;
&gt;
&gt;
&gt; On Thursday, August 1, 2013, Jeremy Ong wrote:
&gt;
&gt;&gt; What erlang version did you build with? How are you load balancing
&gt;&gt; between the nodes? What kind of disks are you using?
&gt;&gt;
&gt;&gt; On Thu, Aug 1, 2013 at 7:53 PM, Paul Ingalls  wrote:
&gt;&gt; &gt; FYI, 2 more nodes died with the end of the last test. Storm, which I'm
&gt;&gt; &gt; using to put data in, kills the topology a bit abruptly, perhaps the
&gt;&gt; nodes
&gt;&gt; &gt; don't like a client going away like that?
&gt;&gt; &gt;
&gt;&gt; &gt; log from one of the nodes:
&gt;&gt; &gt;
&gt;&gt; &gt; 2013-08-02 02:27:23 =ERROR REPORT====
&gt;&gt; &gt; Error in process &lt;0.4959.0&gt; on node 'riak@riak004' with exit value:
&gt;&gt; &gt;
&gt;&gt; {badarg,[{riak\_core\_stat,vnodeq\_len,1,[{file,"src/riak\_core\_stat.erl"},{line,181}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\_core\_stat.erl"},{line,172}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[...
&gt;&gt; &gt;
&gt;&gt; &gt; 2013-08-02 02:27:33 =ERROR REPORT====
&gt;&gt; &gt; Error in process &lt;0.5055.0&gt; on node 'riak@riak004' with exit value:
&gt;&gt; &gt;
&gt;&gt; {badarg,[{riak\_core\_stat,vnodeq\_len,1,[{file,"src/riak\_core\_stat.erl"},{line,181}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\_core\_stat.erl"},{line,172}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[...
&gt;&gt; &gt;
&gt;&gt; &gt; 2013-08-02 02:27:51 =ERROR REPORT====
&gt;&gt; &gt; Error in process &lt;0.5228.0&gt; on node 'riak@riak004' with exit value:
&gt;&gt; &gt;
&gt;&gt; {badarg,[{riak\_core\_stat,vnodeq\_len,1,[{file,"src/riak\_core\_stat.erl"},{line,181}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\_core\_stat.erl"},{line,172}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[...
&gt;&gt; &gt;
&gt;&gt; &gt; and the log from the other node:
&gt;&gt; &gt;
&gt;&gt; &gt; 2013-08-02 00:09:39 =ERROR REPORT====
&gt;&gt; &gt; Error in process &lt;0.4952.0&gt; on node 'riak@riak007' with exit value:
&gt;&gt; &gt;
&gt;&gt; {badarg,[{riak\_core\_stat,vnodeq\_len,1,[{file,"src/riak\_core\_stat.erl"},{line,181}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\_core\_stat.erl"},{line,172}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[...
&gt;&gt; &gt;
&gt;&gt; &gt; 2013-08-02 00:09:44 =ERROR REPORT====
&gt;&gt; &gt; \*\* State machine &lt;0.2368.0&gt; terminating
&gt;&gt; &gt; \*\* Last event in was unregistered
&gt;&gt; &gt; \*\* When State == active
&gt;&gt; &gt; \*\* Data ==
&gt;&gt; &gt;
&gt;&gt; {state,114179815416476790484662877555959610910619729920,riak\_kv\_vnode,{deleted,{state,114179815416476790484662877555959610910619729920,riak\_kv\_eleveldb\_backend,{state,&lt;&lt;&gt;&gt;,"/mnt/datadrive/riak/data/leveldb/114179815416476790484662877555959610910619729920",[{create\_if\_missing,true},{max\_open\_files,128},{use\_bloomfilter,true},{write\_buffer\_size,58858594}],[{add\_paths,[]},{allow\_strfun,false},{anti\_entropy,{on,[]}},{anti\_entropy\_build\_limit,{1,3600000}},{anti\_entropy\_concurrency,2},{anti\_entropy\_data\_dir,"/mnt/datadrive/riak/data/anti\_entropy"},{anti\_entropy\_expire,604800000},{anti\_entropy\_leveldb\_opts,[{write\_buffer\_size,4194304},{max\_open\_files,20}]},{anti\_entropy\_tick,15000},{create\_if\_missing,true},{data\_root,"/mnt/datadrive/riak/data/leveldb"},{fsm\_limit,50000},{hook\_js\_vm\_count,2},{http\_url\_encoding,on},{included\_applications,[]},{js\_max\_vm\_mem,8},{js\_thread\_stack,16},{legacy\_stats,true},{listkeys\_backpressure,true},{map\_js\_vm\_count,8},{mapred\_2i\_pipe,true},{mapred\_name,"mapred"},{max\_open\_files,128},{object\_format,v1},{reduce\_js\_vm\_count,6},{stats\_urlpath,"stats"},{storage\_backend,riak\_kv\_eleveldb\_backend},{use\_bloomfilter,true},{vnode\_vclocks,true},{write\_buffer\_size,58858594}],[],[],[{fill\_cache,false}],true,false},{dict,0,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},undefined,3000,1000,100,100,true,true,undefined}},riak@riak003
&gt;&gt; ,none,undefined,undefined,undefined,{pool,riak\_kv\_worker,10,[]},undefined,107615}
&gt;&gt; &gt; \*\* Reason for termination =
&gt;&gt; &gt; \*\*
&gt;&gt; &gt;
&gt;&gt; {badarg,[{eleveldb,close,[&lt;&lt;&gt;&gt;],[]},{riak\_kv\_eleveldb\_backend,stop,1,[{file,"src/riak\_kv\_eleveldb\_backend.erl"},{line,149}]},{riak\_kv\_vnode,terminate,2,[{file,"src/riak\_kv\_vnode.erl"},{line,836}]},{riak\_core\_vnode,terminate,3,[{file,"src/riak\_core\_vnode.erl"},{line,847}]},{gen\_fsm,terminate,7,[{file,"gen\_fsm.erl"},{line,586}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"
&gt;
&gt;
&gt;



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

