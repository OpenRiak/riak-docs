---
title: "Re: safely resolving conflicts on read"
description: ""
project: community
lastmod: 2011-11-02T07:52:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05419"
mailinglist_parent_id: "msg05416"
author_name: "Bob Ippolito"
project_section: "mailinglistitem"
sent_date: 2011-11-02T07:52:09-07:00
---


An approach similar to #1 is implemented in statebox
http://github.com/mochi/statebox - basically the trick is to store an
operation queue along with the data, and to put some constraints on how
operations must work so that they can be repeated for conflict resolution.

On Wednesday, November 2, 2011, Erik Søe Sørensen  wrote:
&gt; What you'd usually do is somewhere between 2) and 3) - namely, accept
that siblings might occur (although rarely). Also, you'd have a resolution
function with the property (besides being deterministic) that
reconciliating two identical siblings would yield the same - i.e., f(X,X) =
X.
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; Fra: riak-users-boun...@lists.basho.com [
riak-users-boun...@lists.basho.com] På vegne af Justin Karneges [
jus...@affinix.com]
&gt; Sendt: 1. november 2011 21:34
&gt; Til: riak-users@lists.basho.com
&gt; Emne: safely resolving conflicts on read
&gt;
&gt; Hi,
&gt;
&gt; http://wiki.basho.com/Vector-Clocks.html contains this text:
&gt;
&gt; "It should be noted that if you are trying to resolve conflicts
automatically,
&gt; you can end up in a condition with which two clients are simultaneously
&gt; resolving and creating new conflicts."
&gt;
&gt; If conflict resolution is moved to the reader, I'm curious what strategies
&gt; people use to avoid this kind of feet stomping.
&gt;
&gt; Some ideas that have come to mind:
&gt;
&gt; 1) Have a deterministic way of deriving a correct/unified/winner value
from
&gt; multiple siblings, such that any reading client would always arrive at the
&gt; same answer. Simply use this derived answer as the value read, but don't
&gt; attempt to write a corrected value into Riak. The value could eventually
be
&gt; corrected at the time of a necessary write as opposed to a read reaction.
&gt;
&gt; 2) Determine a correct value per #1 above, but then attempt to write this
&gt; value back into Riak in such a way that if multiple nodes were to write
the
&gt; same value simultaneously then they don't create siblings. I'm not sure
if
&gt; this is possible in Riak?
&gt;
&gt; 3) Determine a correct value per #1 above, and allow exactly one node to
ever
&gt; immediately write corrected values after a read. Something like "if
hash(key)
&gt; % node\_count == current\_node then do\_correction". Since value correction
is
&gt; not vital to availability, there's no harm if the owning node is down. I
just
&gt; figure this would allow for self-healing over time.
&gt;
&gt; Maybe there are other ways. What do people really do?
&gt;
&gt; Thanks,
&gt; Justin
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

