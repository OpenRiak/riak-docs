---
title: "Re: Can't set up an instance on EC2 without locking me out."
description: ""
project: community
lastmod: 2013-03-24T18:04:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10578"
mailinglist_parent_id: "msg10574"
author_name: "Hector Castro"
project_section: "mailinglistitem"
sent_date: 2013-03-24T18:04:25-07:00
---


Hey Severin,

I just went through the steps to install Riak on a m1.small using AMI
ami-3fec7956. After that I enabled PAM based limits and set them to
65536 as outlined in the "Enable PAM Based Limits for Debian & Ubuntu"
section here [1]. I \*DID NOT\* uncomment `UseLogin` in the sshd
configuration file. Below are the commands to verify that the open
files limit was increased:

 ubuntu@ip-10-108-23-155:~$ sudo su riak
 riak@ip-10-108-23-155:/home/ubuntu$ ulimit -a | grep "open files"
 open files (-n) 65536
 riak@ip-10-108-23-155:/home/ubuntu$

Are you using a different AMI? Can you try giving it another shot
using only the section on enabling PAM based limits?

[0] 
http://docs.basho.com/riak/latest/tutorials/installation/Installing-on-Debian-and-Ubuntu/#Installing-From-Apt-Get
[1] http://docs.basho.com/riak/latest/cookbooks/Open-Files-Limit/#Linux

--
Hector


On Sun, Mar 24, 2013 at 1:05 PM, Severin Kistner  wrote:
&gt; Hello everyone,
&gt;
&gt; I installed riak on an Ubuntu 12.04 64 instance, no problem, but then
&gt; I get the "Open Files Limit" error.
&gt;
&gt; So I follow this guide
&gt; http://docs.basho.com/riak/1.2.0/cookbooks/Open-Files-Limit/ and set
&gt; the pam.
&gt; The first time I ignored the 5. (optional) and "should" is not clear
&gt; enough that you can screw up your instance here.
&gt;
&gt; So I didn't made the change in the /etc/ssh/sshd\_config and I was
&gt; still able to log in after reboot but the connection closed
&gt; immediately afterwards.
&gt;
&gt; I terminated the instance and started over, now I changed UseLogin to
&gt; yes and now the connection refuses immediately.
&gt; No way to access the instance now.
&gt;
&gt; What should I do?
&gt; This is kinda annoying. There is not much information about pam and
&gt; SSH and all the posts about refused connections tell me to change
&gt; configuration files ... not really helpful.
&gt;
&gt; Cheers Severin
&gt;
&gt; --
&gt; http://sekistner.com
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

