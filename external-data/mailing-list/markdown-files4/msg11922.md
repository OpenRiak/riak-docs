---
title: "Re: RiakNode class in Python client 2.0"
description: ""
project: community
lastmod: 2013-08-06T18:13:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11922"
mailinglist_parent_id: "msg11912"
author_name: "Matt Black"
project_section: "mailinglistitem"
sent_date: 2013-08-06T18:13:48-07:00
---


Hi Sean,

I would indeed like to take advantage of the pooling features of the new
client. Shared objects across Celery workers isn't something I'd ever
really looked at before - but it seems the only real way to share across
workers (ie, processes) is to use memcache or similar. Which makes sense.

Cheers
Matt


On 6 August 2013 23:04, Sean Cribbs  wrote:

&gt; Hi Matt,
&gt;
&gt; You are correct about the Decaying class, it is a wrapper for an
&gt; exponentially-decaying error rate. The idea is, you configure your client
&gt; to connect to multiple Riak nodes, and if one goes down or is restarted,
&gt; the possibility of its selection for new connections can be automatically
&gt; reduced by detecting network errors. Of course, this is moot when you are
&gt; connecting to the cluster via a load-balancer; at that point the
&gt; error-tracking logic can't help you.
&gt;
&gt; If you are creating and throwing away RiakClient objects frequently,
&gt; neither the error-tracking nor the connection pool will help you much.
&gt; However, I urge you to consider keeping a single client around, in some
&gt; globally accessible place (module constant? config object?). Your
&gt; concurrent workers will get to take advantage of existing connections, and
&gt; your socket/file-handle usage will be less.
&gt;
&gt;
&gt; On Tue, Aug 6, 2013 at 1:07 AM, Matt Black wrote:
&gt;
&gt;&gt; I've been looking through the changes to the RiakClient class - and have
&gt;&gt; a question about the nodes list and RiakNode/Decaying class.
&gt;&gt;
&gt;&gt; It seems that the Decaying class is used internally to track error\_rates
&gt;&gt; (request failure\_rate?) of nodes in the available pool.
&gt;&gt;
&gt;&gt; In the application I maintain, we're accessing Riak in many concurrent
&gt;&gt; celery workers - so my assumption would be that this internal error\_rate
&gt;&gt; tracking wouldn't do much good. Have I got this right? Is the client's
&gt;&gt; internal "nodes" list only really useful in a long running application?
&gt;&gt; (ie, when I'm not instantiating RiakClient fresh for each query).
&gt;&gt;
&gt;&gt; We currently have a "pool" of Riak nodes in some configuration, from
&gt;&gt; which a random IP is chosen for each request.
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

