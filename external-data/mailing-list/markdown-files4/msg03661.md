---
title: "Re: Pruning (merging) after storage reaches a certain size?"
description: ""
project: community
lastmod: 2011-06-13T10:31:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03661"
mailinglist_parent_id: "msg03660"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-06-13T10:31:33-07:00
---


Hi Steve,

This Knowledge Base article may be related:
https://help.basho.com/entries/20141178-why-does-it-seem-that-bitcask-merging-is-only-triggered-when-a-riak-node-is-restarted

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Mon, Jun 13, 2011 at 10:25 AM, Steve Webb  wrote:

&gt; Justin -
&gt;
&gt; My current bitcask settings are:
&gt;
&gt; %% Bitcask Config
&gt; {bitcask, [
&gt; {data\_root, "/var/lib/riaksearch/bitcask" },
&gt; {dead\_bytes\_merge\_trigger, 10242880 },
&gt; {dead\_bytes\_threshold, 5242880 },
&gt; {expiry\_secs, 86400}
&gt; ]},
&gt;
&gt; My understanding of these settings mean that the data should auto-expire
&gt; after one day. Also, once each bitcask file in
&gt; .../riaksearch/bitcask/xxx/\*.data once it has 10M of "dead" or expired data
&gt; in it, should be merged, right?
&gt;
&gt; I'm collecting the spritzer twitter stream and loading it into two buckets
&gt; (one non-indexed bucket holds the full tweet, one indexed bucket holds the
&gt; tweet string, id, date and username). I used to see about 10 GB of data
&gt; total, but it's growing and currently at 26GB of data total.
&gt;
&gt; I'm seeing these in the logs:
&gt;
&gt; INFO REPORT==== 13-Jun-2011::08:28:19 ===
&gt; Pid &lt;0.6844.0&gt; compacted 3 segments for 942232 bytes in 4.900694 seconds,
&gt; 0.18 MB/sec
&gt;
&gt; =INFO REPORT==== 13-Jun-2011::08:29:01 ===
&gt; Pid &lt;0.6267.0&gt; compacted 3 segments for 1721790 bytes in 9.690511 seconds,
&gt; 0.17 MB/sec
&gt;
&gt; =INFO REPORT==== 13-Jun-2011::08:31:23 ===
&gt; Pid &lt;0.6924.0&gt; compacted 3 segments for 6988416 bytes in 44.659753 seconds,
&gt; 0.15 MB/sec
&gt;
&gt; ... but I'm not seeing any "merging" related entries.
&gt;
&gt;
&gt; - Steve
&gt;
&gt; --
&gt; Steve Webb - Senior System Administrator for gnip.com
&gt; http://twitter.com/GnipWebb
&gt;
&gt; On Wed, 8 Jun 2011, Justin Sheehy wrote:
&gt;
&gt; Hi, Steve.
&gt;&gt;
&gt;&gt; Check out this page:
&gt;&gt; http://wiki.basho.com/Bitcask-Configuration.html#Disk-Usage-and-Merging-Settings
&gt;&gt;
&gt;&gt; Basically, a "merge trigger" must be met in order to have the merge
&gt;&gt; process occur. When it does occur, it will affect all existing files that
&gt;&gt; meet a "merge threshold."
&gt;&gt;
&gt;&gt; One note that is relevant for your specific use: the expiry\_secs parameter
&gt;&gt; will cause a given item to disappear from the client API immediately after
&gt;&gt; expiry, and to be cleaned if it is in a file already being merged, but will
&gt;&gt; not currently contribute toward merge triggers or thresholds on its own if
&gt;&gt; not otherwise "dead".
&gt;&gt;
&gt;&gt; -Justin
&gt;&gt;
&gt;&gt;
&gt;&gt; On Jun 7, 2011, at 4:29 PM, Steve Webb wrote:
&gt;&gt;
&gt;&gt; Hello there.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I'm curious - I'm up to about 10GB of storage and I'm guessing that I'll
&gt;&gt;&gt; be full in 3-4 more days of ingesting data. I have no idea if/when a merge
&gt;&gt;&gt; will run to expire the older data.
&gt;&gt;&gt;
&gt;&gt;&gt; I'm loading a 2-node (1GB mem, 20GB storage, vmware VMs) riaksearch
&gt;&gt;&gt; cluster with the spritzer twitter feed. I used the bitcask 'expiry\_secs' to
&gt;&gt;&gt; expire data after 3 days. Q: Is there a method or command to force a merge
&gt;&gt;&gt; at any time? Q: Is there a way to run a merge when the storage size reaches
&gt;&gt;&gt; a specific threshold?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; - Steve
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Steve Webb - Senior System Administrator for gnip.com
&gt;&gt;&gt; http://twitter.com/GnipWebb
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

