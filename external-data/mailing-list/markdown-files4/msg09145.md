---
title: "Re: Import tables/data from Microsoft SQL Server"
description: ""
project: community
lastmod: 2012-11-01T15:12:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09145"
mailinglist_parent_id: "msg09132"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2012-11-01T15:12:23-07:00
---


Oh, you know what, SqlBulkCopy is import only, so you can ignore what I
just wrote. It's part of ADO.NET

You really just want to stream rows into Riak as fast as you can - I'd run
with CorrugatedIron and use either RiakClient.Put or RiakAsyncClient.Put
depending on how synchronous you want to be with the Riak side of
things. CorrugatedIron uses the protobuf interface for put operations, so
you'll get a performance boost over using the Http client.

Some getting started info can be found here:
http://corrugatediron.org/documentation/Basics.Connecting.html and I can
help out as needed either via email/skype/whatever.

---
Jeremiah Peschka
Founder, Brent Ozar Unlimited
Microsoft SQL Server MVP



On Thu, Nov 1, 2012 at 2:54 PM, Kevin Burton wrote:

&gt; What do I need to setup the receiving end? How does this differ from
&gt; ADO.NET code?\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*From:\* riak-users [mailto:riak-users-boun...@lists.basho.com] \*On Behalf
&gt; Of \*Jeremiah Peschka
&gt; \*Sent:\* Thursday, November 01, 2012 4:30 PM
&gt; \*To:\* Jayson Barley
&gt;
&gt; \*Cc:\* riak-users
&gt; \*Subject:\* Re: Import tables/data from Microsoft SQL Server\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; The other thing to consider, for SQL Server exports, is that you should be
&gt; using the SqlBulkCopy class (or bcp.exe) to pull data out of your SQL
&gt; Server without doing terrible terrible things to your SQL Server
&gt; performance. You'll be better served by pushing data in stages rather than
&gt; attempting to stream data into Riak directly from SQL Server, even with
&gt; some intermediary transformation in between you'll still put some load on
&gt; SQL Server that could easily be avoided.\*\*\*\*
&gt;
&gt;
&gt; ---
&gt; Jeremiah Peschka
&gt; Founder, Brent Ozar Unlimited\*\*\*\*
&gt;
&gt; Microsoft SQL Server MVP
&gt;
&gt; \*\*\*\*
&gt;
&gt; On Thu, Nov 1, 2012 at 1:18 PM, Jayson Barley 
&gt; wrote:\*\*\*\*
&gt;
&gt; What you are going to want to do is to get the code from the T4 link. You
&gt; will use that to generate your POCO classes. Optionally you can create the
&gt; classes by hand since there are only a few of them. Create a .NET
&gt; application, C# in this case. Include the POCO classes into your main app
&gt; along with the Dapper assembly. The below code should be fairly accurate. I
&gt; typed this in gmail so I can't guarantee it will compile.
&gt;
&gt; // Careful with the size. With tables that have several million rows you
&gt; may exceed the max length
&gt; JavaScriptSerializer ser = new JavaScriptSerializer(){MaxJsonLength =
&gt; Int32.MaxValue};
&gt; StringBuilder json = new StringBuilder();
&gt; string connectionString = @"Data Source=DbServer;Initial
&gt; Catalog=DbName;Integrated Security=True";
&gt; // RIAK url to send data to
&gt; string url = "http://127.0.0.1:8091/riak/goog/";
&gt; // Iterate through your tables.
&gt; foreach(var table in Tables)
&gt; {
&gt; using(var connection = new SqlConnection(connectionString))
&gt; {
&gt; connection.Open();
&gt; // This is your dapper query that converts the results to your
&gt; classes
&gt; var results = connection.Query(@"SELECT \* FROM
&gt; SomeTable;").ToList();
&gt;
&gt; ser.Serialize(json);
&gt;
&gt; WebRequest request = WebRequest.Create(url);
&gt; request.Method = "POST";
&gt; request.ContentType ="application/json;charset=utf-8";
&gt; ((HttpWebRequest)request).KeepAlive = false;
&gt; byte[] byteData = Encoding.UTF8.GetBytes(json.ToString());
&gt; request.ContentLength = byteData.Length;
&gt; using (var postStream = request.GetRequestStream())
&gt; {
&gt; postStream.Write(byteData, 0, byteData.Length);
&gt; postStream.Close();\*\*\*\*
&gt;
&gt;
&gt; }
&gt; }
&gt; }\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Thu, Nov 1, 2012 at 12:41 PM, Dmitri Zagidulin 
&gt; wrote:\*\*\*\*
&gt;
&gt; Ah, ok.
&gt; Then I highly recommend following Jayson Barley's approach, in the
&gt; previous email. Query SQL server, compose a POCO type object, serialize it
&gt; to JSON, and store it in Riak either via the C++/C# client, or just use an
&gt; HTTP client and PUT/POST it over http.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Thu, Nov 1, 2012 at 3:37 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; OK. \*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; My preferred programming language is C++ or more recently C#. I have done
&gt; some Java programming but that was a while back. When I have played with
&gt; JavaScript it was always in the context of Microsoft’s version of
&gt; JavaScript.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; I would like to migrate about 5 tables. Our database is very unstructured
&gt; so there are few to no relationships so I don’t plan on migrating
&gt; relationships.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; The migration is really for a demo where I do a query on SQL Server and as
&gt; close as I can (based on the model that I create) retrieve the same type of
&gt; information using Riak and compare the performance. Then once I have a
&gt; basic apples to apples comparison I can show the other salient features of
&gt; Riak.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*From:\* riak-users [mailto:riak-users-boun...@lists.basho.com] \*On Behalf
&gt; Of \*Dmitri Zagidulin
&gt; \*Sent:\* Thursday, November 01, 2012 2:18 PM\*\*\*\*
&gt;
&gt;
&gt; \*To:\* riak-users
&gt; \*Subject:\* Re: Import tables/data from Microsoft SQL Server\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; Possibly. Let's step back for a second, however. Node.js might not be a
&gt; good fit for your migration script needs.
&gt;
&gt; A couple of questions:
&gt;
&gt; 1) What's your preferred programming language? Java, python, javascript,
&gt; etc?
&gt;
&gt; 2) What kind of data are you trying to migrate? (one table or many? what
&gt; kind of joins/relationships?)
&gt;
&gt; 3) What sort of use case/application is this migration for? \*\*\*\*
&gt;
&gt; On Thu, Nov 1, 2012 at 3:15 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; In this case the “server” is the Microsoft SQL Server. Right? So I need to
&gt; have IIS running on the same machine as the SQL Server?\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*From:\* riak-users [mailto:riak-users-boun...@lists.basho.com] \*On Behalf
&gt; Of \*Dmitri Zagidulin
&gt; \*Sent:\* Thursday, November 01, 2012 2:07 PM
&gt; \*To:\* riak-users\*\*\*\*
&gt;
&gt;
&gt; \*Subject:\* Re: Import tables/data from Microsoft SQL Server\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; Node.js http://nodejs.org/ http://en.wikipedia.org/wiki/Nodejs is a
&gt; server-side Javascript web application framework.
&gt;
&gt; It is completely unrelated to Java, and will have to be installed
&gt; separately. (It uses its own, javascript-specific package management app
&gt; called 'npm' (it's similar to ruby gems and python's eggs), plus has some
&gt; dependencies that you'll need to install via apt-get).
&gt;
&gt; Take a look here, for example, for installation instructions:
&gt; https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager
&gt; \*\*\*\*
&gt;
&gt; On Thu, Nov 1, 2012 at 2:53 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; Sorry for the newbie question but is node.js part of the Java distribution
&gt; for a Ubuntu Linux Server or do I need to get it as a package? How is it
&gt; installed? I am assuming that once node.js is installed then the code will
&gt; be just like any other Java app. Right?\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*From:\* Jeff Kirkell [mailto:jeff.kirk...@gmail.com]
&gt; \*Sent:\* Thursday, November 01, 2012 1:25 PM\*\*\*\*
&gt;
&gt;
&gt; \*To:\* Kevin Burton
&gt; \*Cc:\* riak-users
&gt; \*Subject:\* Re: Import tables/data from Microsoft SQL Server\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; This Microsoft blog post gives a sample how to query the SQL Server\*\*\*\*
&gt;
&gt;
&gt; http://blogs.msdn.com/b/sqlphp/archive/2012/06/08/introducing-the-microsoft-driver-for-node-js-for-sql-server.aspx
&gt; \*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; In the record loop, you use a Riak Node driver like riak-js.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; I can't share the scripts I wrote due to work but I can answer anything
&gt; you may have outside of providing the code.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; Thanks,\*\*\*\*
&gt;
&gt; Jeff\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; On Thu, Nov 1, 2012 at 2:09 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; Would you mind sharing that app? If you have time since I am not familiar
&gt; with Node.js would you mind showing me how you ran it as well as the
&gt; source. Thank you.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*From:\* Jeff Kirkell [mailto:jeff.kirk...@gmail.com]
&gt; \*Sent:\* Thursday, November 01, 2012 1:07 PM
&gt; \*To:\* Kevin Burton
&gt; \*Cc:\* riak-users
&gt; \*Subject:\* Re: Import tables/data from Microsoft SQL Server\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; There is nothing that I have come across. What I did in the past was run a
&gt; quick Node.js app that pulled data out of SQL Server using one of the
&gt; available drivers and serialize and write to Riak. It is not perfect, and
&gt; may be slow depending on the amount of data but it does work.\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; Jeff\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; On Thu, Nov 1, 2012 at 1:40 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; I would like some scripts or programming tools that I could use to
&gt; transfer existing data held in Microsoft SQL Server databases into Riak. Do
&gt; such tools exist?\*\*\*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

