---
title: "Re: Corruption of leveldb database files"
description: ""
project: community
lastmod: 2012-01-26T06:27:11-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06428"
mailinglist_parent_id: "msg06426"
author_name: "David Smith"
project_section: "mailinglistitem"
sent_date: 2012-01-26T06:27:11-08:00
---


I just bumped the version of LevelDB that is used in eleveldb, which
incorporates theses fixes.

https://github.com/basho/eleveldb/commit/0ef9fc1f0bedd0d45a36fa875710f560a1340d64

D.

On Thu, Jan 26, 2012 at 5:34 AM, Kresten Krab Thorup  wrote:
&gt; FYI, The LevelDB bug we observed when running out of disk space (bug ID #63 
&gt; in leveldb's issue list) is also reported fixed now.
&gt;
&gt; Kresten
&gt;
&gt; On 26/01/2012, at 13.26, "Thomas Bakketun"  
&gt; wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; A fix for this bug in leveldb has been released now. I would recommend
&gt;&gt; that a service release of Riak with this fix included is done as soon as
&gt;&gt; possible.
&gt;&gt;
&gt;&gt;
&gt;&gt; On 2012-01-16 17:52, David Smith wrote:
&gt;&gt;&gt; Thomas,
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for the heads up -- I saw that bug report on the Level repo this 
&gt;&gt;&gt; morning.
&gt;&gt;&gt;
&gt;&gt;&gt; D.
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon, Jan 16, 2012 at 9:50 AM, Thomas Bakketun
&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; We have found a bug in leveldb that causes corruption of the CURRENT
&gt;&gt;&gt;&gt; file of leveldb databases. A bug report has been filed:
&gt;&gt;&gt;&gt; http://code.google.com/p/leveldb/issues/detail?id=68
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This bug can easily be reproduced by restarting restarting Riak and
&gt;&gt;&gt;&gt; force of the computer within 30 to 60 seconds. After reboot at least one
&gt;&gt;&gt;&gt; corrupt leveldb database can be expected. When this happens Riak fails
&gt;&gt;&gt;&gt; to start and logs this message:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Failed to start riak\_kv\_eleveldb\_backend Reason: {db\_open,"Corruption:
&gt;&gt;&gt;&gt; CURRENT file does not end with newline"}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Switching on the sync flag for leveldb has no effect.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Thomas Bakketun, Senior software developer
&gt;&gt;&gt;&gt; T. +47 21 53 69 40
&gt;&gt;&gt;&gt; Copyleft Solutions
&gt;&gt;&gt;&gt; www.copyleftsolutions.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Thomas Bakketun, Senior software developer
&gt;&gt; T. +47 21 53 69 40
&gt;&gt; Copyleft Solutions
&gt;&gt; www.copyleftsolutions.com
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



-- 
Dave Smith
Director, Engineering
Basho Technologies, Inc.
diz...@basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

