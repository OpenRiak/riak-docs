---
title: "Re: Query on Riak Search in a cluster of 3 nodes behind ELB is giving	different result everytime"
description: ""
project: community
lastmod: 2015-04-01T01:43:54-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15944"
mailinglist_parent_id: "msg15942"
author_name: "Alex De la rosa"
project_section: "mailinglistitem"
sent_date: 2015-04-01T01:43:54-07:00
---


Oh, ok. Cool to know :) thanks

On Wed, Apr 1, 2015 at 10:06 AM, Vitaliy E &lt;13vitam...@gmail.com&gt; wrote:

&gt; Hi Alex,
&gt;
&gt; riak-admin member-status is the command
&gt;
&gt; (N - 1) nodes were showing all N nodes as part of the cluster, but "Ring
&gt; Ready: false" at the same time. One node was showing just itself in
&gt; "risk-admin member-status". Strangely, when shut down its status was
&gt; reflected in the admin console of the cluster, but no replication was done
&gt; so I'm sure it wasn't working together with the rest of the nodes.
&gt;
&gt; Repaired by joining the cluster as if it was never attempted before:
&gt;
&gt; riak-admin cluster join 
&gt; riak-admin cluster plan
&gt; riak-admin cluster commit
&gt;
&gt; Regards,
&gt; Vitaliy
&gt;
&gt;
&gt;
&gt; On Wed, Apr 1, 2015 at 10:54 AM, Alex De la rosa 
&gt; wrote:
&gt;
&gt;&gt; Hi Vitaliy,
&gt;&gt;
&gt;&gt; How did you find out a node in the cluster was not part in the cluster?
&gt;&gt; any commands to check that? And then, how did you fix that? (Just curious
&gt;&gt; and for future references)
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Alex
&gt;&gt;
&gt;&gt; On Wed, Apr 1, 2015 at 9:50 AM, Vitaliy E &lt;13vitam...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hello everyone,
&gt;&gt;&gt;
&gt;&gt;&gt; I've just joined the list, and am a bit late to the party. Sorry about
&gt;&gt;&gt; that. Thought I would contribute an answer anyway.
&gt;&gt;&gt;
&gt;&gt;&gt; Santi, what is you n\_val?
&gt;&gt;&gt;
&gt;&gt;&gt; I observed the behavior you are describing on Riak 2.0.0 with n\_val=3 in
&gt;&gt;&gt; two cases:
&gt;&gt;&gt;
&gt;&gt;&gt; 1. One of the nodes was not part of the cluster although the cluster was
&gt;&gt;&gt; thinking it was. Don't ask me how that happened. Obviously, when a request
&gt;&gt;&gt; hit that node part of the entries could not be found there.
&gt;&gt;&gt;
&gt;&gt;&gt; 2. Look for indexing errors in Solr console and Riak logs. Each Riak
&gt;&gt;&gt; node has its own Solr "repository", so if an entry fails to be indexed on
&gt;&gt;&gt; any of them, search results will be inconsistent depending on which set of
&gt;&gt;&gt; nodes returns it. Let's say you have replicas on nodes A, B, and C. Entry X
&gt;&gt;&gt; failed to be indexed on A, entry Y failed to be indexed on A and B, and
&gt;&gt;&gt; entry Z was indexed OK on all nodes. Then you may get {X,Y,Z}, {X,Z}, or
&gt;&gt;&gt; {Z} as your search results.
&gt;&gt;&gt;
&gt;&gt;&gt; In our case the indexing failures were caused by disk/filesystem errors.
&gt;&gt;&gt;
&gt;&gt;&gt; Regards,
&gt;&gt;&gt; Vitaly
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

