---
title: "RE: Riak 2.1.4 crashes with Out of Memory Error"
description: ""
project: community
lastmod: 2017-05-03T23:52:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18199"
mailinglist_parent_id: "msg18196"
author_name: "Arulappan, Jerald (Jerald) "
project_section: "mailinglistitem"
sent_date: 2017-05-03T23:52:48-07:00
---


Hi Luke Bakken,

The size of the objects stored in Riak varies from 10kb to 500kb.
I did see the need to upgrade RIAK due to AAE fixes and will be doing that.
However I wanted to understand the root cause and make sure this wouldn't 
happen again after the upgrade.

Regards,
Jerald 

-----Original Message-----
From: Luke Bakken [mailto:lbak...@basho.com] 
Sent: Wednesday, May 03, 2017 8:01 PM
To: Arulappan, Jerald (Jerald) \*\*CTR\*\* 
Cc: riak-users@lists.basho.com
Subject: Re: Riak 2.1.4 crashes with Out of Memory Error

Hi Jerald -

What is the average size of an object that you are storing in Riak?

I'm also seeing a lot of errors in the logs related to AAE, like you note. I 
know there have been fixes in that part of Riak since 2.1.4 and recommend 
upgrading.

--
Luke Bakken
Engineer
lbak...@basho.com


On Tue, May 2, 2017 at 6:56 AM, Arulappan, Jerald (Jerald)  
wrote:
&gt; Hi,
&gt;
&gt; I am using a single node riak server 2.1.4 with bitcask as backend for 
&gt; storing files.
&gt; The riak node stops working after every week. (Looks like when the 
&gt; active anti-entropy process recreates the hash tree) The sylog shows 
&gt; Out of memory Error. But the console.log shows "sst: No such file or 
&gt; directory"
&gt; Syslog Error:
&gt;
&gt; Apr 26 17:39:37 TLCCBAPRO2 kernel: Out of memory: Kill process 16685
&gt; (beam.smp) score 824 or sacrifice child Apr 26 17:39:37 TLCCBAPRO2 
&gt; kernel: Killed process 16987 (sh) total-vm:106168kB, anon-rss:116kB, 
&gt; file-rss:0kB Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill 
&gt; process 16685
&gt; (beam.smp) score 824 or sacrifice child Apr 26 17:39:41 TLCCBAPRO2 
&gt; kernel: Killed process 30374 (memsup) total-vm:4112kB, anon-rss:80kB, 
&gt; file-rss:0kB Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill 
&gt; process 16685
&gt; (beam.smp) score 824 or sacrifice child Apr 26 17:39:41 TLCCBAPRO2 
&gt; kernel: Killed process 14351 (cpu\_sup) total-vm:4112kB, anon-rss:68kB, 
&gt; file-rss:0kB Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill 
&gt; process 16685
&gt; (beam.smp) score 824 or sacrifice child Apr 26 17:39:41 TLCCBAPRO2 
&gt; kernel: Killed process 30385 (sh) total-vm:106164kB, anon-rss:136kB, 
&gt; file-rss:416kB Apr 26 17:44:48 TLCCBAPRO2 run\_erl[16682]: Erlang 
&gt; closed the connection.
&gt;
&gt; Console.log:
&gt;
&gt; 2017-04-26 17:37:03.493 [info]
&gt; &lt;0.625.0&gt;@riak\_kv\_vnode:maybe\_create\_hashtrees:227
&gt; riak\_kv/91343852333181432387730302044767688728495783936: unable to 
&gt; start
&gt; index\_hashtree: {error,{{badmatch,{error,{db\_open,"IO error:
&gt; ./data/anti\_entropy/91343852333181432387730302044767688728495783936/sst\_0/001954.sst:
&gt; No such file or
&gt; directory"}}},[{hashtree,new\_segment\_store,2,[{file,"src/hashtree.erl"
&gt; },{line,675}]},{hashtree,new,2,[{file,"src/hashtree.erl"},{line,246}]}
&gt; ,{riak\_kv\_index\_hashtree,do\_new\_tree,3,[{file,"src/riak\_kv\_index\_hasht
&gt; ree.erl"},{line,610}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]
&gt; },{riak\_kv\_index\_hashtree,init\_trees,3,[{file,"src/riak\_kv\_index\_hasht
&gt; ree.erl"},{line,474}]},{riak\_kv\_index\_hashtree,init,1,[{file,"src/riak
&gt; \_kv\_index\_hashtree.erl"},{line,268}]},{gen\_server,init\_it,6,[{file,"ge
&gt; n\_server.erl"},{line,304}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_l
&gt; ib.erl"},{line,239}]}]}}
&gt; 2017-04-26 17:37:03.515 [error] &lt;0.30178.2881&gt; CRASH REPORT Process 
&gt; &lt;0.30178.2881&gt; with 0 neighbours exited with reason: no match of right 
&gt; hand value {error,{db\_open,"IO error:
&gt; ./data/anti\_entropy/936274486415109681974235595958868809467081785344/000037.sst:
&gt; No such file or directory"}} in hashtree:new\_segment\_store/2 line 675 
&gt; in
&gt; gen\_server:init\_it/6 line 328
&gt; 2017-04-26 17:37:03.515 [info]
&gt; &lt;0.623.0&gt;@riak\_kv\_vnode:maybe\_create\_hashtrees:227
&gt; riak\_kv/45671926166590716193865151022383844364247891968: unable to 
&gt; start
&gt; index\_hashtree: {error,{{badmatch,{error,{db\_open,"IO error:
&gt; ./data/anti\_entropy/45671926166590716193865151022383844364247891968/sst\_0/002239.sst:
&gt; No such file or
&gt; directory"}}},[{hashtree,new\_segment\_store,2,[{file,"src/hashtree.erl"
&gt; },{line,675}]},{hashtree,new,2,[{file,"src/hashtree.erl"},{line,246}]}
&gt; ,{riak\_kv\_index\_hashtree,do\_new\_tree,3,[{file,"src/riak\_kv\_index\_hasht
&gt; ree.erl"},{line,610}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]
&gt; },{riak\_kv\_index\_hashtree,init\_trees,3,[{file,"src/riak\_kv\_index\_hasht
&gt; ree.erl"},{line,474}]},{riak\_kv\_index\_hashtree,init,1,[{file,"src/riak
&gt; \_kv\_index\_hashtree.erl"},{line,268}]},{gen\_server,init\_it,6,[{file,"ge
&gt; n\_server.erl"},{line,304}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_l
&gt; ib.erl"},{line,239}]}]}}
&gt; 2017-04-26 17:37:03.516 [error] &lt;0.30207.2881&gt; CRASH REPORT Process 
&gt; &lt;0.30207.2881&gt; with 0 neighbours exited with reason: no match of right 
&gt; hand value {error,{db\_open,"IO error:
&gt; ./data/anti\_entropy/45671926166590716193865151022383844364247891968/sst\_0/002239.sst:
&gt; No such file or directory"}} in hashtree:new\_segment\_store/2 line 675 
&gt; in
&gt; gen\_server:init\_it/6 line 328
&gt;
&gt;
&gt;
&gt; The complete logs are in the attached zip file. Any thoughts on the 
&gt; root cause and possible solution to overcome this is much appreciated.
&gt;
&gt;
&gt;
&gt; Regards,
&gt;
&gt; Jerald
&gt;
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_ma
&gt; ilman\_listinfo\_riak-2Dusers-5Flists.basho.com&d=DwIFaQ&c=BFpWQw8bsuKpl
&gt; 1SgiZH64Q&r=zOPuaocGAfHxJUtnOg9ZgYW14EJAnNldsbCwB84w4zE&m=7t76DY3mCrip
&gt; DH3glx\_DHTdBaJGT\_aqr1EtXkWhPYhI&s=rVfw97EO99wQM0eCfFhWyIPzTLyS2jk\_3qZw
&gt; XcvWcpE&e=
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

