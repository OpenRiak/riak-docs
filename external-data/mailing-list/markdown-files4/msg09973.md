---
title: "Re: Parameter Planning (eleveldb)"
description: ""
project: community
lastmod: 2013-02-03T13:13:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09973"
mailinglist_parent_id: "msg09972"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2013-02-03T13:13:37-08:00
---


First: Step 2 is talking about how many vnodes exist on a physical server. If 
your ring size is 256, but you have 8 servers â€¦ then your vnode count for step 
2 is 32.

Second: the 2048 is a constant forced by Google's leveldb implementation. It 
is the portion of a file covered by a single bloom filter. This calculation 
constant disappears with the upcoming 1.3 release.

Third: yes there is a "block\_size" parameter that is 4096. Increase that only 
if you want to REDUCE the performance of the leveldb instance. 4096 is a very 
happy value. We have customers and tests with 130K data values, all using 4096 
block size. The block\_size only governs the minimum written (aggregate size of 
small values that must be written as one unit at minimum).

Use 104Mbyte for your average sst file size. It is "good enough"


I am not following the question stream for Step 4 and beyond. Please state 
again.

Matthew




On Feb 3, 2013, at 3:44 PM, Simon Effenberg  wrote:

&gt; Hi,
&gt; 
&gt; I'm not sure if I understand this all well to calculate the memory
&gt; usage per file and other stuff.
&gt; 
&gt; The webpage tells me some steps but I'm completly unsure if I understand all 
&gt; parameters.
&gt; 
&gt; "Step 1: Calculate Available Working Memory"
&gt; 
&gt; taking the example:
&gt; 
&gt; leveldb\_working\_memory = 32G \* (1 - .50) = 16G
&gt; 
&gt; "Step 2: Calculate Working Memory per vnode"
&gt; 
&gt; vnode\_working\_memory = leveldb\_working\_memory / vnode\_count
&gt; 
&gt; vnode\_count = 256
&gt; 
&gt; =&gt; vnode\_working\_memory = 16G / 256 = 64MB/vnode
&gt; 
&gt; also easy
&gt; 
&gt; "Step 3: Estimate Memory Used by Open Files"
&gt; 
&gt; open\_file\_memory =
&gt; (max\_open\_files-10) \* (
&gt; 184 + (average\_sst\_filesize/2048) \*
&gt; (8 + ((average\_key\_size+average\_value\_size)/2048 +1) \*
&gt; 0.6
&gt; )
&gt; 
&gt; so how do I know the average\_sst\_filesize (and what is this value exactly)
&gt; (and is 2048 for both /2048 true or 4096 in riak 1.2?) and how do I know
&gt; the max\_open\_files?
&gt; 
&gt; 
&gt; average\_key\_size could be 16byte (I have to ask someone but taking it for now)
&gt; average\_value\_size will be 14kbyte 
&gt; 
&gt; so for now
&gt; 
&gt; open\_file\_memory =
&gt; (max\_open\_files-10) \* (
&gt; 184 + (average\_sst\_filesize/2048) \*
&gt; (8 + ((16+14336)/2048 +1) \*
&gt; 0.6
&gt; )
&gt; 
&gt; (side question: should I increase the block\_size because of the big average 
&gt; value size?
&gt; and also should I leave the cache\_size at the default value like it was 
&gt; recommended?)
&gt; 
&gt; "Step 4: Calculate Average Write Buffer"
&gt; 
&gt; should I increase these values or not? If only two are held in memory and I 
&gt; have, as an
&gt; example, 32GB or RAM like in this scenario, shouldn't I increase it to 
&gt; something else?
&gt; 
&gt; "Step 5: Calculate vnode Memory Used"
&gt; 
&gt; memory/vnode = average\_write\_buffer\_size + cache\_size + open\_file\_memory + 20 
&gt; MB
&gt; 
&gt; So for now I miss almost all 3 values :(.
&gt; 
&gt; To get an Idea:
&gt; 
&gt; - 3 buckets
&gt; - overall ~ 343347732 keys (but only 2/3 have 14kbyte in average)
&gt; 
&gt; 
&gt; Thx for help!
&gt; Simon
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

