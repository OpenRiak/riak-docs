---
title: "Re: Riak search. Different results (XML - JSON)"
description: ""
project: community
lastmod: 2012-08-27T07:23:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08369"
mailinglist_parent_id: "msg08365"
author_name: "Vladimir Shapovalov"
project_section: "mailinglistitem"
sent_date: 2012-08-27T07:23:07-07:00
---


Thank you for the explanation.

It looks like the serialization routine in one case (solr) encodes
characters\_to\_binary()
and by normal fetch not. Assuming we fetch in JSON in both cases.

I'm requesting same data in same format, i.e. JSON.
Once by fetching object like /buckets/bucket/keys/key.
And second time by using solr query
/solr/index\_name/select?q=kex\_name:value.
And I get different results, i.e. differently encoded JSON.
Both requests give me exactly the same key back. From "user abstraction
level" I was expecting the same results.

Probably riak folks could give me an advice how to convince riak give me
exactly the same result back in both cases. Are there any config options
for?

Thanks in advance!
Vladimir



On Sun, Aug 26, 2012 at 6:07 PM, Olav Frengstad  wrote:

&gt; The current implementation uses mochiweb2 to serialize JSON. By itself
&gt; mochijson2 produces the output you expect (src/riak\_solr\_output.erl):
&gt;
&gt; 55&gt; io:format("~s~n", [mochijson2:encode("Sabinastraße")]).
&gt; [83,97,98,105,110,97,115,116,114,97,223,101]
&gt;
&gt; But since everything is mapped according to your schema the actual
&gt; call handling the encoding looks like this:
&gt;
&gt; 56 &gt; io:format("~s~n",
&gt; [mochijson2:encode([unicode:characters\_to\_binary("Sabinastraße")])]).
&gt; ["Sabinastra\u00dfe"]
&gt;
&gt; The reason for the difference in your results comes down to JSON using
&gt; convert\_type/2 when serializing data and XML doesn't. Unfortunately I
&gt; don't know why the the difference in serialization routines.
&gt;
&gt; Hope this answers your question.
&gt;
&gt; Olav
&gt;
&gt; 2012/8/26 Vladimir Shapovalov :
&gt; &gt; Hey Olaf,
&gt; &gt;
&gt; &gt; Thanks for the answer.
&gt; &gt;
&gt; &gt; Yep, I know, it's JSON compliant.
&gt; &gt; The question is, why the unicode escaped sequences appear only in case of
&gt; &gt; searching and retrieveing in JSON? This is not the case in XML output.
&gt; &gt;
&gt; &gt; If I just get the same key directly in JSON, the unicode chars are NOT
&gt; &gt; escaped.
&gt; &gt;
&gt; &gt; Cheers
&gt; &gt; Vladimir
&gt; &gt;
&gt; &gt;
&gt; &gt; On Sun, Aug 26, 2012 at 4:55 PM, Olav Frengstad  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hey,
&gt; &gt;&gt;
&gt; &gt;&gt; \00df is the unicode representation of ß. The JSON spec states that
&gt; &gt;&gt; "Any character may be escaped" so it is valid JSON.
&gt; &gt;&gt;
&gt; &gt;&gt; Your JSON parser should handle this automatic.
&gt; &gt;&gt;
&gt; &gt;&gt; Cheers,
&gt; &gt;&gt; Olav
&gt; &gt;&gt; 2012/8/25 Vladimir Shapovalov :
&gt; &gt;&gt; &gt; Hi all,
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; I've a key in a bucket, witch is indexed.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; {
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; "street":"Sabinastraße"
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; }
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; If I retrieve the key this way:
&gt; &gt;&gt; &gt; curl -i -v http://localhost:8098/buckets/is\_solr/keys/123
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; The response looks like:
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; {
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; "street":"Sabinastraße"
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; }
&gt; &gt;&gt; &gt; which is correct.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; If I search for key and expect XML output:
&gt; &gt;&gt; &gt; curl -i -v
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; "
&gt; http://localhost:8098/solr/is\_solr/select?wt=xml&q=street:Sabinastra%C3%9Fe
&gt; "
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Response:
&gt; &gt;&gt; &gt; 
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; 
&gt; &gt;&gt; &gt; 
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; Sabinastraße
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; 
&gt; &gt;&gt; &gt; 
&gt; &gt;&gt; &gt; 
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; wich is also correct.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; But in case the format of the output is JSON:
&gt; &gt;&gt; &gt; curl -i -v
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; "
&gt; http://localhost:8098/solr/is\_solr/select?wt=json&q=street:Sabinastra%C3%9Fe
&gt; "
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; result looks differently:
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt; "street":"Sabinastra\u00dfe"
&gt; &gt;&gt; &gt; ...
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Why is the JSON response looks differently then XML?
&gt; &gt;&gt; &gt; Is it an expected output or I'm doing something wrong?
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Thanks in advance!
&gt; &gt;&gt; &gt; Vladimir
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt;&gt; &gt; riak-users mailing list
&gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;&gt; &gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; --
&gt; &gt;&gt; Med Vennlig Hilsen
&gt; &gt;&gt; Olav Frengstad
&gt; &gt;&gt;
&gt; &gt;&gt; Systemutvikler // FWT
&gt; &gt;&gt; +47 920 42 090
&gt; &gt;
&gt; &gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Med Vennlig Hilsen
&gt; Olav Frengstad
&gt;
&gt; Systemutvikler // FWT
&gt; +47 920 42 090
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

