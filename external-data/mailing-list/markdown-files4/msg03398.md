---
title: "Re: Issues with capacity planning pages on wiki"
description: ""
project: community
lastmod: 2011-05-24T14:48:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03398"
mailinglist_parent_id: "msg03394"
author_name: "Anthony Molinaro"
project_section: "mailinglistitem"
sent_date: 2011-05-24T14:48:45-07:00
---


Just curious if anyone has any ideas, for the moment, I'm just taking
the RAM calculation and multiplying by 2 and the Disk calculation and
multiplying by 8, based on my findings with my current cluster. But
I would like to know why my values are so much higher than those I should
be getting.

Also, I'd still like to know how the forms calculate things as the disk
calculation there does not match reality or the formula.

Also, waiting to hear if there is any way to force merge to run so I can
more accurately gauge whether multiple copies are effecting disk usage.

Thanks,

-Anthony

On Mon, May 23, 2011 at 11:06:31PM -0700, Anthony Molinaro wrote:
&gt; 
&gt; On Mon, May 23, 2011 at 10:53:29PM -0700, Anthony Molinaro wrote:
&gt; &gt; 
&gt; &gt; On Mon, May 23, 2011 at 09:57:25PM -0600, David Smith wrote:
&gt; &gt; &gt; On Mon, May 23, 2011 at 9:39 PM, Anthony Molinaro
&gt; &gt; &gt; Thus, depending on
&gt; &gt; &gt; your merge triggers, more space can be used than is strictly necessary
&gt; &gt; &gt; to store the data.
&gt; &gt; 
&gt; &gt; So the lack of any overhead in the calculation is expected? I mean
&gt; &gt; according to http://wiki.basho.com/Cluster-Capacity-Planning.html
&gt; &gt; 
&gt; &gt; Disk = Estimated Total Objects \* Average Object Size \* n\_val
&gt; &gt; 
&gt; &gt; Which just seems wrong, doesn't it? I don't quite understand the
&gt; &gt; bitcask code well enough yet to see what the actual data it stores is,
&gt; &gt; but the whitepaper suggested several things were involved in the on
&gt; &gt; disk representation.
&gt; 
&gt; Okay, finally found the code for this part, I kept looking in the nif
&gt; but that's only the keydir, not the data files. It looks like
&gt; 
&gt; %% Setup io\_list for writing -- avoid merging binaries if we can help it
&gt; Bytes0 = [&lt;&gt;, &lt;&gt;,
&gt; &lt;&gt;, Key, Value],
&gt; Bytes = [&lt;&lt;(erlang:crc32(Bytes0)):?CRCSIZEFIELD&gt;&gt; | Bytes0],
&gt; 
&gt; And looking at the header, it seems that there's 14 bytes of overhead
&gt; (4 for CRC, 4 for timestamp, 2 for keysize, 4 for valsize).
&gt; 
&gt; So disk calculation should be
&gt; 
&gt; ( 14 + Key + Value ) \* Num Entries \* N\_Val
&gt; 
&gt; So using my numbers from before that gives
&gt; 
&gt; ( 14 + 36 + 36 ) \* 183915891 \* 3 = 47450299878 = 44.1 GB
&gt; 
&gt; which actually isn't much closer to 341 GB than the previous calculation :(
&gt; 
&gt; So all my questions from the previous email still apply.
&gt; 
&gt; -Anthony
&gt; 
&gt; -- 
&gt; ------------------------------------------------------------------------
&gt; Anthony Molinaro 

-- 
------------------------------------------------------------------------
Anthony Molinaro 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

