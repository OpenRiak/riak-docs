---
title: "Re: CorrugatedIron call to delete a bucket."
description: ""
project: community
lastmod: 2013-02-06T07:15:27-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10018"
mailinglist_parent_id: "msg10016"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-02-06T07:15:27-08:00
---


There is no LevelDB to learn - it's a C++ API. It's like MyISAM vs InnoDB
vs whatever TokuTek are selling these days. LevelDB is just one possible
storage backend for Riak

To use secondary indices, you'd switch your Riak backend to LevelDB in the
erlang app.config - see
http://docs.basho.com/riak/latest/tutorials/choosing-a-backend/LevelDB/.

To keep the delete activity localized to the server, you'll want to use
Erlang + MapReduce jobs. This is equivalent to a stored procedure that runs
DELETE FROM table;

If you want to perform a delete from CorrugatedIron, you'll be doing the
equivalent of creating a cursor that streams rows back to the client which
then issues a delete.

There are some portions of Riak where the learning curve is steep - bulk
data operations with Erlang is one of them.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Wed, Feb 6, 2013 at 7:07 AM, Kevin Burton wrote:

&gt; So it sounds like if there is the possibility of deleting buckets I need
&gt; to learn LevelDB or Erlang. It sounds like you are leaning towards the
&gt; former.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*From:\* Jeremiah Peschka [mailto:jeremiah.pesc...@gmail.com]
&gt; \*Sent:\* Wednesday, February 06, 2013 8:56 AM
&gt; \*To:\* Kevin Burton; riak-users@lists.basho.com
&gt; \*Subject:\* Re: CorrugatedIron call to delete a bucket.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Don't be too put out - deleting a bucket is the sad panda story of Riak.
&gt; We provide the DeleteBucket() method largely for our own selfish purposes
&gt; of cleaning up after unit tests.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; 2i is a secondary index. If you've set up Riak to use the LevelDB back
&gt; end, you can create secondary indices. There is a $keys index that just
&gt; lists the names of the keys in a bucket. By using secondary indices, you
&gt; can stream the $keys index back to CorrugatedIron and then issue async
&gt; deletes on chunks of keys.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; The Erlang way is a bit more complex - it requires knowing Erlang. In
&gt; theory, you can write several Erlang functions that will perform a
&gt; MapReduce across your bucket (or even the secondary index) and delete keys.
&gt; The upside of using Erlang + MapReduce to do it is that you won't have to
&gt; round trip between Riak and your client. The downside is that you have to
&gt; learn Erlang. ;)\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; ---\*\*\*\*
&gt;
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\*\*\*\*
&gt;
&gt; MCITP: SQL Server 2008, MVP\*\*\*\*
&gt;
&gt; Cloudera Certified Developer for Apache Hadoop\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Wed, Feb 6, 2013 at 4:56 AM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; Sorry. Being a beginner I am not aware of "alternative" methods. I have
&gt; not read enough to use Erlang. I don't know what "querying a 2i" is. I also
&gt; wasn't aware that I needed to manage my keys. Perhaps this question could
&gt; turn into a kind of poll for best practices? All suggestions are greatly
&gt; appreciated.\*\*\*\*
&gt;
&gt;
&gt; On Feb 6, 2013, at 6:44 AM, OJ Reeves  wrote:\*\*\*\*
&gt;
&gt; Kevin,\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; No I'm not saying that bucket's can't be deleted. I'm saying that you
&gt; should choose an alternative method. For example, manage your keys in
&gt; another way perhaps by querying a 2i and using the result to delete the
&gt; values. This could be done via an Erlang map reduce job. You could store
&gt; the keys elsewhere for later retrieval then delete each object via the key.
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; The problem here isn't deleting buckets, the problem is listing keys. I do
&gt; think that other Riak users, Basho people in particular, would be better
&gt; positioned to offer alternative approaches than me.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; OJ\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Wed, Feb 6, 2013 at 10:37 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; I see the warning and I would love to heed it. You are saying buckets can
&gt; never be deleted? Rename has the same problem?\*\*\*\*
&gt;
&gt;
&gt; On Feb 6, 2013, at 6:15 AM, OJ Reeves  wrote:\*\*\*\*
&gt;
&gt; Deleting a bucket takes forever in any Riak client if the bucket has a lot
&gt; of values in it. This is because a bucket isn't an object that is any way
&gt; analogous to a "table" like you'd see in an RDBMS and to delete a bucket
&gt; the keys in that bucket need to be listed first (please correct me if I'm
&gt; wrong people!). This operation is known to be slow and using it is not
&gt; recommended.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; CorrugatedIron outputs warning messages to the debug console whenever
&gt; ListKeys or DeleteBucket are called. I'd recommend heeding those warnings
&gt; and look to take a different approach.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; OJ\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Wed, Feb 6, 2013 at 8:11 AM, Jeremiah Peschka &lt;
&gt; jeremiah.pesc...@gmail.com&gt; wrote:\*\*\*\*
&gt;
&gt; No.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Deleting a bucket requires deleting all keys in the bucket. It will be
&gt; slow.\*\*\*\*
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; ---\*\*\*\*
&gt;
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\*\*\*\*
&gt;
&gt; MCITP: SQL Server 2008, MVP\*\*\*\*
&gt;
&gt; Cloudera Certified Developer for Apache Hadoop\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Tue, Feb 5, 2013 at 1:58 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; I am trying to remove a bucket. So I call client.DeleteBucket()
&gt; but this takes \*\*forever\*\*. Is there a faster way to simply remove a
&gt; bucket?\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; --
&gt;
&gt; OJ Reeves\*\*\*\*
&gt;
&gt; +61 431 952 586
&gt; http://buffered.io/\*\*\*\*
&gt;
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; --
&gt;
&gt; OJ Reeves\*\*\*\*
&gt;
&gt; +61 431 952 586
&gt; http://buffered.io/\*\*\*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

