---
title: "Re: No results provided by Riak search, another !"
description: ""
project: community
lastmod: 2011-07-05T09:27:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03930"
mailinglist_parent_id: "msg03928"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-07-05T09:27:45-07:00
---


Hi Germain,

It looks like your document has nested fields which means the schema you
have defined won't match the fields produced by the pre-commit hook. The
pre-commit hook flattens JSON documents using an underscore ("\_") between
nested fields (e.g. fans\_\*\*data\_nsid); your schema should be using the
flattened field name.

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Tue, Jul 5, 2011 at 7:05 AM, Germain Maurice &lt;
germain.maur...@linkfluence.net&gt; wrote:

&gt; Hello everybody,
&gt;
&gt; I have a problem with Riak Search. I tried to find the solution by my own,
&gt; i tried all the solutions i found and no results.
&gt;
&gt; Firstly, i tried to use it with the default schema, it works but it indexes
&gt; too much data.
&gt; So, i set my own schema as this :
&gt; {
&gt; schema,
&gt; [
&gt; {version, "1.1"},
&gt; {n\_val, 1},
&gt; {default\_field, "nsid"},
&gt; {analyzer\_factory, {erlang, text\_analyzers,
&gt; standard\_analyzer\_factory}}
&gt; ],
&gt; [
&gt; {field, [
&gt; {name, "favedate"},
&gt; {type, string},
&gt; {analyzer\_factory, {erlang, text\_analyzers,
&gt; standard\_analyzer\_factory}}
&gt; ]},
&gt;
&gt; {field, [
&gt; {name, "date\_faved"},
&gt; {type, string},
&gt; {analyzer\_factory, {erlang, text\_analyzers,
&gt; standard\_analyzer\_factory}}
&gt; ]},
&gt;
&gt; %% Everything else is skipped
&gt; {dynamic\_field, [
&gt; {name, "\*"},
&gt; {skip, true}
&gt; ]}
&gt; ]
&gt; }.
&gt;
&gt; Hook on precommit of my buckets are ok.
&gt; I set the schema for each of my buckets as this : "search-cmd set-schema
&gt; photostest My.schema"
&gt; Did a "search-cmd clear-schema-cache" command.
&gt;
&gt; I re-indexed all of my documents of the bucket however, these documents are
&gt; not indexed.
&gt; An example :
&gt;
&gt; { "fans":{
&gt; "data":[{"nsid":"83786678@N00"\*\*,
&gt; "favedate":"1309539453"}
&gt; ,{"nsid":"33233619@N02",
&gt; "favedate":"1309539169"}]
&gt; , ...
&gt; Here is the answer of the index :
&gt; {"responseHeader":{"status":0,\*\*"QTime":2,"params":{"q":"fans\_\*\*
&gt; data\_nsid:83786678@N00","q.op"\*\*:"or","filter":"","wt":"
&gt; json"}},"response":{"numFound"\*\*:0,"start":0,"maxScore":"0.0",\*\*
&gt; "docs":[]}}
&gt;
&gt;
&gt; thank you !
&gt;
&gt; --
&gt; Germain Maurice
&gt; Administrateur Système/Réseau
&gt; Tel : +33.(0)1.42.43.54.33
&gt;
&gt; http://www.linkfluence.net
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

