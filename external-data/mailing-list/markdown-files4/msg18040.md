---
title: "Re: Issue with yokozuna_extractor_map (riak 2.1.1)"
description: ""
project: community
lastmod: 2017-02-28T08:48:10-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18040"
mailinglist_parent_id: "msg18036"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2017-02-28T08:48:10-08:00
---


Hi Simon -

Did you copy the .beam file for your custom extractor to a directory
in the Erlang VM's code path?

If you run "pgrep -a beam.smp" you'll see an argument to beam.smp like this:

-pa /home/lbakken/Projects/basho/riak\_ee-2.1.1/rel/riak/bin/../lib/basho-patches

On my machine, that adds the
"/home/lbakken/Projects/basho/riak\_ee-2.1.1/rel/riak/lib/basho-patches"
directory to the code path. You will see something that starts with
"/usr/lib/riak/.." or "/usr/lib64/riak/..." in your environment.

You must copy the .beam file to the "basho-patches" directory, and
re-start Riak. Then your extractor code will be found.

--
Luke Bakken
Engineer
lbak...@basho.com

On Tue, Feb 28, 2017 at 3:54 AM, Simon Jaspar
 wrote:
&gt; Hi,
&gt;
&gt; I’m currently experimenting with riak 2.1.1 for a project. I recently ran
&gt; into some trouble with yokozuna trying to register a custom extractor.
&gt;
&gt; I’m not sure how I ended up in that situation, but I’m currently stuck with
&gt; my cluster's yokozuna\_extractor\_map equal to the atom ignore…
&gt;
&gt; I remember having the default extractor map there, before I try to register
&gt; a custom extractor (following basho documentation
&gt; https://docs.basho.com/riak/kv/2.2.0/developing/usage/custom-extractors/ ),
&gt; and end up here.
&gt;
&gt; While attached to one of my riak's node, running yz\_extractor:get\_map().
&gt; returns ignore.
&gt;
&gt; And trying to register a new extractor
&gt; yz\_extractor:register("custom\_extractor",yz\_noop\_extractor). returns
&gt; already\_registered , with this in my logs :
&gt;
&gt; 2017-02-28 11:41:39.265 [error]
&gt; &lt;0.180.0&gt;@riak\_core\_ring\_manager:handle\_call:406 ring\_trans: invalid return
&gt; value:
&gt; {'EXIT',{function\_clause,[{orddict,find,["custom\_extractor",ignore],[{file,"orddict.erl"},{line,80}]},{yz\_extractor,get\_def,3,[{file,"src/yz\_extractor.erl"},{line,67}]},{yz\_extractor,register\_map,2,[{file,"src/yz\_extractor.erl"},{line,138}]},{yz\_misc,set\_ring\_trans,2,[{file,"src/yz\_misc.erl"},{line,302}]},{riak\_core\_ring\_manager,handle\_call,3,[{file,"src/riak\_core\_ring\_manager.erl"},{line,389}]},{gen\_server,handle\_msg,5,[{file,"gen\_server.erl"},{line,585}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,239}]}]}}
&gt;
&gt; I have been trying to bypass that issue by reseting the extractor map to its
&gt; default value using lower level functions from yokozuna source code, but
&gt; with no success.
&gt;
&gt; If anyone has any idea or solution that’d be great !
&gt;
&gt; Thanks in advance for your help.
&gt;
&gt; Best,
&gt; Simon JASPAR
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

