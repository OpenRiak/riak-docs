---
title: "Re: Differing results from same index query"
description: ""
project: community
lastmod: 2011-12-23T07:14:28-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06053"
mailinglist_parent_id: "msg06035"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2011-12-23T07:14:28-08:00
---


Hi Jeremy,

Yes, riak-admin backup reads all data, iterating through each vnode, to
create the backup file. To restore, it performs a normal put operation for
each object.

Can you run 'du -k' within the ./data/eleveldb directory on your dev node.
This will list the size of each vnode directory. I'd like to check that
each vnode has data in it, and that the vnodes are roughly the same size.
(There will be some variation due to how LevelDB compacts data, of course.)

Also, have you changed any of the default bucket settings in production or
on your dev machine? Is there anything that is different from the defaults?

Best,
Rusty

On Thu, Dec 22, 2011 at 9:18 AM, Jeremy Raymond  wrote:

&gt; I ran the queries against the production cluster and could not reproduce
&gt; the issue (\*whew\*). It gave me consistent correct results for the repeated
&gt; queries.
&gt;
&gt; The main difference I see is that the data on the prod cluster is written
&gt; directly to Riak and on the dev machine it is restored data. Do the
&gt; riak-admin backup/restore commands do more than read all the objects out of
&gt; riak, serialize them to disk, and then write them back via normal put
&gt; operations when restoring?
&gt;
&gt; --
&gt; Jeremy
&gt;
&gt;
&gt;
&gt; On Thu, Dec 22, 2011 at 8:24 AM, Jeremy Raymond wrote:
&gt;
&gt;&gt; The output from the commands all look normal (just running a single
&gt;&gt; node). I'm going to see if I can reproduce this outside of this setup.
&gt;&gt;
&gt;&gt; $ bin/riak-admin ringready
&gt;&gt; TRUE All nodes agree on the ring ['dev1@127.0.0.1']
&gt;&gt; $ bin/riak-admin transfers
&gt;&gt; No transfers active
&gt;&gt; $ bin/riak-admin member\_status
&gt;&gt; ================================= Membership
&gt;&gt; ==================================
&gt;&gt; Status Ring Pending Node
&gt;&gt;
&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt; valid 100.0% -- 'dev1@127.0.0.1'
&gt;&gt;
&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt; Valid:1 / Leaving:0 / Exiting:0 / Joining:0 / Down:0
&gt;&gt; $ bin/riak-admin ring\_status
&gt;&gt; ================================== Claimant
&gt;&gt; ===================================
&gt;&gt; Claimant: 'dev1@127.0.0.1'
&gt;&gt; Status: up
&gt;&gt; Ring Ready: true
&gt;&gt;
&gt;&gt; ============================== Ownership Handoff
&gt;&gt; ==============================
&gt;&gt; No pending changes.
&gt;&gt;
&gt;&gt; ============================== Unreachable Nodes
&gt;&gt; ==============================
&gt;&gt; All nodes are up and reachable
&gt;&gt;
&gt;&gt; --
&gt;&gt; Jeremy
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Dec 21, 2011 at 7:33 PM, Rusty Klophaus  wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Jeremy,
&gt;&gt;&gt;
&gt;&gt;&gt; That is strange. Can you try running "bin/riak-admin ringready",
&gt;&gt;&gt; "bin/riak-admin transfers", "bin/riak-admin member\_status", and
&gt;&gt;&gt; "bin/riak-admin ring\_status"? Does everything look normal?
&gt;&gt;&gt;
&gt;&gt;&gt; Also, if possible, a zip file of your ./data directory would help us
&gt;&gt;&gt; immensely while troubleshooting. (Feel free to email the link to me off
&gt;&gt;&gt; list.)
&gt;&gt;&gt;
&gt;&gt;&gt; Best,
&gt;&gt;&gt; Rusty
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Dec 21, 2011 at 12:32 PM, Jeremy Raymond wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I'm seeing an issue where running the same index query multiple times
&gt;&gt;&gt;&gt; against an unchanging set of data returns a differing numbers of items.
&gt;&gt;&gt;&gt; Riak error and crash logs are empty.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've seen this on my dev machine (haven't noticed it in production, but
&gt;&gt;&gt;&gt; it could be happening). The production cluster is running Riak 1.0.2 and my
&gt;&gt;&gt;&gt; dev machine is running 1.0 (96d0b8011 from Oct 6) compiled from source. The
&gt;&gt;&gt;&gt; data on my dev machine is an import of the data from production (via
&gt;&gt;&gt;&gt; riak-admin backup/restore).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Anyone seen this issue? Help on debugging the cause appreciated.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Jeremy
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Rusty Klophaus (@rustyio)
&gt;&gt;&gt; \*Basho Technologies, Inc.\*
&gt;&gt;&gt; www.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;


-- 
Rusty Klophaus (@rustyio)
\*Basho Technologies, Inc.\*
www.basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

