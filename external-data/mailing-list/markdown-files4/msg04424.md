---
title: "Re: Map Reduce Requirements"
description: ""
project: community
lastmod: 2011-08-23T08:12:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04424"
mailinglist_parent_id: "msg04419"
author_name: "Brian Rowe"
project_section: "mailinglistitem"
sent_date: 2011-08-23T08:12:46-07:00
---


I'm a little late to the party, but the way I've been handling
marshaling is using an explicit map/reduce phase to perform the
marshaling and/or data massaging. You can chain map phases together by
using the special bucket/key pair {none,none} and passing the
intermediate data via the KeyData. This also makes the phases more
portable if you wish to re-use them in other situations. I wrote a
blog post about chaining phases a while back, which might be useful:
http://cartesianfaith.wordpress.com/2011/07/27/mapreduce-tips-and-tricks-in-riak/

HTH,
Brian


On Tue, Aug 23, 2011 at 10:01 AM, Jeremiah Peschka
 wrote:
&gt; On Aug 22, 2011, at 8:50 PM, bill robertson wrote:
&gt;
&gt;&gt; I wonder if it would be feasible to deploy an erlang web-service in the riak 
&gt;&gt; node's webmachine instance that could translate meta-data into Erlang funs 
&gt;&gt; and drive the map reduce operation that way. I'm not sure if I could get 
&gt;&gt; around having specific knowledge of the protobuf structures baked into that 
&gt;&gt; code, but I don't think it matters in this case.
&gt;&gt;
&gt;&gt; I also wonder how much 1.0 will change this picture.
&gt;&gt;
&gt;&gt; &gt; Additionally, are secondary indexes meta-data?  i.e. If I built some 
&gt;&gt; &gt; secondary indices, these are stored in some form internal to Riak, and 
&gt;&gt; &gt; therefore available for query regardless of the type of data its 
&gt;&gt; &gt; associated with. Is this correct?
&gt;&gt;
&gt;&gt; Secondary indexes are a separate physical structure, or so I gather. (Rusty 
&gt;&gt; could be full of lies.) They're stored separately from the initial data and 
&gt;&gt; not as metadata in the object headers. So, yes, you can store whatever you 
&gt;&gt; want in secondary indexes and query it however you want, provided there's an 
&gt;&gt; API that supports what you're doing.
&gt;&gt;
&gt;&gt; Would secondary indexes eliminate the need for key-filtering? Logically, it 
&gt;&gt; would seem that you could do with indexes, but do they have similar 
&gt;&gt; performance characteristics?  (i.e. does one suck more than the other?)
&gt;
&gt; Key filters will always perform a list-keys operation. Meaning that they 
&gt; result in an in memory scan of all keys in the key space.
&gt;
&gt; Not knowing entirely how indexes are implemented internally (reading the 
&gt; source is on my TO DO list), I can only guess from my experience with other 
&gt; databases how this would work. Indexes generally work best when you have a 
&gt; low search cardinality - when you're seeking only a few records from the 
&gt; index. As long as you can structure secondary indexes to answer the questions 
&gt; you're asking, then indexes make it easy to perform fast queries.
&gt;
&gt; The difference comes in based on your storage mechanism. With bitcask, all 
&gt; keys are in memory so that list-keys scan only happens between RAM and CPU 
&gt; and isn't THAT expensive of an operation. If indexes are not a memory 
&gt; resident structure, then a scan of an index (when you're doing a search 
&gt; that's some kind of substring or ends with operation) will be painfully slow 
&gt; - much like when you have to perform a table scan in an RDBMS.
&gt;
&gt; The upside of key filtering, and composite key names in general, is that you 
&gt; can create meaningful keys that you can assemble on the fly. e.g. To get 
&gt; yesterday's trades of Ford stock in the NYSE, (assuming you have a trades 
&gt; bucket) you could get at yesterday's trading history through something like 
&gt; http://my\_riak\_server:8091/riak/trades/NYSE:F:20110822 Being able to perform 
&gt; ad hoc seeks like that is really powerful.
&gt;
&gt; TL;DR - key filters and secondary indexes serve different purposes.
&gt;
&gt;&gt;
&gt;&gt; Thanks again,
&gt;&gt; Bill Robertson
&gt;
&gt;
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
&gt; Microsoft SQL Server MVP
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

