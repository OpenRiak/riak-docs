---
title: "Re: consistency impact on performance"
description: ""
project: community
lastmod: 2014-01-21T11:16:50-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13437"
mailinglist_parent_id: "msg13409"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2014-01-21T11:16:50-08:00
---


Satoshi,

The difference in performance between w=1 and w=3 depends a lot on
your cluster setup and hardware, as well as cluster load.

In your tests, your cluster is most likely under no load, and all
vnodes are ready to process incoming messages. In this case w=1 and
w=3 will have little difference in response time since vnodes will be
able to respond immediately to the write message.

A better test would be to increase cluster load with a tool like
basho\_bench and benchmark Riak and Cassandra using that tool.
--
Luke Bakken
CSE
lbak...@basho.com


On Sun, Jan 19, 2014 at 9:55 PM, Satoshi Yamada  wrote:
&gt; Luke,
&gt;
&gt; Thanks for your reply.
&gt;
&gt; Actually, the size of the data we use for our product is as small as
&gt; hundreds bytes.
&gt; I use such data as 330MB because I thought the difference of performance
&gt; gets clearer by
&gt; storing big data. I did test similarly when the data size is 1MB and 100B,
&gt; but did not
&gt; see much difference either.
&gt;
&gt; thanks,
&gt; Satoshi
&gt;
&gt;
&gt;
&gt;
&gt; 2014/1/20 Luke Bakken 
&gt;&gt;
&gt;&gt; Hi Satoshi,
&gt;&gt;
&gt;&gt; When using Riak, your object sizes should ideally be 1MB or less. A
&gt;&gt; 330MB object will never result in acceptable Riak performance.
&gt;&gt;
&gt;&gt; If you intend to store large objects like this I strongly recommend
&gt;&gt; using Riak CS, which will break up the object for you into chunks that
&gt;&gt; can be managed by Riak. It also provides an S3-compatible API.
&gt;&gt;
&gt;&gt; Please read more about Riak CS here: http://docs.basho.com/riakcs/latest/
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; CSE
&gt;&gt; lbak...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sun, Jan 19, 2014 at 9:29 PM, Satoshi Yamada 
&gt;&gt; wrote:
&gt;&gt; &gt; Hi, i'm Satoshi, new to riak.
&gt;&gt; &gt;
&gt;&gt; &gt; I would like to check how consistency changes impacts on the performance
&gt;&gt; &gt; of
&gt;&gt; &gt; riak cluster. I used w=1 and w=3, and I expected at least two times more
&gt;&gt; &gt; of
&gt;&gt; &gt; execution time, but there seems no significant change. I saw more
&gt;&gt; &gt; difference
&gt;&gt; &gt; in Cassandra, so I wonder if it's normal in riak or there is something
&gt;&gt; &gt; wrong
&gt;&gt; &gt; in my testing. Can anyone give me some advice on it?
&gt;&gt; &gt;
&gt;&gt; &gt; I simply checked as shown below.
&gt;&gt; &gt;
&gt;&gt; &gt; w=1
&gt;&gt; &gt; $ time curl -v -XPUT
&gt;&gt; &gt; http://mycluster.com:8098/buckets/w1/keys/data.tar.gz?w=1 -H
&gt;&gt; &gt; "X-Riak-Vclock:
&gt;&gt; &gt; a85hYGB.........." -H "Content-Type: text/plain" --data-binary
&gt;&gt; &gt; @data.tar.gz
&gt;&gt; &gt; ...
&gt;&gt; &gt; ...
&gt;&gt; &gt; ...
&gt;&gt; &gt; real 0m27.501s
&gt;&gt; &gt; user 0m0.378s
&gt;&gt; &gt; sys 0m0.674s
&gt;&gt; &gt;
&gt;&gt; &gt; w=3
&gt;&gt; &gt; $ time curl -v -XPUT
&gt;&gt; &gt; http://mycluster.com:8098/buckets/w3/keys/data.tar.gz?w=3 -H
&gt;&gt; &gt; "X-Riak-Vclock:
&gt;&gt; &gt; a85hYGB.........." -H "Content-Type: text/plain" --data-binary
&gt;&gt; &gt; @data.tar.gz
&gt;&gt; &gt; ...
&gt;&gt; &gt; ...
&gt;&gt; &gt; ...
&gt;&gt; &gt; real 0m29.278s
&gt;&gt; &gt; user 0m0.398s
&gt;&gt; &gt; sys 0m0.674s
&gt;&gt; &gt;
&gt;&gt; &gt; My cluster consists of 40, all active and healthy machines and running
&gt;&gt; &gt; riak-1.4.1.
&gt;&gt; &gt; The data I use is 330MB.
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks in advance,
&gt;&gt; &gt; Satoshi
&gt;&gt; &gt;
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; &gt;
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

