---
title: "Re: FYI: How to do secondary indexing with Riak behind Nginx"
description: ""
project: community
lastmod: 2011-10-07T14:46:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05101"
mailinglist_parent_id: "msg05099"
author_name: "Jeff Kirkell"
project_section: "mailinglistitem"
sent_date: 2011-10-07T14:46:39-07:00
---


yep, that is the deal with nginx. That said, apparent nginx 1.1.5 had a bug
fix for the ngx\_http\_proxy\_module regarding http/1.1 but I am not sure if
that means it solves the issue or relates to something else.

On Fri, Oct 7, 2011 at 5:14 PM, Jonathan Langevin &lt;
jlange...@loomlearning.com&gt; wrote:

&gt; My understanding is the same as Alexander's. While I love nginx, I'll not
&gt; be using it to proxy Riak until HTTP 1.1 is sorted out.\*
&gt;
&gt; 
&gt; Jonathan Langevin
&gt; Manager, Information Technology
&gt; Loom Inc.
&gt; Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
&gt; www.loomlearning.com - Skype: intel352
&gt; \*
&gt;
&gt;
&gt; On Thu, Oct 6, 2011 at 9:49 AM, Alexander Sicular wrote:
&gt;
&gt;&gt; That aside, I thought there were other reasons for not using nginx in
&gt;&gt; front of riak. Http 1.0 vs http 1.1 support. For that reason I front Riak
&gt;&gt; with haproxy.
&gt;&gt;
&gt;&gt; Thoughts?
&gt;&gt;
&gt;&gt; @siculars
&gt;&gt; http://siculars.posterous.com
&gt;&gt;
&gt;&gt; Sent from my rotary phone.
&gt;&gt; On Oct 6, 2011 9:32 AM, "Mårten Gustafson" 
&gt;&gt; wrote:
&gt;&gt; &gt; Howdy,
&gt;&gt; &gt;
&gt;&gt; &gt; = Background
&gt;&gt; &gt;
&gt;&gt; &gt; During the Riak 1.0 webinar I played around with Nginx and encountered
&gt;&gt; &gt; a problem with secondary indexing when accessing Riak (over HTTP)
&gt;&gt; &gt; through Nginx. I had a quick chat with Sean about it on IRC[1] and
&gt;&gt; &gt; then I forgot it. The problem is that Nginx won't handle header names
&gt;&gt; &gt; with underscores "properly".
&gt;&gt; &gt;
&gt;&gt; &gt; AFAICT it's perfectly legal with underscores in headers according to
&gt;&gt; &gt; RFC 2616[2], I also found a discussion on StackOverflow[3] that came
&gt;&gt; &gt; to the same conclusion.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; = Solution
&gt;&gt; &gt;
&gt;&gt; &gt; In your nginx.conf in the relevant server-section add the following:
&gt;&gt; &gt; underscores\_in\_headers on;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; /mårten.
&gt;&gt; &gt;
&gt;&gt; &gt; [1] http://irclogger.com/.riak/2011-09-21 @ 14:33
&gt;&gt; &gt; [2] http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2
&gt;&gt; &gt; [3]
&gt;&gt; http://stackoverflow.com/questions/964519/php-http-post-incorrect-headers
&gt;&gt; &gt;
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

