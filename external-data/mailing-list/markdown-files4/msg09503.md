---
title: "Re: Synchronous Writes to Remote Cluster"
description: ""
project: community
lastmod: 2012-12-10T09:10:17-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09503"
mailinglist_parent_id: "msg09500"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2012-12-10T09:10:17-08:00
---


Hey Ben,

I'm not aware of any off-the-shelf tool that does exactly what you're looking 
for. Riak's multi-dc replication
is not synchronous (naive synchronous replication \_reduces\_ availability). In 
order to have synchronous multi-dc
replication that doesn't decrease availability, you'd need to do some kind of 
multi-dc coordination with at least
3 data centers. Neither Riak nor Riak CS support this at the moment. It is also 
worth noting that Riak's replication
is not 'done passively'. Real-time replication is done on every update, and 
then there is a daemon process
called full-sync that runs to synchronize any lost realtime updates.

More comments inline:

On Dec 10, 2012, at 11:20 AM, Ben Rowland  wrote:

&gt; Hi,
&gt; 
&gt; We're building a distributed storage API, which must be highly available 
&gt; across several globally distant data-centres. 
&gt; 
&gt; A specific requirement is that a user of the API must see a write as 
&gt; successful iff the data has been successfully written to a node in at least 2 
&gt; data-centres. This is to avoid the case where one data-centre becomes 
&gt; unavailable a short time after being written to, e.g. due to a net-split or 
&gt; power outage. 
&gt; 
&gt; I understand there is multi data-centre support in Riak CS, but I believe 
&gt; Real-Time Sync is done passively (on next read) and this leaves a loop-hole 
&gt; where the cluster written to could immediately go off-line.

nope, updates are replicated to the other data centers right away

&gt; 
&gt; In theory, we could meet our requirement by having 2 physical nodes in each 
&gt; cluster (DC), and using a N-value of 3. This would force writes to go to 
&gt; nodes in at least 2 clusters. Are there any particular reasons against this? 
&gt; I realise there will be a problem with latency but couldn't we just increase 
&gt; connection time-outs? I also suspect SSL wouldn't be supported when writing 
&gt; within a cluster which would be an issue.

Running a \_single\_ Riak cluster across multiple data centers is possible, but 
not something we ever test, optimize
or recommend. If you \_really\_ need a \_guarantee\_ that data has been written to 
at least two DCs, 

&gt; 
&gt; Is Riak CS the right tool to meet these requirements?

Riak CS has the same multi-dc replication semantics as Riak, with the addition 
of something called 'proxy-get', which allows objects
to be fetched from a remote cluster if they haven't been written locally yet.

&gt; 
&gt; If it helps, our use-case is perhaps simpler than many in that all objects 
&gt; are write-once. So we don't need to worry about things like split-brain, 
&gt; just adequate replication.

Immutability will definitely make your life easier, though it's not a silver 
bullet for solving the 'synchronous replication w/out lowering availability' 
problem.

&gt; 
&gt; Many thanks,
&gt; 
&gt; Ben
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

