---
title: "Re: Riak secondary indexing 'Unknown field type for field' error"
description: ""
project: community
lastmod: 2012-10-24T14:59:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09049"
mailinglist_parent_id: "msg09030"
author_name: "Hrishikesh More"
project_section: "mailinglistitem"
sent_date: 2012-10-24T14:59:44-07:00
---


Hi Brian,

 I got this problem fixed as there was a special character in index
name.

 I have some follow-up queries related to secondary indexing:
1. I stored IRiakObject ( with RiakIndexes) using RiakBucket (Strongly
typed for IRiakObject) . Secondary indexes are created and object is stored
perfectly. However, the store operation returns 'null' IRiakObject. Is
there a way to get ETag or VTag of stored object through HttpResponseHeader
(while using RiakBucket and without querying again)?

2. In order to get proper http response I used RiakClient (instead of
RiakBucket.store ), where I performed same 'store' operation with secondary
indexes. I got the same error i.e. 'Unknown field type for field: 'login''.
If I do store without secondary indexes (commenting out 'indexes.add'
lines), it works fine. I want to store json string (which is available
from client) without any converter. While storing json string I want to
store secondary indexes (which is also provided by client).

 Is this error related to 'prefix' used in creating RiakClient?

 The code snippet :

 StandardHttpRequestRetryHandler retryHandler = new
StandardHttpRequestRetryHandler(3, false);

 /\* create RiakConfig \*/
 RiakConfig config = new RiakConfig("192.168.21.202",
"8098", "/riak");
 config.setMaxConnections(500);
 config.setTimeout(5000);
 config.setRetryHandler(retryHandler);

 /\* create http client for riak \*/
 RiakClient riakClient = new RiakClient(config);


List indexes = new ArrayList();
 indexes.add(new BinIndex("login","m...@domain.com"));
 indexes.add(new IntIndex("quantity",77));


 RiakObject riakObject = new RiakObject(riakClient,
 "test",
 id, json.getBytes(),
 "application/json",
 null, null, null, null,
null, indexes);


 StoreResponse response = riakClient.store(riakObject);
 if (response.isSuccess()) {
 retval = response.getVtag();
 } else {
 int statusCode = response.getStatusCode();
 String errMsg = "Error while storing id : " + id + " status
code : " + statusCode;
 logger.error(errMsg);
 throw new xxxxException(errMsg);
 }

thanks!

On Wed, Oct 24, 2012 at 3:49 AM, Brian Roach  wrote:

&gt; Without knowing exactly what you're doing, it's hard to tell. When
&gt; you're using an IRiakObject with StoreObject.store() without
&gt; specifying a Converter, there's not any JSON
&gt; serialization/deserialization occurring. It's simply storing whatever
&gt; you pass to withValue() in Riak.
&gt;
&gt; If you can provide a short compilable example that exhibits the
&gt; behavior you're describing, I'll be happy to look into it.
&gt;
&gt; Thanks!
&gt; Brian Roach
&gt;
&gt; On Tue, Oct 23, 2012 at 3:08 PM, Hrishikesh More
&gt;  wrote:
&gt; &gt; Index preparation works but storing the JSON is not working. It complains
&gt; &gt; about 'sku1' (which is a 'object' type).
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Oct 24, 2012 at 2:33 AM, Hrishikesh More
&gt; &gt;  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; I have config with list of attributes and their types (e.g. string,
&gt; &gt;&gt; integer, boolean). Based on attribute I appropriately put it in
&gt; RiakIndexes
&gt; &gt;&gt; object. It works if I do it with simple (non nested) JSON.
&gt; &gt;&gt;
&gt; &gt;&gt; e.g.
&gt; &gt;&gt; if (attrType.equals("String")) {
&gt; &gt;&gt; riakIndexes.add(fieldName, parser.getText()); ==&gt;
&gt; &gt;&gt; parser is JsonParser
&gt; &gt;&gt; }
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; On Wed, Oct 24, 2012 at 2:27 AM, Brian Roach  wrote:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; How, exactly, are you creating 'indexes' ?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; A secondary index in Riak has to be an integer or a string.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Thanks,
&gt; &gt;&gt;&gt; Brian Roach
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; On Tue, Oct 23, 2012 at 2:42 PM, Hrishikesh More
&gt; &gt;&gt;&gt;  wrote:
&gt; &gt;&gt;&gt; &gt; Hi,
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; Using following JSON I am trying to create secondary indexes in
&gt; &gt;&gt;&gt; &gt; Riak.
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; {
&gt; &gt;&gt;&gt; &gt; “Id” : “xxxx”,
&gt; &gt;&gt;&gt; &gt; “login” : “xxx”,
&gt; &gt;&gt;&gt; &gt; “context” : “xxx”,
&gt; &gt;&gt;&gt; &gt; “creationDate” : “xxxx”,
&gt; &gt;&gt;&gt; &gt; ...........
&gt; &gt;&gt;&gt; &gt; ...........
&gt; &gt;&gt;&gt; &gt; “sku1” : {
&gt; &gt;&gt;&gt; &gt; quantity : 1,
&gt; &gt;&gt;&gt; &gt; },
&gt; &gt;&gt;&gt; &gt; “sku2” : {
&gt; &gt;&gt;&gt; &gt; quantity : 2,
&gt; &gt;&gt;&gt; &gt; },
&gt; &gt;&gt;&gt; &gt; }
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; I prepare RiakIndexes by using above JSON and looping over it.
&gt; When
&gt; &gt;&gt;&gt; &gt; I try
&gt; &gt;&gt;&gt; &gt; to store (the same json string) it in following way I get 'Unknown
&gt; &gt;&gt;&gt; &gt; field
&gt; &gt;&gt;&gt; &gt; type for field: 'sku1' error.
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; IRiakObject riakObj = RiakObjectBuilder.newBuilder(bucketName, id)
&gt; &gt;&gt;&gt; &gt; .withIndexes(indexes)
&gt; &gt;&gt;&gt; &gt; .withValue(json)
&gt; &gt;&gt;&gt; &gt; .withContentType('application/json')
&gt; &gt;&gt;&gt; &gt; .build();
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; IRiakObject returnObject = bucket.store(riakObj);
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; Error:
&gt; &gt;&gt;&gt; &gt; com.basho.riak.client.http.response.RiakResponseRuntimeException:
&gt; &gt;&gt;&gt; &gt; Unknown field type for field: 'sku1'.
&gt; &gt;&gt;&gt; &gt; Unknown field type for field: 'sku2'.
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; 1. If I don't define nested JSON it works, however it I put 'skuid'
&gt; &gt;&gt;&gt; &gt; using
&gt; &gt;&gt;&gt; &gt; objectMapper.createObjectNode() and add to parent object node (while
&gt; &gt;&gt;&gt; &gt; preparing JSON for testing), it gives above error.
&gt; &gt;&gt;&gt; &gt; Do I have to write custom serializer here?
&gt; &gt;&gt;&gt; &gt; 2. Is there a way to ignore this error through config in Riak?
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; thanx.
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt;&gt;&gt; &gt; riak-users mailing list
&gt; &gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt; &gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;&gt;&gt; &gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

