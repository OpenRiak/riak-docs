---
title: "Re: configuration problem: riak.conf being ignored"
description: ""
project: community
lastmod: 2014-04-25T09:04:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14134"
mailinglist_parent_id: "msg14133"
author_name: "Joe DeVivo"
project_section: "mailinglistitem"
sent_date: 2014-04-25T09:04:11-07:00
---


It’s no coincidence that these are the two settings that have changed how 
they’re set between Erlang R15 and R16, but that’s not the whole story.

It looks like ERL\_MAX\_PORTS and ERL\_MAX\_ETS\_TABLES are both still valid 
environment variables in R16+.  If you use their R16 counterparts (+Q and +e), 
those values are used, but if you don’t, the -env variables are used instead.

Cuttlefish currently uses +Q and +e; however the code that displays those log 
messages is written to inspect the environment variables only. Here’s a link to 
that code, if you’re curious: 
https://github.com/basho/riak\_kv/blob/2.0.0beta1/src/riak\_kv\_env.erl#L139-L164

The fix for this w.r.t to max\_ports is easy, just change it to 
system\_info(port\_limit). The problem is max\_ets\_tables, which needs 
system\_info(ets\_limit) which wasn’t introduced until Erlang R16B03. Riak 2.0 is 
shipping with Erlang R16B02, but with a couple of backported patches from later 
versions of Erlang. 

Currently we’re hoping to backport the system\_info(ets\_limit) fix, and then 
modify the code linked above accordingly.

Thanks for your help in identifying this issue.

—joe

On April 25, 2014 at 5:32:20 AM, Sean Allen (s...@monkeysnatchbanana.com) wrote:

Setting ERL\_MAX\_PORTS and ERL\_MAX\_ETS\_TABLES did have an effect.


On Fri, Apr 25, 2014 at 5:47 AM, Sean Allen  wrote:
More on this looking at the command line that started it,

did/does pre-20 erlang not pick up the vm options correctly?

/usr/lib64/riak/erts-5.10.3/bin/beam.smp -P 256000 -e 262144 -Q 65536 -A 64 -K 
true -W w -- -root /usr/lib64/riak -progname riak -- -home /opt/riak -- -boot 
/usr/lib64/riak/releases/2.0.0pre20/riak -config 
/var/lib/riak/generated.configs/app.2014.04.24.19.12.05.config -setcookie riak 
-name \*\*\*\*\* -smp enable -vm\_args 
/var/lib/riak/generated.configs/vm.2014.04.24.19.12.05.args -pa 
/usr/lib64/riak/lib/basho-patches -- console

(hostname removed in the above)



On Fri, Apr 25, 2014 at 5:40 AM, Sean Allen  wrote:
riak-2 

we have the following in /etc/riak/riak.conf


erlang.max\_ports = 65536
erlang.max\_ets\_tables = 262144

however i get the following on startup:

2014-04-24 19:12:09.697 [warning] &lt;0.799.0&gt; riak\_kv\_env: Erlang ports limit of 
1024 is low, at least 64000 is recommended
2014-04-24 19:12:09.698 [warning] &lt;0.799.0&gt; riak\_kv\_env: ETS table count limit 
of 1400 is low, at least 256000 is recommended.

So it appears that riak.conf isn't actually being used. Pointers?


--

Ce n'est pas une signature



--

Ce n'est pas une signature



--

Ce n'est pas une signature
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ 
riak-users mailing list 
riak-users@lists.basho.com 
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com 
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

