---
title: "Re: Measuring Riak disk usage"
description: ""
project: community
lastmod: 2013-04-10T06:23:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10819"
mailinglist_parent_id: "msg10818"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2013-04-10T06:23:46-07:00
---


Greetings Ben,

Also, leveldb stores data in "levels". The very first storage level and the 
runtime data recovery log are not compressed.

That said, I agree with Tom that you are most likely seeing Riak store 3 copies 
of your data versus only one for mongodb. It is possible to dumb down Riak so 
that it is closer to mongodb:

1. in app.config, look for the riak\_core options, add the following line:

 {default\_bucket\_props, [{n\_val,1}]},

This will default the system to only storing one copy of your data.


2. if you are using Riak 1.3, again in app.config, look for the riak\_kv options:

 change this

 {anti\_entropy, {on, []}},

 to

 {anti\_entropy, {off, []}},

This will disable Riak's automatic detection and correction of data loss / 
corruption. The feature requires an added 1 to 2% data on disk.


Matthew



On Apr 10, 2013, at 9:01 AM, Tom Santero  wrote:

&gt; Hi Ben,
&gt; 
&gt; First, allow me to welcome to the list! Stick around, I think you'll like it 
&gt; here. :)
&gt; 
&gt; How many nodes of Riak are you running vs how many nodes of Mongo?
&gt; 
&gt; How much more disk space did Riak take?
&gt; 
&gt; Riak is designed to run as a cluster of several nodes, utilizing replication 
&gt; to provide resiliency and high-availability during partial failure. By 
&gt; default Riak stores three replicas of every object you persist. If you are 
&gt; only running a single node of Riak for your testing purposes, I suspect this 
&gt; may explain the significant divergence you're seeing when compared to the 
&gt; disk space used vs a single mongo, as each replica in Riak is being stored to 
&gt; the same disk.
&gt; 
&gt; Also, Snappy is optimizes for speed over disk utility, which will have a 
&gt; negligible impact on total disk usage when compared to other compression 
&gt; libraries such as zlib, etc. That said, for sufficiently large JSON files I 
&gt; know that BSON's prefixes can add significant overhead to object sizes such 
&gt; that BSON is actually heavier than the JSON it represents. What is the 
&gt; average size of the documents you're seeking to store?
&gt; 
&gt; Could you tell us a bit more about what you're trying to achieve with both 
&gt; Riak and Mongo, respectfully?
&gt; 
&gt; Tom
&gt; 
&gt; On Wed, Apr 10, 2013 at 12:39 AM, Ben McCann  wrote:
&gt; Hi, 
&gt; 
&gt; I'm currently storing data in MongoDB and would like to evaluate Riak as an 
&gt; alternative. Riak is appealing to me because LevelDB uses Snappy, so I would 
&gt; expect it to take less disk space to store my data set than MongoDB which 
&gt; does not use compression. However, when I benchmarked it by inserting a few 
&gt; hundred thousand JSON records into each datastore, Riak in fact took far more 
&gt; disk space. I'm wondering if there's something I might be missing here as a 
&gt; newcomer to Riak. E.g. I checked the disk space used by running "du -ch 
&gt; /var/lib/riak/leveldb". Is this perhaps not a good way to check disk space 
&gt; usage because perhaps Riak/LevelDB preallocates files? (I know MongoDB does 
&gt; this and has a built-in db.collection.stats command to provide true disk 
&gt; usage information). Are there any other reasons why Riak might be taking more 
&gt; space or anything I could have screwed up? 
&gt; 
&gt; Thanks, 
&gt; Ben 
&gt; 
&gt; -- 
&gt; about.me/benmccann 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

