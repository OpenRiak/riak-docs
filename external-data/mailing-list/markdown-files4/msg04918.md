---
title: "Re: simulating physical node crash"
description: ""
project: community
lastmod: 2011-09-28T13:59:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04918"
mailinglist_parent_id: "msg04916"
author_name: "Martin Woods"
project_section: "mailinglistitem"
sent_date: 2011-09-28T13:59:06-07:00
---


Hi Francisco

I've seen the same error in a dev environment running on a single Riak node 
with an n\_val of 1, so in my case it was nothing to do with a failing node. I 
wasn't running Riak Search either. I posted a question about it to this list a 
week or so ago but haven't seen a reply yet. 

So indeed, does anyone know what's causing this error and how we can avoid it?

Regards,
Martin. 



On 28 Sep 2011, at 20:39, francisco treacy  wrote:

&gt; Regarding (3) I found a Forcing Read Repair contrib function 
&gt; (http://contrib.basho.com/bucket\_inspector.html) which should help.
&gt; 
&gt; Otherwise for the m/r error, all of my buckets use default n\_val and write 
&gt; quorum. Could it be that some data never reached that particular node in the 
&gt; cluster? That is, should've I used W=3? During the failure, many assets were 
&gt; returning 404s which triggered read-repair (and were ok upon subsequent 
&gt; request), but no luck with the Map/Reduce function (it kept on failing). 
&gt; Could it have something to do with Riak Search?
&gt; 
&gt; Thanks,
&gt; 
&gt; Francisco
&gt; 
&gt; 
&gt; 2011/9/26 francisco treacy 
&gt; Hi all,
&gt; 
&gt; I have a 3-node Riak cluster, and I am simulating the scenario of physical 
&gt; nodes crashing.
&gt; 
&gt; When 2 nodes go down, and I query the remaining one, it fails with:
&gt; 
&gt; {error,
&gt; {exit,
&gt; {{{error,
&gt; {no\_candidate\_nodes,exhausted\_prefist,
&gt; [{riak\_kv\_mapred\_planner,claim\_keys,3},
&gt; {riak\_kv\_map\_phase,schedule\_input,5},
&gt; {riak\_kv\_map\_phase,handle\_input,3},
&gt; {luke\_phase,executing,3},
&gt; {gen\_fsm,handle\_msg,7},
&gt; {proc\_lib,init\_p\_do\_apply,3}],
&gt; []}},
&gt; {gen\_fsm,sync\_send\_event,
&gt; [&lt;0.31566.2330&gt;,
&gt; {inputs,
&gt; 
&gt; (...)
&gt; 
&gt; Here I'm doing a M/R, inputs being fed by Search.
&gt; 
&gt; (1) All of the involved buckets have N=3, and all involved requests R=1 (I 
&gt; don't really need quorum for this usecase)
&gt; 
&gt; Why is it failing? I'm sure i'm missing something basic here
&gt; 
&gt; (2) Probably worth noting, those 3 nodes are spread across \*two\* physical 
&gt; servers (1 on small one, 2 on beefier one). I've heard it is "not a good 
&gt; idea", not sure why though. These two servers are definitely enough still for 
&gt; our current load; should I consider adding a third one?
&gt; 
&gt; (3) To overcome the aforementioned error, I added a new node to the cluster 
&gt; (installed on the small server). Now the setup looks like: 4 nodes = 2 on 
&gt; small server, 2 on beefier one.
&gt; 
&gt; When 2 nodes go down, this works. Which brings me to another topic... could 
&gt; you point me to good strategies to "pre-" invoke read-repair? Is it up to 
&gt; clients to scan the keyspace forcing reads? It's a disaster usability-wise 
&gt; when first users start getting 404s all over the place.
&gt; 
&gt; Francisco
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

