---
title: "Re: riak-users Digest, Vol 78, Issue 13"
description: ""
project: community
lastmod: 2016-01-18T06:50:28-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16978"
author_name: "Ivaylo Panitchkov"
project_section: "mailinglistitem"
sent_date: 2016-01-18T06:50:28-08:00
---


&gt;
&gt; Message: 1
&gt; Date: Fri, 15 Jan 2016 18:24:08 +0100
&gt; From: Eugene Shubin 
&gt; To: riak-users@lists.basho.com
&gt; Subject: Re: Map after reduce
&gt; Message-ID:
&gt;  rmu\_oktkwr52+kdcqhtjcgmdbbd...@mail.gmail.com&gt;
&gt; Content-Type: text/plain; charset="utf-8"
&gt;
&gt; Did somebody successfully used trick described here
&gt; 
&gt; to
&gt; pass reduce results to map phase?
&gt; For me it does not work and looks strange in general.
&gt;
&gt; 2016-01-13 13:55 GMT+01:00 Eugene Shubin :
&gt;
&gt; &gt; Is it possible to put a map phase in chain of map-reduce job after reduce
&gt; &gt; phase?
&gt; &gt;
&gt; &gt; Any example, would be highly appreciated.
&gt; &gt;
&gt; &gt; Best regards,
&gt; &gt; Eugene Shubin
&gt; &gt;
&gt; -------------- next part --------------
&gt; An HTML attachment was scrubbed...
&gt; URL: &lt;
&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/attachments/20160115/55a949bf/attachment-0001.html
&gt; &gt;
&gt;
&gt; ------------------------------
&gt;

Hi Eugene,

Passing reduce phase's results to a map phase is mostly useful when you
want to prepare your data for the actual processing.
Here is a piece of my code (node.js) that pulls keys and loads Riak objects
in blocks:

riak.mapreduce
.add(config.sourceBucket)
.reduce({"keep" : false, "language" : "erlang", "module" :
"riak\_kv\_mapreduce", "function" : "reduce\_identity"})
.reduce({"keep" : false, "language" : "javascript", "source" :
"function(value, arg) { return value.slice(0, arg.n); }", "arg" : {"n"
: config.objectsPerBatch, "reduce\_phase\_batch\_size" :
config.objectsPerBatch, "do\_prereduce" : true}})
.map({"keep" : true, "language" : "javascript", "source" :
"function(o) { return ('true' !=
o.values[0].metadata['X-Riak-Deleted'])?[{key: o.key, data:
JSON.parse(o.values[0].data)}]:[]; }"})
.run(function(err, objects)
{

 console.log("HEY!");
});








-- 


\*Ivaylo Panitchkov\*Software developer | Programming
+1 514 504 4297
ipanitch...@hibernum.com

Facebook  | Twitter
 | LinkedIn



\*Ce courriel est confidentiel et peut aussi être protégé par la loi. Si
vous avez reçu ce courriel par erreur, veuillez nous en aviser
immédiatement en y répondant, puis supprimer ce message de votre système.
Veuillez ne pas le copier, l’utiliser pour quelque raison que ce soit ni
divulguer son contenu à quiconque. // \*\*This email is confidential and may
also be legally privileged. If you have received this email in error,
please notify us immediately by reply email and then delete this message
from your system. Please do not copy it or use it for any purpose or
disclose its content.\*
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

