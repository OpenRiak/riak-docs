---
title: "Re: RiakTS Query Question"
description: ""
project: community
lastmod: 2017-03-29T13:16:04-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18108"
mailinglist_parent_id: "msg18107"
author_name: "Andrei Zavada"
project_section: "mailinglistitem"
sent_date: 2017-03-29T13:16:04-07:00
---


Joe,

TS records in a given table all have the same structure and are stored
and retrieved as single objects (in Riak KV sense); the backend cannot
introspect them and only extract some fields.

Full records are read from backend and these are delivered, in chunks,
to the coordinator node (the node your client has connected to). On
receipt, columns not appearing in the SELECT clause are dropped; thus,
only the relevant columns are kept while the coordinator collects the
remaining chunks. From there, records are shipped to the client (via
temp tables if the query had an ORDER BY or LIMIT clause).

So no, the 1M blobs will be read from the leveldb backend, and they
will hog the bandwidth between storage and coordinator nodes. They
will not appear in the traffic going from the coordinator to the
client, though.

Andrei

On Wed, Mar 29, 2017 at 10:17 PM, Alexander Sicular  wrote:
&gt; I'm not 100% certain but I do not believe that is the case. Part of the
&gt; reason for structured data is efficient retrieval. I believe the data is
&gt; read but only the data selected leaves the leveldb backend, unselected data
&gt; never leaves leveldb so there's no overhead when passing data from level to
&gt; Riak or on the network.
&gt;
&gt; I defer to the engineering folks working on TS tho.
&gt;
&gt; -Alexander
&gt;
&gt; @siculars
&gt; http://siculars.posthaven.com
&gt;
&gt; Sent from my iRotaryPhone
&gt;
&gt; On Mar 29, 2017, at 15:08, Joe Olson  wrote:
&gt;
&gt; Suppose I have the following table in RiakTS:
&gt;
&gt;
&gt; CREATE TABLE T1 (
&gt;
&gt; id VARCHAR NOT NULL,
&gt;
&gt; eventtime TIMESTAMP NOT NULL,
&gt;
&gt; field2 SINT64,
&gt;
&gt; data BLOB NOT NULL,
&gt;
&gt; primary key (id, QUANTUM(eventtime, 365, 'd')),id)
&gt;
&gt; )
&gt;
&gt;
&gt; Assume the BLOB field is close to the max size for a RiakTS BLOB value
&gt; (~1MB)
&gt;
&gt;
&gt; Suppose I want to execute the following query:
&gt;
&gt;
&gt; Select id, eventtime, field2 from T1 where ((id = ID1) and (eventtime &gt;= T1
&gt; and eventtime &lt; T2))
&gt;
&gt;
&gt; I only want the SINT64 field, not the 1MB BLOB.
&gt;
&gt;
&gt; Am I paying for the bandwidth for the RiakTS cluster to pass around
&gt; (internally) the 1MB BLOB field just to get the SINT64 field?
&gt;
&gt;
&gt; If so, is there a way to avoid this, besides creating a second table without
&gt; the BLOB field?
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

