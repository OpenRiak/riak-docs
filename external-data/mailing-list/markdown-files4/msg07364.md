---
title: "Re: Geospatial advice?"
description: ""
project: community
lastmod: 2012-05-01T12:02:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07364"
mailinglist_parent_id: "msg07361"
author_name: "Mark Rose"
project_section: "mailinglistitem"
sent_date: 2012-05-01T12:02:41-07:00
---


In general I've been shying away from datastores that aren't
highly-available. In a world of zero-downtime expectations, single box
solutions are out. Galera is nice on the SQL side but isn't scalable beyond
a few boxes. I am also looking for a tool that offers mapreduce, which
eliminates any SQL tool I know of. MongoDB might have sharding and
mapreduce, but suffers from a global insert write lock and doesn't
guarantee data persistence. The best comparison I've found of the different
datastores is at http://kkovacs.eu/cassandra-vs-mongodb-vs-couchdb-vs-redis .
Riak appeals to me for its high scalability, plus the ability to add new
nodes/CPU easily.

-Mark

On Tue, May 1, 2012 at 1:32 PM, Will Moss  wrote:

&gt; I remember someone once going on a rant about how there's no silver bullet
&gt; database (If you have not read 
&gt; this,
&gt; do so), so I'm, of course, going to agree Sean.
&gt;
&gt; If you're going to need to run this on more than one machine then going
&gt; with something like Riak makes more sense. Postges has no build in sharding
&gt; functionality, and it's not clear to 
&gt; methat
&gt; MongoDB's 2d indexes work in a sharded configuration.
&gt;
&gt; Will
&gt;
&gt;
&gt; On Tue, May 1, 2012 at 10:16 AM, Sean Cribbs  wrote:
&gt;
&gt;&gt; In contrast to Alexander's assessment, I'd say "it depends". I have built
&gt;&gt; some geospatial indexes on top of Riak using a geohashing scheme based on
&gt;&gt; the Hilbert space-filling curve. However, I had to choose specific levels
&gt;&gt; of "zoom" and precompute them. Now that we have secondary indexes, you
&gt;&gt; could perhaps bypass the precomputation step. In general, if you know the
&gt;&gt; geometry of the space you want to query, you can fairly trivially compute
&gt;&gt; the names of the geohashes you need to look up and then either fetch
&gt;&gt; individual keys for those (if you precompute them), or use MapReduce to
&gt;&gt; fetch a range of them. It's not automatic, for sure, but the greatest
&gt;&gt; complexity will be in deciding which granularities of index to support.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, May 1, 2012 at 12:44 PM, Alexander Sicular wrote:
&gt;&gt;
&gt;&gt;&gt; My advice is to not use Riak. Check mongo or Postgres.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; @siculars on twitter
&gt;&gt;&gt; http://siculars.posterous.com
&gt;&gt;&gt;
&gt;&gt;&gt; Sent from my iRotaryPhone
&gt;&gt;&gt;
&gt;&gt;&gt; On May 1, 2012, at 9:18, Mark Rose  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; &gt; Hello everyone!
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; I'm going to be implementing Riak as a storage engine for geographic
&gt;&gt;&gt; data. Research has lead me to using geohashing as a useful way to filter
&gt;&gt;&gt; out results outside of a region of interest. However, I've run into some
&gt;&gt;&gt; stumbling blocks and I'm looking for advice on the best way to proceed.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Querying efficiently by geohash involves querying several regions
&gt;&gt;&gt; around a point. From what I can tell, Riak offers no way to query a
&gt;&gt;&gt; secondary index with multiple ranges. Having to query a several ranges,
&gt;&gt;&gt; merge them in the application layer, then pass them off to mapreduce seems
&gt;&gt;&gt; rather silly (and could mean passing GBs of data). Alternatively, I could
&gt;&gt;&gt; start straight with mapreduce, but key filtering seems to work only with
&gt;&gt;&gt; the primary key, which would force me into using the geohashed location as
&gt;&gt;&gt; the primary key (which would lead to collisions if two things existed at
&gt;&gt;&gt; the same point). I'd also like to avoid using the primary key as the
&gt;&gt;&gt; geohash as if the item moves I'd have to change all the references to it.
&gt;&gt;&gt; Lastly, I could do a less efficient mapreduce over a less precise geohash,
&gt;&gt;&gt; but this doesn't solve the issue of the equator (anything near the equator
&gt;&gt;&gt; would require mapreducing the entire dataset).
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Is there any way to query multiple ranges with a secondary index and
&gt;&gt;&gt; pass that off to mapreduce? Or should I just stick with the less efficient
&gt;&gt;&gt; mapreduce, and when near the equator, run two queries and later merge them?
&gt;&gt;&gt; Or am I going about this the wrong way?
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; In any case, the final stage of my queries will involve mapreduce as
&gt;&gt;&gt; I'll need to further filter the items found in a region.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Thank you,
&gt;&gt;&gt; &gt; Mark
&gt;&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs 
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

