---
title: "Re: Using apache as a reverse proxy"
description: ""
project: community
lastmod: 2015-01-15T14:06:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15508"
mailinglist_parent_id: "msg15507"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2015-01-15T14:06:45-08:00
---


Most reverse proxies have a timeout for data being sent from the
server. If this query takes a long time to run when not using the
proxy, I suggest investigating increasing timeout values.
--
Luke Bakken
Engineer
lbak...@basho.com


On Thu, Jan 15, 2015 at 12:01 PM, Fred Grim  wrote:
&gt; The more I look at this the more I am thinking there is something busted
&gt; in riak or webmachine (I am using riak 1.4.10). The issue seems to be
&gt; impervious to apache settings or haproxy settings and going through the
&gt; source there doesnÂ¹t seem to be many knobs to turn to adjust chunked
&gt; responses. Googling for issues in web machine also turned up nothing.
&gt; Maybe a pause in the return of map responses is doing it? Can riak be
&gt; configured to send keepalives?
&gt;
&gt; F
&gt;
&gt; On 1/14/15, 10:31 PM, "Toby Corkindale"  wrote:
&gt;
&gt;&gt;Just a thought, but have you tried to replicate the problem when using
&gt;&gt;haproxy (with the example configs provided on basho's site)?
&gt;&gt;That might let you discover if the problem really IS with Apache, or
&gt;&gt;if it's something to do with your Riak config instead.
&gt;&gt;
&gt;&gt;On 15 January 2015 at 11:05, Fred Grim  wrote:
&gt;&gt;&gt; Hello List,
&gt;&gt;&gt;
&gt;&gt;&gt; So I am using apache on ubuntu as a reverse proxy to a riak cluster.
&gt;&gt;&gt;Everything seems to work fine except for largish streaming map reduce
&gt;&gt;&gt;queries. The config is:
&gt;&gt;&gt; 
&gt;&gt;&gt; ServerAdmin aper...@acompany.com
&gt;&gt;&gt; 
&gt;&gt;&gt; BalancerMember
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;&gt;kc9WU&e= :8098
&gt;&gt;&gt; BalancerMember
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;&gt;kc9WU&e= :8098
&gt;&gt;&gt; BalancerMember
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;&gt;kc9WU&e= :8098
&gt;&gt;&gt; BalancerMember
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;&gt;kc9WU&e= :8098
&gt;&gt;&gt; BalancerMember
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;&gt;kc9WU&e= :8098
&gt;&gt;&gt; BalancerMember
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;&gt;kc9WU&e= :8098
&gt;&gt;&gt; BalancerMember
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;&gt;kc9WU&e= :8098
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; ProxyPass balancer://riak\_cluster/
&gt;&gt;&gt; ProxyPassReverse balancer://riak\_cluster/
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt;
&gt;&gt;&gt; What happens is that my streamed queries seem to partially come in
&gt;&gt;&gt;which makes me think that the load balancer is switching them or
&gt;&gt;&gt;something. I know I am missing some config value in here but I cannot,
&gt;&gt;&gt;for the life of me, figure out what it is. Does anyone have an example
&gt;&gt;&gt;config they could through up?
&gt;&gt;&gt;
&gt;&gt;&gt; F
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_mailm
&gt;&gt;&gt;an\_listinfo\_riak-2Dusers-5Flists.basho.com&d=AwICAg&c=Sqcl0Ez6M0X8aeM67LK
&gt;&gt;&gt;IiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7PMnXQSchCb
&gt;&gt;&gt;1a36y\_3o9wCTLFVK8KJSs0&s=MsEIDP9hnsHgV-B\_0DwIZR4xJbEmFwP3M1b3ULbDXiU&e=
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;--
&gt;&gt;Turning and turning in the widening gyre
&gt;&gt;The falcon cannot hear the falconer
&gt;&gt;Things fall apart; the center cannot hold
&gt;&gt;Mere anarchy is loosed upon the world
&gt;&gt;
&gt;&gt;\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;riak-users mailing list
&gt;&gt;riak-users@lists.basho.com
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_mailma
&gt;&gt;n\_listinfo\_riak-2Dusers-5Flists.basho.com&d=AwICAg&c=Sqcl0Ez6M0X8aeM67LKIi
&gt;&gt;DJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7PMnXQSchCb1a3
&gt;&gt;6y\_3o9wCTLFVK8KJSs0&s=MsEIDP9hnsHgV-B\_0DwIZR4xJbEmFwP3M1b3ULbDXiU&e=
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

