---
title: "Writing a reduce phase with reduce_phase_only_1 and additional	parameters"
description: ""
project: community
lastmod: 2012-05-23T12:04:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07516"
author_name: "Manuel Gomez"
project_section: "mailinglistitem"
sent_date: 2012-05-23T12:04:13-07:00
---


I need to write a a reduce\_slice function in erlang that I'll load into
riak, I'm doing this so I don't need to use the javascript one which has
already once maxed out the js\_thread\_stack memory.


This is my function so far:

reduce\_slice(WList,{Page,PageSize}) -&gt;
 lager:info("Page and PageSize ~p - ~p",[Page,PageSize]),
 lists:sublist(WList, Page, PageSize).


This "works". The problem is that because the reduce phase gets executed
with whatever it has at any given moment, the end result is always
different. So I need to call this phase with reduce\_phase\_only\_1 as a
param, and here is where I'm a bit lost, this is how I call the function
now:

{reduce,{modfun,whisper\_db,reduce\_slice},{Page,PageSize},true}])

I see that in the Riak's MapReduce documentation you can call a function
with "reduce\_phase\_only\_1" like so:

{reduce, FunSpec, [reduce\_phase\_only\_1], Keep}

So I tried:

{reduce,{modfun,whisper\_db,reduce\_slice},[reduce\_phase\_only\_1,
{Page,PageSize}],true}])

Which throws (of course because of the the function definition is not
expecting a list):

Supervisor riak\_pipe\_vnode\_worker\_sup had child undefined started with
{riak\_pipe\_vnode\_worker,start\_link,undefined} at &lt;0.2927.0&gt; exit with
reason no function clause matching whisper\_db:reduce\_slice([

I also tried:

{reduce,{modfun,whisper\_db,reduce\_slice},{reduce\_phase\_only\_1,{Page,PageSize}},true}]),
and changing the function definition to:

reduce\_slice(WList,{Phase,{Page,PageSize}}) -&gt;
 lager:info("Page and PageSize ~p - ~p",[Page,PageSize]),
 lists:sublist(WList, Page, PageSize).

I get the same problem as my first example (different results every time).

So I'm not sure the reduce function definition is wrong, or I'm invoking it
wrong.

Thanks in advance for any help.

Manuel
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

