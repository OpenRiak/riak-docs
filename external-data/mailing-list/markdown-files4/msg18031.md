---
title: "Re: Handoffs are too slow after netsplit"
description: ""
project: community
lastmod: 2017-02-24T09:22:05-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18031"
mailinglist_parent_id: "msg18013"
author_name: "Charlie Voiselle"
project_section: "mailinglistitem"
sent_date: 2017-02-24T09:22:05-08:00
---


Andrey:

Another thing that can stall handoff is running commands that reset the vnode 
activity timer. The `riak-admin vnode-status` command will reset the activity 
timer and should never be run more frequently that then vnode inactivity 
timeout; if you do, that can permanently stall handoff. We have seen this 
before at a customer site where they were collecting the statics from the 
vnode-status command into their metrics system. 

Regards,
Charlie Voiselle


&gt; On Feb 23, 2017, at 7:14 AM, Douglas Rohrer  wrote:
&gt; 
&gt; Andrey:
&gt; 
&gt; It's waiting for 60 seconds, literally...
&gt; 
&gt; See 
&gt; https://github.com/basho/riak\_core/search?utf8=%E2%9C%93&q=vnode\_inactivity\_timeout
&gt; 
&gt; 
&gt; - handoff is not initiated until a vnode has been inactive for the specified 
&gt; inactivity period.
&gt; 
&gt; For demonstration purposes, if you want to reduce this time, you could set 
&gt; the riak\_core.vnode\_inactivity\_timeout period lower ,which can be set in 
&gt; advanced.config. Also note that, depending on the backend you use, it's 
&gt; possible to have other settings set lower than the vnode inactivity timeout, 
&gt; you can actually prevent handoff completely - see 
&gt; http://docs.basho.com/riak/kv/2.2.0/setup/planning/backend/bitcask/#sync-strategy
&gt; 
&gt; ,
&gt; for examnple.
&gt; 
&gt; Hope this helps.
&gt; 
&gt; Doug
&gt; 
&gt; On Thu, Feb 23, 2017 at 6:40 AM Andrey Ershov  &gt; wrote:
&gt; Hi, guys!
&gt; 
&gt; I'd like to follow up on handoffs behaviour after netsplit. The problem is 
&gt; that right after network partition is healed, "riak-admin transfers" command 
&gt; says that there are X partitions waiting transfer from one node to another, 
&gt; and Y partitions waiting transfer in the opposite direction. What are they 
&gt; waiting for? Active transfers section is always empty. It takes about 1 
&gt; minute for transfer to occur. I've increased transfer\_limit to 100 and it 
&gt; does not help. 
&gt; Also I've tried to attach to Erlang VM and execute 
&gt; riak\_core\_vnode\_manager:force\_handoff() on each node. This command returns 
&gt; 'ok'. But seems that it does not work right after network is healed. After 
&gt; some time 30-60 s, force\_handoff() works as expected, but actually it's the 
&gt; same latency as in auto handoff case. 
&gt; 
&gt; So what is it waiting for? Any ideas?
&gt; 
&gt; I'm preparing real-time coding demo to be shown on the conference. So it's 
&gt; too much time to wait for 1 minute for handoff to occur just for a couple of 
&gt; keys...
&gt; -- 
&gt; Thanks,
&gt; Andrey
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

