---
title: "Re: Unit testing, Riak buckets"
description: ""
project: community
lastmod: 2013-10-13T20:22:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12616"
mailinglist_parent_id: "msg12615"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2013-10-13T20:22:44-07:00
---


https://github.com/basho/riak\_test/blob/master/src/rtdev.erl#L76 is the
main function that does the resetting of the git repository (and stops
nodes, etc).

https://github.com/basho/riak\_test/blob/master/bin/rtdev-setup-releases.shcreates
the necessary directory structure and git repo for rtdev.erl from a
bunch of prebuilt Riak devrels.

https://github.com/basho/riak\_test/blob/master/bin/rtdev-current.sh adds
the "current" release to the existing directory structure/repo.

It also bears mentioning that the tests in the official Python client
create random bucket and key names, which seems to work pretty well, but it
can become troublesome when you have too many buckets and you go to list
them or change their properties.


On Sun, Oct 13, 2013 at 9:19 PM, Jeremiah Peschka &lt;
jeremiah.pesc...@gmail.com&gt; wrote:

&gt; Go on.
&gt;
&gt; ---
&gt; sent from a tiny portion of the hive mind...
&gt; in this case, a phone
&gt; On Oct 13, 2013 9:19 PM, "Sean Cribbs"  wrote:
&gt;
&gt;&gt; Not sure it's the greatest way (sometimes slow), but our integration
&gt;&gt; testing tool riak\_test uses git to store a clean "devrel" and resets/cleans
&gt;&gt; the git repository at the beginning of each test. If you're curious, I can
&gt;&gt; point you to the relevant sections of code that do this.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sun, Oct 13, 2013 at 8:34 PM, Jeremiah Peschka &lt;
&gt;&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; For CorrugatedIron's integration tests, we frequently use a GUID as part
&gt;&gt;&gt; of the bucket name and then destroy the bucket after tests finish. Since
&gt;&gt;&gt; I'm frequently moving between different Riak builds, I destroy my data
&gt;&gt;&gt; directories at the filesystem level on a regular basis.
&gt;&gt;&gt;
&gt;&gt;&gt; Your idea of using cron jobs to delete yesterday's buckets doesn't sound
&gt;&gt;&gt; like a bad idea.
&gt;&gt;&gt;
&gt;&gt;&gt; Yes, listing buckets is bad in production. No, this isn't production.
&gt;&gt;&gt; Therefore: LIST ALL THE THINGS!
&gt;&gt;&gt;
&gt;&gt;&gt; ---
&gt;&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt;&gt;&gt; MCITP: SQL Server 2008, MVP
&gt;&gt;&gt; Cloudera Certified Developer for Apache Hadoop
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Sun, Oct 13, 2013 at 8:27 PM, Toby Corkindale &lt;
&gt;&gt;&gt; toby.corkind...@strategicdata.com.au&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt; I'd like to hear how other people are approaching the problem of
&gt;&gt;&gt;&gt; cleaning Riak buckets up at the end of unit tests for their apps.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The problem I have is that multiple tests may be run at once (by
&gt;&gt;&gt;&gt; different developers or different Jenkins' jobs or even just a parallelised
&gt;&gt;&gt;&gt; test suite) so I can't really run a blanket delete-all at the end of the
&gt;&gt;&gt;&gt; test suite, unless I use a randomly-named bucket each time. Yet if I do
&gt;&gt;&gt;&gt; that, I'm concerned the test suite may crash out prior to the end
&gt;&gt;&gt;&gt; sometimes, and then never delete that randomly-named bucket.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If secondary indexes aren't required, then the easy solution is to use
&gt;&gt;&gt;&gt; a randomly-named Bitcask bucket which has a backend configured for a fairly
&gt;&gt;&gt;&gt; short TTL.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Otherwise, I have wondered about creating buckets with a certain
&gt;&gt;&gt;&gt; format, perhaps "test-XXXXXX-YYYY-MM-DD", (x=random) and then a nightly
&gt;&gt;&gt;&gt; cron script can run to find all buckets timestamped from the previous day
&gt;&gt;&gt;&gt; or earlier, and remove them. I gather listing all buckets is an expensive
&gt;&gt;&gt;&gt; operation though, although it'll only be running on a testing Riak cluster.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So I wondered how other developers are approaching this issue?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;&gt; Toby
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs 
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

