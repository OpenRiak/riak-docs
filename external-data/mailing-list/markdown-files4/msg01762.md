---
title: "Re: Ring Cluster and CPU idle time"
description: ""
project: community
lastmod: 2010-12-09T10:13:32-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01762"
mailinglist_parent_id: "msg01761"
author_name: "David Dawson"
project_section: "mailinglistitem"
sent_date: 2010-12-09T10:13:32-08:00
---


Sean,

 I will try tweaking those settings you suggest.

 In terms of the CPU usage we see 60% on average across the whole 12 
CPU's so approx 720-790% in total with no one cpu maxed out.

Dave 


On 9 Dec 2010, at 14:04, Sean Cribbs wrote:

&gt; If you're using ETS, then yes that makes sense that the majority of the time 
&gt; would be CPU (there's no disk to wait on!). One thing - when you say 60% of 
&gt; available CPU, is that 60% of one core, or 60% of 12 cores (sometimes 
&gt; reported as 720%)? The latter seems highly unlikely.
&gt; 
&gt; There are some generic things you can do to tweak Erlang and Riak for 
&gt; multicore computers, many of them referenced on this page: 
&gt; http://erlang.org/doc/man/erl.html Of special note are:
&gt; 
&gt; +A - how many OS threads will be in the async thread pool (handles IO, some 
&gt; system calls)
&gt; +S - the number of scheduler threads to create (usually 1 thread per CPU)
&gt; +sct - specify the CPU topology (useful for NUMA processors like Nehalem)
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On Dec 9, 2010, at 5:40 AM, David Dawson wrote:
&gt; 
&gt;&gt; Sean,
&gt;&gt; 
&gt;&gt; We have used the ETS backend, to rule out Disk IO as much as possible 
&gt;&gt; and we are pretty sure that our memory IO is fine, this leaves either 
&gt;&gt; Network IO being a factor or the erlang VM itself ( highly unlikely ). In 
&gt;&gt; further testing we also discovered that just using 1 node in the ring gave 
&gt;&gt; us 80% cpu / 0% wait / 17% idle / 3% sys, which could suggest that network 
&gt;&gt; chatter between the ring could be the factor, so we are planning to setup 
&gt;&gt; the RIAK ring so the handoff and chatter traffic is done over a separate 
&gt;&gt; NIC, in your experiences will this help? 
&gt;&gt; 
&gt;&gt; Dave
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On 8 Dec 2010, at 17:57, Sean Cribbs wrote:
&gt;&gt; 
&gt;&gt;&gt; David,
&gt;&gt;&gt; 
&gt;&gt;&gt; It's expected that, especially when running basho\_bench, your cluster will 
&gt;&gt;&gt; not use that much CPU. Riak is mostly I/O-bound, which is a good thing (vs. 
&gt;&gt;&gt; wasting CPU not delivering data to you). I would definitely expect network 
&gt;&gt;&gt; and disk (and possibly RAM) to be the primary limiting factors.
&gt;&gt;&gt; 
&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt; 
&gt;&gt;&gt; On Dec 8, 2010, at 12:36 PM, David Dawson wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; We are currently running a ring of 3 machines each machine with 12 cores, 
&gt;&gt;&gt;&gt; and have noticed that we seem to only be using 60% of available CPU ( 
&gt;&gt;&gt;&gt; other 40% is spent idle ) when running basho bench against the cluster. We 
&gt;&gt;&gt;&gt; have tried changing the 'n\_val' from 3 to 1 and also the backend from 
&gt;&gt;&gt;&gt; bitcask to ets, and it seems to make no difference. Is this expected? 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Also are there any suggested tuning parameters that should be used when 
&gt;&gt;&gt;&gt; running riak on machines with lots of cores? and if not what would you 
&gt;&gt;&gt;&gt; expect the bottleneck to be in a cluster? ( cpu / disk io/ memory / 
&gt;&gt;&gt;&gt; network io )
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Dave
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

