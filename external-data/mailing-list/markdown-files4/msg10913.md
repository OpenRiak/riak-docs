---
title: "Re: Experimental branch - 2i query improvements"
description: ""
project: community
lastmod: 2013-04-17T03:08:01-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10913"
mailinglist_parent_id: "msg10904"
author_name: "Olav Frengstad"
project_section: "mailinglistitem"
sent_date: 2013-04-17T03:08:01-07:00
---


The features sounds very promising, from a ease-of-use perspective
feature #3 and #4 definitely have great value. Being able to do
multi-conditional 2i queries based on composite keys is something
im personally excited about.

Out of curiosity, have you thought about adding additional flexibility
to the query iterator by being able to add "pluggable" match functions?
Especially I'm thinking of querying ISO-8601 dates that matches a
certain criteria (eg get all data between 08:00-16:00 in august for
all years). At least facilitating for more advanced matching functions
could be a good idea.

Olav

2013/4/16 Martin Sumner :
&gt; I've been working on an experimental branch to offer some improvements to
&gt; the functionality and performance of 2i queries in Riak:
&gt; https://github.com/martinsumner/riak\_kv
&gt;
&gt; Explanation:
&gt; https://github.com/martinsumner/riak\_kv/blob/master/docs/index\_speedup.md
&gt;
&gt; There are four basic features that are included:
&gt; 1. The ability to pin particular 2i indexes into memory (without loss of
&gt; consistency on restart of a node)
&gt; 2. The ability to set partition-level static bloom filters for particular 2i
&gt; indexes to greatly reduce the disk overheads of exact-term queries with
&gt; small result sets (e.g. for queries by a secondary identifier such as email
&gt; address)
&gt; 3. The ability to return indexterms, not just keys as results of a query -
&gt; so that those terms can be overloaded with additional information which can
&gt; then be filtered by the application without requiring a M/R stage (note this
&gt; is already available via Russell Brown's branch -
&gt; https://github.com/basho/riak\_kv/tree/pt34-index-values)
&gt; 4. The ability to pass a regular expression to the query iterator - so that
&gt; range queries will be filtered based on matches to that regular expression
&gt; (for example allowing for non-trailing wildcards) before returning the keys
&gt; and terms
&gt;
&gt; Testing is slight at the moment, both functionally and non-functionally.
&gt; This is still very-much an experiment. We're hoping to do some full scale
&gt; volume testing on the branch in the next couple of weeks.
&gt;
&gt; The branch has been developed to solve some problems we have with edge cases
&gt; in our implementation for the NHS in England - where we have to support
&gt; tracing across an 80M record demographic database. I'd be interested if
&gt; people thought it had value in other environments.
&gt;
&gt; Regards
&gt;
&gt; Martin
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Med Vennlig Hilsen
Olav Frengstad

Systemutvikler // FWT
+47 920 42 090

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

