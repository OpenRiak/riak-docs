---
title: "Re: Riak node joining"
description: ""
project: community
lastmod: 2013-06-30T12:19:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11353"
mailinglist_parent_id: "msg11344"
author_name: "Daniel Iwan"
project_section: "mailinglistitem"
sent_date: 2013-06-30T12:19:39-07:00
---


Four days passed and node is still joining.
I haven't tried to restart it (which would probably fix the issue) as I
would like to find out what was the real reason of that stall and what to
do
to avoid it in the future.
Any suggestions?

Daniel


On 27 June 2013 00:19, Daniel Iwan  wrote:

&gt; Hi all
&gt;
&gt; I see node stalled at 'joining' for good 8 hours now:
&gt; 3-node cluster v1.3.1, 512 vnodes (way too high but that's another
&gt; matter), leveldb backend
&gt; Cluster was originally 2-nodes only and after upgrading to 1.3.1 we
&gt; attached another node
&gt; No active transfers on the nodes at the moment, but from error log looks
&gt; like vnode transfer stopped
&gt;
&gt; riak-admin member-status
&gt; Attempting to restart script through sudo -H -u riak
&gt; ================================= Membership
&gt; ==================================
&gt; Status Ring Pending Node
&gt;
&gt; -------------------------------------------------------------------------------
&gt; joining 33.2% -- 'riak@10.173.240.3'
&gt; valid 33.6% -- 'riak@10.173.240.2'
&gt; valid 33.2% -- 'riak@10.173.240.21'
&gt; -------------------------------------------------------------------------------
&gt; Valid:2 / Leaving:0 / Exiting:0 / Joining:1 / Down:0
&gt;
&gt;
&gt;
&gt; riak-admin ring-status
&gt; Attempting to restart script through sudo -H -u riak
&gt; ================================== Claimant
&gt; ===================================
&gt; Claimant: 'riak@10.173.240.21'
&gt; Status: up
&gt; Ring Ready: true
&gt;
&gt; ============================== Ownership Handoff
&gt; ==============================
&gt; No pending changes.
&gt;
&gt; ============================== Unreachable Nodes
&gt; ==============================
&gt; All nodes are up and reachable
&gt;
&gt;
&gt;
&gt; Node that is joining shows
&gt; \*error.log\*
&gt; 2013-06-26 16:35:50.351 [error] &lt;0.7222.0&gt; gen\_fsm &lt;0.7222.0&gt; in state
&gt; ready terminated with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.7223.0&gt;,stop]}}
&gt; 2013-06-26 16:35:51.549 [error] &lt;0.7222.0&gt; CRASH REPORT Process &lt;0.7222.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.7223.0&gt;,stop]}} in
&gt; gen\_fsm:handle\_msg/7 line 511
&gt; 2013-06-26 16:35:52.460 [error] &lt;0.5316.0&gt; gen\_fsm &lt;0.5316.0&gt; in state
&gt; ready terminated with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.5317.0&gt;,stop]}}
&gt; 2013-06-26 16:35:52.696 [error] &lt;0.5316.0&gt; CRASH REPORT Process &lt;0.5316.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.5317.0&gt;,stop]}} in
&gt; gen\_fsm:handle\_msg/7 line 511
&gt; 2013-06-26 16:35:52.867 [error] &lt;0.9088.0&gt; gen\_fsm &lt;0.9088.0&gt; in state
&gt; ready terminated with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.9089.0&gt;,stop]}}
&gt; 2013-06-26 16:35:53.007 [error] &lt;0.9088.0&gt; CRASH REPORT Process &lt;0.9088.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.9089.0&gt;,stop]}} in
&gt; gen\_fsm:handle\_msg/7 line 511
&gt; 2013-06-26 16:35:53.127 [error] &lt;0.5794.0&gt; gen\_fsm &lt;0.5794.0&gt; in state
&gt; ready terminated with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.5795.0&gt;,stop]}}
&gt; 2013-06-26 16:35:53.248 [error] &lt;0.5794.0&gt; CRASH REPORT Process &lt;0.5794.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.5795.0&gt;,stop]}} in
&gt; gen\_fsm:handle\_msg/7 line 511
&gt; 2013-06-26 16:35:53.368 [error] &lt;0.3990.0&gt; gen\_fsm &lt;0.3990.0&gt; in state
&gt; ready terminated with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.3991.0&gt;,stop]}}
&gt; 2013-06-26 16:35:53.498 [error] &lt;0.3990.0&gt; CRASH REPORT Process &lt;0.3990.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.3991.0&gt;,stop]}} in
&gt; gen\_fsm:handle\_msg/7 line 511
&gt; 2013-06-26 16:35:53.619 [error] &lt;0.7017.0&gt; gen\_fsm &lt;0.7017.0&gt; in state
&gt; ready terminated with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.7018.0&gt;,stop]}}
&gt; 2013-06-26 16:35:53.739 [error] &lt;0.7017.0&gt; CRASH REPORT Process &lt;0.7017.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.7018.0&gt;,stop]}} in
&gt; gen\_fsm:handle\_msg/7 line 511
&gt; 2013-06-26 16:35:53.859 [error] &lt;0.5120.0&gt; gen\_fsm &lt;0.5120.0&gt; in state
&gt; ready terminated with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.5121.0&gt;,stop]}}
&gt; 2013-06-26 16:35:53.980 [error] &lt;0.5120.0&gt; CRASH REPORT Process &lt;0.5120.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {timeout,{gen\_fsm,sync\_send\_all\_state\_event,[&lt;0.5121.0&gt;,stop]}} in
&gt; gen\_fsm:handle\_msg/7 line 511
&gt; 2013-06-26 16:41:27.819 [error]
&gt; &lt;0.10046.0&gt;@riak\_core\_handoff\_sender:start\_fold:226 hinted\_handoff transfer
&gt; of riak\_kv\_vnode from 'riak@10.173.240.3'
&gt; 961964944883816959833284743408959721921971224576 to 'riak@10.173.240.2'
&gt; 961964944883816959833284743408959721921971224576 failed because of
&gt; exit:{noproc,{riak\_core\_gen\_server,call,[{riak\_kv\_handoff\_listener,'
&gt; riak@10.173.240.2'},handoff\_port,infinity]}}
&gt; [{riak\_core\_gen\_server,call,3,[{file,"src/riak\_core\_gen\_server.erl"},{line,214}]},{riak\_core\_handoff\_sender,start\_fold,5,[{file,"src/riak\_core\_handoff\_sender.erl"},{line,84}]}]
&gt; 2013-06-26 16:41:27.819 [error]
&gt; &lt;0.10045.0&gt;@riak\_core\_handoff\_sender:start\_fold:226 hinted\_handoff transfer
&gt; of riak\_kv\_vnode from 'riak@10.173.240.3'
&gt; 790695221759101774106290427075020305556041629696 to 'riak@10.173.240.2'
&gt; 790695221759101774106290427075020305556041629696 failed because of
&gt; exit:{noproc,{riak\_core\_gen\_server,call,[{riak\_kv\_handoff\_listener,'
&gt; riak@10.173.240.2'},handoff\_port,infinity]}}
&gt; [{riak\_core\_gen\_server,call,3,[{file,"src/riak\_core\_gen\_server.erl"},{line,214}]},{riak\_core\_handoff\_sender,start\_fold,5,[{file,"src/riak\_core\_handoff\_sender.erl"},{line,84}]}]
&gt; 2013-06-26 16:41:31.153 [error]
&gt; &lt;0.10061.0&gt;@riak\_core\_handoff\_sender:start\_fold:226 hinted\_handoff transfer
&gt; of riak\_kv\_vnode from 'riak@10.173.240.3'
&gt; 379647886259785328361504067873565706277810601984 to 'riak@10.173.240.2'
&gt; 379647886259785328361504067873565706277810601984 failed because of
&gt; exit:{noproc,{riak\_core\_gen\_server,call,[{riak\_kv\_handoff\_listener,'
&gt; riak@10.173.240.2'},handoff\_port,infinity]}}
&gt; [{riak\_core\_gen\_server,call,3,[{file,"src/riak\_core\_gen\_server.erl"},{line,214}]},{riak\_core\_handoff\_sender,start\_fold,5,[{file,"src/riak\_core\_handoff\_sender.erl"},{line,84}]}]
&gt; 2013-06-26 16:45:23.242 [error] emulator Error in process &lt;0.25919.0&gt; on
&gt; node 'riak@10.173.240.3' with exit value:
&gt; {badarg,[{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\_core\_stat.erl"},{line,168}]},{riak\_core\_stat,'-vnodeq\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\_core\_stat.erl"},{line,169}]},{riak\_core\_stat,vnodeq\_stats...
&gt;
&gt;
&gt;
&gt; \*console log:\*
&gt; 2013-06-26 16:52:14.834 [info]
&gt; &lt;0.30751.0&gt;@riak\_core\_handoff\_receiver:process\_message:99 Receiving handoff
&gt; data for partition
&gt; riak\_kv\_vnode:822094670998632891489572718402909198556462055424
&gt; 2013-06-26 16:52:14.875 [info]
&gt; &lt;0.30751.0&gt;@riak\_core\_handoff\_receiver:handle\_info:69 Handoff receiver for
&gt; partition 822094670998632891489572718402909198556462055424 exited after
&gt; processing 0 objects
&gt; 2013-06-26 16:52:16.693 [info]
&gt; &lt;0.30763.0&gt;@riak\_core\_handoff\_receiver:process\_message:99 Receiving handoff
&gt; data for partition
&gt; riak\_kv\_vnode:125597796958124469533129165311555572001681702912
&gt; 2013-06-26 16:52:16.731 [info]
&gt; &lt;0.30763.0&gt;@riak\_core\_handoff\_receiver:handle\_info:69 Handoff receiver for
&gt; partition 125597796958124469533129165311555572001681702912 exited after
&gt; processing 0 objects
&gt; 2013-06-26 18:52:20.507 [info]
&gt; &lt;0.18639.3&gt;@riak\_kv\_exchange\_fsm:key\_exchange:204 Repaired 2010 keys during
&gt; active anti-entropy exchange of
&gt; {436737793968023723603835506651545511733120466944,3} between
&gt; {439592289353435643365952078590444502005885960192,'riak@10.173.240.3'}
&gt; and {442446784738847563128068650529343492278651453440,'riak@10.173.240.21
&gt; '}
&gt; 2013-06-26 18:52:49.282 [info]
&gt; &lt;0.22964.3&gt;@riak\_kv\_exchange\_fsm:key\_exchange:204 Repaired 1809 keys during
&gt; active anti-entropy exchange of
&gt; {439592289353435643365952078590444502005885960192,3} between
&gt; {439592289353435643365952078590444502005885960192,'riak@10.173.240.3'}
&gt; and {442446784738847563128068650529343492278651453440,'riak@10.173.240.21
&gt; '}
&gt; 2013-06-26 21:43:21.418 [info]
&gt; &lt;0.17334.7&gt;@riak\_kv\_exchange\_fsm:key\_exchange:204 Repaired 1809 keys during
&gt; active anti-entropy exchange of
&gt; {48526421552002635955981722961282834637013385216,3} between
&gt; {51380916937414555718098294900181824909778878464,'riak@10.173.240.3'} and
&gt; {54235412322826475480214866839080815182544371712,'riak@10.173.240.21'}
&gt; 2013-06-26 21:43:51.259 [info]
&gt; &lt;0.21268.7&gt;@riak\_kv\_exchange\_fsm:key\_exchange:204 Repaired 1965 keys during
&gt; active anti-entropy exchange of
&gt; {51380916937414555718098294900181824909778878464,3} between
&gt; {51380916937414555718098294900181824909778878464,'riak@10.173.240.3'} and
&gt; {54235412322826475480214866839080815182544371712,'riak@10.173.240.21'}
&gt; 2013-06-26 22:22:22.352 [info]
&gt; &lt;0.20533.8&gt;@riak\_kv\_exchange\_fsm:key\_exchange:204 Repaired 1961 keys during
&gt; active anti-entropy exchange of
&gt; {271177061614132377401074334195404075912721858560,3} between
&gt; {274031556999544297163190906134303066185487351808,'riak@10.173.240.3'}
&gt; and {276886052384956216925307478073202056458252845056,'riak@10.173.240.2'}
&gt; 2013-06-26 22:22:51.652 [info]
&gt; &lt;0.24761.8&gt;@riak\_kv\_exchange\_fsm:key\_exchange:204 Repaired 2010 keys during
&gt; active anti-entropy exchange of
&gt; {274031556999544297163190906134303066185487351808,3} between
&gt; {274031556999544297163190906134303066185487351808,'riak@10.173.240.3'}
&gt; and {276886052384956216925307478073202056458252845056,'riak@10.173.240.2'}
&gt;
&gt;
&gt; \*riak-admin status\*
&gt; Attempting to restart script through sudo -H -u riak
&gt; 1-minute stats for 'riak@10.173.240.3'
&gt; -------------------------------------------
&gt; riak\_kv\_stat\_ts : 1372288487
&gt; vnode\_gets : 254
&gt; vnode\_gets\_total : 159164
&gt; vnode\_puts : 0
&gt; vnode\_puts\_total : 42811
&gt; vnode\_index\_reads : 0
&gt; vnode\_index\_reads\_total : 3706
&gt; vnode\_index\_writes : 0
&gt; vnode\_index\_writes\_total : 42811
&gt; vnode\_index\_writes\_postings : 0
&gt; vnode\_index\_writes\_postings\_total : 0
&gt; vnode\_index\_deletes : 0
&gt; vnode\_index\_deletes\_total : 0
&gt; vnode\_index\_deletes\_postings : 0
&gt; vnode\_index\_deletes\_postings\_total : 0
&gt; node\_gets : 95
&gt; node\_gets\_total : 58191
&gt; node\_get\_fsm\_siblings\_mean : 0
&gt; node\_get\_fsm\_siblings\_median : 0
&gt; node\_get\_fsm\_siblings\_95 : 0
&gt; node\_get\_fsm\_siblings\_99 : 0
&gt; node\_get\_fsm\_siblings\_100 : 0
&gt; node\_get\_fsm\_objsize\_mean : 0
&gt; node\_get\_fsm\_objsize\_median : 0
&gt; node\_get\_fsm\_objsize\_95 : 0
&gt; node\_get\_fsm\_objsize\_99 : 0
&gt; node\_get\_fsm\_objsize\_100 : 0
&gt; node\_get\_fsm\_time\_mean : 1266
&gt; node\_get\_fsm\_time\_median : 1309
&gt; node\_get\_fsm\_time\_95 : 1526
&gt; node\_get\_fsm\_time\_99 : 2097
&gt; node\_get\_fsm\_time\_100 : 3879
&gt; node\_puts : 0
&gt; node\_puts\_total : 192
&gt; node\_put\_fsm\_time\_mean : 0
&gt; node\_put\_fsm\_time\_median : 0
&gt; node\_put\_fsm\_time\_95 : 0
&gt; node\_put\_fsm\_time\_99 : 0
&gt; node\_put\_fsm\_time\_100 : 0
&gt; read\_repairs : 0
&gt; read\_repairs\_total : 15325
&gt; coord\_redirs\_total : 126
&gt; executing\_mappers : 0
&gt; precommit\_fail : 0
&gt; postcommit\_fail : 0
&gt; pbc\_active : 0
&gt; pbc\_connects : 8
&gt; pbc\_connects\_total : 2834
&gt; read\_repairs\_primary\_notfound\_one : 0
&gt; read\_repairs\_primary\_notfound\_count : 23123
&gt; read\_repairs\_fallback\_notfound\_one : 0
&gt; read\_repairs\_fallback\_notfound\_count : 1869
&gt; leveldb\_read\_block\_error : 0
&gt; riak\_pipe\_stat\_ts : 1372288486
&gt; pipeline\_active : 0
&gt; pipeline\_create\_count : 0
&gt; pipeline\_create\_one : 0
&gt; pipeline\_create\_error\_count : 0
&gt; pipeline\_create\_error\_one : 0
&gt; cpu\_nprocs : 418
&gt; cpu\_avg1 : 5
&gt; cpu\_avg5 : 18
&gt; cpu\_avg15 : 26
&gt; mem\_total : 2082766848
&gt; mem\_allocated : 938852352
&gt; disk : [{"/",974010980,1},
&gt; {"/dev",1008180,1},
&gt; {"/run",406792,1},
&gt; {"/run/lock",5120,0},
&gt; {"/run/shm",1016976,0},
&gt; {"/boot",186663,17}]
&gt; nodename : 'riak@10.173.240.3'
&gt; connected\_nodes : ['riak@10.173.240.21','riak@10.173.240.2']
&gt; sys\_driver\_version : &lt;&lt;"2.0"&gt;&gt;
&gt; sys\_global\_heaps\_size : 0
&gt; sys\_heap\_type : private
&gt; sys\_logical\_processors : 4
&gt; sys\_otp\_release : &lt;&lt;"R15B01"&gt;&gt;
&gt; sys\_process\_count : 4665
&gt; sys\_smp\_support : true
&gt; sys\_system\_version : &lt;&lt;"Erlang R15B01 (erts-5.9.1) [source] [64-bit]
&gt; [smp:4:4] [async-threads:64] [kernel-poll:true]"&gt;&gt;
&gt; sys\_system\_architecture : &lt;&lt;"x86\_64-unknown-linux-gnu"&gt;&gt;
&gt; sys\_threads\_enabled : true
&gt; sys\_thread\_pool\_size : 64
&gt; sys\_wordsize : 8
&gt; ring\_members : ['riak@10.173.240.2','riak@10.173.240.21','
&gt; riak@10.173.240.3']
&gt; ring\_num\_partitions : 512
&gt; ring\_ownership : &lt;&lt;"[{'riak@10.173.240.21',170},\n 
&gt; {'riak@10.173.240.2',172},\n
&gt; {'riak@10.173.240.3',170}]"&gt;&gt;
&gt; ring\_creation\_size : 512
&gt; storage\_backend : riak\_kv\_eleveldb\_backend
&gt; erlydtl\_version : &lt;&lt;"0.7.0"&gt;&gt;
&gt; riak\_control\_version : &lt;&lt;"1.3.0"&gt;&gt;
&gt; cluster\_info\_version : &lt;&lt;"1.2.3"&gt;&gt;
&gt; riak\_search\_version : &lt;&lt;"1.3.0"&gt;&gt;
&gt; merge\_index\_version : &lt;&lt;"1.3.0"&gt;&gt;
&gt; riak\_kv\_version : &lt;&lt;"1.3.1"&gt;&gt;
&gt; riak\_api\_version : &lt;&lt;"1.3.1"&gt;&gt;
&gt; riak\_pipe\_version : &lt;&lt;"1.3.1"&gt;&gt;
&gt; riak\_core\_version : &lt;&lt;"1.3.1"&gt;&gt;
&gt; bitcask\_version : &lt;&lt;"1.6.1"&gt;&gt;
&gt; basho\_stats\_version : &lt;&lt;"1.0.3"&gt;&gt;
&gt; webmachine\_version : &lt;&lt;"1.9.3"&gt;&gt;
&gt; mochiweb\_version : &lt;&lt;"1.5.1p3"&gt;&gt;
&gt; inets\_version : &lt;&lt;"5.9"&gt;&gt;
&gt; erlang\_js\_version : &lt;&lt;"1.2.2"&gt;&gt;
&gt; runtime\_tools\_version : &lt;&lt;"1.8.8"&gt;&gt;
&gt; os\_mon\_version : &lt;&lt;"2.2.9"&gt;&gt;
&gt; riak\_sysmon\_version : &lt;&lt;"1.1.3"&gt;&gt;
&gt; ssl\_version : &lt;&lt;"5.0.1"&gt;&gt;
&gt; public\_key\_version : &lt;&lt;"0.15"&gt;&gt;
&gt; crypto\_version : &lt;&lt;"2.1"&gt;&gt;
&gt; sasl\_version : &lt;&lt;"2.2.1"&gt;&gt;
&gt; lager\_version : &lt;&lt;"1.2.2"&gt;&gt;
&gt; syntax\_tools\_version : &lt;&lt;"1.6.8"&gt;&gt;
&gt; compiler\_version : &lt;&lt;"4.8.1"&gt;&gt;
&gt; stdlib\_version : &lt;&lt;"1.18.1"&gt;&gt;
&gt; kernel\_version : &lt;&lt;"2.15.1"&gt;&gt;
&gt; memory\_total : 75985000
&gt; memory\_processes : 44614494
&gt; memory\_processes\_used : 44614480
&gt; memory\_system : 31370506
&gt; memory\_atom : 569961
&gt; memory\_atom\_used : 539061
&gt; memory\_binary : 3642608
&gt; memory\_code : 10232207
&gt; memory\_ets : 4826952
&gt;
&gt;
&gt; \*Data size in Riak:\*
&gt;
&gt; du -h --max-depth=1 /var/lib/riak/
&gt; \*\*\*\*\* 10.0.20.21 \*\*\*\*\*
&gt; 0 /var/lib/riak/bitcask
&gt; 132K /var/lib/riak/ring
&gt; 8.0K /var/lib/riak/mr\_queue
&gt; 2.1M /var/lib/riak/kv\_vnode
&gt; 899M /var/lib/riak/leveldb
&gt; 180M /var/lib/riak/anti\_entropy
&gt; 1.1G /var/lib/riak/
&gt; \*\*\*\*\* 10.0.20.22 \*\*\*\*\*
&gt; 0 /var/lib/riak/bitcask
&gt; 132K /var/lib/riak/ring
&gt; 8.0K /var/lib/riak/mr\_queue
&gt; 2.1M /var/lib/riak/kv\_vnode
&gt; 292M /var/lib/riak/leveldb
&gt; 220M /var/lib/riak/anti\_entropy
&gt; 513M /var/lib/riak/
&gt; \*\*\*\*\* 10.0.20.23 \*\*\*\*\*
&gt; 0 /var/lib/riak/bitcask
&gt; 64K /var/lib/riak/ring
&gt; 2.1M /var/lib/riak/kv\_vnode
&gt; 53M /var/lib/riak/leveldb
&gt; 23M /var/lib/riak/anti\_entropy
&gt; 77M /var/lib/riak/
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

