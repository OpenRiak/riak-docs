---
title: "Re: ssl support?"
description: ""
project: community
lastmod: 2012-08-03T10:36:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08178"
mailinglist_parent_id: "msg07931"
author_name: "Michael Johnson"
project_section: "mailinglistitem"
sent_date: 2012-08-03T10:36:49-07:00
---


Just in case anyone else is running into this same problem, it turns out
that the root cause is a failing in the way erlang R14B04. This is the
version of erlang bundled in the basho provided riak 1.1.4 packages as well
as the version provided by centos 5 and centos 6.

This problem is resolved in the current version of erlang (R15B01). Basho
currently does not plan on releasing new packages of riak 1.1.4 as riak 1.2
is about to be released and will be bundled with erlang R15B01 resolving
this problem.

If you need to resolve this problem with riak or any other erlang
application, you can build and install the current version of erlang and
then build the application against the newly installed erlang.

On Mon, Jul 16, 2012 at 8:48 AM, Michael Johnson  wrote:

&gt; I'll be filing this as a bug as it doesn't seem to be a configuration
&gt; problem. Perhaps most people aren't using SSL? While we could potentially
&gt; get away with network segregation, I would much prefer having the traffic
&gt; encrypted as well.
&gt; On Jul 13, 2012 3:08 PM, "Michael Johnson"  wrote:
&gt;
&gt;&gt; I gave compiling from source a try, but it did not make a difference.
&gt;&gt;
&gt;&gt; It turns out that for some reason, the method I have always used to
&gt;&gt; generate self-signed certificates doesn't seem to result in certificates
&gt;&gt; that work with riak even though they work for OpenLDAP, nginx, apache, and
&gt;&gt; other stuff.
&gt;&gt;
&gt;&gt; Here is the way I typically create certificates:
&gt;&gt;
&gt;&gt; openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout
&gt;&gt; /etc/riak/ssl.key -out /etc/riak/ssl.crt
&gt;&gt;
&gt;&gt; I like this because it's a simple one-liner. Basho does point you to
&gt;&gt; http://www.akadia.com/services/ssh\_test\_certificate.html for directions
&gt;&gt; on how to generate a certificate, and if you follow those directions, you
&gt;&gt; do indeed get a certificate that works with riak.
&gt;&gt;
&gt;&gt; If this only affected my self-signed certificates, I would be fine moving
&gt;&gt; on at this point. However, I have tried using certificates that a signed
&gt;&gt; by real ssl cert signing authorities and they have not been working either.
&gt;&gt;
&gt;&gt; I fully admit that I'm not an ssl expert, and have no idea what would be
&gt;&gt; the critical difference between my methodology for creating self-signed
&gt;&gt; certs, the methodology basho points to, and the way the legit cert I
&gt;&gt; tried was created/signed. Any insite?
&gt;&gt;
&gt;&gt; On Fri, Jul 13, 2012 at 2:06 PM, Michael Johnson wrote:
&gt;&gt;
&gt;&gt;&gt; (reposting with the rest of the thread removed... it was too big and
&gt;&gt;&gt; getting moderated)
&gt;&gt;&gt;
&gt;&gt;&gt; Yup, they are:
&gt;&gt;&gt;
&gt;&gt;&gt; [root@riak01 riak]# ls -al /etc/riak/ssl.\*
&gt;&gt;&gt; -rw-r--r--. 1 root root 2122 Jul 12 16:49 /etc/riak/ssl.crt
&gt;&gt;&gt; -rw-r--r--. 1 root root 3272 Jul 12 16:49 /etc/riak/ssl.key
&gt;&gt;&gt;
&gt;&gt;&gt; In fact, I straced the beam process to see if that would show anything
&gt;&gt;&gt; outside of what was showing up in the logs and noticed one thing that was
&gt;&gt;&gt; somewhat interesting. The process check to see if the cert and key files
&gt;&gt;&gt; are writeable (which they are not). On the off chance that that was
&gt;&gt;&gt; problematic, I changed the owner and group of the cert and key to be 'riak'
&gt;&gt;&gt; and the check for write access was succeeding, however it didn't change the
&gt;&gt;&gt; end result. Here is a snip from the strace before changing the owner and
&gt;&gt;&gt; group:
&gt;&gt;&gt;
&gt;&gt;&gt; 31520 stat("/etc/riak/ssl.crt", 
&gt;&gt;&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=2122, ...}) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.crt", R\_OK) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.crt", W\_OK) = -1 EACCES (Permission denied)
&gt;&gt;&gt; ...
&gt;&gt;&gt; 31520 stat("/etc/riak/ssl.key", 
&gt;&gt;&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=3272, ...}) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.key", R\_OK) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.key", W\_OK) = -1 EACCES (Permission denied)
&gt;&gt;&gt;
&gt;&gt;&gt; And after:
&gt;&gt;&gt; 31520 stat("/etc/riak/ssl.crt", 
&gt;&gt;&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=2122, ...}) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.crt", R\_OK) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.crt", W\_OK) = 0
&gt;&gt;&gt; ...
&gt;&gt;&gt; 31520 stat("/etc/riak/ssl.key", 
&gt;&gt;&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=3272, ...}) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.key", R\_OK) = 0
&gt;&gt;&gt; 31520 access("/etc/riak/ssl.key", W\_OK) = 0
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Jul 13, 2012 at 1:34 PM, Dave Parfitt wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Michael -
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [root@riak01 riak]# openssl verify /etc/riak/ssl.crt
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I see you are using root to create/verify these certs - are they
&gt;&gt;&gt;&gt; readable by the riak user?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

