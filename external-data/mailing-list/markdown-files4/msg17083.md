---
title: "Re: Ok, I am stumped. Losing data or riak stop"
description: ""
project: community
lastmod: 2016-02-26T08:15:05-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17083"
mailinglist_parent_id: "msg17082"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2016-02-26T08:15:05-08:00
---


Joe,

Are there any error messages in the leveldb LOG and/or LOG.old files? These 
files are located within each vnode's directory, likely 
/var/lib/riak/data/leveldb/\*/LOG\* on your machine.

The LOG files are not to be confused with 000xxx.log files. The lower case 
\*.log files are the recovery files that should contain the keys you are 
missing. If they are not loading properly, the LOG files should have clues.

Matthew

&gt; On Feb 26, 2016, at 11:04 AM, Christopher Mancini  wrote:
&gt; 
&gt; Hey Joe,
&gt; 
&gt; I will do my best to help, but I am not the most experienced with Riak 
&gt; operations. Your best bet to get to a solution as fast as possible is to 
&gt; include the full users group, which I have added to the recipients of this 
&gt; message.
&gt; 
&gt; 1. Are the Riak data directories within Vagrant shared directories between 
&gt; the host and guest? I have had issues with OS file system caching before when 
&gt; working with web server files.
&gt; 
&gt; 2. What version of Ubuntu are you using?
&gt; 
&gt; 3. How did you install Riak on Ubuntu?
&gt; 
&gt; 4. Have you tried restoring the original distribution riak.conf file and seen 
&gt; if the issue persists? This would help you determine if the issue is your 
&gt; config or something with your environment.
&gt; 
&gt; Chris
&gt; 
&gt; On Fri, Feb 26, 2016 at 10:55 AM Joe Olson  &gt; wrote:
&gt; 
&gt; Chris - 
&gt; 
&gt; I cannot figure out what is going on. Here is my test case. Configuration 
&gt; file attached. I am running a single node of Riak on a vagrant box with a 
&gt; level DB back end. I don't even have to bring the box down, merely stopping 
&gt; and restarting riak '(riak stop' and 'riak start' or 'risk restart) causes 
&gt; all the keys to be lost. The riak node is set up on a Vagrant box. But 
&gt; again....I do not have to bring the machine up or down to get this error.
&gt; 
&gt; I've also deleted the ring info in /var/lib/riak/ring, and deleted all the 
&gt; leveldb files. In this case, the bucket type is just n\_val = 1, and the ring 
&gt; size is the minimum of 8. 
&gt; 
&gt; Is it possible Riak is not flushing RAM to disk after write? The keys only 
&gt; reside in RAM?
&gt; 
&gt; My test procedure:
&gt; 
&gt; ====On a remote machine=====
&gt; 
&gt; riak01@ubuntu:/etc$ curl -i http:// 
&gt; &lt;&gt;:8098/types/n1/buckets/test/keys?keys=true
&gt; HTTP/1.1 200 OK
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho)
&gt; Date: Fri, 26 Feb 2016 13:14:59 GMT
&gt; Content-Type: application/json
&gt; Content-Length: 17
&gt; 
&gt; {"keys":["test"]}
&gt; 
&gt; riak01@ubuntu:/etc$
&gt; 
&gt; 
&gt; 
&gt; ====On the single Riak node itself====
&gt; 
&gt; [vagrant@i-2016022519 -9bb5c84f riak]$ sudo riak stop
&gt; ok
&gt; [vagrant@i-2016022519 -9bb5c84f riak]$ sudo riak start
&gt; [vagrant@i-2016022519 -9bb5c84f riak]$ sudo riak ping
&gt; pong
&gt; 
&gt; 
&gt; 
&gt; ====Back to the remote machine====
&gt; 
&gt; riak01@ubuntu:/etc$ curl -i http:// 
&gt; &lt;&gt;:8098/types/n1/buckets/test/keys?keys=true
&gt; HTTP/1.1 200 OK
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho)
&gt; Date: Fri, 26 Feb 2016 13:16:34 GMT
&gt; Content-Type: application/json
&gt; Content-Length: 11
&gt; 
&gt; {"keys":[]}
&gt; 
&gt; riak01@ubuntu:/etc$
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sincerely,
&gt; 
&gt; Christopher Mancini
&gt; -----------------------------
&gt; 
&gt; employee = {
&gt; purpose: solve problems with code,
&gt; phone: 7164625591,
&gt; email: cmanc...@basho.com ,
&gt; github: http://www.github.com/christophermancini 
&gt; 
&gt; }
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

