---
title: "Re: Secondary index maintenance"
description: ""
project: community
lastmod: 2013-02-20T06:54:26-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10153"
mailinglist_parent_id: "msg10152"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2013-02-20T06:54:26-08:00
---



On 20 Feb 2013, at 14:35, Theo Bot  wrote:

&gt; Hi
&gt; 
&gt; It's not that I want to use the erlang client. It's just that I want to know 
&gt; to to create http queries to maintain the secondary indexes.

Ah, OK.

Sorry for the confusion. Updating the indexes is just like updating a value or 
any other object meta-data in riak, you need to fetch the whole value, change 
it, and send it back.

To delete all the indexes for a key just POST that keys value to riak's HTTP, 
without the x-riak-index headers.
To remove particular index(es) just POST that keys value to riak's HTTP 
interface minus the x-riak-index headers for the index you want to remove.

For example, say you created (as per the riak docs example[1]) 

 curl -X POST \
 -H 'x-riak-index-twitter\_bin: jsmith123' \
 -H 'x-riak-index-email\_bin: jsm...@basho.com' \
 -d'...user data...' \
 http://localhost:8098/buckets/users/keys/john\_smith

When you read the data back with `curl -v 
localhost:8098/buckets/users/keys/john\_smith` you get:

&lt; HTTP/1.1 200 OK
&lt; X-Riak-Vclock: a85hYGBgzGDKBVIcypz/fgbKiqhmMCUy57EyfImZeYovCwA=
&lt; x-riak-index-twitter\_bin: jsmith123
&lt; x-riak-index-email\_bin: jsm...@basho.com
&lt; Vary: Accept-Encoding
&lt; Server: MochiWeb/1.1 WebMachine/1.9.2 (someone had painted it blue)
&lt; Link: ; rel="up"
&lt; Last-Modified: Wed, 20 Feb 2013 14:43:00 GMT
&lt; ETag: "7DdYGiY7JujKiCVTTXp51M"
&lt; Date: Wed, 20 Feb 2013 14:43:10 GMT
&lt; Content-Type: application/x-www-form-urlencoded
&lt; Content-Length: 15
&lt; 
\* Connection #0 to host localhost left intact
...user data...\* Closing connection #0

Those x-riak-index headers are your indexes. To remove one just post back the 
object, minus the index you want to remove. So to drop the 'twitter' index:

curl -X POST http://localhost:8098/buckets/users/keys/john\_smith -d"...user 
data..." \
 -H"X-Riak-Vclock: a85hYGBgzGDKBVIcypz/fgbKiqhmMCUy57EyfImZeYovCwA=" \
 -H 'x-riak-index-email\_bin: jsm...@basho.com'

When you read the value again you'll see it now only has one index.

I guess your client will need to parse out those index headers into some useful 
structure, and expose a way for the user to add / edit / remove indexes, and 
your client then needs to generate headers to post back to riak.

Does that cover it?

Cheers

Russell

[1] 
http://docs.basho.com/riak/latest/tutorials/querying/Secondary-Indexes/#Query-Interfaces-and-Examples


&gt; 
&gt; Theo
&gt; 
&gt; 
&gt; On Wed, Feb 20, 2013 at 3:30 PM, Christian Dahlqvist  
&gt; wrote:
&gt; Hi Theo,
&gt; 
&gt; The Riak HTTP client for Erlang uses the 'riakc\_obj' from the PB client to 
&gt; represent records. You can therefore use any utility functions available 
&gt; there to manipulate metadata. The HTTP client for Erlang does however 
&gt; currently not support secondary indexes [1], meaning that these will not be 
&gt; parsed nor sent when getting or putting an object.
&gt; 
&gt; [1] http://docs.basho.com/riak/1.3.0rc4/references/Client-Libraries/#HTTP
&gt; 
&gt; Best regards,
&gt; 
&gt; Christian
&gt; 
&gt; 
&gt; On 20 Feb 2013, at 08:41, Theo Bot  wrote:
&gt; 
&gt;&gt; Hi
&gt;&gt; 
&gt;&gt; I found in the erlang client that there are methods 
&gt;&gt; (clear\_secondary\_indexes, delete\_secondary\_index) in the pb api to maintain 
&gt;&gt; the secondary index of objects. However in the http api I cannot find such 
&gt;&gt; methods.
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; Kind regards
&gt;&gt; 
&gt;&gt; Theo Bot
&gt;&gt; Network Management Engineer
&gt;&gt; e-mail: theo....@proxy.nl
&gt;&gt; Website: http://www.proxy.nl
&gt;&gt; LinkedIn: http://www.linkedin.com/in/theobot
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Met vriendelijke groet,
&gt; 
&gt; Theo Bot
&gt; Network Management Engineer
&gt; Tel: +31653965698
&gt; e-mail: theo....@proxy.nl
&gt; Website: http://www.proxy.nl
&gt; LinkedIn: http://www.linkedin.com/in/theobot
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

