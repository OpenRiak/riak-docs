---
title: "Re: Schema Architecture, Map Reduce & Key Lists"
description: ""
project: community
lastmod: 2011-02-10T10:20:27-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02269"
mailinglist_parent_id: "msg02268"
author_name: "Mat Ellis"
project_section: "mailinglistitem"
sent_date: 2011-02-10T10:20:27-08:00
---


That's interesting. Unfortunately I think a smart key would simply shift the 
problem elsewhere as we also generate a UUID so clicks can be converted when a 
conversion event occurs. So we either have a UUID as the key (and can quickly 
look up a click to see if it's valid and then the associated data if it is) or 
we can have a Smart Key and can easily lookup the associated data. Either way 
the posting I linked to suggests that unless I supply long lists of keys I have 
to scan \*all\* keys in \*all\* buckets, no matter how much I segment my data into 
separate (i.e. smaller) "sub-" buckets. 

The auto-expire feature will definitely be handy. We'll look at that.

Does anyone have:

(a) opinions on addressing this issue using Ripple's "many" and "one" 
associations? It seems I could end up with a placement record with millions of 
clicks attached

(b) any good examples of Ripple's associations being used in real code (as 
opposed to examples here 
http://seancribbs.github.com/ripple/Ripple/Associations.html) and/or a 
discussion about Ripple::Document vs Ripple::EmbeddedDocument?

M.



On Feb 10, 2011, at 9:52 AM, Jeremiah Peschka wrote:

&gt; Riak 0.14 brings key filters - it's still going to take time to filter the 
&gt; keys in memory, but it's an in memory operation. Using 'smart keys' along the 
&gt; lines of UNIXTIMESTAMP:placement:campaign:customer you can rapidly filter 
&gt; your keys using meaningful criteria and perform MapReduce jobs on the results.
&gt; 
&gt; Nothing says you can't also store the same data in multiple buckets in 
&gt; multiple formats to make querying easier.
&gt; 
&gt; In response to number 2 - there's a way to set Riak to auto expire data from 
&gt; a bucket. It'll only be removed when compactions occur, but if you're storing 
&gt; clickstream data that should be happen often enough.
&gt; 
&gt; -- 
&gt; Jeremiah Peschka
&gt; Microsoft SQL Server MVP
&gt; MCITP: Database Developer, DBA
&gt; On Thursday, February 10, 2011 at 9:35 AM, Mat Ellis wrote:
&gt; 
&gt;&gt; We are converting a mysql based schema to Riak using Ripple. We're tracking 
&gt;&gt; a lot of clicks, and each click belongs to a cascade of other objects:
&gt;&gt; 
&gt;&gt; click -&gt; placement -&gt; campaign -&gt; customer
&gt;&gt; 
&gt;&gt; i.e. we do a lot of operations on these clicks grouped by placement or sets 
&gt;&gt; of placements.
&gt;&gt; 
&gt;&gt; Reading this 
&gt;&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2010-July/001591.html
&gt;&gt; gave me pause for thought. I was hoping the time needed to crunch each 
&gt;&gt; day's data would be proportional to the volume of clicks on that day but it 
&gt;&gt; seems that it would be proportional to the total number of clicks ever.
&gt;&gt; 
&gt;&gt; What's the best approach here? I can see a number of 'solutions' each of 
&gt;&gt; them complicated:
&gt;&gt; 
&gt;&gt; (1) Maintain an index of clicks by day so that we can focus our operations 
&gt;&gt; on a time bound set of clicks
&gt;&gt; 
&gt;&gt; (2) Delete or archive clicks once they have been processed or after a 
&gt;&gt; certain number of days
&gt;&gt; 
&gt;&gt; (3) Add many links to each placement, one per click (millions potentially)
&gt;&gt; 
&gt;&gt; On a related noob-note, what would be the best way of creating a set of the 
&gt;&gt; clicks for a given placement? Map Reduce or Riak Search or some other method?
&gt;&gt; 
&gt;&gt; Thanks in advance.
&gt;&gt; 
&gt;&gt; M.
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

