---
title: "Re: uneven disk distribution"
description: ""
project: community
lastmod: 2015-06-04T06:53:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16200"
mailinglist_parent_id: "msg16139"
author_name: "Johnny Tan"
project_section: "mailinglistitem"
sent_date: 2015-06-04T06:53:18-07:00
---


To followup:

Since we use chef (configuration management), the riak configs are the same
across all our riak nodes (except for stuff like hostnames/IPs, etc.).

I ran riak\_kv:repair and it looks like it had fixed the problem on node
004, but then a \_different\_ node (002) started to throw a bunch of locking
errors. (I thought I saved a copy of that log somewhere but can't seem to
find it now, and the old ones are rotated out.)

Nothing I did would stem those errors on 002, even though 004 seemed
perfectly fine after the repair. In the end, I rm'd 002's bitcask
directory, rejoined the cluster, and it seems to now be back in shape. No
errors, the nodes are all relatively similar in size -- 002 lags a little
behind the others, but not in a worrisome way.

I'm sure this was related to Bitcask merging, I just still haven't
pinpointed what it was. But I appreciate the input and suggestions.

johnny

On Fri, May 15, 2015 at 4:48 PM, Charlie Voiselle 
wrote:

&gt; Johnny:
&gt;
&gt; Something else to look for would be any errors in the console.log related
&gt; to Bitcask merging. It would be interesting to see if the unusual disk
&gt; utilization was related to a specific partition. If it is, you could
&gt; consider removing that particular partition and running riak\_kv:repair to
&gt; restore the replicas from the adjacent partitions. I can provide more
&gt; information if you find that to be the case.
&gt;
&gt; Regards,
&gt; Charlie Voiselle
&gt; Client Services, Basho
&gt;
&gt;
&gt; On May 14, 2015 10:06 PM, "Engel Sanchez"  wrote:
&gt;
&gt;&gt; Hi Johnny. Make sure that the configuration on that node is not different
&gt;&gt; to the others. For example, it could be configured to never merge Bitcask
&gt;&gt; files, so that space could never be reclaimed.
&gt;&gt;
&gt;&gt;
&gt;&gt; http://docs.basho.com/riak/latest/ops/advanced/backends/bitcask/#Configuring-Bitcask
&gt;&gt;
&gt;&gt; On Thu, May 14, 2015 at 4:31 PM, Johnny Tan  wrote:
&gt;&gt;
&gt;&gt;&gt; We have a 6-node test riak cluster. One of the nodes seems to be using
&gt;&gt;&gt; far more disk:
&gt;&gt;&gt; staging-riak001.pp /dev/sda3 15G 6.3G 7.2G 47% /
&gt;&gt;&gt; staging-riak002.pp /dev/sda3 15G 6.4G 7.1G 48% /
&gt;&gt;&gt; staging-riak003.pp /dev/sda3 15G 6.1G 7.5G 45% /
&gt;&gt;&gt; staging-riak004.pp /dev/sda3 15G 14G 266M 99% /
&gt;&gt;&gt; staging-riak005.pp /dev/sda3 15G 5.8G 7.7G 44% /
&gt;&gt;&gt; staging-riak006.pp /dev/sda3 15G 6.3G 7.3G 47% /
&gt;&gt;&gt;
&gt;&gt;&gt; Specifically, /var/lib/riak/bitcask is using up most of that space. It
&gt;&gt;&gt; seems to have files in there that are much older than any of the other
&gt;&gt;&gt; nodes. We've done maintenance of various sort on this cluster -- as the
&gt;&gt;&gt; name indicates, we use it as a staging ground before we go to production. I
&gt;&gt;&gt; don't recall a specific issue per se, but I wouldn't rule it out.
&gt;&gt;&gt;
&gt;&gt;&gt; Is there a way to figure out if there's an underlying issue here, or
&gt;&gt;&gt; whether some of this disk space is not really current and can somehow be
&gt;&gt;&gt; purged?
&gt;&gt;&gt;
&gt;&gt;&gt; What info would help answer those questions?
&gt;&gt;&gt;
&gt;&gt;&gt; johnny
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

