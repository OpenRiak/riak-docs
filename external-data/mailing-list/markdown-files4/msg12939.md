---
title: "Re: max_files_limit and AAE"
description: ""
project: community
lastmod: 2013-11-11T12:11:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12939"
mailinglist_parent_id: "msg12938"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2013-11-11T12:11:59-08:00
---


Hi Dave,

Just to confirm that the ulimit settings "stuck", could you please run riak
attach and execute the following Erlang snippet?

os:cmd('ulimit -n').

The period is significant and please exit using CTRL-C twice.

Thanks!
--
Luke Bakken
CSE
lbak...@basho.com


On Mon, Nov 11, 2013 at 11:56 AM, Dave Brady  wrote:

&gt; Hey Everyone,
&gt;
&gt; We have a five-node, 128 partition cluster running 1.4.2 on Debian.
&gt;
&gt; Is there a doc somewhere that explains how to size max\_open\_files as it
&gt; applies to AAE?
&gt;
&gt; I have max\_open\_files for eLevelDB set to 3000, as we have about 1500 .sst
&gt; files in one VNode's data directory, and the boxes have plenty of RAM.
&gt;
&gt; I set max\_open\_files in the AAE section to 3000, too, on whim after we had
&gt; our first issue. Still got these in the logs on a couple of nodes after
&gt; running for less than one day:
&gt;
&gt; ===============
&gt; 2013-11-09 11:37:12.438 [info]
&gt; &lt;0.857.0&gt;@riak\_kv\_vnode:maybe\_create\_hashtrees:142
&gt; riak\_kv/125597796958124469533129165311555572001681702912: unable to start
&gt; index\_hashtree: {error,{{badmatch,{error,{db\_open,"IO error:
&gt; /var/lib/riak/anti\_entropy/125597796958124469533129165311555572001681702912/LOCK:
&gt; Too many open
&gt; files"}}},[{hashtree,new\_segment\_store,2,[{file,"src/hashtree.erl"},{line,499}]},{hashtree,new,2,[{file,"src/hashtree.erl"},{line,215}]},{riak\_kv\_index\_hashtree,do\_new\_tree,2,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,426}]},{lists,foldl,3,[{file,"lists.erl"},{line,1197}]},{riak\_kv\_index\_hashtree,init\_trees,2,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,366}]},{riak\_kv\_index\_hashtree,init,1,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,226}]},{gen\_server,init\_it,6,[{file,"gen\_server.erl"},{line,304}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,227}]}]}}
&gt; 2013-11-09 11:37:12.441 [error] &lt;0.5209.2422&gt; gen\_server &lt;0.5209.2422&gt;
&gt; terminated with reason: no match of right hand value {error,{db\_write,"IO
&gt; error:
&gt; /var/lib/riak/anti\_entropy/125597796958124469533129165311555572001681702912/011260.log:
&gt; Too many open files"}} in hashtree:flush\_buffer/1 line 302
&gt; 2013-11-09 11:37:12.441 [error] &lt;0.5209.2422&gt; CRASH REPORT Process
&gt; &lt;0.5209.2422&gt; with 1 neighbours exited with reason: no match of right hand
&gt; value {error,{db\_write,"IO error:
&gt; /var/lib/riak/anti\_entropy/125597796958124469533129165311555572001681702912/011260.log:
&gt; Too many open files"}} in hashtree:flush\_buffer/1 line 302 in
&gt; gen\_server:terminate/6 line 747
&gt; 2013-11-09 11:37:12.441 [error] &lt;0.19959.2426&gt; CRASH REPORT Process
&gt; &lt;0.19959.2426&gt; with 0 neighbours exited with reason: no match of right hand
&gt; value {error,{db\_open,"IO error:
&gt; /var/lib/riak/anti\_entropy/125597796958124469533129165311555572001681702912/LOCK:
&gt; Too many open files"}} in hashtree:new\_segment\_store/2 line 499 in
&gt; gen\_server:init\_it/6 line 328
&gt; ===============
&gt;
&gt; Our init script has "ulimit -n 65536" in it, which I \*thought\* that would
&gt; be high enough. Maybe not?
&gt;
&gt; I also made the necessary tweaks to /etc/pam.d/common-session\*, so that
&gt; /etc/security/limts.conf would be read, and that did not help.
&gt;
&gt; Much obliged for any suggestions!
&gt; --
&gt; Dave Brady
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

