---
title: "Re: Missing keys in bucket?"
description: ""
project: community
lastmod: 2013-09-03T09:05:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12188"
mailinglist_parent_id: "msg12189"
author_name: "Anders Hedström"
project_section: "mailinglistitem"
sent_date: 2013-09-03T09:05:00-07:00
---


The funny thing is that there's no delete's issued... Can I still get
Tombstone objects?


On Tue, Sep 3, 2013 at 4:30 PM, Jeremiah Peschka  wrote:

&gt; TL;DR: Distributed databases are spooky, your app must account for
&gt; entertaining side effects like you described.
&gt;
&gt; Long form:
&gt;
&gt; There is some window of time between issuing a delete, Riak writing the
&gt; initial tombstone, and then Riak deleting the underlying data from disk [1].
&gt;
&gt; In any situation where you're querying for data and there's a chance it
&gt; could go away, you need to make sure that you're double checking that the
&gt; data is present and that you're accounting for failures.
&gt;
&gt; Secondary indexes ($bucket included) perform a coverage query. That is -
&gt; when you query an index, Riak will not read from R partitions (notice that
&gt; you can't set an R-value for index reads?), instead it reads from enough
&gt; partitions to get 1 copy of the data. See [2] for more details on coverage
&gt; queries.
&gt;
&gt; In theory, you could be reading rows from a node before the delete has
&gt; been replicated or between the tombstoning and reclamation of the object.
&gt;
&gt; [1]:
&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2011-October/006048.html
&gt; [2]:
&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2011-October/006237.html
&gt;
&gt;
&gt;
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt;
&gt;
&gt; On Fri, Aug 30, 2013 at 5:54 AM, Anders Hedström &lt;
&gt; anders.hedstr...@gmail.com&gt; wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I've got a riak cluster with 3 nodes.
&gt;&gt;
&gt;&gt; I use the $bucket index to get all keys for a bucket. Then I loop thru
&gt;&gt; the returned list and try to fetch each object for each key. For some keys
&gt;&gt; that was returned I get a 404 back when trying to fetch the object... How
&gt;&gt; is this possible? What can have gone wrong? I've got no clue... When the
&gt;&gt; $bucket index returns a key I expect it to exist.
&gt;&gt;
&gt;&gt; I appreciate any response...
&gt;&gt;
&gt;&gt; Cheers
&gt;&gt; //Anders
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;


-- 
-------------------------------------------------
LinkedIn: http://www.linkedin.com/in/andershedstrom
GTalk: anders.hedstr...@gmail.com
Skype: anders.hedstrom
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

