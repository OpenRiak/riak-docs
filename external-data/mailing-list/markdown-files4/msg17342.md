---
title: "Re: Precommit hook function - no error log - how to debug?"
description: ""
project: community
lastmod: 2016-05-13T07:41:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17342"
mailinglist_parent_id: "msg17339"
author_name: "Sanket Agrawal"
project_section: "mailinglistitem"
sent_date: 2016-05-13T07:41:16-07:00
---


Hi Luke,

I renamed precommit to pre\_triggers, and then re-associated the hook to
bucket type instead of bucket as you suggested. Also, started redbug on all
three consoles, and confirmed that it started. Then, I made the call that
should trigger the hooks, but nothing triggered. The module shows up fine
in each of the consoles. This is the output I got after redbug timed out
(after the testing):

redbug done, timeout - 0


Also, sasl-error log is still not being created, just in case this matters
(if the log is supposed to be created when enabled). I added this
configuration in advanced.config (with different paths for each of the
nodes):
{sasl,[sasl\_error\_logger,{file, "/home/ec2-user/riak/riak1/log/sasl.log"}]}

On Fri, May 13, 2016 at 10:07 AM, Luke Bakken  wrote:

&gt; Sanket -
&gt;
&gt; One other thought. Could you please change the name of your module to
&gt; something other than "precommit"? That is the atom being used for
&gt; precommit hooks and maybe that's causing an issue.
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt;
&gt; On Fri, May 13, 2016 at 7:05 AM, Luke Bakken  wrote:
&gt; &gt; Hi Sanket -
&gt; &gt;
&gt; &gt; Could you please try \*removing\* the precommit hook from the "uuid\_log"
&gt; &gt; bucket and define it on the "test\_kv\_wo" bucket type instead?
&gt; &gt;
&gt; &gt; Removal:
&gt; &gt; curl -4vvv -H 'Content-Type: application/json' -X PUT
&gt; &gt; localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props -d
&gt; &gt; '{"props":{"precommit":[]}}'
&gt; &gt;
&gt; &gt; Confirm:
&gt; &gt; curl -4vvv localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props
&gt; &gt;
&gt; &gt; Add precommit hook to bucket type:
&gt; &gt; curl -4vvv -H 'Content-Type: application/json' -X PUT
&gt; &gt; localhost:8098/types/test\_kv\_wo/props -d
&gt; &gt; '{"props":{"precommit":[{"mod":"precommit","fun":"pre\_uuid"}]}}'
&gt; &gt;
&gt; &gt; Confirm:
&gt; &gt; curl -4vvv localhost:8098/types/test\_kv\_wo/props
&gt; &gt;
&gt; &gt; You can then use redbug to trace calls within Erlang:
&gt; &gt;
&gt; &gt; riak attach
&gt; &gt;
&gt; &gt; The following statement will wait for up to 10 minutes and will
&gt; &gt; display up to 10 calls to your pre\_uuid function. Note that the period
&gt; &gt; is significant:
&gt; &gt;
&gt; &gt; redbug:start(600000, 10, "precommit:pre\_uuid/1-&gt;return").
&gt; &gt;
&gt; &gt; If you run the above redbug statement on all nodes, you should see one
&gt; &gt; or more outputs showing that it was called. You can confirm that
&gt; &gt; redbug is working by tracing calls to now():
&gt; &gt;
&gt; &gt; redbug:start("erlang:now/0").
&gt; &gt;
&gt; &gt; --
&gt; &gt; Luke Bakken
&gt; &gt; Engineer
&gt; &gt; lbak...@basho.com
&gt; &gt;
&gt; &gt; On Tue, May 10, 2016 at 6:49 PM, Sanket Agrawal
&gt; &gt;  wrote:
&gt; &gt;&gt; One more thing - I set up the hooks by bucket, not bucket type. The
&gt; &gt;&gt; documentation for 2.1.4 says that hooks are defined on the bucket level.
&gt; &gt;&gt; Here is how I set up precommit hook (derived from "Riak Handbook" p95):
&gt; &gt;&gt;
&gt; &gt;&gt; curl -X PUT localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props -H
&gt; &gt;&gt; 'Content-Type: application/json' -d '{ "props": { "precommit": [{"mod":
&gt; &gt;&gt; "precommit", "fun": "pre\_uuid"}]}}' -v
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; On Tue, May 10, 2016 at 9:15 PM, Sanket Agrawal &lt;
&gt; sanket.agra...@gmail.com&gt;
&gt; &gt;&gt; wrote:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I just set up a precommit hook function in dev environment (KV 2.1.4)
&gt; &gt;&gt;&gt; which doesn't seem to be triggering off at all. The object is being
&gt; stored
&gt; &gt;&gt;&gt; in the bucket, but the precommit logic is not kicking off. I checked
&gt; couple
&gt; &gt;&gt;&gt; of things as listed below but came up with no error - so, it is a
&gt; &gt;&gt;&gt; head-scratcher why precommit hook is not triggering:
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

