---
title: "Re: Query data with Riak TS"
description: ""
project: community
lastmod: 2016-11-14T08:07:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17745"
mailinglist_parent_id: "msg17744"
author_name: "Andrei Zavada"
project_section: "mailinglistitem"
sent_date: 2016-11-14T08:07:09-08:00
---


On Mon, Nov 14, 2016 at 5:44 PM, Jan Paulus 
wrote:

&gt; Hello Andrei,
&gt;
&gt;
&gt;
&gt; thanks for the answer. It is good news that 1.5 will get the ODER BY and
&gt; LIMIT functionality.
&gt;
&gt; Unfortunately the current AVG implementation is not exactly what we are
&gt; looking for. The current implementation will sum up all points in the time
&gt; range and will it divide by the number of points. Currently Riak TS return
&gt; 4.5 for my example. We are looking for an average which takes into account
&gt; how long a value was persistent.
&gt;
&gt; ​
This​ seems to be a peculiar requirement that Riak TS cannot accommodate
(sorry for not reading your explanation carefully enough). Indeed, the AVG
function operates on numeric values as isolated scalars, and has no
knowledge of how long each value has persisted.


&gt;
&gt; Kind Regards,
&gt;
&gt; Jan Paulus
&gt;
&gt;
&gt;
&gt; \*Von:\* Andrei Zavada [mailto:azav...@contractor.basho.com]
&gt; \*Gesendet:\* Montag, 14. November 2016 16:19
&gt; \*An:\* Jan Paulus
&gt; \*Cc:\* riak-users@lists.basho.com
&gt; \*Betreff:\* Re: Query data with Riak TS
&gt;
&gt;
&gt;
&gt; Hello Jan,
&gt;
&gt;
&gt;
&gt; R​eplying to your questions inline:​​
&gt;
&gt; ​
&gt;
&gt; Hi,
&gt;
&gt; we are testing Riak TS for our Application right now. I have a couple of
&gt; question how to query the data. We are measuring electric power which comes
&gt; in in odd time intervals.
&gt;
&gt;
&gt;
&gt; 1. Is it possible to query the value which has been received bevor at a
&gt; given time? In other words: Get the current / last value of a series.
&gt;
&gt;
&gt;
&gt; In Riak TS 1.4 (the latest release), you still have to specify the exact
&gt; range ​in the WHERE clause. Because of that, if you are only interested
&gt; in a single record that was added last before a certain time, you have to
&gt; do some guesswork to arrive at the suitable boundaries. Depending on the
&gt; rate of data ingress, the selection returned may contain one, a few, too
&gt; many, or no results at all. One workaround is to issue a sequence of
&gt; SELECTs, starting from a small range, with the lower boundary of the range
&gt; progressively moved back until you have the last record included (and
&gt; hopefully not many previous records which you are going to discard anyway).
&gt;
&gt;
&gt;
&gt; In 1.5, we will support ORDER BY and LIMIT clauses which will allow a much
&gt; simpler solution, e.g.:
&gt;
&gt;
&gt;
&gt; SELECT value FROM table
&gt; WHERE time &gt; 0 AND time &lt; $now
&gt; ORDER BY value DESC LIMIT 1
&gt;
&gt;
&gt;
&gt; 2. Is it possible to query the average in respect to time?
&gt; For instance you have such a measurement reading:
&gt; time | value
&gt; -----------------
&gt; 09:31 | 4
&gt; 10:02 | 6
&gt; 10:05 | 3
&gt; And you want to query the average from 10:00 to 10:10. I would expect a
&gt; value of 4.1
&gt; 4 \* 20% + 6 \* 30% + 3 \* 50% = 4.1
&gt;
&gt;
&gt;
&gt; ​It is definitely possible:​
&gt;
&gt;
&gt;
&gt; ﻿⁠⁠⁠⁠SELECT AVG(val
&gt;
&gt; ​ue​
&gt;
&gt; ) FROM
&gt;
&gt; ​table
&gt;
&gt; ​
&gt;
&gt; WHERE time &gt;
&gt;
&gt; ​=​
&gt;
&gt; ​'​2016-11-22
&gt;
&gt; 10
&gt;
&gt; ​:00'​
&gt;
&gt; AND time &lt;
&gt;
&gt; ​'2016-11-22 ​
&gt;
&gt; ​10:10'​
&gt;
&gt;
&gt;
&gt; ​Note that you can specify timestamp values in ISO8601 format:
&gt; http://docs.basho.com/riak/ts/1.4.0/using/timerepresentations
&gt;
&gt;
&gt;
&gt; ​
&gt;
&gt; 3. Is it possible to query 15 minutes average values for the last day? I
&gt; would expect 96 values with the average as described in question 2.
&gt;
&gt;
&gt;
&gt; No, you will have to issue 96 separate queries, each similar to the one in
&gt; (2) but with a different 15-min range.​
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; Thanks a lot.
&gt; Jan Paulus
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

