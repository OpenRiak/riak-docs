---
title: "Re: Put failure: too many siblings"
description: ""
project: community
lastmod: 2016-06-17T01:46:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17488"
mailinglist_parent_id: "msg17487"
author_name: "Vladyslav Zakhozhai"
project_section: "mailinglistitem"
sent_date: 2016-06-17T01:46:55-07:00
---


Hi Russel,

thank you for your answer. I really appreciate your help.

2.1.3 is not actually riak\_kv version. It is version of basho's riak
package. Versions of riak subsystems you can see below.

Bucket properties:
# riak-admin bucket-type list
default (active)

# riak-admin bucket-type status default
default is active

allow\_mult: true
basic\_quorum: false
big\_vclock: 50
chash\_keyfun: {riak\_core\_util,chash\_std\_keyfun}
dvv\_enabled: false
dw: quorum
last\_write\_wins: false
linkfun: {modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}
n\_val: 3
notfound\_ok: true
old\_vclock: 86400
postcommit: []
pr: 0
precommit: []
pw: 0
r: quorum
rw: quorum
small\_vclock: 50
w: quorum
write\_once: false
young\_vclock: 20

I did not mentioned that upgrade from riak 1.5.4 have been took place
couple months ago (about 6 months). As I understand DVV is disabled. Is it
safe to migrate to setting DVV from Vector Clocks?

Package versions:
# dpkg -l | grep riak
ii riak 2.1.3-1
 amd64 Riak is a distributed data store
ii riak-cs 2.1.0-1
 amd64 Riak CS

Subsystems versions:
"clique\_version" : "0.3.2-0-ge332c8f",
"bitcask\_version" : "1.7.2",
"sys\_driver\_version" : "2.2",
"riak\_core\_version" : "2.1.5-0-gb02ab53",
"riak\_kv\_version" : "2.1.2-0-gf969bba",
"riak\_pipe\_version" : "2.1.1-0-gb1ac2cf",
"cluster\_info\_version" : "2.0.3-0-g76c73fc",
"riak\_auth\_mods\_version" : "2.1.0-0-g31b8b30",
"erlydtl\_version" : "0.7.0",
"os\_mon\_version" : "2.2.13",
"inets\_version" : "5.9.6",
"erlang\_js\_version" : "1.3.0-0-g07467d8",
"riak\_control\_version" : "2.1.2-0-gab3f924",
"xmerl\_version" : "1.3.4",
"protobuffs\_version" : "0.8.1p5-0-gf88fc3c",
"riak\_sysmon\_version" : "2.0.0",
"compiler\_version" : "4.9.3",
"eleveldb\_version" : "2.1.10-0-g0537ca9",
"lager\_version" : "2.1.1",
"sasl\_version" : "2.3.3",
"riak\_dt\_version" : "2.1.1-0-ga2986bc",
"runtime\_tools\_version" : "1.8.12",
"yokozuna\_version" : "2.1.2-0-g3520d11",
"riak\_search\_version" : "2.1.1-0-gffe2113",
"sys\_system\_version" : "Erlang R16B02\_basho8 (erts-5.10.3) [source]
[64-bit] [smp:4:4] [async-threads:64] [kernel-poll:true] [frame-pointer]",
"basho\_stats\_version" : "1.0.3",
"crypto\_version" : "3.1",
"merge\_index\_version" : "2.0.1-0-g0c8f77c",
"kernel\_version" : "2.16.3",
"stdlib\_version" : "1.19.3",
"riak\_pb\_version" : "2.1.0.2-0-g620bc70",
"syntax\_tools\_version" : "1.6.11",
"goldrush\_version" : "0.1.7",
"ibrowse\_version" : "4.0.2",
"mochiweb\_version" : "2.9.0",
"exometer\_core\_version" : "1.0.0-basho2-0-gb47a5d6",
"ssl\_version" : "5.3.1",
"public\_key\_version" : "0.20",
"pbkdf2\_version" : "2.0.0-0-g7076584",
"sidejob\_version" : "2.0.0-0-gc5aabba",
"webmachine\_version" : "1.10.8-0-g7677c24",
"poolboy\_version" : "0.8.1p3-0-g8bb45fb",
"riak\_api\_version" : "2.1.2-0-gd8d510f",
"asn1\_version" : "2.0.3",


On Fri, Jun 17, 2016 at 10:45 AM Russell Brown  wrote:

&gt; What version of riak\_kv is behind this riak\_cs install, please? Is it
&gt; really 2.1.3 as stated below? This looks and sounds like sibling explosion,
&gt; which is fixed in riak 2.0 and above. Are you sure that you are using the
&gt; DVV enabled setting for riak\_cs bucket properties? Can you post your bucket
&gt; properties please?
&gt;
&gt; On 16 Jun 2016, at 23:54, Vladyslav Zakhozhai 
&gt; wrote:
&gt;
&gt; &gt; Hello.
&gt; &gt;
&gt; &gt; I see very interesting and confusing thing.
&gt; &gt;
&gt; &gt; From my previous letter you can see that siblings count on manifest
&gt; objects is about 100 (actualy it is in range 100-300). Unfortunately my
&gt; problem is that almost all PUT requests are failing with 500 Internal
&gt; Server error.
&gt; &gt;
&gt; &gt; I've tried today set max\_siblings riak option to 500. And there were
&gt; successfull PUT requests but not for long. Now I see in riak logs error
&gt; with "max siblings", but actual count of them is 500+ (earlier it was
&gt; 100-300 as I've mentioned).
&gt; &gt;
&gt; &gt; Period of time between max\_siblings=500 and errors in log is about 30
&gt; minutes. And I want to point your attention that I've forbid PUT method on
&gt; haproxy - frontend for riak cs.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon, Jun 6, 2016 at 1:17 AM Vladyslav Zakhozhai &lt;
&gt; v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt; &gt; Hi, Luke.
&gt; &gt;
&gt; &gt; Thank you for your answer. I did not understand you completely about
&gt; transfer-limit. How does it relate to my problem. Transfer limit - is a
&gt; limit of concurrent data transfer from different nodes. Am I wright? You
&gt; mean that riak can handoff one partition from several nodes concurrently?
&gt; &gt;
&gt; &gt; Now I have transfer-limit 1 on all riak nodes.
&gt; &gt;
&gt; &gt; But I am not sure that my cluster will be converged ever. All nodes
&gt; experiences low memory and are killed by OOM Killer periodically. I try to
&gt; add new nodes to the cluster but due problem with OOM killer this process
&gt; is very-very slow.
&gt; &gt;
&gt; &gt; In the official docs I've read:
&gt; &gt;
&gt; &gt; "Sibling explosion occurs when an object rapidly collects siblings that
&gt; are not reconciled. This can lead to a variety of problems, including
&gt; degraded performance, especially if many objects in a cluster suffer from
&gt; siblings explosion. At the extreme, having an enormous object in a node can
&gt; cause reads of that object to crash the entire node. Other issues include
&gt; undue latency and out-of-memory errors."
&gt; &gt;
&gt; &gt; I mentioned that new nodes in the cluster do not experience such
&gt; problems (I mean out of RAM).
&gt; &gt;
&gt; &gt; Regarding to siblings maybe your are right, this is manifest object. I
&gt; can recognize key name but not bucket name. But more than 100 siblings on
&gt; many keys is really confused me. Each time I try to PUT some object to Riak
&gt; via Riak CS S3 interface I got errors with siblings.
&gt; &gt;
&gt; &gt; On Fri, Jun 3, 2016 at 6:43 PM Luke Bakken  wrote:
&gt; &gt; Hi Vladyslav,
&gt; &gt;
&gt; &gt; If you recognize the full name of the object raising the sibling
&gt; &gt; warning, it is most likely a manifest object. Sometimes, during hinted
&gt; &gt; handoff, you can see these messages. They should resolve after handoff
&gt; &gt; completes.
&gt; &gt;
&gt; &gt; Please see the documentation for the transfer-limit command as well:
&gt; &gt;
&gt; &gt;
&gt; http://docs.basho.com/riak/kv/2.1.4/using/admin/riak-admin/#transfer-limit
&gt; &gt;
&gt; &gt; --
&gt; &gt; Luke Bakken
&gt; &gt; Engineer
&gt; &gt; lbak...@basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; On Fri, Jun 3, 2016 at 2:55 AM, Vladyslav Zakhozhai
&gt; &gt;  wrote:
&gt; &gt; &gt; Hi.
&gt; &gt; &gt;
&gt; &gt; &gt; I have a trouble with PUT to Riak CS cluster. During this process I
&gt; &gt; &gt; periodically see the following message in Riak error.log:
&gt; &gt; &gt;
&gt; &gt; &gt; 2016-06-03 11:15:55.201 [error]
&gt; &gt; &gt; &lt;0.15536.142&gt;@riak\_kv\_vnode:encode\_and\_put:2253 Put failure: too many
&gt; &gt; &gt; siblings for object OBJECT\_NAME (101)
&gt; &gt; &gt;
&gt; &gt; &gt; and also
&gt; &gt; &gt;
&gt; &gt; &gt; 2016-06-03 12:41:50.678 [error]
&gt; &gt; &gt; &lt;0.20448.515&gt;@riak\_api\_pb\_server:handle\_info:331 Unrecognized message
&gt; &gt; &gt; {7345880,{error,{too\_many\_siblings,101}}}
&gt; &gt; &gt;
&gt; &gt; &gt; Here OBJECT\_NAME - is the name of object in Riak which has too many
&gt; &gt; &gt; siblings.
&gt; &gt; &gt;
&gt; &gt; &gt; I definitely sure that this objects are static. Nobody deletes is,
&gt; nobody
&gt; &gt; &gt; rewrites it. I have no idea why more than 100 siblings of this object
&gt; &gt; &gt; occurs.
&gt; &gt; &gt;
&gt; &gt; &gt; The following effect of this issue occurs:
&gt; &gt; &gt;
&gt; &gt; &gt; Great amount of keys are loaded to RAM. I almost out of RAM (Do each
&gt; sibling
&gt; &gt; &gt; has it own key or key duplicate?).
&gt; &gt; &gt; Nodes are slow - adding new nodes are too slow
&gt; &gt; &gt; Presence of "too many siblings" affects ownership handoffs
&gt; &gt; &gt;
&gt; &gt; &gt; So I have several questions:
&gt; &gt; &gt;
&gt; &gt; &gt; Do hinted or ownership handoffs can affect siblings count (I mean can
&gt; &gt; &gt; siblings be created during ownership of hinted handoffs)
&gt; &gt; &gt; Is there any workaround of this issue. Do I need remove siblings
&gt; manually or
&gt; &gt; &gt; it removes during merges, read repairs and so on
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; My configuration:
&gt; &gt; &gt;
&gt; &gt; &gt; riak from basho's packages - 2.1.3-1
&gt; &gt; &gt; riak cs from basho's packages - 2.1.0-1
&gt; &gt; &gt; 24 riak/riak-cs nodes
&gt; &gt; &gt; 32 GB RAM per node
&gt; &gt; &gt; AAE is disabled
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; I appreciate you help.
&gt; &gt; &gt;
&gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

