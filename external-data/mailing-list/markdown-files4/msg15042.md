---
title: "Re: serving files from riak-cs to public via url"
description: ""
project: community
lastmod: 2014-10-14T14:57:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15042"
mailinglist_parent_id: "msg15024"
author_name: "Michael Grauer"
project_section: "mailinglistitem"
sent_date: 2014-10-14T14:57:12-07:00
---


Thank you Kota, by setting content type in the boto call I got the policy
to work.

...

prp\_json = json.dumps(public\_read\_policy)
bucket.set\_policy(prp\_json, headers={'Content-Type': 'application/json'})

...

Setting read-public acl on the buckets would not work for me because that
only allows the bucket to be listed, and not each object to be read. But
the policy works to give all objects in the bucket public read access.




On Tue, Oct 14, 2014 at 12:57 AM, Kota Uenishi  wrote:

&gt; How about setting read-public acl to buckets instead of setting it each
&gt; object?
&gt;
&gt; BTW that seems valid JSON, or did you correctly put 'application/json'
&gt; as content-type when you put the policy?
&gt;
&gt; On Tue, Oct 14, 2014 at 5:19 AM, Michael Grauer
&gt;  wrote:
&gt; &gt; Thanks Ali.
&gt; &gt;
&gt; &gt; I now am having a permissions issue it seems in accessing the objects.
&gt; &gt;
&gt; &gt; I try to curl the object
&gt; &gt;
&gt; &gt;
&gt; http://10.x.x.x/test-bucket/pointclouds/4f55ed40ca08aeb57bf19257aa6601e85436ff0684aa2/static/metadata.ini
&gt; &gt;
&gt; &gt; and I get
&gt; &gt;
&gt; &gt; xml version="1.0"
 &gt; encoding="UTF-8"?&gt;`AccessDenied`Access
&gt; &gt;
&gt; Denied/test-bucket/pointclouds/4f55ed40ca08aeb57bf19257aa6601e85436ff0684aa2/static/metadata.ini
&gt; &gt;
&gt; &gt;
&gt; &gt; When I request the ACL for this bucket from boto I get:
&gt; &gt;
&gt; &gt;  &gt; michael.grauer (owner) = FULL\_CONTROL&gt;
&gt; &gt;
&gt; &gt; I would like to not have to set ACLs on each object in my bucket, as I
&gt; &gt; expect a large number of objects. I tried to set a bucket policy like
&gt; this:
&gt; &gt;
&gt; &gt; {
&gt; &gt; "Version":"2008-10-17",
&gt; &gt; "Statement":[{
&gt; &gt; "Sid":"AllowPublicRead",
&gt; &gt; "Effect":"Allow",
&gt; &gt; "Principal": {
&gt; &gt; "AWS": "\*"
&gt; &gt; },
&gt; &gt; "Action":["s3:GetObject"],
&gt; &gt; "Resource":["arn:aws:s3:::test-bucket/\*"
&gt; &gt; ]
&gt; &gt; }
&gt; &gt; ]
&gt; &gt; }
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; But this was not accepted by boto or s3cmd . boto told me
&gt; &gt; boto.exception.S3ResponseError: S3ResponseError: 415 Unsupported Media
&gt; Type
&gt; &gt; , but there weren't any errors that I could see in the riak-cs logs.
&gt; &gt;
&gt; &gt; Can anyone point the way?
&gt; &gt;
&gt; &gt;
&gt; &gt; Thanks again
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon, Oct 13, 2014 at 2:53 PM, Ali Nikkhah  &gt;
&gt; &gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi Mike,
&gt; &gt;&gt;
&gt; &gt;&gt; You are trying to resolve a domain name 'test-bucket.10.x.x.x,' which is
&gt; &gt;&gt; invalid. This is the part that is incorrect. There are a couple options:
&gt; &gt;&gt;
&gt; &gt;&gt; 0) You should be able to access the bucket by using
&gt; &gt;&gt; http://ip/bucket-name, like:
&gt; &gt;&gt;
&gt; &gt;&gt; http://10.x.x.x/test-bucket/my\_key\_path
&gt; &gt;&gt;
&gt; &gt;&gt; 1) For easier public access, you can then set up a resolvable domain
&gt; &gt;&gt; name in your DNS configuration for the bucket, i.e. add a dns entry
&gt; &gt;&gt; like:
&gt; &gt;&gt;
&gt; &gt;&gt; test-bucket..com
&gt; &gt;&gt;
&gt; &gt;&gt; pointing to the riak-cs proxy ip. As long as your proxy is set up
&gt; &gt;&gt; properly, you should then be able to access the object using:
&gt; &gt;&gt;
&gt; &gt;&gt; http://test-bucket..com/my\_key\_path
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; -Ali
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; On Mon, 2014-10-13 at 14:11 -0400, Michael Grauer wrote:
&gt; &gt;&gt; &gt; Hi,
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; I'm very new to Riak-CS, and am investigating using it as a standin
&gt; &gt;&gt; &gt; for S3. I'd like to have a url that allows an anonymous
&gt; &gt;&gt; &gt; (unauthenticated) user to download an object from a bucket.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Riak 2.0.0-1
&gt; &gt;&gt; &gt; Riak CS 1.5.0-1
&gt; &gt;&gt; &gt; Stanchion 1.5.0-1
&gt; &gt;&gt; &gt; Ubuntu 14.04
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; I have test-bucket set up, and can connect to it, and upload and
&gt; &gt;&gt; &gt; download a file there all using an authenticated user that owns the
&gt; &gt;&gt; &gt; bucket, via boto.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; My Riak CS is running as 10.x.x.x , the internal IP of my AWS
&gt; &gt;&gt; &gt; instance, and proxied behind nginx.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; When I try to curl
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; curl -v http://test-bucket.10.x.x.x/my\_key\_path
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; I'm getting "could not resolve host: test-bucket.10.x.x.x"
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; My configuration is incorrect, but I'm uncertain of how to fix it.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Any help is appreciated!
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Thanks,
&gt; &gt;&gt; &gt; Mike
&gt; &gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt;&gt; &gt; riak-users mailing list
&gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Kota UENISHI / @kuenishi
&gt; Basho Japan KK
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

