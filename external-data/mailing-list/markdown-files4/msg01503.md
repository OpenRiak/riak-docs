---
title: "Re: Slow performance using linkwalk, help wanted"
description: ""
project: community
lastmod: 2010-11-09T02:10:43-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01503"
mailinglist_parent_id: "msg01497"
author_name: "Karsten Thygesen"
project_section: "mailinglistitem"
sent_date: 2010-11-09T02:10:43-08:00
---


Hi Ryan

Thanks for helping out!!

The cluster consists of 4 exactly similar nodes - all dedicated to riak use 
only - no other zones or tasks going on. We use Riak-EE 0.13. The servers is HP 
servers with 4 x 146GB 10K RPM SAS disks. There is a memorycache on the RAID 
controller and it is used during both read and writes but the RAID iis built 
usin Solaris-10u9 ZFS in a setup as such:

 pool: pool01
 state: ONLINE
 scrub: scrub completed after 0h0m with 0 errors on Tue Oct 26 21:25:05 2010
config:

 NAME STATE READ WRITE CKSUM
 pool01 ONLINE 0 0 0
 mirror-0 ONLINE 0 0 0
 c0t0d0s7 ONLINE 0 0 0
 c0t1d0s7 ONLINE 0 0 0
 mirror-1 ONLINE 0 0 0
 c0t2d0 ONLINE 0 0 0
 c0t3d0 ONLINE 0 0 0

errors: No known data errors

metrics during load gives 5% CPU load and about 10% IO load (iostat reports 30 
iops and the disks should be able to handle 300 iops each). So basically, the 
servers is unloaded....

One question remains - we use ZFS with default blocksize of 128Kb - what is the 
optimal blocksize with bitcask?

But I believe, that we should look somewhere else for the challenge - the 
hardware is not loaded significant, so I suspect, that we have a faulty 
datamodel or usage...?

Best regards,

Karsten

On Nov 8, 2010, at 23:43 , Ryan Tilder wrote:

&gt; Hi, Jan. Your description of the behaviour you're seeing below is frequently 
&gt; the result of slow access times to data on disk due to low spindle count for 
&gt; a given data set. Can you tell me the hardware specifications of the disks 
&gt; in each of the machines in the Riak ring? Primarily the number of disks, 
&gt; their capacity in GB or TB, their spindle speed, any on disk buffer they 
&gt; might have, and whether or not they're all the same hardware model?[1]
&gt; 
&gt; One other question that might be relate: is there any other software of note 
&gt; running on the hardware? i.e. Riak running on multi-tenant hardware in a 
&gt; Solaris Zone while another DB is running in a separate Zone on the same 
&gt; hardware, another disk seek heavy daemon running on the same machine, etc.
&gt; 
&gt; --Ryan
&gt; 
&gt; 1. If you don't know the above, you can get a lot of information from the 
&gt; "prtconf -v | more" command and just search for the work "disk". The model 
&gt; number(s) for the relevant disks is enough that we can hunt down the 
&gt; technical specs quickly enough.
&gt; 
&gt; On Mon, Nov 8, 2010 at 12:44 PM, Jan Buchholdt  wrote:
&gt; Another information is that the first time I do a link walk (using curl) on a 
&gt; total idle cluster it takes 2.71 second for a person with 363 documents. If I 
&gt; repeat the request it takes 319 milliseconds. I would expect that the 
&gt; performance would be almost the same.
&gt; 
&gt; If I run my performance test with 20 treads, that randomly pick a Person from 
&gt; 5 millions, the minimum time is 2.8s, average 6.7s, 90% 8.9s and max 12.4s.
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



smime.p7s
Description: S/MIME cryptographic signature
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

