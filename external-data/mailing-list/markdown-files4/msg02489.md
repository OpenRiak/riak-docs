---
title: "Re: riaksearch sort, start, and rows"
description: ""
project: community
lastmod: 2011-02-28T05:35:33-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02489"
mailinglist_parent_id: "msg02488"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2011-02-28T05:35:33-08:00
---


Hi Gary,

Yes, unfortunately, this is a bug. (Tracked here:
https://issues.basho.com/show\_bug.cgi?id=867) We have not yet scheduled the
fix for this.

Best,
Rusty

On Mon, Feb 28, 2011 at 1:25 AM, Gary William Flake  wrote:

&gt; Ack. I know what's happening with this. Riaksearch is sorting by
&gt; relevance, segmenting the results according to start and rows, and THEN
&gt; sorting by the sort key.
&gt;
&gt; Is this the intended behavior? If so, I am kind of surprised because the
&gt; post sort is easy for the caller to do without Riaksearch's help. What's
&gt; hard is the pre-sort.
&gt;
&gt; I suppose the work around is to get all of the results, then send the
&gt; result to map/reduce to correctly handle pre-sort, then filter by range.
&gt; However, before I do this, does anyone know if (a) this is considered
&gt; broken? and (b) if so, is this scheduled to be fixed?
&gt;
&gt; Thanks,
&gt; -- GWF
&gt;
&gt;
&gt;
&gt; On Sun, Feb 27, 2011 at 10:17 PM, Gary William Flake wrote:
&gt;
&gt;&gt; While coding up a front-end to paginate over a set of search results, I
&gt;&gt; think I found a bug whereby the result set is incorrectly segmented as a
&gt;&gt; function of the sort key, the start index, and the row count. In the output
&gt;&gt; that follows, I am using the field ctime for sort order, and the value of
&gt;&gt; delta is simply the difference between subsequent ctime values (which I was
&gt;&gt; checking in order to debug what was happening).
&gt;&gt;
&gt;&gt; First, lets ask for just the first result:
&gt;&gt;
&gt;&gt; GET
&gt;&gt;&gt; /solr/clips/select?q=user%3Ad33af3cca29a43e63e8f6a52dfdd99a61f7b7906%20AND%20private%3A1&start=0&rows=1&wt=json&sort=ctime
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; title: weather flagler beach - Google Search
&gt;&gt;
&gt;&gt; ctime: 98701733411258
&gt;&gt;
&gt;&gt; delta: 0
&gt;&gt;
&gt;&gt; ----------
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Now, let's do the same query, but get the top three instead:
&gt;&gt;
&gt;&gt; GET
&gt;&gt;&gt; /solr/clips/select?q=user%3Ad33af3cca29a43e63e8f6a52dfdd99a61f7b7906%20AND%20private%3A1&start=0&rows=3&wt=json&sort=ctime
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; title: Amazon.com: knives
&gt;&gt;
&gt;&gt; ctime: 98701733349673
&gt;&gt;
&gt;&gt; delta: 0
&gt;&gt;
&gt;&gt; ----------
&gt;&gt;
&gt;&gt; title: weather flagler beach - Google Search
&gt;&gt;
&gt;&gt; ctime: 98701733411258
&gt;&gt;
&gt;&gt; delta: 61585
&gt;&gt;
&gt;&gt; ----------
&gt;&gt;
&gt;&gt; title: Bartholdi on spacefilling curves
&gt;&gt;
&gt;&gt; ctime: 98701733465867
&gt;&gt;
&gt;&gt; delta: 54609
&gt;&gt;
&gt;&gt; ----------
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Notice that we have a new 'top' result. Finally, let's get all of the
&gt;&gt; results by setting row to something large, but I'll only show the first
&gt;&gt; result because that's all you need to see:
&gt;&gt;
&gt;&gt; GET
&gt;&gt;&gt; /solr/clips/select?q=user%3Ad33af3cca29a43e63e8f6a52dfdd99a61f7b7906%20AND%20private%3A1&start=0&rows=1000&wt=json&sort=ctime
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; title: HTTP cookie - Wikipedia, the free encyclopedia
&gt;&gt;
&gt;&gt; ctime: 98701587317266
&gt;&gt;
&gt;&gt; delta: 0
&gt;&gt;
&gt;&gt; ----------
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; We now get a record that we haven't seen yet.
&gt;&gt;
&gt;&gt;
&gt;&gt; I can confirm that when I get all of the results, they are in the properly
&gt;&gt; sorted order. I also believe that any of my smaller result sets are also in
&gt;&gt; proper sort order. However, it also appears that when I ask for a specific
&gt;&gt; number of row with a non-zero start start value, then the start index is not
&gt;&gt; handled correctly. FWIW, these results don't' have anything to do with the
&gt;&gt; client library because I reproduced them over the REST interface.
&gt;&gt;
&gt;&gt; Any ideas?
&gt;&gt;
&gt;&gt; -- GWF
&gt;&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

