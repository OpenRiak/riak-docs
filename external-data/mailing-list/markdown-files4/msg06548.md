---
title: "Re: Low PUT throughput using Riak"
description: ""
project: community
lastmod: 2012-02-06T11:48:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06548"
mailinglist_parent_id: "msg06535"
author_name: "Ian Plosker"
project_section: "mailinglistitem"
sent_date: 2012-02-06T11:48:07-08:00
---


Hussam, 

You should consider upping the number of concurrent workers and point them at 
multiple nodes in your cluster. Further, you should use the 
`basho\_bench\_driver\_riakc\_pb` driver. The riak client which the 
`basho\_bench\_driver\_riakclient` driver uses is an internal component of Riak 
and should not be used in client apps.

A good example can be found here of using the `basho\_bench\_driver\_riakc\_pb` 
with multiple nodes and multiple concurrent workers:

https://github.com/basho/basho\_bench/blob/master/examples/riakc\_pb.devrel.config
 

-- 
Ian Plosker 
Developer Advocate
Basho Technologies, Inc.



On Friday, February 3, 2012 at 2:16 PM, Hussam Abu-Libdeh wrote:

&gt; Sure!
&gt; 
&gt; Here is the basho\_bench config file I used to benchmark Riak: (recall,
&gt; this was testing a single-node cluster)
&gt; 
&gt; {mode, max}.
&gt; {duration, 4}.
&gt; {concurrent, 1}.
&gt; {driver, basho\_bench\_driver\_riakclient}.
&gt; {code\_paths, ["deps/stats",
&gt; "/usr/er/riak/deps/riak\_kv",
&gt; "/usr/er/riak/deps/riak\_core"]}.
&gt; {key\_generator, {int\_to\_bin, {uniform\_int, 1000000}}}.
&gt; {value\_generator, {fixed\_bin, 10000}}.
&gt; {riakclient\_nodes, ['riak@10.1.1.3 (mailto:riak@10.1.1.3)']}.
&gt; {riakclient\_mynode, ['riak\_bench@10.1.1.3 (mailto:riak\_bench@10.1.1.3)', 
&gt; longnames]}.
&gt; {riakclient\_replies, 1}.
&gt; {operations, [{put, 1}]}.
&gt; 
&gt; 
&gt; And for reference, here is the bash\_bench config file I used to
&gt; benchmark Bitcask:
&gt; 
&gt; {mode, max}.
&gt; {duration, 4}.
&gt; {concurrent, 1}.
&gt; {driver, basho\_bench\_driver\_bitcask}.
&gt; {key\_generator, {int\_to\_bin, {uniform\_int, 1000000}}}.
&gt; {value\_generator, {fixed\_bin, 10000}}.
&gt; {operations, [{put, 1}]}.
&gt; {code\_paths, ["deps/stats", "/usr/er/riak/deps/bitcask"]}.
&gt; {bitcask\_dir, "/usr/er/bitcask.bench"}.
&gt; {bitcask\_flags, [{sync\_strategy, none}]}.
&gt; 
&gt; 
&gt; Thanks,
&gt; 
&gt; On Fri, Feb 3, 2012 at 11:05 AM, Ian Plosker  (mailto:i...@basho.com)&gt; wrote:
&gt; &gt; Hussam,
&gt; &gt; 
&gt; &gt; Could you paste the contents of your basho\_bench config into an email and
&gt; &gt; send it over?
&gt; &gt; 
&gt; &gt; --
&gt; &gt; Ian Plosker 
&gt; &gt; Developer Advocate
&gt; &gt; Basho Technologies
&gt; &gt; 
&gt; &gt; On Thursday, February 2, 2012 at 7:33 PM, Hussam Abu-Libdeh wrote:
&gt; &gt; 
&gt; &gt; Hello,
&gt; &gt; 
&gt; &gt; I am trying to benchmark Riak on a local cluster. I have Riak v1.0.2
&gt; &gt; compiled from source. I am benchmarking using Basho's benchmarking
&gt; &gt; tool, and I used Riaknostic to help me with configuration. My machines
&gt; &gt; are all Dual Xeon with 2GB of RAM and 1Gb ethernet. I get about 50MB/s
&gt; &gt; write throughput on the local disks, and the local disks are mounted
&gt; &gt; with the noatime flag as Riaknostic suggested.
&gt; &gt; 
&gt; &gt; I benchmarked the write throughput of Bitcask by running a local
&gt; &gt; experiment where 1 worker was continuously writing 10K fixed\_binary
&gt; &gt; objects ( {value\_generator, {fixed\_bin, 10000}}. ) with the only
&gt; &gt; bitcask-specific flag being: {bitcask\_flags, [{sync\_strategy, none}]}.
&gt; &gt; I got about 50 MB/s write throughput from Bitcask, so that is good.
&gt; &gt; 
&gt; &gt; Then I tried to benchmark Riak. I setup a cluster of 8 Riak nodes with
&gt; &gt; the same configuration as used for Bitcask. I used the riakclient
&gt; &gt; driver from the benchmarking suite, and set the required riak\_client
&gt; &gt; replies to 1. The client was generating PUT operations continuously
&gt; &gt; with 10K binaries as before. I only got a throughput of about 4 MB/s.
&gt; &gt; I thought this might be an issue of storing extra copies due to
&gt; &gt; replication, so I modified the app.config file on all the nodes to
&gt; &gt; specify that N, R, and W are all set to 1. No improvement. I thought
&gt; &gt; this could be an issue in the network, so I benchmarked a single-node
&gt; &gt; cluster, with the client being local to the same machine (and N,R,W
&gt; &gt; all set to 1), and I still got the same low throughput. Finally, out
&gt; &gt; of desperation, I even modified the target\_n\_val parameter to 1 and
&gt; &gt; the ring\_creation\_size to 1 so there is only 1 Bitcask directory, ran
&gt; &gt; the experiment with 1 local client, and I still got the same very low
&gt; &gt; throughput.
&gt; &gt; 
&gt; &gt; Any help would be greatly appreciated. I have been stuck at this for a
&gt; &gt; while now.
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt; --Hussam
&gt; &gt; 
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; 
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

