---
title: "Re: Is it inefficient to map over a small bucket when you have 	millions of other buckets?"
description: ""
project: community
lastmod: 2010-07-12T07:44:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00714"
mailinglist_parent_id: "msg00708"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2010-07-12T07:44:09-07:00
---


I believe the number of buckets are basically unlimited - as long as
you use the default bucket properties (which can be changed by conf
file), re. number of replicas. If you change bucket properties on the
fly that info runs around the cluster in the gossip channel.
Afaik, buckets are simply virtual namespaces. Your data structure
could have a bucket per user listing collections. Map over that then
use the collection value to deriv bucket/key pair to pass into
additional map phases in an m/r chain.

And no, I seriously doubt that riak traverses the entire key space for
every m/r in the sense that it touches every key in the system
regardless of bucket. That is why riak has an input param required for
each m/r. I would love to hear otherwise.

-Alexander

On 2010-07-11, Daniel Einspanjer  wrote:
&gt; I'm thinking about the pros and cons of Riak vs HBase for Mozilla's
&gt; Weave (now Firefox Sync) 2.0 engine.
&gt; https://wiki.mozilla.org/Labs/Weave/Sync/2.0/API
&gt;
&gt; The primary use case is that when a user's client performs a sync, it
&gt; needs to retrieve all the new items since the last time it synced for
&gt; each collection (bookmarks, tabs, history, etc.) that the client is
&gt; configured to sync.
&gt; If a particular client doesn't sync often, it is possible that
&gt; there might be thousands of items to retrieve, this means that using
&gt; links \*might\* run into issues.
&gt;
&gt; HBase's use of ordered keys pushes for a schema where you'd have the
&gt; modified timestamp in the key. That would allow for quick and easy
&gt; scanning of just the new items.
&gt;
&gt; Riak however, has a few interesting features such as the on-demand
&gt; creation of new buckets that might make it much more flexible... if
&gt; there is a highly performant mechanism for the client to retrieve new data.
&gt;
&gt; What prompted me to post this message was something I thought I
&gt; remembered seeing regarding mapping over buckets in Riak. Unfortunately
&gt; I can't find the reference now.
&gt;
&gt; Is it true that in order to map over all the keys in a single bucket,
&gt; the Riak cluster must actually traverse the entire global keyspace of
&gt; all buckets to find the keys that are part of the desired bucket?
&gt;
&gt; In the case where you have tens of millions of users, and you have
&gt; either one bucket per user or (if it were feasible) one bucket per user
&gt; per collection, it seems like it would be impossible to efficiently
&gt; perform a map reduce on one user's bucket.
&gt;
&gt; That seems like such a common scenario, I must have misinterpreted what
&gt; I read. I'd really appreciate some clarification there and also would
&gt; be very interested in any schema proposals or thoughts you might have
&gt; about this use case.
&gt;
&gt; -Daniel
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

-- 
Sent from my mobile device

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

