---
title: "Re: configurable prefix for consistent hashing?"
description: ""
project: community
lastmod: 2011-11-09T15:29:53-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05526"
mailinglist_parent_id: "msg05519"
author_name: "Phil Stanhope"
project_section: "mailinglistitem"
sent_date: 2011-11-09T15:29:53-08:00
---


Tread carefully here ... by forcing localilty ... you will sacrifice high
availability by algorithmically creating a bias and a single point of
failure in the cluster.

Cassandra made this easier to do ... and then there were many questions on
the user list about:

"why is my cluster is unbalanced?"
'why is one of my nodes is falling over when the others are not?"
etc...

On Thu, Nov 10, 2011 at 4:25 AM, Elias Levy wrote:

&gt; On Wed, Nov 9, 2011 at 12:00 PM, wrote:
&gt;
&gt;&gt; From: Nate Lawson 
&gt;&gt;
&gt;&gt;
&gt;&gt; We have been looking into ways to cluster keys to benefit from the
&gt;&gt; LevelDB backend's prefix compression. If we were doing a batch of lookups
&gt;&gt; and the keys from a given document could be grouped on a partition, they
&gt;&gt; could be read with less disk IO. However, consistent hashing in Riak
&gt;&gt; currently spreads keys randomly, based on SHA-1.
&gt;&gt;
&gt;&gt; What I think we could really use is a per-bucket configurable prefix
&gt;&gt; length for consistent hashing. We would then create keys of the form
&gt;&gt; "DocumentID:" and tell Riak to only hash DocumentID to get the
&gt;&gt; partition. This way, keys from the same document would be clustered on the
&gt;&gt; same partition.
&gt;&gt;
&gt;&gt; Is this on your roadmap already? It seems like it wouldn't require too
&gt;&gt; many changes to Riak.
&gt;&gt;
&gt;
&gt; If you look at the bucket properties by fetching them, you'll notice that
&gt; there is already an entry for specifying a key hashing function. Its not
&gt; documented, but you can read the Erlang code for the existing function
&gt; (pretty much just a call to SHA1), and create your own to do whatever
&gt; partitioning you want.
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

