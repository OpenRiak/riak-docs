---
title: "Re: OpenLDAP MDB backend for riak"
description: ""
project: community
lastmod: 2012-09-30T10:58:30-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08757"
mailinglist_parent_id: "msg08756"
author_name: "Zabrane Mickael"
project_section: "mailinglistitem"
sent_date: 2012-09-30T10:58:30-07:00
---


Any volunteer to test EMDB as a new Riak backend:
https://github.com/alepharchives/emdb

Regards,
Zabrane

On Sep 30, 2012, at 6:15 PM, Howard Chu wrote:

&gt; Kresten Krab Thorup wrote:
&gt;&gt; Howard,
&gt;&gt; 
&gt;&gt; I took a look at MDB, and it does look quite promising!
&gt;&gt; 
&gt;&gt; Perhaps you can enlighten us a bit on these aspects of MDB:
&gt;&gt; 
&gt;&gt; - How do you back up an MDB instance? Can you do that while it is actively
&gt; updating, or do you need to stop it? I'm asking because the operational ease
&gt; of the log-structured stores is one of the features that many Riak'ers like
&gt; quite a lot.
&gt; 
&gt; Since this was originally developed for OpenLDAP slapd we currently use 
&gt; slapcat to backup an MDB instance. That won't be useful in general though, so 
&gt; we will be providing an mdb\_dump/mdb\_load utility shortly. There is no need 
&gt; to stop the database while performing a backup, but...
&gt; MDB uses MVCC, so once a read transaction starts, it is guaranteed a 
&gt; self-consistent view of the database until the transaction ends.
&gt; Keeping a read txn open for a very long time will prevent the dirty page 
&gt; reclaimer from re-using the pages that are referenced by that read txn. As 
&gt; such, any ongoing write activity will be forced to use new pages. The DB size 
&gt; can grow very rapidly in these situations, until the read txn ends.
&gt; 
&gt;&gt; - What is the typical response-time distribution for inserts? I've tried
&gt;&gt; to
&gt; work with BDB some time back, and one of the issues with that is that every
&gt; once in a while it slows down quite significantly as B-tree rebalancing makes
&gt; some requests unreasonably slow.
&gt; 
&gt; MDB is also a B+tree; at a high level it will have similar characteristics to 
&gt; BDB. It's always possible for an insert that results in a page split to have 
&gt; a cascade effect, causing page splits all the way back up to the root of the 
&gt; tree. But in general MDB is still more efficient than BDB so the actual 
&gt; variance will be much smaller.
&gt; 
&gt; Also note that if you're bulk loading records in sorted order, using the 
&gt; MDB\_APPEND option basically degenerates into sequential write operations - 
&gt; when one page fills, instead of splitting it in half as usual, we just 
&gt; allocate a new sibling page and continue filling it. Page "splits" of this 
&gt; sort can still ripple upward, but they're so cheap as to be unmeasurable.
&gt; 
&gt;&gt; - Does an MDB instance exploit multiple cores? If so, what is the
&gt;&gt; structure
&gt; of this usage? In Riak, we have the benefit that a typical Riak node runs
&gt; multiple independent databases (one for each data partition/vnode), and so at
&gt; least that can provide some concurrency to better leverage I/O and CPU
&gt; concurrency.
&gt; 
&gt; Within an MDB environment, multiple readers can run concurrently with a 
&gt; single writer. Readers are never blocked by anything. (Readers don't block 
&gt; writers, but as mentioned above, can prevent old pages from being reused.)
&gt; 
&gt;&gt; Kresten
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Sep 29, 2012, at 9:50 PM, Kresten Krab Thorup 
&gt;&gt; &gt; wrote:
&gt;&gt; 
&gt;&gt; BETS May be a good template for MDB NIFs since the MDB API looks like bdb. 
&gt;&gt; It doesn't implement the Riak backend API but an ets subset.
&gt;&gt; 
&gt;&gt; https://github.com/krestenkrab/bets
&gt;&gt; 
&gt;&gt; Kresten
&gt;&gt; Trifork
&gt;&gt; 
&gt;&gt; On 28/09/2012, at 13.50, "Howard Chu" 
&gt;&gt; &gt; wrote:
&gt;&gt; 
&gt;&gt; yaoxinming wrote:
&gt;&gt; mdb looks very good ,you can use nif ,maybe you can look the eleveldb
&gt;&gt; project,that's a good example.
&gt;&gt; 
&gt;&gt; Thanks for the tip, I'll look into eleveldb.
&gt;&gt; 
&gt;&gt; 2012/9/27 Howard Chu  
&gt;&gt; &gt;
&gt;&gt; 
&gt;&gt; Hi, I'm interested in developing a backend using OpenLDAP's memory-mapped
&gt;&gt; database library (MDB). Unfortunately Erlang is not a language I've used
&gt;&gt; before. Any tips on where to get started?
&gt;&gt; 
&gt;&gt; You can find information on MDB here: http://highlandsun.com/hyc/\_\_mdb/
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Its read performance is several times faster than anything else out there,
&gt;&gt; and scales perfectly linearly since readers require no locks. Its write
&gt;&gt; performance is also quite fast...
&gt;&gt; --
&gt;&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; -- Howard Chu
&gt; CTO, Symas Corp. http://www.symas.com
&gt; Director, Highland Sun http://highlandsun.com/hyc/
&gt; Chief Architect, OpenLDAP http://www.openldap.org/project/
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

