---
title: "Re: tuning riak for 100s of concurrent connections"
description: ""
project: community
lastmod: 2011-02-26T06:30:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02486"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-02-26T06:30:16-08:00
---



On 25 Feb 2011, at 18:31, Wilson MacGyver wrote:

&gt; Another possibility that comes to mind to avoid the setup cost is to
&gt; do connection pool
&gt; of some sorts.
&gt; 
&gt; Does any of the riak client lib supports connection pooling?

Late to this party, sorry.

The Java REST client makes use of Apache HttpClient so connection pooling is 
available (and you can set TCP\_NODELAY using the HttpConnectionParams of the 
HttpClient.)

The Java protobufs client creates a connection per thread that uses the client 
, it will reuse the connection (if it is not idle for a second or more.) so you 
can create \*n\* threads and share (either) RiakClient implementation between 
them (I haven't tested this with the protobufs client yet, so caveat emptor.)

&gt; 
&gt; On Fri, Feb 25, 2011 at 1:25 PM, Sean Cribbs  wrote:
&gt;&gt; Now you're talking about tweaking kernel-level settings -- something well 
&gt;&gt; outside my expertise (although TCP slow-start comes to mind). That said, 
&gt;&gt; it's kind of hard not to use TCP if you want a reliable connection, warts 
&gt;&gt; and all.
&gt;&gt; 
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt;&gt; On Feb 25, 2011, at 1:06 PM, Wilson MacGyver wrote:
&gt;&gt; 
&gt;&gt;&gt; any advise to solve this?
&gt;&gt;&gt; 
&gt;&gt;&gt; On Fri, Feb 25, 2011 at 1:05 PM, Sean Cribbs  wrote:
&gt;&gt;&gt;&gt; Yes, the majority of the cost is probably in TCP setup. That pain is 
&gt;&gt;&gt;&gt; happening at the TCP stack level, not in Erlang. It's actually really 
&gt;&gt;&gt;&gt; cheap and easy to spawn a new process in Erlang, so there's no reason to 
&gt;&gt;&gt;&gt; have "standby workers", especially when they don't need to maintain state 
&gt;&gt;&gt;&gt; between requests.
&gt;&gt;&gt;&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Omnem crede diem tibi diluxisse supremum.
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

