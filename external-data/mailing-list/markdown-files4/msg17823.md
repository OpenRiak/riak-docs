---
title: "Re: Reaping Tombstones"
description: ""
project: community
lastmod: 2016-12-30T07:31:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17823"
mailinglist_parent_id: "msg17822"
author_name: "Arun Rajagopalan"
project_section: "mailinglistitem"
sent_date: 2016-12-30T07:31:24-08:00
---


Thanks Matthew & Luca

Re: global expiry - will that option retroactively remove objects? That is
remove objects that became "unneeded" before the option was set ?
Same question w.r.t delete\_mode

Re: Map / Reduce - I am not sure the delete would remove the tombstone
unless I set the delete\_mode to immediate AND there are no copies on
non-primary nodes. Or am I mistaken ?


On Fri, Dec 30, 2016 at 10:11 AM, Luca Favatella &lt;
luca.favate...@erlang-solutions.com&gt; wrote:

&gt; On 30 December 2016 at 15:06, Matthew Von-Maszewski 
&gt; wrote:
&gt; &gt; Greetings,
&gt; &gt;
&gt; &gt; I am not able to answer your tombstone questions. That question needs a
&gt; &gt; better expert.
&gt; &gt;
&gt; &gt; Just wanted to point out that Riak now has global expiry in both the
&gt; leveldb
&gt; &gt; and bitcask backends. That might be a quicker solution for your frequent
&gt; &gt; delete operations:
&gt; &gt;
&gt; &gt; http://basho.com/products/riak-kv/global-object-expiration/
&gt; &gt;
&gt; &gt; Technical details for the leveldb expiry are found here:
&gt; &gt; https://github.com/basho/leveldb/wiki/mv-expiry
&gt; &gt;
&gt; &gt; Matthew
&gt; &gt;
&gt; &gt; On Dec 30, 2016, at 9:55 AM, Arun Rajagopalan &lt;
&gt; arun.v.rajagopa...@gmail.com&gt;
&gt; &gt; wrote:
&gt; &gt;
&gt; &gt; Hello Riakers
&gt; &gt;
&gt; &gt; I wonder if there is anyway to delete all tombstones that were left
&gt; behind
&gt; &gt; when delete\_mode was set to 'keep'
&gt;
&gt; Hi Arun,
&gt;
&gt; Brute-force rate-limited map-reduce custom application code looking
&gt; for `X-Riak-Deleted` in object metadata and then deleting? Refs:
&gt; \* http://docs.basho.com/riak/kv/2.2.0/developing/app-guide/
&gt; advanced-mapreduce/#map-phase
&gt; \* https://github.com/basho/basho\_docs/blob/6b2f42a7243bfded737bd62eed12c4
&gt; 90376c67e2/content/riak/kv/2.2.0/developing/app-guide/
&gt; advanced-mapreduce.md#map-phase
&gt;
&gt; Interested to hear if you come up with a better way though.
&gt;
&gt;
&gt; &gt; Also how do I estimate how much space the tombstones take ? We have a
&gt; ton of
&gt; &gt; large scale and frequent delete operations and I suspect some space is
&gt; used
&gt; &gt; by Tombstones. I would like to find out if it is significant enough to
&gt; &gt; warrant some cleanup.
&gt;
&gt; I understand this is a separate question - I am not sure about the answer.
&gt;
&gt;
&gt; &gt; If it does, how do I remove them?
&gt;
&gt; I believe I proposed an answer above.
&gt;
&gt;
&gt; Regards
&gt; Luca
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

