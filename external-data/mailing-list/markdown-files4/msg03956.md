---
title: "Re: riak mapreduce failure"
description: ""
project: community
lastmod: 2011-07-07T06:25:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03956"
mailinglist_parent_id: "msg03955"
author_name: "Matt Graham"
project_section: "mailinglistitem"
sent_date: 2011-07-07T06:25:16-07:00
---


Thanks Jonathan and Mathias! I'll know to look out for that next time
I see that error.


On Thu, Jul 7, 2011 at 08:33, Mathias Meyer  wrote:
&gt; Matt,
&gt;
&gt; in your JS function, you return value, where instead you must return a list 
&gt; of values, so changing it to
&gt;
&gt; return [value];
&gt;
&gt; fixes the problem.
&gt;
&gt; Mathias Meyer
&gt; Developer Advocate, Basho Technologies
&gt;
&gt;
&gt; On Donnerstag, 7. Juli 2011 at 05:53, Matt Graham wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt; I'm trying to test out riak's mapreduce for just a simple case but I
&gt;&gt; can't get it to work. Maybe someone can help with what I'm doing
&gt;&gt; wrong. I have the latest build of Riak available for Ubuntu
&gt;&gt; installed.
&gt;&gt;
&gt;&gt; I add an object to riak, that works. I can then fetch it. Then I try
&gt;&gt; to run a mapreduce on that bucket and it fails.
&gt;&gt;
&gt;&gt; mdg@maple:~/tmp$ curl -i -d 6 http://127.0.0.1:8098/riak/test/2
&gt;&gt; HTTP/1.1 204 No Content
&gt;&gt; Vary: Accept-Encoding
&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt;&gt; Date: Thu, 07 Jul 2011 03:47:00 GMT
&gt;&gt; Content-Type: application/x-www-form-urlencoded
&gt;&gt; Content-Length: 0
&gt;&gt;
&gt;&gt; mdg@maple:~/tmp$ curl -i http://127.0.0.1:8098/riak/test/2
&gt;&gt; HTTP/1.1 200 OK
&gt;&gt; X-Riak-Vclock: a85hYGBgzGDKBVIs7JvMrDOYEhnzWBlMVnQe58sCAA==
&gt;&gt; Vary: Accept-Encoding
&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt;&gt; Link: ; rel="up"
&gt;&gt; Last-Modified: Tue, 05 Jul 2011 09:33:16 GMT
&gt;&gt; ETag: "4fhdlMvPAPNw4SegwaTNMv"
&gt;&gt; Date: Thu, 07 Jul 2011 03:47:09 GMT
&gt;&gt; Content-Type: application/x-www-form-urlencoded
&gt;&gt; Content-Length: 1
&gt;&gt;
&gt;&gt; 6
&gt;&gt; mdg@maple:~/tmp$curl -i -d
&gt;&gt; '{"inputs":"test","query":[{"map":{"language":"javascript","source":"function(value)
&gt;&gt; { return value; }","keep":true}}]}' -H "Content-Type:
&gt;&gt; application/json" http://127.0.0.1:8098/mapred
&gt;&gt; HTTP/1.1 500 Internal Server Error
&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt;&gt; Date: Thu, 07 Jul 2011 03:47:22 GMT
&gt;&gt; Content-Type: text/html
&gt;&gt; Content-Length: 692
&gt;&gt;
&gt;&gt; 500 Internal Server
&gt;&gt; ErrorInternal Server Error
=====================

The server
&gt;&gt; encountered an error while processing this
&gt;&gt; request:  

```
{error,{exit,{json_encode,{bad_term,{&lt;&lt;"bucket"&gt;&gt;,&lt;&lt;"test"&gt;&gt;}}},
&gt;&gt;  [{mochijson2,json_encode,2},
&gt;&gt;  {mochijson2,'-json_encode_array/2-fun-0-',3},
&gt;&gt;  {lists,foldl,3},
&gt;&gt;  {mochijson2,json_encode_array,2},
&gt;&gt;  {riak_kv_wm_mapred,process_post,2},
&gt;&gt;  {webmachine_resource,resource_call,3},
&gt;&gt;  {webmachine_resource,do,3},
&gt;&gt;  {webmachine_decision_core,resource_call,1}]}}
```


---

mochiweb+webmachine
&gt;&gt; web server


&gt;&gt;
&gt;&gt;
&gt;&gt; I get that json\_encode error every time. Any ideas on how to not get
&gt;&gt; that or how to work around it?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Matt
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

