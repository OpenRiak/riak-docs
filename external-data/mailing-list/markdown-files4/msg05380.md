---
title: "Re: Python Client Protocol Buffers Error"
description: ""
project: community
lastmod: 2011-10-30T10:22:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05380"
mailinglist_parent_id: "msg05372"
author_name: "Jim Adler"
project_section: "mailinglistitem"
sent_date: 2011-10-30T10:22:25-07:00
---


Attached is the app.config and here's the code snippet:

import riak

client = riak.RiakClient(host='xxx.xxx.xxx.xxx', port=8087,
transport\_class=riak.RiakPbcTransport)

query = riak.RiakMapReduce(client).add('nodes')

query.add\_key\_filters(riak.key\_filter.tokenize('-', 2) +
riak.key\_filter.starts\_with('jim'))

query.map('''

 function(v) {

 return [[v.key]];

 }''')

for result in query.run(timeout=6000000):

 print '%s' % (result)


Thanks!

Jim

From: Reid Draper 
Date: Sat, 29 Oct 2011 16:13:03 -0400
To: Jim Adler 
Cc: "riak-users@lists.basho.com" 
Subject: Re: Python Client Protocol Buffers Error

Do you have some code that you can send to reproduce the issue? Would you
mind sending your app.config as well?

On Sat, Oct 29, 2011 at 3:58 PM, Jim Adler  wrote:
&gt; Ried, 
&gt; 
&gt; Riak 1.0.1 from package, Ubuntu 11.04
&gt; 
&gt; Jim
&gt; 
&gt; From: Reid Draper 
&gt; Date: Sat, 29 Oct 2011 13:47:02 -0400
&gt; To: Jim Adler 
&gt; Cc: "riak-users@lists.basho.com" 
&gt; Subject: Re: Python Client Protocol Buffers Error
&gt; 
&gt; Jim,
&gt; 
&gt; What version of Riak are you using? Are you using a package or did you build
&gt; from source? If you built from source, what version of Erlang are you using?
&gt; 
&gt; Reid
&gt; 
&gt; On Sat, Oct 29, 2011 at 1:38 PM, Jim Adler  wrote:
&gt;&gt; I'm consistently seeing a key filter query fail with protocol buffers that
&gt;&gt; works fine with http. I've seen similar problems reported
&gt;&gt; (http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2011-April/004
&gt;&gt; 002.html 
&gt;&gt; &gt; 2.html&gt; ,
&gt;&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2011-October/00
&gt;&gt; 6056.html 
&gt;&gt; &gt; 056.html&gt; ,
&gt;&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2011-January/00
&gt;&gt; 3015.html 
&gt;&gt; &gt; 015.html&gt; ). I am using the latest python client 1.3.0 which should have
&gt;&gt; fixed some of the earlier reported problems.
&gt;&gt; 
&gt;&gt; Any ideas?
&gt;&gt; 
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; Here's the stack trace:
&gt;&gt; 
&gt;&gt; 2011-10-29 10:32:03 ERROR \_\_main\_\_,545 'Socket returned short packet
&gt;&gt; length \x00\x00\x00 - expected 4' Traceback (most recent call last):
&gt;&gt; File
&gt;&gt; "/Users/jadler/projects/dg/usr/jadler/projects/score/twitter/twitter\_crawl.
&gt;&gt; py", line 270, in main for result in query.run(timeout=6000000):
&gt;&gt; File
&gt;&gt; "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/mapreduce.py", line 211, in run result = t.mapred(self.\_inputs,
&gt;&gt; query, timeout)
&gt;&gt; File
&gt;&gt; "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/transports/pbc.py", line 311, in mapred msg\_code, resp =
&gt;&gt; self.recv\_msg()
&gt;&gt; File
&gt;&gt; "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/transports/pbc.py", line 365, in recv\_msg self.recv\_pkt()
&gt;&gt; File
&gt;&gt; "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/transports/pbc.py", line 410, in recv\_pkt format(nmsglen))
&gt;&gt; RiakError: 'Socket returned short packet length \x00\x00\x00 - expected 4'
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 





app.config
Description: Binary data
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

