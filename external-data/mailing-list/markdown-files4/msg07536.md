---
title: "Re: Riak crashed with MANIFEST not found"
description: ""
project: community
lastmod: 2012-05-25T18:37:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07536"
mailinglist_parent_id: "msg07535"
author_name: "Nam Nguyen"
project_section: "mailinglistitem"
sent_date: 2012-05-25T18:37:03-07:00
---


Hi Justin,

I had essentially done the same thing you suggested. I moved the affected 
directory out of leveldb and restarted riak. Though I did not run repair, it 
seemed to go well. The nodes are leaving the cluster now.

However, it has been three hours and riak-admin transfers still shows many 
partitions to handoff. I'm not sure if I should wait for more before doing a 
force-remove.

Thanks,
Nam


On May 25, 2012, at 5:38 PM, jshoffstall wrote:

&gt; Hi, Nam, 
&gt; 
&gt; On the node that is reporting the LevelDB Manifest error, I would do the
&gt; following: 
&gt; 
&gt; 1. Stop the node if it isn't down already. 
&gt; 
&gt; 2. Backup
&gt; /var/lib/riak/leveldb/502391187832497878132516661246222288006726811648 to
&gt; another folder outside of /var/lib/riak/leveldb. 
&gt; 
&gt; 3. Run the erl binary included with Riak (typically underneath
&gt; /usr/lib/riak/erts-\*/bin or /usr/lib64/riak/erts-\*/bin in Linux) to startup
&gt; an Erlang shell. 
&gt; 
&gt; 4. Issue the following to open the node's LevelDB database: 
&gt; [application:set\_env(eleveldb, Var, Val) || {Var, Val} &lt;- 
&gt; [{max\_open\_files, 2000}, 
&gt; {block\_size, 1048576}, 
&gt; {cache\_size, 20\*1024\*1024\*1024}, 
&gt; {sync, false}, 
&gt; {data\_root, "/var/lib/riak/leveldb"}]]. 
&gt; 
&gt; 5. Run 
&gt; eleveldb:repair("502391187832497878132516661246222288006726811648", []). 
&gt; 
&gt; 6. After the repair has completed, run 
&gt; q(). 
&gt; or hit ^c twice to exit the shell. 
&gt; 
&gt; 7. Restart Riak. 
&gt; 
&gt; Let us know how this goes. If you run into any more trouble, ping the list
&gt; and we'll give you a hand! 
&gt; 
&gt; Regards, 
&gt; 
&gt; Justin Shoffstall 
&gt; Developer Advocate | Basho Technologies, Inc. 
&gt; 
&gt; 
&gt; --
&gt; View this message in context: 
&gt; http://riak-users.197444.n3.nabble.com/Riak-crashed-with-MANIFEST-not-found-tp4015987p4016113.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

