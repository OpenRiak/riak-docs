---
title: "Re: Python client performance issue"
description: ""
project: community
lastmod: 2011-02-15T10:06:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02322"
mailinglist_parent_id: "msg02321"
author_name: "Andy Gross"
project_section: "mailinglistitem"
sent_date: 2011-02-15T10:06:09-08:00
---




Sorry, I should have been more clear. The Python client depends on 
"protobuf&gt;=2.3.0" in setup.py, so people are already most likely using 
protobufs-2.3.0.

- Andy

On Tuesday, February 15, 2011 at 3:09 AM, Nico Meyer wrote: 
&gt; Hi Andy.
&gt; 
&gt; I am not quite sure what you mean, is the protobuf library included with
&gt; riak-python-client? Or are you talking about the version of the protobuf
&gt; compiler that was used to create riakclient\_pb2.py from 
&gt; riakclient.proto?
&gt; 
&gt; Cheers,
&gt; Nico
&gt; 
&gt; Am Dienstag, den 15.02.2011, 02:23 -0800 schrieb Andy Gross:
&gt; &gt; python-riak-client already uses version 2.3.0. Adventurous types
&gt; &gt; might want to check out https://github.com/Greplin/fast-python-pb,
&gt; &gt; which wraps the C/C++ protocol buffers library. 
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; Andy Gross
&gt; &gt; Principal Architect
&gt; &gt; Basho Technologies, Inc.
&gt; &gt; 
&gt; &gt; 
&gt; &gt; On Tuesday, February 15, 2011 at 1:46 AM, Nico Meyer wrote:
&gt; &gt; 
&gt; &gt; &gt; Hi Mike,
&gt; &gt; &gt; 
&gt; &gt; &gt; perhaps you can try to upgrade the protocol buffers library to at
&gt; &gt; &gt; least
&gt; &gt; &gt; version 2.3.0. This is from the changelog for that version:
&gt; &gt; &gt; 
&gt; &gt; &gt; Python
&gt; &gt; &gt; \* 10-25 times faster than 2.2.0, still pure-Python.
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Cheers,
&gt; &gt; &gt; Nico
&gt; &gt; &gt; 
&gt; &gt; &gt; Am Montag, den 14.02.2011, 19:35 -0500 schrieb Mike Stoddart:
&gt; &gt; &gt; &gt; Will do when I get time. Would the REST API be any faster?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Thanks
&gt; &gt; &gt; &gt; Mike
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; On Mon, Feb 14, 2011 at 7:01 PM, Thomas Burdick
&gt; &gt; &gt; &gt;  wrote:
&gt; &gt; &gt; &gt; &gt; I would highly recommend looking in to the cProfile and pstat
&gt; &gt; &gt; &gt; &gt; module and
&gt; &gt; &gt; &gt; &gt; profile the code that is going slow. If your using the protocol
&gt; &gt; &gt; &gt; &gt; buffer
&gt; &gt; &gt; &gt; &gt; client it could possibly be related to the fact that python
&gt; &gt; &gt; &gt; &gt; protocol buffers
&gt; &gt; &gt; &gt; &gt; is extraordinarily slow and is well known to be slow. Profile
&gt; &gt; &gt; &gt; &gt; until proven
&gt; &gt; &gt; &gt; &gt; guilty though.
&gt; &gt; &gt; &gt; &gt; Tom Burdick
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; On Mon, Feb 14, 2011 at 7:09 AM, Mike Stoddart
&gt; &gt; &gt; &gt; &gt;  wrote:
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; I added some code to my system to test writing data into Riak.
&gt; &gt; &gt; &gt; &gt; &gt; I'm
&gt; &gt; &gt; &gt; &gt; &gt; using the Python client library with protocol buffers. I'm
&gt; &gt; &gt; &gt; &gt; &gt; writing a
&gt; &gt; &gt; &gt; &gt; &gt; snapshot of my current data, which is one json object
&gt; &gt; &gt; &gt; &gt; &gt; containing on
&gt; &gt; &gt; &gt; &gt; &gt; average 60 individual json sub-objects. Each sub object
&gt; &gt; &gt; &gt; &gt; &gt; contains about
&gt; &gt; &gt; &gt; &gt; &gt; 22 values.
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; # Archived entry. ts is a formatted timestamp.
&gt; &gt; &gt; &gt; &gt; &gt; entry = self.\_bucket.new(ts, data=data)
&gt; &gt; &gt; &gt; &gt; &gt; entry.store()
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; # Now write the current entry.
&gt; &gt; &gt; &gt; &gt; &gt; entry = self.\_bucket.new("current", data=data)
&gt; &gt; &gt; &gt; &gt; &gt; entry.store()
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; I'm writing the same data twice; the archived copy and the
&gt; &gt; &gt; &gt; &gt; &gt; current
&gt; &gt; &gt; &gt; &gt; &gt; copy, which I can easily retrieve later. Performance is lower
&gt; &gt; &gt; &gt; &gt; &gt; than
&gt; &gt; &gt; &gt; &gt; &gt; expected; top is showing a constant cpu usage of 10-12%.
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; I haven't decided to use Riak; this is to help me decide. But
&gt; &gt; &gt; &gt; &gt; &gt; for now
&gt; &gt; &gt; &gt; &gt; &gt; are there any optimisations I can do here? A similiar test
&gt; &gt; &gt; &gt; &gt; &gt; with
&gt; &gt; &gt; &gt; &gt; &gt; MongoDB shows a steady cpu usage of 1%. The cpu usages are for
&gt; &gt; &gt; &gt; &gt; &gt; my
&gt; &gt; &gt; &gt; &gt; &gt; client, not Riak's own processes. The only differences in my
&gt; &gt; &gt; &gt; &gt; &gt; test app
&gt; &gt; &gt; &gt; &gt; &gt; is the code that writes the data to the database. Otherwise
&gt; &gt; &gt; &gt; &gt; &gt; all other
&gt; &gt; &gt; &gt; &gt; &gt; code is 100% the same between these two test apps.
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; Any suggestions appreciated.
&gt; &gt; &gt; &gt; &gt; &gt; Thanks
&gt; &gt; &gt; &gt; &gt; &gt; Mike
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

