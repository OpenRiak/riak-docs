---
title: "Re: Invalid hintfiles"
description: ""
project: community
lastmod: 2013-09-18T20:29:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12318"
mailinglist_parent_id: "msg12317"
author_name: "Andrew Stone"
project_section: "mailinglistitem"
sent_date: 2013-09-18T20:29:13-07:00
---


Hi Toby,

Can you try raising the pb\_backlog to 128 in your riak app.config on each
node. It's likely those disconnect errors are left over from the stampede
of connections from the CS connection pool on startup. For one reason or
another the resets don't come through and the hanging disconnected socket
isn't discovered until the next send attempt.

-Andrew


On Wed, Sep 18, 2013 at 10:31 PM, Toby Corkindale &lt;
toby.corkind...@strategicdata.com.au&gt; wrote:

&gt; On 19/09/13 11:17, Luke Bakken wrote:
&gt;
&gt;&gt; The "error: disconnected" message is a good clue. If you can provide
&gt;&gt; log files that may point to the cause.
&gt;&gt;
&gt;
&gt; See below for logs from riak and riak cs, for a roughly five minute window
&gt; during which I'd fiddled with the load balancer and DNS to try and isolate
&gt; this server from other requests, and only send mine to it.
&gt;
&gt; Unfortunately I really don't see much in there apart from the disconnected
&gt; messages. I did note that there were warnings about system hitting high
&gt; watermarks for memory at one point though. That's a bit odd, as the machine
&gt; wasn't near max capacity at any point - it's only 8GB, but 'free' was
&gt; reporting that most was being used just for buffers and cache at the time;
&gt; as follows:
&gt;
&gt; ie.
&gt; total used free shared buffers cached
&gt; Mem: 8176412 3803404 4373008 0 34112 3052340
&gt; -/+ buffers/cache: 716952 7459460
&gt; Swap: 3903484 0 3903484
&gt;
&gt;
&gt; ======= erlang.log (riak cs) =========
&gt;
&gt; ===== Thu Sep 19 11:58:46 EST 2013
&gt; 11:58:46.287 [info] alarm\_handler: {set,{system\_memory\_high\_\*\*
&gt; watermark,[]}}^M
&gt; 12:00:47.864 [info] webmachine\_log\_handler: closing log file:
&gt; "/var/log/riak-cs/access.log"
&gt; ^M
&gt; 12:00:47.865 [info] opening log file: "/var/log/riak-cs/access.log.\*\*
&gt; 2013\_09\_19\_02"
&gt; ^M
&gt; 12:00:50.081 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:00:51.013 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:00:51.406 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:01:49.320 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:02:04.662 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:03:37.330 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:06:24.345 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:06:41.670 [error] Retrieval of user record for s3 failed. Reason:
&gt; disconnected^M
&gt; 12:06:46.554 [info] Finished garbage collection: 0 seconds, 0 batch\_count,
&gt; 0 batch\_skips, 0 manif\_count, 0 block\_count^M
&gt; 12:11:46.300 [info] alarm\_handler: {clear,system\_memory\_high\_\*\*
&gt; watermark}^M
&gt; 12:16:46.305 [info] alarm\_handler: {set,{system\_memory\_high\_\*\*
&gt; watermark,[]}}^M
&gt; 12:18:46.307 [info] alarm\_handler: {clear,system\_memory\_high\_\*\*
&gt; watermark}^M
&gt; ==============================\*\*==========
&gt;
&gt;
&gt; ===== console.log (riak cs) ===================
&gt; 2013-09-19 12:00:47.865 [info] &lt;0.94.0&gt; opening log file:
&gt; "/var/log/riak-cs/access.log.\*\*2013\_09\_19\_02"
&gt;
&gt; 2013-09-19 12:00:50.081 [error] 
&gt; &lt;0.7092.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:00:51.013 [error] 
&gt; &lt;0.10406.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:00:51.406 [error] 
&gt; &lt;0.11179.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:01:49.320 [error] 
&gt; &lt;0.11197.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:02:04.662 [error] 
&gt; &lt;0.9667.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:03:37.330 [error] 
&gt; &lt;0.11343.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:06:24.345 [error] 
&gt; &lt;0.11589.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:06:41.670 [error] 
&gt; &lt;0.11215.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:06:46.554 [info] 
&gt; &lt;0.274.0&gt;@riak\_cs\_gc\_d:\*\*fetching\_next\_fileset:162
&gt; Finished garbage collection: 0 seconds, 0 batch\_count, 0 batch\_skips, 0
&gt; manif\_count, 0 block\_count
&gt; 2013-09-19 12:11:46.300 [info] &lt;0.41.0&gt; alarm\_handler:
&gt; {clear,system\_memory\_high\_\*\*watermark}
&gt; 2013-09-19 12:16:46.305 [info] &lt;0.41.0&gt; alarm\_handler:
&gt; {set,{system\_memory\_high\_\*\*watermark,[]}}
&gt; 2013-09-19 12:18:46.307 [info] &lt;0.41.0&gt; alarm\_handler:
&gt; {clear,system\_memory\_high\_\*\*watermark}
&gt; ==============================\*\*================
&gt;
&gt;
&gt;
&gt; ======= error.log (riak cs) ================
&gt; 2013-09-19 12:00:50.081 [error] 
&gt; &lt;0.7092.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:00:51.013 [error] 
&gt; &lt;0.10406.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:00:51.406 [error] 
&gt; &lt;0.11179.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:01:49.320 [error] 
&gt; &lt;0.11197.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:02:04.662 [error] 
&gt; &lt;0.9667.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:03:37.330 [error] 
&gt; &lt;0.11343.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:06:24.345 [error] 
&gt; &lt;0.11589.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; 2013-09-19 12:06:41.670 [error] 
&gt; &lt;0.11215.0&gt;@riak\_cs\_wm\_common:\*\*maybe\_create\_user:223
&gt; Retrieval of user record for s3 failed. Reason: disconnected
&gt; ==============================\*\*======
&gt;
&gt;
&gt;
&gt; ========= erlang.log (riak) ==========
&gt; ===== ALIVE Thu Sep 19 12:01:04 EST 2013
&gt;
&gt; ===== ALIVE Thu Sep 19 12:16:04 EST 2013
&gt; ==============================\*\*========
&gt;
&gt;
&gt; =========== console.log (riak) =========
&gt; 2013-09-19 12:03:05.471 [info] 
&gt; &lt;0.146.0&gt;@riak\_core\_gossip:\*\*log\_membership\_changes:372
&gt; 'riak@mel-storage04.\*\*strategicdata.internal' joined cluster with status
&gt; 'joining'
&gt; 2013-09-19 12:03:21.048 [info] 
&gt; &lt;0.146.0&gt;@riak\_core\_gossip:\*\*log\_membership\_changes:378
&gt; 'riak@mel-storage04.\*\*strategicdata.internal' changed from 'joining' to
&gt; 'valid'
&gt; 2013-09-19 12:03:26.235 [info] 
&gt; &lt;0.182.0&gt;@riak\_core\_handoff\_\*\*manager:handle\_info:286
&gt; An outbound handoff of partition riak\_kv\_vnode
&gt; 274031556999544297163190906134\*\*303066185487351808 was terminated for
&gt; reason: {shutdown,max\_concurrency}
&gt;
&gt; ^^ very similar messages to that repeat a few hundred times ^^
&gt;
&gt; ==============================\*\*============
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

