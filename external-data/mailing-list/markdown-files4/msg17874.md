---
title: "Re: Riak CS race condition at start-up (was: Riak-CS issues when Riak	endpoint fails-over to new server)"
description: ""
project: community
lastmod: 2017-01-22T19:29:40-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17874"
mailinglist_parent_id: "msg17872"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2017-01-22T19:29:40-08:00
---


Thanks Luke.

We're using the official Basho Ubuntu packages for Ubuntu 14.04 LTS.
These don't seem to perform that step; they just start Riak CS
simultaneously with Riak KV.

I'm surprised if we're the only people who hit this. Don't people hit these
issues in your other production deployments, or are they running on another
platforms that have more finessed start-up scripts?

Toby


On Sat, 21 Jan 2017 at 03:19 Luke Bakken  wrote:

&gt; Hi Toby,
&gt;
&gt; The process you use to run "riak-cs start" could use the "riak-admin
&gt; wait-for-service riak\_kv" command to ensure Riak is ready first:
&gt;
&gt;
&gt; http://docs.basho.com/riak/kv/2.2.0/using/admin/riak-admin/#wait-for-service
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt;
&gt; On Thu, Jan 19, 2017 at 5:38 PM, Toby Corkindale  wrote:
&gt; &gt; Hi guys,
&gt; &gt; I've switched our configuration around, so that Riak CS now talks to
&gt; &gt; 127.0.0.1:8087 instead of the haproxy version.
&gt; &gt;
&gt; &gt; We have immediately re-encountered the problems that caused us to move to
&gt; &gt; haproxy.
&gt; &gt; On start-up, riak takes slightly longer than riak-cs to get ready, and so
&gt; &gt; riak-cs logs the following then exits.
&gt; &gt; Restarting riak-cs again (so now 15 seconds after Riak started) results
&gt; in a
&gt; &gt; successful start-up, but obviously this is really annoying for our ops
&gt; guys
&gt; &gt; to have to remember to do after restarting riak or rebooting a machine.
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

