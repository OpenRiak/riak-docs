---
title: "Re: Memory backend doesn't work (with multi backend)?"
description: ""
project: community
lastmod: 2016-06-23T11:07:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17493"
mailinglist_parent_id: "msg17491"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2016-06-23T11:07:58-07:00
---


Hello,

I think the documentation for multi backend could use some
improvement. Once you configure Riak to use the "multi" storage
backend, you must then \*name\* backends to be used by your bucket
types:

Here is a configuration that you can use, that would create two
backends, one using the memory backend that is \*named\*
"my\_memory\_backend", and one using the leveldb backend that is named
"my\_leveldb\_backend":

In riak.conf:

storage\_backend = multi
multi\_backend.my\_memory\_backend.storage\_backend = memory
multi\_backend.my\_leveldb\_backend.storage\_backend = leveldb

The following is an example of setting a leveldb-specific setting for
the "my\_leveldb\_backend" named backend:

multi\_backend.my\_leveldb\_backend.leveldb.maximum\_memory.percent = 70

Then, you associate your "os\_cache" bucket type with
"my\_memory\_backend" this way:

riak-admin bucket-type create os\_cache '{"props": {"write\_once":
true,"backend":"my\_memory\_backend","n\_val":2,"r":1,"w":1,"dw":1}}'
riak-admin bucket-type activate os\_cache

Please let me know if this resolves your issue. You may have to remove
the content's of Riak's data and ring directories to overwrite your
old settings.

I have filed an issue in GitHub to improve the documentation for
multi-backend: https://github.com/basho/basho\_docs/issues/2123

--
Luke Bakken
Engineer
lbak...@basho.com

On Wed, Jun 22, 2016 at 5:34 AM, Nagy, Attila  wrote:
&gt; Hi,
&gt;
&gt; Trying to use the memory backend via multi.
&gt;
&gt; What I did:
&gt; in riak.conf:
&gt; storage\_backend = multi
&gt;
&gt; Then creating a bucket type:
&gt; riak-admin bucket-type create os\_cache '{"props": {"write\_once":
&gt; true,"backend":"memory","n\_val":2,"r":1,"w":1,"dw":1}}'
&gt; riak-admin bucket-type activate os\_cache
&gt;
&gt; Then I PUT an object:
&gt; curl -v -XPUT -H "Content-Type: application/octet-stream"
&gt; 'http://localhost:8098/types/os\_cache/buckets/os\_cache/keys/test1' -d 'test'
&gt;
&gt; Mext, I shut down all of the servers at once, leaving nothing in the
&gt; cluster, then restarting them.
&gt; And a new get for the above URL returns "test".
&gt;
&gt; When I set storage\_backend to memory, it works as expected, after a full
&gt; cluster stop, the bucket is empty.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

