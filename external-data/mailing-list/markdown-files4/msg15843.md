---
title: "Re: Riak 2.0 Search Issues"
description: ""
project: community
lastmod: 2015-03-05T09:16:47-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15843"
mailinglist_parent_id: "msg15835"
author_name: "Steve Garon"
project_section: "mailinglistitem"
sent_date: 2015-03-05T09:16:47-08:00
---


Does deleting core.properties or moving search-root/index deletes any of my
index data? Will that cause any interruption to SOLR? Cause I'm having
problems on a production cluster and I really don't want to have to backup
300 millions keys again or cause any interruptions to the system ...


Steve

On 5 March 2015 at 10:11, Zeeshan Lakhani  wrote:

&gt; Hey Steve,
&gt;
&gt; We’re currently tracking this issue,
&gt; https://github.com/basho/yokozuna/issues/442, and are working on testing
&gt; out a patch internally. I will update you as soon as we get clarity there.
&gt;
&gt; As a possible workaround, I would attempt to delete the `core.properties`
&gt; file located in the search root\_directory/index of each node
&gt; (./data/yz/&lt;&gt;). This file should then be recreated on the next
&gt; attempt to creating the core on the Solr side,
&gt; https://github.com/basho/yokozuna/blob/92ca14cc35b46c8e7ac86cad6d92547e68e8d917/src/yz\_index.erl#L171
&gt; .
&gt;
&gt; If that doesn’t work, you can then delete or `mv` that search-root/index
&gt; directory out of the way, for which it will then get recreated and AAE will
&gt; sync the data.
&gt;
&gt; Thanks.
&gt;
&gt; Zeeshan Lakhani
&gt; programmer |
&gt; software engineer at @basho |
&gt; org. member/founder of @papers\_we\_love | paperswelove.org
&gt; twitter =&gt; @zeeshanlakhani
&gt;
&gt; On Mar 5, 2015, at 9:02 AM, Steve Garon  wrote:
&gt;
&gt; In solr.log, the kind of exceptions that I'm getting right now is the
&gt; following:
&gt;
&gt; 1. IO Error while trying to get the size of the
&gt; Directory:java.io.FileNotFoundException: SOME\_RAMDOM\_FILE\* (.doc, .pos,
&gt; .fnm, .si, .nv, .gen extensions)\*
&gt; 2. SolrException.java:120 null:org.apache.sorl.common.SolrException: Core
&gt; with name 'BUCKET NAME' already exists.
&gt; 3. SolrException.java:120 null:org.eclipse.jetty.io.EofException
&gt; 4. Server refused connection
&gt; 5. IOException occured when talking to server
&gt;
&gt;
&gt;
&gt;
&gt; Steve
&gt;
&gt; On 5 March 2015 at 08:50, Steve Garon  wrote:
&gt;
&gt;&gt; Yes I do have yz\_events,handle\_info in crash log. Tons of them actually
&gt;&gt; and they have a big ass strack trace attached to each of them.
&gt;&gt;
&gt;&gt; It would be hard for me to provide you with logs. If you have specific
&gt;&gt; questions you want answers to I'd be happy to help though.
&gt;&gt;
&gt;&gt;
&gt;&gt; Steve
&gt;&gt;
&gt;&gt; On 4 March 2015 at 14:20, Zeeshan Lakhani  wrote:
&gt;&gt;
&gt;&gt;&gt; Hey Steve,
&gt;&gt;&gt;
&gt;&gt;&gt; Sorry to see you’re having new issues.
&gt;&gt;&gt;
&gt;&gt;&gt; We’ll have the fix for “space in the key” out soon; it’s currently under
&gt;&gt;&gt; review. And, I know that this issue is unrelated.
&gt;&gt;&gt;
&gt;&gt;&gt; I have a few different routes/thoughts for you, but are you seeing
&gt;&gt;&gt; anything related to `yz\_events,handle\_info` in your crash logs? Also, can
&gt;&gt;&gt; you gist/pastebin me your solr logs? I’d like to seem if it correlates with
&gt;&gt;&gt; something we’re currently looking at.
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks.
&gt;&gt;&gt;
&gt;&gt;&gt; Zeeshan Lakhani
&gt;&gt;&gt; programmer |
&gt;&gt;&gt; software engineer at @basho |
&gt;&gt;&gt; org. member/founder of @papers\_we\_love | paperswelove.org
&gt;&gt;&gt; twitter =&gt; @zeeshanlakhani
&gt;&gt;&gt;
&gt;&gt;&gt; On Mar 4, 2015, at 10:39 AM, Steve Garon  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hey all,
&gt;&gt;&gt;
&gt;&gt;&gt; We were having the "space in the key" bug in our cluster so we went
&gt;&gt;&gt; through the whole dataset, backing it up to json file and removing the
&gt;&gt;&gt; spaces in the keys. Then we trashed our whole cluster and restart from
&gt;&gt;&gt; scratch reimporting the whole data. Everything worked like a charm for two
&gt;&gt;&gt; weeks but this weekend, not sure what happened but AAE died again.
&gt;&gt;&gt;
&gt;&gt;&gt; I have two issues now:
&gt;&gt;&gt; 1. AAE is trying to recreate an index that already exists and crashes
&gt;&gt;&gt; with an "Already exists" error ... I get this in my error log every 15
&gt;&gt;&gt; seconds
&gt;&gt;&gt; 2. AAE crashes while iterating through entropy data with a request
&gt;&gt;&gt; timeout error every hour followed by tons of failed to index objects with
&gt;&gt;&gt; request timeout as well. Stack trace looks like this:
&gt;&gt;&gt;
&gt;&gt;&gt; \*[error] emulator Error in process &lt;025931.7166&gt; on node 'riak@IP' with
&gt;&gt;&gt; exit value: {function\_clause,[{yz\_entropy,iterate\_entropy\_data,[&lt;&lt;11
&gt;&gt;&gt; bytes&gt;&gt;,[{continuation,&lt;&lt;159
&gt;&gt;&gt; bytes&gt;&gt;},{limit,100},{partition,12}],#Fun&gt;&gt; \*\*(TRUNCATED)\*
&gt;&gt;&gt;
&gt;&gt;&gt; \*[error] &lt;0.1371.0&gt;@yz\_kv:index:215 failed to index object
&gt;&gt;&gt; {{&lt;&lt;"TYPE"&gt;&gt;,&lt;&lt;"BUCKET"&gt;&gt;},&lt;&lt;"KEY"&gt;&gt;} with error {"Failed to index
&gt;&gt;&gt; docs",{error,req\_timeout}} because ... \*\*(REPEATED MULTIPLE TIME FOR
&gt;&gt;&gt; DIFFERENT KEYS)\*
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I tried clearing the yz anti-entropy tree and reinitialising the
&gt;&gt;&gt; yz\_entropy\_mgr with no luck. Anything I can do to fix this?
&gt;&gt;&gt;
&gt;&gt;&gt; Oh FYI, I cannot insert data with spaces in the key anymore because we
&gt;&gt;&gt; are using a wrapper on top of riak that will prevent us to do so therefore
&gt;&gt;&gt; my issues are not related to this for sure.
&gt;&gt;&gt;
&gt;&gt;&gt; These are some config changes that may be good to know for more context.
&gt;&gt;&gt;
&gt;&gt;&gt; We added this to ibrowse.conf:
&gt;&gt;&gt; {dest, "localhost", 8093, 100, 1000, []}.
&gt;&gt;&gt;
&gt;&gt;&gt; Jetty is set with minthread 80, acceptors 80, and is using the NIO
&gt;&gt;&gt; connector.
&gt;&gt;&gt;
&gt;&gt;&gt; All our solr buckets have filterCache disabled with softcommits set to
&gt;&gt;&gt; 10s instead of 1.
&gt;&gt;&gt;
&gt;&gt;&gt; Our riak.conf has background\_manager turned on with AAE and handoff
&gt;&gt;&gt; using it.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;
&gt;&gt;&gt; Steve
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

