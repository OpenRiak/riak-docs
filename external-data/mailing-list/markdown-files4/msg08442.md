---
title: "Re: LevelDB memory problem crashes Erlang"
description: ""
project: community
lastmod: 2012-09-03T12:56:04-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08442"
mailinglist_parent_id: "msg08440"
author_name: "Kresten Krab Thorup"
project_section: "mailinglistitem"
sent_date: 2012-09-03T12:56:04-07:00
---


You could try running riak with the HanoiDB backend. It is not as fast as 
LevelDB but uses less memory/open files, and otherwise has similar 
characteristics. 

https://github.com/basho-labs/riak\_kv\_hanoidb\_backend

The nice things with Hanoi are that it has better worst case response time, and 
it is pure Erlang. 

Let me know if you want help trying it out. 

Kresten,
Trifork 

On 03/09/2012, at 20.30, "leonickel"  wrote:

&gt; Hello guys, i've put this issue on hold and now i'm back on it. I tried to
&gt; increase memory for riak user in limits.conf but still getting the same
&gt; problem. I start my riak node and begin storing some data when at a certain
&gt; of time (proccess "/usr/lib/riak/erts-5.9.1/bin/beam.smp" with 500mb
&gt; approximately) erlang crashes and system goes down. A few seconds before
&gt; system crashes i've got this bevahior on "riak-admin top":
&gt; 
&gt; ========================================================================================
&gt; 'riak@127.0.0.1' 
&gt; 18:02:20
&gt; Load: cpu 154 Memory: total 25213 binary 
&gt; 1463
&gt; procs 1435 processes 5795 code 
&gt; 5249
&gt; runq 0 atom 338 ets 
&gt; 9556
&gt; 
&gt; Pid Name or Initial Func Time Reds Memory MsgQ Current
&gt; Function
&gt; ----------------------------------------------------------------------------------------
&gt; &lt;6086.103.0&gt; application\_master:s '-' 0 300524 0
&gt; application\_master:l
&gt; &lt;6086.43.0&gt; release\_handler '-' 0 115092 0
&gt; gen\_server:loop/6 
&gt; &lt;6086.150.0&gt; riak\_core\_vnode\_prox '-' 0 73868 0
&gt; gen\_server:loop/6 
&gt; &lt;6086.32.0&gt; erlang:apply/2 '-' 0 71348 0
&gt; shell:get\_command1/5
&gt; &lt;6086.153.0&gt; riak\_core\_vnode\_mana '-' 16861 49368 0
&gt; gen\_server:loop/6 
&gt; &lt;6086.69.0&gt; memsup '-' 0 44268 0
&gt; gen\_server:loop/6 
&gt; &lt;6086.30485.4&gt; proc\_lib:init\_p/5 '-' 3335631 44268 0
&gt; mochiweb\_http:reques
&gt; &lt;6086.25.0&gt; code\_server '-' 0 44248 0
&gt; code\_server:loop/1 
&gt; &lt;6086.3.0&gt; erl\_prim\_loader '-' 0 44208 0
&gt; erl\_prim\_loader:loop
&gt; &lt;6086.7.0&gt; application\_controll '-' 0 27964 0
&gt; gen\_server:loop/6 
&gt; ========================================================================================
&gt; 
&gt; Output server crashed: noconnection
&gt; 
&gt; On "riak-admin status" command my system seems to be healthy:
&gt; 
&gt; (...)
&gt; mem\_total : 4081463296
&gt; mem\_allocated : 3447291904
&gt; disk : [{"/",144185016,76},
&gt; {"/dev",1986272,1},
&gt; {"/dev/shm",1992900,1},
&gt; {"/var/run",1992900,1},
&gt; {"/var/lock",1992900,0},
&gt; {"/home",288370316,97}]
&gt; nodename : 'riak@127.0.0.1'
&gt; connected\_nodes : []
&gt; sys\_driver\_version : &lt;&lt;"2.0"&gt;&gt;
&gt; sys\_global\_heaps\_size : 0
&gt; sys\_heap\_type : private
&gt; sys\_logical\_processors : 4
&gt; sys\_otp\_release : &lt;&lt;"R15B01"&gt;&gt;
&gt; sys\_process\_count : 1391
&gt; sys\_smp\_support : true
&gt; sys\_system\_version : &lt;&lt;"Erlang R15B01 (erts-5.9.1) [source] [smp:4:4]
&gt; [async-threads:64] [kernel-poll:true]"&gt;&gt;
&gt; sys\_system\_architecture : &lt;&lt;"i686-pc-linux-gnu"&gt;&gt;
&gt; sys\_threads\_enabled : true
&gt; sys\_thread\_pool\_size : 64
&gt; sys\_wordsize : 4
&gt; ring\_members : ['riak@127.0.0.1']
&gt; ring\_num\_partitions : 64
&gt; ring\_ownership : &lt;&lt;"[{'riak@127.0.0.1',64}]"&gt;&gt;
&gt; ring\_creation\_size : 64
&gt; storage\_backend : riak\_kv\_eleveldb\_backend
&gt; riak\_api\_version : &lt;&lt;"1.2.0"&gt;&gt;
&gt; (...)
&gt; 
&gt; I'm running a single riak node with "n\_val=1", "allow\_mult=false" and
&gt; "last\_write\_wins=true".
&gt; Is there any erlang configuration that I am missing ou doing wrong?
&gt; 
&gt; Thanks for the help!
&gt; 
&gt; Leo
&gt; 
&gt; 
&gt; 
&gt; 
&gt; --
&gt; View this message in context: 
&gt; http://riak-users.197444.n3.nabble.com/LevelDB-memory-problem-crashes-Erlang-tp4024974p4025155.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

