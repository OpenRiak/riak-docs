---
title: "Re: Atomicity of if_not_modified?"
description: ""
project: community
lastmod: 2013-01-03T12:36:01-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09730"
mailinglist_parent_id: "msg09690"
author_name: "Pavan Venkatesh"
project_section: "mailinglistitem"
sent_date: 2013-01-03T12:36:01-08:00
---


Hi,
If its through http, "ifnotmodified" will only store if there has been no
modification since the provided timestamp (conditional store).
With your example of N=3, R=2 and W=2, if two clients are updating at the
same time to the same object, then it actually depends on the "allow\_mult"
and "last\_write\_wins" variable.

Case 1-- If allow\_mult is true and last\_write\_wins is false, then siblings
are created and replicated among the nodes. It has to be resolved on the
client side. Client will have to issue a "put" request later along with the
vector clock and with the relevant value in order to resolve the sibling
scenario.

Case 2 If allow\_mult is false and last write\_wins is true, then the client
with the latest time stamp wins. Siblings might occur here, but is not
exposed to the client.

Case 3 If allow\_mult is false and last write\_wins is false, then resolve
differences using vector clock(this happens internally). The latest one is
returned if siblings still exists.

Case 4 If allow\_mult is true and last write\_wins is true, then the client
with the latest time stamp wins.

More Details on "IfnotModified" below-
ifNotModified
public StoreObject 
  &gt; ifNotModified(boolean ifNotModified)
Default is false (i.e. NOT a conditional store).

 NOTE: This has different meanings depending on the underlying transport.
 

 In the case of the PB interface it means: Only store if the vclock provided
with the store is the same as the one in Riak for this object (i.e. the
object has not been modified since you last got it), of course, since this
StoreObject does a fetch before a store the window for concurrent
modification is minimized, but this is an extra guard, still.
 

 For the HTTP API it means: Only store if there has been no modification
since the provided timestamp.
 

 To make this transparent the StoreOperation will pull the last modified
date from the object returned in the pre-store fetch, and use that as
supplementary data to the HTTP Store request.

Parameters:ifNotModified - true if you want a conditional store, false
otherwise, defaults to false. Returns:This

Pavan


From: qaspar 
Date: Thursday, January 3, 2013 8:46 AM
To: 
Subject: Re: Atomicity of if\_not\_modified?


Hi,

Can someone confirm this? If it's true, what exactly is the purpose of
offering the if\_not\_modified flag?

Kaspar

On Dec 28, 2012 1:51 PM, "Daniil Churikov [via Riak Users]" &lt;[hidden email]
 &gt; wrote:
&gt; Riak doesn't have atomic updates. This if\_not\_modified does not gives you any
&gt; guaranties. Best way to handle with simultaneously updates is try to engineer
&gt; scheme so that only one client makes concurrent updates and in case of
&gt; conflict any sibling will be good for you. Another option is try to use
&gt; convergent data types [0][1]
&gt; [0] https://github.com/basho/riak\_dt
&gt; [1] https://github.com/mochi/statebox\_riak
&gt; 
&gt; 
&gt; If you reply to this email, your message will be added to the discussion
&gt; below:
&gt; http://riak-users.197444.n3.nabble.com/Atomicity-of-if-not-modified-tp4026430p
&gt; 4026431.html 
&gt; To unsubscribe from Atomicity of if\_not\_modified?, click here.
&gt; NAML 
&gt;  iewer&id=instant\_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicN
&gt; amespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.Nod
&gt; eNamespace&breadcrumbs=notify\_subscribers%21nabble%3Aemail.naml-instant\_emails
&gt; %21nabble%3Aemail.naml-send\_instant\_email%21nabble%3Aemail.naml&gt;


View this message in context: Re: Atomicity of if\_not\_modified?
 
Sent from the Riak Users mailing list archive
 at Nabble.com.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

