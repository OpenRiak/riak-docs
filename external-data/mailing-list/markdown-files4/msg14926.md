---
title: "Still merge errors in patched riak_kv_bitcask_backend"
description: ""
project: community
lastmod: 2014-09-25T07:12:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14926"
author_name: "Damien Krotkine"
project_section: "mailinglistitem"
sent_date: 2014-09-25T07:12:05-07:00
---




Hi,

I'm using Riak 2.0 and the latest riak\_kv\_bitcask\_backend.beam patch 
from this very mailing list [0], but I'm still experiencing merge errors:


$ md5sum /usr/lib64/riak/lib/basho-patches/riak\_kv\_bitcask\_backend.beam
751dcf22ba4ce17630db062b0c646305

riak attach shows:
&gt; code:which(riak\_kv\_bitcask\_backend).
"/usr/lib64/riak/lib/basho-patches/riak\_kv\_bitcask\_backend.beam"

Alas, I still get a lot of merging errors [1]. Note that I use a merging 
strategy that is maybe not too common: I make sure Riak waits before a 
file is completely full of out-dated keys, before it tries to merge it.


Any hint ? Shall I open a github issue ?

Thanks,
dams.

[0] 
http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2014-September/015897.html


[1]
2014-09-25 14:07:16.291 [info] &lt;0.16612.8&gt; All keys expired in: 
"/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/112.bitcask.data" 
scheduling file for deletion
2014-09-25 14:07:16.298 [error] &lt;0.16612.8&gt; Failed to merge 
{["/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/96.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/94.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/92.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/91.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/90.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/89.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/125.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/124.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/123.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/122.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/121.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/120.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/118.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/117.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/116.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/114.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/112.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/110.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/108.bitcask.data","/var/lib/riak/bitcask\_mult\_events/822094670998632891489572718402909198556462055424/106.bi...",...],...}: 
{generic\_failure,error,badarg,[{bitcask\_nifs,keydir\_remove\_int,[&lt;&lt;&gt;&gt;,{tombstone,&lt;&lt;2,0,6,101,118,101,110,116,115,49,52,49,49,49,54,49,53,56,49,58,49,58,69,88,80,58,58,48&gt;&gt;},1411161602,114,&lt;&lt;133,167,151,16,0,0,0,0&gt;&gt;,1411654036],[]},{bitcask,'-expiry\_merge/4-fun-0-',7,[{file,"src/bitcask.erl"},{line,1912}]},{bitcask\_fileops,fold\_hintfile\_loop,5,[{file,"src/bitcask\_fileops.erl"},{line,660}]},{bitcask\_fileops,fold\_file\_loop,8,[{file,"src/bitcask\_fileops.erl"},{line,720}]},{bitcask\_fileops,fold\_hintfile,3,[{file,"src/bitcask\_fileops.erl"},{line,624}]},{bitcask,expiry\_merge,4,[{file,"src/bitcask.erl"},{line,1915}]},{bitcask,merge1,4,[{file,"src/bitcask.erl"},{line,686}]},{bitcask,merge,3,[{file,"src/bitcask.erl"},{line,566}]}]}






--
Damien Krotkine, IT Developer, Paris, France.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

