---
title: "Re: Re: Questions about the Riak Horizontal Scalability"
description: ""
project: community
lastmod: 2014-03-11T09:49:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13786"
mailinglist_parent_id: "msg13781"
author_name: "Greg Burd"
project_section: "mailinglistitem"
sent_date: 2014-03-11T09:49:41-07:00
---


A few things:

1. can you provide the output from `riak-admin member-status`?
2. using five VMs per physical node likely means that you're bottleneck is
that host running the VMs not Riak
3. uses a shared disk via iSCSI for storage is most certainly also a
bottleneck

A benchmark that scales linearly uses distinct resources, not shared
resources. That's the dynamo model, that's the way to test Riak. Setup 5
distinct machines, run the basho bench test. Add five more, run it again.
 You'll see a difference. Also, if possible use two network interfaces: 1)
for inbound TCP/PB or HTTP/TCP traffic from basho\_bench (clients
communicating with the cluster), 2) for communication between nodes
(disterl messages) and handoff.

Also, make sure that the system running basho\_bench is not also a Riak
node. That'd skew results as well.

-greg

@gregburd | Basho Technologies | Riak | http://basho.com | @basho


On Mon, Mar 10, 2014 at 2:43 AM, yanqun....@mesheven.com &lt;
yanqun....@mesheven.com&gt; wrote:

&gt; Greate thanks to all of you!
&gt; I'm very sorry for a late response!
&gt; Is it polite to make a reply to all in one email? (If not, ask for
&gt; forgiveness)
&gt;
&gt; To Alexander:
&gt; There are 2 physical machines in our cluster, and 5 riak VMs on each
&gt; machine.
&gt; Two physical CPUs in each machine (totally 12 cores), and I assigned 2
&gt; cores for each riak VM.
&gt; All the 12 riak VMs are based on the same shared storage server (by
&gt; FreeNAS+iSCSI), whicn means all riak VMs don't use machines' local disks as
&gt; their storage.
&gt; And they are in a 1Gb LAN, each physical machine has 6 NICs, 4 of them are
&gt; for iSCSI(multipath).
&gt; So the network bandwidth is probably not the bottleneck, but disk IO
&gt; probably be.
&gt;
&gt; To Sean Cribbs:
&gt; Yes, as you said, more "concurrent" means more load for basho benchmark
&gt; machine.
&gt; But during my previous tests, I noticed that cpu utilization of basho
&gt; benchmark machine is about 50%.
&gt; But I want to try run basho benchmark tool on two machines as you
&gt; suggested.
&gt; I noticed the command "basho\_bench" has an option "-J --join", I tried but
&gt; faild with error report "escript: exception throw: {no\_host,'
&gt; root@10.11.20.44'} ".
&gt; I have configured SSH public-key&no-password login for those two basho
&gt; benchmark machines(they have same environments like OS,erlang and basho
&gt; benchmark versions). I searched about this, but didn't find how to run
&gt; basho benchmark tool on two separate machines.
&gt; Could you tell me how to do or is there any guidance about this?
&gt;
&gt; To Christian Dahlqvist:
&gt; Thanks for your tips, and I think we will try
&gt; "basho\_bench\_driver\_riakc\_pb".
&gt; Not only because of this "Horizontal Scalability" problem, but also for
&gt; better performance.
&gt; And also, I will change the key generator for subsequent tests.
&gt;
&gt; To Evan Vigil-McClanahan:
&gt; Yes, I am using Riak 2.0 for tests.
&gt; And "numa zones", "sbt"? Sorry I know little about this, but I will read
&gt; more about this to check if it can help me.
&gt;
&gt; I will run more tests with the suggestions from all of you!
&gt; Thank you again!
&gt; And I will let you know if get any progress or result.
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; \*From:\* Sean Cribbs 
&gt; \*Date:\* 2014-03-08 06:54
&gt; \*To:\* Alexander Sicular 
&gt; \*CC:\* yanqun....@mesheven.com; riak-users 
&gt; \*Subject:\* Re: Questions about the Riak Horizontal Scalability
&gt; Note as well that the 'concurrent' setting will \*not\* typically increase
&gt; throughput beyond a certain point (instead you will simply have many
&gt; workers waiting in the run queue). You are also only driving load from a
&gt; single machine with limits on its CPU and network throughput. Start by
&gt; trying a more reasonable concurrency level, like two (2) times the number
&gt; of CPU cores in the basho\_bench machine. Also consider running basho\_bench
&gt; from multiple machines at once. Consider the line rate of your network as
&gt; well; in the past I have easily been able to saturate a gigabit network
&gt; with basho\_bench.
&gt;
&gt;
&gt; On Fri, Mar 7, 2014 at 4:45 PM, Alexander Sicular wrote:
&gt;
&gt;&gt; How many physical machines (disks/cores/nics) are in your cluster?
&gt;&gt;
&gt;&gt; -Alexander
&gt;&gt;
&gt;&gt; @siculars
&gt;&gt; http://siculars.posthaven.com
&gt;&gt;
&gt;&gt; Sent from my iRotaryPhone
&gt;&gt;
&gt;&gt; On Mar 6, 2014, at 22:07, "yanqun....@mesheven.com" &lt;
&gt;&gt; yanqun....@mesheven.com&gt; wrote:
&gt;&gt;
&gt;&gt; Greetings all...
&gt;&gt;
&gt;&gt; I am running tests with Riak Cluster.
&gt;&gt; When this cluster has only one node, the max throughput is about 1500
&gt;&gt; ops/s(CPU becomes the bottleneck).
&gt;&gt; But after I added 4 more nodes into the cluster, no matter how I changed
&gt;&gt; the configuration file of Basho benchmark tool,
&gt;&gt; the number of throughput have never been more than ~3500 ops/s.
&gt;&gt; CPU utilization on each node is about 60~65% (captured by iostat and sar)
&gt;&gt;
&gt;&gt; And when I added 5 more nodes(10 nodes totally), it is the same result.
&gt;&gt; And CPU utilization on each node is about 60%.
&gt;&gt; I can't understand why.
&gt;&gt;
&gt;&gt; During the tests, I tried:
&gt;&gt; 1)Change ring size from 64 to 128
&gt;&gt; 2)Change basho benchmark configuration file, like "mode","concurrent" and
&gt;&gt; "key\_generator"...
&gt;&gt; 3)Modify some system limits on both riak nodes and basho bench servers,
&gt;&gt; such as file descriptor , tcp settings.
&gt;&gt; 4)Monitoring system like cpu, memory and IO, and none of them become
&gt;&gt; the bottleneck.
&gt;&gt; 5)Monitoring the basho bench server, low load.
&gt;&gt;
&gt;&gt; Any ideas?
&gt;&gt; Or did I make any mistakes in my configuration file?
&gt;&gt;
&gt;&gt; Configuration file of Basho benchmark tool:
&gt;&gt; ===================================================================
&gt;&gt; {mode, max}.
&gt;&gt; {duration, 15}.
&gt;&gt; {concurrent, 500}.
&gt;&gt; {driver, basho\_bench\_driver\_http\_raw}.
&gt;&gt; {http\_raw\_ips,
&gt;&gt; ["10.11.20.46","10.11.20.47","10.11.20.48","10.11.20.49","10.11.20.50","10.11.20.51","10.11.20.52","10.11.20.53"]}.
&gt;&gt; {http\_raw\_port, 8098}.
&gt;&gt; {http\_raw\_path, "/riak/test"}.
&gt;&gt; {key\_generator, {partitioned\_sequential\_int,
&gt;&gt; 1000000000000000,8000000000000000}}. %%we want 16 bytes long key-length
&gt;&gt; {value\_generator, {fixed\_bin, 1024}}. %%1KB
&gt;&gt; {operations, [{insert,4}, {get,6}]}.
&gt;&gt;
&gt;&gt; ===============================================================================
&gt;&gt;
&gt;&gt; Here are our server specifications(VMs based on Xenserver):
&gt;&gt; 1)Riak nodes: 2cores + 4GB RAM + 20GB disk
&gt;&gt; 2)Basho benchmark, 4 cores + 4GB RAM, 30GB disk.
&gt;&gt;
&gt;&gt; Thank you very much !
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

