---
title: "Re: Review request: revamped http transport"
description: ""
project: community
lastmod: 2011-09-07T17:43:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04597"
mailinglist_parent_id: "msg04596"
author_name: "Brett Hoerner"
project_section: "mailinglistitem"
sent_date: 2011-09-07T17:43:15-07:00
---


Greg, can you make a Github pull request from your branch?

It'd be easier to review the commits together (well, git log is easy)
but more importantly comment in-line.



On Wed, Sep 7, 2011 at 5:19 PM, Greg Stein  wrote:
&gt; Hi all,
&gt;
&gt; I've got a rough first cut of a modified RiakHttpTransport class. You
&gt; can review it here:
&gt; Â https://github.com/gstein/riak-python-client/commits/newhttp
&gt;
&gt; (note that it includes changes from my 'relax-deps' and 'simplify'
&gt; branches; just look at the most recent commit(s))
&gt;
&gt;
&gt; This code has been tested in very simple form. I haven't done an
&gt; extensive series of testing. No multi-thread, multiple hosts, etc. I
&gt; \*have\* verified that the HTTP connection is persistent, as expected,
&gt; so it should be much faster than normal. But I don't have any
&gt; performance tests to run. ... my hope is that some more experience
&gt; Riak python developers can do some testing.
&gt;
&gt; This is just a rough draft for initial review on the approach. It
&gt; needs comments and documentation, if people like the direction.
&gt;
&gt; Some comments on the ConnectionManager:
&gt;
&gt; \* when creating a ConnectionManager, you can specify multiple hosts
&gt; (eg. all the riak servers)
&gt; \* in a single-threaded environment, only one connection will be opened
&gt; right now. my next change will be to pre-open one connection to each
&gt; host.
&gt; \* when new connections are needed (ie. in a multi-threaded
&gt; environment), it round-robins across the set of servers
&gt; \* higher-level logic can remove hosts if they go down (I stlll need to
&gt; remove existing conns)
&gt; \* similarly, hosts can be added as they are discovered or added to the ring
&gt;
&gt;
&gt; With some more work to pass along multiple hosts to the constructor of
&gt; RiakHttpTransport, then the full capability is reached and
&gt; RiakHttpReuseTransport and RiakHttpPoolTransport can be removed.
&gt;
&gt; Similar changes can be made in pbc.py to use a ConnectionManager for
&gt; connections to the server(s), and RiakPbcCachedTransport can be
&gt; removed.
&gt;
&gt; Cheers,
&gt; -g
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

