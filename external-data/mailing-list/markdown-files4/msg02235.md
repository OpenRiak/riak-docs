---
title: "riak-search and innostore"
description: ""
project: community
lastmod: 2011-02-08T16:08:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02235"
author_name: "Gordon Tillman"
project_section: "mailinglistitem"
sent_date: 2011-02-08T16:08:52-08:00
---


Greetings All,

I just have a couple of quick comments regarding using riak-search with 
innostore. Thought it may save someone else a bit of trouble.

OK, starting with a standard dev install of riak-search (latest version). I 
installed innostore and configured as per the wiki. So I had the following 
lines in the app.config files of my 3 node development cluster:

{storage\_backend, riak\_kv\_innostore\_backend},
...
%% innostore config
{innostore, [
 {data\_home\_dir, "data/innodb"}, %% Where data files go
 {log\_group\_home\_dir, "data/innodb"}, %% Where log files go
 {buffer\_pool\_size, 268435456} %% 256MB in-memory buffer in bytes
]}

The cluster started up fine and I populated it with some initial data with no 
errors. Found that I was unable to list keys in a bucket. Did some poking 
around and found out that even though all of the proper riak\_search and 
merge\_index config was in place, the system had used innostore and not 
merge\_index\_backend for the indexes.

So I discovered that the right thing to do was to configure the cluster using:

{storage\_backend, riak\_kv\_multi\_backend},

And that brings me to my second note. The wiki docs describe the configuration 
info needed to work with riak\_kv\_multi\_backend. An example:

 {multi\_backend\_default, &lt;&lt;"bitcask"&gt;&gt;},
 {multi\_backend, [
 {&lt;&lt;"bitcask"&gt;&gt;, riak\_kv\_bitcask\_backend,
 [{data\_root, "data/bitcask"}]},
 {&lt;&lt;"innostore"&gt;&gt;, riak\_kv\_innostore\_backend,
 [
 {data\_home\_dir, "data/innodb"},
 {log\_group\_home\_dir, "data/innodb"},
 {buffer\_pool\_size, 268435456}
 ]}
 ]},

I found out that even though this info must be present, the system was not 
honoring my settings for &lt;&lt;"innostore"&gt;&gt;. I know this because it was creating 
a different directory for the indexes in a different location than what I had 
specified. I still had to include this section (outside of the multi\_backend 
block):

{innostore, [
 {data\_home\_dir, "data/innodb"}, %% Where data files go
 {log\_group\_home\_dir, "data/innodb"}, %% Where log files go
 {buffer\_pool\_size, 268435456} %% 256MB in-memory buffer in bytes
]}

With that declaration in place, all is working well. The riak-search indexes 
are correct and functioning. I can list bucket keys, and the information for 
the buckets whose "backend" property is set to "innostore" (via REST interface) 
is being correctly stored in the proper directory, etc.



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

