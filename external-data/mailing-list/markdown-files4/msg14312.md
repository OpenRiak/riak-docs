---
title: "Re: Recommended riak configuration options for better performance"
description: ""
project: community
lastmod: 2014-06-13T00:17:30-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14312"
mailinglist_parent_id: "msg14288"
author_name: "Naveen Tamanam"
project_section: "mailinglistitem"
sent_date: 2014-06-13T00:17:30-07:00
---


Hi Alex,

What precautions should I take when I do MR work with Erlang.


On Thu, Jun 5, 2014 at 7:14 PM, Alex Moore  wrote:

&gt; Hi Naveen,
&gt;
&gt; You are running out of MR workers, you’ll either have to:
&gt; a) Increase the worker limits on the current
&gt; nodes (particularly map\_js\_vm\_count and reduce\_js\_vm\_count)
&gt; b) Add more nodes (and thereby more workers)
&gt; c) Do less MR work.
&gt; d) Implement your MapReduce functions in Erlang to avoid the JS VM
&gt; altogether
&gt;
&gt; Bryan Fink has a nice writeup on how to estimate your MR worker needs
&gt; here:
&gt;
&gt; http://riak-users.197444.n3.nabble.com/Follow-up-Riak-Map-Reduce-error-preflist-exhausted-tp4024330p4024380.html
&gt;
&gt; Thanks,
&gt; Alex
&gt;
&gt; On Jun 4, 2014, at 7:58 AM, Naveen Tamanam 
&gt; wrote:
&gt;
&gt; Hi Guys,
&gt;
&gt;
&gt; I have 5 nodes riak cluster in use. Each machine is having 16GB ram. All
&gt; those 5 machines are
&gt; ​dedicated for riak only. No other application is there to eat resources. ​
&gt; ​I use to do a lot of work with
&gt; map reduce queries. Having a may map reduce queries with both map and
&gt; reduce phases.
&gt; I have many cases with the the following error and log messages, ​
&gt;
&gt; ​
&gt; "error":"[preflist\_exhausted]"
&gt; RiakError: 'could not get a response'
&gt; All VMs are busy
&gt;
&gt; I know above errors can be avoided with fine tuned riak configuration
&gt; options. I am looking for recommended values
&gt; Here are few riak configuration options currently I have on each node,
&gt;
&gt; { kernel, [
&gt; {inet\_dist\_listen\_min, 6000},
&gt; {inet\_dist\_listen\_max, 7999}
&gt; ]},
&gt;
&gt; {map\_js\_vm\_count, 48 },
&gt; {reduce\_js\_vm\_count, 26 },
&gt; {hook\_js\_vm\_count, 12 },
&gt; {js\_max\_vm\_mem, 32},
&gt; {js\_thread\_stack, 16}
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; ​
&gt;
&gt; --
&gt; Thanks & Regards,
&gt; Naveen Tamanam
&gt; ​​
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;


-- 
Thanks & Regards,
Naveen Tamanam
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

