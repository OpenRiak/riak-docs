---
title: "Re: riakc doesn't save metadata properly?"
description: ""
project: community
lastmod: 2012-10-25T05:32:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09057"
mailinglist_parent_id: "msg09012"
author_name: "David Parfitt"
project_section: "mailinglistitem"
sent_date: 2012-10-25T05:32:47-07:00
---


Hello Christian -

 I believe this is an inconsistency in the HTTP vs PB custom
metadata APIs. We'll be revisiting this code at some point to clean
things up. In the meantime, would you mind filing an issue at [1] so
we don't lose track of this?

Cheers -
Dave

[1] https://github.com/basho/riak-erlang-client


On Tue, Oct 23, 2012 at 12:48 AM, Christian Dahlqvist
 wrote:
&gt; On 22/10/2012 22:25, David Parfitt wrote:
&gt;
&gt; Hello Metin -
&gt;
&gt; I'm trying to get that into the docs right now. Will italics do? :-)
&gt; https://github.com/basho/riak-erlang-client/pull/74
&gt;
&gt; Cheers -
&gt; Dave
&gt;
&gt; On Mon, Oct 22, 2012 at 5:22 PM, Metin Akat  wrote:
&gt;
&gt; Oh, I see, thanks for this clarification, much appreciated.
&gt; I think this should be written somewhere in bold, as 3 days later, I still
&gt; wasn't able to find anything on google.
&gt;
&gt;
&gt; On Tue, Oct 23, 2012 at 12:08 AM, David Parfitt  wrote:
&gt;
&gt; Hello Metin -
&gt;
&gt; Sorry for the delay. At the moment, all metadata needs to be stored
&gt; under the &lt;&lt;"X-Riak-Meta"&gt;&gt; dict key. The following example
&gt; illustrates how this works:
&gt;
&gt; %% To store metadata:
&gt; Object = riakc\_obj:new(&lt;&lt;"groceries"&gt;&gt;, &lt;&lt;"mine"&gt;&gt;, &lt;&lt;"eggs & bacon"&gt;&gt;).
&gt; MetaData = dict:from\_list([{&lt;&lt;"X-Riak-Meta"&gt;&gt;, [{"Foo", "Bar"}]}]),
&gt; Object2 = riakc\_obj:update\_metadata(Object, MetaData).
&gt; riakc\_pb\_socket:put(Pid, Object2).
&gt;
&gt; %% To retrieve metadata:
&gt; {ok, O} = riakc\_pb\_socket:get(Pid, &lt;&lt;"groceries"&gt;&gt;, &lt;&lt;"mine"&gt;&gt;).
&gt; {ok, MD} = dict:find(&lt;&lt;"X-Riak-Meta"&gt;&gt;, riakc\_obj:get\_metadata(O)).
&gt;
&gt; We're kicking around ways to improve this in the future.
&gt;
&gt; Cheers -
&gt; Dave
&gt;
&gt; On Fri, Oct 19, 2012 at 8:31 AM, Metin Akat  wrote:
&gt;
&gt; I am trying to do something like:
&gt;
&gt; Meta1 = dict:store(&lt;&lt;"ver"&gt;&gt;, Ver, Meta0),
&gt; Obj1 = riakc\_obj:update\_metadata(Obj, Meta1),
&gt;
&gt; and then save the object. But on a subsequent read, the metadata k/v
&gt; pair is
&gt; not there.
&gt;
&gt; Is there anything special that needs to be done for this to work, or is
&gt; this
&gt; illegal way to use Riak?
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; Hi,
&gt;
&gt; As far as I can see there seems to be an inconsistency between the Erlang
&gt; and HTTP APIs with respect to how metadata is handled.
&gt;
&gt; When I query the record created in the example through the Erlang API
&gt; (attached to console) I, as expected, get the following:
&gt;
&gt; {ok, RO} = C:get(&lt;&lt;"groceries"&gt;&gt;, &lt;&lt;"mine"&gt;&gt;).
&gt; {ok, MD} = dict:find(&lt;&lt;"X-Riak-Meta"&gt;&gt;, riak\_object:get\_metadata(RO)).
&gt; {ok,[{"Foo","Bar"}]}
&gt;
&gt; The metadata parameter is stored in the dictionary exactly as created, which
&gt; is expected.
&gt;
&gt; When I query this record through the HTTP interface the same metadata is
&gt; returned as a header:
&gt;
&gt; curl -v -X HEAD http://localhost:8098/riak/groceries/mine
&gt; &gt; HEAD /riak/groceries/mine HTTP/1.1
&gt; &gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4
&gt; OpenSSL/0.9.8r zlib/1.2.5
&gt; &gt; Host: localhost:8098
&gt; &gt; Accept: \*/\*
&gt; &gt;
&gt; &lt; HTTP/1.1 200 OK
&gt; &lt; X-Riak-Vclock: a85hYGBgzGDKBVIcypz/fga0yrzJYEpkzGNlEG36dZIvCwA=
&gt; &lt; Vary: Accept-Encoding
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.9.2 (someone had painted it blue)
&gt; &lt; Link: ; rel="up"
&gt; &lt; Foo: Bar
&gt; &lt; ETag: "5hdCr8ayy5j9orqA6nDJfs"
&gt; &lt; Content-Type: application/octet-stream
&gt; &lt; Content-Length: 12
&gt; &lt;
&gt;
&gt; When I tried to create another record with the same metadata as the first
&gt; one through the HTTP interface, I had to prefix the metadata with
&gt; "X-Riak-Meta-" in order for it to be saved on the record. When I did this
&gt; the interface did however not seem to strip the "X-Riak-Meta-" prefix from
&gt; the parameter, and when I query the record through the Erlang API, the
&gt; parameter is stored in the metadata dict as "X-Riak-Meta-Foo" instead of
&gt; just "Foo".
&gt;
&gt; I was expecting the parameter to be stored as "Foo" internally in Riak and
&gt; represented as "X-Riak-Meta-Foo" when getting or setting through the HTTP
&gt; API, but that does not seem to be the case.
&gt;
&gt; Is this an inconsistency or is there something I am doing wrong or have
&gt; missed here?
&gt;
&gt; Best regards,
&gt;
&gt; Christian
&gt;
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

