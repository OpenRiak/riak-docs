---
title: "Re: No results provided by Riak search, another !"
description: ""
project: community
lastmod: 2011-07-05T10:17:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03933"
mailinglist_parent_id: "msg03931"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-07-05T10:17:18-07:00
---


Hi Germain,

Did you change the fields to "dynamic\_field" in the schema?

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Tue, Jul 5, 2011 at 9:51 AM, Germain Maurice &lt;
germain.maur...@linkfluence.net&gt; wrote:

&gt; \*\*
&gt; Thanks Dan,
&gt;
&gt; I changed the fields in the schema as this :
&gt; - nsid -&gt; \*\_nsid
&gt; - favedate -&gt; \*\_favedate
&gt; - date\_faved -&gt; \*\_date\_faved
&gt;
&gt; In order to take it in account i did :
&gt;
&gt; search-cmd set-schema photostest My.schema
&gt; search-cmd clear-schema-cache
&gt; and reindexing data (reading/writing the documents in their own place)
&gt;
&gt; No change :(
&gt; I tried to use the fields : fans\_data\_nsid, fans\_data\_favedate
&gt; but no better result.
&gt;
&gt; I'm using Riak Search 0.14.2
&gt;
&gt; Just for checking :
&gt; curl http://localhost:8098/riak/photostest
&gt; {"props":{"precommit":[{"fun":"precommit","mod":"riak\_search\_kv\_hook"}]...}
&gt;
&gt; Le 05/07/11 18:27, Dan Reverri a écrit :
&gt;
&gt; Hi Germain,
&gt;
&gt; It looks like your document has nested fields which means the schema you
&gt; have defined won't match the fields produced by the pre-commit hook. The
&gt; pre-commit hook flattens JSON documents using an underscore ("\_") between
&gt; nested fields (e.g. fans\_data\_nsid); your schema should be using the
&gt; flattened field name.
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Tue, Jul 5, 2011 at 7:05 AM, Germain Maurice &lt;
&gt; germain.maur...@linkfluence.net&gt; wrote:
&gt;
&gt;&gt; Hello everybody,
&gt;&gt;
&gt;&gt; I have a problem with Riak Search. I tried to find the solution by my own,
&gt;&gt; i tried all the solutions i found and no results.
&gt;&gt;
&gt;&gt; Firstly, i tried to use it with the default schema, it works but it
&gt;&gt; indexes too much data.
&gt;&gt; So, i set my own schema as this :
&gt;&gt; {
&gt;&gt; schema,
&gt;&gt; [
&gt;&gt; {version, "1.1"},
&gt;&gt; {n\_val, 1},
&gt;&gt; {default\_field, "nsid"},
&gt;&gt; {analyzer\_factory, {erlang, text\_analyzers,
&gt;&gt; standard\_analyzer\_factory}}
&gt;&gt; ],
&gt;&gt; [
&gt;&gt; {field, [
&gt;&gt; {name, "favedate"},
&gt;&gt; {type, string},
&gt;&gt; {analyzer\_factory, {erlang, text\_analyzers,
&gt;&gt; standard\_analyzer\_factory}}
&gt;&gt; ]},
&gt;&gt;
&gt;&gt; {field, [
&gt;&gt; {name, "date\_faved"},
&gt;&gt; {type, string},
&gt;&gt; {analyzer\_factory, {erlang, text\_analyzers,
&gt;&gt; standard\_analyzer\_factory}}
&gt;&gt; ]},
&gt;&gt;
&gt;&gt; %% Everything else is skipped
&gt;&gt; {dynamic\_field, [
&gt;&gt; {name, "\*"},
&gt;&gt; {skip, true}
&gt;&gt; ]}
&gt;&gt; ]
&gt;&gt; }.
&gt;&gt;
&gt;&gt; Hook on precommit of my buckets are ok.
&gt;&gt; I set the schema for each of my buckets as this : "search-cmd set-schema
&gt;&gt; photostest My.schema"
&gt;&gt; Did a "search-cmd clear-schema-cache" command.
&gt;&gt;
&gt;&gt; I re-indexed all of my documents of the bucket however, these documents
&gt;&gt; are not indexed.
&gt;&gt; An example :
&gt;&gt;
&gt;&gt; { "fans":{
&gt;&gt; "data":[{"nsid":"83786678@N00",
&gt;&gt; "favedate":"1309539453"}
&gt;&gt; ,{"nsid":"33233619@N02",
&gt;&gt; "favedate":"1309539169"}]
&gt;&gt; , ...
&gt;&gt; Here is the answer of the index :
&gt;&gt;
&gt;&gt; {"responseHeader":{"status":0,"QTime":2,"params":{"q":"fans\_data\_nsid:83786678@N00
&gt;&gt; ","q.op":"or","filter":"","wt":"
&gt;&gt; json"}},"response":{"numFound":0,"start":0,"maxScore":"0.0","docs":[]}}
&gt;&gt;
&gt;&gt;
&gt;&gt; thank you !
&gt;&gt;
&gt;&gt; --
&gt;&gt; Germain Maurice
&gt;&gt; Administrateur Système/Réseau
&gt;&gt; Tel : +33.(0)1.42.43.54.33
&gt;&gt;
&gt;&gt; http://www.linkfluence.net
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Germain Maurice
&gt; Administrateur Système/Réseau
&gt; Tel : +33.(0)1.42.43.54.33
&gt; http://www.linkfluence.net
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

