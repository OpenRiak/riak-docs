---
title: "Re: Possible handoff stalls"
description: ""
project: community
lastmod: 2012-03-19T11:36:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07003"
mailinglist_parent_id: "msg07002"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2012-03-19T11:36:19-07:00
---


Hi Armon,

We've recently patched an issue that affects handoffs here
https://github.com/basho/riak\_core/pull/153

If the issue repeats for you, as well as the logs it would be very useful
if you could follow the instructions from the pull request above ro the
'riak\_core\_handoff\_manager:status().' command against all nodes.

The pull request works around an issue where it looks like the kernel has
closed a socket (no evidence of it any longer with netstat/ss) but the
erlang process is still stuck in an receive call from it (gen\_tcp:recv/2 to
be more precise).

Please let us know if you hit it again.

Best, Jon.

On Mon, Mar 19, 2012 at 12:10 PM, Armon Dadgar wrote:

&gt; I wanted to ping the mailing list and see if anybody else has encountered
&gt; stalls in the partition handoffs on Riak 1.1. We added a new node to our
&gt; cluster
&gt; last Friday, but noticed that the partition handoffs appear to have
&gt; stopped
&gt; after about 7-8 hours.
&gt;
&gt; Most of the handoffs completed, and the only handoffs that remained were
&gt; from node 3 to node 2.
&gt; The ring claimant (node 1), indicated that node 3 was unreachable (via
&gt; ring\_status).
&gt; However, Riak control did not indicate that node 3 was unreachable, and in
&gt; fact it was
&gt; actually live and continuing to serve request.
&gt;
&gt; To resolve this, I tried to just restart node 3. I ran "riak stop"
&gt; multiple times, but this did
&gt; not actually seem to do anything (The node was continuing to run and serve
&gt; requests).
&gt; Next, I attached to the node and ran "init:stop()." This started to shut
&gt; down various
&gt; sub-systems, but the node was still running. Sending a SIGTERM signal to
&gt; the beam vm
&gt; finally killed it. Restarting the node with "riak start" worked as
&gt; expected,
&gt; and the node promptly resumed the handoffs, and finished in a few hours.
&gt;
&gt; I'm not sure exactly what the issue was, but something seemed to cause a
&gt; stalling of the handoffs.
&gt;
&gt; I've attached the contents of our console.log, erlang.log, error.log and
&gt; crash.log
&gt; from the relevant times if that is useful.
&gt;
&gt; Best Regards,
&gt;
&gt; Armon Dadgar
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

