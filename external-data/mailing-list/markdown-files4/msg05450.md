---
title: "Re: Riak 1.0.2 RC1"
description: ""
project: community
lastmod: 2011-11-07T07:23:58-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05450"
mailinglist_parent_id: "msg05449"
author_name: "Jim Adler"
project_section: "mailinglistitem"
sent_date: 2011-11-07T07:23:58-08:00
---


Thanks for the detailed response Joe. We're at 256 partition ring size
which seems, a little high, but within your guidance.

Jim

On 11/6/11 8:10 PM, "Joseph Blomstedt"  wrote:

&gt;&gt; RE: large ring size warning in the release notes, is the performance
&gt;&gt; degradation linear below 256? That is, until the major release that
&gt;&gt;fixes
&gt;&gt; this, is it best to keep ring sizes at 64 for best performance?
&gt;
&gt;The large ring size warning in the release notes is predominately
&gt;related to an issue with Riak's ring gossip functionality.
&gt;Adding/removing nodes, changing bucket properties, and setting cluster
&gt;metadata all result in a brief period (usually a few seconds) where
&gt;gossip traffic increases significantly. The size of the ring
&gt;determines both the number of gossip messages that occur during this
&gt;window, as well as the size of each message. With large rings, it is
&gt;possible that messages are generated faster than they can be handled,
&gt;resulting in large message queues that impact cluster performance and
&gt;tie up system memory until the message queues are fully drained. In
&gt;general, there is no problem as long as your hardware is fast enough
&gt;to process the brief spike in gossip traffic in close to real time.
&gt;Concerning this specific issue, choosing a ring size smaller than the
&gt;maximum you can handle does not provide any additional performance
&gt;gains.
&gt;
&gt;However, unrelated to this issue, there are general performance
&gt;considerations related to ring size versus the number of nodes in your
&gt;cluster. Given a fixed number of nodes, a larger ring results in more
&gt;vnodes per node. This allows more process concurrency which may
&gt;improvement performance. However, each vnode runs it's own backend
&gt;instance that has it's own set of on-disk files, and competing
&gt;reads/writes to different files may result in additional I/O
&gt;contention than having fewer vnodes per node. The overall performance
&gt;is going to depend largely on your OS, your file system, and your
&gt;traffic pattern. So, it's hard to give specific hard and fast rules.
&gt;The other issue is 2I performance. Secondary indexes send request to a
&gt;covering set of vnodes, which works out to ring\_size / N requests;
&gt;therefore increasing the ring\_size without increasing N leads to more
&gt;2I requests. Again, the right answer depends largely on your use case.
&gt;
&gt;Overall, I believe we normally recommend between 10 and 50 vnodes per
&gt;node, with the ring size rounded up to the next power of two.
&gt;Personally, I think 16 vnodes per node is a good number, which matches
&gt;the common 64 partition, 4 node Riak cluster. Thus, choosing a ring
&gt;size based on that ratio and your expected number of future nodes is a
&gt;reasonable choice. Just be sure to stay under 1024 until the issue
&gt;with gossip overloading the cluster is resolved.
&gt;
&gt;-Joe
&gt;
&gt;On Sat, Nov 5, 2011 at 9:49 AM, Jim Adler  wrote:
&gt;&gt; RE: large ring size warning in the release notes, is the performance
&gt;&gt; degradation linear below 256? That is, until the major release that
&gt;&gt;fixes
&gt;&gt; this, is it best to keep ring sizes at 64 for best performance?
&gt;&gt; Jim
&gt;&gt;
&gt;&gt; Sent from my phone. Please forgive the typos.
&gt;&gt; On Nov 4, 2011, at 7:20 PM, Jared Morrow  wrote:
&gt;&gt;
&gt;&gt; As we've mentioned earlier, the 1.0.2 release of Riak is coming soon.
&gt;&gt;Like
&gt;&gt; we did with Riak 1.0.0, we are provided a release candidate for test
&gt;&gt;before
&gt;&gt; we release 1.0.2 final.
&gt;&gt; You can find the packages here:
&gt;&gt; http://downloads.basho.com/riak/riak-1.0.2rc1/
&gt;&gt; The release notes have been updated and can be found here:
&gt;&gt; https://github.com/basho/riak/blob/1.0/RELEASE-NOTES.org
&gt;&gt; Thank you, as always, for continuing to provide bug reports and
&gt;&gt;feedback.
&gt;&gt; -Jared
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt;
&gt;-- 
&gt;Joseph Blomstedt 
&gt;Software Engineer
&gt;Basho Technologies, Inc.
&gt;http://www.basho.com/



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

