---
title: "Re: 2i Reindex Strategy"
description: ""
project: community
lastmod: 2012-02-28T07:56:46-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06778"
mailinglist_parent_id: "msg06777"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2012-02-28T07:56:46-08:00
---


If you want to avoid overwhelming the cluster, there's an easy trick you can 
try.

In the RDBMS world, we frequently batch requests and issue 5,000 or 10,000 
updates at once. We then put a delay in the code of a second or so after the 
commit so that the transaction log has a second to catch up. This is really so 
that the checkpoint flushing dirty pages from memory doesn't run into I/O 
contention with the log writer.

Updating by time instead of key will have a double I/O hit for the lookup, but 
you can easily control the order of updates. I say go for it.

---
Jeremiah Peschka, Managing Director, Brent Ozar PLF, LLC
Microsoft SQL Server MVP

On Feb 28, 2012, at 7:34 AM, Jeremy Raymond  wrote:

&gt; Hi,
&gt; 
&gt; I need to reindex a bucket with a ~4 million items. If I do a
&gt; streaming list keys using the Erlang client and then read/write the
&gt; items as they keys come in it puts too much load on the cluster and
&gt; other mapred queries that get run timeout. I already have a date based
&gt; index on the items and was thinking getting items based on hourly
&gt; chunks and update them in batches that way as the times should be
&gt; relatively evenly distributed in time. I can then better control the
&gt; flow and load of the reindexing operations.
&gt; 
&gt; Anyone have any better ideas or use any other strategies when having to 
&gt; reindex?
&gt; 
&gt; --
&gt; Jeremy
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

