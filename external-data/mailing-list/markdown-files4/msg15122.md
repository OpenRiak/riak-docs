---
title: "Re: Riak errors after node left the cluster"
description: ""
project: community
lastmod: 2014-11-06T17:07:25-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15122"
mailinglist_parent_id: "msg15121"
author_name: "Sargun Dhillon"
project_section: "mailinglistitem"
sent_date: 2014-11-06T17:07:25-08:00
---


So, from my understanding, one of your servers was being replaced, so
you did a leave from the cluster, and it failed to commit, and then
another node failed, resulting in 3/4ish or 3/5ish of the ring being
up?
Did you down the failed node, or remove it from the cluster? What's
the current status of your ring?

Can you run:
riak-admin status (on each node)
riak-admin diag
riak-admin member-status
riak-admin ring-status
riak-admin vnode-status
riak-admin transfers
riak-admin transfer-limit

Can you put this all in a github gist: gist.github.com?
Also, are you running AAE?

You might want to temporarily turn off AAE, and transfers as you debug
the cluster, just to figure out what's going on with the cluster at
the moment.

On Thu, Nov 6, 2014 at 1:05 PM, Oleksiy Krivoshey  wrote:
&gt; Just got a new problem with Riak. Recently a hard drive has failed on one of
&gt; Riak nodes so I had to shut it down. I'm running 4 nodes now and each 10
&gt; minutes all of them start to fail with 'Error: {error,mailbox\_overload}'
&gt; until restarted. Can anyone from Basho please suggest a solution/ fix for
&gt; this? My whole cluster is unusable with just 1 node failed.
&gt;
&gt; On 5 November 2014 00:11, Oleksiy Krivoshey  wrote:
&gt;&gt;
&gt;&gt; There were also errors during initial handoff, here is a full console.log
&gt;&gt; for that day: https://www.dropbox.com/s/o7zop181pvpxoa5/console.log?dl=0
&gt;&gt;
&gt;&gt; I actually replaced two nodes that day. First one went smoothly as it
&gt;&gt; should. The second one resulted in the situation above. I replaced the first
&gt;&gt; one and then the second after few hours.
&gt;&gt;
&gt;&gt; On 4 November 2014 20:44, Oleksiy Krivoshey  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I'm running a 5 node cluster (Riak 2.0.0) and I had to replace hardware
&gt;&gt;&gt; on one of the servers. So I did a 'cluster leave', waited till the node
&gt;&gt;&gt; exited, checked the ring status and members status, all was ok, with no
&gt;&gt;&gt; pending changes. Then later after about 5 minutes every client connection to
&gt;&gt;&gt; any of the 4 remaining nodes started to fail with
&gt;&gt;&gt;
&gt;&gt;&gt; [Error: {error,mailbox\_overload}
&gt;&gt;&gt;
&gt;&gt;&gt; I have restarted one node after another and the error has gone. However I
&gt;&gt;&gt; was still experiencing connectivity issues (timeouts) and riak error log is
&gt;&gt;&gt; full of various errors even after I joined the 5th node back.
&gt;&gt;&gt;
&gt;&gt;&gt; Error are like:
&gt;&gt;&gt;
&gt;&gt;&gt; Failed to merge
&gt;&gt;&gt; {["/var/lib/riak/bitcask\_expire\_1d/685078892498860742907977265335757665463718379520/1.bitcask.data"]
&gt;&gt;&gt;
&gt;&gt;&gt; gen\_fsm &lt;0.818.0&gt; in state active terminated with reason: bad record
&gt;&gt;&gt; state in riak\_kv\_vnode:set\_vnode\_forwarding/2 line 991
&gt;&gt;&gt;
&gt;&gt;&gt; @riak\_pipe\_vnode:new\_worker:826 Pipe worker startup failed:
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; msg,7,[{file,"gen\_fsm.erl"},{line,505}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,239}]}]
&gt;&gt;&gt; 2014-11-04 16:07:57.124 [error]
&gt;&gt;&gt; &lt;0.11128.0&gt;@riak\_core\_handoff\_sender:start\_fold:279 hinted\_handoff transfer
&gt;&gt;&gt; of riak\_kv\_vnode from 'riak@10.0.1.1'
&gt;&gt;&gt; 353957427791078050502454920423474793822921162752 to 'riak@
&gt;&gt;&gt; 10.0.1.5' 353957427791078050502454920423474793822921162752 failed because
&gt;&gt;&gt; of error:undef
&gt;&gt;&gt; [{riak\_core\_format,human\_size\_fmt,["~.2f",588],[]},{riak\_core\_handoff\_sender,start\_fold,5,[{file,"src/riak\_core\_han
&gt;&gt;&gt; doff\_sender.erl"},{line,246}]}]
&gt;&gt;&gt;
&gt;&gt;&gt; The full error log file is available here:
&gt;&gt;&gt; https://www.dropbox.com/s/3b8x3nqyego7lw3/error.log?dl=0
&gt;&gt;&gt;
&gt;&gt;&gt; There was no significant load on Riak so I would like to understand what
&gt;&gt;&gt; caused so many errors?
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Oleksiy
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Oleksiy Krivoshey
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Oleksiy Krivoshey
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

