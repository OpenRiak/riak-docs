---
title: "Re: a weird error while post request to server for store object"
description: ""
project: community
lastmod: 2016-09-07T06:34:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17630"
mailinglist_parent_id: "msg17626"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2016-09-07T06:34:38-07:00
---


Hello Alan -

Which PHP client library are you using?

--
Luke Bakken
Engineer
lbak...@basho.com

On Tue, Sep 6, 2016 at 10:29 PM, HQS^âˆž^  wrote:
&gt; dear everyone:
&gt; I follow the tutorial at
&gt; http://docs.basho.com/riak/kv/2.1.4/developing/usage/document-store/ ,
&gt; Step by Step Practice , when I've Post a request for store object , but the
&gt; riak server respond 400 (Bad Request) , I review my code again and again ,
&gt; but no problem found . see below:
&gt;
&gt; php

&gt;
&gt; class BlogPost {
&gt; var $\_title = '';
&gt; var $\_author = '';
&gt; var $\_content = '';
&gt; var $\_keywords = [];
&gt; var $\_datePosted = '';
&gt; var $\_published = false;
&gt; var $\_bucketType = "cms";
&gt; var $\_bucket = null;
&gt; var $\_riak = null;
&gt; var $\_location = null;
&gt; public function \_\_construct(Riak $riak, $bucket, $title, $author,
&gt; $content, array $keywords, $date, $published)
&gt; {
&gt; $this-&gt;\_riak = $riak;
&gt; $this-&gt;\_bucket = new Bucket($bucket, "cms");
&gt; $this-&gt;\_location = new Riak\Location('blog1',$this-&gt;\_bucket,"cms");
&gt; $this-&gt;\_title = $title;
&gt; $this-&gt;\_author = $author;
&gt; $this-&gt;\_content = $content;
&gt; $this-&gt;\_keywords = $keywords;
&gt; $this-&gt;\_datePosted = $date;
&gt; $this-&gt;\_published = $published;
&gt; }
&gt;
&gt; public function store()
&gt; {
&gt; $setBuilder = (new UpdateSet($this-&gt;\_riak));
&gt;
&gt; foreach($this-&gt;\_keywords as $keyword) {
&gt; $setBuilder-&gt;add($keyword);
&gt; }
&gt; /\*
&gt; (new UpdateMap($this-&gt;\_riak))
&gt; -&gt;updateRegister('title', $this-&gt;\_title)
&gt; -&gt;updateRegister('author', $this-&gt;\_author)
&gt; -&gt;updateRegister('content', $this-&gt;\_content)
&gt; -&gt;updateRegister('date', $this-&gt;\_datePosted)
&gt; -&gt;updateFlag('published', $this-&gt;\_published)
&gt; -&gt;updateSet('keywords', $setBuilder)
&gt; -&gt;withBucket($this-&gt;\_bucket)
&gt; -&gt;build()
&gt; -&gt;execute();
&gt;
&gt; \*/
&gt; $response = (new UpdateMap($this-&gt;\_riak))
&gt; -&gt;updateRegister('title', $this-&gt;\_title)
&gt; -&gt;updateRegister('author', $this-&gt;\_author)
&gt; -&gt;updateRegister('content', $this-&gt;\_content)
&gt; -&gt;updateRegister('date', $this-&gt;\_datePosted)
&gt; -&gt;updateFlag('published', $this-&gt;\_published)
&gt; -&gt;updateSet('keywords', $setBuilder)
&gt; -&gt;atLocation($this-&gt;\_location)
&gt; -&gt;build()
&gt; -&gt;execute();
&gt;
&gt; echo '';
&gt; var\_dump($response);
&gt; echo '';
&gt; }
&gt; }
&gt;
&gt; $node = (new Node\Builder)
&gt; -&gt;atHost('192.168.111.2')
&gt; -&gt;onPort(8098)
&gt; -&gt;build();
&gt;
&gt; $riak = new Riak([$node]);
&gt;
&gt;
&gt; $keywords = ['adorbs', 'cheshire'];
&gt; $date = new \DateTime('now');
&gt;
&gt;
&gt; $post1 = new BlogPost(
&gt; $riak,
&gt; 'cat\_pics', // bucket
&gt; 'This one is so lulz!', // title
&gt; 'Cat Stevens', // author
&gt; 'Please check out these cat pics!', // content
&gt; $keywords, // keywords
&gt; $date, // date posted
&gt; true // published
&gt; );
&gt; $post1-&gt;store();
&gt;
&gt; the wireshark captured packet :
&gt;
&gt; 192.168.171.124(client ip) =&gt; 192.168.111.2(riak server ip) HTTP
&gt; 511 POST /types/cms/buckets/cat\_pics/datatypes/alldoc? HTTP/1.1
&gt; (application/json)
&gt; 192.168.111.2 192.168.171.124 HTTP 251 HTTP/1.1 400 Bad Request
&gt;
&gt; GET http://192.168.111.2:8098//types/cms/buckets/cat\_pics/props
&gt; {"props":{"name":"cat\_pics","young\_vclock":20,"w":"quorum","small\_vclock":50,"search\_index":"blog\_posts","rw":"quorum","r":"quorum","pw":0,"precommit":[],"pr":0,"postcommit":[],"old\_vclock":86400,"notfound\_ok":true,"n\_val":3,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"last\_write\_wins":false,"dw":"quorum","dvv\_enabled":true,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"big\_vclock":50,"basic\_quorum":false,"allow\_mult":true,"datatype":"map","active":true,"claimant":"node1@192.168.111.1"}}
&gt;
&gt; please help me catch the bugs thanks in advance!
&gt;
&gt; regards
&gt;
&gt; Alan

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

