---
title: "Re: Query data with Riak TS"
description: ""
project: community
lastmod: 2016-11-14T07:20:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17743"
mailinglist_parent_id: "msg17742"
author_name: "Andrei Zavada"
project_section: "mailinglistitem"
sent_date: 2016-11-14T07:20:06-08:00
---


Hello Jan,

R​eplying to your questions inline:​​
​

&gt; Hi,

we are testing Riak TS for our Application right now. I have a couple of
&gt; question how to query the data. We are measuring electric power which comes
&gt; in in odd time intervals.
&gt;


&gt; 1. Is it possible to query the value which has been received bevor at a
&gt; given time? In other words: Get the current / last value of a series.
&gt;

In Riak TS 1.4 (the latest release), you still have to specify the exact
range ​in the WHERE clause. Because of that, if you are only interested in
a single record that was added last before a certain time, you have to do
some guesswork to arrive at the suitable boundaries. Depending on the rate
of data ingress, the selection returned may contain one, a few, too many,
or no results at all. One workaround is to issue a sequence of SELECTs,
starting from a small range, with the lower boundary of the range
progressively moved back until you have the last record included (and
hopefully not many previous records which you are going to discard anyway).

In 1.5, we will support ORDER BY and LIMIT clauses which will allow a much
simpler solution, e.g.:

 SELECT value FROM table
 WHERE time &gt; 0 AND time &lt; $now
 ORDER BY value DESC LIMIT 1


&gt; 2. Is it possible to query the average in respect to time?
&gt; For instance you have such a measurement reading:
&gt; time | value
&gt; -----------------
&gt; 09:31 | 4
&gt; 10:02 | 6
&gt; 10:05 | 3
&gt; And you want to query the average from 10:00 to 10:10. I would expect a
&gt; value of 4.1
&gt; 4 \* 20% + 6 \* 30% + 3 \* 50% = 4.1
&gt;

​It is definitely possible:​

 ﻿⁠⁠⁠⁠SELECT AVG(val
​ue​
) FROM
​table
​
 WHERE time &gt;
​=​
​'​2016-11-22
10
​:00'​
AND time &lt;
​'2016-11-22 ​
​10:10'​

​Note that you can specify timestamp values in ISO8601 format:
http://docs.basho.com/riak/ts/1.4.0/using/timerepresentations

​

&gt; 3. Is it possible to query 15 minutes average values for the last day? I
&gt; would expect 96 values with the average as described in question 2.
&gt;

No, you will have to issue 96 separate queries, each similar to the one in
(2) but with a different 15-min range.​



&gt; Thanks a lot.
&gt; Jan Paulus
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

