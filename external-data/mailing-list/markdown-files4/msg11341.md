---
title: "Re: Write to riak cluster with one slow node can be very slow."
description: ""
project: community
lastmod: 2013-06-26T06:41:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11341"
mailinglist_parent_id: "msg11340"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2013-06-26T06:41:55-07:00
---


Sadly, this is not unexpected on EC2, especially if your storage is on EBS.
In a BoF session at the Surge Conference last year, Brendan Gregg measured
about 1.5sec of I/O silence to EBS on an OmniOS instance running Riak that
was under load (using DTrace of course). Granted, this is just one case,
but I think the symptoms you see are indicative of a similar problem.
Others have told me they have seen large iowait/delay even on ephemeral
storage.

Now, to Riak's part. That "local put coordination" stuff (sometimes called
vnode\_vclocks), while increasing latency in some cases, also improves
convergence and reduces the appearance of spurious siblings. It also
removes the need for clients to specify an identifier, instead using the
vnode's identifier in the vector clock. Which vnode does the coordination
is somewhat randomized, so 1 out of N times you send a put request, you
could get that slow node.

I hope that helps understand the why's... not sure I know how I would fix
your problem in general, other than the typical "get bigger instances"
solution.


On Wed, Jun 26, 2013 at 7:47 AM, Andreas Hasselberg &lt;
andreas.hasselb...@gmail.com&gt; wrote:

&gt; Hi,
&gt;
&gt; We are having problems with the io on one of our amazon instances being
&gt; very slow for short periods of time. When this happens we get some put
&gt; timeouts even though all the other amazon instances seems to be fine. I
&gt; have done some investigations here:
&gt; https://gist.github.com/anha0825/5866757. Could anyone confirm this or
&gt; point me in a better direction?
&gt;
&gt; Thanks!
&gt; Andreas
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

