---
title: "Re: Riak Search VS other query systems"
description: ""
project: community
lastmod: 2014-08-21T09:56:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14774"
mailinglist_parent_id: "msg14769"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2014-08-21T09:56:22-07:00
---


Re. Riak pipes. What's the latest regarding accessing the pipe framework? 
Haven't heard toooo much about it lately, admittedly haven't been listening 
toooo hard either. The thought would be to do "storm"ish stream processing in 
situ. 


@siculars
http://siculars.posthaven.com

Sent from my iRotaryPhone

&gt; On Aug 20, 2014, at 22:28, Sargun Dhillon  wrote:
&gt; 
&gt; I second John's opinions. Generally, I would have have one key which
&gt; is the secondary index, being an observe-remove OR-Set (or a relevant
&gt; type for your application, be a register, g-set, or a plain old
&gt; OR-set) pointing to back to the keys. Unfortunately, this mechanism
&gt; can become quite unwieldy in when you have a term with a high
&gt; cardinality.
&gt; 
&gt; Now, moving onto the Twitter use case, you care a lot about the speed.
&gt; With this strategy, if you're doing this from a client where you (1)
&gt; read the 2i OR-set, and then (2) read the keys, that can be expensive
&gt; as you have to read the entire 2i value back to the Riak client before
&gt; reading any of the keys. An example, the hashtag #beiber, would have
&gt; high cardinality would result in a super large value, and reading that
&gt; back over the network would be less than awesome. Also, having to pass
&gt; this value around disterl would be poor. Fortunately, the folks at
&gt; Basho have invented riak\_pipe. Riak\_pipe is a method to allow running
&gt; the read locally on the node the 2i lives on, and then streaming reads
&gt; for all of those keys to the nodes that they live on, and then all
&gt; back to the reader. It's actually the framework that Riak MR uses
&gt; under the hood.
&gt; Talk: https://vimeo.com/53910999 (there might be newer ones as well)
&gt; Docs: https://github.com/basho/riak\_pipe
&gt; 
&gt; Also, to deal with high-cardinality values, there are a variety of
&gt; work arounds, such as sharding the secondary index to some known set
&gt; of keys, and doing a read across these list of keys. Also, you can
&gt; postfix a nonce to the 2i-key, and ensure that they all end up on one
&gt; node (custom hashing function), or a subset of nodes, and utilize
&gt; leveldb's key iteration over a range to handle this.
&gt; 
&gt; The general patterns I like for 2i atop Riak is to specialize Peter
&gt; Bailis, from UC Berkeley's work for RAMPs. If you build the framework
&gt; for this, it'll be all sorts of useful in the future. One warning is
&gt; that there is no easy way to garbage collect in Riak today.
&gt; Paper: http://www.bailis.org/papers/ramp-sigmod2014.pdf
&gt; Talk: https://www.youtube.com/watch?v=\_rAdJkAbGls
&gt; 
&gt; None of these methods gracefully handle range queries. You can do
&gt; clever things with your 2i to handle this, but it the Twitter use case
&gt; wouldn't need ranges.
&gt; 
&gt;&gt; On Wed, Aug 20, 2014 at 12:28 PM, John Daily  wrote:
&gt;&gt; I don't have benchmarks to discuss query performance for different tools at
&gt;&gt; different sizes, but I'd like to point out that the ultimate search tool for
&gt;&gt; Riak is to not search at all.
&gt;&gt; 
&gt;&gt; Riak Search, 2i, MapReduce are all capable tools, but they don't scale
&gt;&gt; nearly as well as straight key/value requests, and it is often possible to
&gt;&gt; model your data around the latter.
&gt;&gt; 
&gt;&gt; I covered this in https://basho.com/riak-development-anti-patterns/ and the
&gt;&gt; next edition of Eric Redmond's Little Riak Book (http://littleriakbook.com)
&gt;&gt; will have more discussion on the topic, but if at all possible, create your
&gt;&gt; query results as reports as the data is ingested, instead of attempting to
&gt;&gt; find it all later.
&gt;&gt; 
&gt;&gt; -John
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Wed, Aug 20, 2014 at 3:21 PM, Alex De la rosa 
&gt;&gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Any thoughts about this?
&gt;&gt;&gt; 
&gt;&gt;&gt; One thing it worries me about Riak Search is that if one index has several
&gt;&gt;&gt; millions of object to search for maybe it becomes slow? 2i might be faster
&gt;&gt;&gt; then?
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks!
&gt;&gt;&gt; Alex
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On Tue, Aug 19, 2014 at 8:47 AM, Alex De la rosa 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Hi there,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I had been seeing lately Riak Search as an ultimate way to query Riak...
&gt;&gt;&gt;&gt; and it seems recommended to use over MapReduce and even 2i... said so...
&gt;&gt;&gt;&gt; should we try to always use Riak Search over the other systems?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Is there any situation in which MapReduce could be a better approach than
&gt;&gt;&gt;&gt; Riak Search?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Same goes for 2i... I believe 2i is an optimal approach if you just want
&gt;&gt;&gt;&gt; keys and know very well what are you looking for, but out of that, should
&gt;&gt;&gt;&gt; Riak Search try to replace all 2i uses?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Practical example: If you are twitter and want to get twits for the
&gt;&gt;&gt;&gt; hashtag #Riak, what would be the best approach? 2i? Riak Search? MapReduce?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Thanks!
&gt;&gt;&gt;&gt; Alex
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

