---
title: "Re: MR Timeout"
description: ""
project: community
lastmod: 2012-08-03T13:48:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08181"
mailinglist_parent_id: "msg08175"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2012-08-03T13:48:37-07:00
---


On Fri, Aug 3, 2012 at 10:50 AM, Yousuf Fauzan  wrote:
&gt; The query fails with the following error
&gt; &lt;&lt;"{\"phase\":1,\"error\":\"{{{badmatch,[]},[{riak\_kv\_js\_manager,needs\_reload,2},{riak\_kv\_js\_manager,handle\_call,3},...

Hi, Yousuf. I think there may be a race between a Javascript VM
marking itself idle and the same VM getting the message that its
manager has died. Could you please check in your Riak logs for an
error similar to:

16:32:10.693 [error] Supervisor riak\_kv\_sup had child riak\_kv\_js\_map
started with riak\_kv\_js\_manager:start\_link(riak\_kv\_js\_map, 8) at
&lt;0.284.0&gt; exit with reason killed in context child\_terminated

The important part to look for is the first bit about "Supervisor
riak\_kv\_sup had child riak\_kv\_js\_map started with
riak\_kv\_js\_manager:start\_link". If that happened, then the error your
seeing is an old VM trying to mark itself idle with a new manager that
doesn't know about it. I'll work up a patch to solve this issue.

\*Why\* that manager exited, if that is indeed what you find in your
logs, is another question, and may have to do with many JS VMs
crashing suddenly. Such situations are often linked to high memory
pressure, in my experience.

&gt; Also, MR is quite slow. Is there a way to speed things up?

The biggest speedup in MR performance often comes from rewriting
Javascript phases in Erlang. It's annoying, yes, but it avoids the
costs of JSON (de-)serialization and inter-VM communication. Reduce
phases, in particular, also benefit from ensuring that your function
is actually \*reducing\* (not accumulating an ever-growing result on
each invocation), and from tuning reduce\_phase\_batch\_size or even
using reduce\_phase\_only\_1.
(http://wiki.basho.com/MapReduce-Implementation.html#Configuration-Tuning-for-Reduce-Phases)

Hope that helps,
Bryan

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

