---
title: "Re: riak 2.1.1 : Erlang crash dump"
description: ""
project: community
lastmod: 2015-10-01T14:07:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16594"
mailinglist_parent_id: "msg16577"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2015-10-01T14:07:56-07:00
---


It looks like Riak was unable to allocate 4Gb of memory. You may have to
reduce the amount of memory allocated for leveldb from the default 70%, try
setting this in your /etc/riak/riak.conf file

leveldb.maximum\_memory.percent = 50

The memory footprint for Riak should stabilize after a few hours and on
servers with smaller amounts of memory, the 30% left over may not be enough.

Please let us know how you get on.

On Wed, Sep 30, 2015 at 5:31 PM Girish Shankarraman &lt;
gshankarra...@vmware.com&gt; wrote:

&gt; I have 7 node cluster for riak with a ring\_size of 128.
&gt;
&gt; \*System Details:\*
&gt; Each node is a VM with 16GB of memory.
&gt; The backend is using leveldb.
&gt; sys\_system\_architecture : &lt;&lt;"x86\_64-unknown-linux-gnu"&gt;&gt;
&gt; sys\_system\_version : &lt;&lt;"Erlang R16B02\_basho8 (erts-5.10.3) [source]
&gt; [64-bit] [smp:4:4] [async-threads:64] [kernel-poll:true] [frame-pointer]"&gt;&gt;
&gt; riak\_control\_version : &lt;&lt;"2.1.1-0-g5898c40"&gt;&gt;
&gt; cluster\_info\_version : &lt;&lt;"2.0.2-0-ge231144"&gt;&gt;
&gt; yokozuna\_version : &lt;&lt;"2.1.0-0-gcb41c27”&gt;&gt;
&gt;
&gt; \*Scenario:\*
&gt; We have up to 400-1000 json records being written/sec. Each record might
&gt; be a few 100 bytes.
&gt; I see the following crash message in the erlang logs after a few hours of
&gt; processing. Any suggestions on what could be going on here ?
&gt;
&gt; ===== Tue Sep 29 20:20:56 UTC 2015
&gt; [os\_mon] memory supervisor port (memsup): Erlang has closed^M
&gt; [os\_mon] cpu supervisor port (cpu\_sup): Erlang has closed^M
&gt; ^M
&gt; Crash dump was written to: /var/log/riak/erl\_crash.dump^M
&gt; eheap\_alloc: Cannot allocate 3936326656 bytes of memory (of type "heap").^M
&gt;
&gt; Also tested running this at 50GB per Riak Node(VM) and things work but
&gt; memory keeps growing, so throwing hardware at it doesn’t seem very scalable.
&gt;
&gt; Thanks,
&gt;
&gt; — Girish Shankarraman
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

