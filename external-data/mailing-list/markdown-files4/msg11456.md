---
title: "Re: Using Hadoop distcp to load data into Riak-CS"
description: ""
project: community
lastmod: 2013-07-10T08:31:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11456"
mailinglist_parent_id: "msg11450"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2013-07-10T08:31:18-07:00
---


Hi Dan. I do not know much about distcp, but if it is the case that it uses
a PUT (copy) operation to transfer data then distcp will not currently work
with RiakCS. Support for that operation is on our roadmap, but it is not
done yet unfortunately.

Kelly


On Wed, Jul 10, 2013 at 6:20 AM, Sajner, Daniel G  wrote:

&gt; Hi.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Sorry about the “fake sender” in the subject of the original message. Our
&gt; mail security system is funny like that…\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Anyhow, we discovered that distcp puts a temp file name in place and then
&gt; tries to do a PUT (copy) that copy the file to the permanent name. From
&gt; the documentation that doesn’t appear to be supported by Riak.
&gt; http://docs.basho.com/riakcs/latest/references/apis/storage/RiakCS-PUT-Object-Copy/
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; I still would like to hear if anyone else has had success with distcp.
&gt; Maybe there is another version out there that works differently.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Thanks,\*\*\*\*
&gt;
&gt; Dan\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*From:\* riak-users [mailto:riak-users-boun...@lists.basho.com] \*On Behalf
&gt; Of \*Sajner, Daniel G
&gt; \*Sent:\* Tuesday, July 09, 2013 7:56 AM
&gt; \*To:\* 'riak-users@lists.basho.com'
&gt; \*Subject:\* [PMX:FAKE\_SENDER] Using Hadoop distcp to load data into Riak-CS
&gt; \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Hi.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; I’m trying to load data from a Hadoop cluster using distcp. Distcp
&gt; supports the S3 API, but I’m running into issues.\*\*\*\*
&gt;
&gt; Has anyone tested/had success with this process? Any help is
&gt; appreciated! Details below…\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Thanks,\*\*\*\*
&gt;
&gt; Dan\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Here’s my setup:\*\*\*\*
&gt;
&gt; Hadoop cluster with a small text file in hdfs.\*\*\*\*
&gt;
&gt; Jets3t.properties file configured to use a proxy host.\*\*\*\*
&gt;
&gt; Proxy host running Varnish basically to serve as a load balancer at this
&gt; point. All caching is currently disabled.\*\*\*\*
&gt;
&gt; Riak-CS/Riak running on a 6 server cluster.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Here’s the scenario:\*\*\*\*
&gt;
&gt; I’m running this command…\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*\*Ø \*\*hadoop distcp -libjars ./jets3t-config.jar
&gt; hdfs://hadoop.node.address/user/dan/test.txt
&gt; s3n://riak-user-key:riak-secret@testing/\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; I see many requests and responses in the varnishlog so I know
&gt; communication is succeeding. The distcp process throws an exception and I
&gt; see empty files and directories left on my Riak system.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; The exception looks like this:\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; 13/07/08 15:52:42 INFO tools.DistCp: sourcePathsCount=1\*\*\*\*
&gt;
&gt; 13/07/08 15:52:42 INFO tools.DistCp: filesToCopyCount=1\*\*\*\*
&gt;
&gt; 13/07/08 15:52:42 INFO tools.DistCp: bytesToCopyCount=93.0\*\*\*\*
&gt;
&gt; 13/07/08 15:52:42 INFO mapred.JobClient: Running job: job\_201307031542\_0023
&gt; \*\*\*\*
&gt;
&gt; 13/07/08 15:52:43 INFO mapred.JobClient: map 0% reduce 0%\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Job complete:
&gt; job\_201307031542\_0023\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Counters: 6\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Job Counters\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: SLOTS\_MILLIS\_MAPS=6980\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Total time spent by all
&gt; reduces waiting after reserving slots (ms)=0\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Total time spent by all maps
&gt; waiting after reserving slots (ms)=0\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Launched map tasks=1\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: SLOTS\_MILLIS\_REDUCES=0\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Failed map tasks=1\*\*\*\*
&gt;
&gt; 13/07/08 15:52:50 INFO mapred.JobClient: Job Failed: NA\*\*\*\*
&gt;
&gt; With failures, global counters are inaccurate; consider running with -i\*\*\*
&gt; \*
&gt;
&gt; Copy failed: java.io.IOException: Job failed!\*\*\*\*
&gt;
&gt; at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:1246)\*
&gt; \*\*\*
&gt;
&gt; at org.apache.hadoop.tools.DistCp.copy(DistCp.java:667)\*\*\*\*
&gt;
&gt; at org.apache.hadoop.tools.DistCp.run(DistCp.java:881)\*\*\*\*
&gt;
&gt; at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)\*\*\*\*
&gt;
&gt; at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:79)\*\*\*\*
&gt;
&gt; at org.apache.hadoop.tools.DistCp.main(DistCp.java:908)\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; And Riak is left like this:\*\*\*\*
&gt;
&gt; \*\*Ø \*\*s3cmd ls s3://testing \*\*\*\*
&gt;
&gt; DIR s3://testing/\_distcp\_logs\_7bhq3z/\*\*\*\*
&gt;
&gt; DIR s3://testing/\_distcp\_logs\_j9re3f/\*\*\*\*
&gt;
&gt; 2013-07-09 03:54 0 s3://testing/\_distcp\_logs\_7bhq3z\_$folder$\*\*\*\*
&gt;
&gt; 2013-07-09 00:03 0 s3://testing/\_distcp\_logs\_j9re3f\_$folder$\*\*\*\*
&gt;
&gt; 2013-07-08 19:52 0 s3://testing/test.txt\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*Confidentiality Notice\*: This electronic message transmission, including
&gt; any attachment(s), may contain confidential, proprietary, or privileged
&gt; information from Chemical Abstracts Service (“CAS”), a division of the
&gt; American Chemical Society (“ACS”). If you have received this transmission
&gt; in error, be advised that any disclosure, copying, distribution, or use of
&gt; the contents of this information is strictly prohibited. Please destroy all
&gt; copies of the message and contact the sender immediately by either replying
&gt; to this message or calling 614-447-3600.\*\*\*\*
&gt;
&gt; \*Confidentiality Notice\*: This electronic message transmission, including
&gt; any attachment(s), may contain confidential, proprietary, or privileged
&gt; information from Chemical Abstracts Service (“CAS”), a division of the
&gt; American Chemical Society (“ACS”). If you have received this transmission
&gt; in error, be advised that any disclosure, copying, distribution, or use of
&gt; the contents of this information is strictly prohibited. Please destroy all
&gt; copies of the message and contact the sender immediately by either replying
&gt; to this message or calling 614-447-3600.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

