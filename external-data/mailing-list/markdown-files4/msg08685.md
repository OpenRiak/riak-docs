---
title: "Re: preflist_exhausted"
description: ""
project: community
lastmod: 2012-09-24T13:15:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08685"
mailinglist_parent_id: "msg08588"
author_name: "Darrel Grant"
project_section: "mailinglistitem"
sent_date: 2012-09-24T13:15:17-07:00
---


It turned out this was caused by my using the wrong port in my code.

I had two ways of initiating the connection to riak in my python code. One
using the HTTP interface, and one using the protocol buffers interface, and
the port being used for protocol buffers was incorrectly hitting the system
riak instance, rather than the nodes setup by following the riak fast track.

I should have noticed when the data I created from the http interface calls
wasn't there when I changed switched over to pcb. So new to riak, it seemed
as if changing the interface affected the returned data, even though that
didn't make a lot of sense. It was just hitting a different cluster. It
seems like the system riak, which has its config in /etc/riak/app.config,
doesn't really need to run at all for development.


On Tue, Sep 18, 2012 at 2:40 PM, Darrel Grant  wrote:

&gt; More info, in case it helps someone help me figure out what has gone
&gt; wrong. I suspect I have something misconfigured, or not configured, that is
&gt; affecting the mapreduce js vms.
&gt;
&gt; I followed the instructions on this thread:
&gt; http://riak-users.197444.n3.nabble.com/preflist-exhausted-with-map-reduce-and-riak-js-td3821516.html
&gt;
&gt; In that thread, the guys problem turned out to be a missing
&gt; mapred\_builtins.js file. I found mine /usr/lib/riak/lib/riak\_kv-1.2.0/priv
&gt; so I don't think my problem is the same.
&gt;
&gt; About using the riak console to find out how many map reduce vms are
&gt; available:
&gt;
&gt; (riak@127.0.0.1)5&gt; rpc:multicall(supervisor, count\_children,
&gt; [riak\_pipe\_builder\_sup]).
&gt; {[[{specs,1},{active,0},{supervisors,0},{workers,0}]],[]}
&gt; (riak@127.0.0.1)6&gt; rpc:multicall(supervisor, count\_children,
&gt; [riak\_pipe\_fitting\_sup]).
&gt; {[[{specs,1},{active,0},{supervisors,0},{workers,0}]],[]}
&gt; (riak@127.0.0.1)7&gt;
&gt; rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_map]).
&gt; {"\b",[]}
&gt; (riak@127.0.0.1)9&gt;
&gt; rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_reduce]).
&gt; {[6],[]}
&gt;
&gt;
&gt; May be worth noting that those commands product the same weird output
&gt; whether my app.config settings are:
&gt; {map\_js\_vm\_count, 32 },
&gt; {reduce\_js\_vm\_count, 32 },
&gt; {hook\_js\_vm\_count, 16 },
&gt;
&gt; Or the outlandishly high:
&gt; {map\_js\_vm\_count, 4096 },
&gt; {reduce\_js\_vm\_count, 4096 },
&gt; {hook\_js\_vm\_count, 256 },
&gt;
&gt;
&gt; and look nothing like the Mathew Tobvin's output:
&gt; 3&gt;rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_map]).
&gt; {[0,0,0],[]}
&gt; 4&gt;rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_reduce]).
&gt; {[0,0,0],[]}
&gt;
&gt; Also, the output of those commands is the same after running a mapreduce
&gt; job. Once in a while, usually after a fresh riak restart and a bit of time
&gt; has passed since the last preflist\_exhausted error, one of my mapreduce
&gt; jobs will actually complete successfully. At a mere 10000 keys in one
&gt; bucket and exactly 1 user, I do not understand at all what is wrong in my
&gt; installation. Does anyone have any suggestions?
&gt;
&gt; Darrel
&gt;
&gt;
&gt;
&gt; On Tue, Sep 18, 2012 at 9:27 AM, Darrel Grant  wrote:
&gt;
&gt;&gt; I have about 10000 items in a bucket, and am getting this error a lot.
&gt;&gt;
&gt;&gt; My app.config settings are already quite a lot higher than any values
&gt;&gt; I've come across while googling this issue:
&gt;&gt; {map\_js\_vm\_count, 4096 },
&gt;&gt; {reduce\_js\_vm\_count, 4096 },
&gt;&gt; {hook\_js\_vm\_count, 256 },
&gt;&gt; {js\_max\_vm\_mem, 256},
&gt;&gt;
&gt;&gt; And just steadily increasing them doesn't seem good, because this bucket
&gt;&gt; could easily have millions of keys in it in a bit of time.
&gt;&gt;
&gt;&gt; Interestingly, if I stop and start riak, I can get the results I expect
&gt;&gt; from the mapreduce, but if I then run it again, I get the
&gt;&gt; preflist\_exhausted error. Is there some setting I am missing, which frees
&gt;&gt; up workers after a run, or perhaps causes them to be re-used in some way?
&gt;&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

