---
title: "Re: distribution of data among riak cluster physical nodes"
description: ""
project: community
lastmod: 2013-10-09T07:03:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12562"
mailinglist_parent_id: "msg12560"
author_name: "John Daily"
project_section: "mailinglistitem"
sent_date: 2013-10-09T07:03:52-07:00
---


What you saw is actually quite typical when using R=1.

When you turn off a node, Riak's sloppy quorum behavior will kick in and hand 
off some of your read requests to an empty data partition to supplement the two 
remaining partitions that still have a copy. Since the partition is empty, it 
can respond very quickly with a message indicating that the object cannot be 
found.

By default, Riak will treat the absence of an object as a definitive statement 
of "we don't have a copy of that."

If R=2 or R=3, Riak would wait for another partition to respond before 
replying, but since R=1 the first reply wins. You should find that a 2nd 
request succeeds, because read repair will kick in and distribute a copy of the 
object to that empty partition.

Rather than increasing the R value, you can also manipulate this behavior using 
the notfound\_ok configuration variable.

See http://basho.com/riaks-config-behaviors-part-3/ for a more detailed 
explanation, specifically the "notfound tuning" section, and 
http://basho.com/riaks-config-behaviors-epilogue/ for a list of links to the 
full series.

-John

On Oct 9, 2013, at 9:50 AM, kzhang  wrote:

&gt; We have a 5 node riak cluster to store site images, with N=3, R=1. When we
&gt; turned off one node, a lot of GET requests failed, which made me think those
&gt; requested images (3 copies of them) all landed on the failed physical node.
&gt; Is there a way to tell how the replicas are distributed among the physical
&gt; nodes, and if there is a way to re-distribute them if all copies of the same
&gt; key-value are on the same machine?
&gt; 
&gt; 
&gt; 
&gt; --
&gt; View this message in context: 
&gt; http://riak-users.197444.n3.nabble.com/distribution-of-data-among-riak-cluster-physical-nodes-tp4029398.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

