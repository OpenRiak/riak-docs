---
title: "Best way to feed inputs into a MapReduce query"
description: ""
project: community
lastmod: 2011-10-11T17:59:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05128"
author_name: "Wayne See"
project_section: "mailinglistitem"
sent_date: 2011-10-11T17:59:36-07:00
---


Hi all,

I'm planning on using Riak to perform aggregation/sorting on a dataset
composed of JSON values. I can feed the keys to the MapReduce query using
key filters or Riak search, but I was wondering which would give better
performance when doing the query on a large dataset and the matching keys
would only be a small subset of it? To give a little bit more background I
only need to index/query against 2 fields of a JSON document so I don't
necessarily need the flexibility of Riak search, and key filters would work
since I can use field1-field2 to key the document. I'm concerned though that
key filters would have to loop through the entire bucket keyspace to find
the matching keys, but I'm also concerned that Riak Search would index the
whole JSON (although the fields I would query against would be your regular
integer keys, the other fields can get pretty big) and possibly affect write
performance. I'm planning to test this when I have the time but I was
wondering if anybody has similar experiences regarding this and can shed
some insight? Rough estimate of size of dataset would be 1M keys but
aggregation would only be performed on a 50-150 keys.

I'm also considering keeping an inverted index on another datastore like
redis so I can just get the keys I need from that datastore and feed that
into Riak's MapReduce, but ideally I would like to keep it in Riak to make
it simpler to scale. I've also looked into secondary indices but from the
looks of it I can't perform lookups against 2 tags.

Thanks in advance!

Wayne
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

