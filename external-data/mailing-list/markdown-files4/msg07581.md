---
title: "Re: Strange spike"
description: ""
project: community
lastmod: 2012-05-30T23:23:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07581"
mailinglist_parent_id: "msg07579"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-05-30T23:23:58-07:00
---


Nam,

The LevelDB storage backend has a known issue where compaction can stall a
heavily-loaded node for a long time (we've seen 60 seconds or more in
production clusters). We're very sorry about this, but an improvement will
be available in the next release. In the meantime, DO NOT make the node
leave the cluster - this will only make things worse! It might be worth
adding another node to the cluster, but I suggest you wait until the node
finishes compaction.

On Wed, May 30, 2012 at 10:43 PM, Nam Nguyen  wrote:

&gt; Hi,
&gt;
&gt; My 5-node cluster exhibits a strange spike on one particular node.
&gt;
&gt; Overall, the mean get time is about 1ms. This node occasionally shoots up
&gt; to 40ms.
&gt;
&gt; During those times, %iowait is still the same as it is before the spike.
&gt; No error. Console log shows many lines like the below, which I don't think
&gt; relevant to the spike.
&gt;
&gt; 2012-05-30 21:29:50.591 [info]
&gt; &lt;0.72.0&gt;@riak\_core\_sysmon\_handler:handle\_event:85 monitor long\_gc &lt;0.938.0&gt;
&gt; [{initial\_call,{riak\_core\_vnode,init,1}},{almost\_current\_function,{gen\_fsm,loop,7}},{message\_queue\_len,0}]
&gt; [{timeout,185},{old\_heap\_block\_size,0},{heap\_block\_size,2584},{mbuf\_size,0},{stack\_size,55},{old\_heap\_size,0},{heap\_size,804}]
&gt;
&gt; The cluster is set up uniformly. Ubuntu 64bit, m2.2xlarge instance. Riak
&gt; 1.1.2 with LevelDB backend.
&gt;
&gt; What would be the best course of actions for me?
&gt;
&gt; I plan to:
&gt;
&gt; - riak-admin leave on that node
&gt; - set up new instance
&gt; - riak-admin reip the new instance
&gt; - riak-admin join it to the cluster
&gt;
&gt; Cheers,
&gt; Nam
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

