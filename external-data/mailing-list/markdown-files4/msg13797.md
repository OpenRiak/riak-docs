---
title: "Re: 60 second timeout in Riak"
description: ""
project: community
lastmod: 2014-03-13T08:42:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13797"
mailinglist_parent_id: "msg13792"
author_name: "Matthew MacClary"
project_section: "mailinglistitem"
sent_date: 2014-03-13T08:42:17-07:00
---


Interesting, so the Java client is just honoring the server's request that
it try back in 60 seconds? Do you happen to know if there is a
configuration variable to tune that default timeout value?

Our automated testing since yesterday has shown that changing pb\_backlog
did resolve this 60 second timeout issue for our system.

-Matt


On Wed, Mar 12, 2014 at 9:18 PM, Brian Roach  wrote:

&gt; Just as a clarification, there is no default timeout in the Java client.
&gt; Riak 1.4 introduced server-side timeouts on operations and the default is
&gt; 60 seconds (60k milliseconds). By default, the client does retry after
&gt; receiving the timeout error message which is the behavior you're seeing.
&gt;
&gt; - Roach
&gt; On Mar 12, 2014 7:42 AM, "Matthew MacClary" &lt;
&gt; maccl...@lifetime.oregonstate.edu&gt; wrote:
&gt;
&gt;&gt; Thanks for the suggestion Christian. Right now I am running an experiment
&gt;&gt; with pb\_backlog set to 64 up from the default of 5. The way our application
&gt;&gt; uses the client there would usually be 4 connections initiated at the same
&gt;&gt; time, but there could be as many as 12 connections initiated at the same
&gt;&gt; time right now. I wonder if that is causing the client to time out and try
&gt;&gt; back in 60 seconds!
&gt;&gt;
&gt;&gt; I will report my results.
&gt;&gt;
&gt;&gt; Best regards,
&gt;&gt;
&gt;&gt; -Matt
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Mar 11, 2014 at 11:38 PM, Christian Dahlqvist &lt;
&gt;&gt; christ...@basho.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Matthew,
&gt;&gt;&gt;
&gt;&gt;&gt; I believe 60 seconds is the default timeout in the client, so it is
&gt;&gt;&gt; possible the `busy\_dist\_port` issues have caused a timeout and that the
&gt;&gt;&gt; automatic retry then has succeeded.
&gt;&gt;&gt;
&gt;&gt;&gt; A small +zdbbl value will cause the internal buffers to fill up and
&gt;&gt;&gt; result in `busy\_dist\_port` messages, which will cause performance problems.
&gt;&gt;&gt; I would recommend setting +zdbbl to 16384 (16MB) or 32768 (32MB) and verify
&gt;&gt;&gt; that you stop seeing busy\_dist\_post messages in the logs. If problems
&gt;&gt;&gt; persist it may be required to set it even higher.
&gt;&gt;&gt;
&gt;&gt;&gt; It is also important to note that `busy\_dist\_port` messages can be
&gt;&gt;&gt; caused by individual large objects even if +zdbbl is set to a reasonably
&gt;&gt;&gt; large value as outlined above. In Riak 1.4.8, logging of large objects has
&gt;&gt;&gt; been introduced, which will allow you to identify large objects that could
&gt;&gt;&gt; cause problems by going through the logs. You can also track large objects
&gt;&gt;&gt; by trending the `node\_get\_fsm\_objsize\_100` statistic.
&gt;&gt;&gt;
&gt;&gt;&gt; Best regards,
&gt;&gt;&gt;
&gt;&gt;&gt; Christian
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Mar 12, 2014 at 5:43 AM, Matthew MacClary &lt;
&gt;&gt;&gt; maccl...@lifetime.oregonstate.edu&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi everyone, we are running Riak 1.4.1 on RHEL 6.2 using bitcask. We
&gt;&gt;&gt;&gt; are using protobufs with the Java client, and our binary objects are
&gt;&gt;&gt;&gt; typically a few hundred KB in size. I have noticed a persistent anomaly
&gt;&gt;&gt;&gt; with riak reads and writes. It seems like often, maybe 0.5% of the time,
&gt;&gt;&gt;&gt; writing to Riak takes 60 seconds longer than it should. Here is a prime
&gt;&gt;&gt;&gt; example I just trimmed from a log file (see the last time entry below).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This is not bitcask merge related because it happens before any of the
&gt;&gt;&gt;&gt; bitcask slabs are large enough to merge. I am seeing lots of busy\_dist\_port
&gt;&gt;&gt;&gt; messages in the Riak logs. One unique setting is that we have a small zdbbl
&gt;&gt;&gt;&gt; setting of 128K because this seemed to prevent congestive collapse of
&gt;&gt;&gt;&gt; throughput at high sustained loads. I believe that this 60 second timeout
&gt;&gt;&gt;&gt; persisted across the various zdbbl settings we tried. Also we see this
&gt;&gt;&gt;&gt; occasional 60 second delay on both VMs and real server hardware.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Does anyone know where this 60 second delay comes from?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -Matt
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2014-03-11 20:40:00,747 INFO [Thread-61] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 88: 0.087 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:01,137 INFO [Thread-62] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 70: 0.185 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:01,958 INFO [Thread-63] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 97: 0.054 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:02,566 INFO [Thread-64] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 90: 0.043 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:02,830 INFO [Thread-65] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 85: 0.051 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:04,162 INFO [Thread-66] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 101: 0.075 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:04,503 INFO [Thread-67] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 103: 0.048 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:05,745 INFO [Thread-68] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 98: 0.031 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:06,041 INFO [Thread-69] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 102: 0.063 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:06,444 INFO [Thread-70] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 92: 0.022 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:06,903 INFO [Thread-71] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 99: 0.039 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:09,847 INFO [Thread-72] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 106: 0.019 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:10,107 INFO [Thread-73] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 108: 0.043 seconds
&gt;&gt;&gt;&gt; 2014-03-11 20:40:47,820 INFO [Thread-52] sally.ReportHandler - Riak
&gt;&gt;&gt;&gt; load time for 62: 1 minutes, 0.190 seconds
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

