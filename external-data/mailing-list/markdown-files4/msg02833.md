---
title: "Re: Riak node recovery after crash."
description: ""
project: community
lastmod: 2011-04-01T07:26:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02833"
mailinglist_parent_id: "msg02832"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-04-01T07:26:32-07:00
---


Nico,

That's fair, I was probably too rosy-eyed about it. However, the difference in 
startup times between Bitcask and Inno is still orders of magnitude for the 
same keyspace size. Now that I reflect on it, I remember a customer who had 
30MM keys in a 5 node cluster, each node would take about 1.5 seconds for the 
node watcher to report riak\_kv was available. Before they switched off of 
Innostore, it would take upwards of a minute to load and repair tables. YMMV

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Apr 1, 2011, at 10:11 AM, Nico Meyer wrote:

&gt; Hi Sean,
&gt; 
&gt; I have to object here. We have a cluster of 8 Core/64GB nodes with an
&gt; SSD drive for the bitcask dir. Each node holds on the order of 100Mio
&gt; keys. The complete bitcask directory is only about 60Gb big, so it fit
&gt; almost completely. 
&gt; The time from starting the node until it start handling requests, which
&gt; means all hint files have been read, is on the order of 10 minutes.
&gt; During this time the beam process is completely CPU bound, the disk is
&gt; hardly breaking a sweat.
&gt; Only 1 core is used at all, since there is only a single erlang process
&gt; starting all the vnodes sequentially. Sometimes a second core is also
&gt; utilized, but that is due to merges on the already started partitions.
&gt; 
&gt; Cheers,
&gt; Nico
&gt; 
&gt; Am Freitag, den 01.04.2011, 08:45 -0400 schrieb Sean Cribbs:
&gt;&gt; Santhosh,
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Bitcask has crash-proof design and so, unlike Inno, it will not read
&gt;&gt; the entire keyspace and try to correct it at startup time. It will
&gt;&gt; simply load the existing hint files and then scan the files it doesn't
&gt;&gt; have hints for to discover the extant keys. This takes milliseconds
&gt;&gt; or less per partition; you will hardly notice it.
&gt;&gt; 
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt;&gt; On Apr 1, 2011, at 2:49 AM, santhosh venkat wrote:
&gt;&gt; 
&gt;&gt;&gt; Hi , 
&gt;&gt;&gt; I am trying to experiment with the recovery time of a riak
&gt;&gt;&gt; node using bitcask storage after a crash .
&gt;&gt;&gt; 
&gt;&gt;&gt; I was able to find some information about that in this page
&gt;&gt;&gt; (which is for Innodb though)
&gt;&gt;&gt; 
&gt;&gt;&gt; http://wiki.basho.com/Recovering-a-failed-node.html which is
&gt;&gt;&gt; more about Innodb .
&gt;&gt;&gt; 
&gt;&gt;&gt; Upon Reading bitcask paper i found it uses hint file to
&gt;&gt;&gt; constructs in memory mapping , so it should not ideally take more
&gt;&gt;&gt; than few mins to reconstruct data after crash . Please throw some
&gt;&gt;&gt; light on this .
&gt;&gt;&gt; 
&gt;&gt;&gt; I got this thread dump when i tried the steps outlined in the
&gt;&gt;&gt; above link.
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:50 ===
&gt;&gt;&gt; [{alarm\_handler,{set,{{disk\_almost\_full,"/var/lib/mysql"},[]}}}]
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:50 ===
&gt;&gt;&gt; [{alarm\_handler,{set,{{disk\_almost\_full,"/var/lib/riak"},[]}}}]\*\*
&gt;&gt;&gt; Found 0 name clashes in code paths 
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.141.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.142.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.143.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.144.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.145.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.146.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.147.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_map) host starting (&lt;0.148.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_reduce) host starting (&lt;0.150.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_reduce) host starting (&lt;0.151.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_reduce) host starting (&lt;0.152.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_reduce) host starting (&lt;0.153.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; =INFO REPORT==== 1-Apr-2011::12:06:51 ===
&gt;&gt;&gt; Spidermonkey VM (thread stack: 16MB, max heap: 8MB, pool:
&gt;&gt;&gt; riak\_kv\_js\_reduce) host starting (&lt;0.154.0&gt;)
&gt;&gt;&gt; 
&gt;&gt;&gt; Please help . 
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Santhosh
&gt;&gt;&gt; 
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

