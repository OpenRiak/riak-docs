---
title: "Re: Python Client Thread Safe?"
description: ""
project: community
lastmod: 2012-02-27T12:13:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06758"
mailinglist_parent_id: "msg06756"
author_name: "Jim Adler"
project_section: "mailinglistitem"
sent_date: 2012-02-27T12:13:20-08:00
---


Hmm, I do have multiple clients -- one per thread.

Jim

On 2/27/12 10:47 AM, "Armon Dadgar"  wrote:

&gt;Hey Jim,
&gt;
&gt;The PBC client does not share any state between clients,
&gt;but it is not safe to use a single client with multiple threads,
&gt;since the underlying socket will be shared.
&gt;
&gt;If you have multiple threads, just make sure to use multiple
&gt;clients.
&gt;
&gt;Best Regards,
&gt;
&gt;Armon Dadgar
&gt;
&gt;&gt; 
&gt;&gt; Message: 1
&gt;&gt; Date: Sun, 26 Feb 2012 19:39:38 +0000
&gt;&gt; From: Jim Adler 
&gt;&gt; To: "riak-users@lists.basho.com" 
&gt;&gt; Subject: Python Client Thread Safe?
&gt;&gt; Message-ID: 
&gt;&gt; Content-Type: text/plain; charset="us-ascii"
&gt;&gt; 
&gt;&gt; I'm getting the following error while using protocol buffers
&gt;&gt; (RiakPbcTransport) with more than one thread (stack trace below):
&gt;&gt; 
&gt;&gt; Socket returned short packet length 0 - expected 4'
&gt;&gt; 
&gt;&gt; I'm using the 1.3.0 Python client on Mac and Ubuntu 11.04 and have seen
&gt;&gt; the same error on both OS's. A single-thread works fine as does the
&gt;&gt; RiakHttpTransport.
&gt;&gt; 
&gt;&gt; Anyone have this problem?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; File 
&gt;&gt; 
&gt;&gt;"/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/
&gt;&gt;li
&gt;&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/bucket.py", line
&gt;&gt;260,
&gt;&gt; in get
&gt;&gt; return obj.reload(r)
&gt;&gt; File 
&gt;&gt; 
&gt;&gt;"/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/
&gt;&gt;li
&gt;&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/riak\_object.py",
&gt;&gt;line
&gt;&gt; 373, in reload
&gt;&gt; Result = t.get(self, r, vtag)
&gt;&gt; File 
&gt;&gt; 
&gt;&gt;"/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/
&gt;&gt;li
&gt;&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt;&gt; line 195, in get
&gt;&gt; msg\_code, resp = self.send\_msg(MSG\_CODE\_GET\_REQ, req, None)
&gt;&gt; File 
&gt;&gt; 
&gt;&gt;"/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/
&gt;&gt;li
&gt;&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt;&gt; line 387, in send\_msg
&gt;&gt; return self.recv\_msg(conn, expect)
&gt;&gt; File 
&gt;&gt; 
&gt;&gt;"/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/
&gt;&gt;li
&gt;&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt;&gt; line 413, in recv\_msg
&gt;&gt; self.recv\_pkt(conn)
&gt;&gt; File 
&gt;&gt; 
&gt;&gt;"/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/
&gt;&gt;li
&gt;&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt;&gt; line 460, in recv\_pkt
&gt;&gt; len(nmsglen))
&gt;&gt; RiakError: 'Socket returned short packet length 0 - expected 4'
&gt;&gt; 
&gt;
&gt;\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;riak-users mailing list
&gt;riak-users@lists.basho.com
&gt;http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

