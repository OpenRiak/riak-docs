---
title: "Re: Listing buckets causes nodes to misbehave"
description: ""
project: community
lastmod: 2012-03-16T13:27:29-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06989"
mailinglist_parent_id: "msg06986"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2012-03-16T13:27:29-07:00
---


That is true. The wiki page for list keys 
http://wiki.basho.com/HTTP-List-Keys.html we mention not to use it in 
production environments and the same holds for list buckets. 

-Jared


On Mar 16, 2012, at 1:48 PM, Armon Dadgar wrote:

&gt; Interesting, so it's not just us. Based on the behavior,
&gt; I'm guessing that listing the buckets requires traversing the
&gt; key space?
&gt; 
&gt; 
&gt;&gt; Message: 2
&gt;&gt; Date: Thu, 15 Mar 2012 11:19:15 -0700
&gt;&gt; From: Aphyr 
&gt;&gt; To: riak-users@lists.basho.com
&gt;&gt; Subject: Re: Listing buckets causes nodes to misbehave
&gt;&gt; Message-ID: &lt;4f6232a3.5050...@aphyr.com&gt;
&gt;&gt; Content-Type: text/plain; charset=ISO-8859-1; format=flowed
&gt;&gt; 
&gt;&gt; Yup, list-keys and list-buckets does this for us too, since Riak 0.14. 
&gt;&gt; Bitcask, 6 nodes, physical hardware, 1024 partitions, 100-300 million 
&gt;&gt; keys with n\_val 3.
&gt;&gt; 
&gt;&gt; --Kyle
&gt;&gt; 
&gt;&gt; On 03/15/2012 11:17 AM, Armon Dadgar wrote:
&gt;&gt;&gt; We are currently running Riak 1.1 in production, using LevelDB
&gt;&gt;&gt; with snappy compression and yesterday we ran into a strange
&gt;&gt;&gt; issue where listing the buckets via:
&gt;&gt;&gt; 
&gt;&gt;&gt; $ curl "http://east-riak-001:8098/riak?buckets=true"
&gt;&gt;&gt; 
&gt;&gt;&gt; Doing this caused curl to hang indefinitely, and the target node to
&gt;&gt;&gt; freak out.
&gt;&gt;&gt; Symptoms included a massive increase in system load (2-3x), FSM timings
&gt;&gt;&gt; exploding
&gt;&gt;&gt; from ~30-50 msec to 500 - 5000 msec, and most of the APIs becoming
&gt;&gt;&gt; totally unresponsive.
&gt;&gt;&gt; 
&gt;&gt;&gt; We ran this on a few nodes on the cluster, which basically brought
&gt;&gt;&gt; everything to a halt. Our solution was to just reboot all the nodes, at
&gt;&gt;&gt; which point things returned to normal.
&gt;&gt;&gt; 
&gt;&gt;&gt; Curious if anybody else has experienced this.
&gt;&gt;&gt; 
&gt;&gt;&gt; Best Regards,
&gt;&gt;&gt; 
&gt;&gt;&gt; Armon Dadgar
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

