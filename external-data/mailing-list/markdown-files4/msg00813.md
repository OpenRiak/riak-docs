---
title: "Re: Write_lock error has occurred after inserting 12M data"
description: ""
project: community
lastmod: 2010-07-30T14:38:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00813"
mailinglist_parent_id: "msg00812"
author_name: "Ken Matsumoto"
project_section: "mailinglistitem"
sent_date: 2010-07-30T14:38:02-07:00
---



Hi Grant, Alexander, David,

Thank you for your messages.
Here are the infos:
Version : 0.11.0-1344 debian package
Key length : 36B

I append the error part of the log file:

=ERROR REPORT==== 30-Jul-2010::04:00:54 ===
\*\* State machine &lt;0.28753.1381&gt; terminating
\*\* Last event in was {put,&lt;0.28729.1381&gt;,
 {&lt;&lt;"lpb\_probes"&gt;&gt;,
 &lt;&lt;"e2ba34b6-20c0-493a-b248-a031e1ab6299"&gt;&gt;},
 {r\_object,&lt;&lt;"lpb\_probes"&gt;&gt;,
 &lt;&lt;"e2ba34b6-20c0-493a-b248-a031e1ab6299"&gt;&gt;,
 [{r\_content,
 {dict,3,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],
 [],[],[]},
 {{[],[],[],[],[],[],[],[],[],[],

[[&lt;&lt;"content-type"&gt;&gt;,97,112,112,108,
 105,99,97,116,105,111,110,47,106,
 115,111,110],

[&lt;&lt;"X-Riak-VTag"&gt;&gt;,51,111,113,68,70,

105,50,68,117,56,72,66,90,102,68,73,
 84,56,80,67,112,65]],
 [],[],
 [[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|
 {1280,487640,458574}]],
 [],[]}}},

&lt;&lt;"{\"gettime\":\"121850\",\"getdate\":\"20080802\",\"meshcode\":\"503005\",\"longitude\":\"8154510\",\"latitude\":\"1940739\"}"&gt;&gt;}],
 [{&lt;&lt;5,60,63,24&gt;&gt;,{1,63447706840}}],
 {dict,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
 [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
 [[clean|true]],
 []}}},
 undefined},
 72719594,63447706840,
 [{returnbody,false}]}
\*\* When State == active
\*\* Data == {state,456719261665907161938651510223838443642478919680,[],
 riak\_kv\_bitcask\_backend,
 {#Ref&lt;0.0.172.25968&gt;,

"/var/lib/riak/bitcask/456719261665907161938651510223838443642478919680"},
 not\_in\_handoff,undefined}
\*\* Reason for termination =
\*\* {bad\_return\_value,{error,{write\_locked,locked}}}



Best,

Ken.

On 2010/07/30 14:13, Alex Wolfe wrote:

Hey David.

Does the below log output look like it could be caused by the issue you
fixed?

Alex


==== Fri Jul 30 14:22:34 CDT 2010

=ERROR REPORT==== 30-Jul-2010::14:22:34 ===
\*\* State machine &lt;0.176.0&gt; terminating
\*\* Last event in was {riak\_vnode\_req\_v1,
593735040165679310520246963290989976735222595584,
{fsm,undefined,&lt;0.12466.0&gt;},
{riak\_kv\_put\_req\_v1,
{&lt;&lt;"test.groups"&gt;&gt;,&lt;&lt;"EghzXywWrGGtp2fCcSLoatIdjML"&gt;&gt;},
{r\_object,&lt;&lt;"test.groups"&gt;&gt;,
&lt;&lt;"EghzXywWrGGtp2fCcSLoatIdjML"&gt;&gt;,
[{r\_content,
{dict,5,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],
[[&lt;&lt;"Links"&gt;&gt;]],
[],[],[],[],[],[],[],
[[&lt;&lt;"content-type"&gt;&gt;,97,112,112,108,105,99,97,
116,105,111,110,47,106,115,111,110],
[&lt;&lt;"X-Riak-VTag"&gt;&gt;,89,69,78,55,55,111,66,121,73,
69,78,53,122,101,85,105,117,68,89,80,52]],
[],[],
[[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|
{1280,517754,951062}]],
[],
[[&lt;&lt;"X-Riak-Meta"&gt;&gt;]]}}},
&lt;&lt;"{\"name\":\"foo\",\"created\_at\":\"2010-07-30T19:22:34.947Z\",\"type\":\"group\",\"version\":1}"&gt;&gt;}],
[{&lt;&lt;0,55,119,231&gt;&gt;,{1,63447736954}}],
{dict,1,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[[clean|true]],
[]}}},
undefined},
33218311,63447736954,
[{returnbody,true}]}}
\*\* When State == active
\*\* Data == {state,593735040165679310520246963290989976735222595584,
riak\_kv\_vnode,
{state,593735040165679310520246963290989976735222595584,
riak\_kv\_bitcask\_backend,
{#Ref&lt;0.0.0.611&gt;,
"data/bitcask/593735040165679310520246963290989976735222595584"},
[],false},
undefined,none}
\*\* Reason for termination =
\*\* {{badmatch,{error,emfile}},
[{bitcask\_fileops,create\_file\_loop,3},
{bitcask,put,3},
{riak\_kv\_bitcask\_backend,put,3},
{riak\_kv\_vnode,perform\_put,3},
{riak\_kv\_vnode,do\_put,7},
{riak\_kv\_vnode,handle\_command,3},
{riak\_core\_vnode,vnode\_command,3},
{gen\_fsm,handle\_msg,7}]}

=ERROR REPORT==== 30-Jul-2010::14:22:35 ===
Failed to open lock file
data/bitcask/593735040165679310520246963290989976735222595584/bitcask.write.lock:
emfile

=ERROR REPORT==== 30-Jul-2010::14:22:35 ===
\*\* State machine &lt;0.12471.0&gt; terminating
\*\* Last event in was {riak\_vnode\_req\_v1,
593735040165679310520246963290989976735222595584,
{fsm,undefined,&lt;0.12470.0&gt;},
{riak\_kv\_put\_req\_v1,
{&lt;&lt;"test.users"&gt;&gt;,&lt;&lt;"ZrAxzFghd51VG902GuCcJ2gYOMJ"&gt;&gt;},
{r\_object,&lt;&lt;"test.users"&gt;&gt;,
&lt;&lt;"ZrAxzFghd51VG902GuCcJ2gYOMJ"&gt;&gt;,
[{r\_content,
{dict,5,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],
[[&lt;&lt;"Links"&gt;&gt;,
{{&lt;&lt;"test.groups"&gt;&gt;,
&lt;&lt;"EghzXywWrGGtp2fCcSLoatIdjML"&gt;&gt;},
&lt;&lt;"groups"&gt;&gt;}]],
[],[],[],[],[],[],[],
[[&lt;&lt;"content-type"&gt;&gt;,97,112,112,108,105,99,97,
116,105,111,110,47,106,115,111,110],
[&lt;&lt;"X-Riak-VTag"&gt;&gt;,50,88,97,105,85,49,70,49,55,
54,48,71,113,115,75,103,54,102,84,56,118,84]],
[],[],
[[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|{1280,517755,638}]],
[],
[[&lt;&lt;"X-Riak-Meta"&gt;&gt;]]}}},
&lt;&lt;"{\"name\":\"bar\",\"created\_at\":\"2010-07-30T19:22:34.998Z\",\"type\":\"user\",\"version\":1}"&gt;&gt;}],
[{&lt;&lt;3,30,180,15&gt;&gt;,{1,63447736955}}],
{dict,1,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[[clean|true]],
[]}}},
undefined},
122945524,63447736955,
[{returnbody,true}]}}
\*\* When State == active
\*\* Data == {state,593735040165679310520246963290989976735222595584,
riak\_kv\_vnode,
{state,593735040165679310520246963290989976735222595584,
riak\_kv\_bitcask\_backend,
{#Ref&lt;0.0.0.16357&gt;,
"data/bitcask/593735040165679310520246963290989976735222595584"},
[],false},
undefined,none}
\*\* Reason for termination =
\*\* {bad\_return\_value,{error,{write\_locked,emfile}}}

==&gt; sasl-error.log &lt;==

=CRASH REPORT==== 30-Jul-2010::14:22:35 ===
crasher:
initial call: riak\_core\_vnode:init/1
pid: &lt;0.176.0&gt;
registered\_name: []
exception exit: {{badmatch,{error,emfile}},
[{bitcask\_fileops,create\_file\_loop,3},
{bitcask,put,3},
{riak\_kv\_bitcask\_backend,put,3},
{riak\_kv\_vnode,perform\_put,3},
{riak\_kv\_vnode,do\_put,7},
{riak\_kv\_vnode,handle\_command,3},
{riak\_core\_vnode,vnode\_command,3},
{gen\_fsm,handle\_msg,7}]}
in function gen\_fsm:terminate/7
ancestors: [riak\_core\_vnode\_sup,riak\_core\_sup,&lt;0.98.0&gt;]
messages: []
links: [#Port&lt;0.3507&gt;,&lt;0.100.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 1597
stack\_size: 24
reductions: 11185
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:22:35 ===
Supervisor: {local,riak\_core\_vnode\_sup}
Context: child\_terminated
Reason: {{badmatch,{error,emfile}},
[{bitcask\_fileops,create\_file\_loop,3},
{bitcask,put,3},
{riak\_kv\_bitcask\_backend,put,3},
{riak\_kv\_vnode,perform\_put,3},
{riak\_kv\_vnode,do\_put,7},
{riak\_kv\_vnode,handle\_command,3},
{riak\_core\_vnode,vnode\_command,3},
{gen\_fsm,handle\_msg,7}]}
Offender: [{pid,&lt;0.176.0&gt;},
{name,undefined},
{mfa,
{riak\_core\_vnode,start\_link,
[riak\_kv\_vnode,
593735040165679310520246963290989976735222595584]}},
{restart\_type,temporary},
{shutdown,brutal\_kill},
{child\_type,worker}]


=CRASH REPORT==== 30-Jul-2010::14:22:35 ===
crasher:
initial call: riak\_core\_vnode:init/1
pid: &lt;0.12471.0&gt;
registered\_name: []
exception exit: {bad\_return\_value,{error,{write\_locked,emfile}}}
in function gen\_fsm:terminate/7
ancestors: [riak\_core\_vnode\_sup,riak\_core\_sup,&lt;0.98.0&gt;]
messages: []
links: [&lt;0.100.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 2584
stack\_size: 24
reductions: 1955
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:22:35 ===
Supervisor: {local,riak\_core\_vnode\_sup}
Context: child\_terminated
Reason: {bad\_return\_value,{error,{write\_locked,emfile}}}
Offender: [{pid,&lt;0.12471.0&gt;},
{name,undefined},
{mfa,
{riak\_core\_vnode,start\_link,
[riak\_kv\_vnode,
593735040165679310520246963290989976735222595584]}},
{restart\_type,temporary},
{shutdown,brutal\_kill},
{child\_type,worker}]


==&gt; erlang.log.4 &lt;==

=ERROR REPORT==== 30-Jul-2010::14:23:27 ===
\*\* Generic server memsup terminating
\*\* Last message in was {'EXIT',&lt;0.21020.78&gt;,
{emfile,
[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}}
\*\* When Server state == {state,{unix,darwin},
false,
{1897500000,7776508000},
{&lt;0.81.0&gt;,972008},
false,60000,30000,0.8,0.05,&lt;0.21020.78&gt;,
#Ref&lt;0.0.2.58535&gt;,undefined,
[reg],
[]}
\*\* Reason for termination ==
\*\* {emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd
2&gt;&1"},[stream]]},
{os,start\_port\_srv\_loop,2}]}

=ERROR REPORT==== 30-Jul-2010::14:23:27 ===
\*\* Generic server memsup terminating
\*\* Last message in was {'EXIT',&lt;0.21186.78&gt;,
{emfile,
[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}}
\*\* When Server state == {state,{unix,darwin},
false,undefined,undefined,false,60000,30000,
0.8,0.05,&lt;0.21186.78&gt;,#Ref&lt;0.0.2.58551&gt;,
undefined,
[reg],
[]}
\*\* Reason for termination ==
\*\* {emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd
2&gt;&1"},[stream]]},
{os,start\_port\_srv\_loop,2}]}

=ERROR REPORT==== 30-Jul-2010::14:23:27 ===
\*\* Generic server memsup terminating
\*\* Last message in was {'EXIT',&lt;0.21252.78&gt;,
{emfile,
[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}}
\*\* When Server state == {state,{unix,darwin},
false,undefined,undefined,false,60000,30000,
0.8,0.05,&lt;0.21252.78&gt;,#Ref&lt;0.0.2.58559&gt;,
undefined,
[reg],
[]}
\*\* Reason for termination ==
\*\* {emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd
2&gt;&1"},[stream]]},
{os,start\_port\_srv\_loop,2}]}

=ERROR REPORT==== 30-Jul-2010::14:23:27 ===
\*\* Generic server memsup terminating
\*\* Last message in was {'EXIT',&lt;0.21374.78&gt;,
{emfile,
[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}}
\*\* When Server state == {state,{unix,darwin},
false,undefined,undefined,false,60000,30000,
0.8,0.05,&lt;0.21374.78&gt;,#Ref&lt;0.0.2.58569&gt;,
undefined,
[reg],
[]}
\*\* Reason for termination ==
\*\* {emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd
2&gt;&1"},[stream]]},
{os,start\_port\_srv\_loop,2}]}

=ERROR REPORT==== 30-Jul-2010::14:23:27 ===
\*\* Generic server memsup terminating
\*\* Last message in was {'EXIT',&lt;0.21396.78&gt;,
{emfile,
[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}}
\*\* When Server state == {state,{unix,darwin},
false,undefined,undefined,false,60000,30000,
0.8,0.05,&lt;0.21396.78&gt;,#Ref&lt;0.0.2.58575&gt;,
undefined,
[reg],
[]}
\*\* Reason for termination ==
\*\* {emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd
2&gt;&1"},[stream]]},
{os,start\_port\_srv\_loop,2}]}

=ERROR REPORT==== 30-Jul-2010::14:23:27 ===
\*\* State machine &lt;0.175.0&gt; terminating
\*\* Last event in was {riak\_vnode\_req\_v1,
570899077082383952423314387779798054553098649600,
{fsm,undefined,&lt;0.12470.0&gt;},
{riak\_kv\_put\_req\_v1,
{&lt;&lt;"test.users"&gt;&gt;,&lt;&lt;"ZrAxzFghd51VG902GuCcJ2gYOMJ"&gt;&gt;},
{r\_object,&lt;&lt;"test.users"&gt;&gt;,
&lt;&lt;"ZrAxzFghd51VG902GuCcJ2gYOMJ"&gt;&gt;,
[{r\_content,
{dict,5,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],
[[&lt;&lt;"Links"&gt;&gt;,
{{&lt;&lt;"test.groups"&gt;&gt;,
&lt;&lt;"EghzXywWrGGtp2fCcSLoatIdjML"&gt;&gt;},
&lt;&lt;"groups"&gt;&gt;}]],
[],[],[],[],[],[],[],
[[&lt;&lt;"content-type"&gt;&gt;,97,112,112,108,105,99,97,
116,105,111,110,47,106,115,111,110],
[&lt;&lt;"X-Riak-VTag"&gt;&gt;,50,88,97,105,85,49,70,49,55,
54,48,71,113,115,75,103,54,102,84,56,118,84]],
[],[],
[[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|{1280,517755,638}]],
[],
[[&lt;&lt;"X-Riak-Meta"&gt;&gt;]]}}},
&lt;&lt;"{\"name\":\"bar\",\"created\_at\":\"2010-07-30T19:22:34.998Z\",\"type\":\"user\",\"version\":1}"&gt;&gt;}],
[{&lt;&lt;3,30,180,15&gt;&gt;,{1,63447736955}}],
{dict,1,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[[clean|true]],
[]}}},
undefined},
122945524,63447736955,
[{returnbody,true}]}}
\*\* When State == active
\*\* Data == {state,570899077082383952423314387779798054553098649600,
riak\_kv\_vnode,
{state,570899077082383952423314387779798054553098649600,
riak\_kv\_bitcask\_backend,
{#Ref&lt;0.0.0.598&gt;,
"data/bitcask/570899077082383952423314387779798054553098649600"},
[],false},
undefined,none}
\*\* Reason for termination =
\*\* {{badmatch,{error,emfile}},
[{bitcask\_fileops,create\_file\_loop,3},
{bitcask,put,3},
{riak\_kv\_bitcask\_backend,put,3},
{riak\_kv\_vnode,perform\_put,3},
{riak\_kv\_vnode,do\_put,7},
{riak\_kv\_vnode,handle\_command,3},
{riak\_core\_vnode,vnode\_command,3},
{gen\_fsm,handle\_msg,7}]}

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
application: os\_mon
exited: shutdown
type: permanent

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.139.0&gt;)

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.137.0&gt;)

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.144.0&gt;)

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.140.0&gt;)

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.138.0&gt;)

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.142.0&gt;)

==&gt; sasl-error.log &lt;==

=CRASH REPORT==== 30-Jul-2010::14:23:27 ===
crasher:
initial call: memsup:init/1
pid: &lt;0.52.0&gt;
registered\_name: memsup
exception exit: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
in function gen\_server:terminate/6
ancestors: [os\_mon\_sup,&lt;0.49.0&gt;]
messages: []
links: [&lt;0.50.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 2584
stack\_size: 24
reductions: 53031
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:23:27 ===
Supervisor: {local,os\_mon\_sup}
Context: child\_terminated
Reason: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
Offender: [{pid,&lt;0.52.0&gt;},
{name,memsup},
{mfa,{memsup,start\_link,[]}},
{restart\_type,permanent},
{shutdown,2000},
{child\_type,worker}]


=CRASH REPORT==== 30-Jul-2010::14:23:27 ===
crasher:
initial call: memsup:init/1
pid: &lt;0.21163.78&gt;
registered\_name: memsup
exception exit: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
in function gen\_server:terminate/6
ancestors: [os\_mon\_sup,&lt;0.49.0&gt;]
messages: []
links: [&lt;0.50.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 377
stack\_size: 24
reductions: 181
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:23:27 ===
Supervisor: {local,os\_mon\_sup}
Context: child\_terminated
Reason: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
Offender: [{pid,&lt;0.21163.78&gt;},
{name,memsup},
{mfa,{memsup,start\_link,[]}},
{restart\_type,permanent},
{shutdown,2000},
{child\_type,worker}]


=CRASH REPORT==== 30-Jul-2010::14:23:27 ===
crasher:
initial call: memsup:init/1
pid: &lt;0.21226.78&gt;
registered\_name: memsup
exception exit: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
in function gen\_server:terminate/6
ancestors: [os\_mon\_sup,&lt;0.49.0&gt;]
messages: []
links: [&lt;0.50.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 377
stack\_size: 24
reductions: 181
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:23:27 ===
Supervisor: {local,os\_mon\_sup}
Context: child\_terminated
Reason: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
Offender: [{pid,&lt;0.21226.78&gt;},
{name,memsup},
{mfa,{memsup,start\_link,[]}},
{restart\_type,permanent},
{shutdown,2000},
{child\_type,worker}]


=CRASH REPORT==== 30-Jul-2010::14:23:27 ===
crasher:
initial call: memsup:init/1
pid: &lt;0.21343.78&gt;
registered\_name: memsup
exception exit: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
in function gen\_server:terminate/6
ancestors: [os\_mon\_sup,&lt;0.49.0&gt;]
messages: []
links: [&lt;0.50.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 377
stack\_size: 24
reductions: 193
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:23:27 ===
Supervisor: {local,os\_mon\_sup}
Context: child\_terminated
Reason: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
Offender: [{pid,&lt;0.21343.78&gt;},
{name,memsup},
{mfa,{memsup,start\_link,[]}},
{restart\_type,permanent},
{shutdown,2000},
{child\_type,worker}]


=CRASH REPORT==== 30-Jul-2010::14:23:27 ===
crasher:
initial call: memsup:init/1
pid: &lt;0.21393.78&gt;
registered\_name: memsup
exception exit: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
in function gen\_server:terminate/6
ancestors: [os\_mon\_sup,&lt;0.49.0&gt;]
messages: []
links: [&lt;0.50.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 377
stack\_size: 24
reductions: 189
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:23:27 ===
Supervisor: {local,os\_mon\_sup}
Context: child\_terminated
Reason: {emfile,[{erlang,open\_port,
[{spawn,"/bin/sh -s unix:cmd 2&gt;&1"},
[stream]]},
{os,start\_port\_srv\_loop,2}]}
Offender: [{pid,&lt;0.21393.78&gt;},
{name,memsup},
{mfa,{memsup,start\_link,[]}},
{restart\_type,permanent},
{shutdown,2000},
{child\_type,worker}]


=SUPERVISOR REPORT==== 30-Jul-2010::14:23:27 ===
Supervisor: {local,os\_mon\_sup}
Context: shutdown
Reason: reached\_max\_restart\_intensity
Offender: [{pid,&lt;0.21393.78&gt;},
{name,memsup},
{mfa,{memsup,start\_link,[]}},
{restart\_type,permanent},
{shutdown,2000},
{child\_type,worker}]


=CRASH REPORT==== 30-Jul-2010::14:23:27 ===
crasher:
initial call: riak\_core\_vnode:init/1
pid: &lt;0.175.0&gt;
registered\_name: []
exception exit: {{badmatch,{error,emfile}},
[{bitcask\_fileops,create\_file\_loop,3},
{bitcask,put,3},
{riak\_kv\_bitcask\_backend,put,3},
{riak\_kv\_vnode,perform\_put,3},
{riak\_kv\_vnode,do\_put,7},
{riak\_kv\_vnode,handle\_command,3},
{riak\_core\_vnode,vnode\_command,3},
{gen\_fsm,handle\_msg,7}]}
in function gen\_fsm:terminate/7
ancestors: [riak\_core\_vnode\_sup,riak\_core\_sup,&lt;0.98.0&gt;]
messages: []
links: [#Port&lt;0.3521&gt;,&lt;0.100.0&gt;]
dictionary: []
trap\_exit: true
status: running
heap\_size: 4181
stack\_size: 24
reductions: 221476677
neighbours:

=SUPERVISOR REPORT==== 30-Jul-2010::14:23:27 ===
Supervisor: {local,riak\_core\_vnode\_sup}
Context: child\_terminated
Reason: {{badmatch,{error,emfile}},
[{bitcask\_fileops,create\_file\_loop,3},
{bitcask,put,3},
{riak\_kv\_bitcask\_backend,put,3},
{riak\_kv\_vnode,perform\_put,3},
{riak\_kv\_vnode,do\_put,7},
{riak\_kv\_vnode,handle\_command,3},
{riak\_core\_vnode,vnode\_command,3},
{gen\_fsm,handle\_msg,7}]}
Offender: [{pid,&lt;0.175.0&gt;},
{name,undefined},
{mfa,
{riak\_core\_vnode,start\_link,
[riak\_kv\_vnode,
570899077082383952423314387779798054553098649600]}},
{restart\_type,temporary},
{shutdown,brutal\_kill},
{child\_type,worker}]


==&gt; erlang.log.4 &lt;==

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.143.0&gt;)

=INFO REPORT==== 30-Jul-2010::14:23:27 ===
Spidermonkey VM host stopping (&lt;0.141.0&gt;)
{"Kernel pid
terminated",application\_controller,"{application\_terminated,os\_mon,shutdown}"}

Crash dump was written to: erl\_crash.dump
Kernel pid terminated (application\_controller)
({application\_terminated,os\_mon,shutdown})





On Jul 30, 2010, at 4:10 PM, David Smith wrote:


Given the amount of data Ken has inserted, I'd say there's a 90%
chance this problem is related to a bug I fixed earlier this week:

http://bitbucket.org/basho/bitcask/changeset/6a74d3aac4fb

But without more information, it's hard to say. I presume, Ken, you
are also seeing a vnode crash error before this happens and I'm
betting it's emfile related.

D.

On Fri, Jul 30, 2010 at 3:06 PM, Alexander Sicular &gt; wrote:

 This may be another max file handler type of error. Or maybe even
 an oom thing if the key length is large.


 On Jul 30, 2010, at 4:59 PM, Grant Schofield wrote:

 &gt; I am not sure if you hit an already fixed bug in Bitcask or not.
 What version of Riak are you running on currently?
 &gt;
 &gt; Grant Schofield
 &gt; Developer Advocate
 &gt; Basho Technologies
 &gt;
 &gt; On Jul 30, 2010, at 1:28 PM, Ken Matsumoto wrote:
 &gt;
 &gt;&gt; Hi all,
 &gt;&gt;
 &gt;&gt; I just tried to insert 1Billion data records.
 &gt;&gt; But I got the "write\_lock" error after 12Million data.
 &gt;&gt; What is the reason and how should I avoid this?
 &gt;&gt; I use bitcask (default) backend and no parameters changed in
 config file.
 &gt;&gt; 1 record is just 70B text data.
 &gt;&gt;
 &gt;&gt; Regards,
 &gt;&gt;
 &gt;&gt; Ken.
 &gt;&gt;
 &gt;&gt; --
 &gt;&gt; Ken Matsumoto
 &gt;&gt; VP / Research & Development
 &gt;&gt; Nomura Research Institute America, Inc.
 &gt;&gt; NRI Pacific
 &gt;&gt; 1400 Fashion Island Blvd., Suite 1010
 &gt;&gt; San Mateo, CA 94404, U.S.A.
 &gt;&gt;
 &gt;&gt; PLEASE READ：This e-mail is confidential and intended for the
 named recipient only. If you are not an intended recipient, please
 notify the sender and delete this e-mail.
 &gt;&gt;
 &gt;&gt;
 &gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
 &gt;&gt; riak-users mailing list
 &gt;&gt; riak-users@lists.basho.com 
 &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
 &gt;
 &gt;
 &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
 &gt; riak-users mailing list
 &gt; riak-users@lists.basho.com 
 &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


 \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
 riak-users mailing list
 riak-users@lists.basho.com 
 http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com 
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com





--
Ken Matsumoto
VP / Research & Development
Nomura Research Institute America, Inc.
NRI Pacific
1400 Fashion Island Blvd., Suite 1010
San Mateo, CA 94404, U.S.A.

PLEASE READ：This e-mail is confidential and intended for the named 
recipient only. If you are not an intended recipient, please notify the 
sender and delete this e-mail.



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

