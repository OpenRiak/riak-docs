---
title: "Re: riak kv search problem"
description: ""
project: community
lastmod: 2011-04-22T12:44:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03130"
mailinglist_parent_id: "msg03112"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2011-04-22T12:44:41-07:00
---


Hi alezozov,

I was able to perform the exact steps you described without problems:

$ curl -X PUT http://192.168.1.100:8098/riak/users/ -H "Content-Type:
application/json"
-d'{"props":{"precommit":[{"mod":"riak\_search\_kv\_hook","fun":"precommit"}]}}'

$ curl -X PUT http://192.168.1.100:8098/riak/users/test -H
"Content-Type:text/plain" -d "here are some words"

And then search using:

$ bin/search-cmd search users words

Can you check the Riak logs for errors to help me diagnose what's going on
here?

Also, what version of Search are you using? If you pulled the code from
GitHub, you may want to try downloading a package or tarball from
http://downloads.basho.com/riak-search/CURRENT/ instead.

Best,
Rusty

On Thu, Apr 21, 2011 at 4:23 AM, alezozov  wrote:

&gt; I'm trying to use auto index of bucket's objects.
&gt;
&gt; First I allow Riak to do it for some bucket
&gt;
&gt; \*curl -X PUT http://192.168.1.100:8098/riak/users/
&gt; -H "Content-Type: application/json"
&gt; -d
&gt; '{"props":{"precommit":[{"mod":"riak\_search\_kv\_hook","fun":"precommit"}]}}'
&gt; \*
&gt;
&gt; then putting some kv record in this bucket
&gt;
&gt; curl -X PUT http://192.168.1.100:8098/riak/users/test -H "Content-Type:
&gt; text/plain" -d "here are some words"
&gt;
&gt; but getting error:
&gt;
&gt; \*PUT aborted by pre-commit hook.\*
&gt;
&gt; i tried a piece of code
&gt;
&gt; require\_once 'riak.php';
&gt; $client = new Riak();
&gt; $bucket = $client-&gt;bucket('users');
&gt;
&gt; $user = $bucket-&gt;newObject('alezozov3',
&gt; array('name'=&gt;'alezozov',
&gt; 'mail'=&gt;'alezo...@mail.ru',
&gt; ));
&gt; $user-&gt;setContentType('application/json');
&gt; $user-&gt;store();
&gt;
&gt; //
&gt; //$aluser = $bucket-&gt;get('alezozov');
&gt; //if($aluser){
&gt; // if($aluser-&gt;getData()){
&gt; // print\_r($aluser-&gt;getData());
&gt; // }
&gt; // else{
&gt; // echo '0';
&gt; // }
&gt;
&gt; //}
&gt;
&gt; $results = $client-&gt;search("users", "name:alezozov")-&gt;run();
&gt; if($results){
&gt; print\_r($results);
&gt; }
&gt; else{
&gt; echo '-';
&gt; }
&gt;
&gt; but getting message :
&gt;
&gt; \*Fatal error: Uncaught exception 'Exception' with message 'Expected status
&gt; 200 or 201 or 300, received 403' in
&gt; /opt/lampp/htdocs/lib/php/riak\_lib.php:1206 Stack trace: #0
&gt; /opt/lampp/htdocs/lib/php/riak\_lib.php(1102): RiakObject-&gt;populate(Array,
&gt; Array) #1 /opt/lampp/htdocs/test/index.php(15): RiakObject-&gt;store() #2
&gt; {main} thrown in /opt/lampp/htdocs/lib/php/riak\_lib.php on line 1206\*
&gt;
&gt; but if I don't use
&gt;
&gt; \*url -X PUT http://192.168.1.100:8098/riak/users/
&gt; -H "Content-Type: application/json"
&gt; -d
&gt; '{"props":{"precommit":[{"mod":"riak\_search\_kv\_hook","fun":"precommit"}]}}
&gt; \*'
&gt;
&gt; everything ok, and I can store and get objects, with command line and php
&gt; code, but of cource can't search
&gt;
&gt; what I doing wrong ? where to dig?
&gt;
&gt; thanks.
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

