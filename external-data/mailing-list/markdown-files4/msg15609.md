---
title: "Re: adding nodes to cluster"
description: ""
project: community
lastmod: 2015-01-29T06:45:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15609"
mailinglist_parent_id: "msg15562"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2015-01-29T06:45:37-08:00
---


I just closed https://github.com/basho/riak/issues/667

riak-2.0.5 will address it

Thanks for the report and sorry for the inconvenience.

On 21 Jan 2015, at 19:28, Alexander Popov  wrote:

&gt; Actually, problematic node is production. but when shit happens i was migrate 
&gt; all data ( export/import) to clean setup.
&gt; so i can experiment with old node.
&gt; It have not source installation, from package.
&gt; I will try compile it tomorrow. 
&gt; 
&gt; On Wed, Jan 21, 2015 at 9:01 PM, Russell Brown  wrote:
&gt; There’s a branch of riak\_dt here https://github.com/basho/riak\_dt/pull/111
&gt; 
&gt; Since you’re running against a source install (I assume in development, or 
&gt; test?) would you be so kind as to try this branch and see if it solves your 
&gt; issue?
&gt; 
&gt; Many thanks
&gt; 
&gt; Russell
&gt; 
&gt; On 20 Jan 2015, at 15:12, Alexander Popov  wrote:
&gt; 
&gt; &gt; Thanks.
&gt; &gt;
&gt; &gt; On Tue, Jan 20, 2015 at 5:07 PM, Russell Brown  wrote:
&gt; &gt; FYI https://github.com/basho/riak/issues/667
&gt; &gt;
&gt; &gt; I’ll get to work on it at once, we might be able to hit the 2.0.5 build 
&gt; &gt; date at the end of the week.
&gt; &gt;
&gt; &gt; On 20 Jan 2015, at 14:04, Russell Brown  wrote:
&gt; &gt;
&gt; &gt; &gt; I’ll open a ticket for it. We changed the internal structure of both Maps 
&gt; &gt; &gt; and Sets, and tested that they were backwards compatible, but clearly 
&gt; &gt; &gt; missed something.
&gt; &gt; &gt;
&gt; &gt; &gt; On 20 Jan 2015, at 13:54, Alexander Popov  wrote:
&gt; &gt; &gt;
&gt; &gt; &gt;&gt; Upgraded riak 2.0.2-&gt; 2.0.4
&gt; &gt; &gt;&gt; trying to add nodes to cluster( was single node )
&gt; &gt; &gt;&gt; all new nodes located on another host, but multi-nodes installation from 
&gt; &gt; &gt;&gt; source
&gt; &gt; &gt;&gt; each new node have config settings tuned like
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; nodename = riak1@10.0.0.28
&gt; &gt; &gt;&gt; platform\_data\_dir = /var/lib/riak1
&gt; &gt; &gt;&gt; listener.http.internal = 0.0.0.0:18098
&gt; &gt; &gt;&gt; listener.protobuf.internal = 0.0.0.0:18087
&gt; &gt; &gt;&gt; handoff.port = 18099
&gt; &gt; &gt;&gt; search.solr.port = 18093
&gt; &gt; &gt;&gt; search.solr.jmx\_port = 18985
&gt; &gt; &gt;&gt; search=on
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; after adding this nodes to cluster for long time was nothing was 
&gt; &gt; &gt;&gt; transferred for new nodes.
&gt; &gt; &gt;&gt; I was down this nodes and force-remove it from cluster.
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; After this strange things happens.
&gt; &gt; &gt;&gt; On new nodes:
&gt; &gt; &gt;&gt; Even after restart cleaning entire data dir and start again, in folder 
&gt; &gt; &gt;&gt; yz indexes somehow appears again.
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; logs contains only
&gt; &gt; &gt;&gt; 2015-01-20 13:15:04.815 [info] &lt;0.352.0&gt;@riak\_core:wait\_for\_service:483 
&gt; &gt; &gt;&gt; Wait complete for service riak\_kv (10 seconds)
&gt; &gt; &gt;&gt; 2015-01-20 13:15:06.660 [info] &lt;0.547.0&gt;@yz\_index:local\_create:189 
&gt; &gt; &gt;&gt; Created index contacts\_index with schema contacts
&gt; &gt; &gt;&gt; 2015-01-20 13:15:08.683 [info] &lt;0.547.0&gt;@yz\_index:local\_create:189 
&gt; &gt; &gt;&gt; Created index users\_index with schema users
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; Main Node now have bunch of errors on start and periodically after:
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; 015-01-20 13:29:00.382 [error] 
&gt; &gt; &gt;&gt; &lt;0.871.0&gt;@riak\_core\_vnode:vnode\_command:348 riak\_kv\_vnode command failed 
&gt; &gt; &gt;&gt; {{badrecord,dict},[{dict,filter\_dict,2,[{file,"dict.erl"},{line,464}]},{riak\_dt\_map,'-filter\_unique/4-fun-1-',4,[{file,"src/ria
&gt; &gt; &gt;&gt; k\_dt\_map.erl"},{line,466}]},{sets,fold\_bucket,3,[{file,"sets.erl"},{line,313}]},{sets,fold\_seg,4,[{file,"sets.erl"},{line,309}]},{sets,fold\_segs,4,[{file,"sets.erl"},{line,305}]},{riak\_dt\_map,merge,2,[{file,"src/riak\_dt\_map.erl"},{l
&gt; &gt; &gt;&gt; ine,454}]},{riak\_kv\_crdt,'-merge\_value/2-fun-0-',5,[{file,"src/riak\_kv\_crdt.erl"},{line,204}]},{orddict,update,4,[{file,"orddict.erl"},{line,170}]}]}
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.382 [error] 
&gt; &gt; &gt;&gt; &lt;0.650.0&gt;@riak\_core\_vnode:vnode\_command:348 riak\_kv\_vnode command failed 
&gt; &gt; &gt;&gt; {{badrecord,dict},[{dict,filter\_dict,2,[{file,"dict.erl"},{line,464}]},{riak\_dt\_map,'-filter\_unique/4-fun-1-',4,[{file,"src/ria
&gt; &gt; &gt;&gt; k\_dt\_map.erl"},{line,466}]},{sets,fold\_bucket,3,[{file,"sets.erl"},{line,313}]},{sets,fold\_seg,4,[{file,"sets.erl"},{line,309}]},{sets,fold\_segs,4,[{file,"sets.erl"},{line,305}]},{riak\_dt\_map,merge,2,[{file,"src/riak\_dt\_map.erl"},{l
&gt; &gt; &gt;&gt; ine,454}]},{riak\_kv\_crdt,'-merge\_value/2-fun-0-',5,[{file,"src/riak\_kv\_crdt.erl"},{line,204}]},{orddict,update,4,[{file,"orddict.erl"},{line,170}]}]}
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.383 [error] &lt;0.4520.0&gt; gen\_fsm &lt;0.4520.0&gt; in state 
&gt; &gt; &gt;&gt; waiting\_local\_vnode terminated with reason: no case clause matching 
&gt; &gt; &gt;&gt; {vnode\_error,{{badrecord,dict},[{dict,filter\_dict,2,[{file,"dict.erl"},{line,464}]},{riak\_dt\_
&gt; &gt; &gt;&gt; map,'-filter\_unique/4-fun-1-',4,[{file,"src/riak\_dt\_map.erl"},{line,466}]},{sets,fold\_bucket,3,[{file,"sets.erl"},{line,313}]},{sets,fold\_seg,4,[{file,"sets.erl"},{line,309}]},{sets,fold\_segs,4,[{file,"sets.erl"},{line,305}]},{riak\_
&gt; &gt; &gt;&gt; dt\_map,merge,2,[{file,"src/riak\_dt\_map.erl"},{line,454}]},{riak\_kv\_crdt,'-merge\_value/2-fun-0-',5,[{file,"src/riak\_kv\_crdt.erl"},{line,204}]},{orddict,update,4,[{file,"or..."},...]}]}}
&gt; &gt; &gt;&gt; in riak\_kv\_put\_fsm:waiting\_local\_vnode/2 line 5
&gt; &gt; &gt;&gt; 67
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.384 [error] &lt;0.4520.0&gt; CRASH REPORT Process 
&gt; &gt; &gt;&gt; &lt;0.4520.0&gt; with 0 neighbours exited with reason: no case clause matching 
&gt; &gt; &gt;&gt; {vnode\_error,{{badrecord,dict},[{dict,filter\_dict,2,[{file,"dict.erl"},{line,464}]},{riak\_dt\_ma
&gt; &gt; &gt;&gt; p,'-filter\_unique/4-fun-1-',4,[{file,"src/riak\_dt\_map.erl"},{line,466}]},{sets,fold\_bucket,3,[{file,"sets.erl"},{line,313}]},{sets,fold\_seg,4,[{file,"sets.erl"},{line,309}]},{sets,fold\_segs,4,[{file,"sets.erl"},{line,305}]},{riak\_dt
&gt; &gt; &gt;&gt; \_map,merge,2,[{file,"src/riak\_dt\_map.erl"},{line,454}]},{riak\_kv\_crdt,'-merge\_value/2-fun-0-',5,[{file,"src/riak\_kv\_crdt.erl"},{line,204}]},{orddict,update,4,[{file,"or..."},...]}]}}
&gt; &gt; &gt;&gt; in riak\_kv\_put\_fsm:waiting\_local\_vnode/2 line 567
&gt; &gt; &gt;&gt; in gen\_fsm:terminate/7 line 622
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.384 [error] &lt;0.4521.0&gt; gen\_fsm &lt;0.4521.0&gt; in state 
&gt; &gt; &gt;&gt; waiting\_local\_vnode terminated with reason: no case clause matching 
&gt; &gt; &gt;&gt; {vnode\_error,{{badrecord,dict},[{dict,filter\_dict,2,[{file,"dict.erl"},{line,464}]},{riak\_dt\_
&gt; &gt; &gt;&gt; map,'-filter\_unique/4-fun-1-',4,[{file,"src/riak\_dt\_map.erl"},{line,466}]},{sets,fold\_bucket,3,[{file,"sets.erl"},{line,313}]},{sets,fold\_seg,4,[{file,"sets.erl"},{line,309}]},{sets,fold\_segs,4,[{file,"sets.erl"},{line,305}]},{riak\_
&gt; &gt; &gt;&gt; dt\_map,merge,2,[{file,"src/riak\_dt\_map.erl"},{line,454}]},{riak\_kv\_crdt,'-merge\_value/2-fun-0-',5,[{file,"src/riak\_kv\_crdt.erl"},{line,204}]},{orddict,update,4,[{file,"or..."},...]}]}}
&gt; &gt; &gt;&gt; in riak\_kv\_put\_fsm:waiting\_local\_vnode/2 line 5
&gt; &gt; &gt;&gt; 67
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.384 [error] &lt;0.4521.0&gt; CRASH REPORT Process 
&gt; &gt; &gt;&gt; &lt;0.4521.0&gt; with 0 neighbours exited with reason: no case clause matching 
&gt; &gt; &gt;&gt; {vnode\_error,{{badrecord,dict},[{dict,filter\_dict,2,[{file,"dict.erl"},{line,464}]},{riak\_dt\_ma
&gt; &gt; &gt;&gt; p,'-filter\_unique/4-fun-1-',4,[{file,"src/riak\_dt\_map.erl"},{line,466}]},{sets,fold\_bucket,3,[{file,"sets.erl"},{line,313}]},{sets,fold\_seg,4,[{file,"sets.erl"},{line,309}]},{sets,fold\_segs,4,[{file,"sets.erl"},{line,305}]},{riak\_dt
&gt; &gt; &gt;&gt; \_map,merge,2,[{file,"src/riak\_dt\_map.erl"},{line,454}]},{riak\_kv\_crdt,'-merge\_value/2-fun-0-',5,[{file,"src/riak\_kv\_crdt.erl"},{line,204}]},{orddict,update,4,[{file,"or..."},...]}]}}
&gt; &gt; &gt;&gt; in riak\_kv\_put\_fsm:waiting\_local\_vnode/2 line 567
&gt; &gt; &gt;&gt; in gen\_fsm:terminate/7 line 622
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.385 [error] &lt;0.871.0&gt; gen\_fsm &lt;0.871.0&gt; in state 
&gt; &gt; &gt;&gt; active terminated with reason: bad record dict in dict:filter\_dict/2 
&gt; &gt; &gt;&gt; line 464
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.385 [error] &lt;0.871.0&gt; CRASH REPORT Process &lt;0.871.0&gt; 
&gt; &gt; &gt;&gt; with 1 neighbours exited with reason: bad record dict in 
&gt; &gt; &gt;&gt; dict:filter\_dict/2 line 464 in gen\_fsm:terminate/7 line 622
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.385 [error] &lt;0.167.0&gt; Supervisor riak\_core\_vnode\_sup 
&gt; &gt; &gt;&gt; had child undefined started with {riak\_core\_vnode,start\_link,undefined} 
&gt; &gt; &gt;&gt; at &lt;0.871.0&gt; exit with reason bad record dict in dict:filter\_dict/2 line 
&gt; &gt; &gt;&gt; 464 in context
&gt; &gt; &gt;&gt; child\_terminated
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.385 [error] &lt;0.988.0&gt; gen\_fsm &lt;0.988.0&gt; in state 
&gt; &gt; &gt;&gt; ready terminated with reason: bad record dict in dict:filter\_dict/2 line 
&gt; &gt; &gt;&gt; 464
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.385 [error] &lt;0.988.0&gt; CRASH REPORT Process &lt;0.988.0&gt; 
&gt; &gt; &gt;&gt; with 10 neighbours exited with reason: bad record dict in 
&gt; &gt; &gt;&gt; dict:filter\_dict/2 line 464 in gen\_fsm:terminate/7 line 622
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.385 [error] &lt;0.650.0&gt; gen\_fsm &lt;0.650.0&gt; in state 
&gt; &gt; &gt;&gt; active terminated with reason: bad record dict in dict:filter\_dict/2 
&gt; &gt; &gt;&gt; line 464
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.650.0&gt; CRASH REPORT Process &lt;0.650.0&gt; 
&gt; &gt; &gt;&gt; with 1 neighbours exited with reason: bad record dict in 
&gt; &gt; &gt;&gt; dict:filter\_dict/2 line 464 in gen\_fsm:terminate/7 line 622
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.989.0&gt; Supervisor 
&gt; &gt; &gt;&gt; {&lt;0.989.0&gt;,poolboy\_sup} had child riak\_core\_vnode\_worker started with 
&gt; &gt; &gt;&gt; riak\_core\_vnode\_worker:start\_link([{worker\_module,riak\_core\_vnode\_worker},{worker\_args,[593735040165679310520
&gt; &gt; &gt;&gt; 246963290989976735222595584,...]},...]) at undefined exit with reason 
&gt; &gt; &gt;&gt; bad record dict in dict:filter\_dict/2 line 464 in context shutdown\_error
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.989.0&gt; gen\_server &lt;0.989.0&gt; 
&gt; &gt; &gt;&gt; terminated with reason: bad record dict in dict:filter\_dict/2 line 464
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.989.0&gt; CRASH REPORT Process &lt;0.989.0&gt; 
&gt; &gt; &gt;&gt; with 0 neighbours exited with reason: bad record dict in 
&gt; &gt; &gt;&gt; dict:filter\_dict/2 line 464 in gen\_server:terminate/6 line 744
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.167.0&gt; Supervisor riak\_core\_vnode\_sup 
&gt; &gt; &gt;&gt; had child undefined started with {riak\_core\_vnode,start\_link,undefined} 
&gt; &gt; &gt;&gt; at &lt;0.650.0&gt; exit with reason bad record dict in dict:filter\_dict/2 line 
&gt; &gt; &gt;&gt; 464 in context
&gt; &gt; &gt;&gt; child\_terminated
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.696.0&gt; gen\_fsm &lt;0.696.0&gt; in state 
&gt; &gt; &gt;&gt; ready terminated with reason: bad record dict in dict:filter\_dict/2 line 
&gt; &gt; &gt;&gt; 464
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.696.0&gt; CRASH REPORT Process &lt;0.696.0&gt; 
&gt; &gt; &gt;&gt; with 10 neighbours exited with reason: bad record dict in 
&gt; &gt; &gt;&gt; dict:filter\_dict/2 line 464 in gen\_fsm:terminate/7 line 622
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.702.0&gt; Supervisor 
&gt; &gt; &gt;&gt; {&lt;0.702.0&gt;,poolboy\_sup} had child riak\_core\_vnode\_worker started with 
&gt; &gt; &gt;&gt; riak\_core\_vnode\_worker:start\_link([{worker\_module,riak\_core\_vnode\_worker},{worker\_args,[228359630832953580969
&gt; &gt; &gt;&gt; 325755111919221821239459840,...]},...]) at undefined exit with reason 
&gt; &gt; &gt;&gt; bad record dict in dict:filter\_dict/2 line 464 in context shutdown\_error
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.702.0&gt; gen\_server &lt;0.702.0&gt; 
&gt; &gt; &gt;&gt; terminated with reason: bad record dict in dict:filter\_dict/2 line 464
&gt; &gt; &gt;&gt; 2015-01-20 13:29:00.386 [error] &lt;0.702.0&gt; CRASH REPORT Process &lt;0.702.0&gt; 
&gt; &gt; &gt;&gt; with 0 neighbours exited with reason: bad record dict in 
&gt; &gt; &gt;&gt; dict:filter\_dict/2 line 464 in gen\_server:terminate/6 line 744
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; any advice?
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt;&gt; riak-users mailing list
&gt; &gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

