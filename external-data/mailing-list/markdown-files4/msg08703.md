---
title: "Re: Pruning (merging) after storage reaches a certain size?"
description: ""
project: community
lastmod: 2012-09-26T08:05:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08703"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2012-09-26T08:05:12-07:00
---


The only other time I've seen this documented is in a thread from 2011
about pruning (merging) after deletes. Here's the message in question in
case any historians are lurking:
http://markmail.org/message/4nakwhixkw3jcxvi
---
Jeremiah Peschka
Managing Director, Brent Ozar PLF, LLC


On Thu, Jul 28, 2011 at 9:18 AM, Steve Webb  wrote:

&gt; Just to be clear ...
&gt;
&gt; If I made the max\_file\_size small, and set the expire\_secs value to
&gt; something small, but never explicitly delete anything, the non-active files
&gt; will be considered for merging (and will prune any expired data) just
&gt; because they are inactive and don't trigger any other merge-detection
&gt; criteria?
&gt;
&gt; If not, how would I configure riak as a system that I could continuously
&gt; insert data into and always just have the last days worth of data or so?
&gt;
&gt;
&gt; - Steve
&gt;
&gt; --
&gt; Steve Webb - Senior System Administrator for gnip.com
&gt; http://twitter.com/GnipWebb
&gt;
&gt; On Mon, 13 Jun 2011, Justin Sheehy wrote:
&gt;
&gt; Hi, Steve.
&gt;&gt;
&gt;&gt; The key to your situation was in my earlier email:
&gt;&gt;
&gt;&gt; One note that is relevant for your specific use: the expiry\_secs
&gt;&gt; parameter will cause a given item to disappear from the client
&gt;&gt; API immediately after expiry, and to be cleaned if it is in a file
&gt;&gt; already being merged, but will not currently contribute toward
&gt;&gt; merge triggers or thresholds on its own if not otherwise "dead".
&gt;&gt;
&gt;&gt; That is, bitcask wasn't originally designed around the expiry-centric
&gt;&gt; way of removing old data, and data that has simply expired (but not
&gt;&gt; actively been deleted) will not be counted as garbage toward
&gt;&gt; thresholds or triggers at this time. It will be cleaned up in a
&gt;&gt; merge, but will not contribute toward causing the merge in the first
&gt;&gt; place. In a use case where you only add items and never actually
&gt;&gt; delete anything, a merge will never be dynamically triggered.
&gt;&gt;
&gt;&gt; It is plausible that we could add some expiry-statistics measurement
&gt;&gt; and triggering to bitcask, but today that's the state of things. You
&gt;&gt; could manually trigger merges, but that currently requires a bit of
&gt;&gt; Erlang.
&gt;&gt;
&gt;&gt; I hope that this helps.
&gt;&gt;
&gt;&gt; -Justin
&gt;&gt;
&gt;&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

