---
title: "Re: Deleting a strongly consistent key"
description: ""
project: community
lastmod: 2015-01-09T09:58:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15461"
mailinglist_parent_id: "msg15450"
author_name: "Drew Pirrone-Brusse"
project_section: "mailinglistitem"
sent_date: 2015-01-09T09:58:42-08:00
---


Hello Zsolt,

Whether or not it is correct or valuable for you to use delete
operations is (as with many features of Riak) largely dependent on
your use-case. Deletes in the strongly consistent mode are much less
valuable than deletes in the eventually consistent mode because keys
are never reaped from strongly consistent buckets. You might be able
to reclaim some disk space with a strongly consistent delete by
shrinking the size of the stored value, but that key will never be
removed from the system. The next time a GET is performed for that
key, the return value should look like the return value for a key that
never existed though, so if those are the semantics you're after it
might still be correct to delete keys.

I hope that answered your question.
Best,
-Drew


On Fri, Jan 9, 2015 at 4:55 AM, Zsolt Laky  wrote:
&gt; Hello Drew,
&gt;
&gt; Thinking through the delete operation on a strong consistent bucket, a
&gt; question popped up for me.
&gt;
&gt; Should not we use delete\_object instead to keep strong consistency? The
&gt; delete function takes a key and does not care about the current state/value
&gt; of the object itself. If in the meantime another process changes the value
&gt; of an object, delete will simply delete it. So is there a benefit using
&gt; delete on strongly consistent bucket other than swipe the bucket not caring
&gt; about other processes store their state info?
&gt;
&gt; Thanks for your thoughts,
&gt; Zsolt
&gt;
&gt; -----Eredeti üzenet-----
&gt; Feladó: riak-users [mailto:riak-users-boun...@lists.basho.com] Meghatalmazó
&gt; Drew Pirrone-Brusse
&gt; Küldve: Thursday, January 08, 2015 12:32 AM
&gt; Címzett: Igor Birman
&gt; Másolatot kap: riak-users@lists.basho.com
&gt; Tárgy: Re: Deleting a strongly consistent key
&gt;
&gt; Hello Igor,
&gt;
&gt; Deletions should be a strongly consistent operation, yes. If after a
&gt; successful strongly consistent delete a GET of that key returns stale data
&gt; something is likely wrong, be it with your application, the cluster, or Riak
&gt; itself.
&gt;
&gt; That said, deletions don't actually remove keys from Riak. Strongly
&gt; consistent deletions should behave identically to conditional PUTs, where
&gt; the value put is a tombstone. When Riak is running in an eventually
&gt; consistent mode, those tombstones are (sometimes) eventually harvested and
&gt; removed from disk. In the strongly consistent mode (as with `delete\_mode =
&gt; keep`) Riak will never harvest those tombstones, so they will remain on disk
&gt; indefinitely.
&gt; Our documentation has lots of good information, if you're looking for some
&gt; implementation details[1].
&gt;
&gt; Generally speaking, if you know you're going to immediately re-use a key,
&gt; it's better to simply overwrite values than issuing an intermittent delete.
&gt;
&gt; Best regards,
&gt; -Drew
&gt;
&gt; [1]:
&gt; http://docs.basho.com/riak/latest/ops/advanced/strong-consistency/#Implement
&gt; ation-Details
&gt;
&gt; On Wed, Jan 7, 2015 at 10:01 AM, Igor Birman  wrote:
&gt;&gt; Is deleting a strongly consistent key a consistent operation? I have
&gt;&gt; found in testing that if I delete a key and then attempt to
&gt;&gt; immediately reuse it, sometimes the delete completes after I have
&gt;&gt; reused it. Should I expect that when I get a 204 from a delete that I
&gt;&gt; can immediately create a new key with the same id?
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; ---
&gt; This email has been checked for viruses by Avast antivirus software.
&gt; http://www.avast.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

