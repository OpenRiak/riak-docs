---
title: "Re: riak sizing considerations"
description: ""
project: community
lastmod: 2012-01-25T14:23:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06417"
mailinglist_parent_id: "msg06386"
author_name: "Ian Plosker"
project_section: "mailinglistitem"
sent_date: 2012-01-25T14:23:20-08:00
---


Sebastian,

With all requests, Riak will attempt to read or write to all replicas 
regardless of the specified r or w value. The r and w values affect how many 
reads from or writes to partitions must be completed before the operation is 
considered successful.

As a result, the get (read) and put (write) handlers outlive the client 
request. They will continue to wait for either all vnodes (replicas/partitions) 
to respond or for the 60 timeout to elapse. As such, network traffic after a 
large number of reads with r=1 shouldn't be surprising, the request handlers 
are continuing to await responses from vnodes who are working through their 
request queues.

On modest hardware, I've seen Riak clusters perform multiples of 500 ops per 
second. I'm curious, what are you using to perform your benchmark? Does it 
perform requests in parallel? Are requests being made to all nodes in the 
cluster or just one? To find your maximum throughput, you should experiment 
with various ratios of parallel request per node.

Hope that helps. 

-- 
Ian Plosker 
Developer Advocate
Basho Technologies


On Tuesday, January 24, 2012 at 5:21 AM, Sebastian Gerlach wrote:

&gt; Dear Riak-Users,
&gt; 
&gt; we consider to save a large amount (50000000) of binary Data (Images) in
&gt; a riak cluster. Each image has a size of 648 KB. We want to store 3
&gt; copy's of each image.
&gt; 
&gt; In this case i need to store 50000000 \* 648 KB \* 3 = 90.5 TB Data. This
&gt; calculation didn't include any overhead for reorganisation and other stuff.
&gt; 
&gt; On the other hand is the network. I run some benchmarks on a 4 node
&gt; cluster. Each with a 1 Gbps interface. In addition to the benchmarks
&gt; I've made some calculations.
&gt; 
&gt; Some information for the benchmark:
&gt; - I use the same interface for clustercommunication and benchmarking.
&gt; - I use the riak http api interface
&gt; - time curl -s
&gt; HTTP://interface:8098/buckets/test-01/keys/[10001-20000].jpg &gt; /dev/null
&gt; 
&gt; In theory, a 1 Gbps interface provides 125 MB per second. In my
&gt; calculation i only use 50 percent of the theoretically available
&gt; bandwidth. This fit very well to my benchmarks.
&gt; 
&gt; I try a while with the '{"props":{"r":X}}'.
&gt; 
&gt; Calculation “r=2”
&gt; available bandwidth = 62.5 MB per second / (3\*648 KB) = 33 requests per
&gt; second per node = 132 requests per second over the cluster.
&gt; 
&gt; Calculation “r=1”
&gt; available bandwidth = 62.5 MB per second / (2\*648 KB) = 50 requests per
&gt; second per node = 200 requests per second over the cluster.
&gt; 
&gt; In this second case i see some strange effects in the network. My send
&gt; and received queues grow verry fast. And after finishing the benchmark
&gt; there is a while a lot of traffic between the riak nodes.
&gt; 
&gt; Does anyone have experience with these data sets and can give a few
&gt; hints at a possible setup? The goal is to processed at least 500
&gt; requests per second.
&gt; 
&gt; Some other points in my considerations are the time required for a
&gt; reorganization after a new node are added to the cluster or a node has
&gt; been replaced.
&gt; 
&gt; Many thanks for your reply and your attention.
&gt; 
&gt; Kind regards
&gt; Sebastian
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

