---
title: "Re: riak-cs fails to start after reimporting Docker container"
description: ""
project: community
lastmod: 2017-03-08T07:01:01-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18073"
mailinglist_parent_id: "msg18057"
author_name: "Jon Brisbin"
project_section: "mailinglistitem"
sent_date: 2017-03-08T07:01:01-08:00
---


FWIW- All work done so far on Riak-in-Docker is for purposes of testing and
ad-hoc cluster creation and NOT for use in "production" environments (for
any definition of the word "production"). Things like exposing the conf
files on a volume which are more production-oriented haven't been in scope
of the work yet; providing a self-contained image that can be bootstrapped
OOTB has been the focus. That said, we're definitely discussing how we
might support Docker in a more robust way. There's lots to do, beyond just
initial config and data on volumes. There's the IP addressing and
networking issues of bridges to consider, among other things.

Might be good to make sure this info is encapsulated into a GitHub issue so
we don't loose track of it.

jb

On Wed, Mar 8, 2017 at 8:16 AM Jean-Marc Le Roux 
wrote:

&gt; Hello,
&gt;
&gt; I finally found the problem : the riak and riak-cs config files where
&gt; stored in my app container, not in my persistent data container (where the
&gt; riak data is).
&gt; Whenever I upgraded the app container to a newly generated one, the conf
&gt; files and especially the admin user credentials did not match.
&gt;
&gt; Yet, two things are rather surprising :
&gt;
&gt; - AFAIK all the provided riak + Docker examples did not bother to
&gt; properly store those conf files in a Docker volume, so they suffer from the
&gt; same problem and cannot be used as is ;
&gt; - IMHO the riak-cs error is completely misleading and useless :
&gt; "notfound" should be "admin\_user\_not\_found" or "invalid\_admin\_user".
&gt;
&gt; Please feel free to ask me any question so that I can help understanding
&gt; this and fix this misleading and - quite frankly completely useless -
&gt; "notfound" error message.
&gt;
&gt; I hope this helps.
&gt;
&gt; Regards,
&gt;
&gt; 2017-03-08 15:04 GMT+01:00 Luca Favatella &lt;
&gt; luca.favate...@erlang-solutions.com&gt;:
&gt;
&gt; On 6 March 2017 at 03:49, Toby Corkindale  wrote:
&gt; &gt;
&gt; &gt; I tried quite hard to get Riak to work reliably in a Docker container,
&gt; in a long-term-use kind of way.
&gt; &gt; Riak would never shutdown cleanly, though, and so at startup there would
&gt; always be lots of lock files left around that had to be deleted first.
&gt; &gt;
&gt; &gt; Riak is not well-behaved after a rough shutdown -- whether in a Docker
&gt; container, or running on bare metal. Tends to require sysadmin intervention
&gt; to clean things up.
&gt; &gt;
&gt; &gt; If you're running it in a Docker container, you need to figure out a way
&gt; to capture the incoming SIGTERM and then use that to shutdown Riak cleanly.
&gt; I never got that far.
&gt;
&gt; Hi,
&gt;
&gt; FYI
&gt;
&gt; I opened a ticket for tracking wish to use SIGTERM for stopping Riak KV:
&gt; https://github.com/basho/riak/issues/899
&gt;
&gt;
&gt; Thanks for sharing your experiences.
&gt;
&gt; Regards
&gt; Luca
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; \*Jean-Marc Le Roux\*
&gt;
&gt;
&gt; Founder and CEO of Aerys (http://aerys.in)
&gt;
&gt; Blog: http://blogs.aerys.in/jeanmarc-leroux
&gt; Cell: (+33)6 20 56 45 78 &lt;+33%206%2020%2056%2045%2078&gt;
&gt; Phone: (+33)9 72 40 17 58 &lt;+33%209%2072%2040%2017%2058&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

