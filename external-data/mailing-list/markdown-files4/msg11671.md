---
title: "Re: Comparing Riak MapReduce and Hadoop MapReduce"
description: ""
project: community
lastmod: 2013-07-21T20:21:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11671"
mailinglist_parent_id: "msg11652"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-07-21T20:21:26-07:00
---


Responses inline. Hopefully they shed some light on the subject.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Fri, Jul 19, 2013 at 5:07 PM, Xiaoming Gao  wrote:

&gt; Hi everyone,
&gt;
&gt; I am trying to learn about Riak MapReduce and comparing it with Hadoop
&gt; MapReduce, and there are some details that I am interested in but not
&gt; covered in the online documents. So hopefully we can get some help here
&gt; about the following questions? Thanks in advance!
&gt;

They're not at all similar. Hadoop MR is optimized for sequential data
processing in large batches. Riak MR works better when you think of it like
a multi-processing engine - you can perform work across a matching set of
items and that work will be distributed across the cluster during map
phases.

Take a look at this thread for a bit of discussion about when you should
use Riak MapReduce: http://markmail.org/message/qpoilvmm635inb5v

Or, if you want to, you can run a Riak MR job across an entire bucket,
which really is like scanning every table in an RDBMS while looking for
rows from a single table. MR jobs run with an R of 1. So, at least there's
that.


&gt; 1. For a given MapReduce request (or to say, job), how does Riak decide how
&gt; many mappers to use for the job? For example, if I have 8 nodes and my data
&gt; are distributed across all nodes with an "N" value of 2, will I have 4
&gt; mappers running on 4 nodes concurrently? Is it possible to have multiple
&gt; mappers (e.g., 4 or even 6) for the same MR job running on each node (for
&gt; better processing speed)?
&gt;

To the best of my recollection, this will be based on either:

1) If you're using JavaScript MR jobs, the number of mappers and reducers
is controlled by the the map\_js\_vm\_count and reduce\_js\_vm\_count settings
from each node's app.config file.
2) If you're using Erlang: magic. This will be handled by the Erlang VM and
is based on number of processors and your overall Erlang VM configuration.


&gt;
&gt; 2. If I run a MapReduce job over the results of a Riak Search query, how
&gt; does Riak schedule the mappers based on the search results?
&gt;

Riak Search uses document-based indices - search will query every node in
the cluster. Map phases happen and then results are then streamed to the
reducer.


&gt;
&gt; 3. How does Riak handle intermediate data generated by mappers?
&gt; Specifically:
&gt; (1) In Hadoop MapReduce, the output of mappers are  pairs, and
&gt; the output from all mappers are first grouped based on keys, and then
&gt; handed
&gt; over to the reducer. Does Riak do similar grouping of intermediate data?
&gt;

The only reason for the intermediate grouping/scratch work in Hadoop MR
jobs is to deal with multiple reducers. Although, I'm not entirely sure how
this works in Riak, my suspicion is that data is streamed across the wire
after the data is read from disk.


&gt;
&gt; (2) How are mapper outputs transmitted to the reducer? Does Riak use local
&gt; disks on the mapper nodes or reducer nodes to store the intermediate data
&gt; temporarily?


Since large MR jobs can cause out of memory errors, you can bet good money
that the answer is "no".


&gt;
&gt; 4. According to the document
&gt; http://docs.basho.com/riak/latest/dev/advanced/mapreduce/#How-Phases-Work,
&gt; each MR job only schedules one reducer, which runs on the coordinate node.
&gt; Is there any way to configure a MR job to use multiple reducers?
&gt;

Using Riak MR, there's no way to create a job that runs reducers on
multiple nodes. You can have multiple reducer processes on a single node,
but not reducers on multiple nodes.


&gt;
&gt; Best regards,
&gt; Xiaoming
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/Comparing-Riak-MapReduce-and-Hadoop-MapReduce-tp4028454.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

