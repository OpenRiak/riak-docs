---
title: "Re: RiakCS poor s3 upload speeds 2MB/s"
description: ""
project: community
lastmod: 2015-01-20T20:23:40-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15537"
mailinglist_parent_id: "msg15536"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2015-01-20T20:23:40-08:00
---


Hi Toby -

Are you using the stock bitcask configuration for merging?

--
Luke Bakken
Engineer
lbak...@basho.com

On Tue, Jan 20, 2015 at 5:07 PM, Toby Corkindale  wrote:
&gt; Hi Kota,
&gt; I had a bit of an off-list chat about this a while ago, plus continued
&gt; to investigate locally, and eventually achieved some faster speeds,
&gt; around 15MByte/sec writes.
&gt; Things that were changed:
&gt; \* Adjusted Riak CS GC to be spread out over the cluster much more.
&gt; \* Tweaked up the put buffers and concurrency further
&gt; \* Moved most of the files out of CS and into Amazon S3+Glacier
&gt; \* Switched from nginx to haproxy
&gt; \* simplified firewalling for internal clients
&gt;
&gt; Each one of those changes made a small to modest improvement, but
&gt; overall combined to make a quite noticeable improvement.
&gt;
&gt; I did notice something odd though -- despite moving most of the data
&gt; out of the cluster, the disk-space-in-use by Riak is still very large
&gt; compared to the amount stored. I mean, we moved more than 90% of the
&gt; data out of the cluster, yet the actual disk space used only halved.
&gt; For every gigabyte of file stored in CS, dozens of gigabytes are
&gt; actually on disk!
&gt;
&gt; Either the garbage collection algorithm is very, very lazy, or somehow
&gt; something has gone a bit wrong in the past, which might have explained
&gt; part of the performance problems.
&gt;
&gt; We're going to look at redeploying a new, fresh cluster based on Riak
&gt; 2 in the not too distant future, once Riak CS looks like it's approved
&gt; for use there, and maybe that'll clear all of this up.
&gt;
&gt; Toby

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

