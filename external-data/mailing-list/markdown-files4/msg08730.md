---
title: "Re: Cloning a cluster / copying all cluster data"
description: ""
project: community
lastmod: 2012-09-27T21:56:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08730"
mailinglist_parent_id: "msg08508"
author_name: "Matt Black"
project_section: "mailinglistitem"
sent_date: 2012-09-27T21:56:47-07:00
---


Thanks for your answers.

So let's say I have a production cluster with six nodes, and my data is
then evenly distributed across all six. How would I approach cloning that
into a three node cluster?

I actually tried a background process which rsync'd a six node cluster into
a new one - each node one-for-one.. And it didn't work. No nodes could join
the cluster and Riak was crashing out periodically. I didn't really have
time to investigate exactly why - I'm just trying out some process stuff.

Any thoughts?

On 12 September 2012 10:18, Matthew Tovbin  wrote:

&gt; Matt,
&gt;
&gt; We copied all the data key by key, since we used incorrect
&gt; 'ring\_creation\_size' value.
&gt; (
&gt; http://riak-users.197444.n3.nabble.com/Cluster-migration-due-to-incorrect-quot-ring-creation-size-quot-value-td4024509.html
&gt; )
&gt;
&gt; So, you can use this copy tool - https://github.com/tovbinm/riak-tools,
&gt; which proved itself copying 200m+ items for us.
&gt;
&gt; -Matthew
&gt;
&gt;
&gt;
&gt; On Tue, Sep 11, 2012 at 5:09 PM, Kresten Krab Thorup wrote:
&gt;
&gt;&gt; Simply copying the riak/data and riak/etc directories should do the
&gt;&gt; trick. You can use tar, rsync or simply cp as you feel like, and you can do
&gt;&gt; all that while Riak is running at full throttle. The beauty of log
&gt;&gt; structured storage (Bitcask, LevelDB, HainoiDB)
&gt;&gt;
&gt;&gt; At least that's the idea. I seem to remember that there was an issue with
&gt;&gt; LevelDB that made basho recommend that you stop a node before doing backup,
&gt;&gt; I dunno if that was fixed.
&gt;&gt;
&gt;&gt; If its just for debugging/dev purposes you can just stop sending requests
&gt;&gt; to riak while doing the backup and you should definitively be fine.
&gt;&gt;
&gt;&gt; Kresten, Trifork
&gt;&gt;
&gt;&gt; Den 12/09/2012 kl. 01.59 skrev "Matt Black" :
&gt;&gt;
&gt;&gt; &gt; Hey again list,
&gt;&gt; &gt;
&gt;&gt; &gt; Can anyone recommend a process for either cloning a cluster, or backing
&gt;&gt; up a whole cluster's data to restore elsewhere? This would be incredibly
&gt;&gt; useful for creating a new environment to test upgrades and run application
&gt;&gt; regression testing.
&gt;&gt; &gt;
&gt;&gt; &gt; In the dark old days, it would be a simple combination of mysqldump &
&gt;&gt; mysql..
&gt;&gt; &gt;
&gt;&gt; &gt; Cheers
&gt;&gt; &gt; Matt
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

