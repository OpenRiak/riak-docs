---
title: "Re: Python Client Thread Safe?"
description: ""
project: community
lastmod: 2012-02-27T10:47:18-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06756"
mailinglist_parent_id: "msg06751"
author_name: "Armon Dadgar"
project_section: "mailinglistitem"
sent_date: 2012-02-27T10:47:18-08:00
---


Hey Jim,

The PBC client does not share any state between clients,
but it is not safe to use a single client with multiple threads,
since the underlying socket will be shared.

If you have multiple threads, just make sure to use multiple
clients.

Best Regards,

Armon Dadgar

&gt; 
&gt; Message: 1
&gt; Date: Sun, 26 Feb 2012 19:39:38 +0000
&gt; From: Jim Adler 
&gt; To: "riak-users@lists.basho.com" 
&gt; Subject: Python Client Thread Safe?
&gt; Message-ID: 
&gt; Content-Type: text/plain; charset="us-ascii"
&gt; 
&gt; I'm getting the following error while using protocol buffers
&gt; (RiakPbcTransport) with more than one thread (stack trace below):
&gt; 
&gt; Socket returned short packet length 0 - expected 4'
&gt; 
&gt; I'm using the 1.3.0 Python client on Mac and Ubuntu 11.04 and have seen
&gt; the same error on both OS's. A single-thread works fine as does the
&gt; RiakHttpTransport.
&gt; 
&gt; Anyone have this problem?
&gt; 
&gt; Thanks,
&gt; Jim
&gt; 
&gt; File 
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/bucket.py", line 260,
&gt; in get
&gt; return obj.reload(r)
&gt; File 
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/riak\_object.py", line
&gt; 373, in reload
&gt; Result = t.get(self, r, vtag)
&gt; File 
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 195, in get
&gt; msg\_code, resp = self.send\_msg(MSG\_CODE\_GET\_REQ, req, None)
&gt; File 
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 387, in send\_msg
&gt; return self.recv\_msg(conn, expect)
&gt; File 
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 413, in recv\_msg
&gt; self.recv\_pkt(conn)
&gt; File 
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 460, in recv\_pkt
&gt; len(nmsglen))
&gt; RiakError: 'Socket returned short packet length 0 - expected 4'
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

