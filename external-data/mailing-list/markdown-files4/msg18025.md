---
title: "Re: Riak: reliable object deletion"
description: ""
project: community
lastmod: 2017-02-23T22:16:38-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18025"
mailinglist_parent_id: "msg18024"
author_name: "al so"
project_section: "mailinglistitem"
sent_date: 2017-02-23T22:16:38-08:00
---


What is the best way to root cause it.

Any metadata/etc to query the lifecycle of this deleted object given that
Key and Bucket are known.

On Thu, Feb 23, 2017 at 9:53 PM, al so  wrote:

&gt; Present both in Solr and Riak. It's a 1-way replication in MDC. MDC is not
&gt;&gt; the cause unless there is a bug there as well.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Feb 23, 2017 at 6:02 AM, Fred Dushin  wrote:
&gt;&gt;
&gt;&gt;&gt; Running a Solr query has no impact on writes -- Riak search queries are
&gt;&gt;&gt; direct pass throughs to Solr query and don't touch any of the salient Riak
&gt;&gt;&gt; systems (batching writes to Solr, YZ AAE, etc). I believe the timing of
&gt;&gt;&gt; the reappearance is a coincidence.
&gt;&gt;&gt;
&gt;&gt;&gt; Is it possible the object reappeared via MDC? Do you have record of the
&gt;&gt;&gt; reappeared object in your other cluster?
&gt;&gt;&gt;
&gt;&gt;&gt; Also, just to confirm, when you say the object reappeared -- it
&gt;&gt;&gt; re-appeared in Riak (and subsequently in Solr), correct? Or are you saying
&gt;&gt;&gt; you just find the object in Solr (via a search)?
&gt;&gt;&gt;
&gt;&gt;&gt; -Fred
&gt;&gt;&gt;
&gt;&gt;&gt; On Feb 23, 2017, at 1:43 AM, al so  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Here is brief env:
&gt;&gt;&gt;&gt; Riak v 2.0.8 + Solr/ 5 node cluster/ MDC
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Problem:
&gt;&gt;&gt;&gt; Deleted object suddenly resurrected after few days. Solr search query(
&gt;&gt;&gt;&gt; "\*:\*") was executed around the time of reappearance.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Bucket property for this reappeared object
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt; "props": {
&gt;&gt;&gt;&gt; "name": "UsaHype",
&gt;&gt;&gt;&gt; "allow\_mult": false,
&gt;&gt;&gt;&gt; "basic\_quorum": false,
&gt;&gt;&gt;&gt; "big\_vclock": 50,
&gt;&gt;&gt;&gt; "chash\_keyfun": {
&gt;&gt;&gt;&gt; "mod": "riak\_core\_util",
&gt;&gt;&gt;&gt; "fun": "chash\_std\_keyfun"
&gt;&gt;&gt;&gt; },
&gt;&gt;&gt;&gt; "dvv\_enabled": true,
&gt;&gt;&gt;&gt; "dw": "quorum",
&gt;&gt;&gt;&gt; "last\_write\_wins": false,
&gt;&gt;&gt;&gt; "linkfun": {
&gt;&gt;&gt;&gt; "mod": "riak\_kv\_wm\_link\_walker",
&gt;&gt;&gt;&gt; "fun": "mapreduce\_linkfun"
&gt;&gt;&gt;&gt; },
&gt;&gt;&gt;&gt; "n\_val": 3,
&gt;&gt;&gt;&gt; "notfound\_ok": true,
&gt;&gt;&gt;&gt; "old\_vclock": 86400,
&gt;&gt;&gt;&gt; "postcommit": [
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt; "mod": "riak\_repl\_leader",
&gt;&gt;&gt;&gt; "fun": "postcommit"
&gt;&gt;&gt;&gt; },
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt; "mod": "riak\_repl2\_rt",
&gt;&gt;&gt;&gt; "fun": "postcommit"
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt; ],
&gt;&gt;&gt;&gt; "pr": 0,
&gt;&gt;&gt;&gt; "precommit": [
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; ],
&gt;&gt;&gt;&gt; "pw": 0,
&gt;&gt;&gt;&gt; "r": "quorum",
&gt;&gt;&gt;&gt; "repl": true,
&gt;&gt;&gt;&gt; "rw": "quorum",
&gt;&gt;&gt;&gt; "small\_vclock": 50,
&gt;&gt;&gt;&gt; "w": "quorum",
&gt;&gt;&gt;&gt; "young\_vclock": 20
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \* delete\_mode is not configured at all. Defaults to 3 sec? Do Tombstone 
&gt;&gt;&gt;&gt; still get created when no delete\_mode at all in the config? Can we query 
&gt;&gt;&gt;&gt; metadata(\*X-Riak-Deleted)\* for this reappeared object.\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; How would one go about finding root cause. I do know the date when the
&gt;&gt;&gt;&gt; object was deleted from our app logs. I also seem to know when it
&gt;&gt;&gt;&gt; reappeared. Seems like a solr search ("\*:\*") in code was executed just
&gt;&gt;&gt;&gt; before this object reappeared? Look at AAE? Is there a way to find if Solr
&gt;&gt;&gt;&gt; and Riak backends are out-of-sync (AAE?).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I understand tuning other params (allow\_mult = true, ...) will have
&gt;&gt;&gt;&gt; its own implications.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; In summary:
&gt;&gt;&gt;&gt; How do I find root cause of this issue.
&gt;&gt;&gt;&gt; How to reliable delete an object.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -Volk
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

