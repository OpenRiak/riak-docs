---
title: "Re: Using map 'arg' in mapreduce calls in python and Erlang clients"
description: ""
project: community
lastmod: 2012-11-10T10:39:58-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09280"
mailinglist_parent_id: "msg09271"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2012-11-10T10:39:58-08:00
---


On Fri, Nov 9, 2012 at 2:48 PM, Julian  wrote:
&gt; map\_reindex(RiakObject, \_KeyData, IndexJson) when is\_binary(IndexJson) -&gt;
&gt;
&gt; and the error that the python client gets starts with Exception:
&gt; {"phase":0,"error":"function\_clause"
&gt;
&gt; so I don't think it's being received as a binary.

Hi, Julian. You're right, it's not being received as a binary. The
MapReduce endpoint expects the 'arg' to be JSON, and decodes it. If
you're constructing your 'arg' like so:

 client.map(['module','function'], {'arg':'foobar'})

then I would expect the binary &lt;&lt;"foobar"&gt;&gt; to come through (indeed,
it does in my testing). But, if you're constructing like so:

 client.map(['module','function'], {'arg':{'foobar':1}})

then instead, you'll get a mochijson2-decoded structure. That looks
something like this in Erlang:

 {struct, [{&lt;&lt;"foobar"&gt;&gt;, 1}]}

More detail about that decoding can be found here:
https://github.com/mochi/mochiweb/blob/master/src/mochijson2.erl

&gt; And how do I print out some logging information from my map function? I
&gt; tried using lager like I found in the riak code,
&gt;
&gt; lager:error("Arg is ~p", [IndexJson]),
&gt;
&gt; but I can't find the message in any of the Riak logs.

Lager requires a parse transform at compile time. I suggest using the
error\_logger module. The lager application will pick up any calls to
make to error\_logger:info\_message, :warning\_msg, and :error\_msg, and
dump them in your console.log or error.log, as appropriate.

-Bryan

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

