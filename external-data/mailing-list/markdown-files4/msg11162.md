---
title: "Riak 1.3.1 Upgrade Questions"
description: ""
project: community
lastmod: 2013-05-24T02:25:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11162"
author_name: "Shane McEwan"
project_section: "mailinglistitem"
sent_date: 2013-05-24T02:25:08-07:00
---



G'day!

We're about to start upgrading our Riak clusters from 1.2.1 to 1.3.1 and 
I have a couple of questions about the upgrade process.


Firstly, the new "enable\_health\_checks" config option. It's not clear 
what impact this option will have on a busy cluster. The way I read it, 
if a riak\_kv\_vnode message queue goes over the "vnode\_mailbox\_limit" 
DisableThreshold then the riak\_kv service is disabled. Doesn't this 
effectively take the node down? If you have a busy cluster isn't it 
possible that all nodes could hit this limit around the same time and 
bring the whole cluster down? Especially if you're running close to the 
limit and one node gets taken offline then the other nodes try to take 
up the slack which puts them over the threshold. Or am I 
misunderstanding this feature?


Is there any way to query the riak\_kv\_vnode message queue length to get 
an idea of how close we are to hitting the limit?


Secondly, reformatting the indexes to fix the 2i integer encoding 
problem. Do I need to run the "riak-admin reformat-indexes" on each node 
or just once for the whole cluster?


Thanks!

Shane.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

