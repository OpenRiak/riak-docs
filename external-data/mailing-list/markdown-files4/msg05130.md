---
title: "Re: Best way to feed inputs into a MapReduce query"
description: ""
project: community
lastmod: 2011-10-11T21:22:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05130"
mailinglist_parent_id: "msg05128"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-10-11T21:22:15-07:00
---


Responses inline.


On Oct 11, 2011, at 5:59 PM, Wayne See wrote:

&gt; Hi all,
&gt; 
&gt; I'm planning on using Riak to perform aggregation/sorting on a dataset 
&gt; composed of JSON values. I can feed the keys to the MapReduce query using key 
&gt; filters or Riak search, but I was wondering which would give better 
&gt; performance when doing the query on a large dataset and the matching keys 
&gt; would only be a small subset of it? To give a little bit more background I 
&gt; only need to index/query against 2 fields of a JSON document so I don't 
&gt; necessarily need the flexibility of Riak search, and key filters would work 
&gt; since I can use field1-field2 to key the document.

&gt; I'm concerned though that key filters would have to loop through the entire 
&gt; bucket keyspace to find the matching keys,

Key filters will have to loop through all keys in the instance, not just all 
keys in a bucket. There are improvements in Riak 1.0 to make this perform 
better (through asynchronous folding), but it's still not a huge improvement.

&gt; but I'm also concerned that Riak Search would index the whole JSON (although 
&gt; the fields I would query against would be your regular integer keys, the 
&gt; other fields can get pretty big) and possibly affect write performance.

Riak Search can be made to only index the fields that you want through the use 
of a schema http://wiki.basho.com/Riak-Search---Schema.html

&gt; I'm planning to test this when I have the time but I was wondering if anybody 
&gt; has similar experiences regarding this and can shed some insight? Rough 
&gt; estimate of size of dataset would be 1M keys but aggregation would only be 
&gt; performed on a 50-150 keys.
&gt; 
&gt; I'm also considering keeping an inverted index on another datastore like 
&gt; redis so I can just get the keys I need from that datastore and feed that 
&gt; into Riak's MapReduce, but ideally I would like to keep it in Riak to make it 
&gt; simpler to scale. I've also looked into secondary indices but from the looks 
&gt; of it I can't perform lookups against 2 tags.

While you can't perform lookups against 2 separate indexes, you can have two 
indexes and perform some kind of comparison between the results of querying 
both indexes. If the result sets are going to be the size you're thinking 
(50-150 keys), then performing some kind of in memory comparison on the client 
to merge the results of two index queries shouldn't be terribly expensive.

---
Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
Microsoft SQL Server MVP
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

