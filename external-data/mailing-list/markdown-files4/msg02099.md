---
title: "Re: running erlang map phases via REST API"
description: ""
project: community
lastmod: 2011-01-24T12:43:56-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02099"
mailinglist_parent_id: "msg02098"
author_name: "Eric Moritz"
project_section: "mailinglistitem"
sent_date: 2011-01-24T12:43:56-08:00
---


I would find this useful. It's easier to run an anonymous function than to
deploy an erlang module to a cluster.
On Jan 24, 2011 3:34 PM, "Dan Reverri"  wrote:
&gt; Hi Brendan,
&gt;
&gt; Anonymous Erlang functions are not currently supported in map reduce
phases.
&gt; Is this a feature the community would find valuable?
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Mon, Jan 24, 2011 at 12:14 PM, Brendan  wrote:
&gt;
&gt;&gt; is it possible to pass erlang anonymous funs via the REST API? i took a
&gt;&gt; javascript query, replaced "language":"javascript" with
&gt;&gt; "language":"erlang" and changed the source to an anonymous fun, but i
&gt;&gt; end up getting an error from the REST API back.am i doing something
&gt;&gt; wrong here, or can erlang functions only be called using the "module"
&gt;&gt; and "function" fields?
&gt;&gt;
&gt;&gt; the anonymous erlang fun was pulled from the Phase Functions-&gt;Map
&gt;&gt; Function examples section of the http://wiki.basho.com/MapReduce.html
&gt;&gt; wiki page.
&gt;&gt;
&gt;&gt; [dev.a]brendan@build01:~/riak$ curl -X PUT -d 'stuff'
&gt;&gt; http://127.0.0.1:8098/riak/bucket/object
&gt;&gt; [dev.a]brendan@build01:~/riak$ curl -X GET
&gt;&gt; http://127.0.0.1:8098/riak/bucket/object; echo
&gt;&gt; stuff
&gt;&gt; [dev.a]brendan@build01:~/riak$ cat erl2
&gt;&gt; {
&gt;&gt; "inputs": [
&gt;&gt; [
&gt;&gt; "bucket",
&gt;&gt; "object"
&gt;&gt; ]
&gt;&gt; ],
&gt;&gt; "query": [
&gt;&gt; {
&gt;&gt; "map": {
&gt;&gt; "language": "erlang",
&gt;&gt; "source":
&gt;&gt; "fun(Value,\_Keydata,\_Arg)-&gt;[[riak\_object:get\_value(Value)]] end."
&gt;&gt; }
&gt;&gt; }
&gt;&gt; ]
&gt;&gt; }
&gt;&gt; [dev.a]brendan@build01:~/riak$ curl -X POST -H
&gt;&gt; "content-type:application/json" http://localhost:8098/mapred --data @erl2
&gt;&gt; 500 Internal Server
&gt;&gt; ErrorInternal Server Error
=====================

The server
&gt;&gt; encountered an error while processing this
request:  

```
{error,badarg,
&gt;&gt; [{erlang,binary_to_list,[undefined]},
&gt;&gt; {riak_kv_mapred_json,bin_to_atom,1},
&gt;&gt; {riak_kv_mapred_json,parse_step,2},
&gt;&gt; {riak_kv_mapred_json,parse_query,2},
&gt;&gt; {riak_kv_mapred_json,parse_request,1},
&gt;&gt; {riak_kv_wm_mapred,verify_body,2},
&gt;&gt; {riak_kv_wm_mapred,malformed_request,2},
&gt;&gt;
&gt;&gt;
&gt;&gt;
{webmachine_resource,resource_call,3}]}
```


---

mochiweb+webmachine
&gt;&gt; web server


&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

