---
title: "Re: O(n) behavior on crdts"
description: ""
project: community
lastmod: 2014-04-01T12:29:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13965"
mailinglist_parent_id: "msg13961"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2014-04-01T12:29:11-07:00
---


Hey James,

Massive respect to any mailing list response about performance that includes 
graphs, thanks!

I plan to keep optimising right up until we release, so hopefully we can 
further improve the performance. From the look of your graphs there is work to 
be done.

Are these graphs for Set or Map additions, please?

Keep us posted with your testing/assessment, please.

Cheers

Russell


On 1 Apr 2014, at 20:18, James Moore  wrote:

&gt; Thanks Russell,
&gt; 
&gt; I'm mainly observing this issue around the add operation on hash's when 
&gt; running a similar operation as this guy
&gt; 
&gt; https://gist.github.com/russelldb/d330d796ca1b25d1879d
&gt; 
&gt; the behavior I was seeing show's up in the following graphs
&gt; 
&gt; the horizontal axis is the iteration of the add operation, and the y axis is 
&gt; milliseconds
&gt; 
&gt; 
&gt; 
&gt; 
&gt; From that chart it looks as though the fix in compression has resolved the 
&gt; issue :) ( and also in hindsight the results don't quite look O(n) )
&gt; 
&gt; for larger add operations I'm still seeing a linear performance degradation, 
&gt; but add operations are still pretty quick through 10k operations
&gt; 
&gt; 
&gt; 
&gt; 
&gt; In answer to you're question on performance I believe the switch up to pre20 
&gt; should resolve the the poor add performance for us, and overall I've found it 
&gt; to be quite impressive so far.
&gt; 
&gt; --james
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Tue, Apr 1, 2014 at 2:21 AM, Russell Brown  wrote:
&gt; Hey James,
&gt; 
&gt; I haven’t analysed the complexity of the data types. Off hand I know that 
&gt; operations on Maps, Sets, Counters etc are not O(n). Merges sometimes will 
&gt; be, if every entry must be compared, and we’re looking at ways to optimise 
&gt; this. The `value` operation on Maps and Sets must be O(n) since we have to 
&gt; derive the correct value for each entry. I’m not sure how we would optimise 
&gt; that.
&gt; 
&gt; We’ve optimised the `context` for operations down to a single version vector 
&gt; (before it was a binary of the entire Map or Set), which should have got us 
&gt; some performance improvements.
&gt; 
&gt; Right now Sets and Maps still use orddict. We have a round of performance and 
&gt; scalability testing starting, and hopefully some optimisations will come out 
&gt; of that.
&gt; 
&gt; I think you’re referring to Sean’s porting of Elixir’s TreeMap to erlang. We 
&gt; have not yet tested that code, nor have we integrated it with riak\_dt. I 
&gt; don’t know if anyone even plans to.
&gt; 
&gt; Have you observed poor performance from the data types? The earlier releases' 
&gt; main performance issue was to/from binary encoding. We since switched to 
&gt; erlangs built in t2b/b2t functions, with compression, and have found the 
&gt; performance to be acceptable.
&gt; 
&gt; I guess the short answer is: we’re working on it, but with 2.0 release 
&gt; looming up, we might not get all the way there in time.
&gt; 
&gt; There is some cost for using CRDTs, I don’t think it could be another way, 
&gt; there aren’t any free lunches. My aim is to reduce that cost below the pain 
&gt; barrier of siblings, and writing complex merge functions.
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; On 31 Mar 2014, at 23:06, James Moore  wrote:
&gt; 
&gt; &gt; Hey All,
&gt; &gt;
&gt; &gt; has there been any progress on resolving the O(n) behavior of crdt sets and 
&gt; &gt; maps?
&gt; &gt;
&gt; &gt; Sean mentioned in a previous thread that there was a potential for a fix to 
&gt; &gt; resolve the poor performance of erlang's orddict.
&gt; &gt;
&gt; &gt; thanks!
&gt; &gt;
&gt; &gt; --James
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

