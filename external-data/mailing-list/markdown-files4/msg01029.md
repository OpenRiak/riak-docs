---
title: "Re: Riak and no of clients limit?"
description: ""
project: community
lastmod: 2010-09-04T16:31:35-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01029"
mailinglist_parent_id: "msg01026"
author_name: "Seth Falcon"
project_section: "mailinglistitem"
sent_date: 2010-09-04T16:31:35-07:00
---


Hi Justin,


On Sat, Sep 4, 2010 at 3:47 PM, Justin Sheehy  wrote:
&gt; Each instantiated riak\_client has a unique client-id that will
&gt; represent that client in all updates (put-requests) that it makes.
&gt; That is, the entries in the vector clock will match that client-id.
&gt; Much of the value of vector clocks can vanish if concurrent writes to
&gt; the same values can be issued with the same client-id.
&gt;
&gt; Sharing connections as you describe might be fine, depending on the
&gt; details.  However, if your resources might overlap in a way like the
&gt; following example then you probably have a problem.
&gt;
&gt; A and B are resource instances handling separate concurrent HTTP
&gt; requests but sharing a client-id C.
&gt; A issues get(K), receiving object X with vector clock V
&gt; B issues get(K), receiving object X with vector clock V
&gt; A issues put(K,Xa) where Xa is an update to X
&gt; B issues put(K,Xb) where Xb is an update to X
&gt;
&gt; You can lose one of the two updates, as they are both a single update
&gt; to V from client C.  It is assumed that a given client will not
&gt; compete with itself for updates.

What's the fun in that? ;-)

&gt; I hope that this explanation is helpful.

Quite useful, thanks (once again).

I haven't measured, but my intuition is that I don't want to create
and shutdown a new riak pb client for each resource request (and the
fact that there is no easy API for shutting down a pb client also
leads me to think that this is not an intended use).

Given that, it sounds like one would want a pool of pb clients such
that each resource takes a client out of the pool when handling a
request and returns it when done. So there would be no concurrent
requests going through the same client.

Does that seem like a reasonable approach?

+ seth


-- 
Seth Falcon | @sfalcon | http://userprimary.net/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

