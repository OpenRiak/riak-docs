---
title: "Re: Riak LevelDB Deletion Problem"
description: ""
project: community
lastmod: 2015-07-14T10:02:20-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16292"
mailinglist_parent_id: "msg16291"
author_name: "Antonio Teixeira"
project_section: "mailinglistitem"
sent_date: 2015-07-14T10:02:20-07:00
---


Hi Matthew,

We will be removing close to 1 TB of data from the node , and since we are
short on "disk space" when we saw that the disk space was actually rising
we halted the data removal.

Now according to some docs I have read, if after a deletion ( a few seconds
) we make a .get() it force the release of the diskspace , is this true ?

For us it's not possible to move data to another node, is there any way
even manually to release the space ? or at least to force :
" The actual release occurs significantly later (days, weeks, or even
months later) when the tombstone record merges with the actual data in a
background compaction."

Thanks for all the help,
Antonio


2015-07-14 17:43 GMT+01:00 Matthew Von-Maszewski :

&gt; Antonio,
&gt;
&gt; Here is a detailed discussion of the Riak / leveldb delete scenario:
&gt;
&gt; https://github.com/basho/leveldb/wiki/mv-aggressive-delete
&gt;
&gt; Pay close attention to the section titled “Update April 6, 2014”. This
&gt; explains why as much as 4.2G bytes per vnode might remain within leveldb
&gt; after deleting all keys. There is no mechanism to override the logic that
&gt; causes the disk space retention.
&gt;
&gt; One workaround is to use Riak’s handoff mechanism to transfer vnodes from
&gt; one physical server to another. The vnode transfer will remove all
&gt; deletion tombstones on the destination. The last step of the transfer then
&gt; deletes all leveldb files on the original server, recovering the space.
&gt;
&gt; Matthew
&gt;
&gt;
&gt;
&gt; &gt; On Jul 14, 2015, at 12:32 PM, Antonio Teixeira 
&gt; wrote:
&gt; &gt;
&gt; &gt; Hello,
&gt; &gt;
&gt; &gt; We have been migrating our Riak Database to another infrastructure
&gt; through a "streaming" process and right now we should have somewhere around
&gt; 2Gb of free space the Hard Disk, however those 2Gb are still being used by
&gt; Riak. After some research I believe the problem is the Objects are only
&gt; being marked for deletion and not actually deleted at runtime. What we need
&gt; is a way to aggressively deleted those keys or some way to force Riak to
&gt; delete those marked keys and subsequently release the Disk Space. The Riak
&gt; version we are using is v2.0.2
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

