---
title: "Re: 50-100 ops/sec on a 5 Node cluster"
description: ""
project: community
lastmod: 2012-06-29T12:56:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07843"
mailinglist_parent_id: "msg07835"
author_name: "Yousuf Fauzan"
project_section: "mailinglistitem"
sent_date: 2012-06-29T12:56:45-07:00
---


Thats a very useful information. Thanks guys.

I figured out the problem was with my data loading script. Plus, instead of
going through ELB, I created a pool of connections for each node.

Now I am getting around 1k writes/sec. I think I could further improve this
my using a more powerful machine for loading data (I am using small
instance of EC2)

Thanks all for your help.

--
Yousuf Fauzan
http://fauzism.com

On Fri, Jun 29, 2012 at 10:25 PM, Mark Rose  wrote:

&gt; There are other reasons to avoid using an ELB for this purpose I'd like to
&gt; add.
&gt;
&gt; ELB works by resolving a DNS name to an A record, so if the ELB instance
&gt; goes down or has trouble, you will have trouble as well. This is also the
&gt; source of the scaling up issue as it takes time for the DNS records on the
&gt; client machines to expire and for new A records to be returned.
&gt;
&gt; Also, you have to pay per request, plus the bandwidth used. Not to mention
&gt; the latency of client-&gt;elb-&gt;server instead of running a proxy on the local
&gt; machine.
&gt;
&gt; Instead, I would recommend setting up HAProxy on every client machine, and
&gt; configure HAProxy to connect to some or all of your nodes. It will react
&gt; much faster to node status, plus you get useful reports and whatnot. It's
&gt; also extremely efficient, using little CPU and memory.
&gt;
&gt; -Mark
&gt;
&gt;
&gt; On Fri, Jun 29, 2012 at 12:28 PM, Sean O'Connor  wrote:
&gt;
&gt;&gt; There are a few things you probably want to look at in regard to how your
&gt;&gt; using ELB.
&gt;&gt;
&gt;&gt; If your using the straight ELB offering (e.g. not part of a virtual
&gt;&gt; private cloud), that's probably your problem. This form of ELB was really
&gt;&gt; only designed for routing traffic from outside the AWS network to servers
&gt;&gt; within EC2. Using it route traffic with the AWS tends to be very
&gt;&gt; slow/throttled as your traffic has to go out to the public network and then
&gt;&gt; back into the private AWS network.
&gt;&gt;
&gt;&gt; Recently (i.e. the last two or three weeks) Amazon announced a new
&gt;&gt; version of ELB that you can use with virtual private cloud to route traffic
&gt;&gt; between VPC networks. I haven't tried it yet but in theory this should
&gt;&gt; avoid many of the problems mentioned above.
&gt;&gt;
&gt;&gt; One last thing to be aware of with ELB is it can often take a while for
&gt;&gt; an ELB instance to deal with spikes in capacity (e.g. load tests). Under
&gt;&gt; the covers ELB is basically as series of managed EC2 instances running a
&gt;&gt; load balancer program. When your capacity exceeds what one instance can
&gt;&gt; handle, they'll spin up more instances but that takes time to happen.
&gt;&gt; Accordingly when doing load testing with ELB, you often need to "prime"
&gt;&gt; the ELB by running test traffic for 10-15 minutes and then start recording
&gt;&gt; your benchmark data.
&gt;&gt;
&gt;&gt; With the possible exception of the new VPC ELB offering, I would strongly
&gt;&gt; recommend against using ELB to load balance traffic to your riak cluster.
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean O'Connor
&gt;&gt; CTO/Co-Founder
&gt;&gt; (845)669-0883
&gt;&gt; http://focuslab.io
&gt;&gt;
&gt;&gt; On Thursday, June 28, 2012 at 4:03 PM, Ruslan Bukin wrote:
&gt;&gt;
&gt;&gt; On Tue, Jun 26, 2012 at 04:29:38PM +0530, Yousuf Fauzan wrote:
&gt;&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; Here is my setup of Riak 1.1.4
&gt;&gt;
&gt;&gt; - 5 Nodes
&gt;&gt; - ami-a29943cb (EC2 AMI)
&gt;&gt; - m1.large (7.5GB Ram, 4 EC2 compute instances)
&gt;&gt; - EBS storage
&gt;&gt; - LevelDB backend
&gt;&gt; - Python Client with Protobuf (on a separate machine)
&gt;&gt;
&gt;&gt; While loading data I am getting around 50 ops/sec.
&gt;&gt;
&gt;&gt; I tried running basho benchmark on the setup and it showed 100 ops/sec
&gt;&gt; throughput.
&gt;&gt;
&gt;&gt; After talking to people or Riak IRC, I realized that upwards of 1.5K
&gt;&gt; ops/sec is what I should be getting.
&gt;&gt;
&gt;&gt; Could anyone help me in figuring out what I am doing wrong?
&gt;&gt;
&gt;&gt;
&gt;&gt; are your riak nodes located in the same DC?
&gt;&gt;
&gt;&gt; -Ruslan
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

