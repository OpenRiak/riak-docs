---
title: "Re: Retrying requests to Riak"
description: ""
project: community
lastmod: 2011-04-07T20:07:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02924"
mailinglist_parent_id: "msg02921"
author_name: "matthew hawthorne"
project_section: "mailinglistitem"
sent_date: 2011-04-07T20:07:32-07:00
---


I don't use haproxy (we use hardware load balancers), but if I did, I
would want to handle it at that layer instead of in the riak client.

However, If you're using the java client you can implement a custom
HttpClient retry handler to do this:
http://hc.apache.org/httpcomponents-client-ga/tutorial/html/fundamentals.html#d4e292

I believe that doc is for a newer version of HttpClient than the java
client depends on, but the concept is similar across versions.

We actually do the opposite of what you're looking for -- we override
it to never retry after failures. But it all depends on how errors
are handled in your architecture.

-matt


On Thu, Apr 7, 2011 at 9:47 PM, Greg Nelson  wrote:
&gt; Hello,
&gt; I have a simple three node cluster that I have been using for testing and
&gt; benchmarking Riak.  Lately I've been simulating various failure scenarios --
&gt; like a node going down, disk going bad, etc.
&gt; My application talks to Riak through an haproxy instance running locally on
&gt; each application server.  It's configured to round-robin over the nodes in
&gt; the cluster for both HTTP and PBC interfaces, and uses the HTTP /ping health
&gt; check.  I assume this is a rather typical setup.
&gt; I'm only using the HTTP interface right now...  When there's a failure and a
&gt; node returns a 5XX error, I'd like to have my application retry the request
&gt; on a different node.  I could of course build this retry logic into my
&gt; application, but what I'm wondering is if there's another way that people
&gt; are typically doing this.  Is there a way to configure haproxy to do this?
&gt;  Do any of the Riak client libraries have this logic built-in?
&gt; Thanks!
&gt; Greeg
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

