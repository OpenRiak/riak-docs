---
title: "Re: haproxy issues with protocol buffers on 2.x releases"
description: ""
project: community
lastmod: 2015-06-04T21:00:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16211"
mailinglist_parent_id: "msg16197"
author_name: "Kota Uenishi"
project_section: "mailinglistitem"
sent_date: 2015-06-04T21:00:06-07:00
---


Toby,

As PB connection management haven't been changed between CS 1.5 and
2.0, I think it should work. What's the version the load balancing
working stable? It depends of the reason why connection has been cut,
but I would recommend you restart just the CS node and recreate the
connection pool.

On Thu, Jun 4, 2015 at 2:33 PM, Toby Corkindale  wrote:
&gt; Hi,
&gt; I've been happily using haproxy in front of Riak and Riak CS 1.x in
&gt; production for quite a while.
&gt;
&gt; I've been trying to bring up a new cluster based on riak/cs 2.0.x recently,
&gt; as you've probably noticed from the flurry of emails to this list :)
&gt;
&gt; I'm discovering that if I have haproxy sitting between riak-cs and riak,
&gt; then I get a lot of errors about disconnections. Initially I thought this
&gt; must be related to pb backlogs or pool sizes or file handle limits -- but
&gt; I've played with all those things to no avail.
&gt;
&gt; I \*have\* noticed that if I get riak-cs to connect directly to a riak
&gt; (bypassing haproxy) then everything is fine, including with the original
&gt; default request pool and backlog sizes.
&gt;
&gt; I am essentially using the recommended haproxy.cfg, which has worked fine in
&gt; production elsewhere.
&gt;
&gt; Any suggestions?
&gt; Error message sample follows:
&gt;
&gt; 2015-06-04 15:26:16.447 [warning]
&gt; &lt;0.283.0&gt;@riak\_cs\_riak\_client:get\_user\_with\_pbc:293 Fetching user re
&gt; cord with strong option failed: disconnected
&gt; 2015-06-04 15:26:16.447 [warning]
&gt; &lt;0.2095.0&gt;@riak\_cs\_pbc:check\_connection\_status:97 Connection status
&gt; of &lt;0.287.0&gt; at maybe\_create\_user: {false,[]}
&gt;
&gt;
&gt;
&gt; Cheers
&gt; Toby
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Kota UENISHI / @kuenishi
Basho Japan KK

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

