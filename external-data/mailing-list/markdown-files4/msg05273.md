---
title: "RE: Join a Riak-1.0 node to a Riak-0.14 cluster"
description: ""
project: community
lastmod: 2011-10-24T10:09:31-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05273"
mailinglist_parent_id: "msg05133"
author_name: "Tomer Naor"
project_section: "mailinglistitem"
sent_date: 2011-10-24T10:09:31-07:00
---


Well, it caused us some problems...

The situation is as follows:
we have a production cluster with five 0.14 nodes and which we want to replace 
with three new Riak 1.0.1 servers.

This is what we did:

1. join each of the 1.0 nodes to the 0.14 cluster.

2. after that all the three 1.0 nodes were part of the ring members and 
handoff was over we did 'admin-riak leave' on one of the 0.14 nodes (eventually 
we'll need to leave them all).

The problem is that it looks like not all the data from the 0.14 node were 
handoff in the leaving process and it seems like we've lost some data.
(Don't know if it's matter but the bitcask of the 0.14 node that we tried to 
'riak-admin leave' was reduced from 120GB to 55GB)

Another problem that we noticed is that the basic get api not always returned a 
consistent response, it sometimes returned the required data and sometimes 
returned 404 status code.

what is the best/right/safe way to do it without losing data and without 
experience significant downtime as a result of the join and leave process.

Thanks,
Tomer.

From: Sean Cribbs [mailto:s...@basho.com]
Sent: Wednesday, October 12, 2011 14:37
To: Tomer Naor
Cc: riak-users@lists.basho.com
Subject: Re: Join a Riak-1.0 node to a Riak-0.14 cluster

It is possible but requires a slight modification from the directions in 
http://wiki.basho.com/Rolling-Upgrades.html. When adding the new 1.0 node, 
make sure these settings are in the 'riak\_kv' section of its app.config:




{legacy\_keylisting, true},

{mapred\_system, legacy},

{vnode\_vclocks, false}
This will ensure that it does not try to use functionality that is unavailable 
on the 0.14.2 nodes.

On Wed, Oct 12, 2011 at 6:30 AM, Tomer Naor 
&gt; wrote:
Hi,

Is it possible to join a Riak-1.0 node (not from rolling upgrade - new server 
with fresh 1.0.0 installation) to a cluster with Riak-0.14 nodes without any 
unexpected problems?

Thanks,
Tomer.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



--
Sean Cribbs &gt;
Developer Advocate
Basho Technologies, Inc.
http://www.basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

