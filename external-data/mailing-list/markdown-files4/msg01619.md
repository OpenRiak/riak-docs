---
title: "Re: innostore and multi_backend"
description: ""
project: community
lastmod: 2010-11-23T19:12:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01619"
mailinglist_parent_id: "msg01618"
author_name: "Joseph Lambert"
project_section: "mailinglistitem"
sent_date: 2010-11-23T19:12:37-08:00
---


Attached is app.config, below is copy/pasted the multi\_backend part

{storage\_backend, riak\_kv\_multi\_backend},

 {multi\_backend\_default, &lt;&lt;"bitcask"&gt;&gt;},

 {multi\_backend, [
 {&lt;&lt;"bitcask"&gt;&gt;, riak\_kv\_bitcask\_backend, [{data\_root,
"/var/lib/riak/bitcask"}]},
 {&lt;&lt;"dets"&gt;&gt;, riak\_kv\_dets\_backend,
[{riak\_kv\_dets\_backend\_root, "/var/lib/riak/dets"}]},
 {&lt;&lt;"ets"&gt;&gt;, riak\_kv\_ets\_backend, []},
 {&lt;&lt;"fs"&gt;&gt;, riak\_kv\_fs\_backend,
[{riak\_kv\_fs\_backend\_root, "/var/lib/riak/fs"}]},
 {&lt;&lt;"cache"&gt;&gt;, riak\_kv\_cache\_backend, [
 {riak\_kv\_cache\_backend\_memory, 100},
 {riak\_kv\_cache\_backend\_ttl, 600},
 {riak\_kv\_cache\_backend\_max\_ttl, 3600}
 ]},
 {&lt;&lt;"innostore"&gt;&gt;, riak\_kv\_innostore\_backend, []}
 ]},

Innostore config:

 {innostore, [
 {data\_home\_dir, "/var/lib/riak/innostore"},
 {log\_group\_home\_dir, "/var/lib/riak/inno-log"},

 {buffer\_pool\_size, 4294967296},
 {log\_files\_in\_group, 6},
 {log\_file\_size, 16777216}
]},


- Joe Lambert

joseph.g.lamb...@gmail.com


On Wed, Nov 24, 2010 at 10:55 AM, Dan Reverri  wrote:

&gt; Can you provide the full app.config? I'd like to see if multi backend has
&gt; been setup correctly.
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Tue, Nov 23, 2010 at 6:35 PM, Joseph Lambert &lt;
&gt; joseph.g.lamb...@gmail.com&gt; wrote:
&gt;
&gt;&gt; This:
&gt;&gt;
&gt;&gt; {riak\_kv, [
&gt;&gt; ....
&gt;&gt; {multi\_backend, [
&gt;&gt; ....
&gt;&gt; {&lt;&lt;"inno"&gt;&gt;, riak\_kv\_innostore\_backend, []}
&gt;&gt; ]}
&gt;&gt; ]},
&gt;&gt;
&gt;&gt; ....
&gt;&gt; {innostore, [
&gt;&gt; {data\_home\_dir, "/var/lib/riak/innostore"},
&gt;&gt; {log\_group\_home\_dir, "/var/lib/riak/inno-log"},
&gt;&gt; {buffer\_pool\_size, 4294967296},
&gt;&gt; {log\_files\_in\_group, 6},
&gt;&gt; {log\_file\_size, 16777216}
&gt;&gt; ]}
&gt;&gt;
&gt;&gt; Then this (without an entry for multi\_backend, definitely won't work,
&gt;&gt; since it's not declared in multi\_backend):
&gt;&gt; {riak\_kv, [
&gt;&gt; ....
&gt;&gt; {multi\_backend, [
&gt;&gt; ....
&gt;&gt; ]}
&gt;&gt; ]},
&gt;&gt;
&gt;&gt; ....
&gt;&gt; {innostore, [
&gt;&gt; {data\_home\_dir, "/var/lib/riak/innostore"},
&gt;&gt; {log\_group\_home\_dir, "/var/lib/riak/inno-log"},
&gt;&gt; {buffer\_pool\_size, 4294967296},
&gt;&gt; {log\_files\_in\_group, 6},
&gt;&gt; {log\_file\_size, 16777216}
&gt;&gt; ]}
&gt;&gt;
&gt;&gt;
&gt;&gt; I also tried with {innostore, riak\_kv\_innostore\_backend, []} in
&gt;&gt; multi\_backend. First one gives the error mentioned in the previous email.
&gt;&gt;
&gt;&gt;
&gt;&gt; - Joe Lambert
&gt;&gt;
&gt;&gt; joseph.g.lamb...@gmail.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Nov 24, 2010 at 10:18 AM, Dan Reverri  wrote:
&gt;&gt;
&gt;&gt;&gt; Can you provide the different app.configs you are using?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Dan
&gt;&gt;&gt;
&gt;&gt;&gt; Daniel Reverri
&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; d...@basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Nov 23, 2010 at 5:59 PM, Joseph Lambert &lt;
&gt;&gt;&gt; joseph.g.lamb...@gmail.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Dan,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I'm using riak\_search 0.13.0 and innostore 1.0.2, btw.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If I add the default innostore configuration like on the configuration
&gt;&gt;&gt;&gt; page, and also add an entry for innostore in the multi\_backend I get this
&gt;&gt;&gt;&gt; error on startup:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {{{badmatch,
&gt;&gt;&gt;&gt; {error,
&gt;&gt;&gt;&gt; {eagain,
&gt;&gt;&gt;&gt; [{erlang,open\_port,
&gt;&gt;&gt;&gt; [{spawn,innostore\_drv},[binary]]},
&gt;&gt;&gt;&gt; {innostore,connect,0},
&gt;&gt;&gt;&gt; {riak\_kv\_innostore\_backend,start,2},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {riak\_kv\_multi\_backend,'-start/2-lc$^0/1-0-',2},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {riak\_kv\_multi\_backend,'-start/2-lc$^0/1-0-',2},
&gt;&gt;&gt;&gt; {riak\_kv\_multi\_backend,start,2},
&gt;&gt;&gt;&gt; {riak\_kv\_vnode,init,1},
&gt;&gt;&gt;&gt; {riak\_core\_vnode,init,1}]}}},
&gt;&gt;&gt;&gt; [{riak\_core\_vnode\_master,get\_vnode,2},
&gt;&gt;&gt;&gt; {riak\_core\_vnode\_master,handle\_call,3},
&gt;&gt;&gt;&gt; {gen\_server,handle\_msg,5},
&gt;&gt;&gt;&gt; {proc\_lib,init\_p\_do\_apply,3}]},
&gt;&gt;&gt;&gt; {gen\_server,call,
&gt;&gt;&gt;&gt; [riak\_kv\_vnode\_master,
&gt;&gt;&gt;&gt; {1096126227998177188652763624537212264741949407232,
&gt;&gt;&gt;&gt; get\_vnode},
&gt;&gt;&gt;&gt; infinity]}}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If I take out the innostore configuration from multi\_backend, I get an
&gt;&gt;&gt;&gt; error about the backend not existing.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; - Joe Lambert
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; joseph.g.lamb...@gmail.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Wed, Nov 24, 2010 at 2:34 AM, Dan Reverri  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; You are correct, the innostore backend is not using the parameters
&gt;&gt;&gt;&gt;&gt; passed to it by multi\_backend:
&gt;&gt;&gt;&gt;&gt; https://issues.basho.com/show\_bug.cgi?id=890
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Rather than modifying the innostore.app file you can configure the
&gt;&gt;&gt;&gt;&gt; default innostore settings in your Riak app.config file:
&gt;&gt;&gt;&gt;&gt; [
&gt;&gt;&gt;&gt;&gt; {riak\_core, [...riak\_core settings...]},
&gt;&gt;&gt;&gt;&gt; {riak\_kv, [...riak\_kv settings...]},
&gt;&gt;&gt;&gt;&gt; {innostore, [{buffer\_pool\_size, 8589934592}, ...other settings...]}
&gt;&gt;&gt;&gt;&gt; ]
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt; Dan
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Daniel Reverri
&gt;&gt;&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt; d...@basho.com
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Tue, Nov 23, 2010 at 2:02 AM, Joseph Lambert &lt;
&gt;&gt;&gt;&gt;&gt; joseph.g.lamb...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Does anyone have innostore set up under multi\_backend? I can't seem to
&gt;&gt;&gt;&gt;&gt;&gt; get it to work properly with multi\_backend.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I tried adding it under the multi\_backend, but it won't use any
&gt;&gt;&gt;&gt;&gt;&gt; parameters passed in in the third parameter. If I set it up as an
&gt;&gt;&gt;&gt;&gt;&gt; application, you can't select it as a backend. If I use both, I get an 
&gt;&gt;&gt;&gt;&gt;&gt; error
&gt;&gt;&gt;&gt;&gt;&gt; with the erlang open\_port command (guess it's trying to spawn it twice 
&gt;&gt;&gt;&gt;&gt;&gt; if I
&gt;&gt;&gt;&gt;&gt;&gt; have it under multi\_backend and configured as an app).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Is the solution here to modify the innostore.app file to give me the
&gt;&gt;&gt;&gt;&gt;&gt; defaults I want, build it then install innostore (if I set it up only 
&gt;&gt;&gt;&gt;&gt;&gt; under
&gt;&gt;&gt;&gt;&gt;&gt; multi\_backend, it will work, but with the default app settings)?
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; If I've just completely missed the mark, don't be afraid to mock me
&gt;&gt;&gt;&gt;&gt;&gt; :).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; - Joe Lambert
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; joseph.g.lamb...@gmail.com
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;


app.config
Description: Binary data
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

