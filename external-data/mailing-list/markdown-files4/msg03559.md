---
title: "Re: Correct way to use pbc/mapreduce to do multiget where keys and	bucket names are binary values?"
description: ""
project: community
lastmod: 2011-06-04T13:54:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03559"
mailinglist_parent_id: "msg03556"
author_name: "Jacques"
project_section: "mailinglistitem"
sent_date: 2011-06-04T13:54:22-07:00
---


Interesting. Are there any benefits to maintaining the json version of the
map reduce definition for the pb client? If the erlang version of the
mapreduce definition offers a superset of the json functionality, couldn't
it simply replace the json version?

Thoughts?

I guess one downside would be not being able to share the code with the http
version of the client. (But this is begs the question of why ultimately to
have the http client for anything but calls the pb client doesn't support).

As an aside, I ran across your alternative ideas around a cleaner riak
client api and on first glance it definitely looks more usable.

I have to run off but will drill into this on Monday. Thanks again for your
help!

Jacques


On Sat, Jun 4, 2011 at 1:19 PM, Russell Brown  wrote:

&gt;
&gt; On 4 Jun 2011, at 18:22, Jacques wrote:
&gt;
&gt; I like the sound of option 3 also. I'll have a look at it this weekend and
&gt;&gt; get back to you.
&gt;&gt;
&gt;
&gt; Awesome! Thanks. If you can give me a point in the right direction
&gt; regarding the correct typing approach and what not, I'm up for giving it a
&gt; shot as well.
&gt;
&gt;
&gt; Ok, I have a half working hack. It isn't pretty 'cos the Jinterface API is
&gt; verbose. I've hacked the pbc.MapReduceBuilder to encode the job as
&gt; "application/x-erlang-binary" and submit that, but really this code should
&gt; be in a separate class, maybe using the output from
&gt; MapReduceBuilder.getJSON() as input. That way you can get the feature
&gt; without patching the client.
&gt;
&gt; What I haven't done is decode the response from Riak yet. If you want a
&gt; pointer here is a gist of the (unclean) hack. It could use a lot of work,
&gt; but it proves the concept:
&gt;
&gt; https://gist.github.com/1008293
&gt;
&gt; The gist is just the diff so you can apply it as a patch
&gt; to src/main/java/com/basho/riak/pbc/mapreduce/MapReduceBuilder.java if you
&gt; want to play with it.
&gt;
&gt; You'll have to add Jinterface to your pom too.
&gt;
&gt; 
&gt; 
&gt; org.erlang.otp
&gt; jinterface
&gt; 1.5.4
&gt; 
&gt;
&gt; I think it is best to put the result decoding outside the library too. I'm
&gt; going to hack up a poc for that now, but I thought I'd post what I have thus
&gt; far.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt;
&gt; Thanks again,
&gt; Jacques
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

