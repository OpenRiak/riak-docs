---
title: "Re: Partitions repair isn't working anymore?"
description: ""
project: community
lastmod: 2018-06-01T02:10:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18556"
mailinglist_parent_id: "msg18536"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2018-06-01T02:10:40-07:00
---



&gt; On 1 Jun 2018, at 10:07, Guido Medina  wrote:
&gt; 
&gt; The last command should have been like the following:
&gt; • {ok, Ring} = riak\_core\_ring\_manager:get\_my\_ring().
&gt; • Partitions = [P || {P, 'r...@node4.domain.com'} &lt;- 
&gt; riak\_core\_ring:all\_owners(Ring)].
&gt; • [riak\_kv\_vnode:repair(P) || P &lt;- Partitions].
&gt; My bad, I think I copied the command from the wrong instructions before.

And does that work?

From your mail you said that 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; )3&gt; [riak\_search\_vnode:repair(P) || P &lt;- Partitions].
&gt;&gt;&gt;&gt;&gt;&gt;&gt; \*\* exception error: undefined function riak\_search\_vnode:repair/1
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 

Does not work. This I would expect, and I was asking, why do you run this? Are 
you using legacy search?

If you run 

&gt; • [riak\_kv\_vnode:repair(P) || P &lt;- Partitions].

Does it work?

Cheers

Russell

&gt; 
&gt; Guido.
&gt; 
&gt; On 01/06/18 09:37, Russell Brown wrote:
&gt;&gt; I don’t see a call to `riak\_search\_vnode:repair` in those docs
&gt;&gt; 
&gt;&gt; Do you still run legacy riak search (i.e. not yokozuna/solr)?
&gt;&gt; 
&gt;&gt; 
&gt;&gt;&gt; On 1 Jun 2018, at 09:35, Guido Medina 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Sorry, not repairing a single partition but all partitions per node:
&gt;&gt;&gt; 
&gt;&gt;&gt; https://docs.basho.com/riak/kv/2.2.3/using/repair-recovery/repairs/#repairing-all-partitions-on-a-node
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On 01/06/18 09:34, Guido Medina wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Hi Russell,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I was repairing each node as specified in this guide 
&gt;&gt;&gt;&gt; https://docs.basho.com/riak/kv/2.2.3/using/repair-recovery/repairs/#repairing-a-single-partition
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Guido.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On 01/06/18 09:16, Russell Brown wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; riak\_search has been removed from riak-2.2.5. Looks like some vestige 
&gt;&gt;&gt;&gt;&gt; survived. 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Can you tell me what command you ran, it looks to me from the output 
&gt;&gt;&gt;&gt;&gt; below that you’re connected to node and typing commands in the console?
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Is this some snippet that you attach and run?
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Cheers
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Russell
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; On 1 Jun 2018, at 09:07, Guido Medina 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; Hi all,
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; We started the partitions repair a couple of weeks ago, so far so good 
&gt;&gt;&gt;&gt;&gt;&gt; (3 nodes out of 7 done), then we started getting this error:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; (r...@node4.domain.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; )3&gt; [riak\_search\_vnode:repair(P) || P &lt;- Partitions].
&gt;&gt;&gt;&gt;&gt;&gt;&gt; \*\* exception error: undefined function riak\_search\_vnode:repair/1
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; The first two steps for the node repair executed fine:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; {ok, Ring} = riak\_core\_ring\_manager:get\_my\_ring().
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Partitions = [P || {P, '
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; r...@node4.domain.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; '} &lt;- riak\_core\_ring:all\_owners(Ring)].
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; We are running on 2.2.5
&gt;&gt;&gt;&gt;&gt;&gt; Guido.
&gt;&gt;&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; 
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

