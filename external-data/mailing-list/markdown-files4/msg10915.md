---
title: "Re: Experimental branch - 2i query improvements"
description: ""
project: community
lastmod: 2013-04-17T03:43:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10915"
mailinglist_parent_id: "msg10914"
author_name: "Olav Frengstad"
project_section: "mailinglistitem"
sent_date: 2013-04-17T03:43:52-07:00
---


Yes, but also include funs in Riak and could be enabled by
passing sending. To enable regex matching the args might contain a 'regex'
atom. Taking the my previous example you could match a timerange by
passing a term [{datetime, [{month, [8], {hour, [{8, 16}]}]}] which
translates to anything in august between 08:00 and 16:00.

I would be happy to assist with the implementation if you want.

Taking a quick peek riak-erlang-client and riak\_pb it would need some
additional changes to be able to pass opts but it's not to difficult.

Any other opinions on implementing such feature?

Olav

2013/4/17 Martin Sumner 

&gt; Olav,
&gt;
&gt; Do you mean similar to passing a map function into M/R, but a function
&gt; which is applied to the term rather than the object? I agree that would be
&gt; neater, and much more powerful ... I just don't know how to do it.
&gt;
&gt; I'm short of time at the moment to progress this, but perhaps in the next
&gt; couple of weeks I may try and revisit that idea.
&gt;
&gt; Martin
&gt;
&gt;
&gt; On 17 April 2013 11:06, Olav Frengstad  wrote:
&gt;
&gt;&gt; The features sounds very promising, from a ease-of-use perspective
&gt;&gt; feature #3 and #4 definitely have great value. Being able to do
&gt;&gt; multi-conditional 2i queries based on composite keys is something
&gt;&gt; im personally excited about.
&gt;&gt;
&gt;&gt; Out of curiosity, have you thought about adding additional flexibility
&gt;&gt; to the query iterator by being able to add "pluggable" match functions?
&gt;&gt; Especially I'm thinking of querying ISO-8601 dates that matches a
&gt;&gt; certain criteria (eg get all data between 08:00-16:00 in august for
&gt;&gt; all years). At least facilitating for more advanced matching functions
&gt;&gt; could be a good idea.
&gt;&gt;
&gt;&gt; Olav
&gt;&gt;
&gt;&gt; 2013/4/16 Martin Sumner :
&gt;&gt; &gt; I've been working on an experimental branch to offer some improvements
&gt;&gt; to
&gt;&gt; &gt; the functionality and performance of 2i queries in Riak:
&gt;&gt; &gt; https://github.com/martinsumner/riak\_kv
&gt;&gt; &gt;
&gt;&gt; &gt; Explanation:
&gt;&gt; &gt;
&gt;&gt; https://github.com/martinsumner/riak\_kv/blob/master/docs/index\_speedup.md
&gt;&gt; &gt;
&gt;&gt; &gt; There are four basic features that are included:
&gt;&gt; &gt; 1. The ability to pin particular 2i indexes into memory (without loss of
&gt;&gt; &gt; consistency on restart of a node)
&gt;&gt; &gt; 2. The ability to set partition-level static bloom filters for
&gt;&gt; particular 2i
&gt;&gt; &gt; indexes to greatly reduce the disk overheads of exact-term queries with
&gt;&gt; &gt; small result sets (e.g. for queries by a secondary identifier such as
&gt;&gt; email
&gt;&gt; &gt; address)
&gt;&gt; &gt; 3. The ability to return indexterms, not just keys as results of a
&gt;&gt; query -
&gt;&gt; &gt; so that those terms can be overloaded with additional information which
&gt;&gt; can
&gt;&gt; &gt; then be filtered by the application without requiring a M/R stage (note
&gt;&gt; this
&gt;&gt; &gt; is already available via Russell Brown's branch -
&gt;&gt; &gt; https://github.com/basho/riak\_kv/tree/pt34-index-values)
&gt;&gt; &gt; 4. The ability to pass a regular expression to the query iterator - so
&gt;&gt; that
&gt;&gt; &gt; range queries will be filtered based on matches to that regular
&gt;&gt; expression
&gt;&gt; &gt; (for example allowing for non-trailing wildcards) before returning the
&gt;&gt; keys
&gt;&gt; &gt; and terms
&gt;&gt; &gt;
&gt;&gt; &gt; Testing is slight at the moment, both functionally and non-functionally.
&gt;&gt; &gt; This is still very-much an experiment. We're hoping to do some full
&gt;&gt; scale
&gt;&gt; &gt; volume testing on the branch in the next couple of weeks.
&gt;&gt; &gt;
&gt;&gt; &gt; The branch has been developed to solve some problems we have with edge
&gt;&gt; cases
&gt;&gt; &gt; in our implementation for the NHS in England - where we have to support
&gt;&gt; &gt; tracing across an 80M record demographic database. I'd be interested if
&gt;&gt; &gt; people thought it had value in other environments.
&gt;&gt; &gt;
&gt;&gt; &gt; Regards
&gt;&gt; &gt;
&gt;&gt; &gt; Martin
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Med Vennlig Hilsen
&gt;&gt; Olav Frengstad
&gt;&gt;
&gt;&gt; Systemutvikler // FWT
&gt;&gt; +47 920 42 090
&gt;&gt;
&gt;
&gt;


-- 
Med Vennlig Hilsen
Olav Frengstad

Systemutvikler // FWT
+47 920 42 090
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

