---
title: "Re: Riak packaging for RPM-based distros"
description: ""
project: community
lastmod: 2013-01-09T14:00:29-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09776"
mailinglist_parent_id: "msg09775"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2013-01-09T14:00:29-08:00
---


&gt;
&gt; &gt; Right now if someone has a problem, I can say, "tell me what ./riak
&gt; version says"
&gt; &gt; and know exactly what is running.
&gt;
&gt; Mostly true, but... Most deps in 'rebar.config' files links to HEAD of
&gt; 'master' branch. Seems output of './riak version' is not enough.
&gt; Anyway, when packaging is done right way (no packages was built with
&gt; new code but old version), 'rpm -q $pkgname' (for example) will give
&gt; good start point.


For releases that's not true. At RC time all rebar.config files change to
fix each dependency on a tag. If we don't control the repo (such as
folsom), I fix the tag on an exact commit. So for each version of Riak
released since about 0.14.2 we can tell you the exact list of commits that
went into each release. If you download the source tarball at each release
you can get the dependency\_manifest.txt file (I added this around 1.0 I
think) it further lists all the tags used for reference.

You can checkout a tag like riak-1.2.0 in basho/riak, do a 'make deps',
then a './rebar list-deps' and you'll see that no repo is a floating commit
or branch.

Thanks,
-Jared



On Wed, Jan 9, 2013 at 1:34 PM, Aleksey Morarash  wrote:

&gt; 2013/1/9 Jared Morrow 
&gt; &gt; In our case, making a distributed database that people depend on to be
&gt; stable and
&gt; &gt; performant also requires us to control the Erlang VM we use. In a
&gt; particular case,
&gt; &gt; we've been fighting Erlang scheduler issues in regards to our use of
&gt; NIF's that has
&gt; &gt; changed behavior between versions of Erlang. Because of this issue, we
&gt; haven't
&gt; &gt; moved forward on using new versions past R15B02 of erlang. Because we
&gt; are
&gt; &gt; responsible for any problems with Riak, I do not see anytime in the
&gt; future we will
&gt; &gt; give up control of the Erlang we use at the expense of a slightly larger
&gt; rpm / deb / tgz
&gt; &gt; size. That was just one example, another is the use of HiPE or no HiPE
&gt; where
&gt; &gt; we've found segfaults when using HiPE on SunOS or \*BSD due to fixed
&gt; memory buffer sizes.
&gt;
&gt; Hm. I`m familiar with such problems too :)
&gt;
&gt; &gt; Regarding packaging components as separate RPM's. This is another thing
&gt; that
&gt; &gt; distributions have tried to get us to do, make a riak\_core, riak\_kv,
&gt; erlang\_js, etc.,
&gt; &gt; etc. rpm. Again, I see no benefit at all to people who use riak. This
&gt; is a benefit
&gt; &gt; solely to fit into packaging guidelines made by distributions. When
&gt; testing such a
&gt; &gt; complicated system such as Riak, breaking it up into 30 pieces would
&gt; simply make
&gt; &gt; testing harder and the product less stable. Unless you are writing a
&gt; riak\_core app,
&gt; &gt; who would just \*just\* want a riak\_core RPM anyway?
&gt;
&gt; Agree. Code, related only to Riak we can package in one package.
&gt; Creating package for each Erlang application is not strict dogma.
&gt;
&gt; &gt; Right now if someone has a problem, I can say, "tell me what ./riak
&gt; version says"
&gt; &gt; and know exactly what is running.
&gt;
&gt; Mostly true, but... Most deps in 'rebar.config' files links to HEAD of
&gt; 'master' branch. Seems output of './riak version' is not enough.
&gt; Anyway, when packaging is done right way (no packages was built with
&gt; new code but old version), 'rpm -q $pkgname' (for example) will give
&gt; good start point.
&gt;
&gt; &gt;&gt; - honor filesystem hierarchy of underlying OS.
&gt; &gt; This one I'd like to hear more about. I've made some changes along the
&gt; way for systems
&gt; &gt; I didn't know as much about at first pass (mainly SunOS flavors), but I
&gt; know for a fact we
&gt; &gt; haven't got everything right. If you have some examples of where we are
&gt; doing it wrong
&gt; &gt; in regards to our install, please let me know or file a bug at
&gt; https://github.com/basho/riak
&gt;
&gt; Ok, I will.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

