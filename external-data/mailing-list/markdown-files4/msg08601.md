---
title: "Re: Evolving data model"
description: ""
project: community
lastmod: 2012-09-19T15:03:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08601"
mailinglist_parent_id: "msg08600"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2012-09-19T15:03:14-07:00
---


I have also used Bip's method and found it successful. You do need to be 
careful to make sure
all reads of your data go through this upgrade-path, but that is easy once you 
realize it :).


Reid

On Sep 19, 2012, at 5:44 PM, Bip Thelin  wrote:

&gt; We use a technique that works well for our use case:
&gt; We store everything as JSON and use the erlang-client, for every object we 
&gt; store we add an opaque schema\_version tag to the JSON and then in our model 
&gt; encode/decode routine we parse this schema\_version and if the version is not 
&gt; the latest according to the model we recurse and upgrade the payload all the 
&gt; way up to the current version and then return the new object to the client 
&gt; and spawn an async process that saves the new object back.
&gt; 
&gt; So for instance an object is at schema\_version 1 when it get's read. The 
&gt; model is now on version 5 there will be five functions, i.e:
&gt; upgrade\_version(2, Payload) -&gt;
&gt; do\_something();
&gt; upgrade\_version(3, Payload) -&gt;
&gt; etc...
&gt; 
&gt; every function knows how to upgrade itself from it's former version so fast 
&gt; forwarding through version is easy and every object will get upgraded 
&gt; eventually (if the get read).
&gt; 
&gt; --
&gt; Bip Thelin
&gt; 
&gt; KIVRA | Lugnets All√© 1 | 120 33 Stockholm
&gt; Tel 08-533 335 37 | Mob 0735-18 18 90
&gt; www.kivra.com
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On 19 sep 2012, at 00:55, Allen Johnson  wrote:
&gt; 
&gt;&gt; Hey everyone,
&gt;&gt; 
&gt;&gt; I'm beginning to experiment with Riak and I'm trying to better
&gt;&gt; understand how to model my data. One question I have at the moment is
&gt;&gt; how to evolve my data with a data store such as Riak? I know that
&gt;&gt; it's schema-less and that I can add new fields as needed but I'm
&gt;&gt; thinking more about the existing documents.
&gt;&gt; 
&gt;&gt; For example, say hypothetically, that I have a fairly successful
&gt;&gt; riak-based app. As the application code continues to evolve over
&gt;&gt; several versions I begin to find a "better" way to model my data. By
&gt;&gt; this time I have already stored many, many documents. What is the
&gt;&gt; appropriate path here? Do I version my documents with metadata and
&gt;&gt; rely on my application code to continue to deal with old-style
&gt;&gt; documents -- or do I perform some sort of bulk transformation on these
&gt;&gt; existing documents?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Allen
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

