---
title: "Re: Precommit hook function - no error log - how to debug?"
description: ""
project: community
lastmod: 2016-05-16T08:31:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17374"
mailinglist_parent_id: "msg17373"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2016-05-16T08:31:07-07:00
---


Sanket,

I can't speak to the output of cluster-info with regard to the precomit hook.

If you save an object to the "test\_kv" bucket, does
rtriggers:pre\_all() get called?

I have confirmed that precommit hooks are \*NOT\* triggered for buckets
where "write\_once" is true, and filed the following docs issue:
https://github.com/basho/basho\_docs/issues/2076

--
Luke Bakken
Engineer
lbak...@basho.com


On Mon, May 16, 2016 at 8:20 AM, Sanket Agrawal
 wrote:
&gt; Shouldn't precommit body show up in cluster-info first before we try to test
&gt; it with an object? I just set the precommit hook for test\_kv bucket type
&gt; which has no custom property set. Curl on props shows precommit, but
&gt; cluster-info doesn't (took another dump after 5 minutes of precommit hook
&gt; creation). No sasl logging is triggered either though the debug mode is on.
&gt;
&gt; Curl output for test\_kv props:
&gt;
&gt;
&gt;&gt;
&gt;&gt; $ curl localhost:8098/types/test\_kv/props
&gt;&gt;
&gt;&gt; {"props":{"active":true,"allow\_mult":true,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"claimant":"riak1@127.0.0.1","dvv\_enabled":true,"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"rtriggers","fun":"pre\_all"}],"pw":0,"r":"quorum","rw":"quorum","small\_vclock":50,"w":"quorum","young\_vclock":20}}
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; Cluster-info dump after setting the props - precommit body is still empty in
&gt; the cluster-info for test\_kv bucket type:
&gt;
&gt;&gt;
&gt;&gt; grep -A15 test\_kv cluster\_info.txt |grep precommit
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;&gt; {precommit,[]},
&gt;
&gt;
&gt; On Mon, May 16, 2016 at 10:48 AM, Luke Bakken  wrote:
&gt;&gt;
&gt;&gt; Hi Sanket,
&gt;&gt;
&gt;&gt; Thanks for providing that information, this is the first time that the
&gt;&gt; "write\_once" bucket type property was mentioned.
&gt;&gt;
&gt;&gt; If you set the precommit hook on a different bucket type where there
&gt;&gt; are \*no other\* custom bucket type properties set, does the precommit
&gt;&gt; hook run successfully?
&gt;&gt;
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer
&gt;&gt; lbak...@basho.com
&gt;&gt;
&gt;&gt; On Mon, May 16, 2016 at 7:17 AM, Sanket Agrawal
&gt;&gt;  wrote:
&gt;&gt; &gt; Hi Luke,
&gt;&gt; &gt;
&gt;&gt; &gt; More on the precommit hook debugging I just did - I might have a handle
&gt;&gt; &gt; on
&gt;&gt; &gt; what the problem is. I took a cluster-info dump for all the nodes in the
&gt;&gt; &gt; cluster. In the dump, precommit is set to [] for all the buckets in the
&gt;&gt; &gt; cluster. The reason for that seems to be that the bucket type with
&gt;&gt; &gt; "write-once" property where precommit hook is set, is not in the cluster
&gt;&gt; &gt; somehow!
&gt;&gt; &gt;
&gt;&gt; &gt; The bucket type name is "test\_kv\_wo". Let us grep for it in
&gt;&gt; &gt; cluster\_info.txt
&gt;&gt; &gt; - it doesn't show up at all (another bucket type "test\_kv" shows up
&gt;&gt; &gt; instead):
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; $ grep test\_kv cluster\_info.txt | sort -u
&gt;&gt; &gt;&gt; [[{bucket,&lt;&lt;"test\_kv"&gt;&gt;}|
&gt;&gt; &gt;&gt; {name,&lt;&lt;"test\_kv"&gt;&gt;},
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Now, let us verify we can get the props for the bucket type fine from
&gt;&gt; &gt; curl:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; $ curl localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; {"props":{"name":"uuid\_log","active":true,"allow\_mult":true,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"claimant":"riak1@127.0.0.1","dvv\_enabled":true,"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"uuid\_log","notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"rtriggers","fun":"pre\_uuid"}],"pw":0,"r":"quorum","rw":"quorum","small\_vclock":50,"w":"quorum","write\_once":true,"young\_vclock":20}}
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; So, the problem might be missing bucket types in the cluster since they
&gt;&gt; &gt; don't show up in cluster-info at all? The same thing happens with LWW
&gt;&gt; &gt; bucket
&gt;&gt; &gt; type that I created, test\_kv\_lww. It doesn't show up either. CRDT bucket
&gt;&gt; &gt; types show up fine.
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

