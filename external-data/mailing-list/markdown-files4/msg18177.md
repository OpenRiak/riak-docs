---
title: "Leveled, Riak and Hashtree rebuilds"
description: ""
project: community
lastmod: 2017-04-24T04:06:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18177"
author_name: "Martin Sumner"
project_section: "mailinglistitem"
sent_date: 2017-04-24T04:06:46-07:00
---


The next phase of Riak and Leveled testing is now complete, with this phase
focused on achieving stable throughput during hashtree rebuilds. this
scenario has been tested due to a history of issues with the cost of
hashtree rebuilds in Riak production environments, and looks at
improvements offered by both leveled and the new riak\_kv\_sweeper feature in
the KV develop branch.

Test information and results can be found here -
https://github.com/martinsumner/leveled/blob/master/docs/VOLUME.md#riak-cluster-test---phase-2---aae-rebuild

The test takes a scenario which should be fairly favourable to leveldb
(using SSDs with sync\_on\_write disabled), although still with mid-size
objects favourable to leveled (8KB size). The test tries to push
throughput with aae enabled with aggressive hashtree rebuilds.

In the 6th hour of the test Riak/leveled was achieving 11,283 ops/s
compared to 7,304 ops/s with Riak/leveldb. As before volatility of
throughput and tail latency is reduced significantly with leveled, but that
improvement does come with some caveats explained in the link above.

Next stage will be to address the short-comings of compaction and
anti-entropy in the value store (Journal) in leveled. Further results
should be available in the next 3 or 4 weeks.

Martin
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

