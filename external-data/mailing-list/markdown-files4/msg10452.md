---
title: "Re: Binary data"
description: ""
project: community
lastmod: 2013-03-14T18:44:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10452"
mailinglist_parent_id: "msg10448"
author_name: "OJ Reeves"
project_section: "mailinglistitem"
sent_date: 2013-03-14T18:44:49-07:00
---


Kevin,

Please take a look at this sample application:

https://github.com/DistributedNonsense/CorrugatedIron.ImageStore

I've just thrown it together for you. It is a sample Winforms application
which shows how to store and retrieve image data using CorrugatedIron. It's
not a production application by any means, but it does demonstrate how to
do what you're trying to do. All the images that are stored in Riak using
this sample application are accessible via cURL and render correctly. So if
you store an image, you should be able to use any other client to pull the
image down and view it in an image viewer.

The one thing to note is that in your code you were specifying a character
set of UTF8, which isn't correct for binary data.

Please take a look at the application and its source, it will show you what
to do.

HTH.
OJ

On Fri, Mar 15, 2013 at 8:28 AM, Kevin Burton wrote:

&gt; I know that if I specify an incorrect content type such as
&gt; application/json for the binary data then I get close to 6MB back so there
&gt; is some interpretation. \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*From:\* Kevin Burton [mailto:rkevinbur...@charter.net]
&gt; \*Sent:\* Thursday, March 14, 2013 5:16 PM
&gt; \*To:\* 'Jeremiah Peschka'
&gt; \*Cc:\* 'riak-users'
&gt; \*Subject:\* RE: Binary data\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Good. Is this the correct way to do it? Basically it is a modification of
&gt; the program that I have been using for the JSON data. Here is the modified
&gt; code:\*\*\*\*
&gt;
&gt; string fileName = "..\\..\\test.jpg";\*\*\*\*
&gt;
&gt; string bucket = "images";\*\*\*\*
&gt;
&gt; byte[] buffer = File.ReadAllBytes(fileName);\*\*\*\*
&gt;
&gt; Debug.WriteLine("number of bytes read: " + buffer.Length);\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; IRiakEndPoint cluster = RiakCluster.FromConfig("riakConfig");\*
&gt; \*\*\*
&gt;
&gt; IRiakClient riakClient = cluster.CreateClient();\*\*\*\*
&gt;
&gt; RiakResult pingResult = riakClient.Ping();\*\*\*\*
&gt;
&gt; if (pingResult.IsSuccess)\*\*\*\*
&gt;
&gt; {\*\*\*\*
&gt;
&gt; RiakObject value = new RiakObject(bucket,\*\*\*\*
&gt;
&gt; "1.jpg",\*\*\*\*
&gt;
&gt; buffer,\*\*\*\*
&gt;
&gt; RiakConstants.
&gt; ContentTypes.ImageJpg,\*\*\*\*
&gt;
&gt; RiakConstants.CharSets
&gt; .Utf8);\*\*\*\*
&gt;
&gt; RiakResult response = riakClient.Put(value);\*\*
&gt; \*\*
&gt;
&gt; if (!response.IsSuccess)\*\*\*\*
&gt;
&gt; {\*\*\*\*
&gt;
&gt; Debug.WriteLine(string.Format("Error ('{0}' - {1}:
&gt; Writing {2}",\*\*\*\*
&gt;
&gt; response.ErrorMessage,\*\*\*\*
&gt;
&gt; response.ResultCode,\*\*\*\*
&gt;
&gt; "1.jpg"));\*\*\*\*
&gt;
&gt; }\*\*\*\*
&gt;
&gt; }\*\*\*\*
&gt;
&gt; }\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*From:\* Jeremiah Peschka 
&gt; [mailto:jeremiah.pesc...@gmail.com]
&gt;
&gt; \*Sent:\* Thursday, March 14, 2013 4:57 PM
&gt; \*To:\* Kevin Burton
&gt; \*Cc:\* riak-users
&gt; \*Subject:\* Re: Binary data\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; How are you reading the JPEG and saving it to Riak? A code sample would be
&gt; lovely.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; CorrugatedIron doesn't need a `--data-binary` option. All operations are
&gt; performed over the protocol buffers interface (barring several bucket
&gt; properties operations) - we don't alter any data that comes in to CI, we
&gt; just send and receive bytes on a socket. Much like curl, though, if you
&gt; send in junk data, CI is happily going to return that junk data back to you.
&gt; \*\*\*\*
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; ---\*\*\*\*
&gt;
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\*\*\*\*
&gt;
&gt; MCITP: SQL Server 2008, MVP\*\*\*\*
&gt;
&gt; Cloudera Certified Developer for Apache Hadoop\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Thu, Mar 14, 2013 at 2:12 PM, Kevin Burton 
&gt; wrote:\*\*\*\*
&gt;
&gt; I read on the FAQ how to get the same number of bytes as was stored:\*\*\*\*
&gt;
&gt; When storing a non-text object like a PNG file in Riak and then retrieving
&gt; it with curl, it comes back a different size. For Example:\*\*\*\*
&gt;
&gt; curl -i -\*X\* \*PUT\* --data \*@\*g005.\*PNG\_L\* -\*H\* "Content-Type: image/png"
&gt; http://sfdev02:8098/luwak/g005.PNG\_L\*\*\*\*
&gt;
&gt; Curl will try to convert non-ASCII characters in PUT and POST bodies. Use
&gt; the --data-binary flag to turn this off:\*\*\*\*
&gt;
&gt; curl -i -\*X\* \*PUT\* --data-binary \*@\*g005.\*PNG\_L\* -\*H\* "Content-Type:
&gt; image/png" http://sfdev02:8098/luwak/g005.PNG\_L\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; Is there an option like ‘—data-binary’ for CorrugatedIron? I am ‘put’ing
&gt; what should be binary data but if I retrieve the data with curl I get a
&gt; different size and if the binary data is a jpeg image it comes back as
&gt; corrupted?\*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 

OJ Reeves
+61 431 952 586
http://buffered.io/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

