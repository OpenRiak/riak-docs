---
title: "preflist_exhausted with map-reduce and riak-js"
description: ""
project: community
lastmod: 2012-04-02T15:25:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07116"
mailinglist_parent_id: "msg07106"
author_name: "Matthew Tovbin"
project_section: "mailinglistitem"
sent_date: 2012-04-02T15:25:32-07:00
---


Unfortunately, yes, Jon.

Here are my log files after setting 128/128 for 'map\_js\_vm\_count' and
'reduce\_js\_vm\_count' accordingly and restarting all the nodes (see attached
app.config).

If you need any other information provided or tests performed please let me
know.

\*-Console.log:\*
2012-04-02 15:16:56.848 [notice]
&lt;0.22138.162&gt;@riak\_kv\_js\_manager:blocking\_dispatch:247 JS call failed: All
VMs are busy.
2012-04-02 15:16:56.853 [error] &lt;0.22121.162&gt; gen\_fsm &lt;0.22121.162&gt; in
state wait\_pipeline\_shutdown terminated with reason: {sink\_died,shutdown}
2012-04-02 15:16:56.860 [error] &lt;0.22121.162&gt; CRASH REPORT Process
&lt;0.22121.162&gt; with 0 neighbours crashed with reason: {sink\_died,shutdown}
2012-04-02 15:16:56.862 [error] &lt;0.1451.0&gt; Supervisor riak\_pipe\_builder\_sup
had child undefined started with {riak\_pipe\_builder,start\_link,undefined}
at &lt;0.22121.162&gt; exit with reason {sink\_died,shutdown} in context
child\_terminated

\*-Error.log:\*
\*\* State machine &lt;0.22121.162&gt; terminating
\*\* Last message in was
{'DOWN',#Ref&lt;0.0.33.48784&gt;,process,&lt;0.22119.162&gt;,shutdown}
\*\* When State == wait\_pipeline\_shutdown
\*\* Data ==
{state,[{sink,{fitting,&lt;0.22119.162&gt;,#Ref&lt;0.0.33.48768&gt;,{riak\_kv\_pipe\_get,bkey\_chash},{riak\_kv\_pipe\_get,bkey\_nval}}},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},{log,{sink,{fitting,&lt;0.21554.162&gt;,#Ref&lt;0.0.33.48768&gt;,sink,undefined}}}],{pipe,&lt;0.22121.162&gt;,[{listkeys,{fitting,&lt;0.22122.162&gt;,#Ref&lt;0.0.33.48768&gt;,{chash,key\_of},1}}],{fitting,&lt;0.22119.162&gt;,#Ref&lt;0.0.33.48768&gt;,{riak\_kv\_pipe\_get,bkey\_chash},{riak\_kv\_pipe\_get,bkey\_nval}}},[{{fitting,&lt;0.22122.162&gt;,#Ref&lt;0.0.33.48768&gt;,{chash,key\_of},1},#Ref&lt;0.0.33.48787&gt;}],#Ref&lt;0.0.33.48784&gt;}
\*\* Reason for termination =
\*\* {sink\_died,shutdown}
2012-04-02 15:16:56 =CRASH REPORT====
 crasher:
 initial call: riak\_pipe\_builder:init/1
 pid: &lt;0.22121.162&gt;
 registered\_name: []
 exception exit: {sink\_died,shutdown}
 in function gen\_fsm:terminate/7
 in call from proc\_lib:init\_p\_do\_apply/3
 ancestors: [riak\_pipe\_builder\_sup,riak\_pipe\_sup,&lt;0.1448.0&gt;]
 messages: [{'DOWN',#Ref&lt;0.0.33.48787&gt;,process,&lt;0.22122.162&gt;,shutdown}]
 links: [&lt;0.1451.0&gt;]
 dictionary:
[{eunit,[{module,riak\_pipe\_builder},{ref,#Ref&lt;0.0.33.48768&gt;},{spec,[{fitting\_spec,listkeys,riak\_kv\_pipe\_listkeys,undefined,{chash,key\_of},1,64}]},{options,[{sink,{fitting,&lt;0.22119.162&gt;,#Ref&lt;0.0.33.48768&gt;,{riak\_kv\_pipe\_get,bkey\_chash},{riak\_kv\_pipe\_get,bkey\_nval}}},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},{log,{sink,{fitting,&lt;0.21554.162&gt;,#Ref&lt;0.0.33.48768&gt;,sink,undefined}}}]},{fittings,[{{fitting,&lt;0.22122.162&gt;,#Ref&lt;0.0.33.48768&gt;,{chash,key\_of},1},#Ref&lt;0.0.33.48787&gt;}]}]}]
 trap\_exit: false
 status: running
 heap\_size: 987
 stack\_size: 24
 reductions: 251
 neighbours:
2012-04-02 15:16:56 =SUPERVISOR REPORT====
 Supervisor: {local,riak\_pipe\_builder\_sup}
 Context: child\_terminated
 Reason: {sink\_died,shutdown}
 Offender:
[{pid,&lt;0.22121.162&gt;},{name,undefined},{mfargs,{riak\_pipe\_builder,start\_link,undefined}},{restart\_type,temporary},{shutdown,brutal\_kill},{child\_type,worker}]


-Matthew



On Mon, Apr 2, 2012 at 12:27, Jon Meredith  wrote:

&gt; Very strange.
&gt;
&gt; Are you seeing the
&gt;
&gt; 16:40:50.037 [notice] JS call failed: All VMs are busy.
&gt;
&gt; message in your console.log files on any of the nodes in your cluster?
&gt;
&gt; Jon
&gt;
&gt;
&gt; On Mon, Apr 2, 2012 at 11:48 AM, Matthew Tovbin wrote:
&gt;
&gt;&gt; Jon,
&gt;&gt;
&gt;&gt; Thanks for the reply. I tried increasing the 'map\_js\_vm\_count' and
&gt;&gt; 'reduce\_js\_vm\_count' on the cluster to the values you suggested 24/18
&gt;&gt; and even larger ones 32/24 and 128/128, but with no success - I still get
&gt;&gt; the same error in the console log of the node.
&gt;&gt;
&gt;&gt; What are we missing?!
&gt;&gt;
&gt;&gt; -Matthew
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;


app.config
Description: Binary data
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

