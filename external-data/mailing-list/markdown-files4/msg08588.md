---
title: "Re: preflist_exhausted"
description: ""
project: community
lastmod: 2012-09-18T14:40:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08588"
mailinglist_parent_id: "msg08583"
author_name: "Darrel Grant"
project_section: "mailinglistitem"
sent_date: 2012-09-18T14:40:17-07:00
---


More info, in case it helps someone help me figure out what has gone wrong.
I suspect I have something misconfigured, or not configured, that is
affecting the mapreduce js vms.

I followed the instructions on this thread:
http://riak-users.197444.n3.nabble.com/preflist-exhausted-with-map-reduce-and-riak-js-td3821516.html

In that thread, the guys problem turned out to be a missing
mapred\_builtins.js file. I found mine /usr/lib/riak/lib/riak\_kv-1.2.0/priv
so I don't think my problem is the same.

About using the riak console to find out how many map reduce vms are
available:

(riak@127.0.0.1)5&gt; rpc:multicall(supervisor, count\_children,
[riak\_pipe\_builder\_sup]).
{[[{specs,1},{active,0},{supervisors,0},{workers,0}]],[]}
(riak@127.0.0.1)6&gt; rpc:multicall(supervisor, count\_children,
[riak\_pipe\_fitting\_sup]).
{[[{specs,1},{active,0},{supervisors,0},{workers,0}]],[]}
(riak@127.0.0.1)7&gt;
rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_map]).
{"\b",[]}
(riak@127.0.0.1)9&gt;
rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_reduce]).
{[6],[]}


May be worth noting that those commands product the same weird output
whether my app.config settings are:
 {map\_js\_vm\_count, 32 },
 {reduce\_js\_vm\_count, 32 },
 {hook\_js\_vm\_count, 16 },

Or the outlandishly high:
 {map\_js\_vm\_count, 4096 },
 {reduce\_js\_vm\_count, 4096 },
 {hook\_js\_vm\_count, 256 },


and look nothing like the Mathew Tobvin's output:
3&gt;rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_map]).
{[0,0,0],[]}
4&gt;rpc:multicall(riak\_kv\_js\_manager,pool\_size,[riak\_kv\_js\_reduce]).
{[0,0,0],[]}

Also, the output of those commands is the same after running a mapreduce
job. Once in a while, usually after a fresh riak restart and a bit of time
has passed since the last preflist\_exhausted error, one of my mapreduce
jobs will actually complete successfully. At a mere 10000 keys in one
bucket and exactly 1 user, I do not understand at all what is wrong in my
installation. Does anyone have any suggestions?

Darrel


On Tue, Sep 18, 2012 at 9:27 AM, Darrel Grant  wrote:

&gt; I have about 10000 items in a bucket, and am getting this error a lot.
&gt;
&gt; My app.config settings are already quite a lot higher than any values I've
&gt; come across while googling this issue:
&gt; {map\_js\_vm\_count, 4096 },
&gt; {reduce\_js\_vm\_count, 4096 },
&gt; {hook\_js\_vm\_count, 256 },
&gt; {js\_max\_vm\_mem, 256},
&gt;
&gt; And just steadily increasing them doesn't seem good, because this bucket
&gt; could easily have millions of keys in it in a bit of time.
&gt;
&gt; Interestingly, if I stop and start riak, I can get the results I expect
&gt; from the mapreduce, but if I then run it again, I get the
&gt; preflist\_exhausted error. Is there some setting I am missing, which frees
&gt; up workers after a run, or perhaps causes them to be re-used in some way?
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

