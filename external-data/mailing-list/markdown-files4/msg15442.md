---
title: "Re: Riak stalls, leveldb backend"
description: ""
project: community
lastmod: 2015-01-06T03:02:17-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15442"
mailinglist_parent_id: "msg15441"
author_name: "Sorin Manole"
project_section: "mailinglistitem"
sent_date: 2015-01-06T03:02:17-08:00
---


Hey Andy,

We had the same issue few days ago. We were getting timeouts when trying to
read a key from riak.

Also we were seeing in the logs a warning about reading/writing a large
object. In our case that object was first read from riak and after written
back. It was that big (17Mb) because of some load testing that we did.

We deleted the object and we didn't experience timeouts anymore.

We tried to repro the issue, so we can be sure it was this and we posted a
20Mb json to the same key and the timeouts came back again, deleted the
20Mb object and everything worked fine again.

I don't know why this is happening but we can say that this was the issue
for our timeouts.

Maybe someone has a better understanding on this.. I'd like to be in the
loop of this conversation if possible.

Thanks!
Sorin.

On 5 January 2015 at 18:07, Andy Pellett  wrote:

&gt; Hi all,
&gt;
&gt; I've been experiencing stalls where riak won't return any data (queries
&gt; time out) with my riak cluster. Here are some basic details:
&gt;
&gt; - 8 nodes
&gt; - riak 1.4.10 (upgraded from 1.4.6 -&gt; 1.4.8 -&gt; 1.4.10)
&gt; - leveldb backend
&gt; - n\_val is 2
&gt; - allow\_mult is false
&gt; - ec2 i2.2xlarge boxes (8 cores, 61gb ram, 800gb disk space)
&gt; - about 33% disk space utilization per node
&gt;
&gt; The riak cluster will stall for as long as a few minutes at a time, but
&gt; will otherwise work as expected for hours. There doesn't seem to be an
&gt; obvious pattern as to when the stalls happen.
&gt;
&gt; My first thought was that the stalls may be related to AAE, but I've
&gt; disabled that via 'riak attach' and the settings file. Sidenote, I still
&gt; see messages like:
&gt;
&gt; 2015-01-05 12:24:04.666 [info]
&gt; &lt;0.574.0&gt;@riak\_kv\_entropy\_manager:perhaps\_log\_throttle\_change:826 Changing
&gt; AAE throttle from 0 -&gt; 10 msec/key, based on maximum vnode mailbox size 209
&gt; from 'riak-user@riak-host'
&gt;
&gt; which makes me question whether AAE is actually turned off.
&gt;
&gt; Now I'm leaning towards leveldb compactions being the issue. What can I do
&gt; to verify this is the issue, and how can I fix it?
&gt;
&gt; I see log messages about large objects:
&gt;
&gt; 2015-01-05 16:11:28.046 [warning]
&gt; &lt;0.6398.0&gt;@riak\_kv\_vnode:encode\_and\_put\_no\_sib\_check:1830 Writing very
&gt; large object (11307735 bytes) to &lt;&lt;"BucketName"&gt;&gt;/&lt;&lt;"keys\_1420466400"&gt;&gt;
&gt;
&gt; Could these be causing longer-running compactions, or more frequent
&gt; compactions?
&gt;
&gt; Thanks for reading,
&gt; Andy
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
[image: photo]
\*Sorin Manole\*
Senior Software Engineer, Trustev
m:+353 86 051 2658 | e:sorin.man...@trustev.com | w:www.trustev.com
| a: Trustev Ltd, 2100 Airport
Business Park, Cork, Ireland.

-- 


This message is for the named person's use only. If you received this 
message in error, please immediately delete it and all copies and notify 
the sender. You must not, directly or indirectly, use, disclose, 
distribute, print, or copy any part of this message if you are not the 
intended recipient. Any views expressed in this message are those of the 
individual sender and not Trustev Ltd. Trustev is registered in Ireland No. 
516425 and trades from 2100 Cork Airport Business Park, Cork, Ireland.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

