---
title: "Re: the optimal value of the ring_creation_size"
description: ""
project: community
lastmod: 2013-04-25T14:11:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10978"
mailinglist_parent_id: "msg10975"
author_name: "Dev Vasantharajan"
project_section: "mailinglistitem"
sent_date: 2013-04-25T14:11:34-07:00
---


Speaking of ring resizing, this SO answer from Dmitri could also be good
reference (if you ever wanna go there).

http://stackoverflow.com/questions/14685236/migrating-riak-data-when-ring-size-changes


On Fri, Apr 26, 2013 at 12:04 AM, Dmitri Zagidulin wrote:

&gt; Tom,
&gt;
&gt; Just to emphasize Joe's comment -- 512 should be the \_maximum\_ you want to
&gt; use as your ring size with leveldb/multi backend. But you should probably
&gt; use a smaller size, unless your cluster is going to have several dozen
&gt; nodes.
&gt;
&gt; The recommended rule of thumb with ring size is "~10 vnodes to a physical
&gt; machine". Meaning, if you have a 5 node cluster (and it's going to stay at
&gt; 5 nodes and not scale that much), using a ring size of 64 is perfectly fine
&gt; (since each node is going to have 12 to 13 vnodes on it ( 64 / 5) ).
&gt;
&gt; Say you scale that cluster to 10 nodes, and keep the 64 ring size. Here,
&gt; each machine is going to be running 6 to 7 virtual nodes on it (64/10), and
&gt; will probably be under-utilized, in terms of hardware resources.
&gt; Whereas if you select a ring size of 128 for that 10 node cluster, you're
&gt; back to the 12-13 vnodes per machine range.
&gt;
&gt; On the other hand, if you have a 5 node cluster with a ring size of 512,
&gt; each machine will be responsible for around 100 vnodes, so unless your
&gt; servers are very powerful, they're going to compete with each other for
&gt; resources (ram, cpu, etc) and be overwhelmed. Also, keep in mind, that
&gt; Secondary Index (2i) queries get slower the bigger your ring size is (since
&gt; 2i uses "covering" queries -- each request has to contact half of all the
&gt; vnodes, so it matters whether it has to contact around 32 vnodes (for ring
&gt; size 64) or 256 (for 512)).
&gt;
&gt; So in short, most small to medium sized clusters out there use 128 or 256
&gt; ring sizes. If you \_know\_ you're not going to scale past 7-9 nodes, it's
&gt; safe to go with 64. If you know you're going to scale to a giant cluster of
&gt; 50 nodes or some such, use 512 (though at that point, you should
&gt; re-evaluate your use of Secondary Indexes).
&gt;
&gt; Last thought - migrating to a different ring size is a big pain, although
&gt; it's doable. (You basically have to resort to logical backup tools --
&gt; export all your data from the old cluster to disk, and then import it all
&gt; to the new cluster).
&gt;
&gt; Dmitri
&gt;
&gt;
&gt;
&gt; On Mon, Apr 22, 2013 at 5:30 PM, Tom Zeng  wrote:
&gt;
&gt;&gt; Ok thanks Joe. We plan to switch to the Multi backend, so will use 512.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Apr 22, 2013 at 5:17 PM, Joe Caswell  wrote:
&gt;&gt;
&gt;&gt;&gt; Tom,
&gt;&gt;&gt; There is no hard and fast rule for the "best value." The optimal
&gt;&gt;&gt; value for your situation will need to take into account the physical
&gt;&gt;&gt; resources available both in your starting cluster as well as your planned
&gt;&gt;&gt; end-state cluster. If you plan to use secondary indexing, the maximum
&gt;&gt;&gt; ring\_creation\_size you should consider is 512.
&gt;&gt;&gt; There will be a separate concurrent vnode\_proxy process for each
&gt;&gt;&gt; vnode, and a process for each backend for each vnode. Each backend will
&gt;&gt;&gt; need open file handles and RAM for caching objects. The backend
&gt;&gt;&gt; configuration section of the docs should help plan your backed settings
&gt;&gt;&gt; http://docs.basho.com/riak/1.3.1/tutorials/choosing-a-backend/
&gt;&gt;&gt; Your planning must also include failure scenarios. If any of your
&gt;&gt;&gt; nodes crash, the surviving nodes will each start more vnodes to cover the
&gt;&gt;&gt; missing node(s). The 10 vnodes per node recommendation is to ensure that
&gt;&gt;&gt; the vnodes from any single failed node can be divided among enough
&gt;&gt;&gt; surviving nodes to not leave one node handling significantly more load than
&gt;&gt;&gt; the other, but this also is not a hard and fast rule.
&gt;&gt;&gt; At this time changing number of partitions in the ring does require a
&gt;&gt;&gt; complete rebuild of the cluster, we do have dynamic ring sizing on the
&gt;&gt;&gt; product roadmap, but there is no release date set for that feature.
&gt;&gt;&gt;
&gt;&gt;&gt; Joe Caswell
&gt;&gt;&gt;
&gt;&gt;&gt; From: Tom Zeng 
&gt;&gt;&gt; Date: Sunday, April 21, 2013 9:38 PM
&gt;&gt;&gt; To: 
&gt;&gt;&gt; Subject: the optimal value of the ring\_creation\_size
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I am wondering what's the best value for ring\_creation\_size, the default
&gt;&gt;&gt; is 64. According to the docs 64 will work for a cluster of no more than 6
&gt;&gt;&gt; nodes (64 /10), and ring\_creation\_size of 128 will allow cluster of up to
&gt;&gt;&gt; 12 mode. I am wondering what kind of overhead of is associated with a
&gt;&gt;&gt; large ring\_creation\_size. Since changing the ring\_creation\_size will
&gt;&gt;&gt; result in rebuilding the cluster(destuctive), would a larger value make
&gt;&gt;&gt; more sense and allow scaling by adding more nodes?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Tom
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Tom Zeng
&gt;&gt;&gt; Director of Engineering
&gt;&gt;&gt; Intridea, Inc. | www.intridea.com
&gt;&gt;&gt; t...@intridea.com
&gt;&gt;&gt; (o) 888.968.4332 x519
&gt;&gt;&gt; (c) 240-643-8728
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
\*Dev Kanchen \*|\* \*Solution Architect
\*Sourcebits\*

\*Bangalore\* | San Francisco | Wroclaw | Connecticut | Atlanta
M: +91 96111 07106
GTalk ID: d...@sourcebits.com | Skype ID: dev.kanchen

Disclaimer:This email and any attachments are sent in strictest confidence
for the sole use of the addressee and may contain legally privileged,
confidential, and proprietary data. If you are not the intended recipient,
please advise the sender by replying promptly to this email and then delete
and destroy this email and any attachments without any further use, copying
or forwarding.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

