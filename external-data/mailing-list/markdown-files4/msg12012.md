---
title: "Re: Practical Riak cluster choices in AWS (number of nodes? AZ's?)"
description: ""
project: community
lastmod: 2013-08-13T17:23:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12012"
mailinglist_parent_id: "msg11969"
author_name: "John Eikenberry"
project_section: "mailinglistitem"
sent_date: 2013-08-13T17:23:32-07:00
---


Brady Wetherington wrote:

&gt; First off - I know 5 instances is the "magic number" of instances to have.
&gt; If I understand the thinking here, it's that at the default redundancy
&gt; level ('n'?) of 3, it is most likely to start getting me some scaling
&gt; (e.g., performance &gt; just that of a single node), and yet also have
&gt; redundancy; whereby I can lose one box and not start to take a performance
&gt; hit.

With n=3 wouldn't you just need to avoid having more than 2 (of 5) nodes in the
same zone? With 5 nodes you shouldn't have to worry about replicas being on the
same node, so if you only have 2 nodes in 1 zone you wouldn't lose data if you
lost a zone.

The only place I see there being a problem is in regions with only 2 zones or
when you need to expand beyond the 2/zone number. Then you just have to do
backups and accept that you will suffer an outage if you lose a zone.

The cure for all this is having riak get so called "rack awareness" so you can
configure it to make sure that data is replicated across multiple zones. This
is supposed to be coming at some point [1].

[1] https://github.com/basho/riak/issues/308

&gt; My question is - I think I can only do 4 in a way that makes sense. I only
&gt; have 4 AZ's that I can use right now; AWS won't let me boot instances in
&gt; 1a. My concern is if I try to do 5, I will be "doubling up" in one AZ - and
&gt; in AWS you're almost as likely to lose an entire AZ as you are a single
&gt; instance. And so, if I have instances doubled-up in one AZ (let's say
&gt; us-east-1e), and then I lose 1e, I've now lost two instances. What are the
&gt; chances that all three of my replicas of some chunk of my data are on those
&gt; two instances? I know that it's not guaranteed that all replicas are on
&gt; separate nodes.
&gt; 
&gt; So is it better for me to ignore the recommendation of 5 nodes, and just do
&gt; 4? Or to ignore the fact that I might be doubling-up in one AZ? Also,
&gt; another note. These are designed to be 'durable' nodes, so if one should go
&gt; down I would expect to bring it back up \*with\* its data - or, if I
&gt; couldn't, I would do a force-replace or replace and rebuild it from the
&gt; other replicas. I'm definitely not doing instance-store. So I don't know if
&gt; that mitigates my need for a full 5 nodes. I would also consider losing one
&gt; node to be "degraded" and would probably seek to fix that problem as soon
&gt; as possible, so I wouldn't expect to be in that situation for long. I would
&gt; probably tolerate a drop in performance during that time, too. (Not a
&gt; super-severe one, but 20-30 percent? Sure.)
&gt; 
&gt; What do you folks think?
&gt; 
&gt; -B.

&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


-- 

John Eikenberry
[ j...@zhar.net - http://zhar.net ]
[ PGP public key @ http://zhar.net/jae\_at\_zhar\_net.gpg ]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Sic gorgiamus allos subjectatos nunc


signature.asc
Description: Digital signature
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

