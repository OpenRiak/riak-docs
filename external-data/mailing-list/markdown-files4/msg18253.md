---
title: "Re: Put failure: too many siblings"
description: ""
project: community
lastmod: 2017-05-31T12:45:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18253"
mailinglist_parent_id: "msg18232"
author_name: "Vladyslav Zakhozhai"
project_section: "mailinglistitem"
sent_date: 2017-05-31T12:45:23-07:00
---


Hi,

I've changed default bucket prop "dvv\_enabled" on production system (27
nodes) without any issues (couple of days ago):

NewProps = [case Prop of {dvv\_enabled,false} -&gt; {dvv\_enabled,true}; Other
-&gt; Other end || Prop &lt;- application:get\_env(riak\_core,
default\_bucket\_props)].
riak\_core\_util:rpc\_every\_member\_ann(application, set\_env, [riak\_core,
default\_bucket\_props, NewProps], 5000).

This simple script will do the trick. And also the configuration of riak
has been changed.

Another question is about old siblings workaround. Russell said that I need
to manage it manually. But now I have no idea what can I do in this case. I
mean will siblings be resolved during read repairs, hinted handoffs, etc or
not. Or I do need to resolve them manually?




On Fri, May 26, 2017 at 11:41 PM Vladyslav Zakhozhai &lt;
v.zakhoz...@smartweb.com.ua&gt; wrote:

&gt; Hi Magnus,
&gt;
&gt; Thank you for the tip and clarification. I'll give it a try.
&gt;
&gt; On Thu, May 25, 2017 at 4:24 PM Magnus Kessler  wrote:
&gt;
&gt;&gt; On 25 May 2017 at 09:39, Vladyslav Zakhozhai &gt; &gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I've been trying to change dvv\_enabled for default bucket type. But this
&gt;&gt;&gt; is impossible with riak-admin:
&gt;&gt;&gt;
&gt;&gt;&gt; riak-admin bucket-type update default '{"props":{"dvv\_enabled":true}}'
&gt;&gt;&gt; Error updating bucket type default:
&gt;&gt;&gt; no\_default\_update
&gt;&gt;&gt;
&gt;&gt;&gt; I think that workaround for this is changing default props in riak
&gt;&gt;&gt; config:
&gt;&gt;&gt;
&gt;&gt;&gt; {riak\_core, [
&gt;&gt;&gt;
&gt;&gt;&gt; {default\_bucket\_props, [
&gt;&gt;&gt; {allow\_mult, true},
&gt;&gt;&gt; {dvv\_enabled, true}
&gt;&gt;&gt; ]},
&gt;&gt;&gt; ...
&gt;&gt;&gt;
&gt;&gt;&gt; (yes, I still use old-style configs)
&gt;&gt;&gt;
&gt;&gt;&gt; And then I need to restart all riak nodes. Here is two questions:
&gt;&gt;&gt; 1. Is this approach correct?
&gt;&gt;&gt; 2. Is it ok to have different default\_bucket\_props value on different
&gt;&gt;&gt; nodes of the same cluster (in short period of time)?
&gt;&gt;&gt;
&gt;&gt;&gt; I have to restart 27 riak nodes. There is several billions of keys in
&gt;&gt;&gt; riak and each node starts wery slow (20-30-60 min; bitcask backend). So I
&gt;&gt;&gt; can't change default\_bucket\_props simultaneously in a such way.
&gt;&gt;&gt;
&gt;&gt;&gt; I also can change this parameter in riak console, i.e.
&gt;&gt;&gt;
&gt;&gt;&gt; application:set\_env(riak\_core, default\_bucket\_props, [{dvv\_enabled,
&gt;&gt;&gt; true}, ......]). But what I need to do for applying this changes?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; Hi Vladyslav,
&gt;&gt;
&gt;&gt; The recommended approach for changing the default bucket type's
&gt;&gt; properties is to change the settings in `riak.conf` or `advanced.config`.
&gt;&gt; However, I just checked that any settings changed through a set\_env call
&gt;&gt; also seem to be reflected in the runtime configuration.
&gt;&gt;
&gt;&gt; If you'd like to try this, I recommend making the change on a test
&gt;&gt; cluster first, as I have not verified if this causes issues on a production
&gt;&gt; CS cluster. The set\_env call should pass in the complete set of bucket type
&gt;&gt; properties, not just the changes. You can try the following (with default
&gt;&gt; default bucket-type properties):
&gt;&gt;
&gt;&gt; riak\_core\_util:rpc\_every\_member\_ann(application, set\_env, [riak\_core,
&gt;&gt; default\_bucket\_props,
&gt;&gt; [{allow\_mult,false},{big\_vclock,50},{chash\_keyfun,{riak\_core\_util,chash\_std\_keyfun}},{dvv\_enabled,
&gt;&gt; false},{dw,quorum},{last\_write\_wins,false},{linkfun,{modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}},{n\_val,3},{notfound\_ok,true},{old\_vclock,86400},{postcommit,[]},{pr,0},{precommit,[]},{pw,0},{r,quorum},{repl,true},{rw,quorum},{small\_vclock,50},{w,quorum},{write\_once,false},{young\_vclock,20}]],
&gt;&gt; 5000).
&gt;&gt;
&gt;&gt;
&gt;&gt; If you go down this route, please don't forget to also make changes to
&gt;&gt; the configuration files, in order to these settings to persist across a
&gt;&gt; restart.
&gt;&gt;
&gt;&gt; Kind Regards,
&gt;&gt;
&gt;&gt; Magnus
&gt;&gt;
&gt;&gt; --
&gt;&gt; Magnus Kessler
&gt;&gt; Client Services Engineer
&gt;&gt; Basho Technologies Limited
&gt;&gt;
&gt;&gt; Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

