---
title: "Re: ListKeys or MapReduce"
description: ""
project: community
lastmod: 2013-02-12T06:53:26-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10094"
mailinglist_parent_id: "msg10088"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-02-12T06:53:26-08:00
---


They're both pretty crappy in terms of performance - they read all data off
of disk. If you're using LevelDB you can use the $keys index to pull back
just the keys that in a single bucket.

A better approach is to maintain a separate bucket - e.g. DocumentCount -
that is used for counting documents. Unfortunately, you can't guarantee
transactional consistency around counts in Riak today, so you'll want to
move maintaining the counts out of Riak and into something else. If you
search the list archives [1], you'll find that Redis has been mentioned as
a good way to solve this problem - counters are stored in Redis and flushed
to Riak on a regular schedule. Because of the lack of consistency
(especially around MapReduce operations), Riak isn't the best choice if you
require counters/aggregations to be stored in the database.

Once CRDTs [2] make it into mainstream Riak, you can make use of those data
structures to implement distributed counters in Riak.

[1]: http://riak.markmail.org
[2]: http://vimeo.com/52414903

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Mon, Feb 11, 2013 at 10:30 AM,  wrote:

&gt; Say I need to determine how many document there are in my database. For a
&gt; CorrugatedIron application I can do ListKeys and get the warning that it is
&gt; an expensive operation or I can do a MapReduce query. Which is the the
&gt; least expensive? Is there an option that I am missing?
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

