---
title: "Re: MapReduce query returns case_clause badmatch?"
description: ""
project: community
lastmod: 2011-07-15T12:55:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04020"
mailinglist_parent_id: "msg04019"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-07-15T12:55:37-07:00
---


Didn't realize that, thanks for the correction! :-)
\*


Jonathan Langevin
Systems Administrator
Loom Inc.
Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
www.loomlearning.com - Skype: intel352
\*


On Fri, Jul 15, 2011 at 3:29 PM, Sean Cribbs  wrote:

&gt; Jonathan,
&gt;
&gt; Riak cannot run a map phase that takes anything other than
&gt; bucket/key[/keydata] inputs, so returning [value] from your first map phase
&gt; is invalid. Instead, just return [1] if your regexp test passes.
&gt;
&gt; On Fri, Jul 15, 2011 at 2:07 PM, Jonathan Langevin &lt;
&gt; jlange...@loomlearning.com&gt; wrote:
&gt;
&gt;&gt; When running several maps and one reduce against a bucket, I'm getting an
&gt;&gt; error, info is below.
&gt;&gt; Any idea what I'm doing wrong?
&gt;&gt;
&gt;&gt; Data submitted (printed as php-style array):
&gt;&gt; array
&gt;&gt; (
&gt;&gt; 'inputs' =&gt; 'Course'
&gt;&gt; 'query' =&gt; array
&gt;&gt; (
&gt;&gt; '0' =&gt; array
&gt;&gt; (
&gt;&gt; 'map' =&gt; array
&gt;&gt; (
&gt;&gt; 'keep' =&gt; false
&gt;&gt; 'language' =&gt; 'javascript'
&gt;&gt; 'arg' =&gt; null
&gt;&gt; 'source' =&gt; 'function(v){return [v];}'
&gt;&gt; )
&gt;&gt; )
&gt;&gt; '1' =&gt; array
&gt;&gt; (
&gt;&gt; 'map' =&gt; array
&gt;&gt; (
&gt;&gt; 'keep' =&gt; false
&gt;&gt; 'language' =&gt; 'javascript'
&gt;&gt; 'arg' =&gt; null
&gt;&gt; 'source' =&gt; '
&gt;&gt; function(value){
&gt;&gt; if(!value.not\_found) {
&gt;&gt; var object = Riak.mapValuesJson(value)[0];
&gt;&gt; var val = object[\"idNumber\"].toLowerCase();
&gt;&gt; if((val.match(/lbst/))) {
&gt;&gt; return [value];
&gt;&gt; }
&gt;&gt; }
&gt;&gt; return [];
&gt;&gt; }
&gt;&gt; '
&gt;&gt; )
&gt;&gt; )
&gt;&gt; '2' =&gt; array
&gt;&gt; (
&gt;&gt; 'map' =&gt; array
&gt;&gt; (
&gt;&gt; 'keep' =&gt; false
&gt;&gt; 'language' =&gt; 'javascript'
&gt;&gt; 'arg' =&gt; null
&gt;&gt; 'source' =&gt; 'function(){return [1]}'
&gt;&gt; )
&gt;&gt; )
&gt;&gt; '3' =&gt; array
&gt;&gt; (
&gt;&gt; 'reduce' =&gt; array
&gt;&gt; (
&gt;&gt; 'keep' =&gt; true
&gt;&gt; 'language' =&gt; 'javascript'
&gt;&gt; 'arg' =&gt; null
&gt;&gt; 'name' =&gt; 'Riak.reduceSum'
&gt;&gt; )
&gt;&gt; )
&gt;&gt; )
&gt;&gt; )
&gt;&gt;
&gt;&gt;
&gt;&gt; And here is the [start of] the response I get, below.
&gt;&gt; What's interesting is, I also get back the results of my query (or at
&gt;&gt; least, the contents of the bucket...).
&gt;&gt;
&gt;&gt; array
&gt;&gt; (
&gt;&gt; 'headers' =&gt; array
&gt;&gt; (
&gt;&gt; 'http\_code' =&gt; 500
&gt;&gt; 'server' =&gt;
&gt;&gt; 'MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)'
&gt;&gt; 'date' =&gt; 'Fri, 15 Jul 2011 18:02:25 GMT'
&gt;&gt; 'content-type' =&gt; 'text/html'
&gt;&gt; 'content-length' =&gt; '2453'
&gt;&gt; )
&gt;&gt; 'body' =&gt;
&gt;&gt; '500 Internal Server 
&gt;&gt; ErrorInternal Server Error
=====================

The server 
&gt;&gt; encountered an error while processing this request:  

```
{error,
&gt;&gt;     {error,
&gt;&gt;         {case_clause,
&gt;&gt;             {{badmatch,
&gt;&gt;                  {struct,
&gt;&gt;                      [{&lt;&lt;\"bucket\"&gt;&gt;,&lt;&lt;\"Course\"&gt;&gt;},
&gt;&gt;                       {&lt;&lt;\"key\"&gt;&gt;,
&gt;&gt; .....
&gt;&gt; *
&gt;&gt;
&gt;&gt;
&gt;&gt;  
&gt;&gt;  Jonathan Langevin
&gt;&gt; Systems Administrator
&gt;&gt; Loom Inc.
&gt;&gt; Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
&gt;&gt; www.loomlearning.com - Skype: intel352
&gt;&gt; *
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://www.basho.com/
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


```
