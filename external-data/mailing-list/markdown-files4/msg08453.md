---
title: "Re: LevelDB memory problem crashes Erlang"
description: ""
project: community
lastmod: 2012-09-05T00:49:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08453"
mailinglist_parent_id: "msg08440"
author_name: "shaharke"
project_section: "mailinglistitem"
sent_date: 2012-09-05T00:49:09-07:00
---


Hi,

We encounter the exact same problem. We're trying to insert into a 4 node
cluster 20M documents, and eventually the Erlang VM crashes (not enough heap
space). Tracking the Riak process, we can see the memory level steadily
rising, well above 80% of available RAM.

IT configuration:
4 Ubuntu 10.4 servers with 8GB RAM each.

Riak configuration:
-leveldb backend
-n\_val=2
-w=quorum
-pw=one
-riak search enabled

We also tweaked the JS VM parameters, but this doesn't seem to be relevant.
Let me know if I'm wrong.

What's even more alarming is that after we restart the nodes we fail to run
MR jobs that ran successfully before on a small scale. We get a very vague
error message almost immediately after executing the MR request:

{"phase":0,"error":"[timeout]","input":"{&lt;&lt;\"users\_info\"&gt;&gt;,&lt;&lt;\"103631217508103\"&gt;&gt;}","type":"forward\_preflist","stack":"[]"}

Deleting the leveldb directory and re-inserting 10K documents will resolve
the MR problem. It is as if there is some corruption in the data due to the
crashes. Anyway, solving the crashes is obviously on higher priority at this
moment, and I'm guessing the solving the latter will will solve the MR
problem.

I read the page on Basho wiki regarding leveldb tuning, but nothing there
seems to be relevant to the problem we encounter (except for the cache\_size
which, if I understand correctly, is set to 8MB by default which should be
OK).

Thanks,
Shahar




--
View this message in context: 
http://riak-users.197444.n3.nabble.com/LevelDB-memory-problem-crashes-Erlang-tp4024974p4025168.html
Sent from the Riak Users mailing list archive at Nabble.com.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

