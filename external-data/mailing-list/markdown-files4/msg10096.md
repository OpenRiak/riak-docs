---
title: "Re: ListKeys or MapReduce"
description: ""
project: community
lastmod: 2013-02-12T07:19:11-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10096"
mailinglist_parent_id: "msg10095"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-02-12T07:19:11-08:00
---


It would be queried like any other index as an MR input. I'll create an
issue and will try to get this in some time in the next few days - no
promises, though.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Tue, Feb 12, 2013 at 7:09 AM, Kevin Burton wrote:

&gt; I will read the other URLs that you mentioned. Thank you.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Would you mind giving a short example (preferably using CI) of the $keys
&gt; index?\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*From:\* Jeremiah Peschka [mailto:jeremiah.pesc...@gmail.com]
&gt; \*Sent:\* Tuesday, February 12, 2013 8:52 AM
&gt; \*To:\* Kevin Burton
&gt; \*Cc:\* riak-users
&gt; \*Subject:\* Re: ListKeys or MapReduce\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; They're both pretty crappy in terms of performance - they read all data
&gt; off of disk. If you're using LevelDB you can use the $keys index to pull
&gt; back just the keys that in a single bucket.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; A better approach is to maintain a separate bucket - e.g. DocumentCount -
&gt; that is used for counting documents. Unfortunately, you can't guarantee
&gt; transactional consistency around counts in Riak today, so you'll want to
&gt; move maintaining the counts out of Riak and into something else. If you
&gt; search the list archives [1], you'll find that Redis has been mentioned as
&gt; a good way to solve this problem - counters are stored in Redis and flushed
&gt; to Riak on a regular schedule. Because of the lack of consistency
&gt; (especially around MapReduce operations), Riak isn't the best choice if you
&gt; require counters/aggregations to be stored in the database.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Once CRDTs [2] make it into mainstream Riak, you can make use of those
&gt; data structures to implement distributed counters in Riak.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; [1]: http://riak.markmail.org\*\*\*\*
&gt;
&gt; [2]: http://vimeo.com/52414903\*\*\*\*
&gt;
&gt;
&gt; \*\*\*\*
&gt;
&gt; ---\*\*\*\*
&gt;
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\*\*\*\*
&gt;
&gt; MCITP: SQL Server 2008, MVP\*\*\*\*
&gt;
&gt; Cloudera Certified Developer for Apache Hadoop\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; On Mon, Feb 11, 2013 at 10:30 AM,  wrote:\*\*\*\*
&gt;
&gt; Say I need to determine how many document there are in my database. For a
&gt; CorrugatedIron application I can do ListKeys and get the warning that it is
&gt; an expensive operation or I can do a MapReduce query. Which is the the
&gt; least expensive? Is there an option that I am missing?\*\*\*\*
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

