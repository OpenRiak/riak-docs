---
title: "Re: Yokozuna queries slow"
description: ""
project: community
lastmod: 2015-04-20T23:15:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16044"
mailinglist_parent_id: "msg16043"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-04-20T23:15:07-07:00
---


Hey Jason,

We’re working on performance issues with YZ filter queries, e.g. 
https://github.com/basho/yokozuna/issues/392 
, and coverage plan 
generation/caching, and our CliServ team has started doing a ton of benchmarks 
as well.

You can bypass YZ, but then you’d have to create a way to generate your own 
coverage plans and other things involving distributed solr that YZ gives you. 
Nonetheless, we’re actively working on improving these issues you’ve 
encountered. 

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\_we\_love | paperswelove.org
twitter =&gt; @zeeshanlakhani

&gt; On Apr 21, 2015, at 1:06 AM, Jason Campbell  wrote:
&gt; 
&gt; Hello,
&gt; 
&gt; I'm currently trying to debug slow YZ queries, and I've narrowed down the 
&gt; issue, but not sure how to solve it.
&gt; 
&gt; First off, we have about 80 million records in Riak (and YZ), but the queries 
&gt; return relatively few (a thousand or so at most). Our query times are 
&gt; anywhere from 800ms to 1.5s.
&gt; 
&gt; I have been experimenting with queries directly on the Solr node, and it 
&gt; seems to be a problem with YZ and the way it does vnode filters.
&gt; 
&gt; Here is the same query, emulating YZ first:
&gt; 
&gt; {
&gt; "responseHeader":{
&gt; "status":0,
&gt; "QTime":958,
&gt; "params":{
&gt; "q":"timestamp:[1429579919010 TO 1429579921010]",
&gt; "indent":"true",
&gt; "fq":"\_yz\_pn:55 OR \_yz\_pn:40 OR \_yz\_pn:25 OR \_yz\_pn:10",
&gt; "rows":"0",
&gt; "wt":"json"}},
&gt; "response":{"numFound":80,"start":0,"docs":[]
&gt; }}
&gt; 
&gt; And the same query, but including the vnode filter in the main body instead 
&gt; of using a filter query:
&gt; 
&gt; {
&gt; "responseHeader":{
&gt; "status":0,
&gt; "QTime":1,
&gt; "params":{
&gt; "q":"timestamp:[1429579919010 TO 1429579921010] AND (\_yz\_pn:55 OR 
&gt; \_yz\_pn:40 OR \_yz\_pn:25 OR \_yz\_pn:10)",
&gt; "indent":"true",
&gt; "rows":"0",
&gt; "wt":"json"}},
&gt; "response":{"numFound":80,"start":0,"docs":[]
&gt; }}
&gt; 
&gt; I understand there is a caching benefit to using filter queries, but a 
&gt; performance difference of 100x or greater doesn't seem worth it, especially 
&gt; with a constant data stream.
&gt; 
&gt; Is there a way to make YZ do this, or is the only way to query Solr directly, 
&gt; bypassing YZ? Does anyone have any other suggestions of how to make this 
&gt; faster?
&gt; 
&gt; The timestamp field is a SolrTrieLongField with default settings if anyone is 
&gt; curious.
&gt; 
&gt; Thanks,
&gt; Jason
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

