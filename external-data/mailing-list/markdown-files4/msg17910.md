---
title: "Re: Reg:Continuous Periodic crashes after long operation"
description: ""
project: community
lastmod: 2017-02-01T14:16:33-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17910"
mailinglist_parent_id: "msg17909"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2017-02-01T14:16:33-08:00
---


Thanks for the information. Yes, one RiakClient instance per Unix
process is correct.

I will see if there is a way for you to keep track of connections from
the client to Riak. Off the top of my head the Python client doesn't
have the ability to set limits.

--
Luke Bakken
Engineer
lbak...@basho.com

On Wed, Feb 1, 2017 at 1:59 PM, Steven Joseph  wrote:
&gt; Hi Luke,
&gt;
&gt; Yes I am creating new client objects for each of my tasks.
&gt;
&gt; Please see this github issuse against the python client for some
&gt; background as to why.
&gt;
&gt; https://github.com/basho/riak-python-client/issues/497
&gt;
&gt; Basicaly I ran into issues with concurrency when processes are forked.
&gt;
&gt; I might experiment with using process ids as keys to access a process
&gt; specific riak client in forked child ?
&gt;
&gt;
&gt; Regards
&gt;
&gt; Steven
&gt;
&gt; Luke Bakken  writes:
&gt;
&gt;&gt; Hi Steven,
&gt;&gt;
&gt;&gt; At this point I suspect you're using the Python client in such a way
&gt;&gt; that too many connections are being created. Are you re-using the
&gt;&gt; RiakClient object or repeatedly creating new ones? Can you provide any
&gt;&gt; code that reproduces your issue?
&gt;&gt;
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer
&gt;&gt; lbak...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Jan 31, 2017 at 7:47 PM, Steven Joseph  wrote:
&gt;&gt;&gt; Hi Luke,
&gt;&gt;&gt;
&gt;&gt;&gt; Here's the output of
&gt;&gt;&gt;
&gt;&gt;&gt; $ sysctl fs.file-max
&gt;&gt;&gt;
&gt;&gt;&gt; fs.file-max = 20000500
&gt;&gt;&gt;
&gt;&gt;&gt; Regards
&gt;&gt;&gt;
&gt;&gt;&gt; Steven
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Feb 1, 2017 at 9:30 AM Luke Bakken  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Steven,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What is the output of this command on your systems?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ sysctl fs.file-max
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Mine is:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; fs.file-max = 1620211
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Luke Bakken
&gt;&gt;&gt;&gt; Engineer
&gt;&gt;&gt;&gt; lbak...@basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Tue, Jan 31, 2017 at 12:22 PM, Steven Joseph 
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt; &gt; Hi Shaun,
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Im having this issue again, this time I have captured the system limits,
&gt;&gt;&gt;&gt; &gt; while riak is still crashing.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Please note lsof and prlimit outputs at bottom.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

