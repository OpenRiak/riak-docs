---
title: "Re: Riak 2i http query much faster than python api?"
description: ""
project: community
lastmod: 2013-04-10T13:04:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10836"
mailinglist_parent_id: "msg10835"
author_name: "Jeff Peck"
project_section: "mailinglistitem"
sent_date: 2013-04-10T13:04:56-07:00
---


Thanks Evan. I tried doing it in python like this (realizing that the previous 
way I did it uses MapReduce) and I had better results. It finished in 3.5 
minutes, but nowhere close to the 15 seconds from the straight http query:

import riak
from pprint import pprint

bucket\_name = "mybucket"

client = riak.RiakClient(port=8087,transport\_class=riak.RiakPbcTransport)
bucket = client.bucket(bucket\_name)
results = bucket.get\_index('status\_bin', 'PERSISTED')

print len(results)


On Apr 10, 2013, at 4:00 PM, Evan Vigil-McClanahan  
wrote:

&gt; get\_index() is the right function there, I think.
&gt; 
&gt; On Wed, Apr 10, 2013 at 2:53 PM, Jeff Peck  wrote:
&gt;&gt; I can grab over 900,000 keys from an indexs, using an http query in about 15 
&gt;&gt; seconds, whereas the same operation in python times out after 5 minutes. 
&gt;&gt; Does this indicate that I am using the python API incorrectly? Should I be 
&gt;&gt; relying on an http request initially when I need to grab this many keys?
&gt;&gt; 
&gt;&gt; (Note: This is tied to the question that I asked earlier, but is also a 
&gt;&gt; general question to help understand the proper usage of the python API.)
&gt;&gt; 
&gt;&gt; Thanks! Examples are below.
&gt;&gt; 
&gt;&gt; - Jeff
&gt;&gt; 
&gt;&gt; ---
&gt;&gt; 
&gt;&gt; HTTP:
&gt;&gt; 
&gt;&gt; $ time curl -s 
&gt;&gt; http://localhost:8098/buckets/mybucket/index/status\_bin/PERSISTED | grep -o 
&gt;&gt; , | wc -l
&gt;&gt; 926047
&gt;&gt; 
&gt;&gt; real 0m14.583s
&gt;&gt; user 0m2.500s
&gt;&gt; sys 0m0.270s
&gt;&gt; 
&gt;&gt; ---
&gt;&gt; 
&gt;&gt; Python:
&gt;&gt; 
&gt;&gt; import riak
&gt;&gt; 
&gt;&gt; bucket = "my bucket"
&gt;&gt; client = riak.RiakClient(port=8098)
&gt;&gt; results = client.index(bucket, 'status\_bin', 
&gt;&gt; 'PERSISTED').run(timeout=5\*60\*1000) # 5 minute timeout
&gt;&gt; print len(results)
&gt;&gt; 
&gt;&gt; (times out after 5 minutes)
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

