---
title: "Re: Secondary indexes or Riak search ?"
description: ""
project: community
lastmod: 2017-02-13T03:09:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17966"
mailinglist_parent_id: "msg17964"
author_name: "Alex Feng"
project_section: "mailinglistitem"
sent_date: 2017-02-13T03:09:07-08:00
---


Hi Russell,

We have tried this, but it returns a reference(some number) only. We have
googled and haven't found any clue about how to use this API.
The API user guide doesn't say much about the "reference". What is the
next step with the returned reference ?


cs\_bucket\_fold(Pid::pid(), Bucket::bucket()

 | bucket\_and\_type()
,
Opts::cs\_opts()
)
-&gt; {ok, reference()} | {error, term()}

secret function, do not use, or I come to your house and keeel you.

cs\_opt() = {timeout, timeout()} | {continuation, binary()} | {max\_results,
non\_neg\_integer() | all} | {start\_key, binary()} | {start\_incl, boolean()}
| {end\_key, binary()} | {end\_incl, boolean()}

Br,
Alex

2017-02-13 16:34 GMT+08:00 Russell Brown :

&gt; If you look at the riak-erlang-client here https://github.com/basho/riak-
&gt; erlang-client/blob/develop/src/riakc\_pb\_socket.erl#L1129 there is a
&gt; client API call that was implemented for CS (riak s2, or whatever it is
&gt; called, the large object store thingy that basho had) that will use the
&gt; $keys index, but in the back end calls fold\_objects rather than fold\_keys
&gt; on eleveldb, and so returns the whole object. NOTE: this is equivalent to
&gt; r=1, you don’t get a quorum read here, but a single vnode per-value only. I
&gt; don’t know if other clients added this API, but it would not be hard to add
&gt; to any client that supports 2i. Like I say, originally it was for riakCS,
&gt; but it’s open source and part of the release for 4 years now, so hardly a
&gt; secret.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt; On 13 Feb 2017, at 06:18, Alex Feng  wrote:
&gt;
&gt; &gt; Hi Russell,
&gt; &gt;
&gt; &gt; In your reply, you mentioned this,
&gt; &gt;
&gt; &gt; &gt;&gt; There is also the feature that can return the actual riak objects for
&gt; a $keys index search,
&gt; &gt; &gt;&gt;You can pack the index terms with data and return the terms in a query
&gt; so that you don’t need a further object fetch (see &gt;&gt;return\_terms in docs.)
&gt; &gt;
&gt; &gt; If I understood correctly, it is possible to fetch object (value) by 2i
&gt; in one time. But, we have tried using "return\_term = true", it returns the
&gt; index with key comparing only key when not using "return\_term=true". It
&gt; doesn't help much with extra index, what we want to achieve is to fetch the
&gt; object in one time.
&gt; &gt;
&gt; &gt;
&gt; &gt; Our use case, client search DB every 10 seconds by 2i, Riak will return
&gt; a list of around 5000 results(Keys), then client will query DB to fetch
&gt; value for each key, basically it is around 5000 times, client is easy to
&gt; run into some issues most of the time. Any suggestion here ?
&gt; &gt;
&gt; &gt; Many thanks in advance.
&gt; &gt;
&gt; &gt; Br,
&gt; &gt; Alex
&gt; &gt;
&gt; &gt; 2017-02-06 19:02 GMT+08:00 Alex Feng :
&gt; &gt; Hi Russell,
&gt; &gt;
&gt; &gt; It is really helpful, thank you a lot.
&gt; &gt; We are suffering from solr crash now, are considering to switch to 2i.
&gt; &gt;
&gt; &gt; Br,
&gt; &gt; Alex
&gt; &gt;
&gt; &gt; 2017-02-06 16:53 GMT+08:00 Russell Brown :
&gt; &gt; It’s worth noting that secondary indexes (2i) has some other advantages
&gt; over solr search. If you \_can\_ model your queries in 2i then I'd recommend
&gt; it.
&gt; &gt;
&gt; &gt; Secondary indexes have a richer API than is currently documented, if
&gt; you look at https://docs.basho.com/riak/1.4.7/dev/using/2i/ you’ll see
&gt; that documents a feature that allows the index terms to be filtered via reg
&gt; ex. There is also the feature that can return the actual riak objects for a
&gt; $keys index search,
&gt; &gt; You can pack the index terms with data and return the terms in a query
&gt; so that you don’t need a further object fetch (see return\_terms in docs.)
&gt; &gt; Secondary indexes are written atomically with the object they index.
&gt; &gt; Operationally they don’t require you run a JVM and Solr alongside your
&gt; riak nodes.
&gt; &gt;
&gt; &gt; You have the tools with basho\_bench to answer the question about
&gt; performance and overhead for your workload. I suspect for “overhead” 2i
&gt; wins, as there is no JVM-per-node.
&gt; &gt;
&gt; &gt; Modelling for 2i is perhaps harder, in the classical nosql way, you have
&gt; to do more work upfront when designing your querying.
&gt; &gt;
&gt; &gt; I hope that helps a little. I worked quite a lot on 2i and never really
&gt; understood why riak-search was seen as a replacment, imo they’re
&gt; complementary, and you pick the one that best fits.
&gt; &gt;
&gt; &gt; Cheers
&gt; &gt;
&gt; &gt; Russell
&gt; &gt;
&gt; &gt; On 2 Feb 2017, at 09:43, Alex Feng  wrote:
&gt; &gt;
&gt; &gt; &gt; Hello Riak-users,
&gt; &gt; &gt;
&gt; &gt; &gt; I am currently using Riak search to do some queries, since my queries
&gt; are very simple, it should be fulfilled by secondary indexes as well.
&gt; &gt; &gt; So, my question is which one has better performance and less overhead,
&gt; let's say both can fulfill the query requirement.
&gt; &gt; &gt;
&gt; &gt; &gt; Many thanks in advance.
&gt; &gt; &gt;
&gt; &gt; &gt; Br,
&gt; &gt; &gt; Alex
&gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

