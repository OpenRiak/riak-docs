---
title: "RiakCS large file uploads fail with 403/AccessDenied and	400/InvalidDigest"
description: ""
project: community
lastmod: 2015-02-11T07:42:54-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15687"
author_name: "Niels O"
project_section: "mailinglistitem"
sent_date: 2015-02-11T07:42:54-08:00
---


Hello everyone,

I have just installed riakcs and have the s3cmd and nodejs (the official
amazon) plugin working.

with the same credentials (accesskey&secret) I CAN upload big files with
S3CMD but I CANNOT with the AWS/S3 nodejs plugin? (downloading very big
files is no problem b.t.w.)


with the nodejs plugin

- until 992k, (I tested with 32 KiB increases) everything works
- starting at 1024 KiB I get [400 InvalidDigest: The Content-MD5 you
specified was invalid.]
- from 8192 KiB and beyond I get [403 AccessDenied] back from riakcs.

this while -again- with s3cmd I am able to upload files of over 1 GiB size
easily .. same machine, same creds

any ideas?





(below some riakcs debug logging from both the 400 and 403) ...


400 - InvalidDigest:

2015-02-11 16:34:16.911 [debug]
&lt;0.17889.18&gt;@riak\_cs\_s3\_auth:calculate\_signature:129 STS:
["PUT","\n","0BsQLab2tMEzr8IWoS2m5w==","\n","application/octet-stream","\n","\n",[["x-amz-date",":",&lt;&lt;"Wed,
11 Feb 2015 15:34:16 GMT"&gt;&gt;,"\n"]],["/testje/4096k",[]]]
2015-02-11 16:34:17.854 [debug]
&lt;0.23568.18&gt;@riak\_cs\_put\_fsm:is\_digest\_valid:326 Calculated =
&lt;&lt;"pIFX5fpeo7+sPPNjtSBWBg=="&gt;&gt;, Reported = "0BsQLab2tMEzr8IWoS2m5w=="
2015-02-11 16:34:17.860 [debug] &lt;0.23568.18&gt;@riak\_cs\_put\_fsm:done:303
Invalid digest in the PUT FSM


403 - AccessDenied

2015-02-11 16:36:00.448 [debug]
&lt;0.22889.18&gt;@riak\_cs\_s3\_auth:calculate\_signature:129 STS:
["POST","\n",[],"\n","application/octet-stream","\n","\n",[["x-amz-date",":",&lt;&lt;"Wed,
11 Feb 2015 15:36:00 GMT"&gt;&gt;,"\n"]],["/testje/8192k","?uploads"]]
2015-02-11 16:36:00.484 [debug]
&lt;0.23539.18&gt;@riak\_cs\_s3\_auth:calculate\_signature:129 STS:
["PUT","\n","sq5d2PIhC7I1xxT8Rp9cVg==","\n","application/octet-stream","\n","\n",[["x-amz-date",":",&lt;&lt;"Wed,
11 Feb 2015 15:36:00
GMT"&gt;&gt;,"\n"]],["/testje/8192k","?partNumber=1&uploadId=TXR2AuCeRDWwc2bviLPcOg=="]]
2015-02-11 16:36:00.484 [debug]
&lt;0.23539.18&gt;@riak\_cs\_wm\_common:post\_authentication:471 bad\_auth
2015-02-11 16:36:00.494 [debug]
&lt;0.23543.18&gt;@riak\_cs\_s3\_auth:calculate\_signature:129 STS:
["DELETE","\n",[],"\n","application/octet-stream","\n","\n",[["x-amz-date",":",&lt;&lt;"Wed,
11 Feb 2015 15:36:00
GMT"&gt;&gt;,"\n"]],["/testje/8192k","?uploadId=TXR2AuCeRDWwc2bviLPcOg=="]]
2015-02-11 16:36:00.494 [debug]
&lt;0.23543.18&gt;@riak\_cs\_wm\_common:post\_authentication:471 bad\_auth
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

