---
title: "Re: riak_kv_multi_backend + custom backend"
description: ""
project: community
lastmod: 2011-05-16T10:17:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03342"
mailinglist_parent_id: "msg03285"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2011-05-16T10:17:05-07:00
---


Hi Todd,

Thanks for putting this together. After quickly reading through this
email, it looks like we are going to want to incorporate a lot these
suggestions/examples. I just opened a new issue on the wiki repo\* to
make sure this content gets incorporated in a timely manner. Pull
requests are encouraged, btw. :)

Thanks for taking the time to put this together and keep the
suggestions coming.

Mark

\* https://github.com/basho/riak\_wiki/issues/97

On Sun, May 8, 2011 at 2:38 PM, Todd  wrote:
&gt; ---------------------------
&gt; 1. Minor doc suggestion
&gt; ---------------------------
&gt;
&gt; http://wiki.basho.com/Configuration-Files.html
&gt;
&gt; """
&gt; # riak\_kv\_fs\_backend
&gt; Data is stored in binary files on the filesystem
&gt;
&gt;    \* riak\_kv\_fs\_backendroot
&gt;      Root directory where the files are stored (ex: /var/lib/riak/data)
&gt; """
&gt;
&gt; "riak\_kv\_fs\_backendroot" should be "riak\_kv\_fs\_backend\_root"
&gt;
&gt;
&gt; Note: these docs correctly point that out:
&gt; http://doc.erlagner.org/riak\_kv/riak\_kv\_fs\_backend.html
&gt;
&gt; -----------------------------------
&gt; 2. Working example of multi backend
&gt; -----------------------------------
&gt;
&gt; Following the previous thread on this, I was able to noodle out how to make
&gt; this work:
&gt;
&gt; a) edit the app.config
&gt; ++++++++++++++++++++++
&gt;
&gt; user@erlang32:~/projects/riak/riak/rel/riak$ vim etc/app.config
&gt;
&gt;  42  %% Riak KV config
&gt;  43  {riak\_kv, [
&gt;  44             %% Storage\_backend specifies the Erlang module defining the
&gt; storage
&gt;  45             %% mechanism that will be used on this node.
&gt;  46             {storage\_backend, riak\_kv\_multi\_backend},
&gt;  47             {multi\_backend\_default, &lt;&lt;"cache"&gt;&gt;},
&gt;  48             {multi\_backend, [
&gt;  49                {&lt;&lt;"bitcask"&gt;&gt;, riak\_kv\_bitcask\_backend, [
&gt;  50                   {data\_root, "/var/riak/data/bitcask"}
&gt;  51                ]},
&gt;  52                {&lt;&lt;"filesystem"&gt;&gt;, riak\_kv\_fs\_backend, [
&gt;  53                   {riak\_kv\_fs\_backend\_root, "/var/riak/data/filesystem"}
&gt;  54                ]},
&gt;  55                {&lt;&lt;"cache"&gt;&gt;, riak\_kv\_cache\_backend, [
&gt;  56                   {riak\_kv\_cache\_backend\_memory, 1024},
&gt;  57                   {riak\_kv\_cache\_backend\_ttl, 600},
&gt;  58                   {riak\_kv\_cache\_backend\_max\_ttl, 3600}
&gt;  59                ]}
&gt;  60             ]},
&gt;
&gt;
&gt; b) try to persist data into the filestore backend
&gt; +++++++++++++++++++++++++++++++++++++++++++++++++
&gt;
&gt; user@erlang32:~/projects/riak/riak/rel/riak$ ./erts-5.8.3/bin/erl -name
&gt; 'riaktest@127.0.0.1' -setcookie riak
&gt;
&gt; Erlang R14B02 (erts-5.8.3) [source] [rq:1] [async-threads:0]
&gt; [kernel-poll:false]
&gt;
&gt; Eshell V5.8.3  (abort with ^G)
&gt;
&gt; (riaktest@127.0.0.1)1&gt; RiakNode = 'riak@127.0.0.1'.
&gt; 'riak@127.0.0.1'
&gt; (riaktest@127.0.0.1)2&gt; net\_adm:ping(RiakNode).
&gt; pong
&gt; (riaktest@127.0.0.1)3&gt;  {ok, C} = riak:client\_connect(RiakNode).
&gt; {ok,{riak\_client,'riak@127.0.0.1',&lt;&lt;3,169,233,111&gt;&gt;}}
&gt; (riaktest@127.0.0.1)4&gt; C:set\_bucket(&lt;&lt;"Blobs"&gt;&gt;, [{backend,
&gt; &lt;&lt;"filesystem"&gt;&gt;}]).
&gt; ok
&gt; (riaktest@127.0.0.1)5&gt; Blob=riak\_object:new(&lt;&lt;"Blobs"&gt;&gt;, &lt;&lt;"file1"&gt;&gt;,
&gt; [&lt;&lt;"data blob 1"&gt;&gt;]).
&gt; {r\_object,&lt;&lt;"Blobs"&gt;&gt;,&lt;&lt;"file1"&gt;&gt;,
&gt;          [{r\_content,{dict,0,16,16,8,80,48,
&gt;
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;                            {{[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt;                      [&lt;&lt;"data blob 1"&gt;&gt;]}],
&gt;          [],
&gt;          {dict,1,16,16,8,80,48,
&gt;                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;                {{[],[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt;          undefined}
&gt; (riaktest@127.0.0.1)6&gt; C:put(Blob, 1).
&gt; ok
&gt;
&gt; c) retrieve the persisted data
&gt; ++++++++++++++++++++++++++++++
&gt;
&gt;
&gt; (riaktest@127.0.0.1)7&gt; {ok, Retrieved} = C:get(&lt;&lt;"Blobs"&gt;&gt;, &lt;&lt;"file1"&gt;&gt;, 1).
&gt; {ok,{r\_object,&lt;&lt;"Blobs"&gt;&gt;,&lt;&lt;"file1"&gt;&gt;,
&gt;              [{r\_content,{dict,2,16,16,8,80,48,
&gt;                                {[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;                                {{[],[],[],[],[],[],[],[],[],[],...}}},
&gt;                          [&lt;&lt;"data blob 1"&gt;&gt;]}],
&gt;              [{&lt;&lt;3,169,233,111&gt;&gt;,{1,63472109206}}],
&gt;              {dict,1,16,16,8,80,48,
&gt;                    {[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;                    {{[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt;              undefined}}
&gt; (riaktest@127.0.0.1)9&gt; riak\_object:get\_value(Retrieved).
&gt; [&lt;&lt;"data blob 1"&gt;&gt;]
&gt;
&gt; Hope that helps.
&gt;
&gt; -Todd
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

