---
title: "Re: Riak JAVA Client Performance"
description: ""
project: community
lastmod: 2012-10-10T05:33:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08866"
mailinglist_parent_id: "msg08865"
author_name: "Pavel Kogan"
project_section: "mailinglistitem"
sent_date: 2012-10-10T05:33:45-07:00
---


Hi,

The node is OK and not down.
I have a way to do load balancing externally to JAVA Client.
I am evaluating Riak for using in my company and want to measure maximal
throughput vs single node.

Thanks,
 Pavel

On Wed, Oct 10, 2012 at 2:13 PM, Guido Medina wrote:

&gt; That question has been answered few times, here is my old answer:
&gt;
&gt; Hi,
&gt;
&gt; It is the Java client which to be honest, doesn't handle well one node
&gt; going down, so, for example, in my company we use HA proxy for that, here is
&gt; a starting configuration: https://gist.github.com/1507077
&gt;
&gt; Once we switched to HA proxy we just use a simple client without cluster
&gt; config, so the Java client doesn't know anything about the load balancing
&gt; going on. It works well, I can upgrade and restart servers without our Java
&gt; application be complaining.
&gt;
&gt; Regards,
&gt;
&gt; Guido.
&gt;
&gt;
&gt; On 10/10/12 12:58, Pavel Kogan wrote:
&gt;
&gt; Thanks,
&gt;
&gt; I will try this solution.
&gt;
&gt; Pavel
&gt;
&gt; On Wed, Oct 10, 2012 at 1:51 PM, kamiseq  wrote:
&gt;
&gt;&gt; well I asked same question few days ago (maybe 2 weeks form now) and
&gt;&gt; the answer was that yes sharing client is thread safe and all you
&gt;&gt; should do is to create new bucket instance on every request
&gt;&gt;
&gt;&gt; pozdrawiam
&gt;&gt; Paweł Kamiński
&gt;&gt;
&gt;&gt; kami...@gmail.com
&gt;&gt; pkaminski....@gmail.com
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;
&gt;&gt;
&gt;&gt; On 10 October 2012 09:25, Pavel Kogan  wrote:
&gt;&gt; &gt; 1) Is it ok to share a single pbc client object between 50 threads?
&gt;&gt; Should
&gt;&gt; &gt; it be protected by lock ?
&gt;&gt; &gt; 2) I didn't do load balancing between nodes yet, cause I want to
&gt;&gt; understand
&gt;&gt; &gt; better throughput limit. I am planning to do it for much higher
&gt;&gt; throughput.
&gt;&gt; &gt;
&gt;&gt; &gt; Pavel
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On Wed, Oct 10, 2012 at 9:21 AM, kamiseq  wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; maybe the good start is to share pbclient object and only create
&gt;&gt; &gt;&gt; bucket per request, you will save few steps on client configuration.
&gt;&gt; &gt;&gt; have you tried balancing requests to cluster and distribute them over
&gt;&gt; all
&gt;&gt; &gt;&gt; nodes?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; pozdrawiam
&gt;&gt; &gt;&gt; Paweł Kamiński
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; kami...@gmail.com
&gt;&gt; &gt;&gt; pkaminski....@gmail.com
&gt;&gt; &gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On 10 October 2012 06:18, Pavel Kogan  wrote:
&gt;&gt; &gt;&gt; &gt; Hi all,
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; I have Riak cluster consisting of 5 nodes that contains about 30
&gt;&gt; &gt;&gt; &gt; millions of
&gt;&gt; &gt;&gt; &gt; keys (35% of capacity according to Riak Control).
&gt;&gt; &gt;&gt; &gt; Currently we have single JAVA client reading and writing records to
&gt;&gt; same
&gt;&gt; &gt;&gt; &gt; node. I need some tips, how to use the client efficiently
&gt;&gt; &gt;&gt; &gt; to reach maximal throughput - I would like to be able to read/write
&gt;&gt; up
&gt;&gt; &gt;&gt; &gt; to
&gt;&gt; &gt;&gt; &gt; 100 records/sec on 1Gbit network. Currently I get a lot
&gt;&gt; &gt;&gt; &gt; of JAVA socket exceptions after a while (even for the much slower
&gt;&gt; rate -
&gt;&gt; &gt;&gt; &gt; 10
&gt;&gt; &gt;&gt; &gt; records/sec), after which I need to restart client and node.
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Thanks,
&gt;&gt; &gt;&gt; &gt; Pavel
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; P.S: My client using 50 threads and pbc client is created and
&gt;&gt; &gt;&gt; &gt; shut-downed
&gt;&gt; &gt;&gt; &gt; per request.
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt;
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing 
&gt; listriak-users@lists.basho.comhttp://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

