---
title: "Re: odd error on mapreduce"
description: ""
project: community
lastmod: 2011-08-26T03:33:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04471"
mailinglist_parent_id: "msg04456"
author_name: "Giancarlo Frison"
project_section: "mailinglistitem"
sent_date: 2011-08-26T03:33:12-07:00
---


If i serialize the body as Json I catch errors any more instead of protobuf
object representation (application/octet-stream).
Would be an mapreduce bug?

Is it possibile to skirt any body parsing during the mapreduce? Just for
evaluating headers values?

Thanks,

Giancarlo Frison



On Thu, Aug 25, 2011 at 3:48 PM, Giancarlo Frison wrote:

&gt; Hi all,
&gt;
&gt; I'm performing a mapreduce call for retrieving objects with a peculiar tag
&gt; link:
&gt;
&gt; {"inputs": "minos","query": [{"map": {"language": "javascript","source":
&gt; "function(v){ if(v.values[0].metadata.Links!=null &&
&gt; v.values[0].metadata.Links[0][0]==\"eclass-com\_chelab\_core\_minos\"
&gt; &&v.values[0].metadata.Links[0][1]==\"State\"
&gt; &&v.values[0].metadata.Links[0][2]==\"iof\") {return [v.key]; } else return
&gt; [];}"}}]}
&gt;
&gt; I have an object stored in binary format(protobuf) that the body is (json
&gt; format):
&gt;
&gt; {
&gt; "name": "2login",
&gt; "type": "start",
&gt; "transitions": [
&gt; {
&gt; "name": "logon",
&gt; "nextState": "logged",
&gt; "guard": "request.user!=null && request.password!=null",
&gt; "activity": {
&gt; "name": "call-login",
&gt; "serviceName": "http://apigeoname",
&gt; "condition": "this.password==request.password"
&gt; }
&gt; }
&gt; ]
&gt; }
&gt;
&gt; and the mapreduce works fine.
&gt;
&gt; IF I change JUST 'serviceName' element to 'http://apigeonames' adding the
&gt; last char 's' I encounter and error in the mapreduce above.
&gt; the error log is:
&gt;
&gt;
&gt;
&gt; Error JSON encoding arguments: [{struct,
&gt; [{&lt;&lt;"bucket"&gt;&gt;,&lt;&lt;"minos"&gt;&gt;},
&gt; {&lt;&lt;"key"&gt;&gt;,&lt;&lt;"2login"&gt;&gt;},
&gt; {&lt;&lt;"vclock"&gt;&gt;,
&gt;
&gt; &lt;&lt;"a85hYGBgzGDKBVIsLNdPbMpgSmTMY2XYIXvmOF8WAA=="&gt;&gt;},
&gt; {&lt;&lt;"values"&gt;&gt;,
&gt; [{struct,
&gt; [{&lt;&lt;"metadata"&gt;&gt;,
&gt; {struct,
&gt; [{&lt;&lt;"Links"&gt;&gt;,
&gt;
&gt; [[&lt;&lt;"eclass-com\_chelab\_core\_minos"&gt;&gt;,
&gt; &lt;&lt;"State"&gt;&gt;,&lt;&lt;"iof"&gt;&gt;]]},
&gt; {&lt;&lt;"X-Riak-VTag"&gt;&gt;,
&gt; &lt;&lt;"1uFeJm9wytHzl66Pxjsunx"&gt;&gt;},
&gt; {&lt;&lt;"content-type"&gt;&gt;,
&gt; &lt;&lt;"application/octet-stream"&gt;&gt;},
&gt; {&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;,
&gt; &lt;&lt;"Fri, 26 Aug 2011 13:38:00
&gt; GMT"&gt;&gt;}]}},
&gt; {&lt;&lt;"data"&gt;&gt;,
&gt; &lt;&lt;26,128,1,10,5,108,111,103,111,
&gt; 110,18,6,108,111,103,103,101,
&gt; 100,26,44,114,101,113,117,101,
&gt; 115,116,46,117,115,101,114,33,
&gt; 61,110,117,108,108,32,38,38,32,
&gt; 114,101,113,117,101,115,116,46,
&gt; 112,97,115,115,119,111,114,100,
&gt; 33,61,110,117,108,108,34,65,18,
&gt; 18,104,116,116,112,58,47,47,97,
&gt; 112,105,103,101,111,110,97,109,
&gt; 101,115,34,10,99,97,108,108,45,
&gt; 108,111,103,105,110,42,31,116,
&gt; 104,105,115,46,112,97,115,115,
&gt; 119,111,114,100,61,61,114,101,
&gt; 113,117,101,115,116,46,112,97,
&gt; 115,115,119,111,114,100,42,6,
&gt;
&gt; 50,108,111,103,105,110,64,6&gt;&gt;}]}]}]},
&gt; undefined,none]
&gt;
&gt; {error,
&gt; {no\_candidate\_nodes,exhausted\_preflist,
&gt; [{riak\_kv\_mapred\_planner,claim\_keys,3},
&gt; {riak\_kv\_map\_phase,handle\_info,2},
&gt; {luke\_phase,handle\_info,3},
&gt; {gen\_fsm,handle\_msg,7},
&gt; {proc\_lib,init\_p\_do\_apply,3}],
&gt; [{{5680,'riak@127.0.0.1'},
&gt; [{pid,&lt;0.12932.0&gt;},
&gt; {keys,
&gt; {{730750818665451459101842416358141509827966271488,
&gt; 'riak@127.0.0.1'},
&gt; [{riak\_kv\_map\_input,
&gt; {&lt;&lt;"minos"&gt;&gt;,&lt;&lt;"2login"&gt;&gt;},
&gt; [{name,&lt;&lt;"minos"&gt;&gt;},
&gt; {n\_val,3},
&gt; {allow\_mult,false},
&gt; {last\_write\_wins,false},
&gt; {precommit,[]},
&gt; {postcommit,[]},
&gt; {chash\_keyfun,{riak\_core\_util,chash\_std\_keyfun}},
&gt; {linkfun,
&gt;
&gt; {modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}},
&gt; {old\_vclock,86400},
&gt; {young\_vclock,20},
&gt; {big\_vclock,50},
&gt; {small\_vclock,10},
&gt; {r,quorum},
&gt; {w,quorum},
&gt; {dw,quorum},
&gt; {rw,quorum}],
&gt; undefined,
&gt; [{730750818665451459101842416358141509827966271488,
&gt; 'riak@127.0.0.1'}]}]}}]},
&gt; {&lt;0.12932.0&gt;,{5680,'riak@127.0.0.1'}}]}}
&gt;
&gt;
&gt; have you any idea about this problem?
&gt;
&gt; Thanks,
&gt;
&gt;
&gt; Giancarlo Frison
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

