---
title: "Re: Using UUID as keys is problematic for Riak Search"
description: ""
project: community
lastmod: 2014-08-10T18:04:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14635"
mailinglist_parent_id: "msg14634"
author_name: "David James"
project_section: "mailinglistitem"
sent_date: 2014-08-10T18:04:32-07:00
---


Yes, that clarifies it -- much appreciated.


On Sun, Aug 10, 2014 at 8:43 PM, Eric Redmond  wrote:

&gt; I'm at my laptop now so I can talk a bit more about it.
&gt;
&gt; Don't conflate the value type with the encodings. UUID is a field type,
&gt; just like how dates or integers are field types. They explain to the Solr
&gt; indexer how to reason about the value it gets. The field type string
&gt; "20140810" is encoded differently than the integer value 20140810 or Date
&gt; "20140810". This is important for the queries you can build, as a date
&gt; range query is different than an integer or string range.
&gt;
&gt; That said, in Solr, usually UUID is generated on the backend, such as
&gt; with UUIDUpdateProcessorFactory. Even so, you can no more send a binary
&gt; UUID than you can a binary date value.
&gt;
&gt; There are two encodings you have to think about when dealing with Solr.
&gt; Anything that's binary needs to be converted to a String that Solr can
&gt; understand. Base64 is how you convert a binary value to a string value. So
&gt; in the case of your key (in Erlang):
&gt;
&gt; 1&gt;
&gt; base64:encode(&lt;&lt;94,143,33,35,45,180,78,164,151,237,72,81,56,13,28,250&gt;&gt;).
&gt; &lt;&lt;"Xo8hIy20TqSX7UhROA0c+g=="&gt;&gt;
&gt;
&gt; base64 encoding libs exist in any language.
&gt;
&gt; Once you have this key string in base64, internally, Yokozuna will assume
&gt; that string is valid UTF8.
&gt;
&gt; I was probably a bit hasty when I said "yokozuna only supports UTF8 . What
&gt; I should have said is that "yokozuna assumes types/buckets/keys are UTF8
&gt; and encodes values appropriately."
&gt;
&gt; So in summation:
&gt;
&gt; UUID: Solr field type
&gt; Base64: Encode binary values to a string
&gt; UTF8: The assumed string encoding
&gt;
&gt; Does that help?
&gt; Eric
&gt;
&gt;
&gt; On Aug 10, 2014, at 5:03 PM, David James  wrote:
&gt;
&gt; Thanks for the quick responses.
&gt;
&gt; Eric: I don't understand. Why does Solr have the UUIDField (
&gt; http://lucene.apache.org/solr/4\_7\_0/solr-core/org/apache/solr/schema/UUIDField.html)
&gt; if it were not indexable? What is the nature of the limitation?
&gt;
&gt; Jason: Thanks, I will consider Base 64 encoding.
&gt;
&gt;
&gt; On Sun, Aug 10, 2014 at 7:19 PM, Jason Campbell  wrote:
&gt;
&gt;&gt; I like UUIDs for everything as well, although I expected compatibility
&gt;&gt; issues with something. Base 64 encoding the binary value is a nice
&gt;&gt; compromise for me, and takes 22 characters (if you drop the padding)
&gt;&gt; instead of the usual 36 for the hyphenated hex format.
&gt;&gt;
&gt;&gt; It would still require re encoding all the keys, but it's a partial
&gt;&gt; solutions.
&gt;&gt;
&gt;&gt; \*From: \*Eric Redmond
&gt;&gt; \*Sent: \*Monday, 11 August 2014 9:15 AM
&gt;&gt; \*To: \*David James
&gt;&gt; \*Cc: \*riak-users
&gt;&gt; \*Subject: \*Re: Using UUID as keys is problematic for Riak Search
&gt;&gt;
&gt;&gt; You're correct that yokozuna only supports utf8, because the Solr
&gt;&gt; interface only supports utf8 (note that the failure happens when attempting
&gt;&gt; to build a non-utf8 JSON add document command). There's not much we can do
&gt;&gt; here at the moment, since we've yet to (if ever) support a custom interface
&gt;&gt; to Solr that accepts arbitrary binary values. In the mean time, to use
&gt;&gt; yokozuna, you'll have to encode your keys to utf8.
&gt;&gt;
&gt;&gt; Eric Redmond, Engineer @ Basho
&gt;&gt;
&gt;&gt; On Sun, Aug 10, 2014 at 4:01 PM, David James 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt; I'm using UUIDs for keys in Riak -- converted to bytes, not UTF-8
&gt;&gt; strings. (I'd rather spend 16 bytes for each key, not 36.)
&gt;&gt;
&gt;&gt; As I understand it, Yokozuna maps the Riak key to \_yz\_id.
&gt;&gt;
&gt;&gt; Here is the suggested schema from the documentation:
&gt;&gt;
&gt;&gt; 
&gt;&gt; &gt; multiValued="false" required="true"/&gt;
&gt;&gt; 
&gt;&gt;
&gt;&gt; Would you expect this to work with Riak Search? I would hope so.
&gt;&gt;
&gt;&gt; (Or must keys be UTF-8 strings?)
&gt;&gt;
&gt;&gt; I get this error, which does not surprise me, given that the \_yz\_id is
&gt;&gt; defined as a string:
&gt;&gt;
&gt;&gt; ==&gt; log/error.log &lt;==
&gt;&gt;
&gt;&gt; 2014-08-10 18:24:16.221 [error] &lt;0.610.0&gt;@yz\_kv:index:206 failed to index
&gt;&gt; object
&gt;&gt; {&lt;&lt;"test-0001"&gt;&gt;,&lt;&lt;94,143,33,35,45,180,78,164,151,237,72,81,56,13,28,250&gt;&gt;}
&gt;&gt; with error {ucs,{bad\_utf8\_character\_code}} because
&gt;&gt; [{xmerl\_ucs,from\_utf8,1,[{file,"xmerl\_ucs.erl"},{line,185}]},{mochijson2,json\_encode\_string,2,[{file,"src/mochijson2.erl"},{line,186}]},{mochijson2,'-json\_encode\_proplist/2-fun-0-',3,[{file,"src/mochijson2.erl"},{line,167}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]},{mochijson2,json\_encode\_proplist,2,[{file,"src/mochijson2.erl"},{line,170}]},{mochijson2,'-json\_encode\_proplist/2-fun-0-',3,[{file,"src/mochijson2.erl"},{line,167}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]},{mochijson2,json\_encode\_proplist,2,[{file,"src/mochijson2.erl"},{line,170}]}]
&gt;&gt; I don't think changing the schema.xml type for \_yz\_id to "solr.UUIDField"
&gt;&gt; is a good idea.
&gt;&gt;
&gt;&gt; What can I do?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; David
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

