---
title: "Re: Issue with riak_client:list_keys"
description: ""
project: community
lastmod: 2010-04-13T12:03:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00028"
mailinglist_parent_id: "msg00026"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-04-13T12:03:19-07:00
---


This list\_keys method is updated asynchronously so it may not immediately
reflect the addition or removal of keys. The list\_keys method should
eventually reflect the deletion of the key. Can you try running list\_keys
after a delay?


On Tue, Apr 13, 2010 at 11:13 AM, Alexander Zhuravlev  wrote:

&gt; Hello,
&gt;
&gt; We are having an issue with riak\_client:list\_keys function.
&gt; The thing is that the function returns information about the keys which
&gt; were successfully deleted from a bucket. For example, please check
&gt; output from our tests below:
&gt;
&gt; (r...@macbook-siden)1&gt; {ok, C} = riak:client\_connect('r...@macbook-siden
&gt; ').
&gt; {ok,{riak\_client,'r...@macbook-siden',&lt;&lt;7,122,127,92&gt;&gt;}}
&gt; (r...@macbook-siden)2&gt; O0 = riak\_object:new(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;,
&gt; "val1").
&gt; {r\_object,&lt;&lt;"aaa"&gt;&gt;,&lt;&lt;"key1"&gt;&gt;,
&gt; [{r\_content,{dict,0,16,16,8,80,48,
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt; {{[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt; "val1"}],
&gt; [],
&gt; {dict,1,16,16,8,80,48,
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt; {{[],[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt; undefined}
&gt; (r...@macbook-siden)3&gt; C:put(O0, 2).
&gt; ok
&gt; (r...@macbook-siden)4&gt; C:list\_keys(&lt;&lt;"aaa"&gt;&gt;).
&gt; {ok,[&lt;&lt;"key1"&gt;&gt;]}
&gt; (r...@macbook-siden)5&gt; C:delete(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;, 2).
&gt; ok
&gt; (r...@macbook-siden)6&gt; C:get(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;, 2).
&gt; {error,notfound}
&gt; (r...@macbook-siden)7&gt; C:list\_keys(&lt;&lt;"aaa"&gt;&gt;).
&gt; {ok,[&lt;&lt;"key1"&gt;&gt;]}
&gt;
&gt; backend = ets
&gt; riak 0.9.1
&gt;
&gt; As you can see the key was successfully deleted (as it can be confirmed by
&gt; the output from riak\_client:get call), but riak\_client:list\_keys still
&gt; reports that the key
&gt; exists in the bucket. Is this the intended behavior of did we hit a bug in
&gt; riak?
&gt; Please advise.
&gt;
&gt; Thanks.
&gt;
&gt; --
&gt; Alexander Zhuravlev
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

