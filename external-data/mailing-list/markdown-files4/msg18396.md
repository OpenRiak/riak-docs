---
title: "Re: Leveled and Anti-Entropy"
description: ""
project: community
lastmod: 2017-07-21T07:44:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18396"
mailinglist_parent_id: "msg18395"
author_name: "Heinz N. Gies"
project_section: "mailinglistitem"
sent_date: 2017-07-21T07:44:27-07:00
---


Have you taken a look at the changes here 
https://github.com/Kyorai/riak\_core/pull/24 


It pulls the AAE work for riak\_kv into riak\_core.


&gt; On 21. Jul 2017, at 16:06, Martin Sumner  wrote:
&gt; 
&gt; 
&gt; I've added some anti-entropy features to Leveled (the pure-Erlang KV store 
&gt; designed as a Riak backend). These features are in-part an experiment in how 
&gt; to approach both anti-entropy and full-sync multi-data centre replication in 
&gt; the future.
&gt; 
&gt; There's a long write-up, including some history of AAE in Riak:
&gt; 
&gt; https://github.com/martinsumner/leveled/blob/master/docs/ANTI\_ENTROPY.md 
&gt; 
&gt; 
&gt; In summary, Riak's current AAE is based on cryptographically strong Merkle 
&gt; trees, and this experiment is based on removing that security strength, as it 
&gt; isn't relevant to the context in which is used. Instead Leveled now has 
&gt; Merkle Trees that can be merged and also can be built incrementally (i.e. be 
&gt; built key by key even when the keys are not in segment order).
&gt; 
&gt; Using these new trees (coined TicTac trees to fit into Leveled's terrible 
&gt; naming convention), we can build AAE trees in folds incrementally and hence 
&gt; at a lower cost, but also merge trees across independent stores. In the 
&gt; future trees can be built from folds using Riak coverage queries, across 
&gt; either indexes or objects in the store - and compared between different 
&gt; database clusters even where those clusters are partitioned differently e.g. 
&gt; different ring-sizes.
&gt; 
&gt; The expectation is that there will be more flexibility of choice in what we 
&gt; can decide to compare at run time - not just are the objects consistent, are 
&gt; the indexes consistent. Also split from partition constraints there will be 
&gt; improved flexibility in what we can decide to compare between - e.g. make it 
&gt; easier to compare with a different database.
&gt; 
&gt; Coupled with this there's a demonstration of using temporary indexes in 
&gt; Leveled, index entries that auto-expire at a TTL, and we've shown how this 
&gt; can be used with tree-creating folds to compare recent changes between stores 
&gt; at a lower cost than comparing the whole database state: with the added 
&gt; advantage that the long-term footprint of the database is not extended by 
&gt; maintaining a separate copy of all the keys and hashes.
&gt; 
&gt; Concurrently to this, we now have some other work ongoing in the space of 
&gt; replication and anti-entropy:
&gt; 
&gt; - @russelldb is continuing to test and improve his open source real-time 
&gt; replication solution (rabl) which uses RabbitMQ. He's hoping to be able to 
&gt; talk further on progress with this by the end of August.
&gt; - I'm working on implementing in riak\_core a core\_node\_worker\_pool, which is 
&gt; intended to compliment the core\_vnode\_worker\_pool but allow for coverage 
&gt; queries where snapshots are taken on a covering set of vnodes, but folds are 
&gt; then scheduled to run one-at-a-time on each node. This can then be used to 
&gt; regulate the impact of anti-entropy folds.
&gt; 
&gt; Our current target is to have a release candidate of open-source replication 
&gt; (both real-time and full-sync) by the end of September. This will initially 
&gt; be focused only on replication between two Riak clusters.
&gt; 
&gt; Regards
&gt; 
&gt; Martin (@masleeds)
&gt; 
&gt; P.S. Hopefully next Friday we should also be able to report back on the 
&gt; improvements and test enhancements that followed up the work on riak\_core 
&gt; claim.
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



signature.asc
Description: Message signed with OpenPGP
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

