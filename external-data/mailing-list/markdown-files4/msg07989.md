---
title: "Re: Intermittent MapReduce crashes (reserve_vm)"
description: ""
project: community
lastmod: 2012-07-18T14:44:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07989"
mailinglist_parent_id: "msg07342"
author_name: "Matthew Tovbin"
project_section: "mailinglistitem"
sent_date: 2012-07-18T14:44:00-07:00
---


Hi Brian,

I've also started getting the same error lately.

Did you able to solve it? Does any one has a clue what to do with it?!


-Matthew



On Fri, Apr 27, 2012 at 10:38 PM, Brian Conway wrote:

&gt; Any ideas? Using JS for MapReduce, I'm currently unable to do anything
&gt; except trivial tasks without these crashes, so I must be doing
&gt; something wrong. I'm fine with slow results (it is virtualized on
&gt; commodity hardware, after all), but intermittent VM errors don't seem
&gt; right. Thanks in advance.
&gt;
&gt; Brian Conway
&gt;
&gt; On Thu, Apr 26, 2012 at 12:23 AM, Brian Conway 
&gt; wrote:
&gt; &gt; I have a test cluster of 3 nodes running locally (virtualized), with
&gt; &gt; default configuration + eleveldb. The nodes have plenty of ram and
&gt; &gt; never hit swap. I've already bumped up the JS VM count (8 -&gt; 24) after
&gt; &gt; getting preflist\_exhausted errors, and I now get the follow
&gt; &gt; intermittently when posting to /mapred:
&gt; &gt;
&gt; &gt; $ curl -X POST http://10.236.174.131:8098/mapred -H "Content-Type:
&gt; &gt; application/json" -d @volume.js
&gt; &gt;
&gt; {"phase":3,"error":"{noproc,{gen\_server,call,[riak\_kv\_js\_map,{reserve\_vm,&lt;11534.1650.0&gt;},infinity]}}","input":"{ok,{r\_object,&lt;&lt;\"vol\"&gt;&gt;,&lt;&lt;\"6724\_2012-01-21\_18\"&gt;&gt;,[{r\_content,{dict,4,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;\"content-type\"&gt;&gt;,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110],[&lt;&lt;\"X-Riak-VTag\"&gt;&gt;,52,68,111,85,117,98,80,99,106,114,79,106,71,115,107,118,85,67,88,117,68,107]],[[&lt;&lt;\"index\"&gt;&gt;]],[],[[&lt;&lt;\"X-Riak-Last-Modified\"&gt;&gt;|{1335,385687,399828}]],[],[]}}},&lt;&lt;\"{\"dlid\":
&gt; &gt; \"1\", \"rate\": \"0.08\", \"cnid\":
&gt; &gt;
&gt; \"...\"&gt;&gt;}],...},...}","type":"exit","stack":"[{gen\_server,call,3},{riak\_kv\_js\_manager,blocking\_dispatch,4},{riak\_kv\_mrc\_map,map\_js,3},{riak\_kv\_mrc\_map,process,3},{riak\_pipe\_vnode\_worker,process\_input,3},{riak\_pipe\_vnode\_worker,wait\_for\_input,2},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]"}
&gt; &gt;
&gt; &gt; This only seems to happen every two or three attempts, the rest
&gt; &gt; complete successfully. Doing the same with Python and protocol buffers
&gt; &gt; also gives inconsistent results. Those attempts sometimes work and
&gt; &gt; sometimes throws off errors that are either the same as above, or like
&gt; &gt; these (may be unrelated):
&gt; &gt;
&gt; &gt; ...
&gt; &gt; File
&gt; "/home/bconway/scratch/riakenv/lib/python2.6/site-packages/riak/transports/pbc.py",
&gt; &gt; line 535, in recv\_pkt
&gt; &gt; % len(nmsglen))
&gt; &gt; riak.RiakError: 'Socket returned short packet length 3 - expected 4'
&gt; &gt;
&gt; &gt; ...
&gt; &gt; File
&gt; "/home/bconway/scratch/riakenv/lib/python2.6/site-packages/riak/transports/pbc.py",
&gt; &gt; line 535, in recv\_pkt
&gt; &gt; % len(nmsglen))
&gt; &gt; riak.RiakError: 'Socket returned short packet length 1 - expected 4'
&gt; &gt;
&gt; &gt; The MapReduce itself is wide but fairly simple: 10 user bucket-key
&gt; &gt; pairs, a few layers of links, and dump the final data:
&gt; &gt;
&gt; &gt; $ cat volume.js
&gt; &gt;
&gt; {"inputs":[["user","1672\_2012-01"],["user","2672\_2012-01"],["user","3672\_2012-01"],["user","4672\_2012-01"],["user","5672\_2012-01"],["user","6672\_2012-01"],["user","672\_2012-01"],["user","6723\_2012-01"],["user","6724\_2012-01"],["user","6725\_2012-01"]],
&gt; &gt; "query":[{"link":{"tag":"day"}},
&gt; &gt; {"link":{"tag":"usage"}},
&gt; &gt; {"link":{"tag":"contact"}},
&gt; &gt; {"map":{
&gt; &gt; "language":"javascript",
&gt; &gt; "name":"Riak.mapValuesJson"
&gt; &gt; }}
&gt; &gt; ]
&gt; &gt; }
&gt; &gt;
&gt; &gt; The logs are fairly chatty, let me know what else I should add:
&gt; &gt;
&gt; &gt; \*\* Reason for termination ==
&gt; &gt; \*\*
&gt; {{{badmatch,[]},[{riak\_kv\_js\_manager,needs\_reload,2},{riak\_kv\_js\_manager,handle\_call,3},{gen\_server,handle\_msg,5},{proc\_lib,init\_p\_do\_apply,3}]},{gen\_server,call,[riak\_kv\_js\_map,{mark\_idle,&lt;0.1756.0&gt;},infinity]}}
&gt; &gt; 2012-04-26 00:18:18 =CRASH REPORT====
&gt; &gt; crasher:
&gt; &gt; initial call: riak\_kv\_js\_vm:init/1
&gt; &gt; pid: &lt;0.1756.0&gt;
&gt; &gt; registered\_name: []
&gt; &gt; exception exit:
&gt; &gt;
&gt; {{{badmatch,[]},[{riak\_kv\_js\_manager,needs\_reload,2},{riak\_kv\_js\_manager,handle\_call,3},{gen\_server,handle\_msg,5},{proc\_lib,init\_p\_do\_apply,3}]},{gen\_server,call,[riak\_kv\_js\_map,{mark\_idle,&lt;0.1756.0&gt;},infinity]}}
&gt; &gt; in function gen\_server:terminate/6
&gt; &gt; in call from proc\_lib:init\_p\_do\_apply/3
&gt; &gt; ancestors: [riak\_kv\_js\_sup,riak\_kv\_sup,&lt;0.256.0&gt;]
&gt; &gt; messages:
&gt; [{'DOWN',#Ref&lt;0.0.0.149247&gt;,process,&lt;0.1753.0&gt;,{timeout,{gen\_server,call,[&lt;0.1764.0&gt;,{checkout\_to,&lt;0.2736.0&gt;},1000]}}}]
&gt; &gt; links: [&lt;0.275.0&gt;]
&gt; &gt; dictionary: []
&gt; &gt; trap\_exit: false
&gt; &gt; status: running
&gt; &gt; heap\_size: 1597
&gt; &gt; stack\_size: 24
&gt; &gt; reductions: 627539
&gt; &gt; neighbours:
&gt; &gt;
&gt; &gt; Thanks for any help.
&gt; &gt;
&gt; &gt; Brian Conway
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

