---
title: "Re: Question from a noob about link walking"
description: ""
project: community
lastmod: 2011-09-12T09:18:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04671"
mailinglist_parent_id: "msg04663"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-09-12T09:18:36-07:00
---


Hi Antonio,

Links only work in one direction so it is not possible to find the items
that link to an object. You would need to apply links on both sides of the
relationship.

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


2011/9/12 Antonio Fern√°ndez Vara 

&gt; Hi,
&gt;
&gt; I'm using Ruby and I'm trying to learn how to use Riak basics, now I'm
&gt; learning links and I have a question I know will be so easy to answer by
&gt; you, experts :).
&gt;
&gt; I know how to search with a simple MapReduce query what items I'm linking,
&gt; but now the opposite, what items links me.
&gt;
&gt; As little concept I've made this simple script, just it creates 10 items in
&gt; a bucket, 20 relations as follow, 20 as like (I don't try to do the next
&gt; graph thing, just was the first tags that come to my brain): (BTW: I have
&gt; tryed to find how this is done in ripple but seems I need to study more to
&gt; obtain the answer looking the code Sean wrote).
&gt;
&gt; As you can see, I just create those 10 items in the bucket (1..10) and
&gt; randomly add the relations. The mapreduce function works showing me all the
&gt; links in each relation for each object in the last iteration.
&gt;
&gt; Now, I'm trying to find how to get the reverse.
&gt;
&gt; Thank you in advance. Hope someone can get some time and help me.
&gt;
&gt; -- test-creator.rb --
&gt; require 'rubygems'
&gt; require 'riak'
&gt;
&gt; client = Riak::Client.new
&gt; client.http\_port = 8091
&gt;
&gt; bucket\_name = "users8" #change for test in different bucket
&gt;
&gt; bucket = client.bucket(bucket\_name)
&gt;
&gt; 10.times do |n|
&gt; o = bucket.new("#{n + 1}")
&gt; o.data = "#{n + 1}"
&gt; o.store
&gt; end
&gt;
&gt; 20.times do |n|
&gt; source = rand(10) + 1
&gt; destination = rand(10) + 1
&gt; puts "#{source} --&gt; follow --&gt; #{destination}"
&gt; o = bucket["#{source}"]
&gt; o.links &lt;&lt; Riak::Link.new(bucket\_name, destination, 'follow')
&gt; o.store
&gt; end
&gt;
&gt; 20.times do |n|
&gt; source = rand(10) + 1
&gt; destination = rand(10) + 1
&gt; puts "#{source} --&gt; like --&gt; #{destination}"
&gt; o = bucket["#{source}"]
&gt; o.links &lt;&lt; Riak::Link.new(bucket\_name, destination, 'like')
&gt; o.store
&gt; end
&gt;
&gt; 10.times do |n|
&gt; results = Riak::MapReduce.new(client).add(bucket\_name, "#{n +
&gt; 1}").link(:bucket =&gt; bucket\_name, :tag =&gt; 'follow').map("function(v) {
&gt; return [JSON.parse(v.values[0].data)]; }", :keep =&gt; true).run
&gt; puts "follow #{n + 1} = "
&gt; p results
&gt; results = Riak::MapReduce.new(client).add(bucket\_name, "#{n +
&gt; 1}").link(:bucket =&gt; bucket\_name, :tag =&gt; 'like').map("function(v) { return
&gt; [JSON.parse(v.values[0].data)]; }", :keep =&gt; true).run
&gt; puts "like #{n + 1} = "
&gt; p results
&gt; end
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

