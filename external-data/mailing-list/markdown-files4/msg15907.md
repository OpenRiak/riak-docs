---
title: "Re: Trouble with Riak Search JSON Extractor"
description: ""
project: community
lastmod: 2015-03-22T18:26:35-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15907"
mailinglist_parent_id: "msg15906"
author_name: "Matt Brooks"
project_section: "mailinglistitem"
sent_date: 2015-03-22T18:26:35-07:00
---


Not getting any errors... but I did notice something interesting after
deleting the nodes on my system and then reconfiguring them.

If the first time I set up a schema I add the multivalued field in
question, everything works. If I then change the schema and then update it
over HTTP, the changes do not take affect.

For example, when I reconfigured the nodes on my system I added kept the
multivalued "groups" field I mentioned above. I then added some users and
was able to successfully retrieve them using q=groups:\* or something more
specific. I then changed the schema from "groups" to "groups.id" and PUT it
on the server successfully (a subsequent GET returned the new schema). I
also updated the users so that the "groups" array was changed to an array
of JSON objects, each with an "id" field that would match the "groups.id"
field in the schema. I then tried to query the users using q=groups.id:\*.
This failed.

Do changed to the schema not cause the solr indexes to update?

PS: I dug around in $RIAK/data/yz/user/conf and noticed a user.xml file.
The file held the ORIGINAL schema, not the updated one.

On Sun, Mar 22, 2015 at 6:45 PM Zeeshan Lakhani  wrote:

&gt; Hello Matt,
&gt;
&gt; Are you receiving any indexing errors in your logs (check the Solr logs as
&gt; well)? To be sure, I just wrote a test (using our erlang pb api,
&gt; https://github.com/basho/yokozuna/pull/474/files#diff-5
&gt; d0015658ff90b94cb1a00329ffafe00R251) using a custom schema, and I didn’t
&gt; run into any troubles; I also checked via the http api. If you have the
&gt; required \_yz\* fields, you should get those back with the document. If you
&gt; want the groups items themselves, you’d have to make `stored` true.
&gt;
&gt; Zeeshan Lakhani
&gt; programmer |
&gt; software engineer at @basho |
&gt; org. member/founder of @papers\_we\_love | paperswelove.org
&gt; twitter =&gt; @zeeshanlakhani
&gt;
&gt; On Mar 22, 2015, at 4:13 PM, Matt Brooks  wrote:
&gt;
&gt; Hello,
&gt;
&gt; I have a quick question about a search schema that would index an array of
&gt; strings in a JSON object. I am storing user data in JSON that looks
&gt; something like this:
&gt;
&gt; {
&gt; "name" : "John Smith",
&gt; "email" : "jsm...@gmail.com",
&gt; "groups" : [
&gt; "3304cf79",
&gt; "abe155cf"
&gt; ]}
&gt;
&gt; The custom schema I use for users includes this field entry:
&gt;
&gt;  multiValued="true"/&gt;
&gt;
&gt; I also have the following field type entry:
&gt;
&gt; 
&gt;
&gt; I assumed that these entries would allow me to search for users using a
&gt; query like:
&gt;
&gt; curl $RIAK/search/query/user?wt=json&q=groups:3304cf79
&gt;
&gt; But no docs are returned. I'm almost certain I have an issue with my
&gt; schema. How can I query users by string entries in the "groups" array?
&gt;
&gt; Thank you,
&gt; Matt.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

