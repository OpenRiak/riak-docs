---
title: "Re: stalled handoffs with riak 1.3.1 and eleveldb"
description: ""
project: community
lastmod: 2013-05-13T05:35:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11060"
mailinglist_parent_id: "msg11052"
author_name: "Simon Effenberg"
project_section: "mailinglistitem"
sent_date: 2013-05-13T05:35:03-07:00
---


I found this in the logs for hours:


2013-05-12 04:39:13.002 UTC [info] 
&lt;0.188.0&gt;@riak\_core\_handoff\_manager:handle\_info:279 An outbound handoff of 
partition riak\_kv\_vnode 884893569477695126256137301058686984557302906880 was 
terminated for reason: {shutdown,max\_concurrency}


after the rolling restart it started working:

2013-05-12 05:11:52.277 UTC [info] 
&lt;0.4696.0&gt;@riak\_core\_handoff\_sender:start\_fold:130 Starting hinted\_handoff 
transfer of riak\_kv\_vnode from 'riak@10.46.109.201' 
1255977969581244695331291653115555720016817029120 to 'riak@10.46.109.205' 
1255977969581244695331291653115555720016817029120


also the AAE was suddenly working:

2013-05-12 06:44:35.889 UTC [info] 
&lt;0.7820.3&gt;@riak\_kv\_exchange\_fsm:key\_exchange:204 Repaired 1 keys during active 
anti-entropy exchange of {108470824645652950960429733678161630365088743424,12} 
between {137015778499772148581595453067151533092743675904,'riak@10.46.109.201'} 
and {14272476927059598810582859694494951363827
4662400,'riak@10.46.109.202'}

The situation started to long ago so I have no log files for the start of this 
event except some error logs which only shows:

\*\* Removing (timedout) connection \*\*
2013-05-05 00:35:30 UTC =ERROR REPORT====
\*\* Node 'riak@10.47.109.205' not responding \*\*
\*\* Removing (timedout) connection \*\*
2013-05-05 00:35:30 UTC =ERROR REPORT====
\*\* Node 'riak@10.47.109.201' not responding \*\*
\*\* Removing (timedout) connection \*\*
2013-05-05 00:35:30 UTC =ERROR REPORT====
\*\* Node 'riak@10.47.109.202' not responding \*\*
\*\* Removing (timedout) connection \*\*
2013-05-05 00:36:30 UTC =ERROR REPORT====
\*\* Node 'riak@10.47.109.202' not responding \*\*
\*\* Removing (timedout) connection \*\*
2013-05-05 00:36:30 UTC =ERROR REPORT====
\*\* Node 'riak@10.47.109.205' not responding \*\*

this "could" be the start of the problem and we have had some weird network 
issues between to DC's at this timeframe with some broken TCP connections. But 
it looks like Riak wasn't able to get out of this situation by itself without a 
rolling restart.

Any ideas?

Cheers,
Simon


On Sun, 12 May 2013 07:34:50 +0200
Simon Effenberg  wrote:

&gt; Hi list,
&gt; 
&gt; this morning I did a "riak-admin transfers" on the riak machines and
&gt; saw this:
&gt; 
&gt; [root@kriak46-1:~]# riak-admin transfers
&gt; Attempting to restart script through sudo -H -u riak
&gt; 'riak@10.47.109.206' waiting to handoff 30 partitions
&gt; 'riak@10.47.109.202' waiting to handoff 3 partitions
&gt; 'riak@10.47.109.201' waiting to handoff 15 partitions
&gt; 'riak@10.46.109.206' waiting to handoff 1 partitions
&gt; 'riak@10.46.109.205' waiting to handoff 1 partitions
&gt; 'riak@10.46.109.204' waiting to handoff 29 partitions
&gt; 'riak@10.46.109.203' waiting to handoff 16 partitions
&gt; 'riak@10.46.109.202' waiting to handoff 17 partitions
&gt; 'riak@10.46.109.201' waiting to handoff 3 partitions
&gt; 
&gt; Active Transfers:
&gt; 
&gt; and this didn't changed for at least 15 minutes while checking.
&gt; 
&gt; I also did on each node:
&gt; 
&gt; riak-admin ring-status
&gt; 
&gt; and every node said:
&gt; 
&gt; Attempting to restart script through sudo -H -u riak
&gt; ================================== Claimant 
&gt; ===================================
&gt; Claimant: 'riak@10.46.109.201'
&gt; Status: up
&gt; Ring Ready: true
&gt; 
&gt; ============================== Ownership Handoff 
&gt; ==============================
&gt; No pending changes.
&gt; 
&gt; ============================== Unreachable Nodes 
&gt; ==============================
&gt; All nodes are up and reachable
&gt; 
&gt; 
&gt; So why do I not see any "Ownership Handoff" on some nodes (or is this 
&gt; "another" handoff)?
&gt; Also how could I get rid of the waiting handoffs?
&gt; 
&gt; My solution was a rolling restart which helped. But I don't know how it was 
&gt; possible to get into this situation and also it would be nice to resolve it 
&gt; without a rolling restart.
&gt; 
&gt; Any ideas?
&gt; 
&gt; Cheers,
&gt; Simon
&gt; 



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

