---
title: "Re: Riak Overload Behavior"
description: ""
project: community
lastmod: 2012-05-14T19:27:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07452"
mailinglist_parent_id: "msg07451"
author_name: "Sean O'Connor"
project_section: "mailinglistitem"
sent_date: 2012-05-14T19:27:19-07:00
---


I've spent a while trying to write a script to replicate this problem but so 
far I've been unsuccessful. I'll try to keep an eye out to see if I can spot 
patterns for when this happens but otherwise I'll probably need to drop this 
problem for a little while. 

If anybody has ideas on additional things I can try to check to isolate the 
cause of these 400 errors I'd be happy to give it a try. Just in case it 
sparks ideas for possible causes below is a bit more information about our test 
suite/environment: 
Heavy use of leveldb storage backend and secondary index queries.
Both javascript and erlang map reduce functions are used.
The error has been observed with Riak 1.1.2 running on both OS X 10.7.3 
installed via homebrew and on ubuntu 11.04 installed via the package based chef 
cookbook.
The OS X system has a single riak instance running, the linux based system is a 
3 node cluster running on 3 EC2 instances.
The app.config being used can be found at 
https://gist.github.com/83b59b51b94b38e451b0

Thanks again for the quick response!


-- 
Sean O'Connor
Co-Founder/CTO

FocusLab (http://www.focuslab.io)
(845)669-0883


On Monday, May 14, 2012 at 7:56 PM, Sean O'Connor wrote:

&gt; Interesting. I am running Riak 1.1.2 and I am making the requests via 
&gt; version 1.4.0 of the python client using the HTTP transport class. I'll see 
&gt; if I can create a simple script that replicates the problem and post it to 
&gt; the list sometime later tonight or tomorrow.
&gt; 
&gt; -- 
&gt; Sean O'Connor
&gt; Co-Founder/CTO
&gt; 
&gt; FocusLab (http://www.focuslab.io)
&gt; (845)669-0883
&gt; 
&gt; 
&gt; On Monday, May 14, 2012 at 7:48 PM, Sean Cribbs wrote:
&gt; 
&gt; &gt; Hi Sean,
&gt; &gt; 
&gt; &gt; Are you running your test suite against 1.1.x? We have seen 400 errors in 
&gt; &gt; the past where the client in a keep-alive connection emitted additional 
&gt; &gt; CRLFs or other whitespace beyond the ones required for the request. The 
&gt; &gt; next time a request was made, the 400 error was already on the wire because 
&gt; &gt; the HTTP parser failed to recognize the (non-existent) request in the 
&gt; &gt; additional whitespace. This error should be fixed already in 1.1.x. 
&gt; &gt; 
&gt; &gt; On Mon, May 14, 2012 at 5:45 PM, Sean O'Connor  &gt; (mailto:s...@focuslab.io)&gt; wrote:
&gt; &gt; &gt; Hello, 
&gt; &gt; &gt; 
&gt; &gt; &gt; I've been seeing some strange behavior from Riak and any help or feedback 
&gt; &gt; &gt; would be very welcome.
&gt; &gt; &gt; 
&gt; &gt; &gt; In particular, we've been seeing pseudo-radom 400 errors from Riak when 
&gt; &gt; &gt; we run our test suite. Our test suite hits riak pretty hard to test 
&gt; &gt; &gt; various queries and situations in our app and the errors seem to happen a 
&gt; &gt; &gt; few seconds after the CPUs on the testing machine get saturated. I say 
&gt; &gt; &gt; psuodo-random as the errors tends to happen in a particularly riak heavy 
&gt; &gt; &gt; portion of our test suite but the specific call to riak that errors is 
&gt; &gt; &gt; often different (reads, writes, map/reduce jobs, 2i queries). The thing 
&gt; &gt; &gt; that is really baffling about these errors is there doesn't seem to be 
&gt; &gt; &gt; any information attached other than the 400 message and nothing shows up 
&gt; &gt; &gt; in any of the riak logs. 
&gt; &gt; &gt; 
&gt; &gt; &gt; If we introduce a 2 second delay between tests in our test suite, the 
&gt; &gt; &gt; problem goes away but obviously slows down our test suite quite a bit. 
&gt; &gt; &gt; Aside from that, I am concerned about this potentially happening in our 
&gt; &gt; &gt; production cluster. 
&gt; &gt; &gt; 
&gt; &gt; &gt; Is this more or less the expected behavior of Riak when it gets 
&gt; &gt; &gt; overwhelmed or does it sound like there is something that should be 
&gt; &gt; &gt; investigated further here? I suspect that I can create a script to 
&gt; &gt; &gt; replicate the problem but if this is somewhat expected then I won't waste 
&gt; &gt; &gt; the time writing it. 
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks! 
&gt; &gt; &gt; 
&gt; &gt; &gt; -- 
&gt; &gt; &gt; Sean O'Connor
&gt; &gt; &gt; Co-Founder/CTO
&gt; &gt; &gt; 
&gt; &gt; &gt; FocusLab (http://www.focuslab.io)
&gt; &gt; &gt; (845)669-0883 (tel:%28845%29669-0883) 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; Sean Cribbs 
&gt; &gt; Software Engineer
&gt; &gt; Basho Technologies, Inc.
&gt; &gt; http://basho.com/
&gt; &gt; 
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

