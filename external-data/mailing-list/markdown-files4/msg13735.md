---
title: "Re: Riak 1.4.2 crashing"
description: ""
project: community
lastmod: 2014-03-01T11:18:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13735"
mailinglist_parent_id: "msg13734"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2014-03-01T11:18:06-08:00
---


Do you have active entropy enabled: {anti\_entropy, {on, []}} in app.config 
file ?

If so, please check file count there also: {anti\_entropy\_data\_dir, â€¦

Matthew


On Mar 1, 2014, at 1:54 PM, Bryan Hughes  wrote:

&gt; Howdy,
&gt; 
&gt; I am having a problem with Riak crashing (note, this not in production) with 
&gt; "maximum number of file descriptors exhausted'. The problem is, I have my 
&gt; file descriptors bumped pretty high. I am on a Mac with 10.9.2, with 16 GB of 
&gt; memory.
&gt; 
&gt; launchctl limit
&gt; cpu unlimited unlimited
&gt; filesize unlimited unlimited
&gt; data unlimited unlimited
&gt; stack 8388608 67104768
&gt; core 0 unlimited
&gt; rss unlimited unlimited
&gt; memlock unlimited unlimited
&gt; maxproc 709 1064
&gt; maxfiles 65536 65536
&gt; 
&gt; There are only 372 files in the data bitcask directory:
&gt; 
&gt; bryan@yetitron:/opt/riak-1.4.2$ ls data/bitcask/\*/\* | wc -l
&gt; 372
&gt; 
&gt; Here is the message repeated many times from the error.log
&gt; 
&gt; 2014-03-01 10:38:55.080 [error] &lt;0.15839.0&gt; gen\_server memsup terminated with 
&gt; reason: maximum number of file descriptors exhausted, check ulimit -n
&gt; 2014-03-01 10:38:55.080 [error] &lt;0.15839.0&gt; CRASH REPORT Process memsup with 
&gt; 0 neighbours exited with reason: maximum number of file descriptors 
&gt; exhausted, check ulimit -n in gen\_server:terminate/6 line 747
&gt; 2014-03-01 10:38:55.080 [error] &lt;0.86.0&gt; Supervisor os\_mon\_sup had child 
&gt; memsup started with memsup:start\_link() at &lt;0.15839.0&gt; exit with reason 
&gt; maximum number of file descriptors exhausted, check ulimit -n in context 
&gt; child\_terminated
&gt; 
&gt; Here is the crash.log:
&gt; 
&gt; 2014-03-01 10:38:55 =ERROR REPORT====
&gt; \*\* Generic server memsup terminating
&gt; \*\* Last message in was 
&gt; {'EXIT',&lt;0.15840.0&gt;,{emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd 
&gt; 2&gt;&1"},[stream]],[]},{os,start\_port\_srv\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\_port\_srv\_loop,0,[{file,"os.erl"},{line,270}]}]}}
&gt; \*\* When Server state == 
&gt; {state,{unix,darwin},false,undefined,undefined,false,60000,30000,0.8,0.05,&lt;0.15840.0&gt;,#Ref&lt;0.0.0.137055&gt;,undefined,[reg],[]}
&gt; \*\* Reason for termination ==
&gt; \*\* {emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd 
&gt; 2&gt;&1"},[stream]],[]},{os,start\_port\_srv\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\_port\_srv\_loop,0,[{file,"os.erl"},{line,270}]}]}
&gt; 2014-03-01 10:38:55 =CRASH REPORT====
&gt; crasher:
&gt; initial call: memsup:init/1
&gt; pid: &lt;0.15839.0&gt;
&gt; registered\_name: memsup
&gt; exception exit: {{emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd 
&gt; 2&gt;&1"},[stream]],[]},{os,start\_port\_srv\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\_port\_srv\_loop,0,[{file,"os.erl"},{line,270}]}]},[{gen\_server,terminate,6,[{file,"gen\_server.erl"},{line,747}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,227}]}]}
&gt; ancestors: [os\_mon\_sup,&lt;0.85.0&gt;]
&gt; messages: []
&gt; links: [&lt;0.86.0&gt;]
&gt; dictionary: []
&gt; trap\_exit: true
&gt; status: running
&gt; heap\_size: 377
&gt; stack\_size: 24
&gt; reductions: 216
&gt; neighbours:
&gt; 2014-03-01 10:38:55 =SUPERVISOR REPORT====
&gt; Supervisor: {local,os\_mon\_sup}
&gt; Context: child\_terminated
&gt; Reason: {emfile,[{erlang,open\_port,[{spawn,"/bin/sh -s unix:cmd 
&gt; 2&gt;&1"},[stream]],[]},{os,start\_port\_srv\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\_port\_srv\_loop,0,[{file,"os.erl"},{line,270}]}]}
&gt; Offender: 
&gt; [{pid,&lt;0.15839.0&gt;},{name,memsup},{mfargs,{memsup,start\_link,[]}},{restart\_type,permanent},{shutdown,2000},{child\_type,worker}]
&gt; 
&gt; 2014-03-01 10:38:55 =SUPERVISOR REPORT====
&gt; Supervisor: {local,os\_mon\_sup}
&gt; Context: shutdown
&gt; Reason: reached\_max\_restart\_intensity
&gt; Offender: 
&gt; [{pid,&lt;0.15839.0&gt;},{name,memsup},{mfargs,{memsup,start\_link,[]}},{restart\_type,permanent},{shutdown,2000},{child\_type,worker}]
&gt; 
&gt; 2014-03-01 10:38:57 =SUPERVISOR REPORT====
&gt; Supervisor: {local,os\_mon\_sup}
&gt; Context: shutdown\_error
&gt; Reason: killed
&gt; Offender: 
&gt; [{pid,&lt;0.92.0&gt;},{name,cpu\_sup},{mfargs,{cpu\_sup,start\_link,[]}},{restart\_type,permanent},{shutdown,2000},{child\_type,worker}]
&gt; 
&gt; Cheers,
&gt; Bryan
&gt; 
&gt; -- 
&gt; Bryan Hughes
&gt; Go Factory
&gt; http://www.go-factory.net
&gt; 
&gt; "Internet Class, Enterprise Grade"
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

