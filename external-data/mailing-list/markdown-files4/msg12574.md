---
title: "Re: Bucket properties not updated"
description: ""
project: community
lastmod: 2013-10-09T12:45:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12574"
mailinglist_parent_id: "msg12573"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-10-09T12:45:02-07:00
---


Could this be a duplicate of bug 660?
https://github.com/basho/riak\_kv/issues/660

I can reliably reproduce this on a local 5 node stagedevrel cluster on Riak
1.4.2 and develop.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Wed, Oct 9, 2013 at 12:35 PM, Daniel Iwan  wrote:

&gt; Thank for reply.
&gt;
&gt; The thing is that bucket never converges. The allow\_mult remains false
&gt; even several minutes after handoff had finished.
&gt; I don't know whether it's because properties get overwritten by defaults
&gt; during gossip or it's because message from client(s) never reaches Riak.
&gt;
&gt; This situation is potentially very dangerous for us. As I have no way of
&gt; checking if allow\_mult has incorrect value (Riak client returns true)
&gt; it simply means write loss during updates.
&gt;
&gt; Is there a way to debug what's happening or check what's in the ring?
&gt;
&gt; Regards
&gt; Daniel Iwan
&gt;
&gt;
&gt;
&gt; On 9 October 2013 20:08, Joe Caswell  wrote:
&gt;
&gt;&gt; Daniel,
&gt;&gt;
&gt;&gt; Custom (i.e. non-default) bucket properties are currently stored in the
&gt;&gt; ring. Once you set a bucket property on one node, the updated ring must be
&gt;&gt; gossiped to the other nodes. I assume by 'vnode transfer' you mean
&gt;&gt; handoff. An ownership handoff would also generate changes to the ring
&gt;&gt; which need to be gossiped, and so could slow the propagation of the bucket
&gt;&gt; data. If you are setting bucket properties at multiple nodes
&gt;&gt; simultaneously, there will be additional steps to resolve the change in
&gt;&gt; order for the ring to converge. If all nodes are online and reachable, the
&gt;&gt; change should complete very quickly (I would consider 1 second somewhat
&gt;&gt; slow).
&gt;&gt;
&gt;&gt; Joe Caswell
&gt;&gt;
&gt;&gt; From: Daniel Iwan 
&gt;&gt; Date: Wednesday, October 9, 2013 7:39 AM
&gt;&gt; To: "riak-users@lists.basho.com" 
&gt;&gt; Subject: Bucket properties not updated
&gt;&gt;
&gt;&gt; Hi
&gt;&gt;
&gt;&gt; With Java client 1.1.3 and Riak 1.3.1
&gt;&gt; I'm doing:
&gt;&gt;
&gt;&gt; WriteBucket wb =
&gt;&gt; iclient.createBucket(BUCKET\_NAME).nVal(3).allowSiblings(true);
&gt;&gt; Bucket b = wb.execute();
&gt;&gt;
&gt;&gt; \_logger.fine("Regular bucket: " + bucket + ", allows siblings? " +
&gt;&gt; bucket.getAllowSiblings());
&gt;&gt;
&gt;&gt; DomainBucketBuilder&lt; MyObjectInRiak &gt; builder =
&gt;&gt; DomainBucket.builder(bucket, MyObjectInRiak.class);
&gt;&gt;
&gt;&gt; builder.r(RIAK\_TX\_R\_VALUE);
&gt;&gt; builder.w(RIAK\_TX\_W\_VALUE);
&gt;&gt; builder.rw(RIAK\_TX\_RW\_VALUE);
&gt;&gt; builder.returnDeletedVClock(true);
&gt;&gt; builder.returnBody(true);
&gt;&gt; builder.basicQuorum(false);
&gt;&gt;
&gt;&gt; with custom resolver, mutator and converter.
&gt;&gt; This code runs on 3 servers at the same time during a test and I know
&gt;&gt; Riak db is empty
&gt;&gt; and bucket BUCKET\_NAME does not exist.
&gt;&gt;
&gt;&gt; log shows that all 3 servers see allowSibbling set to true, but
&gt;&gt; occasionally test fails and curl shows allow\_multi is false on that bucket!
&gt;&gt;
&gt;&gt; Is there any delay, race condition etc in Riak, or client library. that
&gt;&gt; would explain why that bucket property is not set?
&gt;&gt; During a test vnode transfer occurs but that should not matter I guess?
&gt;&gt;
&gt;&gt; Regards
&gt;&gt; Daniel
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

