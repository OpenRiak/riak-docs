---
title: "Re: about hash calculation in reference page at docs.basho.com"
description: ""
project: community
lastmod: 2013-01-29T06:48:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09910"
mailinglist_parent_id: "msg09905"
author_name: "Donald Yan"
project_section: "mailinglistitem"
sent_date: 2013-01-29T06:48:14-08:00
---


Hi Charlie,

That really helps to clear the confusion. Thanks again!

Then it comes to the next question :-) Just curious to know: is there a
special reason why using the end value as the partition's name? Normally,
most people I think would pick the beginning value as the partition's name
in common logic.

And a second question related to the above question is how this end value
is picked: partition named "0" is actually ending with number 0, and so
forth for the other partitions. This is like the 160-bit space got
right-shifted one number relative to 0-started numbering system. Is there
a special reason for it in Riak, or simply want to use 1-started numbering
system.


wr, donald

On Mon, Jan 28, 2013 at 3:21 PM, Charlie Voiselle wrote:

&gt; Donald:
&gt;
&gt; Since we are traversing the ring in a clockwise fashion, the data is
&gt; written into the next partition you would run into moving forward. You can
&gt; see how the partitions are chosen in\* \*chash:ordered\_from/2 at
&gt; https://github.com/basho/riak\_core/blob/master/src/chash.erl#L138. The
&gt; preference list is built using the partitions that come after the hashed
&gt; value.
&gt;
&gt; If you consider the partition's name to be the end value that the
&gt; partition holds, the an object that hashes to
&gt; 1045375627425331784151332358177649483819648417632 being assigned to
&gt; 1096126227998177188652763624537212264741949407232 makes sense. That
&gt; partition would hold items that hash from
&gt; 913438523331814323877303020447676887284957839361 to
&gt; 1096126227998177188652763624537212264741949407232
&gt;
&gt;
&gt; Does this help?
&gt;
&gt; Thanks,
&gt; Charlie Voiselle
&gt;
&gt;
&gt; On Jan 24, 2013, at 12:05 AM, Donald Yan  wrote:
&gt;
&gt; Hi there,
&gt;
&gt; I'm reading this page at
&gt; http://docs.basho.com/riak/latest/references/appendices/concepts/Replication/#Understanding-replication-by-example
&gt; and
&gt; have a question about the example given in the page. I quote it here:
&gt; "
&gt;
&gt; The DocIdx hash is a 160 bit integer:
&gt;
&gt; (dev1@127.0.0.1)5&gt; &lt;&gt; = DocIdx.
&gt; &lt;&lt;183,28,67,173,80,128,26,94,190,198,65,15,27,243,135,127,121,101,255,96&gt;&gt;
&gt; (dev1@127.0.0.1)6&gt; I.1045375627425331784151332358177649483819648417632
&gt;
&gt; The node looks up the hashed key in the ring which returns a list of
&gt; “preferred” partitions for the given key.
&gt;
&gt; (node1@127.0.0.1)&gt; Preflist = riak\_core\_ring:preflist(DocIdx, Ring).
&gt; [{1096126227998177188652763624537212264741949407232, 'dev1@127.0.0.1'},
&gt; {1278813932664540053428224228626747642198940975104, 'dev2@127.0.0.1'},
&gt; {0, 'dev1@127.0.0.1'},
&gt; {182687704666362864775460604089535377456991567872, 'dev2@127.0.0.1'},
&gt; {365375409332725729550921208179070754913983135744, 'dev3@127.0.0.1'},
&gt; {548063113999088594326381812268606132370974703616, 'dev1@127.0.0.1'},
&gt; {730750818665451459101842416358141509827966271488, 'dev2@127.0.0.1'},
&gt; {913438523331814323877303020447676887284957839360, 'dev3@127.0.0.1'}]
&gt;
&gt;
&gt; "
&gt;
&gt; I question is since the key is calculated as "
&gt; 1045375627425331784151332358177649483819648417632", shouldn't the prefer
&gt; list be like the following instead?
&gt; "
&gt; [{913438523331814323877303020447676887284957839360, 'dev3@127.0.0.1'},
&gt; {1096126227998177188652763624537212264741949407232, 'dev1@127.0.0.1'},
&gt; {1278813932664540053428224228626747642198940975104, 'dev2@127.0.0.1'},
&gt; {0, 'dev1@127.0.0.1'},
&gt; {182687704666362864775460604089535377456991567872, 'dev2@127.0.0.1'},
&gt; {365375409332725729550921208179070754913983135744, 'dev3@127.0.0.1'},
&gt; {548063113999088594326381812268606132370974703616, 'dev1@127.0.0.1'},
&gt; {730750818665451459101842416358141509827966271488, 'dev2@127.0.0.1'}]
&gt; "
&gt; because value "1045375627425331784151332358177649483819648417632" falls
&gt; between 913438523331814323877303020447676887284957839360 (partition 5)
&gt; and 1096126227998177188652763624537212264741949407232 (partition 6)?
&gt;
&gt; Please Riak experts help to clear my confusion here. Why partition 6, 7,
&gt; 0 are on the top 3 of the list?
&gt;
&gt; Appreciate in advance.
&gt;
&gt;
&gt; -donald
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

