---
title: "Re: Erlang MR bulk fetch"
description: ""
project: community
lastmod: 2013-02-06T12:18:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10024"
mailinglist_parent_id: "msg09417"
author_name: "Dmitri Zagidulin"
project_section: "mailinglistitem"
sent_date: 2013-02-06T12:18:37-08:00
---


How large are the objects that you're working with?

As part of a previous project, we ran some benchmarks on bulk fetches --
A/B testing two different options. Option one was fetching the objects via
MapReduce (as you are trying to do), and option two was issuing a bunch of
GETs, serially.
Counter-intuitively, it turned out that for any but the smallest object
sizes, it was faster to bulk retrieve objects using GETs instead of the M/R.

So, may be worth reconsidering that route, in your case.

(We also ended up having to write a custom Erlang M/R function to
base64-encode binary object values, since they crash the JSON results, as
you've noticed).


On Sun, Dec 2, 2012 at 8:26 PM, Elias Levy wrote:

&gt; While processing a request I am finding that I am spending most of my time
&gt; fetching data from Riak. As I am using the Ruby client I can't
&gt; parallelise them, as it does not support non-blocking IO and I don't want
&gt; to spawn many threads.
&gt;
&gt; For these requests I am willing to accept an R of 1, so I can use a MR job
&gt; as a bulk fetch, but I would prefer to avoid the JS VM, as its rather
&gt; slow and I don't want to worry about running out of VMs at the wrong time.
&gt;
&gt; I can easily fetch the values using only Erlang MR by adding the keys to
&gt; my MR object and doing
&gt;
&gt; map(["riak\_kv\_mapreduce", "map\_object\_value"], :arg =&gt; [ true ],
&gt; :keep =&gt; true).
&gt;
&gt; but this gives me an array of values. I need to to know the which values
&gt; are associated with what key, and my values do not include the key or
&gt; otherwise allow me to map them.
&gt;
&gt; From looking at the Riak code there does not seem to exist an exported
&gt; Erlang map function that will return a value with its key.
&gt;
&gt; Did I miss one? Is such a function somewhere in the source? If not,
&gt; anyone have one handy they'd like to share?
&gt;
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

