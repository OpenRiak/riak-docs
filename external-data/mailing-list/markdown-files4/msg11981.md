---
title: "Re: Practical Riak cluster choices in AWS (number of nodes? AZ's?)"
description: ""
project: community
lastmod: 2013-08-12T12:00:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11981"
mailinglist_parent_id: "msg11980"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-08-12T12:00:39-07:00
---


Nope, depending on how much you want to spend, you can cram up to 42TB into
a single AWS instance. Reasonably priced instances can hold 1690GB of data
on a single instance. You can see an easy to sort map over here:
http://www.ec2instances.info/

I would take Amazon's own recommendations with a grain of salt; whichever
engineer wrote that document is going against AWS advice for other database
engines. E.g RAID 1 is great when you need capacity but your RAID volume
will effectively function at the latency of the slowest drive. If you use
EBS optimized instances or even PIOPS, your storage can end up costing
several times what the instance itself does.

E.g. an m2.4xl with 4TB of PIOPS (4000 IOPS) costs :

Dedicated instance (1 year lease) $199.11 / month
EBS optimization: $36.60
EBS IOPS: $400.00
EBS Storage: $50.00

For the price of that storage, you can get 2 more EC2 instances (more if
you use crappier instances). It's easier and cheaper to spin up more Riak
nodes than it is to tune AWS infrastructure.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Mon, Aug 12, 2013 at 11:38 AM, Dave Martorana  wrote:

&gt; Jared - thanks for the links. I'm in the same boat with Brady with
&gt; weighing deployment options in AWS.
&gt;
&gt; Jeremiah - isn't EBS the only option once your data starts reaching into
&gt; the hundreds-of-gigs?
&gt;
&gt; Dave
&gt;
&gt;
&gt; On Sun, Aug 11, 2013 at 8:57 PM, Jared Morrow  wrote:
&gt;
&gt;&gt; +1 to what Jeremiah said, putting a 4 or 5 node cluster in each US West
&gt;&gt; and US East using MDC between them would be the optimum solution. I'm also
&gt;&gt; not buying consistent latencies between AZ's, but I've also not tested it
&gt;&gt; personally in a production environment. We have many riak-users members on
&gt;&gt; AWS, so hopefully more experienced people will chime in.
&gt;&gt;
&gt;&gt; If you haven't seen them already, here's what I have in my "Riak on AWS"
&gt;&gt; bookmark folder:
&gt;&gt;
&gt;&gt; http://media.amazonwebservices.com/AWS\_NoSQL\_Riak.pdf
&gt;&gt; http://docs.basho.com/riak/latest/ops/tuning/aws/
&gt;&gt; http://basho.com/riak-on-aws-deployment-options/
&gt;&gt;
&gt;&gt; -Jared
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sun, Aug 11, 2013 at 6:11 PM, Jeremiah Peschka &lt;
&gt;&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; I'd be wary of using EBS backed nodes for Riak - with only a single
&gt;&gt;&gt; ethernet connection, it wil be very easy to saturate the max of 1000mbps
&gt;&gt;&gt; available in a single AWS NIC (unless you're using cluster compute
&gt;&gt;&gt; instances). I'd be more worried about temporarily losing contact with a
&gt;&gt;&gt; node through network saturation than through AZ failure, truthfully.
&gt;&gt;&gt;
&gt;&gt;&gt; The beauty of Riak is that a node can drop and you can replace it with
&gt;&gt;&gt; minimal fuss. Use that to your advantage and make every node in the cluster
&gt;&gt;&gt; disposable.
&gt;&gt;&gt;
&gt;&gt;&gt; As far as doubling up in one AZ goes - if you're worried about AZ
&gt;&gt;&gt; failure, you should treat each AZ as a separate data center and design your
&gt;&gt;&gt; failure scenarios accordingly. Yes, Amazon say you should put one Riak node
&gt;&gt;&gt; in each AZ; I'm not buying that. With no guarantee around latency, and no
&gt;&gt;&gt; control around between DCs, you need to be very careful how much of that
&gt;&gt;&gt; latency you're willing to introduce into your application.
&gt;&gt;&gt;
&gt;&gt;&gt; Were I in your position, I'd stand up a 5 node cluster in US-WEST-2 and
&gt;&gt;&gt; be done with it. I'd consider Riak EE for my HA/DR solution once the
&gt;&gt;&gt; business decides that off-site HA/DR is something it wants/needs.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; ---
&gt;&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt;&gt;&gt; MCITP: SQL Server 2008, MVP
&gt;&gt;&gt; Cloudera Certified Developer for Apache Hadoop
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Sun, Aug 11, 2013 at 1:52 PM, Brady Wetherington &lt;
&gt;&gt;&gt; br...@bespincorp.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi all -
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have some questions about how I want my Riak stuff to work - I've
&gt;&gt;&gt;&gt; already asked these questions of some Basho people and gotten some answers,
&gt;&gt;&gt;&gt; but thought I would toss it out into the wider world to see what you all
&gt;&gt;&gt;&gt; have to say, too:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; First off - I know 5 instances is the "magic number" of instances to
&gt;&gt;&gt;&gt; have. If I understand the thinking here, it's that at the default
&gt;&gt;&gt;&gt; redundancy level ('n'?) of 3, it is most likely to start getting me some
&gt;&gt;&gt;&gt; scaling (e.g., performance &gt; just that of a single node), and yet also have
&gt;&gt;&gt;&gt; redundancy; whereby I can lose one box and not start to take a performance
&gt;&gt;&gt;&gt; hit.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; My question is - I think I can only do 4 in a way that makes sense. I
&gt;&gt;&gt;&gt; only have 4 AZ's that I can use right now; AWS won't let me boot instances
&gt;&gt;&gt;&gt; in 1a. My concern is if I try to do 5, I will be "doubling up" in one AZ -
&gt;&gt;&gt;&gt; and in AWS you're almost as likely to lose an entire AZ as you are a single
&gt;&gt;&gt;&gt; instance. And so, if I have instances doubled-up in one AZ (let's say
&gt;&gt;&gt;&gt; us-east-1e), and then I lose 1e, I've now lost two instances. What are the
&gt;&gt;&gt;&gt; chances that all three of my replicas of some chunk of my data are on those
&gt;&gt;&gt;&gt; two instances? I know that it's not guaranteed that all replicas are on
&gt;&gt;&gt;&gt; separate nodes.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So is it better for me to ignore the recommendation of 5 nodes, and
&gt;&gt;&gt;&gt; just do 4? Or to ignore the fact that I might be doubling-up in one AZ?
&gt;&gt;&gt;&gt; Also, another note. These are designed to be 'durable' nodes, so if one
&gt;&gt;&gt;&gt; should go down I would expect to bring it back up \*with\* its data - or, if
&gt;&gt;&gt;&gt; I couldn't, I would do a force-replace or replace and rebuild it from the
&gt;&gt;&gt;&gt; other replicas. I'm definitely not doing instance-store. So I don't know if
&gt;&gt;&gt;&gt; that mitigates my need for a full 5 nodes. I would also consider losing one
&gt;&gt;&gt;&gt; node to be "degraded" and would probably seek to fix that problem as soon
&gt;&gt;&gt;&gt; as possible, so I wouldn't expect to be in that situation for long. I would
&gt;&gt;&gt;&gt; probably tolerate a drop in performance during that time, too. (Not a
&gt;&gt;&gt;&gt; super-severe one, but 20-30 percent? Sure.)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What do you folks think?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -B.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

