---
title: "Re: System Limit Question"
description: ""
project: community
lastmod: 2011-09-20T13:21:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04806"
mailinglist_parent_id: "msg04805"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-09-20T13:21:58-07:00
---


Hi TJ,

When you hit the issue, could you run these two commands on the riak console
(if riak is running as a daemon 'riak attach' to get to the console then ^D
to get out)

 length(erlang:ports()).
 length(erlang:processes()).

If ports is close to 4096 or ports to 32767 you'll need to up the limit in
vm.args.

Cheers,

Jon Meredith
Basho Technologies.

On Tue, Sep 20, 2011 at 2:13 PM, TJ Ninneman wrote:

&gt; On our RHEL servers I've been noticing a lot of:
&gt;
&gt; Failed to merge ...
&gt; {{badmatch,{error,system\_limit}},[{bitcask,scan\_key\_files,3},{bitcask,'merge1',3},{bitcask\_merge\_worker,do\_merge,1}]}
&gt;
&gt; This is a RHEL 6 / Riak 1.0 test cluster which has Riak running as root. I
&gt; have not noticed this at all on our production 0.14.2 FreeBSD cluster.
&gt;
&gt; My ulimit -a output is as follows:
&gt;
&gt; core file size (blocks, -c) 0
&gt; data seg size (kbytes, -d) unlimited
&gt; scheduling priority (-e) 0
&gt; file size (blocks, -f) unlimited
&gt; pending signals (-i) 127400
&gt; max locked memory (kbytes, -l) 64
&gt; max memory size (kbytes, -m) unlimited
&gt; open files (-n) 40560
&gt; pipe size (512 bytes, -p) 8
&gt; POSIX message queues (bytes, -q) 819200
&gt; real-time priority (-r) 0
&gt; stack size (kbytes, -s) 10240
&gt; cpu time (seconds, -t) unlimited
&gt; max user processes (-u) 1024
&gt; virtual memory (kbytes, -v) unlimited
&gt; file locks (-x) unlimited
&gt;
&gt; An lsof -p shows open files of around 3 - 5k during the merge and about
&gt; 1,300 post fail. Anybody have an idea what system limit I may be hitting?
&gt;
&gt; Thanks!
&gt;
&gt; TJ
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

