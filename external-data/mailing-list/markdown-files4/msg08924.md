---
title: "Re: Re: Re: Riak performance problems when LevelDB database grows beyond 16GB"
description: ""
project: community
lastmod: 2012-10-15T12:10:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08924"
mailinglist_parent_id: "msg08894"
author_name: "Jan.Evangelista"
project_section: "mailinglistitem"
sent_date: 2012-10-15T12:10:39-07:00
---


Hi Evan,

regarding the swappiness and disk scheduling: these were set to default, I will 
correct it and run another test. 

The hosting provider sets the computer with software RAID1 over 2 physical 
disks, do you think it is useful with Riak?

BTW, I suspected that part of the problem could be caused by the hardware of 
the first node. So I ran another test over the weekend with the node replaced, 
and the result was slightly better: one of the nodes crashed after cca 22 hours 
when its DB reached 14G, but the other 3 nodes worked for 2.8 days until the DB 
reached 40G (see 
http://janevangelista.rajce.idnes.cz/nastenka/#4Riak\_2K\_2.1RC2\_3d\_edited.jpg ). 
All the nodes crashed silently, there is nothing interesting in Riak logs.

Thanks, Jan

---------- Původní zpráva ----------
Od: Evan Vigil-McClanahan 
Datum: 12. 10. 2012
Předmět: Re: Re: Riak performance problems when LevelDB database grows beyond 
16GB
Hi there, Jan,

The lsof issue is that max\_open\_files is per backend, iirc, so if
you're maxed out you'll see vnode count \* max\_open\_files.

I think on the second try, you may have set the cache too high. I'd
drop it back to 8 or 16 MB, and possibly up the open files a bit more,
but you don't seem to be running into contention at this point.
There's a RAM cost, so maybe just leave it where it is for now, unless
you have quite a lot of memory.

Another thing to check is that vm.swappiness is set to 0 and that your
disk scheduler is set to deadline for spinning disks and noop for
SSDs.

On Fri, Oct 12, 2012 at 5:02 AM, wrote:
&gt;&gt; Can you attach the eleveldb portion of your app.config file?
&gt;&gt; Configuration problems, especially max\_open\_files being too low, can
&gt;&gt; often cause issues like this.
&gt;&gt;
&gt;&gt; If it isn't sensitive, the whole app.config and vm.args files are also
&gt;&gt; often helpful.
&gt;
&gt; Hello Evan,
&gt;
&gt; thanks for responding.
&gt;
&gt; I originally had default LevelDB settings. When the node stalled, I changed it
&gt; to
&gt;
&gt; {eleveldb, [
&gt; {data\_root, "/home/riak/leveldb"},
&gt; {max\_open\_files, 132},
&gt; {cache\_size, 377487360}
&gt; ]},
&gt;
&gt; on all nodes and I restarted them all. The application started to run with
&gt; about 1000 requests/second, after about 1 minute it dropped to &lt;500
&gt; requests/second, and the node stalled again after 41 minutes. BTW according to
&gt; lsof(1) it had 267 open LevelDB files which is more than the 132 files limit
&gt; (??).
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

