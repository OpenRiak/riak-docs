---
title: "http 410 deletes and document revival"
description: ""
project: community
lastmod: 2010-04-14T21:21:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00044"
author_name: "Doug Tangren"
project_section: "mailinglistitem"
sent_date: 2010-04-14T21:21:05-07:00
---


I don' know if this would be worth adding to the http interface or not but
might it be useful to have a `soft delete` feature where the http interface
returns a 410 (Gone) rather than a 404 (Not Found) status code after a
document has been deleted. Perhaps as an audit trail or even a rollback
feature.

A use case might be

# currently

boss

PUT http://host.com/riak/important/someImportantDocumentA { ... } -&gt; docA
PUT http://host.com/riak/important/someImportantDocumentB { ... } -&gt; docB

intern

DELETE http://host.com/riak/important/someImportantDocumentA // "Whoops! I
think I might have deleted the wrong document! Hope the boss doesn't find
out."

boss

GET http://host.com/riak/important/someImportantDocumentA // 404 "wtf!?
Where did my TPS report go?"

boss calls up intern --censored--

# a proposal

boss

PUT http://host.com/riak/important/someImportantDocumentA { ... } -&gt; docA
PUT http://host.com/riak/important/someImportantDocumentB { ... } -&gt; docB

intern

DELETE http://host.com/riak/important/someImportantDocumentA (with new
header x-riak-perm-delete=false) // "Whoops! I think I might have deleted
the wrong document! Hope the boss doesn't find out"

boss

GET http://host.com/riak/important/someImportantDocumentA // 410 "silly
intern, let's see what else he did"

GET http://host.com/riak/important { "props": { ...,
"deleted\_keys":["someImportantDocumentA"] ] } }

PUT http://host.com/riak/important/someImportantDocumentA (with new header
x-riak-revive=true)

GET http://host.com/riak/important/someImportantDocumentA // 200, "heh, glad
I set my `important` bucket's `perm\_delete` property to false"

GET http://host.com/riak/important { "props": { ..., "deleted\_keys":[],
"perm\_delete":false ] } }

boss calls up intern and says not to worry and makes sure intern gets TSP
report, mmm k.


This is essentially a 2 new features.
 \* a deletion audit trail with a bucket's deleted keys
( "deleted\_keys":["foo","bar"] ) and 410 (gone) responses (of course this
would probably be turned off by default)
 \* per document rollback/revive feature that allows up to undo/undelete
previously soft deleted documents

What does everyone think? Would this be useful?






-Doug Tangren
http://lessis.me
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

