---
title: "Re: Riak init script hangs on \"stop\""
description: ""
project: community
lastmod: 2013-05-24T08:23:59-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11164"
mailinglist_parent_id: "msg11036"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2013-05-24T08:23:59-07:00
---


Pascal,

We've seen similar behavior in testing and have always failed to track down
the cause. Nothing is actually running in Riak, but the process still just
hangs around. I filed an issue for this
https://github.com/basho/riak/issues/330. Coincidentally on the
erlang-bugs mailing list someone just reported a similar problem with
shutdown. I am going to try the suggestion provided on erlang-bugs and get
the change into our upcoming 1.4 release.

Thanks for the message and sorry no one got back to you sooner.

-Jared


On Tue, May 7, 2013 at 2:09 AM, Pascal Schmiel &lt;
pascal.schm...@bluelionmobile.com&gt; wrote:

&gt; Hi List,
&gt;
&gt; sometimes the riak init script hangs on the "stop" command. After several
&gt; hours the init script and the riak process itself is still running (but
&gt; unreachable). I have to use SIGTERM to stop the process.
&gt;
&gt; The lines from my console.log after invoking "/etc/init.d/riak stop" are:
&gt;
&gt;
&gt; 2013-05-07 01:08:54.624 [info] &lt;0.1307.0&gt;@riak\_kv\_app:prep\_\*\*stop:165
&gt; Stopping application riak\_kv - marked service down.
&gt; 2013-05-07 01:08:54.624 [info] &lt;0.1307.0&gt;@riak\_kv\_app:prep\_\*\*stop:169
&gt; Unregistered pb services
&gt; 2013-05-07 01:08:54.625 [info] &lt;0.1307.0&gt;@riak\_kv\_app:prep\_\*\*stop:174
&gt; unregistered webmachine routes
&gt; 2013-05-07 01:08:54.625 [info] &lt;0.1307.0&gt;@riak\_kv\_app:prep\_\*\*stop:176 all
&gt; active put FSMs completed
&gt; 2013-05-07 01:08:54.634 [info] &lt;0.1346.0&gt;@riak\_kv\_js\_vm:\*\*terminate:240
&gt; Spidermonkey VM (pool: riak\_kv\_js\_hook) host stopping (&lt;0.1346.0&gt;)
&gt; 2013-05-07 01:08:54.635 [info] &lt;0.1307.0&gt;@riak\_kv\_app:stop:\*\*187 Stopped
&gt; application riak\_kv.
&gt; 2013-05-07 01:08:54.651 [info] &lt;0.129.0&gt;@riak\_core\_app:prep\_\*\*stop:101
&gt; Stopping application riak\_core - disabling web services.
&gt; 2013-05-07 01:08:54.733 [error] &lt;0.23337.1&gt;@riak\_kv\_stat:\*\*update:85
&gt; error:badarg updating stat {vnode\_index\_delete,0}.
&gt; 2013-05-07 01:08:54.748 [error] &lt;0.12920.2&gt;@riak\_kv\_stat:\*\*update:85
&gt; error:badarg updating stat {vnode\_index\_delete,0}.
&gt; 2013-05-07 01:08:54.769 [error] &lt;0.27391.2&gt;@riak\_kv\_stat:\*\*update:85
&gt; error:badarg updating stat {vnode\_index\_delete,0}.
&gt; 2013-05-07 01:08:54.777 [error] &lt;0.24922.3&gt;@riak\_kv\_stat:\*\*update:85
&gt; error:badarg updating stat {vnode\_index\_delete,0}.
&gt; 2013-05-07 01:08:54.780 [error] &lt;0.27478.3&gt;@riak\_kv\_stat:\*\*update:85
&gt; error:badarg updating stat {vnode\_index\_delete,0}.
&gt; 2013-05-07 01:08:54.784 [error] &lt;0.23385.2&gt;@riak\_kv\_stat:\*\*update:85
&gt; error:badarg updating stat {vnode\_index\_delete,0}.
&gt; 2013-05-07 01:08:57.294 [info] &lt;0.129.0&gt;@riak\_core\_app:stop:\*\*110 Stopped
&gt; application riak\_core.
&gt; 2013-05-07 01:08:57.459 [info] &lt;0.55.0&gt; alarm\_handler:
&gt; {clear,system\_memory\_high\_\*\*watermark}
&gt;
&gt; The problem appeared suddenly without any config or system changes.
&gt;
&gt; We're using Riak 1.3 installed from RPM on CentOS 6.3 x64 with eleveldb
&gt; backend.
&gt;
&gt; - Pascal
&gt;
&gt;
&gt; --
&gt; Pascal Schmiel
&gt; Head of System Operations
&gt; Blue Lion mobile GmbH (QEEP)
&gt; Gottfried-Hagen-Str. 20
&gt; 51105 Köln
&gt;
&gt; Tel. +49 (0) 221 788 797 17
&gt; Fax. +49 (0) 221 788 797 19
&gt;
&gt; pascal.schmiel@bluelionmobile.\*\*com 
&gt; www.bluelionmobile.com
&gt; www.qeep.net
&gt;
&gt; Sitz Köln, HRB 58203, Amtsgericht Köln
&gt; Geschäftsführung: Cornelius Rost, Christian R. Schulte
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

