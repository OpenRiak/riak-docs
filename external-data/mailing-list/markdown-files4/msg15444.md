---
title: "Re: Riak stalls, leveldb backend"
description: ""
project: community
lastmod: 2015-01-06T12:31:56-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15444"
mailinglist_parent_id: "msg15441"
author_name: "Michael Lewis"
project_section: "mailinglistitem"
sent_date: 2015-01-06T12:31:56-08:00
---


Hi,

I'd be interested in the answer to this too, isn't it inevitable that in the 
underlying storage you will get compaction delays, you see the same in any key 
value store, eg if you were pushing lots of small packets of data into 
HBase/Cassandra etc... Eventually the system has to perform the compaction ? 
Not sure how you tune it so that you lower the throughput but remove some of 
the compaction times.

Rgds,
Mike

&gt; On 5 Jan 2015, at 17:07, Andy Pellett  wrote:
&gt; 
&gt; Hi all,
&gt; 
&gt; I've been experiencing stalls where riak won't return any data (queries time 
&gt; out) with my riak cluster. Here are some basic details:
&gt; 
&gt; - 8 nodes
&gt; - riak 1.4.10 (upgraded from 1.4.6 -&gt; 1.4.8 -&gt; 1.4.10)
&gt; - leveldb backend
&gt; - n\_val is 2
&gt; - allow\_mult is false
&gt; - ec2 i2.2xlarge boxes (8 cores, 61gb ram, 800gb disk space)
&gt; - about 33% disk space utilization per node
&gt; 
&gt; The riak cluster will stall for as long as a few minutes at a time, but will 
&gt; otherwise work as expected for hours. There doesn't seem to be an obvious 
&gt; pattern as to when the stalls happen.
&gt; 
&gt; My first thought was that the stalls may be related to AAE, but I've disabled 
&gt; that via 'riak attach' and the settings file. Sidenote, I still see messages 
&gt; like:
&gt; 
&gt; 2015-01-05 12:24:04.666 [info] 
&gt; &lt;0.574.0&gt;@riak\_kv\_entropy\_manager:perhaps\_log\_throttle\_change:826 Changing 
&gt; AAE throttle from 0 -&gt; 10 msec/key, based on maximum vnode mailbox size 209 
&gt; from 'riak-user@riak-host'
&gt; 
&gt; which makes me question whether AAE is actually turned off.
&gt; 
&gt; Now I'm leaning towards leveldb compactions being the issue. What can I do to 
&gt; verify this is the issue, and how can I fix it?
&gt; 
&gt; I see log messages about large objects:
&gt; 
&gt; 2015-01-05 16:11:28.046 [warning] 
&gt; &lt;0.6398.0&gt;@riak\_kv\_vnode:encode\_and\_put\_no\_sib\_check:1830 Writing very large 
&gt; object (11307735 bytes) to &lt;&lt;"BucketName"&gt;&gt;/&lt;&lt;"keys\_1420466400"&gt;&gt;
&gt; 
&gt; Could these be causing longer-running compactions, or more frequent 
&gt; compactions?
&gt; 
&gt; Thanks for reading,
&gt; Andy
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

