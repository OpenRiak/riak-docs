---
title: "Riak Cluster Setup on EC2"
description: ""
project: community
lastmod: 2011-02-06T16:52:35-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02209"
author_name: "Eamonn"
project_section: "mailinglistitem"
sent_date: 2011-02-06T16:52:35-08:00
---


After a lot if unsuccessful fiddling around with ports I gave up and 
just opened up all ports between the Riak nodes.


I suggest you set up a security group called "Riak" with settings 
something like the following:


 Protocol | From Port | To Port | Source (IP or group)
 ---------+-----------+---------+---------------------
 tcp | 1 | 65535 | Riak group
 udp | 1 | 65535 | Riak group
 tcp | 8098 | 8098 | WebServer group

Although all the ports are open on the Riak nodes, it is still pretty 
secure because they are only open to nodes in the same security group, 
i.e. other Riak nodes.


The only port open outside the Riak cluster is the default HTTP port, 
which is only open to nodes in the "WebServer" security group. Change 
"WebServer" to be the security group of whatever nodes are using Riak. 
If you have changed the default or are using protocol buffers instead of 
HTTP you will have to change the port number.


You may also want to add the SSH port to so that you can login, but I 
suggest using a cloud-init script to do all the Riak installation and 
initialization at node creation time, so in normal production use will 
not need to SSH into the nodes.


\_\_
Eamonn



On 2/4/11 9:00 AM, riak-users-requ...@lists.basho.com wrote:
Date: Wed, 02 Feb 2011 21:33:20 +0530 From: Abhishek Kona 
 To: Sean Cribbs  Cc: 
"riak-users@lists.basho.com"  Subject: Re: 
Riak Cluster Setup on EC2 Message-ID: &lt;4d498048.3060...@flipkart.com&gt; 
Content-Type: text/plain; charset=ISO-8859-1; format=flowed On 
02/02/11 8:38 PM, Sean Cribbs wrote:

&gt; Abhishek,
&gt;
&gt; First, make sure all of your nodes are in the same security group.

Yes, both the machines are on the same security group ( which has only
the ports 8098, 8099, 8087).

&gt; Second, check that your OS doesn't have an additional firewall installed 
(iptables, for example).

I can telnet into the Riak ports from each of the machines, so firewall
does not seem to be the issue.

&gt; Third, you might consider doing what the Chef recipe for Riak does and 
limit the ports that Erlang uses for distributed communication. Adding a section 
to app.config like the below will limit the port range:
&gt;
&gt; {kernel, [
&gt; {inet\_dist\_listen\_min, 6000},
&gt; {inet\_dist\_listen\_max, 7999}
&gt; ]}
&gt;
&gt; You'll need to stop Riak, kill the "epmd" process, and then start Riak up 
again for this change to take effect. Make sure those ports are also open in your security 
group and any software firewall you have.
&gt;

Tried with these changes as well, but still get the same message.
Anything else, I can try?.
Thanks for the help.

&gt; Sean Cribbs
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; On Feb 2, 2011, at 8:47 AM, Abhishek Kona wrote:
&gt;

&gt;&gt; Hi folks
&gt;&gt;
&gt;&gt; I am trying to set up a Riak cluster on EC2.
&gt;&gt; Each time I issue a command :
&gt;&gt;
&gt;&gt; $ sudo riak-admin joinriak@10.130.149.253
&gt;&gt;
&gt;&gt; It fails :
&gt;&gt;
&gt;&gt; Attempting to restart script through sudo -u riak
&gt;&gt;
&gt;&gt; Noderiak@10.130.149.253 is not reachable!
&gt;&gt;
&gt;&gt;
&gt;&gt; Netstat on both the machines says the ports are running fine.
&gt;&gt;
&gt;&gt; netstat -na | egrep '(8087|8098|8099)'
&gt;&gt;
&gt;&gt; tcp 0 0 0.0.0.0:8098 0.0.0.0:\* LISTEN
&gt;&gt;
&gt;&gt; tcp 0 0 0.0.0.0:8099 0.0.0.0:\* LISTEN
&gt;&gt;
&gt;&gt; tcp 0 0 0.0.0.0:8087 0.0.0.0:\* LISTEN
&gt;&gt;
&gt;&gt;
&gt;&gt; I can telnet to all the ports from each of the machine.
&gt;&gt; I have been pulling my hair for long but of no avail.
&gt;&gt; Can any one look and tell me what I am doing wrong.
&gt;&gt; Are there any debug logs where I can look at what is going wrong?
&gt;&gt; Is there any EC2 specific trick (like using public hostnames).
&gt;&gt;
&gt;&gt; I am attaching my app.cfg file for reference.
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt; -Abhishek Kona
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com





\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

