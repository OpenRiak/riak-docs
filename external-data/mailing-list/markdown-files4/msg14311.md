---
title: "Re: The best (fastest) way to delete/clear a bucket [python]"
description: ""
project: community
lastmod: 2014-06-12T08:54:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14311"
mailinglist_parent_id: "msg14241"
author_name: "Dave Martorana"
project_section: "mailinglistitem"
sent_date: 2014-06-12T08:54:25-07:00
---


Dimitri,

Can you better explain this behavior for strongly-consistent buckets? We
plan on using one (and only one) but I expect keys to fly in and out of
there rather quickly. I'm concerned about indefinite retention of
tombstones and the data required to maintain them. Not being able to
actually, wholly delete something seems like a problem. (I understand
retention for a certain period of time to enforce consistency, but
indefinite retention is confusing to me.)

Cheers,

Dave


On Wed, May 21, 2014 at 5:12 AM, Paweł Królikowski 
wrote:

&gt; @Dmitri - cool, thanks. Now that I know it's an expected behaviour, even
&gt; if I think it's strange, I can find a way of working around it :)
&gt;
&gt; @Sean - tbh, I don't know. I was trying to test a whole application,
&gt; involving http requests + multiple consumers over rabbitmq with semi-real
&gt; data, so random bucket/key names sound .. wrong (&compliated?). On the
&gt; other hand, restarting riak & nuking data directory, possibly on mutli-node
&gt; cluster, doesn't seem that much better.
&gt;
&gt; I'll play with tests a little longer, I'll come up with something that
&gt; works.
&gt;
&gt; Anyway, thanks for the help :)
&gt;
&gt;
&gt; On 20 May 2014 15:50, Sean Cribbs  wrote:
&gt;
&gt;&gt; For what it's worth, in the integration tests of our client libraries we
&gt;&gt; have moved to generating random bucket and key names for each test/example.
&gt;&gt; This reduces setup/teardown time and is less susceptible to the types of
&gt;&gt; unexpected behaviors you are seeing from list-keys. If possible, I highly
&gt;&gt; recommend this approach in your suite.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, May 20, 2014 at 9:25 AM, Dmitri Zagidulin 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Ok, so, from what I understand, this is going to be expected behavior
&gt;&gt;&gt; from strongly consistent buckets. (I'm in the process of confirming this,
&gt;&gt;&gt; and we'll see if we can add it to the documentation). The delete\_mode:
&gt;&gt;&gt; immediate is ignored, and the tombstone is kept around, to ensure the
&gt;&gt;&gt; consistency of not found, etc. (In the context of further over-writes of
&gt;&gt;&gt; that key).
&gt;&gt;&gt;
&gt;&gt;&gt; So, unfortunately that may be bad news in terms of deleting a
&gt;&gt;&gt; stongly\_consistent bucket via keylist for unit testing. :)
&gt;&gt;&gt;
&gt;&gt;&gt; You may want to switch to method #2, for your test suite. (Write a shell
&gt;&gt;&gt; script to stop the node, delete the bitcask & aae dirs, and restart. And
&gt;&gt;&gt; invoke it as a shell script command from your test suite. Or just call
&gt;&gt;&gt; those commands directly.).
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, May 20, 2014 at 5:44 AM, Paweł Królikowski 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Ok then,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've stopped riak, wiped bitcask and anti\_entropy directories, updated
&gt;&gt;&gt;&gt; config, started riak.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've tried to verify it with:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; riak config generate -l debug
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Got output:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [...]
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 10:25:46.260 [info] /etc/riak/advanced.config detected, overlaying
&gt;&gt;&gt;&gt; proplists
&gt;&gt;&gt;&gt; -config /var/lib/riak/generated.configs/app.2014.05.20.10.25.46.config
&gt;&gt;&gt;&gt; -args\_file /var/lib/riak/generated.configs/vm.2014.05.20.10.25.46.args
&gt;&gt;&gt;&gt; -vm\_args /var/lib/riak/generated.configs/vm.2014.05.20.10.25.46.args
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; And at the very end of the config file there's:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {k\_kv,[{delete\_mode,immediate}]}].
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So, it worked.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Then did this:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;&gt; import riak
&gt;&gt;&gt;&gt; &gt;&gt;&gt; c = riak.RiakClient(pb\_port=8087, protocol='pbc', host='db-13')
&gt;&gt;&gt;&gt; &gt;&gt;&gt; b = c.bucket(name='locate', bucket\_type='strongly\_consistent')
&gt;&gt;&gt;&gt; &gt;&gt;&gt; o = b.get('foo')
&gt;&gt;&gt;&gt; &gt;&gt;&gt; o.data = 3
&gt;&gt;&gt;&gt; &gt;&gt;&gt; o.store()
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; &gt;&gt;&gt; o.delete()
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; &gt;&gt;&gt; b.delete('foo')
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; &gt;&gt;&gt; o.exists
&gt;&gt;&gt;&gt; False
&gt;&gt;&gt;&gt; &gt;&gt;&gt; b.get\_keys()
&gt;&gt;&gt;&gt; ['foo']
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So, it didn't work.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It's not just the python client, because if I do this, I get the key
&gt;&gt;&gt;&gt; back:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://db-13:8098/types/strongly\_consistent/buckets/locate/keys?keys=true
&gt;&gt;&gt;&gt; {"keys":["foo"]}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've tried deleting the key via http request (curl -v -X DELETE
&gt;&gt;&gt;&gt; http://db-13:8098/types/strongly\_consistent/buckets/locate/keys/bar),
&gt;&gt;&gt;&gt; but it still remains.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://db-13:8098/types/strongly\_consistent/buckets/locate/keys/foo
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; returns
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; not found
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; but
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://db-13:8098/types/strongly\_consistent/buckets/locate/keys?keys=true
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; gives
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {"keys":["foo","bar"]}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've tried looking for detailed logs, but console.log, even on debug,
&gt;&gt;&gt;&gt; doesn't print anything useful.
&gt;&gt;&gt;&gt; I've also tried looking inside bitcask directory, and there's
&gt;&gt;&gt;&gt; definitely 'some' binary data there, even after deletion.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On 19 May 2014 23:23, Dmitri Zagidulin  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Ah, that's interesting, let's see if we can test this.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; The 'delete\_mode' configuration is not supported in the regular
&gt;&gt;&gt;&gt;&gt; riak.conf file, from what I understand.
&gt;&gt;&gt;&gt;&gt; However, you can still set it in the 'advanced.config' file, as
&gt;&gt;&gt;&gt;&gt; described here:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; https://github.com/basho/basho\_docs/blob/features/lp/advanced-conf/source/languages/en/riak/ops/advanced/configs/configuration-files.md#the-advancedconfig-file
&gt;&gt;&gt;&gt;&gt; (those docs are a current work-in-progress, mind you)
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; So, create an advanced.config file in your riak etc/ directory (this
&gt;&gt;&gt;&gt;&gt; will be in addition to your existing riak.conf), with the following
&gt;&gt;&gt;&gt;&gt; contents:
&gt;&gt;&gt;&gt;&gt; [
&gt;&gt;&gt;&gt;&gt; {riak\_kv, [
&gt;&gt;&gt;&gt;&gt; {delete\_mode, immediate}
&gt;&gt;&gt;&gt;&gt; ]}
&gt;&gt;&gt;&gt;&gt; ].
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Restart the node, and try your tests again. The tombstones should
&gt;&gt;&gt;&gt;&gt; disappear now on every delete request. (You should probably also wipe all
&gt;&gt;&gt;&gt;&gt; of the old data, by deleting the contents of the bitcask and anti\_entropy
&gt;&gt;&gt;&gt;&gt; directories in your riak data dir, just to make sure the old ones are 
&gt;&gt;&gt;&gt;&gt; gone.
&gt;&gt;&gt;&gt;&gt; This should be done while the node is down, of course.)
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Mon, May 19, 2014 at 4:33 PM, Paweł Królikowski 
&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; The problem is that the tombstones never disappear - they keep coming
&gt;&gt;&gt;&gt;&gt;&gt; back through bucket.get\_keys() hours after deletion, even after a 
&gt;&gt;&gt;&gt;&gt;&gt; restart.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I said I'm using the delete\_mode default configuration, because I
&gt;&gt;&gt;&gt;&gt;&gt; didn't change it. I now tried, and apparently it's not supported any more
&gt;&gt;&gt;&gt;&gt;&gt; in Riak 2.0.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 17:16:56.318 [error] You've tried to set delete\_mode, but there is no
&gt;&gt;&gt;&gt;&gt;&gt; setting with that name.^M
&gt;&gt;&gt;&gt;&gt;&gt; 17:16:56.318 [error] Did you mean one of these?^M
&gt;&gt;&gt;&gt;&gt;&gt; 17:16:56.335 [error] dtrace^M
&gt;&gt;&gt;&gt;&gt;&gt; 17:16:56.335 [error] nodename^M
&gt;&gt;&gt;&gt;&gt;&gt; 17:16:56.335 [error] ssl.keyfile^M
&gt;&gt;&gt;&gt;&gt;&gt; 17:16:56.335 [error] Error generating configuration in phase
&gt;&gt;&gt;&gt;&gt;&gt; transform\_datatypes^M
&gt;&gt;&gt;&gt;&gt;&gt; 17:16:56.335 [error] Conf file attempted to set unknown variable:
&gt;&gt;&gt;&gt;&gt;&gt; delete\_mode^M
&gt;&gt;&gt;&gt;&gt;&gt; Error generating config with cuttlefish
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I'm using Riak 2.0.0pre20, on strongly consistent buckets, on a
&gt;&gt;&gt;&gt;&gt;&gt; single node cluster. Can this be the reason? I guess what I need is a
&gt;&gt;&gt;&gt;&gt;&gt; confirmation that something is broken/that I'm doing something stupid.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I've tried looking for similar issues (github.com/basho/riak/issues),
&gt;&gt;&gt;&gt;&gt;&gt; didn't find any -&gt; I guess that suggests I'm doing something stupid, I 
&gt;&gt;&gt;&gt;&gt;&gt; just
&gt;&gt;&gt;&gt;&gt;&gt; don't know what yet.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Thanks again :)
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt; Paweł
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On 19 May 2014 18:00, Dmitri Zagidulin  wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Ah, yes, you bring up a good point. (And, that's another subtlety to
&gt;&gt;&gt;&gt;&gt;&gt;&gt; keep in mind, with Option #1).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Tombstones are definitely something to keep in mind, when deleting
&gt;&gt;&gt;&gt;&gt;&gt;&gt; unit test data.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; As you mentioned in your earlier question, if you're using default
&gt;&gt;&gt;&gt;&gt;&gt;&gt; delete\_mode configuration ( 3 seconds ), it means that if you issue a
&gt;&gt;&gt;&gt;&gt;&gt;&gt; delete, a tombstone object is going to be written (and stick around for 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; at
&gt;&gt;&gt;&gt;&gt;&gt;&gt; least 3 seconds), and unfortunately, it is going to show up as a false
&gt;&gt;&gt;&gt;&gt;&gt;&gt; positive on a List Keys call.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; The easiest thing to try, in your case, is to set 'delete\_mode' to
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 'immediate', restart the test cluster, and retest. With an immediate
&gt;&gt;&gt;&gt;&gt;&gt;&gt; delete, your second test with 10 keys should not take as long as the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; previous delete with 10000 keys.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Mon, May 19, 2014 at 11:46 AM, Paweł Królikowski &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; rabb...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi Dmitri,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thanks a lot for the answer. Option #1 seems the best, but I have a
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; follow up question:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; - when do the deleted keys disappear from Riak: a part of my
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; problem (have not explained it correctly the first time), is that
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; get\_keys() returns keys that no longer exist. So, I run a test with 10 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 000
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; keys, I remove them, it takes Nseconds. I then follow with a test with 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 10
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; keys, but removing them takes just as much time - I imagine it's 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; because
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I'm going over that 10 000 keys again.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; This article seems relevant:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://basho.com/riaks-config-behaviors-part-3/ - it seems like
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; the tombstones simply remain in my system indefinitely.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Paweł
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 19 May 2014 15:32, Dmitri Zagidulin 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi Pawel,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; There's basically three ways to clear data from Riak (for the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; purposes of automated testing):
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1. Iterate through the keys via get\_keys(), and delete each one.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; This is what you're currently doing, except you don't need to invoke
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; if.exists().
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; if.exists() makes an additional API call to Riak, and it takes
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; twice as long as just calling delete() (and trapping a potential 404
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; doesn't exist error).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Advantages: Easy to understand, can be done entirely in code
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; (without invoking OS/shell commands).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Disadvantages: It can get slow, for large data sets. Another
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; subtle disadvantage is that, as your app grows, it can get difficult 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; keep track of which buckets you've created and need to be cleared.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2. Stop the Riak cluster, delete the riak data directory, and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; re-start.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Advantages: Very fast, and you can be sure that you're deleting
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; all buckets.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Disadvantages: Involves invoking OS/shell commands. This is fairly
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; easy if your Riak node is running on the same machine as your tests 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; (and if
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; it's a single node). To delete the data directories of a multi-node
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; cluster, now you need to involve either a bash script that uses SSH 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to log
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; in and restart, or a coordination framework like Ansible.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 3. Use an in-memory back end. (And to drop all data, just restart
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; the node(s)).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Advantages: Same as #2 - fast, thorough.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Disadvantages: Same as #2 (involves shell commands, potentially
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SSH etc). In addition, since you're likely not going to be running 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; your
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; production code on an in-memory back end, this method introduces a
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; potential environmental/functional difference between your testing and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; production clusters.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I generally use method #1 in my unit tests, and manually delete
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; each key.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Dmitri
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Mon, May 19, 2014 at 8:53 AM, Paweł Królikowski &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; rabb...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; For testing, I'd like to be able to throw a large number of data
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; at Riak (100k+ entries), check how it performed, change something in 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; application, run the test again. I'd like to use the same data every 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; time,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; so, I'd like to clear the bucket between every test.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; The documentation (
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://docs.basho.com/riak/2.0.0beta1/dev/references/http/) says:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; \*Delete Buckets\*
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; There is no straightforward way to delete an entire Bucket. To
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; delete all the keys in a bucket, you’ll need to delete them all
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; individually.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; So, I'm currently using something like:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; for k in r\_bk.get\_keys():
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; v = r\_bk.get(k)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; if v.exists:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; r\_bk.delete(v)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; The problem is that r\_bk.get\_keys() returns a lot of elements
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; that don't exist (tombstones?) and iterating over all of them takes 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; time.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Is that the way it's supposed to work? Or am I missing something?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; - I'm using default delete\_mode configuration ( 3 seconds )
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; - I'm using Riak 2.0 alpha 19 with Python. ( there's a bug with
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; strong consistency in Beta1, cannot use it)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; - changing the bucket name for every run seems .. impractical?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Any advices welcomed,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Paweł
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs 
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

