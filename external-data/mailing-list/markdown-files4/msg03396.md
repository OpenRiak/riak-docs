---
title: "Re: Mapreduce crosstalk"
description: ""
project: community
lastmod: 2011-05-24T09:55:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03396"
mailinglist_parent_id: "msg03350"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-05-24T09:55:39-07:00
---


Kyle,

Just wanted to let you know that this bug is fixed in master now. If you are
interested, I describe some details about the issue and the fix in the
commit message here:
https://github.com/basho/riak\_kv/commit/f7e09d54c932f24d1d06fb595ce74e686657810f

Kelly

On Tue, May 17, 2011 at 1:35 PM, Aphyr  wrote:

&gt; I was writing a new mapreduce query to look at users over time, and ran it
&gt; over a single user in production. After that, other mapreduce jobs over
&gt; users started returning results from my new map phase, some of the time.
&gt; After five minutes of this, I had to restart every node in the cluster to
&gt; get it to stop.
&gt;
&gt; Every node has {map\_cache\_size, 0} in riak\_kv.
&gt;
&gt; The map phase that screwed things up was:
&gt;
&gt; function(v) {
&gt; o = JSON.parse(v.values[0].data);
&gt;
&gt; // Age of account in days
&gt; age = Math.round(
&gt; (Date.now() - Date.iso8601(o.created\_at)) /
&gt; (1000 \* 60 \* 60 \* 24)
&gt; );
&gt;
&gt; return [['t\_user\_scores', v.key, age]];
&gt; }
&gt;
&gt; It looks like one node started running that phase instead of the requested
&gt; phase for subsequent jobs. It \*should\* have run this one, but didn't.
&gt;
&gt; function(v) {
&gt; o = JSON.parse(v.values[0].data);
&gt; return [{
&gt; key: v.key,
&gt; name: o.name,
&gt; thumbnail: o.thumbnail
&gt; }];
&gt; }
&gt;
&gt; Now I'm scared to run MR jobs. Could it be an issue with returning keydata?
&gt; Anybody else seen this before?
&gt;
&gt; --Kyle
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Kelly McLaughlin
Engineer
Basho Technologies, Inc.
ke...@basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

