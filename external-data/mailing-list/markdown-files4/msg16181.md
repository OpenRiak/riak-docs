---
title: "Re: Riak2.1.1/java.lang.OutOfMemoryError"
description: ""
project: community
lastmod: 2015-06-03T06:10:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16181"
mailinglist_parent_id: "msg16179"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2015-06-03T06:10:23-07:00
---


Hi Robert,

You have leveldb set to use 90% of available RAM, and the JVM to use
up to 22GB heap, but your machines only have 30GB RAM in total. At
some point during your load cycle, you are guaranteed to start
exhausting RAM, just as you're seeing. Reduce leveldb to 50 percent
(15GB), give the JVM up to 12GB, and that will leave ~3GB for your
operating system.

Please follow up after making those changes, thanks!

--
Luke Bakken
Engineer
lbak...@basho.com


&gt; \*THE PROBLEM\*: After 250K records, inserts come to a slow crawl - going from
&gt; 1 insert in 0.02 seconds to 1 insert in 1 second. Finally, it starts
&gt; hitting java.lang.OutOfMemoryError: GC overhead limit exceeded errors!!
&gt;
&gt; Some riak.conf settings...
&gt; storage\_backend = leveldb
&gt; search = on
&gt; leveldb.maximum\_memory.percent = 90
&gt; ring\_size = 128
&gt; search.solr.jvm\_options = -d64 -Xms1g -Xmx22g -XX:+UseStringCache
&gt; -XX:+UseCompressedOops
&gt;
&gt; Did you note the \*\*-Xmx22g\*\* Heap Size?!?!

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

