---
title: "python client - failing mapreduce on fulltext search"
description: ""
project: community
lastmod: 2016-03-14T11:40:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17163"
author_name: "Bartłomiej Górny"
project_section: "mailinglistitem"
sent_date: 2016-03-14T11:40:44-07:00
---



Hi

I've been trying to do fulltext search and mapreduce on it, only to get 
values, and I can't make it work. When I try the following code:


query = riak.mapreduce.RiakMapReduce(c)
query = query.search(idx, sstr)
query = query.map\_values()
query = query.reduce\_limit(1)
res = query.run()

it failes, and gives me this:

File 
"/usr/local/lib/python2.7/dist-packages/riak-2.4.2-py2.7.egg/riak/mapreduce.py", 
line 322, in run
riak.riak\_error.RiakError: 'Error processing stream message: 
exit:{json\_encode,

 {bad\_term,
 {not\_found,
 {{&lt;&lt;"default"&gt;&gt;, &lt;&lt;"events"&gt;&gt;},
 &lt;&lt;"1457605860\_zeknmulfpt"&gt;&gt;},
 {struct,[]}}}}:[{mochijson2,
 json\_encode,2 [{file,src/mochijson2.erl"}...

where &lt;&lt;"1457605860\_zeknmulfpt"&gt;&gt; is a key of an existing object in 
&lt;&lt;"events"&gt;&gt; bucket, which can be fetched.


The search itself works fine - when I do this:

c.fulltext\_search(idx, sstr, rows=10000)

it works, and I can retrieve all found objects one by one. When I 
mapreduce on a bucket:


query = riak.mapreduce.RiakMapReduce(c)
query = query.add\_bucket("track\_here\_events")
query = query.map\_values()
query = query.reduce\_limit(10)
res = query.run()

it works too. Only combination of search and mapreduce works, though 
according to documentation it should work. What may be wrong, then?


Bartek

--
Młodość jest straszna; to scena, gdzie na wysokich koturnach i w 
najrozmaitszych kostiumach poruszają się dzieci i recytują wyuczone 
kwestie, które rozumieją tylko w połowie, ale którym są fanatycznie oddane.


(Milan Kundera, "Żart")

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

