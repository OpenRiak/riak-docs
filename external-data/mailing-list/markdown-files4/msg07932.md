---
title: "Re: ssl support?"
description: ""
project: community
lastmod: 2012-07-13T15:08:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07932"
mailinglist_parent_id: "msg07931"
author_name: "Michael Johnson"
project_section: "mailinglistitem"
sent_date: 2012-07-13T15:08:23-07:00
---


I gave compiling from source a try, but it did not make a difference.

It turns out that for some reason, the method I have always used to
generate self-signed certificates doesn't seem to result in certificates
that work with riak even though they work for OpenLDAP, nginx, apache, and
other stuff.

Here is the way I typically create certificates:

openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout
/etc/riak/ssl.key -out /etc/riak/ssl.crt

I like this because it's a simple one-liner. Basho does point you to
http://www.akadia.com/services/ssh\_test\_certificate.html for directions on
how to generate a certificate, and if you follow those directions, you do
indeed get a certificate that works with riak.

If this only affected my self-signed certificates, I would be fine moving
on at this point. However, I have tried using certificates that a signed
by real ssl cert signing authorities and they have not been working either.

I fully admit that I'm not an ssl expert, and have no idea what would be
the critical difference between my methodology for creating self-signed
certs, the methodology basho points to, and the way the legit cert I
tried was created/signed. Any insite?

On Fri, Jul 13, 2012 at 2:06 PM, Michael Johnson  wrote:

&gt; (reposting with the rest of the thread removed... it was too big and
&gt; getting moderated)
&gt;
&gt; Yup, they are:
&gt;
&gt; [root@riak01 riak]# ls -al /etc/riak/ssl.\*
&gt; -rw-r--r--. 1 root root 2122 Jul 12 16:49 /etc/riak/ssl.crt
&gt; -rw-r--r--. 1 root root 3272 Jul 12 16:49 /etc/riak/ssl.key
&gt;
&gt; In fact, I straced the beam process to see if that would show anything
&gt; outside of what was showing up in the logs and noticed one thing that was
&gt; somewhat interesting. The process check to see if the cert and key files
&gt; are writeable (which they are not). On the off chance that that was
&gt; problematic, I changed the owner and group of the cert and key to be 'riak'
&gt; and the check for write access was succeeding, however it didn't change the
&gt; end result. Here is a snip from the strace before changing the owner and
&gt; group:
&gt;
&gt; 31520 stat("/etc/riak/ssl.crt", 
&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=2122, ...}) = 0
&gt; 31520 access("/etc/riak/ssl.crt", R\_OK) = 0
&gt; 31520 access("/etc/riak/ssl.crt", W\_OK) = -1 EACCES (Permission denied)
&gt; ...
&gt; 31520 stat("/etc/riak/ssl.key", 
&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=3272, ...}) = 0
&gt; 31520 access("/etc/riak/ssl.key", R\_OK) = 0
&gt; 31520 access("/etc/riak/ssl.key", W\_OK) = -1 EACCES (Permission denied)
&gt;
&gt; And after:
&gt; 31520 stat("/etc/riak/ssl.crt", 
&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=2122, ...}) = 0
&gt; 31520 access("/etc/riak/ssl.crt", R\_OK) = 0
&gt; 31520 access("/etc/riak/ssl.crt", W\_OK) = 0
&gt; ...
&gt; 31520 stat("/etc/riak/ssl.key", 
&gt; 31520 &lt;... stat resumed&gt; {st\_mode=S\_IFREG|0644, st\_size=3272, ...}) = 0
&gt; 31520 access("/etc/riak/ssl.key", R\_OK) = 0
&gt; 31520 access("/etc/riak/ssl.key", W\_OK) = 0
&gt;
&gt; On Fri, Jul 13, 2012 at 1:34 PM, Dave Parfitt  wrote:
&gt;
&gt;&gt; Hi Michael -
&gt;&gt;
&gt;&gt; [root@riak01 riak]# openssl verify /etc/riak/ssl.crt
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt; I see you are using root to create/verify these certs - are they readable
&gt;&gt; by the riak user?
&gt;&gt;
&gt;&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

