---
title: "Re: Some questions about Riak Search and Riak itself"
description: ""
project: community
lastmod: 2010-10-13T06:27:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01267"
mailinglist_parent_id: "msg01262"
author_name: "Dmitry Demeshchuk"
project_section: "mailinglistitem"
sent_date: 2010-10-13T06:27:24-07:00
---


Hi, Fink. Thank you for your reply. Here are some inline comments.

On Tue, Oct 12, 2010 at 9:42 PM, Bryan Fink  wrote:
&gt; On Tue, Oct 12, 2010 at 3:16 AM, Dmitry Demeshchuk  
&gt; wrote:
&gt;&gt; 1. I tried to put some Erlang terms into Riak bucket that is being
&gt;&gt; indexed by Riak Search. I hoped that key-value lists like this
&gt; ...snip...
&gt;&gt; Is there a way to send Erlang proplists into Riak and process them
&gt;&gt; using Riak Search?
&gt;
&gt; Hi, Dmitry. We've filed a bug for doing exactly this:
&gt;
&gt; https://issues.basho.com/show\_bug.cgi?id=788
&gt;
&gt; In the meantime, you could also write your own extractor. See the
&gt; "Other Data Encodings" section of using\_search.org:
&gt;
&gt; http://bitbucket.org/basho/riak\_search/src/d1f10b876cae/doc/using\_search.org#cl-985
&gt;
&gt; Or on the wiki:
&gt;
&gt; http://wiki.basho.com/display/RIAK/Riak+Search+-+Indexing+and+Querying+Riak+KV+Data#RiakSearch-IndexingandQueryingRiakKVData-OtherDataEncodings
&gt;
&gt;&gt; 2. Is there a way to query Erlang buckets indexes using any other APIs
&gt;&gt; than REST API? The only way to query the bucket I found was
&gt;&gt;
&gt;&gt; /solr/some\_bucket/select
&gt;&gt;
&gt;&gt; and my attempts of using Riak Search shell and Erlang API just failed.
&gt;
&gt; If you could posts details about the ways in which your attempts
&gt; failed (error messages, etc.), we might be able to help you
&gt; troubleshoot them.
&gt;
&gt; The other main way of querying Search indexes is using the map/reduce
&gt; Search input. The "Querying via HTTP/Curl" section has an example of
&gt; how to hook this up:
&gt;
&gt; http://bitbucket.org/basho/riak\_search/src/d1f10b876cae/doc/using\_search.org#cl-783
&gt;
&gt; http://wiki.basho.com/display/RIAK/Riak+Search+-+Querying#RiakSearch-Querying-QueryingviaHTTP%2FCurl
&gt;
&gt; And it's also possible to specify the same map/reduce input using any
&gt; of the Erlang clients (native, protocol buffer, or http). Though
&gt; there is a small bug with the non-streaming native Erlang client at
&gt; the moment (https://issues.basho.com/show\_bug.cgi?id=803). For an
&gt; example of using that syntax, have a look at the Wriaki project:
&gt;
&gt; http://bitbucket.org/basho/wriaki/src/d2334be214ce/apps/wriaki/src/wiki\_resource.erl#cl-267

I worked it out. Both shell and command-line search work good. Seems
like I've been doing something wrong before.

&gt;
&gt;&gt; 3. Is there a way to write custom analyzers in non-java languages? I
&gt;&gt; saw the same question and found an answer that analyzer automatically
&gt;&gt; tries to start JVM for its needs. The problem is that we don't have
&gt;&gt; good Java and JVM developers so it would be better to use some other
&gt;&gt; solutions (like OCaml or even C, for example). Also, I'm kinda
&gt;&gt; suspicious about Java analyzers performance.
&gt;
&gt; At the moment, the only non-Java language supported for custom
&gt; analyzers is Erlang. You can specify an Erlang analyzer by adding an
&gt; "analyzer\_factory" entry to your schema, of the form:
&gt;
&gt; {analyzer\_factory, {erlang, my\_modlue, my\_function}}
&gt;
&gt; Other formats for the analyzer\_factory setting are:
&gt;
&gt; {erlang, my\_module, my\_function, Arguments}
&gt; {java, FullyQualifiedClassNameAsString}
&gt; {java, FullyQualifiedClassNameAsString, Arguments}
&gt; FullyQualifiedClassNameAsString
&gt;
&gt; The last format is demonstrated in the "Defining a Schema" section of the 
&gt; docs:
&gt;
&gt; http://bitbucket.org/basho/riak\_search/src/d1f10b876cae/doc/using\_search.org#cl-193
&gt;
&gt; http://wiki.basho.com/display/RIAK/Riak+Search+-+Schema#RiakSearch-Schema-DefiningaSchema
&gt;
&gt; Unfortunately, we haven't written much documentation about what an
&gt; analyzer is expected to do, but hopefully between the comments in
&gt; qilr\_analyzer, and the default Erlang analyzer,
&gt; text\_analyzers:default\_analyzer\_factory/2, you'll be able to work out
&gt; some of what you need.
&gt;
&gt; http://bitbucket.org/basho/riak\_search/src/d1f10b876cae/apps/qilr/src/qilr\_analyzer.erl#cl-53
&gt;
&gt; http://bitbucket.org/basho/riak\_search/src/d1f10b876cae/apps/qilr/src/text\_analyzers.erl
&gt;
&gt;&gt; 4. Do you have any tips and advice about working with Unicode in Riak Search?
&gt;
&gt; Encode everything in UTF-8. There may still be a few bugs we need to
&gt; work out, but our intended goal is to have everything in that
&gt; department "just work" once you're using UTF-8 everywhere.

I'm not sure if I do everything right but here's the step-by step
description of my actions:

1. curl -v -d "{\"title\":\"Статья 1\", \"tags\":\"псто, лытдыбр\",
\"body\":\"Я что-то здесь написал\"}" -H "Content-Type:
application/json" http://127.0.0.1:8098/riak/posts

(Note, there are cyrillic symbols)

2. curl -X POST -H "content-type: application/json"
http://localhost:8098/mapred -d '{"inputs":"posts",
"query":[{"map":{"language":"javascript","source":"Riak.mapValues",
"keep":true}}]}'

The result is:

["{\"title\":\"\u0421\u0442\u0430\u0442\u044c\u044f 1\",
\"tags\":\"\u043f\u0441\u0442\u043e,
\u043b\u044b\u0442\u0434\u044b\u0431\u0440\", \"body\":\"\u042f
\u0447\u0442\u043e-\u0442\u043e \u0437\u0434\u0435\u0441\u044c
\u043d\u0430\u043f\u0438\u0441\u0430\u043b\"}"]

So, the cyrillic strings were encoded properly by Riak itself (not
sure if it's on the mochiweb level or somewhere else).

3. curl -X POST -H "content-type: application/json"
http://localhost:8098/mapred -d '{"inputs":{"module":"riak\_search",
"function":"mapred\_search", "arg": ["posts", "title:Статья\*"]},
"query":[{"map":{"language":"javascript","source":"Riak.mapValues",
"keep":true}}]}'

This is a map-reduce Riak Search request. It's expected to return the
previously posted document. However, it returns an empty list.

4. Tried both shell and command-line search - the same result.

5. If I try to reproduce the same using latin characters, everything
just works fine. The JSON data may be partially cyrillic - in that
case search works on the latin fields only.


Am I doing something wrong? Should I encode characters somehow before
I send them into RiakSearch?


Thanks.


&gt;
&gt; -Bryan
&gt;



-- 
Best regards,
Dmitry Demeshchuk

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

