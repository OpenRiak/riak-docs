---
title: "Re: Updating Counters on Riak 2.0 pre whatever"
description: ""
project: community
lastmod: 2013-10-22T14:54:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12736"
mailinglist_parent_id: "msg12735"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-10-22T14:54:48-07:00
---


Good to know that bolth options are available. :)

We don't do any version detection in CorrugatedIron and instead rely on the
developer to be relatively sane (just like you shouldn't try to send SQL
Server 2012 commands to SQL Server 2000 over an ODBC connection). Our plan
is to provide both the 1.4 counter API and the CRDT API.

We'll deprecate 1.4 counters whenever Basho does the same.

There's no information overload for me, but it is nice to see everything in
the same place.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Tue, Oct 22, 2013 at 3:13 PM, Russell Brown wrote:

&gt;
&gt; On 22 Oct 2013, at 20:24, Jeremiah Peschka 
&gt; wrote:
&gt;
&gt; &gt; Hah! No worries at all. Thanks for the clarification. I'll rebuild.
&gt; &gt;
&gt; &gt; I wasn't sure if I needed to try to figure out (from a client
&gt; perspective) if I needed to use the CRDT syntax for 2.0 and newer and
&gt; RpbCounterUpdateReq for 1.4.x and earlier. Good to know that I can blindly
&gt; proceed.
&gt;
&gt; Ok, this is a good question. And something we've been working on.
&gt;
&gt; 1.4 had counters, 2.0 has counters. Are they the same? Yes and no.
&gt;
&gt; In 2.0 we add bucket types. We decided that CRDTs in 2.0 should take
&gt; advantage of bucket types. The reason being that there is no sensible way
&gt; to merge across types (how do you merge a Map with a Set? (we thought of a
&gt; few ways, but non were intuitive)) It comes down to the reason for CRDTs:
&gt; no conflicts, no siblings. If we allow different types in the same bucket
&gt; then you can create the same key with two different types, which means
&gt; siblings types: just as complex as siblings.
&gt;
&gt; So, we restrict you to one CRDT type per bucket. But in 1.4 we didn't have
&gt; this restriction. And we need to support 1.4 style counters.
&gt;
&gt; If you use the 1.4 API or store counters in the default (untyped) bucket
&gt; using the 2.0 API then you're interoperable between versions.
&gt;
&gt; Sorry if it seems confusing. The point is that as a client developer you
&gt; can access 1.4 counters through the 2.0 API by using the default bucket
&gt; type OR continue support for the 1.4 API (or bolth.) Whichever you prefer.
&gt;
&gt; I realise this might be an information overload, so feel free to ask
&gt; questions about anything I wasn't clear enough about.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt; &gt;
&gt; &gt; ---
&gt; &gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; &gt; MCITP: SQL Server 2008, MVP
&gt; &gt; Cloudera Certified Developer for Apache Hadoop
&gt; &gt;
&gt; &gt;
&gt; &gt; On Tue, Oct 22, 2013 at 2:07 PM, Russell Brown 
&gt; wrote:
&gt; &gt; Yes! Sorry!
&gt; &gt;
&gt; &gt; We broke backwards compatibility during development. We merged the patch
&gt; today[1]. The develop branch works right now. It will get into the next pre
&gt; (or whatever the next tag is called.)
&gt; &gt;
&gt; &gt; Apologies again, it was easier for me to do the new work without
&gt; thinking about backwards compatibility, then re-add old counters when the
&gt; 2.0 stuff was done.
&gt; &gt;
&gt; &gt; Let me know if you have any more issues going forward, please.
&gt; &gt;
&gt; &gt; Cheers
&gt; &gt;
&gt; &gt; Russell
&gt; &gt;
&gt; &gt; [1] https://github.com/basho/riak\_kv/pull/697
&gt; &gt; On 22 Oct 2013, at 19:56, Jeremiah Peschka 
&gt; wrote:
&gt; &gt;
&gt; &gt; &gt; I'm attempting to create a counter on Riak 2.0 built from the develop
&gt; on Sunday. When I send a counter increment message using
&gt; RpbCounterUpdateReq, I get the following back from Riak:
&gt; &gt; &gt;
&gt; &gt; &gt; Riak returned an error. Code '0'. Message: Error processing incoming
&gt; message: error:undef:[{riak\_kv\_counter,supported,
&gt; &gt; &gt; [],[]},
&gt; &gt; &gt;
&gt; {riak\_kv\_pb\_counter,process,
&gt; &gt; &gt; 2,
&gt; &gt; &gt; [{file,
&gt; &gt; &gt;
&gt; "src/riak\_kv\_pb\_counter.erl"},
&gt; &gt; &gt; {line,114}]},
&gt; &gt; &gt; {riak\_api\_pb\_server,
&gt; &gt; &gt; process\_message,4,
&gt; &gt; &gt; [{file,
&gt; &gt; &gt;
&gt; "src/riak\_api\_pb\_server.erl"},
&gt; &gt; &gt; {line,386}]},
&gt; &gt; &gt; {riak\_api\_pb\_server,
&gt; &gt; &gt; connected,2,
&gt; &gt; &gt; [{file,
&gt; &gt; &gt;
&gt; "src/riak\_api\_pb\_server.erl"},
&gt; &gt; &gt; {line,228}]},
&gt; &gt; &gt; {riak\_api\_pb\_server,
&gt; &gt; &gt; decode\_buffer,2,
&gt; &gt; &gt; [{file,
&gt; &gt; &gt;
&gt; "src/riak\_api\_pb\_server.erl"},
&gt; &gt; &gt; {line,362}]},
&gt; &gt; &gt; {gen\_fsm,handle\_msg,7,
&gt; &gt; &gt; [{file,"gen\_fsm.erl"},
&gt; &gt; &gt; {line,505}]},
&gt; &gt; &gt;
&gt; {proc\_lib,init\_p\_do\_apply,3,
&gt; &gt; &gt;
&gt; [{file,"proc\_lib.erl"},
&gt; &gt; &gt; {line,239}]}]
&gt; &gt; &gt; ---
&gt; &gt; &gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; &gt; &gt; MCITP: SQL Server 2008, MVP
&gt; &gt; &gt; Cloudera Certified Developer for Apache Hadoop
&gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

