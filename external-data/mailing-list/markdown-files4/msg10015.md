---
title: "Re: CorrugatedIron call to delete a bucket."
description: ""
project: community
lastmod: 2013-02-06T06:57:47-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10015"
mailinglist_parent_id: "msg10012"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-02-06T06:57:47-08:00
---


Don't be too put out - deleting a bucket is the sad panda story of Riak. We
provide the DeleteBucket() method largely for our own selfish purposes of
cleaning up after unit tests.

2i is a secondary index. If you've set up Riak to use the LevelDB back end,
you can create secondary indices. There is a $keys index that just lists
the names of the keys in a bucket. By using secondary indices, you can
stream the $keys index back to CorrugatedIron and then issue async deletes
on chunks of keys.

The Erlang way is a bit more complex - it requires knowing Erlang. In
theory, you can write several Erlang functions that will perform a
MapReduce across your bucket (or even the secondary index) and delete keys.
The upside of using Erlang + MapReduce to do it is that you won't have to
round trip between Riak and your client. The downside is that you have to
learn Erlang. ;)




---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Wed, Feb 6, 2013 at 4:56 AM, Kevin Burton wrote:

&gt; Sorry. Being a beginner I am not aware of "alternative" methods. I have
&gt; not read enough to use Erlang. I don't know what "querying a 2i" is. I also
&gt; wasn't aware that I needed to manage my keys. Perhaps this question could
&gt; turn into a kind of poll for best practices? All suggestions are greatly
&gt; appreciated.
&gt;
&gt; On Feb 6, 2013, at 6:44 AM, OJ Reeves  wrote:
&gt;
&gt; Kevin,
&gt;
&gt; No I'm not saying that bucket's can't be deleted. I'm saying that you
&gt; should choose an alternative method. For example, manage your keys in
&gt; another way perhaps by querying a 2i and using the result to delete the
&gt; values. This could be done via an Erlang map reduce job. You could store
&gt; the keys elsewhere for later retrieval then delete each object via the key.
&gt;
&gt; The problem here isn't deleting buckets, the problem is listing keys. I do
&gt; think that other Riak users, Basho people in particular, would be better
&gt; positioned to offer alternative approaches than me.
&gt;
&gt; OJ
&gt;
&gt;
&gt; On Wed, Feb 6, 2013 at 10:37 PM, Kevin Burton wrote:
&gt;
&gt;&gt; I see the warning and I would love to heed it. You are saying buckets can
&gt;&gt; never be deleted? Rename has the same problem?
&gt;&gt;
&gt;&gt; On Feb 6, 2013, at 6:15 AM, OJ Reeves  wrote:
&gt;&gt;
&gt;&gt; Deleting a bucket takes forever in any Riak client if the bucket has a
&gt;&gt; lot of values in it. This is because a bucket isn't an object that is any
&gt;&gt; way analogous to a "table" like you'd see in an RDBMS and to delete a
&gt;&gt; bucket the keys in that bucket need to be listed first (please correct me
&gt;&gt; if I'm wrong people!). This operation is known to be slow and using it is
&gt;&gt; not recommended.
&gt;&gt;
&gt;&gt; CorrugatedIron outputs warning messages to the debug console whenever
&gt;&gt; ListKeys or DeleteBucket are called. I'd recommend heeding those warnings
&gt;&gt; and look to take a different approach.
&gt;&gt;
&gt;&gt; OJ
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Feb 6, 2013 at 8:11 AM, Jeremiah Peschka &lt;
&gt;&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; No.
&gt;&gt;&gt;
&gt;&gt;&gt; Deleting a bucket requires deleting all keys in the bucket. It will be
&gt;&gt;&gt; slow.
&gt;&gt;&gt;
&gt;&gt;&gt; ---
&gt;&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt;&gt;&gt; MCITP: SQL Server 2008, MVP
&gt;&gt;&gt; Cloudera Certified Developer for Apache Hadoop
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Feb 5, 2013 at 1:58 PM, Kevin Burton 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \*\* \*\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I am trying to remove a bucket. So I call client.DeleteBucket(&gt;&gt;&gt; bucket&gt;) but this takes \*\*forever\*\*. Is there a faster way to simply
&gt;&gt;&gt;&gt; remove a bucket?\*\*\*\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \*\* \*\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \*\* \*\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt;
&gt;&gt; OJ Reeves
&gt;&gt; +61 431 952 586
&gt;&gt; http://buffered.io/
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt;
&gt; OJ Reeves
&gt; +61 431 952 586
&gt; http://buffered.io/
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

