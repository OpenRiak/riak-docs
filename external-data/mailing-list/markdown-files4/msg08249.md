---
title: "Re: Upgrading 0.14.2 cluster to 1.2"
description: ""
project: community
lastmod: 2012-08-09T13:25:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08249"
mailinglist_parent_id: "msg08238"
author_name: "Sebastian Cohnen"
project_section: "mailinglistitem"
sent_date: 2012-08-09T13:25:19-07:00
---


I forgot to mention, that I also ran 
"riak\_core\_node\_watcher:service\_up(riak\_pipe, self())." on the 0.14.2 node (got 
that from here: http://wiki.basho.com/Rolling-Upgrades.html)
 
On 09.08.2012, at 22:16, Sebastian Cohnen  wrote:

&gt; Hey all,
&gt; 
&gt; looks like I'm already stuck :-/
&gt; 
&gt; I'm trying to test the upgrade on a stage cluster (with 2 nodes). What I did 
&gt; so far:
&gt; \* downloaded 1.2
&gt; \* stopped riak
&gt; \* backup /var/lib/riak/ring and /etc/riak
&gt; \* installed 1.2
&gt; \* changed app.config and vm.args (just node name, ring creation size, config 
&gt; for our multi-backends)
&gt; \* started riak again
&gt; 
&gt; riak-admin status looked fine, ring membership is fine, both nodes answer 
&gt; requests. As hinted by Jon, I attached to riak console and run 
&gt; riak\_core\_capability:all(). As far as I can tell, everything looks okay here 
&gt; too.
&gt; 
&gt; What is not working is: riak-admin transfers. It is not working on both 
&gt; nodes. For the state situation this is not a big deal, for production this 
&gt; would be a potential problem.
&gt; 
&gt; I've pasted the output of "riak\_core\_capability:all()." and command output of 
&gt; riak-admin transfers here: https://gist.github.com/3307714
&gt; 
&gt; Is there anything I can do about that?
&gt; 
&gt; 
&gt; Best
&gt; 
&gt; Sebastian
&gt; 
&gt; 
&gt; PS: What's interesting is that I think that I saw a similar behavior while 
&gt; trying to upgrade to 1.1.4 a few days ago. I have to double check that though.
&gt; 
&gt; On 09.08.2012, at 14:08, Sebastian Cohnen  wrote:
&gt; 
&gt;&gt; I'm actually thinking about taking the risk. We only have a small 3-node 
&gt;&gt; cluster with ~50GB of data with relatively little traffic (and we don't have 
&gt;&gt; any 2i, nor do we use search or MR).
&gt;&gt; 
&gt;&gt; I'll backup the data files, the ring state and everything else I find and 
&gt;&gt; give it a try. If anything strange happens, we roll back and do the 
&gt;&gt; additional 1.1.4 step.
&gt;&gt; 
&gt;&gt; Thanks for the information and help so far!
&gt;&gt; 
&gt;&gt; On 08.08.2012, at 19:57, Jon Meredith  wrote:
&gt;&gt; 
&gt;&gt;&gt; Only test coverage. We didn't run direct testing to 0.14.2 - we also 
&gt;&gt;&gt; deliberately made the decision not to remove some older code that would 
&gt;&gt;&gt; have broken 0.14 upgrades until the next major release. 
&gt;&gt;&gt; 
&gt;&gt;&gt; It all depends on your risk tolerance - we didn't make any file format 
&gt;&gt;&gt; changes to bitcask so your data should be safe. If you wanted to try it, I 
&gt;&gt;&gt; would take a backup of the ring directory in case you had to downgrade the 
&gt;&gt;&gt; node again for any reason.
&gt;&gt;&gt; 
&gt;&gt;&gt; On the newly upgraded node you could run riak\_core\_capability:all(). on the 
&gt;&gt;&gt; riak console, that would double-check that the settings matched the 
&gt;&gt;&gt; required rolling upgrade settings, and make sure you do a diff of your 
&gt;&gt;&gt; app.config/vm.args against the new package to check there aren't any 
&gt;&gt;&gt; settings missing.
&gt;&gt;&gt; 
&gt;&gt;&gt; Jon.
&gt;&gt;&gt; 
&gt;&gt;&gt; On Wed, Aug 8, 2012 at 11:39 AM, Sebastian Cohnen 
&gt;&gt;&gt;  wrote:
&gt;&gt;&gt; I'm curious, are there any special reasons for your recommendation?
&gt;&gt;&gt; 
&gt;&gt;&gt; On 08.08.2012, at 19:38, Jon Meredith  wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I would recommend going 0.14.2 -&gt; 1.1.4 -&gt; 1.2, making sure you follow the 
&gt;&gt;&gt;&gt; pre-1.0 upgrade instructions on http://wiki.basho.com/Rolling-Upgrades.html
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Once you do the upgrade from 1.2, the capabilities system will kick in and 
&gt;&gt;&gt;&gt; the old legacy settings mentioned in the rolling upgrade will no longer be 
&gt;&gt;&gt;&gt; used (if you need to you can override them with the new capability 
&gt;&gt;&gt;&gt; override mechanism).
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Jon.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Wed, Aug 8, 2012 at 10:23 AM, Nathan Wilken  wrote:
&gt;&gt;&gt;&gt; Is an intermediate upgrade recommended? 0.14.2 --&gt; 1.0/1.1 --&gt; 1.2?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; From: riak-users-boun...@lists.basho.com 
&gt;&gt;&gt;&gt; [riak-users-boun...@lists.basho.com] on behalf of Sean Cribbs 
&gt;&gt;&gt;&gt; [s...@basho.com]
&gt;&gt;&gt;&gt; Sent: Wednesday, August 08, 2012 6:35 AM
&gt;&gt;&gt;&gt; To: Sebastian Cohnen
&gt;&gt;&gt;&gt; Cc: riak-users@lists.basho.com
&gt;&gt;&gt;&gt; Subject: Re: Upgrading 0.14.2 cluster to 1.2
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Sebastian,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; While it might work, we did not specifically test upgrades from 0.14.2, 
&gt;&gt;&gt;&gt; only 1.0 and 1.1.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Wed, Aug 8, 2012 at 7:08 AM, Sebastian Cohnen 
&gt;&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt; Hey list,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; is it a good idea to upgrade a small (3 node) cluster straight to 1.2 from 
&gt;&gt;&gt;&gt; 0.14.2. Especially with riak's 1.2 capabilities negotiation, it feels like 
&gt;&gt;&gt;&gt; the upgrade process should be much simpler now? We don't do any M/R jobs 
&gt;&gt;&gt;&gt; currently and we are only using bitcask right now.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Best
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Sebastian
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Jon Meredith
&gt;&gt;&gt;&gt; Platform Engineering Manager
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; jmered...@basho.com
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; -- 
&gt;&gt;&gt; Jon Meredith
&gt;&gt;&gt; Platform Engineering Manager
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; jmered...@basho.com
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

