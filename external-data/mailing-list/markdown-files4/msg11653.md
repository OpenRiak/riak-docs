---
title: "Re: riak 1.4.0 upgrade failed"
description: ""
project: community
lastmod: 2013-07-19T19:20:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11653"
mailinglist_parent_id: "msg11650"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2013-07-19T19:20:22-07:00
---


So 'epmd' (erlang port mapper daemon) is probably still running under the
riak user. You can try killing epmd and making sure no other process is
running under the riak user.

I'll put in an issue to not fail so hard if the usermod command fails.
 Sorry for the troubles.

-Jared


On Fri, Jul 19, 2013 at 8:58 AM, kzhang  wrote:

&gt; Hi,
&gt;
&gt; Thanks for the reply. Sorry, I tried a few times, I did stop it at some
&gt; point, still the same result. Just tried again and here is the result:
&gt;
&gt; # riak stop
&gt; Attempting to restart script through sudo -H -u riak ok
&gt;
&gt; # riak-admin status
&gt; Attempting to restart script through sudo -H -u riak Node is not running!
&gt;
&gt; # sudo rpm -Uvhv riak-1.4.0-1.el6.x86\_64.rpm
&gt; D: ============== riak-1.4.0-1.el6.x86\_64.rpm
&gt; D: loading keyring from pubkeys in /var/lib/rpm/pubkeys/\*.key
&gt; D: couldn't find any keys in /var/lib/rpm/pubkeys/\*.key
&gt; D: loading keyring from rpmdb
&gt; D: opening db environment /var/lib/rpm cdb:mpool:joinenv
&gt; D: opening db index /var/lib/rpm/Packages rdonly mode=0x0
&gt; D: locked db index /var/lib/rpm/Packages
&gt; D: opening db index /var/lib/rpm/Name rdonly mode=0x0
&gt; D: read h# 457 Header sanity check: OK
&gt; D: added key gpg-pubkey-c105b9de-4e0fd3a3 to keyring
&gt; D: Using legacy gpg-pubkey(s) from rpmdb
&gt; D: Expected size: 25326908 = lead(96)+sigs(180)+pad(4)+data(25326628)
&gt; D: Actual size: 25326908
&gt; D: riak-1.4.0-1.el6.x86\_64.rpm: Header SHA1 digest: OK
&gt; (f2fc385c419ea7010a2691e6c7e7e8ad51a045a6)
&gt; D: ========== relocations
&gt; D: read h# 496 Header SHA1 digest: OK
&gt; (7b0796f33bb3381f63e1d28c779198e8313729d0)
&gt; D: added binary package [0]
&gt; D: found 0 source and 1 binary packages
&gt; D: ========== +++ riak-1.4.0-1.el6 x86\_64/linux 0x2
&gt; D: opening db index /var/lib/rpm/Basenames rdonly mode=0x0
&gt; D: read h# 13 Header V3 RSA/SHA1 Signature, key ID c105b9de: OK
&gt; D: Requires: /bin/bash YES (db files)
&gt; D: Requires: /bin/sh YES (db files)
&gt; D: Requires: /bin/sh YES (cached)
&gt; D: Requires: /bin/sh YES (cached)
&gt; D: read h# 155 Header V3 RSA/SHA1 Signature, key ID c105b9de: OK
&gt; D: Requires: /usr/bin/env YES (db files)
&gt; D: Requires: config(riak) = 1.4.0-1.el6 YES (added
&gt; provide)
&gt; D: opening db index /var/lib/rpm/Providename rdonly mode=0x0
&gt; D: read h# 11 Header V3 RSA/SHA1 Signature, key ID c105b9de: OK
&gt; D: Requires: libc.so.6()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libc.so.6(GLIBC\_2.2.5)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libc.so.6(GLIBC\_2.3)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libc.so.6(GLIBC\_2.3.2)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libc.so.6(GLIBC\_2.3.4)(64bit) YES (db
&gt; provides)
&gt; D: read h# 157 Header V3 RSA/SHA1 Signature, key ID c105b9de: OK
&gt; D: Requires: libcrypto.so.10()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libdl.so.2()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libdl.so.2(GLIBC\_2.2.5)(64bit) YES (db
&gt; provides)
&gt; D: read h# 1 Header V3 RSA/SHA1 Signature, key ID c105b9de: OK
&gt; D: Requires: libgcc\_s.so.1()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libgcc\_s.so.1(GCC\_3.0)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libm.so.6()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libm.so.6(GLIBC\_2.2.5)(64bit) YES (db
&gt; provides)
&gt; D: read h# 12 Header V3 RSA/SHA256 Signature, key ID c105b9de: OK
&gt; D: Requires: libncurses.so.5()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libpthread.so.0()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libpthread.so.0(GLIBC\_2.2.5)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libpthread.so.0(GLIBC\_2.3.2)(64bit) YES (db
&gt; provides)
&gt; D: Requires: librt.so.1()(64bit) YES (db
&gt; provides)
&gt; D: Requires: librt.so.1(GLIBC\_2.2.5)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libssl.so.10()(64bit) YES (db
&gt; provides)
&gt; D: read h# 27 Header V3 RSA/SHA1 Signature, key ID c105b9de: OK
&gt; D: Requires: libstdc++.so.6()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libstdc++.so.6(CXXABI\_1.3)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libstdc++.so.6(GLIBCXX\_3.4)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libstdc++.so.6(GLIBCXX\_3.4.11)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libstdc++.so.6(GLIBCXX\_3.4.9)(64bit) YES (db
&gt; provides)
&gt; D: Requires: libtinfo.so.5()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libutil.so.1()(64bit) YES (db
&gt; provides)
&gt; D: Requires: libutil.so.1(GLIBC\_2.2.5)(64bit) YES (db
&gt; provides)
&gt; D: Requires: rpmlib(CompressedFileNames) &lt;= 3.0.4-1 YES (rpmlib
&gt; provides)
&gt; D: Requires: rpmlib(FileDigests) &lt;= 4.6.0-1 YES (rpmlib
&gt; provides)
&gt; D: Requires: rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1 YES (rpmlib
&gt; provides)
&gt; D: Requires: rtld(GNU\_HASH) YES (db
&gt; provides)
&gt; D: Requires: rpmlib(PayloadIsXz) &lt;= 5.2-1 YES (rpmlib
&gt; provides)
&gt; D: opening db index /var/lib/rpm/Conflictname rdonly mode=0x0
&gt; D: ========== --- riak-1.3.2-2.el6 x86\_64/linux 0x2
&gt; D: opening db index /var/lib/rpm/Requirename rdonly mode=0x0
&gt; D: ========== recording tsort relations
&gt; D: ========== tsorting packages (order, #predecessors, #succesors, tree,
&gt; depth)
&gt; D: 0 0 0 0 1 +riak-1.4.0-1.el6.x86\_64
&gt; D: 1 0 0 1 1 -riak-1.3.2-2.el6.x86\_64
&gt; D: installing binary packages
&gt; D: closed db index /var/lib/rpm/Conflictname
&gt; D: closed db index /var/lib/rpm/Providename
&gt; D: closed db index /var/lib/rpm/Requirename
&gt; D: closed db index /var/lib/rpm/Basenames
&gt; D: closed db index /var/lib/rpm/Name
&gt; D: closed db index /var/lib/rpm/Packages
&gt; D: closed db environment /var/lib/rpm
&gt; D: opening db environment /var/lib/rpm cdb:mpool:joinenv
&gt; D: opening db index /var/lib/rpm/Packages create mode=0x42
&gt; D: sanity checking 2 elements
&gt; D: opening db index /var/lib/rpm/Name create mode=0x42
&gt; D: read h# 496 Header SHA1 digest: OK
&gt; (7b0796f33bb3381f63e1d28c779198e8313729d0)
&gt; D: running pre-transaction scripts
&gt; D: computing 4357 file fingerprints
&gt; Preparing... D: computing file dispositions
&gt; D: opening db index /var/lib/rpm/Basenames create mode=0x42
&gt; D: 0x0000fd00 4096 477283 158983 /
&gt; D: 0x0000fd02 4096 176259 62467 /var
&gt; ########################################### [100%]
&gt; D: ========== +++ riak-1.4.0-1.el6 x86\_64-linux 0x2
&gt; D: Expected size: 25326908 = lead(96)+sigs(180)+pad(4)+data(25326628)
&gt; D: Actual size: 25326908
&gt; D: riak-1.4.0-1.el6.x86\_64: Header SHA1 digest: OK
&gt; (f2fc385c419ea7010a2691e6c7e7e8ad51a045a6)
&gt; D: install: riak-1.4.0-1.el6 has 2227 files, test = 0
&gt; D: opening db index /var/lib/rpm/Triggername create mode=0x42
&gt; D: install: %pre(riak-1.4.0-1.el6.x86\_64) scriptlet start
&gt; D: install: %pre(riak-1.4.0-1.el6.x86\_64) execv(/bin/sh) pid 20966
&gt; + getent group riak
&gt; + getent passwd riak
&gt; + usermod -d /var/lib/riak riak
&gt; usermod: user riak is currently logged in
&gt; D: install: waitpid(20966) rc 20966 status 800 secs 0.304
&gt; error: %pre(riak-1.4.0-1.el6.x86\_64) scriptlet failed, exit status 8
&gt; error: install: %pre scriptlet failed (2), skipping riak-1.4.0-1.el6
&gt; D: ========== +++ riak-1.3.2-2.el6 x86\_64-linux 0x2
&gt; D: element riak-1.3.2-2.el6.x86\_64 marked as failed, skipping
&gt; D: running post-transaction scripts
&gt; D: closed db index /var/lib/rpm/Triggername
&gt; D: closed db index /var/lib/rpm/Basenames
&gt; D: closed db index /var/lib/rpm/Name
&gt; D: closed db index /var/lib/rpm/Packages
&gt; D: closed db environment /var/lib/rpm
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/riak-1-4-0-upgrade-failed-tp4028429p4028434.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

