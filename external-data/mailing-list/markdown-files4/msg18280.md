---
title: "Re: Solr search response time spikes"
description: ""
project: community
lastmod: 2017-06-22T13:41:54-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18280"
mailinglist_parent_id: "msg18277"
author_name: "Fred Dushin"
project_section: "mailinglistitem"
sent_date: 2017-06-22T13:41:54-07:00
---


It's pretty strange that you are seeing no search latency measurements on node 
5. Are you sure your round robining is working? Are you favoring node 1?

In general, I don't think which node you hit for query should make a 
difference, but I'd have to stare at the code some to be sure. In essence, all 
the node that services the query does is convert the query into a sharded Solr 
query based on a coverage plan, which changes every minute or so, and then runs 
the sharded query on the local Solr node. The Solr node then distributes the 
query to the rest of the nodes in the cluster, but that's all Solr comms -- 
Riak is out of the picture, by then.

Now, if you have a lot of sharded queries accumulating on one node, that might 
make a difference to Solr. I am not a Solr expert, and I don't even play one 
on TV. But maybe the fact that you are not hitting node 5 is relevant for that 
reason?

Can you do more analysis on your client, to make sure you are not favoring node 
1?

-Fred

&gt; On Jun 22, 2017, at 10:20 AM, sean mcevoy  wrote:
&gt; 
&gt; Hi List,
&gt; 
&gt; We have a standard riak cluster with 5 nodes and at the minute the traffic 
&gt; levels are fairly low. Each of our application nodes has 25 client 
&gt; connections, 5 to each riak node which get selected in a round robin.
&gt; 
&gt; Our application level requests involve multiple riak requests so our traffic 
&gt; tends to make requests in small bursts. Everything works fine for KV gets, 
&gt; puts & deletes but we're seeing timeouts & weird response time spikes on solr 
&gt; search operations.
&gt; 
&gt; In the past 36 hours (the only period I have riak stats for) I see one 
&gt; response time of 38.8 seconds, 3 hours earlier a response time of 20.8 
&gt; seconds, and the third biggest spike is an acceptable 3.5 seconds.
&gt; 
&gt; See below all search\_query stats for the minute of the 38 sec sample. In the 
&gt; application request we made 5 riak search requests to the same index in 
&gt; parallel, which happens for each request of this type and normally doesn't 
&gt; have an issue. But in this case all 5 timed out, and one timed out again on 
&gt; retry with the other 4 succeeding.
&gt; 
&gt; Anyone ever seen anything like this before? Is there any known deadlock in 
&gt; solr that I might hit if I make the same request on another connection before 
&gt; the first has completed? This is what we do when our riak client times out 
&gt; after 2 seconds and immediately retries.
&gt; 
&gt; Any advice or pointers welcomed.
&gt; Thanks,
&gt; //Sean.
&gt; 
&gt; 
&gt; Riak node 1
&gt; search\_query\_throughput\_one: 14
&gt; search\_query\_throughput\_count: 259
&gt; search\_query\_latency\_min: 2776
&gt; search\_query\_latency\_median: 69411
&gt; search\_query\_latency\_mean: 4900973
&gt; search\_query\_latency\_max: 38887902
&gt; search\_query\_latency\_999: 38887902
&gt; search\_query\_latency\_99: 38887902
&gt; search\_query\_latency\_95: 2046215
&gt; search\_query\_fail\_one: 0
&gt; search\_query\_fail\_count: 0
&gt; 
&gt; Riak node 2
&gt; search\_query\_throughput\_one: 22
&gt; search\_query\_throughput\_count: 564
&gt; search\_query\_latency\_min: 4006
&gt; search\_query\_latency\_median: 8800
&gt; search\_query\_latency\_mean: 11834
&gt; search\_query\_latency\_max: 25509
&gt; search\_query\_latency\_999: 25509
&gt; search\_query\_latency\_99: 25509
&gt; search\_query\_latency\_95: 24035
&gt; search\_query\_fail\_one: 0
&gt; search\_query\_fail\_count: 0
&gt; 
&gt; Riak node 3
&gt; search\_query\_throughput\_one: 6
&gt; search\_query\_throughput\_count: 298
&gt; search\_query\_latency\_min: 3200
&gt; search\_query\_latency\_median: 15391
&gt; search\_query\_latency\_mean: 18062
&gt; search\_query\_latency\_max: 31759
&gt; search\_query\_latency\_999: 31759
&gt; search\_query\_latency\_99: 31759
&gt; search\_query\_latency\_95: 31759
&gt; search\_query\_fail\_one: 0
&gt; search\_query\_fail\_count: 0
&gt; 
&gt; Riak node 4
&gt; search\_query\_throughput\_one: 8
&gt; search\_query\_throughput\_count: 334
&gt; search\_query\_latency\_min: 2404
&gt; search\_query\_latency\_median: 7230
&gt; search\_query\_latency\_mean: 10211
&gt; search\_query\_latency\_max: 22502
&gt; search\_query\_latency\_999: 22502
&gt; search\_query\_latency\_99: 22502
&gt; search\_query\_latency\_95: 22502
&gt; search\_query\_fail\_one: 0
&gt; search\_query\_fail\_count: 0
&gt; 
&gt; Riak node 5
&gt; search\_query\_throughput\_one: 0
&gt; search\_query\_throughput\_count: 0
&gt; search\_query\_latency\_min: 0
&gt; search\_query\_latency\_median: 0
&gt; search\_query\_latency\_mean: 0
&gt; search\_query\_latency\_max: 0
&gt; search\_query\_latency\_999: 0
&gt; search\_query\_latency\_99: 0
&gt; search\_query\_latency\_95: 0
&gt; search\_query\_fail\_one: 0
&gt; search\_query\_fail\_count: 0
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

