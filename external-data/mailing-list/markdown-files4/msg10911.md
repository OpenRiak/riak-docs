---
title: "Re: Simple mapreduce with 2i returns different result"
description: ""
project: community
lastmod: 2013-04-17T02:20:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10911"
mailinglist_parent_id: "msg10909"
author_name: "OJ Reeves"
project_section: "mailinglistitem"
sent_date: 2013-04-17T02:20:22-07:00
---


Hi guys,

Russell is correct. In CI we gather the responses as they come in, in
whichever order they're received. We make some effort to flatten the
result, but we take the approach of being "smart enough to get you the
results, but no smarter".

We don't do anything to reorder or manage the results in the way that the
HTTP interface does as we feel that's behaviour that the user of the
library should decide to implement should they desire it.

HTH.
OJ



On Wed, Apr 17, 2013 at 5:58 PM, Russell Brown wrote:

&gt;
&gt; On 17 Apr 2013, at 08:54, Mattias Sjölinder  wrote:
&gt;
&gt; &gt; Thanks for your help. Your query returned the same number over and over
&gt; again just as expected.
&gt; &gt;
&gt; &gt; I think I have found the reason for my problem though. The client lib
&gt; CorrugatedIron seems to wrap each document in the MapReduce result into a
&gt; array turning the result into a nested array looking like:
&gt; &gt; [[{doc1}], [{doc2}], [{doc3}]] counting 3 arrays & 3 docs
&gt; &gt; and sometimes
&gt; &gt; [[{doc1}], [{doc2}, {doc3}]] counting 2 arrays and 2 docs (according to
&gt; my client code... :)
&gt; &gt;
&gt; &gt; Why the result for same query in CorrugatedIron and for a simple curl
&gt; differs I don't know but I will investigate it further.
&gt;
&gt; My guess is the client library streams the mapreduce results and gathers
&gt; the separate messages. So depending on how many chunks are sent by riak you
&gt; get a different nested array of responses.
&gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Thanks again for your help!
&gt; &gt;
&gt; &gt; Best regards,
&gt; &gt; Mattias
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; 2013/4/16 Christian Dahlqvist 
&gt; &gt; Hi Mattias,
&gt; &gt;
&gt; &gt; The following curl query simply counts the number of inputs, and has
&gt; worked well for me in the past. Can you please run it against the cluster a
&gt; couple of times and see if it also return varying number of results?
&gt; &gt;
&gt; &gt; curl -XPOST http://localhost:8098/mapred
&gt; &gt; -H 'Content-Type: application/json'
&gt; &gt; -d '{"inputs":{
&gt; &gt; "bucket":"som-bucket",
&gt; &gt; "index":"userid\_bin",
&gt; &gt; "key":"18481123123"
&gt; &gt; },
&gt; &gt; "query":[{"reduce":{"language":"erlang",
&gt; &gt; "module":"riak\_kv\_mapreduce",
&gt; &gt; "function":"reduce\_count\_inputs"
&gt; &gt; }}]}'
&gt; &gt;
&gt; &gt; Best regards,
&gt; &gt;
&gt; &gt; Christian
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On 16 Apr 2013, at 15:52, Mattias Sjölinder 
&gt; wrote:
&gt; &gt;
&gt; &gt;&gt; 18481123123
&gt; &gt;
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 

OJ Reeves
+61 431 952 586
http://buffered.io/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

