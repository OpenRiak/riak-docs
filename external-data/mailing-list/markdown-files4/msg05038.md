---
title: "Re: Have Riak servers in separate cluster behind a load balancer, or	on same machines as web server?"
description: ""
project: community
lastmod: 2011-10-04T16:01:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05038"
mailinglist_parent_id: "msg05035"
author_name: "Mike Oxford"
project_section: "mailinglistitem"
sent_date: 2011-10-04T16:01:33-07:00
---


You'll want to run protobufs if you're looking to optimize your
response time; HTTP sockets (even to localhost) will require much more
overhead and time.
Even better would be unix sockets if they're available, and you can
bypass the whole TCP stack.

I would go A over B. Less thrash, more control, better ACL/security
but it is slightly slower (probably a few ms per request.)
How optimized do you care about? Is an extra 100ms (random number)
too much to give up?

-mox

On Tue, Oct 4, 2011 at 2:04 PM, O'Brien-Strain, Eamonn
 wrote:
&gt; I am contemplating two different architectures for deploying Riak nodes and 
&gt; web servers.
&gt;
&gt; Option A:  Riak nodes are in their own cluster of dedicated machines behind a 
&gt; load balancer.  Web servers talk to the Riak nodes via the load balancer. 
&gt; (See diagram http://eamonn.org/i/riak-arch-A.png )
&gt;
&gt; Option B: Each web server machine also has a Riak node, and there are also 
&gt; some Riak-only machines.  Each web server only talks to its own localhost 
&gt; Riak node. (See diagram http://eamonn.org/i/riak-arch-B.png )
&gt;
&gt;
&gt; All machines will deployed as elastic cloud instances.  I will want to spin 
&gt; up and spin down instances, particularly the web servers, as demand varies.  
&gt; Both load balancers are non-sticky.  Web servers are currently talking to 
&gt; Riak via HTTP (though might change that to protocol buffers in the future).  
&gt; Currently Riak is configured with the default options.
&gt;
&gt; Here is my thinking of the comparative advantages:
&gt;
&gt; Option A:
&gt;
&gt;  - Better for security, because can lock down the Riak load balancer to only 
&gt; open a single port and only for connections from the web servers.
&gt;  - Less churn for Riak of nodes entering and leaving the Riak cluster (as web 
&gt; servers spin up and down)
&gt;  - More flexibility in scaling storage and web tiers independently of each 
&gt; other
&gt;
&gt; Option B:
&gt;
&gt;  - Faster localhost connection from web server to Riak
&gt;
&gt; I think availability is similar for the two options.
&gt;
&gt; The web server response time is the primary metric I want to optimize.  Most 
&gt; web server requests will cause several requests to Riak.
&gt;
&gt; What other factors should I take into account?  What measurements could I 
&gt; make to help me decide between the architectures?  Are there other 
&gt; architectures I should consider? Should I add memcached? Does anyone have any 
&gt; experiences they could share in deploying such systems?
&gt;
&gt; Thanks.
&gt; \_\_
&gt; Eamonn
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

