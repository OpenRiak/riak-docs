---
title: "Re: Strategies for testing against Riak"
description: ""
project: community
lastmod: 2012-09-07T05:03:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08467"
mailinglist_parent_id: "msg08465"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-09-07T05:03:05-07:00
---


If it's only for your test suite, use a local memory-only node via the
Ripple::TestServer. If you configure it correctly (there's a bundled
Rails generator that helps), it will delete all the contents of Riak
in one fell-swoop after or before each test/example.

On Fri, Sep 7, 2012 at 2:49 AM, Brad Heller  wrote:
&gt; Hey all,
&gt;
&gt; So we're rolling out Riak more and more and so far, so good. In fact we're
&gt; starting to accumulate a pretty sizable test suite of our data access layer.
&gt; To support this we've written some code that helps clean out buckets between
&gt; test runs. We're using Ruby (ripple + ruby-risk-client, obviously) so we
&gt; just monkey patch the bucket object and detect if it was used or not.
&gt;
&gt; If it was used during a test, we iterate over all the keys and delete each
&gt; one. We're cognizant of the risks in doing this for large clusters, but in
&gt; our test enviro the number of documents per test is pretty small and the
&gt; operations themselves are quite fast.
&gt;
&gt; The problem we're having, though, is that when we run the full suite (or a
&gt; large subset of the suite) all at once the churn in Riak seems to be so
&gt; quick that sometimes Riak isn't quite in the state that we expect it to be
&gt; in when the test runs! For instance, we have a test that checks that the
&gt; right number of linked documents are created when a given object is saved.
&gt; If we run the test by itself everything works fine--the expectation that 10
&gt; documents are created indeed checks out. If we run this test as part of a
&gt; large suite of tests, the expectation fails and sometimes 11 documents or 12
&gt; documents appear (we check by counting the keys in the linked bucket).
&gt;
&gt; I would think that this has something to do with Riak's eventually
&gt; consistent delete operation, but wanted to tap in to the brain trust: Is
&gt; there any tuning we can do in test to prevent this?
&gt;
&gt; Thanks,
&gt;
&gt; Brad Heller | Engineering Lead | Cloudability.com | 541-231-1514 | Skype:
&gt; brad.heller | @bradhe | @cloudability
&gt;
&gt; We're hiring! http://cloudability.com/jobs
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

