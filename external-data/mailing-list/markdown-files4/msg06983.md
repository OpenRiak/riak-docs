---
title: "Re: riak-python-client2, a rewrite of the official client"
description: ""
project: community
lastmod: 2012-03-16T11:14:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06983"
mailinglist_parent_id: "msg06970"
author_name: "Greg Stein"
project_section: "mailinglistitem"
sent_date: 2012-03-16T11:14:02-07:00
---


On Thu, Mar 15, 2012 at 14:08, Armon Dadgar  wrote:
&gt;&gt; Message: 4
&gt;&gt; Date: Thu, 15 Mar 2012 11:13:03 -0400
&gt;&gt; From: Shuhao Wu 
&gt;&gt; To: "Andrey V. Martyanov" 
&gt;&gt; Cc: riak-users@lists.basho.com
&gt;&gt; Subject: Re: riak-python-client2, a rewrite of the official client
&gt;&gt; Message-ID:
&gt;&gt;       
&gt;&gt; Content-Type: text/plain; charset=ISO-8859-1
&gt;&gt;
&gt;&gt; I'm looked into just modifying and contributing to the existing library, and
&gt;&gt; found several issues with it. Here's my main motivation for a rewrite:
&gt;&gt;
&gt;&gt; ? 1. The current structure riak-python-client is somewhat messy. Everything
&gt;&gt;     depends on each other. Just look at things like RiakLink and
&gt;&gt; RiakIndexEntry.
&gt;&gt;     They're unnecessary and overcomplicates the code. Furthermore, if you 
&gt;&gt; look
&gt;&gt;     the transports, it's very much dependent on things like RiakObject, and
&gt;&gt;     RiakObject is pretty much nothing without the transport. It's almost 
&gt;&gt; like a
&gt;&gt;     circular dependency. So instead, I redesigned the transports to operate
&gt;&gt;     independently from things like RiakObject. To do this, simply modifying
&gt;&gt;     is not feasible and it will result in an almost complete rewrite anyway 
&gt;&gt; due
&gt;&gt;     to the dependencies problems I described.
&gt;&gt;  2. There's a lot of "bloat" in the current riak-python-client. A simple
&gt;&gt;     example would be get\_ and set\_, as well as things like RiakLink and
&gt;&gt;     RiakIndexEntry. To get rid of those would pretty much require a rewrite 
&gt;&gt; as
&gt;&gt;     well.
&gt;&gt;  3. Basho currently do not have a dedicated python developer working on this.
&gt;&gt;     I don't know this for sure but I think their resources, in terms
&gt;&gt; of clients,
&gt;&gt;     go mainly to java, ruby and javascript, though that's just my 
&gt;&gt; observations.
&gt;&gt;
&gt;&gt; My primary goal of having a rewrite is hopefully simplify the code base as 
&gt;&gt; well
&gt;&gt; as improve some aspects of the python client (such as not using deprecated
&gt;&gt; functions such as apply) and (hopefully) increase the speed of the client.
&gt;&gt; After examining the code (which I had to do while rewriting), I don't think
&gt;&gt; simply modifying the current codebase could fix its issues (there are more
&gt;&gt; issues then what I've stated), and I don't think it will take as long as 
&gt;&gt; people
&gt;&gt; think. The current code base has about 4k lines of python and 0.5k lines of
&gt;&gt; Erlang. In my client, a chunk of the code actually comes from the original
&gt;&gt; client as they work with a few adaptations.
&gt;&gt;
&gt;&gt; As far as road map goes, I'm currently just rewriting all the functionalities
&gt;&gt; provided by the current python client, and here's a list of things that Sean
&gt;&gt; would like to see accomplished, which I will work on once I have all the
&gt;&gt; functionalities of the current client complete:
&gt;&gt;
&gt;&gt;    https://gist.github.com/1959278
&gt;&gt;
&gt;&gt; I hope I've answered all the questions. If there is any more 
&gt;&gt; questions/comments,
&gt;&gt; feel free to shoot it my way.
&gt;&gt;
&gt;&gt; Shuhao
&gt;&gt;
&gt;
&gt; I agree that the Python client does need some work to clean it up,
&gt; and make it more idiomatic Python, but I'm not sure that a total rewrite
&gt; is necessary.
&gt;
&gt; Most of the abstractions are good, but they just need a bit of cleanup.
&gt; I think there is always a tendency to assume things are unnecessarily messy,
&gt; but once you get to rewriting it you end up running into the pain points that
&gt; drove those design decisions.
&gt;
&gt; If there is interest, we could just formulate a roadmap for the a set of 
&gt; breaking
&gt; changes to the existing client, and release it as a new version of the same 
&gt; project.
&gt;
&gt; Things I would like to see:
&gt;  \* Cleanup the transport interface
&gt;  \* RiakObject needs to be simplified
&gt;  \* Support a RiakJSONObject subclass which has the encoding logic that is 
&gt; inside RiakObject now
&gt;  \* Indexes need to be cleaned up
&gt;  \* MapReduce interfaces feel a bit dirty
&gt;  \* Much improved exception hierarchy
&gt;  \* RiakClient / RiakBucket interface needs to cleaned up

Right. Evolution of a client that everybody uses.

It isn't like Basho is refusing to accept pull requests from the
community. If they were a total black hole, then there may be an
argument for forking the project and evolving it. But that would at
least be from a fork. I don't see a valid argument for
start-from-scratch.

Yet that isn't the case. Basho's responsiveness on the Python client
might not be "awesome", but they \*are\* willing to engage. I met up
with them last fall, have exchanged numerous emails with them, and
even had a conference call about the Python client. Not to mention all
the discussion and the pull requests that I provided, which got
merged. They \*are\* working with the community.

In my experience, communities exist to develop/maintain/focus on a
code base. Multiple/competing codebases end up fracturing the
community. That rarely leads to a long-term, sustainable, healthy
outcome.

Cheers,
-g

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

