---
title: "RE: Escape characters in MapReduce?"
description: ""
project: community
lastmod: 2013-02-10T17:19:00-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10084"
mailinglist_parent_id: "msg10083"
author_name: "Kevin Burton"
project_section: "mailinglistitem"
sent_date: 2013-02-10T17:19:00-08:00
---


This is just like the canonical ‘word count’ MapReduce’ I just want to count 
the number of departments in the bucket. The ‘!=’ is to skip the values of 
Department that are the empty string.

 

From: Alexander Sicular [mailto:sicul...@gmail.com] 
Sent: Sunday, February 10, 2013 7:14 PM
To: Kevin Burton
Cc: 
Subject: Re: Escape characters in MapReduce?

 

What is p.Department not supposed to equal?





@siculars

http://siculars.posterous.com

 

Sent from my iRotaryPhone


On Feb 10, 2013, at 18:36, "Kevin Burton"  wrote:

I have a query that is made from a CorrugatedIron client that looks like:

 

 IRiakClient riakClient = cluster.CreateClient();

 var query = new RiakMapReduceQuery()

 .Inputs(productBucketName)

 .MapJs(m =&gt; m.Source(@"function(v,d,a) {" +

 "var p = JSON.parse(v.values[0].data);" + 

 "var r = [];" +

 "if(p.Department != '') {" +

 "var o = {};" +

 "o[p.Department] = 1;" +

 "r.push(o);" +

 "}" +

 "return r;" +

 "}"))

 .ReduceJs(m =&gt; m.Source(@"function(v,d,a) {" +

 "var r = {};" +

 "for(var i in v) {" +

 " for(var w in v[i]) {" +

 " if(w in r) r[w] += v[i][w];" +

 " else r[w] = v[i][w];" +

 " }" +

 "}" +

 "return [r];" +

 "}")

 .Keep(true));

 

This query returns the error:

 

Query failed with Riak returned an error. Code '0'. Message: 
{"phase":"listkeys","error":"{badmatch,{'EXIT',timeout}}","input":"{cover,[],&lt;&lt;\"buyseasons-products\"&gt;&gt;}","type":"error","stack":"[{riak\_core\_vnode\_proxy,call,2,[{file,\"src/riak\_core\_vnode\_proxy.erl\"},{line,52}]},{riak\_pipe\_vnode,queue\_work\_send,4,[{file,\"src/riak\_pipe\_vnode.erl\"},{line,331}]},{riak\_pipe\_vnode,queue\_work\_erracc,6,[{file,\"src/riak\_pipe\_vnode.erl\"},{line,279}]},{riak\_kv\_pipe\_listkeys,keysend,4,[{file,\"src/riak\_kv\_pipe\_listkeys.erl\"},{line,112}]},{riak\_kv\_pipe\_listkeys,keysend\_loop,3,[{file,\"src/riak\_kv\_pipe\_listkeys.erl\"},{line,89}]},{riak\_kv\_pipe\_listkeys,process,3,[{file,\"src/riak\_kv\_pipe\_listkeys.erl\"},...]},...]"}
 - CommunicationError

 

I can read the error and it is a “badmatch” but the rest of the details I don’t 
know how to use. The purpose of these query is to count all of the different 
Departments in the database. I was wondering if this requires that the 
Department name be escaped somehow. One of the department names is ‘Accessories 
& Makeup’, ‘Decorations & Props’, or ‘Hats, Wigs & Masks’. Does the ‘&’ need 
to be escaped when putting it into the database (this string is a property that 
is part of the object that is JSON serialized)? Anything else? If it needs to 
be escaped and I am using this value as a secondary index should I set the 
index before or after the escape is done? Could this be the source of a 
“badmatch”?

 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

