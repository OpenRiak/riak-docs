---
title: "Re: Facing java.net broken pipe issue while benchmarking	java-PBClient with YCSB"
description: ""
project: community
lastmod: 2011-08-11T03:20:57-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04343"
mailinglist_parent_id: "msg04184"
author_name: "vijayakumar"
project_section: "mailinglistitem"
sent_date: 2011-08-11T03:20:57-07:00
---


Hi Russell,
 I was trying with REST API port (8098) instead of PB client port. Now I
am able to get it working.

Regards,
Vijayakumar.


On Wed, Aug 3, 2011 at 2:12 AM, Russell Brown-2 [via Riak Users] &lt;
ml-node+3220159-944807713-419...@n3.nabble.com&gt; wrote:

&gt; Hi,
&gt; A couple of preliminary questions: What version of riak-java-client and
&gt; what version of Riak are you using?
&gt;
&gt; Also, your cut and paste has come out a little garbled, could you maybe
&gt; paste it into a github gist or a paste bin so I can get a better read of the
&gt; code, please?
&gt;
&gt; Also, do you have the riak log? Is there anything in that for the same
&gt; call?
&gt;
&gt; Do you get the error consistently or is this as part of a load
&gt; test/benchmark and it occurs under a certain load?
&gt;
&gt; I've never used YCSB so I'll have a look into that, also.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt; On 2 Aug 2011, at 20:20, vijayakumar wrote:
&gt;
&gt; &gt; I am trying to benchmark riak client with YCSB and I am getting the
&gt; following
&gt; &gt; exception while
&gt; &gt; trying to fetch from riak client. Am I missing any tunable parameters in
&gt; &gt; server or client settings?
&gt; &gt;
&gt; &gt; Code snippet (method implementation for YCSB-DB):
&gt; &gt;
&gt; &gt; public int read(String table, String key, Set fields,
&gt; &gt; HashMap&lt;String, String&gt; result) {
&gt; &gt; ObjectInputStream ois = null;
&gt; &gt; int status = Error;
&gt; &gt; try {
&gt; &gt; RiakObject[] riakObjects = \*riakclient.fetch(table, key,1)\*;
&gt; &gt; ois = new ObjectInputStream(new
&gt; &gt; ByteArrayInputStream(riakObjects[0].getValue().toByteArray()));
&gt; &gt; HashMap&lt;String, String&gt; values = (HashMap&lt;String,
&gt; &gt; String&gt;) ois.readObject();
&gt; &gt; result.putAll(values);
&gt; &gt; status = Ok;
&gt; &gt; } catch (IOException e) {
&gt; &gt; e.printStackTrace(System.out);
&gt; &gt; return status;
&gt; &gt; } catch (ClassNotFoundException e) {
&gt; &gt; e.printStackTrace(System.out);
&gt; &gt; return status;
&gt; &gt; } finally{
&gt; &gt; if(ois!=null){
&gt; &gt; try{
&gt; &gt; ois.close();
&gt; &gt; }catch(Exception excep){
&gt; &gt; excep.printStackTrace();
&gt; &gt; }
&gt; &gt; }
&gt; &gt; }
&gt; &gt; return status;
&gt; &gt; }
&gt; &gt;
&gt; &gt; Exception thrown while running YCSB setup:
&gt; &gt;
&gt; &gt; java.net.SocketException: Broken pipe
&gt; &gt; at java.net.SocketOutputStream.socketWrite0(Native Method)
&gt; &gt; at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
&gt; &gt; at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
&gt; &gt; at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
&gt;
&gt; &gt; at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
&gt; &gt; at java.io.DataOutputStream.flush(DataOutputStream.java:106)
&gt; &gt; at com.basho.riak.pbc.RiakConnection.send(RiakConnection.java:68)
&gt; &gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:221)
&gt; &gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:210)
&gt; &gt; at com.yahoo.ycsb.db.riak.RiakPBClient.read(RiakPBClient.java:63)
&gt; &gt; at com.yahoo.ycsb.DBWrapper.read(DBWrapper.java:87)
&gt; &gt; at
&gt; &gt;
&gt; com.apigee.kms.RequestTokenWorkLoad.doTransactionRead(RequestTokenWorkLoad.java:81)
&gt;
&gt; &gt; at
&gt; &gt;
&gt; com.yahoo.ycsb.workloads.CoreWorkload.doTransaction(CoreWorkload.java:372)
&gt; &gt; at com.yahoo.ycsb.ClientThread.run(Client.java:235)
&gt; &gt; java.io.EOFException
&gt; &gt; at java.io.DataInputStream.readFully(DataInputStream.java:180)
&gt; &gt; at java.io.DataInputStream.readFully(DataInputStream.java:152)
&gt; &gt; at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:89)
&gt; &gt; at com.basho.riak.pbc.RiakClient.process\_fetch\_reply(RiakClient.java:251)
&gt;
&gt; &gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:222)
&gt; &gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:210)
&gt; &gt; at com.yahoo.ycsb.db.riak.RiakPBClient.read(RiakPBClient.java:63)
&gt; &gt; at com.yahoo.ycsb.DBWrapper.read(DBWrapper.java:87)
&gt; &gt; at
&gt; &gt;
&gt; com.apigee.kms.RequestTokenWorkLoad.doTransactionRead(RequestTokenWorkLoad.java:81)
&gt;
&gt; &gt; at
&gt; &gt;
&gt; com.yahoo.ycsb.workloads.CoreWorkload.doTransaction(CoreWorkload.java:372)
&gt; &gt; at com.yahoo.ycsb.ClientThread.run(Client.java:235)
&gt; &gt;
&gt; &gt; --
&gt; &gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/Facing-java-net-broken-pipe-issue-while-benchmarking-java-PBClient-with-YCSB-tp3219935p3219935.html
&gt; &gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; [hidden email] 
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; [hidden email] 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; ------------------------------
&gt; If you reply to this email, your message will be added to the discussion
&gt; below:
&gt;
&gt; http://riak-users.197444.n3.nabble.com/Facing-java-net-broken-pipe-issue-while-benchmarking-java-PBClient-with-YCSB-tp3219935p3220159.html
&gt; To unsubscribe from Facing java.net broken pipe issue while benchmarking
&gt; java-PBClient with YCSB, click 
&gt; here.
&gt;
&gt;


--
View this message in context: 
http://riak-users.197444.n3.nabble.com/Facing-java-net-broken-pipe-issue-while-benchmarking-java-PBClient-with-YCSB-tp3219935p3245485.html
Sent from the Riak Users mailing list archive at Nabble.com.\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

