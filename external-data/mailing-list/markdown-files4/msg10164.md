---
title: "Re: 2i: url encoding/decoding of index names/values"
description: ""
project: community
lastmod: 2013-02-21T01:53:47-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10164"
mailinglist_parent_id: "msg10159"
author_name: "Age Mooij"
project_section: "mailinglistitem"
sent_date: 2013-02-21T01:53:47-08:00
---


Yeah, in attempt number two the index names and values have been url encoded 
when creating the relevant HTTP headers and when doing the index fetch the 
index name and value are again encoded. 

What is probably happening is that Riak will decode the incoming fetch url and 
then use the decoded values to match against indexes internally (since the 
http\_url\_encoding setting will be set to "on" for most people). Since those 
indexes themselves have been encoded, they won't match.

Approach number 3), double encoding the index name and value when constructing 
the fetch URL, works in all cases but seems a bit overkill. 

If nothing better comes along I guess I'll go with number 3)

Thanks,
Age


On Feb 20, 2013, at 22:19, Dmitri Zagidulin  wrote:

&gt; Question about 2) -- are you also encoding the index names and values when 
&gt; issuing the fetch? (Maybe post some example code or Riak object header 
&gt; snippets, and examples of the fetch queries, that might help).
&gt; 
&gt; On Wed, Feb 20, 2013 at 3:56 PM, Age Mooij  wrote:
&gt; Hi all,
&gt; 
&gt; I'm writing a new Scala (http) client library for Riak [1] and I ran into 
&gt; some trouble with special characters while implementing 2i. 
&gt; 
&gt; Reading through the docs, all the 2i examples are for simple one-word index 
&gt; names but I have not been able to find any rules about index names and values 
&gt; containing spaces, commas, and other special characters and how the HTTP api 
&gt; deals with encoding and decoding these?
&gt; 
&gt; My unit tests use the following troublesome corner cases:
&gt; 
&gt; - index values containing spaces
&gt; - index names containing spaces
&gt; - index values containing commas
&gt; 
&gt; I tried a number of approaches and none of them work for all three:
&gt; 
&gt; 1) Don't encode the index names or the values when creating "x-riak-index-" 
&gt; http headers but encode both the name and the value in the URL used to fetch 
&gt; by an index
&gt; 
&gt; This works fine for values containing spaces but creates illegal headers for 
&gt; index names containing spaces and breaks for values containing commas (the 
&gt; values get split into two).
&gt; 
&gt; 2) Encode everything
&gt; 
&gt; This creates valid headers and storing index values containing commas now 
&gt; works fine. The only trouble is that index fetching fails whenever there are 
&gt; spaces, commas or other encoded characters involved.
&gt; 
&gt; Could anyone enlighten me about the correct way to deal with these cases?
&gt; 
&gt; Regards,
&gt; Age
&gt; 
&gt; 
&gt; [1] https://github.com/agemooij/riak-scala-client
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

