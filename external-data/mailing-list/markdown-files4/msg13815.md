---
title: "Re: Question about link-walk results returned by erlang_pb_client"
description: ""
project: community
lastmod: 2014-03-16T07:24:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13815"
mailinglist_parent_id: "msg13809"
author_name: "fxmy wang"
project_section: "mailinglistitem"
sent_date: 2014-03-16T07:24:03-07:00
---


Hi Alex,

Thank you for the clarify( and the warning :) ).

Just out of curiosity, by using erlang\_pb\_client, is there a good way
to retrieve \*all\* the Objects that have been walked in on shot( like
the HTTP interface does)?

And if there's not, then how is the HTTP map-reduce implemented so
that it can return all the Objects alone the way?

Best Regards :)
fxmy

2014-03-15 0:30 GMT+08:00 Alex Moore :
&gt; Hi fxmy,
&gt;
&gt; The return value is just Bucket/Key/link-tag pairs, without ObjectValue or
&gt; other metadata.
&gt;&gt;
&gt;&gt; {ok,[{0,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"timoreilly"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]},
&gt;&gt;
&gt;&gt; {1,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"dhh"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]}]}
&gt;
&gt;
&gt; Is this intended or not?
&gt;
&gt;
&gt; This is intended. You are running a map reduce job with one "link" stage,
&gt; which does the link walking for you.
&gt; Link stages only return a list of key/value/relation tuples.
&gt;
&gt; If so, what's the best way to get these ObjectValues through one single pass
&gt; of link-walking?
&gt;
&gt;
&gt; If you want to grab everything in one shot you would have to feed the link
&gt; stage's output into a map stage to grab the actual objects:
&gt;
&gt; {ok, RiakObj} = riakc\_pb\_socket:mapred(Pid,[{&lt;&lt;"people"&gt;&gt;,
&gt; &lt;&lt;"timoreilly"&gt;&gt;}],
&gt; [{link, &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;, false},
&gt; {link, &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;, false},
&gt; {map, {modfun, riak\_kv\_mapreduce, map\_identity}, none, true}]).
&gt;
&gt; This should give you the entire object for the results of the last link
&gt; phase, namely Dave Thomas's.
&gt;
&gt; I should warn you thought that while link walking and map reduce let you do
&gt; things like this in one shot, you should be cautious about using them in
&gt; production since a bad query can kill performance.
&gt;
&gt; Thanks,
&gt; Alex
&gt;
&gt; On Mar 14, 2014, at 6:49 AM, fxmy wang  wrote:
&gt;
&gt;
&gt; Hi, list,
&gt;
&gt; This should be a trivial question and I think I'm definitely missing
&gt; something( and feeling stupid :\).
&gt;
&gt; So when I am doing a chained link-walking through HTTP interface like
&gt; this(copied from link walking docs):
&gt;&gt;
&gt;&gt; curl -v localhost:8091/riak/people/davethomas/\_,friend,1/\_,friend,\_/
&gt;
&gt;
&gt; The output is quite verbose, including Bucket/Key/Value etc.etc.
&gt;&gt;
&gt;&gt; --JCgqdOHsL4BdXPCb0cuQDnLTxOH
&gt;&gt;
&gt;&gt; Content-Type: multipart/mixed; boundary=LpfqXc9urbAJJNFH7aGGPBiAtnX
&gt;&gt;
&gt;&gt;
&gt;&gt; --LpfqXc9urbAJJNFH7aGGPBiAtnX
&gt;&gt;
&gt;&gt; X-Riak-Vclock: a85hYGBgzGDKBVIcc+04TgWFOj/NYEpkzGNlyNCadoYvCwA=
&gt;&gt;
&gt;&gt; Location: /riak/people/timoreilly
&gt;&gt;
&gt;&gt; Content-Type: text/plain
&gt;&gt;
&gt;&gt; Link: ; riaktag="friend", ; rel="up"
&gt;&gt;
&gt;&gt; Etag: 3DmGNeyDj2hUlLR2UhJvMr
&gt;&gt;
&gt;&gt; Last-Modified: Thu, 13 Mar 2014 13:11:04 GMT
&gt;&gt;
&gt;&gt;
&gt;&gt; I am an excellent public speaker.
&gt;&gt;
&gt;&gt; --LpfqXc9urbAJJNFH7aGGPBiAtnX--
&gt;&gt;
&gt;&gt;
&gt;&gt; --JCgqdOHsL4BdXPCb0cuQDnLTxOH
&gt;&gt;
&gt;&gt; Content-Type: multipart/mixed; boundary=IcBLyeIFObvJlJGyXuhTty5cRSs
&gt;&gt;
&gt;&gt;
&gt;&gt; --IcBLyeIFObvJlJGyXuhTty5cRSs
&gt;&gt;
&gt;&gt; X-Riak-Vclock: a85hYGBgzGDKBVIcR4M2cgeFOkdkMCUy5rEyzNSadoYvCwA=
&gt;&gt;
&gt;&gt; Location: /riak/people/dhh
&gt;&gt;
&gt;&gt; Content-Type: text/plain
&gt;&gt;
&gt;&gt; Link: ; rel="up"
&gt;&gt;
&gt;&gt; Etag: 4qbA2ZufXNgzFRb8PlSLUO
&gt;&gt;
&gt;&gt; Last-Modified: Thu, 13 Mar 2014 13:11:53 GMT
&gt;&gt;
&gt;&gt;
&gt;&gt; I drive a Zonda.
&gt;&gt;
&gt;&gt; --IcBLyeIFObvJlJGyXuhTty5cRSs--
&gt;&gt;
&gt;&gt;
&gt;&gt; --JCgqdOHsL4BdXPCb0cuQDnLTxOH--
&gt;
&gt;
&gt;
&gt; But when I retried it through the erlang\_pb\_client
&gt;&gt;
&gt;&gt; riakc\_pb\_socket:mapred(Pid,[{&lt;&lt;"people"&gt;&gt;, &lt;&lt;"davethomas"&gt;&gt;}],[{link,
&gt;&gt; &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;, true},{link, &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;,
&gt;&gt; true}]).
&gt;
&gt;
&gt; The return value is just Bucket/Key/link-tag pairs, without ObjectValue or
&gt; other metadata.
&gt;&gt;
&gt;&gt; {ok,[{0,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"timoreilly"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]},
&gt;&gt;
&gt;&gt; {1,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"dhh"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]}]}
&gt;
&gt;
&gt; Is this intended or not?
&gt; If so, what's the best way to get these ObjectValues through one single pass
&gt; of link-walking?
&gt;
&gt;
&gt; Cheers,
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

