---
title: "Re: Proper data filtration and pagination"
description: ""
project: community
lastmod: 2014-01-15T06:02:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13387"
mailinglist_parent_id: "msg13383"
author_name: "Anton Yakushin"
project_section: "mailinglistitem"
sent_date: 2014-01-15T06:02:19-08:00
---


Eric,

Seems yokozuna is what I looked for.
The only problem is our project is already in production.
Are there any other ways like additional buckets serving as indexes or
something built-in to achieve similar functionality?
Is there a way in Riak to get values for several known keys without using
MapReduce?

Many thanks for your quick response!

Best regards,
Anton


On Mon, Jan 13, 2014 at 7:39 PM, Eric Redmond  wrote:

&gt; Anton,
&gt;
&gt; Depending on how soon you plan to be in production, this sounds like a
&gt; good usecase for yokozuna (the new Riak Search) coming in 2.0 (sometime in
&gt; Q1). It has builtin support for handling semistructured data like JSON or
&gt; XML, nested even, and will allow you to query by multiple fields at once.
&gt; The most recent version also has excellent pagination support.
&gt;
&gt; To toy with it right now, you can find more information on
&gt; https://github.com/basho/yokozuna
&gt;
&gt; Eric
&gt;
&gt;
&gt; On Jan 13, 2014, at 5:46 AM, Anton Yakushin 
&gt; wrote:
&gt;
&gt; Hi,
&gt;
&gt; Could anyone advice on how to properly organize data structure so
&gt; it could be efficiently filtered and results paginated?
&gt;
&gt; A structure example from our current system.
&gt; We have products stored in the following JSON:
&gt; {
&gt; "name": 
&gt; "category": {
&gt; "key" : ,
&gt; "name": 
&gt; },
&gt; "sub\_categories": [
&gt; {
&gt; "key" : ,
&gt; "name": 
&gt; }
&gt; ],
&gt; ... lots of other attributes: strings, arrays, objects.
&gt; }
&gt;
&gt; What we need is be able to fetch filtered by their attributes
&gt; products with paginated results.
&gt;
&gt; What we have tried:
&gt; 1. Implemented filtration using key filters. So currently product
&gt; keys look like: "-c:-sc:..."
&gt; Disadvantages were that the keys could possibly change and they
&gt; had quite a large length. Also it was hard to add a new attribute to a key.
&gt;
&gt; 2. MapReduce was used to filter by all attributes that were not in
&gt; product keys. Also results from key filters were passed through
&gt; MapReduce to decrease amount of requests.
&gt;
&gt; 3. SecondaryIndexes were used for some attributes. But it's very
&gt; inconvenient that one can't filter by several indexes at a time.
&gt;
&gt; 4. At the first moment seemed that Riak Search could solve all these
&gt; problems, but it transforms product objects into a flat structure
&gt; making them hardly usable. Case with Search + MapReduce was too slow
&gt; and didn't allow to paginate data.
&gt;
&gt; 5. Pagination with MapReduce was too slow and put exceptional load
&gt; on our servers.
&gt;
&gt; So the issue which holds our system from growing and feature
&gt; increasing is how should the data be re-organized to make them easily and
&gt; efficiently
&gt; filtered with pagination?
&gt;
&gt; Would highly appreciate any suggestions. It's really a big issue now
&gt; so we even think about switching to another database (e.g. MongoDB) if
&gt; we would not find a suitable solution in Riak.
&gt;
&gt; Best regards,
&gt; Anton
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

