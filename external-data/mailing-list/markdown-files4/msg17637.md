---
title: "Re: Riak KV memory backend did't discarding oldest objects when met	max memory"
description: ""
project: community
lastmod: 2016-09-12T21:56:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17637"
mailinglist_parent_id: "msg17619"
author_name: "周磊"
project_section: "mailinglistitem"
sent_date: 2016-09-12T21:56:07-07:00
---


Dear friends,

Any idea about this?

Best Regards & Thanks

John

2016-09-01 11:58 GMT+08:00 周磊 :

&gt; Dear Friends,
&gt; I'm sorry to disturb you, could you help on this?
&gt;
&gt; ENV
&gt;
&gt; OS: CenterOS 6.5
&gt; Riak KV:2.1.4
&gt; Installed by:
&gt;
&gt; wget http://s3.amazonaws.com/downloads.basho.com/riak/2.1/
&gt; 2.1.4/rhel/6/riak-2.1.4-1.el6.x86\_64.rpm
&gt; sudo rpm -Uvh riak-2.1.4-1.el6.x86\_64.rpm
&gt;
&gt; My Setting:
&gt;
&gt; storage\_backend = multi
&gt; multi\_backend.bitcask\_multi.storage\_backend = bitcask
&gt; multi\_backend.bitcask\_multi.bitcask.data\_root = /var/lib/riak/bitcask\_mult
&gt; multi\_backend.memory\_multi.storage\_backend = memory
&gt; multi\_backend.memory\_multi.memory\_backend.max\_memory\_per\_vnode = 2MB
&gt; multi\_backend.default = memory\_multi
&gt;
&gt; Document
&gt;
&gt; http://docs.basho.com/riak/kv/2.1.4/setup/planning/backend/memory/
&gt; 
&gt;
&gt; When the threshold value that you set has been met in a particular vnode, Riak
&gt; will begin discarding objects, beginning with the \*oldest\* object and
&gt; proceeding until memory usage returns below the allowable threshold.
&gt; You can configure maximum memory using the memory\_backend.max\_memory\_per\_vnode
&gt; setting. You can specify max\_memory\_per\_vnode however you’d like, using
&gt; kilobytes, megabytes, or even gigabytes.
&gt;
&gt; Setps
&gt;
&gt; 1.Use sh to Loop POST [512kb] files (0.ts,index.m3u8,1.ts,index.
&gt; m3u8,2.ts,index.m3u8........)
&gt; 2.When meet the max memory 2 MB, some object discarded but not beginning
&gt; with the oldest object(index.m3u8 discarded)
&gt; curl.sh.txt 
&gt;
&gt; http://10.20.122.45:8098/buckets/test/keys?keys=true
&gt;
&gt; {"keys":["217.ts","212.ts","203.ts","210.ts","173.ts","
&gt; 166.ts","200.ts","199.ts","192.ts","215.ts","129.ts","
&gt; 124.ts","208.ts","179.ts","198.ts","196.ts","185.ts","97.
&gt; ts","219.ts","114.ts","201.ts","190.ts","165.ts","223.ts","
&gt; 220.ts","214.ts","222.ts","211.ts","209.ts","213.ts","
&gt; 183.ts","143.ts","205.ts","171.ts","139.ts","66.ts","142.
&gt; ts","122.ts","216.ts","170.ts","162.ts","194.ts","119.ts","
&gt; 105.ts","178.ts","160.ts","158.ts","221.ts","193.ts","
&gt; 187.ts","197.ts","159.ts","155.ts","218.ts","207.ts","
&gt; 184.ts","188.ts","181.ts","176.ts","206.ts","202.ts","195.ts"]}
&gt;
&gt;
&gt;
&gt; Best Regards & Thanks
&gt;
&gt; John
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

