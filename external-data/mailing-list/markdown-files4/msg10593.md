---
title: "Re: Getting multiple values: is iterating or MapReduce preferred?"
description: ""
project: community
lastmod: 2013-03-25T17:43:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10593"
mailinglist_parent_id: "msg10592"
author_name: "Matt Black"
project_section: "mailinglistitem"
sent_date: 2013-03-25T17:43:11-07:00
---


This is very interesting.

I've just been testing a multi-phase map reduce job which was intended to
replace some code where we look up several objects sequentially after a
small map-reduce job. Sounds like the current application code is the right
way to do it..


On 26 March 2013 11:14, John Caprice  wrote:

&gt; Rob,
&gt;
&gt; Performing GET requests either serially or concurrently is more efficient
&gt; than using MapReduce to query for values. MapReduce has additional
&gt; overhead that GET requests do not have. One example of this is that a GET
&gt; is sent to only the nodes in the prefs list for a given key, while a
&gt; MapReduce query is sent to all nodes.
&gt;
&gt; There are appropriate uses of MapReduce. Using MapReduce in a controlled
&gt; manner outside of your peak production hours can minimize performance
&gt; effects. For example, using MapReduce nightly to
&gt; perform maintenance, build reports etc. It is important to ensure that
&gt; MapReduce queries remain bounded. Replacing serial / concurrent GETs in
&gt; your application with MapReduce queries provides the opportunity for
&gt; unbounded use, which can have severe performance consequences.
&gt;
&gt; Making separate requests, either serially or concurrently, is the optimal
&gt; way to query data in Riak. To an application developer, this might not
&gt; look as elegant however it is much more efficient for Riak.
&gt;
&gt; Thanks,
&gt;
&gt; John
&gt;
&gt;
&gt; On Mon, Mar 25, 2013 at 3:07 PM, Rob Speer  wrote:
&gt;
&gt;&gt; I've looked at the archives of this mailing list to find a way to
&gt;&gt; implement a "multi-get" using Riak, for the very common case where there
&gt;&gt; are multiple keys to look up. Making a separate round-trip to the server
&gt;&gt; for each key seems inefficient, after all.
&gt;&gt;
&gt;&gt; I came across the suggestion to use MapReduce, so I tried implementing it
&gt;&gt; this way (using riak-python-client):
&gt;&gt;
&gt;&gt; def multi\_get(self, bucket\_name, ids):
&gt;&gt; if len(ids) == 0:
&gt;&gt; return []
&gt;&gt; mr = RiakMapReduce(self.riak)
&gt;&gt; for uid in ids:
&gt;&gt; mr.add(bucket\_name, uid)
&gt;&gt; query = mr.map\_values\_json()
&gt;&gt; return query.run()
&gt;&gt;
&gt;&gt; After this I noticed significant load on the Riak servers, and the client
&gt;&gt; code would sometimes stall for a long time, even on a multi\_get that was
&gt;&gt; only returning 6 documents. Is this actually an inappropriate use of
&gt;&gt; MapReduce? (And are there appropriate uses of MapReduce in NoSQL databases
&gt;&gt; besides stress-testing them?)
&gt;&gt;
&gt;&gt; Is it better to make a separate request for each ID, to use MapReduce, or
&gt;&gt; to use some other method I haven't thought of?
&gt;&gt; -- Rob
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

