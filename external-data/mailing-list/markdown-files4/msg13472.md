---
title: "Re: Split index with Riak 2.0 git (jan 15th) on a single dev node	cluster"
description: ""
project: community
lastmod: 2014-01-23T15:08:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13472"
mailinglist_parent_id: "msg13471"
author_name: "Eric Redmond"
project_section: "mailinglistitem"
sent_date: 2014-01-23T15:08:20-08:00
---


Rob,

The one second wait is because yokozuna is the glue code (putting it very, very 
simply) between a Riak cluster and distributed Solr instances. When you write 
an object to Riak, yokozuna asynchronously fires off an update to the Solr 
service. Solr is, by default, configured to soft commit writes every 1 second, 
and hard commit every 30 seconds[1]. These values are set in the Solr 
configuration, based on suggested best practiced. You can configure solr.xml to 
reduce that delay, but the payoff isn't generally worth the overhead.

The benefit of an asynchronous index update is that you get the predictable 
performance of Riak, with an eventually consistent searchable index. The 
alternative is to lock a Riak put/delete while Solr updates, which means you'll 
wait up to a second for confirmation for a simple write. We may eventually add 
such back pressure, but it's barely on our radar, since at the moment, atomic 
object/index updating is not of practical concern to most Riak users. If you 
have a specific requirement for such back pressure, please let us know and we 
may have some ideas for you.

Another benefit to separating the write from indexing is that it allows us to 
leverage an index-specific AAE service. This means that if your dataset and 
index ever get out of sync, or your index corrupted, the index AAE can repair 
the discrepancy. If you've ever run Solr or Elastic Search against another 
datastore, you'll be familiar with having to repair indexes on occasion 
(whether by a server going down, other system errors, bit rot, etc). With Riak 
Search (yokozuna) this is handled automatically for you.

Hope that helps,
Eric

http://wiki.apache.org/solr/NearRealtimeSearch


On Jan 23, 2014, at 5:41 PM, Rob Speer  wrote:

&gt; I'm still interested in the question as it applies to Yokozuna. Stable 
&gt; full-text search in Riak will be very important to my company, so I'd want to 
&gt; know what the equivalent behaviors are for Yokozuna queries. Do you have to 
&gt; wait an unspecified amount of time between writing a document and querying it 
&gt; via Yokozuna? Is there a way to know when it is ready?
&gt; 
&gt; 
&gt; On Thu, Jan 23, 2014 at 10:53 AM, Luke Bakken  wrote:
&gt; Hi Rob,
&gt; 
&gt; I believe Ryan meant to wait a second to do a Yokozuna search, not a
&gt; general Riak K/V operation.
&gt; 
&gt; There is more information about "read your own writes" here:
&gt; http://basho.com/tag/configurable-behaviors/
&gt; --
&gt; Luke Bakken
&gt; CSE
&gt; lbak...@basho.com
&gt; 
&gt; 
&gt; On Wed, Jan 22, 2014 at 11:36 AM, Rob Speer  wrote:
&gt; &gt;&gt; 5. Did you wait at least 1 second before running the queries?
&gt; &gt;
&gt; &gt; I'm not the original poster but I'm now wondering what this question means.
&gt; &gt; Under what circumstances do you have to wait 1 second before query results
&gt; &gt; are available?
&gt; &gt;
&gt; &gt; We want to always be able to run tests on our database rapidly, which
&gt; &gt; includes loading data and then immediately querying to make sure the correct
&gt; &gt; data is there. I know we've had some tests where we were not able to read
&gt; &gt; our own writes, but I thought those were fixed by making sure we used vector
&gt; &gt; clocks correctly. Is there a situation where you have to wait for an
&gt; &gt; unspecified amount of time before you can read your writes?
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

