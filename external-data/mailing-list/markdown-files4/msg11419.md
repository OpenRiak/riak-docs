---
title: "Re: Riak database fails after a short period"
description: ""
project: community
lastmod: 2013-07-08T13:31:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11419"
mailinglist_parent_id: "msg11349"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2013-07-08T13:31:37-07:00
---


Hi Kirill,

Based on a \*very\* quick read of this email, I think the issue here is
that your VM is too small. Riak needs a certain amount of memory to
run and 1GB of RAM probably isn't going to cut it. If it's possible,
grab three new VMs with at least 8GB of RAM and spread your cluster
over those machines.

Hope that helps.

Mark

On Thu, Jun 27, 2013 at 12:35 PM, Kirill K.  wrote:
&gt; Hi,
&gt;
&gt; I created a simple erlang application which periodically collects required
&gt; data and puts it in a riak database.
&gt;
&gt; As I start my application it runs smoothly.. but after a period of time it
&gt; stucks as PUT requests to riak database becomes too slow.. It is logs from
&gt; my app:
&gt;
&gt; 2013-06-26 12:44:09.090 [info] &lt;0.60.0&gt; data processed in [16476 ms]
&gt; 2013-06-26 12:45:51.472 [info] &lt;0.60.0&gt; data processed in [18793 ms]
&gt; ...
&gt; 2013-06-26 12:57:28.138 [info] &lt;0.60.0&gt; data processed in [15135 ms]
&gt; 2013-06-26 13:07:01.484 [info] &lt;0.60.0&gt; data processed in [488420 ms]
&gt; 2013-06-26 14:03:11.561 [info] &lt;0.60.0&gt; data processed in [3370075 ms]
&gt;
&gt; In riak crash logs I can see a lot of messages like
&gt;
&gt; 2013-06-26 17:06:20 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\_kv\_index\_hashtree:init/1
&gt; pid: &lt;0.13660.7&gt;
&gt; registered\_name: []
&gt; exception exit: {{{badmatch,{error,{db\_open,"IO error: ./data/anti\_entropy/
&gt; 433883298582611803841718934712646521460354973696/MANIFEST-000004:
&gt; Cannot allocate memory"}}}, [{hashtree,new\_segment\_store,2,
&gt; [{file,"src/hashtree.erl"},{line,499}]},
&gt; {hashtree,new,2,[{file,"src/hashtree.erl"},{line,215}]},
&gt; {riak\_kv\_index\_hashtree,do\_new\_tree,2,
&gt; [{file,"src/riak\_kv\_index\_hashtree.erl"},
&gt; {line,426}]},{lists,foldl,3,[{file,"lists.erl"},
&gt; {line,1197}]},{riak\_kv\_index\_hashtree,
&gt; init\_trees,2,[{file,"src/riak\_kv\_index\_hashtree.erl"},
&gt; {line,368}]},{riak\_kv\_index\_hashtree,init,1,
&gt; [{file,"src/riak\_kv\_index\_hashtree.erl"},
&gt;
&gt; {line,225}]},{gen\_server,init\_it,6,[{file,"gen\_server.erl"},{line,304}]},
&gt; {proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,227}]}]},
&gt; [{gen\_server,init\_it,6,[{file,"gen\_server.erl"},{line,328}]},
&gt; {proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,227}]}]}
&gt; ancestors: [&lt;0.955.0&gt;,riak\_core\_vnode\_sup,riak\_core\_sup,&lt;0.129.0&gt;]
&gt; messages: []
&gt; links: []
&gt; dictionary: []
&gt; trap\_exit: false
&gt; status: running
&gt; heap\_size: 1597
&gt; stack\_size: 24
&gt; reductions: 593
&gt; neighbours:
&gt;
&gt; I can see the same behavior on Amazon AWS and local virtual machine. my VM's
&gt; are quite small 512-1024 mb.. AWS is Micro, so it has the same amount of
&gt; memory.
&gt;
&gt; There are no cluster currently. Just single node with riak and my app
&gt; running on it.
&gt;
&gt; I've checked riak documentation and basic things they recommend to do is to
&gt; increase ulimit and to update sysctl. So, my server ulimit shows: ulimit -n
&gt; 65536 AND sysctl updated as recommended.
&gt;
&gt; I've tried bitcask and eleveldb, but result is the same.
&gt;
&gt; Currently, I can't figure out what is broken and why riak Cannot allocate
&gt; memory..
&gt;
&gt; Thanks.
&gt;
&gt;
&gt; Kirill
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

