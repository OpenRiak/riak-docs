---
title: "Re: Riak Search - searching across all fields"
description: ""
project: community
lastmod: 2012-12-14T21:43:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09594"
mailinglist_parent_id: "msg09577"
author_name: "Matt Painter"
project_section: "mailinglistitem"
sent_date: 2012-12-14T21:43:52-08:00
---


Thanks so much Ryan - yokozuna sounds most promising. If I were building a
small system (relatively simple, small user base) that will be
production-ready in a few months, do you think that Yokozuna could cut the
mustard? I see that it's officially an experimental prototype, but do you
think it's stable 'enough' in its current state? Sorry if this is an
impossible question to answer with too many variables...

I must confess that using a forked Riak makes me a touch queasy for
anything other than playpen stuff. Do you think that a combo deal of Riak +
elasticsearch could be a suitable compromise for the time-being?


On 15 December 2012 06:13, Ryan Zezeski  wrote:

&gt; Matt, comments inline
&gt;
&gt;
&gt; On Tue, Dec 11, 2012 at 3:35 AM, Matt Painter  wrote:
&gt;&gt;
&gt;&gt;
&gt;&gt; Apart from a single default value, is it possible for Riak Search to
&gt;&gt; search for a keyword across all fields in a document without having to
&gt;&gt; specify the field up front as a prefix in one's search term?
&gt;&gt;
&gt;
&gt; A field must be specified to search, but a default field may be specified
&gt; in the schema [1]. This field will be searched if one is not specified.
&gt; But there is no way to do a search against all fields. It is always over
&gt; one field.
&gt;
&gt;
&gt;&gt; I'm guessing that one solution could be a post-commit hook which
&gt;&gt; recursively iterates over all fields and squashes them into a secondary
&gt;&gt; default value field - but since I know even less about Erlang and am just
&gt;&gt; starting out with Riak, I thought it prudent to see if there was a more
&gt;&gt; straightforward solution...
&gt;&gt;
&gt;
&gt; Your use case immediately makes me think of Solr copy fields. You index
&gt; everything under their individual fields but all values get copied into a
&gt; catch-all field so that all content may be searched easily. However, with
&gt; this you lose the ability to know which field it came from. Riak Search
&gt; doesn't have copy field functionality. You'd have to concatenate all the
&gt; data into a field on your application side. The new search solution I've
&gt; been working on, Yokozuna, uses Solr underneath and therefore does support
&gt; copy fields [2].
&gt;
&gt; You could create a pre-commit hook to do this field-squashing but I think
&gt; you would be better off doing it in your application. To do it via a hook
&gt; you'd have to make sure it runs before the search hook (I can't remember if
&gt; you can force specific order of pre-commit hooks). It would also have an
&gt; effect on your write latencies as more pre-processing would have to be
&gt; done. Finally, you would have to write Erlang.
&gt;
&gt;
&gt;&gt; The use case is this:
&gt;&gt;
&gt;&gt; We are providing an object + metadata store for users to deposit files
&gt;&gt; and any number of related fragments of structured JSON metadata. We are not
&gt;&gt; enforcing any metadata schema - and therefore can't know up-front any field
&gt;&gt; names - but would like the ability for a dumb keyword search from a website
&gt;&gt; to return references to the records they have deposited in
&gt;&gt; Riak. Essentially, providing a Google-like interface.
&gt;&gt;
&gt;&gt; (As a side question, Is Riak Search mature enough for these type of very
&gt;&gt; generic searches? I know that it's "inspired by" Lucene and "Lucene-like",
&gt;&gt; but I don't know how many of Lucene's goodies are present - or is it just a
&gt;&gt; case of invoking analysers provided by Lucene for things like stemming, and
&gt;&gt; all will be pretty much equivalent for most situations?)
&gt;&gt;
&gt;
&gt; There are no "goodies present" \_at all\_. Riak Search is an in-house
&gt; implementation, completely written in Erlang. It's only connection to
&gt; Lucene/Solr is a superficial interface that looks very much like
&gt; Lucene/Solr. E.g. you mention stemming, there is no stemming support in
&gt; Riak Search and would be a non-trivial addition. This is one of the big
&gt; reasons Yokozuna is being written [2]. The world of search is vast and
&gt; complicated, best to start with proven solution and build from that.
&gt;
&gt; Riak Search generally starts causing pain when you have searches that
&gt; match tens of thousands of documents. The runtime is proportional to the
&gt; size of the result set. In fact, Riak Search has a hard-coded upper limit
&gt; to fail queries that match 100K or more documents (although it does the
&gt; work to get 100K results and then drops it all on the floor so you still
&gt; use resources/times). For example, if a lot of your files were pictures
&gt; and were tagged with something like {"type":"picture"} then a search for
&gt; "picture" is probably going to cause issues. Things really start to hurt
&gt; when you do conjunction queries with multiple large result sets, e.g.
&gt; "funny AND picture". Once again, this is not the case with Yokozuna, which
&gt; in my benchmarking thus far has shown flat latencies regardless of result
&gt; set size.
&gt;
&gt; -Z
&gt;
&gt; [1]:
&gt; http://docs.basho.com/riak/latest/cookbooks/Riak-Search---Schema/#Defining-a-Schema
&gt;
&gt; [2]: https://github.com/rzezeski/yokozuna
&gt;



-- 
Matt Painter
m...@deity.co.nz
+64 21 115 9378
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

