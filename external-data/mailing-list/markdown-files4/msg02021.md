---
title: "Re: map performance notes and question"
description: ""
project: community
lastmod: 2011-01-18T10:50:54-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02021"
mailinglist_parent_id: "msg02020"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2011-01-18T10:50:54-08:00
---


To your second point re. returning a large string via a js m/r, yes,
this has to do with passing the string from the erlang environment to
the javascript environment. That is why it is always recommended that
as your needs escalate you should seriously look into going native
erlang in your m/r's.

Best, Alexander

On Tue, Jan 18, 2011 at 18:39, Brendan  wrote:
&gt; hi. i'm a new riak user. i scanned the list archives and didn't notice
&gt; either of these things discussed - i apologize in advance if they
&gt; already have been.
&gt;
&gt; i noticed something that is perhaps of use to people. when using the
&gt; data of an object in a map phase to generate a list of [bucket,object]
&gt; pairs for a second map phase i've seen the suggestion to use a json
&gt; array as the data and Riak.mapValues to generate the list. i've been
&gt; playing with this (and some more complex json objects beyond a simple
&gt; array) and i've come to the conclusion that using a comma separated list
&gt; as the data instead of a json array is far more efficient on large
&gt; datasets.
&gt;
&gt; JSON.parse (and the eval()) it calls is relatively slow, but a
&gt; split(',') operation is very quick. on a 100,000 element dataset on my
&gt; test machine the split averages about 25ms to convert the csv data into
&gt; a javascript array object, but using JSON.parse to convert the json data
&gt; into a javascript array object averages around 750ms. for smaller
&gt; datasets there isn't much of a difference, but for large ones the
&gt; difference can become quite significant. hopefully this observation is
&gt; of use to someone besides me. :)
&gt;
&gt; i also have a question regarding map performance with large objects. if
&gt; i create an object with one of these large 100,000 element datasets in
&gt; it (whether a csv or json array doesn't matter) then stop and start
&gt; riak, i can retrieve the object (get, via rest api) in about 0.2
&gt; seconds. subsequent requests take about 0.06 seconds, i assume because
&gt; riak had to load the data from disk the first time and had it cached the
&gt; second. at any rate, riak is very quick in both cases.
&gt;
&gt; if, however, i then do a simple map operation of
&gt; "function(v){return[1]}" where the map doesn't actually do any work at
&gt; all on just that single object, then the time to process the request
&gt; balloons to 2.1 seconds. given that riak can return the data via GET in
&gt; 0.06 seconds, 2.1 seconds simply to load the object into a map phase
&gt; seems excessive. is this a penalty for passing the data into the
&gt; javascript engine, and thus something i could avoid by doing the map
&gt; operation natively in erlang (my erlang skills are pretty weak, but if
&gt; this works around the issue it'll be a good driver to force me to
&gt; improve them)? or is it simply a penalty of the map phase, with no way
&gt; around it?
&gt;
&gt; (everything above is based on tests with riak-0.14-0)
&gt;
&gt; thanks
&gt; -brendan
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

