---
title: "Re: Riak 2.0 Search Issues"
description: ""
project: community
lastmod: 2015-03-05T09:29:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15845"
mailinglist_parent_id: "msg15843"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-03-05T09:29:48-08:00
---


Hey Steve,

Your data will remain in Riak, but Search will then use AAE to rebuild the data 
on the Solr side. This is only to fix Solr’s core data issues. If you’re 
worried about an interruption on the SOLR side, as there would be one to 
reindex the data, you could then wait until things are sured-up in our next 
release/patch-release to help solve these issues.

As I mentioned, we’re working on a fix for this with an internal patch that 
we’re testing at this moment.

Thanks.

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\_we\_love | paperswelove.org
twitter =&gt; @zeeshanlakhani

&gt; On Mar 5, 2015, at 12:13 PM, Steve Garon  wrote:
&gt; 
&gt; Does deleting core.properties or moving search-root/index deletes any of my 
&gt; index data? Will that cause any interruption to SOLR? Cause I'm having 
&gt; problems on a production cluster and I really don't want to have to backup 
&gt; 300 millions keys again or cause any interruptions to the system ...
&gt; 
&gt; 
&gt; Steve
&gt; 
&gt; On 5 March 2015 at 10:11, Zeeshan Lakhani  &gt; wrote:
&gt; Hey Steve,
&gt; 
&gt; We’re currently tracking this issue, 
&gt; https://github.com/basho/yokozuna/issues/442 
&gt; , and are working on testing 
&gt; out a patch internally. I will update you as soon as we get clarity there.
&gt; 
&gt; As a possible workaround, I would attempt to delete the `core.properties` 
&gt; file located in the search root\_directory/index of each node 
&gt; (./data/yz/&lt;&gt;). This file should then be recreated on the next 
&gt; attempt to creating the core on the Solr side, 
&gt; https://github.com/basho/yokozuna/blob/92ca14cc35b46c8e7ac86cad6d92547e68e8d917/src/yz\_index.erl#L171
&gt; 
&gt; .
&gt; 
&gt; If that doesn’t work, you can then delete or `mv` that search-root/index 
&gt; directory out of the way, for which it will then get recreated and AAE will 
&gt; sync the data.
&gt; 
&gt; Thanks.
&gt; 
&gt; Zeeshan Lakhani
&gt; programmer | 
&gt; software engineer at @basho | 
&gt; org. member/founder of @papers\_we\_love | paperswelove.org 
&gt; 
&gt; twitter =&gt; @zeeshanlakhani
&gt; 
&gt;&gt; On Mar 5, 2015, at 9:02 AM, Steve Garon &gt; &gt; wrote:
&gt;&gt; 
&gt;&gt; In solr.log, the kind of exceptions that I'm getting right now is the 
&gt;&gt; following:
&gt;&gt; 
&gt;&gt; 1. IO Error while trying to get the size of the 
&gt;&gt; Directory:java.io.FileNotFoundException: SOME\_RAMDOM\_FILE (.doc, .pos, .fnm, 
&gt;&gt; .si, .nv, .gen extensions)
&gt;&gt; 2. SolrException.java:120 null:org.apache.sorl.common.SolrException: Core 
&gt;&gt; with name 'BUCKET NAME' already exists. 
&gt;&gt; 3. SolrException.java:120 null:org.eclipse.jetty.io.EofException
&gt;&gt; 4. Server refused connection 
&gt;&gt; 5. IOException occured when talking to server
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Steve
&gt;&gt; 
&gt;&gt; On 5 March 2015 at 08:50, Steve Garon &gt; &gt; wrote:
&gt;&gt; Yes I do have yz\_events,handle\_info in crash log. Tons of them actually and 
&gt;&gt; they have a big ass strack trace attached to each of them.
&gt;&gt; 
&gt;&gt; It would be hard for me to provide you with logs. If you have specific 
&gt;&gt; questions you want answers to I'd be happy to help though.
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Steve
&gt;&gt; 
&gt;&gt; On 4 March 2015 at 14:20, Zeeshan Lakhani &gt; &gt; wrote:
&gt;&gt; Hey Steve,
&gt;&gt; 
&gt;&gt; Sorry to see you’re having new issues.
&gt;&gt; 
&gt;&gt; We’ll have the fix for “space in the key” out soon; it’s currently under 
&gt;&gt; review. And, I know that this issue is unrelated.
&gt;&gt; 
&gt;&gt; I have a few different routes/thoughts for you, but are you seeing anything 
&gt;&gt; related to `yz\_events,handle\_info` in your crash logs? Also, can you 
&gt;&gt; gist/pastebin me your solr logs? I’d like to seem if it correlates with 
&gt;&gt; something we’re currently looking at. 
&gt;&gt; 
&gt;&gt; Thanks. 
&gt;&gt; 
&gt;&gt; Zeeshan Lakhani
&gt;&gt; programmer | 
&gt;&gt; software engineer at @basho | 
&gt;&gt; org. member/founder of @papers\_we\_love | paperswelove.org 
&gt;&gt; 
&gt;&gt; twitter =&gt; @zeeshanlakhani
&gt;&gt; 
&gt;&gt;&gt; On Mar 4, 2015, at 10:39 AM, Steve Garon &gt;&gt; &gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Hey all, 
&gt;&gt;&gt; 
&gt;&gt;&gt; We were having the "space in the key" bug in our cluster so we went through 
&gt;&gt;&gt; the whole dataset, backing it up to json file and removing the spaces in 
&gt;&gt;&gt; the keys. Then we trashed our whole cluster and restart from scratch 
&gt;&gt;&gt; reimporting the whole data. Everything worked like a charm for two weeks 
&gt;&gt;&gt; but this weekend, not sure what happened but AAE died again. 
&gt;&gt;&gt; 
&gt;&gt;&gt; I have two issues now: 
&gt;&gt;&gt; 1. AAE is trying to recreate an index that already exists and crashes with 
&gt;&gt;&gt; an "Already exists" error ... I get this in my error log every 15 seconds
&gt;&gt;&gt; 2. AAE crashes while iterating through entropy data with a request timeout 
&gt;&gt;&gt; error every hour followed by tons of failed to index objects with request 
&gt;&gt;&gt; timeout as well. Stack trace looks like this:
&gt;&gt;&gt; 
&gt;&gt;&gt; [error] emulator Error in process &lt;025931.7166&gt; on node 'riak@IP' with exit 
&gt;&gt;&gt; value: {function\_clause,[{yz\_entropy,iterate\_entropy\_data,[&lt;&lt;11 
&gt;&gt;&gt; bytes&gt;&gt;,[{continuation,&lt;&lt;159 
&gt;&gt;&gt; bytes&gt;&gt;},{limit,100},{partition,12}],#Fun&gt;&gt; (TRUNCATED)
&gt;&gt;&gt; 
&gt;&gt;&gt; [error] &lt;0.1371.0&gt;@yz\_kv:index:215 failed to index object 
&gt;&gt;&gt; {{&lt;&lt;"TYPE"&gt;&gt;,&lt;&lt;"BUCKET"&gt;&gt;},&lt;&lt;"KEY"&gt;&gt;} with error {"Failed to index 
&gt;&gt;&gt; docs",{error,req\_timeout}} because ... (REPEATED MULTIPLE TIME FOR 
&gt;&gt;&gt; DIFFERENT KEYS)
&gt;&gt;&gt; 
&gt;&gt;&gt; I tried clearing the yz anti-entropy tree and reinitialising the 
&gt;&gt;&gt; yz\_entropy\_mgr with no luck. Anything I can do to fix this? 
&gt;&gt;&gt; 
&gt;&gt;&gt; Oh FYI, I cannot insert data with spaces in the key anymore because we are 
&gt;&gt;&gt; using a wrapper on top of riak that will prevent us to do so therefore my 
&gt;&gt;&gt; issues are not related to this for sure.
&gt;&gt;&gt; 
&gt;&gt;&gt; These are some config changes that may be good to know for more context.
&gt;&gt;&gt; We added this to ibrowse.conf:
&gt;&gt;&gt; {dest, "localhost", 8093, 100, 1000, []}.
&gt;&gt;&gt; 
&gt;&gt;&gt; Jetty is set with minthread 80, acceptors 80, and is using the NIO 
&gt;&gt;&gt; connector.
&gt;&gt;&gt; 
&gt;&gt;&gt; All our solr buckets have filterCache disabled with softcommits set to 10s 
&gt;&gt;&gt; instead of 1.
&gt;&gt;&gt; 
&gt;&gt;&gt; Our riak.conf has background\_manager turned on with AAE and handoff using 
&gt;&gt;&gt; it.
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; 
&gt;&gt;&gt; Steve
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com 
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com 
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

