---
title: "Re: Riak crash on 0.14.2 riak_kv_stat terminating"
description: ""
project: community
lastmod: 2011-06-20T10:20:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03751"
mailinglist_parent_id: "msg03750"
author_name: "Greg Nelson"
project_section: "mailinglistitem"
sent_date: 2011-06-20T10:20:33-07:00
---


I see this from time to time on our production 5-node cluster, with no 
indications of any other problems. And I'm certain it's not a memory or disk 
issue.

On Sunday, June 19, 2011 at 6:01 PM, Jeremy Raymond wrote:

&gt; Actually it's a bit later on where I see this:
&gt; 
&gt; ===== Fri Jun 17 16:26:46 EDT 2011
&gt; 
&gt; =ERROR REPORT==== 17-Jun-2011::16:26:46 ===
&gt; \*\* Generic server riak\_kv\_stat terminating 
&gt; \*\* Last message in was {'$gen\_cast',{update,vnode\_get,63475547206}}
&gt; \*\* When Server state == {state,
&gt; {spiral,63475547266,
&gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; {spiral,63475547266,
&gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; 2846696,42859,35845,31080,
&gt; {slide,63475532874,60,60,
&gt; "/tmp/riak/slide-data/474/1308.328066.57288",
&gt; {file\_descriptor,prim\_file,
&gt; {#Port&lt;0.64895&gt;,24}},
&gt; 63475547205},
&gt; {slide,63475532874,60,60,
&gt; "/tmp/riak/slide-data/474/1308.328066.59517",
&gt; {file\_descriptor,prim\_file,
&gt; {#Port&lt;0.64896&gt;,13}},
&gt; 63475547205},
&gt; {spiral,63475547266,
&gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; 978,4,
&gt; {spiral,63475547266,
&gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; 21375,21}
&gt; \*\* Reason for termination == 
&gt; \*\* {badarg,[{erlang,hd,[[]]},
&gt; {spiraltime,incr,3},
&gt; {riak\_kv\_stat,spiral\_incr,3},
&gt; {riak\_kv\_stat,handle\_cast,2},
&gt; {gen\_server2,handle\_msg,7},
&gt; {proc\_lib,init\_p\_do\_apply,3}]}
&gt; (riak@x.x.x.x (mailto:riak@x.x.x.x))3&gt; 
&gt; /usr/lib/riak/lib/os\_mon-2.2.5/priv/bin/memsup: Erlang has closed. 
&gt; Erlang has closed
&gt; 
&gt; 
&gt; Other than that the only other thing that stands out is the info messages 
&gt; about system\_memory\_high\_watermark. 
&gt; 
&gt; - Jeremy
&gt; 
&gt; 
&gt; On Sun, Jun 19, 2011 at 8:47 PM, Jeremy Raymond  (mailto:jeraym...@gmail.com)&gt; wrote:
&gt; &gt; I see these messages near the time of the crash. Indicators of low system 
&gt; &gt; memory?
&gt; &gt; 
&gt; &gt; =INFO REPORT==== 17-Jun-2011::12:27:35 ===
&gt; &gt; Spidermonkey VM (pool: riak\_kv\_js\_map) host stopping (&lt;0.160.0&gt;)
&gt; &gt; (riak@10.90.80.167 (mailto:riak@10.90.80.167))1&gt; 
&gt; &gt; =INFO REPORT==== 17-Jun-2011::12:27:35 ===
&gt; &gt; Spidermonkey VM (pool: riak\_kv\_js\_map) host stopping (&lt;0.159.0&gt;)
&gt; &gt; (riak@10.90.80.167 (mailto:riak@10.90.80.167))1&gt; 
&gt; &gt; /usr/lib/riak/lib/os\_mon-2.2.5/priv/bin/memsup: Erlang has closed. 
&gt; &gt; 
&gt; &gt; =INFO REPORT==== 17-Jun-2011::12:27:35 ===
&gt; &gt; [{alarm\_handler,{clear,system\_memory\_high\_watermark}}](riak@10.90.80.167 
&gt; &gt; (mailto:riak@10.90.80.167))1&gt; Erlang has closed
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; - Jeremy
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; On Sun, Jun 19, 2011 at 4:52 PM, Sean Cribbs  &gt; (mailto:s...@basho.com)&gt; wrote:
&gt; &gt; &gt; Jeremy,
&gt; &gt; &gt; 
&gt; &gt; &gt; There is an open pull request for fixing this bug. Details of the bug are 
&gt; &gt; &gt; here: https://issues.basho.com/show\_bug.cgi?id=1072 It will not cause 
&gt; &gt; &gt; your entire to node to crash, there is likely some other cause. Node 
&gt; &gt; &gt; exits tend to only happen when you run out of RAM or disk space, or can't 
&gt; &gt; &gt; bind to a TCP port during riak\_core startup. Were there other indications 
&gt; &gt; &gt; in the erlang.log.\*? 
&gt; &gt; &gt; 
&gt; &gt; &gt; -- 
&gt; &gt; &gt; Sean Cribbs 
&gt; &gt; &gt; Developer Advocate
&gt; &gt; &gt; Basho Technologies, Inc.
&gt; &gt; &gt; http://www.basho.com/
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; On Sat, Jun 18, 2011 at 9:53 PM, Jeremy Raymond  &gt; &gt; (mailto:jeraym...@gmail.com)&gt; wrote:
&gt; &gt; &gt; &gt; Hello,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I have a 3 node Riak 0.14.2 cluster from the deb packages running on 
&gt; &gt; &gt; &gt; Ubuntu 10.10. I had a node go down with the following error from the 
&gt; &gt; &gt; &gt; sasl-error.log. Ideas on tracking down the cause?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; - Jeremy
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; =ERROR REPORT==== 17-Jun-2011::16:26:46 ===
&gt; &gt; &gt; &gt; \*\* Generic server riak\_kv\_stat terminating 
&gt; &gt; &gt; &gt; \*\* Last message in was {'$gen\_cast',{update,vnode\_get,63475547206}}
&gt; &gt; &gt; &gt; \*\* When Server state == {state,
&gt; &gt; &gt; &gt; {spiral,63475547266,
&gt; &gt; &gt; &gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; &gt; &gt; &gt; {spiral,63475547266,
&gt; &gt; &gt; &gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; &gt; &gt; &gt; 2846696,42859,35845,31080,
&gt; &gt; &gt; &gt; {slide,63475532874,60,60,
&gt; &gt; &gt; &gt; "/tmp/riak/slide-data/474/1308.328066.57288",
&gt; &gt; &gt; &gt; {file\_descriptor,prim\_file,
&gt; &gt; &gt; &gt; {#Port&lt;0.64895&gt;,24}},
&gt; &gt; &gt; &gt; 63475547205},
&gt; &gt; &gt; &gt; {slide,63475532874,60,60,
&gt; &gt; &gt; &gt; "/tmp/riak/slide-data/474/1308.328066.59517",
&gt; &gt; &gt; &gt; {file\_descriptor,prim\_file,
&gt; &gt; &gt; &gt; {#Port&lt;0.64896&gt;,13}},
&gt; &gt; &gt; &gt; 63475547205},
&gt; &gt; &gt; &gt; {spiral,63475547266,
&gt; &gt; &gt; &gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; &gt; &gt; &gt; 978,4,
&gt; &gt; &gt; &gt; {spiral,63475547266,
&gt; &gt; &gt; &gt; [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
&gt; &gt; &gt; &gt; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},
&gt; &gt; &gt; &gt; 21375,21}
&gt; &gt; &gt; &gt; \*\* Reason for termination == 
&gt; &gt; &gt; &gt; \*\* {badarg,[{erlang,hd,[[]]},
&gt; &gt; &gt; &gt; {spiraltime,incr,3},
&gt; &gt; &gt; &gt; {riak\_kv\_stat,spiral\_incr,3},
&gt; &gt; &gt; &gt; {riak\_kv\_stat,handle\_cast,2},
&gt; &gt; &gt; &gt; {gen\_server2,handle\_msg,7},
&gt; &gt; &gt; &gt; {proc\_lib,init\_p\_do\_apply,3}]}
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; =CRASH REPORT==== 17-Jun-2011::16:26:46 ===
&gt; &gt; &gt; &gt; crasher:
&gt; &gt; &gt; &gt; initial call: gen:init\_it/7
&gt; &gt; &gt; &gt; pid: &lt;0.151.0&gt;
&gt; &gt; &gt; &gt; registered\_name: riak\_kv\_stat
&gt; &gt; &gt; &gt; exception exit: 
&gt; &gt; &gt; &gt; {badarg,[{erlang,hd,[[]]},{spiraltime,incr,3},{riak\_kv\_stat,spiral\_incr,3},{riak\_kv\_stat,handle\_cast,2},{gen\_server2,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
&gt; &gt; &gt; &gt; in function gen\_server2:terminate/6
&gt; &gt; &gt; &gt; in call from proc\_lib:init\_p\_do\_apply/3
&gt; &gt; &gt; &gt; ancestors: [riak\_kv\_sup,&lt;0.138.0&gt;]
&gt; &gt; &gt; &gt; messages: 
&gt; &gt; &gt; &gt; [{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,mapper\_end,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,mapper\_end,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_get,63475547206}},{$gen\_cast,{update,vnode\_put,63475547206}}]
&gt; &gt; &gt; &gt; links: [#Port&lt;0.64896&gt;,&lt;0.145.0&gt;,#Port&lt;0.64895&gt;]
&gt; &gt; &gt; &gt; dictionary: []
&gt; &gt; &gt; &gt; trap\_exit: true
&gt; &gt; &gt; &gt; status: running
&gt; &gt; &gt; &gt; heap\_size: 2584
&gt; &gt; &gt; &gt; stack\_size: 24
&gt; &gt; &gt; &gt; reductions: 81329187
&gt; &gt; &gt; &gt; neighbours:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; =SUPERVISOR REPORT==== 17-Jun-2011::16:26:46 ===
&gt; &gt; &gt; &gt; Supervisor: {local,riak\_kv\_sup}
&gt; &gt; &gt; &gt; Context: child\_terminated
&gt; &gt; &gt; &gt; Reason: 
&gt; &gt; &gt; &gt; {badarg,[{erlang,hd,[[]]},{spiraltime,incr,3},{riak\_kv\_stat,spiral\_incr,3},{riak\_kv\_stat,handle\_cast,2},{gen\_server2,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
&gt; &gt; &gt; &gt; Offender: 
&gt; &gt; &gt; &gt; [{pid,&lt;0.151.0&gt;},{name,riak\_kv\_stat},{mfa,{riak\_kv\_stat,start\_link,[]}},{restart\_type,permanent},{shutdown,5000},{child\_type,worker}]
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

