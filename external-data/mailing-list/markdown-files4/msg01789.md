---
title: "Re: using the erlang API for riak search"
description: ""
project: community
lastmod: 2010-12-14T11:36:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01789"
mailinglist_parent_id: "msg01788"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2010-12-14T11:36:42-08:00
---


Hi Carson,

That looks like a simple typo. ;-) The name of the module is
'riakc\_pb\_socket' module. Notice the 'c' after 'riak'.

Best,
Rusty

On Tue, Dec 14, 2010 at 2:30 PM, carson li wrote:

&gt; Hi Rusty,
&gt;
&gt; That makes sense but i'm still running into problems. My code is simple
&gt;
&gt; Pid = get\_riak\_client(),
&gt; {ok, Results} = riak\_pb\_socket:search(Pid, "testB", "firstName:Billie").
&gt;
&gt; This returns the following error.
&gt;
&gt; {error,{error,undef,
&gt; [{riak\_pb\_socket,search,[&lt;0.97.0&gt;,"testB","firstName:Billie"]},
&gt; {webmachine\_demo\_resource,to\_text,2},
&gt; {webmachine\_demo\_resource,to\_html,2},
&gt; {webmachine\_resource,resource\_call,3},
&gt; {webmachine\_resource,do,3},
&gt; {webmachine\_decision\_core,resource\_call,1},
&gt; {webmachine\_decision\_core,decision,1},
&gt; {webmachine\_decision\_core,handle\_request,2}]}}
&gt;
&gt;
&gt; So something isn't right, and i'm not getting any results back. What
&gt; exactly am i doing wrong? Just to double check that the query itself is
&gt; correct and the data is there, going to the terminal, and doing a
&gt; "search-cmd search testB "firstName:Billie" returns me
&gt;
&gt; :: Searching for 'firstName:Billie' in testB...
&gt;
&gt; ------------------------------
&gt;
&gt; index/id: testB/testK1
&gt; p -&gt; [0]
&gt; score -&gt; 0.5
&gt;
&gt; ------------------------------
&gt;
&gt; :: Found 1 results.
&gt;
&gt;
&gt; So i know the item is in there. is my syntax wrong? or am i missing
&gt; something?
&gt;
&gt;
&gt; On Tue, Dec 14, 2010 at 2:01 PM, Rusty Klophaus  wrote:
&gt;
&gt;&gt; Hi Carson,
&gt;&gt;
&gt;&gt; You are definitely on the right track. The SearchQuery parameter is a
&gt;&gt; Lucene-syntax-ish search query, and the Bucket parameter is the bucket on
&gt;&gt; which to search. You can find more information on the query syntax here:
&gt;&gt; http://wiki.basho.com/display/RIAK/Riak+Search+-+Querying
&gt;&gt;
&gt;&gt; Usage is as follows:
&gt;&gt;
&gt;&gt; {ok, Pid} = riakc\_pb\_socket:start("127.0.0.1", "8087"),
&gt;&gt; Bucket = "json",
&gt;&gt; SearchQuery = "firstname:John"),
&gt;&gt; {ok, BucketKeyList} = riakc\_pb\_socket:search(Pid, Bucket, SearchQuery,
&gt;&gt; riakc\_pb\_socket:stop(Pid).
&gt;&gt;
&gt;&gt; You can also do more complicated things like using the results to spawn a
&gt;&gt; map/reduce operation by adding a MapReducePhases parameter. You can find
&gt;&gt; more information on map/reduce phases here:
&gt;&gt; http://wiki.basho.com/display/RIAK/MapReduce
&gt;&gt;
&gt;&gt; {ok, Result} = riakc\_pb\_socket:search(Pid, "json", "firstname:John",
&gt;&gt; MapReducePhases, TimeoutInMS),
&gt;&gt;
&gt;&gt; Best,
&gt;&gt; Rusty
&gt;&gt;
&gt;&gt; On Mon, Dec 13, 2010 at 4:33 PM, carson li &gt; liquidanalytics.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; hey everyone,
&gt;&gt;&gt;
&gt;&gt;&gt; i just started off with using riak search. (i have some basic riak
&gt;&gt;&gt; experience) and i don't know how to use the erlang api for riak to do search
&gt;&gt;&gt; queries.
&gt;&gt;&gt;
&gt;&gt;&gt; what i've done so far
&gt;&gt;&gt; ------------------------------
&gt;&gt;&gt; I have successfully installed the KV hook, put in a json document,
&gt;&gt;&gt; and also used the search-cmd to retrieve something. for reference i put
&gt;&gt;&gt; in the json
&gt;&gt;&gt;
&gt;&gt;&gt; {
&gt;&gt;&gt; firstname:"John",
&gt;&gt;&gt; lastName:"Smith"
&gt;&gt;&gt; }
&gt;&gt;&gt;
&gt;&gt;&gt; with the command curl -X PUT http://127.0.0.1:8098/riak/test/123 -H
&gt;&gt;&gt; "Content-Type: application/json" -d @test.json
&gt;&gt;&gt;
&gt;&gt;&gt; to retrieve something i by navigating to riah search's bin, then
&gt;&gt;&gt; ./search-cmd search json firstname:John
&gt;&gt;&gt;
&gt;&gt;&gt; the above works well.
&gt;&gt;&gt; now i'm buildling an aplpication with webmachine / erlang. and i want to
&gt;&gt;&gt; be able to perform searches as well.
&gt;&gt;&gt; the wiki indicates that the Erlang api should support this
&gt;&gt;&gt;
&gt;&gt;&gt; https://wiki.basho.com/display/RIAK/Riak+Search+-+Querying
&gt;&gt;&gt;
&gt;&gt;&gt; looking at riakc\_pb\_socket.erl, i see there is a search method that has
&gt;&gt;&gt; the signature search(Pid, Bucket, SearchQuery)
&gt;&gt;&gt;
&gt;&gt;&gt; so what exactly is SearchQuery, how is it supposed to look like. So it
&gt;&gt;&gt; just gets passed into a mapred\_search?
&gt;&gt;&gt; I'm confused on how this works. Can someone please provide a simple
&gt;&gt;&gt; example, of how i can search for say firstname:John with the json above?
&gt;&gt;&gt;
&gt;&gt;&gt; any help would be greatly appreciated.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Carson Li
&gt;&gt;&gt; Liquid Analytics
&gt;&gt;&gt; carson...@liquidanalytics.com
&gt;&gt;&gt; 647-273-1024
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Carson Li
&gt; Liquid Analytics
&gt; carson...@liquidanalytics.com
&gt; 647-273-1024
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

