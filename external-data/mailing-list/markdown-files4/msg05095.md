---
title: "Re: Has the result failure scenarios documented in wiki changed in 1.0"
description: ""
project: community
lastmod: 2011-10-07T07:06:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05095"
mailinglist_parent_id: "msg05059"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2011-10-07T07:06:41-07:00
---


Eric,

Since your colleague is running an older version he is probably bumping up
against basic\_quorum [1]. Basic quorum is a mechanism to prevent latency
growth in the case where nodes are going down. In the land before 1.0 Riak
considered a not\_found to count towards a failure. Basic quorum says "if
the majority of the replicas report failure, i.e. not\_found, then consider
the data not to be there and return not\_found back to the client." If you
didn't have this check then clients using R=1 on a cluster with failing
nodes will have nonintuitive latency spikes because with N=3 & R=1 you maybe
have to wait for all 3 replicas to reply before you can return to the
client. This essentially turns a R=1 into a R=3 request without the
client's knowledge.

In 1.0, Riak defaults to `basic\_quorum=false` and `notfound\_ok=true`. This
means that notfound responses will count as successful reads. This keeps
the semantics of R because if the first R responses are notfound then
notfound will be returned to the client.

In your case, depending on how many nodes you are taking down and what keys
you are reading you could still get a notfound response for N=3 and R=2. It
also depends on which replicas respond first. E.g. given the case where
N=3/R=2 and you kill 2 nodes that where the first two entries in a key K's
preflist. Only if those two partitions (which are now fallbacks) return
first will you get a notfound for key K. If the 3rd partition is
interleaved anywhere in the first two responses you'll get your object back.
 Also, read repair will then kick in and the 2nd time around all replicas
should have the object.

In general we tried to make 1.0 more predictable in the face of node
failures. I hope this makes sense. It's easier to explain with a
whiteboard.

-Ryan

[1]:
http://wiki.basho.com/Eventual-Consistency.html#Edge-Case%3A-Reading-With-R%3D1-When-Two-Primaries-Fail
(I think our explanation here is a little confusing and even wrong in
some
places)

On Wed, Oct 5, 2011 at 6:37 PM, Eric Moritz wrote:

&gt; I was reading through this documentation after a colleague mentioned
&gt; getting not\_found while stopping and starting nodes to mimic failures.
&gt; His experience corresponds with the behaviors described on this wiki
&gt; page:
&gt;
&gt; http://wiki.basho.com/Eventual-Consistency.html#Failure-Scenarios
&gt;
&gt; However, when I try to mimic the same failures in 1.0, I get successes
&gt; when trying to read and write after taking a node down. I noticed the
&gt; notfound\_ok parameter exists now in the HTTP documentation which I
&gt; assume has something to do with this. Has the fail-over code been
&gt; improved to hide the not\_found responses in the face of failure?
&gt;
&gt; Thanks,
&gt; Eric Moritz.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

