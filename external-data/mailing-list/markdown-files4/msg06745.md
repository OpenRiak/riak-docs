---
title: "Re: Possibility of a CAS API"
description: ""
project: community
lastmod: 2012-02-25T17:18:25-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06745"
mailinglist_parent_id: "msg06740"
author_name: "Armon Dadgar"
project_section: "mailinglistitem"
sent_date: 2012-02-25T17:18:25-08:00
---


On Feb 24, 2012, at 7:46 PM, Reid Draper wrote:
&gt; The problem is that amongst all replicas for a particular key,
&gt; operations are not serializable. Put another way, if there
&gt; are concurrent writes to three replicas,
&gt; there is no way to figure out a total ordering for the actions.
&gt; 
&gt; It's also important to note that even when you set W=N
&gt; for a write, it's possible that 1 write could succeed
&gt; and 2 could fail. The succeeding write is \_not\_ "rolled back"
&gt; when this happens. The user will see an error message
&gt; that the write didn't succeed on all replicas.

Got it. I was unsure how "If-Unmodified-Since" and "If-None-Match"
were implemented, but that makes sense given Riak's architecture.

&gt;&gt; 
&gt;&gt; I'm not convinced that a CAS operation is inevitably subject to data races.
&gt;&gt; There are proven techniques for avoiding races at the cost of latency,
&gt;&gt; which is acceptable in certain situations.
&gt; Correct, but as far as I know, there is no way to build a CAS system
&gt; on top of the primitives provided by the Riak public API. You need
&gt; a point of serialization amongst all of the replicas (for a particular key),
&gt; which Riak does not provide, for availability reasons.

I think a point of serialization is not needed here. It should be sufficient
to add a new internal API for nodes to handle a two-phase commit, and
then the transaction coordinator (running on whatever node you make
the request to) can contain the logic to carry out the transaction.

I totally understand that under the current architecture and exposed
API's of Riak KV it is not possible.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

