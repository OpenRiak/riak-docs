---
title: "Re: search schema caching bug?"
description: ""
project: community
lastmod: 2012-04-23T15:46:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07296"
mailinglist_parent_id: "msg07295"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-04-23T15:46:41-07:00
---


Michael,

This is indeed a bug in Search. You can clear the cache via the command
line like so:

 search-cmd clear-schema-cache

I filed an issue for this here:
https://github.com/basho/riak\_search/issues/105

-Z

On Mon, Apr 23, 2012 at 6:13 PM, Michael Radford  wrote:

&gt; In order to get case-insensitive indexing without stopwords, I'm
&gt; trying to put a new search schema in place using the method from the
&gt; Riak wiki:
&gt;
&gt; search-cmd set-schema [bucket] [schema file]
&gt;
&gt; This apparently succeeded, and search-cmd show-schema correctly
&gt; returns my new schema. However, I was still getting
&gt; stopword\_not\_allowed\_in\_query errors from searches. Looking at the
&gt; code, I saw that the schema for parsing queries comes from
&gt;
&gt; {ok, Schema} = riak\_search\_config:get\_schema(IndexName),
&gt;
&gt; and sure enough, riak\_search\_config:get\_schema for my bucket returns
&gt; the old (default) schema. Looking at the source for that function, I
&gt; see the schema is cached locally in an ets table, and then when
&gt; search-cmd calls riak\_search\_config:put\_raw\_schema, it updates the
&gt; local cache, but it seems like the other nodes' caches are not
&gt; cleared. Is this a bug?
&gt;
&gt; As a workaround, it seems I can call riak\_search\_config:clear() on all
&gt; the nodes after setting the new schema. (But if this is a bad idea for
&gt; some reason, I'd like to know before trying this on a production
&gt; system!)
&gt;
&gt; Mike
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

