---
title: "Re: A first encounter with Riak/Riak-search - not getting it to work."
description: ""
project: community
lastmod: 2010-12-29T07:57:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01852"
mailinglist_parent_id: "msg01851"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2010-12-29T07:57:59-08:00
---


We worked through this on IRC, but to summarize:

It looks like the 403's were caused by a misformatted curl command. The
steps below make it work:

# Install the bucket hook.
bin/search-cmd install my\_bucket

# Index the document in the bucket. Assumes the XML document is in
document.xml

curl -X POST -H "content-type:application/xml"
http://localhost:8098/riak/my\_bucket/my\_object --data-binary @document.xml


# Run the query.

bin/search-cmd search my\_bucket "Event\_EntityRef:nur"


Regarding the perceived query wackiness, this was caused because the
document had been indexed with content-type text/plain, ignoring the XML
structure. As a result, the entire document was tokenized and stuffed into
the default field (the "value" field).


Further compounding the issue is the fact that the default analyzer
tokenizes by 1) splitting on any whitespace or punctuation, 2) lowercasing
all tokens, and 3) throwing out any tokens smaller than three characters.
This has been a repeated cause of confusion, and as a result the next
version of Search will use the Whitespace analyzer by default. (The
whitespace analyzer simply tokenizes based on spaces/tabs/newlines but
leaves everything else alone.)


Best,

Rusty


On Wed, Dec 29, 2010 at 10:01 AM, Sven Johansson
wrote:

&gt; I am putting together an application prototype for a client that needs to
&gt; store vast amounts of historical data.
&gt; The data is supposed to be delivered to this application as XML, and these
&gt; documents needs to be searchable
&gt; based on certain field values in these documents.
&gt;
&gt; After reading up on Riak, and riak-search more specifically, I found that
&gt; it seemed like a very good match given
&gt; that it is supposed to be able to understand and index XML documents out of
&gt; the box.
&gt; (In the end, I'm expecting to find that it's a more efficient solution to
&gt; using a custom index & analyzer factory, but
&gt; from what I can make of the docs in the Basho wiki the out of the
&gt; box-behaviour should suffice for the prototype).
&gt;
&gt; However, things are not going as smooth as one would expect.
&gt; As soon as I enable an index through the precommit-hook on a bucket, I am
&gt; getting a 403 response back
&gt; for any PUT or POST operation that does not use the content type
&gt; "text/plain".
&gt; This seems a bit off to me that riak-search is able to introspect both
&gt; application/xml and application/json, but
&gt; will not accept content declared to be of these MIME types.
&gt; I am getting errors
&gt;
&gt; Having accepted this for the time being, I have gone ahead to import some
&gt; test documents into riak-search and
&gt; attempt to query the index.
&gt;
&gt; This is the format of my test documents:
&gt;
&gt; xml version="1.0"?
&gt; 
&gt; NUR-X5-199-456
&gt; 
&gt; NN-CUST-7278
&gt; NN-CUST-9619
&gt; NN-CUST-699
&gt; NN-CUST-8184
&gt; NN-SYS-2383
&gt; 
&gt; 
&gt;
&gt; Querying the index with q=EntityRef will give me all of the results back,
&gt; as expected.
&gt; However, attempting to use actual values to search, like so:
&gt; q=EntityRef:NUR-X5-199-456
&gt; gives me nothing.
&gt;
&gt; I have also stored the sample XML from the wiki in the same bucket, and yes
&gt; - a query for
&gt; q=name:Alyssa%20P.%20Hacker does indeed return \_that\_ document.
&gt;
&gt; I am completely new to Riak, so what I know I've learned through this
&gt; experiment and reading up
&gt; on the wiki (which, alas, does not indulge in detail), which has left me
&gt; with having to do some
&gt; guesswork to get me this far.
&gt;
&gt; Any feedback & help on what I might be doing wrong, would be greatly
&gt; appreciated.
&gt;
&gt; Thanks / Sven
&gt;
&gt; --
&gt; Sven Johansson
&gt; Phone: +46704966945
&gt; Twitter: @svjson
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

