---
title: "Re: riak-users Digest, Vol 42, Issue 12"
description: ""
project: community
lastmod: 2013-01-09T16:49:10-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09778"
author_name: "Julio Cesar RÃ­os Gutierrez"
project_section: "mailinglistitem"
sent_date: 2013-01-09T16:49:10-08:00
---


sorry, for the previuos message. I do not describe my problem.

this is my problem.

in the to\_pdf function do not arrive name\_file with value, arrive empty,
and after process\_post, It process "init" again, why this happend?

io:format(Name\_File), %%Print empty string

but

in this line I do this.

Ctx2 = Ctx#context{name\_file = binary\_to\_list(Nombre)},

and Nombre contain string value.


Why this happend?

Why do not arrives with values?



-module(rptPedidos\_resource).
-export([init/1, allowed\_methods/2, process\_post/2]).
-export([content\_types\_provided/2,to\_pdf/2]).

-record ( context, {root, name\_file } ).

-include\_lib("webmachine/include/webmachine.hrl").

%%init([]) -&gt; {ok, undefined}.
init(Config)-&gt;
%%{{trace, "/tmp"}, Config}.
%%{{trace,"/tmp"},
#context{root=proplists:get\_value(root,Config),name\_file=""}}.
{ok, #context{root=proplists:get\_value(root,Config),name\_file=""}}.

allowed\_methods ( RD, Ctx )-&gt; {['POST','GET','HEAD'], RD, Ctx}.

content\_types\_provided ( RD, Ctx )-&gt; {[{"application/pdf",to\_pdf}], RD, Ctx
}.

to\_pdf ( RD, #context { root = Root, name\_file = Name\_File } = Ctx )-&gt;
 io:format(Name\_File),
Ruta = string:concat("/root/sicap-rpt/reports/", Name\_File),
 io:format(Ruta),
Ruta1 = string:concat ( Ruta, ".pdf" ),

io:format(Ruta1),

%%{ok, Body} = file:read\_file ( "/root/sicap-rpt/reports/" ++ Name\_File ++
".pdf" ),
%%{ok, Body} = file:read\_file ("/root/sicap-rpt/reports/tttt.pdf"),

{ok, Body} = file:read\_file ( Ruta1 ),

{Body, RD, Ctx}.


process\_post ( RD, Ctx )-&gt;
 Data = mochiweb\_util:parse\_qs ( wrq:req\_body ( RD ) ),

Struct = mochijson2:decode ( proplists:get\_value ( "json", Data ) ),
Struct2 = proplists:get\_value ( "json", Data ),
{struct, [{ &lt;&lt;"nombre"&gt;&gt;, Nombre }]} = Struct,

RD1 = wrq:set\_resp\_header ( "Content-Disposition", "application/pdf", RD ),

%%print\_pdf:print ( binary\_to\_list ( Nombre ) ),

print\_pdf:print(binary\_to\_list(Nombre),"programa",
"01/12/2012","31/12/2012" ),

Ctx2 = Ctx#context{name\_file = binary\_to\_list(Nombre)},

%%{true, RD1, Ctx#context{name\_file=Nombre}}.
{true, RD1, Ctx2}.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

