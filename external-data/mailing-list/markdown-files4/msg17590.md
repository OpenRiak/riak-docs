---
title: "Re: Need help with Riak-KV (2.1.4) certificate based authentication	using Java client"
description: ""
project: community
lastmod: 2016-08-25T17:54:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17590"
mailinglist_parent_id: "msg17589"
author_name: "Jonathan Joseph"
project_section: "mailinglistitem"
sent_date: 2016-08-25T17:54:22-07:00
---


Try adding the following Java property setting when launching your java
client in order to see SSL Handshake related debug information:

-Djavax.net.debug=ssl:handshake

Or to see all ssl related debug output:

-Djavax.net.debug=ssl



On Thu, Aug 25, 2016 at 4:24 PM, Nguyen, Kyle 
wrote:

&gt; Hi all,
&gt;
&gt;
&gt;
&gt; I was trying to implement client certificate based authentication
&gt; following http://docs.basho.com/riak/kv/2.1.4/using/security/basics/ but
&gt; kept getting the following SSL Handshake exception. I believe I have the
&gt; client keystore, truststore and riak server cert/key setup properly. Both
&gt; client cert and riak server cert are signed with the same CA. Any advice
&gt; and suggestions will be greatly appreciated!
&gt;
&gt;
&gt;
&gt; 2016-08-25 12:53:24 DEBUG InternalLoggerFactory:71 - Using SLF4J as the
&gt; default logging framework
&gt;
&gt; 2016-08-25 12:53:24 DEBUG MultithreadEventLoopGroup:76 -
&gt; -Dio.netty.eventLoopThreads: 16
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent0:76 - java.nio.Buffer.address:
&gt; available
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent0:76 -
&gt; sun.misc.Unsafe.theUnsafe: available
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent0:71 -
&gt; sun.misc.Unsafe.copyMemory: available
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent0:76 - java.nio.Bits.unaligned:
&gt; true
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:71 - Platform: Windows
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:76 - Java version: 8
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:76 - -Dio.netty.noUnsafe: false
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:76 - sun.misc.Unsafe: available
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:76 - -Dio.netty.noJavassist:
&gt; false
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:71 - Javassist: unavailable
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:71 - You don't have Javassist
&gt; in your class path or you don't have enough permission to load dynamically
&gt; generated classes. Please check the configuration for better performance.
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:76 - -Dio.netty.tmpdir:
&gt; C:\apache-tomcat-7.0.54\temp (java.io.tmpdir)
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:76 - -Dio.netty.bitMode: 64
&gt; (sun.arch.data.model)
&gt;
&gt; 2016-08-25 12:53:24 DEBUG PlatformDependent:76 -
&gt; -Dio.netty.noPreferDirect: false
&gt;
&gt; 2016-08-25 12:53:24 DEBUG NioEventLoop:76 - -Dio.netty.noKeySetOptimization:
&gt; false
&gt;
&gt; 2016-08-25 12:53:24 DEBUG NioEventLoop:76 - 
&gt; -Dio.netty.selectorAutoRebuildThreshold:
&gt; 512
&gt;
&gt; 2016-08-25 12:53:24 INFO RiakJKSConnection:73 - initializeRiak Cluster is
&gt; OK
&gt;
&gt; 2016-08-25 12:53:24 DEBUG ThreadLocalRandom:71 - 
&gt; -Dio.netty.initialSeedUniquifier:
&gt; 0xac658e47a52a7794 (took 3 ms)
&gt;
&gt; 2016-08-25 12:53:24 DEBUG ByteBufUtil:76 - -Dio.netty.allocator.type:
&gt; unpooled
&gt;
&gt; 2016-08-25 12:53:24 DEBUG ByteBufUtil:76 - 
&gt; -Dio.netty.threadLocalDirectBufferSize:
&gt; 65536
&gt;
&gt; 2016-08-25 12:53:24 DEBUG ByteBufUtil:76 - 
&gt; -Dio.netty.maxThreadLocalCharBufferSize:
&gt; 16384
&gt;
&gt; 2016-08-25 12:53:24 DEBUG RiakNode:762 - Using TLSv1.2
&gt;
&gt; 2016-08-25 12:53:24 DEBUG RiakSecurityDecoder:166 - Handler Added
&gt;
&gt; 2016-08-25 12:53:24 DEBUG RiakNode:777 - Waiting on SSL Promise
&gt;
&gt; 2016-08-25 12:53:24 DEBUG AbstractByteBuf:81 - 
&gt; -Dio.netty.buffer.bytebuf.checkAccessible:
&gt; true
&gt;
&gt; 2016-08-25 12:53:24 DEBUG ResourceLeakDetector:81 -
&gt; -Dio.netty.leakDetection.level: simple
&gt;
&gt; 2016-08-25 12:53:24 DEBUG ResourceLeakDetector:81 -
&gt; -Dio.netty.leakDetection.maxRecords: 4
&gt;
&gt; 2016-08-25 12:53:24 DEBUG Recycler:76 - 
&gt; -Dio.netty.recycler.maxCapacity.default:
&gt; 262144
&gt;
&gt; 2016-08-25 12:53:24 DEBUG Cleaner0:76 - java.nio.ByteBuffer.cleaner():
&gt; available
&gt;
&gt; 2016-08-25 12:53:24 DEBUG RiakSecurityDecoder:69 - RiakSecurityDecoder
&gt; decode
&gt;
&gt; 2016-08-25 12:53:24 DEBUG RiakSecurityDecoder:93 - Received
&gt; MSG\_RpbStartTls reply
&gt;
&gt; 2016-08-25 12:53:24 ERROR RiakSecurityDecoder:230 - SSL Handshake failed:
&gt;
&gt; java.nio.channels.ClosedChannelException
&gt;
&gt; 2016-08-25 12:53:24 ERROR RiakNode:787 - Failure during Auth;
&gt; 127.0.0.1:8087 java.nio.channels.ClosedChannelException
&gt;
&gt; 2016-08-25 12:53:24 DEBUG RiakSecurityDecoder:181 - Channel Inactive
&gt;
&gt;
&gt;
&gt; RiakNode builder setup:
&gt;
&gt;
&gt;
&gt; \*public\* \*static\* RiakCluster getRiakCluster(String riakUserName, String
&gt; userPassword, String storePath, String storePasswd, String keyPasswd)
&gt; \*throws\* UnknownHostException{
&gt;
&gt;
&gt;
&gt; KeyStore keyStore = \*loadKeystore\*(storePath,storePasswd);
&gt;
&gt; //riak with one node
&gt;
&gt; RiakNode.Builder builder = \*new\* RiakNode.Builder().
&gt; withRemoteAddress("127.0.0.1").withRemotePort(8087);
&gt;
&gt; builder.withAuth(riakUserName, userPassword, \*trustStore\*, keyStore,
&gt; keyPasswd);
&gt;
&gt; builder.withConnectionTimeout(30000);
&gt;
&gt; RiakCluster cluster = \*cluster = new
&gt; RiakCluster.Builder(builder.build()).build();\*
&gt;
&gt; \* cluster.start();\*
&gt;
&gt; \*return\* cluster;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; Thanks
&gt;
&gt;
&gt;
&gt; -Kyle-
&gt;
&gt; ------------------------------
&gt; The information contained in this message may be confidential and legally
&gt; protected under applicable law. The message is intended solely for the
&gt; addressee(s). If you are not the intended recipient, you are hereby
&gt; notified that any use, forwarding, dissemination, or reproduction of this
&gt; message is strictly prohibited and may be unlawful. If you are not the
&gt; intended recipient, please contact the sender by return e-mail and destroy
&gt; all copies of the original message.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

