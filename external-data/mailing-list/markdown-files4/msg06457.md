---
title: "Re: RIAK all_nodes_down error"
description: ""
project: community
lastmod: 2012-01-30T07:46:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06457"
mailinglist_parent_id: "msg06456"
author_name: "Marcel Müller"
project_section: "mailinglistitem"
sent_date: 2012-01-30T07:46:14-08:00
---


Thanks that was the solution 

Marcel 

Am 30.01.2012 um 16:33 schrieb Sean Cribbs:

&gt; Marcel,
&gt; 
&gt; It looks like you have a screwed up ring. You have two nodes joining and no 
&gt; valid nodes, meaning the one owning the original ring is gone (not even just 
&gt; down, but nonexistent). You probably started a node, changed its node name in 
&gt; vm.args and then restarted it. Because the ring has already been written, it 
&gt; thinks the new node name owns 0 partitions, while the one that it was before, 
&gt; owns them all.
&gt; 
&gt; To fix both of these problems, you need to stop all nodes, delete the ring 
&gt; files (on Linux, /var/lib/riak/ring/\*), start them back up, and rejoin them.
&gt; 
&gt; On Mon, Jan 30, 2012 at 10:15 AM, Marcel Müller  
&gt; wrote:
&gt; hi Sean, 
&gt; 
&gt; [root@prd-uk-ras-002 ~]# riak-admin member\_status
&gt; Attempting to restart script through sudo -u riak
&gt; ================================= Membership 
&gt; ==================================
&gt; Status Ring Pending Node
&gt; -------------------------------------------------------------------------------
&gt; joining 0.0% -- 'riak@10.10.13.4'
&gt; joining 0.0% -- 'riak@10.10.13.5'
&gt; -------------------------------------------------------------------------------
&gt; Valid:0 / Leaving:0 / Exiting:0 / Joining:2 / Down:0
&gt; 
&gt; [root@prd-uk-ras-002 ~]# riak-admin ring\_status
&gt; Attempting to restart script through sudo -u riak
&gt; ================================== Claimant 
&gt; ===================================
&gt; Claimant: 'riak@127.0.0.1'
&gt; Status: down
&gt; Ring Ready: unknown
&gt; 
&gt; ============================== Ownership Handoff 
&gt; ==============================
&gt; No pending changes.
&gt; 
&gt; ============================== Unreachable Nodes 
&gt; ==============================
&gt; The following nodes are unreachable: ['riak@127.0.0.1']
&gt; 
&gt; WARNING: The cluster state will not converge until all nodes
&gt; are up. Once the above nodes come back online, convergence
&gt; will continue. If the outages are long-term or permanent, you
&gt; can either mark the nodes as down (riak-admin down NODE) or
&gt; forcibly remove the nodes from the cluster (riak-admin
&gt; force-remove NODE) to allow the remaining nodes to settle.
&gt; [root@prd-uk-ras-002 ~]# 
&gt; 
&gt; Thanks
&gt; Marcel 
&gt; 
&gt; Am 30.01.2012 um 16:04 schrieb Sean Cribbs:
&gt; 
&gt;&gt; Marcel,
&gt;&gt; 
&gt;&gt; What is the output of `riak-admin member\_status` and `riak-admin 
&gt;&gt; ring\_status`?
&gt;&gt; 
&gt;&gt; On Mon, Jan 30, 2012 at 10:02 AM, Marcel Müller  
&gt;&gt; wrote:
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; i had install riak via rpm -i riak-1.0.3-1.el5.x86\_64.rpm.
&gt;&gt; Start riak without any problems. Cool !
&gt;&gt; 
&gt;&gt; When i try to insert something via PUT:
&gt;&gt; 
&gt;&gt; [prd-uk-ras-002 ~]# curl -v -X PUT -d 'data1' 
&gt;&gt; http://10.10.13.4:8098/buckets/persons/keys/bosse
&gt;&gt; \* About to connect() to 10.10.13.4 port 8098
&gt;&gt; \* Trying 10.10.13.4... connected
&gt;&gt; \* Connected to 10.10.13.4 (10.10.13.4) port 8098
&gt;&gt; &gt; PUT /buckets/persons/keys/bosse HTTP/1.1
&gt;&gt; &gt; User-Agent: curl/7.15.5 (x86\_64-redhat-linux-gnu) libcurl/7.15.5 
&gt;&gt; &gt; OpenSSL/0.9.8b zlib/1.2.3 libidn/0.6.5
&gt;&gt; &gt; Host: 10.10.13.4:8098
&gt;&gt; &gt; Accept: \*/\*
&gt;&gt; &gt; Content-Length: 5
&gt;&gt; &gt; Content-Type: application/x-www-form-urlencoded
&gt;&gt; &gt;
&gt;&gt; &gt; data1HTTP/1.1 500 Internal Server Error
&gt;&gt; &lt; Vary: Accept-Encoding
&gt;&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt;&gt; &lt; Date: Mon, 30 Jan 2012 14:57:36 GMT
&gt;&gt; &lt; Content-Type: text/plain
&gt;&gt; &lt; Content-Length: 22
&gt;&gt; Error:
&gt;&gt; all\_nodes\_down
&gt;&gt; \* Connection #0 to host 10.10.13.4 left intact
&gt;&gt; \* Closing connection #0
&gt;&gt; 
&gt;&gt; I receive the error: all\_nodes\_down
&gt;&gt; 
&gt;&gt; but risk-admin status told me
&gt;&gt; 
&gt;&gt; nodename : 'riak@10.10.13.4'
&gt;&gt; connected\_nodes : ['riak@10.10.13.5','riak@10.10.13.3']
&gt;&gt; sys\_driver\_version : &lt;&lt;"1.5"&gt;&gt;
&gt;&gt; sys\_global\_heaps\_size : 0
&gt;&gt; sys\_heap\_type : private
&gt;&gt; sys\_logical\_processors : 1
&gt;&gt; sys\_otp\_release : &lt;&lt;"R14B03"&gt;&gt;
&gt;&gt; sys\_process\_count : 223
&gt;&gt; sys\_smp\_support : false
&gt;&gt; sys\_system\_version : &lt;&lt;"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [rq:1] 
&gt;&gt; [async-threads:64] [hipe] [kernel-poll:true]"&gt;&gt;
&gt;&gt; sys\_system\_architecture : &lt;&lt;"x86\_64-unknown-linux-gnu"&gt;&gt;
&gt;&gt; sys\_threads\_enabled : true
&gt;&gt; sys\_thread\_pool\_size : 64
&gt;&gt; sys\_wordsize : 8
&gt;&gt; ring\_members : ['riak@10.10.13.4','riak@10.10.13.5']
&gt;&gt; 
&gt;&gt; Can you help me ? What is wrong ?
&gt;&gt; 
&gt;&gt; Thanks
&gt;&gt; Marcel
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; Sean Cribbs 
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

