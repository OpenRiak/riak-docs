---
title: "Re: riaksearch sort, start, and rows"
description: ""
project: community
lastmod: 2011-02-27T22:25:58-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02488"
mailinglist_parent_id: "msg02487"
author_name: "Gary William Flake"
project_section: "mailinglistitem"
sent_date: 2011-02-27T22:25:58-08:00
---


Ack. I know what's happening with this. Riaksearch is sorting by
relevance, segmenting the results according to start and rows, and THEN
sorting by the sort key.

Is this the intended behavior? If so, I am kind of surprised because the
post sort is easy for the caller to do without Riaksearch's help. What's
hard is the pre-sort.

I suppose the work around is to get all of the results, then send the result
to map/reduce to correctly handle pre-sort, then filter by range. However,
before I do this, does anyone know if (a) this is considered broken? and (b)
if so, is this scheduled to be fixed?

Thanks,
-- GWF



On Sun, Feb 27, 2011 at 10:17 PM, Gary William Flake  wrote:

&gt; While coding up a front-end to paginate over a set of search results, I
&gt; think I found a bug whereby the result set is incorrectly segmented as a
&gt; function of the sort key, the start index, and the row count. In the output
&gt; that follows, I am using the field ctime for sort order, and the value of
&gt; delta is simply the difference between subsequent ctime values (which I was
&gt; checking in order to debug what was happening).
&gt;
&gt; First, lets ask for just the first result:
&gt;
&gt; GET
&gt;&gt; /solr/clips/select?q=user%3Ad33af3cca29a43e63e8f6a52dfdd99a61f7b7906%20AND%20private%3A1&start=0&rows=1&wt=json&sort=ctime
&gt;
&gt;
&gt;&gt; title: weather flagler beach - Google Search
&gt;
&gt; ctime: 98701733411258
&gt;
&gt; delta: 0
&gt;
&gt; ----------
&gt;
&gt;
&gt;
&gt; Now, let's do the same query, but get the top three instead:
&gt;
&gt; GET
&gt;&gt; /solr/clips/select?q=user%3Ad33af3cca29a43e63e8f6a52dfdd99a61f7b7906%20AND%20private%3A1&start=0&rows=3&wt=json&sort=ctime
&gt;
&gt;
&gt;&gt; title: Amazon.com: knives
&gt;
&gt; ctime: 98701733349673
&gt;
&gt; delta: 0
&gt;
&gt; ----------
&gt;
&gt; title: weather flagler beach - Google Search
&gt;
&gt; ctime: 98701733411258
&gt;
&gt; delta: 61585
&gt;
&gt; ----------
&gt;
&gt; title: Bartholdi on spacefilling curves
&gt;
&gt; ctime: 98701733465867
&gt;
&gt; delta: 54609
&gt;
&gt; ----------
&gt;
&gt;
&gt;
&gt; Notice that we have a new 'top' result. Finally, let's get all of the
&gt; results by setting row to something large, but I'll only show the first
&gt; result because that's all you need to see:
&gt;
&gt; GET
&gt;&gt; /solr/clips/select?q=user%3Ad33af3cca29a43e63e8f6a52dfdd99a61f7b7906%20AND%20private%3A1&start=0&rows=1000&wt=json&sort=ctime
&gt;
&gt;
&gt;&gt; title: HTTP cookie - Wikipedia, the free encyclopedia
&gt;
&gt; ctime: 98701587317266
&gt;
&gt; delta: 0
&gt;
&gt; ----------
&gt;
&gt;
&gt;
&gt; We now get a record that we haven't seen yet.
&gt;
&gt;
&gt; I can confirm that when I get all of the results, they are in the properly
&gt; sorted order. I also believe that any of my smaller result sets are also in
&gt; proper sort order. However, it also appears that when I ask for a specific
&gt; number of row with a non-zero start start value, then the start index is not
&gt; handled correctly. FWIW, these results don't' have anything to do with the
&gt; client library because I reproduced them over the REST interface.
&gt;
&gt; Any ideas?
&gt;
&gt; -- GWF
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

