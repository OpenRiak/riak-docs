---
title: "Re: efficient fetching of values falling in a key range"
description: ""
project: community
lastmod: 2012-01-30T10:42:25-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06461"
mailinglist_parent_id: "msg06459"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2012-01-30T10:42:25-08:00
---



On 30 Jan 2012, at 18:12, Dietrich Featherston wrote:

&gt; I'm using a leveldb-backed riak 1.0.2 and looking for some suggestions to 
&gt; fetch a block of data by key range. I have control over the keys and all 
&gt; reads out of this setup will involve at minimum a key range. It seems that if 
&gt; leveldb is an ideal candidate for this kind of access pattern so long as I'm 
&gt; able to take advantage of that in the APIs exposed by riak.
&gt; 
&gt; First thought is to use the built-in $key index to do a query for the keys 
&gt; falling in a range, then fetch the underlying objects (either directly or via 
&gt; a map job). Doesn't look like this is yielding any results for a range known 
&gt; to contain data, however.
&gt; 
&gt; Doing something like the following in the Java API yields no data
&gt; 
&gt; val keys = 
&gt; bucket.fetchIndex(BinIndex.named("$key")).from(startKey).to(endKey).execute();
&gt; 
&gt; Whereas the same question phrased as a keyfilter map job does yield data
&gt; 
&gt; riak.mapReduce(query)
&gt; .addKeyFilter(new BetweenFilter(startKey, endKey))
&gt; .addMapPhase(new NamedErlangFunction("riak\_kv\_mapreduce", 
&gt; "map\_object\_value"), true)
&gt; .execute() 
&gt; 
&gt; Perhaps there is something I need to do to make sure the $key index is built 
&gt; other than using the leveldb backend, but I couldn't find any evidence of 
&gt; that in the docs.
&gt; 
&gt; Does this seem like a reasonable approach? If so, any thoughts on how I might 
&gt; be reading the key index incorrectly?

It is a bug/oversight in the RJC, when you do BinIndex.named("$key"), you'll 
get an index called "$key\_bin", which isn't the name of the index you want. 
I'll raise a bug for it and get a patch out. I think the best bet is to have a 
tagged type (KeyIndex ?) rather than change the way that BinIndex/IntIndex 
work. Sound ok?

Cheers

Russell

&gt; 
&gt; Thanks,
&gt; D
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

