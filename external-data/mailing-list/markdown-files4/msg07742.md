---
title: "Re: Riak Cluster Crash down on heavy load Benchmarking"
description: ""
project: community
lastmod: 2012-06-22T04:38:30-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07742"
mailinglist_parent_id: "msg07724"
author_name: "Amol Rajoba"
project_section: "mailinglistitem"
sent_date: 2012-06-22T04:38:30-07:00
---


Hi Guys,

I have 3 more queries, I hope I am not troubling you guys much.

1. As LevelDB keeps keys and values in a block cache, how it does the
management of key spaces that are larger than available memory? like in
memcached/redis LRU is used for memory management, here in leveldb how
block cache gets managed?

2. if at start i have 2 nodes and i set n\_val of 2, can I change n\_val to 3
after adding 3rd node without making cluster down?

3. What are the chances/probability of cluster failure for 2 node cluster
with n\_val of 2? I will be increasing cluster size on the availability of
new nodes and n\_val as well.

Thanks for the help guys.
Amol Rajoba


On Wed, Jun 20, 2012 at 8:46 PM, Amol Rajoba  wrote:

&gt; Thanks Guys.
&gt;
&gt; And I did try with default eleveldb configuration and it worked very well,
&gt; Thanks. I am now thinking of migration from cassandra to riak.
&gt; At start I thought that giving more write\_buffer\_size will help in write
&gt; performance like it happens in cassandra.
&gt;
&gt; I have 3 more queries, I hope I am not troubling you guys much:
&gt;
&gt; 1. As LevelDB keeps keys and values in a block cache, how it does the
&gt; management of key spaces that are larger than available memory? like in
&gt; memcached/redis LRU is used for memory management, here in leveldb how
&gt; block cache gets managed?
&gt;
&gt; 2. if at start i have 2 nodes and i set n\_val of 2, can I change n\_val to
&gt; 3 after adding 3rd node without making cluster down?
&gt;
&gt; 3. What are the chances/probability of cluster failure for 2 node cluster
&gt; with n\_val of 2? I will be increasing cluster size on the availability of
&gt; new nodes and n\_val as well.
&gt;
&gt; Thanks for the help guys.
&gt; Amol Rajoba
&gt;
&gt;
&gt; On Wed, Jun 20, 2012 at 12:23 AM, Daniel Reverri  wrote:
&gt;
&gt;&gt; Hi Amol,
&gt;&gt;
&gt;&gt; What motivated the eleveldb configuration changes in app.config? Have you
&gt;&gt; evaluated performance using the default configuration values?
&gt;&gt;
&gt;&gt; The settings you modified are per vnode. A 2 node cluster, using the
&gt;&gt; default ring size of 64, has 32 vnodes per node. The chosen
&gt;&gt; write\_buffer\_size seems quite large. Can you retry your test using the
&gt;&gt; default configuration values?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Dan
&gt;&gt;
&gt;&gt; --
&gt;&gt; Daniel Reverri
&gt;&gt; Architect
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt;
&gt;&gt; On Tuesday, June 19, 2012 at 10:51 AM, Mark Phillips wrote:
&gt;&gt;
&gt;&gt; Hi Amol,
&gt;&gt;
&gt;&gt; It looks like you're out of RAM. One of the offending entries from your
&gt;&gt; log:
&gt;&gt;
&gt;&gt; 2012-06-15 19:09:31.777 [error] &lt;0.20970.188&gt; gen\_server &lt;0.20970.188&gt;
&gt;&gt; terminated with reason:
&gt;&gt; {mem\_error,[{zlib,call,3},{zlib,zip,1},{riak\_kv\_pb\_socket,process\_message,2},{riak\_kv\_pb\_socket,handle\_info,2},{gen\_server2,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
&gt;&gt;
&gt;&gt; Is there any any chance you could add a machine or two and to the cluster
&gt;&gt; and run the test gain?
&gt;&gt;
&gt;&gt; Mark
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Jun 18, 2012 at 11:34 PM, Amol Rajoba wrote:
&gt;&gt;
&gt;&gt; Hi Guys,
&gt;&gt;
&gt;&gt; Can anybody help here?
&gt;&gt;
&gt;&gt; Also found that due to continuous put operation beam.smp taking 2.9G RAM,
&gt;&gt; what could be reason of this?
&gt;&gt;
&gt;&gt; Thanks.
&gt;&gt; Amol Rajoba
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

