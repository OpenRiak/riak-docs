---
title: "Fwd: newly created object not found under heavy load"
description: ""
project: community
lastmod: 2011-10-20T13:40:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05220"
mailinglist_parent_id: "msg05219"
author_name: "Joseph Blomstedt"
project_section: "mailinglistitem"
sent_date: 2011-10-20T13:40:55-07:00
---


Ivaylo,

If you're using R=1 and W=quorum then this is entirely possible. Given
these settings an incoming write is only guaranteed to hit
floor(N/2+1) nodes. If N=3, that would be 2 nodes. However, with R=1,
you are only waiting for 1 reply before responding, which may not be
one of the 2 nodes in the quorum. Reads/writes eventually propagate to
all replicas though, and read-repair is initiated if necessary; hence
why the results are fine after a delay. Standard eventual consistency.

To prevent this behavior, you need to have R+W &gt; N. R=1, W=all is one
N-independent option. Or, in the case of N=3, R=1, W=3; R=2, W=2; and
R=3, W=1 would all be valid options depending on your desired
read/write latency requirements.

Regards,
Joe

On Thu, Oct 20, 2011 at 2:26 PM, Ivaylo Panitchkov
 wrote:
&gt; Hello,
&gt;
&gt; We are close to production and noticed that from time to time under heavy
&gt; load newly created objects are not available immediately after their
&gt; creation. I'm running Riak 1.0.0.rc2 under Ubuntu 11.04. allow\_mult: false,
&gt; last\_write\_wins: true, r: 'one', w: 'quorum'. Cluster of three machines with
&gt; 1GB RAM each. The same situation on Joyent's smart machine. If there is a
&gt; slight delay between the actual creation and the next read everything is ok.
&gt;
&gt; Ivaylo
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



--
Joseph Blomstedt 
Software Engineer
Basho Technologies, Inc.
http://www.basho.com/



-- 
Joseph Blomstedt 
Software Engineer
Basho Technologies, Inc.
http://www.basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

