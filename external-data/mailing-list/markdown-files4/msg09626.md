---
title: "Re: Riak handling of mismatched n_val within cluster"
description: ""
project: community
lastmod: 2012-12-18T15:17:57-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09626"
mailinglist_parent_id: "msg09590"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-12-18T15:17:57-08:00
---


Hey David,

So the short answer is that we don't have anything in place that will
complain wildly if this happens. This, however, should not be the
case. Before I go file an issue, out of curiosity, how did this
happen? Did you set the n\_val differently in the app.config of each
node before you started them up?

Mark


On Fri, Dec 14, 2012 at 8:03 PM, David Lowell  wrote:
&gt; I know this is really very boneheaded. But we ended up with n\_val being 3 on
&gt; one of two riak hosts in a dev cluster, and 1 on the other host. I would
&gt; have expected Riak to howl loudly about this, but it said nothing. In fact,
&gt; we discovered the problem while debugging app-level issues that resulted
&gt; from this configuration.
&gt;
&gt; We found that on the two hosts, the same 2i query returned wildly different
&gt; results. As we investigated we discovered that on the host with n=1, riak
&gt; was returning each key 3 times. On the host with n=3, each key was in the 2i
&gt; results once.
&gt;
&gt; Maybe this makes sense at some low level, but I sure would have preferred
&gt; something in the logs, or even a riak crash to this behavior.
&gt;
&gt; Once we corrected n\_val on the errant host, both hosts returned each key 3x.
&gt; Is it possible for riak to recover from this situation and eventually return
&gt; the correct 2i results with each key listed only once?
&gt;
&gt; This is a dev cluster, so this isn't critical. But I'd like to understand
&gt; better whether and how riak can recover from this weird state.
&gt;
&gt; Thanks,
&gt;
&gt; Dave
&gt;
&gt; --
&gt; Dave Lowell
&gt; d...@connectv.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

