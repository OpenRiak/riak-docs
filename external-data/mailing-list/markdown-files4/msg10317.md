---
title: "Riak vnodes not available"
description: ""
project: community
lastmod: 2013-03-05T03:37:32-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10317"
author_name: "Daniel Iwan"
project_section: "mailinglistitem"
sent_date: 2013-03-05T03:37:32-08:00
---


Hi

In our test setup (3 nodes) we've changed number of vnodes from default 64
to 512.

We've noticed increased riak start up time (by 7 seconds) and failures in
our test framework due to that. Our test framework wipes Riak cluster and
recreates it, and then our application starts.

Application (each server) loads some keys on start via local riak node
using 127.0.0.1 interface ,
Most queries are on buckets with default N=3 and quorum 2.

Since we've changed to 512 vnodes, we get:

Unable to retrieve the riak object! com.google.protobuf.ByteString@1a292c9d,
com.google.protobuf.ByteString@3e62f0b1
com.basho.riak.pbc.RiakError: {insufficient\_vnodes,0,need,2}
 at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:125)
 at com.basho.riak.pbc.RiakClient.processFetchReply(RiakClient.java:282)
 at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:275)

This is true both for Riak 1.2.1 and 1.3
So obviously nodes are not ready (or in the middle of vnode transfer?).

This happens not only during cluster set up but also after reboot.
What is the correct approach to make sure nodes are ready and Riak service
is fully up and running and can take request?
SInce our app depends on Riak we need to somehow make sure Riak is ready
before our services start.


Daniel
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

