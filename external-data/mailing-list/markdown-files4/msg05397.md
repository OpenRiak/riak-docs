---
title: "Re: Riak 1.0.1 w/search nodes crashing"
description: ""
project: community
lastmod: 2011-10-31T14:38:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05397"
mailinglist_parent_id: "msg05395"
author_name: "Gordon Tillman"
project_section: "mailinglistitem"
sent_date: 2011-10-31T14:38:48-07:00
---


Thank you Kelly,

I will pass this on to the engineer that reported this to me and see if this 
gets things sorted out.

Reindexing is no problem -- we can just wipe the index bucket and trigger a map 
operation that invokes the appropriate function.

Regards,

--gordon

On Oct 31, 2011, at 15:47 , Kelly McLaughlin wrote:

&gt; Hi Gordon,
&gt; 
&gt; I'm looking at the info you provided about the problem and I suspect that it 
&gt; is related to your use of 90 as the ring creation size. We generally 
&gt; recommend the value to be a power of 2, though we do not explicitly enforce 
&gt; that in the code. If this is a development cluster the simplest path may be 
&gt; to wipe out all of the cluster data and ring information, change the 
&gt; ring\_creation\_size to 128 (for example) on each node, reform the cluster and 
&gt; reinsert the data. 
&gt; 
&gt; Another path to resolution is to use the riak-admin backup option to backup 
&gt; your data, change the ring\_creation\_size to 128, remove the existing ring 
&gt; data (i.e. the data/ring/ subdirectory where your riak data lives). Do this 
&gt; for each node in the cluster. Then restore the data on each node with 
&gt; riak-admin restore and rejoin the nodes to form a cluster again. 
&gt; Unfortuately, search data is not handled by the current backup and restore 
&gt; functionality so you will need to remove the search data from 
&gt; data/merge-index and then you will have to reindex your documents. Support 
&gt; for backup and restore of search data is coming, but it is just not there 
&gt; yet. Hope this helps.
&gt; 
&gt; Kelly
&gt; 
&gt; On Oct 28, 2011, at 12:46 PM, Gordon Tillman wrote:
&gt; 
&gt;&gt; Howdy Gang,
&gt;&gt; 
&gt;&gt; We have a 3 node Riak 1.0.1 with search enabled and are seeing the following 
&gt;&gt; errors in the Riak log file:
&gt;&gt; 
&gt;&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt;&gt; 2011-10-28 11:04:21.900 [error] &lt;0.993.0&gt; gen\_fsm &lt;0.993.0&gt; in state 
&gt;&gt; initialize terminated with reason: bad argument in call to erlang:hd([]) in 
&gt;&gt; riak\_core\_ring:index\_owner/2
&gt;&gt; 2011-10-28 11:04:21.906 [error] &lt;0.993.0&gt; CRASH REPORT Process &lt;0.993.0&gt; 
&gt;&gt; with 0 neighbours crashed with reason: bad argument in call to erlang:hd([]) 
&gt;&gt; in riak\_core\_ring:index\_owner/2
&gt;&gt; 2011-10-28 11:04:21.930 [error] &lt;0.257.0&gt; Supervisor riak\_kv\_keys\_fsm\_sup 
&gt;&gt; had child undefined started with 
&gt;&gt; {riak\_core\_coverage\_fsm,start\_link,undefined} at &lt;0.993.0&gt; exit with reason 
&gt;&gt; bad argument in call to erlang:hd([]) in riak\_core\_ring:index\_owner/2 in 
&gt;&gt; context child\_terminated
&gt;&gt; 
&gt;&gt; ==&gt; /var/log/riak/crash.log &lt;==
&gt;&gt; 2011-10-28 11:04:21 =ERROR REPORT====
&gt;&gt; \*\* State machine &lt;0.993.0&gt; terminating 
&gt;&gt; \*\* Last event in was timeout
&gt;&gt; \*\* When State == initialize
&gt;&gt; \*\* Data == 
&gt;&gt; {state,undefined,riak\_kv\_keys\_fsm,{state,plain,{raw,60225046,&lt;0.465.0&gt;}},3,riak\_kv,all,1,{'riak\_kv\_listkeys\_req\_v3',&lt;&lt;"queue"&gt;&gt;,none},60225046,undefined,0,60000,riak\_kv\_vnode\_master}
&gt;&gt; \*\* Reason for termination = 
&gt;&gt; \*\* 
&gt;&gt; {badarg,[{erlang,hd,[[]]},{riak\_core\_ring,index\_owner,2},{riak\_core\_coverage\_plan,'-create\_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak\_core\_coverage\_fsm,initialize,2},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
&gt;&gt; 2011-10-28 11:04:21 =CRASH REPORT====
&gt;&gt; crasher:
&gt;&gt; initial call: riak\_core\_coverage\_fsm:init/1
&gt;&gt; pid: &lt;0.993.0&gt;
&gt;&gt; registered\_name: []
&gt;&gt; exception exit: 
&gt;&gt; {badarg,[{erlang,hd,[[]]},{riak\_core\_ring,index\_owner,2},{riak\_core\_coverage\_plan,'-create\_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak\_core\_coverage\_fsm,initialize,2},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
&gt;&gt; in function gen\_fsm:terminate/7
&gt;&gt; in call from proc\_lib:init\_p\_do\_apply/3
&gt;&gt; ancestors: [riak\_kv\_keys\_fsm\_sup,riak\_kv\_sup,&lt;0.177.0&gt;]
&gt;&gt; messages: []
&gt;&gt; links: [&lt;0.257.0&gt;]
&gt;&gt; dictionary: []
&gt;&gt; trap\_exit: false
&gt;&gt; status: running
&gt;&gt; heap\_size: 4181
&gt;&gt; stack\_size: 24
&gt;&gt; reductions: 86192
&gt;&gt; neighbours:
&gt;&gt; 2011-10-28 11:04:21 =SUPERVISOR REPORT====
&gt;&gt; Supervisor: {local,riak\_kv\_keys\_fsm\_sup}
&gt;&gt; Context: child\_terminated
&gt;&gt; Reason: 
&gt;&gt; {badarg,[{erlang,hd,[[]]},{riak\_core\_ring,index\_owner,2},{riak\_core\_coverage\_plan,'-create\_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak\_core\_coverage\_fsm,initialize,2},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
&gt;&gt; Offender: 
&gt;&gt; [{pid,&lt;0.993.0&gt;},{name,undefined},{mfargs,{riak\_core\_coverage\_fsm,start\_link,undefined}},{restart\_type,temporary},{shutdown,5000},{child\_type,worker}]
&gt;&gt; 
&gt;&gt; 
&gt;&gt; ==&gt; /var/log/riak/erlang.log.3 &lt;==
&gt;&gt; 11:04:21.900 [error] gen\_fsm &lt;0.993.0&gt; in state initialize terminated with 
&gt;&gt; reason: bad argument in call to erlang:hd([]) in riak\_core\_ring:index\_owner/2
&gt;&gt; 11:04:21.906 [error] CRASH REPORT Process &lt;0.993.0&gt; with 0 neighbours 
&gt;&gt; crashed with reason: bad argument in call to erlang:hd([]) in 
&gt;&gt; riak\_core\_ring:index\_owner/2 
&gt;&gt; 11:04:21.930 [error] Supervisor riak\_kv\_keys\_fsm\_sup had child undefined 
&gt;&gt; started with {riak\_core\_coverage\_fsm,start\_link,undefined} at &lt;0.993.0&gt; exit 
&gt;&gt; with reason bad argument in call to erlang:hd([]) in 
&gt;&gt; riak\_core\_ring:index\_owner/2 in context child\_terminated
&gt;&gt; 
&gt;&gt; ==&gt; /var/log/riak/error.log &lt;==
&gt;&gt; 2011-10-28 11:04:21.900 [error] &lt;0.993.0&gt; gen\_fsm &lt;0.993.0&gt; in state 
&gt;&gt; initialize terminated with reason: bad argument in call to erlang:hd([]) in 
&gt;&gt; riak\_core\_ring:index\_owner/2
&gt;&gt; 2011-10-28 11:04:21.906 [error] &lt;0.993.0&gt; CRASH REPORT Process &lt;0.993.0&gt; 
&gt;&gt; with 0 neighbours crashed with reason: bad argument in call to erlang:hd([]) 
&gt;&gt; in riak\_core\_ring:index\_owner/2
&gt;&gt; 2011-10-28 11:04:21.930 [error] &lt;0.257.0&gt; Supervisor riak\_kv\_keys\_fsm\_sup 
&gt;&gt; had child undefined started with 
&gt;&gt; {riak\_core\_coverage\_fsm,start\_link,undefined} at &lt;0.993.0&gt; exit with reason 
&gt;&gt; bad argument in call to erlang:hd([]) in riak\_core\_ring:index\_owner/2 in 
&gt;&gt; context child\_terminated
&gt;&gt; 
&gt;&gt; Would anyone be able to clue me in as to the cause? I have the log snippet, 
&gt;&gt; status, and cluster info all available online.
&gt;&gt; 
&gt;&gt; LOG:
&gt;&gt; https://gist.github.com/1322665
&gt;&gt; 
&gt;&gt; STATUS:
&gt;&gt; https://gist.github.com/1322680
&gt;&gt; 
&gt;&gt; CLUSTER INFO:
&gt;&gt; 
&gt;&gt; This was to big to fit in a gist (1.7MB):
&gt;&gt; 
&gt;&gt; https://eval.mezeo.net/v2/files/A725C464-0194-11E1-9D55-0030485F2412/content/inline/cluster\_info.txt
&gt;&gt; 
&gt;&gt; Thanks a bunch!
&gt;&gt; 
&gt;&gt; --gordon
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

