---
title: "Re: update objects in precommit hooks"
description: ""
project: community
lastmod: 2011-04-01T06:23:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02828"
mailinglist_parent_id: "msg02821"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-04-01T06:23:37-07:00
---


Hi Damian,

The put FSM is being overhauled at the moment. The current 0.14.1 code does
not apply the updated values in precommit hooks. In my testing it worked
ok, but I think that is probably because there were already values present
in Riak and the changes were included at the vnode level.

You could try building from source on github, the branch the put FSM was
refactored on has been pulled in now. There is a QuickCheck test that
executes code that looks very similar to yours.

 MD = riak\_object:get\_metadata(Obj),
 UpdMD = dict:store(?MD\_USERMETA, [{"X-Riak-Meta-PrecommitHook","was
here"}], MD),
 riak\_object:update\_metadata(Obj, UpdMD).

I'd be very interested to hear if it resolves your problem.

BR, Jon.
Basho Technologies.

2011/4/1 Damian Dobroczy≈Ñski 

&gt; Hi, list!
&gt;
&gt; I'm trying to update object metadata dictionary within my precommit hook
&gt; (in Erlang) using `riak\_object:update\_metadata/2' like this:
&gt;
&gt; Old = riak\_object:get\_metadata(O),
&gt; New = dict:store(&lt;&lt;"X-my-metadata-name"&gt;&gt;, Value, Old),
&gt; NewObject = riak\_object:update\_metadata(O, New),
&gt;
&gt; Unfortunately, the retrieved object does not contain the new keys. Where
&gt; can be the problem?
&gt;
&gt; -- D.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

