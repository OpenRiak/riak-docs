---
title: "Re: Pass json as argument to mapreduce"
description: ""
project: community
lastmod: 2012-07-06T08:56:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07875"
mailinglist_parent_id: "msg07871"
author_name: "Mathias Meyer"
project_section: "mailinglistitem"
sent_date: 2012-07-06T08:56:43-07:00
---


Venki,

&gt;From what I gather you're trying to specify arguments directly as objects in 
&gt;the function's argument list? You reference the arg that's passed into the 
&gt;MapReduce request by declaring a third parameter variable, not by specifying 
&gt;an object: function(value, keydata, arg) {doSomethingWith(arg)}. Then you can 
&gt;reference the argument by way of that parameter.

Cheers, Mathias
http://riakhandbook.com





On Friday, 6. July 2012 at 08:40, Venki Yedidha wrote:

&gt; Thanks again,
&gt; I changed args to arg.
&gt; To keep it simple, I just want to use that arg parameter value 
&gt; {"gender":"G0,G1","
&gt; agegroups":"A0,A2","metrics":"users,cpc\_median","groupby":"country"} inside 
&gt; my javascript function.
&gt; 
&gt; If I try to assign it to a variable like:
&gt; 
&gt; var k = arg;
&gt; 
&gt; It is giving undefined variable arg.
&gt; 
&gt; On the other hand,
&gt; If I am trying to access this variable passing as a third parameter to 
&gt; function(v,k,{"",""})
&gt; It is also giving me error.
&gt; 
&gt; Please help me on the above.
&gt; 
&gt; Thanks,
&gt; Venkatesh
&gt; 
&gt; 
&gt; On Thu, Jul 5, 2012 at 9:07 PM, Mathias Meyer  (mailto:me...@paperplanes.de)&gt; wrote:
&gt; &gt; Venki,
&gt; &gt; 
&gt; &gt; The parameter name is arg not args. Also, you were talking about some sort 
&gt; &gt; of error you're getting, but I couldn't see one in the listing below.
&gt; &gt; 
&gt; &gt; Cheers, Mathias
&gt; &gt; http://riakhandbook.com
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; On Thursday, 5. July 2012 at 16:29, Venki Yedidha wrote:
&gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; I tried the format you sent me earlier but when I tried to access the 
&gt; &gt; &gt; args parameter inside the function, it is showing me the error:
&gt; &gt; &gt; 
&gt; &gt; &gt; {"inputs":['.$k.'],"query":[{"map":{"language":"javascript","source":"function(value,keydata,"arguments"){
&gt; &gt; &gt; var data = Riak.mapValuesJson(value)[0];
&gt; &gt; &gt; var obj = {};
&gt; &gt; &gt; obj[value.key] = {};
&gt; &gt; &gt; for(var i=1;i&lt;3;i++)
&gt; &gt; &gt; {
&gt; &gt; &gt; var gender = \"G\"+ i;
&gt; &gt; &gt; obj[value.key][gender] = {};
&gt; &gt; &gt; for(var j=1;j&lt;=6;j++)
&gt; &gt; &gt; {
&gt; &gt; &gt; var agegroup = \"A\" + j;
&gt; &gt; &gt; obj[value.key][gender][agegroup] = {};
&gt; &gt; &gt; obj[value.key][gender][agegroup][\"cpc\_median\"] = 
&gt; &gt; &gt; data[gender][j][agegroup][\"bid\_estimations\"][0][\"cpc\_median\"];
&gt; &gt; &gt; obj[value.key][gender][agegroup][\"users\"] = 
&gt; &gt; &gt; data[gender][j][agegroup][\"users\"];
&gt; &gt; &gt; 
&gt; &gt; &gt; }
&gt; &gt; &gt; }
&gt; &gt; &gt; return [obj];
&gt; &gt; &gt; }","args":{"gender":"G0,G1","agegroups":"A0,A2","metrics":"users,cpc\_median","groupby":"country"},"keep":true}}]}';
&gt; &gt; &gt; 
&gt; &gt; &gt; Please help me on the above.
&gt; &gt; &gt; 
&gt; &gt; &gt; To clarify my requirement, I would like to access the args parameter 
&gt; &gt; &gt; (before keep parameter) inside javascript function and if possible I 
&gt; &gt; &gt; would also like to know the flow that what is the need for args param 
&gt; &gt; &gt; after js function.
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Venkatesh.Y
&gt; &gt; &gt; 
&gt; &gt; &gt; On Wed, Jul 4, 2012 at 2:11 PM, Mathias Meyer  &gt; &gt; (mailto:me...@paperplanes.de) (mailto:me...@paperplanes.de)&gt; wrote:
&gt; &gt; &gt; &gt; Venki,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; You don't have to serialize the argument as a JSON string, it can 
&gt; &gt; &gt; &gt; simply be specified as a normal JSON data structure, just like the 
&gt; &gt; &gt; &gt; other data in the MapReduce request:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; curl -v -d '{"inputs":[["artists", "Beatles"]], 
&gt; &gt; &gt; &gt; "query":[{"map":{"language":"javascript","source":"function(v, k, a) 
&gt; &gt; &gt; &gt; {return [a];}","arg":{"paul": true}}}]}' -H "Content-Type: 
&gt; &gt; &gt; &gt; application/json" http://127.0.0.1:8098/mapred
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Cheers, Mathias
&gt; &gt; &gt; &gt; http://riakhandbook.com
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; On Wednesday, 4. July 2012 at 07:26, Venki Yedidha wrote:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Hi all,
&gt; &gt; &gt; &gt; &gt; I don't know why, I can't pass a json argument to map function.
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; "inputs":"[b1,k1],[b2,k2],[b3,k3]"
&gt; &gt; &gt; &gt; &gt; "query":[{map":{"language":"javascript","source":"function(value,keydata,args){}"
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; for the args parameter I need to pass json of the form:
&gt; &gt; &gt; &gt; &gt; {\"name\":\"venkatesh\",\"age\":24}
&gt; &gt; &gt; &gt; &gt; (escaped " for json)
&gt; &gt; &gt; &gt; &gt; but it showing missing variable name..
&gt; &gt; &gt; &gt; &gt; On the other, If I am passing an array, it is not showing the error...
&gt; &gt; &gt; &gt; &gt; Please help me on the above.
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Thanks,
&gt; &gt; &gt; &gt; &gt; Venkatesh
&gt; &gt; &gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com) 
&gt; &gt; &gt; &gt; &gt; (mailto:riak-users@lists.basho.com) 
&gt; &gt; &gt; &gt; &gt; (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; 
&gt; 




\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

