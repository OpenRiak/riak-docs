---
title: "Re: RIAK-CS crashing with many HEAD requests"
description: ""
project: community
lastmod: 2013-04-11T12:09:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10856"
mailinglist_parent_id: "msg10855"
author_name: "Silasi Stefan"
project_section: "mailinglistitem"
sent_date: 2013-04-11T12:09:22-07:00
---


Thanks Kelly. If you need test environment or more data, please let me know.

Thank you,
Stefan.


On Thu, Apr 11, 2013 at 8:57 PM, Kelly McLaughlin  wrote:

&gt; Stefan,
&gt;
&gt; I have been able to reproduce the problem you saw and I have opened a
&gt; github issue to address it here:
&gt; https://github.com/basho/riak\_cs/issues/532. Thanks again for the report
&gt; and we should have a fix for it pushed to github very soon.
&gt;
&gt; Kelly
&gt;
&gt;
&gt; On Wed, Apr 10, 2013 at 5:42 PM, Kelly McLaughlin  wrote:
&gt;
&gt;&gt; Stefan,
&gt;&gt;
&gt;&gt; Thanks for the report. We will investigate this and let you know what we
&gt;&gt; find.
&gt;&gt;
&gt;&gt; Kelly
&gt;&gt;
&gt;&gt; On Wed, Apr 10, 2013 at 5:05 AM, Silasi Stefan wrote:
&gt;&gt;
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; I'm testing RIAK-CS as an S3 alternative and I get some strange crashing
&gt;&gt;&gt; when reading data from it. The following is reproducible with each run of
&gt;&gt;&gt; the python script.
&gt;&gt;&gt;
&gt;&gt;&gt; conn = boto.connect\_s3(
&gt;&gt;&gt; aws\_access\_key\_id = access\_key,
&gt;&gt;&gt; aws\_secret\_access\_key = secret\_key,
&gt;&gt;&gt; host = riak\_host,
&gt;&gt;&gt; proxy = riak\_host,
&gt;&gt;&gt; proxy\_port = 8080,
&gt;&gt;&gt; calling\_format = boto.s3.connection.OrdinaryCallingFormat(),
&gt;&gt;&gt; debug = 2,
&gt;&gt;&gt; is\_secure = False,
&gt;&gt;&gt; )
&gt;&gt;&gt;
&gt;&gt;&gt; bucket = conn.create\_bucket('bucket\_name')
&gt;&gt;&gt;
&gt;&gt;&gt; for row in rows:
&gt;&gt;&gt; key=bucket.new\_key(valid\_key\_name)
&gt;&gt;&gt; if key.exists():
&gt;&gt;&gt; key.open\_read()
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; If I monitor the riak-cs memory usage, it is growing and growing until
&gt;&gt;&gt; it's using all RAM+SWAP, then it crashes.
&gt;&gt;&gt; In the console log, the following line is appended before RIAK-CS
&gt;&gt;&gt; crashes:
&gt;&gt;&gt;
&gt;&gt;&gt; 2013-04-10 08:28:40.802 [info] &lt;0.41.0&gt; alarm\_handler:
&gt;&gt;&gt; {set,{system\_memory\_high\_watermark,[]}}
&gt;&gt;&gt;
&gt;&gt;&gt; Nothing related in the error.log.
&gt;&gt;&gt; In access.log I see a lot of HEAD requests for the objects stored.
&gt;&gt;&gt;
&gt;&gt;&gt; Current architecture looks like this:
&gt;&gt;&gt; - 3 virtual machines with 4 cores, 4gb ram, 2gb swap and 1tb disk each
&gt;&gt;&gt; - RIAK installed on all of them, configured as cluster
&gt;&gt;&gt; - stanchion installed on all of them
&gt;&gt;&gt; - RIAK-CS installed on all of them, configured to "speak" only with
&gt;&gt;&gt; local RIAK
&gt;&gt;&gt; - about 10GB of data storred in each RIAK with N=3.
&gt;&gt;&gt;
&gt;&gt;&gt; The strange thing is that if I move the connect-to part in the FOR loop,
&gt;&gt;&gt; RIAK-CS memory usage doesn't go over 300MB. Any ideas what could be wrong?
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you,
&gt;&gt;&gt; Stefan.
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

