---
title: "Re: slow 2 node cluster"
description: ""
project: community
lastmod: 2011-11-20T13:21:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05693"
mailinglist_parent_id: "msg05692"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-11-20T13:21:14-08:00
---


Kyle's recommendations are solid. 

If you're reaching a maximum throughput rate of 300 inserts per second 
regardless of number of nodes, then there's a fundamental infrastructure 
problem. 

Eliminate every possible bottleneck one at a time:

You can eliminate disk as a bottleneck by testing with the in-memory backend. 
You can eliminate network as a bottleneck by testing on the host.
You can eliminate your client as a bottleneck by running basho\_bench.

As someone who has spent a lot of time making RDBMSes go really fast, any 
waiting on disk is too much waiting on disk ;)
---
Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
Microsoft SQL Server MVP

On Nov 20, 2011, at 12:56 PM, Aphyr wrote:

&gt; On 11/20/2011 12:14 PM, Catalin Constantin wrote:
&gt;&gt; I am 100% sure the transfer rate is 10MBytes / second. This is not the
&gt;&gt; problem.
&gt; 
&gt; In ten years of network administration I have never encountered an ethernet 
&gt; device with a wire rate of 10 MBps. I have, however, encountered frequent 
&gt; confusion over units. Perhaps you understand my suspicion here. :)
&gt; 
&gt;&gt; IOWAIT is also pretty low. iostat shows: iowait 4.69%
&gt; 
&gt; If you read my email, I suggested that even values as low as 2.6% may suggest 
&gt; contention. It depends on your CPU arch and utilization. I would investigate 
&gt; your disks more closely. Are they spinning or solid-state? Median seek time? 
&gt; 95/99 seek times? Disk cache? Does the riak process spend disproportionate 
&gt; time in IO\_WAIT relative to USER? Filesystem atime/relatime/noatime? FS block 
&gt; size properly aligned for your disk? Insufficient filesystem or leveldb 
&gt; cache? hdparm options? Is riak on an independent disk or competing with other 
&gt; processes, i.e. syslog, file servers, etc? Does strace show an unusual amount 
&gt; of time spent in certain system calls?
&gt; 
&gt; It might just be leveldb, too. I only have experience with bitcask in 
&gt; production.
&gt; 
&gt;&gt; I have retried the test with one node, a new bucket newly created where
&gt;&gt; i have set: n to 1.
&gt;&gt; bucket.set\_n\_val(1)
&gt;&gt; 
&gt;&gt; Results are the same. Less than 300 inserts / second.
&gt; 
&gt; This is good; it rules out replication.
&gt; 
&gt;&gt; Any idea why riak is so slow on inserting data ?
&gt; 
&gt; Disk, disk disk disk, disk disk? Disk!
&gt; 
&gt; You could also look at the client. Are you writing to a local node or a 
&gt; remote one? Is your client's threading model getting in the way? Can you 
&gt; actually produce data fast enough to insert it? Is your client fighting for 
&gt; the same resources as the riak process? Presuming you've ruled these out, 
&gt; it's almost certainly network or disk.
&gt; 
&gt; --Kyle
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

