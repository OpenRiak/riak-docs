---
title: "Re: Riak 1.0"
description: ""
project: community
lastmod: 2011-10-22T09:28:50-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05245"
mailinglist_parent_id: "msg05231"
author_name: "Jim Adler"
project_section: "mailinglistitem"
sent_date: 2011-10-22T09:28:50-07:00
---


Thanks Nico. I'll make the changes you suggest to regain the consistency.
My understanding is a ring size of 64 would limit my cluster to about 6
nodes, right?

Jim

From: Nico Meyer 
Date: Sat, 22 Oct 2011 12:12:13 +0200
To: "riak-users@lists.basho.com" , Jim Adler

Subject: Re: Riak 1.0

 
 Hello Jim,
 
 it sounds like the ring\_creation\_size in your app.conf file is inconsistent
with the actual ring size on your existing nodes. This would happen, if the
ring\_creation\_size in the config was changed after the ring as been created.
As the name implies, the setting is only used when starting a fresh/empty
node for the first time, so changing it afterwards has no real effect, other
than showing up in the riak-admin output and severly confusing people ;-).
 
 So to fix your problem, first of all, since the real ring size is 64, your
new node must also have a ring size of 64. So do as Dan suggested, but set
the ring\_creation\_size to 64 instead of 256.
 At that point joining might already work. I checked the code, and if the
new gossip protocol is used, riak checks for equality the actual ring sizes
of the two nodes to join. But if the legacy gossip protocol is still used,
riak compares the ring\_creation\_size config settings of both nodes.
 
 In any case, you should change the ring\_creation\_size on all your nodes to
64 and restart them, if only to make thing consistent again.
 
 Cheers,
 Nico
 
 Am 22.10.2011 09:46, schrieb Jim Adler:
&gt; 
&gt; For the bitcask backend, ring\_num\_partitions=64 and ring\_creation\_size=256. I
&gt; haven't seen where to set ring\_num\_partitions in app.config. I have about 8
&gt; million keys stored in this cluster.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; So, how do I bring up a LevelDB node and join to the existing cluster given
&gt; this 64/256 partitions/creation\_size config?
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Thanks for the help!
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Jim
&gt; 
&gt; 
&gt; 
&gt; 
&gt; From: Dan Reverri 
&gt; Date: Fri, 21 Oct 2011 09:41:02 -0700
&gt; To: Jim Adler 
&gt; Cc: Ian Plosker , "riak-users@lists.basho.com"
&gt; 
&gt; Subject: Re: Riak 1.0
&gt; 
&gt; 
&gt; 
&gt; 
&gt; The "ring\_creation\_size" parameter in app.config must be set before the node
&gt; has been started and written a ring file. Assuming the LevelDB node is empty,
&gt; you can do the following:
&gt; 
&gt; 
&gt; 
&gt; 1. Stop the node
&gt; 
&gt; 2. Clear out the data directories (data/ring, data/leveldb, data/bitcask,
&gt; data/mr\_queue, data/kv\_vnode)
&gt; 
&gt; 3. Verify "ring\_creation\_size" is set to 256 in the app.config file
&gt; 
&gt; 4. Start the node
&gt; 
&gt; 5. Verify "ring\_num\_partitions" in "riak-admin status" is 256
&gt; 
&gt; 6. Join the node to the cluster
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Thanks,
&gt; 
&gt; Dan 
&gt; 
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt; 
&gt; 
&gt; 
&gt; On Fri, Oct 21, 2011 at 9:30 AM,  wrote:
&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 64 on the LevelDB vs 256 on the Bitcask. I guess that’s it. Workaround?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; From: Dan Reverri [mailto:d...@basho.com]
&gt;&gt; Sent: Friday, October 21, 2011 9:27 AM
&gt;&gt; To: Jim Adler
&gt;&gt; Cc: Ian Plosker; riak-users
&gt;&gt; Subject: Re: Riak 1.0
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Hi Jim,
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Can you check "ring\_num\_partitions" on each node from "riak-admin status"?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Dan
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Daniel Reverri
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 2011/10/20 Jim Adler 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; I tried the Bitcask-to-LevelDB procedure on 1.0.1 to switch my backend from
&gt;&gt; Bitcask to LevelDB. I have one node on Bitcask with my data and the other
&gt;&gt; node with a fresh LevelDB backend. When I join the fresh LevelDB node, I get
&gt;&gt; the following error: Failed: r...@xx.xx.xx.xx has a different
&gt;&gt; ring\_creation\_size
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; riak-admin status | grep creation gives: ring\_creation\_size : 256
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Any ideas?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; From: riak-users-boun...@lists.basho.com
&gt;&gt; [mailto:riak-users-boun...@lists.basho.com] On Behalf Of Ian Plosker
&gt;&gt; Sent: Saturday, October 01, 2011 8:15 AM
&gt;&gt; To: 54chen
&gt;&gt; ! Cc: riak-users
&gt;&gt; Subject: Re: Riak 1.0
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; There are instructions on the wiki:
&gt;&gt; http://wiki.basho.com/Secondary-Indexes.html#Migrating-an-Existing-Cluster-(M
&gt;&gt; ethod-One) 
&gt;&gt; &gt; 28Method-One%29&gt;
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Basically, you will have each node leave the cluster, switch the backend, and
&gt;&gt; then rejoin. The process is something like this:
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 1) Issue `riak-admin leave` and wait for all transfers to complete
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 2) `riak stop`
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 3) Change the backend to the `riak\_kv\_eleveldb\_backend`
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 4) `riak start` and `riak-admin join `
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 5) Repeat for each node in the cluster
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Ian Plosker
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Developer Advocate
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Basho Technologies
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Sep 30, 2011, at 10:41 PM, 54chen wrote:
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Congratulations!
&gt;&gt; 
&gt;&gt; Can you give me an example of how the 0.14.2（bitcas! k） upgrade to 1.0（
&gt;&gt; levelDB）?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 2011/10/1 Alexander Sicular 
&gt;&gt; 
&gt;&gt; Awesome!
&gt;&gt; 
&gt;&gt; Already got it in place on my mac and ubuntu dev boxes. Smooth.
&gt;&gt; 
&gt;&gt; -Alexander Sicular
&gt;&gt; 
&gt;&gt; @siculars
&gt;&gt; http://siculars.posterous.com 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Sep 30, 2011, at 4:31 PM, David Smith wrote:
&gt;&gt; 
&gt;&gt;&gt; &gt; Hi All,
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; I am very pleased to announce that Riak 1.0 is tagged and officially
&gt;&gt;&gt; &gt; ready for downloading.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Pre-built installations and source tarballs are available at:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; http://downloads.basho.com/riak/CURRENT
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Release notes are here:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; https://github.com/basho/riak/blob/1.0/RELEASE-NOTES.org
&gt;&gt;&gt; 
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; There is also a blog post about the release here:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; http://blog.basho.com/2011/09/30/Riak-1-dot-0-is-Official/
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; 1.0 has been two years and 15 releases in the making. Thank you all
&gt;&gt;&gt; &gt; for being a part of this project and wonderful community. We couldn't
&gt;&gt;&gt; &gt; have done it without you.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Sincerely,
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; D.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; --
&gt;&gt;&gt; &gt; Dave Smith
&gt;&gt;&gt; &gt; Director, Engineering
&gt;&gt;&gt; &gt; Basho Technologies, Inc.
&gt;&gt;&gt; &gt; diz...@basho.com
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users \_lists.basho.com
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; -
&gt;&gt; http://www.54chen.com 
&gt;&gt; http://twitter.com/54chen
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.comhttp://lists.basho.com/mailman/listinfo/riak-users\_l
&gt; ists.basho.com
&gt; 
 
 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

