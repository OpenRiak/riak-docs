---
title: "Re: Mapred unable to find keys that use bucket types"
description: ""
project: community
lastmod: 2015-02-05T22:31:17-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15652"
mailinglist_parent_id: "msg15650"
author_name: "Mikhail Pustovalov"
project_section: "mailinglistitem"
sent_date: 2015-02-05T22:31:17-08:00
---


Thank you again Christopher,
An example would be awesome! Although I really need only one line of code
that shows how to pass specific keys to mapred function to operate on (in
the case when they use bucket type).
As to my map function: it really does nothing - simply returns key-value
pairs, because I use mapred functionality to simply fetch multiple objects
in one query. Here it is:

map\_kv\_pairs ( Obj, \_, \_ ) -&gt;
 case riak\_object:is\_robject(Obj) of
 true -&gt; [ {riak\_object:key(Obj), riak\_object:get\_value(Obj)} ] ;
 false -&gt; []
 end.

On Fri Feb 06 2015 at 1:24:50 AM Christopher Meiklejohn &lt;
cmeiklej...@basho.com&gt; wrote:

&gt;
&gt; On Feb 5, 2015, at 12:47 PM, Mikhail Pustovalov 
&gt; wrote:
&gt;
&gt; Hi Chris,
&gt;
&gt; Thank you for the prompt reply.
&gt; Although that is exactly what I do. I've noticed that bucket can now be
&gt; both binary or a tuple {binary, binary} where the first element is bucket
&gt; type and the second is bucket. And it works for put/get operations and for
&gt; mapred\_bucket which traverses the whole bucket. But what I am trying to
&gt; achieve is traverse only specified keys and that doesn't seem to work for
&gt; mapred queiries. Here are the commands that work:
&gt; simple get:
&gt; riakc\_pb\_socket:get(Pid,{&lt;&lt;"bucket\_type"&gt;&gt;,&lt;&lt;"bucket"&gt;&gt;},&lt;&gt;).
&gt; mapred over the whole bucket:
&gt; riakc\_pb\_socket:mapred\_bucket(Pid, {&lt;&lt;"bucket\_type"&gt;&gt;,&lt;&lt;"bucket"&gt;&gt;},
&gt; [{map, {modfun, rc\_mapred, map\_kv\_pairs}, none, true}]).
&gt; but this one fails with the result {ok,[{0,[{error,notfound}]}]}:
&gt; riakc\_pb\_socket:mapred(Pid, 
&gt; [{{&lt;&lt;"bucket\_type"&gt;&gt;,&lt;&lt;"bucket"&gt;&gt;},&lt;&gt;}],[{map,
&gt; {modfun, rc\_mapred, map\_kv\_pairs}, none, true}]).
&gt;
&gt; If you can run a mapred query over specified keys could you please show me
&gt; an example?
&gt;
&gt;
&gt; I can try to put together an example.
&gt;
&gt; Do you mind sharing what your map function is doing?
&gt;
&gt; - Chris
&gt;
&gt; Christopher Meiklejohn
&gt; Senior Software Engineer
&gt; Basho Technologies, Inc.
&gt; cmeiklej...@basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

