---
title: "Re: Running multiple Riak instances."
description: ""
project: community
lastmod: 2010-07-30T21:00:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00817"
mailinglist_parent_id: "msg00787"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-07-30T21:00:27-07:00
---


Hi Misha,

Another possibility for starting multiple instances from the packaged builds
is the following:

1. Create a folder to store the relevant files and data for "staging"

mkdir -p ~/staging/etc


2. Create an app.config and vm.args file for "staging"

~/staging/etc/app.config

[

 {riak\_core, [

 {ring\_state\_dir, "data/ring"},

 {web\_ip, "127.0.0.1" },

 {web\_port, 8091 },

 {handoff\_port, 8101 }

 ]},

 {riak\_kv, [

 {storage\_backend, riak\_kv\_bitcask\_backend},

 {pb\_ip, "127.0.0.1" },

 {pb\_port, 8081 }

 ]},

 {bitcask, [

 {data\_root, "data/bitcask"}

 ]},

 {sasl, [

 {sasl\_error\_logger, {file, "log/sasl-error.log"}},

 {errlog\_type, error},

 {error\_logger\_mf\_dir, "log/sasl"}, % Log directory

 {error\_logger\_mf\_maxbytes, 10485760}, % 10 MB max file size

 {error\_logger\_mf\_maxfiles, 5} % 5 files max

 ]}

].


~/staging/etc/vm.args

-name stag...@127.0.0.1

-setcookie riak

+K true

+A 64

-env ERL\_MAX\_PORTS 4096

-env ERL\_FULLSWEEP\_AFTER 10


3. Start the "staging" instance using the erl binary installed by the
package

cd ~/staging

/usr/lib/riak/erts-5.7.5/bin/erl \

-config ~/staging/etc/app.config \

-args\_file ~/staging/etc/vm.args \

-eval '[application:start(A) || A &lt;- [sasl, crypto, webmachine, riak\_core,
luke, erlang\_js, bitcask, mochiweb, os\_mon, riak\_kv]].'



You should now have a running instance accessible at
http://127.0.0.1:8091/riak


Thanks,

Dan


Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Sun, Jul 25, 2010 at 1:57 PM, Misha Gorodnitzky  wrote:

&gt; Ya, I changed that in my vm.staging.args config file. However, in the
&gt; process list I see these two processes:
&gt;
&gt; /usr/lib/riak/erts-5.7.5/bin/run\_erl -daemon /var/run/riak-staging/
&gt; /var/log/riak-staging exec /usr/sbin/riak console -
&gt; /usr/lib/riak/erts-5.7.5/bin/beam.smp -K true -A 5 -- -root
&gt; /usr/lib/riak -progname riak -- -home /var/lib/riak -- -boot
&gt; /usr/lib/riak/releases/0.12.0/riak -embedded -config
&gt; /etc/riak/app.staging.config -name riak\_stag...@127.0.0.1 -setcookie
&gt; riak-staging -home /var/lib/riak-staging -- console -
&gt;
&gt; The second one being a child to the first. I can see that the -name is
&gt; being set there, what worries me is that -progname is 'riak', I'm not
&gt; sure if that needs to be unique or not, or how to change it.
&gt;
&gt;
&gt; --M
&gt;
&gt; On 25 July 2010 17:29, Grant Schofield  wrote:
&gt; &gt; Does the second vm.args have the same -name setting as the first node?
&gt; Each node will need to have a unique name configured.
&gt; &gt;
&gt; &gt; Grant Schofield
&gt; &gt; Developer Advocate
&gt; &gt; Basho Technologies, Inc.
&gt; &gt;
&gt; &gt;
&gt; &gt; On Jul 25, 2010, at 9:00 AM, Misha Gorodnitzky wrote:
&gt; &gt;
&gt; &gt;&gt; Hi all,
&gt; &gt;&gt;
&gt; &gt;&gt; I'm trying to run multiple instances of Riak on my server with the
&gt; &gt;&gt; goal to run both the staging environment and eventually the production
&gt; &gt;&gt; environment on the same server (I only have one for this project).
&gt; &gt;&gt; This is an Ubuntu server and if at all possible I'd prefer not to
&gt; &gt;&gt; build Riak from source, although I understand that it would be easier
&gt; &gt;&gt; to have multiple instances running that way. I would rather keep
&gt; &gt;&gt; software managed with the package manager here.
&gt; &gt;&gt;
&gt; &gt;&gt; What I've done is I've modified /usr/sbin/riak to allow specifying the
&gt; &gt;&gt; config files to use (app.config, vm.args), the log dir, run dir (for
&gt; &gt;&gt; the pipe) and the home dir, and I can startup an instance of Riak
&gt; &gt;&gt; using my "staging" environment. However, when I try to start up the
&gt; &gt;&gt; second Riak instance, it fails with just a couple of things
&gt; &gt;&gt; out-of-the-ordinary in it's logs:
&gt; &gt;&gt;
&gt; &gt;&gt; =INFO REPORT==== 25-Jul-2010::13:54:35 ===
&gt; &gt;&gt; application: riak\_kv
&gt; &gt;&gt; exited: {shutdown,{riak\_kv\_app,start,[normal,[]]}}
&gt; &gt;&gt; type: permanent
&gt; &gt;&gt; =INFO REPORT==== 25-Jul-2010::13:54:35 ===
&gt; &gt;&gt; alarm\_handler: {clear,system\_memory\_high\_watermark}
&gt; &gt;&gt; {"Kernel pid
&gt; terminated",application\_controller,"{application\_start\_failure,riak\_kv,{shutdown,{riak\_kv\_app,start,[normal,[]]}}}"}^M
&gt; &gt;&gt; Kernel pid terminated (application\_controller)
&gt; &gt;&gt;
&gt; ({application\_start\_failure,riak\_kv,{shutdown,{riak\_kv\_app,start,[normal,[]]}}})^M
&gt; &gt;&gt;
&gt; &gt;&gt; And the Riak process that's already running logs this:
&gt; &gt;&gt;
&gt; &gt;&gt; \*\* Connection attempt from disallowed node 'riak\_stag...@127.0.0.1' \*\*
&gt; &gt;&gt;
&gt; &gt;&gt; Any ideas what this might be? Has anyone managed to do this using the
&gt; &gt;&gt; Riak .deb package?
&gt; &gt;&gt;
&gt; &gt;&gt; Thanks,
&gt; &gt;&gt;
&gt; &gt;&gt; --Misha
&gt; &gt;&gt;
&gt; &gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

