---
title: "Re: Evolving data model"
description: ""
project: community
lastmod: 2012-09-19T16:17:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08603"
mailinglist_parent_id: "msg08602"
author_name: "Allen Johnson"
project_section: "mailinglistitem"
sent_date: 2012-09-19T16:17:07-07:00
---


Thanks for all the responses.

Originally I was leaning toward the batch transformation approach thinking
that this would help keep map-reduce jobs as simple as possible since they
wouldn't have to concern themselves with multiple versions of documents.
 Perhaps I'm just so used to schema migrations in RDBMS that this is just
how I think. The lazy object upgrading technique is appealing. I have a
small project coming up where I can test that out to see how it goes.

Thanks again.

On Wed, Sep 19, 2012 at 6:52 PM, Todd Cullen  wrote:

&gt; ThoughtLeadr uses Bip's approach. Its essential lazy schema migration.
&gt;
&gt;
&gt; On Wed, Sep 19, 2012 at 3:03 PM, Reid Draper  wrote:
&gt;
&gt;&gt; I have also used Bip's method and found it successful. You do need to be
&gt;&gt; careful to make sure
&gt;&gt; all reads of your data go through this upgrade-path, but that is easy
&gt;&gt; once you realize it :).
&gt;&gt;
&gt;&gt;
&gt;&gt; Reid
&gt;&gt;
&gt;&gt; On Sep 19, 2012, at 5:44 PM, Bip Thelin  wrote:
&gt;&gt;
&gt;&gt; We use a technique that works well for our use case:
&gt;&gt; We store everything as JSON and use the erlang-client, for every object
&gt;&gt; we store we add an opaque schema\_version tag to the JSON and then in our
&gt;&gt; model encode/decode routine we parse this schema\_version and if the version
&gt;&gt; is not the latest according to the model we recurse and upgrade the payload
&gt;&gt; all the way up to the current version and then return the new object to the
&gt;&gt; client and spawn an async process that saves the new object back.
&gt;&gt;
&gt;&gt; So for instance an object is at schema\_version 1 when it get's read. The
&gt;&gt; model is now on version 5 there will be five functions, i.e:
&gt;&gt; upgrade\_version(2, Payload) -&gt;
&gt;&gt; do\_something();
&gt;&gt; upgrade\_version(3, Payload) -&gt;
&gt;&gt; etc...
&gt;&gt;
&gt;&gt; every function knows how to upgrade itself from it's former version so
&gt;&gt; fast forwarding through version is easy and every object will get upgraded
&gt;&gt; eventually (if the get read).
&gt;&gt;
&gt;&gt; --
&gt;&gt; Bip Thelin
&gt;&gt;
&gt;&gt; KIVRA | Lugnets All√© 1 | 120 33 Stockholm
&gt;&gt; Tel 08-533 335 37 | Mob 0735-18 18 90
&gt;&gt; www.kivra.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On 19 sep 2012, at 00:55, Allen Johnson  wrote:
&gt;&gt;
&gt;&gt; Hey everyone,
&gt;&gt;
&gt;&gt; I'm beginning to experiment with Riak and I'm trying to better
&gt;&gt; understand how to model my data. One question I have at the moment is
&gt;&gt; how to evolve my data with a data store such as Riak? I know that
&gt;&gt; it's schema-less and that I can add new fields as needed but I'm
&gt;&gt; thinking more about the existing documents.
&gt;&gt;
&gt;&gt; For example, say hypothetically, that I have a fairly successful
&gt;&gt; riak-based app. As the application code continues to evolve over
&gt;&gt; several versions I begin to find a "better" way to model my data. By
&gt;&gt; this time I have already stored many, many documents. What is the
&gt;&gt; appropriate path here? Do I version my documents with metadata and
&gt;&gt; rely on my application code to continue to deal with old-style
&gt;&gt; documents -- or do I perform some sort of bulk transformation on these
&gt;&gt; existing documents?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Allen
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Cheers,
&gt;
&gt; Todd Cullen | Founder & CEO of ThoughtLeadr
&gt; 177 Post Street, #550 SF 94108
&gt; e. t...@thoughtleadr.com p. 415-254-0787
&gt; twitter: @shakakai  skype: todd.cullen
&gt;
&gt; Fast Company covers 
&gt; ThoughtLeadr
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

