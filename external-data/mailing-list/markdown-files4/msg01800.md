---
title: "Re: {error,<<\"{precommit_fail,notfound}\">>}"
description: ""
project: community
lastmod: 2010-12-15T18:11:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01800"
mailinglist_parent_id: "msg01799"
author_name: "Neville Burnell"
project_section: "mailinglistitem"
sent_date: 2010-12-15T18:11:45-08:00
---


Cant you simply PUT all the objects again, ie, dont bother deleting?

On 16 December 2010 12:49, Xiaopong Tran  wrote:

&gt; Well, that's what I had been trying to do: delete all the objects
&gt; in the bucket and re-insert again.
&gt;
&gt; So now, I can't delete the objects, and there's no delete-bucket
&gt; operation. Is that supposed to mean that I have to delete the
&gt; entire Riack db and start everything from scratch??? I hope I
&gt; got that part wrong.
&gt;
&gt; Best
&gt;
&gt; Xiaopong
&gt;
&gt; On Wed, 2010-12-15 at 22:50 +0800, Joseph Lambert wrote:
&gt; &gt; You need to add the hook before you add the objects you want indexed
&gt; &gt; when inserting KV data. The precommit hook is what triggers the
&gt; &gt; indexing of the objects. If it's not installed when you insert an
&gt; &gt; object, it's not going to index it.
&gt; &gt;
&gt; &gt;
&gt; &gt; From the wiki:
&gt; &gt;
&gt; &gt;
&gt; &gt; "Riak Search indexing of KV data must be enabled on a per-KV-bucket
&gt; &gt; basis. To enable indexing for a bucket, simply add the Search
&gt; &gt; precommit hook to that bucket's properties"
&gt; &gt;
&gt; &gt;
&gt; &gt; "With the precommit hook installed, Riak Search will index your data
&gt; &gt; each time that data is written"
&gt; &gt;
&gt; &gt;
&gt; &gt; I believe the delete is failing because it can't find the value in the
&gt; &gt; index, so the precommit hook returns {precommit\_fail,notfound} error
&gt; &gt; (since a delete updates the meta data of the object).
&gt; &gt;
&gt; &gt;
&gt; &gt; If you want to see index data, the index buckets start are named like
&gt; &gt; \_rsid\_bucketname, where bucketname is the bucket you install the hook
&gt; &gt; on.
&gt; &gt;
&gt; &gt; - Joe Lambert
&gt; &gt;
&gt; &gt; joseph.g.lamb...@gmail.com
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Dec 15, 2010 at 7:12 PM, Xiaopong Tran
&gt; &gt;  wrote:
&gt; &gt; I installed Riak Search, added a few JSON docs, then install
&gt; &gt; the
&gt; &gt; search hook for the bucket. Now, here are the questions:
&gt; &gt;
&gt; &gt; 1) How can I list the indexes that have been created
&gt; &gt; for my bucket?
&gt; &gt;
&gt; &gt; 2) After installing the hook, I can't delete my object
&gt; &gt; anymore. Here is the error:
&gt; &gt;
&gt; &gt; 7&gt; {ok, P} = test3:init().
&gt; &gt; {ok,&lt;0.44.0&gt;}
&gt; &gt; 8&gt; riakc\_pb\_socket:get(P, "user\_bucket", "jane").
&gt; &gt; {ok,{riakc\_obj,"user\_bucket","jane",
&gt; &gt;
&gt; &gt; &lt;&lt;107,206,97,96,96,96,204,96,202,5,82,44,108,85,66,103,50,
&gt; &gt; 152,18,25,243,88,25,...&gt;&gt;,
&gt; &gt; [{{dict,3,16,16,8,80,48,
&gt; &gt;
&gt; &gt; {[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt; &gt; {{[],[],[],[],[],[],[],[],[],[],...}}},
&gt; &gt; &lt;&lt;"{\"userid\":\"jane\",\"first\_name\":\"Jane
&gt; &gt; \",
&gt; &gt; \"last\_name\":\"Doe\",\"gender\":\"F\",\"joined\_"...&gt;&gt;}],
&gt; &gt; undefined,undefined}}
&gt; &gt; 9&gt; riakc\_pb\_socket:delete(P, "user\_bucket", "jane").
&gt; &gt; {error,&lt;&lt;"{precommit\_fail,notfound}"&gt;&gt;}
&gt; &gt; 10&gt; riakc\_pb\_socket:delete(P, "user\_bucket", &lt;&lt;"jane"&gt;&gt;).
&gt; &gt; {error,&lt;&lt;"{precommit\_fail,notfound}"&gt;&gt;}
&gt; &gt;
&gt; &gt; I can retrieve the object, but can't delete it. What's is
&gt; &gt; going on?
&gt; &gt;
&gt; &gt; Thanks
&gt; &gt;
&gt; &gt; Xiaopong
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt;
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

