---
title: "Re: Errors, 'preflist_exhausted' & 'worker_limit_reached' when trying	to read data from Riak"
description: ""
project: community
lastmod: 2012-07-25T22:05:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08074"
mailinglist_parent_id: "msg07921"
author_name: "Balamurugan V G"
project_section: "mailinglistitem"
sent_date: 2012-07-25T22:05:10-07:00
---


Hi,

I am trying to get started with Riak, so installed the
'riak\_1.1.4-1\_i386.deb' on a Ubuntu 12.04 LTS 32bit System running in a
Virtual Box VM. I no not have any cluster.

&gt;
&gt; I have a script which does the following:
&gt;
&gt; 1. It creates 50 child processes which run in parallel
&gt; 2. Each Child process does the following
&gt; a. Creates 1000 entries using the provides REST interface. The entry
&gt; is a simple json value with 4 attributes and an integer key. This goes
&gt; through fine.
&gt;
&gt; The Json object is something like {"name": "Test1", "title":
&gt; "This is the title for Test1", "count": 1, "pid": 1234}. The pid is the
&gt; process ID of the process creating the entry. I later use this to query the
&gt; entries created by the process.
&gt;
&gt; b. Reads the entries created by it. A Javascript Map function which
&gt; is stored as an object is used to filter and return only the entries
&gt; created by the process
&gt;
&gt;
&gt; During the reads, I get the following errors in HTTP response:
&gt;
&gt;
&gt;
&gt; {"phase":0,"error":"[worker\_limit\_reached]","input":"{&lt;&lt;\"samples\"&gt;&gt;,&lt;&lt;\"11505823\"&gt;&gt;}","type":"result","stack":"[]"}
&gt;
&gt; and
&gt;
&gt; {"phase":0,"error":"[preflist\_exhausted]","input":"{ok,{r\_object,&lt;&lt;\"samples\"&gt;&gt;,&lt;&lt;\"11506270\"&gt;&gt;,[{r\_content,{dict,7,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[&lt;&lt;\"Links\"&gt;&gt;]],[],[],[],[],[],[],[],[[&lt;&lt;\"content-type\"&gt;&gt;,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110],[&lt;&lt;\"X-Riak-VTag\"&gt;&gt;,78,109,90,48,101,81,88,51,55,54,85,120,120,115,68,101,71,108,76,77,71]],[[&lt;&lt;\"index\"&gt;&gt;]],[],[[&lt;&lt;\"X-Riak-Last-Modified\"&gt;&gt;|{1342,87419,992551}]],[],[[&lt;&lt;\"charset\"&gt;&gt;,85,84,70,45,56],[&lt;&lt;\"X-Riak-Meta\"&gt;&gt;]]}}},&lt;&lt;\"{
&gt; \\n ...\"&gt;&gt;}],...},...}","type":"forward\_preflist","stack":"[]"}
&gt;
&gt; The crash log has these:
&gt;
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Module riak\_kv\_pipe\_get must be purged before loading
&gt;
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_pipe\_get.beam
&gt; failed: not\_purged
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Module riak\_kv\_pipe\_get must be purged before loading
&gt;
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_pipe\_get.beam
&gt; failed: not\_purged
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Module riak\_kv\_pipe\_get must be purged before loading
&gt;
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_pipe\_get.beam
&gt; failed: not\_purged
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Module riak\_kv\_mrc\_map must be purged before loading
&gt;
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_mrc\_map.beam
&gt; failed: not\_purged
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Module riak\_kv\_mrc\_map must be purged before loading
&gt;
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_mrc\_map.beam
&gt; failed: not\_purged
&gt; 2012-07-12 15:24:10 =ERROR REPORT====
&gt; Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_mrc\_map.beam
&gt; failed: not\_purged
&gt; 2012-07-12 15:24:11 =ERROR REPORT====
&gt; Module riak\_kv\_mrc\_map must be purged before loading
&gt;
&gt; 2012-07-12 15:24:12 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\_pipe\_vnode\_worker:init/1
&gt; pid: &lt;0.2303.0&gt;
&gt; registered\_name: []
&gt; exception exit:
&gt; {init\_failed,error,{case\_clause,{error,{insufficient\_vnodes,0,need,1}}}}
&gt; in function gen\_fsm:init\_it/6
&gt; in call from proc\_lib:init\_p\_do\_apply/3
&gt; ancestors:
&gt; [&lt;0.340.0&gt;,&lt;0.339.0&gt;,riak\_core\_vnode\_sup,riak\_core\_sup,&lt;0.93.0&gt;]
&gt; messages: []
&gt; links: [&lt;0.340.0&gt;]
&gt; dictionary:
&gt; [{eunit,[{module,riak\_pipe\_vnode\_worker},{partition,1050454301831586472458898473514828420377701515264},{&lt;0.339.0&gt;,&lt;0.339.0&gt;},{details,{fitting\_details,{fitting,&lt;0.1136.0&gt;,#Ref&lt;0.0.0.2622&gt;,follow,1},0,riak\_kv\_mrc\_map,{{jsanon,{&lt;&lt;"functions"&gt;&gt;,&lt;&lt;"get\_by\_pid"&gt;&gt;}},11043},{fitting,&lt;0.799.0&gt;,#Ref&lt;0.0.0.2622&gt;,sink,undefined},[{sink,{fitting,&lt;0.799.0&gt;,#Ref&lt;0.0.0.2622&gt;,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64}}]}]
&gt; trap\_exit: false
&gt; status: running
&gt; heap\_size: 987
&gt; stack\_size: 24
&gt; reductions: 256
&gt; neighbours:
&gt; 2012-07-12 15:24:12 =SUPERVISOR REPORT====
&gt; Supervisor: {&lt;0.340.0&gt;,riak\_pipe\_vnode\_worker\_sup}
&gt; Context: child\_terminated
&gt; Reason:
&gt; {init\_failed,error,{case\_clause,{error,{insufficient\_vnodes,0,need,1}}}}
&gt; Offender:
&gt; [{pid,&lt;0.2303.0&gt;},{name,undefined},{mfargs,{riak\_pipe\_vnode\_worker,start\_link,undefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
&gt;
&gt;
&gt; I did search the Basho site for the error messages and found that some
&gt; configurtion changes in app.config and setting ulimit might help. But that
&gt; didnt solve my problem.
&gt;
&gt; My ulimit is set as 'ulimit -n 4096'. I have also done the following
&gt; changes to the app.config:
&gt;
&gt; diff /etc/riak/app.config /etc/riak/orig.app.config
&gt; 65c65
&gt; &lt; %% {pb\_backlog, 500},
&gt; ---
&gt; &gt; %% {pb\_backlog, 5},
&gt; 80d79
&gt; &lt; {riak\_pipe, [{worker\_limit, 1000}]},
&gt; 97,99c96,98
&gt; &lt; {map\_js\_vm\_count, 2048 },
&gt; &lt; {reduce\_js\_vm\_count, 2048 },
&gt; &lt; {hook\_js\_vm\_count, 2048 },
&gt; ---
&gt; &gt; {map\_js\_vm\_count, 8 },
&gt; &gt; {reduce\_js\_vm\_count, 6 },
&gt; &gt; {hook\_js\_vm\_count, 2 },
&gt; 110c109
&gt; &lt; {js\_max\_vm\_mem, 800},
&gt; ---
&gt; &gt; {js\_max\_vm\_mem, 8},
&gt; 115c114
&gt; &lt; {js\_thread\_stack, 1600},
&gt; ---
&gt; &gt; {js\_thread\_stack, 16},
&gt;
&gt;
&gt; Any pointers for this issue will be helpful.
&gt;
&gt; Regards,
&gt; Balu
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

