---
title: "Re: Cluster start and 2i query"
description: ""
project: community
lastmod: 2014-03-07T07:08:12-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13768"
mailinglist_parent_id: "msg13754"
author_name: "Ciprian Manea"
project_section: "mailinglistitem"
sent_date: 2014-03-07T07:08:12-08:00
---


Hi Daniel,

Secondary index queries need at least 1/n\_val primary partitions to be
available before it could run successfully and Riak would return
{error,insufficient\_vnodes\_available} while the required primary partitions
are coming up.

I would suggest defensive programming (retrying the 2i queries on error) as
a way to mitigate this.


Thanks,
Ciprian


On Wed, Mar 5, 2014 at 11:06 PM, Daniel Iwan  wrote:

&gt; Thanks Ciprian
&gt;
&gt; We already have wait-for-service in our script and it looks like it's not a
&gt; sufficient condition to satisfy secondary index query.
&gt; How long application should wait before starting querying Riak using 2i?
&gt; Should we do riak-admin transfers to make sure there are no vnode transfers
&gt; happening?
&gt;
&gt; I'm trying to figure it out what {error,insufficient\_vnodes\_available}
&gt; means
&gt; in terms of 2i query.
&gt; Does it mean not all primary partitions are up?
&gt;
&gt; Regards
&gt; Daniel
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/Cluster-start-and-2i-query-tp4030557p4030614.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

