---
title: "Re: Query on Riak Search in a cluster of 3 nodes behind ELB is giving	different result everytime"
description: ""
project: community
lastmod: 2015-03-05T08:17:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15839"
mailinglist_parent_id: "msg15834"
author_name: "Santi Kumar"
project_section: "mailinglistitem"
sent_date: 2015-03-05T08:17:24-08:00
---


This issue is happening for \*:\* query only. It doesn't have lot of objects
so we are doing \*:\* query. Ever time it fetches different number when I
switched to list all keys and do a multi get its returning all objects

Another thing what we do is we create indexes on the fly and wait for index
creation by checking Listindex operation. Once it found the index then we
are associating the Bucket with index. After that we write some entries
into that bucket.

I fetched the key and tried searching again but it's the same again. So
read repair would have happened so that wouldn't be the issue I can check
AAE

Can you suggest any better way for these index creations and bucket
association? I suspect that might be the reason
Is there any way to check what's the data each shard has? I tried solr
query with shards param

Thanks
Santi
On Mar 5, 2015 8:05 PM, "Zeeshan Lakhani"  wrote:

&gt; Hello Santi,
&gt;
&gt; Have you deleted an object in that bucket/index at some point?
&gt;
&gt; Please make sure AAE is running by checking searchâ€™s AAE status,
&gt; `riak-admin search aae-status`, and that data exists in the correct
&gt; directory, `./data/yz\_anti\_entropy` (
&gt; http://docs.basho.com/riak/latest/ops/advanced/configs/search/).
&gt;
&gt; You may just need to perform a read-repair by performing a fetch of the
&gt; object itself first, before performing search queries again.
&gt;
&gt; Thanks.
&gt;
&gt; Zeeshan Lakhani
&gt; programmer |
&gt; software engineer at @basho |
&gt; org. member/founder of @papers\_we\_love | paperswelove.org
&gt; twitter =&gt; @zeeshanlakhani
&gt;
&gt; On Mar 4, 2015, at 9:06 PM, Santi Kumar  wrote:
&gt;
&gt; But in our case we didnt have spaces in keys. All our keys are UUID's so I
&gt; wouldn't suspect that. AAE I haven't verified .
&gt;
&gt; On Thu, Mar 5, 2015 at 7:16 AM, John O'Brien  wrote:
&gt;
&gt;&gt; I'd lean towards AAE issues on Yokozuna... Same problems we were having
&gt;&gt; with our 'spaces-in-keys' issue... Once we cleaned those up, things were
&gt;&gt; great again.
&gt;&gt;
&gt;&gt; On Wed, Mar 4, 2015 at 8:36 PM, Santi Kumar  wrote:
&gt;&gt;
&gt;&gt;&gt; Raik 2.0.0
&gt;&gt;&gt; On Mar 5, 2015 12:31 AM, "Christopher Meiklejohn" 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; On Mar 4, 2015, at 1:15 PM, Santi Kumar  wrote:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Hi,
&gt;&gt;&gt;&gt; &gt; We are running into a strange issue with Riak Search. Our setup is
&gt;&gt;&gt;&gt; with 3 nodes of Riak (with search enabled) in 3 different ec2 instances
&gt;&gt;&gt;&gt; behind ELB. App server talks to the cluster through ELB. We are querying
&gt;&gt;&gt;&gt; for list of objects through \*:\* query instead of list bucket keys and every
&gt;&gt;&gt;&gt; time the result is different. We have only 4 objects in that bucket /
&gt;&gt;&gt;&gt; index, only few times it's giving all 4 but ofther it returns 2 or 3.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; This wasn't happening when we have one instance of Riak. Any insight?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Santi,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Can you provide information regarding what versions of Riak you are
&gt;&gt;&gt;&gt; running?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; - Chris
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Christopher Meiklejohn
&gt;&gt;&gt;&gt; Senior Software Engineer
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; cmeiklej...@basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

