---
title: "Re: riakkit, a python riak object mapper, has hit beta!"
description: ""
project: community
lastmod: 2012-03-02T06:51:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06845"
mailinglist_parent_id: "msg06837"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2012-03-02T06:51:52-08:00
---


Andrey,

First off, you are indeed sending two emails to the Riak Users list each time 
you email, not just one, so I think gmail is doing the right thing the first 
time.

Second, I'm sure Shuhao would love some pull requests to help with Riakkit 
since you seem to have a lot of ideas to make it better.

-Jared


On Mar 2, 2012, at 6:39 AM, Andrey V. Martyanov wrote:

&gt; Also, I think we can add RoR-like migrations on top of that with automatic 
&gt; schema versioning and all the stuff.
&gt; 
&gt; Best regards,
&gt; Andrey Martyanov
&gt; 
&gt; On Fri, Mar 2, 2012 at 6:22 PM, Andrey V. Martyanov  
&gt; wrote:
&gt; I'm sorry for the repost, but my gmail client by default sends an email to a 
&gt; specific subscriber, not to riak-users.
&gt; 
&gt; 
&gt; Hi Shuhao,
&gt; 
&gt; I don't have enough time to write my own implementation and to see how it 
&gt; works in practice. But I share my thoughts about that.
&gt; It's possible to save the current API, it's common now and used in SQLAlchemy 
&gt; and Django ORM. But underlying implementation I see a bit different. The 
&gt; simple workflow:
&gt; 1. Define the models with specific fields and properties;
&gt; 2. Generate the JSON Schema [1] based on these fields;
&gt; 3. Create an instances of our models;
&gt; 4. Validate against the schema;
&gt; 5. Generate the optimal sequence of actions we need to do to store the data, 
&gt; based on the meta information of our models;
&gt; 6. Store the data, resolve the conflicts if occur.
&gt; 
&gt; Also it should be possible to deserialize the JSON objects into python 
&gt; objects.
&gt; 
&gt; [1] - http://json-schema.org/
&gt; 
&gt; Best regards,
&gt; Andrey Martyanov
&gt; 
&gt; On Fri, Mar 2, 2012 at 6:17 PM, Andrey V. Martyanov  
&gt; wrote:
&gt; Hi Shuhao,
&gt; 
&gt; I don't have enough time to write my own implementation and to see how it 
&gt; works in practice. But I share my thoughts about that.
&gt; It's possible to save the current API, it's common now and used in SQLAlchemy 
&gt; and Django ORM. But underlying implementation I see a bit different. The 
&gt; simple workflow:
&gt; 1. Define the models with specific fields and properties;
&gt; 2. Generate the JSON Schema [1] based on these fields;
&gt; 3. Create an instances of our models;
&gt; 4. Validate against the schema;
&gt; 5. Generate the optimal sequence of actions we need to do to store the data, 
&gt; based on the meta information of our models;
&gt; 6. Store the data, resolve the conflicts if occur.
&gt; 
&gt; Also it should be possible to deserialize the JSON objects into python 
&gt; objects.
&gt; 
&gt; [1] - http://json-schema.org/
&gt; 
&gt; Best regards,
&gt; Andrey Martyanov
&gt; 
&gt; 
&gt; On Fri, Mar 2, 2012 at 5:47 PM, Shuhao Wu  wrote:
&gt; Yeah. You're looking at something like dictshield. As riakkit is more a RAD 
&gt; tool in its current state. You bring in an excellent point, nonetheless, 
&gt; which gave me some intuition and ideas about the next step.
&gt; 
&gt; Cheers,
&gt; Shuhao
&gt; Sent from my phone.
&gt; 
&gt; On Mar 1, 2012 11:41 PM, "Andrey V. Martyanov"  wrote:
&gt; Riakkit in its current implementation has a lot of overhead. But what I get 
&gt; for this price? Almost nothing. Only field validation make sense. Simple 
&gt; key-value mapping is about 50-70 lines of code, not a big deal, even for 
&gt; small project. Riak used mostly in web-based projects. Almost all modern 
&gt; projects use JSON. The simple workflow is get JSON from the client, validate, 
&gt; store in the database, query the database, send JSON to the client. If our 
&gt; mapper doesn't understand the JSON and cannot operate on it then it's not 
&gt; useful. We can use jsonpickle with a lot more profit. Just jsonpickle.encode 
&gt; the object and store it in Riak. I'm sorry, this is my position!
&gt; 
&gt; Best regards,
&gt; Andrey Martyanov
&gt; 
&gt; On Fri, Mar 2, 2012 at 9:01 AM, Andrey V. Martyanov  
&gt; wrote:
&gt; I'm just saying that to efficiently store and get the data user should have 
&gt; ability to customize the relationship. Riak has several options to get 
&gt; related data: secondary indexes, map-reduce etc. I think that the most 
&gt; important task of mapper is to validate the data and to track these 
&gt; dependencies. When you have enough meta information about objects storing 
&gt; these objects is not a big problem.
&gt; 
&gt; 
&gt; On Fri, Mar 2, 2012 at 8:39 AM, Shuhao Wu  wrote:
&gt; The thing about riak-python-client is that it's already pretty high level, 
&gt; but not high level enough to be that simple.
&gt; 
&gt; From what I understand, tracking relationship between models will still 
&gt; involve a certain level of magic. Right now the magic is that when you save 
&gt; any document, all the related document will be saved into the database as 
&gt; well. You're saying that just tracking those relationship change is good 
&gt; enough and saving will be up to the user?
&gt; 
&gt; Shuhao
&gt; 
&gt; 
&gt; On Thu, Mar 1, 2012 at 10:20 PM, Andrey V. Martyanov  
&gt; wrote:
&gt; I'm not sure about forking the riak-python-client. The the whole idea of 
&gt; separation the low-level client library from the high-level mapper and the 
&gt; like is quite good. Some sort of SQLAlchemy does.
&gt; 
&gt; Best regards,
&gt; Andrey Martyanov
&gt; 
&gt; 
&gt; On Fri, Mar 2, 2012 at 8:15 AM, Shuhao Wu  wrote:
&gt; Another thing I was considering is forking riak-python-client. Some of the 
&gt; stuff in there could use some fixing as well, and maybe just take out the 
&gt; core transports and such and plug that right into riakkit and skip the notion 
&gt; of RiakObject all together as those API is also somewhat weird. (such as 
&gt; add\_link and remove\_link)
&gt; 
&gt; Shuhao
&gt; 
&gt; 
&gt; 
&gt; On Thu, Mar 1, 2012 at 10:02 PM, Shuhao Wu  wrote:
&gt; Hi!
&gt; 
&gt; First off, the code is LGPL licensed, not GPL. So you're free to put this 
&gt; into any code you want, it's just that when you want to modify riakkit, you 
&gt; have to release your modified version.
&gt; 
&gt; I just went over your idea and it would be a valid solution to some of the 
&gt; problems I'm having right now with my own projects with riakkit. When I 
&gt; initially started writing riakkit, I needed something to do RAD with, which 
&gt; would make sense to have an all-in-one, very simple to use framework, rather 
&gt; than working with serialization and what not. However, now I'm beginning to 
&gt; see problems in this approach when it comes to scalability as I'm slowing 
&gt; moving out of the RAD phase. I haven't done anything as I have not 
&gt; encountered any major issues yet (though I probably will).
&gt; 
&gt; So here's what I'm thinking for the next branch ( I still have to maintain 
&gt; the master branch due to some code i've written and need ): I'm going to 
&gt; break riakkit into 2 pieces. The first piece is the underlying piece, which 
&gt; will do what you said, serialize/deserialize objects, validation, track 
&gt; relationships and what not, however, it doesn't load it those references up 
&gt; nor does it try to accomplish everything all in one shot, and a RAD layer 
&gt; that's compatible with the current API that will allow RAD to work with it, 
&gt; but still reserve the flexibility of having that underlying API that's 
&gt; relatively easy (as oppose to dead simple) to work with and not as messy as 
&gt; what's going on right now.
&gt; 
&gt; I do agree that the code is messy.. Most of the time it's me fixing bugs I 
&gt; didn't anticipate as I go along and hacking everything into place..
&gt; 
&gt; One thing I'm not too clear about is what you mean by "Track dependencies 
&gt; between models". I'm not sure how you think I should go about approaching 
&gt; this (which right now is a pretty big disaster.. though relatively stable)
&gt; 
&gt; Cheers,
&gt; 
&gt; Shuhao
&gt; 
&gt; P.S. I don't want to go into the whole PEP8 discussion and 4 spaces vs 
&gt; whatever.. I just like the 2 spaces and the style guide that Google uses. Is 
&gt; that really a big deal if you're using it as a library?
&gt; 
&gt; On Thu, Mar 1, 2012 at 9:35 PM, Andrey V. Martyanov  
&gt; wrote:
&gt; Hi!
&gt; 
&gt; Two things force me to avoid using Riakkit: the code is GPL licensed and non 
&gt; pep8 compliant. So, I cannot fork it and make changes. The code needs clean 
&gt; up, for example, json module is imported in document.py, but not used. 
&gt; Riakkit has no conflict resolution logic, it's basically delegate the work to 
&gt; underlying python client. If I'd like to implement my save method I need to 
&gt; copy and rewrite more than 150 lines of code mess. What I think the mapper 
&gt; should do:
&gt; 1. Serialize the objects to valid json;
&gt; 2. Deserialize the data back to class instances;
&gt; 3. Validate the fields data;
&gt; 4. Track dependencies between models;
&gt; 
&gt; Simple example using Riakkit-like syntax;
&gt; 
&gt; class Post(Document):
&gt; 
&gt; bucket\_name = 'posts'
&gt; 
&gt; title = types.StringProperty(required=True)
&gt; content = types.StringProperty(required=True)
&gt; 
&gt; 
&gt; class Comment(Document):
&gt; 
&gt; bucket\_name = 'comments'
&gt; 
&gt; text = types.StringProperty(required=True)
&gt; post = types.IndexReferenceProperty(reference\_class=Post, 
&gt; collection\_name='comments')
&gt; 
&gt; &gt;&gt;&gt; post = Post('title', 'content')
&gt; &gt;&gt;&gt; comment1 = ('comment1', post=post)
&gt; &gt;&gt;&gt; comment2 = ('comment2', post=post)
&gt; &gt;&gt;&gt; post.is\_valid()
&gt; True
&gt; &gt;&gt; post.serialize()
&gt; {
&gt; "key": "post\_key",
&gt; "title": "title",
&gt; "content": "content",
&gt; "comments": [
&gt; {
&gt; "key": "comment1\_key",
&gt; "text": "comment1"
&gt; },
&gt; {
&gt; "key": "comment2\_key",
&gt; "text": "comment2"
&gt; },
&gt; ]
&gt; }
&gt; &gt;&gt;&gt; post.store()
&gt; True
&gt; &gt;&gt;&gt; post = Post.get\_with\_key('post\_key')
&gt; &gt;&gt;&gt; post.comments
&gt; ['Post comment1', 'Post comment2']
&gt; &gt;&gt;&gt; post\_json\_data = get\_json\_data\_from\_request()
&gt; &gt;&gt;&gt; post = Post.deserialize(post\_json\_data)
&gt; &gt;&gt;&gt; post.title
&gt; 'title'
&gt; &gt;&gt;&gt; post.comments
&gt; ['Post comment1', 'Post comment2']
&gt; 
&gt; Something like that.
&gt; 
&gt; 
&gt; Best regards,
&gt; Andrey Martyanov
&gt; 
&gt; On Fri, Mar 2, 2012 at 5:39 AM, Sean Carey  wrote:
&gt; Keep up the great work Shuhao!
&gt; 
&gt; 
&gt; On Mar 1, 2012, at 7:36 PM, Shuhao Wu  wrote:
&gt; 
&gt;&gt; Hey guys,
&gt;&gt; 
&gt;&gt; I started writing riakkit approximately 3 months ago and announced it here. 
&gt;&gt; In case you missed that, Riakkit is basically an object mapper for python 
&gt;&gt; and riak, which seemed to be lacking in at the time. Now that 3 months has 
&gt;&gt; passed and I have developed this project into much more than what I had 
&gt;&gt; envisioned to begin with. It's currently also being used and tested in a 
&gt;&gt; project of mine (web application) as well and functioning quite nicely. I 
&gt;&gt; would say that currently this is the only object mapper that can compete 
&gt;&gt; with their counterparts in other languages for Riak in Python, although a 
&gt;&gt; lot of work still needs to be done before it could fully compete.
&gt;&gt; 
&gt;&gt; So today I felt that riakkit is "stable" and "clean" enough to deserve the 
&gt;&gt; first beta release. So I whipped up a website and it's released to pypi. 
&gt;&gt; Here's (again), a demo (the full tutorial can be found on the links below)
&gt;&gt; 
&gt;&gt; class User(Document):
&gt;&gt; client = riak.RiakClient()
&gt;&gt; bucket\_name = "users"
&gt;&gt; 
&gt;&gt; name = StringProperty(required=True)
&gt;&gt; 
&gt;&gt; &gt;&gt;&gt; user = User(name="foo")
&gt;&gt; &gt;&gt;&gt; user.save()
&gt;&gt; &gt;&gt;&gt; print user.name
&gt;&gt; foo
&gt;&gt; 
&gt;&gt; If anyone is interested, you can find the website here: 
&gt;&gt; http://ultimatebuster.github.com/riakkit and the code at 
&gt;&gt; http://github.com/ultimatebuster/riakkit
&gt;&gt; 
&gt;&gt; Cheers!
&gt;&gt; 
&gt;&gt; Shuhao
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

