---
title: "Re: Is Riak a good solution for this problem?"
description: ""
project: community
lastmod: 2012-02-13T12:45:23-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06592"
mailinglist_parent_id: "msg06584"
author_name: "Jacques"
project_section: "mailinglistitem"
sent_date: 2012-02-13T12:45:23-08:00
---


This seems like the bread and butter of most Hadoop/MapReduce
implementations. If you needs some data more near realtime, you could add
HBase on top. If you need ad hoc querying, use Hive or Pig. If you want
to do clustering and more advanced analyses, use Mahout.

We love Riak and use it extensively but wouldn't suggest using it for the
use case you're describing.

Jacques

On Sun, Feb 12, 2012 at 3:27 AM, Marco Monteiro wrote:

&gt; Hello!
&gt;
&gt; I'm considering Riak for the statistics of a site that is approaching a
&gt; billion page views per month.
&gt; The plan is to log a little information about each the page view and then
&gt; to query that data.
&gt;
&gt; I'm very new to Riak. I've gone over the documentation on the wiki, and I
&gt; know about map-reduce,
&gt; secondary indexes and Riak search. I've installed Riak on a single node
&gt; and made a test with the
&gt; default configuration. The results were a little bellow what I expected.
&gt; For the test is used the following
&gt; requirement.
&gt;
&gt; We want the page view count by day for registered and unregistered users.
&gt; We are storing session
&gt; documents. Each document has a session identifier as it's key and a list
&gt; of page views as the value
&gt; (and a few additional properties we can ignore). This document structure
&gt; comes from CouchDB,
&gt; where I organised things like this to be able to more easily query the
&gt; database. I've done a basic
&gt; javascript map-reduce query for this. I just map over each session (every
&gt; k/v in a bucket) returning
&gt; the length of the page views array for either the registered or
&gt; unregistered field (the other is zero), and
&gt; the day of the request. In the reduce I collect them by hashing the day
&gt; and summing the two number
&gt; of page views. Then I have a second reduce to sort the list by day.
&gt;
&gt; This is very slow on a single machine setup with default Riak
&gt; configuration. 1.000 sessions takes
&gt; 6 seconds. 10.000 sessions takes more that 2 minutes (timeout). We want to
&gt; handle 10.000.000
&gt; sessions, at least. Is there a way, maybe with secondary indexes, to make
&gt; this go faster using only Riak?
&gt; Or must I use some kind of persistent cache to store this info as time
&gt; goes by? Or can I make Riak
&gt; run 100 times faster by tweaking the config? I don't want to have 1000
&gt; machines for making this work.
&gt;
&gt; Also, will updating the session documents be a problem for Riak? Would it
&gt; be better to store each
&gt; page hit under a new key, to not update the the session document. Because
&gt; of the "multilevel" map
&gt; reduce this ca work on Riak, where it didn't work on CouchDB, because its
&gt; view system limitation.
&gt; Unfortunately, with the update of documents the CouchDB database was
&gt; growing way too fast for it
&gt; to be a feasible solution.
&gt;
&gt;
&gt; Any advice to make Riak work for this problem is greatly appreciated.
&gt;
&gt; Thanks,
&gt; Marco
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

