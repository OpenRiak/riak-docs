---
title: "riak exiting when number partitions > 128"
description: ""
project: community
lastmod: 2012-10-08T18:00:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08826"
author_name: "David Lowell"
project_section: "mailinglistitem"
sent_date: 2012-10-08T18:00:48-07:00
---


I'm starting to want to move past the default Riak configs, for example, by 
running with a larger number of partitions than the default 64. However, today 
when bumping up the "ring\_creation\_size" config param to 256 or higher Riak 
started failing soon after startup with messages about "Too many open files". 
For the record, I'm using the ELevelDB back-end.

I've seen the documentation about the need for ring\_creation\_size \* 
max\_open\_files file descriptors with levelDB. I've upped the system open files 
limit for the riak user to 100k, so I don't think I'm hitting that system 
limit. So it feels like I'm hitting a limit configured within the application 
somewhere.

It doesn't feel like changing levelDB's 'max\_open\_files' configuration is the 
issue here, as I'm using the default/minimum value of 20 for that parameter. 
Any other setting would increase open files.

So I could use a pointer here from folks who have been here. I suspect there is 
something very simple required here. 

Thanks folks!

Dave

ps. For the record, my data set is empty on this host, and for completeness I'm 
blowing away the ring state when I fiddle with the ring\_creation\_size parameter.

--
Dave Lowell
d...@connectv.com


2012-10-09 00:50:17.430 [info] &lt;0.7.0&gt; Application riak\_kv started on node 
'riak@10.0.3.81'
2012-10-09 00:50:17.456 [info] &lt;0.7.0&gt; Application merge\_index started on node 
'riak@10.0.3.81'
2012-10-09 00:50:17.459 [info] &lt;0.1316.0&gt;@riak\_core:wait\_for\_service:445 
Waiting for service riak\_kv to start (0 seconds)
2012-10-09 00:50:17.525 [info] &lt;0.1303.0&gt;@riak\_core:wait\_for\_application:419 
Wait complete for application riak\_kv (0 seconds)
2012-10-09 00:50:37.366 [error] &lt;0.5081.0&gt;@riak\_kv\_vnode:init:265 Failed to 
start riak\_kv\_eleveldb\_backend Reason: {db\_open,"IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files"}
2012-10-09 00:50:37.423 [notice] &lt;0.5081.0&gt;@riak:stop:46 "backend module failed 
to start."
2012-10-09 00:50:37.424 [error] &lt;0.5081.0&gt; CRASH REPORT Process &lt;0.5081.0&gt; with 
0 neighbours exited with reason: {db\_open,"IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files"} in gen\_fsm:init\_it/6 line 371
2012-10-09 00:50:37.429 [info] &lt;0.494.0&gt;@riak\_kv\_js\_vm:terminate:240 
Spidermonkey VM (pool: riak\_kv\_js\_hook) host stopping (&lt;0.494.0&gt;)
2012-10-09 00:50:37.673 [error] &lt;0.138.0&gt; Supervisor riak\_core\_vnode\_sup had 
child undefined started with {riak\_core\_vnode,start\_link,undefined} at 
&lt;0.5081.0&gt; exit with reason {db\_open,"IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files"} in context child\_terminated
2012-10-09 00:50:37.736 [error] &lt;0.153.0&gt; gen\_server riak\_core\_vnode\_manager 
terminated with reason: no match of right hand value {error,{db\_open,"IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files"}} in riak\_core\_vnode\_manager:get\_vnode/3 line 489
2012-10-09 00:50:37.799 [error] &lt;0.153.0&gt; CRASH REPORT Process 
riak\_core\_vnode\_manager with 0 neighbours exited with reason: no match of right 
hand value {error,{db\_open,"IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files"}} in riak\_core\_vnode\_manager:get\_vnode/3 line 489 in 
gen\_server:terminate/6 line 747
2012-10-09 00:50:37.844 [error] &lt;0.136.0&gt; Supervisor riak\_core\_sup had child 
riak\_core\_vnode\_manager started with riak\_core\_vnode\_manager:start\_link() at 
&lt;0.153.0&gt; exit with reason no match of right hand value {error,{db\_open,"IO 
error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files"}} in riak\_core\_vnode\_manager:get\_vnode/3 line 489 in 
context child\_terminated

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

