---
title: "Re: Precommit hook function - no error log - how to debug?"
description: ""
project: community
lastmod: 2016-05-13T07:09:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17339"
mailinglist_parent_id: "msg17340"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2016-05-13T07:09:11-07:00
---


Sanket -

One other thought. Could you please change the name of your module to
something other than "precommit"? That is the atom being used for
precommit hooks and maybe that's causing an issue.

--
Luke Bakken
Engineer
lbak...@basho.com


On Fri, May 13, 2016 at 7:05 AM, Luke Bakken  wrote:
&gt; Hi Sanket -
&gt;
&gt; Could you please try \*removing\* the precommit hook from the "uuid\_log"
&gt; bucket and define it on the "test\_kv\_wo" bucket type instead?
&gt;
&gt; Removal:
&gt; curl -4vvv -H 'Content-Type: application/json' -X PUT
&gt; localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props -d
&gt; '{"props":{"precommit":[]}}'
&gt;
&gt; Confirm:
&gt; curl -4vvv localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props
&gt;
&gt; Add precommit hook to bucket type:
&gt; curl -4vvv -H 'Content-Type: application/json' -X PUT
&gt; localhost:8098/types/test\_kv\_wo/props -d
&gt; '{"props":{"precommit":[{"mod":"precommit","fun":"pre\_uuid"}]}}'
&gt;
&gt; Confirm:
&gt; curl -4vvv localhost:8098/types/test\_kv\_wo/props
&gt;
&gt; You can then use redbug to trace calls within Erlang:
&gt;
&gt; riak attach
&gt;
&gt; The following statement will wait for up to 10 minutes and will
&gt; display up to 10 calls to your pre\_uuid function. Note that the period
&gt; is significant:
&gt;
&gt; redbug:start(600000, 10, "precommit:pre\_uuid/1-&gt;return").
&gt;
&gt; If you run the above redbug statement on all nodes, you should see one
&gt; or more outputs showing that it was called. You can confirm that
&gt; redbug is working by tracing calls to now():
&gt;
&gt; redbug:start("erlang:now/0").
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt; On Tue, May 10, 2016 at 6:49 PM, Sanket Agrawal
&gt;  wrote:
&gt;&gt; One more thing - I set up the hooks by bucket, not bucket type. The
&gt;&gt; documentation for 2.1.4 says that hooks are defined on the bucket level.
&gt;&gt; Here is how I set up precommit hook (derived from "Riak Handbook" p95):
&gt;&gt;
&gt;&gt; curl -X PUT localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props -H
&gt;&gt; 'Content-Type: application/json' -d '{ "props": { "precommit": [{"mod":
&gt;&gt; "precommit", "fun": "pre\_uuid"}]}}' -v
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, May 10, 2016 at 9:15 PM, Sanket Agrawal 
&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; I just set up a precommit hook function in dev environment (KV 2.1.4)
&gt;&gt;&gt; which doesn't seem to be triggering off at all. The object is being stored
&gt;&gt;&gt; in the bucket, but the precommit logic is not kicking off. I checked couple
&gt;&gt;&gt; of things as listed below but came up with no error - so, it is a
&gt;&gt;&gt; head-scratcher why precommit hook is not triggering:

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

