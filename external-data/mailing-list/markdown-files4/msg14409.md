---
title: "Re: Help on bucket quorums"
description: ""
project: community
lastmod: 2014-06-29T12:29:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14409"
mailinglist_parent_id: "msg14407"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2014-06-29T12:29:08-07:00
---


Roughly. Even with PR/PW you can't say strong \_consistency\_, but you can
reason about stronger \_durability\_ and reduced divergence. To truly get
strong consistency, you have to use a consensus algorithm like Paxos, Raft,
etc. Riak 2.0 will have one that you can turn on per-bucket-type.

Generally it is best to use N/2 + 1 ("quorum") for R / W unless you
absolutely know what you're doing. See
https://www.youtube.com/watch?v=FOQVWdG5e2s for a great use-case of R=1
along with other bucket/request properties.


On Sat, Jun 28, 2014 at 3:33 PM, Alex De la rosa 
wrote:

&gt; Hi Sean,
&gt;
&gt; Thank you very much for your explanation :) looks much clearer now.
&gt;
&gt; So... is not viable to set anything to 0 as it would make no sense and
&gt; fail, and also is not appropriate to set anything to the same value as
&gt; "n\_value" (in this case 3) as there would be false negatives... so the
&gt; adjustments should be between 1 and 2 (the default)... meaning that we can
&gt; only increase its speed a bit setting some value to 1 (r = 1 if we want to
&gt; read fast, w = 1 if we want to write fast)
&gt;
&gt; For what I see, makes no much sense to change PR and PW... and DW only if
&gt; we really really really want strong consistency. Leaving again just the
&gt; real need to set "r" and "w" if we want to speed up any of the processes.
&gt;
&gt; Am I right?
&gt;
&gt; Cheers,
&gt; Alex
&gt;
&gt;
&gt; On Sat, Jun 28, 2014 at 8:41 PM, Sean Cribbs  wrote:
&gt;
&gt;&gt;
&gt;&gt; On Sat, Jun 28, 2014 at 4:55 AM, Alex De la rosa &gt; &gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi there,
&gt;&gt;&gt;
&gt;&gt;&gt; Can somebody help me understand a bit better the bucket quorums? I will
&gt;&gt;&gt; use the Python API to write code examples:
&gt;&gt;&gt;
&gt;&gt;&gt; Imagine we are building a web app like twitter, and we want fast read
&gt;&gt;&gt; (although not need to be consistent) and safe writings, this R/W
&gt;&gt;&gt; combination is appropriate?
&gt;&gt;&gt;
&gt;&gt;&gt; bucket = client.bucket('twits')
&gt;&gt;&gt;
&gt;&gt;&gt; bucket.r = 1
&gt;&gt;&gt; bucket.w = 3
&gt;&gt;&gt;
&gt;&gt;&gt; # OR
&gt;&gt;&gt;
&gt;&gt;&gt; bucket.set\_property('r', 1)
&gt;&gt;&gt; bucket.set\_property('w', 3)
&gt;&gt;&gt;
&gt;&gt;&gt; Which method is better to use? or are just exactly the same?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; The pseudo-properties in the first example are exactly the same as the
&gt;&gt; set\_property() calls in the second, just a convenience. Generally I
&gt;&gt; wouldn't recommend W=3 because it will tend to create false negatives under
&gt;&gt; heavy load, W=2 (the default) should be sufficient. Keep in mind that R=1
&gt;&gt; with notfound\_ok = true (the default) can tend to result in false negative
&gt;&gt; responses as well.
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; Imagine that in this new case, we want to focus on writing fast
&gt;&gt;&gt; (normally we will write more "twits" than read them)... which would be the
&gt;&gt;&gt; most appropriate/suggested quorums?
&gt;&gt;&gt;
&gt;&gt;&gt; Also, what's really the difference between "r" and "pr"? what is a
&gt;&gt;&gt; "primary replica"?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; Primaries are the replicas (nodes) that are the canonical owners the
&gt;&gt; data, but Riak will let you read and write even if they are not available.
&gt;&gt; If they are not available, fallback replicas (non-owner nodes) will take
&gt;&gt; over in their place. Setting PR or PW &gt; 0 will result in failures if that
&gt;&gt; many primaries are not available (the node is down or partitioned from the
&gt;&gt; node that receives the request).
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; If i set up bucket.w = 1, it will still do the 3 copies (n\_val) in the
&gt;&gt;&gt; background but will reply "true" once 1 copy is saved, right?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; Yes. Keep in mind W is a fast-path response, i.e. "I received the request
&gt;&gt; to write", whereas DW is a "I saved the key to the storage engine". There
&gt;&gt; is no practical reason for DW ever to be 0, in fact I think it is
&gt;&gt; disallowed (or silently upgraded to 1).
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Alex
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs 
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

