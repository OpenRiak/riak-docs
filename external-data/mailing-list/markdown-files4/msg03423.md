---
title: "Re: Riak Client Resources,	Deleting a Key Doesn't Remove it from bucket.keys"
description: ""
project: community
lastmod: 2011-05-26T07:35:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03423"
mailinglist_parent_id: "msg03422"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-05-26T07:35:17-07:00
---


How long is the key list cached like that, naturally?\*


Jonathan Langevin
Systems Administrator
Loom Inc.
Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
www.loomlearning.com - Skype: intel352
\*


On Thu, May 26, 2011 at 10:35 AM, Sean Cribbs  wrote:

&gt; Keith,
&gt;
&gt; There was a pull-request issue out for this on the Github project (
&gt; https://github.com/seancribbs/ripple/pull/168). For various reasons, the
&gt; list of keys is memoized in the Riak::Bucket instance. Passing :reload =&gt;
&gt; true to the #keys method will cause it to refresh. I like to discourage
&gt; list-keys, but with the memoized list you don't shoot yourself in the foot
&gt; as often.
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; On May 26, 2011, at 10:29 AM, Keith Bennett wrote:
&gt;
&gt; &gt; All -
&gt; &gt;
&gt; &gt; I just started working with Riak, and am using the riak-client Ruby gem.
&gt; &gt;
&gt; &gt; When I delete a key from a bucket, and try to fetch the value associated
&gt; with that key, I get a 404 error (which is reasonable). However, it remains
&gt; in the bucket's list of keys (i.e. the value returned by bucket.keys(). Why
&gt; is the key still reported to exist in the bucket? Is bucket.keys cached, and
&gt; therefore unaware of the deletion? Here's a riak-client Ruby script and its
&gt; output in irb that illustrates this:
&gt; &gt;
&gt; &gt; ree-1.8.7-2010.02 :001 &gt; require 'riak'
&gt; &gt; =&gt; true
&gt; &gt; ree-1.8.7-2010.02 :002 &gt;
&gt; &gt; ree-1.8.7-2010.02 :003 &gt; client = Riak::Client.new
&gt; &gt; =&gt; #
&gt; &gt; ree-1.8.7-2010.02 :004 &gt; bucket = client['links']
&gt; &gt; =&gt; #
&gt; &gt; ree-1.8.7-2010.02 :005 &gt; key = bucket.keys.first
&gt; &gt; =&gt; "4000-17.xml"
&gt; &gt; ree-1.8.7-2010.02 :006 &gt; object = bucket[key]
&gt; &gt; =&gt; #
&gt; &gt; ree-1.8.7-2010.02 :007 &gt; object.delete
&gt; &gt; =&gt; #
&gt; &gt; ree-1.8.7-2010.02 :008 &gt; bucket.keys.first
&gt; &gt; =&gt; "4000-17.xml"
&gt; &gt; ree-1.8.7-2010.02 :009 &gt; object = bucket[key]
&gt; &gt; Riak::HTTPFailedRequest: Expected [200, 300] from Riak but received 404.
&gt; not found
&gt; &gt;
&gt; &gt; from
&gt; /Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\_http\_backend.rb:55:in
&gt; `perform'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1054:in
&gt; `request'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:2142:in
&gt; `reading\_body'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1053:in
&gt; `request'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1037:in
&gt; `request'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:543:in
&gt; `start'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1035:in
&gt; `request'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\_http\_backend.rb:47:in
&gt; `perform'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\_http\_backend.rb:46:in
&gt; `tap'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\_http\_backend.rb:46:in
&gt; `perform'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/http\_backend/transport\_methods.rb:59:in
&gt; `get'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/http\_backend.rb:72:in
&gt; `fetch\_object'
&gt; &gt; from
&gt; /Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/bucket.rb:101:in
&gt; `[]'
&gt; &gt; from riak-delete-failure.rb:9
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt; Keith
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

