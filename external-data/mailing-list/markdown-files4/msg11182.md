---
title: "Re: Slow write performance for Riak CS"
description: ""
project: community
lastmod: 2013-05-27T20:13:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11182"
mailinglist_parent_id: "msg11181"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2013-05-27T20:13:32-07:00
---


Toby,

Can you trying putting data with a second client simultaneously? When
people have slow benchmarking, lots of times just using multiple
worker/clients helps. Also, what client library are you using?

Also I meant to mention in my first reply, but Boundary
http://boundary.com/worked wonders for us being able to see how much
data was really moving
around. They have a free trial as far as I know. It might be worth it to
see if there are any obvious bottlenecks.

Good luck,
Jared





On Mon, May 27, 2013 at 8:46 PM, Toby Corkindale &lt;
toby.corkind...@strategicdata.com.au&gt; wrote:

&gt; On 28/05/13 01:41, Jared Morrow wrote:
&gt;
&gt;&gt; Toby,
&gt;&gt;
&gt;&gt; If you write with multiple clients does it still stick to 9mb/s or
&gt;&gt; does it increase? What is the network link between your client and
&gt;&gt; the Riak CS cluster? On our internal CS cluster we were seeing
&gt;&gt; around 2gb/s read+write at the network level so I know CS can take
&gt;&gt; the speeds, so my gut thinks you single client might have a slow
&gt;&gt; link. That is just a guess.
&gt;&gt;
&gt;
&gt; The network links are all Ethernet, and appear to be functioning OK.
&gt; iperf reports:
&gt; bandwidth from client to loadbalancer: 2.20 gbit/sec
&gt; bandwidth from loadbalancer to a riak node: 941 mbit/sec
&gt; bandwidth from one riak node to another node: 942 mbit/s
&gt;
&gt; I've tested going direct from a client to a riak node rather than via the
&gt; loadbalancer, but it doesn't seem to make any difference.
&gt;
&gt; Having tested a bit further now, I'd guess that the problem lies with Riak
&gt; rather than Riak CS.
&gt;
&gt; I've noticed that if I try to push files directly into Riak, they go
&gt; fairly slowly too - around 10-20mbyte/sec.
&gt;
&gt; I've tried 3, 10 and 50 MB files, against bitcask, leveldb and even memory
&gt; backends, and in all cases I get fairly consistent transfer rates in that
&gt; range. (just using curl for testing here)
&gt;
&gt; I've tried reducing n\_val to 1, there was a small but not significant
&gt; improvement.
&gt;
&gt; I'm a bit stumped.. However I do note that the log files seem to have a
&gt; lot of "monitor busy\_dist\_port" messages in them.. I'm wondering if that
&gt; might be related somehow?
&gt;
&gt;
&gt; T
&gt;
&gt;
&gt; On May 27, 2013, at 1:38 AM, Toby Corkindale
&gt;&gt; &gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt; Hi, I seem to be getting significantly slower performance out of
&gt;&gt;&gt; Riak CS than I expect to see, and I wondered if I could get some
&gt;&gt;&gt; advice about where I might be going wrong.
&gt;&gt;&gt;
&gt;&gt;&gt; I have a cluster of six nodes, with fairly good sequential-write
&gt;&gt;&gt; disk performance, for eg: # dd if=/dev/zero of=test bs=1M count=500
&gt;&gt;&gt; conv=fsync 524288000 bytes (524 MB) copied, 1.27205 s, 412 MB/s
&gt;&gt;&gt;
&gt;&gt;&gt; The riak partition is formatted as ext4, with data=writeback and
&gt;&gt;&gt; barriers disabled.
&gt;&gt;&gt;
&gt;&gt;&gt; So given n\_val=3, and six nodes with ~400MB/s transfer rates, you'd
&gt;&gt;&gt; expect to see some pretty fast transfers, right?
&gt;&gt;&gt;
&gt;&gt;&gt; However the actual performance I'm getting is reliably a mere 9MB/s
&gt;&gt;&gt; for a single client writing to the cluster. (On a 500M transfer)
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Is this kind of performance normal for this hardware? If not, could
&gt;&gt;&gt; you give me some pointers about what to check?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks, Toby
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ riak-users mailing
&gt;&gt;&gt; list riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

