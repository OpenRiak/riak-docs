---
title: "Re: MapReduce request causes Erlang VM to close"
description: ""
project: community
lastmod: 2012-09-14T06:56:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08536"
mailinglist_parent_id: "msg08534"
author_name: "Staffan Einarsson"
project_section: "mailinglistitem"
sent_date: 2012-09-14T06:56:12-07:00
---


Ian,

I use the prebuilt package of Riak 1.2.0 for Ubuntu Precise.

I think I've got some more information now. The problem seems to show up
when using the ejsLog() function from a MapReduce JS phase function. It has
already been reported once here: https://github.com/basho/riak/issues/209

I have not made a thorough investigation yet, because the ejsLog() function
is not crucial for me/us, and we have bigger fish to fry. But I know that
it used to work before so either something was introduced in the 1.2.0
release that broke it, or it is caused by package dependencies or the
virtualisation platform.

Thanks,

-- Staffan Einarsson
Engineering

Skype: staffan.einarsson
Phone: +46 70 426 07 46
http://muchdifferent.com



On Fri, Sep 14, 2012 at 3:41 PM, Ian Plosker  wrote:

&gt; Staffan,
&gt;
&gt; Are you using a Basho provided package or did you build from source?
&gt;
&gt; -ian
&gt;
&gt; On Thursday, 13 September 2012 at 15:42, Staffan Einarsson wrote:
&gt;
&gt; Ian:
&gt;
&gt; Actually, yes there is: http://pastebin.com/N3zh9fc7
&gt;
&gt; It seems at the end that something fails in the JavaScript driver. Thanks,
&gt; now I have something to investigate.
&gt;
&gt; Michael:
&gt;
&gt; The same error message is also in the kern.log file. Thanks!
&gt;
&gt; -- Staffan Einarsson
&gt; Engineering
&gt;
&gt; Skype: staffan.einarsson
&gt; Phone: +46 70 426 07 46
&gt; http://muchdifferent.com
&gt;
&gt;
&gt;
&gt; On Thu, Sep 13, 2012 at 4:31 PM, Michael Radford  wrote:
&gt;
&gt; I recently had a development instance of Riak get killed by the kernel
&gt; OOM killer, and (on Ubuntu 12.04) it seems like the only place where
&gt; this was logged was /var/log/kern.log.
&gt;
&gt; Mike
&gt;
&gt; On Thu, Sep 13, 2012 at 6:31 AM, Ian Plosker  wrote:
&gt; &gt; Staffan,
&gt; &gt;
&gt; &gt; Is there anything in the kernel ring buffer? You can check it using the
&gt; &gt; dmesg command.
&gt; &gt;
&gt; &gt; -Ian
&gt; &gt;
&gt; &gt; On Sep 13, 2012, at 13:10, Staffan Einarsson
&gt; &gt;  wrote:
&gt; &gt;
&gt; &gt; Hi Kersten,
&gt; &gt;
&gt; &gt; That is exactly my problem. Normally I have something to go on from the
&gt; &gt; error and crash log files, but in this case they are both empty. There is
&gt; &gt; neither any crash dump file. The console.log file contains the same
&gt; &gt; information as the erlang.log.1 file I pasted, minus a few lines.
&gt; &gt;
&gt; &gt; I'm not sure what would cause an Erlang VM to fail so abruptly without
&gt; &gt; saying anything. Is the name clash mentioned at the top of the pasted
&gt; file
&gt; &gt; something that could cause this?
&gt; &gt;
&gt; &gt; Kindly,
&gt; &gt;
&gt; &gt; -- Staffan Einarsson
&gt; &gt; Engineering
&gt; &gt;
&gt; &gt; Skype: staffan.einarsson
&gt; &gt; Phone: +46 70 426 07 46
&gt; &gt; http://muchdifferent.com
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Thu, Sep 13, 2012 at 11:39 AM, Kresten Krab Thorup 
&gt; &gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; What you send does not seem to indicate any errors other than the
&gt; "erlang
&gt; &gt;&gt; has closed" message. Isn't there something else you can share with us?
&gt; a
&gt; &gt;&gt; crash log or something?
&gt; &gt;&gt;
&gt; &gt;&gt; Kresten
&gt; &gt;&gt;
&gt; &gt;&gt; On Sep 13, 2012, at 11:32 AM, Staffan Einarsson
&gt; &gt;&gt;  staffan.einars...@muchdifferent.com&gt;&gt;
&gt; &gt;&gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi guys,
&gt; &gt;&gt;
&gt; &gt;&gt; I'm having a problem with the Erlang VM going down for a Riak node that
&gt; &gt;&gt; receives a MapReduce request.
&gt; &gt;&gt;
&gt; &gt;&gt; My setup is this:
&gt; &gt;&gt;
&gt; &gt;&gt; I run three Riak 1.2.0 nodes, each on an Ubuntu Server 12.04 guest OS on
&gt; &gt;&gt; VirtualBox 4.1.20. The host OS is Windows. I send requests through our
&gt; own
&gt; &gt;&gt; Riak client library, (uGameDB for the Unity game engine), which uses
&gt; the PB
&gt; &gt;&gt; interface. When my test script sends a MapReduce request to one of the
&gt; &gt;&gt; nodes, the node fails instantly.
&gt; &gt;&gt;
&gt; &gt;&gt; The error.log and crash.log files are empty. The erlang.log.1 file says:
&gt; &gt;&gt; http://pastebin.com/1LHqYCaB
&gt; &gt;&gt;
&gt; &gt;&gt; I have tested this with different versions of our client library,
&gt; &gt;&gt; specifically with versions that have previously been confirmed to work,
&gt; to
&gt; &gt;&gt; rule out any error on the client side. I have also tried with different
&gt; &gt;&gt; numbers of nodes, and it is only the node that receives the MapReduce
&gt; &gt;&gt; request that fails.
&gt; &gt;&gt;
&gt; &gt;&gt; Any help is greatly appreciated!
&gt; &gt;&gt;
&gt; &gt;&gt; Kindly,
&gt; &gt;&gt;
&gt; &gt;&gt; -- Staffan Einarsson
&gt; &gt;&gt; Engineering
&gt; &gt;&gt;
&gt; &gt;&gt; Skype: staffan.einarsson
&gt; &gt;&gt; Phone: +46 70 426 07 46
&gt; &gt;&gt; http://muchdifferent.com
&gt; &gt;&gt;
&gt; &gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; Mobile: + 45 2343 4626 | Skype: krestenkrabthorup | Twitter: @drkrab
&gt; &gt;&gt; Trifork A/S | Margrethepladsen 4 | DK- 8000 Aarhus C | Phone : +45
&gt; &gt;&gt; 8732 8787 | www.trifork.com
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

