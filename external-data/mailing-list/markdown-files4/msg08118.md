---
title: "Re: Riak performance on GET operations (was \"LevelDB read performance)"
description: ""
project: community
lastmod: 2012-07-29T21:25:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08118"
mailinglist_parent_id: "msg08116"
author_name: "Parnell Springmeyer"
project_section: "mailinglistitem"
sent_date: 2012-07-29T21:25:11-07:00
---


I (for some reason) didn't think about this… Thanks for saying so; I'll try 
implementing that instead.

On Jul 29, 2012, at 1:46 PM, Rapsey wrote:

&gt; A map reduce job is a batch request. It takes in a list of {Bucket,Key} pairs 
&gt; and returns the result. Though writing map reduce in the erlang PB client is 
&gt; not exactly as nice as one would think. This is the function I use:
&gt; 
&gt; % P = riak connection
&gt; % B = bucket
&gt; % LI = list of keys
&gt; mget\_bin(P,B,LI) -&gt;
&gt; case riakc\_pb\_socket:mapred(P,[{B,key(Key)} || Key &lt;- LI],
&gt; 
&gt; [{reduce, {modfun, 
&gt; riak\_kv\_mapreduce, reduce\_set\_union}, none, false},
&gt; 
&gt; {map, {modfun, 
&gt; riak\_kv\_mapreduce, map\_identity}, none, true}]) of
&gt; {ok,[{\_,L}|\_]} -&gt;
&gt; {ok,[Val || 
&gt; {r\_object,\_Bucket,\_Key,[{r\_content,\_Meta,Val}],\_VClock,\_UpdateMeta,\_UpdateVal}
&gt; &lt;- L]};
&gt; {error,notfound} -&gt;
&gt; undefined;
&gt; X -&gt;
&gt; X
&gt; end.
&gt; 
&gt; 
&gt; 
&gt; On Sat, Jul 28, 2012 at 6:26 PM, Parnell Springmeyer  
&gt; wrote:
&gt; Hi everyone!
&gt; 
&gt; I figured out what my bottleneck was - HTTP API + sequential (as opposed to 
&gt; concurrent) GET requests.
&gt; 
&gt; I wrote a simple Erlange Cowboy handler that uses a worker pool OTP 
&gt; application I built to make concurrent GETs using the PBC api. My Python web 
&gt; app makes a call to the handler and it simulates "batched" requests.
&gt; 
&gt; It would be a great feature in Riak to have batched GETs built in…it 
&gt; shouldn't be too difficult to add to the PBC or HTTP API's and it would be 
&gt; enormously useful, particularly in the event where the client KNOWS the key 
&gt; space and wants a batch of results.
&gt; 
&gt; I might make an experimental fork of Riak to add that feature if Basho isn't 
&gt; working on something similar?
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 



signature.asc
Description: Message signed with OpenPGP using GPGMail
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

