---
title: "Re: Using the Local Client from a riak-attach session"
description: ""
project: community
lastmod: 2013-01-18T10:03:57-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09839"
mailinglist_parent_id: "msg09838"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-01-18T10:03:57-08:00
---


Hi Derek,

The Riak Erlang client (https://github.com/basho/riak-erlang-client) has good 
support for mapreduce, so it may be worthwhile switching to this. 

Here is an example of how to count records returned by a 2i lookup using a map 
reduce query:

riakc\_pb\_socket:mapred(Pid, {index, &lt;&lt;"bucket"&gt;&gt;, &lt;&lt;"index\_int"&gt;&gt;, &lt;&lt;"1"&gt;&gt;, 
&lt;&lt;"50"&gt;&gt;},
 [{reduce, {modfun, 'riak\_kv\_mapreduce', 
'reduce\_count\_inputs'}, none, true}]).

Hope this helps.

Best regards,

Christian

--------------------
Christian Dahlqvist
Client Services Engineer
Basho Technologies
EMEA Office
E-mail: christ...@basho.com
Skype: c.dahlqvist
Mobile: +44 7890 590 910

On 18 Jan 2013, at 09:48, Evan Vigil-McClanahan  wrote:

&gt; Note that this uses the luke mapreduce subsystem, which isn't a good
&gt; idea as it's been deprecated going forward.
&gt; 
&gt; Unfortunately there doesn't seem to be a way that's as simple to do
&gt; pipe mapreduce jobs. I'll ping people and see if we can't get you all
&gt; some code that's slightly easier to use.
&gt; 
&gt; On Fri, Jan 18, 2013 at 5:09 AM, Derek Sanderson  wrote:
&gt;&gt; I love this mailing list
&gt;&gt; 
&gt;&gt; Thank you Daniil! I had almost exactly the first thing you recommended, but
&gt;&gt; the example I found had a slightly different notation, and was throwing
&gt;&gt; errors that I couldn't figure out.
&gt;&gt; 
&gt;&gt; Your example seems to be working, and I think I can get past my issue
&gt;&gt; 
&gt;&gt; Thanks again
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Thu, Jan 17, 2013 at 10:30 PM, Daniil Churikov  wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Another option, if you want range query:
&gt;&gt;&gt; 
&gt;&gt;&gt; {ok, C} = riak:local\_client(),
&gt;&gt;&gt; {ok, Keys} = C:get\_index(&lt;&lt;"bucket\_name"&gt;&gt;, {range,
&gt;&gt;&gt; &lt;&lt;"key\_name\_bin"&gt;&gt;,
&gt;&gt;&gt; KeyStart, KeyTo}),
&gt;&gt;&gt; ...
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; View this message in context:
&gt;&gt;&gt; http://riak-users.197444.n3.nabble.com/Using-the-Local-Client-from-a-riak-attach-session-tp4026572p4026578.html
&gt;&gt;&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;&gt;&gt; 
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

