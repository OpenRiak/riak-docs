---
title: "Re: tuning riak for 100s of concurrent connections"
description: ""
project: community
lastmod: 2011-02-25T11:43:17-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02473"
author_name: "Nico Meyer"
project_section: "mailinglistitem"
sent_date: 2011-02-25T11:43:17-08:00
---


Just out of curiosity I did some tests myself on one of our production
machines. We normally only use the ProtocolBuffers interface and a
thrift interface that we wrote ourselves.

If I fetch a small key (~250 bytes), the riak server becomes CPU bound
with about 20 concurrent requests, at which point the latency naturally
becomes larger. At this point one riak server is handling over 6000
requests/s. This is on an 8 core system (Dual Intel Xeon E5506
@2.13GHz), and all cores are at nearly 100%. No tuning was done on
either riak or the OS.

Also 99% of the requests still took less then 20ms, while with 10
concurrent requests its more like 2ms.


Am Freitag, den 25.02.2011, 13:54 -0500 schrieb Wilson MacGyver:
&gt; SO\_REUSEADDR is also something you set at the socket API as I recall.
&gt; So I don't think it's something you can just set on the TCP/IP itself
&gt; as a global setting.
&gt; 
&gt; On Fri, Feb 25, 2011 at 1:41 PM, Les Mikesell  wrote:
&gt; &gt; Those settings shouldn't make a big difference in how the number of
&gt; &gt; connections scale up, though. There is a theoretical maximum rate limit for
&gt; &gt; creating new connections as each socket is supposed to sit in TIME\_WAIT for
&gt; &gt; a packet round-trip time to ensure that nothing outstanding will collide
&gt; &gt; with that socket number when it is reused for the same IP address. Maybe
&gt; &gt; your test is hitting that limit. Can you set SO\_REUSEADDR?
&gt; 
&gt; 



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

