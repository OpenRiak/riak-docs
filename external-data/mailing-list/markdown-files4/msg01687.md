---
title: "Re: More on Map/Reduce, Riak, and Grails Gorm, spring-data support"
description: ""
project: community
lastmod: 2010-12-01T09:51:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01687"
mailinglist_parent_id: "msg01686"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2010-12-01T09:51:06-08:00
---


On Wed, Dec 1, 2010 at 12:32, Jon Brisbin
 wrote:
&gt;
&gt; On Dec 1, 2010, at 10:08 AM, Kevin Smith wrote:
&gt;
&gt;&gt; There is a cache between the MapReduce machinery and the Javascript VMs to 
&gt;&gt; reduce demand on the VMs. It is a two-level cache based on the bucket/key 
&gt;&gt; pair being accessed and the hash of the Javascript function name or source 
&gt;&gt; being invoked. Changing either the function or writing to the bucket/key 
&gt;&gt; pair should cause the cache to eject entries.
&gt;&gt;
&gt;&gt; If you want to disable the cache, you can do so by adding the following 
&gt;&gt; lines to the riak\_kv section of your app.config:
&gt;&gt;
&gt;&gt; {vnode\_cache\_entries, 0}
&gt;
&gt; This did make a difference. I suspected this was the case, so I added some 
&gt; code to make the Javascript I was submitting always unique. I took that back 
&gt; out and put this setting in place.
&gt;
&gt;&gt; I will dig into the caching code and see if there's an issue with stale 
&gt;&gt; entries not getting ejected.
&gt;
&gt; I can't say for certain, but it seems to be that the M/R gets an incomplete 
&gt; list of keys to use because they are queried first. While the M/R is being 
&gt; run, though, entries are added to that bucket. These are obviously not picked 
&gt; up by the running M/R code because the list of keys has already been obtained.
&gt;

This is more or less how couch works as well. The list of inputs are
determined at runtime and any new keys (in riaks case if you mapped
over a bucket) are not included in the m/r.

&gt; Of course that's just a guess because I don't know the specifics of how it 
&gt; works internally. :)
&gt;
&gt;&gt; What are you using for W or DW on your write calls? With W/DW &lt; N the call 
&gt;&gt; can return while the data is still being replicated.
&gt;
&gt; I was using the defaults.
&gt;
&gt; What I'm trying now is to set the n\_val, w, etc... properties when I start 
&gt; the tests.
&gt;
&gt; If I'm running a single test server, what should I set and to what value? 
&gt; Just w=1 or does r need to be set too?
&gt;
&gt; I basically want to make sure that every write is "flushed" before returning. 
&gt; I don't want to add this to the underlying code, because I want to take 
&gt; advantage of any caching and what-not. I just want to make sure that things 
&gt; are flushed and solid while running the test suite. If it takes twice as 
&gt; long, I don't care. I just want the tests to pass. ;)
&gt;
&gt; jb
&gt;
&gt;
&gt;&gt;
&gt;&gt; --Kevin
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for all the help so far! :)
&gt;&gt;&gt;
&gt;&gt;&gt; Jon Brisbin
&gt;&gt;&gt; Portal Webmaster
&gt;&gt;&gt; NPC International, Inc.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt; Jon Brisbin
&gt; Portal Webmaster
&gt; NPC International, Inc.
&gt;
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

