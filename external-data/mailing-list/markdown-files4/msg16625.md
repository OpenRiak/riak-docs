---
title: "Re: Is storing billions of small files a good Riak-CS/KV usecase?"
description: ""
project: community
lastmod: 2015-10-07T07:38:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16625"
mailinglist_parent_id: "msg16624"
author_name: "David Heidt"
project_section: "mailinglistitem"
sent_date: 2015-10-07T07:38:19-07:00
---


Thank you so much Daniel and Dmitri!

I will benchmark 2i against bitcask expiry and get back to you here in a
couple of days.

Best,

David


2015-10-07 16:23 GMT+02:00 Dmitri Zagidulin :

&gt; On second thought, ignore the Search recommendation. Search + Expiry
&gt; doesn't work very well (when objects expire from Riak, their search index
&gt; entries persist, except now those are orphaned).
&gt;
&gt; On Wed, Oct 7, 2015 at 4:11 PM, Dmitri Zagidulin 
&gt; wrote:
&gt;
&gt;&gt; Hi David,
&gt;&gt;
&gt;&gt; 1) Storing billions of small files is definitely a good use case for Riak
&gt;&gt; KV. (Since they're small, there's no reason to use CS (now re-branded as
&gt;&gt; S2)).
&gt;&gt;
&gt;&gt; 2) As far as deleting an entire bucket, that part is tougher.
&gt;&gt;
&gt;&gt; (Incidentally, if you were thinking of using Riak CS because it has a
&gt;&gt; 'delete bucket' command (see
&gt;&gt; http://docs.basho.com/riakcs/latest/references/apis/storage/s3/RiakCS-DELETE-Bucket/
&gt;&gt; ) -- that won't work, the delete bucket command requires all objects to be
&gt;&gt; deleted first. Meaning, you can only perform it on an empty bucket. Which
&gt;&gt; doesn't help you :) ).
&gt;&gt;
&gt;&gt; Your best bet is to use the Bitcask back end (instead of leveldb), and
&gt;&gt; use its Automatic Expiration setting (see the end of the
&gt;&gt; http://docs.basho.com/riak/latest/ops/advanced/backends/bitcask/#Configuring-Bitcask
&gt;&gt; section, under 'Automatic Expiration').
&gt;&gt;
&gt;&gt; So, you can say:
&gt;&gt;
&gt;&gt; bitcask.expiry = 30d
&gt;&gt;
&gt;&gt; And all of the objects (in all buckets using that backend) will be
&gt;&gt; expired 30 days (from their last-modified timestamp). Which also
&gt;&gt; effectively deletes the bucket they were in.
&gt;&gt;
&gt;&gt; Now, this setting is per-backend. So, if you need other buckets without
&gt;&gt; expirations, you'd want to set up a Multi backend. So, the default backend
&gt;&gt; could be a plain non-expiry Bitcask (or leveldb), and then a second backend
&gt;&gt; would have the expiry setting. You can learn more here:
&gt;&gt;
&gt;&gt; http://docs.basho.com/riak/latest/ops/advanced/backends/multi/
&gt;&gt;
&gt;&gt; What if you want to delete buckets but also use LevelDB?
&gt;&gt;
&gt;&gt; That depends on why you want LevelDB. If you're using it for Secondary
&gt;&gt; Index capability -- you can use Search instead, that works with Bitcask.
&gt;&gt; Or, on the flip side, you can use 2i (secondary index) queries to delete
&gt;&gt; the bucket. You'd use a 2i query to get all the keys in an expiring bucket,
&gt;&gt; and then issue Deletes to each key. (Don't forget to delete with a W value
&gt;&gt; equal to your N value. Or you may have to run the query + delete a few
&gt;&gt; times, to account for stray missing replicas).
&gt;&gt;
&gt;&gt; Does that help explain the situation?
&gt;&gt;
&gt;&gt; Dmitri
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Oct 7, 2015 at 3:43 PM, David Heidt 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hi List,
&gt;&gt;&gt;
&gt;&gt;&gt; would you say that storing billions of very small (json) files is a good
&gt;&gt;&gt; usecase for riak kv or cs?
&gt;&gt;&gt;
&gt;&gt;&gt; here's what I would do:
&gt;&gt;&gt;
&gt;&gt;&gt; \* create daily buckets ( i.e. 2015-10-07)
&gt;&gt;&gt; \* up to 130 Million inserts per day
&gt;&gt;&gt; \* about 150.000 read-ony accesses/day
&gt;&gt;&gt; \* no updates on existing keys/files
&gt;&gt;&gt; \* delete buckets (including keys/files) older than x days
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I already have a working riak-kv/leveldb cluster (inserts and lookups
&gt;&gt;&gt; are going smoothly), but when it comes to mass deletion of keys I found no
&gt;&gt;&gt; way to do this.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Best,
&gt;&gt;&gt;
&gt;&gt;&gt; David
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

