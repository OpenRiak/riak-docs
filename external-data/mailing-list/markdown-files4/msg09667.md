---
title: "Re: CRASH REPORT Process <<\"TypeError: reduce of empty array with no	initial value\">>},{<<\"source\">>,<<\"unknown\">>}]}"
description: ""
project: community
lastmod: 2012-12-21T23:55:35-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09667"
mailinglist_parent_id: "msg09666"
author_name: "David Montgomery"
project_section: "mailinglistitem"
sent_date: 2012-12-21T23:55:35-08:00
---


Hi

As an update.......I did get it to work and still wondering if correct even
though I did get data.

filters = key\_filter.tokenize(":",5).eq(country) \
 & key\_filter.tokenize(":", 2).eq(campaign\_id) \
 & key\_filter.tokenize(":", 4).string\_to\_int().less\_than\_eq(date\_end) \
 & key\_filter.tokenize(":",
4).string\_to\_int().greater\_than\_eq(date\_start)
 query.add\_key\_filters(filters)

I changed the & to a | for the date range. This was a tough bug to track
down yet so simple and image that is why I get the error in the log file.

Thanks



On Sat, Dec 22, 2012 at 3:39 PM, David Montgomery  wrote:

&gt; Hi,
&gt;
&gt; Thanks...... in my mapper I added obj={} which I left out.
&gt;
&gt; But still cant get MR to work but left out that i am using filters. I get
&gt; the same error and am wondering if I am using key filters correct.
&gt; {'uuid':1,'campaign\_id':2,'adgroup\_id':3,'date':4,'country':5}
&gt;
&gt; filters = key\_filter.tokenize(":",5).eq(country) \
&gt; & key\_filter.tokenize(":", 2).eq(campaign\_id) \
&gt; & key\_filter.tokenize(":", 4).string\_to\_int().less\_than\_eq(date\_end) \
&gt; & key\_filter.tokenize(":",
&gt; 4).string\_to\_int().greater\_than\_eq(date\_start)
&gt; query.add\_key\_filters(filters)
&gt;
&gt; '[['and', [['tokenize', ':', 5], ['eq', 'SG']], [['tokenize', ':', 2],
&gt; ['eq', 'cid5989410021']], [['tokenize', ':', 4], ['string\_to\_int'],
&gt; ['less\_than\_eq', '2012122509']], [['tokenize', ':', 4],
&gt; ['string\_to\_int'], ['greater\_than\_eq', '2012121810']]]]
&gt;
&gt; If I leave out & key\_filter.tokenize(":",
&gt; filter\_map['date']).string\_to\_int().greater\_than\_eq(date\_start) the query
&gt; works and I get the data I want. If I include then I get the error.
&gt; So...what I cant figure out is why I cant use the last filter. My key
&gt; looks like this.
&gt; 07712f3d-6661-44a7-89ff-4e4ed3b5f5a6:cid5989410021:agid7744464312:2012122205:SG
&gt;
&gt; uuid:campaign\_id:aid:date:country where date is in YYYYMMDDHH format
&gt;
&gt; I just want a query that will filter by campaign\_id, country, and between
&gt; a date range.
&gt;
&gt; thanks
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Thu, Dec 20, 2012 at 11:07 PM, Bryan Fink  wrote:
&gt;
&gt;&gt; On Thu, Dec 20, 2012 at 8:52 AM, David Montgomery
&gt;&gt;  wrote:
&gt;&gt; &gt;
&gt;&gt; {fitting\_exited\_abnormally,[{&lt;&lt;"lineno"&gt;&gt;,3},{&lt;&lt;"message"&gt;&gt;,&lt;&lt;"TypeError:
&gt;&gt; &gt; reduce of empty array with no initial value"&gt;&gt;}
&gt;&gt;
&gt;&gt; Hi, David. The error is occurring on line three of your reduce
&gt;&gt; function, where it calls `values.reduce`:
&gt;&gt;
&gt;&gt; &gt; query.reduce('''
&gt;&gt; &gt; function(values, arg){
&gt;&gt; &gt; return [ values.reduce( function(acc, item) {
&gt;&gt; ...
&gt;&gt;
&gt;&gt; It's complaining about the fact that `values` is an empty array, so
&gt;&gt; `values.reduce` doesn't know what to do. You will need to either
&gt;&gt; include an initial value as a second parameter, like:
&gt;&gt;
&gt;&gt; values.reduce(function(acc, item) { ... },
&gt;&gt; {}) //initial empty object
&gt;&gt;
&gt;&gt; Or check to see if `values` is empty before reducing, like the Riak JS
&gt;&gt; reduce builtins do:
&gt;&gt;
&gt;&gt; https://github.com/basho/riak\_kv/blob/master/priv/mapred\_builtins.js#L68
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt; Bryan
&gt;&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

