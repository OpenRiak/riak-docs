---
title: "Re: speeding up bulk loading"
description: ""
project: community
lastmod: 2016-09-06T08:11:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17623"
mailinglist_parent_id: "msg17615"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2016-09-06T08:11:25-07:00
---


Hi Travis,

I also want to confirm that you are spreading your load amongst all nodes
in the cluster. You should be connecting your C client to Riak via a proxy
like nginx/HAproxy/F5 [0]. The proxy will do a round robin/least
connections distribution to all nodes in the cluster. This will greatly
increase performance if you are not already doing it.

-alexander

[0] http://docs.basho.com/riak/kv/2.1.4/configuring/load-balancing-proxy/




Alexander Sicular
Solutions Architect
Basho Technologies
9175130679
@siculars

On Wed, Aug 31, 2016 at 10:41 AM, Travis Kirstine &lt;
tkirst...@firstbasesolutions.com&gt; wrote:

&gt; Magnus
&gt;
&gt;
&gt;
&gt; Thanks for your reply. We’re are using the riack C client library for
&gt; riak (https://github.com/trifork/riack) which is used within an
&gt; application called MapCache to store 256x256 px images with a corresponding
&gt; key within riak. Currently we have 75 million images to transfer from disk
&gt; into riak which is being done concurrently. Periodically this transfer
&gt; process will crash
&gt;
&gt;
&gt;
&gt; Riak is setup using n=3 on 5 nodes with a leveldb backend. Each server
&gt; has 45GB of memory and 16 cores with standard hard drives. We made no
&gt; significant modification to the riak.conf except upping the
&gt; leveldb.maximum\_memory.percent to 70 and tweeking the sysctl.conf as follows
&gt;
&gt;
&gt;
&gt; vm.swappiness = 0
&gt;
&gt; net.ipv4.tcp\_max\_syn\_backlog = 40000
&gt;
&gt; net.core.somaxconn = 40000
&gt;
&gt; net.core.wmem\_default = 8388608
&gt;
&gt; net.core.rmem\_default = 8388608
&gt;
&gt; net.ipv4.tcp\_sack = 1
&gt;
&gt; net.ipv4.tcp\_window\_scaling = 1
&gt;
&gt; net.ipv4.tcp\_fin\_timeout = 15
&gt;
&gt; net.ipv4.tcp\_keepalive\_intvl = 30
&gt;
&gt; net.ipv4.tcp\_tw\_reuse = 1
&gt;
&gt; net.ipv4.tcp\_moderate\_rcvbuf = 1
&gt;
&gt; # Increase the open file limit
&gt;
&gt; # fs.file-max = 65536 # current setting
&gt;
&gt;
&gt;
&gt; I have seen this error in the logs
&gt;
&gt; 2016-08-30 22:26:07.180 [error] &lt;0.20777.512&gt; CRASH REPORT Process
&gt; &lt;0.20777.512&gt; with 0 neighbours crashed with reason: no function clause
&gt; matching webmachine\_request:peer\_from\_peername({error,enotconn},
&gt; {webmachine\_request,{wm\_reqstate,#Port&lt;0.2817336&gt;,[],
&gt; undefined,undefined,undefined,{wm\_reqdata,'GET',...},...}}) line 150
&gt;
&gt;
&gt;
&gt; Regards
&gt;
&gt;
&gt;
&gt; \*From:\* Magnus Kessler [mailto:mkess...@basho.com]
&gt; \*Sent:\* August-31-16 4:08 AM
&gt; \*To:\* Travis Kirstine 
&gt; \*Cc:\* riak-users@lists.basho.com
&gt; \*Subject:\* Re: speeding up bulk loading
&gt;
&gt;
&gt;
&gt; On 26 August 2016 at 22:20, Travis Kirstine  com&gt; wrote:
&gt;
&gt; Is there any way to speed up bulk loading? I wondering if I should be
&gt; tweeking the erlang, aae or other config options?
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; Hi Travis,
&gt;
&gt;
&gt;
&gt; Excuse the late reply; your message had been stuck in the moderation
&gt; queue. Please consider subscribing to this list.
&gt;
&gt;
&gt;
&gt; Without knowing more about how you perform bulk uploads, it's difficult to
&gt; recommend any changes. Are you using the HTTP REST API or one of the client
&gt; libraries, which use protocol buffers by default? What concerns do you have
&gt; about the upload performance? Please let us know a bit more about your
&gt; setup.
&gt;
&gt;
&gt;
&gt; Kind Regards,
&gt;
&gt;
&gt;
&gt; Magnus
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt;
&gt; Magnus Kessler
&gt;
&gt; Client Services Engineer
&gt;
&gt; Basho Technologies Limited
&gt;
&gt;
&gt;
&gt; Registered Office - 8 Lincoln’s Inn Fields London WC2A 3BP Reg 07970431
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

