---
title: "Re: 2i for single-result lookup"
description: ""
project: community
lastmod: 2011-11-07T18:11:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05464"
mailinglist_parent_id: "msg05463"
author_name: "Greg Pascale"
project_section: "mailinglistitem"
sent_date: 2011-11-07T18:11:45-08:00
---


Hi Nate,

 There are only 2 secondary keys for now (in addition to the primary key), but 
this number will grow to 5 or more pretty soon. 

I think when you say "insert each separately", you mean create 2 duplicate 
objects, one keyed by username and one keyed by email. Or do you mean create 
one object keyed by username, and then another object containing the username 
and keyed by email (a manual index if you will)? Code complexity is the main 
reason I'd like to avoid a solution like this. Suddenly a user create operation 
requires n writes to be considered a success. If one fails, I need to delete 
the others, etcâ€¦ It quickly becomes a pain.

I don't know what you mean by "some relationship between the keys" 

-- 
Greg
Clipboard

On Monday, November 7, 2011 at 5:59 PM, Nate Lawson wrote:

&gt; On Nov 7, 2011, at 5:45 PM, Greg Pascale wrote:
&gt; 
&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt; I'm thinking about using 2i for a certain piece of my system, but I'm 
&gt; &gt; worried that the document-based partitioning may make it suboptimal.
&gt; &gt; 
&gt; &gt; The issue is that the secondary fields I want to query over (email and 
&gt; &gt; username) are unique, so each will only ever map to one value. Since 2i 
&gt; &gt; queries a coverage set, but I'm only ever looking for one result, it's 
&gt; &gt; going to be hitting n-1 machines needlessly.
&gt; &gt; 
&gt; &gt; So, what I'm looking to understand is how much overhead a single-result 2i 
&gt; &gt; lookup like this will incur vs. a primary-key lookup, or even vs. search. 
&gt; &gt; Search doesn't intuitively feel like the right tool here, but I wonder if 
&gt; &gt; it may actually be preferable since it uses term-based partitioning.
&gt; &gt; 
&gt; &gt; Thanks,
&gt; 
&gt; 
&gt; If it's only 2 keys, why not insert each separately? You will double your 
&gt; total number of keys in the db. But both search and 2I are creating extra 
&gt; keys anyway in their private indices, so it has the same or worse effect on 
&gt; total storage as doubling your primary keys. And query efficiency is worse, 
&gt; as you point out.
&gt; 
&gt; 2I and search are more useful where there's some relationship between the 
&gt; keys, not when they're fully independent as you point out.
&gt; 
&gt; -Nate
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

