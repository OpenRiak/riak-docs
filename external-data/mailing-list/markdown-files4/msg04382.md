---
title: "Re: High cpu usage on store() , small number of keys"
description: ""
project: community
lastmod: 2011-08-17T19:06:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04382"
mailinglist_parent_id: "msg04270"
author_name: "Tony Bussieres"
project_section: "mailinglistitem"
sent_date: 2011-08-17T19:06:05-07:00
---


Hi Ryan,

The cpu usage is mostly constant, on both nodes. I tried to play with my N
but it doesn't make a significant difference.
The 10 writes are happening almost concurrently.

Is there a way to show the impact of the conflict resolutions (stats or
something like it)?

thanks!

-tony

On Mon, Aug 8, 2011 at 10:29 PM, Ryan Zezeski  wrote:

&gt; Tony,
&gt;
&gt; Is it a constant 200% usage? On both nodes in the cluster? My first
&gt; thought, since your working with a small key-space, would be conflict
&gt; resolution or vclock explosion but you're spacing the writes out by 6s which
&gt; seems like more than enough time. Are all 10 writes happening at the same
&gt; time concurrently?
&gt;
&gt; I would set your N=2 since you only have two machines, or add a 3rd node.
&gt;
&gt; Perhaps there is some weird behavior in the cache backend, but I would be
&gt; surprised if that was it.
&gt;
&gt; -Ryan
&gt;
&gt; On Wed, Aug 3, 2011 at 11:31 AM, Tony Bussieres wrote:
&gt;
&gt;&gt; I'm starting to play with Riak, so far I am very impressed with the
&gt;&gt; product.
&gt;&gt;
&gt;&gt; I want to use Riak as an highly available distributed cache.
&gt;&gt;
&gt;&gt; I've compiled Erlang R1304 from source (--with-ssl, --enable-smp-support,
&gt;&gt; --enable-kernel-poll)
&gt;&gt; I've compiled riak-0.14.2 from source
&gt;&gt; I use 2 nodes, they are running on two RHEL5 box . (2.6.18.8.el5 #1 SMP).
&gt;&gt; They are clustered.
&gt;&gt; I use HAProxy to load balance the request on the two nodes.
&gt;&gt;
&gt;&gt; I have a test bench that plays with 80 keys in one bucket (I use
&gt;&gt; riak\_kv\_cache\_backend)
&gt;&gt; I use the java client (riak-client 0.14.1 fetched using a maven repo)
&gt;&gt;
&gt;&gt;
&gt;&gt; I have 10 clients that does something like this :
&gt;&gt; while(true) {
&gt;&gt; Fetch a key from the bucket
&gt;&gt; Sleep between 100 and 400ms
&gt;&gt; }
&gt;&gt;
&gt;&gt; I have also 10 servers that updates data in the keys every 6 seconds (80
&gt;&gt; keys)
&gt;&gt; conceptually they do something like this :
&gt;&gt; while (true) {
&gt;&gt; Fetch a key from the bucket
&gt;&gt; Update the data
&gt;&gt; Store the key in the bucket
&gt;&gt; Sleep 6000ms
&gt;&gt; }
&gt;&gt;
&gt;&gt; The number of clients have a little impact on the CPU usage of the nodes.
&gt;&gt; However when I start 10 servers, the CPU usage goes very high (I saw one
&gt;&gt; of the node going up to 200%)
&gt;&gt;
&gt;&gt; Is there something I should check or do to lower the CPU usage on the
&gt;&gt; nodes when I write keys to Riak?
&gt;&gt;
&gt;&gt; Thanks a lot!
&gt;&gt;
&gt;&gt; -tony
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

