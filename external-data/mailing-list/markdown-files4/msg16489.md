---
title: "Re: What's the maximum seconds to set index on bucket after creating	the index"
description: ""
project: community
lastmod: 2015-09-02T08:51:01-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16489"
mailinglist_parent_id: "msg16488"
author_name: "zlakhani"
project_section: "mailinglistitem"
sent_date: 2015-09-02T08:51:01-07:00
---


Ah. 2.0.4 does not have the configurable timeout and semi-sync setup. You can 
write a poll function to wait and check for index creation and some of the 
clients have something similar as well.

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\_we\_love |
twitter =&gt; @zeeshanlakhani

&gt; On Sep 2, 2015, at 8:31 AM, Hao  wrote:
&gt; 
&gt; v. 2.0.4. I think I know what might be causing the wrong. I forgot to add the 
&gt; my custom extractor into riak. Will test it out.
&gt; 
&gt; 
&gt; Thanks,
&gt; 
&gt; -Hao
&gt; 
&gt;&gt; On 09/02/2015 11:36 PM, Alex Moore wrote:
&gt;&gt; Hao,
&gt;&gt; 
&gt;&gt; What version of Riak are you using?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Alex
&gt;&gt; 
&gt;&gt;&gt; On Sep 2, 2015, at 11:26 AM, Fred Dushin  wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; I apologize, I was wrong about the timeouts -- they are configurable, 
&gt;&gt;&gt; either through the client, or in the advanced config on the Riak server(s).
&gt;&gt;&gt; 
&gt;&gt;&gt; The timeout gets set in the server here:
&gt;&gt;&gt; 
&gt;&gt;&gt; https://github.com/basho/yokozuna/blob/2.1.1/src/yz\_pb\_admin.erl#L114
&gt;&gt;&gt; 
&gt;&gt;&gt; This means you can set the timeout in the PB client, as in
&gt;&gt;&gt; 
&gt;&gt;&gt; riakc\_pb\_socket:create\_search\_index(Pid, Index, Schema, [{timeout, 
&gt;&gt;&gt; Timeout}, ...])
&gt;&gt;&gt; 
&gt;&gt;&gt; where timeout is in milliseconds (or the atom 'infinity').
&gt;&gt;&gt; 
&gt;&gt;&gt; cf. http://basho.github.io/riak-erlang-client/
&gt;&gt;&gt; 
&gt;&gt;&gt; The order of precedence is:
&gt;&gt;&gt; 
&gt;&gt;&gt; 1. client-defined
&gt;&gt;&gt; 2. riak config
&gt;&gt;&gt; 3. default (45 seconds)
&gt;&gt;&gt; 
&gt;&gt;&gt; -Fred
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Sep 2, 2015, at 8:13 AM, Fred Dushin  wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; What is the return value you are getting from 
&gt;&gt;&gt;&gt; rick\_pb\_socket:create\_search\_index? If it's ok, then the Solr cores 
&gt;&gt;&gt;&gt; should have been created on all nodes. Otherwise, you should check the 
&gt;&gt;&gt;&gt; logs for timeout messages, e.g.,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; https://github.com/basho/yokozuna/blob/2.1.1/src/yz\_index.erl#L443
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; If you are getting timeouts, instead of sleeping, you should probably 
&gt;&gt;&gt;&gt; query your cluster for the search index, along the lines of what is done 
&gt;&gt;&gt;&gt; in one of the riak tests, e.g.,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; https://github.com/basho/yokozuna/blob/2.1.1/riak\_test/yz\_pb.erl#L100
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; If necessary, you might want to fold over all nodes in your cluster, to 
&gt;&gt;&gt;&gt; ensure the index has been propagated to all nodes, and possibly use the 
&gt;&gt;&gt;&gt; wait\_for patterns used in the tests.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Unfortunately, it looks like the internal timeout used to wait for 
&gt;&gt;&gt;&gt; propagation of indexes to all nodes is not configurable -- it defaults to 
&gt;&gt;&gt;&gt; 45 seconds:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; https://github.com/basho/yokozuna/blob/2.1.1/include/yokozuna.hrl#L134
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I hope that helps,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; -Fred
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; On Sep 2, 2015, at 6:27 AM, Hao  wrote:
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; What's the maximum seconds to wait after creating an search index and 
&gt;&gt;&gt;&gt;&gt; before setting it on the bucket?
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; On my local machine, I only need to wait 1 second, sometimes I feel I 
&gt;&gt;&gt;&gt;&gt; don't need to wait at all, but on a production server which is basically 
&gt;&gt;&gt;&gt;&gt; zero traffic, I have to wait about 10 seconds(definitely over 5s) before 
&gt;&gt;&gt;&gt;&gt; I can set the index on a bucket.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; I am using riakc\_pb\_socket client. At first I thought something wrong 
&gt;&gt;&gt;&gt;&gt; with my function to "create" and "set" the index but then when I split 
&gt;&gt;&gt;&gt;&gt; the process, it's fine. So seems it's the interval in between that 
&gt;&gt;&gt;&gt;&gt; matters.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; I need to know how long is the maximum because I need to restore a lot of 
&gt;&gt;&gt;&gt;&gt; buckets and set index on them via a script. I don't care how long it 
&gt;&gt;&gt;&gt;&gt; takes but I don't want it to miss any index not being set on the bucket.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; The exact error on the console when I set the index on a bucket is
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; &lt;&lt;"Invalid bucket properties: [{search\_index,\n 
&gt;&gt;&gt;&gt;&gt; &lt;&lt;\"application\_test\_player\_idx does not exist\"&gt;&gt;}]"&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; -- 
&gt;&gt;&gt;&gt;&gt; Hao
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt; 
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt;&gt; 1 attachments
&gt;&gt; signature.asc(1K)
&gt;&gt; download preview
&gt; 
&gt; -- 
&gt; Hao
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

