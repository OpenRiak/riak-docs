---
title: "Re: speeding up bulk loading"
description: ""
project: community
lastmod: 2016-08-31T12:42:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17616"
mailinglist_parent_id: "msg17615"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2016-08-31T12:42:12-07:00
---


Travis,

I cannot address the crash error you see in the logs. Someone else will have 
to review that problem.

I want to point you to this wiki article: 
https://github.com/basho/leveldb/wiki/riak-tuning-2

The article details how you can potentially increase Riak's throughput by 
restricting the number of schedulers (CPUs) assigned solely to Erlang. Heavy 
bulk loading scenarios demonstrated 20 to 30% throughput gain.

Per the wiki article, you would create an (or add to your existing) 
advanced.config with the following based upon your 16 core machines:

[
 {vm\_args, [{"+S", "14:14"}]}
].
Matthew
&gt; On Aug 31, 2016, at 11:41 AM, Travis Kirstine 
&gt;  wrote:
&gt; 
&gt; Magnus
&gt; 
&gt; Thanks for your reply. We’re are using the riack C client library for riak 
&gt; (https://github.com/trifork/riack ) which 
&gt; is used within an application called MapCache to store 256x256 px images with 
&gt; a corresponding key within riak. Currently we have 75 million images to 
&gt; transfer from disk into riak which is being done concurrently. Periodically 
&gt; this transfer process will crash
&gt; 
&gt; Riak is setup using n=3 on 5 nodes with a leveldb backend. Each server has 
&gt; 45GB of memory and 16 cores with standard hard drives. We made no 
&gt; significant modification to the riak.conf except upping the 
&gt; leveldb.maximum\_memory.percent to 70 and tweeking the sysctl.conf as follows
&gt; 
&gt; vm.swappiness = 0
&gt; net.ipv4.tcp\_max\_syn\_backlog = 40000
&gt; net.core.somaxconn = 40000
&gt; net.core.wmem\_default = 8388608
&gt; net.core.rmem\_default = 8388608
&gt; net.ipv4.tcp\_sack = 1
&gt; net.ipv4.tcp\_window\_scaling = 1
&gt; net.ipv4.tcp\_fin\_timeout = 15
&gt; net.ipv4.tcp\_keepalive\_intvl = 30
&gt; net.ipv4.tcp\_tw\_reuse = 1
&gt; net.ipv4.tcp\_moderate\_rcvbuf = 1
&gt; # Increase the open file limit
&gt; # fs.file-max = 65536 # current setting
&gt; 
&gt; I have seen this error in the logs
&gt; 2016-08-30 22:26:07.180 [error] &lt;0.20777.512&gt; CRASH REPORT Process 
&gt; &lt;0.20777.512&gt; with 0 neighbours crashed with reason: no function clause 
&gt; matching webmachine\_request:peer\_from\_peername({error,enotconn}, 
&gt; {webmachine\_request,{wm\_reqstate,#Port&lt;0.2817336&gt;,[],undefined,undefined,undefined,{wm\_reqdata,'GET',...},...}})
&gt; line 150
&gt; 
&gt; Regards
&gt; 
&gt; From: Magnus Kessler [mailto:mkess...@basho.com ] 
&gt; Sent: August-31-16 4:08 AM
&gt; To: Travis Kirstine  &gt;
&gt; Cc: riak-users@lists.basho.com 
&gt; Subject: Re: speeding up bulk loading
&gt; 
&gt; On 26 August 2016 at 22:20, Travis Kirstine  &gt; wrote:
&gt; Is there any way to speed up bulk loading? I wondering if I should be 
&gt; tweeking the erlang, aae or other config options?
&gt; 
&gt; 
&gt; 
&gt; Hi Travis,
&gt; 
&gt; Excuse the late reply; your message had been stuck in the moderation queue. 
&gt; Please consider subscribing to this list.
&gt; 
&gt; Without knowing more about how you perform bulk uploads, it's difficult to 
&gt; recommend any changes. Are you using the HTTP REST API or one of the client 
&gt; libraries, which use protocol buffers by default? What concerns do you have 
&gt; about the upload performance? Please let us know a bit more about your setup.
&gt; 
&gt; Kind Regards,
&gt; 
&gt; Magnus
&gt; 
&gt; 
&gt; -- 
&gt; Magnus Kessler
&gt; Client Services Engineer
&gt; Basho Technologies Limited
&gt; 
&gt; Registered Office - 8 Lincoln’s Inn Fields London WC2A 3BP Reg 07970431
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com 
&gt; 
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

