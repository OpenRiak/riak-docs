---
title: "Re: Forcing Siblings to Occur"
description: ""
project: community
lastmod: 2013-11-13T00:33:22-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12968"
mailinglist_parent_id: "msg12964"
author_name: "Sam Elliott"
project_section: "mailinglistitem"
sent_date: 2013-11-13T00:33:22-08:00
---


We have introduced these so that users who are accidentally creating siblings 
(and large objects) can be notified in their logs. 

1) Of course you can choose to change the limits
2) Please Please only do so if you know what you're doing. There's a certain 
amount of "you're on your own", because we'll set the defaults for these values 
to what we think is sensible for Riak. Of course, if you think your magical 
system will work fine, it's entirely up to you.

We hope that our Data Types will provide enough useful types such that they 
cover the vast majority of data models. Riak 2.0 will get counters, sets, and 
maps, but if you have suggestions for generalised data structures you think 
would be useful to other Riak users, do send them our way and we'll see what we 
can do.

Sam

-- 
Sam Elliott
Engineer
sam.elli...@basho.com
--


On Wednesday, 13 November 2013 at 12:43AM, Olav Frengstad wrote:

&gt; Forgot the link!
&gt; 
&gt; [1] 
&gt; https://github.com/basho/riak\_kv/commit/6981450c5ffc18207b3a1dc057fd3840a0906c42
&gt; 
&gt; 
&gt; 2013/11/13 Olav Frengstad 
&gt; &gt; @John, I'm definitely looking forward to CRDT's but at the same time i'm 
&gt; &gt; looking into alternative approaches for achieving the same thing. 
&gt; &gt; 
&gt; &gt; @Jason, your description is close to what i had in mind. Only real 
&gt; &gt; difference is merge would be on read. I did some testing and m/r seems to 
&gt; &gt; work by using an initial map phase calling `riak\_object:get\_values`
&gt; &gt; 
&gt; &gt; 
&gt; &gt; There's also the addition of maximum number of siblings in riak-2.0[1]
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 2013/11/13 John Daily 
&gt; &gt; &gt; Jason, I don’t see any inherent problems, given reasonable management of 
&gt; &gt; &gt; the situation as you describe. I’d have to chase the code path to see 
&gt; &gt; &gt; what overhead you’re introducing to Riak’s processing, but if it’s 
&gt; &gt; &gt; working well for you, then who am I to object?
&gt; &gt; &gt; 
&gt; &gt; &gt; Perhaps someone who’s more familiar with the sibling management code 
&gt; &gt; &gt; could chime in.
&gt; &gt; &gt; 
&gt; &gt; &gt; -John
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; On Nov 12, 2013, at 5:10 PM, Jason Campbell  &gt; &gt; (mailto:xia...@xiaclo.net)&gt; wrote:
&gt; &gt; &gt; &gt; I am currently forcing siblings for time series data. The maximum 
&gt; &gt; &gt; &gt; bucket sizes are very predictable due to the nature of the data. I 
&gt; &gt; &gt; &gt; originally used the get/update/set cycle, but as I approach the end of 
&gt; &gt; &gt; &gt; the interval, reading and writing 1MB+ objects at a high frequency 
&gt; &gt; &gt; &gt; kills network bandwidth. So now, I append siblings, and I have a cron 
&gt; &gt; &gt; &gt; that merges the previous siblings (a simple set union works for me, 
&gt; &gt; &gt; &gt; only entire objects are ever deleted). 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I can see how it can be dangerous to insert siblings, bit if you have 
&gt; &gt; &gt; &gt; some other method of knowing how much data is in one, I don't see size 
&gt; &gt; &gt; &gt; being an issue. I have also considered using a counter to know how 
&gt; &gt; &gt; &gt; large an object is without fetching it, which shouldn't be off by more 
&gt; &gt; &gt; &gt; than a few siblings unless there is a network partition. 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; So aside from size issues, which can be roughly predicted or worked 
&gt; &gt; &gt; &gt; around, is there any reason to not create hundreds or thousands of 
&gt; &gt; &gt; &gt; siblings and resolve them later? I realise sets could work well for my 
&gt; &gt; &gt; &gt; use case, but they seem overkill for simple append operations when I 
&gt; &gt; &gt; &gt; don't need delete functionality. Creating your own CRDTs are trivial if 
&gt; &gt; &gt; &gt; you never need to delete. 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Thoughts are welcome,
&gt; &gt; &gt; &gt; Jason
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; From: John Daily
&gt; &gt; &gt; &gt; Sent: Wednesday, 13 November 2013 3:10 AM
&gt; &gt; &gt; &gt; To: Olav Frengstad
&gt; &gt; &gt; &gt; Cc: riak-users
&gt; &gt; &gt; &gt; Subject: Re: Forcing Siblings to Occur
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Forcing siblings other than for testing purposes is not typically a 
&gt; &gt; &gt; &gt; good idea; as you indicate, the object size can easily become a problem 
&gt; &gt; &gt; &gt; as all siblings will live inside the same Riak value. 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Your counter-example sounds a lot like a use case for server-side 
&gt; &gt; &gt; &gt; CRDTs; data structures that allow the application to add values without 
&gt; &gt; &gt; &gt; retrieving the server-side content first, and siblings are resolved by 
&gt; &gt; &gt; &gt; Riak. 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; These will arrive with Riak 2.0; see 
&gt; &gt; &gt; &gt; https://gist.github.com/russelldb/f92f44bdfb619e089a4d for an overview.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; -John
&gt; &gt; &gt; &gt; On Nov 12, 2013, at 7:13 AM, Olav Frengstad  &gt; &gt; &gt; (mailto:o...@fwt.no)&gt; wrote:
&gt; &gt; &gt; &gt; &gt; Do you consider forcing siblings a good idea? I would like to get 
&gt; &gt; &gt; &gt; &gt; some input on possible use cases and pitfalls.
&gt; &gt; &gt; &gt; &gt; For instance i have considered to force siblings and then merge them 
&gt; &gt; &gt; &gt; &gt; on read instead of fetching an object every time i want to update it 
&gt; &gt; &gt; &gt; &gt; (especially with larger objects).
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; It's not clear from the docs if there are any limitations, will the 
&gt; &gt; &gt; &gt; &gt; maximum object size be the limitation:?
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; A section of the docs[1] comees comes to mind:
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; "Having an enormous object in your node can cause reads of that 
&gt; &gt; &gt; &gt; &gt; object to crash the entire node. Other issues are increased cluster 
&gt; &gt; &gt; &gt; &gt; latency as the object is replicated and out of memory errors."
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; [1] 
&gt; &gt; &gt; &gt; &gt; http://docs.basho.com/riak/latest/theory/concepts/Vector-Clocks/#Siblings
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; 2013/11/9 Brian Roach 
&gt; &gt; &gt; &gt; &gt; &gt; On Fri, Nov 8, 2013 at 11:38 AM, Russell Brown 
&gt; &gt; &gt; &gt; &gt; &gt;  wrote:
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; If you’re using a well behaved client like the Riak-Java-Client, 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; or any other that gets a vclock before doing a put, use whatever 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; option stops that.
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; for (int i = 0; i &lt; numReplicasWanted; i++) {
&gt; &gt; &gt; &gt; &gt; &gt; bucket.store("key", "value").withoutFetch().execute();
&gt; &gt; &gt; &gt; &gt; &gt; }
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; :)
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; - Roach
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com 
&gt; &gt; &gt; &gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; Med Vennlig Hilsen
&gt; &gt; Olav Frengstad
&gt; &gt; 
&gt; &gt; Systemutvikler // FWT
&gt; &gt; +47 920 42 090
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Med Vennlig Hilsen
&gt; Olav Frengstad
&gt; 
&gt; Systemutvikler // FWT
&gt; +47 920 42 090
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com




\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

