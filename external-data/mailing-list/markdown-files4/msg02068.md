---
title: "Re: Getting all the Keys"
description: ""
project: community
lastmod: 2011-01-22T16:10:03-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02068"
mailinglist_parent_id: "msg02067"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2011-01-22T16:10:03-08:00
---


I think it's worth mentioning that riak is based on Amazon Dynamo and if you 
read the paper you'll see Dynamo's use case is lookup by primary key.

-Ryan

[Sent from my iPhone]

On Jan 22, 2011, at 5:43 PM, Neville Burnell  wrote:

&gt; &gt;As of Riak 0.14 your m/r can filter on key name. I would highly recommend 
&gt; &gt;that your data architecture take this into account by using keys that have 
&gt; &gt;meaningful names. 
&gt; 
&gt; &gt;&gt;&gt;&gt;&gt;&gt;This will allow you to not scan every key in your cluster.
&gt; Is this part true?
&gt; 
&gt; I understood that key filtering just means you dont have to fetch the 'value' 
&gt; from the backend (bitcask or innostore). How would it help wrt to scanning 
&gt; every key? Without a 'secondary index/set' somewhere, you would still need to 
&gt; scan every key in the cluster to find all the keys that match your filter.
&gt; 
&gt; Kind Regards
&gt; 
&gt; Nev
&gt; 
&gt; On 23 January 2011 03:31, Alexander Sicular  wrote:
&gt; Hi Thomas,
&gt; 
&gt; This is a topic that has come up many times. Lemme just hit a couple of high 
&gt; notes in no particular order:
&gt; 
&gt; - If you must do a list keys op on a bucket, you must must must use 
&gt; "?keys=stream". True will block on the coordinating node until all nodes 
&gt; return their keys. Stream will start sending keys as soon as the first node 
&gt; returns.
&gt; 
&gt; - "list keys" is one of the most expensive native operations you can perform 
&gt; in Riak. Not only does it do a full key scan of all the keys in your bucket, 
&gt; but all the keys in your cluster. It is obnoxiously expensive and only more 
&gt; so as the number of keys in your cluster grows. There has been discussions 
&gt; about changing this but everything comes with a cost (more open file 
&gt; descriptors) and I do not believe a decision has been made yet.
&gt; 
&gt; -Riak is in no way a relational system. It is, in fact, about as opposite as 
&gt; you can get. Incidentally, "select \*" is generally not recommended in the 
&gt; Kingdom of Relations and regarded as wasteful. You need a bit of a mind shift 
&gt; from relational world to have success with nosql in general and Riak in 
&gt; particular.
&gt; 
&gt; -There are no native indices in Riak. By default Riak uses the bitcask 
&gt; backend. Bitcask has many advantages but one disadvantage is that all keys 
&gt; (key length + a bit of overhead) must fit in ram.
&gt; 
&gt; -Do not use "?keys=true". Your computer will melt. And then your face.
&gt; 
&gt; -As of Riak 0.14 your m/r can filter on key name. I would highly recommend 
&gt; that your data architecture take this into account by using keys that have 
&gt; meaningful names. This will allow you to not scan every key in your cluster.
&gt; 
&gt; -Buckets are analogous to relational tables but only just. In Riak, you can 
&gt; think of a bucket as a namespace holder (it is used as part of the default 
&gt; circular hash function) but primarily as a mechanism to differentiate system 
&gt; settings from one group of keys to the next.
&gt; 
&gt; -There is no penalty for unlimited buckets except for when their settings 
&gt; deviate from the system defaults. By settings I mean things like hooks, 
&gt; replication values and backends among others.
&gt; 
&gt; -One should list keys by truth if one enjoys sitting in parking lots on the 
&gt; freeway on a scorching summers day or perhaps waiting in a TSA line at your 
&gt; nearest international point of embarkation surrounded by octomom families all 
&gt; the while juggling between the grope or the pr0n slideshow. If that is for 
&gt; you, use "?keys=true".
&gt; 
&gt; -Virtually everything in Riak is transient. Meaning, for the most part (not 
&gt; including the 60 seconds or so of m/r cache), there is no caching going on in 
&gt; Riak outside of the operating system. Ie. your subsequent queries will do 
&gt; more or less the same work as their predecessors. You need to cache your own 
&gt; results if you want to reuse them... quickly.
&gt; 
&gt; 
&gt; 
&gt; Oh, there's more but I'm pretty jelloed from last night. Welcome to the fold, 
&gt; Thomas. Can I call you Tom?
&gt; 
&gt; Cheers,
&gt; -Alexander Sicular
&gt; 
&gt; @siculars
&gt; 
&gt; On Jan 22, 2011, at 10:19 AM, Thomas Burdick wrote:
&gt; 
&gt; &gt; I've been playing around with riak lately as really my first usage of a 
&gt; &gt; distributed key/value store. I quite like many of the concepts and 
&gt; &gt; possibilities of Riak and what it may deliver, however I'm really stuck on 
&gt; &gt; an issue.
&gt; &gt;
&gt; &gt; Doing the equivalent of a select \* from sometable in riak is seemingly 
&gt; &gt; slow. As a quick test I tried...
&gt; &gt;
&gt; &gt; http://localhost:8098/riak/mytable?keys=true
&gt; &gt;
&gt; &gt; Before even iterating over the keys this was unbearably slow already. This 
&gt; &gt; took almost half a second on my machine where mytable is completely empty!
&gt; &gt;
&gt; &gt; I'm a little baffled, I would assume that getting all the keys of a table 
&gt; &gt; is an incredibly common task? How do I get all the keys of a table 
&gt; &gt; quickly? By quickly I mean a few milliseconds or less as I would expect of 
&gt; &gt; even a "slow" rdbms with an empty table, even some tables with 1000's of 
&gt; &gt; items can get all the primary keys of a sql table in a few milliseconds.
&gt; &gt;
&gt; &gt; Tom Burdick
&gt; &gt;
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

