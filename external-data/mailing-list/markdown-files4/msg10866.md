---
title: "Re: Simple mapreduce with 2i returns different result"
description: ""
project: community
lastmod: 2013-04-12T01:43:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10866"
mailinglist_parent_id: "msg10864"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-04-12T01:43:13-07:00
---


Hi Mattias,

MapReduce in Riak executes based on the data in a single partition and does, 
for efficiency reasons, not perform a quorum read (which greatly reduces the 
required amount of network traffic). As Riak is eventually consistent, it is 
possible that all partitions do not hold exactly the same data or version of 
the data at any point in time. What you are seeing could very well be a result 
of all replicas of some data not being in sync across all partitions holding a 
copy.

This would however be corrected either through read-repair or AAE (Active 
Anti-Entropy) if you have this enabled. If you were to perform a GET on a key 
that is missing, triggering read-repair, I would expect it to consistently show 
up in the results from that point on, at least until it is updated again.

Best regards,

Christian



On 12 Apr 2013, at 08:13, Mattias Sj√∂linder  wrote:

&gt; Hi
&gt; 
&gt; I struggling to get a grip around MapReduce and why it is sometimes returning 
&gt; only a subset of what is expected. Is it the nodes processing the map phase 
&gt; that after a specific time returning the found matches so far? I would rather 
&gt; have it returning timeout instead of a subset of the actual match.
&gt; 
&gt; An example is this simple MapReduce:
&gt; 
&gt; {
&gt; "inputs":{
&gt; "bucket":"som-bucket",
&gt; "index":"userid\_bin",
&gt; "key":"18481123123"
&gt; },
&gt; "query":[
&gt; {
&gt; "map":{
&gt; "language":"javascript",
&gt; "name":"Riak.mapValuesJson",
&gt; "keep":true
&gt; }
&gt; }
&gt; ]
&gt; }
&gt; 
&gt; 
&gt; Any thoughts?
&gt; 
&gt; Regards
&gt; Mattias
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

