---
title: "Re: Riak2.0 with Solr Search: index on one node contains not all	entries"
description: ""
project: community
lastmod: 2015-03-25T09:29:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15928"
mailinglist_parent_id: "msg15927"
author_name: "Michael Weibel"
project_section: "mailinglistitem"
sent_date: 2015-03-25T09:29:34-07:00
---


Hi Zeeshan,

Ok, will do that and report back as soon as I have it.. Might take a while
though because I first also have to figure out whether I have still the
same issue or not.. ;)

Thanks!
Michael


2015-03-25 16:56 GMT+01:00 Zeeshan Lakhani :

&gt; Hey Michael,
&gt;
&gt; Ideally, for this “testing" setup, n\_val=2 would be the effective choice.
&gt; I’d create a new bucket\_type/bucket and re-PUT your data in and test search
&gt; again to be sure.
&gt;
&gt; Let me know. Thanks.
&gt;
&gt; Zeeshan Lakhani
&gt; programmer |
&gt; software engineer at @basho |
&gt; org. member/founder of @papers\_we\_love | paperswelove.org
&gt; twitter =&gt; @zeeshanlakhani
&gt;
&gt; On Mar 25, 2015, at 11:02 AM, Michael Weibel 
&gt; wrote:
&gt;
&gt; Hi Zeeshan,
&gt;
&gt; Thanks for your answer.
&gt;
&gt;&gt; Just to be sure, does your custom schema include the required fields, as
&gt;&gt; mentioned in the docs:
&gt;&gt; http://docs.basho.com/riak/latest/dev/advanced/search-schema/#Custom-Schemas?
&gt;&gt;
&gt;
&gt; Yes, I double checked that now to make sure, and the schema includes the
&gt; required fields.
&gt;
&gt;
&gt;&gt; Are these Riak nodes joined? What’s your ring size, n\_val value?
&gt;&gt;
&gt;
&gt; They run in a cluster, yes. Output of "riak-admin status":
&gt;
&gt; ring\_creation\_size : 64
&gt; ring\_members : ['riak@IPADDRESS','riak@IPADDRESS']
&gt; ring\_num\_partitions : 64
&gt; ring\_ownership : &lt;&lt;"[{'riak@IPADDRESS',32},{'riak@IPADDRESS',32}]"&gt;&gt;
&gt; rings\_reconciled : 0
&gt; rings\_reconciled\_total : 33
&gt;
&gt; n\_val is 3, the initial one. According to the docs we should probably
&gt; either add another node or reduce it to "2" though..correct? (Sorry, newbie
&gt; in riak here :D)
&gt;
&gt;
&gt;&gt; How are you querying the Solr nodes to know which node has the data and
&gt;&gt; which one doesn't? Coverage is R=1, so you would be getting a different
&gt;&gt; number on some search queries (using the standard
&gt;&gt; /search/query/?...) if its only on one of the Solr cores.
&gt;&gt;
&gt;
&gt; Yes exactly. That's how I figured out that there's a difference, later on
&gt; I queried the separate Solr instances using the solr admin interface
&gt; itself. I also then fetched the missing key on both the riak nodes (without
&gt; going to solr, just fetching it directly using the riak HTTP API) and they
&gt; exist on both nodes.
&gt;
&gt;
&gt;&gt; Can you also post me a screenshot of your search AAE exchanges, e.g.
&gt;&gt; `riak-admin search aae-status`? You could look at this thread,
&gt;&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2015-March/016926.html,
&gt;&gt; for answers on how to perform read-repair/repair the AAE tree.
&gt;&gt;
&gt;
&gt; aae-status is in the .log file attached.
&gt;
&gt; So you'd propose to perform a read-repair on the AAE tree?
&gt;
&gt; Best,
&gt; Michael
&gt;
&gt;
&gt;
&gt;&gt;
&gt;&gt; Thanks.
&gt;&gt;
&gt;&gt; Zeeshan Lakhani
&gt;&gt; programmer |
&gt;&gt; software engineer at @basho |
&gt;&gt; org. member/founder of @papers\_we\_love | paperswelove.org
&gt;&gt; twitter =&gt; @zeeshanlakhani
&gt;&gt;
&gt;&gt; On Mar 25, 2015, at 6:42 AM, Michael Weibel 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt; Hi all,
&gt;&gt;
&gt;&gt; I have on a test environment two riak nodes and each of them has solr
&gt;&gt; activated which index 3 buckets using a custom schema.
&gt;&gt; After testing a bit back and forth, I have the case that on one solr
&gt;&gt; node, an entry is not in the index (I know in which node though).
&gt;&gt; Fetching the specific key in the bucket works however, both nodes have
&gt;&gt; the respective entry.
&gt;&gt;
&gt;&gt; 1) How can this happen? I don't see any error/warning in the logs
&gt;&gt; (neither solr nor riak logs).
&gt;&gt; 2) Is there a possibility to fix this without having to do e.g. a PUT on
&gt;&gt; the specific key with the same content in order to update it?
&gt;&gt;
&gt;&gt; I tried to run a repair on the failing node using the guide:
&gt;&gt; http://docs.basho.com/riak/1.4.7/ops/running/recovery/repairing-indexes/#Repairing-Search-Indexes
&gt;&gt; When running the repair command on the partitions I received, it gave me
&gt;&gt; however a [{, down}, {...}] response, which gives me an
&gt;&gt; uncomfortable feeling, but I didn't really figure out yet what this means
&gt;&gt; exactly.
&gt;&gt;
&gt;&gt; Thanks a lot for your help :)
&gt;&gt;
&gt;&gt; Best,
&gt;&gt; Michael
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt; 
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

