---
title: "Re: Docs on Rspec & Ripple"
description: ""
project: community
lastmod: 2011-02-13T20:33:23-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02310"
mailinglist_parent_id: "msg02306"
author_name: "Mat Ellis"
project_section: "mailinglistitem"
sent_date: 2011-02-13T20:33:23-08:00
---


I see now that test\_server.rb should fire up an instance of Riak with the right 
parameters. Is there somewhere I could see the official way to setup a staging 
or test instance? From a blank system to where rake spec should just work?

Thanks

On Feb 12, 2011, at 9:07 PM, Sean Cribbs wrote:

&gt; I'm looking into causes of this - you aren't the only one who has hit it. 
&gt; (https://github.com/seancribbs/ripple/issues#issue/103) So far I have been 
&gt; unable to reproduce it, but in the meantime, check the typical culprits:
&gt; 
&gt; \* ulimit -n (set this in the shell where you run rake or rspec)
&gt; \* RAM usage (memsup may cause Riak to close)
&gt; \* Permissions on the relevant directories and files
&gt; \* Port collision - (web\_port/http, pb\_port, handoff\_port)
&gt; 
&gt; The test server is mostly-threadsafe but doesn't guarantee that separate 
&gt; threads won't collide with one another's data. Make sure your suite isn't 
&gt; parallelized (Spork, for example?).
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On Feb 12, 2011, at 11:43 PM, Mat Ellis wrote:
&gt; 
&gt;&gt; I got the wrong impression, I thought the test\_server was setup by the 
&gt;&gt; script. Once we setup a variant of the dev environment and pointed 
&gt;&gt; test\_server.rb at that things moved forward. Now we just get:
&gt;&gt; 
&gt;&gt; "Broken pipe when recycling, is Riak alive?"
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Feb 12, 2011, at 8:31 PM, Mat Ellis wrote:
&gt;&gt; 
&gt;&gt;&gt; The specific issue we're having is that we can't get the test server to 
&gt;&gt;&gt; stay up, it seems to die after 5-6 seconds.
&gt;&gt;&gt; 
&gt;&gt;&gt; We setup our dev environments based on the Riak Fast Track and so there was 
&gt;&gt;&gt; nothing in RIAK\_ROOT/rel/riak/bin. 
&gt;&gt;&gt; 
&gt;&gt;&gt; We tried RIAK\_ROOT/dev/dev1/bin and also 'make rel' in RIAK\_ROOT. 
&gt;&gt;&gt; 
&gt;&gt;&gt; Any time we try any Ripple operations against the test server we get 
&gt;&gt;&gt; 'EOFError: end of file reached.'
&gt;&gt;&gt; 
&gt;&gt;&gt; M.
&gt;&gt;&gt; 
&gt;&gt;&gt; On Feb 12, 2011, at 8:23 PM, Sean Cribbs wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; The generators are there to help (assuming you have Ripple in your bundle):
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Ripple:
&gt;&gt;&gt;&gt; ripple
&gt;&gt;&gt;&gt; ripple:configuration
&gt;&gt;&gt;&gt; ripple:js
&gt;&gt;&gt;&gt; ripple:model
&gt;&gt;&gt;&gt; ripple:test
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; The root "ripple" generator will generate configuration, js, and test. 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; The "configuration" generator adds a config/ripple.yml that you use 
&gt;&gt;&gt;&gt; normally to set up your dev and prod environments, and a hint on how to 
&gt;&gt;&gt;&gt; set up the test env. The test server also gets its configuration from the 
&gt;&gt;&gt;&gt; file. The only thing you really need to set is "bin\_dir", which gives the 
&gt;&gt;&gt;&gt; directory where the "riak" start script lives (depends on how you 
&gt;&gt;&gt;&gt; installed Riak, obviously).
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; The "test" generator will add the file spec/support/ripple.rb which wraps 
&gt;&gt;&gt;&gt; the test-server up for you in a friendly package. It also inserts an 
&gt;&gt;&gt;&gt; "after :each" block to your spec\_helper.rb that wires up clearing the data 
&gt;&gt;&gt;&gt; for you. The test server is completely independent of any stubbing or 
&gt;&gt;&gt;&gt; additional testing frameworks you use and so it should still work for your 
&gt;&gt;&gt;&gt; specs. Think of it like having a separate test database, with a big 
&gt;&gt;&gt;&gt; rolled-back transaction at the end of each example.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Feb 12, 2011, at 11:02 PM, Mat Ellis wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Is there a tutorial or a walk-through available for testing with Rspec & 
&gt;&gt;&gt;&gt;&gt; Ripple? Currently ploughing our way through 
&gt;&gt;&gt;&gt;&gt; https://github.com/seancribbs/ripple/tree/41a7f741603ea186d97064ff3ef542238a078135/ripple/spec
&gt;&gt;&gt;&gt;&gt; attempting to make the in memory test server work. And of course, our 
&gt;&gt;&gt;&gt;&gt; Rspec setup is a little different (mocha stubbing, shoulda, etc.) We'll 
&gt;&gt;&gt;&gt;&gt; probably get there eventually any docs or cribsheets would be helpful.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; TIA M.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

