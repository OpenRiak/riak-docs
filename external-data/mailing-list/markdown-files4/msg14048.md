---
title: "Re: RIAK 1.4.6 - Mass key deletion"
description: ""
project: community
lastmod: 2014-04-10T06:25:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14048"
author_name: "Edgar Veiga"
project_section: "mailinglistitem"
sent_date: 2014-04-10T06:25:25-07:00
---


Thanks, I'll start the process and give you guys some feedback in the mean
while.

The plan is
1 - Disable AAE in the cluster via riak attach:


a.
rpc:multicall(riak\_kv\_entropy\_manager, disable, []).
rpc:multicall(riak\_kv\_entropy\_manager, cancel\_exchanges, []).
z.

2 - Update the app.config changing the aae dir to the mechanic disk;

3 - Restart riak process in each machine one by one;

4 - Remove old aae data;

By the way, I've seen here in the list different ways of disabling the
aae via riak attach... The former one is the most complete. What does
the a. and z. stand for? I've been disabling the aae just running
"rpc:multicall(riak\_kv\_entropy\_manager, disable, []).", is there any
difference if we ignore the a., z. and the cancel\_exchanges?

Best regards!



On 10 April 2014 13:41, Matthew Von-Maszewski  wrote:

&gt; Yes, you can send the AAE (active anti-entropy) data to a different disk.
&gt;
&gt; AAE calculates a hash each time you PUT new data to the regular database.
&gt; AAE then buffers around 1,000 hashes (I forget the exact value) to write
&gt; as a block to the AAE database. The AAE write is NOT in series with the
&gt; user database writes. Your throughput should not be impacted. But this is
&gt; not something I have personally measured/validated.
&gt;
&gt; Matthew
&gt;
&gt;
&gt; On Apr 10, 2014, at 7:33 AM, Edgar Veiga  wrote:
&gt;
&gt; Hi Matthew!
&gt;
&gt; I have a possibility of moving the data of anti-entropy directory to a
&gt; mechanic disk 7200, that exists on each of the machines. I was thinking of
&gt; changing the anti\_entropy data dir config in app.config file and restart
&gt; the riak process.
&gt;
&gt; Is there any problem using a mechanic disk to store the anti-entropy data?
&gt;
&gt; Best regards!
&gt;
&gt;
&gt; On 8 April 2014 23:58, Edgar Veiga  wrote:
&gt;
&gt;&gt; I'll wait a few more days, see if the AAE maybe "stabilises" and only
&gt;&gt; after that make a decision regarding this.
&gt;&gt; The cluster expanding was on the roadmap, but not right now :)
&gt;&gt;
&gt;&gt; I've attached a few screenshot, you can clearly observe the evolution of
&gt;&gt; one of the machines after the anti-entropy data removal and consequent
&gt;&gt; restart (5th of April).
&gt;&gt;
&gt;&gt; https://cloudup.com/cB0a15lCMeS
&gt;&gt;
&gt;&gt; Best regards!
&gt;&gt;
&gt;&gt;
&gt;&gt; On 8 April 2014 23:44, Matthew Von-Maszewski  wrote:
&gt;&gt;
&gt;&gt;&gt; No. I do not see a problem with your plan. But ...
&gt;&gt;&gt;
&gt;&gt;&gt; I would prefer to see you add servers to your cluster. Scalabilty is
&gt;&gt;&gt; one of Riak's fundamental characteristics. As your database needs grow, we
&gt;&gt;&gt; grow with you ... just add another server and migrate some of the vnodes
&gt;&gt;&gt; there.
&gt;&gt;&gt;
&gt;&gt;&gt; I obviously cannot speak to your budgetary constraints. All of the
&gt;&gt;&gt; engineers at Basho, I am just one, are focused upon providing you
&gt;&gt;&gt; performance and features along with your scalability needs. This seems to
&gt;&gt;&gt; be a situation where you might be sacrificing data integrity where another
&gt;&gt;&gt; server or two would address the situation.
&gt;&gt;&gt;
&gt;&gt;&gt; And if 2.0 makes things better ... sell the extra servers on Ebay.
&gt;&gt;&gt;
&gt;&gt;&gt; Matthew
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Apr 8, 2014, at 6:31 PM, Edgar Veiga  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks Matthew!
&gt;&gt;&gt;
&gt;&gt;&gt; Today this situation has become unsustainable, In two of the machines I
&gt;&gt;&gt; have an anti-entropy dir of 250G... It just keeps growing and growing and
&gt;&gt;&gt; I'm almost reaching max size of the disks.
&gt;&gt;&gt;
&gt;&gt;&gt; Maybe I'll just turn off aae in the cluster, remove all the data in the
&gt;&gt;&gt; anti-entropy directory and wait for the v2 of riak. Do you see any problem
&gt;&gt;&gt; with this?
&gt;&gt;&gt;
&gt;&gt;&gt; Best regards!
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 8 April 2014 22:11, Matthew Von-Maszewski  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Edgar,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Today we disclosed a new feature for Riak's leveldb, Tiered Storage.
&gt;&gt;&gt;&gt; The details are here:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; https://github.com/basho/leveldb/wiki/mv-tiered-options
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This feature might give you another option in managing your storage
&gt;&gt;&gt;&gt; volume.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Apr 8, 2014, at 11:07 AM, Edgar Veiga  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It makes sense, I do a lot, and I really mean a LOT of updates per key,
&gt;&gt;&gt;&gt; maybe thousands a day! The cluster is experiencing a lot more updates per
&gt;&gt;&gt;&gt; each key, than new keys being inserted.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The hash trees will rebuild during the next weekend (normally it takes
&gt;&gt;&gt;&gt; about two days to complete the operation) so I'll come back and give you
&gt;&gt;&gt;&gt; some feedback (hopefully good) on the next Monday!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Again, thanks a lot, You've been very helpful.
&gt;&gt;&gt;&gt; Edgar
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On 8 April 2014 15:47, Matthew Von-Maszewski wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Edgar,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; The test I have running currently has reach 1 Billion keys. It is
&gt;&gt;&gt;&gt;&gt; running against a single node with N=1. It has 42G of AAE data. Here is
&gt;&gt;&gt;&gt;&gt; my extrapolation to compare your numbers:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; You have ~2.5 Billion keys. I assume you are running N=3 (the
&gt;&gt;&gt;&gt;&gt; default). AAE therefore is actually tracking ~7.5 Billion keys. You have
&gt;&gt;&gt;&gt;&gt; six nodes, therefore tracking ~1.25 Billion keys per node.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Raw math would suggest that my 42G of AAE data for 1 billion keys
&gt;&gt;&gt;&gt;&gt; would extrapolate to 52.5G of AAE data for you. Yet you have ~120G of AAE
&gt;&gt;&gt;&gt;&gt; data. Is something wrong? No. My data is still loading and has
&gt;&gt;&gt;&gt;&gt; experience zero key/value updates/edits.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; AAE hashes get rewritten every time a user updates the value of a key.
&gt;&gt;&gt;&gt;&gt; AAE's leveldb is just like the user leveldb, all prior values of a key
&gt;&gt;&gt;&gt;&gt; accumulate in the .sst table files until compaction removes duplicates.
&gt;&gt;&gt;&gt;&gt; Similarly, a user delete of a key causes a delete tombstone in the AAE
&gt;&gt;&gt;&gt;&gt; hash tree. Those delete tombstones have to await compactions too before
&gt;&gt;&gt;&gt;&gt; leveldb recovers the disk space.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; AAE's hash trees rebuild weekly. I am told that the rebuild operation
&gt;&gt;&gt;&gt;&gt; will actually destroy the existing files and start over. That is when you
&gt;&gt;&gt;&gt;&gt; should see AAE space usage dropping dramatically.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Apr 8, 2014, at 9:31 AM, Edgar Veiga  wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks a lot Matthew!
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; A little bit of more info, I've gathered a sample of the contents of
&gt;&gt;&gt;&gt;&gt; anti-entropy data of one of my machines:
&gt;&gt;&gt;&gt;&gt; - 44 folders with the name equal to the name of the folders in
&gt;&gt;&gt;&gt;&gt; level-db dir (i.e. 393920363186844927172086927568060657641638068224/)
&gt;&gt;&gt;&gt;&gt; - each folder has a 5 files (log, current, log, etc) and 5 sst\_\*
&gt;&gt;&gt;&gt;&gt; folders.
&gt;&gt;&gt;&gt;&gt; - The biggest sst folder is sst\_3 with 4.3G
&gt;&gt;&gt;&gt;&gt; - Inside sst\_3 folder there are 1219 files name 00\*\*\*\*.sst.
&gt;&gt;&gt;&gt;&gt; - Each of the 00\*\*\*\*\*.sst files has ~3.7M
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hope this info gives you some more help!
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Best regards, and again, thanks a lot
&gt;&gt;&gt;&gt;&gt; Edgar
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On 8 April 2014 13:24, Matthew Von-Maszewski wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Argh. Missed where you said you had upgraded. Ok it will proceed with
&gt;&gt;&gt;&gt;&gt;&gt; getting you comparison numbers.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Sent from my iPhone
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Apr 8, 2014, at 6:51 AM, Edgar Veiga 
&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Thanks again Matthew, you've been very helpful!
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Maybe you can give me some kind of advise on this issue I'm having
&gt;&gt;&gt;&gt;&gt;&gt; since I've upgraded to 1.4.8.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Since I've upgraded my anti-entropy data has been growing a lot and
&gt;&gt;&gt;&gt;&gt;&gt; has only stabilised in very high values... Write now my cluster has 6
&gt;&gt;&gt;&gt;&gt;&gt; machines each one with ~120G of anti-entropy data and 600G of level-db
&gt;&gt;&gt;&gt;&gt;&gt; data. This seems to be quite a lot no? My total amount of keys is ~2.5
&gt;&gt;&gt;&gt;&gt;&gt; Billions.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Best regards,
&gt;&gt;&gt;&gt;&gt;&gt; Edgar
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On 6 April 2014 23:30, Matthew Von-Maszewski wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Edgar,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; This is indirectly related to you key deletion discussion. I made
&gt;&gt;&gt;&gt;&gt;&gt;&gt; changes recently to the aggressive delete code. The second section of 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; following (updated) web page discusses the adjustments:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://github.com/basho/leveldb/wiki/Mv-aggressive-delete
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Apr 6, 2014, at 4:29 PM, Edgar Veiga 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Matthew, thanks again for the response!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; That said, I'll wait again for the 2.0 (and maybe buy some bigger
&gt;&gt;&gt;&gt;&gt;&gt;&gt; disks :)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Best regards
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 6 April 2014 15:02, Matthew Von-Maszewski wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Edgar,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; In Riak 1.4, there is no advantage to using empty values versus
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; deleting.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; leveldb is a "write once" data store. New data for a given key
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; never physically overwrites old data for the same key. New data 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; "hides"
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; the old data by being in a lower level, and therefore picked first.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; leveldb's compaction operation will remove older key/value pairs
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; only when the newer key/value is pair is part of a compaction involving
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; both new and old. The new and the old key/value pairs must have 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; migrated
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to adjacent levels through normal compaction operations before leveldb 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; will
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; see them in the same compaction. The migration could take days, 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; weeks, or
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; even months depending upon the size of your entire dataset and the 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; rate of
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; incoming write operations.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; leveldb's "delete" object is exactly the same as your empty JSON
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; object. The delete object simply has one more flag set that allows it 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; also be removed if and only if there is no chance for an identical key 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; exist on a higher level.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I apologize that I cannot give you a more useful answer. 2.0 is on
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; the horizon.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Apr 6, 2014, at 7:04 AM, Edgar Veiga 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi again!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Sorry to reopen this discussion, but I have another question
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; regarding the former post.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; What if, instead of doing a mass deletion (We've already seen that
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; it will be non profitable, regarding disk space) I update all the 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; values
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; with an empty JSON object "{}" ? Do you see any problem with this? I no
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; longer need those millions of values that are living in the cluster...
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; When the version 2.0 of riak runs stable I'll do the update and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; only then delete those keys!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Best regards
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 18 February 2014 16:32, Edgar Veiga wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Ok, thanks a lot Matthew.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 18 February 2014 16:18, Matthew Von-Maszewski &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; matth...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Riak 2.0 is coming. Hold your mass delete until then. The "bug"
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; is within Google's original leveldb architecture. Riak 2.0 sneaks 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; around
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to get the disk space freed.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Feb 18, 2014, at 11:10 AM, Edgar Veiga 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; The only/main purpose is to free disk space..
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I was a little bit concerned regarding this operation, but now
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; with your feedback I'm tending to don't do nothing, I can't risk the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; growing of space...
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Regarding the overhead I think that with a tight throttling
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; system I could control and avoid overloading the cluster.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Mixed feelings :S
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 18 February 2014 15:45, Matthew Von-Maszewski &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; matth...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Edgar,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; The first "concern" I have is that leveldb's delete does not
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; free disk space. Others have executed mass delete operations only 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; to
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; discover they are now using more disk space instead of less. Here 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; is a
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; discussion of the problem:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://github.com/basho/leveldb/wiki/mv-aggressive-delete
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; The link also describes Riak's database operation overhead.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; This is a second "concern". You will need to carefully throttle 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; your
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; delete rate or the overhead will likely impact your production 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; throughput.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; We have new code to help quicken the actual purge of deleted
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; data in Riak 2.0. But that release is not quite ready for 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; production usage.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; What do you hope to achieve by the mass delete?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Feb 18, 2014, at 10:29 AM, Edgar Veiga 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Sorry, forgot that info!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; It's leveldb.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Best regards
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On 18 February 2014 15:27, Matthew Von-Maszewski &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; matth...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Which Riak backend are you using: bitcask, leveldb, multi?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Feb 18, 2014, at 10:17 AM, Edgar Veiga &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; edgarmve...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Hi all!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I have a fairly trivial question regarding mass deletion on a
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak cluster, but firstly let me give you just some context. My 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; cluster is
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; running with riak 1.4.6 on 6 machines with a ring of 256 nodes and 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1Tb ssd
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; disks.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; I need to execute a massive object deletion on a bucket, I'm
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; talking of ~1 billion keys (The object average size is ~1Kb). I 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; will not
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; retrive the keys from riak because a I have a file with all of 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; them. I'll
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; just start a script that reads them from the file and triggers an 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; HTTP
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; DELETE for each one.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; The cluster will continue running on production with a quite
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; high load serving all other applications, while running this 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; deletion.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; My question is simple, do I need to have any kind of extra
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; concerns regarding this action? Do you advise me on taking special
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; attention to any kind of metrics regarding riak or event the 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; servers where
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; it's running?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; Best regards!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

