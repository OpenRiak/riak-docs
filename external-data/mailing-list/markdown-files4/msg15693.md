---
title: "Re: Simple 3 node test cluster eating all my memory"
description: ""
project: community
lastmod: 2015-02-12T02:09:13-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15693"
mailinglist_parent_id: "msg15692"
author_name: "Juan Luis Francés"
project_section: "mailinglistitem"
sent_date: 2015-02-12T02:09:13-08:00
---


Hi Simon.

Maybe sadly you have been hit by this bug: 
https://github.com/basho/riak\_kv/issues/1064

Sadly, because I think that there aren’t a soon resolution about this issue.

Juan Luis Francés

&gt; El 12/2/2015, a las 10:51, Simon Hartley  
&gt; escribió:
&gt; 
&gt; Hi,
&gt; 
&gt; We have a simple 3 node test cluster, and we are seeing this cluster 
&gt; fall-over under quite modest loads, 2-3 times a day with the node reporting 
&gt; out of memory problems.
&gt; 
&gt; Our basic details are:
&gt; 
&gt; · Riak 1.4.9
&gt; · 3 nodes, each being:
&gt; o A virtual RedHat EL
&gt; o 2 x 2.2GHz CPU
&gt; o 4GB RAM
&gt; · In-memory back end
&gt; · 128 segment ring
&gt; 
&gt; We have tried to limit the in-memory max memory by the following setting in 
&gt; app.config:
&gt; 
&gt; %% Memory Config
&gt; {memory\_backend, [
&gt; {max\_memory, 32}, %% 32 megabytes
&gt; {ttl, 86400} %% 1 Day in seconds
&gt; ]},
&gt; 
&gt; The behaviour we are seeing is a sudden and rapid increase in memory 
&gt; allocated to riak, up to 100% available RAM, and then a crash.
&gt; 
&gt; This is happening on all 3 nodes (at different times).
&gt; 
&gt; When looking through the console.log just prior to the out of memory / crash 
&gt; we see log entries similar to the following appearing:
&gt; 
&gt; 2015-02-11 16:50:27.356 [info] 
&gt; &lt;0.98.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor large\_heap 
&gt; &lt;0.238.0&gt; 
&gt; [{name,riak\_core\_gossip},{initial\_call,{riak\_core\_gossip,init,1}},{almost\_current\_function,{riak\_core\_gossip,update\_gossip\_vers
&gt; ion,1}},{message\_queue\_len,78}] 
&gt; [{old\_heap\_block\_size,0},{heap\_block\_size,47828850},{mbuf\_size,0},{stack\_size,15},{old\_heap\_size,0},{heap\_size,13944475}]
&gt; 
&gt; We can’t see any errors at the appropriate times in the error.log
&gt; 
&gt; We see the following in erlang.log.1:
&gt; 
&gt; ===== ALIVE Wed Feb 11 17:00:24 GMT 2015
&gt; /usr/lib64/riak/lib/os\_mon-2.2.9/priv/bin/memsup: Erlang has closed.
&gt; Erlang has closed
&gt; 
&gt; Crash dump was written to: /var/log/riak/erl\_crash.dump
&gt; eheap\_alloc: Cannot allocate 4454408120 bytes of memory
&gt; 
&gt; =====
&gt; 
&gt; Anyone any ideas?
&gt; 
&gt; Simon Hartley
&gt; Solutions Architect
&gt; 
&gt; Email: simon.hart...@williamhill.com
&gt; Skype: +44 (0)113 397 6747
&gt; Skype: sijomons
&gt; 
&gt; William Hill Online, St. Johns, Merrion St. Leeds, LS2 8LQ
&gt; 
&gt; 
&gt; Confidentiality: The contents of this e-mail and any attachments transmitted 
&gt; with it are intended to be confidential to the intended recipient; and may be 
&gt; privileged or otherwise protected from disclosure. If you are not an intended 
&gt; recipient of this e-mail, do not duplicate or redistribute it by any means. 
&gt; Please delete it and any attachments and notify the sender that you have 
&gt; received it in error. This e-mail is sent by a William Hill PLC group 
&gt; company. The William Hill group companies include, among others, William Hill 
&gt; PLC (registered number 4212563), William Hill Organization Limited 
&gt; (registered number 278208), William Hill US HoldCo Inc, WHG (International) 
&gt; Limited (registered number 99191) and WHG Trading Limited (registered number 
&gt; 101439). Each of William Hill PLC, William Hill Organization Limited is 
&gt; registered in England and Wales and has its registered office at Greenside 
&gt; House, 50 Station Road, Wood Green, London N22 7TP. William Hill U.S. HoldCo, 
&gt; Inc. is 160 Greentree Drive, Suite 101, Dover 19904, Kent, Delaware, United 
&gt; States of America. Each of WHG (International) Limited and WHG Trading 
&gt; Limited is registered in Gibraltar and has its registered office at 6/1 
&gt; Waterport Place, Gibraltar. Unless specifically indicated otherwise, the 
&gt; contents of this e-mail are subject to contract; and are not an official 
&gt; statement, and do not necessarily represent the views, of William Hill PLC, 
&gt; its subsidiaries or affiliated companies. Please note that neither William 
&gt; Hill PLC, nor its subsidiaries and affiliated companies can accept any 
&gt; responsibility for any viruses contained within this e-mail and it is your 
&gt; responsibility to scan any emails and their attachments. William Hill PLC, 
&gt; its subsidiaries and affiliated companies may monitor e-mail traffic data and 
&gt; also the content of e-mails for effective operation of the e-mail system, or 
&gt; for security, purposes.. \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

