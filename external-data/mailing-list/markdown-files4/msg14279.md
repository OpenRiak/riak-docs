---
title: "Re: Errors messages from 2i/range queries, or something else?"
description: ""
project: community
lastmod: 2014-05-30T04:43:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14279"
mailinglist_parent_id: "msg14278"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2014-05-30T04:43:23-07:00
---



On 30 May 2014, at 11:55, Dave Brady  wrote:

&gt; Hi Russell,
&gt; 
&gt; Thanks for clarifying that it is our 2i queries!

I’m not 100% sure, but it seems possible, those messages look similar to the 
streaming merge sort code working. Which reminds me, are you streaming the 
results? It’s way better than buffering all the results in memory before 
returning them.

&gt; 
&gt; I myself don't know the size of the result sets. I know pagination is used 
&gt; in some of our programs, though I don't know if all of them use it.
&gt; 
&gt; I didn't know that 1.4.8 had those improvements. I'll look into upgrading, 
&gt; too.
&gt; 
&gt; Thanks again!
&gt; 
&gt; --
&gt; Dave Brady
&gt; 
&gt; ----- Original Message -----
&gt; From: "Russell Brown" 
&gt; To: "Dave Brady" 
&gt; Cc: riak-users@lists.basho.com
&gt; Sent: Friday, May 30, 2014 11:33:45 AM
&gt; Subject: Re: Errors messages from 2i/range queries, or something else?
&gt; 
&gt; How large is your max\_results size for 2i queries, or, if you’re not using 
&gt; pagination, what do you estimate the result size is?
&gt; 
&gt; Do you require sorted results? If you don’t, and you’re not using pagination, 
&gt; 1.4.8 might solve your issues since it doesn’t buffer and sort results in 
&gt; memory (see Sorting under 
&gt; http://docs.basho.com/riak/1.4.8/dev/using/2i/#Querying)
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; On 30 May 2014, at 10:27, Dave Brady  wrote:
&gt; 
&gt;&gt; Our five-node cluster, running 1.4.7, is spewing lots of these messages:
&gt;&gt; 
&gt;&gt; 2014-05-30 08:49:20.683 [info] 
&gt;&gt; &lt;0.83.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc 
&gt;&gt; &lt;0.8208.361&gt; 
&gt;&gt; [{initial\_call,{erlang,apply,2}},{almost\_current\_function,{lists,rmerge3\_21\_3,6}},{message\_queue\_len,0}]
&gt;&gt; 
&gt;&gt; [{timeout,155},{old\_heap\_block\_size,0},{heap\_block\_size,317811},{mbuf\_size,0},{stack\_size,59},{old\_heap\_size,0},{heap\_size,271310}]
&gt;&gt; 2014-05-30 08:52:30.532 [info] 
&gt;&gt; &lt;0.83.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc 
&gt;&gt; &lt;0.17361.375&gt; 
&gt;&gt; [{initial\_call,{erlang,apply,2}},{almost\_current\_function,{lists,rmerge2\_1,4}},{message\_queue\_len,0}]
&gt;&gt; 
&gt;&gt; [{timeout,103},{old\_heap\_block\_size,0},{heap\_block\_size,514229},{mbuf\_size,0},{stack\_size,59},{old\_heap\_size,0},{heap\_size,252851}]
&gt;&gt; 2014-05-30 08:52:31.123 [info] 
&gt;&gt; &lt;0.83.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc 
&gt;&gt; &lt;0.17361.375&gt; 
&gt;&gt; [{initial\_call,{erlang,apply,2}},{almost\_current\_function,{lists,rmerge2\_2,5}},{message\_queue\_len,0}]
&gt;&gt; 
&gt;&gt; [{timeout,103},{old\_heap\_block\_size,0},{heap\_block\_size,514229},{mbuf\_size,0},{stack\_size,58},{old\_heap\_size,0},{heap\_size,251111}]
&gt;&gt; 2014-05-30 08:52:37.041 [info] 
&gt;&gt; &lt;0.83.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc 
&gt;&gt; &lt;0.29376.375&gt; 
&gt;&gt; [{initial\_call,{erlang,apply,2}},{almost\_current\_function,{lists,split\_1\_1,6}},{message\_queue\_len,0}]
&gt;&gt; 
&gt;&gt; [{timeout,103},{old\_heap\_block\_size,0},{heap\_block\_size,196418},{mbuf\_size,0},{stack\_size,56},{old\_heap\_size,0},{heap\_size,190521}]
&gt;&gt; 2014-05-30 08:52:37.149 [info] 
&gt;&gt; &lt;0.83.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc 
&gt;&gt; &lt;0.29376.375&gt; 
&gt;&gt; [{initial\_call,{erlang,apply,2}},{almost\_current\_function,{lists,split\_1,5}},{message\_queue\_len,0}]
&gt;&gt; 
&gt;&gt; [{timeout,101},{old\_heap\_block\_size,0},{heap\_block\_size,317811},{mbuf\_size,0},{stack\_size,56},{old\_heap\_size,0},{heap\_size,196361}]
&gt;&gt; 2014-05-30 08:52:37.977 [info] 
&gt;&gt; &lt;0.83.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc 
&gt;&gt; &lt;0.29376.375&gt; 
&gt;&gt; [{initial\_call,{erlang,apply,2}},{almost\_current\_function,{lists,rmerge3\_21\_3,6}},{message\_queue\_len,0}]
&gt;&gt; 
&gt;&gt; [{timeout,123},{old\_heap\_block\_size,0},{heap\_block\_size,514229},{mbuf\_size,0},{stack\_size,59},{old\_heap\_size,0},{heap\_size,251541}]
&gt;&gt; 2014-05-30 09:02:00.731 [info] 
&gt;&gt; &lt;0.83.0&gt;@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc 
&gt;&gt; &lt;0.16282.433&gt; 
&gt;&gt; [{initial\_call,{erlang,apply,2}},{almost\_current\_function,{erlang,max,2}},{message\_queue\_len,0}]
&gt;&gt; 
&gt;&gt; [{timeout,103},{old\_heap\_block\_size,0},{heap\_block\_size,196418},{mbuf\_size,0},{stack\_size,65},{old\_heap\_size,0},{heap\_size,125642}]
&gt;&gt; 
&gt;&gt; GET and PUT times are shooting into multi-second response.
&gt;&gt; 
&gt;&gt; Can someone give me any hints about where to look, please?
&gt;&gt; 
&gt;&gt; --
&gt;&gt; Dave Brady
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

