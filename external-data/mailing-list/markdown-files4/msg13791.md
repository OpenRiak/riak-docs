---
title: "Re: 60 second timeout in Riak"
description: ""
project: community
lastmod: 2014-03-12T06:42:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13791"
mailinglist_parent_id: "msg13790"
author_name: "Matthew MacClary"
project_section: "mailinglistitem"
sent_date: 2014-03-12T06:42:32-07:00
---


Thanks for the suggestion Christian. Right now I am running an experiment
with pb\_backlog set to 64 up from the default of 5. The way our application
uses the client there would usually be 4 connections initiated at the same
time, but there could be as many as 12 connections initiated at the same
time right now. I wonder if that is causing the client to time out and try
back in 60 seconds!

I will report my results.

Best regards,

-Matt


On Tue, Mar 11, 2014 at 11:38 PM, Christian Dahlqvist
wrote:

&gt; Hi Matthew,
&gt;
&gt; I believe 60 seconds is the default timeout in the client, so it is
&gt; possible the `busy\_dist\_port` issues have caused a timeout and that the
&gt; automatic retry then has succeeded.
&gt;
&gt; A small +zdbbl value will cause the internal buffers to fill up and result
&gt; in `busy\_dist\_port` messages, which will cause performance problems. I
&gt; would recommend setting +zdbbl to 16384 (16MB) or 32768 (32MB) and verify
&gt; that you stop seeing busy\_dist\_post messages in the logs. If problems
&gt; persist it may be required to set it even higher.
&gt;
&gt; It is also important to note that `busy\_dist\_port` messages can be caused
&gt; by individual large objects even if +zdbbl is set to a reasonably large
&gt; value as outlined above. In Riak 1.4.8, logging of large objects has been
&gt; introduced, which will allow you to identify large objects that could cause
&gt; problems by going through the logs. You can also track large objects by
&gt; trending the `node\_get\_fsm\_objsize\_100` statistic.
&gt;
&gt; Best regards,
&gt;
&gt; Christian
&gt;
&gt;
&gt;
&gt; On Wed, Mar 12, 2014 at 5:43 AM, Matthew MacClary &lt;
&gt; maccl...@lifetime.oregonstate.edu&gt; wrote:
&gt;
&gt;&gt; Hi everyone, we are running Riak 1.4.1 on RHEL 6.2 using bitcask. We are
&gt;&gt; using protobufs with the Java client, and our binary objects are typically
&gt;&gt; a few hundred KB in size. I have noticed a persistent anomaly with riak
&gt;&gt; reads and writes. It seems like often, maybe 0.5% of the time, writing to
&gt;&gt; Riak takes 60 seconds longer than it should. Here is a prime example I just
&gt;&gt; trimmed from a log file (see the last time entry below).
&gt;&gt;
&gt;&gt; This is not bitcask merge related because it happens before any of the
&gt;&gt; bitcask slabs are large enough to merge. I am seeing lots of busy\_dist\_port
&gt;&gt; messages in the Riak logs. One unique setting is that we have a small zdbbl
&gt;&gt; setting of 128K because this seemed to prevent congestive collapse of
&gt;&gt; throughput at high sustained loads. I believe that this 60 second timeout
&gt;&gt; persisted across the various zdbbl settings we tried. Also we see this
&gt;&gt; occasional 60 second delay on both VMs and real server hardware.
&gt;&gt;
&gt;&gt; Does anyone know where this 60 second delay comes from?
&gt;&gt;
&gt;&gt; Thanks!
&gt;&gt;
&gt;&gt; -Matt
&gt;&gt;
&gt;&gt;
&gt;&gt; 2014-03-11 20:40:00,747 INFO [Thread-61] sally.ReportHandler - Riak load
&gt;&gt; time for 88: 0.087 seconds
&gt;&gt; 2014-03-11 20:40:01,137 INFO [Thread-62] sally.ReportHandler - Riak load
&gt;&gt; time for 70: 0.185 seconds
&gt;&gt; 2014-03-11 20:40:01,958 INFO [Thread-63] sally.ReportHandler - Riak load
&gt;&gt; time for 97: 0.054 seconds
&gt;&gt; 2014-03-11 20:40:02,566 INFO [Thread-64] sally.ReportHandler - Riak load
&gt;&gt; time for 90: 0.043 seconds
&gt;&gt; 2014-03-11 20:40:02,830 INFO [Thread-65] sally.ReportHandler - Riak load
&gt;&gt; time for 85: 0.051 seconds
&gt;&gt; 2014-03-11 20:40:04,162 INFO [Thread-66] sally.ReportHandler - Riak load
&gt;&gt; time for 101: 0.075 seconds
&gt;&gt; 2014-03-11 20:40:04,503 INFO [Thread-67] sally.ReportHandler - Riak load
&gt;&gt; time for 103: 0.048 seconds
&gt;&gt; 2014-03-11 20:40:05,745 INFO [Thread-68] sally.ReportHandler - Riak load
&gt;&gt; time for 98: 0.031 seconds
&gt;&gt; 2014-03-11 20:40:06,041 INFO [Thread-69] sally.ReportHandler - Riak load
&gt;&gt; time for 102: 0.063 seconds
&gt;&gt; 2014-03-11 20:40:06,444 INFO [Thread-70] sally.ReportHandler - Riak load
&gt;&gt; time for 92: 0.022 seconds
&gt;&gt; 2014-03-11 20:40:06,903 INFO [Thread-71] sally.ReportHandler - Riak load
&gt;&gt; time for 99: 0.039 seconds
&gt;&gt; 2014-03-11 20:40:09,847 INFO [Thread-72] sally.ReportHandler - Riak load
&gt;&gt; time for 106: 0.019 seconds
&gt;&gt; 2014-03-11 20:40:10,107 INFO [Thread-73] sally.ReportHandler - Riak load
&gt;&gt; time for 108: 0.043 seconds
&gt;&gt; 2014-03-11 20:40:47,820 INFO [Thread-52] sally.ReportHandler - Riak load
&gt;&gt; time for 62: 1 minutes, 0.190 seconds
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

