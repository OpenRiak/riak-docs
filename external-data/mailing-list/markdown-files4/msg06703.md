---
title: "Re: questions about search"
description: ""
project: community
lastmod: 2012-02-23T00:38:29-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06703"
mailinglist_parent_id: "msg06661"
author_name: "Jason Toy"
project_section: "mailinglistitem"
sent_date: 2012-02-23T00:38:29-08:00
---



Ryan, 

Thank you for the informative reply. 

&gt; - does riak search have the ability to do a join? A feature we heavily use 
&gt; from the lucene unstable branch is the ability to do a "hash join" 
&gt; (https://issues.apache.org/jira/browse/SOLR-2272). 
&gt; Our use case is we have documents of type User who have BlogPosts. 
&gt; We want to match all the BlogPosts that mentioned "tires" and where their 
&gt; User's description mentions " taxi driver". We can't index all the User 
&gt; data into each Blog Post because we have ~400+ million blog posts and ~2+ 
&gt; millions of Users with both growing. We need the search to be in realtime 
&gt; so its not a situation where we could do background processing. Is there a 
&gt; way to model this with riak search?
&gt; 
&gt; No. To satisfy this query you'd have to denormalize and put some user data 
&gt; in the blog post index (probably as an inline field).

Regarding denormalizing, I don't think its possible in our situation because we 
would be added up to MBs of data per each document. Would it be possible to do 
a search for User docs,then feed all those ids into a map reduce function that 
does another search against BlogPosts that match the search term and the user 
ids? 

I still plan to try out riak to see if we can use it. I'll let you all know of 
the progress. I see you guys are in Boston, I'm there often and would love to 
stop by your office sometime.



&gt; Jason,
&gt; 
&gt; In general Riak Search is far from a Solr/Lucene clone. It's main relation 
&gt; is that it supports the Lucene syntax and has an HTTP interface that roughly 
&gt; looks like Solr but doesn't support a lot of it's features and also has 
&gt; different semantics in some cases.
&gt; 
&gt; If you rely on specific Lucene/Solr functionality, such as joins or specific 
&gt; analyzers then Riak Search is probably not going to fit the bill. Some Riak 
&gt; users have chosen to integrate with external solutions such as Solr or 
&gt; Elasticsearch. As you mention this poses potential consistency issues and 
&gt; more deployment work, but perhaps you can work around those things.
&gt; 
&gt; More comments inline...
&gt; 
&gt; On Mon, Feb 20, 2012 at 1:08 AM, Jason Toy  wrote:
&gt; I'm considering moving a fairly large data instance to riak because of the 
&gt; distributed nature and because of full integration with search. Avoiding the 
&gt; work of keeping solr and a datastore in sync sounds great.
&gt; I've gone through the wiki pages regarding search and I have a couple of 
&gt; questions.
&gt; 
&gt; 
&gt; - Are the search scores returned from the solr/search interface accessible 
&gt; to the client running the search? 
&gt; 
&gt; This probably depends on the client but I don't see why the score shouldn't 
&gt; be exposed.
&gt; 
&gt; 
&gt; - Is the scoring system built to be modifying by developers? In our current 
&gt; system, we have a modified solr scoring system to model our needs. If I did 
&gt; want to modify it, would it coded in java or erlang?
&gt; 
&gt; No, it's hardcoded in Erlang. There is currently no way to customize it like 
&gt; you can in Lucene.
&gt; 
&gt; 
&gt; 
&gt; - I have searched around and I have not seen many case studies of using riak 
&gt; search with large amounts of keys. I'm not even sure what large means for 
&gt; riak. Our total data size of indexed data is about 500 million docs and 
&gt; growing. Most docs are small, about 64kb in size, but we also have a couple 
&gt; million docs that are multi mbs.
&gt; 
&gt; The concern isn't so much the number of objects you store/index as it is the 
&gt; number of objects that match any given query. For example, an AND operator 
&gt; with a large result set on one side can cause serious performance issues 
&gt; because of Search's distributed nature (it has to stream/merge sort the 
&gt; postings from both sides). This can be alleviated with inline fields but at 
&gt; a cost of a larger index. Also, the size of the object shouldn't affect 
&gt; Search because it's streaming postings in most cases but there is a practical 
&gt; limit with Riak in general. We say don't go past 40MB or so but I would say 
&gt; the practical limit is much, much lower. Giving you a hard number would be 
&gt; foolish on my part because something like that is going to depend greatly on 
&gt; your hardware/software stack. You need to benchmark with real data and real 
&gt; load to know for sure. But to be pragmatic, I'd probably say in the single 
&gt; digit MBs.
&gt; 
&gt; 
&gt; 
&gt; - According to this page: 
&gt; http://wiki.basho.com/Riak-Search---Querying.html#Query-Scoring there is no 
&gt; actual idf score? How are documents actually ranked then if no idf is used? 
&gt; if docs get matched on a query on different nodes, how is the order of 
&gt; results reassembled without using know the total number of documents in a 
&gt; collection?
&gt; 
&gt; I'm going to punt on this for now. I'll try to get back to you with an 
&gt; answer later.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; - does riak search have the ability to do a join? A feature we heavily use 
&gt; from the lucene unstable branch is the ability to do a "hash join" 
&gt; (https://issues.apache.org/jira/browse/SOLR-2272). 
&gt; Our use case is we have documents of type User who have BlogPosts. 
&gt; We want to match all the BlogPosts that mentioned "tires" and where their 
&gt; User's description mentions " taxi driver". We can't index all the User 
&gt; data into each Blog Post because we have ~400+ million blog posts and ~2+ 
&gt; millions of Users with both growing. We need the search to be in realtime 
&gt; so its not a situation where we could do background processing. Is there a 
&gt; way to model this with riak search?
&gt; 
&gt; No. To satisfy this query you'd have to denormalize and put some user data 
&gt; in the blog post index (probably as an inline field).
&gt; 
&gt; 
&gt; - Is this a bug in riak search and has this been solved? 
&gt; http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2012-January/007114.html
&gt; 
&gt; No, it has not been addressed.
&gt; 
&gt; 
&gt; - can indexing and indexes be used together? I see there is support for doing 
&gt; exact/range queries in search if riak already can index dates?
&gt; 
&gt; Are you asking if you can use 2i and Search together? If so, yes.
&gt; 
&gt; Search can do everything 2i can do. The main difference at this point is the 
&gt; API and the query engine. Search uses term-based partitioning whereas 2i is 
&gt; document-based. Both have their pros/cons, but the main thing to take away 
&gt; is Search only has to query one node for a term query, 2i has to query 1/N of 
&gt; the nodes. I've talked about this before on the mailing list. I can dig up 
&gt; the threads if you want more information.
&gt; 
&gt; 
&gt; -finally is there a way to measure what kind of ram/hardware will be needed 
&gt; to support the indexes?
&gt; 
&gt; Capacity planning is tricky, to say the least. Both 2i and Search use 
&gt; sequential log, generational merging techniques (2i uses leveldb, Search uses 
&gt; our in-house index merge\_index). Estimating disk/memory overhead for a given 
&gt; document in Search is also difficult since it relies on the data, the 
&gt; analyzer and other field options. It should be fairly easy to add an API to 
&gt; Search to take a document, do a dry-run, and tell you disk/memory overhead, 
&gt; but currently there is no such thing. We do have some general capacity 
&gt; planning pages but nothing specifically on Search.
&gt; 
&gt; http://wiki.basho.com/Cluster-Capacity-Planning.html
&gt; 
&gt; http://wiki.basho.com/System-Requirements.html
&gt; 
&gt; http://wiki.basho.com/Bitcask-Capacity-Planning.html
&gt; 
&gt; -Ryan

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

