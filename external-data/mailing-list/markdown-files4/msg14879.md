---
title: "Re: Issue with Riak partition allocation"
description: ""
project: community
lastmod: 2014-09-09T07:24:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14879"
mailinglist_parent_id: "msg14876"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2014-09-09T07:24:00-07:00
---


Hi Peter,

Could you please provide the output of "riak-admin transfers" ?
--
Luke Bakken
Engineer / CSE
lbak...@basho.com


On Mon, Sep 8, 2014 at 10:01 AM, Peter Bakkum  wrote:
&gt; Hey all,
&gt;
&gt; Looking for some guidance on a problem we're seeing in production right now.
&gt; We're not Riak experts so please bear with us.
&gt;
&gt; We had a member of our 6-node Riak cluster appear to fall out (riak-admin
&gt; member status on that node only showed itself). So I ran a riak-admin join
&gt; and riak-admin commit to get the node back in the cluster. Node discovery
&gt; appears to work now, but for some reason that node is now using a huge
&gt; amount of disk space. It appears that the partition balancing process is
&gt; creating this condition, and still hasn't completed after ~16 hours. The
&gt; cluster is still functional and serving our production traffic, and taking
&gt; the entire cluster offline isn't an option for us.
&gt;
&gt; Most of our nodes use about 450GB of space, this node in particular is using
&gt; around 1.2TB, which is pushing the limit of its disk.
&gt;
&gt; Questions:
&gt; Whats happening here? Is this expected?
&gt;
&gt; Whats the best course of action? Should we clear out this node and attempt
&gt; to join the cluster again?
&gt;
&gt; Here are some stats from the node in question. Let me know if anything else
&gt; would be helpful.
&gt;
&gt; Thanks for your help.
&gt;
&gt;
&gt; [root@192.168.72.19 /data/lib/riak] # riak-admin member-status
&gt; ================================= Membership
&gt; ==================================
&gt; Status Ring Pending Node
&gt; -------------------------------------------------------------------------------
&gt; valid 20.3% 16.4% 'xxxx\_prod\_cluster@192.168.72.135'
&gt; valid 18.0% 17.2% 'xxxx\_prod\_cluster@192.168.72.170'
&gt; valid 20.3% 17.2% 'xxxx\_prod\_cluster@192.168.72.176'
&gt; valid 7.0% 16.4% 'xxxx\_prod\_cluster@192.168.72.19'
&gt; valid 17.2% 16.4% 'xxxx\_prod\_cluster@192.168.72.7'
&gt; valid 17.2% 16.4% 'xxxx\_prod\_cluster@192.168.72.74'
&gt;
&gt;
&gt; [root@192.168.72.19 /data/lib/riak] # riak-admin status
&gt; 1-minute stats for 'xxxx\_prod\_cluster@192.168.72.19'
&gt; -------------------------------------------
&gt; riak\_kv\_stat\_ts : 1410194287
&gt; vnode\_gets : 1607
&gt; vnode\_gets\_total : 563683
&gt; vnode\_puts : 39
&gt; vnode\_puts\_total : 5459724
&gt; vnode\_index\_refreshes : 0
&gt; vnode\_index\_refreshes\_total : 0
&gt; vnode\_index\_reads : 0
&gt; vnode\_index\_reads\_total : 0
&gt; vnode\_index\_writes : 39
&gt; vnode\_index\_writes\_total : 5459724
&gt; vnode\_index\_writes\_postings : 0
&gt; vnode\_index\_writes\_postings\_total : 5227558
&gt; vnode\_index\_deletes : 0
&gt; vnode\_index\_deletes\_total : 0
&gt; vnode\_index\_deletes\_postings : 39
&gt; vnode\_index\_deletes\_postings\_total : 30613
&gt; node\_gets : 3602
&gt; node\_gets\_total : 2463956
&gt; node\_get\_fsm\_siblings\_mean : 1
&gt; node\_get\_fsm\_siblings\_median : 1
&gt; node\_get\_fsm\_siblings\_95 : 2
&gt; node\_get\_fsm\_siblings\_99 : 3
&gt; node\_get\_fsm\_siblings\_100 : 12
&gt; node\_get\_fsm\_objsize\_mean : 52047
&gt; node\_get\_fsm\_objsize\_median : 26936
&gt; node\_get\_fsm\_objsize\_95 : 167435
&gt; node\_get\_fsm\_objsize\_99 : 267979
&gt; node\_get\_fsm\_objsize\_100 : 1313716
&gt; node\_get\_fsm\_time\_mean : 12223
&gt; node\_get\_fsm\_time\_median : 6675
&gt; node\_get\_fsm\_time\_95 : 37390
&gt; node\_get\_fsm\_time\_99 : 87046
&gt; node\_get\_fsm\_time\_100 : 345380
&gt; node\_puts : 39
&gt; node\_puts\_total : 24915
&gt; node\_put\_fsm\_time\_mean : 4419
&gt; node\_put\_fsm\_time\_median : 2444
&gt; node\_put\_fsm\_time\_95 : 12890
&gt; node\_put\_fsm\_time\_99 : 18775
&gt; node\_put\_fsm\_time\_100 : 18775
&gt; read\_repairs : 0
&gt; read\_repairs\_total : 0
&gt; coord\_redirs\_total : 17022
&gt; executing\_mappers : 0
&gt; precommit\_fail : 0
&gt; postcommit\_fail : 0
&gt; index\_fsm\_create : 0
&gt; index\_fsm\_create\_error : 0
&gt; index\_fsm\_active : 0
&gt; list\_fsm\_create : 0
&gt; list\_fsm\_create\_error : 0
&gt; list\_fsm\_active : 0
&gt; pbc\_active : 0
&gt; pbc\_connects : 1
&gt; pbc\_connects\_total : 508
&gt; node\_get\_fsm\_active : 1
&gt; node\_get\_fsm\_active\_60s : 3530
&gt; node\_get\_fsm\_in\_rate : 55
&gt; node\_get\_fsm\_out\_rate : 56
&gt; node\_get\_fsm\_rejected : 0
&gt; node\_get\_fsm\_rejected\_60s : 0
&gt; node\_get\_fsm\_rejected\_total : 0
&gt; node\_put\_fsm\_active : 0
&gt; node\_put\_fsm\_active\_60s : 67
&gt; node\_put\_fsm\_in\_rate : 1
&gt; node\_put\_fsm\_out\_rate : 1
&gt; node\_put\_fsm\_rejected : 0
&gt; node\_put\_fsm\_rejected\_60s : 0
&gt; node\_put\_fsm\_rejected\_total : 0
&gt; leveldb\_read\_block\_error : 0
&gt; riak\_pipe\_stat\_ts : 1410194286
&gt; pipeline\_active : 0
&gt; pipeline\_create\_count : 0
&gt; pipeline\_create\_one : 0
&gt; pipeline\_create\_error\_count : 0
&gt; pipeline\_create\_error\_one : 0
&gt; cpu\_nprocs : 426
&gt; cpu\_avg1 : 1352
&gt; cpu\_avg5 : 1260
&gt; cpu\_avg15 : 1137
&gt; mem\_total : 15666507776
&gt; mem\_allocated : 15479640064
&gt; disk : [{"/",8256952,60},
&gt; {"/dev/shm",7649660,0},
&gt; {"/tmpfs",1048576,14},
&gt; {"/tmpfs\_mp3",1048576,0},
&gt; {"/data",1514123712,81}]
&gt; nodename : 'xxxx\_prod\_cluster@192.168.72.19'
&gt; connected\_nodes : ['xxxx\_prod\_cluster@192.168.72.170',
&gt; 'xxxx\_prod\_cluster@192.168.72.176',
&gt; 'xxxx\_prod\_cluster@192.168.72.74',
&gt; 'xxxx\_prod\_cluster@192.168.72.135',
&gt; 'xxxx\_prod\_cluster@192.168.72.7']
&gt; sys\_driver\_version : &lt;&lt;"2.0"&gt;&gt;
&gt; sys\_global\_heaps\_size : 0
&gt; sys\_heap\_type : private
&gt; sys\_logical\_processors : 4
&gt; sys\_otp\_release : &lt;&lt;"R15B01"&gt;&gt;
&gt; sys\_process\_count : 2469
&gt; sys\_smp\_support : true
&gt; sys\_system\_version : &lt;&lt;"Erlang R15B01 (erts-5.9.1) [source] [64-bit]
&gt; [smp:4:4] [async-threads:64] [kernel-poll:true]"&gt;&gt;
&gt; sys\_system\_architecture : &lt;&lt;"x86\_64-unknown-linux-gnu"&gt;&gt;
&gt; sys\_threads\_enabled : true
&gt; sys\_thread\_pool\_size : 64
&gt; sys\_wordsize : 8
&gt; ring\_members : ['xxxx\_prod\_cluster@192.168.72.135',
&gt; 'xxxx\_prod\_cluster@192.168.72.170',
&gt; 'xxxx\_prod\_cluster@192.168.72.176',
&gt; 'xxxx\_prod\_cluster@192.168.72.19',
&gt; 'xxxx\_prod\_cluster@192.168.72.7',
&gt; 'xxxx\_prod\_cluster@192.168.72.74']
&gt; ring\_num\_partitions : 128
&gt; ring\_ownership : &lt;&lt;"[{'xxxx\_prod\_cluster@192.168.72.170',23},\n
&gt; {'xxxx\_prod\_cluster@192.168.72.74',22},\n
&gt; {'xxxx\_prod\_cluster@192.168.72.135',26},\n
&gt; {'xxxx\_prod\_cluster@192.168.72.176',26},\n
&gt; {'xxxx\_prod\_cluster@192.168.72.7',22},\n
&gt; {'xxxx\_prod\_cluster@192.168.72.19',9}]"&gt;&gt;
&gt; ring\_creation\_size : 128
&gt; storage\_backend : riak\_kv\_eleveldb\_backend
&gt; erlydtl\_version : &lt;&lt;"0.7.0"&gt;&gt;
&gt; riak\_control\_version : &lt;&lt;"1.4.10-0-g73c43c3"&gt;&gt;
&gt; cluster\_info\_version : &lt;&lt;"1.2.4"&gt;&gt;
&gt; riak\_search\_version : &lt;&lt;"1.4.10-0-g6e548e7"&gt;&gt;
&gt; merge\_index\_version : &lt;&lt;"1.3.2-0-gcb38ee7"&gt;&gt;
&gt; riak\_kv\_version : &lt;&lt;"1.4.10-0-g64b6ad8"&gt;&gt;
&gt; sidejob\_version : &lt;&lt;"0.2.0"&gt;&gt;
&gt; riak\_api\_version : &lt;&lt;"1.4.10-0-gc407ac0"&gt;&gt;
&gt; riak\_pipe\_version : &lt;&lt;"1.4.10-0-g9353526"&gt;&gt;
&gt; riak\_core\_version : &lt;&lt;"1.4.10"&gt;&gt;
&gt; bitcask\_version : &lt;&lt;"1.6.6-0-g230b6d6"&gt;&gt;
&gt; basho\_stats\_version : &lt;&lt;"1.0.3"&gt;&gt;
&gt; webmachine\_version : &lt;&lt;"1.10.4-0-gfcff795"&gt;&gt;
&gt; mochiweb\_version : &lt;&lt;"1.5.1p6"&gt;&gt;
&gt; inets\_version : &lt;&lt;"5.9"&gt;&gt;
&gt; erlang\_js\_version : &lt;&lt;"1.2.2"&gt;&gt;
&gt; runtime\_tools\_version : &lt;&lt;"1.8.8"&gt;&gt;
&gt; os\_mon\_version : &lt;&lt;"2.2.9"&gt;&gt;
&gt; riak\_sysmon\_version : &lt;&lt;"1.1.3"&gt;&gt;
&gt; ssl\_version : &lt;&lt;"5.0.1"&gt;&gt;
&gt; public\_key\_version : &lt;&lt;"0.15"&gt;&gt;
&gt; crypto\_version : &lt;&lt;"2.1"&gt;&gt;
&gt; sasl\_version : &lt;&lt;"2.2.1"&gt;&gt;
&gt; lager\_version : &lt;&lt;"2.0.1"&gt;&gt;
&gt; goldrush\_version : &lt;&lt;"0.1.5"&gt;&gt;
&gt; compiler\_version : &lt;&lt;"4.8.1"&gt;&gt;
&gt; syntax\_tools\_version : &lt;&lt;"1.6.8"&gt;&gt;
&gt; stdlib\_version : &lt;&lt;"1.18.1"&gt;&gt;
&gt; kernel\_version : &lt;&lt;"2.15.1"&gt;&gt;
&gt; memory\_total : 130705264
&gt; memory\_processes : 55557705
&gt; memory\_processes\_used : 55341757
&gt; memory\_system : 75147559
&gt; memory\_atom : 545377
&gt; memory\_atom\_used : 527226
&gt; memory\_binary : 12172712
&gt; memory\_code : 11674242
&gt; memory\_ets : 11913912
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

