---
title: "Re: Reg:Continuous Periodic crashes after long operation"
description: ""
project: community
lastmod: 2017-01-27T12:02:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17896"
mailinglist_parent_id: "msg17882"
author_name: "Steven Joseph"
project_section: "mailinglistitem"
sent_date: 2017-01-27T12:02:45-08:00
---


Hi Shaun,

I have already set this to a very high value

(r...@hawk1.streethawk.com)1&gt; os:cmd("ulimit -n").
"20000500\n"
(r...@hawk1.streethawk.com)2&gt;


So the issue is not that the limit is low, but maybe a resource leak ? As I
mentioned our application processes continuously run queries on the cluster.

Kind Regards

Steven

On Thu, Jan 26, 2017 at 11:13 PM Shaun McVey  wrote:

&gt; Hi Steven,
&gt;
&gt; Based on that log output, it looks like you're running into issues with
&gt; system limits, probably open file limits. You can check the value that
&gt; Riak has available by connecting to one of the nodes with riak attach, then
&gt; executing:
&gt;
&gt; ```
&gt; os:cmd("ulimit -n").
&gt; ```
&gt;
&gt; (After, disconnect with ctrl+g, then q, then Enter).
&gt;
&gt; It should be at least 65,536 ideally, although the bigger the better.
&gt;
&gt; If you find it's lower, then follow this doc to increase it.
&gt;
&gt; http://docs.basho.com/riak/kv/2.0.2/using/performance/open-files-limit/
&gt;
&gt; Have a check and let us know what the output was.
&gt;
&gt; Kind Regards,
&gt; Shaun
&gt;
&gt; On Thu, Jan 26, 2017 at 10:34 AM, Steven Joseph 
&gt; wrote:
&gt;
&gt; Hi,
&gt;
&gt; We have a cluster of 5 nodes, which are continuously being queried for
&gt; new data through solr. We have been having some issues with riak/solr
&gt; which seems to be happening after longer periods of operation. It starts
&gt; off with one node and it seems to be happening on all node after a
&gt; while.
&gt;
&gt; We tried upgrading to the latest version of riak hoping that it would
&gt; solve the issue, but no luck.
&gt;
&gt; Only thing that stops the crashes is a full cluster staggered restart.
&gt;
&gt; Please find the logs below. Any help would be much appreciated.
&gt;
&gt; Riak Logs:
&gt;
&gt; 2017-01-26T07:53:03.262Z hawk5| \*\* Last message in was tick
&gt; 2017-01-26T07:53:10.197Z hawk5|
&gt; 2017-01-26T07:53:10.197Z hawk5| 2017-01-26 07:53:08.183 [error] emulator
&gt; Error in process &lt;0.22701.73&gt; on node 'r...@hawk5.streethawk.com' with
&gt; exit value: {{badmatch,{error,system\_limit}},[{cpu\_sup,g
&gt;
&gt; et\_uint32\_measurement,2,[{file,"cpu\_sup.erl"},{line,223}]},{cpu\_sup,measurement\_server\_loop,1,[{file,"cpu\_sup.erl"},{line,585}]}]}
&gt; 2017-01-26T07:53:10.263Z hawk5| Error in process &lt;0.22701.73&gt; on node '
&gt; r...@hawk5.streethawk.com' with exit value:
&gt; {{badmatch,{error,system\_limit}},[{cpu\_sup,get\_uint32\_measurement,2,[{file,"cpu\_sup.e
&gt;
&gt; rl"},{line,223}]},{cpu\_sup,measurement\_server\_loop,1,[{file,"cpu\_sup.erl"},{line,585}]}]}
&gt; 2017-01-26T07:53:10.263Z hawk5| 2017-01-26 07:53:08 =ERROR REPORT====
&gt; 2017-01-26T07:53:17.198Z hawk5|
&gt; 2017-01-26T07:53:17.208Z hawk5| 2017-01-26 07:53:13.472 [error] emulator
&gt; Error in process &lt;0.12549.73&gt; on node 'r...@hawk5.streethawk.com' with
&gt; exit value: {{badmatch,{error,system\_limit}},[{cpu\_sup,g
&gt;
&gt; et\_uint32\_measurement,2,[{file,"cpu\_sup.erl"},{line,223}]},{cpu\_sup,measurement\_server\_loop,1,[{file,"cpu\_sup.erl"},{line,585}]}]}
&gt; 2017-01-26T07:53:17.263Z hawk5| Error in process &lt;0.12549.73&gt; on node '
&gt; r...@hawk5.streethawk.com' with exit value:
&gt; {{badmatch,{error,system\_limit}},[{cpu\_sup,get\_uint32\_measurement,2,[{file,"cpu\_sup.e
&gt;
&gt; rl"},{line,223}]},{cpu\_sup,measurement\_server\_loop,1,[{file,"cpu\_sup.erl"},{line,585}]}]}
&gt; 2017-01-26T07:53:17.263Z hawk5| 2017-01-26 07:53:13 =ERROR REPORT====
&gt; 2017-01-26T07:53:18.198Z hawk5| 2017-01-26 07:53:17.861 [error] emulator
&gt; Error in process &lt;0.2254.73&gt; on node 'r...@hawk5.streethawk.com' with
&gt; exit value: {{badmatch,{error,system\_limit}},[{cpu\_sup,g$
&gt;
&gt; t\_uint32\_measurement,2,[{file,"cpu\_sup.erl"},{line,223}]},{cpu\_sup,measurement\_server\_loop,1,[{file,"cpu\_sup.erl"},{line,585}]}]}
&gt; 2017-01-26T07:53:18.208Z hawk5|
&gt; 2017-01-26T07:53:18.208Z hawk5| 2017-01-26 07:53:17.861 [error] emulator
&gt; Error in process &lt;0.2254.73&gt; on node 'r...@hawk5.streethawk.com' with
&gt; exit value: {{badmatch,{error,system\_limit}},[{cpu\_sup,g$
&gt;
&gt; t\_uint32\_measurement,2,[{file,"cpu\_sup.erl"},{line,223}]},{cpu\_sup,measurement\_server\_loop,1,[{file,"cpu\_sup.erl"},{line,585}]}]}
&gt; 2017-01-26T07:53:18.264Z hawk5|
&gt;
&gt;
&gt; Python client traces:
&gt;
&gt; 2017-01-26T10:20:44.517Z hawk5| File
&gt; "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py", line
&gt; 179, in wrapper
&gt; 2017-01-26T10:20:44.517Z hawk5| return
&gt; self.\_client.fulltext\_search(search\_index, query, \*\*params)
&gt; 2017-01-26T10:20:44.517Z hawk5| File
&gt; "/usr/local/lib/python2.7/dist-packages/riak/bucket.py", line 476, in search
&gt; 2017-01-26T10:20:44.517Z hawk5| raise e.args[0]
&gt; 2017-01-26T10:20:44.517Z hawk5| File
&gt; "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py", line
&gt; 134, in \_with\_retries
&gt; 2017-01-26T10:20:44.517Z hawk5| return self.\_with\_retries(pool, thunk)
&gt; 2017-01-26T10:20:44.543Z hawk5| RiakError: 'recv\_into returned zero bytes
&gt; unexpectedly'
&gt;
&gt;
&gt; Regards
&gt;
&gt; Steven Joseph
&gt;
&gt; CTO, StreetHawk Pty Ltd
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

