---
title: "Re: Map function in erlang that takes entire bucket as input?"
description: ""
project: community
lastmod: 2013-01-10T08:03:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09788"
mailinglist_parent_id: "msg09787"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-01-10T08:03:24-08:00
---


Hi Shaan,

When using a bucket, input is &lt;&lt;"groceries"&gt;&gt;. Did you by any chance specify it 
as [&lt;&lt;"groceries"&gt;&gt;]?

I ran the example and it worked for me with the following result:

28&gt; {ok, [{1, [R]}]} = riakc\_pb\_socket:mapred(Client,&lt;&lt;"groceries"&gt;&gt;,[{map, 
{qfun, Count}, none, false},{reduce, {qfun, Merge}, none, true}]). 
{ok,[{1, 
 [{dict,3,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
 {{[],[],[],[],[],
 [["bread"|1],["eggs"|1]],
 [["bacon"|2]],
 [],[],[],[],[],[],...}}}]}]}

Best regards,

Christian



On 10 Jan 2013, at 15:57, Shaan Sapra  wrote:

&gt; Unfortunately, this does not seem to work..
&gt; 
&gt; \*\* exception error: no match of right hand side value 
&gt; {error,&lt;&lt;"{inputs,{\"Inputs target tuples must be {B,K} or 
&gt; {{B,K},KeyData}:\",\n [&lt;&lt;\"groceries\"&gt;&gt;]}}"&gt;&gt;}
&gt; 
&gt; 
&gt; On Thu, Jan 10, 2013 at 9:43 AM, Shaan Sapra  wrote:
&gt; Ah thank you! 
&gt; 
&gt; 
&gt; On Thu, Jan 10, 2013 at 9:40 AM, Christian Dahlqvist  
&gt; wrote:
&gt; Hi Shaan,
&gt; 
&gt; The riakc\_pb\_socket:mapred function can take several different types of 
&gt; input: a bucket name, a list of bucket/key pairs or a secondary index query 
&gt; specification. 
&gt; 
&gt; If you wanted to run the example in the tutorial based on all keys in the 
&gt; groceries bucket instead of having to specify the keys individually, you 
&gt; could set input to the bucket name &lt;&lt;"groceries"&gt;&gt; as shown below:
&gt; 
&gt; {ok, [{1, [R]}]} = riakc\_pb\_socket:mapred(
&gt; Client,
&gt; [&lt;&lt;"groceries"&gt;&gt;,
&gt; [{map, {qfun, Count}, none, false},
&gt; {reduce, {qfun, Merge}, none, true}]).
&gt; 
&gt; The specification for what inputs you can specify is available in the 
&gt; riakc.hrl file 
&gt; (https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl) 
&gt; and looks like this:
&gt; 
&gt; -type mapred\_inputs() :: [{bucket(), key()} | {{bucket(), key()}, term()}] |
&gt; {modfun, Module::atom(), Function::atom(), [term()]} 
&gt; |
&gt; bucket() |
&gt; {index, bucket(), Index::binary(), key()} |
&gt; {index, bucket(), Index::binary(), StartKey::key(), 
&gt; EndKey::key()}.
&gt; 
&gt; Best regards,
&gt; 
&gt; Christian
&gt; 
&gt; 
&gt; 
&gt; On 10 Jan 2013, at 06:56, Shaan Sapra  wrote:
&gt; 
&gt;&gt; Hi all,
&gt;&gt; 
&gt;&gt; I'm exploring the erlang-riak-client and trying to write MapReduce functions 
&gt;&gt; to mimic the ones I've written in Javascript and in the riak-ruby-client.
&gt;&gt; 
&gt;&gt; Following the tutorial here, I have successfully run the query. I have now 
&gt;&gt; loaded a bucket with 10000 keys into Riak and now I want to write a simple 
&gt;&gt; map function that queries the bucket and returns all of the objects back to 
&gt;&gt; me.
&gt;&gt; 
&gt;&gt; I noticed that the input is specified as {&lt;&lt;"groceries"&gt;&gt;, &lt;&lt;"mine"&gt;&gt;}. Is 
&gt;&gt; there is a way to specify just the bucket in its entirety? If I wanted to 
&gt;&gt; query my bucket, would I have to list all 10000 keys in a list?
&gt;&gt; 
&gt;&gt; In the riak-ruby-client, it was possible to add the entire bucket. 
&gt;&gt; 
&gt;&gt; Thanks for any help! I'm sure this is a silly question, but I've been hard 
&gt;&gt; pressed to find good documentation for a novice like me.
&gt;&gt; 
&gt;&gt; Shaan
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt; 
&gt; 
&gt; 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

