---
title: "Re: Using apache as a reverse proxy"
description: ""
project: community
lastmod: 2015-01-15T12:29:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15507"
mailinglist_parent_id: "msg15498"
author_name: "Fred Grim"
project_section: "mailinglistitem"
sent_date: 2015-01-15T12:29:07-08:00
---


The more I look at this the more I am thinking there is something busted
in riak or webmachine (I am using riak 1.4.10). The issue seems to be
impervious to apache settings or haproxy settings and going through the
source there doesnÂ¹t seem to be many knobs to turn to adjust chunked
responses. Googling for issues in web machine also turned up nothing.
Maybe a pause in the return of map responses is doing it? Can riak be
configured to send keepalives?

F

On 1/14/15, 10:31 PM, "Toby Corkindale"  wrote:

&gt;Just a thought, but have you tried to replicate the problem when using
&gt;haproxy (with the example configs provided on basho's site)?
&gt;That might let you discover if the problem really IS with Apache, or
&gt;if it's something to do with your Riak config instead.
&gt;
&gt;On 15 January 2015 at 11:05, Fred Grim  wrote:
&gt;&gt; Hello List,
&gt;&gt;
&gt;&gt; So I am using apache on ubuntu as a reverse proxy to a riak cluster.
&gt;&gt;Everything seems to work fine except for largish streaming map reduce
&gt;&gt;queries. The config is:
&gt;&gt; 
&gt;&gt; ServerAdmin aper...@acompany.com
&gt;&gt; 
&gt;&gt; BalancerMember
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;kc9WU&e= :8098
&gt;&gt; BalancerMember
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;kc9WU&e= :8098
&gt;&gt; BalancerMember
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;kc9WU&e= :8098
&gt;&gt; BalancerMember
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;kc9WU&e= :8098
&gt;&gt; BalancerMember
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;kc9WU&e= :8098
&gt;&gt; BalancerMember
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;kc9WU&e= :8098
&gt;&gt; BalancerMember
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez6M
&gt;&gt;0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7
&gt;&gt;PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4fRr
&gt;&gt;kc9WU&e= :8098
&gt;&gt; 
&gt;&gt; 
&gt;&gt; ProxyPass balancer://riak\_cluster/
&gt;&gt; ProxyPassReverse balancer://riak\_cluster/
&gt;&gt; 
&gt;&gt; 
&gt;&gt;
&gt;&gt; What happens is that my streamed queries seem to partially come in
&gt;&gt;which makes me think that the load balancer is switching them or
&gt;&gt;something. I know I am missing some config value in here but I cannot,
&gt;&gt;for the life of me, figure out what it is. Does anyone have an example
&gt;&gt;config they could through up?
&gt;&gt;
&gt;&gt; F
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; 
&gt;&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_mailm
&gt;&gt;an\_listinfo\_riak-2Dusers-5Flists.basho.com&d=AwICAg&c=Sqcl0Ez6M0X8aeM67LK
&gt;&gt;IiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7PMnXQSchCb
&gt;&gt;1a36y\_3o9wCTLFVK8KJSs0&s=MsEIDP9hnsHgV-B\_0DwIZR4xJbEmFwP3M1b3ULbDXiU&e=
&gt;
&gt;
&gt;
&gt;-- 
&gt;Turning and turning in the widening gyre
&gt;The falcon cannot hear the falconer
&gt;Things fall apart; the center cannot hold
&gt;Mere anarchy is loosed upon the world
&gt;
&gt;\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;riak-users mailing list
&gt;riak-users@lists.basho.com
&gt;https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_mailma
&gt;n\_listinfo\_riak-2Dusers-5Flists.basho.com&d=AwICAg&c=Sqcl0Ez6M0X8aeM67LKIi
&gt;DJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7PMnXQSchCb1a3
&gt;6y\_3o9wCTLFVK8KJSs0&s=MsEIDP9hnsHgV-B\_0DwIZR4xJbEmFwP3M1b3ULbDXiU&e= 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

