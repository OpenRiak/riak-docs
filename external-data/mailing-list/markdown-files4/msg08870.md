---
title: "Re: Riak JAVA Client Performance"
description: ""
project: community
lastmod: 2012-10-10T08:19:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08870"
mailinglist_parent_id: "msg08866"
author_name: "Pavel Kogan"
project_section: "mailinglistitem"
sent_date: 2012-10-10T08:19:34-07:00
---


I understand that load balancing is a final solution, but I want to
benchmark single node.
If I knew that I can load single node with N requests / sec, I could assume
that after load balancing over 5 nodes my throughput limit will increase
linearly.

Pavel

On Wed, Oct 10, 2012 at 2:51 PM, Guido Medina wrote:

&gt; The answer is there, create a client config with N pooled connections to
&gt; your load balancer whatever you are using, I know HA proxy supports the PBC
&gt; config (TCP based) which is faster than HTTP client, and hence my
&gt; recommendation.
&gt;
&gt; Say, a non-clustered client config with N connections to balancer\_host at
&gt; 8087 and your balancer\_host connected to EACH node, that's the way to go,
&gt; the rest is about the CAP level you want to support which will impact your
&gt; performance vs integrity. Up to you.
&gt;
&gt; CAP doc:
&gt; http://docs.basho.com/riak/latest/tutorials/fast-track/Tunable-CAP-Controls-in-Riak/
&gt;
&gt; Guido.
&gt;
&gt;
&gt; On 10/10/12 13:33, Pavel Kogan wrote:
&gt;
&gt; Hi,
&gt;
&gt; The node is OK and not down.
&gt; I have a way to do load balancing externally to JAVA Client.
&gt; I am evaluating Riak for using in my company and want to measure maximal
&gt; throughput vs single node.
&gt;
&gt; Thanks,
&gt; Pavel
&gt;
&gt; On Wed, Oct 10, 2012 at 2:13 PM, Guido Medina wrote:
&gt;
&gt;&gt; That question has been answered few times, here is my old answer:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; It is the Java client which to be honest, doesn't handle well one node
&gt;&gt; going down, so, for example, in my company we use HA proxy for that, here is
&gt;&gt; a starting configuration: https://gist.github.com/1507077
&gt;&gt;
&gt;&gt; Once we switched to HA proxy we just use a simple client without cluster
&gt;&gt; config, so the Java client doesn't know anything about the load balancing
&gt;&gt; going on. It works well, I can upgrade and restart servers without our Java
&gt;&gt; application be complaining.
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt;
&gt;&gt; Guido.
&gt;&gt;
&gt;&gt;
&gt;&gt; On 10/10/12 12:58, Pavel Kogan wrote:
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt;
&gt;&gt; I will try this solution.
&gt;&gt;
&gt;&gt; Pavel
&gt;&gt;
&gt;&gt; On Wed, Oct 10, 2012 at 1:51 PM, kamiseq  wrote:
&gt;&gt;
&gt;&gt;&gt; well I asked same question few days ago (maybe 2 weeks form now) and
&gt;&gt;&gt; the answer was that yes sharing client is thread safe and all you
&gt;&gt;&gt; should do is to create new bucket instance on every request
&gt;&gt;&gt;
&gt;&gt;&gt; pozdrawiam
&gt;&gt;&gt; Paweł Kamiński
&gt;&gt;&gt;
&gt;&gt;&gt; kami...@gmail.com
&gt;&gt;&gt; pkaminski....@gmail.com
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 10 October 2012 09:25, Pavel Kogan  wrote:
&gt;&gt;&gt; &gt; 1) Is it ok to share a single pbc client object between 50 threads?
&gt;&gt;&gt; Should
&gt;&gt;&gt; &gt; it be protected by lock ?
&gt;&gt;&gt; &gt; 2) I didn't do load balancing between nodes yet, cause I want to
&gt;&gt;&gt; understand
&gt;&gt;&gt; &gt; better throughput limit. I am planning to do it for much higher
&gt;&gt;&gt; throughput.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Pavel
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; On Wed, Oct 10, 2012 at 9:21 AM, kamiseq  wrote:
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; maybe the good start is to share pbclient object and only create
&gt;&gt;&gt; &gt;&gt; bucket per request, you will save few steps on client configuration.
&gt;&gt;&gt; &gt;&gt; have you tried balancing requests to cluster and distribute them over
&gt;&gt;&gt; all
&gt;&gt;&gt; &gt;&gt; nodes?
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; pozdrawiam
&gt;&gt;&gt; &gt;&gt; Paweł Kamiński
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; kami...@gmail.com
&gt;&gt;&gt; &gt;&gt; pkaminski....@gmail.com
&gt;&gt;&gt; &gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; On 10 October 2012 06:18, Pavel Kogan 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; &gt;&gt; &gt; Hi all,
&gt;&gt;&gt; &gt;&gt; &gt;
&gt;&gt;&gt; &gt;&gt; &gt; I have Riak cluster consisting of 5 nodes that contains about 30
&gt;&gt;&gt; &gt;&gt; &gt; millions of
&gt;&gt;&gt; &gt;&gt; &gt; keys (35% of capacity according to Riak Control).
&gt;&gt;&gt; &gt;&gt; &gt; Currently we have single JAVA client reading and writing records to
&gt;&gt;&gt; same
&gt;&gt;&gt; &gt;&gt; &gt; node. I need some tips, how to use the client efficiently
&gt;&gt;&gt; &gt;&gt; &gt; to reach maximal throughput - I would like to be able to read/write
&gt;&gt;&gt; up
&gt;&gt;&gt; &gt;&gt; &gt; to
&gt;&gt;&gt; &gt;&gt; &gt; 100 records/sec on 1Gbit network. Currently I get a lot
&gt;&gt;&gt; &gt;&gt; &gt; of JAVA socket exceptions after a while (even for the much slower
&gt;&gt;&gt; rate -
&gt;&gt;&gt; &gt;&gt; &gt; 10
&gt;&gt;&gt; &gt;&gt; &gt; records/sec), after which I need to restart client and node.
&gt;&gt;&gt; &gt;&gt; &gt;
&gt;&gt;&gt; &gt;&gt; &gt; Thanks,
&gt;&gt;&gt; &gt;&gt; &gt; Pavel
&gt;&gt;&gt; &gt;&gt; &gt;
&gt;&gt;&gt; &gt;&gt; &gt; P.S: My client using 50 threads and pbc client is created and
&gt;&gt;&gt; &gt;&gt; &gt; shut-downed
&gt;&gt;&gt; &gt;&gt; &gt; per request.
&gt;&gt;&gt; &gt;&gt; &gt;
&gt;&gt;&gt; &gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; &gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt; &gt;&gt; &gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing 
&gt;&gt; listriak-users@lists.basho.comhttp://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

