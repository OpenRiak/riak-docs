---
title: "Re: riak hinted handoff freezed transfer"
description: ""
project: community
lastmod: 2013-08-02T05:42:21-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11868"
mailinglist_parent_id: "msg11847"
author_name: "Igor Karymov"
project_section: "mailinglistitem"
sent_date: 2013-08-02T05:42:21-07:00
---


Looks like the root of the problem in incorrect handling of bad\_crc backend
error.
This error was mention here https://github.com/basho/riak\_kv/pull/385
Could anybody advice way how-to to do dealt with this error in riak 1.2.1-1
?


2013/8/1 Daniil Churikov 

&gt; Hello dear list.
&gt; Recently we had an issue: 1 from 4 of our riak nodes went down
&gt; ('riak@10.0.1.192'). As expected 3 other nodes took it's work and
&gt; everything
&gt; was ok.
&gt; After some time we was able to recover this node and put it again into
&gt; cluster.
&gt;
&gt; But now I see some strange things in logs:
&gt;
&gt; # riak-admin transfers
&gt; Attempting to restart script through sudo -H -u riak
&gt; 'riak@10.0.1.190' waiting to handoff 1 partitions
&gt;
&gt;
&gt; From 'riak@10.0.1.190' logs:
&gt;
&gt; [error] hinted\_handoff transfer of riak\_kv\_vnode from 'riak@10.0.1.190'
&gt; 1244559988039597016282825365359959758925755056128 to 'riak@10.0.1.192'
&gt; 1244559988039597016282825365359959758925755056128 failed because of
&gt; error:{case\_clause,{error,closed}}
&gt;
&gt; [{riak\_core\_handoff\_sender,start\_fold,5,[{file,"src/riak\_core\_handoff\_sender.erl"},{line,174}]}]
&gt;
&gt;
&gt; And from 'riak@10.0.1.192' (recovered node) logs:
&gt; 2013-08-01 08:20:00.222 UTC [error] &lt;0.31615.12&gt; Supervisor poolboy\_sup had
&gt; child riak\_core\_vnode\_worker started with
&gt;
&gt; riak\_core\_vnode\_worker:start\_link([{worker\_args,[1244559988039597016282825365359959758925755056128,[],worker\_props]},{worker\_callback\_mod,...},...])
&gt; at undefined exit with reason no case clause matching
&gt;
&gt; {error,bad\_crc,{state,#Ref&lt;0.0.11.259591&gt;,"1244559988039597016282825365359959758925755056128",[{async\_folds,true},{vnode\_vclocks,true},{included\_applications,[]},{allow\_strfun,false},{storage\_backend,riak\_kv\_bitcask\_backend},{legacy\_keylisting,false},{reduce\_js\_vm\_count,0},{js\_thread\_stack,16},{riak\_kv\_stat,true},{map\_js\_vm\_count,0},{mapred\_system,pipe},{js\_max\_vm\_mem,8},{legacy\_stats,true},{mapred\_name,"mapred"},{stats\_urlpath,"stats"},{http\_url\_encoding,...},...],...}}
&gt; in riak\_kv\_vnode:prepare\_put/3 line 698 in context shutdown\_error
&gt; 2013-08-01 08:20:00.231 UTC [error] &lt;0.31615.12&gt; gen\_server &lt;0.31615.12&gt;
&gt; terminated with reason: no case clause matching
&gt;
&gt; {error,bad\_crc,{state,#Ref&lt;0.0.11.259591&gt;,"1244559988039597016282825365359959758925755056128",[{async\_folds,true},{vnode\_vclocks,true},{included\_applications,[]},{allow\_strfun,false},{storage\_backend,riak\_kv\_bitcask\_backend},{legacy\_keylisting,false},{reduce\_js\_vm\_count,0},{js\_thread\_stack,16},{riak\_kv\_stat,true},{map\_js\_vm\_count,0},{mapred\_system,pipe},{js\_max\_vm\_mem,8},{legacy\_stats,true},{mapred\_name,"mapred"},{stats\_urlpath,"stats"},{http\_url\_encoding,...},...],...}}
&gt; in riak\_kv\_vnode:prepare\_put/3 line 698
&gt; 2013-08-01 08:20:00.255 UTC [error] &lt;0.31615.12&gt; CRASH REPORT Process
&gt; &lt;0.31615.12&gt; with 0 neighbours exited with reason: no case clause matching
&gt;
&gt; {error,bad\_crc,{state,#Ref&lt;0.0.11.259591&gt;,"1244559988039597016282825365359959758925755056128",[{async\_folds,true},{vnode\_vclocks,true},{included\_applications,[]},{allow\_strfun,false},{storage\_backend,riak\_kv\_bitcask\_backend},{legacy\_keylisting,false},{reduce\_js\_vm\_count,0},{js\_thread\_stack,16},{riak\_kv\_stat,true},{map\_js\_vm\_count,0},{mapred\_system,pipe},{js\_max\_vm\_mem,8},{legacy\_stats,true},{mapred\_name,"mapred"},{stats\_urlpath,"stats"},{http\_url\_encoding,...},...],...}}
&gt; in riak\_kv\_vnode:prepare\_put/3 line 698 in gen\_server:terminate/6 line 747
&gt;
&gt;
&gt; It seems that for some reason 'riak@10.0.1.192' node abort handoff every
&gt; time 'riak@10.0.1.190' tried to give it's data back.
&gt;
&gt; Riak version is 1.2.1-1
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/riak-hinted-handoff-freezed-transfer-tp4028652.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

