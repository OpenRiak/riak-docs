---
title: "Re: Custom hashing (partitioning) functions"
description: ""
project: community
lastmod: 2014-01-30T17:24:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13552"
mailinglist_parent_id: "msg13425"
author_name: "Sargun Dhillon"
project_section: "mailinglistitem"
sent_date: 2014-01-30T17:24:20-08:00
---


Cool, I went ahead and created an issue a little while ago:
https://github.com/basho/riak\_kv/issues/811

It's not so much of a blocker for us, because the product team working
with custom partitioners and Riak. It's just something that people
might want to keep an eye out in the future when using MR, or
riak\_pipe directly.

As as side-note, is there information around querying Riak directly
with Riak\_pipe; I imagine it has some of the same downsides as
mapreduce. We're primarily using it as a method to avoid the
read-modify-write overheads on writing to Riak, and multi-key,
partition-specific reads (utilizing targeted 2i, because we know the
coverage as we know the partition key).

Has anyone else here done this in production?

On Tue, Jan 21, 2014 at 7:25 AM, Sean Cribbs  wrote:
&gt; Sargun,
&gt;
&gt; That might indeed be a bug. Would you file it on the issue tracker?
&gt; https://github.com/basho/riak\_kv/issues
&gt;
&gt;
&gt; On Mon, Jan 20, 2014 at 3:08 PM, Sargun Dhillon  wrote:
&gt;&gt;
&gt;&gt; So, I don't know how many people are aware of if, but Riak supports
&gt;&gt; custom hashing (partitioning) functions. It's exposed as a bucket
&gt;&gt; property (chash\_keyfun), in which you can deploy your own code to hash
&gt;&gt; keys to ensure data locality to specific vnodes. This can come in
&gt;&gt; handy when doing custom mapreduce jobs, riak\_pipe, or riak\_core
&gt;&gt; applications.
&gt;&gt;
&gt;&gt; After playing around with this feature set quite a bit recently, it
&gt;&gt; seems like there are some places that don't entirely respect this.
&gt;&gt; Specifically, the place where I'm looking at right now is
&gt;&gt; riak\_kv\_pipe\_get, when try\_preflist gets called (if try\_partition
&gt;&gt; falls through), it falls back to riak\_core\_util:chash\_key (L188), as
&gt;&gt; opposed to looking at the riak\_pipe chashfun, or the bucket chashfun.
&gt;&gt; What's the approach that most people have taken here with custom hash
&gt;&gt; functions?
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

