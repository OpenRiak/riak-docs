---
title: "Re: riak disk usage"
description: ""
project: community
lastmod: 2013-12-02T08:10:26-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13134"
mailinglist_parent_id: "msg13131"
author_name: "Hector Castro"
project_section: "mailinglistitem"
sent_date: 2013-12-02T08:10:26-08:00
---


Stefan,

The Riak 2.0 technical preview hasn't been heavily tested with Riak CS
because it isn't a stable release. The best combination of Riak and
Riak CS to run right now is Riak 1.4.2 and Riak CS 1.4.3.

Below are a few settings you can tweak to reclaim disk space more
aggressively in Riak CS:

- `leeway\_seconds` – Number of seconds before an object is garbage
collected (might want to start with 3600)
- `gc\_interval` – Ensure that all nodes in your cluster \*but one\* are
set to `infinity` (disables GC on all nodes but one to reduce
redundant work)
- `delete\_concurrency` – Number of blocks to delete concurrently

You may want to add another node to your cluster before making any of
these changes so that disk utilization on the existing nodes in your
cluster goes down.

--
Hector


On Sat, Nov 30, 2013 at 6:19 PM, Silasi Stefan  wrote:
&gt; Thanks for your reply Hector.
&gt; I'm using the simple python/boto script for upload via the
&gt; key.set\_content\_from\_file method. Each object has an unique key name.
&gt;
&gt; Today, 2 of the nodes are at 100% disk usage after I tried to remove one of
&gt; them via "riak-admin cluster remove riak@node".
&gt; I upgraded to the technical preview version 2.0... so far, it didn't help.
&gt;
&gt; Thank you,
&gt; Stefan.
&gt;
&gt;
&gt; On Sat, Nov 30, 2013 at 8:27 PM, Hector Castro  wrote:
&gt;&gt;
&gt;&gt; Hello Silasi,
&gt;&gt;
&gt;&gt; Can you please explain the process you're using to add the image/video
&gt;&gt; data into Riak CS? Are you overwriting objects or using multipart
&gt;&gt; upload?
&gt;&gt;
&gt;&gt; --
&gt;&gt; Hector
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Nov 28, 2013 at 5:33 AM, Silasi Stefan 
&gt;&gt; wrote:
&gt;&gt; &gt; Hello,
&gt;&gt; &gt;
&gt;&gt; &gt; I'm preparing an evironment for an image/video storage website, with
&gt;&gt; &gt; riak-cs
&gt;&gt; &gt; on top of riak cluster.
&gt;&gt; &gt; I have 5 servers with a 900gb disk each and about 700gb of images/videos
&gt;&gt; &gt; collected, mainly images.
&gt;&gt; &gt;
&gt;&gt; &gt; I have a little over 300,000 objects in total, all stored in one place
&gt;&gt; &gt; occupying a little over 700gb data. Based on the formula: 700gb x 3
&gt;&gt; &gt; replication factor, I was expecting to use around 2.1-2.2 TB data.
&gt;&gt; &gt;
&gt;&gt; &gt; After uploading half of the 700gb data (350gb x 3 = 1,05TB), I notice
&gt;&gt; &gt; the
&gt;&gt; &gt; disk usage is around 70% already on all nodes (640gb x 5 = ~3.2TB). The
&gt;&gt; &gt; nodes are dedicated to riak/riak-cs.
&gt;&gt; &gt;
&gt;&gt; &gt; Am I missing something?
&gt;&gt; &gt;
&gt;&gt; &gt; Thank you,
&gt;&gt; &gt; Stefan.
&gt;&gt; &gt;
&gt;&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; &gt;
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

