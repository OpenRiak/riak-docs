---
title: "Re: What happens when a node goes down?"
description: ""
project: community
lastmod: 2014-03-24T11:24:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13910"
mailinglist_parent_id: "msg13907"
author_name: "Jeff Peck"
project_section: "mailinglistitem"
sent_date: 2014-03-24T11:24:27-07:00
---


Thank you, this has been very helpful. I appreciate all of the information and 
the quick responses.

- Jeff


On Mar 24, 2014, at 2:20 PM, Seth Thomas  wrote:

&gt; To further elaborate:
&gt; 
&gt; When a nodes fails (or is simply too slow) for a PUT request, that data will 
&gt; be placed on the first fallback in the preflist as per [1]. For a GET the 
&gt; request only needs to full fill the R[2] value which for an N of 3, is 2. So 
&gt; the GET request would succeed by simply taking the response from the other 
&gt; two active primaries and then read-repair[3] the value to the fallback.
&gt; 
&gt; Hopefully that makes it a little bit more clear the moving pieces in a 
&gt; failure scenario.
&gt; 
&gt; [1] 
&gt; http://docs.basho.com/riak/latest/theory/concepts/Replication/#Processing-partition-requests
&gt; [2] 
&gt; http://docs.basho.com/riak/latest/theory/concepts/Eventual-Consistency/#Replication-properties-and-request-tuning
&gt; [3] http://docs.basho.com/riak/latest/theory/concepts/Replication/#Read-Repair
&gt; 
&gt; 
&gt; 
&gt; On March 24, 2014 at 10:57:02, Jeff Peck (je...@tnrglobal.com) wrote:
&gt; 
&gt;&gt; Aha, so if a node is detected to go down, but the cluster is not currently 
&gt;&gt; receiving any requests (i.e. on a development cluster that is used to store 
&gt;&gt; data that is only requested periodically or in batches, etc.) then there 
&gt;&gt; would not be any increased I/O unless it is manually ("administratively") 
&gt;&gt; removed?
&gt;&gt; 
&gt;&gt; - Jeff
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Mar 24, 2014, at 1:53 PM, Seth Thomas  wrote:
&gt;&gt; 
&gt;&gt;&gt; As immediately as the cluster can detect the node is no longer serving 
&gt;&gt;&gt; requests[1]. There will likely be increased network and IO among the 
&gt;&gt;&gt; remaining nodes as they will be picking up the slack. That said, the data 
&gt;&gt;&gt; is not permanently reshuffled at that point - only such time as it is 
&gt;&gt;&gt; administratively removed. The degree to which you’d see a spike depends on 
&gt;&gt;&gt; the volume of objects, # of physical nodes, and # of partitions/vnodes.
&gt;&gt;&gt; 
&gt;&gt;&gt; [1] 
&gt;&gt;&gt; http://docs.basho.com/riak/latest/theory/concepts/Replication/#Processing-partition-requests
&gt;&gt;&gt; 
&gt;&gt;&gt; On March 24, 2014 at 10:43:36, Jeff Peck (je...@tnrglobal.com) wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Does that happen immediately? I am basically trying to understand: When a 
&gt;&gt;&gt;&gt; physical node goes down (let's say it is temporarily restarted, or down 
&gt;&gt;&gt;&gt; for even a couple hours due to some sort of failure), will that cause an 
&gt;&gt;&gt;&gt; increase in disk and network bandwidth at the moment that it goes down as 
&gt;&gt;&gt;&gt; data is re-shuffled across the cluster?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; Jeff
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Mar 24, 2014, at 1:38 PM, Seth Thomas  wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Data is redistributed temporarily (indefinitely) until the primary node 
&gt;&gt;&gt;&gt;&gt; comes back online. So primary ownership of data would not be changed but 
&gt;&gt;&gt;&gt;&gt; your keys could be living on another physical node if any of the primary 
&gt;&gt;&gt;&gt;&gt; replicas were down.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; So to answer your question directly: Yes (in the narrowest definition)
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; On March 24, 2014 at 10:34:22, Jeff Peck (je...@tnrglobal.com) wrote:
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; Thank you. So, does that mean that no redistribution of data would occur 
&gt;&gt;&gt;&gt;&gt;&gt; unless the node is manually removed?
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; - Jeff
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; On Mar 24, 2014, at 1:31 PM, Seth Thomas  wrote:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Jeff,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; When a node is no longer responding a process called hinted handoff[1] 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; takes over and ensure that your N (replication) value is met by 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; allowing other nodes to temporarily take responsibility for the vnodes 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; of the downed node. This node can return to the cluster and will resume 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; operations for the vnodes it’s primarily responsible for or you could 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; remove the node[2] from the cluster which would redistribute the 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; primary responsibly among the remaining nodes. I’d also give our docs 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; on replication[3] a look for more information.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Seth Thomas
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; [1] 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://docs.basho.com/riak/latest/theory/concepts/glossary/#Hinted-Handoff
&gt;&gt;&gt;&gt;&gt;&gt;&gt; [2] 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://docs.basho.com/riak/latest/ops/running/nodes/adding-removing/#Removing-a-Node-From-a-Cluster
&gt;&gt;&gt;&gt;&gt;&gt;&gt; [3] http://docs.basho.com/riak/latest/theory/concepts/Replication/
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On March 24, 2014 at 9:33:17, Jeff Peck (je...@tnrglobal.com) wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Is there a description of what happens internally when a node goes 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; down? I am curious if any there would be any sort of reshuffling or 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; redistribution of data in the remaining vnodes? Or would the node 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; simply be unavailable until restarted? 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thanks, 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Jeff 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

