---
title: "Re: strange behavior upgrading from riak-java-client 1.0.5 -> 1.0.6"
description: ""
project: community
lastmod: 2012-12-28T12:35:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09703"
mailinglist_parent_id: "msg09702"
author_name: "Dietrich Featherston"
project_section: "mailinglistitem"
sent_date: 2012-12-28T12:35:14-08:00
---


I don't believe allow\_mult is enabled. It shouldn't be at least!

On Dec 28, 2012, at 1:23 PM, Brian Roach  wrote:

&gt; On Fri, Dec 28, 2012 at 12:34 PM, Dietrich Featherston
&gt;  wrote:
&gt;&gt; Primarily stores but I did see one case of socket timeouts simply building a 
&gt;&gt; new connection pool using the rjc.
&gt; 
&gt; This should be simply a result of attempting to bring up another
&gt; instance of the client when the node can't accept more connections and
&gt; when it tries to "warm up" the connection pool, those connections time
&gt; out.
&gt; 
&gt;&gt; We are simply doing a put. It is not uncommon for keys to be overwritten but 
&gt;&gt; we are not
&gt;&gt; providing a vector clock. There is a dedicated master performing the write 
&gt;&gt; for a given key
&gt;&gt; upstream from riak and overwriting is always safe (assuming last one wins) 
&gt;&gt; but we don't
&gt;&gt; hold onto the vector clock.
&gt;&gt; 
&gt;&gt; It seems possible/likely that we are inadvertently invoking some riak 
&gt;&gt; consistency
&gt;&gt; machinery by turning off the get prior to put using withoutFetch(). Would it 
&gt;&gt; help to attempt
&gt;&gt; to coordinate writes in another way?
&gt; 
&gt; Are you using a bucket with allow\_mult enabled?
&gt; 
&gt;&gt; Somewhat related: I've been curious about writing a smart riak client that 
&gt;&gt; writes to a node
&gt;&gt; based on the preflist for a key to avoid unnecessary internal handing off of 
&gt;&gt; reads and
&gt;&gt; writes when possible. Two things strike me though 1) would need to compute 
&gt;&gt; this preflist
&gt;&gt; outside of riak and 2) unsure how impactful this change would be without 
&gt;&gt; better
&gt;&gt; understanding where internal riak bottlenecks present themselves. Perhaps 
&gt;&gt; best left for
&gt;&gt; another thread.
&gt; 
&gt; Yeah - a bit off topic but we've talked about this (not in great
&gt; detail as of yet) internally.
&gt; 
&gt; - Roach

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

