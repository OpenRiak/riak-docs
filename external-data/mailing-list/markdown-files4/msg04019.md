---
title: "Re: MapReduce query returns case_clause badmatch?"
description: ""
project: community
lastmod: 2011-07-15T12:30:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04019"
mailinglist_parent_id: "msg04017"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-07-15T12:30:00-07:00
---


Jonathan,

Riak cannot run a map phase that takes anything other than
bucket/key[/keydata] inputs, so returning [value] from your first map phase
is invalid. Instead, just return [1] if your regexp test passes.

On Fri, Jul 15, 2011 at 2:07 PM, Jonathan Langevin &lt;
jlange...@loomlearning.com&gt; wrote:

&gt; When running several maps and one reduce against a bucket, I'm getting an
&gt; error, info is below.
&gt; Any idea what I'm doing wrong?
&gt;
&gt; Data submitted (printed as php-style array):
&gt; array
&gt; (
&gt; 'inputs' =&gt; 'Course'
&gt; 'query' =&gt; array
&gt; (
&gt; '0' =&gt; array
&gt; (
&gt; 'map' =&gt; array
&gt; (
&gt; 'keep' =&gt; false
&gt; 'language' =&gt; 'javascript'
&gt; 'arg' =&gt; null
&gt; 'source' =&gt; 'function(v){return [v];}'
&gt; )
&gt; )
&gt; '1' =&gt; array
&gt; (
&gt; 'map' =&gt; array
&gt; (
&gt; 'keep' =&gt; false
&gt; 'language' =&gt; 'javascript'
&gt; 'arg' =&gt; null
&gt; 'source' =&gt; '
&gt; function(value){
&gt; if(!value.not\_found) {
&gt; var object = Riak.mapValuesJson(value)[0];
&gt; var val = object[\"idNumber\"].toLowerCase();
&gt; if((val.match(/lbst/))) {
&gt; return [value];
&gt; }
&gt; }
&gt; return [];
&gt; }
&gt; '
&gt; )
&gt; )
&gt; '2' =&gt; array
&gt; (
&gt; 'map' =&gt; array
&gt; (
&gt; 'keep' =&gt; false
&gt; 'language' =&gt; 'javascript'
&gt; 'arg' =&gt; null
&gt; 'source' =&gt; 'function(){return [1]}'
&gt; )
&gt; )
&gt; '3' =&gt; array
&gt; (
&gt; 'reduce' =&gt; array
&gt; (
&gt; 'keep' =&gt; true
&gt; 'language' =&gt; 'javascript'
&gt; 'arg' =&gt; null
&gt; 'name' =&gt; 'Riak.reduceSum'
&gt; )
&gt; )
&gt; )
&gt; )
&gt;
&gt;
&gt; And here is the [start of] the response I get, below.
&gt; What's interesting is, I also get back the results of my query (or at
&gt; least, the contents of the bucket...).
&gt;
&gt; array
&gt; (
&gt; 'headers' =&gt; array
&gt; (
&gt; 'http\_code' =&gt; 500
&gt; 'server' =&gt;
&gt; 'MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)'
&gt; 'date' =&gt; 'Fri, 15 Jul 2011 18:02:25 GMT'
&gt; 'content-type' =&gt; 'text/html'
&gt; 'content-length' =&gt; '2453'
&gt; )
&gt; 'body' =&gt;
&gt; '500 Internal Server 
&gt; ErrorInternal Server Error
=====================

The server 
&gt; encountered an error while processing this request:  

```
{error,
&gt;     {error,
&gt;         {case_clause,
&gt;             {{badmatch,
&gt;                  {struct,
&gt;                      [{&lt;&lt;\"bucket\"&gt;&gt;,&lt;&lt;\"Course\"&gt;&gt;},
&gt;                       {&lt;&lt;\"key\"&gt;&gt;,
&gt; .....
&gt; *
&gt;
&gt;
&gt;  
&gt;  Jonathan Langevin
&gt; Systems Administrator
&gt; Loom Inc.
&gt; Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
&gt; www.loomlearning.com - Skype: intel352
&gt; *
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://www.basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


```
