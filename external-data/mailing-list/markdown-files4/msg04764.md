---
title: "Precommit Hook Difficulties"
description: ""
project: community
lastmod: 2011-09-17T16:11:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04764"
author_name: "Greg Pascale"
project_section: "mailinglistitem"
sent_date: 2011-09-17T16:11:45-07:00
---


Hi,

I'm trying to write a simple precommit hook to modify a JSON object by
removing certain fields. The simplest way to do this, I figure, is to decode
the object's value with mochijson2, remove the fields I don't want,
re-encode it, and update the value.

What happens, though, is my object ends up somehow mangled. When I inspect
it via curl, it sort of looks like JSON, but characters like "{" and ":"
seem to be replaced with garbage.

For example, what should read "hostname":"www.google.com" looks like \*
hostnamea"ja:la"mwww.google.coma"j\*

To try to diagnose the issue, I reduced my hook to the simplest possible
case. I don't even modify the JSON, I just decode the object and re-encode
exactly the same value, but I still have the problem. The code is pasted
below

\*precommit(RiakObject) -&gt;\*
\* Value = riak\_object:get\_value(RiakObject),\*
\* {struct, TermList} = mochijson2:decode(Value),\*
\* riak\_object:apply\_updates(\*
\* riak\_object:update\_value(RiakObject, \*
\* mochijson2:encode({struct, TermList}))).
\*

Can anybody point out what I'm doing wrong?

-- 
Greg
Clipboard  is hiring
!
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

