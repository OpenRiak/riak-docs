---
title: "Re: Question on the symptoms of Ticket 260"
description: ""
project: community
lastmod: 2010-10-13T18:21:42-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01280"
mailinglist_parent_id: "msg01278"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-10-13T18:21:42-07:00
---


Hi SC,

If a single client is writing to a single key with read and write quorums
your reads should reflect your writes. Are other clients updating the same
key concurrently? Are you updating the values with the correct vclock? Would
it be possible to provide a minimal test case that reproduces the issue?

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Wed, Oct 13, 2010 at 5:07 PM, scott clasen wrote:

&gt; Hi-
&gt;
&gt; I am writing a Riak backend for Akka's persistent data structures,
&gt; and am running into what looks like behavior similar to what is
&gt; mentioned in this ticket.
&gt;
&gt; https://issues.basho.com/show\_bug.cgi?id=260 which says---&gt;
&gt;
&gt; In cases where objects are rapidly updated and deleted, unpredictable
&gt; behavior
&gt; seems to occur due to race conditions. Exposing tombstones to the client
&gt; when
&gt; allow\_mult is true would allow resolution of the conflict that is normally
&gt; hidden from the user. This will require the client who is interested in
&gt; resolving delete+update conflicts to submit the vclock when performing the
&gt; delete.
&gt;
&gt; This is on a single riak instance 0.13.0, on OS X, installed via 'brew
&gt; install riak', w
&gt;
&gt; The behavior I am seeing is in a single threaded test that rapidly
&gt; inserts, updates and deletes the value for a single key in a single
&gt; bucket.
&gt;
&gt; This is using the protobuf interface, via the riak-java-pb-client.
&gt; All reads use quorum, and all writes use quorum and durableWrite
&gt; quorum as well.
&gt;
&gt; Running the tests outside the debugger cause test failures because the
&gt; reads are not seeing the latest write/delete
&gt;
&gt; When I run the tests in debug mode, with breakpoints set to watch the
&gt; values returned from riak, the tests pass.
&gt;
&gt; This makes me think there is some race condition like the one
&gt; mentioned in ticket 260 occurring. Although it could certainly be user
&gt; error ;).
&gt;
&gt; Other than the default config, I have tried fiddling with
&gt; last\_write\_wins and allow\_multi but no combination of those seem to
&gt; help.
&gt;
&gt; Is there anything I am missing, or any configuration or code that can
&gt; give me a consistent view?
&gt;
&gt; Thanks
&gt; SC
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

