---
title: "Re: riak 2.0 - java client 'unavailable' exception"
description: ""
project: community
lastmod: 2014-07-28T16:57:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14567"
mailinglist_parent_id: "msg14566"
author_name: "Joseph Blomstedt"
project_section: "mailinglistitem"
sent_date: 2014-07-28T16:57:07-07:00
---


This means the consistency sub-system is not enabled/active. You can
verify this with the output of `riak-admin ensemble-status`.

To enable strong consistency you must:

1) Set 'strong\_consistency = on' in riak.conf.
2) Have at least a 3 node cluster.

You can address #2 by setting up 3+ local developer nodes as detailed
in the 5 minute tutorial:
http://docs.basho.com/riak/2.0.0/quickstart

Alternatively, you can override the need for 3 nodes and use 1 node.

To do that,

1) Run 'riak attach' to attach to your Riak's node console
2) Enter (including the period): riak\_ensemble\_manager:enable().
3) Enter (including the period): riak\_core\_ring\_manager:force\_update().
3) Detach from the console using: Ctrl-C a

After either approach, re-check `riak-admin ensemble-status`. It may
take up to a minute for the consistency sub-system to be enabled.

If you haven't already, please take a look at the temporary (until we
finish updating docs.basho.com) strong consistency related
documentation (linked from the 2.0 RC1 release notes) here:
https://github.com/basho/riak\_ensemble/blob/wip/riak-2.0-user-docs/riak\_consistent\_user\_docs.md

Regards,
Joe

On Mon, Jul 28, 2014 at 3:05 PM, Jason W  wrote:
&gt; Hi,
&gt;
&gt; I am trying out 2.0 w/ just one local node, created a strongly consistent
&gt; bucket type. But keep getting below exception. If I just use the default
&gt; bucket type, everything works fine. Here is the bucket type detail with
&gt; consistency bit on.
&gt;
&gt; young\_vclock: 20
&gt; w: quorum
&gt; small\_vclock: 50
&gt; rw: quorum
&gt; r: quorum
&gt; pw: 0
&gt; precommit: []
&gt; pr: 0
&gt; postcommit: []
&gt; old\_vclock: 86400
&gt; notfound\_ok: true
&gt; n\_val: 1
&gt; linkfun: {modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}
&gt; last\_write\_wins: false
&gt; dw: quorum
&gt; dvv\_enabled: true
&gt; chash\_keyfun: {riak\_core\_util,chash\_std\_keyfun}
&gt; big\_vclock: 50
&gt; basic\_quorum: false
&gt; allow\_mult: true
&gt; consistent: true
&gt; active: true
&gt; claimant: 'riak@0.0.0.0'
&gt;
&gt; Here is the java code
&gt;
&gt; List addresses = new LinkedList();
&gt;
&gt; addresses.add("172.16.0.254");
&gt;
&gt; RiakClient riakClient = RiakClient.newClient(addresses);
&gt;
&gt; try {
&gt;
&gt; Location wildeGeniusQuote = new Location(new
&gt; Namespace("strongly\_consistent2", "sample"), emp.getId());
&gt;
&gt; BinaryValue text =
&gt; BinaryValue.create(objectMapper.writeValueAsBytes(sampleObj));
&gt;
&gt; RiakObject obj = new RiakObject()
&gt;
&gt; .setContentType("text/plain")
&gt;
&gt; .setValue(text);
&gt;
&gt; StoreValue store = new
&gt; StoreValue.Builder(obj).withLocation(wildeGeniusQuote)
&gt;
&gt; .withOption(Option.ASIS, true)
&gt;
&gt; .withOption(Option.DW, new Quorum(1))
&gt;
&gt; .withOption(Option.IF\_NONE\_MATCH, true)
&gt;
&gt; .withOption(Option.IF\_NOT\_MODIFIED, true)
&gt;
&gt; .withOption(Option.PW, new Quorum(1))
&gt;
&gt; .withOption(Option.N\_VAL, 1)
&gt;
&gt; .withOption(Option.RETURN\_BODY, true)
&gt;
&gt; .withOption(Option.RETURN\_HEAD, true)
&gt;
&gt; .withOption(Option.SLOPPY\_QUORUM, true)
&gt;
&gt; .withOption(Option.TIMEOUT, 1000)
&gt;
&gt; .withOption(Option.W, new Quorum(1))
&gt;
&gt; .build();
&gt;
&gt; riakClient.execute(store);
&gt;
&gt; } catch (Exception e) {
&gt;
&gt; e.printStackTrace();
&gt;
&gt; return null;
&gt;
&gt; }
&gt;
&gt; Am I still missing something? Thanks.
&gt;
&gt;
&gt;
&gt; Caused by: com.basho.riak.client.core.netty.RiakResponseException:
&gt; unavailable
&gt;
&gt; at
&gt; com.basho.riak.client.core.netty.RiakResponseHandler.channelRead(RiakResponseHandler.java:52)
&gt;
&gt; at
&gt; io.netty.channel.DefaultChannelHandlerContext.invokeChannelRead(DefaultChannelHandlerContext.java:340)
&gt;
&gt; at
&gt; io.netty.channel.DefaultChannelHandlerContext.fireChannelRead(DefaultChannelHandlerContext.java:326)
&gt;
&gt; at
&gt; io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:155)
&gt;
&gt; at
&gt; io.netty.handler.codec.ByteToMessageCodec.channelRead(ByteToMessageCodec.java:108)
&gt;
&gt; at
&gt; io.netty.channel.DefaultChannelHandlerContext.invokeChannelRead(DefaultChannelHandlerContext.java:340)
&gt;
&gt; at
&gt; io.netty.channel.DefaultChannelHandlerContext.fireChannelRead(DefaultChannelHandlerContext.java:326)
&gt;
&gt; at
&gt; io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:785)
&gt;
&gt; at
&gt; io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:116)
&gt;
&gt; at
&gt; io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:494)
&gt;
&gt; at
&gt; io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:461)
&gt;
&gt; at
&gt; io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:378)
&gt;
&gt; at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:350)
&gt;
&gt; at
&gt; io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:101)
&gt;
&gt; ... 1 more
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Joseph Blomstedt 
Principal Engineer
Basho Technologies, Inc.
http://www.basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

