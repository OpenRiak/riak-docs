---
title: "MapReduce \"not_found\" from Solr search index"
description: ""
project: community
lastmod: 2015-11-16T03:49:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16771"
author_name: "Ellis Pritchard"
project_section: "mailinglistitem"
sent_date: 2015-11-16T03:49:16-08:00
---


Hi,

I've configured a Solr search index ("erights-users") for my bucket (named
"missing", default type), containing a bunch of JSON documents, with a
search schema ("erightsuser"); this seems to be working OK for simple
queries, i.e. I can run a Solr query against it and it returns expected
results:

$ curl http://localhost:8098/types/default/buckets/missing/props

{"props":{"allow\_mult":false,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"dvv\_enabled":false,"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"missing","notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":"quorum","rw":"quorum","search\_index":"erights-users","small\_vclock":50,"w":"quorum","write\_once":false,"young\_vclock":20}}


$ curl http://localhost:8098/search/query/erights-users?q=country.code:ANT

xml version="1.0" encoding="UTF-8"?
058country.code:ANT
127.0.0.1:8093/internal\_solr/erights-users\_yz\_pn:64
OR (\_yz\_pn:61 AND (\_yz\_fpn:61)) OR \_yz\_pn:60 OR \_yz\_pn:57 OR \_yz\_pn:54 OR
\_yz\_pn:51 OR \_yz\_pn:48 OR \_yz\_pn:45 OR \_yz\_pn:42 OR \_yz\_pn:39 OR \_yz\_pn:36
OR \_yz\_pn:33 OR \_yz\_pn:30 OR \_yz\_pn:27 OR \_yz\_pn:24 OR \_yz\_pn:21 OR
\_yz\_pn:18 OR \_yz\_pn:15 OR \_yz\_pn:12 OR \_yz\_pn:9 OR \_yz\_pn:6 OR
\_yz\_pn:3PRANTFINENCANTx...@xxx.com10783b99-9483-414d-a6f8-eb330ff6dfac104222051\*default\*missing\*10783b99-9483-414d-a6f8-eb330ff6dfac\*5110783b99-9483-414d-a6f8-eb330ff6dfacdefaultmissing ...


However, I'm trying to do a simple MapReduce on it, initially to count the
documents (following the example in the 2.1.1 riakdocs) and I always seem
to get 0 as a result:

$ curl -XPOST http://localhost:8098/mapred -H 'Content-Type:
application/json' -d
'{"inputs":{"module":"yokozuna","function":"mapred\_search","arg":["erights-users","country.code:ANT"]},"query":[{"map":{"language":"javascript","keep":false,"source":"function(v)
{ return [1];
}"}},{"reduce":{"language":"javascript","keep":true,"name":"Riak.reduceSum"}}]}'

[0]


If I run with {"keep": true} on the map operation, I get the following:

[[{"not\_found":{"bucket\_type":"default","bucket":"missing","key":"0063aac8-bb45-4051-a502-d541b41d327b","keydata":{}}},...

(NB confusingly, my bucket is called "missing"!).

Doing a GET for the keys that come back "not\_found" works fine.


What am I missing?


Ellis.

(Riak 2.1.1 MacOS X)

-- 

------------------------------
This email was sent by a company owned by Pearson plc, registered office at 
80 Strand, London WC2R 0RL. Registered in England and Wales with company 
number 53723.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

