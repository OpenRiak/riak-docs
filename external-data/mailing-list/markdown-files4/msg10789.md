---
title: "Re: Post commit hooks are a single process, so they are executed in	the same order as the commits ?"
description: ""
project: community
lastmod: 2013-04-09T03:37:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10789"
mailinglist_parent_id: "msg10785"
author_name: "Simon Majou"
project_section: "mailinglistitem"
sent_date: 2013-04-09T03:37:47-07:00
---


Ryan,

Yes I know about Riak Enterprise, but I am thinking about a more
"fine-grained" multi-cluster, by setting a X-Meta-primary-cluster property
on each value.

In that scenario, the object would be written always on the primary
cluster, and read on both clusters.
In case of failure all the writes would be done on the active cluster, with
the primary-cluster updated to the new primary.

&gt;From your explanation on the post commit hook I understand that I will need
a message queue between the cluster, in order to free the hook as fast as
possible, and to not lose any updates in case of crash of one cluster.


Simon


On Tue, Apr 9, 2013 at 3:55 AM, Ryan Zezeski  wrote:

&gt; Simon,
&gt;
&gt;
&gt; On Mon, Apr 8, 2013 at 7:14 PM, Simon Majou  wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I want to sync a bucket of a first cluster with the bucket of a second
&gt;&gt; cluster. To do that I think using the post commit hook.
&gt;&gt;
&gt;
&gt; If you didn't know, this is exactly what Riak Enterprise was built to do.
&gt; I.e. handle multi-cluster replication. However, if you want to give it a
&gt; go on your own a post-commit hook is one way to get the job done. You'll
&gt; want to think through failure scenarios where the receiving cluster is down
&gt; and how to deal with msgs that are dropped between clusters. The
&gt; post-commit hook runs on a process called the "coordinator", there is a
&gt; coordinator for every incoming request. So you won't block the vnodes,
&gt; which is important, but the client/user request will block until your
&gt; post-commit returns.
&gt;
&gt;
&gt;&gt;
&gt;&gt; Is there any risk that the sequence of PUTs to be mixed in such a
&gt;&gt; scenario ?
&gt;&gt;
&gt;
&gt; Do you mean the sequence seen on cluster A vs. cluster B? Are you asking
&gt; if the object could appear to be on B before A even though the PUT was sent
&gt; to A? The answer is, it depends. With a healthy system it's probably
&gt; unlikely but it will depend on your DW values and state of each cluster.
&gt; E.g. if cluster A nodes get slow disk I/O then perhaps the replication to
&gt; cluster B could beat writes on A. If we start introducing node and network
&gt; failures, or changing W/DW values then things can get more complicated.
&gt; You could have success on cluster A, fire replica to cluster B, all
&gt; primary nodes for that object on cluster A die, now cluster B will have a
&gt; key for which cluster A says not\_found (well, not totally true, depends on
&gt; your PR value).
&gt;
&gt; -Z
&gt;
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

