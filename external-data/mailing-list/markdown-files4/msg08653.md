---
title: "Re: Riak storage backend change"
description: ""
project: community
lastmod: 2012-09-23T06:30:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08653"
mailinglist_parent_id: "msg08651"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-09-23T06:30:15-07:00
---


Hi,

Those settings in the multi backend are solely for the storage layer
and will not affect the bucket properties. You will have to set the
default quorums via a normal curl command (or through your
programmatic client).

On Sun, Sep 23, 2012 at 5:41 AM, hs raghu  wrote:
&gt; Hi,
&gt;
&gt; I have query related to Riak storage backend change for buckets.
&gt;
&gt; In my setup I have defined different storage backends, mainly
&gt; differentiated based on r,w,dw values.
&gt;
&gt; I created a bucket using HTTP api (it used default 'bitcask\_mult'
&gt; backend).
&gt;
&gt; %% Storage\_backend specifies the Erlang module defining the
&gt; storage
&gt; %% mechanism that will be used on this node.
&gt; {storage\_backend, riak\_kv\_multi\_backend},
&gt;
&gt; %% Adding multi backend storage related plugins
&gt; {multi\_backend\_default, &lt;&lt;"bitcask\_mult"&gt;&gt;},
&gt; {multi\_backend, [
&gt;
&gt; %% individual backends
&gt; {&lt;&lt;"bitcask\_mult"&gt;&gt;, riak\_kv\_bitcask\_backend, [
&gt; %% bitcask configuration
&gt; {data\_root, "./data/bitcask"},
&gt; {open\_timeout, 4},
&gt; {sync\_strategy, {seconds, 60}},
&gt; {max\_file\_size, 16#80000000},
&gt; {merge\_window, {6, 7}},
&gt; {frag\_merge\_trigger, 60},
&gt; {dead\_bytes\_merge\_trigger, 536870912},
&gt; {max\_fold\_age, -1},
&gt; {max\_fold\_puts, 0},
&gt; {expiry\_secs, 86400}
&gt; ]},
&gt;
&gt; {&lt;&lt;"bitcask\_mult\_l"&gt;&gt;, riak\_kv\_bitcask\_backend, [
&gt; %% bitcask configuration
&gt; {data\_root, "./data/bitcask\_l"},
&gt; {open\_timeout, 4},
&gt; {n\_val,3},
&gt; {r,1},
&gt; {w,1},
&gt; {dw,1},
&gt; {allow\_mult,true},
&gt; {last\_write\_wins,false},
&gt; {sync\_strategy, {seconds, 10}},
&gt; {max\_file\_size, 16#80000000},
&gt; {merge\_window, {6, 7}},
&gt; {frag\_merge\_trigger, 60},
&gt; {dead\_bytes\_merge\_trigger, 536870912},
&gt; {max\_fold\_age, -1},
&gt; {max\_fold\_puts, 0},
&gt; {expiry\_secs, 86400}
&gt; ]},
&gt;
&gt;
&gt; So when I get bucket it shows all the default properties such as
&gt; "r":"quorum", "w":"quorum", etc ..
&gt; I changed the storage backend for the bucket to 'bitcask\_mult\_l' which
&gt; has different values for r:1,w:1,dw:1, etc.
&gt;
&gt; After changing the backend I restarted node (all the nodes on cluster).
&gt; However, I am still getting the old quorum values ...
&gt; so my queries are:
&gt;
&gt; 1. Is there something missing in configuration?
&gt; 2. Do I have to specifically update (bucket properties with) all the
&gt; quorum and other properties of new storage backend
&gt; (manually/programatically) ?
&gt; 3. What is the proper way of configuring multiple buckets with respective
&gt; storage backends?
&gt;
&gt; Any help or pointer is highly appreciated.
&gt;
&gt; Command used to change bucket backend:
&gt;
&gt;&gt; curl -X PUT -H "Content-Type: application/json" \
&gt;&gt; -d '{"props":{"backend":"bitcask\_mult\_l"}}' \
&gt;&gt; http://localhost:8098/riak/test
&gt;
&gt; Result show old/stale quorum related properties:
&gt;
&gt; &gt; curl http://192.168.21.201:8098/riak/test
&gt; {"props":{"allow\_mult":false,"backend":"bitcask\_mult\_l","basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"test","notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":"quorum","rw":"quorum","search":false,"small\_vclock":50,"w":"quorum","young\_vclock":20}}
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;



-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

