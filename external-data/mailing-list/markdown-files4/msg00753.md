---
title: "Re: Riak 0.11.0 hanging on OSX 10.6"
description: ""
project: community
lastmod: 2010-07-20T11:11:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00753"
mailinglist_parent_id: "msg00752"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-07-20T11:11:58-07:00
---


Yes, this shows the maximum allowed open files:
open files (-n) 1024


Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Tue, Jul 20, 2010 at 11:10 AM, Chris Dawson  wrote:

&gt; This returns:
&gt;
&gt; Chris-Dawsons-MacBook-Pro:riak-0.11.0-osx-x86\_64 xrdawson$ ulimit -a
&gt; core file size (blocks, -c) 0
&gt; data seg size (kbytes, -d) unlimited
&gt; file size (blocks, -f) unlimited
&gt; max locked memory (kbytes, -l) unlimited
&gt; max memory size (kbytes, -m) unlimited
&gt; open files (-n) 1024
&gt; pipe size (512 bytes, -p) 1
&gt; stack size (kbytes, -s) 8192
&gt; cpu time (seconds, -t) unlimited
&gt; max user processes (-u) 266
&gt; virtual memory (kbytes, -v) unlimited
&gt;
&gt; I'm assuming this is OK, because what we wanted was open file handles,
&gt; right?
&gt;
&gt; Chris
&gt;
&gt;
&gt; On Tue, Jul 20, 2010 at 11:00 AM, Dan Reverri  wrote:
&gt;
&gt;&gt; Hi Chris,
&gt;&gt;
&gt;&gt; Can you try "ulimit -a"?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Dan
&gt;&gt;
&gt;&gt; Daniel Reverri
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Jul 20, 2010 at 10:53 AM, Chris Dawson wrote:
&gt;&gt;
&gt;&gt;&gt; I believe I have been having the same problem, so I appreciate this
&gt;&gt;&gt; information.
&gt;&gt;&gt;
&gt;&gt;&gt; When I run ulimit on my machine I get "unlimited." Is this acceptable?
&gt;&gt;&gt; I ran ulimit -n 1024, and even after that it still returns unlimited.
&gt;&gt;&gt;
&gt;&gt;&gt; Chris
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon, Jul 19, 2010 at 6:40 AM, Shane Holloway &gt;&gt; &gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks -- ulimit -n 1024 fixed my problem. It's wonderfully stable now
&gt;&gt;&gt;&gt; -- even under high load.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Jul 19, 2010, at 2:30 AM, Daniel Reverri wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Shane,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Can you try increasing the number of allowed open file handles on your
&gt;&gt;&gt;&gt; system?
&gt;&gt;&gt;&gt; ulimit -n 1024
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; You can check this setting from a riak console by typing:
&gt;&gt;&gt;&gt; os:cmd("ulimit -a").
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; Dan
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Sent from my iPhone
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Jul 18, 2010, at 10:32 PM, Shane Holloway 
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I'm having a bit of a problem with Riak. When I keep my new documents
&gt;&gt;&gt;&gt; to about 10 per second, Riak works fine. But as I increase my speed to
&gt;&gt;&gt;&gt; about 100 docs per second, Riak gets dramatically slow. After a while, the
&gt;&gt;&gt;&gt; beam process takes 100% of my CPU and no longer responds to ping/stop or 
&gt;&gt;&gt;&gt; any
&gt;&gt;&gt;&gt; other command from the bin folder. I end up sending kill TERM to stop the
&gt;&gt;&gt;&gt; process.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If I restart Riak, the bitcask backend seems to be limited to about 1-2
&gt;&gt;&gt;&gt; document stores per second, but read seems fairly responsive still. I'd
&gt;&gt;&gt;&gt; appreciate any thoughts or troubleshooting tips you may have. It's an
&gt;&gt;&gt;&gt; in-development database with demo data, so I can run any experiments you'd
&gt;&gt;&gt;&gt; like to see.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; -Shane
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Riak/riakOne% ./bin/riak-admin status
&gt;&gt;&gt;&gt; 1-minute stats for 'r...@172.20.0.49'
&gt;&gt;&gt;&gt; -------------------------------------------
&gt;&gt;&gt;&gt; vnode gets : 104
&gt;&gt;&gt;&gt; vnode\_puts : 103
&gt;&gt;&gt;&gt; vnode\_gets\_total : 136
&gt;&gt;&gt;&gt; vnode\_puts\_total : 127
&gt;&gt;&gt;&gt; node\_gets : 36
&gt;&gt;&gt;&gt; node\_gets\_total : 47
&gt;&gt;&gt;&gt; node\_get\_fsm\_time\_mean : 2635.1111111111113
&gt;&gt;&gt;&gt; node\_get\_fsm\_time\_median : 667
&gt;&gt;&gt;&gt; node\_get\_fsm\_time\_95 : 9156
&gt;&gt;&gt;&gt; node\_get\_fsm\_time\_99 : 40652
&gt;&gt;&gt;&gt; node\_get\_fsm\_time\_100 : 40652
&gt;&gt;&gt;&gt; node\_puts : 36
&gt;&gt;&gt;&gt; node\_puts\_total : 44
&gt;&gt;&gt;&gt; \*node\_put\_fsm\_time\_mean : 1670575.611111111\*
&gt;&gt;&gt;&gt; \*node\_put\_fsm\_time\_median : 1157\*
&gt;&gt;&gt;&gt; \*node\_put\_fsm\_time\_95 : 23900\*
&gt;&gt;&gt;&gt; \*node\_put\_fsm\_time\_99 : 60000511\*
&gt;&gt;&gt;&gt; \*node\_put\_fsm\_time\_100 : 600005\*11
&gt;&gt;&gt;&gt; cpu\_nprocs : 0
&gt;&gt;&gt;&gt; cpu\_avg1 : 0
&gt;&gt;&gt;&gt; cpu\_avg5 : 0
&gt;&gt;&gt;&gt; cpu\_avg15 : 0
&gt;&gt;&gt;&gt; mem\_total : 0
&gt;&gt;&gt;&gt; mem\_allocated : 0
&gt;&gt;&gt;&gt; \*disk : [{"none",0,0}]\*
&gt;&gt;&gt;&gt; nodename : 'r...@172.20.0.49'
&gt;&gt;&gt;&gt; connected\_nodes : ['riak\_maint\_61...@172.20.0.49']
&gt;&gt;&gt;&gt; sys\_driver\_version : &lt;&lt;"1.5"&gt;&gt;
&gt;&gt;&gt;&gt; sys\_global\_heaps\_size : 0
&gt;&gt;&gt;&gt; sys\_heap\_type : private
&gt;&gt;&gt;&gt; sys\_logical\_processors : 2
&gt;&gt;&gt;&gt; sys\_otp\_release : &lt;&lt;"R13B04"&gt;&gt;
&gt;&gt;&gt;&gt; sys\_process\_count : 167
&gt;&gt;&gt;&gt; sys\_smp\_support : true
&gt;&gt;&gt;&gt; sys\_system\_version : &lt;&lt;"Erlang R13B04 (erts-5.7.5) [source] [64-bit]
&gt;&gt;&gt;&gt; [smp:2:2] [rq:2] [async-threads:5] [hipe] [kernel-poll:true]\n"&gt;&gt;
&gt;&gt;&gt;&gt; sys\_system\_architecture : &lt;&lt;"i386-apple-darwin9.4.0"&gt;&gt;
&gt;&gt;&gt;&gt; sys\_threads\_enabled : true
&gt;&gt;&gt;&gt; sys\_thread\_pool\_size : 5
&gt;&gt;&gt;&gt; sys\_wordsize : 8
&gt;&gt;&gt;&gt; ring\_members : ['r...@172.20.0.49']
&gt;&gt;&gt;&gt; ring\_num\_partitions : 64
&gt;&gt;&gt;&gt; ring\_ownership : &lt;&lt;"[{'r...@172.20.0.49',64}]"&gt;&gt;
&gt;&gt;&gt;&gt; ring\_creation\_size : 64
&gt;&gt;&gt;&gt; storage\_backend : riak\_kv\_bitcask\_backend
&gt;&gt;&gt;&gt; pbc\_connects\_total : 0
&gt;&gt;&gt;&gt; pbc\_connects : 0
&gt;&gt;&gt;&gt; pbc\_active : 0
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Chris Dawson
&gt;&gt;&gt; 971-533-8335
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Chris Dawson
&gt; 971-533-8335
&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

