---
title: "Re: Riak search fails to index via riakc_pb client"
description: ""
project: community
lastmod: 2014-03-31T08:20:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13955"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2014-03-31T08:20:08-07:00
---


&gt;
&gt; Index via the erlang client (error)
&gt;
&gt; ===================================
&gt;
&gt; Eshell V5.9.2 (abort with ^G)
&gt; 1&gt; {ok, Conn} = riakc\_pb\_socket:start\_link("localhost", 8087).
&gt; {ok,&lt;0.34.0&gt;}
&gt; 2&gt; Body = &lt;&lt;"{\"name\_s\":\"tom\"}"&gt;&gt;.
&gt; &lt;&lt;"{\"name\_s\":\"tom\"}"&gt;&gt;
&gt; 3&gt; Object2Store = 
&gt; riakc\_obj:new({&lt;&lt;"testtype"&gt;&gt;,&lt;&lt;"somebucket"&gt;&gt;},&lt;&lt;"00001"&gt;&gt;,Body).
&gt;
&gt; {riakc\_obj,{&lt;&lt;"testtype"&gt;&gt;,&lt;&lt;"somebucket"&gt;&gt;},
&gt; &lt;&lt;"00002"&gt;&gt;,undefined,[],undefined,
&gt; &lt;&lt;"{\"name\_s\":\"tom\"}"&gt;&gt;}
&gt; 4&gt; ok = riakc\_pb\_socket:put(Conn,Object2Store).
&gt; ok
&gt;
&gt; The object is stored (in riak), but not indexed (in solr):
&gt; $ curl "http://localhost:8098/types/testtype/buckets/somebucket/keys/
&gt; 00001"
&gt; {"name\_s":"tom"}
&gt;
&gt; ==&gt; /../riak-yokozuna-0.14.0-src/rel/riak/log/console.log &lt;==
&gt; 2014-03-31 16:26:11.568 [error] &lt;0.1448.0&gt;@yz\_kv:index:204 failed to
&gt; index object {{&lt;&lt;"testtype"&gt;&gt;,&lt;&lt;"somebucket"&gt;&gt;},&lt;&lt;"00001"&gt;&gt;} with error
&gt; badarg because
&gt; [{dict,fetch,[&lt;&lt;"content-type"&gt;&gt;,{dict,4,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[[&lt;&lt;"dot"&gt;&gt;|{&lt;&lt;35,9,254,249,83,57,16,45&gt;&gt;,{1,63563491571}}]],[],[],[],[],[],[[&lt;&lt;"X-Riak-VTag"&gt;&gt;,53,117,84,48,117,57,84,88,70,88,98,79,53,77,77,76,103,67,102,55,100,74]],[[&lt;&lt;"index"&gt;&gt;]],[],[[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|{1396,272371,362491}]],[],[]}}}],[{file,"dict.erl"},{line,125}]},{yz\_doc,extract\_fields,1,[{file,"src/yz\_doc.erl"},{line,99}]},{yz\_doc,make\_doc,5,[{file,"src/yz\_doc.erl"},{line,71}]},{yz\_doc,'-make\_docs/4-lc$^0/1-0-',5,[{file,"src/yz\_doc.erl"},{line,60}]},{yz\_kv,index,7,[{file,"src/yz\_kv.erl"},{line,249}]},{yz\_kv,index,3,[{file,"src/yz\_kv.erl"},{line,191}]},{riak\_kv\_vnode,actual\_put,6,[{file,"src/riak\_kv\_vnode.erl"},{line,1391}]},{riak\_kv\_vnode,perform\_put,3,[{file,"src/riak\_kv\_vnode.erl"},{line,1380}]}]
&gt;

You failed to provide a content-type when building the object. It's
not easy to see if you aren't used to Erlang but the error in the log
shows a failure to find the key &lt;&lt;"content-type"&gt;&gt; in the object's
metadata.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

