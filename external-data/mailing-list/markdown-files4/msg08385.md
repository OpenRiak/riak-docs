---
title: "Re: rik loading taking huge time?any suggestion for betterment"
description: ""
project: community
lastmod: 2012-08-28T10:58:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08385"
mailinglist_parent_id: "msg08384"
author_name: "Mike Oxford"
project_section: "mailinglistitem"
sent_date: 2012-08-28T10:58:36-07:00
---


Oh, also, your logging is going to cause a HUGE performance hit, especially
if that machine is one of the Riak nodes. Too much disk and IO thrash.

-mox

On Tue, Aug 28, 2012 at 10:56 AM, Mike Oxford  wrote:

&gt; Use the https://github.com/basho/riak-erlang-client directly, instead of
&gt; calling os:cmd and pushing through CURL.
&gt; You can also parallelize it at that time, because right now you're doing
&gt; 25million os:cmd calls and making 25million curl calls. Open up a pool of
&gt; connections (or even just N and round-robin them) and keep them open.
&gt;
&gt; A 2-node cluster will have 1/3 of the set on one machine, and 2/3 on the
&gt; other. You may consider moving to N=2 on the bucket, which will put one
&gt; copy on each machine (eg, dual-master.)
&gt;
&gt; Beyond that, you have not provided enough information as to where the
&gt; bottleneck may be, though I'm sure the Basho crew will have some better
&gt; better answers. :)
&gt;
&gt; -mox
&gt;
&gt;
&gt; On Mon, Aug 27, 2012 at 8:26 PM, wrote:
&gt;
&gt;&gt; Dear team,
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I am trying to load 25 million dataset (1.3 Gb) of sample call data
&gt;&gt; onto riak..its a 4-quad core ---1.5 TB storage 2-node raik cluster…takes
&gt;&gt; real 5671m12.812s.please suggest the solutions for the betterment of
&gt;&gt; the same…5671m12.812s is quite huge…we deal with bigdata and I need to
&gt;&gt; store and test 165 GB on the riak..if so I may take years for loading I
&gt;&gt; guess with the present scenario…loaded 165 GB on to mongodb and got the
&gt;&gt; results..for \*comparative performance study of mongodb and riak db\* …please 
&gt;&gt; do assist me with the same .
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \*using the following code for loading :\*
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; #!/usr/local/bin/escript
&gt;&gt;
&gt;&gt; main([Filename]) -&gt;
&gt;&gt;
&gt;&gt; {ok, Data} = file:read\_file(Filename),
&gt;&gt;
&gt;&gt; Lines = tl(re:split(Data, "\r?\n", [{return, binary},trim])),
&gt;&gt;
&gt;&gt; lists:foreach(fun(L) -&gt; LS = re:split(L, ","), format\_and\_insert(LS)
&gt;&gt; end, Lines).
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; format\_and\_insert(Line) -&gt;
&gt;&gt;
&gt;&gt; JSON =
&gt;&gt; io\_lib:format("{\"id\":\"~s\",\"phonenumber\":~s,\"callednumber\":~s,\"starttime\":~s,\"endtime\":~s,\"status\":~s}",
&gt;&gt; Line),
&gt;&gt;
&gt;&gt; Command = io\_lib:format("curl -X PUT
&gt;&gt; http://10.232.5.169:8098/riak/CustCalls25m/~s -d '~s' -H 'content-type:
&gt;&gt; application/json'", [hd(Line),JSON]),
&gt;&gt;
&gt;&gt; io:format("Inserting: ~s~n", [hd(Line)]),
&gt;&gt;
&gt;&gt; os:cmd(Command).
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \*[hadoop@CTSINGMRGTO data]$ time ./load\_data25m CustCalls25m.csv &gt;&gt;
&gt;&gt; 25m.txt &\*
&gt;&gt;
&gt;&gt; [3] 32354
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; [hadoop@CTSINGMRGTO data]$
&gt;&gt;
&gt;&gt; \*real 5671m12.812s\*
&gt;&gt;
&gt;&gt; user 1725m31.862s
&gt;&gt;
&gt;&gt; sys 3074m42.135s
&gt;&gt;
&gt;&gt; [hadoop@CTSINGMRGTO data]$
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; [hadoop@CTSINGMRGTO data]$ tail -4 25m.txt
&gt;&gt;
&gt;&gt; Inserting: 24999997
&gt;&gt;
&gt;&gt; Inserting: 24999998
&gt;&gt;
&gt;&gt; Inserting: 24999999
&gt;&gt;
&gt;&gt; \*Inserting: 25000000\*
&gt;&gt;
&gt;&gt; [hadoop@CTSINGMRGTO data]$
&gt;&gt;
&gt;&gt;
&gt;&gt; This e-mail and any files transmitted with it are for the sole use of
&gt;&gt; the intended recipient(s) and may contain confidential and privileged
&gt;&gt; information. If you are not the intended recipient(s), please reply to the
&gt;&gt; sender and destroy all copies of the original message. Any unauthorized
&gt;&gt; review, use, disclosure, dissemination, forwarding, printing or copying of
&gt;&gt; this email, and/or any action taken in reliance on the contents of this
&gt;&gt; e-mail is strictly prohibited and may be unlawful.
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

