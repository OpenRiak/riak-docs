---
title: "Re: key garbage collection"
description: ""
project: community
lastmod: 2011-11-03T10:52:01-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05435"
mailinglist_parent_id: "msg05432"
author_name: "Justin Karneges"
project_section: "mailinglistitem"
sent_date: 2011-11-03T10:52:01-07:00
---


On Thursday, November 03, 2011 12:49:06 AM you wrote:
&gt; On Thu, Nov 3, 2011 at 02:39, Justin Karneges  wrote:
&gt; &gt; So far so good. Now for handling cleanup. Periodically, we scan the
&gt; &gt; "cleanup" bucket for keys to process. Since keys only exist in this
&gt; &gt; bucket at the moment of a write (they are deleted immediately
&gt; &gt; afterwards), in practice there should hardly be any keys in here at any
&gt; &gt; single point in time. We're talking single digits here. Much better
&gt; &gt; than a full db scan to find garbage keys. Also, the keys to process can
&gt; &gt; be narrowed down by time (e.g. &gt; 5 minutes ago) based on the key name.
&gt; 
&gt; This will minimize your scans, but not eliminate them. You may not be
&gt; able to write to the "cleanup" bucket because you've lost all network
&gt; connectivity to the Riak cluster. Not a bad assumption, given that you
&gt; could not write out B (what makes you think you could write to
&gt; "cleanup"?).

The cleanup key is written first. If that write fails to acknowledge, then the 
overall write process would abort. It should not be possible to have only the 
A key and no cleanup key.

Justin

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

