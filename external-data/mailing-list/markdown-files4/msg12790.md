---
title: "Re: Import big data to Riak"
description: ""
project: community
lastmod: 2013-10-29T08:34:42-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12790"
mailinglist_parent_id: "msg12789"
author_name: "Georgi Ivanov"
project_section: "mailinglistitem"
sent_date: 2013-10-29T08:34:42-07:00
---


Hi and thank you for the reply. My comment follow:

&gt; Your tests are not close to what you are going to have in production
My tests are exactly what we will have in production. 1 node or in best case 2 
nodes.
We don't care about durability here. Our request per second will be extremely 
low too(300 per day ?)
&gt; IMHO, here are few recommendations:
&gt; 
&gt; 1. Build a cluster with at least 5 nodes with N=3 and R=W=2 (You can
&gt; update your bucket properties via PBC with Java)
&gt; 2. Use PBC instead of HTTP.
Hmm i ran some tests that showed that PBC is slower. Keep in mind that the 
import script is working on the same node as riak .
Also we use 2i indexes. 
The docs say that 2i is emulated using PBC (Whatever that means). Dunno if 
this is a problem .

Secondary Indexes (emulated, native) ✓✗

I will try this tho...
&gt; 3. If you are only importing data call
&gt; .store()....withoutFetch().execute() to avoid unnecessary roundtrips.
I already do this.
The problem goes deeper as i am not only inserting but also updating some 
keys. 
I.e. :
 1.Fetch 
 2.Merge results
 3.Store back


&gt; 
&gt; If you test using unrealistic scenarios you will find unpleasant
&gt; surprises when you are about to be go live so better to set your
&gt; expectations right at the beginning.
&gt; 
&gt; HTH,
&gt; 
&gt; Guido.
&gt; 
&gt; On 29/10/13 14:59, Georgi Ivanov wrote:
&gt; &gt; Hello,
&gt; &gt; I am importing some big data to Riak.
&gt; &gt; I am importing like 10GB per day and i have to import one year of data.
&gt; &gt; The task is to speed up the initial import. After that i will import on
&gt; &gt; daily basis, so the speed is not very important.
&gt; &gt; 
&gt; &gt; I am using JAVA HTTP client. So far my test show that the fastest setup is
&gt; &gt; to use n\_val 1 and import to single server.
&gt; &gt; 
&gt; &gt; I tested importing on 2 servers (with n\_val:2), but it is actually slower.
&gt; &gt; My JAVA client is multi-threaded.
&gt; &gt; 
&gt; &gt; My idea is to use n\_val:1 on single node, then increase the n\_val:2 and
&gt; &gt; add
&gt; &gt; one more node to the cluster. The problem is that i don't see the storage
&gt; &gt; to grow when i change n\_val : 2
&gt; &gt; I was looking at Riak Active Anti-Entropy feature and i am expecting my
&gt; &gt; storage to grow after i increase the n\_val. Unfortunately this is not the
&gt; &gt; case or i don't understand AAE feature ....
&gt; &gt; I can't any changes in storage size at all. I don't want to go in
&gt; &gt; direction of force repair as it would take forever.
&gt; &gt; 
&gt; &gt; Can anyone shed some light on AAE ? Or any tips for speeding up the import
&gt; &gt; in general.
&gt; &gt; 
&gt; &gt; To summarize the situation :
&gt; &gt; 1. One Riak node with n\_val : 1 , eLevelDb as back-end
&gt; &gt; 2. Import data.
&gt; &gt; 3. Change n\_val to 2
&gt; &gt; 4. Join one more node to the cluster.
&gt; &gt; 
&gt; &gt; What i expect to happen :
&gt; &gt; To have all the keys distributed to 2 riak nodes with n\_val:2
&gt; &gt; So if i had 1TB of data on node1 with n\_val:1 , after changing to n\_val 2
&gt; &gt; and joining one more node, to have 1TB of data on each node.
&gt; &gt; 
&gt; &gt; 
&gt; &gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

