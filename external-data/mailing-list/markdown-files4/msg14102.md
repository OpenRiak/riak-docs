---
title: "Re: Socket returned short packet length 0 - expected 4"
description: ""
project: community
lastmod: 2014-04-16T13:39:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14102"
mailinglist_parent_id: "msg14101"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2014-04-16T13:39:06-07:00
---


Hi Jason,

We usually see these errors when someone connects to the HTTP port instead
of the PB port. First, check that your client is configured correctly.
Also, please check the server logs for any crashes related to
riak\_api\_pb\_server, and paste those here if present.

It is also conceivable this could occur if the socket were closed before
anything were sent, that is, the read buffer on it is empty, so it returns
0. I don't know of any specific reason that might happen unless you are
using haproxy between the client and the server (see related PR/issue
https://github.com/basho/riak\_api/pull/54).


On Tue, Apr 15, 2014 at 6:34 PM, Jason Wang  wrote:

&gt; HI all,
&gt;
&gt; In production, we are experiencing "Socket returned short packet length 0
&gt; - expected 4" exceptions whenever we try to store an object &gt;20K in size.
&gt; In addition, the exception typically takes over 60 seconds to manifest. The
&gt; content of each object is an bytearray.
&gt;
&gt; Any idea what could be causing this exception?
&gt;
&gt; Other details:
&gt; Library: Python
&gt; Version: riak==2.0.1, riak-pb==1.4.1.1
&gt; Protocol: pbc
&gt; Steps to reproduce: N/A. This only happens in production, not on dev
&gt; machines.
&gt;
&gt; Thanks in advance,
&gt;
&gt; Jason
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

