---
title: "Re: {error,<<\"{precommit_fail,notfound}\">>}"
description: ""
project: community
lastmod: 2010-12-15T06:50:46-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01795"
mailinglist_parent_id: "msg01792"
author_name: "Joseph Lambert"
project_section: "mailinglistitem"
sent_date: 2010-12-15T06:50:46-08:00
---


You need to add the hook before you add the objects you want indexed when
inserting KV data. The precommit hook is what triggers the indexing of the
objects. If it's not installed when you insert an object, it's not going to
index it.

&gt;From the wiki:

"Riak Search indexing of KV data must be enabled on a per-KV-bucket basis.
To enable indexing for a bucket, simply add the Search precommit hook to
that bucket's properties"

"With the precommit hook installed, Riak Search will index your data each
time that data is written"

I believe the delete is failing because it can't find the value in the
index, so the precommit hook returns {precommit\_fail,notfound} error (since
a delete updates the meta data of the object).

If you want to see index data, the index buckets start are named like \_rsid\_
\*bucketname\*, where bucketname is the bucket you install the hook on.

- Joe Lambert

joseph.g.lamb...@gmail.com


On Wed, Dec 15, 2010 at 7:12 PM, Xiaopong Tran wrote:

&gt; I installed Riak Search, added a few JSON docs, then install the
&gt; search hook for the bucket. Now, here are the questions:
&gt;
&gt; 1) How can I list the indexes that have been created
&gt; for my bucket?
&gt;
&gt; 2) After installing the hook, I can't delete my object
&gt; anymore. Here is the error:
&gt;
&gt; 7&gt; {ok, P} = test3:init().
&gt; {ok,&lt;0.44.0&gt;}
&gt; 8&gt; riakc\_pb\_socket:get(P, "user\_bucket", "jane").
&gt; {ok,{riakc\_obj,"user\_bucket","jane",
&gt;
&gt; &lt;&lt;107,206,97,96,96,96,204,96,202,5,82,44,108,85,66,103,50,
&gt; 152,18,25,243,88,25,...&gt;&gt;,
&gt; [{{dict,3,16,16,8,80,48,
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt; {{[],[],[],[],[],[],[],[],[],[],...}}},
&gt; &lt;&lt;"{\"userid\":\"jane\",\"first\_name\":\"Jane\",
&gt; \"last\_name\":\"Doe\",\"gender\":\"F\",\"joined\_"...&gt;&gt;}],
&gt; undefined,undefined}}
&gt; 9&gt; riakc\_pb\_socket:delete(P, "user\_bucket", "jane").
&gt; {error,&lt;&lt;"{precommit\_fail,notfound}"&gt;&gt;}
&gt; 10&gt; riakc\_pb\_socket:delete(P, "user\_bucket", &lt;&lt;"jane"&gt;&gt;).
&gt; {error,&lt;&lt;"{precommit\_fail,notfound}"&gt;&gt;}
&gt;
&gt; I can retrieve the object, but can't delete it. What's is going on?
&gt;
&gt; Thanks
&gt;
&gt; Xiaopong
&gt;
&gt;
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

