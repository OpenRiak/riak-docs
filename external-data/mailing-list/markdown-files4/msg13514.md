---
title: "Re: using salt stack with riak"
description: ""
project: community
lastmod: 2014-01-28T08:28:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13514"
mailinglist_parent_id: "msg13474"
author_name: "Matt Davis"
project_section: "mailinglistitem"
sent_date: 2014-01-28T08:28:16-08:00
---


Cool Matt, looks very similar to what I've got! We're also using pillar,
which helps a great deal when cross-referencing riak packages needed for
riak-cs.


On Thu, Jan 23, 2014 at 3:56 PM, Matt Black wrote:

&gt; This state is meat of it, and should be pretty self-explanatory if you're
&gt; already writing Salt states..
&gt;
&gt; riak-ulimit-pam:
&gt; file.append:
&gt; - name: /etc/pam.d/common-session
&gt; - text: "session\trequired\tpam\_limits.so"
&gt;
&gt; riak-ulimit-pam-noninteractive:
&gt; file.append:
&gt; - name: /etc/pam.d/common-session-noninteractive
&gt; - text: "session\trequired\tpam\_limits.so"
&gt;
&gt; riak-ulimit:
&gt; file.append:
&gt; - name: /etc/security/limits.conf
&gt; - text:
&gt; - "riak soft nofile 65536"
&gt; - "riak hard nofile 65536"
&gt; - require:
&gt; - file: riak-ulimit-pam
&gt;
&gt; python-software-properties:
&gt; pkg.installed
&gt;
&gt; basho-pkgrepo:
&gt; pkgrepo.managed:
&gt; - humanname: Basho PPA
&gt; - name: deb http://apt.basho.com precise main
&gt; - file: /etc/apt/sources.list.d/basho.list
&gt; - key\_url: http://apt.basho.com/gpg/basho.apt.key
&gt; - require:
&gt; - pkg: python-software-properties
&gt;
&gt; riak:
&gt; pkg.installed:
&gt; - version: 1.4.2-1
&gt; - require:
&gt; - pkgrepo: basho-pkgrepo
&gt; riak.running:
&gt; - require:
&gt; - pkg: riak
&gt; - file: /etc/riak/app.config
&gt; - file: /etc/riak/vm.args
&gt; - file: riak-ulimit
&gt;
&gt; /etc/riak/app.config:
&gt; file.managed:
&gt; - source: salt://riak/app.config
&gt; - mode: 644
&gt; - template: jinja
&gt; - require:
&gt; - pkg: riak
&gt; - defaults:
&gt; internal\_ip: {{ salt['cmd.exec\_code']('bash', 'hostname -I') }}
&gt;
&gt; /etc/riak/vm.args:
&gt; file.managed:
&gt; - source: salt://riak/vm.args
&gt; - mode: 644
&gt; - template: jinja
&gt; - require:
&gt; - pkg: riak
&gt; - defaults:
&gt; internal\_ip: {{ salt['cmd.exec\_code']('bash', 'hostname -I') }}
&gt;
&gt;
&gt;
&gt; On 24 January 2014 04:22, Matt Davis  wrote:
&gt;
&gt;&gt; Nicely done Matt! Sure would love to see your states... I've got a fairly
&gt;&gt; good one for riak-cs, would love to see some others.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Jan 22, 2014 at 2:14 PM, Matt Black wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Matt,
&gt;&gt;&gt;
&gt;&gt;&gt; We manage all our Riak infrastructure with a couple of Salt states and a
&gt;&gt;&gt; custom module I wrote which you can see here:
&gt;&gt;&gt;
&gt;&gt;&gt; https://github.com/saltstack/salt-contrib/blob/master/modules/riak.py
&gt;&gt;&gt;
&gt;&gt;&gt; There's another Riak module in Salt core, but last time I checked it had
&gt;&gt;&gt; less functionality. (I talked with them a while back about merging the two
&gt;&gt;&gt; modules - perhaps I should bring that up again).
&gt;&gt;&gt;
&gt;&gt;&gt; I can send our Salt states as well, if you're interested :)
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 23 January 2014 07:05, Matt Davis  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hey all,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; We're implementing salt stack for configuration management, and I've
&gt;&gt;&gt;&gt; been trying out how it works with riak, specifically remote command
&gt;&gt;&gt;&gt; execution.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Anyone out there in riak-land been successfully integrating it with
&gt;&gt;&gt;&gt; salt?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've hit a couple of "arroo?" moments and am curious what others have
&gt;&gt;&gt;&gt; experienced.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -matt
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

