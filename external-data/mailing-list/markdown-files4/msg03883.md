---
title: "Re: mr_queue gone wild"
description: ""
project: community
lastmod: 2011-06-30T13:52:29-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03883"
mailinglist_parent_id: "msg03859"
author_name: "Sylvain Niles"
project_section: "mailinglistitem"
sent_date: 2011-06-30T13:52:29-07:00
---


So I backrev'd everything to: Erlang R13B04, Riak 0.14.2 (no riak
search) and got rid of any functionality using search. After importing
the 7k objects the bitcask dir is ~41MB. Starting up our app
everything works fine until a worker starts updating objects with new
values at the rate of about 1-2/second. It finds those objects via a
map function that looks for one json integer and compares it with an
input (currently with a javascript function but I'm slowly porting
them all to erlang). While this worker is running the mr\_queue
directory grows at about 1MB every 2 minutes, forever. It's my
understanding that pending m/r jobs are persisted to disk in this
directory, but the amount of work is trivial and the mr\_queue never
gets smaller even after we shut down all our workers and leave riak
alone.

Is there a way to list the m/r jobs in the queue in case there's
something else going on? Is there a reason they never get removed?

Thanks in advance,
Sylvain


On Wed, Jun 29, 2011 at 12:59 AM, Mathias Meyer  wrote:
&gt; Sylvain,
&gt;
&gt; you should not be using riak HEAD for anything that's close to your 
&gt; production environment. Development in Riak is in big flux right now, and 
&gt; it'll be hard for us to help you find the specific problem.
&gt;
&gt; Could you please install Riak Search 0.14.2, best with a fresh installation, 
&gt; and try running this setup again to see if you get the same erroneous 
&gt; results? If you do, some more details on your data and the MapReduce jobs 
&gt; you're running would be great to reproduce and figure out the problem.
&gt;
&gt; Mathias Meyer
&gt; Developer Advocate, Basho Technologies
&gt;
&gt;
&gt; On Mittwoch, 29. Juni 2011 at 00:41, Sylvain Niles wrote:
&gt;
&gt;&gt; We recently started trying to move our production environment over to
&gt;&gt; riak and we're seeing some weird behavior that's preventing us from
&gt;&gt; doing so:
&gt;&gt;
&gt;&gt; Running: riak HEAD from github as of last Friday, riak\_search turned
&gt;&gt; on with indexing of the problem bucket "events".
&gt;&gt; When we turn on our processes that start creating objects in the
&gt;&gt; bucket "events", the mr\_queue directory starts growing massively and
&gt;&gt; the riak process starts spending most of its time in io\_wait. With a
&gt;&gt; total of about 7000 objects (each is a ripple document that's got
&gt;&gt; maybe 10-20 lines of text in it) in the events bucket out bitcask dir
&gt;&gt; was ~240MB and the mr\_queue dir was 1.2GB. Something is going horribly
&gt;&gt; wrong.. Our logs only show flow\_timeouts for normal requests trying to
&gt;&gt; do simple map/reduce lookups. Any ideas where to look?
&gt;&gt;
&gt;&gt; Thanks in advance,
&gt;&gt; Sylvain
&gt;&gt;
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;
&gt;

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

