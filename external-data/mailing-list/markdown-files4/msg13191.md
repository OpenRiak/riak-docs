---
title: "2i stopped working on LevelDB with multi backend"
description: ""
project: community
lastmod: 2013-12-10T09:16:40-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13191"
author_name: "Chris Read"
project_section: "mailinglistitem"
sent_date: 2013-12-10T09:16:40-08:00
---


We just rebuilt our test environment (something we do every month) and
suddenly we get the following error when trying to use 2i:

{error,{error,{indexes\_not\_supported,riak\_kv\_multi\_backend}}}

But looking at the properties of the bucket it's set to use leveldb:

# curl -k https://localhost:8069/riak/eleveldb/ | jq .
{
 "props": {
 "young\_vclock": 20,
 "w": "quorum",
 "small\_vclock": 50,
 "rw": "quorum",
 "r": "quorum",
 "linkfun": {
 "fun": "mapreduce\_linkfun",
 "mod": "riak\_kv\_wm\_link\_walker"
 },
 "last\_write\_wins": false,
 "dw": "quorum",
 "chash\_keyfun": {
 "fun": "chash\_std\_keyfun",
 "mod": "riak\_core\_util"
 },
 "big\_vclock": 50,
 "basic\_quorum": false,
 "backend": "eleveldb\_data",
 "allow\_mult": false,
 "n\_val": 3,
 "name": "eleveldb",
 "notfound\_ok": true,
 "old\_vclock": 86400,
 "postcommit": [],
 "pr": 0,
 "precommit": [],
 "pw": 0
 }
}

Here's the relevant app.config snippet:

 {storage\_backend, riak\_kv\_multi\_backend},
 {multi\_backend\_default, &lt;&lt;"bitcask\_data"&gt;&gt;},
 {multi\_backend, [
 {&lt;&lt;"bitcask\_data"&gt;&gt;, riak\_kv\_bitcask\_backend,
[
 {data\_root, "/srv/riak/data/bitcask/data"},
 %%{io\_mode, nif},
 {max\_file\_size, 2147483648}, %% 2G
 {merge\_window, always},
 {frag\_merge\_trigger, 30}, %% Merge
at 30% dead keys
 {dead\_bytes\_merge\_trigger, 134217728}, %% Merge
files that have more than 128MB dead
 {frag\_threshold, 25}, %% Files
that have 25% dead keys will be merged too
 {dead\_bytes\_threshold, 67108864}, %% Include
files that have 64MB of dead space in merges
 {small\_file\_threshold, 10485760}, %% Files
smaller than 100MB will not be merged
 {log\_needs\_merge, true}, %% Log
when we need to merge...
 {sync\_strategy, none}
]

 },
 {&lt;&lt;"eleveldb\_data"&gt;&gt;, riak\_kv\_eleveldb\_backend,
 [{data\_root, "/srv/riak/data/eleveldb/files"},
 {write\_buffer\_size\_min, 31457280 }, %% 30 MB in bytes
 {write\_buffer\_size\_max, 62914560}, %% 60 MB in bytes
 {max\_open\_files, 20}, %% Maximum number of files open
at once per partition
 {sst\_block\_size, 4096}, %% 4K blocks
 {cache\_size, 8388608} %% 8MB default cache size per-partition
 ]

 }
 ]},

Anyone have any ideas?

We're using Ubuntu 12.04 with the Basho Riak 1.4.2 .deb. The only
change to this environment has been to upgrade the kernel from
3.5.0-26 to 3.8.0-31-generic but I'd be very surprised if that broke
2i...

Thanks,

Chris

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

