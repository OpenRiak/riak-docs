---
title: "Riak Cluster Setup on EC2"
description: ""
project: community
lastmod: 2011-02-02T06:54:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02167"
author_name: "Abhishek Kona"
project_section: "mailinglistitem"
sent_date: 2011-02-02T06:54:07-08:00
---



Hi folks

I am trying to set up a Riak cluster on EC2.
Each time I issue a command :

$ sudo riak-admin join riak@10.130.149.253

It fails :

Attempting to restart script through sudo -u riak

Node riak@10.130.149.253 is not reachable!


Netstat on both the machines says the ports are running fine.

netstat -na | egrep '(8087|8098|8099)'

tcp 0 0 0.0.0.0:8098 0.0.0.0:\* LISTEN

tcp 0 0 0.0.0.0:8099 0.0.0.0:\* LISTEN

tcp 0 0 0.0.0.0:8087 0.0.0.0:\* LISTEN


I can telnet to all the ports from each of the machine.
I have been pulling my hair for long but of no avail.
Can any one look and tell me what I am doing wrong.
Are there any debug logs where I can look at what is going wrong?
Is there any EC2 specific trick (like using public hostnames).

I am attaching my app.cfg file for reference.

Thanks
-Abhishek Kona

%% -\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\*-
%% ex: ts=4 sw=4 et
[
%% Riak Core config
{riak\_core, [
 %% Default location of ringstate
 {ring\_state\_dir, "/var/lib/riak/ring"},

 %% http is a list of IP addresses and TCP ports that the Riak
 %% HTTP interface will bind.
 {http, [ {"0.0.0.0", 8098 } ]},

 %% https is a list of IP addresses and TCP ports that the Riak
 %% HTTPS interface will bind.
 %{https, [{ "0.0.0.0", 8098 }]},

 %% default cert and key locations for https can be overridden
 %% with the ssl config variable
 %{ssl, [
 % {certfile, "etc/cert.pem"},
 % {keyfile, "etc/key.pem"}
 % ]},

 %% riak\_handoff\_port is the TCP port that Riak uses for
 %% intra-cluster data handoff.
 {handoff\_port, 8099 }
 ]},

 %% Riak KV config
{riak\_kv, [
 %% Storage\_backend specifies the Erlang module defining the storage
 %% mechanism that will be used on this node.
 {storage\_backend, riak\_kv\_bitcask\_backend},

 %% pb\_ip is the IP address that the Riak Protocol Buffers interface
 %% will bind to. If this is undefined, the interface will not run.
 {pb\_ip, "0.0.0.0" },

 %% pb\_port is the TCP port that the Riak Protocol Buffers interface
 %% will bind to
 {pb\_port, 8087 },

 %% raw\_name is the first part of all URLS used by the Riak raw HTTP
 %% interface. See riak\_web.erl and raw\_http\_resource.erl for
 %% details.
 %{raw\_name, "riak"},

 %% mapred\_name is URL used to submit map/reduce requests to Riak.
 {mapred\_name, "mapred"},

 %% directory used to store a transient queue for pending
 %% map tasks
 {mapred\_queue\_dir, "/var/lib/riak/mr\_queue" },

 %% Each of the following entries control how many Javascript
 %% virtual machines are available for executing map, reduce,
 %% pre- and post-commit hook functions.
 {map\_js\_vm\_count, 8 },
 {reduce\_js\_vm\_count, 6 },
 {hook\_js\_vm\_count, 2 },

 %% Number of items the mapper will fetch in one request.
 %% Larger values can impact read/write performance for
 %% non-MapReduce requests.
 {mapper\_batch\_size, 5},

 %% js\_max\_vm\_mem is the maximum amount of memory, in megabytes,
 %% allocated to the Javascript VMs. If unset, the default is
 %% 8MB.
 {js\_max\_vm\_mem, 8},

 %% js\_thread\_stack is the maximum amount of thread stack, in megabyes,
 %% allocate to the Javascript VMs. If unset, the default is 16MB.
 %% NOTE: This is not the same as the C thread stack.
 {js\_thread\_stack, 16},

 %% Number of objects held in the MapReduce cache. These will be
 %% ejected when the cache runs out of room or the bucket/key
 %% pair for that entry changes
 {map\_cache\_size, 10000},

 %% js\_source\_dir should point to a directory containing Javascript
 %% source files which will be loaded by Riak when it initializes
 %% Javascript VMs.
 %{js\_source\_dir, "/tmp/js\_source"},

 %% riak\_stat enables the use of the "riak-admin status" command to
 %% retrieve information the Riak node for performance and debugging 
needs
 {riak\_kv\_stat, true}
 ]},

 %% Bitcask Config
{bitcask, [
 {data\_root, "/var/lib/riak/bitcask"}
 ]},

 %% Luwak Config
{luwak, [
 {enabled, false}
 ]},

 %% Riak\_err Config
{riak\_err, [
 %% Info/error/warning reports larger than this will be considered
 %% too big to be formatted safely with the user-supplied format
 %% string.
 {term\_max\_size, 65536},

 %% Limit the total size of formatted info/error/warning reports.
 {fmt\_max\_bytes, 65536}
 ]}, 

 %% SASL config
{sasl, [
 {sasl\_error\_logger, {file, "/var/log/riak/sasl-error.log"}},
 {errlog\_type, error},
 {error\_logger\_mf\_dir, "/var/log/riak/sasl"}, % Log directory
 {error\_logger\_mf\_maxbytes, 10485760}, % 10 MB max file size
 {error\_logger\_mf\_maxfiles, 5} % 5 files max
 ]}
 ].
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

