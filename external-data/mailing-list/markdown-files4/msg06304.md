---
title: "Re: Performance Issue with Embedded Document"
description: ""
project: community
lastmod: 2012-01-18T05:36:31-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06304"
mailinglist_parent_id: "msg06303"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-01-18T05:36:31-08:00
---


Yehuda,

Thank you for finding that performance problem. Would you open an issue on
the Github tracker? https://github.com/seancribbs/ripple/issues

On Wed, Jan 18, 2012 at 2:08 AM, Yehuda Zargrov  wrote:

&gt; Hi,\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; I have a script that runs over ~200,000 rows, creates an embedded document
&gt; per row and adds each X embedded docs to a Document (5 embedded docs to a
&gt; document by average). The script does other stuff as well.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; At first, running the script took too long. Using profiler, I’ve noticed
&gt; the adding takes the majority time: report &lt;&lt; item.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; After debugging the code of ‘&lt;&lt;’ function in ‘many\_embedded\_proxy.rb’,
&gt; I’ve noticed that each call to “Array(docs)” causes a ‘missing\_method’ call
&gt; which activates ‘define\_attribute\_methods’ function. \*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; I’ve tried to coat the embedded doc parameter myself before calling ‘&lt;&lt;’
&gt; and removed the following lines from the ‘&lt;&lt;’ function:\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \* def &lt;&lt;(docs)\*
&gt;
&gt; \* load\_target\*
&gt;
&gt; \* #@reflection.verify\_type!(Array(docs), @owner)\*
&gt;
&gt; \* #assign\_references(docs)\*
&gt;
&gt; \* #@target += Array(docs)\*
&gt;
&gt; \* @target += docs # instead of the previous line\*
&gt;
&gt; \* self\*
&gt;
&gt; \* end\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; And my script ran 10 times faster. I thought that removing these lines
&gt; will cause a problem to the ‘save’ method of the document, but the save
&gt; went ok.\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Am I missing something by removing these lines? Is there a problem with
&gt; the code?\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; Thanks, \*\*\*\*
&gt;
&gt; [image: Description:
&gt; C:\Users\Yehuda\AppData\Roaming\Microsoft\Signatures\midem.png]\*\*\*\*
&gt;
&gt; \*\* \*\*
&gt;
&gt; \*Yehuda Zargrov
&gt; Software Engineer\*\*\*\*\*
&gt;
&gt; \*Conduit Your Site\* \* \*\*\*\*\*
&gt;
&gt; \*t:\* +972.8.946.1713 ext +288 | \*m:\* +972503473119 | \*f:\*
&gt; +97286382140 \*\*\*\*
&gt;
&gt;
&gt; This message may contain confidential and/or privileged information. It is
&gt; intended to be read only by the individual or entity to whom it is
&gt; addressed or by their designee.
&gt; If the reader of this message is not the intended recipient, you are on
&gt; notice that any uses, copy, disclose or distribution of this message, in
&gt; any form, is strictly prohibited.
&gt; If you have received this message in error, please notify the sender by
&gt; reply email or by telephone and delete or destroy any copy of this message.
&gt; Thank you.
&gt;
&gt; \*\*\*\*
&gt;
&gt; \*\*\*\*
&gt;
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
&lt;&gt;\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

