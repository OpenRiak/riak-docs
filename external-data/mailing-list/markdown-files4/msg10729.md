---
title: "Re: Riak 1.2: stalled handoff"
description: ""
project: community
lastmod: 2013-04-05T23:22:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10729"
mailinglist_parent_id: "msg10728"
author_name: "Yuri Lukyanov"
project_section: "mailinglistitem"
sent_date: 2013-04-05T23:22:26-07:00
---


Backend is leveldb.

Ring status:

# riak-admin ring-status
Attempting to restart script through sudo -H -u riak
================================== Claimant
===================================
Claimant: riak@nsto0r1
Status: up
Ring Ready: true

============================== Ownership Handoff
==============================
Owner: riak@nsto0r5
Next Owner: riak@nsto0r6

Index: 0
 Waiting on: [riak\_kv\_vnode]
 Complete: [riak\_pipe\_vnode]

-------------------------------------------------------------------------------

============================== Unreachable Nodes
==============================
All nodes are up and reachable

# riak-admin ringready
Attempting to restart script through sudo -H -u riak
TRUE All nodes agree on the ring [riak@nsto0r0,riak@nsto0r1,riak@nsto0r2,
 riak@nsto0r3,riak@nsto0r4,riak@nsto0r5,
 riak@nsto0r6]


Unfortunately this is the current status. Things have changed since I wrote
the previous email . What I see now by running riak-admin transfers is:

# riak-admin transfers
Attempting to restart script through sudo -H -u riak
riak@nsto0r6 waiting to handoff 1 partitions
riak@nsto0r3 waiting to handoff 1 partitions
riak@nsto0r2 waiting to handoff 1 partitions
riak@nsto0r1 waiting to handoff 1 partitions

Active Transfers:

transfer type: ownership\_handoff
vnode type: riak\_kv\_vnode
partition: 0
started: 2013-04-06 05:36:06 [1.93 min ago]
last update: 2013-04-06 06:08:11 [2.01 s ago]
objects transferred: 5184001

 2692 Objs/s
 riak@nsto0r5 =======================&gt; riak@nsto0r6
 931.18 KB/s

So it looks like the partition finally got being transferred. I don't
understand why there appear new handoffs to transfer though (maybe it's a
different story about riak@nsto0r1; look like it crashed for some reason).

Hm, is there a known reason why riak cluster may stop handoffs for a period
of time?

Thank you.


On Sat, Apr 6, 2013 at 2:42 AM, Alexander Moore wrote:

&gt; Also, what's the output of riak-admin ringready ?
&gt;
&gt; Thanks,
&gt; Alex
&gt;
&gt;
&gt; --Alex
&gt;
&gt;
&gt; On Fri, Apr 5, 2013 at 6:37 PM, Alexander Moore wrote:
&gt;
&gt;&gt; Hi Yuri,
&gt;&gt;
&gt;&gt; What backend are you using?
&gt;&gt;
&gt;&gt; What does riak-admin ring-status output?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Alex
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Apr 5, 2013 at 6:30 PM, Yuri Lukyanov wrote:
&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I was adding the 7-th node to one of our riak 1.2 clusters. Everything
&gt;&gt;&gt; was ok untill the process suddenly stopped with one handoff left:
&gt;&gt;&gt;
&gt;&gt;&gt; # riak-admin transfers
&gt;&gt;&gt; Attempting to restart script through sudo -H -u riak
&gt;&gt;&gt; riak@nsto0r6 waiting to handoff 1 partitions
&gt;&gt;&gt;
&gt;&gt;&gt; Active Transfers:
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Note that no transfers are displayed. At first I thought that it is just
&gt;&gt;&gt; a temporary pause. But it's been already about 12 hours since then.
&gt;&gt;&gt;
&gt;&gt;&gt; Here is what member-status shows:
&gt;&gt;&gt;
&gt;&gt;&gt; # riak-admin member-status
&gt;&gt;&gt; Attempting to restart script through sudo -H -u riak
&gt;&gt;&gt; ================================= Membership
&gt;&gt;&gt; ==================================
&gt;&gt;&gt; Status Ring Pending Node
&gt;&gt;&gt;
&gt;&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt;&gt; valid 14.1% 14.1% riak@nsto0r0
&gt;&gt;&gt; valid 14.1% 14.1% riak@nsto0r1
&gt;&gt;&gt; valid 14.1% 14.1% riak@nsto0r2
&gt;&gt;&gt; valid 14.1% 14.1% riak@nsto0r3
&gt;&gt;&gt; valid 15.6% 15.6% riak@nsto0r4
&gt;&gt;&gt; valid \*15.6% 14.1%\* riak@nsto0r5
&gt;&gt;&gt; valid \*12.5% 14.1%\* riak@nsto0r6
&gt;&gt;&gt;
&gt;&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt;&gt; Valid:7 / Leaving:0 / Exiting:0 / Joining:0 / Down:0
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; What would be a reason for such behaviour and how can I investigate this
&gt;&gt;&gt; further?
&gt;&gt;&gt; How to force the handoff?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

