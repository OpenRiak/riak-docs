---
title: "Re: How to make Riak work faster (writing)"
description: ""
project: community
lastmod: 2012-11-03T12:43:57-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09183"
mailinglist_parent_id: "msg09169"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2012-11-03T12:43:57-07:00
---


Uruka,

Now that you got some somewhat reasonable numbers, it is probably time to
discuss what you are trying to get out of Riak. We typically recommend 4
or 5 nodes minimum for a Riak install because that is the point where the
distribution becomes a performance benefit rather than a hindrance. I know
you were just load testing, but I'd recommend considering a test with 4 or
5 nodes, with default N values. During the test, remove a node (power it
off, or 'riak stop' it). Or like someone else mentioned start with a 3 or
4 node cluster and add a node to see how the performance goes up and no
further operations work is needed to rebalance the data around the cluster.
 This is really where Riak shines over some alternative databases, the ease
of scaling and dealing with failures. SIngle node performance although fun
to try and tune to get the most out of it, isn't as interesting on a long
timeline when trying to scale the system. Obviously single node
performance is still important, dont' get me wrong. Riak isn't always the
best choice, but when it comes with staying available and performance while
systems are failing no other system has a better real-world story than Riak.

If you still want to get your single node performance up, we have several
pages on our docs page based around tuning. A good place to start is the
file system tuning page
http://docs.basho.com/riak/latest/cookbooks/File-System-Tuning/ . Reading
that and other pages in the Operations section might be helpful in
squeezing out those last bits of speed.

I am glad to see your initial 60 writes/sec has gone up to 800 writes/sec,
but we definitely can do better once you start utilizing our strengths.

Hope my rambling helped,
-Jared

On Sat, Nov 3, 2012 at 4:55 AM, Uruka Dark  wrote:

&gt; Jared,
&gt;
&gt; Thank you for you time and reply.
&gt;
&gt; I got impressed by your numbers and I started to double check my settings.
&gt; I found a big problem here, my third machine (the one out of the cluster,
&gt; making the load), was not talking to Riak in gigabit speed, it was 100 Mbs.
&gt; I changed the network cable and it's working fine now.
&gt; I ran my python script again and I already could see better results: 252
&gt; ops/sec (before the fix it was 175 ops/sec).
&gt;
&gt; I also ran your benchmark .config, and these are my numbers:
&gt; https://dl.dropbox.com/u/308392/summary.png
&gt;
&gt; As you can see, even so, I'm still far from your results.. not even close,
&gt; and now I'm using Bitcask.
&gt; Anyway, my current position is much better than at the beggining. I'll
&gt; double-check all over again, cause now I have a confirmation that there is
&gt; something wrong.
&gt;
&gt; If you have any suggestion, please, let me know.
&gt; Once again, thank you.
&gt;
&gt; On Sat, Nov 3, 2012 at 3:08 AM, Jared Morrow  wrote:
&gt;
&gt;&gt; I forgot to mention that 2000 ops/sec was on bitcask, not memory. I
&gt;&gt; didn't bother with the memory backend.
&gt;&gt;
&gt;&gt; -Jared
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sat, Nov 3, 2012 at 12:05 AM, Jared Morrow  wrote:
&gt;&gt;
&gt;&gt;&gt; Uruka,
&gt;&gt;&gt;
&gt;&gt;&gt; So looking at your results something is really wrong with your setup. I
&gt;&gt;&gt; was surprised by your numbers, so I made two VM's each with only 1gb of RAM
&gt;&gt;&gt; on two different boxes also on a 1gb switch.
&gt;&gt;&gt;
&gt;&gt;&gt; I ran a put of 100,000 keys at 10kb in size.
&gt;&gt;&gt;
&gt;&gt;&gt; I didn't do any tuning at all on the VM's and these were quick Ubuntu
&gt;&gt;&gt; 10.04 VM's with 2 virtual CPU's and 1 gig of ram. I also didn't change any
&gt;&gt;&gt; settings in Riak, except for the IP address and listening ports.
&gt;&gt;&gt;
&gt;&gt;&gt; Here is the summary of the results showing around 2000 ops/sec
&gt;&gt;&gt; https://dl.dropbox.com/u/183971/summary.png
&gt;&gt;&gt;
&gt;&gt;&gt; So my main thought is that you weren't actually using N=1 for your puts
&gt;&gt;&gt; and you were using the default N value of 3, meaning you were writing each
&gt;&gt;&gt; key/value 3 times, and with 2 nodes this is doing a lot of writes to the
&gt;&gt;&gt; same disk multiple times.
&gt;&gt;&gt;
&gt;&gt;&gt; To be sure you have N=1, you can use 'riak attach' on each node and
&gt;&gt;&gt; enter the following command:
&gt;&gt;&gt;
&gt;&gt;&gt; riak\_core\_bucket:set\_bucket(&lt;&lt;"pop1"&gt;&gt;,[{n\_val,1}]).
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; If you bucket name is "pop1" as in my case. That name is completely
&gt;&gt;&gt; arbitrary.
&gt;&gt;&gt;
&gt;&gt;&gt; Sorry I'm late to this thread, I had to find some time to setup the test.
&gt;&gt;&gt;
&gt;&gt;&gt; For reference I used https://github.com/basho/basho\_bench for the
&gt;&gt;&gt; benchmark. With the following .config file
&gt;&gt;&gt; https://gist.github.com/e630b63f4a025a0fb634
&gt;&gt;&gt;
&gt;&gt;&gt; Hope this helps,
&gt;&gt;&gt; Jared
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

