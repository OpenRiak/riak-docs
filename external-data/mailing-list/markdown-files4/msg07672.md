---
title: "Re: Erlang Client: get_update_metadata vs get_metadata"
description: ""
project: community
lastmod: 2012-06-12T13:18:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07672"
mailinglist_parent_id: "msg07668"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2012-06-12T13:18:49-07:00
---



On Jun 12, 2012, at 2:56 PM, Michael Radford wrote:

&gt; get\_metadata returns the metadata that was read from riak. But if
&gt; allow\_mult is true, and there is more than one sibling, then
&gt; get\_metadata throws the exception 'siblings'. You have to call
&gt; get\_metadatas to get a list with metadata for each sibling in that
&gt; case.
&gt; 
&gt; get\_update\_metadata returns the metadata that is to be written for the
&gt; object (if you were to call riakc\_pb\_socket:put at that point). The
&gt; update metadata is either a single value set explicitly with
&gt; riakc\_obj:update\_metadata, or if none was set, and there is only one
&gt; sibling, then the default is the value of get\_metadata.
&gt; 
&gt; A related question: if I'm not using any user-specified metadata at
&gt; all, but I do have allow\_mult turned on, then how do I choose which
&gt; metadata to write back to riak after resolving the conflict? Or could
&gt; I just call update\_metadata with an empty dict in that case?
I'd recommend calling update\_metadata with an empty dict. Be sure
to set the content\_type as well.
&gt; 
&gt; Right now, I have some conflict resolution code that uses the same
&gt; default strategy as mochimedia's statebox\_riak library, which
&gt; arbitrarily chooses the first metadata. But this seems less than
&gt; ideal: everything in the metadata is coming from riak, and some of it
&gt; (e.g., last-modified timestamps) must be ignored when doing the
&gt; update. So it seems like riak should be able to resolve the "metadata
&gt; conflict" on its own: just prune all the metadata keys that aren't
&gt; actually written, and then if the resulting pruned metadatas are
&gt; identical, then there's no conflict. Or, if there is some reason why
&gt; the user should prefer one metadata over another, then the client
&gt; library should give the user some way to decide.
There are definitely cases where the user wants to choose one metadata
over another, or perhaps more commonly, "merge" them together, according
to some conflict resolution semantics. The client provides `update\_metadata`
for this reason. `select\_sibling/2` can be used to choose a particular 
{Metadata, Value}
pair as well.
&gt; 
&gt; Mike
&gt; 
&gt; On Tue, Jun 12, 2012 at 11:25 AM, Andrew Berman  wrote:
&gt;&gt; Can someone explain the difference between the get\_update\_metadata and
&gt;&gt; get\_metadata functions in the Erlang PB Client for Riak? It's very
&gt;&gt; confusing...
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Andrew
&gt;&gt; 
&gt;&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
&gt;&gt; 
&gt; 
&gt; \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

