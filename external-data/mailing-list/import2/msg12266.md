---
title: "new cluster -- riak starts and dies on each vm."
description: ""
project: community
lastmod: 2013-09-15T09:07:21-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12266"
author_name: "Daniel Rathbone"
project_section: "mailinglistitem"
sent_date: 2013-09-15T09:07:21-07:00
---


I'm setting up a new small riak cluster - 8 VMs, 4GB each. Riak starts and
dies after a few seconds on each VM. I'd like to figure out why.

I'm running riak 1.4.1, built from source on ubuntu 12.04 (32 bit). I have
AAE and search turned off and my backend is set to leveldb. Ring size is
64. All the other settings are default.

The crash.log files show errors that look like these:

2013-09-14 22:48:25 =SUPERVISOR REPORT====
 Supervisor: {local,riak\_core\_vnode\_proxy\_sup}
 Context: shutdown\_error
 Reason:
{{{function\_clause,[{riak\_kv\_vnode,terminate,[{bad\_return\_value,{stop,{db\_open,"IO
error:
./data/leveldb/1027618338748291114361965898003636498195577569280/000002.dbtmp:
Cannot allocate
memory"}}},undefined],[{file,"src/riak\_kv\_vnode.erl"},{line,838}]},{riak\_core\_vnode,terminate,3,[{file,"src/riak\_core\_vnode.erl"},{line,849}]},{gen\_fsm,terminate,7,[{file,"gen\_fsm.erl"},{line,586}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,227}]}]},{gen\_fsm,sync\_send\_event,[<0.19541.3>,wait\_for\_init,infinity]}},{gen\_server,call,[riak\_core\_vnode\_manager,{205523667749658222872393179600727299639115513856,riak\_kv\_vnode,get\_vnode},infinity]}}
 Offender:
[{pid,<0.471.0>},{name,{riak\_kv\_vnode,205523667749658222872393179600727299639115513856}},{mfargs,{riak\_core\_vnode\_proxy,start\_link,[riak\_kv\_vnode,205523667749658222872393179600727299639115513856]}},{restart\_type,permanent},{shutdown,5000},{child\_type,worker}]

2013-09-14 22:48:25 =SUPERVISOR REPORT====
 Supervisor: {local,riak\_core\_sup}
 Context: child\_terminated
 Reason: shutdown
 Offender:
[{pid,<0.151.0>},{name,riak\_core\_vnode\_proxy\_sup},{mfargs,{riak\_core\_vnode\_proxy\_sup,start\_link,[]}},{restart\_type,permanent},{shutdown,5000},{child\_type,supervisor}]



I don't understand why riak "Cannot allocate memory" as my system memory
use is under 20%. Is there a config parameter I must change?

Thanks,
Daniel
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

