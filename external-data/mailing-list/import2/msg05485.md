---
title: "Re: riak ubuntu 11 building problems"
description: ""
project: community
lastmod: 2011-11-08T15:10:32-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05485"
mailinglist_parent_id: "msg05483"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2011-11-08T15:10:32-08:00
---


In an effort to reproduce the problem, I started with a fresh ubuntu 11.10
image to build riak. First off you'll need these dependencies for ubuntu
11: make, binutils (really ubuntu, no gnu make by default?),
libncurses5-dev, libssl-dev (or libssl-dev-0.9.8 if you are using riak deb
package), libstdc++, g++.
Here are the steps I did:

Download erlang R14B03 from erlang.org and download riak-1.0.1 source
tar.gz file from downloads.basho.com.

jared@dev-ubuntu-01:~$ ls
otp\_src\_R14B03 otp\_src\_R14B03.tar.gz riak-1.0.1 riak-1.0.1.tar.gz
jared@dev-ubuntu-01:~$ uname -a
Linux dev-ubuntu-01 3.0.0-12-server #20-Ubuntu SMP Fri Oct 7 16:36:30 UTC
2011 x86\_64 x86\_64 x86\_64 GNU/Linux

build erlang from source (configure / make / make install)

jared@dev-ubuntu-01:~/riak-1.0.1$ make rel
make: git: Command not found
./rebar get-deps
make: git: Command not found
make: git: Command not found
make: git: Command not found
==> cluster\_info (get-deps)
==> skerl (get-deps)
==> lager (get-deps)
==> poolboy (get-deps)
==> protobuffs (get-deps)
==> basho\_stats (get-deps)
==> riak\_sysmon (get-deps)
==> mochiweb (get-deps)
==> webmachine (get-deps)
==> riak\_core (get-deps)
==> riakc (get-deps)
==> luke (get-deps)
==> erlang\_js (get-deps)
==> bitcask (get-deps)
==> merge\_index (get-deps)
==> ebloom (get-deps)
==> eper (get-deps)
==> eleveldb (get-deps)
==> edown (get-deps)
==> sext (get-deps)
==> riak\_pipe (get-deps)
==> basho\_metrics (get-deps)
==> riak\_kv (get-deps)
==> luwak (get-deps)
==> lucene\_parser (get-deps)
==> riak\_search (get-deps)
==> rel (get-deps)
==> riak-1.0.1 (get-deps)
./rebar compile generate
make: git: Command not found
make: git: Command not found
make: git: Command not found
==> cluster\_info (compile)
Compiled src/cluster\_info\_ex.erl
Compiled src/cluster\_info.erl
Compiled src/cluster\_info\_basic.erl
==> skerl (compile)
Compiled src/hex.erl
Compiled src/skerl.erl
Compiling c\_src/skein.c
Compiling c\_src/skein\_api.c
Compiling c\_src/skein\_block.c
Compiling c\_src/skein\_debug.c
Compiling c\_src/skerl\_nifs.c
==> lager (compile)
Compiled src/lager\_util.erl
Compiled src/lager\_transform.erl
Compiled src/lager\_handler\_watcher.erl
Compiled src/lager\_trunc\_io.erl
Compiled src/lager\_file\_backend.erl
Compiled src/lager\_sup.erl
Compiled src/lager\_crash\_log.erl
Compiled src/lager\_console\_backend.erl
Compiled src/lager\_app.erl
Compiled src/error\_logger\_lager\_h.erl
Compiled src/lager.erl
Compiled src/lager\_stdlib.erl
Compiled src/lager\_handler\_watcher\_sup.erl
Compiled src/lager\_mochiglobal.erl
==> poolboy (compile)
Compiled src/poolboy\_sup.erl
Compiled src/poolboy.erl
==> protobuffs (compile)
Compiled src/protobuffs\_scanner.xrl
Compiled src/protobuffs\_parser.yrl
Compiled src/pokemon\_pb.erl
Compiled src/protobuffs.erl
Compiled src/protobuffs\_compile.erl
Compiled src/protobuffs\_scanner.erl
Compiled src/protobuffs\_parser.erl
==> basho\_stats (compile)
Compiled src/basho\_stats\_rv.erl
Compiled src/basho\_stats\_utils.erl
Compiled src/basho\_stats\_sample.erl
Compiled src/basho\_stats\_histogram.erl
==> riak\_sysmon (compile)
Compiled src/riak\_sysmon\_sup.erl
Compiled src/riak\_sysmon\_testhandler.erl
Compiled src/riak\_sysmon\_app.erl
Compiled src/riak\_sysmon\_example\_handler.erl
Compiled src/riak\_sysmon\_filter.erl
==> mochiweb (compile)
Compiled src/mochifmt\_std.erl
Compiled src/mochilists.erl
Compiled src/mochiweb\_charref.erl
Compiled src/mochiweb\_acceptor.erl
Compiled src/mochihex.erl
Compiled src/mochiweb\_headers.erl
Compiled src/mochifmt\_records.erl
Compiled src/mochifmt.erl
Compiled src/mochijson2.erl
Compiled src/mochiweb\_sup.erl
Compiled src/mochiweb\_echo.erl
Compiled src/mochiweb\_skel.erl
Compiled src/mochiweb\_app.erl
Compiled src/mochiweb.erl
Compiled src/mochilogfile2.erl
Compiled src/mochiutf8.erl
Compiled src/mochiweb\_io.erl
Compiled src/mochiweb\_cookies.erl
Compiled src/mochiweb\_util.erl
Compiled src/mochiweb\_cover.erl
Compiled src/mochiweb\_mime.erl
Compiled src/mochinum.erl
Compiled src/mochitemp.erl
Compiled src/mochiweb\_request.erl
Compiled src/mochiweb\_multipart.erl
Compiled src/mochiweb\_request\_tests.erl
Compiled src/mochiweb\_response.erl
Compiled src/mochiweb\_socket.erl
Compiled src/mochiweb\_http.erl
Compiled src/mochiglobal.erl
Compiled src/reloader.erl
Compiled src/mochiweb\_socket\_server.erl
Compiled src/mochijson.erl
Compiled src/mochiweb\_html.erl
==> webmachine (compile)
Compiled src/webmachine\_error\_handler.erl
Compiled src/webmachine\_sup.erl
Compiled src/webmachine\_logger.erl
Compiled src/webmachine\_perf\_logger.erl
Compiled src/wmtrace\_resource.erl
Compiled src/webmachine.erl
Compiled src/webmachine\_deps.erl
Compiled src/webmachine\_multipart.erl
Compiled src/webmachine\_resource.erl
Compiled src/webmachine\_mochiweb.erl
Compiled src/webmachine\_router.erl
Compiled src/webmachine\_app.erl
Compiled src/webmachine\_util.erl
Compiled src/wrq.erl
Compiled src/webmachine\_decision\_core.erl
Compiled src/webmachine\_dispatcher.erl
Compiled src/webmachine\_request.erl
==> riak\_core (compile)
Compiling src/riak\_core.proto
=INFO REPORT==== 8-Nov-2011::15:56:33 ===
Writing header file to "riak\_core\_pb.hrl"
=INFO REPORT==== 8-Nov-2011::15:56:33 ===
Writing beam file to "riak\_core\_pb.beam"
Compiled src/gen\_nb\_server.erl
Compiled src/gen\_server2.erl
Compiled src/riak\_core\_vnode\_worker.erl
Compiled src/riak\_core\_coverage\_fsm.erl
Compiled src/supervisor\_pre\_r14b04.erl
Compiled src/riak\_core\_vnode.erl
Compiled src/riak\_core\_vnode\_sup.erl
Compiled src/riak\_core\_handoff\_receiver.erl
Compiled src/riak\_core\_claim.erl
Compiled src/riak\_core\_stat.erl
Compiled src/riak\_core\_ring\_events.erl
Compiled src/process\_proxy.erl
Compiled src/riak\_core\_test\_util.erl
Compiled src/riak\_core\_vnode\_worker\_pool.erl
Compiled src/riak\_core\_handoff\_sender.erl
Compiled src/riak\_core\_coverage\_plan.erl
Compiled src/spiraltime.erl
Compiled src/riak\_core\_sup.erl
Compiled src/riak\_core\_node\_watcher.erl
Compiled src/riak\_core\_cinfo\_core.erl
Compiled src/app\_helper.erl
Compiled src/riak\_core\_handoff\_manager.erl
Compiled src/bloom.erl
Compiled src/riak\_core\_new\_claim.erl
Compiled src/vclock.erl
Compiled src/riak\_core\_eventhandler\_sup.erl
Compiled src/riak\_core\_vnode\_master.erl
Compiled src/riak\_core\_console.erl
Compiled src/riak\_core\_sysmon\_minder.erl
Compiled src/priority\_queue.erl
Compiled src/riak\_core\_tracer.erl
Compiled src/riak\_core\_gossip.erl
Compiled src/riak\_core\_util.erl
Compiled src/riak\_core.erl
Compiled src/riak\_core\_bucket.erl
Compiled src/riak\_core\_sysmon\_handler.erl
Compiled src/riak\_core\_status.erl
Compiled src/riak\_core\_ring\_util.erl
Compiled src/riak\_core\_ring.erl
Compiled src/riak\_core\_handoff\_listener.erl
Compiled src/riak\_core\_web.erl
Compiled src/riak\_core\_ring\_handler.erl
Compiled src/chash.erl
Compiled src/riak\_core\_node\_watcher\_events.erl
Compiled src/json\_pp.erl
Compiled src/riak\_core\_ring\_manager.erl
Compiled src/riak\_core\_apl.erl
Compiled src/riak\_core\_config.erl
Compiled src/riak\_core\_nodeid.erl
Compiled src/riak\_core\_gossip\_legacy.erl
Compiled src/riak\_core\_eventhandler\_guard.erl
Compiled src/riak\_core\_wm\_urlmap.erl
Compiled src/riak\_core\_vnode\_manager.erl
Compiled src/riak\_core\_app.erl
Compiled src/slide.erl
Compiled src/merkerl.erl
==> riakc (compile)
Compiling src/riakclient.proto

=INFO REPORT==== 8-Nov-2011::15:56:36 ===
Writing header file to "riakclient\_pb.hrl"

=INFO REPORT==== 8-Nov-2011::15:56:36 ===
Writing beam file to "riakclient\_pb.beam"
Compiled src/riakc\_obj.erl
Compiled src/riakc\_pb.erl
Compiled src/riakc\_pb\_socket.erl
==> luke (compile)
Compiled src/luke\_phase.erl
Compiled src/luke\_phase\_sup.erl
Compiled src/luke\_flow\_cache.erl
Compiled src/luke.erl
Compiled src/luke\_sup.erl
Compiled src/luke\_phases.erl
Compiled src/luke\_flow\_sup.erl
Compiled src/luke\_flow.erl
==> erlang\_js (compile)



Compiled src/riak\_kv\_put\_core.erl
Compiled src/riak\_kv\_reduce\_phase.erl
Compiled src/riak\_kv\_worker.erl
Compiled src/riak\_kv\_w\_reduce.erl
Compiled src/riak\_kv\_wm\_index.erl
Compiled src/riak\_kv\_keys\_fsm.erl
Compiled src/riak\_kv\_mapred\_json.erl
Compiled src/riak\_kv\_buckets\_fsm.erl
Compiled src/riak\_kv\_mapred\_query.erl
Compiled src/riak\_kv\_legacy\_vnode.erl
Compiled src/riak\_kv\_backup.erl
Compiled src/lk.erl
Compiled src/riak\_kv\_wm\_mapred.erl
Compiled src/riak\_kv\_keys\_fsm\_legacy.erl
Compiled src/riak\_kv\_keys\_fsm\_sup.erl
Compiled src/riak\_kv\_mapred\_cache.erl
Compiled src/riak\_kv\_delete.erl
Compiled src/riak\_kv\_put\_fsm\_sup.erl
Compiled src/riak\_kv\_buckets\_fsm\_sup.erl
Compiled src/riak\_kv\_pb\_socket.erl
Compiled src/riak\_kv\_stat.erl
Compiled src/riak\_kv\_eleveldb\_backend.erl
==> luwak (compile)
Compiled src/luwak\_app.erl
Compiled src/luwak\_block.erl
Compiled src/luwak\_file.erl
Compiled src/luwak\_io.erl
Compiled src/luwak\_tree.erl
Compiled src/luwak\_tree\_utils.erl
Compiled src/luwak\_get\_stream.erl
Compiled src/luwak\_checksum.erl
Compiled src/luwak\_wm\_file.erl
Compiled src/luwak\_put\_stream.erl
==> lucene\_parser (compile)
Compiled src/lucene\_scan.xrl
Compiled src/lucene\_parse.yrl
Compiled src/lucene\_parser.erl
Compiled src/lucene\_scan\_test.erl
Compiled src/lucene\_parse\_test.erl
Compiled src/lucene\_parse.erl
Compiled src/lucene\_scan.erl
==> riak\_search (compile)
Compiled src/riak\_search\_backend.erl
Compiled src/riak\_search\_operators\_qc.erl
Compiled src/riak\_search\_kv\_json\_extractor.erl
Compiled src/riak\_search\_vnode.erl
Compiled src/riak\_search\_basic\_qc.erl
Compiled src/riak\_search\_test.erl
Compiled src/riak\_search\_schema.erl
Compiled src/riak\_search\_op\_intersection.erl
Compiled src/riak\_search\_utils.erl
Compiled src/riak\_search\_dir\_indexer.erl
Compiled src/riak\_solr\_qc.erl
Compiled src/riak\_search\_ring\_utils.erl
Compiled src/riak\_search\_op\_range\_worker.erl
Compiled src/riak\_indexed\_doc.erl
Compiled src/riak\_search\_kv\_extractor.erl
Compiled src/riak\_search\_kv\_xml\_extractor.erl
Compiled src/riak\_search\_app.erl
Compiled src/riak\_search\_op\_range\_sized.erl
Compiled src/riak\_search\_kv\_erlang\_extractor.erl
Compiled src/riak\_search\_op\_group.erl
Compiled src/riak\_solr\_sup.erl
Compiled src/riak\_search\_op.erl
Compiled src/riak\_solr\_indexer\_wm.erl
Compiled src/riak\_search\_client.erl
Compiled src/riak\_solr\_xml.erl
Compiled src/riak\_search\_op\_utils.erl
Compiled src/riak\_search\_cinfo.erl
Compiled src/riak\_search\_kv\_hook.erl
Compiled src/riak\_solr\_search\_client.erl
Compiled src/riak\_search\_op\_mockterm.erl
Compiled src/riak\_solr\_xml\_xform.erl
Compiled src/riak\_search\_op\_term.erl
Compiled src/riak\_search\_inlines.erl
Compiled src/riak\_search\_ets\_backend.erl
Compiled src/riak\_search\_config.erl
Compiled src/riak\_search\_schema\_parser.erl
Compiled src/riak\_search\_op\_range.erl
Compiled src/riak\_solr\_searcher\_wm.erl
Compiled src/riak\_solr\_output.erl
Compiled src/riak\_search\_vnode\_sup.erl
Compiled src/riak\_search.erl
Compiled src/riak\_search\_op\_string.erl
Compiled src/riak\_search\_op\_proximity.erl
Compiled src/merge\_index\_backend.erl
Compiled src/riak\_search\_op\_scope.erl
Compiled src/riak\_search\_kv\_raw\_extractor.erl
Compiled src/riak\_search\_kv\_erlang\_binary\_extractor.erl
Compiled src/riak\_search\_op\_node.erl
Compiled src/solr\_search.erl
Compiled src/riak\_search\_sup.erl
Compiled src/riak\_search\_op\_union.erl
Compiled src/riak\_search\_cmd.erl
Compiled src/riak\_search\_op\_negation.erl
Compiled src/basho\_bench\_driver\_riaksearch.erl
Compiled src/riak\_solr\_sort.erl
Compiled src/text\_analyzers.erl
Compiled src/search.erl
==> rel (compile)
==> riak-1.0.1 (compile)
==> rel (generate)
jared@dev-ubuntu-01:~/riak-1.0.1$



As you can see, riak does compile fine on ubuntu 11. Your issue really
looks like stale dependencies, so it might be as easy as "rm -rf deps" to
clean out the deps directory and try to do another 'make rel'

Hope this helps,
-Jared

On Tue, Nov 8, 2011 at 12:37 PM, Ivan Trajkovic  wrote:

> any idea on why this might be happening?
> for now Im using Ubuntu 10.04 for my riak development, but would really
> love to have it running on my Ubuntu 11.04 machines...
>
>
> ps. by accident I see I sent the last email reply to Jared personally
> instead of to the riak list...
>
> On Wed, Nov 2, 2011 at 4:05 PM, Ivan Trajkovic wrote:
>
>> hello Jared
>> thank you for getting back to me
>>
>> Im compiling against erlang R14B03
>> here is the output of running "make rel" in the riak source base dir.
>>
>> $ make rel
>> ./rebar get-deps
>> ==> cluster\_info (get-deps)
>> ==> rel (get-deps)
>> ==> riak (get-deps)
>> ERROR: Dependency dir /media/data/installs/riak/deps/luwak failed
>> application validation with reason:
>> {version\_mismatch,{"/media/data/installs/riak/deps/luwak/ebin/luwak.app",
>> {expected,"1.1.1"},
>> {has,"1.1.0"}}}.
>> make: \*\*\* [deps] Error 1
>>
>>
>>
>>
>>
>>
>> I think I got passed these errors a few days ago by manually
>> 1. "git fetch"
>> 2. "git reset --hard origin/master"
>> in each of the dependency sub-folders(repos)...
>>
>>
>>
>>
>>
>>
>>
>>
>> On Mon, Oct 31, 2011 at 2:30 PM, Jared Morrow  wrote:
>>
>>> Ivan,
>>>
>>> We build the Riak 1.0 packages with Erlang R14B03 currently. We build
>>> on both Ubuntu 10 and Ubuntu 11 based machines with erlang compiled from
>>> source from erlang.org. I can take a look at your issues, can you put
>>> the following output in a gist or pastebin for me?
>>>
>>> $ which erl
>>> $ erl -version
>>> $ git clone g...@github.com:basho/riak
>>> $ cd riak
>>> $ make rel
>>>
>>> Thanks,
>>> Jared
>>>
>>> On Mon, Oct 31, 2011 at 12:06 PM, Ivan Trajkovic 
>>> wrote:
>>>
>>>> so yes the build on ubuntu 11.04 is definitely broken. I tried
>>>> multiple machines.
>>>> ubuntu 10.04 builds without a glitch.
>>>>
>>>> online I see no tutorials on building on 11.04
>>>> is this something thats not a common case?
>>>>
>>>>
>>>> On Sat, Oct 29, 2011 at 2:08 AM, Ivan Trajkovic wrote:
>>>>
>>>>> hello all
>>>>> Im having some problems with building riak from the github sources, on
>>>>> ubuntu 11
>>>>> Ive reproduced this issue on one of my home computers and a linode
>>>>> virtual server, both running ubuntu 11
>>>>>
>>>>>
>>>>> first of all riak 1.0.1 checkout requires me to have erlang R14B3,
>>>>> which is confusing to me since the riak\_1.0.1\_i386.deb seems to be working
>>>>> off of erlang R15A.
>>>>> the requirement is manifested in a message being spit out half way
>>>>> through the riak "make rel", about erlang not being of the correct 
>>>>> version.
>>>>> so I compiled a older R14B3 version of erlang and restarted the riak
>>>>> build process...
>>>>> it does finish "make rel" then but goes on to require "nodetools"
>>>>> which are not present in the erts-5.9 which is whats being checked, and is
>>>>> instead hiding in erts-5.8.4 folder (which is not whats used by riak). so 
>>>>> I
>>>>> went ahead and copied nodetools from 5.8.4 and put it in 5.9... it doesnt
>>>>> complain about that anymore after that... however then the new memsup
>>>>> issues pop up, with the Erlang VM dying each time I run "riak start"
>>>>> without any messages except mentioning memsup as the final issue...
>>>>>
>>>>> for the memsup issue I did check that ulimit is allowing 1024 file
>>>>> handles, and have increased that limit further as well, but no luck.
>>>>>
>>>>>
>>>>>
>>>>> please let me know if you need some more info about my setup, or
>>>>> thoughts/ideas about what I might be dealing with.
>>>>>
>>>>>
>>>>>
>>>>> help is appreciated
>>>>> thanks
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>>
>>>
>>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

