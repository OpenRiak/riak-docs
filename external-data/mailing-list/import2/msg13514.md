---
title: "Re: using salt stack with riak"
description: ""
project: community
lastmod: 2014-01-28T08:28:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13514"
mailinglist_parent_id: "msg13474"
author_name: "Matt Davis"
project_section: "mailinglistitem"
sent_date: 2014-01-28T08:28:16-08:00
---


Cool Matt, looks very similar to what I've got! We're also using pillar,
which helps a great deal when cross-referencing riak packages needed for
riak-cs.


On Thu, Jan 23, 2014 at 3:56 PM, Matt Black wrote:

> This state is meat of it, and should be pretty self-explanatory if you're
> already writing Salt states..
>
> riak-ulimit-pam:
> file.append:
> - name: /etc/pam.d/common-session
> - text: "session\trequired\tpam\_limits.so"
>
> riak-ulimit-pam-noninteractive:
> file.append:
> - name: /etc/pam.d/common-session-noninteractive
> - text: "session\trequired\tpam\_limits.so"
>
> riak-ulimit:
> file.append:
> - name: /etc/security/limits.conf
> - text:
> - "riak soft nofile 65536"
> - "riak hard nofile 65536"
> - require:
> - file: riak-ulimit-pam
>
> python-software-properties:
> pkg.installed
>
> basho-pkgrepo:
> pkgrepo.managed:
> - humanname: Basho PPA
> - name: deb http://apt.basho.com precise main
> - file: /etc/apt/sources.list.d/basho.list
> - key\_url: http://apt.basho.com/gpg/basho.apt.key
> - require:
> - pkg: python-software-properties
>
> riak:
> pkg.installed:
> - version: 1.4.2-1
> - require:
> - pkgrepo: basho-pkgrepo
> riak.running:
> - require:
> - pkg: riak
> - file: /etc/riak/app.config
> - file: /etc/riak/vm.args
> - file: riak-ulimit
>
> /etc/riak/app.config:
> file.managed:
> - source: salt://riak/app.config
> - mode: 644
> - template: jinja
> - require:
> - pkg: riak
> - defaults:
> internal\_ip: {{ salt['cmd.exec\_code']('bash', 'hostname -I') }}
>
> /etc/riak/vm.args:
> file.managed:
> - source: salt://riak/vm.args
> - mode: 644
> - template: jinja
> - require:
> - pkg: riak
> - defaults:
> internal\_ip: {{ salt['cmd.exec\_code']('bash', 'hostname -I') }}
>
>
>
> On 24 January 2014 04:22, Matt Davis  wrote:
>
>> Nicely done Matt! Sure would love to see your states... I've got a fairly
>> good one for riak-cs, would love to see some others.
>>
>>
>> On Wed, Jan 22, 2014 at 2:14 PM, Matt Black wrote:
>>
>>> Hi Matt,
>>>
>>> We manage all our Riak infrastructure with a couple of Salt states and a
>>> custom module I wrote which you can see here:
>>>
>>> https://github.com/saltstack/salt-contrib/blob/master/modules/riak.py
>>>
>>> There's another Riak module in Salt core, but last time I checked it had
>>> less functionality. (I talked with them a while back about merging the two
>>> modules - perhaps I should bring that up again).
>>>
>>> I can send our Salt states as well, if you're interested :)
>>>
>>>
>>> On 23 January 2014 07:05, Matt Davis  wrote:
>>>
>>>> Hey all,
>>>>
>>>> We're implementing salt stack for configuration management, and I've
>>>> been trying out how it works with riak, specifically remote command
>>>> execution.
>>>>
>>>> Anyone out there in riak-land been successfully integrating it with
>>>> salt?
>>>>
>>>> I've hit a couple of "arroo?" moments and am curious what others have
>>>> experienced.
>>>>
>>>> -matt
>>>>
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>>
>>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

