---
title: "Riak Search."
description: ""
project: community
lastmod: 2011-12-01T03:29:10-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05831"
author_name: "Chris Cook"
project_section: "mailinglistitem"
sent_date: 2011-12-01T03:29:10-08:00
---


Hi,

Sorry, but I've done a lot of googling and haven't been to work out where
this is going wrong, could someone please point out where I may be going
wrong with it. I have riak search enabled and set to true and riak clusters
all restarted. I go through the following steps below using
riak-erlang-http-client, but whenever I do a search I get {ok, []} back.

Erlang R14B02 (erts-5.8.3) [source] [rq:1] [async-threads:0]
[kernel-poll:false]

Eshell V5.8.3 (abort with ^G)
1> [ ok = application:start(A) || A <- [sasl, ibrowse] ],
1> IP = "127.0.0.1",
1> Port = 8098,
1> Prefix = "riak",
1> Options = [],
1> C = rhc:create(IP, Port, Prefix, Options).

---- Snipped Progress Reports from here, everything start with ok ----

{rhc,"127.0.0.1",8098,"riak",[{client\_id,"At5+Yg=="}]}
2> rhc:set\_bucket(C, "my\_books", [{<<"precommit">>, [{struct, [{<<"mod">>,
<<"riak\_search\_kv\_hook">>}, {<<"fun">>,<<"precommit">>}]}]}]).

=PROGRESS REPORT==== 1-Dec-2011::11:13:43 ===
 supervisor: {local,inet\_gethost\_native\_sup}
 started: [{pid,<0.53.0>},{mfa,{inet\_gethost\_native,init,[[]]}}]

=PROGRESS REPORT==== 1-Dec-2011::11:13:43 ===
 supervisor: {local,kernel\_safe\_sup}
 started: [{pid,<0.52.0>},
 {name,inet\_gethost\_native\_sup},
 {mfargs,{inet\_gethost\_native,start\_link,[]}},
 {restart\_type,temporary},
 {shutdown,1000},
 {child\_type,worker}]
ok
3> PropList = [{<<"id">>, <<"123456789">>},{<<"title">>, <<"The Title">>},
{<<"content">>, <<"The Content">>}].
[{<<"id">>,<<"123456789">>},
 {<<"title">>,<<"The Title">>},
 {<<"content">>,<<"The Content">>}]
4> Obj = riakc\_obj:new("my\_books", <<"123456789">>, PropList,
list\_to\_binary("application/x-erlang-term")).
{riakc\_obj,"my\_books",<<"123456789">>,undefined,[],
 {dict,1,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},

{{[],[],[],[],[],[],[],[],[],[],[[<<...>>|...]],[],[],...}}},
 [{<<"id">>,<<"123456789">>},
 {<<"title">>,<<"The Title">>},
 {<<"content">>,<<"The Content">>}]}
5> rhc:put(C, Obj).
ok
6> rhc:search(C, "my\_books", <<"content:The Content">>).
{ok,[]}
7> rhc:search(C, <<"my\_books">>, <<"content:The Content">>).
{ok,[]}
8> {ok, Obj0} = rhc:get(C, <<"123456789">>).
\*\* exception error: undefined function rhc:get/2
9> {ok, Obj0} = rhc:get(C, "my\_books", <<"123456789">>).
{ok,{riakc\_obj,"my\_books",<<"123456789">>,
 <<107,206,97,96,96,96,204,96,202,5,82,28,202,156,255,126,
 250,45,186,178,45,131,41,...>>,
 [{{dict,3,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],...},
 {{[],[],[],[],[],[],[],[],[],[],...}}},
 <<131,108,0,0,0,3,104,2,109,0,0,0,2,105,100,109,0,0,0,
 ...>>}],
 undefined,undefined}}
10>

It's probably something to do with the content type, but I'm really unsure,
many thanks in advance Chris.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

