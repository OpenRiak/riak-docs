---
title: "Re: Riak performance on GET operations (was "LevelDB read performance)"
description: ""
project: community
lastmod: 2012-07-29T21:25:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08118"
mailinglist_parent_id: "msg08116"
author_name: "Parnell Springmeyer"
project_section: "mailinglistitem"
sent_date: 2012-07-29T21:25:11-07:00
---


I (for some reason) didn't think about this… Thanks for saying so; I'll try 
implementing that instead.

On Jul 29, 2012, at 1:46 PM, Rapsey wrote:

> A map reduce job is a batch request. It takes in a list of {Bucket,Key} pairs 
> and returns the result. Though writing map reduce in the erlang PB client is 
> not exactly as nice as one would think. This is the function I use:
> 
> % P = riak connection
> % B = bucket
> % LI = list of keys
> mget\_bin(P,B,LI) ->
> case riakc\_pb\_socket:mapred(P,[{B,key(Key)} || Key <- LI],
> 
> [{reduce, {modfun, 
> riak\_kv\_mapreduce, reduce\_set\_union}, none, false},
> 
> {map, {modfun, 
> riak\_kv\_mapreduce, map\_identity}, none, true}]) of
> {ok,[{\_,L}|\_]} ->
> {ok,[Val || 
> {r\_object,\_Bucket,\_Key,[{r\_content,\_Meta,Val}],\_VClock,\_UpdateMeta,\_UpdateVal}
> <- L]};
> {error,notfound} ->
> undefined;
> X ->
> X
> end.
> 
> 
> 
> On Sat, Jul 28, 2012 at 6:26 PM, Parnell Springmeyer  
> wrote:
> Hi everyone!
> 
> I figured out what my bottleneck was - HTTP API + sequential (as opposed to 
> concurrent) GET requests.
> 
> I wrote a simple Erlange Cowboy handler that uses a worker pool OTP 
> application I built to make concurrent GETs using the PBC api. My Python web 
> app makes a call to the handler and it simulates "batched" requests.
> 
> It would be a great feature in Riak to have batched GETs built in…it 
> shouldn't be too difficult to add to the PBC or HTTP API's and it would be 
> enormously useful, particularly in the event where the client KNOWS the key 
> space and wants a batch of results.
> 
> I might make an experimental fork of Riak to add that feature if Basho isn't 
> working on something similar?
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 
> 



signature.asc
Description: Message signed with OpenPGP using GPGMail
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

