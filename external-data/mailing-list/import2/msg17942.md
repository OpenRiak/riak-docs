---
title: "Re: Riak mapreduce error"
description: ""
project: community
lastmod: 2017-02-09T01:41:53-0800
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17942"
mailinglist_parent_id: "msg17922"
author_name: "raghuveer sj"
project_section: "mailinglistitem"
sent_date: 2017-02-09T01:41:53-0800
---


Hi Magnus,

Previously i had used developer branch as master build was failing. Now
with the latest changes i see :

10> riakc\_pb\_socket:mapred\_bucket(Riak, <<"training">>, [{map, {qfun,
ReFun}, Re, true}]).
{error,<<"{\"phase\":0,\"error\":\"{badfun,#Fun}\",\"input\":\"{ok,{r\_object,<<\\\"
training\\\">>,<<\\\"bar\\\">>"...>>}

Please help me out.

Regards,
Raghuveer

On Mon, Feb 6, 2017 at 9:18 PM, Magnus Kessler  wrote:

> On 3 February 2017 at 18:31, raghuveer sj  wrote:
>
>> Hi Team,
>>
>> I am trying to run mapreduce in erlang.
>>
>> curl -XPUT http://localhost:8098/buckets/training/keys/foo -H
>> 'Content-Type: text/plain' -d 'caremad data goes here'
>> curl -XPUT http://localhost:8098/buckets/training/keys/bar -H
>> 'Content-Type: text/plain' -d 'caremad caremad caremad caremad'
>> curl -XPUT http://localhost:8098/buckets/training/keys/baz -H
>> 'Content-Type: text/plain' -d 'nothing to see here'
>> curl -XPUT http://localhost:8098/buckets/training/keys/bam -H
>> 'Content-Type: text/plain' -d 'caremad caremad caremad'
>>
>> \*Running in erlang shell :\*
>>
>> ReFun = fun(O, \_, Re) -> case re:run(riak\_object:get\_value(O), Re,
>> [global]) of
>> {match, Matches} -> [{riak\_object:key(O), length(Matches)}];
>> nomatch -> [{riak\_object:key(O), 0}]
>> end end.
>>
>> code:which(riakc\_pb\_socket).
>> "./ebin/riakc\_pb\_socket.beam"
>>
>> {ok, Pid} = riakc\_pb\_socket:start\_link("127.0.0.1", 8087).
>> {ok,<0.36.0>}
>>
>> riakc\_pb\_socket:ping(Pid).
>> pong
>>
>> {ok, Re} = re:compile("caremad").
>> {ok,{re\_pattern,0,0,0,
>> <<69,82,67,80,85,0,0,0,0,0,0,0,81,0,0,0,255,255,255,255,
>> 255,255,...>>}}
>>
>> {ok, Riak} = riakc\_pb\_socket:start\_link("127.0.0.1", 8087).
>> {ok,<0.42.0>}
>>
>> riakc\_pb\_socket:mapred\_bucket(Riak, <<"training">>, [{map, {qfun,
>> ReFun}, Re, true}]).
>> \*\* 1: variable 'ReFun' is unbound\*
>>
>> Trying to run the famous erlang sample program sample. I am stuck at this
>> error. Kindly help me out.
>>
>> Regards,
>> Raghuveer
>>
>>
> Hi Raghuveer,
>
> I have run the steps you provided, and found that they work fine for me.
> Can you let me know which version of Riak you are running this against, and
> which version of Erlang is used on the client side? Has the
> riak-erlang-client been compiled with the same Erlang version?
>
> Kind Regards,
>
> Magnus
>
> --
> Magnus Kessler
> Client Services Engineer
> Basho Technologies Limited
>
> Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

