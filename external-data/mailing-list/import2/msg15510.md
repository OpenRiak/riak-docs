---
title: "Re: Using apache as a reverse proxy"
description: ""
project: community
lastmod: 2015-01-15T15:43:31-0800
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15510"
mailinglist_parent_id: "msg15508"
author_name: "Fred Grim"
project_section: "mailinglistitem"
sent_date: 2015-01-15T15:43:31-0800
---


So this is really for the Googles. The problem turned out to be my code
(isn’t it always) and a misuse of an edge triggered epoll loop. Sorry for
all the line noise list.

Fred

On 1/15/15, 2:06 PM, "Luke Bakken"  wrote:

>Most reverse proxies have a timeout for data being sent from the
>server. If this query takes a long time to run when not using the
>proxy, I suggest investigating increasing timeout values.
>--
>Luke Bakken
>Engineer
>lbak...@basho.com
>
>
>On Thu, Jan 15, 2015 at 12:01 PM, Fred Grim  wrote:
>> The more I look at this the more I am thinking there is something busted
>> in riak or webmachine (I am using riak 1.4.10). The issue seems to be
>> impervious to apache settings or haproxy settings and going through the
>> source there doesn¹t seem to be many knobs to turn to adjust chunked
>> responses. Googling for issues in web machine also turned up nothing.
>> Maybe a pause in the return of map responses is doing it? Can riak be
>> configured to send keepalives?
>>
>> F
>>
>> On 1/14/15, 10:31 PM, "Toby Corkindale"  wrote:
>>
>>>Just a thought, but have you tried to replicate the problem when using
>>>haproxy (with the example configs provided on basho's site)?
>>>That might let you discover if the problem really IS with Apache, or
>>>if it's something to do with your Riak config instead.
>>>
>>>On 15 January 2015 at 11:05, Fred Grim  wrote:
>>>> Hello List,
>>>>
>>>> So I am using apache on ubuntu as a reverse proxy to a riak cluster.
>>>>Everything seems to work fine except for largish streaming map reduce
>>>>queries. The config is:
>>>> 
>>>> ServerAdmin aper...@acompany.com
>>>> 
>>>> BalancerMember
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez
>>>>6M
>>>>0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLK
>>>>n7
>>>>PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4f
>>>>Rr
>>>>kc9WU&e= :8098
>>>> BalancerMember
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez
>>>>6M
>>>>0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLK
>>>>n7
>>>>PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4f
>>>>Rr
>>>>kc9WU&e= :8098
>>>> BalancerMember
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez
>>>>6M
>>>>0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLK
>>>>n7
>>>>PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4f
>>>>Rr
>>>>kc9WU&e= :8098
>>>> BalancerMember
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez
>>>>6M
>>>>0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLK
>>>>n7
>>>>PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4f
>>>>Rr
>>>>kc9WU&e= :8098
>>>> BalancerMember
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez
>>>>6M
>>>>0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLK
>>>>n7
>>>>PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4f
>>>>Rr
>>>>kc9WU&e= :8098
>>>> BalancerMember
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez
>>>>6M
>>>>0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLK
>>>>n7
>>>>PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4f
>>>>Rr
>>>>kc9WU&e= :8098
>>>> BalancerMember
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_&d=AwICAg&c=Sqcl0Ez
>>>>6M
>>>>0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLK
>>>>n7
>>>>PMnXQSchCb1a36y\_3o9wCTLFVK8KJSs0&s=KekvofgBdK\_OC9kN2fd0pOMp3lPUDQsQwu4f
>>>>Rr
>>>>kc9WU&e= :8098
>>>> 
>>>> 
>>>> ProxyPass balancer://riak\_cluster/
>>>> ProxyPassReverse balancer://riak\_cluster/
>>>> 
>>>> 
>>>>
>>>> What happens is that my streamed queries seem to partially come in
>>>>which makes me think that the load balancer is switching them or
>>>>something. I know I am missing some config value in here but I cannot,
>>>>for the life of me, figure out what it is. Does anyone have an example
>>>>config they could through up?
>>>>
>>>> F
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>>
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_mai
>>>>lm
>>>>an\_listinfo\_riak-2Dusers-5Flists.basho.com&d=AwICAg&c=Sqcl0Ez6M0X8aeM67
>>>>LK
>>>>IiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7PMnXQSch
>>>>Cb
>>>>1a36y\_3o9wCTLFVK8KJSs0&s=MsEIDP9hnsHgV-B\_0DwIZR4xJbEmFwP3M1b3ULbDXiU&e=
>>>
>>>
>>>
>>>--
>>>Turning and turning in the widening gyre
>>>The falcon cannot hear the falconer
>>>Things fall apart; the center cannot hold
>>>Mere anarchy is loosed upon the world
>>>
>>>\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>riak-users mailing list
>>>riak-users@lists.basho.com
>>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_mail
>>>ma
>>>n\_listinfo\_riak-2Dusers-5Flists.basho.com&d=AwICAg&c=Sqcl0Ez6M0X8aeM67LK
>>>Ii
>>>DJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=ZJFOfauLKn7PMnXQSchCb1
>>>a3
>>>6y\_3o9wCTLFVK8KJSs0&s=MsEIDP9hnsHgV-B\_0DwIZR4xJbEmFwP3M1b3ULbDXiU&e=
>>
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> 
>>https://urldefense.proofpoint.com/v2/url?u=http-3A\_\_lists.basho.com\_mailm
>>an\_listinfo\_riak-2Dusers-5Flists.basho.com&d=AwIFaQ&c=Sqcl0Ez6M0X8aeM67LK
>>IiDJAXVeAw-YihVMNtXt-uEs&r=SlFhcqa96v6kZtniOwCKZQ&m=rXthvrEcXXAveYIMrbBRb
>>5k-fI06lSPsavO9MSjrHoY&s=jIfI93rDVYlJ8Bxca0rKKHLMQ0PGTGTnrP5GBl9QVEI&e= 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

