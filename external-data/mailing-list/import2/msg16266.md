---
title: "Java Client: minConnections"
description: ""
project: community
lastmod: 2015-06-30T04:17:56-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16266"
author_name: "Henning Verbeek"
project_section: "mailinglistitem"
sent_date: 2015-06-30T04:17:56-0700
---


I've reported in the past that my application is seeing stange
exceptions when running under even the slightest load (see
http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2015-April/017137.html).

The observation is that some threads simply hang when this exception
occurs, waiting for ever without understanding what is going on. This
unreliability is very bad for my application where a lot of
Riak-related tasks are handled in Threads in the background.

I keep trying to find out what is causing this, but I have no real
clue. But after playing around with
RiakNode.Builder.min/maxConnections, the problem does not occur
anymore.

Specifically, I have now set:
RiakNode riakNode = new RiakNode.Builder()
 .withConnectionTimeout(5000)
 .withMinConnections(2)
 .withMaxConnections(16)
 .withIdleTimeout(500)
 .withBlockOnMaxConnections(false)
 .withRemoteAddress(Config.getInstance().getRiakAddress())
 .withRemotePort(Config.getInstance().getRiakPort())
 .build();

If I leave minConnections at 1, the problem occurs, reproducibly. With
higher values, it doesn't.

Is there maybe an issue in the code? Are connections reaped too quickly?

Cheers,
Henning

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

