---
title: "Re: Timeout when storing"
description: ""
project: community
lastmod: 2011-09-30T09:56:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04941"
mailinglist_parent_id: "msg04938"
author_name: "David Smith"
project_section: "mailinglistitem"
sent_date: 2011-09-30T09:56:08-07:00
---


IIRC, {error, emfile} indicates that the max # of ports (in the erlang
VM) is being exceeded. Try bumping up ERL\_MAX\_PORTS in vm.args.

D.

On Thu, Sep 29, 2011 at 10:52 PM, Jim Adler  wrote:
> Thanks Sean.  I added the ulimit -n 10240 to /etc/default/riak, restarted
> riak, but that didn't work.
>
> Fyodor Yarochkin suggested that the bitcask files could be corrupted, but I
> wasn't sure which bitcask \*.data or \*.hint file to delete.  Any pointers?
>
> Here's the /var/log/riak/erlang.log:
>
> =ERROR REPORT==== 29-Sep-2011::20:27:42 ===
> \*\* State machine <0.369.0> terminating
> \*\* Last event in was {riak\_vnode\_req\_v1,
>                       941983477185933521498468739836666790012612771840,
>                       {fsm,undefined,<0.27704.1>},
>                       {riak\_kv\_put\_req\_v1,
>                        {<<"nodes">>,<<"screen\_name-psych\_ic-info">>},
>
> {r\_object,<<"nodes">>,<<"screen\_name-psych\_ic-info">>,
>                         [{r\_content,
>                           {dict,3,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],
>                              [[<<"content-type">>,97,112,112,108,105,99,97,
>                                116,105,111,110,47,106,115,111,110],
>
> [<<"X-Riak-VTag">>,49,90,120,65,84,100,56,99,48,
>                                80,86,99,111,122,71,79,108,90,70,97,53,87]],
>                              [],[],
>                              [[<<"X-Riak-Last-Modified">>|
>                                {1317,353201,695471}]],
>                              [],[]}}},
>                           <<"{DELETED DATA}">>}],
>                         [{<<2,65,205,48>>,{1,63484572401}}],
>                         {dict,1,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                            [[clean|true]],
>                            []}}},
>                         undefined},
>                        1174401,63484572401,
>                        [{returnbody,true}]}}
> \*\* When State == active
> \*\*      Data  == {state,941983477185933521498468739836666790012612771840,
>                         riak\_kv\_vnode,
>
> {state,941983477185933521498468739836666790012612771840,
>                                riak\_kv\_bitcask\_backend,
>                                {#Ref<0.0.0.3952>,
>
> "/var/lib/riak/bitcask/941983477185933521498468739836666790012612771840"},
>                                {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                        [],[],[]}}},
>                                false},
>                         undefined,none,60000}
> \*\* Reason for termination =
> \*\* {{badmatch,{error,emfile}},
>     [{bitcask\_fileops,create\_file\_loop,3},
>      {bitcask,put,3},
>      {riak\_kv\_bitcask\_backend,put,3},
>      {riak\_kv\_vnode,perform\_put,3},
>      {riak\_kv\_vnode,do\_put,7},
>      {riak\_kv\_vnode,handle\_command,3},
>      {riak\_core\_vnode,vnode\_command,3},
>      {gen\_fsm,handle\_msg,7}]}
>
>
>
> -----Original Message-----
> From: Sean Cribbs [mailto:s...@basho.com]
> Sent: Thu 9/29/2011 3:02 PM
> To: Jim Adler
> Cc: riak-users@lists.basho.com
> Subject: Re: Timeout when storing
>
> Your environment has too few file handles.  Retry starting riak after
> setting `ulimit -n 1024` in the shell.  Also see our wiki page about this
> issue: http://wiki.basho.com/Open-Files-Limit.html  You may need to set this
> limit specifically for the 'riak' user.
>
> Cheers,
>
> --
> Sean Cribbs 
> Developer Advocate
> Basho Technologies, Inc.
> http://www.basho.com/
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>



-- 
Dave Smith
Director, Engineering
Basho Technologies, Inc.
diz...@basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

