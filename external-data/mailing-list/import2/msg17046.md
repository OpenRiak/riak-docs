---
title: "Riak 2.1.3 hooks not invoked"
description: ""
project: community
lastmod: 2016-02-22T07:42:17-0800
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17046"
author_name: "Adam Kovari"
project_section: "mailinglistitem"
sent_date: 2016-02-22T07:42:17-0800
---


Hello

I am trying to enable post commit hook for my bucket type, and I can see it is 
configured in the bucket-type:

➜  idvt-riak git:(master) ✗ riak-admin bucket-type status change\_log
change\_log is active

active: true
allow\_mult: true
basic\_quorum: false
big\_vclock: 50
chash\_keyfun: {riak\_core\_util,chash\_std\_keyfun}
claimant: 'riak@127.0.0.1'
dvv\_enabled: true
dw: quorum
last\_write\_wins: false
linkfun: {modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}
n\_val: 3
notfound\_ok: true
old\_vclock: 86400
postcommit: [{struct,[{<<"mod">>,<<"idvt\_hooks">>},
                      {<<"fun">>,<<"postcommit\_batch">>}]}]
pr: 0
precommit: []
pw: 0
r: quorum
rw: quorum
small\_vclock: 50
w: quorum
young\_vclock: 20



The problem is that this hook never gets invoked.

The module with the hook looks like:

-module(idvt\_hooks).

-export([postcommit\_batch/1]).

postcommit\_batch(Object) ->
    Data = binary\_to\_term(riak\_object:get\_value(Object)),
    file:write\_file("/tmp/riak.tmp", "test"),
    io:format(standard\_error, "~p~n", [Data]),
    Object.


And whenever I create an object in the bucket with this bucket type, no file is 
created and no log message written (not in console.log, nor in error.log, not 
even in erl when running riak attach). I am using riak-erlang-client to create 
an object remotely, using something like this:

Object = riakc\_obj:new({BucketType, Bucket}, Id, Payload, ContentType),
riakc\_pb\_socket:put(Pid, Object),


I am wondering if anyone has experienced similar issue before or if someone 
might have any tips how to debug this problem.


This behaves the same way on os x 10.11.3, latest homebrew build of riak and 
also in debian linux, latest riak.


Thanks


-- 
Adam Kovari

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

