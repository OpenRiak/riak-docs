---
title: "Fw: Issue with Riak Install from Source under SUSE SLES 11 SP11	Version S390 / Problem solved"
description: ""
project: community
lastmod: 2012-04-30T05:48:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07347"
author_name: "claudef"
project_section: "mailinglistitem"
sent_date: 2012-04-30T05:48:02-07:00
---


Dear colleagues,

Problem solved! 

To give you a current feedback about the status of the port. I've succeed 
to ported the RIAK database under the IBM mainframe system z model E114 
running it under the Linux SUSE SLES 11 SP1. I was very happy to find a 
post from Mr. Nobuhiro Iwamatsu (Debian Linux Engineer) who described a 
fix for the module atomic\_pointer.h to reconize the S390 architecture 
(possibly also the Power7). I suggest to Basho to include this fix into 
the latest .github source distribution. 

 I'v applied those changes to the module and the executable now was 
successfully built.. I already did some testing with the Python and Java 
clients , both are working perfectly with a few samples from the Basho 
wiki. 

First of all, my big thanks for the great support from the Erlang user 
group, as well as the Riak user group that both helped me to quickly fix 
those porting issues. 
Regards, 
Claude 



Dear colleagues, 

Thanks for the quick replies in usergroup. 

I've reinstalled the "curl" and "expat" packages both from its source and 
rebuilt the "git" tool using the: 

./configure --with-curl --with-expat 

ps .. yes, for Suse it must be done from source. 

As Jared pointed below, by changing the git protocol to "http://" it 
solved the issue and the "leveldb" package was successfully downloaded. 
This is a good step forwards. 

During the build and a few steps later I got another error message 
telling: "Please implement AtomicPointer for this platform" 

HEAD is now at 14478f1... Rework compaction scoring to ensure L1 doesn't 
exceed the max bytes on that level
make[1]: Entering directory 
`/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/leveldb'
c++ -fPIC -fPIC -I 
/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/system/include -c -I. -I./include 
-fno-builtin-memcmp -DLEVELDB\_PLATFORM\_POSIX -pthread -DOS\_LINUX -O2 
-DNDEBUG -DSNAPPY db/builder.cc -o db/builder.o
In file included from ./port/port\_posix.h:28,
 from ./port/port.h:14,
 from ./db/filename.h:14,
 from db/builder.cc:7:
./port/atomic\_pointer.h:133:2: error: #error Please implement 
AtomicPointer for this platform.
make[1]: \*\*\* [db/builder.o] Error 1
make[1]: Leaving directory 
`/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/leveldb'
ERROR: Command [compile] failed!
make: \*\*\* [rel] Error 1

Any idea how to fix this error? Any dependency with other packages? 

Thanks in advance for your support. 

Regards, 
Claude 


Claude Falbriard 
Certified IT Specialist L2 - Middleware
AMS Hortolândia / SP - Brazil
phone: +55 19 9837 0789
cell: +55 13 8117 3316
e-mail: clau...@br.ibm.com




From: Jared Morrow 
To: clau...@br.ibm.com
Cc: riak-users@lists.basho.com
Date: 28/04/2012 01:17
Subject: Re: Issue with Riak Install from Source under SUSE SLES 11 
SP11 Version S390



Claude,

The issue is not in the rebar.config file for eleveldb, but in a file that 
fetches the original C++ source for leveldb. To fix your issue, simply 
unpack the riak source as you already did then:

$ cd deps/eleveldb

And then make the following changes to 'c\_src/build\_deps.sh':

--- c\_src/build\_deps.sh.orig 2012-04-27 22:06:31.000000000 -0600
+++ c\_src/build\_deps.sh 2012-04-27 22:07:49.000000000 -0600
@@ -37,7 +37,7 @@
 export LD\_LIBRARY\_PATH="$BASEDIR/system/lib:$LD\_LIBRARY\_PATH"
 
 if [ ! -d leveldb ]; then
- git clone git://github.com/basho/leveldb
+ git clone http://github.com/basho/leveldb
 (cd leveldb && git checkout $LEVELDB\_VSN)
 fi
 
Then return to the top-level source directory for Riak and run 'make' and 
things should be better.

-Jared




On Apr 27, 2012, at 12:31 PM, clau...@br.ibm.com wrote:

Dear colleagues, 

Trying to install the RIAK package under a SUSE SLES 11 SP11 Version 
S390. I've downloaded the .tar.gz install file from the BASHO site. First 
I've installed the Erlang package with the --with-ssl option and 
recompiled the openssl package with the "shared" option, as requested by 
the Erlang procedure. 

Using the "make rel" command, I see a successful build running on the 
screen, until a point where the install tries to connect to the GITHUB, 
throwing an error like this: 
 
test -z "/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/system/share/doc/snappy" 
|| /bin/mkdir -p 
"/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/system/share/doc/snappy" 
 /usr/bin/install -c -m 644 ChangeLog COPYING INSTALL NEWS README 
format\_description.txt 
'/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/system/share/doc/snappy' 
test -z "/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/system/include" || 
/bin/mkdir -p "/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/system/include" 
 /usr/bin/install -c -m 644 snappy.h snappy-sinksource.h 
snappy-stubs-public.h snappy-c.h 
'/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/system/include' 
make[2]: Leaving directory 
`/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/snappy-1.0.4' 
make[1]: Leaving directory 
`/opt/riak/riak-1.1.2/deps/eleveldb/c\_src/snappy-1.0.4' 

fatal: unable to connect to github.com: 
github.com[0: 207.97.227.239]: errno=Connection refused 

Cloning into 'leveldb'... 
ERROR: Command [compile] failed! 
make: \*\*\* [rel] Error 1 
 
The riak executable was not yet created under the /bin. 


Question: 
-------------- 
Is there a way to avoid a connect to GITHUB during the package build from 
source, or could you give me a pointer what is causing the connection to 
be refused, as our firewall is configured for outgoing HTTP connections 
(which port and protocol does it use?). 

Thanks in advance for your feedback and support. 

Regards, 
Claude 



Claude Falbriard 
Certified IT Specialist L2 - Middleware
AMS Hortolândia / SP - Brazil
phone: +55 19 9837 0789
cell: +55 13 8117 3316
e-mail: clau...@br.ibm.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

