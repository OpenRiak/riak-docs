---
title: "Re: Memory-backend TTL"
description: ""
project: community
lastmod: 2014-10-06T09:54:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14990"
mailinglist_parent_id: "msg14989"
author_name: "Lucas Grijander"
project_section: "mailinglistitem"
sent_date: 2014-10-06T09:54:12-07:00
---


Hi Luke.

curl -vvv -XGET "http://localhost:8098/riak/ttl\_stg/props"
\* Hostname was NOT found in DNS cache
\* Trying 127.0.0.1...
\* Connected to localhost (127.0.0.1) port 8098 (#0)
> GET /riak/ttl\_stg/props HTTP/1.1
> User-Agent: curl/7.35.0
> Host: localhost:8098
> Accept: \*/\*
>
< HTTP/1.1 404 Object Not Found
\* Server MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained) is not
blacklisted
< Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
< Date: Mon, 06 Oct 2014 16:20:22 GMT
< Content-Type: text/plain
< Content-Length: 10
<
not found
\* Connection #0 to host localhost left intact



I think you wanted to say this command:

curl -vvv -XGET "http://localhost:8098/buckets/ttl\_stg/props"
\* Hostname was NOT found in DNS cache
\* Trying 127.0.0.1...
\* Connected to localhost (127.0.0.1) port 8098 (#0)
> GET /buckets/ttl\_stg/props HTTP/1.1
> User-Agent: curl/7.35.0
> Host: localhost:8098
> Accept: \*/\*
>
< HTTP/1.1 200 OK
< Vary: Accept-Encoding
\* Server MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained) is not
blacklisted
< Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
< Date: Mon, 06 Oct 2014 16:20:57 GMT
< Content-Type: application/json
< Content-Length: 458
<
\* Connection #0 to host localhost left intact
{"props":{"allow\_mult":false,"backend":"ttl\_stg","basic\_quorum":false,"big\_vclock":1,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"dvv\_enabled":false,"dw":"quorum","last\_write\_wins":true,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"ttl\_stg","notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":3,"rw":"quorum","small\_vclock":1,"w":"quorum","young\_vclock":1}}


I have observed an another strange thing with the memory storage (I don't
know if it is related to the TTL problem):

Because of the TTL function is not working fine, I have put a "delete"
function inside the code to emule the TTL feature (I have removed the TTL
from the config), but, randomly, a lot of keys already deleted appear
again. The "delete" function is a "delete" and a "get" of the same key to
assure that the key is deleted. After, from console, I check it with this
command:

curl -X GET http://localhost:8098/buckets/ttl\_stg/keys?keys=true

The problem of this is that i can't reproduce it. It happens randomly. If I
active again the TTL (in all nodes, restarting the cluster) and I remove my
"delete" function (I keep the get to assure that the key is deleted), the
problem is the same, randomly, old already deleted keys (thanks to the TTL)
appear suddenly after a few minutes. The logs are not showing anything.

2014-10-06 18:01 GMT+02:00 Luke Bakken :

> Hi Lucas,
>
> Could you run the following curl statement and provide the full
> transcript of the command and response?
>
> curl -vvv -XGET "http://localhost:8098/riak/ttl\_stg/props"
>
> --
> Luke Bakken
> Engineer / CSE
> lbak...@basho.com
>
>
> On Mon, Oct 6, 2014 at 8:55 AM, Lucas Grijander
>  wrote:
> > Hi Luke,
> >
> > Of course. The request is a simple curl:
> >
> > curl -v -X GET "http://localhost:8098/riak/ttl\_stg/KEY"
> >
> > 2014-10-06 16:59 GMT+02:00 Luke Bakken :
> >>
> >> Hi Lucas,
> >>
> >> Can you confirm that the bucket or bucket-type that contains the
> >> object you're retrieving has been configured to use the "ttl\_stg"
> >> backend?
> >> --
> >> Luke Bakken
> >> Engineer / CSE
> >> lbak...@basho.com
> >>
> >>
> >> On Fri, Oct 3, 2014 at 11:32 AM, Lucas Grijander
> >>  wrote:
> >> > Hello,
> >> >
> >> > I have a memory backend in production with Riak 2.0.1, 4 servers and
> 256
> >> > vnodes. The servers have the same date and time.
> >> >
> >> > I have seen an odd performance with the ttl.
> >> >
> >> > This is the config:
> >> >
> >> > {<<"ttl\_stg">>,riak\_kv\_memory\_backend,
> >> > [{ttl,90},{max\_memory,25}]},
> >> >
> >> > For example, see this GET response in one of the riak servers:
> >> >
> >> > < HTTP/1.1 200 OK
> >> > < X-Riak-Vclock: a85hYGBgzGDKBVIc4otdfgR/7bfIYEpkzGNlKI1efJYvCwA=
> >> > < Vary: Accept-Encoding
> >> > \* Server MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
> is
> >> > not
> >> > blacklisted
> >> > < Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
> >> > < Link: ; rel="up"
> >> > < Last-Modified: Fri, 03 Oct 2014 17:40:05 GMT
> >> > < ETag: "3c8bGoifWcOCSVn0otD5nI"
> >> > < Date: Fri, 03 Oct 2014 17:47:50 GMT
> >> > < Content-Type: application/json
> >> > < Content-Length: 17
> >> >
> >> > If the TTL is 90 seconds, Why the GET doesn't return "not found" if
> the
> >> > difference between "Last-Modified" and "Date" (of the curl request) is
> >> > greater than the TTL?
> >> >
> >> > Thanks in advance!
> >> >
> >> >
> >> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> >> > riak-users mailing list
> >> > riak-users@lists.basho.com
> >> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> >> >
> >
> >
> >
> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > riak-users mailing list
> > riak-users@lists.basho.com
> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> >
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

