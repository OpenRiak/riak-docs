---
title: "Re: Precommit hook function - no error log - how to debug?"
description: ""
project: community
lastmod: 2016-05-17T16:49:57-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17384"
mailinglist_parent_id: "msg17373"
author_name: "Sanket Agrawal"
project_section: "mailinglistitem"
sent_date: 2016-05-17T16:49:57-0700
---


Luke,

Thank you so much for in-depth instructions for setting up multi-node dev
cluster on the same server. I have confirmed that the precommit hook now
works, with your instructions, as non-root user.

Especially, the instructions on doing dev build for 3 nodes were very
helpful! I will run a diff with my original installation to see what might
be the issue, and report back if I find anything.

Thanks again.

On Tue, May 17, 2016 at 5:03 PM, Luke Bakken  wrote:

> Hello everyone -
>
> I have confirmed that precommit hooks are correctly called in a 3-node
> environment, running on the same VM. Riak was both started by and is
> running as a local user account (no "root" permissions necessary).
>
> Overview of the verification process can be found here:
> https://gist.github.com/lukebakken/4c097233e2bfc4bf81233ce5581bde1d
>
> I built Riak using these commands:
>
> git clone git://github.com/basho/riak
> cd riak && git co riak-2.1.4
> make locked-deps
> make stagedevrel DEVNODES=3
>
> Sanket -
>
> At this point, all indication is that this issue is due to something
> specific to your environment. Since Amazon Linux is based on CentOS /
> RedHat, the official packages for one of those distros \*should\* work.
> I recommend that you use three separate servers and install official
> packages on them, which should resolve this issue.
>
> If you start over from a source build \*and\* require multiple nodes to
> run on the same server, please use "make stagedevrel DEVNODES=3"
> rather than "make rel". This should correctly create three dev
> directories, each with a separate Riak ready to run in them. Note that
> this is \*not\* a supported production environment, but is appropriate
> for testing.
>
> Thanks -
>
> --
> Luke Bakken
> Engineer
> lbak...@basho.com
>
> On Tue, May 17, 2016 at 11:10 AM, Luke Bakken  wrote:
> >
> > Riak users subscribers -
> >
> > I would like to add the caveat that this workaround indicates an
> environment-specific issue and not (at this point) a bug in Riak. I am
> working to get to the root cause (pun intended)
> >
> > Thanks,
> > Luke
> > lbak...@basho.com
> >
> > On May 17, 2016 10:54 AM, "Sanket Agrawal" 
> wrote:
> > >
> > > All, the issue is fixed now - the problem is that Riak precommit and
> postcommit hooks seem to work only in root user mode. On AWS, switching
> from ec2-user to root user fixed the precommit trigger issue.
> > > That does raise the question of whether Riak should really be using
> root user account. For example, Postgresql runs fine as non-root user.
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

