---
title: "why leaving riak cluster so slowly and how to accelerate the speed"
description: ""
project: community
lastmod: 2015-08-03T13:54:06-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16346"
author_name: "Changmao.Wang"
project_section: "mailinglistitem"
sent_date: 2015-08-03T13:54:06-0700
---


Hi Raik user group,

 I'm using riak and riak-cs 1.4.2. Last weekend, I added four nodes to cluster 
with 5 nodes. However, it's failed with one of disks 100% full.
As you know bitcask storage engine can not support multifolders.

After that, I restarted the "riak" and leave the cluster with the command 
"riak-admin cluster leave" and "riak-admin cluster plan", and the commit.
However, riak is always doing KV balance after my submit leaving command. I 
guess that it's doing join cluster progress. 

Could you show us how to accelerate the leaving progress? I have tuned the 
"transfer-limit" parameters on 9 nodes.

below is some commands output:
riak-admin member-status
================================= Membership ==================================
Status Ring Pending Node
-------------------------------------------------------------------------------
leaving 6.3% 10.9% 'riak@10.21.136.91'
leaving 9.4% 10.9% 'riak@10.21.136.92'
leaving 6.3% 10.9% 'riak@10.21.136.93'
leaving 6.3% 10.9% 'riak@10.21.136.94'
valid 10.9% 10.9% 'riak@10.21.136.66'
valid 12.5% 10.9% 'riak@10.21.136.71'
valid 18.8% 10.9% 'riak@10.21.136.76'
valid 18.8% 12.5% 'riak@10.21.136.81'
valid 10.9% 10.9% 'riak@10.21.136.86'

 riak-admin transfer\_limit
=============================== Transfer Limit ================================
Limit Node
-------------------------------------------------------------------------------
 200 'riak@10.21.136.66'
 200 'riak@10.21.136.71'
 100 'riak@10.21.136.76'
 100 'riak@10.21.136.81'
 200 'riak@10.21.136.86'
 500 'riak@10.21.136.91'
 500 'riak@10.21.136.92'
 500 'riak@10.21.136.93'
 500 'riak@10.21.136.94'

Any more details for your diagnosing the problem?

Amao

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

