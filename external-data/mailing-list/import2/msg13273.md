---
title: "Re: May allow_mult cause DoS?"
description: ""
project: community
lastmod: 2013-12-17T13:47:49-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13273"
mailinglist_parent_id: "msg13268"
author_name: "Brian Roach"
project_section: "mailinglistitem"
sent_date: 2013-12-17T13:47:49-08:00
---


On Tue, Dec 17, 2013 at 10:28 AM, Viable Nisei  wrote:
> Here you can check our code sample (in java) reproducing this behavior:
> https://bitbucket.org/vsnisei/riak-allow\_mult\_wtf
> ...
> Anyway, looks like that some DoS/DDoS attack approach utilizing this
> behavior may be proposed. We should only know that some
> service/appliation/website is using Riak with allow\_mult buckets then
> provoke concurrent writes into them...

You're writing to the same key over and over without a vector clock.
This is exactly the behavior you should expect. Every write is
creating a new sibling and that will cause what you're seeing.

Because you chose to use a low-level, internal interface of the Java
client instead of IRiakClient, nothing is done automatically for you.

There's two typical patterns when you have concurrent writers:

1) Everything is done in a fetch/modify/write cycle. You fetch the
existing object (and its vector clock), resolve any siblings, apply
modifications, then write it back with the vector clock. This is the
default behavior of the IRiakClient. Note that you \*still\* may need to
resolve siblings on a plain fetch depending on the amount of
concurrent writes you have occurring; you haven't eliminated the
sibling window, just narrowed it.

2) All writes are done without vclocks. When doing a fetch, you
resolve the siblings then write back the resolved version with the
vclock. This is generally not a good approach if you expect to do lots
of writes to the same key as your sample code does because of the same
problem; lots of siblings.

I've written a fairly extensive article on using the Java client and
storing data in Riak - you may want to check it out:
https://github.com/basho/riak-java-client/wiki/Storing-data-in-riak

Thanks,
- Roach

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

