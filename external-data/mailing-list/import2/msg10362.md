---
title: "Re: Delete keys still in Riak db"
description: ""
project: community
lastmod: 2013-03-08T04:09:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10362"
mailinglist_parent_id: "msg10361"
author_name: "Jeremy Raymond"
project_section: "mailinglistitem"
sent_date: 2013-03-08T04:09:24-08:00
---


I've see this behaviour as well. The only thing I've found to be reliable is to 
actually try to read the objects as you describe below and discard the keys if 
notfound in application logic. This obviously sucks if your trying to interact 
with the key index as a light weight way to count items. I've found I have to 
feed the keys to a mapreduce job that will count objects that actually exist to 
get accurate counts. Kinda sounds like a Bloom filter - false positives are 
possible but false negatives are not. So you if do find a key, you actually 
have to check yourself to see if the item actually exists. But if the key isn't 
found, then you know it's not there.

--
Jeremy


On 2013-03-08, at 4:50 AM, Daniel Iwan  wrote:

> Hi
> 
> What worries me though is:
> 
> 1) number of keys changes when i do listing, shouldn't that number be 
> constant?
> If I do:
> http://127.0.0.1:8098/buckets/TX/index/$key/0/zzz' | grep keys | awk 
> '{split($0,a,/,/); for (i in a) print a[i]}' | wc -l
> 
> I'm getting 12, 15 or 20 keys randomly. I believe all of them has been deleted
> 
> 2) Very often when I do get query e.g
> curl 
> 'http://127.0.0.1:8098/riak/TX/eb602276-15c0-2756-ee54-d04b77230afd:af79a2e4-874a-11e2-ba5c-bb1a97c2eacb:1362676559911'
> 
> I will correctly get 'not found'
> 
> But subsequent list as above would still show that key as being in the bucket.
> I believe most of the time key would disappear but very often they just seem 
> to linger.
> Is it possible that list somehow revives the keys?
> 
> D.
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



smime.p7s
Description: S/MIME cryptographic signature
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

