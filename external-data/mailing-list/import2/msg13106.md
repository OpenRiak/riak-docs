---
title: "Re: [Confusing search docs] Enabling search on bucket in Riak 2.0"
description: ""
project: community
lastmod: 2013-11-27T07:24:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13106"
mailinglist_parent_id: "msg13102"
author_name: "Kartik Thakore"
project_section: "mailinglistitem"
sent_date: 2013-11-27T07:24:48-08:00
---


Cool. I did the data activate and emptied out the bucket and set the props
and created a different index. Still no go

Here is the data:
"[2013-11-27T15:21:30] [ERROR] [192.168.1.102] [zach.scratchd.ca] [0] [
thakore.kar...@gmail.com] test"

Here is the search:
http://192.168.1.10:8098/solr/logs/select?q=\*

http://192.168.1.10:8098/solr/logs/select?q=test


No results found


On Tue, Nov 26, 2013 at 8:56 PM, Ryan Zezeski  wrote:

> Kartik,
>
> The pre7 tag incorporates the new bucket type integration. Bucket types
> are a new feature in 2.0 that provide additional namespace support and more
> efficient bucket properties (good for when you have many buckets with
> custom properties). The particular code you are running against requires
> that for data to be indexed in Yokozuna it must be stored under a
> non-default bucket type. Since you are not specifying a type the logs
> bucket lives under the default type where `yz\_index` will not be applied.
> This will be changed for 2.0 so that any type of bucket may be indexed. In
> the meantime, try this:
>
> riak-admin bucket-type create data '{"props":{}}'
> riak-admin bucket-type activate data
>
> curl -X PUT -H 'content-type: application/json' 
> 'http://host:port/types/data/buckets/logs/props'
> -d '{"props":{"yz\_index":"allLogs"}}'
>
> That above will change soon as well. We are attempting to rename most user
> facing parts of Yokozuna to just "search". This means that `yz\_index` will
> soon become `search\_index`. Sorry for the inconvenience as things are in a
> bit of flux leading up to 2.0.
>
> -Z
>
>
> On Tue, Nov 26, 2013 at 5:59 PM, Kartik Thakore  wrote:
>
>> So finally got a chance to try this and I am running into issues (I am on
>> Riak 2.0pre7) btw.
>>
>> I have yz turned on:
>>
>> http://192.168.1.10:8098/yz
>>
>> I created the index with:
>>
>> $ curl -i http://192.168.1.10:8098/yz/index/allLogs
>>
>> HTTP/1.1 200 OK
>> Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
>> Date: Tue, 26 Nov 2013 22:51:15 GMT
>>
>> Content-Type: application/json
>> Content-Length: 41
>>
>> {"name":"allLogs","schema":"\_yz\_default"}
>>
>>
>> And associated the search to the bucket probs:
>>
>> http://192.168.1.10:8098/buckets/logs/props
>>
>> {
>>
>> props:
>> {
>>
>> allow\_mult: true,
>> basic\_quorum: false,
>> big\_vclock: 50,
>> chash\_keyfun:
>> {
>>
>> mod: "riak\_core\_util",
>> fun: "chash\_std\_keyfun"
>>
>> },
>> dw: "quorum",
>> last\_write\_wins: false,
>> linkfun:
>> {
>>
>> mod: "riak\_kv\_wm\_link\_walker",
>> fun: "mapreduce\_linkfun"
>>
>> },
>> n\_val: 3,
>> name: "logs",
>> notfound\_ok: true,
>> old\_vclock: 86400,
>> postcommit: [ ],
>> pr: 0,
>> precommit: [ ],
>> pw: 0,
>> r: "quorum",
>> rw: "quorum",
>> small\_vclock: 50,
>> w: "quorum",
>> young\_vclock: 20,
>> yz\_index: "allLogs"
>>
>> }
>>
>> }
>>
>> I put in a text/plain entry with:
>>
>>
>> http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=47ffPuWSln7VhlTl02raJA
>>
>> [2013-11-26T22:43:26] [ERROR] [192.168.1.102] [0] [
>> thakore.kar...@gmail.com] test
>>
>>
>> http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=6IYwwPE27eUbs8ThaSOcTC
>>
>> [2013-11-26T22:39:59] [ERROR] [192.168.1.102] [0] [
>> thakore.kar...@gmail.com] test
>>
>>
>>
>> But when I search:
>>
>> http://192.168.1.10:8098/search/allLogs?q=\*
>>
>> No results
>>
>> http://192.168.1.10:8098/search/allLogs?q=test
>>
>> No results
>>
>>
>> Whats going on?
>>
>>
>>
>>
>>
>>
>>
>>
>> On Thu, Nov 21, 2013 at 12:45 PM, Ryan Zezeski 
>> wrote:
>> >
>> >
>> >
>> >
>> > On Wed, Nov 20, 2013 at 3:48 PM, Kartik Thakore 
>> wrote:
>> >>
>> >> Thank you.
>> >>
>> >> I am creating indexes with:
>> >>
>> >> curl -i -XPUT http://192.168.1.10:8098/yz/index/allLogs \
>> >> -H 'content-type: application/json' \
>> >> -d '{"schema" : "\_yz\_default", "bucket" : "logs" }'
>> >>
>> >>
>> >> But when I check the index with:
>> >>
>> >> curl -i http://192.168.1.10:8098/yz/index/allLogs
>> >>
>> >> It drops the bucket association
>> >>
>> >> HTTP/1.1 200 OK
>> >> Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
>> >> Date: Wed, 20 Nov 2013 20:45:21 GMT
>> >> Content-Type: application/json
>> >> Content-Length: 41
>> >>
>> >> {"name":"allLogs","schema":"\_yz\_default"}
>> >
>> >
>> > Sorry, that documentation is out of date.
>> >
>> > To associate an index to a bucket you need to set the bucket's
>> properties.
>> >
>> > curl -XPUT -H 'content-type: application/json' '
>> http://localhost:8098/buckets/logs/props' -d
>> '{"props":{"yz\_index":"allLogs"}}'
>> >
>> > You can perform a GET on that same resource to check the yz\_index
>> property is set.
>> >
>> >>
>> >> Also
>> >>
>> >> what is going on here
>> >>
>> >> curl -XPUT -H'content-type:application/json'
>> http://localhost:8098/buckets/people/keys/me \
>> >> -d'{ "name\_s" : "kartik" }'
>> >>
>> >> Why not:
>> >> curl -XPUT -H'content-type:application/json'
>> http://localhost:8098/rial/people/me \
>> >> -d'{ "name\_s" : "kartik" }'
>> >
>> >
>> >
>> > In Riak 1.0.0 we changed the resource from '/riak//' to
>> '/buckets//keys/'. We were supposed to deprecate and
>> eventually remove the old resource but we never did. You can still use the
>> old style but I would recommend using the new style as it is what we use in
>> official docs and there is a chance perhaps the old resources don't stay up
>> to date with the latest features.
>> >
>> >
>> > -Z
>>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

