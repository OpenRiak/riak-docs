---
title: "Re: update objects in precommit hooks"
description: ""
project: community
lastmod: 2011-04-01T10:21:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02844"
mailinglist_parent_id: "msg02828"
author_name: "Damian Dobroczyński"
project_section: "mailinglistitem"
sent_date: 2011-04-01T10:21:05-07:00
---


W dniu 01.04.2011 15:23, Jon Meredith pisze:
> Hi Damian,
> 
> The put FSM is being overhauled at the moment. The current 0.14.1 code
> does not apply the updated values in precommit hooks. In my testing it
> worked ok, but I think that is probably because there were already
> values present in Riak and the changes were included at the vnode level.
> 
> You could try building from source on github, the branch the put FSM was
> refactored on has been pulled in now. There is a QuickCheck test that
> executes code that looks very similar to yours.
> 
> MD = riak\_object:get\_metadata(Obj),
> UpdMD = dict:store(?MD\_USERMETA, [{"X-Riak-Meta-PrecommitHook","was
> here"}], MD),
> riak\_object:update\_metadata(Obj, UpdMD).
> 
> I'd be very interested to hear if it resolves your problem.
> 
> BR, Jon.
> Basho Technologies.
> 

Well, I have not applied this patch yet, but in meanwhile I looked into
the riak\_object source code and found apply\_updates/1. I simply called
this one as the last step in my hook function and it worked. Probably
this is not the correct way of solving this problem, is it?

-- D.


> 2011/4/1 Damian Dobroczyński >
> 
> Hi, list!
> 
> I'm trying to update object metadata dictionary within my precommit hook
> (in Erlang) using `riak\_object:update\_metadata/2' like this:
> 
> Old = riak\_object:get\_metadata(O),
> New = dict:store(<<"X-my-metadata-name">>, Value, Old),
> NewObject = riak\_object:update\_metadata(O, New),
> 
> Unfortunately, the retrieved object does not contain the new keys. Where
> can be the problem?
> 
> -- D.
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com 
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 
> 



0x0CAE3AEB.asc
Description: application/pgp-keys

signature.asc
Description: OpenPGP digital signature
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

