---
title: "Re: Inconsistent results with secondary indexes and spaces"
description: ""
project: community
lastmod: 2012-08-02T17:37:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08169"
mailinglist_parent_id: "msg08104"
author_name: "Paul Gross"
project_section: "mailinglistitem"
sent_date: 2012-08-02T17:37:10-07:00
---


I upgraded riak on the vagrant image, and now I see consistent results 
with spaces. I will follow up with Travis CI to upgrade their images.


Thanks,
Paul
www.pgrs.net

On 7/27/12 1:26 PM, Paul Gross wrote:
It's Ubuntu 11.10. I'm using the Travis Vagrant image, so you can 
download that and try it if you like:


http://files.travis-ci.org/boxes/provisioned/travis-standard.box

The rough steps I did were:

gem install vagrant
vagrant box add travis-standard 
http://files.travis-ci.org/boxes/provisioned/travis-standard.box

vagrant init travis-standard
vagrant up
vagrant ssh

Thanks,
Paul
www.pgrs.net

On 7/27/12 10:01 AM, Kelly McLaughlin wrote:

Paul,

I just tried on OS X and Ubuntu 11.10 and got the expected results on 
both so I'm not sure what could be going on. What version of Ubuntu 
were you trying?


Kelly


On Jul 20, 2012, at 6:12 PM, Paul Gross > wrote:


I'm seeing different results when performing a 2i query with spaces 
on different platforms. On OS X, I find the object. On an ubuntu 
vagrant image used by Travis CI, I do not.


For example, here is my test script:

 require 'riak'

 client = Riak::Client.new
 bucket = client.bucket("test")
 bucket.keys.each { |k| bucket.delete(k) }

 object = ::Riak::RObject.new(bucket, "key")
 object.content\_type = "text/plain"
 object.data = "hello"
 object.indexes = {"with\_space\_bin" => "with space",
 "without\_space\_bin" => "without\_space"}
 object.store

 puts "Found with space" if bucket.get\_index("with\_space\_bin",
 "with space").any?
 puts "Found without space" if
 bucket.get\_index("without\_space\_bin", "without\_space").any?

When I connect to the riak on OS X, it prints both found with space 
and found without. When I connect to the riak running on ubuntu, it 
only prints found without space. I'm running the ruby code from my 
mac both times, so the client library is exactly the same 
(riak-client 1.0.4). Is there a difference in the way riak handles 
spaces on different platforms? Possibly a difference in erlang 
versions? Both riaks are 1.1.2.


Here are the stats on my mac:

% curl localhost:8098/stats
{"vnode\_gets":408,"vnode\_puts":195,"vnode\_index\_reads":638,"vnode\_index\_writes":195,"vnode\_index\_writes\_postings":234,"vnode\_index\_deletes":63,"vnode\_index\_deletes\_postings":225,"read\_repairs":0,"vnode\_gets\_total":408,"vnode\_puts\_total":195,"vnode\_index\_reads\_total":638,"vnode\_index\_writes\_total":195,"vnode\_index\_writes\_postings\_total":234,"vnode\_index\_deletes\_total":63,"vnode\_index\_deletes\_postings\_total":225,"node\_gets":0,"node\_gets\_total":136,"node\_get\_fsm\_time\_mean":0,"node\_get\_fsm\_time\_median":0,"node\_get\_fsm\_time\_95":0,"node\_get\_fsm\_time\_99":0,"node\_get\_fsm\_time\_100":0,"node\_puts":0,"node\_puts\_total":65,"node\_put\_fsm\_time\_mean":0,"node\_put\_fsm\_time\_median":0,"node\_put\_fsm\_time\_95":0,"node\_put\_fsm\_time\_99":0,"node\_put\_fsm\_time\_100":0,"node\_get\_fsm\_siblings\_mean":0,"node\_get\_fsm\_siblings\_median":0,"node\_get\_fsm\_siblings\_95":0,"node\_get\_fsm\_siblings\_99":0,"node\_get\_fsm\_siblings\_100":0,"node\_get\_fsm\_objsize\_mean":0,"node\_get\_fsm\_objsize\_median":0,"node\_get\_fsm\_objsize\_95":0,"nod 
e\_get\_fsm\_objsize\_99":0,"node\_get\_fsm\_objsize\_100":0,"read\_repairs\_total":0,"coord\_redirs\_total":0,"precommit\_fail":0,"postcommit\_fail":0,"cpu\_nprocs":141,"cpu\_avg1":392,"cpu\_avg5":387,"cpu\_avg15":384,"mem\_total":4174500000,"mem\_allocated":4159748000,"nodename":"riak@127.0.0.1","connected\_nodes":[],"sys\_driver\_version":"1.5","sys\_global\_heaps\_size":0,"sys\_heap\_type":"private","sys\_logical\_processors":4,"sys\_otp\_release":"R14B04","sys\_process\_count":1359,"sys\_smp\_support":true,"sys\_system\_version":"Erlang 
R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] 
[async-threads:64] [hipe] 
[kernel-poll:true]","sys\_system\_architecture":"i386-apple-darwin11.2.0","sys\_threads\_enabled":true,"sys\_thread\_pool\_size":64,"sys\_wordsize":8,"ring\_members":["riak@127.0.0.1"],"ring\_num\_partitions":64,"ring\_ownership":"[{'riak@127.0.0.1',64}]","ring\_creation\_size":64,"storage\_backend":"riak\_kv\_eleveldb\_backend","pbc\_connects\_total":0,"pbc\_connects":0,"pbc\_active":0,"ssl\_version":"4.1.6","public\_key\_version":"0.13","runtime\_tools\_version":"1.8.6","basho\_stats\_version":"1.0.2","riak\_search\_version":"1.1.2","riak\_kv\_version":"1.1.2","bitcask\_version":"1.5.1","luke\_version":"0.2.5","erlang\_js\_version":"1.0.2","mochiweb\_version":"1.5.1","inets\_version":"5.7.1","riak\_pipe\_version":"1.1.2","merge\_index\_version":"1.1.0","cluster\_info\_version":"1.2.1","basho\_metrics\_version":"1.0.0","riak\_control\_version":"0.1.0","riak\_core\_version":"1.1.2","lager\_version 
":"1.0.0","riak\_sysmon\_version":"1.1.2","webmachine\_version":"1.9.1","crypto\_version":"2.0.4","os\_mon\_version":"2.2.7","sasl\_version":"2.1.10","stdlib\_version":"1.17.5","kernel\_version":"2.14.5","executing\_mappers":0,"memory\_total":24676960,"memory\_processes":9487312,"memory\_processes\_used":9466216,"memory\_system":15189648,"memory\_atom":1032393,"memory\_atom\_used":1008563,"memory\_binary":509904,"memory\_code":9056222,"memory\_ets":831328,"ignored\_gossip\_total":0,"rings\_reconciled\_total":0,"rings\_reconciled":0,"gossip\_received":0,"handoff\_timeouts":0,"converge\_delay\_min":"undefined","converge\_delay\_max":-1,"converge\_delay\_mean":0,"converge\_delay\_last":"undefined","rebalance\_delay\_min":"undefined","rebalance\_delay\_max":-1,"rebalance\_delay\_mean":0,"rebalance\_delay\_last":"undefined","riak\_kv\_vnodes\_running":64,"riak\_kv\_vnodeq\_min":0,"riak\_kv\_vnodeq\_median":0,"riak\_kv\_vnodeq\_mean":0,"riak\_kv\_vnodeq\_max":0,"riak\_kv\_vnodeq\_total":0,"riak\_pipe\_vnodes\_running":64,"riak\_pipe\_vnodeq\_min":0,"riak\_pi 
pe\_vnodeq\_median":0,"riak\_pipe\_vnodeq\_mean":0,"riak\_pipe\_vnodeq\_max":0,"riak\_pipe\_vnodeq\_total":0}


And here are the stats on ubuntu:

$ curl localhost:8098/stats
{"vnode\_gets":465,"vnode\_puts":219,"vnode\_index\_reads":572,"vnode\_index\_writes":219,"vnode\_index\_writes\_postings":234,"vnode\_index\_deletes":72,"vnode\_index\_deletes\_postings":234,"read\_repairs":0,"vnode\_gets\_total":2433,"vnode\_puts\_total":1161,"vnode\_index\_reads\_total":3498,"vnode\_index\_writes\_total":1161,"vnode\_index\_writes\_postings\_total":1212,"vnode\_index\_deletes\_total":360,"vnode\_index\_deletes\_postings\_total":1206,"node\_gets":0,"node\_gets\_total":811,"node\_get\_fsm\_time\_mean":0,"node\_get\_fsm\_time\_median":0,"node\_get\_fsm\_time\_95":0,"node\_get\_fsm\_time\_99":0,"node\_get\_fsm\_time\_100":0,"node\_puts":0,"node\_puts\_total":387,"node\_put\_fsm\_time\_mean":0,"node\_put\_fsm\_time\_median":0,"node\_put\_fsm\_time\_95":0,"node\_put\_fsm\_time\_99":0,"node\_put\_fsm\_time\_100":0,"node\_get\_fsm\_siblings\_mean":0,"node\_get\_fsm\_siblings\_median":0,"node\_get\_fsm\_siblings\_95":0,"node\_get\_fsm\_siblings\_99":0,"node\_get\_fsm\_siblings\_100":0,"node\_get\_fsm\_objsize\_mean":0,"node\_get\_fsm\_objsize\_median":0,"node\_get\_fsm\_objsize\_95 
":0,"node\_get\_fsm\_objsize\_99":0,"node\_get\_fsm\_objsize\_100":0,"read\_repairs\_total":0,"coord\_redirs\_total":0,"precommit\_fail":0,"postcommit\_fail":0,"cpu\_nprocs":334,"cpu\_avg1":0,"cpu\_avg5":3,"cpu\_avg15":3,"mem\_total":1050632192,"mem\_allocated":607707136,"nodename":"riak@10.0.2.15","connected\_nodes":[],"sys\_driver\_version":"1.5","sys\_global\_heaps\_size":0,"sys\_heap\_type":"private","sys\_logical\_processors":2,"sys\_otp\_release":"R14B04","sys\_process\_count":1557,"sys\_smp\_support":true,"sys\_system\_version":"Erlang 
R14B04 (erts-5.8.5) [source] [smp:2:2] [rq:2] [async-threads:64] 
[kernel-poll:true]","sys\_system\_architecture":"i686-pc-linux-gnu","sys\_threads\_enabled":true,"sys\_thread\_pool\_size":64,"sys\_wordsize":4,"ring\_members":["riak@10.0.2.15"],"ring\_num\_partitions":64,"ring\_ownership":"[{'riak@10.0.2.15',64}]","ring\_creation\_size":64,"storage\_backend":"riak\_kv\_eleveldb\_backend","pbc\_connects\_total":0,"pbc\_connects":0,"pbc\_active":0,"ssl\_version":"4.1.6","public\_key\_version":"0.13","runtime\_tools\_version":"1.8.6","basho\_stats\_version":"1.0.2","riak\_search\_version":"1.1.2","riak\_kv\_version":"1.1.2","bitcask\_version":"1.5.1","luke\_version":"0.2.5","erlang\_js\_version":"1.0.2","mochiweb\_version":"1.5.1","inets\_version":"5.7.1","riak\_pipe\_version":"1.1.2","merge\_index\_version":"1.1.0","cluster\_info\_version":"1.2.1","basho\_metrics\_version":"1.0.0","riak\_control\_version":"0.1.0","riak\_core\_version":"1.1.2","lager\_version":"1.0 
.0","riak\_sysmon\_version":"1.1.2","webmachine\_version":"1.9.1","crypto\_version":"2.0.4","os\_mon\_version":"2.2.7","sasl\_version":"2.1.10","stdlib\_version":"1.17.5","kernel\_version":"2.14.5","executing\_mappers":0,"memory\_total":14504136,"memory\_processes":6056540,"memory\_processes\_used":6043068,"memory\_system":8447596,"memory\_atom":693009,"memory\_atom\_used":674176,"memory\_binary":446456,"memory\_code":4876533,"memory\_ets":430264,"ignored\_gossip\_total":0,"rings\_reconciled\_total":0,"rings\_reconciled":0,"gossip\_received":0,"handoff\_timeouts":0,"converge\_delay\_min":"undefined","converge\_delay\_max":-1,"converge\_delay\_mean":0,"converge\_delay\_last":"undefined","rebalance\_delay\_min":"undefined","rebalance\_delay\_max":-1,"rebalance\_delay\_mean":0,"rebalance\_delay\_last":"undefined","riak\_kv\_vnodes\_running":64,"riak\_kv\_vnodeq\_min":0,"riak\_kv\_vnodeq\_median":0,"riak\_kv\_vnodeq\_mean":0,"riak\_kv\_vnodeq\_max":0,"riak\_kv\_vnodeq\_total":0,"riak\_pipe\_vnodes\_running":64,"riak\_pipe\_vnodeq\_min":0,"riak\_pipe\_vnodeq 
\_median":0,"riak\_pipe\_vnodeq\_mean":0,"riak\_pipe\_vnodeq\_max":0,"riak\_pipe\_vnodeq\_total":0,"riak\_search\_vnodes\_running":64,"riak\_search\_vnodeq\_min":0,"riak\_search\_vnodeq\_median":0,"riak\_search\_vnodeq\_mean":0,"riak\_search\_vnodeq\_max":0,"riak\_search\_vnodeq\_total":0}


These failures are reliable, so I can gather any extra data you'd like.

For context, these differences are breaking the curator build on 
Travis CI. The tests run fine locally, but break on the build 
server: http://travis-ci.org/#!/braintree/curator/jobs/1770794


Thanks,
Paul
www.pgrs.net
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com 
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com






\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

