---
title: "Re: riak 2.2.3, allow_mult=false but still siblings"
description: ""
project: community
lastmod: 2019-04-15T07:57:36-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18611"
mailinglist_parent_id: "msg18610"
author_name: "Russell Brown via riak-users"
project_section: "mailinglistitem"
sent_date: 2019-04-15T07:57:36-0700
---


That's actually very useful, I hope you are OK if that I re-add back in 
the list so that this thread can be indexed/used in future.



On 15/04/2019 15:14, ジョハンガル wrote:
After -X DELETE types/???/buckets/???/props the properties reverted to 
the bucket type properties!

​
Thank you a lot!
​

-----Original Message-----
\*From:\* "Russell Brown"
\*To:\* "ジョハンガル";
\*Cc:\*
\*Sent:\* 2019-04-15 (月) 19:10:24 (GMT+09:00)
\*Subject:\* Re: riak 2.2.3, allow\_mult=false but still siblings

I'm sorry, I don't know, I've not worked much on that code.


Here is how I assume it works


1, create a bucket type T (allow\_mult=true by default)

2, create a bucket B of type T (allow\_mult "inherited" from T)

3, change property allow\_mult of B to false (it is false on B only, not T)


Default buckets have a default set of properties, allow\_mult=false

Typed buckets have a default set of properties, allow\_mult=true


buckets (named) inherit their Types properties, unless you change the
bucket properties.


On 15/04/2019 09:41, ジョハンガル wrote:
> So if I understand well
> There are basic bucket properties who are ignored
I don't understand "who are ignored" bucket properties are not ignored
> /buckets/???/props
> ​
> Then there are bucket types
> riak-admin bucket-type ...​
> ​
> Then there are bucket type properties under that type
> /types/???/buckets/???/props
> ​
> Are /types/??A/buckets/???/props and /types/??B/buckets/???/props
> different

Only if you changed the properties of A or B on creation of the type.
And further you can change the properties of buckets that or type A or B
(unless the types has immutable properties (like the allow\_mult property
of a datatyped bucket))


> ​
> Just to make sure, I am quite confused.
> ​
> If I run -X DELETE /types/???/buckets/???/props would it revert it to
> the default bucket type properties??

I don't think so, no, I don't think you can delete bucket props that
way. You need to set the properties you want


If it helps, I'm confused too. What do the docs say on the matter?


Cheers


Russell

> ​
>
> -----Original Message-----
> \*From:\* "Russell Brown"
> \*To:\* "ジョハンガル";
> \*Cc:\*
> \*Sent:\* 2019-04-15 (月) 17:14:34 (GMT+09:00)
> \*Subject:\* Re: riak 2.2.3, allow\_mult=false but still siblings
>
> That bucket has allow\_mult=true, so the siblings are expected. How the
> bucket props managed to be changed from the bucket-type defaults is
> worth investigating though.
>
>
> On 15/04/2019 08:49, ジョハンガル wrote:
> > Sorry for the late answer!
> > ​
> > ​​
> > ​
> > Is it a case of bucket props overriding the type?
> > We deleted all the bucket props recently. (curl -X DELETE .... /props)
> >
> > -----Original Message-----
> > \*From:\* "Russell Brown"
> > \*To:\* "ジョハンガル";
> > \*Cc:\*
> > \*Sent:\* 2019-04-13 (土) 05:05:33 (GMT+09:00)
> > \*Subject:\* Re: riak 2.2.3, allow\_mult=false but still siblings
> >
> > Can I see the bucket properties for the bucket in question, please?
> > Buckets can override their type's properties, iirc
> >
> >
> > Cheers
> >
> > Russell
> >
> >
> > On 12/04/2019 13:36, ジョハンガル wrote:
> > > for the bucket type definition:
> > > ​
> > > ​
> > > For the headers
> > > ​
> > > ​
> > > These buckets formally allowed siblings (more of a default thing 
than

> > > anything).
> > > Following sibling explosion problems we modified all buckets that
> > > received updates from a single source to not allow siblings anymore.
> > > During some time we had bucket properties and types used at the same
> > > type, following the previously mentioned (property broadcast bug)
> > > repeatedly bringing our machines down, we identified the 
problem, made

> > > sure everything run with >2.0 clients, reset (deleted) all bucket
> > > properties and made sure to use types. Then the cluster became 
stable.

> > > Then while monitoring I noticed these siblings that shouldn't be.
> > > ​
> > > The entire content of these buckets is batch regenerated multiple
> > > times by minute (~1 to 10). There is very little total content 
(a few

> > > megabytes in that bucket) and the machines used are ridiculously
> > > overprovisionned (many cores 64gb ram machines).
> > > ​
> > >
> > > -----Original Message-----
> > > \*From:\* "Russell Brown"
> > > \*To:\* "ジョハンガル";
> > > ;
> > > \*Cc:\*
> > > \*Sent:\* 2019-04-12 (金) 20:47:56 (GMT+09:00)
> > > \*Subject:\* Re: riak 2.2.3, allow\_mult=false but still siblings
> > >
> > > Can you let us see the bucket type definition, please?
> > >
> > >
> > > Can you show me the headers from the curl command that returns
> siblings,
> > > please?
> > >
> > >
> > > I want to say that what you are seeing is unpossible (from what I
> > > remember of the code.) But I don't remember the 2.2.3 release 
process,

> > > and I'd like to see some more evidence before I look at the code
> again.
> > >
> > >
> > > I wonder if you remember the history of the bucket/bucket type in
> > > question. Has it had changes to allow\_mult etc?
> > >
> > >
> > > Cheers
> > >
> > > Russell
> > >
> > > On 12/04/2019 12:29, ジョハンガル wrote:
> > > > Hello,
> > > > ​
> > > > I would be thankful is somebody could help me with some weird
> > > > abnormalities.
> > > > ​
> > > > curl https://~~~/types/THE-TYPE/bucket/~~~/keys/~~~ returns 
siblings

> > > > ​
> > > > However the corresponding type has "allow\_mult" set to false...
> > > > ​​
> > > > The phenomenon appear with both
> > > > "last\_write\_wins=true;dvv\_enabled=false" and
> > > > "last\_write\_wins=false;dvv\_enabled=true".
> > > > The backend is leveldb (in a multi configuration), secondary 
indices

> > > > are used.
> > > > ​
> > > > The cluster is an old cluster (pre 2.0) that received rolling
> updates
> > > > to 2.0 (remove node, reinstall riak with new config, read node).
> > > > Currently 2.2.3
> > > > We used to hit that problem a lot until we found out about it and
> > > > fixed the problem https://github.com/basho/yokozuna/issues/389
> > > > I don't if it has any kind of relevancy though.
> > > > ​
> > > > Does somebody have some kind of hint? Or diagnostic command I 
might

> > > > run? Am I missing something obvious?
> > > > ​
> > > > Best regards,
> > > > ​
> > > >
> > > >
> > > > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > > > riak-users mailing list
> > > > riak-users@lists.basho.com
> > > > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> > >
> >
>



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

