---
title: "Re: Re-building a dev riak tree"
description: ""
project: community
lastmod: 2012-02-16T08:33:40-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06623"
mailinglist_parent_id: "msg06622"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2012-02-16T08:33:40-08:00
---


And, for posterity, here's the complete script that I use to rebuild Riak
locally:

#!/bin/bash

echo 'Making deps';
make deps;

echo 'Making all';
make all;

for i in 1 2 3 4;
do for dep in deps/\*;
 do rm -rf dev/dev$i/lib/`basename $dep`-\* && ln -sf `pwd -P`/$dep
dev/dev$i/lib;
 done;
done;

---
Jeremiah Peschka
Managing Director, Brent Ozar PLF, LLC


On Thu, Feb 16, 2012 at 8:24 AM, Jeremiah Peschka <
jeremiah.pesc...@gmail.com> wrote:

> Cool! Thanks for your help on this. Now I can keep breaking future
> versions of Riak.
>
> ---
> Jeremiah Peschka
> Managing Director, Brent Ozar PLF, LLC
>
>
> On Thu, Feb 16, 2012 at 7:30 AM, Sean Cribbs  wrote:
>
>> Shoot. That make target should probably have its dependencies changed so
>> it doesn't rebuild devrel unless necessary. Anyway, here's an equivalent
>> bash script that does what you want. Run it from the top-level directory of
>> your clone.
>>
>> for i in 1 2 3 4; do for dep in deps/\*; do rm -rf dev/dev$i/lib/`basename
>> $dep`-\* && ln -sf `pwd -P`/$dep dev/dev$i/lib; done; done
>>
>> Yes, you should be sure to run get-deps and update-deps to get
>> riak\_control and such, before running the previous command.
>>
>> On Thu, Feb 16, 2012 at 1:51 AM, Jeremiah Peschka <
>> jeremiah.pesc...@gmail.com> wrote:
>>
>>> I think I am tired or something, `make stagedevrel` produces an error:
>>>
>>> $ make stagedevrel
>>> mkdir -p dev
>>> (cd rel && ../rebar generate target\_dir=../dev/dev1
>>> overlay\_vars=vars/dev1\_vars.config)
>>> ==> rel (generate)
>>> ERROR: Release target directory
>>> "/Users/jeremiah/Projects/riak/rel/../dev/dev1" already exists!
>>> make: \*\*\* [dev1] Error 1
>>>
>>> ---
>>> Jeremiah Peschka
>>> Managing Director, Brent Ozar PLF, LLC
>>>
>>>
>>> On Wed, Feb 15, 2012 at 10:42 PM, Jeremiah Peschka <
>>> jeremiah.pesc...@gmail.com> wrote:
>>>
>>>> Thanks!
>>>>
>>>> I assume, too, that since riak control is now a requirement I should do
>>>> `make deps`, `make all`, `make stagedevrel` ?
>>>>
>>>> ---
>>>> Jeremiah Peschka
>>>> Managing Director, Brent Ozar PLF, LLC
>>>>
>>>>
>>>> On Wed, Feb 15, 2012 at 10:31 PM, Sean Cribbs  wrote:
>>>>
>>>>> Jeremiah,
>>>>>
>>>>> `make stagedevrel` is what you want.
>>>>>
>>>>> On Thu, Feb 16, 2012 at 1:23 AM, Jeremiah Peschka <
>>>>> jeremiah.pesc...@gmail.com> wrote:
>>>>>
>>>>>> Let's say that I have a copy of the riak 1.0.0 source in
>>>>>> ~/src/basho/riak and that I've built a local 4 node clustering using 
>>>>>> `make
>>>>>> devrel`. I've gone through and made some configuration changes for 
>>>>>> working
>>>>>> on the .NET client. Now that 1.1 is out, I'd like to test the 1.1 branch
>>>>>> against my current client code.
>>>>>>
>>>>>> Is there a way to rebuild my 4 node cluster without wiping out my
>>>>>> configuration?
>>>>>>
>>>>>> I spoke with Ryan about this at Surge and he showed me a trick, but I
>>>>>> can't recall how to get this working. Any help would be appreciated.
>>>>>> ---
>>>>>> Jeremiah Peschka
>>>>>> Managing Director, Brent Ozar PLF, LLC
>>>>>>
>>>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>>>> riak-users mailing list
>>>>>> riak-users@lists.basho.com
>>>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Sean Cribbs 
>>>>> Software Engineer
>>>>> Basho Technologies, Inc.
>>>>> http://basho.com/
>>>>>
>>>>>
>>>>
>>>
>>
>>
>> --
>> Sean Cribbs 
>> Software Engineer
>> Basho Technologies, Inc.
>> http://basho.com/
>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

