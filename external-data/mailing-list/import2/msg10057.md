---
title: "Re: About the node show down when occur riak_searc error of	too_many_resut"
description: ""
project: community
lastmod: 2013-02-08T15:37:17-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10057"
mailinglist_parent_id: "msg09866"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2013-02-08T15:37:17-08:00
---


Jason,

Riak Search has a limit of 100k results at which point it halts processing
by throwing an exception. It does this to protect itself from having to
build an indeterminately sized list and then sort it. You can raise this
limit but you might start seeing large process heaps using lots of CPU for
GC or sorting.

I'm having a bit of trouble understanding your second point. Are you
saying that the node goes down after this error? The only reason I see
that happening is if you run this query (or others that also match large
results) many times in succession causing max restart events (I'm referring
to Erlang/OTP supervisor/worker restarts) to occur eventually reaching up
to the root supervisor and thus exiting.

-Z


On Tue, Jan 22, 2013 at 5:16 AM, 郎咸武  wrote:

> Hi all
>
> The default value of 100,000 can be custom tuned with the
> max\_search\_results setting in the etc/app.config file.
>
> I using the default value. There are 1,000,000 K/V. I only
> invoke riakc\_pb\_socket:search(Pid, Bucket, "name:u1\*")[1] when the node
> shutdown[2].
> The error is an obvious out of the default value.
> But the node is showdown. This is really out of my expectation.
>
> Is this a bug?
> Who can give me some advice?
>
> Cheers ,Jason
>
>
> The enviroment:
> Erlang R14B04 (erts-5.8.5)
> FreeBSD meda082 9.0-RELEASE FreeBSD 9.0-RELEASE #0: Tue Jan 3 07:46:30
> UTC 2012
> riak1.2
> riakclint 1.3
>
> [1]{error,<<"Error processing incoming message: throw:{too\_many\_results,\n
> {scope"...>>}
>
> [2]
> (riak@127.0.0.1)1> 17:03:55.626 [error] gen\_server <0.2736.0> terminated
> with reason:
> {throw,{too\_many\_results,{scope,#Ref<0.0.0.8359>,"test\_riak\_json
>
> ","value",{scope,#Ref<0.0.0.8358>,undefined,"name",{range\_sized,#Ref<0.0.0.8362>,{inclusive,<<"u1">>},{inclusive,<<"u1\377">>},all,undefined}}}},[{ria
>
> k\_search\_client,'-search/7-fun-0-',4},{riak\_search\_client,fold\_results,5},{riak\_search\_client,search,8},{riak\_search\_client,search\_doc,8},{riak\_search
>
> \_utils,run\_query,7},{riak\_search\_pb\_query,run\_query,7},{riak\_search\_pb\_query,process,2},{riak\_api\_pb\_server,process\_message,4}]}^M^M
> 17:03:55.643 [error] CRASH REPORT Process <0.2736.0> with 1 neighbours
> exited with reason:
> {throw,{too\_many\_results,{scope,#Ref<0.0.0.8359>,"test\_riak
>
> \_json","value",{scope,#Ref<0.0.0.8358>,undefined,"name",{range\_sized,#Ref<0.0.0.8362>,{inclusive,<<"u1">>},{inclusive,<<"u1\377">>},all,undefined}}}},
>
> [{riak\_search\_client,'-search/7-fun-0-',4},{riak\_search\_client,fold\_results,5},{riak\_search\_client,search,8},{riak\_search\_client,search\_doc,8},{riak\_s
> earch\_utils,run\_query,7},{riak\_search\_pb\_query,run\_query,7},{riak\_search\_pb\_query,process,2},{riak\_api\_pb\_server,process\_message,4}]}
> in gen\_server:te
> rminate/6^M^M
>
>
>
> --
> 只为成功找方法，不为失败找理由
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

