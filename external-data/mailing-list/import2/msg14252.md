---
title: "Re: Loosing data with bucket types,	custom backend and active data entropy"
description: ""
project: community
lastmod: 2014-05-21T04:35:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14252"
mailinglist_parent_id: "msg14251"
author_name: "Oleksiy Krivoshey"
project_section: "mailinglistitem"
sent_date: 2014-05-21T04:35:24-07:00
---


I think I've found that rare case when I don't get deletedvlock before
'put' in my code.

Sorry for bothering everyone :)


On 21 May 2014 14:15, Oleksiy Krivoshey  wrote:

> I think its a different issue and might be my own misunderstanding:
>
> The actual order of operations is (all same key):
>
> 1. write
> 3. read
> 4. delete
> 5. write
> 6. read - failed
>
> So it might be tombstone problem. However I always do 'get' with
> 'deletedvclock: true' before 'put' or 'delete' and provide a vclock.
>
>
> On 21 May 2014 12:10, Oleksiy Krivoshey  wrote:
>
>> Hi,
>>
>> I have a quite rare problem of lost data in Riak 2.0 beta1. I can hardly
>> replicate it but when it happens it looks like this order of operations:
>>
>> (All operations are using bucket types).
>>
>> 1. write some data (KEY1) - ok
>> 2. read that data (KEY1) - ok
>> 3. message appears in riak console.log:
>> 2014-05-21 08:15:03.328 [info]
>> <0.15793.157>@riak\_kv\_exchange\_fsm:key\_exchange:256 Repaired 1 keys during
>> active anti-entropy exchange of
>> {1450083655789255239155218544960687058564870569984,3} between {0,'
>> riak@10.0.1.1'} and {1450083655789255239155218544960687058564870569984,'
>> riak@10.0.1.3'}
>> 4. read data (KEY1) - ok
>> 5. write new data (KEY1) - ok
>> 6. read data (KEY1) - no such key
>>
>> All happens within 10-20 seconds.
>>
>> Can someone give any hint on this?
>>
>> Running riak2.0.0\_beta1 on Ubuntu 14.04
>>
>> Bucket type:
>>
>> {"props":{"backend":"fs\_chunks","allow\_mult":"false"}}
>>
>> fs\_chunks backend:
>>
>> {<<"fs\_chunks">>, riak\_kv\_bitcask\_backend, [
>> {data\_root, "/var/lib/riak/fs\_chunks"}
>> ]}
>>
>> Thanks!
>>
>> --
>> Oleksiy Krivoshey
>>
>
>
>
> --
> Oleksiy Krivoshey
>



-- 
Oleksiy Krivoshey
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

