---
title: "Re: Odd question"
description: ""
project: community
lastmod: 2012-12-07T06:35:22-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09470"
mailinglist_parent_id: "msg09469"
author_name: "Martin Streicher"
project_section: "mailinglistitem"
sent_date: 2012-12-07T06:35:22-08:00
---


I have a test case that demonstrates the issue now...

 describe 'Copy Integrity' do
 it 'remains unique' do
 z = create :zid
 i = create :identity, zid\_id: z.key
 Identity.find\_by\_index('zid\_id', z.key).count.should eq(1)

 i.email = 'uni...@unique.com'
 i.save
 Identity.find\_by\_index('zid\_id', z.key).count.should eq(1)
 end
 end

The answer at bottom is 2, not 1. 


On Dec 7, 2012, at 9:19 AM, Martin Streicher wrote:

> 
> Thanks for the help earlier this week. I have an odd question...
> 
> I have an Identity model being used with Omniauth::Identity. All is well -- 
> when someone registers, the credentials (email and encrypted password) are 
> saved in Riak. 
> 
> However, if in some other code, I retrieve an Identity record by an indexed 
> field and save it, a copy of the record seems to crop up with the new email 
> field value.
> 
> @identity = Identity.find\_by\_index('zid\_id', @zid.key).first
> @identity.email = params[:profile][:email]
> @identity.save
> 
> In other words, if I start with record A, I get A and now B, where B's email 
> field is different. 
> 
> Ideas?
> 
> 
> 
> 
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

