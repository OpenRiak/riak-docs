---
title: "Re: Initializing a commit hook"
description: ""
project: community
lastmod: 2016-11-18T16:59:11-0800
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17771"
mailinglist_parent_id: "msg17769"
author_name: "Mav erick"
project_section: "mailinglistitem"
sent_date: 2016-11-18T16:59:11-0800
---


No luck :(

I set up a bucket type called test-bucket-type. I did NOT set data type.
I set the hooks
Ran your curl -X PUT. The Hook was not called. Tried several times, no luck
I changed the curl to hit my non-typed bucket, and the commit hook hit

$ riak-admin bucket-type list
default (active)
test-bucket-type (active)
sets (active)
maps (active)
counters (active)

I made sure the hooks are applied
Also note there is \*\*no\*\* data type associated
{
 "props": {
 "active": true,
 "allow\_mult": true,
 "basic\_quorum": false,
 "big\_vclock": 50,
 "chash\_keyfun": {
 "fun": "chash\_std\_keyfun",
 "mod": "riak\_core\_util"
 },
 "claimant": "riak@10.243.44.165",
 "dvv\_enabled": true,
 "dw": "quorum",
 "last\_write\_wins": false,
 "linkfun": {
 "fun": "mapreduce\_linkfun",
 "mod": "riak\_kv\_wm\_link\_walker"
 },
 "n\_val": 3,
 "notfound\_ok": true,
 "old\_vclock": 86400,
 "postcommit": [],
 "pr": 0,
 "precommit": [
 {
 "fun": "precommit\_hook",
 "mod": "commit\_hooks"
 }
 ],
 "pw": 0,
 "r": "quorum",
 "rw": "quorum",
 "small\_vclock": 50,
 "w": "quorum",
 "young\_vclock": 20
 }
}

curl -4vvv -H 'Content-Type: text/plain'
localhost:8098/types/test-bucket-type/buckets/test-bucket/keys/test-key -d
"THIS IS THE DATA FOR TEST-KEY"


On 18 November 2016 at 18:24, Luke Bakken  wrote:

> Thanks for correcting that. Everything looks set up correctly.
>
> How are you saving objects? If you're using HTTP, what is the URL?
>
> Can you associate your precommit hook with a bucket type
> ("test-bucket-type" below) that is \*not\* set up for the "map" data
> type and see if your hook is called correctly?
>
> This command should save an object and trigger the precommit hook
> \*with\* a bucket and bucket type:
>
> curl -4vvv -H 'Content-Type: text/plain'
> localhost:8098/types/test-bucket-type/buckets/test-bucket/keys/test-key
> -d "THIS IS THE DATA FOR TEST-KEY"
>
> Luke
>
> On Fri, Nov 18, 2016 at 3:03 PM, Mav erick  wrote:
> >
> > \* Hostname was NOT found in DNS cache
> > \* Trying 127.0.0.1...
> > \* Connected to localhost (127.0.0.1) port 8098 (#0)
> >> GET /types/maps/props HTTP/1.1
> >> User-Agent: curl/7.35.0
> >> Host: localhost:8098
> >> Accept: \*/\*
> >>
> > < HTTP/1.1 200 OK
> > < Vary: Accept-Encoding
> > \* Server MochiWeb/1.1 WebMachine/1.10.6 (no drinks) is not blacklisted
> > < Server: MochiWeb/1.1 WebMachine/1.10.6 (no drinks)
> > < Date: Fri, 18 Nov 2016 22:27:56 GMT
> > < Content-Type: application/json
> > < Content-Length: 545
> > <
> > \* Connection #0 to host localhost left intact
> > {"props":{"active":true,"allow\_mult":true,"basic\_
> quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod"
> > :"riak\_core\_util","fun":"chash\_std\_keyfun"},"claimant":"
> riak@10.243.44.165","datatype":"map","dvv\_en
> > abled":true,"dw":"quorum","last\_write\_wins":false,"
> linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"m
> > apreduce\_linkfun"},"n\_val":3,"notfound\_ok":true,"old\_vclock"
> :86400,"postcommit":[],"pr":0,"precommit
> > ":[{"mod":"commit\_hooks","fun":"precommit\_hook"}],"pw":0,"r"
> :"quorum","rw":"quorum","smal
> > l\_vclock":50,"w":"quorum","young\_vclock":20}}
> >
> > $ curl -4vvv localhost:8098/types/maps/buckets/testbucket/props
> > \* Hostname was NOT found in DNS cache
> > \* Trying 127.0.0.1...
> > \* Connected to localhost (127.0.0.1) port 8098 (#0)
> >> GET /types/maps//buckets/testbucket/props HTTP/1.1
> >> User-Agent: curl/7.35.0
> >> Host: localhost:8098
> >> Accept: \*/\*
> >>
> > < HTTP/1.1 200 OK
> > < Vary: Accept-Encoding
> > \* Server MochiWeb/1.1 WebMachine/1.10.6 (no drinks) is not blacklisted
> > < Server: MochiWeb/1.1 WebMachine/1.10.6 (no drinks)
> > < Date: Fri, 18 Nov 2016 22:59:22 GMT
> > < Content-Type: application/json
> > < Content-Length: 565
> > <
> > \* Connection #0 to host localhost left intact
> > {"props":{"name":"testbucket","active":true,"allow\_mult":
> true,"basic\_quorum":false,"big\_vclock":
> > chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_
> keyfun"},"claimant":"riak@10.243.44.165",
> > atype":"map","dvv\_enabled":true,"dw":"quorum","last\_
> write\_wins":false,"linkfun":{"mod":"riak\_kv\_
> > ink\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"notfound\_
> ok":true,"old\_vclock":86400,"postcomm
> > [],"pr":0,"precommit":[{"mod":"commit\_hooks","fun":"
> precommit\_hook"}],"pw":0,"r":"quo
> > ,"rw":"quorum","small\_vclock":50,"w":"quorum","young\_vclock":20}}$
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

