---
title: "Using Fog with Ruby"
description: ""
project: community
lastmod: 2013-04-08T14:36:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10762"
author_name: "Michael Holt"
project_section: "mailinglistitem"
sent_date: 2013-04-08T14:36:55-07:00
---


I have a small script that I am trying to set up that can read usage stats in 
Ruby Fog. The script is largely pieced together from examples from the Basho 
site and Fog github project. The script is below.



The issue I am running into is the following error:


`AccessDenied`
Access Denied
/riak-cs/usage/OJIPWXM698VYGEMGZLIV/bx/20130401T000000Z/20130430T235959Z.abj.20130407T213209Z.20130408T213209Z





The list user (users = provisioning.list\_users.body) works. The key and secret 
is for the admin user.



Why would I get an Access Denied for the admin user?



--------------RUBY CODE-------------

require 'rubygems'

require 'fog'



def show\_usage(usage, key)

 utilization = usage.get\_usage( "/usage/#{key}",

 :types => [:access, :storage]

 )



 objects = 0

 bytes = 0



 # Retrieve Storage information

 utilization.body['Storage']['Samples'][0].each do |k,v|

 # Sum the # of objects and bytes stored from each user bucket 
for per tenant totals

 if v.is\_a?(Hash) # To ignore StartTime & EndTime

 objects += v['Objects']

 bytes += v['Bytes']

 end

 end



 puts " showUsage objects: #{objects}"

 puts " showUsage bytes: #{bytes}"

end



configuration = {

 :riakcs\_access\_key\_id => "OJIPWXM698VYGEMGZLIV",

 :riakcs\_secret\_access\_key => "fTbOq8WIBiHrUnHxBgRLDIOyo4yK2Qysrx3vjA==",

 :host => 'localhost',

 :port => 80,

 :scheme => "http"

}



Excon.defaults[:ssl\_verify\_peer] = false



# Requests for User Provision and Usage information

provisioning = Fog::RiakCS::Provisioning.new(configuration)

usage = Fog::RiakCS::Usage.new(configuration)





users = provisioning.list\_users.body



# The following block of code displays all available information for every user

users.each do | user |



 utilization = 
usage.get\_usage("/usage/#{user['key\_id']}/bx/20130401T000000Z/20130430T235959Z",
 :types => [:access, :storage])



 puts 
"ยง=================================================================================ยง"

 puts " name: #{user['name']}"

 puts " display\_name: #{user['display\_name']}"

 puts " email: #{user['email']}"

 puts " id: #{user['id']}"

 puts " key\_id: #{user['key\_id']}"

 puts " key\_secret: #{user['key\_secret']}"

 puts " status: #{user['status']}"

 show\_usage usage, user['key\_id']

end

puts 
"ยง=================================================================================ยง"



--

Michael Holt


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

