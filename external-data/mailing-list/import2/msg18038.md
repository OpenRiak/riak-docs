---
title: "Re: Riak: reliable object deletion"
description: ""
project: community
lastmod: 2017-02-28T08:30:50-0800
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18038"
mailinglist_parent_id: "msg18024"
author_name: "al so"
project_section: "mailinglistitem"
sent_date: 2017-02-28T08:30:50-0800
---


Implications when \*delete\_mode \*set to 'keep'\*?\*


On Thu, Feb 23, 2017 at 9:53 PM, al so  wrote:

> Present both in Solr and Riak. It's a 1-way replication in MDC. MDC is not
>> the cause unless there is a bug there as well.
>>
>>
>> On Thu, Feb 23, 2017 at 6:02 AM, Fred Dushin  wrote:
>>
>>> Running a Solr query has no impact on writes -- Riak search queries are
>>> direct pass throughs to Solr query and don't touch any of the salient Riak
>>> systems (batching writes to Solr, YZ AAE, etc). I believe the timing of
>>> the reappearance is a coincidence.
>>>
>>> Is it possible the object reappeared via MDC? Do you have record of the
>>> reappeared object in your other cluster?
>>>
>>> Also, just to confirm, when you say the object reappeared -- it
>>> re-appeared in Riak (and subsequently in Solr), correct? Or are you saying
>>> you just find the object in Solr (via a search)?
>>>
>>> -Fred
>>>
>>> On Feb 23, 2017, at 1:43 AM, al so  wrote:
>>>
>>> Here is brief env:
>>>> Riak v 2.0.8 + Solr/ 5 node cluster/ MDC
>>>>
>>>> Problem:
>>>> Deleted object suddenly resurrected after few days. Solr search query(
>>>> "\*:\*") was executed around the time of reappearance.
>>>>
>>>> Bucket property for this reappeared object
>>>> {
>>>> "props": {
>>>> "name": "UsaHype",
>>>> "allow\_mult": false,
>>>> "basic\_quorum": false,
>>>> "big\_vclock": 50,
>>>> "chash\_keyfun": {
>>>> "mod": "riak\_core\_util",
>>>> "fun": "chash\_std\_keyfun"
>>>> },
>>>> "dvv\_enabled": true,
>>>> "dw": "quorum",
>>>> "last\_write\_wins": false,
>>>> "linkfun": {
>>>> "mod": "riak\_kv\_wm\_link\_walker",
>>>> "fun": "mapreduce\_linkfun"
>>>> },
>>>> "n\_val": 3,
>>>> "notfound\_ok": true,
>>>> "old\_vclock": 86400,
>>>> "postcommit": [
>>>> {
>>>> "mod": "riak\_repl\_leader",
>>>> "fun": "postcommit"
>>>> },
>>>> {
>>>> "mod": "riak\_repl2\_rt",
>>>> "fun": "postcommit"
>>>> }
>>>> ],
>>>> "pr": 0,
>>>> "precommit": [
>>>>
>>>> ],
>>>> "pw": 0,
>>>> "r": "quorum",
>>>> "repl": true,
>>>> "rw": "quorum",
>>>> "small\_vclock": 50,
>>>> "w": "quorum",
>>>> "young\_vclock": 20
>>>> }
>>>> }
>>>>
>>>>
>>>> \* delete\_mode is not configured at all. Defaults to 3 sec? Do Tombstone 
>>>> still get created when no delete\_mode at all in the config? Can we query 
>>>> metadata(\*X-Riak-Deleted)\* for this reappeared object.\*
>>>>
>>>> How would one go about finding root cause. I do know the date when the
>>>> object was deleted from our app logs. I also seem to know when it
>>>> reappeared. Seems like a solr search ("\*:\*") in code was executed just
>>>> before this object reappeared? Look at AAE? Is there a way to find if Solr
>>>> and Riak backends are out-of-sync (AAE?).
>>>>
>>>> I understand tuning other params (allow\_mult = true, ...) will have
>>>> its own implications.
>>>>
>>>> In summary:
>>>> How do I find root cause of this issue.
>>>> How to reliable delete an object.
>>>>
>>>> -Volk
>>>>
>>>
>>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

