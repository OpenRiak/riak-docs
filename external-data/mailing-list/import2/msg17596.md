---
title: "Riak search, post schema change reindexation"
description: ""
project: community
lastmod: 2016-08-29T00:58:03-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17596"
author_name: "Guillaume Boddaert"
project_section: "mailinglistitem"
sent_date: 2016-08-29T00:58:03-0700
---



Hi,

I recently needed to alter my Riak Search schema for a bucket type that 
contains ~30 millions rows. As a result, my index was wiped since we are 
waiting for a Riak Search 2.2 feature that will sync Riak storage with 
Solr index on such an occasion.


I adapted a since script suggested by Evren Esat Ã–zkan there 
(https://github.com/basho/yokozuna/issues/130#issuecomment-196189344). 
It is a simple python script that will stream keys and trigger a store 
action for any items. Unfortunately it failed past 178k items due to 
time out on the key stream. I calculated that this kind of reindexation 
mechanism would take up to 5 days without a crash to succeed.


I was wondering if there would be a pure Erlang mean to achieve a 
complete forced rewrite of every single element in my bucket type rather 
that an error prone and very long python process.


How would you guys reindex a 30 million item bucket type in a fast and 
reliable way ?


Thanks, Guillaume
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

