---
title: "Re: Cluster start and 2i query"
description: ""
project: community
lastmod: 2014-03-07T07:08:12-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13768"
mailinglist_parent_id: "msg13754"
author_name: "Ciprian Manea"
project_section: "mailinglistitem"
sent_date: 2014-03-07T07:08:12-08:00
---


Hi Daniel,

Secondary index queries need at least 1/n\_val primary partitions to be
available before it could run successfully and Riak would return
{error,insufficient\_vnodes\_available} while the required primary partitions
are coming up.

I would suggest defensive programming (retrying the 2i queries on error) as
a way to mitigate this.


Thanks,
Ciprian


On Wed, Mar 5, 2014 at 11:06 PM, Daniel Iwan  wrote:

> Thanks Ciprian
>
> We already have wait-for-service in our script and it looks like it's not a
> sufficient condition to satisfy secondary index query.
> How long application should wait before starting querying Riak using 2i?
> Should we do riak-admin transfers to make sure there are no vnode transfers
> happening?
>
> I'm trying to figure it out what {error,insufficient\_vnodes\_available}
> means
> in terms of 2i query.
> Does it mean not all primary partitions are up?
>
> Regards
> Daniel
>
>
>
> --
> View this message in context:
> http://riak-users.197444.n3.nabble.com/Cluster-start-and-2i-query-tp4030557p4030614.html
> Sent from the Riak Users mailing list archive at Nabble.com.
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

