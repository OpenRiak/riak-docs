---
title: "Re: riakc_pb_socket:start_link question with a riak cluster"
description: ""
project: community
lastmod: 2012-09-02T22:41:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08435"
mailinglist_parent_id: "msg08434"
author_name: "Joseph Lambert"
project_section: "mailinglistitem"
sent_date: 2012-09-02T22:41:12-07:00
---


Hi Bryan,

AFAIK, there is no built-in connection pooling for the Riak Erlang client.
Each connection will only connect with one node and only that node, but
since it's masterless you can connect to any node. You could roll your own
connection pooling mechanism, or use something like Poolboy to handle it
for you. Using Poolboy is convenient because it comes as a dependency of
riak\_core.

If you use Poolboy, you'll have to modify riakc\_pb\_socket slightly to
account for the way poolboy initializes connections (add a start\_link/1),
or create a simple module to pass the initialization from poolboy to
riakc\_pb\_socket.

- Joe Lambert


On Mon, Sep 3, 2012 at 11:41 AM, Bryan Hughes  wrote:

> Hi Guys,
>
> I have a question regarding Riak's protobuffer client gen\_server process.
> I have a cluster of 5 nodes (machines), each with consecutive IP
> addresses. Our application is 100% erlang and runs on its own machine.
> The arguments to riakc\_pb\_socket:start\_link/2 is an Address, Port and the
> optional Options. The Address and Port is the address of the riak server,
> but in the case of a masterless cluster of 5 machines, which address do I
> use?
>
> In reviewing the code for riakc\_pb\_socket.erl, the client opens a socket
> via gen\_tcp to that particular node in the cluster and only that node.
> This means that there is a 1 to 1 connection between the riak node and the
> client. Is this correct? Maybe I am missing something?
>
> If so, then it looks like I need to implement my own round-robin algorithm
> across a pool of protobuffer clients that I am managing, each bound to a
> different node in the cluster while testing "aliveness" with ping/2 and an
> immediate timeout?
>
> Cheers,
> Bryan
>
> --
>
> Bryan Hughes
> \*Wobblesoft\*
>
> http://www.wobblesoft.com
>
> \*"Art is never finished, only abandoned. - Leonardo da Vinci"\*
>
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

