---
title: "Re: Precommit Hook Difficulties"
description: ""
project: community
lastmod: 2011-09-19T13:22:50-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04786"
mailinglist_parent_id: "msg04784"
author_name: "Greg Pascale"
project_section: "mailinglistitem"
sent_date: 2011-09-19T13:22:50-07:00
---


Awesome, thanks.

-Greg
Clipboard



On Sep 19, 2011, at 12:53 PM, Jon Meredith wrote:

> I had a quick play with this. Mochijson2:encode returns an erlang I/O list. 
> You can convert back to a proper binary with iolist\_to\_binary(). 
> 
> precommit\_json\_identity(Obj) ->
> Values = riak\_object:get\_values(Obj),
> {struct, TermList} = mochijson2:decode(hd(Values)),
> riak\_object:apply\_updates(
> riak\_object:update\_value(Obj, 
> iolist\_to\_binary(mochijson2:encode({struct, 
> TermList})))).
> 
> Cheers, Jon
> 
> On Mon, Sep 19, 2011 at 1:50 PM, David Smith  wrote:
> On Sat, Sep 17, 2011 at 5:11 PM, Greg Pascale  wrote:
> > Hi,
> > I'm trying to write a simple precommit hook to modify a JSON object by
> > removing certain fields. The simplest way to do this, I figure, is to decode
> > the object's value with mochijson2, remove the fields I don't want,
> > re-encode it, and update the value.
> > What happens, though, is my object ends up somehow mangled. When I inspect
> > it via curl, it sort of looks like JSON, but characters like "{" and ":"
> > seem to be replaced with garbage.
> > For example, what should read "hostname":"www.google.com" looks
> > like hostnamea"ja:la"mwww.google.coma"j
> 
> If I had to guess, I would say that you are seeing some sort of weird
> unicode encoding of the double-quote character; maybe the data stored
> was UTF-16 encoded? I.e. is there some unicode character that would
> display a " but actually be stored as [a, "]?
> 
> D.
> 
> --
> Dave Smith
> Director, Engineering
> Basho Technologies, Inc.
> diz...@basho.com
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

