---
title: "Re: Search Crashes"
description: ""
project: community
lastmod: 2013-11-23T09:19:23-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13072"
mailinglist_parent_id: "msg13070"
author_name: "Kartik Thakore"
project_section: "mailinglistitem"
sent_date: 2013-11-23T09:19:23-08:00
---


is this still an issues on 2.0?

On Sat, Nov 23, 2013 at 12:07 PM, John Daily  wrote:

> allow\_mult=true is the recommended approach for addressing conflict 
> resolution; when multiple writes to the same object are received and vector 
> clocks cannot determine a causal history, all copies of the writes are 
> retained for future merging/selection by the application. We are planning to 
> make this the default setting for Riak 2.0.
> A couple of blog posts (pardon me for referencing my own content):
> https://basho.com/understanding-riaks-configurable-behaviors-part-1/
> https://basho.com/clocks-are-bad-or-welcome-to-distributed-systems/
> I imagine that the presence of these multiple copies (aka “siblings”) is what 
> is breaking legacy search, but that’s purely guesswork on my part.
> -John
> On Nov 23, 2013, at 12:00 PM, Kartik Thakore  wrote:
>> what does allow\_mult do and why is it breaking the search? 
>> 
>> just curious
>> 
>> 
>> On Sat, Nov 23, 2013 at 11:00 AM, Mark Phillips  wrote:
>> 
>> Please send all rock star praise payments to m...@basho.com. I'll make sure 
>> Ryan gets it. ;) 
>> 
>> On Friday, November 22, 2013, Gabriel Littman wrote:
>> 
>> PS: The searching that should include this element that failed before now 
>> succeeds as well.
>> 
>> >>> r.fulltext\_search('ctv\_tvdata', "searchable\_key:monstersvsaliens")
>> {'max\_score': 0.353553, 'num\_found': 1, 'docs': [{'date': '2013-11-23', 
>> 'expires': '9999999999', 'subject\_name': 'Monsters vs. Aliens', 'sub\_type': 
>> 'Series', 'topic': 
>> '\_\_ref--/data/v2/topic/TMS.Show.9838380:r1384276501.854346', 'person': 
>> '\_\_None\_\_', 'searchable\_key': 'aliens vs monstersvsaliens monsters', 
>> 'genre': 'Children', 'sport': '\_\_None\_\_', 'type': 'show', u'id': 
>> '/data/v2/search\_show/TMS.Show.9838380'}]}
>> 
>> 
>> On Fri, Nov 22, 2013 at 8:07 PM, Gabriel Littman  wrote:
>> Hi Ryan,
>> 
>> You are a rock star. I owe you $5. 
>> 
>> The bucket had allow\_mult set to true:
>> $ curl 'http://10.1.2.95:8098/buckets/\_rsid\_ctv\_tvdata/props'
>> {"props":{"name":"\_rsid\_ctv\_tvdata","allow\_mult":true,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"dw":0,"last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"notfound\_ok":false,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":1,"rw":1,"small\_vclock":50,"w":1,"young\_vclock":20}}
>> 
>> I fixed it in the python console since that is where I'm more comfortable. 
>> And just to be sure I attempted the same riak PUT both before and after.
>> 
>> >>> import riak
>> >>> r = riak.RiakClient()
>> >>> b = r.bucket('ctv\_tvdata')
>> >>> o = b.get('/data/v2/search\_show/TMS.Show.9838380')
>> >>> o.store()
>> Traceback (most recent call last):
>> File "", line 1, in 
>> File "/usr/local/lib/python2.7/dist-packages/riak/riak\_object.py", line 
>> 281, in store
>> timeout=timeout)
>> File "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py", 
>> line 127, in wrapper
>> return self.\_with\_retries(pool, thunk)
>> File "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py", 
>> line 69, in \_with\_retries
>> return fn(transport)
>> File "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py", 
>> line 125, in thunk
>> return fn(self, transport, \*args, \*\*kwargs)
>> File "/usr/local/lib/python2.7/dist-packages/riak/client/operations.py", 
>> line 289, in put
>> timeout=timeout)
>> File 
>> "/usr/local/lib/python2.7/dist-packages/riak/transports/http/transport.py", 
>> line 144, in put
>> return self.\_parse\_body(robj, response, [200, 201, 204, 300])
>> File 
>> "/usr/local/lib/python2.7/dist-packages/riak/transports/http/codec.py", line 
>> 64, in \_parse\_body
>> self.check\_http\_code(status, expected\_statuses)
>> File 
>> "/usr/local/lib/python2.7/dist-packages/riak/transports/http/transport.py", 
>> line 446, in check\_http\_code
>> (expected\_statuses, status))
>> Exception: Expected status [200, 201, 204, 300], received 500
>> >>> b2 = r.bucket('\_rsid\_ctv\_tvdata')
>> >>> b2.get\_properties()
>> {'old\_vclock': 86400, 'pr': 0, 'allow\_mult': True, 'big\_vclock': 50, 'name': 
>> '\_rsid\_ctv\_tvdata', 'chash\_keyfun': {'fun': 'chash\_std\_keyfun', 'mod': 
>> 'riak\_core\_util'}, 'n\_val': 3, 'notfound\_ok': False, 'linkfun': {'fun': 
>> 'mapreduce\_linkfun', 'mod': 'riak\_kv\_wm\_link\_walker'}, 'pw': 0, 
>> 'last\_write\_wins': False, 'r': 1, 'small\_vclock': 50, 'rw': 1, 
>> 'basic\_quorum': False, 'postcommit': [], 'dw': 0, 'w': 1, 'youn
>> 
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

