---
title: "Re: Receiving ulimit warning despite setting it"
description: ""
project: community
lastmod: 2013-05-16T07:11:35-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11092"
mailinglist_parent_id: "msg11090"
author_name: "John E. Vincent"
project_section: "mailinglistitem"
sent_date: 2013-05-16T07:11:35-07:00
---


As an opposing viewpoint, I'd argue that it's NOT the requirement of Riak
to go automatically changing things outside of its domain. Ulimits and
tunables in the same class are not things that should be blindly tweaked by
an incoming package. These are things the system administrator needs to be
aware of and scope for the system in use.

I appreciate the idea and desire that Riak work out of the box but I'd
argue it already does. What DOESN'T work is an untuned Riak at load. And it
shouldn't. There are some things that need to be an informed decision. Is
the default ulimit in most distros too low? Absolutely but it's in the
domain of the OS/Distro provider and not a third-party package to tweak
possible dangerous knobs.

The only sane default here is to use what the distro sets and provide
information for users on how to change it.



On Thu, May 16, 2013 at 9:48 AM, Jared Morrow  wrote:

> Toby,
>
> It seems to me like it would be nice if Riak "just worked" when you
>> installed it, instead of requiring each and every user to have to track
>> something down in the docs and then configure it in their chef/puppet
>> manifests. Don't you agree that is a desirable feature of good software?
>> (ie. Sensible defaults)
>>
>
> That's a good point, and like I said above, I was willing to accept that I
> was the only one with those views.
>
> I filed an issue for my backlog
> https://github.com/basho/node\_package/issues/55 to take a look at that.
> It is probably too late for our next major release to get in, but I do
> indeed want to make this easier on everyone, so thanks for the feedback.
>
> -Jared
>
>
> On Wed, May 15, 2013 at 11:44 PM, Toby Corkindale <
> toby.corkind...@strategicdata.com.au> wrote:
>
>> On 16/05/13 15:38, Jared Morrow wrote:
>>
>>> I've considered packaging separate files for configuring the limit
>>> for people, but the user in me always felt like that was something
>>> the sysadmin should have a say in. I rather dislike packages that
>>> make system changes without my knowledge or consent. Maybe that is
>>> just me?
>>>
>>
>> It's not making a system change though -- it's only adjusting things for
>> the riak/riakcs user.
>>
>> Can you think of any situation where a user would WANT to stick to the
>> default 1024 file-handle limit and yet be running Riak?
>>
>> Now think of how often that situation occurs, compared to the number of
>> times where the user DOES want the "good" number setup, and would just like
>> to install Riak and then get on with their work?
>>
>> It seems to me like it would be nice if Riak "just worked" when you
>> installed it, instead of requiring each and every user to have to track
>> something down in the docs and then configure it in their chef/puppet
>> manifests. Don't you agree that is a desirable feature of good software?
>> (ie. Sensible defaults)
>>
>> Cheers,
>> Toby
>>
>>
>> On May 15, 2013, at 10:54 PM, Toby Corkindale
>>> >
>>> wrote:
>>>
>>> On 16/05/13 14:39, Toby Corkindale wrote:
>>>>
>>>>> On 16/05/13 14:24, Jared Morrow wrote:
>>>>>
>>>>>> Well the riak-cs / riak / stanchion scripts all drop privileges
>>>>>> using sudo. On RHEL/Centos this sudo exec carries the settings
>>>>>> from the calling user (in the case of init.d, root) so things
>>>>>> are fine there. On Ubuntu/Debian that does not always work.
>>>>>> So if you set the ulimit for the root user, it might not
>>>>>> propagate through to the riak-cs / riak / stanchion users.
>>>>>>
>>>>>> So to change that, you should try to change it in
>>>>>> /etc/security/limits.conf.
>>>>>>
>>>>>
>>>>> My understanding is that only sessions opened through PAM will
>>>>> be effected by the limits.d/\* config files. ie. Not daemon
>>>>> processes. (I've checked this anyway with the following
>>>>> /etc/security/limits.d/riakcs.\*\*conf: riak-cs hard nofile
>>>>> 32002 riak-cs soft nofile 32001 )
>>>>>
>>>>> As noted previously, this problem was not occurring on the
>>>>> current Ubuntu LTS nodes; just the Debian Squeeze ones. Which
>>>>> makes it particularly odd.
>>>>>
>>>>> Thanks for your help so far; I'll continue to investigate and
>>>>> report back if I find a solution.
>>>>>
>>>>
>>>> I realised that the Riak CS user was called "riakcs" and not
>>>> "riak-cs". Once I changed that in the limits.d/riakcs.conf file,
>>>> riakcs started working without the file warning.
>>>>
>>>> I also added in a line for the regular "riak" user while I was
>>>> there.
>>>>
>>>> May I suggest you add this to the debian/ubuntu packages by
>>>> default? (ie. a file in /etc/security/limits.d/ )
>>>>
>>>>
>>>> Cheers, Toby
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ riak-users mailing
>>>> list riak-users@lists.basho.com
>>>> http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
>>>>
>>>
>>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

