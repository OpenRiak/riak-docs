---
title: "Re: Riak crash on 0.14.2 riak_kv_stat terminating"
description: ""
project: community
lastmod: 2011-06-21T14:17:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03766"
mailinglist_parent_id: "msg03747"
author_name: "David Mitchell"
project_section: "mailinglistitem"
sent_date: 2011-06-21T14:17:36-07:00
---


Erlang: R13B04
Riak: 0.14.2

I am having the same issue as Jeremy.

I just did 208 MapReduce jobs using anonymous JavaScript functions in the map 
and reduce phases. I am sending the MapReduce jobs to a single node, riak01. 
Out of the 208 jobs, I got two "mapexec\_error" {error,timeout} on riak02.

I read on the basho wiki that the default timeout is 60 seconds. 
http://wiki.basho.com/Loading-Data-and-Running-MapReduce-Queries.html
Map/Reduce queries have a default timeout of 60000 milliseconds (60 seconds).

I have discovered that if a MapReduce job does not complete within 10 seconds, 
then it likely is having issues. Most MapReduce jobs complete in one to two 
seconds. I can try increasing the MapReduce timeout to 120 seconds, but I 
doubt that this will help.

I have discovered that if there are several timeouts, then the beam process can 
terminate.

Any help would be appreciated.

The following is from the sals-error.log on riak01.

=ERROR REPORT==== 21-Jun-2011::16:29:11 ===
\*\* State machine <0.11130.0> terminating
\*\* Last event in was {mapexec\_error,{<<"46">>,'riak@10.0.60.209'},
 {error,timeout}}
\*\* When State == executing
\*\* Data == {state,0,riak\_kv\_map\_phase,
 {state,true,
 {javascript,
 {map,
 {jsanon,
.................

=ERROR REPORT==== 21-Jun-2011::16:29:11 ===
\*\* State machine <0.11127.0> terminating
\*\* Last message in was {'EXIT',<0.11130.0>,{error,timeout}}
\*\* When State == executing
\*\* Data == {state,41465578,
 [<0.11130.0>,[<0.11129.0>,<0.11128.0>]],
 <0.10971.0>,66000,
 {1308688220159363,#Ref<0.0.0.198634>},
 #Fun,[],[]}
\*\* Reason for termination =
\*\* {error,{phase\_error,{error,timeout}}}

=CRASH REPORT==== 21-Jun-2011::16:29:11 ===
 crasher:
 initial call: luke\_flow:init/1
 pid: <0.11127.0>
 registered\_name: []
 exception exit: {error,{phase\_error,{error,timeout}}}
 in function gen\_fsm:terminate/7
 in call from proc\_lib:init\_p\_do\_apply/3
 ancestors: [luke\_flow\_sup,luke\_sup,<0.91.0>]
 messages: []
 links: [<0.11128.0>,<0.11129.0>,<0.93.0>]
 dictionary: []
 trap\_exit: true
 status: running
 heap\_size: 233
 stack\_size: 24
 reductions: 23099
 neighbours:
 neighbour: 
[{pid,<0.11129.0>},{registered\_name,[]},{initial\_call,{luke\_phase,init,[Argument\_\_1]}},{current\_function,{gen\_fsm,loop,7}},{ancestors,[luke\_phase\_sup,luke\_sup,<0.
91.0>]},{messages,[]},{links,[<0.11127.0>,<0.11128.0>,<0.94.0>]},{dictionary,[]},{trap\_exit,false},{status,waiting},{heap\_size,6765},{stack\_size,10},{reductions,4926}]
 neighbour: 
[{pid,<0.11128.0>},{registered\_name,[]},{initial\_call,{luke\_phase,init,[Argument\_\_1]}},{current\_function,{gen\_fsm,loop,7}},{ancestors,[luke\_phase\_sup,luke\_sup,<0.
91.0>]},{messages,[]},{links,[<0.11127.0>,<0.11129.0>,<0.94.0>]},{dictionary,[]},{trap\_exit,false},{status,waiting},{heap\_size,4181},{stack\_size,10},{reductions,4905}]

The second timeout error:

=ERROR REPORT==== 21-Jun-2011::16:31:10 ===
\*\* State machine <0.15144.0> terminating
\*\* Last message in was flow\_timeout
\*\* When State == executing
\*\* Data == {state,78575179,
 [<0.15147.0>,[<0.15146.0>,<0.15145.0>]],
 <0.15118.0>,66000,
 {1308688285727293,#Ref<0.0.1.11874>},
 #Fun,[],[]}
\*\* Reason for termination =
\*\* {error,flow\_timeout}

=CRASH REPORT==== 21-Jun-2011::16:31:10 ===
 crasher:
 initial call: luke\_flow:init/1
 pid: <0.15144.0>
 registered\_name: []
 exception exit: {error,flow\_timeout}
 in function gen\_fsm:terminate/7
 in call from proc\_lib:init\_p\_do\_apply/3
 ancestors: [luke\_flow\_sup,luke\_sup,<0.91.0>]
 messages: []
 links: [<0.15145.0>,<0.15147.0>,<0.15146.0>,<0.93.0>]
 dictionary: []
 trap\_exit: true
 status: running
 heap\_size: 233
 stack\_size: 24
 reductions: 20791
 neighbours:
 neighbour: 
[{pid,<0.15146.0>},{registered\_name,[]},{initial\_call,{luke\_phase,init,[Argument\_\_1]}},{current\_function,{gen\_fsm,loop,7}},{ancestors,[luke\_phase\_sup,luke\_sup,<0.
91.0>]},{messages,[]},{links,[<0.15144.0>,<0.15145.0>,<0.94.0>]},{dictionary,[]},{trap\_exit,false},{status,waiting},{heap\_size,4181},{stack\_size,10},{reductions,6554}]
 neighbour: 
[{pid,<0.15145.0>},{registered\_name,[]},{initial\_call,{luke\_phase,init,[Argument\_\_1]}},{current\_function,{gen\_fsm,loop,7}},{ancestors,[luke\_phase\_sup,luke\_sup,<0.
91.0>]},{messages,[]},{links,[<0.15144.0>,<0.15146.0>,<0.94.0>]},{dictionary,[]},{trap\_exit,false},{status,waiting},{heap\_size,4181},{stack\_size,10},{reductions,6274}]

=SUPERVISOR REPORT==== 21-Jun-2011::16:31:10 ===
 Supervisor: {local,luke\_flow\_sup}
 Context: child\_terminated
 Reason: {error,flow\_timeout}
 Offender: 
[{pid,<0.15144.0>},{name,undefined},{mfa,{luke\_flow,start\_link,[<0.15118.0>,78575179,[{riak\_kv\_map\_phase,[],[{javascript,{map,{jsanon,<<"function(value,keyData,
................

David

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

