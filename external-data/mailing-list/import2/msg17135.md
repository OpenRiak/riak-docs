---
title: "Re: 2i indexes and keys request inconsistencies"
description: ""
project: community
lastmod: 2016-03-09T01:09:11-0800
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17135"
mailinglist_parent_id: "msg17133"
author_name: "Alexander Popov"
project_section: "mailinglistitem"
sent_date: 2016-03-09T01:09:11-0800
---


@Matthew

No, db activity was very low at this time, and keys returned by this
queries was deleted long time ago ( some of them at Dec 2015 )

I got this issue when proceed maintenance task which touch all keys in
DB, list all keys by /keys?keys=true query, read, upgrade, save.

We have some logic depends on 2i indexes results - ( count number of
related keys ). But if it returns phantom keys,
 I cannot trust this data, need to double check by getting each object, but
this is more expensive operation




On Tue, Mar 8, 2016 at 10:21 PM, Matthew Von-Maszewski 
wrote:

> Is the database being actively modified during your queries?
>
> Queries can lock down a "snapshot" within leveldb. The query operation
> can return keys that existed at the time of the snapshot, but have been
> subsequently deleted by normal operations.
>
> In such a case, the query is correct in giving you the key and the 404
> afterward is also correct. They represent two different versions of the
> database over time.
>
> Not sure if this is a valid scenario for you or not.
>
> Matthew
>
>
> On Mar 8, 2016, at 1:22 PM, Alexander Popov  wrote:
>
> Noticied that sometimes 2i query and all keys requesrs returns extra
> records ~2% of all records.
>
> When call this items by get request after, it returns 404 and after that
> key stops to returns in 2i and keys requests.
>
> Does it normally or my database is corrupted?
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

