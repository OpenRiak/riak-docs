---
title: "I2 queries fail when few nodes are down"
description: ""
project: community
lastmod: 2017-01-05T02:54:07-0800
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17831"
author_name: "Tomi Takussaari"
project_section: "mailinglistitem"
sent_date: 2017-01-05T02:54:07-0800
---


Hello Riak-users

We have 9 node Riak-cluster, that we use to store user accounts.

Some of the crucial data fields of user account are indexed using I2, so
that we can do secondary index queries based on them.

Today, we tested how our cluster performs when few nodes go down, and
results were not very good.

If more than 2 nodes go down, all I2 queries will start failing, returning
HTTP 500, with "insufficient vnodes available" error. After nodes are up
again, things start working again.
Normal object CRUD operations worked fine.

Is this to be expected behaviour ?

Funny thing is, that we have other cluster, with same configuration but
with 6 nodes, for other environment, and that also experiences same
problems when more than 2 nodes go down, so it does not seem to have
anything to do with percentage of nodes being down..

Our ring size is 256, and current Riak version is 2.2.

Both clusters were first created years ago, with Riak 1.4, if memory
serves, and I believe we tested this same thing back then, and I2 queries
did not stop working this easily then..

Any help would be appreciated!
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

