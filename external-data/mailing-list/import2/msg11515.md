---
title: "Error while deleting a whole Bucket using Contrib Reducer"
description: ""
project: community
lastmod: 2013-07-13T14:06:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11515"
author_name: "kiran kulkarni"
project_section: "mailinglistitem"
sent_date: 2013-07-13T14:06:33-07:00
---


Hello,

I need to delete buckets on production. I am using Riak 1.3.0. As Bucket
Operations
doesn't
provide any API to delete bucket, I was trying delete\_keys reducer
available in 
contribdirectory

I populated a bucket "testing3" and populated it with 100 items
My MapReduce query looks like
{
 "inputs": "testing3",
 "query": [{"map": {"language": "javascript",
 "source": "function(value, keydata, args){return
[[value.bucket, value.key]];}"}},

 {"reduce": {"language": "erlang",
 "module": "delete\_keys",
 "function": "delete"}}],
 "timeout": 900000
}

I have also verified that "delete\_keys" module is being included

(dev1@127.0.0.1)1> delete\_keys:module\_info().
[{exports,[{module\_info,0},{module\_info,1},{delete,2}]},
 {imports,[]},
 {attributes,[{vsn,[308055930713635303025382691973616137846]}]},
 {compile,[{options,[{outdir,"/Users/kiran/work/riak-work/mapred/erlang"}]},
 {version,"4.8.1"},
 {time,{2013,7,13,17,56,26}},

 {source,"/Users/kiran/work/riak-work/mapred/erlang/delete\_keys.erl"}]}]

But It throws of following error I am quite clueless. Any help will be
appreciated

html>500 Internal Server
ErrorInternal Server Error
=====================

The server
encountered an error while processing this request:  

```
{error,
    {error,
        {case_clause,
            {error,
                {1,
                 [{module,riak_kv_w_reduce},

{partition,433883298582611803841718934712646521460354973696},
                  {details,
                      [{fitting,
                           {fitting,<0.5892.0>,#Ref<0.0.0.33932>,
                               <<"K�������������������">>,1}},
                       {name,1},
                       {module,riak_kv_w_reduce},
                       {arg,{rct,#Fun,none}},
 {output,
 {fitting,<0.5890.0>,#Ref<0.0.0.33932>,sink,
 undefined}},
 {options,
 [{log,sink},
 {trace,[error]},
 {sink,
 {fitting,<0.5890.0>,#Ref<0.0.0.33932>,sink,
 undefined}},
 {sink\_type,{fsm,10,infinity}}]},
 {q\_limit,64}]},
 {type,error},
 {error,undef},
 {input,[<<"testing3">>,<<"84">>]},
 {modstate,
 {state,[],
 [[<<"testing3">>,<<"90">>],
 [<<"testing3">>,<<"27">>],
 [<<"testing3">>,<<"8">>],
 [<<"testing3">>,<<"88">>],
 [<<"testing3">>,<<"11">>],
 [<<"testing3">>,<<"23">>],
 [<<"testing3">>,<<"46">>],
 [<<"testing3">>,<<"12">>],
 [<<"testing3">>,<<"77">>],
 [<<"testing3">>,<<"15">>],
 [<<"testing3">>,<<"22">>],
 [<<"testing3">>,<<"74">>],
 [<<"testing3">>,<<"86">>],
 [<<"testing3">>,<<"85">>],
 [<<"testing3">>,<<"6">>],
 [<<"testing3">>,<<"73">>],
 [<<"testing3">>,<<"94">>],
 [<<"testing3">>,<<"13">>],
 [<<"testing3">>,<<"89">>]],
 19,20,
 433883298582611803841718934712646521460354973696,
 {fitting\_details,
 {fitting,<0.5892.0>,#Ref<0.0.0.33932>,
 <<"K�������������������">>,1},
 1,riak\_kv\_w\_reduce,
 {rct,#Fun,none},
 {fitting,<0.5890.0>,#Ref<0.0.0.33932>,sink,
 undefined},
 [{log,sink},
 {trace,[error]},
 {sink,
 {fitting,<0.5890.0>,#Ref<0.0.0.33932>,
 sink,undefined}},
 {sink\_type,{fsm,10,infinity}}],
 64}}},
 {stack,
 [{delete\_keys,delete,
 [[[<<"testing3">>,<<"89">>],
 [<<"testing3">>,<<"13">>],
 [<<"testing3">>,<<"94">>],
 [<<"testing3">>,<<"73">>],
 [<<"testing3">>,<<"6">>],
 [<<"testing3">>,<<"85">>],
 [<<"testing3">>,<<"86">>],
 [<<"testing3">>,<<"74">>],
 [<<"testing3">>,<<"22">>],
 [<<"testing3">>,<<"15">>],
 [<<"testing3">>,<<"77">>],
 [<<"testing3">>,<<"12">>],
 [<<"testing3">>,<<"46">>],
 [<<"testing3">>,<<"23">>],
 [<<"testing3">>,<<"11">>],
 [<<"testing3">>,<<"88">>],
 [<<"testing3">>,<<"8">>],
 [<<"testing3">>,<<"27">>],
 [<<"testing3">>,<<"90">>],
 [<<"testing3">>,<<"84">>]],
 none],
 []},
 {riak\_kv\_w\_reduce,reduce,3,
 [{file,"src/riak\_kv\_w\_reduce.erl"},{line,206}]},
 {riak\_kv\_w\_reduce,maybe\_reduce,2,
 [{file,"src/riak\_kv\_w\_reduce.erl"},{line,157}]},
 {riak\_pipe\_vnode\_worker,process\_input,3,
 [{file,"src/riak\_pipe\_vnode\_worker.erl"},
 {line,444}]},
 {riak\_pipe\_vnode\_worker,wait\_for\_input,2,
 [{file,"src/riak\_pipe\_vnode\_worker.erl"},
 {line,376}]},
 {gen\_fsm,handle\_msg,7,
 [{file,"gen\_fsm.erl"},{line,494}]},
 {proc\_lib,init\_p\_do\_apply,3,
 [{file,"proc\_lib.erl"},{line,227}]}]}]}}},
 [{riak\_kv\_wm\_mapred,pipe\_mapred\_nonchunked,3,
 [{file,"src/riak\_kv\_wm\_mapred.erl"},{line,180}]},
 {webmachine\_resource,resource\_call,3,
 [{file,"src/webmachine\_resource.erl"},{line,183}]},
 {webmachine\_resource,do,3,
 [{file,"src/webmachine\_resource.erl"},{line,141}]},
 {webmachine\_decision\_core,resource\_call,1,
 [{file,"src/webmachine\_decision\_core.erl"},{line,48}]},
 {webmachine\_decision\_core,decision,1,
 [{file,"src/webmachine\_decision\_core.erl"},{line,481}]},
 {webmachine\_decision\_core,handle\_request,2,
 [{file,"src/webmachine\_decision\_core.erl"},{line,33}]},
 {webmachine\_mochiweb,loop,1,
 [{file,"src/webmachine\_mochiweb.erl"},{line,97}]},
 {mochiweb\_http,parse\_headers,5,
\* Connection #0 to host 127.0.0.1 left intact

 
[{file,"src/mochiweb\_http.erl"},{line,180}]}]}}
```


---

mochiweb+webmachine
web server

\* Closing connection #0
-- 
Kiran Kulkarni
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

