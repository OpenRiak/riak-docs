---
title: "Re: Fwd: Errors when using basho_bench"
description: ""
project: community
lastmod: 2010-06-09T23:30:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00547"
mailinglist_parent_id: "msg00539"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-06-09T23:30:58-07:00
---


Hi Germain,

I'm not able to reproduce the errors locally but I do occasionally see the
following after a test ends:
=ERROR REPORT==== 9-Jun-2010::23:18:35 ===
webmachine error: path="/riak/test/5711"
{error,{error,{badmatch,{error,closed}},
 [{webmachine\_request,recv\_unchunked\_body,4},
 {webmachine\_request,do\_recv\_body,2},
 {webmachine\_request,call,2},
 {wrq,req\_body,1},
 {riak\_kv\_wm\_raw,accept\_doc\_body,2},
 {webmachine\_resource,resource\_call,3},
 {webmachine\_resource,do,3},
 {webmachine\_decision\_core,resource\_call,1}]}}

It looks like this is happening because the basho bench workers are killed
off in the middle of a request.




On Wed, Jun 9, 2010 at 5:07 AM, Germain Maurice <
germain.maur...@linkfluence.net> wrote:

> The backend used is http\_raw as you can see in the benchmark config file :
>
> {mode, max}.
> {duration, 30}.
> {concurrent, 20}.
> {driver, basho\_bench\_driver\_http\_raw}.
> {code\_paths, ["deps/stats",
> "deps/ibrowse"]}.
> {http\_raw\_ips, ["10.0.0.40", "10.0.0.41"]}.
> {key\_generator, {uniform\_int, 10000}}.
> {value\_generator, {fixed\_bin, 800000}}.
> {operations, [{get, 2}, {update, 2}]}.
> {http\_raw\_params, "?r=1&w=2"}.
>
>
> The webmachine errors occured immediately after shutting down the benchmark
> with no other requests.
> We repeated the benchmark and we got these errors again.
>
>
> Le 08/06/10 19:23, Dan Reverri a écrit :
>
> Hi Germain,
>
> I've confirmed that the basho bench drivers for riakclient and riakc\_pb
> do not provide a content-type when submitting key/value pairs to Riak. This
> should not cause problems while running the benchmark.
>
> Which driver were you using when you noticed the webmachine errors? Were
> you making GET requests for keys created in the benchmark against the REST
> API after the benchmark?
>
> Thanks,
> Dan
>
> On Tue, Jun 8, 2010 at 9:29 AM, Dan Reverri  wrote:
>
>> Hi Germain,
>>
>> You should be able to work around this issue by specifying a full list
>> of default bucket properties with your change incorporated. For example, try
>> putting the following in your app.config:
>> {default\_bucket\_props, [{n\_val,2},
>> {allow\_mult,false},
>> {last\_write\_wins,false},
>> {precommit, []},
>> {postcommit, []},
>> {chash\_keyfun, {riak\_core\_util,
>> chash\_std\_keyfun}}]}
>>
>>
>> This is the full list of default bucket properties that can be found in
>> "apps/riak\_core/ebin/riak\_core.app" with the n\_val changed to "2".
>>
>>
>>
>>
>> On Tue, Jun 8, 2010 at 9:05 AM, Germain Maurice <
>> germain.maur...@linkfluence.net> wrote:
>>
>>> You're right, i put this line in the app.config :
>>> ,{default\_bucket\_props, [{n\_val, 2}]}
>>>
>>> Maybe, i made a mistake...
>>>
>>> Le 08/06/10 17:55, Dan Reverri a écrit :
>>>
>>> Forwarding my reply to the mailing list.
>>>
>>> ---------- Forwarded message ----------
>>> From: Dan Reverri 
>>> Date: Tue, Jun 8, 2010 at 8:45 AM
>>> Subject: Re: Errors when using basho\_bench
>>> To: Germain Maurice 
>>>
>>>
>>> Hi Germain,
>>>
>>> The first error "{'function not
>>> exported',[{riak\_core\_bucket,defaults,[]}," would occur when a bucket does
>>> not have a "chash\_keyfun" property defined. This could occur if you have
>>> specified default bucket properties in your app.config. There is a known
>>> issue where bucket properties defined in the app.config file are not merged
>>> with the hard coded defaults:
>>> http://issues.basho.com/show\_bug.cgi?id=123
>>>
>>> I'm not sure why this issue would only occur when increasing the
>>> partition size. Were other changes made to app.config?
>>>
>>>
>>> The second error "{case\_clause,{error,timeout}}, 
>>> [{riak\_kv\_wm\_raw,content\_types\_provided,2}"
>>> occurs when a key/value pair has been inserted into Riak without a
>>> content-type and retrieved via the REST interface. This can happen when
>>> inserting key/value pairs with the native Erlang client or the protobuffs
>>> client. These clients don't require that a content-type be set. I assume the
>>> values in question were inserted by the basho bench utility so I will look
>>> into how those values are inserted by basho bench.
>>>
>>> Thanks,
>>> Dan
>>>
>>>
>>>
>>> On Tue, Jun 8, 2010 at 7:38 AM, Germain Maurice <
>>> germain.maur...@linkfluence.net> wrote:
>>>
>>>> After viewing the demonstration of basho\_bench during the webinar of the
>>>> last week, we led some tests.
>>>> Here are some errors we are meeting while doing a benchmark with
>>>> basho\_bench.
>>>>
>>>> Big notice : when the ring partition size was 64, i never got this kind
>>>> of error (excepting a crash of a node, due to not enough memory i think,
>>>> 1,5GB RAM). But now, i have 128 partitions (see my other message on the 
>>>> riak
>>>> ML about the ring partition size) and these errors occurs.
>>>>
>>>>
>>>> This error occured multiple times :
>>>>
>>>> =ERROR REPORT==== 8-Jun-2010::16:21:06 ===
>>>> \*\* State machine <0.937.0> terminating
>>>> \*\* Last event in was timeout
>>>> \*\* When State == initialize
>>>> \*\* Data ==
>>>> {state,<0.932.0>,undefined,2,undefined,undefined,undefined,
>>>> 8594018,undefined,undefined,undefined,undefined,
>>>> undefined,undefined,60000,undefined,
>>>> {<<"test">>,<<"25500">>},
>>>> {chstate,'r...@10.0.0.40',
>>>> [{'r...@10.0.0.40',{64,63443225844}}],
>>>> {128,
>>>> [{0,'r...@10.0.0.40'},
>>>>
>>>> {11417981541647679048466287755595961091061972992,
>>>> 'r...@10.0.0.41'},
>>>>
>>>> {22835963083295358096932575511191922182123945984,
>>>> 'r...@10.0.0.40'},
>>>>
>>>> {34253944624943037145398863266787883273185918976,
>>>> 'r...@10.0.0.41'},
>>>>
>>>> {45671926166590716193865151022383844364247891968,
>>>> 'r...@10.0.0.40'},
>>>>
>>>> {57089907708238395242331438777979805455309864960,
>>>> 'r...@10.0.0.41'},
>>>> [...]
>>>>
>>>> {1415829711164312202009819681693899175291684651008,
>>>> 'r...@10.0.0.40'},
>>>>
>>>> {1427247692705959881058285969449495136382746624000,
>>>> 'r...@10.0.0.41'},
>>>>
>>>> {1438665674247607560106752257205091097473808596992,
>>>> 'r...@10.0.0.40'},
>>>>
>>>> {1450083655789255239155218544960687058564870569984,
>>>> 'r...@10.0.0.41'}]},
>>>> {dict,0,16,16,8,80,48,
>>>>
>>>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>>>
>>>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>>> []}}}},
>>>> undefined}
>>>> \*\* Reason for termination =
>>>> \*\* {'function not exported',[{riak\_core\_bucket,defaults,[]},
>>>> {riak\_core\_util,chash\_key,1},
>>>> {riak\_kv\_get\_fsm,initialize,2},
>>>> {gen\_fsm,handle\_msg,7},
>>>> {proc\_lib,init\_p\_do\_apply,3}]}
>>>>
>>>>
>>>> After shutting down the benchmark we also got this following error,
>>>> multiple times too :
>>>>
>>>>
>>>> =ERROR REPORT==== 8-Jun-2010::16:19:28 ===
>>>> webmachine error: path="/riak/test/16028"
>>>> [{webmachine\_decision\_core,'-decision/1-lc$^1/1-1-',
>>>> [{error,
>>>> {error,
>>>> {case\_clause,{error,timeout}},
>>>> [{riak\_kv\_wm\_raw,content\_types\_provided,2},
>>>> {webmachine\_resource,resource\_call,3},
>>>> {webmachine\_resource,do,3},
>>>> {webmachine\_decision\_core,resource\_call,1},
>>>> {webmachine\_decision\_core,decision,1},
>>>> {webmachine\_decision\_core,handle\_request,2},
>>>> {webmachine\_mochiweb,loop,1},
>>>> {mochiweb\_http,headers,5}]}}]},
>>>> {webmachine\_decision\_core,decision,1},
>>>> {webmachine\_decision\_core,handle\_request,2},
>>>> {webmachine\_mochiweb,loop,1},
>>>> {mochiweb\_http,headers,5},
>>>> {proc\_lib,init\_p\_do\_apply,3}]
>>>>
>>>>
>>>> Any idea about these errors ?
>>>> No problem with Webmachine ?
>>>>
>>>> --
>>>> Germain Maurice
>>>> Administrateur Système/Réseau
>>>> Tel : +33.(0)1.42.43.54.33
>>>>
>>>> http://www.linkfluence.net
>>>>
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>
>>>
>>>
>>>
>>> --
>>> Germain Maurice
>>> Administrateur Système/Réseau
>>> Tel : +33.(0)1.42.43.54.33
>>> http://www.linkfluence.net
>>>
>>>
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>
>>>
>>
>
>
> --
> Germain Maurice
> Administrateur Système/Réseau
> Tel : +33.(0)1.42.43.54.33
> http://www.linkfluence.net
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

