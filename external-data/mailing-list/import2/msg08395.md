---
title: "Re: riak-erlang-client issue with Riak EE 1.2"
description: ""
project: community
lastmod: 2012-08-29T12:54:59-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08395"
mailinglist_parent_id: "msg08387"
author_name: "Dave Parfitt"
project_section: "mailinglistitem"
sent_date: 2012-08-29T12:54:59-07:00
---


Hi Julian -
 The riak-erlang-client docs definitely need to be updated for search, index, 
and map/reduce. 

In the meantime, if you notice on this line:
https://github.com/basho/riak-erlang-client/blob/master/src/riakc\_pb\_socket.erl#L635
you'll see that the type for Options is "search\_options()". 

You can find the definition of search\_options() here:
https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl#L77

and the definition for search\_option() here:
https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl#L122

Cheers -
Dave


On Aug 28, 2012, at 7:20 PM, Julian wrote:

> Sure, I see the source code of search/\*, but I'm kind of stuck at
> figuring out the search\_options properties and whether they can help
> me or not. I've made stabs at 'rows', 'start' and 'sort' and they're
> more or less the intuitive thing (although I couldn't do a reverse
> sort order if I had to).
> 
> 
> I don't see any code in riak\_pb that sheds enlightenment; I'm guessing
> that this #rpbsearchqueryrec record is just shoved into a packet and
> sent to the server.
> 
> search\_options([{rows, Rows} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{rows=Rows});
> search\_options([{start, Start} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{start=Start});
> search\_options([{sort, Sort} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{sort=Sort});
> search\_options([{filter, Filter} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{filter=Filter});
> search\_options([{df, DF} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{df=DF});
> search\_options([{op, OP} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{op=OP});
> search\_options([{fl, FL} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{fl=FL});
> search\_options([{presort, Presort} | Rest], Req) ->
> search\_options(Rest, Req#rpbsearchqueryreq{presort=Presort});
> search\_options([{\_, \_} | \_Rest], \_Req) ->
> erlang:error(badarg).
> 
> Thanks,
> Julian
> 
> On Tue, Aug 28, 2012 at 12:26 PM, Dave Parfitt  wrote:
>> Hello Julian -
>> 
>> Map-reduce is still available, it's just not what riakc\_pb\_socket:search/\* 
>> uses under the hood anymore. Both map/reduce and Riak search functionality 
>> are implemented in the client using Protocol Buffers now.
>> 
>> The Map/Reduce functions are available here:
>> https://github.com/basho/riak-erlang-client/blob/master/src/riakc\_pb\_socket.erl#L454
>> 
>> and the Search functions are available here:
>> https://github.com/basho/riak-erlang-client/blob/master/src/riakc\_pb\_socket.erl#L618
>> 
>> Cheers -
>> Dave


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

