---
title: "Re: LevelDB"
description: ""
project: community
lastmod: 2015-06-08T12:19:54-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16231"
mailinglist_parent_id: "msg16230"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2015-06-08T12:19:54-0700
---


Congrats on the configure running. I will ask around concerning best practices 
and get back to you tomorrow. 

Is your /mnt/slow a remote mount? If so, what details can you share?

Sent from my iPhone

> On Jun 8, 2015, at 2:58 PM, Joe Olson  wrote:
> 
> Matthew - I got it to work. Setting the filesystem rights to 777 got it to 
> start. I thought starting Riak as root would allow writing to the filesystem, 
> but I guess not.
> 
> Do most people run riak as an OS user "riak"? What is best practice here?
> 
> Thanks for all your help.
> 
> 
> 
> From: "Matthew Von-Maszewski" 
> To: "Joe Olson" 
> Cc: "riak-users" 
> Sent: Monday, June 8, 2015 11:40:56 AM
> Subject: Re: LevelDB
> 
> Odd.
> 
> The tree builds fine, including the lock file, once the config was good:
> 
> /mnt
> ├── fast
> │ └── leveldb
> │ ├── 0
> │ │ ├── CURRENT
> │ │ ├── LOCK
> │ │ ├── LOG
> │ │ ├── MANIFEST-000002
> │ │ ├── sst\_0
> │ │ ├── sst\_1
> │ │ ├── sst\_2
> │ │ └── sst\_3
> │ ├── 1096126227998177188652763624537212264741949407232
> │ │ ├── CURRENT
> │ │ ├── LOCK
> │ │ ├── LOG
> │ │ ├── MANIFEST-000002
> │ │ ├── sst\_0
> │ │ ├── sst\_1
> │ │ ├── sst\_2
> │ │ └── sst\_3
> 
> ├── slow
> │ └── leveldb
> │ ├── 0
> │ │ ├── sst\_4
> │ │ ├── sst\_5
> │ │ └── sst\_6
> │ ├── 1096126227998177188652763624537212264741949407232
> │ │ ├── sst\_4
> │ │ ├── sst\_5
> │ │ └── sst\_6
> 
> What, if anything is Riak building in your tree? Again, I had to create the 
> leveldb directory in each path manually. Did a chmod a+rwx on directories 
> fast, slow, fast/leveldb, and slow/leveldb. Then started the code and waited.
> 
> I was getting your LOCK crash before I added the data\_root line to the config.
> 
> Matthew
> 
> P.S. It may be hours before I respond again. Heading to the airport now.
> 
> 
> On Jun 8, 2015, at 12:24 PM, Joe Olson  wrote:
> 
> Also, I am testing as follows: make the changes to riak.conf, start riak as 
> root,wait a few minutes and issue a 'riak ping' as root. Riak usually starts 
> for 10-15 seconds, and then crashes (doesn't respond to the ping anymore)
> 
> 
> 
> From: "Joe Olson" 
> To: "Matthew Von-Maszewski" 
> Sent: Monday, June 8, 2015 11:22:24 AM
> Subject: Re: LevelDB
> 
> I think our email just crossed each other. Let me try again.
> 
> 
> 
> From: "Joe Olson" 
> To: "Matthew Von-Maszewski" 
> Cc: "riak-users" 
> Sent: Monday, June 8, 2015 11:21:26 AM
> Subject: Re: LevelDB
> 
> Matt - thanks for the support.
> 
> Adding
> leveldb.data\_root=“./leveldb”
> 
> results in
> "IO error: 
> /mnt/fast/./leveldb/91343852333181432387730302044767688728495783936/LOCK: No 
> such file or directory"
> 
> Changing it to 
> leveldb.data\_root=“leveldb”
> 
> results in 
> "IO error: 
> /mnt/fast/leveldb/91343852333181432387730302044767688728495783936/LOCK: No 
> such file or directory"}
> 
> Running "riak start" as root has no effect, and I also double checked the 
> directory permissions. I also manually created the leveldb subdirectory. 
> Still get the same results.
> 
> 
> 
> 
> 
> 
> From: "Matthew Von-Maszewski" 
> To: "Joe Olson" 
> Cc: "riak-users" 
> Sent: Monday, June 8, 2015 10:56:24 AM
> Subject: Re: LevelDB
> 
> Joe,
> 
> Long story short, I am slowly rebuilding my debug setup. Taking longer than 
> I thought. I suspect, but have not yet verified, that if you add one more 
> line:
> 
> leveldb.data\_root=“./leveldb”
> 
> … your troubles will go away. If you test that before I do, let me know your 
> results. I will get the documentation updated if it works.
> 
> Matthew
> 
> 
> On Jun 8, 2015, at 10:37 AM, Joe Olson  wrote:
> 
> 
> 
> Here you go. Thanks for the help. My riak.conf is mostly stock, except for 
> the LevelDB changes.
> 
> 
> 
> 
> 
> From: "Matthew Von-Maszewski" 
> To: "Mr. Technology" 
> Cc: "riak-users" 
> Sent: Saturday, June 6, 2015 9:08:00 AM
> Subject: Re: LevelDB
> 
> There is a script macro that puts paths together during program start. I 
> will go look at that.
> 
> It would help if you would send your riak.conf file.
> 
> Matthew
> 
> 
> On Jun 5, 2015, at 7:48 PM, Mr. Technology  wrote:
> 
> After installing Riak 2.1.1 on a 5 node Centos7 based test cluster, I 
> followed the instructions at 
> http://docs.basho.com/riak/latest/ops/advanced/backends/leveldb/ to attempt 
> to configure a tiered LevelDB backend.
> 
> My /etc/riak/riak.conf:
> 
> storage\_backend = leveldb
> leveldb.tiered = 4
> leveldb.tiered.path.fast = /mnt/fast
> leveldb.tiered.path.slow = /mnt/slow
> 
> Upon start, riak crashes with the following message in the log:
> 
> \*\* 
> {function\_clause,[{riak\_kv\_vnode,terminate,[{bad\_return\_value,{stop,{db\_open,"IO
> error: 
> /mnt/fast//var/lib/riak/leveldb/159851741583067506678528028578343455274867621888/LOCK:
> No such file or 
> directory"}}},undefined],[{file,"src/riak\_kv\_vnode.erl"},{line,1155}]},{riak\_core\_vnode,terminate,3,[{file,"src/riak\_core\_vnode.erl"},{line,907}]},{gen\_fsm,terminate,7,[{file,"gen\_fsm.erl"},{line,597}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,239}]}]}
> 
> I assume the error is due to riak trying to write to the bogus path:
> 
> /mnt/fast//var/lib/riak/leveldb/159851741583067506678528028578343455274867621888/LOCK
> 
> (bogus due to the double slash above)
> 
> Is this a bug, erroneous documentation, or a configuration problem?? I 
> followed the example as closely as I could.
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 
> 
> 
> 
> 
> 
> 
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

