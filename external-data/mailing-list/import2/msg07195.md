---
title: "Re: PB problems with 1.0.0 (and now 1.1.1)"
description: ""
project: community
lastmod: 2012-04-12T07:22:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07195"
mailinglist_parent_id: "msg07179"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-04-12T07:22:24-07:00
---


Peter,

This seems to be an issue with the release build and your environment. I
think the `protobuffs-0` means it couldn't discover the PB version number.
 I wonder if you have some other version of protobuffs installed in your
Erlang VM? E.g. I notice that
https://github.com/ngerakines/erlang\_protobuffs/blob/master/src/protobuffs.er
does not define `next\_field\_num`. What is the output if you start up
a
fresh erl shell and run `code:which(protobuffs).`?

-Z

On Mon, Apr 9, 2012 at 2:26 PM, Peter Fales
wrote:

> Following up on this issue from last October which bit me again with
> 1.1.1. Does anyone know why my deps/protobuffs/ebin/protobuffs.beam
> includes the function next\_field\_num function, but my
> rel/riak/lib/protobuffs-0/ebin/protobuffs.beam (and
> dev/dev\*/riak/lib/protobuffs-0/ebin/protobuffs.beam) are smaller
> and do not include the next\_field\_num function?
>
>
> On Thu, Oct 13, 2011 at 04:18:12PM -0500, Peter Fales wrote:
> > Thanks for the mail, though I thought I was using the latest client. The
> > client\_lib/README file points to
> https://bitbucket.org/basho/riak-python-client
> > and from there I ran the suggested command
> > (hg clone https://bitbucket.org/basho/riak-python-client)
> > to get the code.
> >
> > However, I found at least part of the problem, though I still don't quite
> > understand the root cause. In my riak-1.0.0 build directory,
> > ./deps/protobuffs/ebin/protobuffs.beam is 12692 and includes the string
> > next\_field\_num. However,
> ./rel/riak/lib/protobuffs-0/ebin/protobuffs.beam
> > is only 7536 and does not include that string. It appears that
> > the "rel" version is being built without the full protobuf code.
> >
> > When I run the server using the larger "deps" version, my test client
> works.
> >
> >
> > On Thu, Oct 13, 2011 at 05:08:00PM -0400, Reid Draper wrote:
> > > It looks like you're using version 1.2.2 of the client. I suggest
> trying
> > > 1.3.0 or the master branch from github.
> > >
> > > On Thu, Oct 13, 2011 at 3:37 PM, Peter Fales <
> peter.fa...@alcatel-lucent.com
> > > > wrote:
> > >
> > > > Trying to upgrade from 0.14.1 to 1.0.0...
> > > >
> > > > This python program works with 0.14.1:
> > > >
> > > > ====================================================================
> > > > import riak
> > > > client = riak.RiakClient(port=XXXX, host="YYYY.ZZZZ",
> > > > transport\_class=riak.RiakPbcTransport)
> > > > test\_bucket = client.bucket('test')
> > > > x=test\_bucket.new('0-0-0','hello6')
> > > > x.store()
> > > > ====================================================================
> > > > However, with the server running 1.0.0, I get:
> > > >
> > > > ====================================================================
> > > > Traceback (most recent call last):
> > > > File "./bench/client.py", line 6, in 
> > > > x.store()
> > > > File
> > > >
> "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/riak\_object.py",
> > > > line 296, in store
> > > > Result = t.put(self, w, dw, return\_body)
> > > > File
> > > >
> "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/transports/pbc.py",
> > > > line 188, in put
> > > > msg\_code, resp = self.recv\_msg()
> > > > File
> > > >
> "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/transports/pbc.py",
> > > > line 357, in recv\_msg
> > > > self.recv\_pkt()
> > > > File
> > > >
> "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/transports/pbc.py",
> > > > line 401, in recv\_pkt
> > > > format(nmsglen))
> > > > riak.RiakError: 'Socket returned short packet length - expected 4'
> > > > ====================================================================
> > > >
> > > > When this happens, console.logg gets:
> > > >
> > > > 2011-10-13 15:52:41.920 [error] <0.17823.0> CRASH REPORT Process
> > > > <0.17823.0> with 0 neighbours crashed with reason: call to undefined
> > > > function
> > > >
> protobuffs:next\_field\_num(<<10,4,116,101,115,116,18,5,48,45,48,45,48,34,28,10,8,34,104,101,108,108,111,54,34,18,16,97,112...>>)
> > > >
> > > >
> > > > Both 0.14.1 and 1.0.0 work with the HTTP interface, but I want to use
> > > > the PB interface.
> > > >
> > > > I suspect I'm just missing something simple, but I haven't been
> puzzling
> > > > over this for some time and haven't been able to find anything yet!
> > > >
> > > >
> > > > --
> > > > Peter Fales
> > > > Alcatel-Lucent
> > > > Member of Technical Staff
> > > > 1960 Lucent Lane
> > > > Room: 9H-505
> > > > Naperville, IL 60566-7033
> > > > Email: peter.fa...@alcatel-lucent.com
> > > > Phone: 630 979 8031
> > > >
> > > > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > > > riak-users mailing list
> > > > riak-users@lists.basho.com
> > > > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> > > >
> >
> > --
> > Peter Fales
> > Alcatel-Lucent
> > Member of Technical Staff
> > 1960 Lucent Lane
> > Room: 9H-505
> > Naperville, IL 60566-7033
> > Email: peter.fa...@alcatel-lucent.com
> > Phone: 630 979 8031
> >
> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > riak-users mailing list
> > riak-users@lists.basho.com
> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
> --
> Peter Fales
> Alcatel-Lucent
> Member of Technical Staff
> 1960 Lucent Lane
> Room: 9H-505
> Naperville, IL 60566-7033
> Email: peter.fa...@alcatel-lucent.com
> Phone: 630 979 8031
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

