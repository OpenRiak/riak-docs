---
title: "Re: RIAK-CS crashing with many HEAD requests"
description: ""
project: community
lastmod: 2013-04-10T16:44:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10842"
mailinglist_parent_id: "msg10823"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2013-04-10T16:44:13-07:00
---


Stefan,

Thanks for the report. We will investigate this and let you know what we
find.

Kelly

On Wed, Apr 10, 2013 at 5:05 AM, Silasi Stefan wrote:

> Hello,
>
> I'm testing RIAK-CS as an S3 alternative and I get some strange crashing
> when reading data from it. The following is reproducible with each run of
> the python script.
>
> conn = boto.connect\_s3(
> aws\_access\_key\_id = access\_key,
> aws\_secret\_access\_key = secret\_key,
> host = riak\_host,
> proxy = riak\_host,
> proxy\_port = 8080,
> calling\_format = boto.s3.connection.OrdinaryCallingFormat(),
> debug = 2,
> is\_secure = False,
> )
>
> bucket = conn.create\_bucket('bucket\_name')
>
> for row in rows:
> key=bucket.new\_key(valid\_key\_name)
> if key.exists():
> key.open\_read()
>
>
> If I monitor the riak-cs memory usage, it is growing and growing until
> it's using all RAM+SWAP, then it crashes.
> In the console log, the following line is appended before RIAK-CS crashes:
>
> 2013-04-10 08:28:40.802 [info] <0.41.0> alarm\_handler:
> {set,{system\_memory\_high\_watermark,[]}}
>
> Nothing related in the error.log.
> In access.log I see a lot of HEAD requests for the objects stored.
>
> Current architecture looks like this:
> - 3 virtual machines with 4 cores, 4gb ram, 2gb swap and 1tb disk each
> - RIAK installed on all of them, configured as cluster
> - stanchion installed on all of them
> - RIAK-CS installed on all of them, configured to "speak" only with local
> RIAK
> - about 10GB of data storred in each RIAK with N=3.
>
> The strange thing is that if I move the connect-to part in the FOR loop,
> RIAK-CS memory usage doesn't go over 300MB. Any ideas what could be wrong?
>
> Thank you,
> Stefan.
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

