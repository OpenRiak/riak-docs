---
title: "Re: Using the Local Client from a riak-attach session"
description: ""
project: community
lastmod: 2013-01-18T10:03:57-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09839"
mailinglist_parent_id: "msg09838"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-01-18T10:03:57-08:00
---


Hi Derek,

The Riak Erlang client (https://github.com/basho/riak-erlang-client) has good 
support for mapreduce, so it may be worthwhile switching to this. 

Here is an example of how to count records returned by a 2i lookup using a map 
reduce query:

riakc\_pb\_socket:mapred(Pid, {index, <<"bucket">>, <<"index\_int">>, <<"1">>, 
<<"50">>},
 [{reduce, {modfun, 'riak\_kv\_mapreduce', 
'reduce\_count\_inputs'}, none, true}]).

Hope this helps.

Best regards,

Christian

--------------------
Christian Dahlqvist
Client Services Engineer
Basho Technologies
EMEA Office
E-mail: christ...@basho.com
Skype: c.dahlqvist
Mobile: +44 7890 590 910

On 18 Jan 2013, at 09:48, Evan Vigil-McClanahan  wrote:

> Note that this uses the luke mapreduce subsystem, which isn't a good
> idea as it's been deprecated going forward.
> 
> Unfortunately there doesn't seem to be a way that's as simple to do
> pipe mapreduce jobs. I'll ping people and see if we can't get you all
> some code that's slightly easier to use.
> 
> On Fri, Jan 18, 2013 at 5:09 AM, Derek Sanderson  wrote:
>> I love this mailing list
>> 
>> Thank you Daniil! I had almost exactly the first thing you recommended, but
>> the example I found had a slightly different notation, and was throwing
>> errors that I couldn't figure out.
>> 
>> Your example seems to be working, and I think I can get past my issue
>> 
>> Thanks again
>> 
>> 
>> On Thu, Jan 17, 2013 at 10:30 PM, Daniil Churikov  wrote:
>>> 
>>> Another option, if you want range query:
>>> 
>>> {ok, C} = riak:local\_client(),
>>> {ok, Keys} = C:get\_index(<<"bucket\_name">>, {range,
>>> <<"key\_name\_bin">>,
>>> KeyStart, KeyTo}),
>>> ...
>>> 
>>> 
>>> 
>>> --
>>> View this message in context:
>>> http://riak-users.197444.n3.nabble.com/Using-the-Local-Client-from-a-riak-attach-session-tp4026572p4026578.html
>>> Sent from the Riak Users mailing list archive at Nabble.com.
>>> 
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>> 
>> 
>> 
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

