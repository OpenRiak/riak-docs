---
title: "Re: Rolling upgrade from 1.4.2 to 2.0.5"
description: ""
project: community
lastmod: 2015-08-24T02:53:30-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16451"
mailinglist_parent_id: "msg16404"
author_name: "Sujay Mansingh"
project_section: "mailinglistitem"
sent_date: 2015-08-24T02:53:30-0700
---


Hi guys

I am looking at the instructions here:
http://docs.basho.com/riak/1.4.2/ops/running/nodes/renaming/

However, these are instructions for renaming an existing cluster ‘in-place’.

What I have is an existing 5 node cluster.
I have brought up a completely new (and separate) 5 node cluster.
I am copying over the bitcask data and /var/lib/riak/ring directories from
each existing node to the new cluster. (i.e. from existing-01 to new-01,
existing-02 to new-02, etc)

The instructions above mention to join the cluster, but I don’t wish to do
that (as it would join a new node to the existing cluster).

At the moment I have not formed the new cluster (all 5 riak nodes are
standalone).
What do I need to do in order to rename the ring on the nodes in the new
cluster?

Sujay
​

On Tue, Aug 11, 2015 at 4:47 PM, Dmitri Zagidulin 
wrote:

> Hi Sujay,
>
> Yes, riak.conf is a riak 2 thing. If you're running 1.4, you would change
> the -setcookie in vm.args, exactly.
>
> And no, the node name doesn't have to match the cookie. The two are
> independent.
>
> On Tue, Aug 11, 2015 at 3:22 PM, Sujay Mansingh  wrote:
>
>> Oh and also, does the first part of the riak node name have to match the
>> cookie?
>> I.e. If I change the cookie to riaktest, does the node name have to be
>> riaktest@{{ ip\_addr }} ?
>>
>>
>> On Tuesday, August 11, 2015, Sujay Mansingh  wrote:
>>
>>> Thanks Dmitri
>>>
>>> When you say the cookie must be modified in /etc/riak/riak.conf, is
>>> that a riak 2 thing?
>>> I can see a -setcookie riak line in /etc/riak/vm.args, is that what you
>>> mean?
>>>
>>> Sujay
>>> ​
>>>
>>> On Thu, Aug 6, 2015 at 2:11 PM, Dmitri Zagidulin 
>>> wrote:
>>>
>>>> Sujay,
>>>>
>>>> You're right - the best way to verify the backup is to bring up a
>>>> separate 5 node cluster, and restore it from the backup files.
>>>> The procedure is slightly more involved than untar-ing, though. The
>>>> backed up ring directories from the original cluster will contain the node
>>>> ids (which rely on their IP addresses, etc). Since the new re-hydrated
>>>> cluster is likely to have different IPs from the original one, there's a
>>>> few more steps you need to take.
>>>>
>>>> The procedure of standing up a new cluster from backups is outlined
>>>> here:
>>>> http://docs.basho.com/riak/latest/ops/running/nodes/renaming/#Clusters-from-Backups
>>>>
>>>> There is one other important step to remember. If, by any chance,
>>>> you're bringing up the new cluster on the same network as the old cluster
>>>> is running on, be sure to modify the Erlang cookie in the new cluster (so
>>>> that as far as Erlang is concerned, they're existing on different 
>>>> networks).
>>>> The Erlang cookie must be modified in /etc/riak/riak.conf so the new
>>>> cluster does not conflict with any existing cluster.
>>>>
>>>> Let us know if you have any further questions.
>>>>
>>>> Dmitri
>>>>
>>>> On Thu, Aug 6, 2015 at 8:40 AM, Sujay Mansingh  wrote:
>>>>
>>>>> Thanks Magnus & John.
>>>>>
>>>>> Yes certainly I will test it on a separate cluster first! Which is
>>>>> related to another question I have.
>>>>>
>>>>> If I want to backup I can archive the directories on the nodes as
>>>>> described here:
>>>>> http://docs.basho.com/riak/latest/ops/running/backups/#OS-Specific-Directory-Locations
>>>>>
>>>>> But in order to verify the backup (or perform operations on the
>>>>> cluster in 'offline' mode), can I simply bring up a separate 5 node 
>>>>> cluster
>>>>> and untar the backup files?
>>>>> (Probably not the /etc/riak directory, but the data and ring
>>>>> directories.)
>>>>>
>>>>> I want to do that, and then try adding a riak 2.0.6 node to the test
>>>>> riak 1.4.2 cluster and see if things are ok.
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Sujay
>>>>>
>>>>> On Thu, Aug 6, 2015 at 9:31 AM, Magnus Kessler 
>>>>> wrote:
>>>>>
>>>>>>
>>>>>>
>>>>>> On 5 August 2015 at 18:53, John Daily  wrote:
>>>>>>
>>>>>>> That’s correct: upgrades to either 2.0.x or 2.1.x are supported from
>>>>>>> the 1.4 series.
>>>>>>>
>>>>>>> Side note: I definitely recommend testing the upgrade process in a
>>>>>>> QA environment first.
>>>>>>>
>>>>>>> -John
>>>>>>>
>>>>>>
>>>>>> Hi Sujay,
>>>>>>
>>>>>> The latest release in the 2.0 series is 2.0.6 [0]. Please use this
>>>>>> version if you upgrade to 2.0.
>>>>>>
>>>>>> Please also review the documentation about the new 'riak.conf'
>>>>>> configuration file [1][2]. 2.x installations should use the new format, 
>>>>>> but
>>>>>> you can continue to use the 'app.config' format from Riak 1.x. To 
>>>>>> maintain
>>>>>> complete backwards compatibility when using 'app.config', please add
>>>>>>
>>>>>> [{default\_bucket\_props,
>>>>>> [{allow\_mult,false}, %% have Riak resolve conflicts and do not return 
>>>>>> siblings
>>>>>> {dvv\_enabled,false}]}, %% use vector clocks for conflict resolution
>>>>>> %% other settings
>>>>>> ]
>>>>>>
>>>>>> to 'app.config'. This will ensure that your existing application
>>>>>> continues to work exactly as before. When using 'riak.conf', these 
>>>>>> settings
>>>>>> will be applied automatically.
>>>>>>
>>>>>>
>>>>>> Magnus
>>>>>>
>>>>>> [0] http://docs.basho.com/riak/2.0.6/downloads/
>>>>>> [1]
>>>>>> http://docs.basho.com/riak/latest/intro-v20/#Simplified-Configuration-Management
>>>>>> [2]
>>>>>> http://docs.basho.com/riak/latest/ops/advanced/configs/configuration-files/
>>>>>>
>>>>>> On Aug 5, 2015, at 12:13 PM, Sujay Mansingh  wrote:
>>>>>>>
>>>>>>>
>>>>>>> Hello all, I have a 5 node riak cluster, all nodes running 1.4.2.
>>>>>>>
>>>>>>> I want to upgrade to riak 2.x
>>>>>>>
>>>>>>> According to this:
>>>>>>> http://docs.basho.com/riak/latest/ops/upgrading/rolling-upgrades/ I
>>>>>>> can perform a rolling upgrade (a mixed cluster)
>>>>>>> as long as the versions aren't more than 2 versions apart.
>>>>>>>
>>>>>>> There is no riak 1.5 so would riak 1.4.2 -> 2.0.5 count as 1 version
>>>>>>> apart?
>>>>>>>
>>>>>>> Sujay
>>>>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>>>>> riak-users mailing list
>>>>>>> riak-users@lists.basho.com
>>>>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>>>>> riak-users mailing list
>>>>>>> riak-users@lists.basho.com
>>>>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>>>>
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Magnus Kessler
>>>>>> Client Services Engineer @ Basho
>>>>>>
>>>>>> Registered Office - 8 Lincoln’s Inn Fields London WC2A 3BP Reg
>>>>>> 07970431
>>>>>>
>>>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>>>> riak-users mailing list
>>>>>> riak-users@lists.basho.com
>>>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>>>
>>>>>>
>>>>>
>>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>>> riak-users mailing list
>>>>> riak-users@lists.basho.com
>>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>>
>>>>>
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>>
>>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

