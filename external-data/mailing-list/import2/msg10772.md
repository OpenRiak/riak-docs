---
title: "Re: Using Fog with Ruby"
description: ""
project: community
lastmod: 2013-04-08T16:10:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10772"
mailinglist_parent_id: "msg10764"
author_name: "Hector Castro"
project_section: "mailinglistitem"
sent_date: 2013-04-08T16:10:32-07:00
---


Hi Michael,

I believe that you are seeing this error because the `cs\_root\_host`
Riak CS configuration option and `:host` (in the script's
configuration map) are not the same. Once you update `cs\_root\_host`,
make sure that you restart Riak CS for the changes to take effect.

--
Hector


On Mon, Apr 8, 2013 at 5:44 PM, Michael Holt  wrote:
> There is an Nginx server acting as a proxy in front of Riak CS.
>
>
>
> There is not a problem listing all the users with
> Fog::RiakCS::Provisioning.new but usage (Fog::RiakCS::Usage.new) with the
> same configuration has an Access Denied error.
>
>
>
> --
>
> Michael Holt
>
>
>
> From: Tom Santero [mailto:tsant...@basho.com]
> Sent: Monday, April 08, 2013 5:41 PM
> To: Michael Holt
> Cc: riak-users@lists.basho.com
> Subject: Re: Using Fog with Ruby
>
>
>
> Hi Michael,
>
>
>
> You have port 80 listed in configuration, default port is 8080.
>
>
>
> Tom
>
> On Mon, Apr 8, 2013 at 5:35 PM, Michael Holt  wrote:
>
> I have a small script that I am trying to set up that can read usage stats
> in Ruby Fog. The script is largely pieced together from examples from the
> Basho site and Fog github project. The script is below.
>
>
>
> The issue I am running into is the following error:
>
> 
>
> `AccessDenied`
>
> Access Denied
>
>
> /riak-cs/usage/OJIPWXM698VYGEMGZLIV/bx/20130401T000000Z/20130430T235959Z.abj.20130407T213209Z.20130408T213209Z
>
> 
>
> 
>
>
>
> The list user (users = provisioning.list\_users.body) works. The key and
> secret is for the admin user.
>
>
>
> Why would I get an Access Denied for the admin user?
>
>
>
> --------------RUBY CODE-------------
>
> require 'rubygems'
>
> require 'fog'
>
>
>
> def show\_usage(usage, key)
>
> utilization = usage.get\_usage( "/usage/#{key}",
>
> :types => [:access, :storage]
>
> )
>
>
>
> objects = 0
>
> bytes = 0
>
>
>
> # Retrieve Storage information
>
> utilization.body['Storage']['Samples'][0].each do |k,v|
>
> # Sum the # of objects and bytes stored from each user
> bucket for per tenant totals
>
> if v.is\_a?(Hash) # To ignore StartTime & EndTime
>
> objects += v['Objects']
>
> bytes += v['Bytes']
>
> end
>
> end
>
>
>
> puts " showUsage objects: #{objects}"
>
> puts " showUsage bytes: #{bytes}"
>
> end
>
>
>
> configuration = {
>
> :riakcs\_access\_key\_id => "OJIPWXM698VYGEMGZLIV",
>
> :riakcs\_secret\_access\_key => "fTbOq8WIBiHrUnHxBgRLDIOyo4yK2Qysrx3vjA==",
>
> :host => 'localhost',
>
> :port => 80,
>
> :scheme => "http"
>
> }
>
>
>
> Excon.defaults[:ssl\_verify\_peer] = false
>
>
>
> # Requests for User Provision and Usage information
>
> provisioning = Fog::RiakCS::Provisioning.new(configuration)
>
> usage = Fog::RiakCS::Usage.new(configuration)
>
>
>
>
>
> users = provisioning.list\_users.body
>
>
>
> # The following block of code displays all available information for every
> user
>
> users.each do | user |
>
>
>
> utilization =
> usage.get\_usage("/usage/#{user['key\_id']}/bx/20130401T000000Z/20130430T235959Z",
> :types => [:access, :storage])
>
>
>
> puts
> "ยง=================================================================================ยง"
>
> puts " name: #{user['name']}"
>
> puts " display\_name: #{user['display\_name']}"
>
> puts " email: #{user['email']}"
>
> puts " id: #{user['id']}"
>
> puts " key\_id: #{user['key\_id']}"
>
> puts " key\_secret: #{user['key\_secret']}"
>
> puts " status: #{user['status']}"
>
> show\_usage usage, user['key\_id']
>
> end
>
> puts
> "ยง=================================================================================ยง"
>
>
>
> --
>
> Michael Holt
>
>
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
>
>
>
> --
> @tsantero
> Technical Evangelist
> Basho Technologies
> 347-571-3995
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

