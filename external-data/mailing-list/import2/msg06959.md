---
title: "Need help understanding read-repair (eleveldb backend)"
description: ""
project: community
lastmod: 2012-03-14T15:17:42-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06959"
author_name: "Travis Turner"
project_section: "mailinglistitem"
sent_date: 2012-03-14T15:17:42-07:00
---


I have set up a test 3-node cluster with eleveldb backend (I'll call them nodes 
node-A, node-B, & node-C)
I populated a single bucket with 52,000 objects, 250 of which contain a 
specific secondary index that i can query on.
Bucket properties are set to default:

{"props":{"name":"my\_bucket","allow\_mult":false,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":"quorum","rw":"quorum","small\_vclock":50,"w":"quorum","young\_vclock":20}}


For queries, I use the Riak python binding w/ protocol buffers.

Under normal conditions:
bucket.get\_keys() returns 52000 keys (as expected)
MapReduce.index(my\_secondary\_index) returns 250 keys (as expected)


Next, I tested the failure of one node (node-C) by doing:
node-C> riak stop
node-A> riak-admin down node-C
node-A> riak-admin force-remove node-C

At this point, my test queries look like:
bucket.get\_keys() returns ~34,600 keys
MapReduce.index(secondary\_index) returns ~170 keys


I understand that I can force read-repair on all of the objects by reading all 
objects in the bucket with a R less than N.
My question is, how do I get a list of all keys in the bucket when get\_keys() 
doesn't seem to return the full list of keys once a node has gone away?
Ultimately, I would like to make sure my secondary-index query returns the 
correct result even if a node goes away.

Travis
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

