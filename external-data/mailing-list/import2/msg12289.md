---
title: "Secondary indexes in ruby (using riak-ruby-client)"
description: ""
project: community
lastmod: 2013-09-17T15:40:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12289"
author_name: "Wagner Camarao"
project_section: "mailinglistitem"
sent_date: 2013-09-17T15:40:40-07:00
---


Hi,

I'm trying to get a hello world example working as follows:

require 'riak'

client = Riak::Client.new
bucket = client.bucket('revisions')

object = Riak::RObject.new(bucket, 'foo').tap do |o|
 o.content\_type = 'application/json'
 o.data = ''
end

object.indexes[:bars\_bin] = %w(foo bar)
object.store

bucket.get\_index 'bars\_bin', 'foo'

But am failing with:

Zlib::DataError: incorrect header check
from
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http/response.rb:357:in
`finish'

Any help would be appreciated.

More error details below:

-- Control frame information -----------------------------------------------
c:0024 p:0040 s:0122 e:000122 BLOCK
 /crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:65
[FINISH]
c:0023 p:---- s:0119 e:000118 CFUNC :each
c:0022 p:0035 s:0116 e:000115 BLOCK
 /crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:58
c:0021 p:0014 s:0113 e:000112 BLOCK
 /Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1413
c:0020 p:0033 s:0111 e:000110 METHOD
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http/response.rb:162
c:0019 p:0096 s:0106 e:000105 BLOCK
 /Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1412
[FINISH]
c:0018 p:---- s:0104 e:000103 CFUNC :catch
c:0017 p:0024 s:0100 e:000099 METHOD
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1403
c:0016 p:0061 s:0093 e:000092 METHOD
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1376
c:0015 p:0017 s:0086 E:002090 BLOCK
 /crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:56
[FINISH]
c:0014 p:---- s:0083 e:000082 CFUNC :tap
c:0013 p:0190 s:0080 E:001ba0 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:54
c:0012 p:0032 s:0070 e:000069 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/http\_backend/transport\_methods.rb:44
c:0011 p:0239 s:0063 e:000062 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/http\_backend.rb:297
c:0010 p:0016 s:0053 e:000052 BLOCK
 /crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:266
c:0009 p:0010 s:0050 e:000049 BLOCK
 /crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:434
c:0008 p:0078 s:0046 E:001ac0 METHOD
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/gems/2.0.0/gems/innertube-1.0.2/lib/innertube.rb:127
c:0007 p:0050 s:0040 E:001a50 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:432
c:0006 p:0012 s:0032 e:000031 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:285
c:0005 p:0035 s:0028 e:000027 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:138
c:0004 p:0011 s:0024 E:001da8 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:265
c:0003 p:0020 s:0017 e:000016 METHOD
/crunchbase/open\_source/riak-ruby-client/lib/riak/bucket.rb:179
c:0002 p:0088 s:0011 E:001930 EVAL bench/2i.rb:14 [FINISH]
c:0001 p:0000 s:0002 E:000228 TOP [FINISH]

bench/2i.rb:14:in `'
/crunchbase/open\_source/riak-ruby-client/lib/riak/bucket.rb:179:in
`get\_index'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:265:in
`get\_index'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:138:in `backend'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:285:in `http'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:432:in
`recover\_from'
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/gems/2.0.0/gems/innertube-1.0.2/lib/innertube.rb:127:in
`take'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:434:in `block
in recover\_from'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client.rb:266:in `block
in get\_index'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/http\_backend.rb:297:in
`get\_index'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/http\_backend/transport\_methods.rb:44:in
`get'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:54:in
`perform'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:54:in
`tap'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:56:in
`block in perform'
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1376:in
`request'
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1403:in
`transport\_request'
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1403:in
`catch'
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1412:in
`block in transport\_request'
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http/response.rb:162:in
`reading\_body'
/Users/wagner/.rbenv/versions/2.0.0-p195/lib/ruby/2.0.0/net/http.rb:1413:in
`block (2 levels) in transport\_request'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:58:in
`block (2 levels) in perform'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:58:in
`each'
/crunchbase/open\_source/riak-ruby-client/lib/riak/client/net\_http\_backend.rb:65:in
`block (3 levels) in perform'
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

