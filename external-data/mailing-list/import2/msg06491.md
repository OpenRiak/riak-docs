---
title: "Re: error: undef done()"
description: ""
project: community
lastmod: 2012-02-01T10:36:57-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06491"
mailinglist_parent_id: "msg06486"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2012-02-01T10:36:57-08:00
---


On Wed, Feb 1, 2012 at 11:43 AM, Matthew A. Brown  wrote:
> Thanks much for the info. We're running Riak 1.0.3. I think in our
> case what would've made this easier to track down would have been not
> having the error output cut off in the log -- since the inputs to the
> reduce comprised a pretty large set, the output cut off before the
> call trace, which appears after the dump of the inputs. It was pretty
> easy to track down once I narrowed down the inputs to a manageable
> size that still reproduced the error.

Agreed - it's so hard to know how much context is useful, and how much
is too much. However, I think you'll find that the upcoming Riak 1.1
release already does much better in this situation.

I just created a small sample to reproduce what you found, where I
have a reduce function that calls bryan:does\_not\_exist/0, which is
undefined. In 1.0.3, as you reported, you see no indication of error
in the return value, and useless spew on the error console like:

 13:26:43.720 [error] error:undef done():
 [...so many inputs that the stack trace is omitted...

In the upcoming 1.1 release, using the HTTP interface at /mapred, you
receive a JSON object like:

 {"phase":0,
 
"error":"{undef,[{bryan,does\_not\_exist,[]},{riak\_kv\_w\_reduce,reduce,3},{riak\_kv\_w\_reduce,done,1},{riak\_pipe\_vnode\_worker,wait\_for\_input,2},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}"
 "inputs":...}

As well as a much more informational message on the error console:

 13:27:48.143 [error] gen\_fsm <0.1484.0> in state wait\_for\_input
terminated with reason: call to undefined function
bryan:does\_not\_exist/0 from riak\_kv\_w\_reduce:reduce/3

Hope this helps,
Bryan

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

