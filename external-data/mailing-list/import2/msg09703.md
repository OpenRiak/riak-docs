---
title: "Re: strange behavior upgrading from riak-java-client 1.0.5 -> 1.0.6"
description: ""
project: community
lastmod: 2012-12-28T12:35:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09703"
mailinglist_parent_id: "msg09702"
author_name: "Dietrich Featherston"
project_section: "mailinglistitem"
sent_date: 2012-12-28T12:35:14-08:00
---


I don't believe allow\_mult is enabled. It shouldn't be at least!

On Dec 28, 2012, at 1:23 PM, Brian Roach  wrote:

> On Fri, Dec 28, 2012 at 12:34 PM, Dietrich Featherston
>  wrote:
>> Primarily stores but I did see one case of socket timeouts simply building a 
>> new connection pool using the rjc.
> 
> This should be simply a result of attempting to bring up another
> instance of the client when the node can't accept more connections and
> when it tries to "warm up" the connection pool, those connections time
> out.
> 
>> We are simply doing a put. It is not uncommon for keys to be overwritten but 
>> we are not
>> providing a vector clock. There is a dedicated master performing the write 
>> for a given key
>> upstream from riak and overwriting is always safe (assuming last one wins) 
>> but we don't
>> hold onto the vector clock.
>> 
>> It seems possible/likely that we are inadvertently invoking some riak 
>> consistency
>> machinery by turning off the get prior to put using withoutFetch(). Would it 
>> help to attempt
>> to coordinate writes in another way?
> 
> Are you using a bucket with allow\_mult enabled?
> 
>> Somewhat related: I've been curious about writing a smart riak client that 
>> writes to a node
>> based on the preflist for a key to avoid unnecessary internal handing off of 
>> reads and
>> writes when possible. Two things strike me though 1) would need to compute 
>> this preflist
>> outside of riak and 2) unsure how impactful this change would be without 
>> better
>> understanding where internal riak bottlenecks present themselves. Perhaps 
>> best left for
>> another thread.
> 
> Yeah - a bit off topic but we've talked about this (not in great
> detail as of yet) internally.
> 
> - Roach

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

