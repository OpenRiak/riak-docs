---
title: "Riak/LevelDB Memory Usage"
description: ""
project: community
lastmod: 2013-09-06T09:35:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12201"
author_name: "Shane McEwan"
project_section: "mailinglistitem"
sent_date: 2013-09-06T09:35:51-07:00
---



G'day!

Our Riak nodes have 48GB of RAM in them. When we installed Riak 1.2.0 on 
them we tuned the LevelDB settings as per the Parameter Planning section 
in http://docs.basho.com/riak/1.2.0/tutorials/choosing-a-backend/LevelDB/


 {eleveldb, [
 {write\_buffer\_size\_min, 31457280},
 {write\_buffer\_size\_max, 62914560},
 {cache\_size, 300000000},
 {max\_open\_files, 300}
 ]},

With 64 vnodes per node, an average SST size of 2MB, key size of 150B 
and average value size of 1024B we were expecting our Riak memory usage 
to peak at around 24GB . . . the recommended 50% of system memory.


Currently the Riak process on each of our nodes is using 32GB of RAM and 
still rising.


I've noticed that since we moved to Riak 1.3.1 new SST files are no 
longer 2MB but are now 100MB. Recalculating memory usage based on that 
gives me an expected usage of 32GB. So maybe that explains the higher 
memory usage than expected.


So, 2 questions:

Can we expect the memory usage to plateau soon?

The cache\_size of 300MB should allow for one of our nodes to go down and 
we'll still be under the 50% threshold when the 64 down vnodes are 
shared amongst the remaining three nodes . . . except we're already 
using more than the 24GB threshold (or the new 32GB threshold with 100MB 
SSTs) with all four nodes still up. How can this be?


I'd appreciate if someone could do the math for me and come up with 
suggested tuning parameters because I'm losing faith in the documentation:


Riak: 1.3.1
Nodes: 4
Total RAM per node: 48GB
Desired RAM allocated to Riak: 24GB
ring\_creation\_size: 256
Partitions per node: 64

Thanks!

Shane.


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

