---
title: "Re: Performance Tuning in OmniOS"
description: ""
project: community
lastmod: 2014-01-21T11:40:25-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13438"
mailinglist_parent_id: "msg13430"
author_name: "Tom Santero"
project_section: "mailinglistitem"
sent_date: 2014-01-21T11:40:25-08:00
---


this message from Hari John Kuriakose was accidentally auto-discarded.
(sorry!)

From: Hari John Kuriakose 
To: Jared Morrow 
Cc: riak-users , Hector Castro 
Date: Wed, 22 Jan 2014 00:35:37 +0530
Subject: Re: Performance Tuning in OmniOS

I am using the default raid itself.

Well, if this is the case, I will run the tests again with a different
setup as you said, and get back as soon as possible. I would just like to
believe that OmniOS is not too hopeless.

Thank you.



On Tue, Jan 21, 2014 at 12:47 PM, Jared Morrow  wrote:

> What type of RAID did you chose for your spool of 5 volumes? If you chose
> the default of raidz, you will not be getting much of a performance boost
> over vanilla EBS, just a big integrity boost. Also, unless you are using
> provisioned IOPS for EBS, you are starting from an extremely slow
> base-case, so adding ZFS on top might not help matters much.
>
> If speed is the concern, as a test I'm willing to bet if you do another
> test run against the two instance storage disks on that m1.large, you will
> probably beat those 5 EBS volumes pretty easily.
>
> -Jared
>
>
> On Tue, Jan 21, 2014 at 9:22 AM, Hari John Kuriakose wrote:
>
>> Hello,
>>
>> I am using standard EBS devices, with a zpool in an instance comprising
>> of five 40GB volumes.
>> Each of the Riak instance is of m1.large type.
>>
>> I have made the following changes in zfs properties:
>>
>> # My reason: the default sst block size for leveldb is 4k.
>> zfs set recordsize=4k tank/riak
>> # My reason: by default, leveldb verifies checksums automatically.
>> zfs set checksum=off tank/riak
>> zfs set atime=off tank/riak
>> zfs set snapdir=visible tank/riak
>>
>> And I did the following with help from Basho AWS tuning docs:
>>
>> projadd -c "riak" -K "process.max-file-descriptor=(basic,65536,deny)"
>> user.riak
>> bash -c "echo 'set rlim\_fd\_max=65536' >> /etc/system"
>> bash -c "echo 'set rlim\_fd\_cur=65536' >> /etc/system"
>> ndd -set /dev/tcp tcp\_conn\_req\_max\_q0 40000
>> ndd -set /dev/tcp tcp\_conn\_req\_max\_q 4000
>> ndd -set /dev/tcp tcp\_tstamp\_always 0
>> ndd -set /dev/tcp tcp\_sack\_permitted 2
>> ndd -set /dev/tcp tcp\_wscale\_always 1
>> ndd -set /dev/tcp tcp\_time\_wait\_interval 60000
>> ndd -set /dev/tcp tcp\_keepalive\_interval 120000
>> ndd -set /dev/tcp tcp\_xmit\_hiwat 2097152
>> ndd -set /dev/tcp tcp\_recv\_hiwat 2097152
>> ndd -set /dev/tcp tcp\_max\_buf 8388608
>>
>> Thanks again.
>>
>>
>> On Tue, Jan 21, 2014 at 9:12 PM, Hector Castro  wrote:
>>
>>> Hello,
>>>
>>> Can you please clarify what type of disk you are using within AWS?
>>> EBS, EBS with PIOPS, instance storage? In addition, maybe some details
>>> on volume sizes and instance types.
>>>
>>> These details may help someone attempting to answer your question.
>>>
>>> --
>>> Hector
>>>
>>>
>>> On Tue, Jan 21, 2014 at 8:11 AM, Hari John Kuriakose 
>>> wrote:
>>> >
>>> > I am running LevelDB on ZFS in Solaris (OmniOS specifically) in Amazon
>>> AWS.
>>> > The iops is very very low. There is no significant progress with
>>> tuning too.
>>> >
>>> > Why I chose ZFS is that since LevelDB requires the node to be stopped
>>> before
>>> > taking a backup, I needed a filesystem with snapshot ability. And the
>>> most
>>> > favourable Amazon community AMI seemed to be using OmniOS (fork of
>>> Solaris).
>>> > Everything is fine, except the performance.
>>> >
>>> > I did all the AWS tuning proposed by Basho but still Basho Bench gave
>>> twice
>>> > iops on Ubuntu as compared to OmniOS, under same conditions. Also, I am
>>> > using riak-js client library, and its a 5 node Riak cluster with 8GB
>>> ram
>>> > each.
>>> >
>>> > Could not yet figure out what is really causing the congestion in
>>> OmniOS.
>>> > Any pointers will be really helpful.
>>> >
>>> > Thanks and regards,
>>> > Hari John Kuriakose.
>>> >
>>> >
>>> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> > riak-users mailing list
>>> > riak-users@lists.basho.com
>>> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>> >
>>>
>>
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

