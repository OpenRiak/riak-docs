---
title: "Re: Java Riak client can't handle a Riak node failure?"
description: ""
project: community
lastmod: 2015-10-07T05:30:21-0700
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16615"
mailinglist_parent_id: "msg16613"
author_name: "Dmitri Zagidulin"
project_section: "mailinglistitem"
sent_date: 2015-10-07T05:30:21-0700
---


Hi Vanessa,

Riak is definitely meant to run behind a load balancer. (Or, at the worst
case, to be load-balanced on the client side. That is, all clients connect
to all 4 nodes).

When you say "we did try putting all 4 Riak nodes behind a load-balancer
and pointing the clients at it, but it didn't help." -- what do you mean
exactly, by "it didn't help"? What happened when you tried using the load
balancer?



On Wed, Oct 7, 2015 at 1:57 PM, Vanessa Williams <
vanessa.willi...@thoughtwire.ca> wrote:

> Hi all, we are still (for a while longer) using Riak 1.4 and the matching
> Java client. The client(s) connect to one node in the cluster (since that's
> all it can do in this client version). The cluster itself has 4 nodes
> (sorry, we can't use 5 in this scenario). There are 2 separate clients.
>
> We've tried both n\_val = 3 and n\_val=4. We achieve consistency-by-writes
> by setting w=all. Therefore, we only require one successful read (r=1).
>
> When all nodes are up, everything is fine. If one node fails, the clients
> can no longer read any keys at all. There's an exception like this:
>
> com.basho.riak.client.RiakRetryFailedException:
> java.net.ConnectException: Connection refused
>
> Now, it isn't possible that Riak can't operate when one node fails, so
> we're clearly missing something here.
>
> Note: we did try putting all 4 Riak nodes behind a load-balancer and
> pointing the clients at it, but it didn't help.
>
> Riak is a high-availability key-value store, so... why are we failing to
> achieve high-availability? Any suggestions greatly appreciated, and if more
> info is required I'll do my best to provide it.
>
> Thanks in advance,
> Vanessa
>
> --
> Vanessa Williams
> ThoughtWire Corporation
> http://www.thoughtwire.com
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

