---
title: "Re: Errors, 'preflist_exhausted' & 'worker_limit_reached' when trying	to read data from Riak"
description: ""
project: community
lastmod: 2012-07-25T22:05:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08074"
mailinglist_parent_id: "msg07921"
author_name: "Balamurugan V G"
project_section: "mailinglistitem"
sent_date: 2012-07-25T22:05:10-07:00
---


Hi,

I am trying to get started with Riak, so installed the
'riak\_1.1.4-1\_i386.deb' on a Ubuntu 12.04 LTS 32bit System running in a
Virtual Box VM. I no not have any cluster.

>
> I have a script which does the following:
>
> 1. It creates 50 child processes which run in parallel
> 2. Each Child process does the following
> a. Creates 1000 entries using the provides REST interface. The entry
> is a simple json value with 4 attributes and an integer key. This goes
> through fine.
>
> The Json object is something like {"name": "Test1", "title":
> "This is the title for Test1", "count": 1, "pid": 1234}. The pid is the
> process ID of the process creating the entry. I later use this to query the
> entries created by the process.
>
> b. Reads the entries created by it. A Javascript Map function which
> is stored as an object is used to filter and return only the entries
> created by the process
>
>
> During the reads, I get the following errors in HTTP response:
>
>
>
> {"phase":0,"error":"[worker\_limit\_reached]","input":"{<<\"samples\">>,<<\"11505823\">>}","type":"result","stack":"[]"}
>
> and
>
> {"phase":0,"error":"[preflist\_exhausted]","input":"{ok,{r\_object,<<\"samples\">>,<<\"11506270\">>,[{r\_content,{dict,7,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[<<\"Links\">>]],[],[],[],[],[],[],[],[[<<\"content-type\">>,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110],[<<\"X-Riak-VTag\">>,78,109,90,48,101,81,88,51,55,54,85,120,120,115,68,101,71,108,76,77,71]],[[<<\"index\">>]],[],[[<<\"X-Riak-Last-Modified\">>|{1342,87419,992551}]],[],[[<<\"charset\">>,85,84,70,45,56],[<<\"X-Riak-Meta\">>]]}}},<<\"{
> \\n ...\">>}],...},...}","type":"forward\_preflist","stack":"[]"}
>
> The crash log has these:
>
> 2012-07-12 15:24:10 =ERROR REPORT====
> Module riak\_kv\_pipe\_get must be purged before loading
>
> 2012-07-12 15:24:10 =ERROR REPORT====
> Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_pipe\_get.beam
> failed: not\_purged
> 2012-07-12 15:24:10 =ERROR REPORT====
> Module riak\_kv\_pipe\_get must be purged before loading
>
> 2012-07-12 15:24:10 =ERROR REPORT====
> Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_pipe\_get.beam
> failed: not\_purged
> 2012-07-12 15:24:10 =ERROR REPORT====
> Module riak\_kv\_pipe\_get must be purged before loading
>
> 2012-07-12 15:24:10 =ERROR REPORT====
> Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_pipe\_get.beam
> failed: not\_purged
> 2012-07-12 15:24:10 =ERROR REPORT====
> Module riak\_kv\_mrc\_map must be purged before loading
>
> 2012-07-12 15:24:10 =ERROR REPORT====
> Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_mrc\_map.beam
> failed: not\_purged
> 2012-07-12 15:24:10 =ERROR REPORT====
> Module riak\_kv\_mrc\_map must be purged before loading
>
> 2012-07-12 15:24:10 =ERROR REPORT====
> Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_mrc\_map.beam
> failed: not\_purged
> 2012-07-12 15:24:10 =ERROR REPORT====
> Loading of /usr/lib/riak/lib/riak\_kv-1.1.4/ebin/riak\_kv\_mrc\_map.beam
> failed: not\_purged
> 2012-07-12 15:24:11 =ERROR REPORT====
> Module riak\_kv\_mrc\_map must be purged before loading
>
> 2012-07-12 15:24:12 =CRASH REPORT====
> crasher:
> initial call: riak\_pipe\_vnode\_worker:init/1
> pid: <0.2303.0>
> registered\_name: []
> exception exit:
> {init\_failed,error,{case\_clause,{error,{insufficient\_vnodes,0,need,1}}}}
> in function gen\_fsm:init\_it/6
> in call from proc\_lib:init\_p\_do\_apply/3
> ancestors:
> [<0.340.0>,<0.339.0>,riak\_core\_vnode\_sup,riak\_core\_sup,<0.93.0>]
> messages: []
> links: [<0.340.0>]
> dictionary:
> [{eunit,[{module,riak\_pipe\_vnode\_worker},{partition,1050454301831586472458898473514828420377701515264},{<0.339.0>,<0.339.0>},{details,{fitting\_details,{fitting,<0.1136.0>,#Ref<0.0.0.2622>,follow,1},0,riak\_kv\_mrc\_map,{{jsanon,{<<"functions">>,<<"get\_by\_pid">>}},11043},{fitting,<0.799.0>,#Ref<0.0.0.2622>,sink,undefined},[{sink,{fitting,<0.799.0>,#Ref<0.0.0.2622>,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64}}]}]
> trap\_exit: false
> status: running
> heap\_size: 987
> stack\_size: 24
> reductions: 256
> neighbours:
> 2012-07-12 15:24:12 =SUPERVISOR REPORT====
> Supervisor: {<0.340.0>,riak\_pipe\_vnode\_worker\_sup}
> Context: child\_terminated
> Reason:
> {init\_failed,error,{case\_clause,{error,{insufficient\_vnodes,0,need,1}}}}
> Offender:
> [{pid,<0.2303.0>},{name,undefined},{mfargs,{riak\_pipe\_vnode\_worker,start\_link,undefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
>
>
> I did search the Basho site for the error messages and found that some
> configurtion changes in app.config and setting ulimit might help. But that
> didnt solve my problem.
>
> My ulimit is set as 'ulimit -n 4096'. I have also done the following
> changes to the app.config:
>
> diff /etc/riak/app.config /etc/riak/orig.app.config
> 65c65
> < %% {pb\_backlog, 500},
> ---
> > %% {pb\_backlog, 5},
> 80d79
> < {riak\_pipe, [{worker\_limit, 1000}]},
> 97,99c96,98
> < {map\_js\_vm\_count, 2048 },
> < {reduce\_js\_vm\_count, 2048 },
> < {hook\_js\_vm\_count, 2048 },
> ---
> > {map\_js\_vm\_count, 8 },
> > {reduce\_js\_vm\_count, 6 },
> > {hook\_js\_vm\_count, 2 },
> 110c109
> < {js\_max\_vm\_mem, 800},
> ---
> > {js\_max\_vm\_mem, 8},
> 115c114
> < {js\_thread\_stack, 1600},
> ---
> > {js\_thread\_stack, 16},
>
>
> Any pointers for this issue will be helpful.
>
> Regards,
> Balu
>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

