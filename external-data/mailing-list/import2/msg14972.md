---
title: "Re: Proper way do delete datatypes ( map )"
description: ""
project: community
lastmod: 2014-10-02T09:11:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14972"
mailinglist_parent_id: "msg14966"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2014-10-02T09:11:06-07:00
---


Hi Alexander,

I think you are deleting data-types the proper way.

What is your `delete\_mode` setting, please?

I would guess that sibling you are seeing is a tombstone, which suggests you 
have some concurrent update with the delete.

You will only ever have a single CRDT sibling, and 1 (or possibly more) 
tombstone siblings.

If you write back just the binary CRDT sibling as the value in the normal K/V 
interface, any concurrent data type updates will merge ok to a single value.

I don’t know about your Yokozuna question, but I think it is just that Yokozuna 
indexes each sibling as an independent document.

Let me know if that works out OK for you, please?

Cheers

Russell

On 2 Oct 2014, at 12:54, Alexander Popov  wrote:

> I have map bucket with some data( with neseted maps )
> aprox structure( don't know does it matter or not ):
> {
> "update": {
> "some\_register": "value",
> "some\_flag": "disable",
> "nested\_map": {
> "update": {
> "nested1\_map": {
> "update": {
> "some\_register": "value",
> "some\_flag": "disable",
> }
> },
> "nested1\_map": {
> "update": {
> "some\_register": "value",
> "some\_flag": "disable",
> }
> } 
> }
> },
> "some\_counter": 13,
> }
> }
> 
> 
> Updates works fine. Even simultaneous
> But Sometimes I need recreate entire value, so I Delete it using 
> curl -XDELETE http://host:8098/types/maps/buckets/mybucket/keys/some
> 
> After that sometimes siblings appears.
> 
> 
> curl -H "Accept: multipart/mixed" 
> http://host:8098/types/maps/buckets/mybucket/keys/some
> 
> show that confict with delete
> 
> --XZ98hy0TJbr4sVETS44XBEJf7Yt
> Last-Modified: Thu, 02 Oct 2014 11:29:15 GMT
> 
> E
> ��A�6-.... some binary
> --XZ98hy0TJbr4sVETS44XBEJf7Yt
> Content-Type: application/octet-stream
> Link: ; rel="up"
> Etag: 1MqocFt6qWeQxIw8bE1B8e
> Last-Modified: Thu, 02 Oct 2014 11:29:03 GMT
> X-Riak-Deleted: true
> 
> 
> --XZ98hy0TJbr4sVETS44XBEJf7Yt--
> 
> 
> Further updates to datatype using 
> http://host:8098/types/maps/buckets/mybucket/datatypes/some NOT create new 
> sibling. It is replace previous one.
> 
> Problems: 
> 
> 1. I should remove datatype with different method? Or how to resolve such 
> conflicts? probably
> Data I receive is binary, and query like
> curl -H "Accept: multipart/mixed" 
> http://host:8098/types/maps/buckets/mybucket/datatypes/some
> to get json data not works.Should I post it as binary back? 
> 
> 
> 2. I have also search index on this bucket.
> each further updates to this datatype before resolution creates new 
> records in solr because 
> \_yz\_id includes sibling id:
> 1\*maps\*mybucket\*some\*34\*46hGXxyhuW3yn3L8bRHIml
> 
> good news that when I delete record again all entries in solr deleted too.
> 
> 
> 
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

