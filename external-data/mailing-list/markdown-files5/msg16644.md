---
title: "Re: Sudden frequent node crashes"
description: ""
project: community
lastmod: 2015-10-08T13:29:30-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16644"
mailinglist_parent_id: "msg16643"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2015-10-08T13:29:30-07:00
---


OK, good luck! Let us know how you go.

Cheers

Russell

&gt; On 8 Oct 2015, at 21:05, Allen Landsidel  wrote:
&gt; 
&gt; Understood, I'll give it a shot with erlang16.
&gt; 
&gt; With the FreeBSD ports system there are often pre-build patches to make 
&gt; things more BSD friendly. About a month ago I was doing some maintenance and 
&gt; decided to update riak from 1.4.12 to 2.1.1. There was not a port of 2.1.1 
&gt; available at the time, so I made a duplicate of the existing port and then 
&gt; fixed up the existing patches.
&gt; 
&gt; The patches don't modify any of the erl files so the line numbers shouldn't 
&gt; have changed as a result of that.
&gt; 
&gt; Riak 2.1.1 was added as a port about two weeks ago, so I'll try building from 
&gt; that first. It looks like it's setup to use a specific erlang port called 
&gt; 'erlang-riak' which is also new and is the custom erlang from basho.
&gt; 
&gt; I'll give the new port a see if that takes care of things. Should have 
&gt; looked to see if there was an 'official' port before posting. :)
&gt; 
&gt; We don't store any mission critical data in it (yet) so just clearing it out 
&gt; and starting fresh isn't too big of a deal.
&gt; 
&gt; On 10/8/2015 15:40, Russell Brown wrote:
&gt;&gt; Hi Allen,
&gt;&gt; Riak only supports erlang r16 at this time. Probably best to use the erlang 
&gt;&gt; that riak ships with, or build our basho OTP fork, instructions here: 
&gt;&gt; http://docs.basho.com/riak/latest/ops/building/installing/erlang/#Installing-on-FreeBSD-Solaris
&gt;&gt; 
&gt;&gt; We’re working on erlang 17 and beyond support.
&gt;&gt; 
&gt;&gt; Also, can you confirm what install you did of riak (source? checkout of a 
&gt;&gt; tag on github?) Those line numbers in your crash don’t match up for me
&gt;&gt; 
&gt;&gt; Cheers
&gt;&gt; 
&gt;&gt; Russell
&gt;&gt; 
&gt;&gt;&gt; On 8 Oct 2015, at 20:35, Allen Landsidel  wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Oops sorry, forgot about that.
&gt;&gt;&gt; 
&gt;&gt;&gt; I'm running Erlang 17 from ports; erlang-runtime17-17.5.6.3
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On 10/8/2015 15:28, Russell Brown wrote:
&gt;&gt;&gt;&gt; Hi Allen,
&gt;&gt;&gt;&gt; What version of erlang are you running, please?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Cheers
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Russell
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; On 8 Oct 2015, at 19:58, Allen Landsidel  
&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Background:
&gt;&gt;&gt;&gt;&gt; Riak 2.1.1
&gt;&gt;&gt;&gt;&gt; FreeBSD 9.1.
&gt;&gt;&gt;&gt;&gt; Servers are all virtualized on VMWare ESX 5.5. Each node is given ~300G 
&gt;&gt;&gt;&gt;&gt; of storage, 4G of RAM, and 2 core SMP.
&gt;&gt;&gt;&gt;&gt; Storage is via FC SAN.
&gt;&gt;&gt;&gt;&gt; Access to the cluster from clients is strictly over the HTTP interface 
&gt;&gt;&gt;&gt;&gt; and is funneled through haproxy.
&gt;&gt;&gt;&gt;&gt; The cluster was five nodes using leveldb with a ring size of 16.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; The cluster is setup this way so that we could start small and add nodes 
&gt;&gt;&gt;&gt;&gt; as needed, with a small memory footprint, rather than preallocating a ton 
&gt;&gt;&gt;&gt;&gt; of memory and disk space that we may never use. The cluster has been 
&gt;&gt;&gt;&gt;&gt; running fine for the past month.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Today the cluster has begun experiencing strange repeated failures. No 
&gt;&gt;&gt;&gt;&gt; changes in any of the clients have been made, so the problem seems as 
&gt;&gt;&gt;&gt;&gt; though it must be in the data coming in.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; I started a fresh two-node cluster and shortly after data begins flowing 
&gt;&gt;&gt;&gt;&gt; into the cluster, nodes begin crashing.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; The first report in the crash log is below. I'm far from an expert at 
&gt;&gt;&gt;&gt;&gt; understanding these errors, but "invalid\\_unicode" seems telling.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; If more from the crash log is needed, I can provide it. Once this first 
&gt;&gt;&gt;&gt;&gt; error comes in, the node goes offline and errors just continue to roll in 
&gt;&gt;&gt;&gt;&gt; to the log file, in what looks like an attempt to automatically restart 
&gt;&gt;&gt;&gt;&gt; the node.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; --------------------------------------------
&gt;&gt;&gt;&gt;&gt; \\*\\* Generic server &lt;0.2136.0&gt; terminating
&gt;&gt;&gt;&gt;&gt; \\*\\* Last message in was {vnodeid,10000}
&gt;&gt;&gt;&gt;&gt; \\*\\* When Server state == {state,"/var/db/riak/kv\\_vnode/0",0,&lt;0.2135.0&gt;,2}
&gt;&gt;&gt;&gt;&gt; \\*\\* Reason for termination ==
&gt;&gt;&gt;&gt;&gt; \\*\\* 
&gt;&gt;&gt;&gt;&gt; {{badmatch,{error,{4,file\\_io\\_server,invalid\\_unicode}}},[{riak\\_kv\\_vnode\\_status\\_mgr,handle\\_call,3,[{file,"src/riak\\_kv\\_vnode\\_status\\_mgr.erl"},{line,178}]},{gen\\_server,try\\_handle\\_call,4,[{file,"gen\\_server.erl"},{line,607}]},{gen\\_server,handle\\_msg,5,[{file,"gen\\_server.erl"},{line,639}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,237}]}]}
&gt;&gt;&gt;&gt;&gt; 2015-10-08 18:36:18 =CRASH REPORT====
&gt;&gt;&gt;&gt;&gt; crasher:
&gt;&gt;&gt;&gt;&gt; initial call: riak\\_kv\\_vnode\\_status\\_mgr:init/1
&gt;&gt;&gt;&gt;&gt; pid: &lt;0.2136.0&gt;
&gt;&gt;&gt;&gt;&gt; registered\\_name: []
&gt;&gt;&gt;&gt;&gt; exception exit: 
&gt;&gt;&gt;&gt;&gt; {{{badmatch,{error,{4,file\\_io\\_server,invalid\\_unicode}}},[{riak\\_kv\\_vnode\\_status\\_mgr,handle\\_call,3,[{file,"src/riak\\_kv\\_vnode\\_status\\_mgr.erl"},{line,178}]},{gen\\_server,try\\_handle\\_call,4,[{file,"gen\\_server.erl"},{line,607}]},{gen\\_server,handle\\_msg,5,[{file,"gen\\_server.erl"},{line,639}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,237}]}]},[{gen\\_server,terminate,7,[{file,"gen\\_server.erl"},{line,804}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,237}]}]}
&gt;&gt;&gt;&gt;&gt; ancestors: [&lt;0.2135.0&gt;,riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.169.0&gt;]
&gt;&gt;&gt;&gt;&gt; messages: []
&gt;&gt;&gt;&gt;&gt; links: [&lt;0.2135.0&gt;]
&gt;&gt;&gt;&gt;&gt; dictionary: []
&gt;&gt;&gt;&gt;&gt; trap\\_exit: false
&gt;&gt;&gt;&gt;&gt; status: running
&gt;&gt;&gt;&gt;&gt; heap\\_size: 610
&gt;&gt;&gt;&gt;&gt; stack\\_size: 27
&gt;&gt;&gt;&gt;&gt; reductions: 569
&gt;&gt;&gt;&gt;&gt; neighbours:
&gt;&gt;&gt;&gt;&gt; --------------------------------------------
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt; 
&gt;&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

