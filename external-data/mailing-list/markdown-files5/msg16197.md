---
title: "haproxy issues with protocol buffers on 2.x releases"
description: ""
project: community
lastmod: 2015-06-03T22:34:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16197"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2015-06-03T22:34:27-07:00
---


Hi,
I've been happily using haproxy in front of Riak and Riak CS 1.x in
production for quite a while.

I've been trying to bring up a new cluster based on riak/cs 2.0.x recently,
as you've probably noticed from the flurry of emails to this list :)

I'm discovering that if I have haproxy sitting between riak-cs and riak,
then I get a lot of errors about disconnections. Initially I thought this
must be related to pb backlogs or pool sizes or file handle limits -- but
I've played with all those things to no avail.

I \\*have\\* noticed that if I get riak-cs to connect directly to a riak
(bypassing haproxy) then everything is fine, including with the original
default request pool and backlog sizes.

I am essentially using the recommended haproxy.cfg, which has worked fine
in production elsewhere.

Any suggestions?
Error message sample follows:

 2015-06-04 15:26:16.447 [warning]
&lt;0.283.0&gt;@riak\\_cs\\_riak\\_client:get\\_user\\_with\\_pbc:293 Fetching user re
cord with strong option failed: disconnected
2015-06-04 15:26:16.447 [warning]
&lt;0.2095.0&gt;@riak\\_cs\\_pbc:check\\_connection\\_status:97 Connection status
of &lt;0.287.0&gt; at maybe\\_create\\_user: {false,[]}



Cheers
Toby
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

