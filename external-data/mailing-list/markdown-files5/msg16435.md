---
title: "Re: Default values vs non-existing keys for CRDTs"
description: ""
project: community
lastmod: 2015-08-19T20:49:54-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16435"
mailinglist_parent_id: "msg16434"
author_name: "Dmitri Zagidulin"
project_section: "mailinglistitem"
sent_date: 2015-08-19T20:49:54-07:00
---


&gt;From what I understand, this is a limitation of that particular client
(what language is that, by the way?). Feel free to open an issue on Github
for it.

The HTTP API, at least, does distinguish between a non-existent counter and
a counter whose value happens to be 0.

For example, here's the result of trying to access an existing key (with a
value set to 0):

curl
http://localhost:8098/types/counters/buckets/room\\_occupancy/datatypes/room-215
{"type":"counter","value":0}

And here's the result of retrieving the value of a non-existent key:

curl
http://localhost:8098/types/counters/buckets/room\\_occupancy/datatypes/non-existent-room
{"type":"counter","error":"notfound"}

There's a workaround you can do with your existing client, however (until
the issue with the FetchCounter request gets fixed).

You can issue a regular Fetch Object operation (preferably setting the
'HEAD only' option to true) for that counter. A Riak counter (or any other
data type) still exists as a regular object, and you can issue a HEAD
request to it (as opposed to a Fetch Counter or whatever), and it'll return
a 404 as expected.

On Wed, Aug 19, 2015 at 8:59 PM, Timur Fayruzov 
wrote:

&gt; Hello,
&gt;
&gt; It seems that Riak Datatype API does not allow to distinguish between
&gt; non-existing keys and default values. For example, if I query for
&gt; non-existing key as follows:
&gt;
&gt; val fetchOp = new FetchCounter.Builder(key).build()
&gt; val c = client.execute(fetchOp).getDatatype
&gt;
&gt; I'll get a counter that holds 0. Now, if I put counter with value 0 at
&gt; this key and run the query, I get the same result. Is there any way to
&gt; distinguish between these two different states?
&gt;
&gt; Note: when working with sets there is a context that I can check. If I
&gt; fetch a set and the context is null, it means that the set does not exist
&gt; under this key. This trick does not work for counters though, as they do
&gt; not maintain context. Is it a valid trick to use though?
&gt;
&gt; I posted this to StackOverflow a while ago, but no luck:
&gt; http://stackoverflow.com/questions/31845164/riak-dataypes-default-values-vs-non-existing-keys
&gt;
&gt; Thanks,
&gt;
&gt; Timur
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

