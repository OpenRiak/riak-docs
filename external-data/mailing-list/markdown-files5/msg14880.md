---
title: "Re: Issue with Riak partition allocation"
description: ""
project: community
lastmod: 2014-09-09T10:08:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14880"
mailinglist_parent_id: "msg14879"
author_name: "Peter Bakkum"
project_section: "mailinglistitem"
sent_date: 2014-09-09T10:08:26-07:00
---


Hey Luke,

Here you go. Last night I believe we had ~70 partitions still to transfer.

[root@192.168.72.19 ~] #
[root@192.168.72.19 ~] #
[root@192.168.72.19 ~] # riak-admin transfers
'xxxx\\_prod\\_cluster@192.168.72.74' waiting to handoff 2 partitions
'xxxx\\_prod\\_cluster@192.168.72.7' waiting to handoff 2 partitions
'xxxx\\_prod\\_cluster@192.168.72.19' waiting to handoff 21 partitions

Active Transfers:

transfer type: ownership\\_transfer
vnode type: riak\\_kv\\_vnode
partition: 422465317040964124793252646957050560369293000704
started: 2014-09-09 16:15:11 [48.93 min ago]
last update: 2014-09-09 17:04:06 [887.56 ms ago]
total size: 47814241779 bytes
objects transferred: 326825

 111 Objs/s
xxxx\\_prod\\_cluster =======&gt; xxxx\\_prod\\_cluster
@192.168.72.176 @192.168.72.19
 |=================== | 45%
 7.13 MB/s

transfer type: hinted\\_handoff
vnode type: riak\\_kv\\_vnode
partition: 1004782375664995756265033322492444576013453623296
started: 2014-09-09 16:36:37 [27.50 min ago]
last update: 2014-09-09 17:04:07 [411.93 ms ago]
total size: 47179582874 bytes
objects transferred: 213001

 129 Objs/s
xxxx\\_prod\\_cluster =======&gt; xxxx\\_prod\\_cluster
@192.168.72.19 @192.168.72.7
 |============= | 31%
 8.48 MB/s



On Tue, Sep 9, 2014 at 7:22 AM, Luke Bakken  wrote:

&gt; Hi Peter,
&gt;
&gt; Could you please provide the output of "riak-admin transfers" ?
&gt; --
&gt; Luke Bakken
&gt; Engineer / CSE
&gt; lbak...@basho.com
&gt;
&gt;
&gt; On Mon, Sep 8, 2014 at 10:01 AM, Peter Bakkum  wrote:
&gt; &gt; Hey all,
&gt; &gt;
&gt; &gt; Looking for some guidance on a problem we're seeing in production right
&gt; now.
&gt; &gt; We're not Riak experts so please bear with us.
&gt; &gt;
&gt; &gt; We had a member of our 6-node Riak cluster appear to fall out (riak-admin
&gt; &gt; member status on that node only showed itself). So I ran a riak-admin
&gt; join
&gt; &gt; and riak-admin commit to get the node back in the cluster. Node discovery
&gt; &gt; appears to work now, but for some reason that node is now using a huge
&gt; &gt; amount of disk space. It appears that the partition balancing process is
&gt; &gt; creating this condition, and still hasn't completed after ~16 hours. The
&gt; &gt; cluster is still functional and serving our production traffic, and
&gt; taking
&gt; &gt; the entire cluster offline isn't an option for us.
&gt; &gt;
&gt; &gt; Most of our nodes use about 450GB of space, this node in particular is
&gt; using
&gt; &gt; around 1.2TB, which is pushing the limit of its disk.
&gt; &gt;
&gt; &gt; Questions:
&gt; &gt; Whats happening here? Is this expected?
&gt; &gt;
&gt; &gt; Whats the best course of action? Should we clear out this node and
&gt; attempt
&gt; &gt; to join the cluster again?
&gt; &gt;
&gt; &gt; Here are some stats from the node in question. Let me know if anything
&gt; else
&gt; &gt; would be helpful.
&gt; &gt;
&gt; &gt; Thanks for your help.
&gt; &gt;
&gt; &gt;
&gt; &gt; [root@192.168.72.19 /data/lib/riak] # riak-admin member-status
&gt; &gt; ================================= Membership
&gt; &gt; ==================================
&gt; &gt; Status Ring Pending Node
&gt; &gt;
&gt; -------------------------------------------------------------------------------
&gt; &gt; valid 20.3% 16.4% 'xxxx\\_prod\\_cluster@192.168.72.135'
&gt; &gt; valid 18.0% 17.2% 'xxxx\\_prod\\_cluster@192.168.72.170'
&gt; &gt; valid 20.3% 17.2% 'xxxx\\_prod\\_cluster@192.168.72.176'
&gt; &gt; valid 7.0% 16.4% 'xxxx\\_prod\\_cluster@192.168.72.19'
&gt; &gt; valid 17.2% 16.4% 'xxxx\\_prod\\_cluster@192.168.72.7'
&gt; &gt; valid 17.2% 16.4% 'xxxx\\_prod\\_cluster@192.168.72.74'
&gt; &gt;
&gt; &gt;
&gt; &gt; [root@192.168.72.19 /data/lib/riak] # riak-admin status
&gt; &gt; 1-minute stats for 'xxxx\\_prod\\_cluster@192.168.72.19'
&gt; &gt; -------------------------------------------
&gt; &gt; riak\\_kv\\_stat\\_ts : 1410194287
&gt; &gt; vnode\\_gets : 1607
&gt; &gt; vnode\\_gets\\_total : 563683
&gt; &gt; vnode\\_puts : 39
&gt; &gt; vnode\\_puts\\_total : 5459724
&gt; &gt; vnode\\_index\\_refreshes : 0
&gt; &gt; vnode\\_index\\_refreshes\\_total : 0
&gt; &gt; vnode\\_index\\_reads : 0
&gt; &gt; vnode\\_index\\_reads\\_total : 0
&gt; &gt; vnode\\_index\\_writes : 39
&gt; &gt; vnode\\_index\\_writes\\_total : 5459724
&gt; &gt; vnode\\_index\\_writes\\_postings : 0
&gt; &gt; vnode\\_index\\_writes\\_postings\\_total : 5227558
&gt; &gt; vnode\\_index\\_deletes : 0
&gt; &gt; vnode\\_index\\_deletes\\_total : 0
&gt; &gt; vnode\\_index\\_deletes\\_postings : 39
&gt; &gt; vnode\\_index\\_deletes\\_postings\\_total : 30613
&gt; &gt; node\\_gets : 3602
&gt; &gt; node\\_gets\\_total : 2463956
&gt; &gt; node\\_get\\_fsm\\_siblings\\_mean : 1
&gt; &gt; node\\_get\\_fsm\\_siblings\\_median : 1
&gt; &gt; node\\_get\\_fsm\\_siblings\\_95 : 2
&gt; &gt; node\\_get\\_fsm\\_siblings\\_99 : 3
&gt; &gt; node\\_get\\_fsm\\_siblings\\_100 : 12
&gt; &gt; node\\_get\\_fsm\\_objsize\\_mean : 52047
&gt; &gt; node\\_get\\_fsm\\_objsize\\_median : 26936
&gt; &gt; node\\_get\\_fsm\\_objsize\\_95 : 167435
&gt; &gt; node\\_get\\_fsm\\_objsize\\_99 : 267979
&gt; &gt; node\\_get\\_fsm\\_objsize\\_100 : 1313716
&gt; &gt; node\\_get\\_fsm\\_time\\_mean : 12223
&gt; &gt; node\\_get\\_fsm\\_time\\_median : 6675
&gt; &gt; node\\_get\\_fsm\\_time\\_95 : 37390
&gt; &gt; node\\_get\\_fsm\\_time\\_99 : 87046
&gt; &gt; node\\_get\\_fsm\\_time\\_100 : 345380
&gt; &gt; node\\_puts : 39
&gt; &gt; node\\_puts\\_total : 24915
&gt; &gt; node\\_put\\_fsm\\_time\\_mean : 4419
&gt; &gt; node\\_put\\_fsm\\_time\\_median : 2444
&gt; &gt; node\\_put\\_fsm\\_time\\_95 : 12890
&gt; &gt; node\\_put\\_fsm\\_time\\_99 : 18775
&gt; &gt; node\\_put\\_fsm\\_time\\_100 : 18775
&gt; &gt; read\\_repairs : 0
&gt; &gt; read\\_repairs\\_total : 0
&gt; &gt; coord\\_redirs\\_total : 17022
&gt; &gt; executing\\_mappers : 0
&gt; &gt; precommit\\_fail : 0
&gt; &gt; postcommit\\_fail : 0
&gt; &gt; index\\_fsm\\_create : 0
&gt; &gt; index\\_fsm\\_create\\_error : 0
&gt; &gt; index\\_fsm\\_active : 0
&gt; &gt; list\\_fsm\\_create : 0
&gt; &gt; list\\_fsm\\_create\\_error : 0
&gt; &gt; list\\_fsm\\_active : 0
&gt; &gt; pbc\\_active : 0
&gt; &gt; pbc\\_connects : 1
&gt; &gt; pbc\\_connects\\_total : 508
&gt; &gt; node\\_get\\_fsm\\_active : 1
&gt; &gt; node\\_get\\_fsm\\_active\\_60s : 3530
&gt; &gt; node\\_get\\_fsm\\_in\\_rate : 55
&gt; &gt; node\\_get\\_fsm\\_out\\_rate : 56
&gt; &gt; node\\_get\\_fsm\\_rejected : 0
&gt; &gt; node\\_get\\_fsm\\_rejected\\_60s : 0
&gt; &gt; node\\_get\\_fsm\\_rejected\\_total : 0
&gt; &gt; node\\_put\\_fsm\\_active : 0
&gt; &gt; node\\_put\\_fsm\\_active\\_60s : 67
&gt; &gt; node\\_put\\_fsm\\_in\\_rate : 1
&gt; &gt; node\\_put\\_fsm\\_out\\_rate : 1
&gt; &gt; node\\_put\\_fsm\\_rejected : 0
&gt; &gt; node\\_put\\_fsm\\_rejected\\_60s : 0
&gt; &gt; node\\_put\\_fsm\\_rejected\\_total : 0
&gt; &gt; leveldb\\_read\\_block\\_error : 0
&gt; &gt; riak\\_pipe\\_stat\\_ts : 1410194286
&gt; &gt; pipeline\\_active : 0
&gt; &gt; pipeline\\_create\\_count : 0
&gt; &gt; pipeline\\_create\\_one : 0
&gt; &gt; pipeline\\_create\\_error\\_count : 0
&gt; &gt; pipeline\\_create\\_error\\_one : 0
&gt; &gt; cpu\\_nprocs : 426
&gt; &gt; cpu\\_avg1 : 1352
&gt; &gt; cpu\\_avg5 : 1260
&gt; &gt; cpu\\_avg15 : 1137
&gt; &gt; mem\\_total : 15666507776
&gt; &gt; mem\\_allocated : 15479640064
&gt; &gt; disk : [{"/",8256952,60},
&gt; &gt; {"/dev/shm",7649660,0},
&gt; &gt; {"/tmpfs",1048576,14},
&gt; &gt; {"/tmpfs\\_mp3",1048576,0},
&gt; &gt; {"/data",1514123712,81}]
&gt; &gt; nodename : 'xxxx\\_prod\\_cluster@192.168.72.19'
&gt; &gt; connected\\_nodes : ['xxxx\\_prod\\_cluster@192.168.72.170',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.176',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.74',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.135',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.7']
&gt; &gt; sys\\_driver\\_version : &lt;&lt;"2.0"&gt;&gt;
&gt; &gt; sys\\_global\\_heaps\\_size : 0
&gt; &gt; sys\\_heap\\_type : private
&gt; &gt; sys\\_logical\\_processors : 4
&gt; &gt; sys\\_otp\\_release : &lt;&lt;"R15B01"&gt;&gt;
&gt; &gt; sys\\_process\\_count : 2469
&gt; &gt; sys\\_smp\\_support : true
&gt; &gt; sys\\_system\\_version : &lt;&lt;"Erlang R15B01 (erts-5.9.1) [source] [64-bit]
&gt; &gt; [smp:4:4] [async-threads:64] [kernel-poll:true]"&gt;&gt;
&gt; &gt; sys\\_system\\_architecture : &lt;&lt;"x86\\_64-unknown-linux-gnu"&gt;&gt;
&gt; &gt; sys\\_threads\\_enabled : true
&gt; &gt; sys\\_thread\\_pool\\_size : 64
&gt; &gt; sys\\_wordsize : 8
&gt; &gt; ring\\_members : ['xxxx\\_prod\\_cluster@192.168.72.135',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.170',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.176',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.19',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.7',
&gt; &gt; 'xxxx\\_prod\\_cluster@192.168.72.74']
&gt; &gt; ring\\_num\\_partitions : 128
&gt; &gt; ring\\_ownership : &lt;&lt;"[{'xxxx\\_prod\\_cluster@192.168.72.170',23},\\n
&gt; &gt; {'xxxx\\_prod\\_cluster@192.168.72.74',22},\\n
&gt; &gt; {'xxxx\\_prod\\_cluster@192.168.72.135',26},\\n
&gt; &gt; {'xxxx\\_prod\\_cluster@192.168.72.176',26},\\n
&gt; &gt; {'xxxx\\_prod\\_cluster@192.168.72.7',22},\\n
&gt; &gt; {'xxxx\\_prod\\_cluster@192.168.72.19',9}]"&gt;&gt;
&gt; &gt; ring\\_creation\\_size : 128
&gt; &gt; storage\\_backend : riak\\_kv\\_eleveldb\\_backend
&gt; &gt; erlydtl\\_version : &lt;&lt;"0.7.0"&gt;&gt;
&gt; &gt; riak\\_control\\_version : &lt;&lt;"1.4.10-0-g73c43c3"&gt;&gt;
&gt; &gt; cluster\\_info\\_version : &lt;&lt;"1.2.4"&gt;&gt;
&gt; &gt; riak\\_search\\_version : &lt;&lt;"1.4.10-0-g6e548e7"&gt;&gt;
&gt; &gt; merge\\_index\\_version : &lt;&lt;"1.3.2-0-gcb38ee7"&gt;&gt;
&gt; &gt; riak\\_kv\\_version : &lt;&lt;"1.4.10-0-g64b6ad8"&gt;&gt;
&gt; &gt; sidejob\\_version : &lt;&lt;"0.2.0"&gt;&gt;
&gt; &gt; riak\\_api\\_version : &lt;&lt;"1.4.10-0-gc407ac0"&gt;&gt;
&gt; &gt; riak\\_pipe\\_version : &lt;&lt;"1.4.10-0-g9353526"&gt;&gt;
&gt; &gt; riak\\_core\\_version : &lt;&lt;"1.4.10"&gt;&gt;
&gt; &gt; bitcask\\_version : &lt;&lt;"1.6.6-0-g230b6d6"&gt;&gt;
&gt; &gt; basho\\_stats\\_version : &lt;&lt;"1.0.3"&gt;&gt;
&gt; &gt; webmachine\\_version : &lt;&lt;"1.10.4-0-gfcff795"&gt;&gt;
&gt; &gt; mochiweb\\_version : &lt;&lt;"1.5.1p6"&gt;&gt;
&gt; &gt; inets\\_version : &lt;&lt;"5.9"&gt;&gt;
&gt; &gt; erlang\\_js\\_version : &lt;&lt;"1.2.2"&gt;&gt;
&gt; &gt; runtime\\_tools\\_version : &lt;&lt;"1.8.8"&gt;&gt;
&gt; &gt; os\\_mon\\_version : &lt;&lt;"2.2.9"&gt;&gt;
&gt; &gt; riak\\_sysmon\\_version : &lt;&lt;"1.1.3"&gt;&gt;
&gt; &gt; ssl\\_version : &lt;&lt;"5.0.1"&gt;&gt;
&gt; &gt; public\\_key\\_version : &lt;&lt;"0.15"&gt;&gt;
&gt; &gt; crypto\\_version : &lt;&lt;"2.1"&gt;&gt;
&gt; &gt; sasl\\_version : &lt;&lt;"2.2.1"&gt;&gt;
&gt; &gt; lager\\_version : &lt;&lt;"2.0.1"&gt;&gt;
&gt; &gt; goldrush\\_version : &lt;&lt;"0.1.5"&gt;&gt;
&gt; &gt; compiler\\_version : &lt;&lt;"4.8.1"&gt;&gt;
&gt; &gt; syntax\\_tools\\_version : &lt;&lt;"1.6.8"&gt;&gt;
&gt; &gt; stdlib\\_version : &lt;&lt;"1.18.1"&gt;&gt;
&gt; &gt; kernel\\_version : &lt;&lt;"2.15.1"&gt;&gt;
&gt; &gt; memory\\_total : 130705264
&gt; &gt; memory\\_processes : 55557705
&gt; &gt; memory\\_processes\\_used : 55341757
&gt; &gt; memory\\_system : 75147559
&gt; &gt; memory\\_atom : 545377
&gt; &gt; memory\\_atom\\_used : 527226
&gt; &gt; memory\\_binary : 12172712
&gt; &gt; memory\\_code : 11674242
&gt; &gt; memory\\_ets : 11913912
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

