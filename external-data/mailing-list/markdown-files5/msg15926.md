---
title: "Re: Riak2.0 with Solr Search: index on one node contains not all	entries"
description: ""
project: community
lastmod: 2015-03-25T08:04:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15926"
mailinglist_parent_id: "msg15925"
author_name: "Michael Weibel"
project_section: "mailinglistitem"
sent_date: 2015-03-25T08:04:46-07:00
---


Hi Zeeshan,

Thanks for your answer.

&gt; Just to be sure, does your custom schema include the required fields, as
&gt; mentioned in the docs:
&gt; http://docs.basho.com/riak/latest/dev/advanced/search-schema/#Custom-Schemas?
&gt;

Yes, I double checked that now to make sure, and the schema includes the
required fields.


&gt; Are these Riak nodes joined? Whatâ€™s your ring size, n\\_val value?
&gt;

They run in a cluster, yes. Output of "riak-admin status":

ring\\_creation\\_size : 64
ring\\_members : ['riak@IPADDRESS','riak@IPADDRESS']
ring\\_num\\_partitions : 64
ring\\_ownership : &lt;&lt;"[{'riak@IPADDRESS',32},{'riak@IPADDRESS',32}]"&gt;&gt;
rings\\_reconciled : 0
rings\\_reconciled\\_total : 33

n\\_val is 3, the initial one. According to the docs we should probably
either add another node or reduce it to "2" though..correct? (Sorry, newbie
in riak here :D)


&gt; How are you querying the Solr nodes to know which node has the data and
&gt; which one doesn't? Coverage is R=1, so you would be getting a different
&gt; number on some search queries (using the standard
&gt; /search/query/?...) if its only on one of the Solr cores.
&gt;

Yes exactly. That's how I figured out that there's a difference, later on I
queried the separate Solr instances using the solr admin interface itself.
I also then fetched the missing key on both the riak nodes (without going
to solr, just fetching it directly using the riak HTTP API) and they exist
on both nodes.


&gt; Can you also post me a screenshot of your search AAE exchanges, e.g.
&gt; `riak-admin search aae-status`? You could look at this thread,
&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2015-March/016926.html,
&gt; for answers on how to perform read-repair/repair the AAE tree.
&gt;

aae-status is in the .log file attached.

So you'd propose to perform a read-repair on the AAE tree?

Best,
Michael



&gt;
&gt; Thanks.
&gt;
&gt; Zeeshan Lakhani
&gt; programmer |
&gt; software engineer at @basho |
&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org
&gt; twitter =&gt; @zeeshanlakhani
&gt;
&gt; On Mar 25, 2015, at 6:42 AM, Michael Weibel 
&gt; wrote:
&gt;
&gt; Hi all,
&gt;
&gt; I have on a test environment two riak nodes and each of them has solr
&gt; activated which index 3 buckets using a custom schema.
&gt; After testing a bit back and forth, I have the case that on one solr node,
&gt; an entry is not in the index (I know in which node though).
&gt; Fetching the specific key in the bucket works however, both nodes have the
&gt; respective entry.
&gt;
&gt; 1) How can this happen? I don't see any error/warning in the logs (neither
&gt; solr nor riak logs).
&gt; 2) Is there a possibility to fix this without having to do e.g. a PUT on
&gt; the specific key with the same content in order to update it?
&gt;
&gt; I tried to run a repair on the failing node using the guide:
&gt; http://docs.basho.com/riak/1.4.7/ops/running/recovery/repairing-indexes/#Repairing-Search-Indexes
&gt; When running the repair command on the partitions I received, it gave me
&gt; however a [{, down}, {...}] response, which gives me an
&gt; uncomfortable feeling, but I didn't really figure out yet what this means
&gt; exactly.
&gt;
&gt; Thanks a lot for your help :)
&gt;
&gt; Best,
&gt; Michael
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;


riak-admin-aae-status.log
Description: Binary data
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

