---
title: "Re: Ownership handoff timed out"
description: ""
project: community
lastmod: 2015-10-26T06:58:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16705"
mailinglist_parent_id: "msg16704"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2015-10-26T06:58:44-07:00
---


Hi,

I suspect your {error,enotconn} messages are unrelated - that's likely to
be caused by an HTTP client closing the connection while Riak looks up
 some networking information about the requestor.

The max\\_concurrency message you are seeing is related to the handoff
transfer limit - it should be labelled as informational. When a node has
data to handoff it starts the handoff sender process and if there are
either too many local handoff processes or too many on the remote side it
exits with max\\_concurrency. You could increase with riak-admin
transfer-limit but that probably won't help if you're timing out.

As you're using the multi-backend you're transferring data from bitcask and
leveldb. The next place I would look is in the leveldb LOG files to see if
there are any leveldb vnodes that are having problems that's preventing
repair.

Jon

On Mon, Oct 26, 2015 at 7:15 AM Vladyslav Zakhozhai &lt;
v.zakhoz...@smartweb.com.ua&gt; wrote:

&gt; Hello,
&gt;
&gt; I have a problem with persistent timeouts during ownership handoffs. I've
&gt; tried to surf over Internet and current mail list but no success.
&gt;
&gt; I have Riak 1.4.12 cluster with 17 nodes. Almost all nodes use
&gt; multibackend with bitcask and eleveldb as storage backends (we need
&gt; multiple backend for Riak CS 1.5.0 integration).
&gt;
&gt; Now I'm working to migrate Riak cluster to eleveldb as primary and only
&gt; backend. For now I have 2 nodes with eleveldb backend in the same cluster.
&gt;
&gt; During ownership handoff process I permanently see errors of timed out
&gt; handoff receivers and sender.
&gt;
&gt; Here is partial output of riak-admin transfers:
&gt; ...
&gt; transfer type: ownership\\_transfer
&gt; vnode type: riak\\_kv\\_vnode
&gt; partition: 331121464707782692405522344912282871640797216768
&gt; started: 2015-10-21 08:32:55 [46.66 min ago]
&gt; last update: no updates seen
&gt; total size: unknown
&gt; objects transferred: unknown
&gt;
&gt; unknown
&gt; riak@taipan.pleiad.uaprom =======&gt; r...@eggeater.pleiad.uapr
&gt; om
&gt; | | 0%
&gt; unknown
&gt;
&gt; transfer type: ownership\\_transfer
&gt; vnode type: riak\\_kv\\_vnode
&gt; partition: 336830455478606531929755488790080852186328203264
&gt; started: 2015-10-21 08:32:54 [46.68 min ago]
&gt; last update: no updates seen
&gt; total size: unknown
&gt; objects transferred: unknown
&gt; ...
&gt;
&gt; Some of partition handoffs state never updates, some of them terminates
&gt; after partial handoff objects and never starts again.
&gt;
&gt; I see nothing in logs but following:
&gt;
&gt; On receiver side:
&gt;
&gt; 2015-10-21 11:33:55.131 [error]
&gt; &lt;0.25390.1266&gt;@riak\\_core\\_handoff\\_receiver:handle\\_info:105 Handoff receiver
&gt; for partition 331121464707782692405522344912282871640797216768 timed out
&gt; after processing 0 objects.
&gt;
&gt; On sender side:
&gt;
&gt; 2015-10-21 11:01:58.879 [error] &lt;0.13177.1401&gt; CRASH REPORT Process
&gt; &lt;0.13177.1401&gt; with 0 neighbours crashed with reason: no function clause
&gt; matching webmachine\\_request:peer\\_from\\_peername({error,enotconn},
&gt; {webmachine\\_request,{wm\\_reqstate,#Port&lt;0.50978116&gt;,[],undefined,undefined,undefined,{wm\\_reqdata,...},...}})
&gt; line 150
&gt; 2015-10-21 11:32:50.055 [error] &lt;0.207.0&gt; Supervisor
&gt; riak\\_core\\_handoff\\_sender\\_sup had child riak\\_core\\_handoff\\_sender started
&gt; with {riak\\_core\\_handoff\\_sender,start\\_link,undefined} at &lt;0.22312.1090&gt; exit
&gt; with reason max\\_concurrency in context child\\_terminated
&gt;
&gt; {error, enotconn} - seems to be network issue. But I have no any problems
&gt; with network. All hosts resolve their neighbors correctly and /etc/hosts on
&gt; each node are correct.
&gt;
&gt; I've tried to increase handoff\\_timeout and handoff\\_receive\\_timeout. But no
&gt; success.
&gt;
&gt; Forcing handoff helped me but for short period of time:
&gt;
&gt; rpc:multicall([node() | nodes()], riak\\_core\\_vnode\\_manager, force\\_handoffs, 
&gt; []).
&gt;
&gt;
&gt; I see progress of handoffs (riak-admin transfers) but then I see handoff 
&gt; timed out again.
&gt;
&gt;
&gt; A week ago I've joined 4 nodes with bitcask. And there was no such problems.
&gt;
&gt;
&gt; I'm confused a little bit and need to understand my next steps in 
&gt; troubleshooting this issue.
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

