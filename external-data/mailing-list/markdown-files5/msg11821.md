---
title: "Re: question about java client"
description: ""
project: community
lastmod: 2013-07-30T14:35:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11821"
mailinglist_parent_id: "msg11820"
author_name: "Brian Roach"
project_section: "mailinglistitem"
sent_date: 2013-07-30T14:35:47-07:00
---


Paul,

The annotated fields are not included in the Serialization using the
JSONConverter (at least, not in the current version of the client; I
think I did some fixes around that way back in like v1.0.7). If they
are, you've got something odd going on in your domain object.

Here's a (very basic) example:

public class App3
{

 public static void main(String[] args) throws RiakException
 {
 IRiakClient client = RiakFactory.pbcClient();
 Bucket b = client.fetchBucket("test\\_bucket").execute();

 MyPojo mp = new MyPojo();
 mp.key = "key0";
 mp.value = "This is my value";

 Set links = new HashSet();
 for (int i = 1; i &lt; 4; i++)
 {
 RiakLink link = new RiakLink("test\\_bucket", "key" + i, "myLinkTag");
 links.add(link);
 }
 mp.links = links;
 b.store(mp).execute();

 mp = b.fetch("key0", MyPojo.class).execute();

 System.out.println(mp.key);
 System.out.println(mp.value);
 for (RiakLink link : mp.links)
 {
 System.out.println(link.getKey());
 }

 client.shutdown();
 }

}

class MyPojo
{
 public @RiakKey String key;
 public @RiakLinks Collection links;
 public String value;

}

-----------------------
That outputs:

key0
This is my value
key2
key3
key1

Checking it with curl shows it as it should be:

roach$ curl -v localhost:8098/buckets/test\\_bucket/keys/key0
\\* About to connect() to localhost port 8098 (#0)
\\* Trying ::1... Connection refused
\\* Trying 127.0.0.1... connected
\\* Connected to localhost (127.0.0.1) port 8098 (#0)
&gt; GET /buckets/test\\_bucket/keys/key0 HTTP/1.1
&gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 
&gt; OpenSSL/0.9.8x zlib/1.2.5
&gt; Host: localhost:8098
&gt; Accept: \\*/\\*
&gt;
&lt; HTTP/1.1 200 OK
&lt; X-Riak-Vclock: a85hYGBgzGDKBVIcypz/fga+nNWUwZTInMfK4Lcq5zRfFgA=
&lt; Vary: Accept-Encoding
&lt; Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
&lt; Link: ; riaktag="myLinkTag",
; riaktag="myLinkTag",
; riaktag="myLinkTag",
; rel="up"
&lt; Last-Modified: Tue, 30 Jul 2013 21:21:18 GMT
&lt; ETag: "1ikpRECrH40O93LxiTmnKz"
&lt; Date: Tue, 30 Jul 2013 21:21:57 GMT
&lt; Content-Type: application/json; charset=UTF-8
&lt; Content-Length: 28
&lt;
\\* Connection #0 to host localhost left intact
\\* Closing connection #0
{"value":"This is my value"}



On Tue, Jul 30, 2013 at 2:38 PM, Paul Ingalls  wrote:
&gt; Hey Brian,
&gt;
&gt; After a bit of messing around, I'm now dropping objects into the correct
&gt; bucket using the links annotation. However, I am noticing that the json is
&gt; including the metadata from the domain object, i.e. things tagged with
&gt; @RiakKey, @RiakIndex or @RiakLinks. I was under the impression this data
&gt; would be left out. I wouldn't care a whole lot, but when I'm getting data
&gt; back in via a fetch, the JSONConverter is crashing saying it doesn't know
&gt; how to convert the RiakLink object since there isn't an appropriate
&gt; constructor for it.
&gt;
&gt; Do I need to specifically @JsonIgnore fields tagged with one of the Riak
&gt; tags?
&gt;
&gt; Thanks!
&gt;
&gt; Paul
&gt;
&gt;
&gt; Paul Ingalls
&gt; Founder & CEO Fanzo
&gt; p...@fanzo.me
&gt; @paulingalls
&gt; http://www.linkedin.com/in/paulingalls
&gt;
&gt;
&gt;
&gt; On Jul 30, 2013, at 11:20 AM, Paul Ingalls  wrote:
&gt;
&gt; Ok, thats perfect. I totally missed the annotation for links…
&gt;
&gt; Will give that a shot…
&gt;
&gt; Thanks!
&gt;
&gt; Paul Ingalls
&gt; Founder & CEO Fanzo
&gt; p...@fanzo.me
&gt; @paulingalls
&gt; http://www.linkedin.com/in/paulingalls
&gt;
&gt;
&gt;
&gt; On Jul 30, 2013, at 11:16 AM, Brian Roach  wrote:
&gt;
&gt; Paul,
&gt;
&gt; I'm not quite sure I understand what you're asking.
&gt;
&gt; If you do a fetch and have siblings each one is converted to your
&gt; domain object using the Converter and then passed as a Collection to
&gt; the ConflictResolver. Each sibling is going to include its links
&gt; and/or indexes as long as the Converter is injecting them into the
&gt; domain object and you can resolve them in the ConflictResolver.
&gt;
&gt; The default JSONConverter, for example, injects them into your domain
&gt; object via annotations from the com.basho.riak.client.convert[1]
&gt; package.
&gt;
&gt; Thanks,
&gt; Brian Roach
&gt;
&gt; http://basho.github.io/riak-java-client/1.4.0/com/basho/riak/client/convert/package-summary.html
&gt;
&gt;
&gt; On Tue, Jul 30, 2013 at 11:41 AM, Paul Ingalls  wrote:
&gt;
&gt; Newbie with Riak, and looking at the java client.
&gt;
&gt; Specifically, I've been digging into the domain mapping apis. Looking into
&gt; the code, it appears to me that, if I'm using links a bunch or even
&gt; secondary indexes, that I could lose some data during the conflict
&gt; resolution phase. I see where links and other relevant user data gets
&gt; cached during the conversion phase from the fetch and then patched back in
&gt; during the conversion phase for the store. However, it doesn't look like
&gt; you have the opportunity during the resolution phase to merge metadata.
&gt; Should I focus on using the raw client, or am I missing something?
&gt;
&gt; Thanks!
&gt;
&gt; Paul
&gt;
&gt;
&gt;
&gt;
&gt; Paul Ingalls
&gt; Founder & CEO Fanzo
&gt; p...@fanzo.me
&gt; @paulingalls
&gt; http://www.linkedin.com/in/paulingalls
&gt;
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

