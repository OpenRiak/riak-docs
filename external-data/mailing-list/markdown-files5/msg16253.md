---
title: "Re: Strong consistency only for missing keys?"
description: ""
project: community
lastmod: 2015-06-19T00:49:54-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16253"
mailinglist_parent_id: "msg16252"
author_name: "Cosmin Marginean"
project_section: "mailinglistitem"
sent_date: 2015-06-19T00:49:54-07:00
---


Hi Ilya

Read “quorum” is unusual and a bit against the idea of distributed DB, but I 
believe what you might find useful is enabling strong consistency, which you 
can then chose to apply at a bucket(type) level:
\\* http://docs.basho.com/riak/latest/dev/advanced/strong-consistency/

One of the reasons we chose Riak is precisely the fact that you can silo your 
data into “consistent” and “available” within the same cluster. An important 
thing to remember is that with strong consistency enabled you will need a 
minimum of 3 nodes (yes, for your dev environment too), otherwise writes to 
strong-consistent buckets will fail.

Another relevant note here about strong consistency in Riak (and distributed DB 
in general): is not so much about the performance impact, but more about 
sacrificing availability to achieve this.
(The C vs A in the CAP theorem, if we are to oversimplify this)

Regards
Cos


On Friday, 19 June 2015 at 01:12, Ilya Kutukov wrote:

&gt; Hi!
&gt; 
&gt; I am planning to maintain session storage over Riak KV.
&gt; 
&gt; Core case: when user is signing in to the service session token with some 
&gt; meta is returning to the client and then saving for further usage. At the 
&gt; back-end side this session key is placing to the session storage. 
&gt; 
&gt; Riak could response false "not found" when user is providing client-side 
&gt; token on next request, what following instantly after the session record is 
&gt; placed to Riak. 
&gt; 
&gt; From the end-user POV you log in, than you surprisingly not logged in, then 
&gt; you are refreshing/restarting client and everything is back to normal. Bad 
&gt; glitchy case.
&gt; 
&gt; Riak have typical distributed DB problems when you are reading after write 
&gt; instantly. Also there is a high consistency mode with performance trade-offs.
&gt; 
&gt; Is it possible to configure or modify Riak cluster to act hybrid way:
&gt; 
&gt; Normally cluster is working in HA mode. E.g. on secondary index searches, 
&gt; updates, deletions of the existing keys. 
&gt; 
&gt; But when you are directly asking for the key that seems to be missing the 
&gt; full quorum is required to claim that there is really no such key on all 
&gt; nodes in according partition to say "No". Any other case is "Yes" after long 
&gt; or a short delay.
&gt; In theory, such behaviour will make deletion of keys slower, but situation 
&gt; with false "not found" will be better.
&gt; 
&gt; Or i'm missing some obvious way to resolve read-after-write problem like 
&gt; proxying requests to the session storage through the single instance 3-rd 
&gt; party cache?
&gt; 
&gt; 
&gt; -- 
&gt; Best regards,
&gt; Ilya Kutukov
&gt; 
&gt; +7 962 909 10 35
&gt; post.i...@gmail.com (mailto:post.i...@gmail.com)
&gt; skype: blinkedeye 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

