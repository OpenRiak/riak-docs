---
title: "Re: Ideal Backend for keys that frequently get overwritten"
description: ""
project: community
lastmod: 2011-09-14T09:50:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04705"
mailinglist_parent_id: "msg04704"
author_name: "Jeremy Raymond"
project_section: "mailinglistitem"
sent_date: 2011-09-14T09:50:55-07:00
---


Ok, thanks I'll give that a try.

What does small\\_file\\_threshold do then?

- Jeremy


On Wed, Sep 14, 2011 at 12:48 PM, Dan Reverri  wrote:

&gt; Hi Jeremy,
&gt;
&gt; The max\\_file\\_size parameter controls when Bitcask will close the currently
&gt; active data file and start a new data file. The active data file will not be
&gt; considered when determining if a merge should occur. The default
&gt; max\\_file\\_size is 2GBs. This means that each partition in the system can grow
&gt; to 2GBs before the data files are considered for merging. This is likely
&gt; what you are seeing in your situation.
&gt;
&gt; You can lower the max\\_file\\_size in the app.config file under the bitcask
&gt; section. This parameter should be specified in bytes.
&gt;
&gt; This article is related to your issue:
&gt;
&gt; https://help.basho.com/entries/20141178-why-does-it-seem-that-bitcask-merging-is-only-triggered-when-a-riak-node-is-restarted
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt;
&gt; On Wed, Sep 14, 2011 at 8:49 AM, Jeremy Raymond wrote:
&gt;
&gt;&gt; If I'm reading the docs correctly, only files smaller
&gt;&gt; than small\\_file\\_threshold will be included in a merge. So
&gt;&gt; if small\\_file\\_threshold must be bigger than max\\_file\\_size for a merge to
&gt;&gt; happen?
&gt;&gt;
&gt;&gt; - Jeremy
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Sep 14, 2011 at 10:23 AM, Jeremy Raymond wrote:
&gt;&gt;
&gt;&gt;&gt; Maybe I just need to tweak the Bitcask parameters to merge more often?
&gt;&gt;&gt;
&gt;&gt;&gt; I have approx 17000 keys which get overwritten once an hour. After each
&gt;&gt;&gt; updated the /var/lib/riak/bitcask folder grows by 20 MB (so about 1200 bytes
&gt;&gt;&gt; per key). With the default frag\\_merge\\_trigger at 60 I should get a merge
&gt;&gt;&gt; every 3 hours as I would have &gt; 60% of the keys being dead? This would also
&gt;&gt;&gt; meet the default frag\\_threshold of 40 since &gt; 40% of the keys are dead? I'm
&gt;&gt;&gt; not seeing the merging happening.
&gt;&gt;&gt;
&gt;&gt;&gt; - Jeremy
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Sep 14, 2011 at 9:28 AM, Jeremiah Peschka &lt;
&gt;&gt;&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I would think that the InnoDB backend would be a better backend for the
&gt;&gt;&gt;&gt; use case you're describing.
&gt;&gt;&gt;&gt; ---
&gt;&gt;&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
&gt;&gt;&gt;&gt; Microsoft SQL Server MVP
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Sep 14, 2011, at 8:09 AM, Jeremy Raymond wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; Hi,
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; I store data in Riak whose keys constantly get overwritten with new
&gt;&gt;&gt;&gt; data. I'm currently using Bitcask as the back-end and recently noticed the
&gt;&gt;&gt;&gt; Bitcask data folder grow to 24GB. After restarting the nodes, which I think
&gt;&gt;&gt;&gt; triggered Bitcask merge, the data went down to 96MB. Today the data dirs 
&gt;&gt;&gt;&gt; are
&gt;&gt;&gt;&gt; back up to around 500MB. Would an alternate backend better suit this type 
&gt;&gt;&gt;&gt; of
&gt;&gt;&gt;&gt; use case where keys are constantly being overwritten?
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; - Jeremy
&gt;&gt;&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

