---
title: "Re: Map reduce timeout"
description: ""
project: community
lastmod: 2010-10-05T09:24:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01198"
mailinglist_parent_id: "msg01196"
author_name: "francisco treacy"
project_section: "mailinglistitem"
sent_date: 2010-10-05T09:24:13-07:00
---


If you're going to use "inputs\\":\\"people\\" then Riak 0.13 is
\\*definitely\\* recommended. It's way faster listing keys. You might want
to try a release candidate or tip.

Francisco

2010/10/5 Germain Maurice :
&gt;  Hello everybody,
&gt;
&gt; I'm trying to execute some mapreduce jobs and i have a problem with timeout.
&gt; I'm working with riak\\_kv\\_version : &lt;&lt;"0.12.1"&gt;&gt; with a single node
&gt; "cluster".
&gt;
&gt; My inputs are "people" bucket which contains more than 200k documents. So i
&gt; have decided to set mapreduce timeout to 600000 milliseconds.
&gt; Obviously, it doesn't take care of timeout.
&gt; You'll find below the JSON object i sent to Riak/mapred and the Internal
&gt; Server Error less than 60 seconds after. I added the error message i got
&gt; in riak console.
&gt;
&gt; =====
&gt;&gt; date; perl riak.pl ; date
&gt; mardi 5 octobre 2010, 17:47:58 (UTC+0200)
&gt; --- "{\\"timeout\\":600000,\\"query\\":[{\\"map\\":{\\"source\\":\\"function(v) { var
&gt; data = Riak.mapValuesJson(v)[0] ; if ( data.faved\\_what != undefined &&
&gt; data.faved\\_what.total != undefined ) { return  [ data.faved\\_what.total ] ; }
&gt; return [];
&gt; }\\",\\"language\\":\\"javascript\\",\\"arg\\":[],\\"keep\\":false}},{\\"reduce\\":{\\"source\\":\\"function(values,
&gt; arg) { return [ values.reduce( function (item, total) { return item +
&gt; total\\*1 ; }, 0 ) ]
&gt; }\\",\\"language\\":\\"javascript\\",\\"arg\\":[],\\"keep\\":true}}],\\"inputs\\":\\"people\\"}"
&gt; --- 500 Internal Server Error
&gt;
&gt; mardi 5 octobre 2010, 17:48:53 (UTC+0200)
&gt; =====
&gt;
&gt; \\*\\*\\*\\*\\*\\*\\*\\*
&gt; =ERROR REPORT==== 5-Oct-2010::17:48:53 ===
&gt; Failed reduce: {timeout,
&gt;                   {gen\\_server,call,
&gt;                       [&lt;0.143.0&gt;,
&gt;                        {dispatch,
&gt;                            {&lt;0.143.0&gt;,#Ref&lt;0.0.5.43514&gt;},
&gt;                            {{jsanon,
&gt; &lt;&lt;"function(values, arg) { return [ values.reduce( function (item, total) {
&gt; return item + total\\*1 ; }, 0 ) ] }"&gt;&gt;},
&gt;                             [&lt;&lt;"2607"&gt;&gt;,&lt;&lt;"261"&gt;&gt;,&lt;&lt;"1753"&gt;&gt;,&lt;&lt;"81"&gt;&gt;,
&gt; &lt;&lt;"18190"&gt;&gt;,&lt;&lt;"581"&gt;&gt;,&lt;&lt;"811"&gt;&gt;,&lt;&lt;"732"&gt;&gt;,
&gt; &lt;&lt;"1831"&gt;&gt;,&lt;&lt;"967"&gt;&gt;,&lt;&lt;"2650"&gt;&gt;,&lt;&lt;"222"&gt;&gt;,
&gt; &lt;&lt;"674"&gt;&gt;,&lt;&lt;"2136"&gt;&gt;,&lt;&lt;"1467"&gt;&gt;,&lt;&lt;"362"&gt;&gt;,
&gt; &lt;&lt;"19965"&gt;&gt;,&lt;&lt;"2025"&gt;&gt;,&lt;&lt;"348"&gt;&gt;,&lt;&lt;"4817"&gt;&gt;,
&gt; &lt;&lt;"286"&gt;&gt;],
&gt;                             []}},
&gt;                        10000]}}
&gt;
&gt; =ERROR REPORT==== 5-Oct-2010::17:48:53 ===
&gt; \\*\\* State machine &lt;0.24966.6&gt; terminating
&gt; \\*\\* Last event in was {inputs,[&lt;&lt;"286"&gt;&gt;]}
&gt; \\*\\* When State == executing
&gt; \\*\\*      Data  == {state,1,riak\\_kv\\_reduce\\_phase,
&gt;                     {state,
&gt;                         {javascript,
&gt;                             {reduce,
&gt;                                 {jsanon,
&gt; &lt;&lt;"function(values, arg) { return [ values.reduce( function (item, total) {
&gt; return item + total\\*1 ; }, 0 ) ] }"&gt;&gt;},
&gt;                                 [],true}},
&gt;                         [],[]},
&gt;                     true,true,undefined,[],undefined,1,&lt;0.24964.6&gt;,660000}
&gt; \\*\\* Reason for termination =
&gt; \\*\\* {error,failed\\_reduce}
&gt; \\*\\*\\*\\*\\*\\*\\*\\*
&gt;
&gt; Any idea about this ??
&gt;
&gt; Thank you,
&gt; I'll go back to work on my slides for saturday :)
&gt;
&gt;
&gt; --
&gt; Germain Maurice
&gt; Administrateur Système/Réseau
&gt; Tel : +33.(0)1.42.43.54.33
&gt;
&gt; http://www.linkfluence.net
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

