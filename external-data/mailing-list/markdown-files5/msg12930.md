---
title: "aggregate query"
description: ""
project: community
lastmod: 2013-11-11T06:43:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12930"
author_name: "Ron Pastore"
project_section: "mailinglistitem"
sent_date: 2013-11-11T06:43:07-08:00
---


Hi All,

I posted this question to Stack Overflow a few days back but not much luck.
 Hoping someone here has some thoughts.

I have a use case for an aggregate query across the entire db and all
buckets, I'm wondering the best query method to use, leaning towards
multiple secondary index calls. This won't be a frequently used feature,
possibly invoked once a week or so via scheduled job or something.

Some records have a value in their meta attribute that I'd like to
match/target for the selection. After the selection I'll need to update
those records.

&gt;From what I've read, secondary index looks great but it is limited to a
single bucket? I also saw "list buckets", which has warnings about
production use, though not sure if that's applicable to such infrequently
used functionality. Thought maybe i could list buckets then perform the
secondary index query on each.

Is there a better way? MapReduce seems heavy, having to load every KV off
the file system. Search seem possible too but index setup/maintenance seems
overkill if there's an easier way.

UPDATE: i went ahead with a Search index but am now second guessing that.
 This lookup will be part of an encryption key rotation, where we'll be
finding certain values from Riak that are encrypted with a given key then
re-encrypting with a new key. So, if there are discrepancies or failed
operations between the actual encrypted values and the search index, there
is a potential for data loss, as we'll be discarding keys once rotated.


Sorry for the long winded description. Any help would be greatly
appreciated.
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

