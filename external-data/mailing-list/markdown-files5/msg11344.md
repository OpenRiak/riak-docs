---
title: "Riak node joining"
description: ""
project: community
lastmod: 2013-06-26T16:22:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11344"
author_name: "Daniel Iwan"
project_section: "mailinglistitem"
sent_date: 2013-06-26T16:22:24-07:00
---


Hi all

I see node stalled at 'joining' for good 8 hours now:
3-node cluster v1.3.1, 512 vnodes (way too high but that's another matter),
leveldb backend
Cluster was originally 2-nodes only and after upgrading to 1.3.1 we
attached another node
No active transfers on the nodes at the moment, but from error log looks
like vnode transfer stopped

riak-admin member-status
Attempting to restart script through sudo -H -u riak
================================= Membership
==================================
Status Ring Pending Node
-------------------------------------------------------------------------------
joining 33.2% -- 'riak@10.173.240.3'
valid 33.6% -- 'riak@10.173.240.2'
valid 33.2% -- 'riak@10.173.240.21'
-------------------------------------------------------------------------------
Valid:2 / Leaving:0 / Exiting:0 / Joining:1 / Down:0



riak-admin ring-status
Attempting to restart script through sudo -H -u riak
================================== Claimant
===================================
Claimant: 'riak@10.173.240.21'
Status: up
Ring Ready: true

============================== Ownership Handoff
==============================
No pending changes.

============================== Unreachable Nodes
==============================
All nodes are up and reachable



Node that is joining shows
\\*error.log\\*
2013-06-26 16:35:50.351 [error] &lt;0.7222.0&gt; gen\\_fsm &lt;0.7222.0&gt; in state
ready terminated with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.7223.0&gt;,stop]}}
2013-06-26 16:35:51.549 [error] &lt;0.7222.0&gt; CRASH REPORT Process &lt;0.7222.0&gt;
with 0 neighbours exited with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.7223.0&gt;,stop]}} in
gen\\_fsm:handle\\_msg/7 line 511
2013-06-26 16:35:52.460 [error] &lt;0.5316.0&gt; gen\\_fsm &lt;0.5316.0&gt; in state
ready terminated with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.5317.0&gt;,stop]}}
2013-06-26 16:35:52.696 [error] &lt;0.5316.0&gt; CRASH REPORT Process &lt;0.5316.0&gt;
with 0 neighbours exited with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.5317.0&gt;,stop]}} in
gen\\_fsm:handle\\_msg/7 line 511
2013-06-26 16:35:52.867 [error] &lt;0.9088.0&gt; gen\\_fsm &lt;0.9088.0&gt; in state
ready terminated with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.9089.0&gt;,stop]}}
2013-06-26 16:35:53.007 [error] &lt;0.9088.0&gt; CRASH REPORT Process &lt;0.9088.0&gt;
with 0 neighbours exited with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.9089.0&gt;,stop]}} in
gen\\_fsm:handle\\_msg/7 line 511
2013-06-26 16:35:53.127 [error] &lt;0.5794.0&gt; gen\\_fsm &lt;0.5794.0&gt; in state
ready terminated with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.5795.0&gt;,stop]}}
2013-06-26 16:35:53.248 [error] &lt;0.5794.0&gt; CRASH REPORT Process &lt;0.5794.0&gt;
with 0 neighbours exited with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.5795.0&gt;,stop]}} in
gen\\_fsm:handle\\_msg/7 line 511
2013-06-26 16:35:53.368 [error] &lt;0.3990.0&gt; gen\\_fsm &lt;0.3990.0&gt; in state
ready terminated with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.3991.0&gt;,stop]}}
2013-06-26 16:35:53.498 [error] &lt;0.3990.0&gt; CRASH REPORT Process &lt;0.3990.0&gt;
with 0 neighbours exited with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.3991.0&gt;,stop]}} in
gen\\_fsm:handle\\_msg/7 line 511
2013-06-26 16:35:53.619 [error] &lt;0.7017.0&gt; gen\\_fsm &lt;0.7017.0&gt; in state
ready terminated with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.7018.0&gt;,stop]}}
2013-06-26 16:35:53.739 [error] &lt;0.7017.0&gt; CRASH REPORT Process &lt;0.7017.0&gt;
with 0 neighbours exited with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.7018.0&gt;,stop]}} in
gen\\_fsm:handle\\_msg/7 line 511
2013-06-26 16:35:53.859 [error] &lt;0.5120.0&gt; gen\\_fsm &lt;0.5120.0&gt; in state
ready terminated with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.5121.0&gt;,stop]}}
2013-06-26 16:35:53.980 [error] &lt;0.5120.0&gt; CRASH REPORT Process &lt;0.5120.0&gt;
with 0 neighbours exited with reason:
{timeout,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[&lt;0.5121.0&gt;,stop]}} in
gen\\_fsm:handle\\_msg/7 line 511
2013-06-26 16:41:27.819 [error]
&lt;0.10046.0&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:226 hinted\\_handoff transfer
of riak\\_kv\\_vnode from 'riak@10.173.240.3'
961964944883816959833284743408959721921971224576 to 'riak@10.173.240.2'
961964944883816959833284743408959721921971224576 failed because of
exit:{noproc,{riak\\_core\\_gen\\_server,call,[{riak\\_kv\\_handoff\\_listener,'
riak@10.173.240.2'},handoff\\_port,infinity]}}
[{riak\\_core\\_gen\\_server,call,3,[{file,"src/riak\\_core\\_gen\\_server.erl"},{line,214}]},{riak\\_core\\_handoff\\_sender,start\\_fold,5,[{file,"src/riak\\_core\\_handoff\\_sender.erl"},{line,84}]}]
2013-06-26 16:41:27.819 [error]
&lt;0.10045.0&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:226 hinted\\_handoff transfer
of riak\\_kv\\_vnode from 'riak@10.173.240.3'
790695221759101774106290427075020305556041629696 to 'riak@10.173.240.2'
790695221759101774106290427075020305556041629696 failed because of
exit:{noproc,{riak\\_core\\_gen\\_server,call,[{riak\\_kv\\_handoff\\_listener,'
riak@10.173.240.2'},handoff\\_port,infinity]}}
[{riak\\_core\\_gen\\_server,call,3,[{file,"src/riak\\_core\\_gen\\_server.erl"},{line,214}]},{riak\\_core\\_handoff\\_sender,start\\_fold,5,[{file,"src/riak\\_core\\_handoff\\_sender.erl"},{line,84}]}]
2013-06-26 16:41:31.153 [error]
&lt;0.10061.0&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:226 hinted\\_handoff transfer
of riak\\_kv\\_vnode from 'riak@10.173.240.3'
379647886259785328361504067873565706277810601984 to 'riak@10.173.240.2'
379647886259785328361504067873565706277810601984 failed because of
exit:{noproc,{riak\\_core\\_gen\\_server,call,[{riak\\_kv\\_handoff\\_listener,'
riak@10.173.240.2'},handoff\\_port,infinity]}}
[{riak\\_core\\_gen\\_server,call,3,[{file,"src/riak\\_core\\_gen\\_server.erl"},{line,214}]},{riak\\_core\\_handoff\\_sender,start\\_fold,5,[{file,"src/riak\\_core\\_handoff\\_sender.erl"},{line,84}]}]
2013-06-26 16:45:23.242 [error] emulator Error in process &lt;0.25919.0&gt; on
node 'riak@10.173.240.3' with exit value:
{badarg,[{riak\\_core\\_stat,'-vnodeq\\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\\_core\\_stat.erl"},{line,168}]},{riak\\_core\\_stat,'-vnodeq\\_stats/0-lc$^0/1-0-',1,[{file,"src/riak\\_core\\_stat.erl"},{line,169}]},{riak\\_core\\_stat,vnodeq\\_stats...



\\*console log:\\*
2013-06-26 16:52:14.834 [info]
&lt;0.30751.0&gt;@riak\\_core\\_handoff\\_receiver:process\\_message:99 Receiving handoff
data for partition
riak\\_kv\\_vnode:822094670998632891489572718402909198556462055424
2013-06-26 16:52:14.875 [info]
&lt;0.30751.0&gt;@riak\\_core\\_handoff\\_receiver:handle\\_info:69 Handoff receiver for
partition 822094670998632891489572718402909198556462055424 exited after
processing 0 objects
2013-06-26 16:52:16.693 [info]
&lt;0.30763.0&gt;@riak\\_core\\_handoff\\_receiver:process\\_message:99 Receiving handoff
data for partition
riak\\_kv\\_vnode:125597796958124469533129165311555572001681702912
2013-06-26 16:52:16.731 [info]
&lt;0.30763.0&gt;@riak\\_core\\_handoff\\_receiver:handle\\_info:69 Handoff receiver for
partition 125597796958124469533129165311555572001681702912 exited after
processing 0 objects
2013-06-26 18:52:20.507 [info]
&lt;0.18639.3&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:204 Repaired 2010 keys during
active anti-entropy exchange of
{436737793968023723603835506651545511733120466944,3} between
{439592289353435643365952078590444502005885960192,'riak@10.173.240.3'} and
{442446784738847563128068650529343492278651453440,'riak@10.173.240.21'}
2013-06-26 18:52:49.282 [info]
&lt;0.22964.3&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:204 Repaired 1809 keys during
active anti-entropy exchange of
{439592289353435643365952078590444502005885960192,3} between
{439592289353435643365952078590444502005885960192,'riak@10.173.240.3'} and
{442446784738847563128068650529343492278651453440,'riak@10.173.240.21'}
2013-06-26 21:43:21.418 [info]
&lt;0.17334.7&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:204 Repaired 1809 keys during
active anti-entropy exchange of
{48526421552002635955981722961282834637013385216,3} between
{51380916937414555718098294900181824909778878464,'riak@10.173.240.3'} and
{54235412322826475480214866839080815182544371712,'riak@10.173.240.21'}
2013-06-26 21:43:51.259 [info]
&lt;0.21268.7&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:204 Repaired 1965 keys during
active anti-entropy exchange of
{51380916937414555718098294900181824909778878464,3} between
{51380916937414555718098294900181824909778878464,'riak@10.173.240.3'} and
{54235412322826475480214866839080815182544371712,'riak@10.173.240.21'}
2013-06-26 22:22:22.352 [info]
&lt;0.20533.8&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:204 Repaired 1961 keys during
active anti-entropy exchange of
{271177061614132377401074334195404075912721858560,3} between
{274031556999544297163190906134303066185487351808,'riak@10.173.240.3'} and
{276886052384956216925307478073202056458252845056,'riak@10.173.240.2'}
2013-06-26 22:22:51.652 [info]
&lt;0.24761.8&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:204 Repaired 2010 keys during
active anti-entropy exchange of
{274031556999544297163190906134303066185487351808,3} between
{274031556999544297163190906134303066185487351808,'riak@10.173.240.3'} and
{276886052384956216925307478073202056458252845056,'riak@10.173.240.2'}


\\*riak-admin status\\*
Attempting to restart script through sudo -H -u riak
1-minute stats for 'riak@10.173.240.3'
-------------------------------------------
riak\\_kv\\_stat\\_ts : 1372288487
vnode\\_gets : 254
vnode\\_gets\\_total : 159164
vnode\\_puts : 0
vnode\\_puts\\_total : 42811
vnode\\_index\\_reads : 0
vnode\\_index\\_reads\\_total : 3706
vnode\\_index\\_writes : 0
vnode\\_index\\_writes\\_total : 42811
vnode\\_index\\_writes\\_postings : 0
vnode\\_index\\_writes\\_postings\\_total : 0
vnode\\_index\\_deletes : 0
vnode\\_index\\_deletes\\_total : 0
vnode\\_index\\_deletes\\_postings : 0
vnode\\_index\\_deletes\\_postings\\_total : 0
node\\_gets : 95
node\\_gets\\_total : 58191
node\\_get\\_fsm\\_siblings\\_mean : 0
node\\_get\\_fsm\\_siblings\\_median : 0
node\\_get\\_fsm\\_siblings\\_95 : 0
node\\_get\\_fsm\\_siblings\\_99 : 0
node\\_get\\_fsm\\_siblings\\_100 : 0
node\\_get\\_fsm\\_objsize\\_mean : 0
node\\_get\\_fsm\\_objsize\\_median : 0
node\\_get\\_fsm\\_objsize\\_95 : 0
node\\_get\\_fsm\\_objsize\\_99 : 0
node\\_get\\_fsm\\_objsize\\_100 : 0
node\\_get\\_fsm\\_time\\_mean : 1266
node\\_get\\_fsm\\_time\\_median : 1309
node\\_get\\_fsm\\_time\\_95 : 1526
node\\_get\\_fsm\\_time\\_99 : 2097
node\\_get\\_fsm\\_time\\_100 : 3879
node\\_puts : 0
node\\_puts\\_total : 192
node\\_put\\_fsm\\_time\\_mean : 0
node\\_put\\_fsm\\_time\\_median : 0
node\\_put\\_fsm\\_time\\_95 : 0
node\\_put\\_fsm\\_time\\_99 : 0
node\\_put\\_fsm\\_time\\_100 : 0
read\\_repairs : 0
read\\_repairs\\_total : 15325
coord\\_redirs\\_total : 126
executing\\_mappers : 0
precommit\\_fail : 0
postcommit\\_fail : 0
pbc\\_active : 0
pbc\\_connects : 8
pbc\\_connects\\_total : 2834
read\\_repairs\\_primary\\_notfound\\_one : 0
read\\_repairs\\_primary\\_notfound\\_count : 23123
read\\_repairs\\_fallback\\_notfound\\_one : 0
read\\_repairs\\_fallback\\_notfound\\_count : 1869
leveldb\\_read\\_block\\_error : 0
riak\\_pipe\\_stat\\_ts : 1372288486
pipeline\\_active : 0
pipeline\\_create\\_count : 0
pipeline\\_create\\_one : 0
pipeline\\_create\\_error\\_count : 0
pipeline\\_create\\_error\\_one : 0
cpu\\_nprocs : 418
cpu\\_avg1 : 5
cpu\\_avg5 : 18
cpu\\_avg15 : 26
mem\\_total : 2082766848
mem\\_allocated : 938852352
disk : [{"/",974010980,1},
 {"/dev",1008180,1},
 {"/run",406792,1},
 {"/run/lock",5120,0},
 {"/run/shm",1016976,0},
 {"/boot",186663,17}]
nodename : 'riak@10.173.240.3'
connected\\_nodes : ['riak@10.173.240.21','riak@10.173.240.2']
sys\\_driver\\_version : &lt;&lt;"2.0"&gt;&gt;
sys\\_global\\_heaps\\_size : 0
sys\\_heap\\_type : private
sys\\_logical\\_processors : 4
sys\\_otp\\_release : &lt;&lt;"R15B01"&gt;&gt;
sys\\_process\\_count : 4665
sys\\_smp\\_support : true
sys\\_system\\_version : &lt;&lt;"Erlang R15B01 (erts-5.9.1) [source] [64-bit]
[smp:4:4] [async-threads:64] [kernel-poll:true]"&gt;&gt;
sys\\_system\\_architecture : &lt;&lt;"x86\\_64-unknown-linux-gnu"&gt;&gt;
sys\\_threads\\_enabled : true
sys\\_thread\\_pool\\_size : 64
sys\\_wordsize : 8
ring\\_members : ['riak@10.173.240.2','riak@10.173.240.21','riak@10.173.240.3
']
ring\\_num\\_partitions : 512
ring\\_ownership : &lt;&lt;"[{'riak@10.173.240.21',170},\\n {'riak@10.173.240.2',172},\\n
{'riak@10.173.240.3',170}]"&gt;&gt;
ring\\_creation\\_size : 512
storage\\_backend : riak\\_kv\\_eleveldb\\_backend
erlydtl\\_version : &lt;&lt;"0.7.0"&gt;&gt;
riak\\_control\\_version : &lt;&lt;"1.3.0"&gt;&gt;
cluster\\_info\\_version : &lt;&lt;"1.2.3"&gt;&gt;
riak\\_search\\_version : &lt;&lt;"1.3.0"&gt;&gt;
merge\\_index\\_version : &lt;&lt;"1.3.0"&gt;&gt;
riak\\_kv\\_version : &lt;&lt;"1.3.1"&gt;&gt;
riak\\_api\\_version : &lt;&lt;"1.3.1"&gt;&gt;
riak\\_pipe\\_version : &lt;&lt;"1.3.1"&gt;&gt;
riak\\_core\\_version : &lt;&lt;"1.3.1"&gt;&gt;
bitcask\\_version : &lt;&lt;"1.6.1"&gt;&gt;
basho\\_stats\\_version : &lt;&lt;"1.0.3"&gt;&gt;
webmachine\\_version : &lt;&lt;"1.9.3"&gt;&gt;
mochiweb\\_version : &lt;&lt;"1.5.1p3"&gt;&gt;
inets\\_version : &lt;&lt;"5.9"&gt;&gt;
erlang\\_js\\_version : &lt;&lt;"1.2.2"&gt;&gt;
runtime\\_tools\\_version : &lt;&lt;"1.8.8"&gt;&gt;
os\\_mon\\_version : &lt;&lt;"2.2.9"&gt;&gt;
riak\\_sysmon\\_version : &lt;&lt;"1.1.3"&gt;&gt;
ssl\\_version : &lt;&lt;"5.0.1"&gt;&gt;
public\\_key\\_version : &lt;&lt;"0.15"&gt;&gt;
crypto\\_version : &lt;&lt;"2.1"&gt;&gt;
sasl\\_version : &lt;&lt;"2.2.1"&gt;&gt;
lager\\_version : &lt;&lt;"1.2.2"&gt;&gt;
syntax\\_tools\\_version : &lt;&lt;"1.6.8"&gt;&gt;
compiler\\_version : &lt;&lt;"4.8.1"&gt;&gt;
stdlib\\_version : &lt;&lt;"1.18.1"&gt;&gt;
kernel\\_version : &lt;&lt;"2.15.1"&gt;&gt;
memory\\_total : 75985000
memory\\_processes : 44614494
memory\\_processes\\_used : 44614480
memory\\_system : 31370506
memory\\_atom : 569961
memory\\_atom\\_used : 539061
memory\\_binary : 3642608
memory\\_code : 10232207
memory\\_ets : 4826952


\\*Data size in Riak:\\*

du -h --max-depth=1 /var/lib/riak/
\\*\\*\\*\\*\\* 10.0.20.21 \\*\\*\\*\\*\\*
0 /var/lib/riak/bitcask
132K /var/lib/riak/ring
8.0K /var/lib/riak/mr\\_queue
2.1M /var/lib/riak/kv\\_vnode
899M /var/lib/riak/leveldb
180M /var/lib/riak/anti\\_entropy
1.1G /var/lib/riak/
\\*\\*\\*\\*\\* 10.0.20.22 \\*\\*\\*\\*\\*
0 /var/lib/riak/bitcask
132K /var/lib/riak/ring
8.0K /var/lib/riak/mr\\_queue
2.1M /var/lib/riak/kv\\_vnode
292M /var/lib/riak/leveldb
220M /var/lib/riak/anti\\_entropy
513M /var/lib/riak/
\\*\\*\\*\\*\\* 10.0.20.23 \\*\\*\\*\\*\\*
0 /var/lib/riak/bitcask
64K /var/lib/riak/ring
2.1M /var/lib/riak/kv\\_vnode
53M /var/lib/riak/leveldb
23M /var/lib/riak/anti\\_entropy
77M /var/lib/riak/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

