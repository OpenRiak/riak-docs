---
title: "Re: multi-get optimisation"
description: ""
project: community
lastmod: 2013-11-05T05:50:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12849"
mailinglist_parent_id: "msg12814"
author_name: "Vincent Chavelle"
project_section: "mailinglistitem"
sent_date: 2013-11-05T05:50:42-08:00
---


Hi Dmitri,

Thanks for your recommendations

On Thu, Oct 31, 2013 at 5:15 PM, Dmitri Zagidulin wrote:

&gt; Vincent,
&gt;
&gt; How large are the objects that you're requesting? (in the 1000 objs
&gt; example).
&gt;

1KB


&gt; Also, what does your cluster configuration look like? How many nodes? Are
&gt; you load-balancing the GETs to your riak nodes (via something like
&gt; HAProxy), or are you making requests to a single riak node?
&gt;

5 nodes with haproxy in front for both http and protocol buffer


&gt;
&gt; It sounds like the first thing to investigate, in your case, is - where is
&gt; the slowdown happening, on the client side or on the server side?
&gt; To get a reference data point on the cluster-side multiget performance,
&gt; you can use an external tool like
&gt; https://github.com/basho/riak-data-migrator or
&gt; https://github.com/basho/basho\\_bench to get a rough idea of how many
&gt; requests/sec your Riak cluster can handle.
&gt; For example, you can download the Data Migrator (which has pretty good
&gt; multithreaded connection-pooled GETs that use the Java Riak Client) and do
&gt; an export of your cluster (or the bucket in question), and look at the
&gt; resulting objs/sec number.
&gt;

1745.6 Objs/Sec


&gt;
&gt; If the bottleneck turns out to be on the Ruby client side, you should
&gt; investigate JRuby for better multithreaded performance, or use a
&gt; concurrency library like Celluloid.
&gt;

I think it's the client side, isn't it?
This is why the server solution seems the most optimized (no need to
instantiate any threads).
A concurrency library like Celluloid is it better than the current ruby
client implementation?
https://github.com/basho/riak-ruby-client/blob/master/lib/riak/multiget.rb

Thanks again


&gt;
&gt;
&gt; Dmitri
&gt;
&gt;
&gt; On Tue, Oct 29, 2013 at 6:24 AM, Vincent Chavelle &lt;
&gt; vincent.chave...@gmail.com&gt; wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I fell in love with riak and riak-cs, I have migrated all my stack on it
&gt;&gt; (originally from mongodb).
&gt;&gt; But I have one big issue. I have a lot of key to request simultaneously
&gt;&gt; and thanks for multi\\_get implementation (ruby) it's already optimised for
&gt;&gt; the client side (concurrent requests). But I would like to know if any
&gt;&gt; server implementation to come because, in my case, it is very very slow to
&gt;&gt; request 1000 objects (unlike mongodb).
&gt;&gt;
&gt;&gt; You will make me the happiest man in the world. And I could take off my
&gt;&gt; hideous memory caching solution :-)
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt;
&gt;&gt; Vincent Chavelle
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

