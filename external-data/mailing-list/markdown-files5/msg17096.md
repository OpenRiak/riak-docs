---
title: "Re: Yokozuna inconsistent search results"
description: ""
project: community
lastmod: 2016-02-29T00:29:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17096"
mailinglist_parent_id: "msg17080"
author_name: "Magnus Kessler"
project_section: "mailinglistitem"
sent_date: 2016-02-29T00:29:59-08:00
---


On 26 February 2016 at 15:51, Oleksiy Krivoshey  wrote:

&gt; Yes, AAE is enabled:
&gt;
&gt; anti\\_entropy = active
&gt;
&gt; [...]

&gt; However the output of "riak-admin search aae-status" looks like this:
&gt; http://oleksiy.sirv.com/misc/search-aae.png
&gt;
&gt;
Hi Oleksiy,

there are two partitions on the node that haven't seen their AAE tree
rebuilt in a long time. The reason for this is not clear at the moment,
although we have seen this happening when a partition contains data that
for some reason cannot be indexed with the configured Solr schema.

Please run on the 'riak attach' console:

riak\\_core\\_util:rpc\\_every\\_member\\_ann(yz\\_entropy\\_mgr, expire\\_trees, [], 5000).

Afterwards exit the console with "Ctrl-G q".

The AAE trees should start to be rebuilt shortly after. With default
settings, on a cluster with ring size 64 the whole process should finish in
about 1 day and any missing but indexable data should appear in all
assigned Solr instances. During this time you may still observe
inconsistent search results due to the way the coverage query is performed.
Keep an eye open for any errors from one of the yz\\_ modules in the logs
during this time.

Please let us know if the Search AAE trees can be rebuilt successfully and
if this solved your issue.

Kind Regards,

Magnus


PS: Please consider subscribing to this subscribers only mailing list to
avoid your messages being held in the moderation queue. Instructions on how
to join can be found at
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com.


&gt; On Fri, 26 Feb 2016 at 17:13 Fred Dushin  wrote:
&gt;
&gt;&gt; I would check the coverage plans that are being used for the different
&gt;&gt; queries, which you can usually see in the headers of the resulting
&gt;&gt; document. When you run a search query though yokozuna, it will use a
&gt;&gt; coverage plan from riak core to find a minimal set of nodes (and
&gt;&gt; partitions) to query to get a set of results, and the coverage plan may
&gt;&gt; change every few seconds. You might be hitting nodes that have
&gt;&gt; inconsistencies or are in need of repair. Do you have AAE enabled?
&gt;&gt;
&gt;&gt; -Fred
&gt;&gt;
&gt;&gt; &gt; On Feb 26, 2016, at 8:36 AM, Oleksiy Krivoshey 
&gt;&gt; wrote:
&gt;&gt; &gt;
&gt;&gt; &gt; Hi!
&gt;&gt; &gt;
&gt;&gt; &gt; Riak 2.1.3
&gt;&gt; &gt;
&gt;&gt; &gt; Having a stable data set (no documents deleted in months) I'm receiving
&gt;&gt; inconsistent search results with Yokozuna. For example first query can
&gt;&gt; return num\\_found: 3000 (correct), the same query repeated in next seconds
&gt;&gt; can return 2998, or 2995, then 3000 again. Similar inconsistency happens
&gt;&gt; when trying to receive data in pages (using start/rows options): sometimes
&gt;&gt; I get the same document twice (in different pages), sometimes some
&gt;&gt; documents are missing completely.
&gt;&gt; &gt;
&gt;&gt; &gt; There are no errors or warning in Yokozuna logs. What should I look for
&gt;&gt; in order to debug the problem?
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks!
&gt;
&gt;
-- 
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

