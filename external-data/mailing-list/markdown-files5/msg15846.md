---
title: "Re: Query on Riak Search in a cluster of 3 nodes behind ELB is giving	different result everytime"
description: ""
project: community
lastmod: 2015-03-05T12:42:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15846"
mailinglist_parent_id: "msg15839"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-03-05T12:42:06-08:00
---


Hello Baskar, Santi,

2-15 minutes is a long while, and we’ve not seen index creation/propagation be 
so slow. I’d definitely take a closer look at how you’re creating these indexes 
dynamically on the fly, as index creation is typically a more straightforward 
admin task.

We’ve added defaults to solrconfig.xml to handle most typical use-cases. You 
can read more about solrconfig.xml at 
http://wiki.apache.org/solr/SolrConfigXml#mainIndex\\_Section 
. You may want to 
take another look and optimize/improve your schema design to prevent such 
issues. You can read more about Solr’s performance factors here -&gt; 
http://wiki.apache.org/solr/SolrPerformanceFactors 
. 

Thanks.


Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\\_we\\_love | paperswelove.org
twitter =&gt; @zeeshanlakhani

&gt; On Mar 5, 2015, at 3:00 PM, Baskar Srinivasan  wrote:
&gt; 
&gt; Hello Zeeshan,
&gt; 
&gt; Thanks for the pointer regarding waiting for index creation in each node in 
&gt; the cluster.
&gt; 
&gt; Presently, when the indices get created on one node, it takes a full 2-15 
&gt; minutes for it to get created on other nodes in the cluster. Following are 
&gt; the timestamps on 3 nodes for a single index:
&gt; 
&gt; #Create index request from our server via load balancer
&gt; 11:16:52.999 [http-bio-8080-exec-3] INFO c.v.s.u.RiakClientUtil - Created 
&gt; index for bsr-test-fromlocal-1-Access\\_index
&gt; 
&gt; #1st node, immediate creation (12 secs) once call is issued from our server
&gt; 2015-03-05 19:17:04.135 [info] &lt;0.17388.104&gt;@yz\\_index:local\\_create:189 
&gt; Created index bsr-test-fromlocal-1-Access\\_index with schema
&gt; 
&gt; #2nd node, takes another 4 minutes for creation request to propagate
&gt; 
&gt; 
&gt; 2015-03-05 19:21:17.879 [info] &lt;0.20606.449&gt;@yz\\_index:local\\_create:189 
&gt; Created index bsr-test-fromlocal-1-Access\\_index
&gt; 
&gt; #3rd node, takes 15 minutes for creation request to propagate
&gt; 
&gt; 
&gt; 2015-03-05 19:32:32.172 [info] &lt;0.14715.94&gt;@yz\\_index:local\\_create:189 Created 
&gt; index bsr-test-fromlocal-1-Access\\_index
&gt; 
&gt; Is there a solr config we can tune to make the 2nd and 3rd node propagation 
&gt; more immediate in the order of &lt; 60 seconds?
&gt; 
&gt; Thanks,
&gt; 
&gt; Baskar
&gt; 
&gt; 
&gt; On Thu, Mar 5, 2015 at 9:11 AM, Zeeshan Lakhani  &gt; wrote:
&gt; Hello Santi, Baskar. Please keep your messages on the user group mailing 
&gt; list, btw. Thanks.
&gt; 
&gt; Here’s an example of our testing harness’s wait\\_for\\_index function, 
&gt; https://github.com/basho/yokozuna/blob/develop/riak\\_test/yz\\_rt.erl#L420 
&gt; . We 
&gt; check for the index on each of the nodes, which is an approach you can take. 
&gt; 
&gt; And, as I mentioned, I’m currently working on making Index creation 
&gt; synchronous to make this easier.
&gt; 
&gt; If your logs are not pointing to any errors and being that your bucket, index 
&gt; contains so few objects, I’d delete or mv the search-root/index directory 
&gt; (./data/yz/&lt;&gt;) and let AAE resync the data, which should then 
&gt; give you consistent results.
&gt; 
&gt; Thanks.
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

