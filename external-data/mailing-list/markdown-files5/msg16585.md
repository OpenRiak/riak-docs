---
title: "Re: Yokozuna indexes too slow"
description: ""
project: community
lastmod: 2015-10-01T07:13:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16585"
mailinglist_parent_id: "msg16581"
author_name: "Jason Voegele"
project_section: "mailinglistitem"
sent_date: 2015-10-01T07:13:02-07:00
---


Hello Ilyas, I’ve got a few questions for you to help diagnose the performance 
problem.

\\* What Riak version are you running?

\\* Are you using the default solrconfig on the index, or a custom configuration?

\\* You say that there is a 200x slow down when Yokozuna indexing is enabled. Do 
you have any specific numbers? A graph would be helpful if you can generate one.

\\* When you say that Yokozuna takes up 100% of one core, have you been able to 
narrow that down to specific process within Yokozuna or Riak? Using “riak-admin 
top” might help here.

\\* Can you provide your JVM configuration (heap settings, etc.)?


&gt; On Oct 1, 2015, at 2:18 AM, ilyas  wrote:
&gt; 
&gt; 
&gt; Hello to the Riak community! 
&gt; I have a cluster of 5 nodes (hardware servers with SSDs, 8 CPU cores, 16GB of 
&gt; RAM, most of it is free). When I store data to the database (up to 1 000 000 
&gt; keys) without indexes, everything happens very quickly. If I create an index 
&gt; for yokozuna and do the same, the store rate decreases greatly (200 times). 
&gt; The process yokozuna takes up 100% of the time one core of CPU, other cores 
&gt; are not loaded. Keys are short strings (16 symbols), values are json strings 
&gt; (length is about 200 characters). 
&gt; How can I find out the reason of such performance and fix it?
&gt; 
&gt; creation of bucket:
&gt; 
&gt; #!/bin/bash
&gt; 
&gt; RIAK\\_HOST="127.0.0.1:8098"
&gt; 
&gt; #define search scheme
&gt; curl -XPUT $RIAK\\_HOST/search/schema/dbsearch -H 
&gt; 'Content-Type:application/xml' --data-binary @dbSchema.xml
&gt; 
&gt; # create search index for scheme
&gt; curl -XPUT $RIAK\\_HOST/search/index/user\\_idx\\_bin -H 'Content-Type: 
&gt; application/json' -d '{"schema":"dbsearch"}'
&gt; 
&gt; # create bucket type for leleldb backend
&gt; sudo /usr/sbin/riak-admin bucket-type create leveldb 
&gt; '{"props":{"backend":"leveldb\\_mult"}}'
&gt; sudo /usr/sbin/riak-admin bucket-type activate leveldb
&gt; 
&gt; #create buckets with known backends and indexes
&gt; curl -XPUT $RIAK\\_HOST/types/leveldb/buckets/SomeBucket/props -H 
&gt; 'Content-Type: application/json' -d 
&gt; '{"props":{"search\\_index":"user\\_idx\\_bin"}}'
&gt; 
&gt; index scheme:
&gt; 
&gt; xml version="1.0" encoding="UTF-8" ?
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt;  multiValued="false" required="true"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt;  positionIncrementGap="0"/&gt;
&gt;  multiValued="true" class="solr.StrField" /&gt;
&gt; 
&gt; 
&gt; \\_yz\\_id
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

