---
title: "Re: CRASH REPORT Process <<\"TypeError: reduce of empty array with no	initial value\">>},{<<\"source\">>,<<\"unknown\">>}]}"
description: ""
project: community
lastmod: 2012-12-21T23:39:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09666"
mailinglist_parent_id: "msg09647"
author_name: "David Montgomery"
project_section: "mailinglistitem"
sent_date: 2012-12-21T23:39:36-08:00
---


Hi,

Thanks...... in my mapper I added obj={} which I left out.

But still cant get MR to work but left out that i am using filters. I get
the same error and am wondering if I am using key filters correct.
 {'uuid':1,'campaign\\_id':2,'adgroup\\_id':3,'date':4,'country':5}

 filters = key\\_filter.tokenize(":",5).eq(country) \\
 & key\\_filter.tokenize(":", 2).eq(campaign\\_id) \\
 & key\\_filter.tokenize(":", 4).string\\_to\\_int().less\\_than\\_eq(date\\_end) \\
 & key\\_filter.tokenize(":",
4).string\\_to\\_int().greater\\_than\\_eq(date\\_start)
 query.add\\_key\\_filters(filters)

'[['and', [['tokenize', ':', 5], ['eq', 'SG']], [['tokenize', ':', 2],
['eq', 'cid5989410021']], [['tokenize', ':', 4], ['string\\_to\\_int'],
['less\\_than\\_eq', '2012122509']], [['tokenize', ':', 4], ['string\\_to\\_int'],
['greater\\_than\\_eq', '2012121810']]]]

If I leave out & key\\_filter.tokenize(":",
filter\\_map['date']).string\\_to\\_int().greater\\_than\\_eq(date\\_start) the query
works and I get the data I want. If I include then I get the error.
So...what I cant figure out is why I cant use the last filter. My key
looks like this.
07712f3d-6661-44a7-89ff-4e4ed3b5f5a6:cid5989410021:agid7744464312:2012122205:SG

uuid:campaign\\_id:aid:date:country where date is in YYYYMMDDHH format

I just want a query that will filter by campaign\\_id, country, and between a
date range.

thanks
















On Thu, Dec 20, 2012 at 11:07 PM, Bryan Fink  wrote:

&gt; On Thu, Dec 20, 2012 at 8:52 AM, David Montgomery
&gt;  wrote:
&gt; &gt; {fitting\\_exited\\_abnormally,[{&lt;&lt;"lineno"&gt;&gt;,3},{&lt;&lt;"message"&gt;&gt;,&lt;&lt;"TypeError:
&gt; &gt; reduce of empty array with no initial value"&gt;&gt;}
&gt;
&gt; Hi, David. The error is occurring on line three of your reduce
&gt; function, where it calls `values.reduce`:
&gt;
&gt; &gt; query.reduce('''
&gt; &gt; function(values, arg){
&gt; &gt; return [ values.reduce( function(acc, item) {
&gt; ...
&gt;
&gt; It's complaining about the fact that `values` is an empty array, so
&gt; `values.reduce` doesn't know what to do. You will need to either
&gt; include an initial value as a second parameter, like:
&gt;
&gt; values.reduce(function(acc, item) { ... },
&gt; {}) //initial empty object
&gt;
&gt; Or check to see if `values` is empty before reducing, like the Riak JS
&gt; reduce builtins do:
&gt;
&gt; https://github.com/basho/riak\\_kv/blob/master/priv/mapred\\_builtins.js#L68
&gt;
&gt; Cheers,
&gt; Bryan
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

