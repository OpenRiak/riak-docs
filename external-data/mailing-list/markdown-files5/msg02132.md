---
title: "Re: Riak map reduce returning all results"
description: ""
project: community
lastmod: 2011-01-27T04:54:35-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02132"
mailinglist_parent_id: "msg02131"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-01-27T04:54:35-08:00
---


mapValuesJson (
https://github.com/basho/riak\\_kv/blob/master/priv/mapred\\_builtins.js#L45)
takes a JSON formatted string and returns it as a JavaScript object. You'll
still need to do something with it to make the magic happen.

mr = Riak::MapReduce.new(client)
mr.add("stocks")
mr.map("function(value, keyData, arg) {
 var data = Riak.mapValuesJson(value)[0];
 if (data.abr == "GOOG") {
 // magic happens here
 return [data];
 }
}", :keep =&gt; true, :language =&gt; "JavaScript")



Jeremiah Peschka
Microsoft SQL Server MVP
MCITP: Database Developer, DBA


On Thu, Jan 27, 2011 at 7:37 AM, Joshua Partogi wrote:

&gt; Hi all,
&gt;
&gt; I am trying to do map reduce with the ruby client as such:
&gt; client = Ripple.client
&gt; Riak::MapReduce.new(client).
&gt; add("stocks").
&gt; map("Riak.mapValuesJson", :arg =&gt; "GOOG", :keep =&gt; true)
&gt;
&gt; where the JSON document inside the bucket is as such:
&gt;
&gt; { "abr" : "GOOG" }
&gt; { "abr" : "AAPL" }
&gt;
&gt; However instead of returning only one result it is returning all values in
&gt; the bucket.
&gt;
&gt; What am I doing wrong here?
&gt;
&gt; Thanks heaps for the help.
&gt;
&gt; --
&gt; http://twitter.com/jpartogi 
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

