---
title: "Re: Spaces in the search string"
description: ""
project: community
lastmod: 2016-09-08T13:30:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17633"
mailinglist_parent_id: "msg17629"
author_name: "sean mcevoy"
project_section: "mailinglistitem"
sent_date: 2016-09-08T13:30:07-07:00
---


Hi Alexander,
Unfortunately it didn't shake with any satisfaction.
I'm sure there's an easy answer, and I hope I'll get back to search for it
some day.
But for now me & my pragmatic overlords have gone for a work-around
solution that avoids the problem.
//Sean.


On Wed, Sep 7, 2016 at 2:06 PM, Alexander Sicular 
wrote:

&gt; Hi Sean, Familiarize yourself with the default schema[0], if that is what
&gt; you're using. Also check details around this specific type of search around
&gt; the web[1].
&gt;
&gt; Let us know how it shakes out,
&gt; -Alexander
&gt;
&gt;
&gt; [0] https://raw.githubusercontent.com/basho/yokozuna/develop/priv/default\\_
&gt; schema.xml
&gt; [1] http://stackoverflow.com/questions/10023133/solr-
&gt; wildcard-query-with-whitespace
&gt;
&gt;
&gt;
&gt; On Wednesday, September 7, 2016, sean mcevoy 
&gt; wrote:
&gt;
&gt;&gt; Hi again!
&gt;&gt;
&gt;&gt; Apologies for the premature post earlier. I thought I had a solution when
&gt;&gt; I didn't get the error but when I got around to plugging it into my
&gt;&gt; application it's still not doing everything that I need.
&gt;&gt; I've narrowed it down to this minimal testcase, first setup the index &
&gt;&gt; insert the data:
&gt;&gt;
&gt;&gt;
&gt;&gt; {ok,Pid} = riakc\\_pb\\_socket:start("127.0.0.1", 10017).
&gt;&gt; ok = riakc\\_pb\\_socket:create\\_search\\_index(Pid, &lt;&lt;"test\\_index"&gt;&gt;,
&gt;&gt; &lt;&lt;"\\_yz\\_default"&gt;&gt;, []).
&gt;&gt; ok = riakc\\_pb\\_socket:set\\_search\\_index(Pid, &lt;&lt;"test\\_bucket"&gt;&gt;,
&gt;&gt; &lt;&lt;"test\\_index"&gt;&gt;).
&gt;&gt; RO = riakc\\_obj:new(&lt;&lt;"test\\_bucket"&gt;&gt;, &lt;&lt;"test\\_key"&gt;&gt;,
&gt;&gt; &lt;&lt;"{\\"name\\_s\\":\\"my test name\\",\\"age\\_i\\":2}"&gt;&gt;, "application/json").
&gt;&gt; ok = riakc\\_pb\\_socket:put(Pid, RO).
&gt;&gt;
&gt;&gt;
&gt;&gt; Now I can get the hit when search for a partial name with wildcards & no
&gt;&gt; escapes or spaces:
&gt;&gt; 521&gt;
&gt;&gt; 521&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"test\\_index"&gt;&gt;, &lt;&lt;"name\\_s:\\*test\\* AND
&gt;&gt; age\\_i:2"&gt;&gt;, []).
&gt;&gt; {ok,{search\\_results,[{&lt;&lt;"test\\_index"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"score"&gt;&gt;,&lt;&lt;"1.22776079999999998549e+00"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_rb"&gt;&gt;,&lt;&lt;"test\\_bucket"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_rt"&gt;&gt;,&lt;&lt;"default"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_rk"&gt;&gt;,&lt;&lt;"test\\_key"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_id"&gt;&gt;,&lt;&lt;"1\\*default\\*tes
&gt;&gt; t\\_bucket\\*test\\_key\\*57"&gt;&gt;},
&gt;&gt; {&lt;&lt;"name\\_s"&gt;&gt;,&lt;&lt;"my test name"&gt;&gt;},
&gt;&gt; {&lt;&lt;"age\\_i"&gt;&gt;,&lt;&lt;"2"&gt;&gt;}]}],
&gt;&gt; 1.2277607917785645,1}}
&gt;&gt;
&gt;&gt;
&gt;&gt; And I can get the hit when I search for the full name with spaces & the
&gt;&gt; escaped quotes:
&gt;&gt; 522&gt;
&gt;&gt; 522&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"test\\_index"&gt;&gt;, &lt;&lt;"name\\_s:\\"my test
&gt;&gt; name\\" AND age\\_i:2"&gt;&gt;, []).
&gt;&gt; {ok,{search\\_results,[{&lt;&lt;"test\\_index"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"score"&gt;&gt;,&lt;&lt;"1.00736960000000008719e+00"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_rb"&gt;&gt;,&lt;&lt;"test\\_bucket"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_rt"&gt;&gt;,&lt;&lt;"default"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_rk"&gt;&gt;,&lt;&lt;"test\\_key"&gt;&gt;},
&gt;&gt; {&lt;&lt;"\\_yz\\_id"&gt;&gt;,&lt;&lt;"1\\*default\\*tes
&gt;&gt; t\\_bucket\\*test\\_key\\*58"&gt;&gt;},
&gt;&gt; {&lt;&lt;"name\\_s"&gt;&gt;,&lt;&lt;"my test name"&gt;&gt;},
&gt;&gt; {&lt;&lt;"age\\_i"&gt;&gt;,&lt;&lt;"2"&gt;&gt;}]}],
&gt;&gt; 1.0073696374893188,1}}
&gt;&gt;
&gt;&gt;
&gt;&gt; But how can I search for a partial name with spaces:
&gt;&gt; 523&gt;
&gt;&gt; 523&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"test\\_index"&gt;&gt;, &lt;&lt;"name\\_s:\\"\\*y test
&gt;&gt; na\\*\\" AND age\\_i:2"&gt;&gt;, []).
&gt;&gt; {ok,{search\\_results,[],0.0,0}}
&gt;&gt; 524&gt;
&gt;&gt; 524&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I get the feeling that I'm missing something really obvious but can't see
&gt;&gt; it. Any more pointers appreciated!
&gt;&gt;
&gt;&gt; //Sean.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Sep 7, 2016 at 10:11 AM, sean mcevoy 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Jason,
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for the kick, I just needed to look closer!
&gt;&gt;&gt; Yes, had tried escaping but one of my utility functions for dynamically
&gt;&gt;&gt; building the search string had been stripping it out again. D'oh!
&gt;&gt;&gt;
&gt;&gt;&gt; Curiously, just escaping the space doesn't work as in the example in the
&gt;&gt;&gt; stackoverflow post.
&gt;&gt;&gt; Putting the search term in an inner string and escaping its quotes both
&gt;&gt;&gt; feels more natural and does work so I'm going with something more like:
&gt;&gt;&gt;
&gt;&gt;&gt; 409&gt;
&gt;&gt;&gt; 409&gt;
&gt;&gt;&gt; 409&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"test\\_index"&gt;&gt;, &lt;&lt;"name\\_s:\\"we rt\\"
&gt;&gt;&gt; AND age\\_i:0"&gt;&gt;, []).
&gt;&gt;&gt; {ok,{search\\_results,[],0.0,0}}
&gt;&gt;&gt; 410&gt;
&gt;&gt;&gt; 410&gt;
&gt;&gt;&gt; 410&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"test\\_index"&gt;&gt;, &lt;&lt;"name\\_s:we\\ rt AND
&gt;&gt;&gt; age\\_i:0"&gt;&gt;, []).
&gt;&gt;&gt; {error,&lt;&lt;"Query unsuccessful check the logs."&gt;&gt;}
&gt;&gt;&gt; 411&gt;
&gt;&gt;&gt; 411&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers,
&gt;&gt;&gt; //Sean.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Sep 6, 2016 at 2:48 PM, Jason Voegele 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Sean,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Have you tried escaping the space in your query?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://stackoverflow.com/questions/10023133/solr-wildcard-qu
&gt;&gt;&gt;&gt; ery-with-whitespace
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Sep 5, 2016, at 6:24 PM, sean mcevoy  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi List,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; We have a solr index where we store something like:
&gt;&gt;&gt;&gt; &lt;&lt;"{\\"key\\_s\\":\\"ID\\",\\"body\\_s\\":\\"some test string\\"}"&gt;&gt;}],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Then we try to do a riakc\\_pb\\_socket:search with the pattern:
&gt;&gt;&gt;&gt; &lt;&lt;"body\\_s:\\*test str\\*"&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The request will fail with an error message telling us to check the
&gt;&gt;&gt;&gt; logs and in there we find:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2016-09-05 13:37:29.271 [error] &lt;0.12067.10&gt;@yz\\_pb\\_search:maybe\\_process:107
&gt;&gt;&gt;&gt; {solr\\_error,{400,"http://localhost:10014/internal\\_solr/crm\\_d
&gt;&gt;&gt;&gt; b.campaign\\_index/select",&lt;&lt;"{\\"error\\":{\\"msg\\":\\"no field name
&gt;&gt;&gt;&gt; specified in query and no default specified via 'df'
&gt;&gt;&gt;&gt; param\\",\\"code\\":400}}\\n"&gt;&gt;}} [{yz\\_solr,search,3,[{file,"src
&gt;&gt;&gt;&gt; /yz\\_solr.erl"},{line,284}]},{yz\\_pb\\_search,maybe\\_process,3,[{
&gt;&gt;&gt;&gt; file,"src/yz\\_pb\\_search.erl"},{line,78}]},{riak\\_api\\_pb\\_server
&gt;&gt;&gt;&gt; ,process\\_message,4,[{file,"src/riak\\_api\\_pb\\_server.erl"},{lin
&gt;&gt;&gt;&gt; e,388}]},{riak\\_api\\_pb\\_server,connected,2,[{file,"src/riak\\_
&gt;&gt;&gt;&gt; api\\_pb\\_server.erl"},{line,226}]},{riak\\_api\\_pb\\_server,decode\\_
&gt;&gt;&gt;&gt; buffer,2,[{file,"src/riak\\_api\\_pb\\_server.erl"},{line,364}]},{
&gt;&gt;&gt;&gt; gen\\_fsm,handle\\_msg,7,[{file,"gen\\_fsm.erl"},{line,505}]},{
&gt;&gt;&gt;&gt; proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,239}]}]
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Through experiment I've figured out that it doesn't like the space as
&gt;&gt;&gt;&gt; it seems to think the part of the search string after that space is a new
&gt;&gt;&gt;&gt; key to search for. Which seems fair enough.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Anyone know of a work-around? Or am I formatting my request incorrectly?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks in advance.
&gt;&gt;&gt;&gt; //Sean.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt; --
&gt;
&gt;
&gt; Alexander Sicular
&gt; Solutions Architect
&gt; Basho Technologies
&gt; 9175130679
&gt; @siculars
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

