---
title: "Re: Question about link-walk results returned by erlang_pb_client"
description: ""
project: community
lastmod: 2014-03-14T09:33:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13809"
mailinglist_parent_id: "msg13806"
author_name: "Alex Moore"
project_section: "mailinglistitem"
sent_date: 2014-03-14T09:33:14-07:00
---


Hi fxmy,

&gt; The return value is just Bucket/Key/link-tag pairs, without ObjectValue or 
&gt; other metadata.
&gt; {ok,[{0,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"timoreilly"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]},
&gt; {1,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"dhh"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]}]}
&gt; 
&gt; Is this intended or not?

This is intended. You are running a map reduce job with one “link” stage, 
which does the link walking for you. 
Link stages only return a list of key/value/relation tuples.

&gt; If so, what's the best way to get these ObjectValues through one single pass 
&gt; of link-walking?

If you want to grab everything in one shot you would have to feed the link 
stage’s output into a map stage to grab the actual objects:

{ok, RiakObj} = riakc\\_pb\\_socket:mapred(Pid,[{&lt;&lt;"people"&gt;&gt;, &lt;&lt;"timoreilly"&gt;&gt;}],
 [{link, &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;, false},
 {link, &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;, false}, 
 {map, {modfun, riak\\_kv\\_mapreduce, map\\_identity}, none, true}]).

This should give you the entire object for the results of the last link phase, 
namely Dave Thomas’s.

I should warn you thought that while link walking and map reduce let you do 
things like this in one shot, you should be cautious about using them in 
production since a bad query can kill performance. 

Thanks,
Alex

On Mar 14, 2014, at 6:49 AM, fxmy wang  wrote:

&gt; 
&gt; Hi, list,
&gt; 
&gt; This should be a trivial question and I think I'm definitely missing 
&gt; something( and feeling stupid :\\).
&gt; 
&gt; So when I am doing a chained link-walking through HTTP interface like 
&gt; this(copied from link walking docs):
&gt; curl -v localhost:8091/riak/people/davethomas/\\_,friend,1/\\_,friend,\\_/
&gt; 
&gt; The output is quite verbose, including Bucket/Key/Value etc.etc.
&gt; --JCgqdOHsL4BdXPCb0cuQDnLTxOH
&gt; Content-Type: multipart/mixed; boundary=LpfqXc9urbAJJNFH7aGGPBiAtnX
&gt; 
&gt; --LpfqXc9urbAJJNFH7aGGPBiAtnX
&gt; X-Riak-Vclock: a85hYGBgzGDKBVIcc+04TgWFOj/NYEpkzGNlyNCadoYvCwA=
&gt; Location: /riak/people/timoreilly
&gt; Content-Type: text/plain
&gt; Link: ; riaktag="friend", ; rel="up"
&gt; Etag: 3DmGNeyDj2hUlLR2UhJvMr
&gt; Last-Modified: Thu, 13 Mar 2014 13:11:04 GMT
&gt; 
&gt; I am an excellent public speaker.
&gt; --LpfqXc9urbAJJNFH7aGGPBiAtnX--
&gt; 
&gt; --JCgqdOHsL4BdXPCb0cuQDnLTxOH
&gt; Content-Type: multipart/mixed; boundary=IcBLyeIFObvJlJGyXuhTty5cRSs
&gt; 
&gt; --IcBLyeIFObvJlJGyXuhTty5cRSs
&gt; X-Riak-Vclock: a85hYGBgzGDKBVIcR4M2cgeFOkdkMCUy5rEyzNSadoYvCwA=
&gt; Location: /riak/people/dhh
&gt; Content-Type: text/plain
&gt; Link: ; rel="up"
&gt; Etag: 4qbA2ZufXNgzFRb8PlSLUO
&gt; Last-Modified: Thu, 13 Mar 2014 13:11:53 GMT
&gt; 
&gt; I drive a Zonda.
&gt; --IcBLyeIFObvJlJGyXuhTty5cRSs--
&gt; 
&gt; --JCgqdOHsL4BdXPCb0cuQDnLTxOH--
&gt; 
&gt; 
&gt; But when I retried it through the erlang\\_pb\\_client
&gt; riakc\\_pb\\_socket:mapred(Pid,[{&lt;&lt;"people"&gt;&gt;, &lt;&lt;"davethomas"&gt;&gt;}],[{link, 
&gt; &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;, true},{link, &lt;&lt;"people"&gt;&gt;, &lt;&lt;"friend"&gt;&gt;, true}]).
&gt; 
&gt; The return value is just Bucket/Key/link-tag pairs, without ObjectValue or 
&gt; other metadata.
&gt; {ok,[{0,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"timoreilly"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]},
&gt; {1,[[&lt;&lt;"people"&gt;&gt;,&lt;&lt;"dhh"&gt;&gt;,&lt;&lt;"friend"&gt;&gt;]]}]}
&gt; 
&gt; Is this intended or not?
&gt; If so, what's the best way to get these ObjectValues through one single pass 
&gt; of link-walking?
&gt; 
&gt; 
&gt; Cheers,
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

