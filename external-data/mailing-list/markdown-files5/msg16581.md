---
title: "Yokozuna indexes too slow"
description: ""
project: community
lastmod: 2015-09-30T23:20:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16581"
author_name: "ilyas"
project_section: "mailinglistitem"
sent_date: 2015-09-30T23:20:08-07:00
---




Hello to the Riak community!
I have a cluster of 5 nodes (hardware servers with SSDs, 8 CPU cores, 
16GB of RAM, most of it is free). When I store data to the database (up 
to 1 000 000 keys) without indexes, everything happens very quickly. If 
I create an index for yokozuna and do the same, the store rate decreases 
greatly (200 times). The process yokozuna takes up 100% of the time one 
core of CPU, other cores are not loaded. Keys are short strings (16 
symbols), values are json strings (length is about 200 characters).

How can I find out the reason of such performance and fix it?

\\*creation of bucket:\\*

#!/bin/bash

RIAK\\_HOST="127.0.0.1:8098"

#define search scheme
curl -XPUT $RIAK\\_HOST/search/schema/dbsearch -H 
'Content-Type:application/xml' --data-binary @dbSchema.xml


# create search index for scheme
curl -XPUT $RIAK\\_HOST/search/index/user\\_idx\\_bin -H 'Content-Type: 
application/json' -d '{"schema":"dbsearch"}'


# create bucket type for leleldb backend
sudo /usr/sbin/riak-admin bucket-type create leveldb 
'{"props":{"backend":"leveldb\\_mult"}}'

sudo /usr/sbin/riak-admin bucket-type activate leveldb

#create buckets with known backends and indexes
curl -XPUT $RIAK\\_HOST/types/leveldb/buckets/SomeBucket/props -H 
'Content-Type: application/json' -d 
'{"props":{"search\\_index":"user\\_idx\\_bin"}}'


\\*index scheme:\\*

xml version="1.0" encoding="UTF-8" ?


























\\_yz\\_id

xml version="1.0" encoding="UTF-8" ?


























\\_yz\\_id




make\\_db\\_idx.sh
Description: application/shellscript
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

