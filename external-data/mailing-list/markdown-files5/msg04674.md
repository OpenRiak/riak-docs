---
title: "Re: Misbehaving bucket"
description: ""
project: community
lastmod: 2011-09-12T11:23:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04674"
mailinglist_parent_id: "msg04673"
author_name: "Jeremy Raymond"
project_section: "mailinglistitem"
sent_date: 2011-09-12T11:23:16-07:00
---


I did riakc\\_pb\\_socket:list\\_keys/2 which completes quickly, then fetched each
object individually by the key using riakc\\_pb\\_socket:get/3 which was slow.

The bucket uses the default settings (see below), allow\\_mult=false, using a
single bitcask backend.

I came across this problem because one of the Riak nodes was reporting via
Nagios to be short of disk space. Investigating I found that
/var/lib/riak/bitcask was taking up about 24GB of disk. This much disk usage
was crazy big, since there's probably less than 100MB of data I'm storing in
Riak. Since my original email I've deleted all item in the misbehaving
bucket (it took several tries as the read slowness/CPU usage
also appeared on delete operations). The bitcask folder is now 44MB in size
(down from 24GB!). I've repopulated the data in the bucket now storing 157
items. Things seem to be back to normal for this bucket.

Perhaps I inadvertently pushed something large into the bucket, but each of
the items I put in there was only about 3K in size - this doesn't seem
likely to me.


Bucket Properties:
{"props":{"name":"suite\\_diff","n\\_val":3,"allow\\_mult":false,"last\\_write\\_wins":false,"precommit":[],"postcommit":[],"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"old\\_vclock":86400,"young\\_vclock":20,"big\\_vclock":50,"small\\_vclock":10,"r":"quorum","w":"quorum","dw":"quorum","rw":"quorum"}}

- Jeremy


On Mon, Sep 12, 2011 at 1:43 PM, Daniel Reverri  wrote:

&gt; Hi Jeremy
&gt;
&gt; Are you doing a full bucket query or retrieving individual objects?
&gt;
&gt; Is your bucket configured to allow siblings (allow\\_mult=true)? Do the
&gt; objects being retrieved have many siblings?
&gt;
&gt; Are you using multiple backends?
&gt;
&gt; Thanks
&gt; Dan
&gt;
&gt; Sent from my iPhone
&gt;
&gt; On Sep 12, 2011, at 10:13 AM, Jeremy Raymond  wrote:
&gt;
&gt; &gt; Hello,
&gt; &gt;
&gt; &gt; I have a bucket with about 70 items in it the Keys look like this
&gt; &lt;&lt;"1294549200\\_UbEu1topckAFu2UYy3spr8AG5lc"&gt;&gt; and the values are about 2.8K
&gt; of JSON. For some reason operations on data in this bucket are extremely
&gt; slow. It takes between 5 - 10 seconds to read a value of of the bucket by
&gt; it's key using the Erlang protobuf client. When I do the reads the CPU of
&gt; the node I'm connecting to spikes using up 100% usage on the Riak beam
&gt; process.
&gt; &gt;
&gt; &gt; I can read data out of any of the other 9 buckets in the system some of
&gt; which have a lot more items in them (one as &gt; 16k items) and the operations
&gt; are super fast.
&gt; &gt;
&gt; &gt; There are no errors in the sasl-error.log files and everything looks
&gt; normal in the erlang.log files. Any ideas on what may cause a bucket to
&gt; churn like this?
&gt; &gt;
&gt; &gt; - Jeremy
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

