---
title: "Re: Do nodes always need to restart after backend selection?"
description: ""
project: community
lastmod: 2013-04-09T09:22:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10801"
mailinglist_parent_id: "msg10709"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2013-04-09T09:22:07-07:00
---


I'd like to point out that changing backends and n-val on the fly is usually 
Not A Good Idea. Neither of these are things we test, nor advise. In both 
cases, they can leave data that is never deleted or cleaned up. Unless you have 
a really good reason for doing this, I'd strongly advise against it.

Reid

On Apr 4, 2013, at 10:42 PM, Toby Corkindale 
 wrote:

&gt; Answering my own question again, but hopefully that saves you time.
&gt; 
&gt; So, it appears that if a backend is changed via the JSON REST API, then all 
&gt; keys from the previous backend are now inaccessible. I think this also 
&gt; indicates that now the new backend is in use immediately, without any 
&gt; restarts required.
&gt; 
&gt; May I suggest that the wording on the API Reference page is improved? Both I 
&gt; and a colleague misunderstood it to mean that \\*any\\* change of backend 
&gt; required a restart.
&gt; 
&gt; Cheers,
&gt; Toby
&gt; 
&gt; On 05/04/13 11:27, Toby Corkindale wrote:
&gt;&gt; Hi Jared,
&gt;&gt; 
&gt;&gt; I'm afraid I am still a little confused after reading your reply, so I'd
&gt;&gt; like to check something.
&gt;&gt; 
&gt;&gt; If I understand correctly, the reboot of nodes is only required if the
&gt;&gt; default settings in app.config are changed, and one can change anything
&gt;&gt; else on-the-fly?
&gt;&gt; 
&gt;&gt; So therefore, in the following scenario, I could issue these commands
&gt;&gt; and never need to reboot any nodes?
&gt;&gt; 
&gt;&gt; Riak backend = Multi, with Bitcask (default) and Leveldb.
&gt;&gt; 
&gt;&gt; PUT /buckets/myBucket/myKey
&gt;&gt; # Key is stored in Bitcask
&gt;&gt; 
&gt;&gt; PUT /buckets/myNewBucket/props
&gt;&gt; { backend: Leveldb }
&gt;&gt; 
&gt;&gt; PUT /buckets/myBucket/myOtherKey
&gt;&gt; # Key is stored in Leveldb backend
&gt;&gt; 
&gt;&gt; 
&gt;&gt; If I change the backend, do I lose any keys that were previously
&gt;&gt; available in the original backend or are they migrated? (I'd expect to
&gt;&gt; lose them)
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thanks for your patience,
&gt;&gt; Toby
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On 05/04/13 00:51, Jared Morrow wrote:
&gt;&gt;&gt; Toby,
&gt;&gt;&gt; 
&gt;&gt;&gt; That particular page is talking about changing the default settings of
&gt;&gt;&gt; the backend of a bucket. In that specific case, if you want to change
&gt;&gt;&gt; the default behavior in your app.config file a restart is necessary.
&gt;&gt;&gt; One particularly important detail there is you don't need to restart
&gt;&gt;&gt; \\*all\\* nodes at the same time. Restarting one node at a time is
&gt;&gt;&gt; sufficient and recommended so you don't have any cluster downtime.
&gt;&gt;&gt; 
&gt;&gt;&gt; For setting common bucket properties, you do not need to restart the
&gt;&gt;&gt; node. If you want to change the n\\_val of a bucket for instance, you can
&gt;&gt;&gt; just change it from your client on all nodes. That page explains at the
&gt;&gt;&gt; bottom how to set them on the erlang console or curl, but most people
&gt;&gt;&gt; use their chosen client to set bucket properties before writing values.
&gt;&gt;&gt; Here is an example using the Java Client
&gt;&gt;&gt; http://docs.basho.com/java/latest/cookbooks/buckets/. In general it
&gt;&gt;&gt; doesn't matter if your client supports HTTP or protocol buffers, both
&gt;&gt;&gt; API's support bucket
&gt;&gt;&gt; property changes.
&gt;&gt;&gt; 
&gt;&gt;&gt; Hope that helps,
&gt;&gt;&gt; Jared
&gt;&gt;&gt; 
&gt;&gt;&gt; On Wed, Apr 3, 2013 at 10:14 PM, Toby Corkindale
&gt;&gt;&gt; &gt;&gt; &gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Hi,
&gt;&gt;&gt; According to the docs at the following URL, it is necessary to
&gt;&gt;&gt; reboot all Riak nodes after setting the bucket property for backend.
&gt;&gt;&gt; This seems really drastic, and we'd like to avoid having to do this!
&gt;&gt;&gt; See:
&gt;&gt;&gt; 
&gt;&gt;&gt; http://docs.basho.com/riak/1.\\_\\_3.0/tutorials/choosing-a-\\_\\_backend/Multi/
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; I wondered if the restart of the whole cluster can be avoided?
&gt;&gt;&gt; Perhaps we could set the bucket properties prior to setting any keys
&gt;&gt;&gt; within it?
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

