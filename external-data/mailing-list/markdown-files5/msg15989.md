---
title: "Re: Riak Search 2.0 & Tagging"
description: ""
project: community
lastmod: 2015-04-07T10:30:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15989"
mailinglist_parent_id: "msg15958"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-04-07T10:30:14-07:00
---


Hello Antonio,

Firstly, please always reply to the list and not via personal email.

In regards to your question, I wrote a test that showcases how to write objects 
with tags in pb for search: 
https://github.com/basho/yokozuna/pull/479/files#diff-f9f0e102b2a5208f41b2f304ada0ee5cR306
 
.
 It’s a bit of a workaround, needing the ‘x-riak-meta\\*’, which gets stripped in 
preparation for query, but it does work.

Please make sure you’ve also created an index and associated it with a 
bucket\\_type/bucket, i.e. 
http://docs.basho.com/riak/latest/dev/using/search/#Simple-Setup 
. To query, 
it’d be the same as in the docs (field:\\*query\\*): 
http://docs.basho.com/riak/latest/dev/using/search/#Querying 
.

Thanks.

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\\_we\\_love | paperswelove.org
twitter =&gt; @zeeshanlakhani

&gt; On Apr 7, 2015, at 4:28 AM, Antonio Teixeira  wrote:
&gt; 
&gt; Hi ,
&gt; 
&gt; I've been experimenting with with Riak Search and Tags but I've reached a 
&gt; dead-end. I can't find any documentation on Querying Tags, I have followed 
&gt; your example at: 
&gt; https://github.com/basho/riak-erlang-client/blob/7487c90275c88dbe8ef4c2fed6540864364ca3d4/src/riakc\\_...
&gt; 
&gt; 
&gt; Here is my Code:
&gt; 
&gt; O0 = riakc\\_obj:new(&lt;&lt;"test"&gt;&gt;, &lt;&lt;"key0"&gt;&gt;, &lt;&lt;"value0"&gt;&gt;),
&gt; MD0 = riakc\\_obj:get\\_update\\_metadata(O0),
&gt; MD1 = riakc\\_obj:set\\_user\\_metadata\\_entry(MD0, {&lt;&lt;"ola\\_s"&gt;&gt;,&lt;&lt;"nuno"&gt;&gt;}),
&gt; O1 = riakc\\_obj:update\\_metadata(O0, MD1),
&gt; ok = riakc\\_pb\\_socket:put(Pid, O1).
&gt; 
&gt; My question is, how do I query this data without knowing the Key of the 
&gt; Object.
&gt; 
&gt; Regards
&gt; Antonio
&gt; 
&gt; 2015-04-02 16:10 GMT+01:00 Zeeshan Lakhani  &gt;:
&gt; Hello Antonio, 
&gt; 
&gt; You can insert an object and tag in the same operation, and you can query on 
&gt; that tag via Riak Search.
&gt; 
&gt; Before writing the object, just apply/set the metadata accordingly. Here’s an 
&gt; example in the Erlang client: 
&gt; https://github.com/basho/riak-erlang-client/blob/7487c90275c88dbe8ef4c2fed6540864364ca3d4/src/riakc\\_pb\\_socket.erl#L3348
&gt; 
&gt; .
&gt; 
&gt; 
&gt; Also, this can be done via http: 
&gt; https://github.com/basho/yokozuna/blob/5868266b11f131d14c85495e50f899f3fe8158ba/riak\\_test/yokozuna\\_essential.erl#L281
&gt; 
&gt; .
&gt; 
&gt; Thanks.
&gt; 
&gt; Zeeshan Lakhani
&gt; programmer | 
&gt; software engineer at @basho | 
&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org 
&gt; 
&gt; twitter =&gt; @zeeshanlakhani
&gt; 
&gt;&gt; On Apr 2, 2015, at 5:24 AM, Antonio Teixeira &gt; &gt; wrote:
&gt;&gt; 
&gt;&gt; I've been using Riak as my main database for a few months, now I've been 
&gt;&gt; experimenting with Riak Search 2.0 and for what I read in your documentation 
&gt;&gt; there is no way to insert a object and tag it in the same operation.
&gt;&gt; Right now we have an opaque object and we query them through secondary 
&gt;&gt; indexes, this is becoming unbearable.
&gt;&gt; What we need is to store an object and 
&gt;&gt; tag(https://github.com/basho/yokozuna/blob/develop/docs/TAGGING.md 
&gt;&gt; ) it all in 
&gt;&gt; one step.
&gt;&gt; Our objects consist of erlang dictionaries and it would be a bit expensive 
&gt;&gt; (performance wise) to convert the Dictionary to a list and then to json in 
&gt;&gt; every database related operation.
&gt;&gt; We are using Riak 2.0.5, Erlang 17.0 and the PB Driver.
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

