---
title: "Re: No more disk space on a node of my Riak cluster"
description: ""
project: community
lastmod: 2013-03-21T12:24:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10546"
author_name: "Godefroy de Compreignac"
project_section: "mailinglistitem"
sent_date: 2013-03-21T12:24:16-07:00
---


Ok thanks Evan.
I didn't post them before on this thread because I thought it was just
"info", but I have \\*a lot\\* of messages like these:

2013-03-21 20:13:23.945 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.29558.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
2013-03-21 20:13:26.295 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.29046.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.21529382&gt;,'riak@5.39.74.57'}
2013-03-21 20:13:27.807 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.29046.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{erlang,crc32,2}},{message\\_queue\\_len,0}]
{#Port&lt;0.21529382&gt;,'riak@5.39.74.57'}
2013-03-21 20:13:27.843 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.21168.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.6629407&gt;,'riak@5.39.74.55'}
2013-03-21 20:13:30.626 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.29558.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.6629407&gt;,'riak@5.39.74.55'}
2013-03-21 20:13:30.771 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.24361.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
2013-03-21 20:13:34.447 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.29558.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
2013-03-21 20:13:36.210 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.6726.946&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
2013-03-21 20:13:36.501 [info]
&lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
busy\\_dist\\_port &lt;0.32186.176&gt;
[{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
{#Port&lt;0.6629407&gt;,'riak@5.39.74.55'}

I guess I have a problem with my network config...

I precise that the servers hosting my Riak cluster are also running
Couchebase, Nginx and Elasticsearch, so a lot of trafic and connections.
/proc/sys/net/netfilter/nf\\_conntrack\\_count = 30-100K



-- 
Godefroy de Compreignac

Eklaweb CEO - www.eklaweb.com
EklaBlog CEO - www.eklablog.com

+33(0)6 11 89 13 84
http://www.linkedin.com/in/godefroy
http://twitter.com/Godefroy


2013/3/21 Evan Vigil-McClanahan 

&gt; It could be a large number of things, unfortunately. To go through
&gt; them all it somewhat outside of my skill set. Maybe someone more
&gt; network savvy can provide some pointers?
&gt;
&gt; Perhaps checking with your network admin, or turning any software
&gt; firewalls on your nodes completely off, as a test?
&gt;
&gt; On Thu, Mar 21, 2013 at 11:44 AM, Godefroy de Compreignac
&gt;  wrote:
&gt; &gt; But I don't understand what could stop transfers. Maybe a kernel setting?
&gt; &gt; How could I find out?
&gt; &gt;
&gt; &gt; --
&gt; &gt; Godefroy de Compreignac
&gt; &gt;
&gt; &gt; Eklaweb CEO - www.eklaweb.com
&gt; &gt; EklaBlog CEO - www.eklablog.com
&gt; &gt;
&gt; &gt; +33(0)6 11 89 13 84
&gt; &gt; http://www.linkedin.com/in/godefroy
&gt; &gt; http://twitter.com/Godefroy
&gt; &gt;
&gt; &gt;
&gt; &gt; 2013/3/21 Evan Vigil-McClanahan 
&gt; &gt;&gt;
&gt; &gt;&gt; Handoff is done by default on port 8099.
&gt; &gt;&gt;
&gt; &gt;&gt; I guess what I am getting at here is that this doesn't look like an
&gt; &gt;&gt; obvious riak problem, it's more likely that something on your network
&gt; &gt;&gt; or on your nodes is closing or interrupting those sockets; you'd most
&gt; &gt;&gt; likely get a different error if something internal to riak was causing
&gt; &gt;&gt; the transfers to fail.
&gt; &gt;&gt;
&gt; &gt;&gt; On Thu, Mar 21, 2013 at 10:09 AM, Godefroy de Compreignac
&gt; &gt;&gt;  wrote:
&gt; &gt;&gt; &gt; The only limitation that I'd see is Haproy which have a time limit:
&gt; &gt;&gt; &gt; contimeout 5000
&gt; &gt;&gt; &gt; clitimeout 50000
&gt; &gt;&gt; &gt; srvtimeout 3600000
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; But Haproxy serves Riak on port 8098 and I configured Riak to use port
&gt; &gt;&gt; &gt; 8097:
&gt; &gt;&gt; &gt; {pb\\_port, 8087 }
&gt; &gt;&gt; &gt; {http, [ {"5.39.68.152", 8097 } ]}
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; So I guess Riak use only port 8097 internally, without any limitation.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; And by checking logs, I see that a vnode transfer fails after a random
&gt; &gt;&gt; &gt; duration, sometimes a few minutes.
&gt; &gt;
&gt; &gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

