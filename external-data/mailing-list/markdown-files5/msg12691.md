---
title: "Re: Riak consumes too much memory"
description: ""
project: community
lastmod: 2013-10-18T10:50:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12691"
mailinglist_parent_id: "msg12689"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2013-10-18T10:50:02-07:00
---


Dave,

flexcache will be a new feature in Riak 2.0. There are some subscribers to 
this mailing list that like to download and try things early. I was directing 
those subscribers to the GitHub branch that contains the work-in-progress code.

flexcache is a new method for sizing / accounting the memory used by leveldb. 
It replaces the current method completely. flexcache is therefore not an 
option, but an upgrade to the existing logic.

Again, the detailed discussion is here: 
ttps://github.com/basho/leveldb/wiki/mv-flexcache

Matthew


On Oct 18, 2013, at 12:33 PM, Dave Martorana  wrote:

&gt; Matthew,
&gt; 
&gt; For we who don't quite understand, can you explain - does this mean 
&gt; mv-flexcache is a feature that just comes with 2.0, or is it something that 
&gt; will need to be turned on, etc?
&gt; 
&gt; Thanks!
&gt; 
&gt; Dave
&gt; 
&gt; 
&gt; On Thu, Oct 17, 2013 at 9:45 PM, Matthew Von-Maszewski  
&gt; wrote:
&gt; It is already in test and available for your download now:
&gt; 
&gt; https://github.com/basho/leveldb/tree/mv-flexcache
&gt; 
&gt; Discussion is here:
&gt; 
&gt; https://github.com/basho/leveldb/wiki/mv-flexcache
&gt; 
&gt; This code is slated for Riak 2.0. Enjoy!!
&gt; 
&gt; Matthew
&gt; 
&gt; On Oct 17, 2013, at 20:50, darren  wrote:
&gt; 
&gt;&gt; But why isn't riak smart enough to adjust itself to the available memory or 
&gt;&gt; lack thereof?
&gt;&gt; 
&gt;&gt; No serious enterprise technology should just consume everything and crash.
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Sent from my Verizon Wireless 4G LTE Smartphone
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -------- Original message --------
&gt;&gt; From: Matthew Von-Maszewski  
&gt;&gt; Date: 10/17/2013 8:38 PM (GMT-05:00) 
&gt;&gt; To: ZhouJianhua  
&gt;&gt; Cc: riak-users@lists.basho.com 
&gt;&gt; Subject: Re: Riak consumes too much memory 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Greetings,
&gt;&gt; 
&gt;&gt; The default config targets 5 servers and 16 to 32G of RAM. Yes, the 
&gt;&gt; app.config needs some adjustment to achieve happiness for you:
&gt;&gt; 
&gt;&gt; - change ring\\_creation\\_size from 64 to 16 (remove the % from the beginning 
&gt;&gt; of the line)
&gt;&gt; - add this line before "{data\\_root, }" in eleveldb section: 
&gt;&gt; "{max\\_open\\_files, 40}," (be sure the comma is at the end of this line).
&gt;&gt; 
&gt;&gt; Good luck,
&gt;&gt; Matthew
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Oct 17, 2013, at 8:23 PM, ZhouJianhua  wrote:
&gt;&gt; 
&gt;&gt;&gt; Hi
&gt;&gt;&gt; 
&gt;&gt;&gt; I installed riak v1.4.2 on ubuntu12.04(64bit, 4G RAM) with apt-get, run it 
&gt;&gt;&gt; with default app.conf but change the backend to leveldb, and test it with 
&gt;&gt;&gt; https://github.com/tpjg/goriakpbc . 
&gt;&gt;&gt; 
&gt;&gt;&gt; Just keep putting (key, value) to an bucket, the memory always increasing, 
&gt;&gt;&gt; and in the end it crashed, as it cannot allocate memory. 
&gt;&gt;&gt; 
&gt;&gt;&gt; Should i change the configuration or other?
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

