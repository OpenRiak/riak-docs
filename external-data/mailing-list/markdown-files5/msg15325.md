---
title: "Re: Riak Nodes Crashing"
description: ""
project: community
lastmod: 2014-12-05T10:08:33-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15325"
mailinglist_parent_id: "msg15324"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2014-12-05T10:08:33-08:00
---


Satish,

I find nothing compelling in the log or the app.config. Therefore I have two 
additional suggestions/requests:

- lower max\\_open\\_files in app.config to to 150 from 315. There was one other 
customer report regarding the limit not properly stopping out of memory (OOM) 
conditions.

- try to locate a /var/log/syslog\\* file from a node that contains the time of 
the crash. There may be helpful information there. Please send that along.


Unrelated to this crash … 1.4.7 has a known bug in its active anti-entropy 
(AAE) logic. This bug is NOT known to cause a crash. The bug does cause AAE 
to be unreliable for data restoration. The proper steps for upgrading to the 
current release (1.4.12) are:

-- across the entire cluster
- disable anti\\_entropy in app.config on all nodes: {anti\\_entropy, {off, []}}
- perform a rolling restart of all nodes … AAE is now disabled in the cluster 

-- on each node
- stop the node
- remove (erase all files and directories) /vol/lib/riak/anti\\_entropy
- update Riak to the new software revision
- start the node again

-- across the entire cluster
- enable anti\\_entropy in app.config on all nodes: {anti\\_entropy, {on, []}}
- perform a rolling restart of all nodes … AAE is now enabled in the cluster 

The nodes will start rebuilding the AAE hash data. Suggest you perform the 
last rolling restart during a low utilization time of your cluster.


Matthew


On Dec 5, 2014, at 11:02 AM, ender  wrote:

&gt; Hi Matthew,
&gt; 
&gt; Riak version: 1.4.7
&gt; 5 Nodes in cluster
&gt; RAM: 30GB
&gt; 
&gt; The leveldb logs are attached.
&gt; 
&gt; 
&gt; 
&gt; On Thu, Dec 4, 2014 at 1:34 PM, Matthew Von-Maszewski  
&gt; wrote:
&gt; Satish,
&gt; 
&gt; Some questions:
&gt; 
&gt; - what version of Riak are you running? logs suggest 1.4.7
&gt; - how many nodes in your cluster?
&gt; - what is the physical memory (RAM size) of each node?
&gt; - would you send the leveldb LOG files from one of the crashed servers:
&gt; tar -czf satish\\_LOG.tgz /vol/lib/riak/leveldb/\\*/LOG\\*
&gt; 
&gt; 
&gt; Matthew
&gt; 
&gt; On Dec 4, 2014, at 4:02 PM, ender  wrote:
&gt; 
&gt; &gt; My RIak installation has been running successfully for about a year. This 
&gt; &gt; week nodes suddenly started randomly crashing. The machines have plenty of 
&gt; &gt; memory and free disk space, and looking in the ring directory nothing 
&gt; &gt; appears to amiss:
&gt; &gt;
&gt; &gt; [ec2-user@ip-10-196-72-247 ~]$ ls -l /vol/lib/riak/ring
&gt; &gt; total 80
&gt; &gt; -rw-rw-r-- 1 riak riak 17829 Nov 29 19:42 
&gt; &gt; riak\\_core\\_ring.default.20141129194225
&gt; &gt; -rw-rw-r-- 1 riak riak 17829 Dec 3 19:07 
&gt; &gt; riak\\_core\\_ring.default.20141203190748
&gt; &gt; -rw-rw-r-- 1 riak riak 17829 Dec 4 16:29 
&gt; &gt; riak\\_core\\_ring.default.20141204162956
&gt; &gt; -rw-rw-r-- 1 riak riak 17847 Dec 4 20:45 
&gt; &gt; riak\\_core\\_ring.default.20141204204548
&gt; &gt;
&gt; &gt; [ec2-user@ip-10-196-72-247 ~]$ du -h /vol/lib/riak/ring
&gt; &gt; 84K /vol/lib/riak/ring
&gt; &gt;
&gt; &gt; I have attached a tarball with the app.config file plus all the logs from 
&gt; &gt; the node at the time of the crash. Any help much appreciated!
&gt; &gt;
&gt; &gt; Satish
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

