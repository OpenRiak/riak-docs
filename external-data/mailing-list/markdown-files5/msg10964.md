---
title: "Re: Installing a custom hash function"
description: ""
project: community
lastmod: 2013-04-25T05:26:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10964"
mailinglist_parent_id: "msg10962"
author_name: "Olav Frengstad"
project_section: "mailinglistitem"
sent_date: 2013-04-25T05:26:16-07:00
---


Hey Simon,

The badarg exception means that it can't convert your string to an atom
because the 'sfdc\\_hash' atom is not previously used.
Most likely this is because your .beam file is in the path but not loaded,
meaning list\\_to\\_existing\\_binary/1 will until you load the file in an
alternative way.

I'm not sure how the "{add\\_paths, \\_}" config setting works, but assuming it
just wraps around the code module you can try to attach to the riak console
and run "code:ensure\\_loaded(sfdc\\_hash)." and try to update the bucket props
again.


2013/4/24 Simon Fell 

&gt; I'm following the instructions at
&gt; http://docs.basho.com/riak/1.2.0/cookbooks/Erlang-Named-Functions/ to
&gt; setup a custom hash function, how safe or not is it to assume its the same
&gt; process ?
&gt;
&gt; Currently when i try and PUT the bucket config to specify the new function
&gt; i get back
&gt;
&gt; {error,badarg,
&gt; [{erlang,list\\_to\\_existing\\_atom,["sfdc\\_hash"],[]},
&gt; {riak\\_kv\\_wm\\_props,erlify\\_bucket\\_prop,1,
&gt; [{file,"src/riak\\_kv\\_wm\\_props.erl"},{line,304}]},
&gt; {lists,map,2,[{file,"lists.erl"},{line,1173}]},
&gt; {riak\\_kv\\_wm\\_props,accept\\_bucket\\_body,2,
&gt; [{file,"src/riak\\_kv\\_wm\\_props.erl"},{line,201}]},
&gt; {webmachine\\_resource,resource\\_call,3,
&gt; [{file,"src/webmachine\\_resource.erl"},{line,169}]},
&gt; {webmachine\\_resource,do,3,
&gt; [{file,"src/webmachine\\_resource.erl"},{line,128}]},
&gt; {webmachine\\_decision\\_core,resource\\_call,1,
&gt; [{file,"src/webmachine\\_decision\\_core.erl"},{line,48}]},
&gt; {webmachine\\_decision\\_core,accept\\_helper,0,
&gt;
&gt; My .beam file is in /tmp/riak\\_fun, and i added {add\\_paths,
&gt; ["/tmp/riak\\_fun"]}, to the riak\\_kv section in the app.config, and the .beam
&gt; file is world readable.
&gt;
&gt; I'm running this to set the properties
&gt; curl -v --data-binary @props.json -H Content-Type:application/json
&gt; http://riak1.local:8098/riak/ex -X PUT
&gt;
&gt; props.json contains
&gt; {"props": { "chash\\_keyfun":{"mod":"sfdc\\_hash","fun":"kv\\_hash\\_fun"} } }
&gt;
&gt; Is there a more detailed log somewhere? is there an easy way to see if
&gt; riak can actually load my .beam file?
&gt;
&gt; the source for the module is very straighforward (we just want to hash on
&gt; part of the key)
&gt;
&gt; -module(sfdc\\_hash).
&gt; -export([extract\\_id/1, kv\\_hash\\_fun/1]).
&gt;
&gt; extract\\_id(Key) -&gt;
&gt; case binary:match(Key,&lt;&lt;","&gt;&gt;) of
&gt; {Pos, 1} -&gt; binary:part(Key, 0, Pos);
&gt; \\_ -&gt; Key
&gt; end.
&gt;
&gt; kv\\_hash\\_fun({Bucket,Key}) -&gt;
&gt; chash:key\\_of({Bucket, extract\\_id(Key)}).
&gt;
&gt; This is with riak 1.2.0 on Unbuntu.
&gt;
&gt; Thanks
&gt; Simon
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;



-- 
Med Vennlig Hilsen
Olav Frengstad

Systemutvikler // FWT
+47 920 42 090
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

