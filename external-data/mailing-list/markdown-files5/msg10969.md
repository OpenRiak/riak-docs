---
title: "Re: Getting all the Keys"
description: ""
project: community
lastmod: 2013-04-25T10:21:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10969"
mailinglist_parent_id: "msg10966"
author_name: "Dmitri Zagidulin"
project_section: "mailinglistitem"
sent_date: 2013-04-25T10:21:47-07:00
---


In addition, to reiterate what Alexander said in the email thread above,
keep in mind that doing a 'list keys' on a bucket forces Riak to iterate
through ALL of the keys in a cluster, not just those belonging to a bucket.

Meaning, if your cluster has 100 million keys, but a particular bucket has
only 5 keys, doing a list keys on that bucket will iterate not through 5,
but through all 100 million keys, just to bring you that list of 5.

After Riak version 1.1, when the 'list keys backpressure' feature was
introduced, and given that you use the streaming version of list keys,
iterating through all the keys in a cluster is not completely disastrous.
But it's also not an operation to be done frivolously -- it's reserved for
when there's no other alternative, such as in cases where you have to
perform logical backup of your bucket (extract the whole thing to disk).

You're probably wondering what you should do instead of list keys, to
simulate the SELECT operation you're used to in relational databases.
The answer is - use an index of some sort. (Incidentally, with relational
databases, you're usually using an index, too -- very rare are the cases
where you're doing SELECT \\* on a table with no primary index). This means
one of three things:
1) Use Secondary Indexes to keep track of a subset of keys that you care
about, that you'll want listed.
2) Use Riak Search (which also builds an index of the documents it cares
about), to keep track of a subset of documents you care about.
3) If the subset is small and you know what you're doing, keep track of the
keys yourself -- you can do things like store that list of keys in a json
object and store the list in riak, etc.

Dmitri



On Thu, Apr 25, 2013 at 12:38 PM, n6mac41717  wrote:

&gt; I know it's been over two years since this post, and I'm wondering if the
&gt; latest version of Riak has made improvements to list keys--I tried the
&gt; query
&gt; with "keys=true" and I didn't seem to have TSA/octomom-related wait times.
&gt;
&gt; I was originally hoping that I could get a list of keys via the RESTful API
&gt; which led me to this thread. In other words, a GET url/bucket/key will
&gt; indeed return what I shoved into the bucket at that key, but I was hoping
&gt; that a GET url/bucket (I guess to be truly RESTful, I should make the
&gt; bucket
&gt; plural) would return the keys.
&gt;
&gt; Thoughts?
&gt;
&gt; Thanks in advance, Chuck
&gt;
&gt;
&gt; Alexander Sicular wrote
&gt; &gt; Hi Thomas,
&gt; &gt;
&gt; &gt; This is a topic that has come up many times. Lemme just hit a couple of
&gt; &gt; high notes in no particular order:
&gt; &gt;
&gt; &gt; - If you must do a list keys op on a bucket, you must must must use
&gt; &gt; "?keys=stream". True will block on the coordinating node until all nodes
&gt; &gt; return their keys. Stream will start sending keys as soon as the first
&gt; &gt; node returns.
&gt; &gt;
&gt; &gt; - "list keys" is one of the most expensive native operations you can
&gt; &gt; perform in Riak. Not only does it do a full key scan of all the keys in
&gt; &gt; your bucket, but all the keys in your cluster. It is obnoxiously
&gt; expensive
&gt; &gt; and only more so as the number of keys in your cluster grows. There has
&gt; &gt; been discussions about changing this but everything comes with a cost
&gt; &gt; (more open file descriptors) and I do not believe a decision has been
&gt; made
&gt; &gt; yet.
&gt; &gt;
&gt; &gt; -Riak is in no way a relational system. It is, in fact, about as opposite
&gt; &gt; as you can get. Incidentally, "select \\*" is generally not recommended in
&gt; &gt; the Kingdom of Relations and regarded as wasteful. You need a bit of a
&gt; &gt; mind shift from relational world to have success with nosql in general
&gt; and
&gt; &gt; Riak in particular.
&gt; &gt;
&gt; &gt; -There are no native indices in Riak. By default Riak uses the bitcask
&gt; &gt; backend. Bitcask has many advantages but one disadvantage is that all
&gt; keys
&gt; &gt; (key length + a bit of overhead) must fit in ram.
&gt; &gt;
&gt; &gt; -Do not use "?keys=true". Your computer will melt. And then your face.
&gt; &gt;
&gt; &gt; -As of Riak 0.14 your m/r can filter on key name. I would highly
&gt; recommend
&gt; &gt; that your data architecture take this into account by using keys that
&gt; have
&gt; &gt; meaningful names. This will allow you to not scan every key in your
&gt; &gt; cluster.
&gt; &gt;
&gt; &gt; -Buckets are analogous to relational tables but only just. In Riak, you
&gt; &gt; can think of a bucket as a namespace holder (it is used as part of the
&gt; &gt; default circular hash function) but primarily as a mechanism to
&gt; &gt; differentiate system settings from one group of keys to the next.
&gt; &gt;
&gt; &gt; -There is no penalty for unlimited buckets except for when their settings
&gt; &gt; deviate from the system defaults. By settings I mean things like hooks,
&gt; &gt; replication values and backends among others.
&gt; &gt;
&gt; &gt; -One should list keys by truth if one enjoys sitting in parking lots on
&gt; &gt; the freeway on a scorching summers day or perhaps waiting in a TSA line
&gt; at
&gt; &gt; your nearest international point of embarkation surrounded by octomom
&gt; &gt; families all the while juggling between the grope or the pr0n slideshow.
&gt; &gt; If that is for you, use "?keys=true".
&gt; &gt;
&gt; &gt; -Virtually everything in Riak is transient. Meaning, for the most part
&gt; &gt; (not including the 60 seconds or so of m/r cache), there is no caching
&gt; &gt; going on in Riak outside of the operating system. Ie. your subsequent
&gt; &gt; queries will do more or less the same work as their predecessors. You
&gt; need
&gt; &gt; to cache your own results if you want to reuse them... quickly.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Oh, there's more but I'm pretty jelloed from last night. Welcome to the
&gt; &gt; fold, Thomas. Can I call you Tom?
&gt; &gt;
&gt; &gt; Cheers,
&gt; &gt; -Alexander Sicular
&gt; &gt;
&gt; &gt; @siculars
&gt; &gt;
&gt; &gt; On Jan 22, 2011, at 10:19 AM, Thomas Burdick wrote:
&gt; &gt;
&gt; &gt;&gt; I've been playing around with riak lately as really my first usage of a
&gt; &gt;&gt; distributed key/value store. I quite like many of the concepts and
&gt; &gt;&gt; possibilities of Riak and what it may deliver, however I'm really stuck
&gt; &gt;&gt; on an issue.
&gt; &gt;&gt;
&gt; &gt;&gt; Doing the equivalent of a select \\* from sometable in riak is seemingly
&gt; &gt;&gt; slow. As a quick test I tried...
&gt; &gt;&gt;
&gt; &gt;&gt; http://localhost:8098/riak/mytable?keys=true
&gt; &gt;&gt;
&gt; &gt;&gt; Before even iterating over the keys this was unbearably slow already.
&gt; &gt;&gt; This took almost half a second on my machine where mytable is completely
&gt; &gt;&gt; empty!
&gt; &gt;&gt;
&gt; &gt;&gt; I'm a little baffled, I would assume that getting all the keys of a
&gt; table
&gt; &gt;&gt; is an incredibly common task? How do I get all the keys of a table
&gt; &gt;&gt; quickly? By quickly I mean a few milliseconds or less as I would expect
&gt; &gt;&gt; of even a "slow" rdbms with an empty table, even some tables with 1000's
&gt; &gt;&gt; of items can get all the primary keys of a sql table in a few
&gt; &gt;&gt; milliseconds.
&gt; &gt;&gt;
&gt; &gt;&gt; Tom Burdick
&gt; &gt;&gt;
&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt;
&gt;
&gt; &gt; riak-users@.basho
&gt;
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt;
&gt; &gt; riak-users@.basho
&gt;
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/Getting-all-the-Keys-tp2308764p4027757.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

