---
title: "Re: Secondary indexes or Riak search ?"
description: ""
project: community
lastmod: 2017-02-13T00:36:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17964"
mailinglist_parent_id: "msg17962"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2017-02-13T00:36:07-08:00
---


If you look at the riak-erlang-client here 
https://github.com/basho/riak-erlang-client/blob/develop/src/riakc\\_pb\\_socket.erl#L1129
 there is a client API call that was implemented for CS (riak s2, or whatever 
it is called, the large object store thingy that basho had) that will use the 
$keys index, but in the back end calls fold\\_objects rather than fold\\_keys on 
eleveldb, and so returns the whole object. NOTE: this is equivalent to r=1, you 
don’t get a quorum read here, but a single vnode per-value only. I don’t know 
if other clients added this API, but it would not be hard to add to any client 
that supports 2i. Like I say, originally it was for riakCS, but it’s open 
source and part of the release for 4 years now, so hardly a secret.

Cheers

Russell

On 13 Feb 2017, at 06:18, Alex Feng  wrote:

&gt; Hi Russell,
&gt; 
&gt; In your reply, you mentioned this,
&gt; 
&gt; &gt;&gt; There is also the feature that can return the actual riak objects for a 
&gt; &gt;&gt; $keys index search,
&gt; &gt;&gt;You can pack the index terms with data and return the terms in a query so 
&gt; &gt;&gt;that you don’t need a further object fetch (see &gt;&gt;return\\_terms in docs.)
&gt; 
&gt; If I understood correctly, it is possible to fetch object (value) by 2i in 
&gt; one time. But, we have tried using "return\\_term = true", it returns the index 
&gt; with key comparing only key when not using "return\\_term=true". It doesn't 
&gt; help much with extra index, what we want to achieve is to fetch the object in 
&gt; one time.
&gt; 
&gt; 
&gt; Our use case, client search DB every 10 seconds by 2i, Riak will return a 
&gt; list of around 5000 results(Keys), then client will query DB to fetch value 
&gt; for each key, basically it is around 5000 times, client is easy to run into 
&gt; some issues most of the time. Any suggestion here ? 
&gt; 
&gt; Many thanks in advance.
&gt; 
&gt; Br,
&gt; Alex
&gt; 
&gt; 2017-02-06 19:02 GMT+08:00 Alex Feng :
&gt; Hi Russell,
&gt; 
&gt; It is really helpful, thank you a lot.
&gt; We are suffering from solr crash now, are considering to switch to 2i.
&gt; 
&gt; Br,
&gt; Alex
&gt; 
&gt; 2017-02-06 16:53 GMT+08:00 Russell Brown :
&gt; It’s worth noting that secondary indexes (2i) has some other advantages over 
&gt; solr search. If you \\_can\\_ model your queries in 2i then I'd recommend it.
&gt; 
&gt; Secondary indexes have a richer API than is currently documented, if you 
&gt; look at https://docs.basho.com/riak/1.4.7/dev/using/2i/ you’ll see that 
&gt; documents a feature that allows the index terms to be filtered via reg ex. 
&gt; There is also the feature that can return the actual riak objects for a $keys 
&gt; index search,
&gt; You can pack the index terms with data and return the terms in a query so 
&gt; that you don’t need a further object fetch (see return\\_terms in docs.)
&gt; Secondary indexes are written atomically with the object they index.
&gt; Operationally they don’t require you run a JVM and Solr alongside your riak 
&gt; nodes.
&gt; 
&gt; You have the tools with basho\\_bench to answer the question about performance 
&gt; and overhead for your workload. I suspect for “overhead” 2i wins, as there is 
&gt; no JVM-per-node.
&gt; 
&gt; Modelling for 2i is perhaps harder, in the classical nosql way, you have to 
&gt; do more work upfront when designing your querying.
&gt; 
&gt; I hope that helps a little. I worked quite a lot on 2i and never really 
&gt; understood why riak-search was seen as a replacment, imo they’re 
&gt; complementary, and you pick the one that best fits.
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; On 2 Feb 2017, at 09:43, Alex Feng  wrote:
&gt; 
&gt; &gt; Hello Riak-users,
&gt; &gt;
&gt; &gt; I am currently using Riak search to do some queries, since my queries are 
&gt; &gt; very simple, it should be fulfilled by secondary indexes as well.
&gt; &gt; So, my question is which one has better performance and less overhead, 
&gt; &gt; let's say both can fulfill the query requirement.
&gt; &gt;
&gt; &gt; Many thanks in advance.
&gt; &gt;
&gt; &gt; Br,
&gt; &gt; Alex
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

