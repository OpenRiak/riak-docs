---
title: "Protobuf latency on large keys"
description: ""
project: community
lastmod: 2013-04-16T10:36:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10900"
author_name: "Pavel Kirienko"
project_section: "mailinglistitem"
sent_date: 2013-04-16T10:36:37-07:00
---


Hi everyone,

I encountered a noticeable difference in latency between PBC and HTTP when
querying Riak for large data.

Consider the following setup: 3-node Riak 1.3 cluster with default settings
on LevelDB is connected to an application server via 100Mbit LAN. KV
contains a key of size 25 megabytes.

I request that key using both HTTP and PBC in order to compare the delays:
http://pastebin.com/dr8N82t4

It is interesting that I'm getting completely different timings when I swap
the request order:

HTTP first, then PBC:
-----------------
$ ./riak\\_latency\\_test.py
HTTP
24555775
4.82462286949 sec

PBC
24555775
7.63437104225 sec
-----------------

Vice versa:
-----------------
$ ./riak\\_latency\\_test.py
PBC
24555775
18.1577270031 sec

HTTP
24555775
4.79673409462 sec
-----------------

Note that these results are stable in the sense of repeatability, i.e.
successive runs of every combination yield pretty the same timings.

However, that little observation is hardly relevant to my question, which
is: Why protobuf is so slow being compared with HTTP? Is it possible to
speed it up via fine tuning, or shall I resort to using HTTP?

Regards,
Pavel.
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

