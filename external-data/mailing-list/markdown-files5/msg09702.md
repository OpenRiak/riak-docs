---
title: "Re: strange behavior upgrading from riak-java-client 1.0.5 -> 1.0.6"
description: ""
project: community
lastmod: 2012-12-28T12:23:55-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09702"
mailinglist_parent_id: "msg09701"
author_name: "Brian Roach"
project_section: "mailinglistitem"
sent_date: 2012-12-28T12:23:55-08:00
---


On Fri, Dec 28, 2012 at 12:34 PM, Dietrich Featherston
 wrote:
&gt; Primarily stores but I did see one case of socket timeouts simply building a 
&gt; new connection pool using the rjc.

This should be simply a result of attempting to bring up another
instance of the client when the node can't accept more connections and
when it tries to "warm up" the connection pool, those connections time
out.

&gt; We are simply doing a put. It is not uncommon for keys to be overwritten but 
&gt; we are not
&gt; providing a vector clock. There is a dedicated master performing the write 
&gt; for a given key
&gt; upstream from riak and overwriting is always safe (assuming last one wins) 
&gt; but we don't
&gt; hold onto the vector clock.
&gt;
&gt; It seems possible/likely that we are inadvertently invoking some riak 
&gt; consistency
&gt; machinery by turning off the get prior to put using withoutFetch(). Would it 
&gt; help to attempt
&gt; to coordinate writes in another way?

Are you using a bucket with allow\\_mult enabled?

&gt; Somewhat related: I've been curious about writing a smart riak client that 
&gt; writes to a node
&gt; based on the preflist for a key to avoid unnecessary internal handing off of 
&gt; reads and
&gt; writes when possible. Two things strike me though 1) would need to compute 
&gt; this preflist
&gt; outside of riak and 2) unsure how impactful this change would be without 
&gt; better
&gt; understanding where internal riak bottlenecks present themselves. Perhaps 
&gt; best left for
&gt; another thread.

Yeah - a bit off topic but we've talked about this (not in great
detail as of yet) internally.

- Roach

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

