---
title: "Re: Unable to configure Riak-CS-Control to manage users"
description: ""
project: community
lastmod: 2013-10-09T11:25:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12570"
mailinglist_parent_id: "msg12569"
author_name: "Dmitri Zagidulin"
project_section: "mailinglistitem"
sent_date: 2013-10-09T11:25:18-07:00
---


Ok, yes, I think the hostname mismatch betwen CS and CS Control is at issue
(it's somewhat confusing, I agree).

So:
Since you have

{cs\\_root\\_host, "s3.amazonaws.com"},

in CS Config, you want your cs\\_hostname to match that in CS Control's
config. So, my CS Control config looks like:
 %% Instance of Riak CS you wish to talk to.
 {cs\\_hostname, "s3.amazonaws.com" },
 {cs\\_port, 80 },
 {cs\\_protocol, "http" },

 %% Proxy information; necessary if you are using s3.amazonaws.com as
 %% your hostname.
 {cs\\_proxy\\_host, "localhost" },
 {cs\\_proxy\\_port, 8080 },

(Your cs\\_proxy\\_host would be 10.0.1.202 or 127.0.0.1, depending on your
setup).

Does that make sense?

Dmitri




On Wed, Oct 9, 2013 at 12:22 PM, Siddhu Warrier (siwarrie) &lt;
siwar...@cisco.com&gt; wrote:

&gt; Hi Dmitri,
&gt;
&gt; Sorry I failed to attach the s3cfg file.
&gt;
&gt; Cheers,
&gt;
&gt; Siddhu
&gt;
&gt; From: Dmitri Zagidulin 
&gt; Date: Wednesday, 9 October 2013 16:51
&gt;
&gt; To: Siddhu Warrier 
&gt; Cc: "riak-users@lists.basho.com" 
&gt; Subject: Re: Unable to configure Riak-CS-Control to manage users
&gt;
&gt; Ok, I suspect it has to do with a mismatch between cs\\_root\\_host setting
&gt; in riakcs.app.config and the corresponding setting in
&gt; riak-cs-control.app.config. Can you attach your .s3cfg, so I can confirm?
&gt;
&gt; Dmitri
&gt;
&gt;
&gt; On Wed, Oct 9, 2013 at 11:16 AM, Siddhu Warrier (siwarrie) &lt;
&gt; siwar...@cisco.com&gt; wrote:
&gt;
&gt;&gt; Hi Dmitri,
&gt;&gt;
&gt;&gt; Thanks again for your rapid reply!
&gt;&gt;
&gt;&gt; 1, 2) I have attached my riak, stanchion, riak-cs and riak-cs-control
&gt;&gt; app.config files here
&gt;&gt; 3)
&gt;&gt; \\*Things that work with s3cmd (s3 config attached):\\*
&gt;&gt;
&gt;&gt; - Create a bucket, upload a file, download a file, delete buckets
&gt;&gt; recursively, list contents of buckets
&gt;&gt;
&gt;&gt; [root@cpn-int-store-03 ~]# s3cmd mb s3://cloudcuckooland
&gt;&gt; Bucket 's3://cloudcuckooland/' created
&gt;&gt; [root@cpn-int-store-03 ~]# s3cmd put cobbler.ks
&gt;&gt; s3://cloudcuckooland/shoemaker
&gt;&gt; cobbler.ks -&gt; s3://cloudcuckooland/shoemaker [1 of 1]
&gt;&gt; 6964 of 6964 100% in 0s 114.14 kB/s done
&gt;&gt; [root@cpn-int-store-03 ~]# s3cmd la
&gt;&gt; 2013-10-09 14:47 6964 s3://cloudcuckooland/shoemaker
&gt;&gt;
&gt;&gt; [root@cpn-int-store-03 ~]# s3cmd get s3://cloudcuckooland/shoemaker
&gt;&gt; /tmp/shoemaker.tmp
&gt;&gt; s3://cloudcuckooland/shoemaker -&gt; /tmp/shoemaker.tmp [1 of 1]
&gt;&gt; 6964 of 6964 100% in 0s 659.50 kB/s done
&gt;&gt; [root@cpn-int-store-03 ~]# s3cmd rb --force s3://cloudcuckooland
&gt;&gt; WARNING: Bucket is not empty. Removing all the objects from it first.
&gt;&gt; This may take some time...
&gt;&gt; File s3://cloudcuckooland/shoemaker deleted
&gt;&gt; Bucket 's3://cloudcuckooland/' removed
&gt;&gt;
&gt;&gt; \\*Things that do not work:\\*
&gt;&gt;
&gt;&gt; - Riak CS Control: Create user
&gt;&gt; - Riak CS Control: List users
&gt;&gt;
&gt;&gt; \\*Note:\\* With anonymous user creation set to true, I was able to view
&gt;&gt; information about users and modify them.
&gt;&gt;
&gt;&gt; I was however able to view the information about a particular user.
&gt;&gt; [root@cpn-int-store-03 ~]# s3cmd get s3://riak-cs/user -
&gt;&gt; s3://riak-cs/user -&gt;  [1 of 1]
&gt;&gt; xml version="1.0" 
&gt; encoding="UTF-8"?&gt;x...@cisco.comxxxxxRory
&gt;&gt; Irvine5VI-NIFLNIHKRNGKPBVX&gt; in 0s 4.57 kB/s
&gt;&gt; 
&gt;&gt; doneeySecret&gt;c26c71a140f18b6853b45fd3ce4a672e0471b62a04920c2a77def7a0bfbcde0denabled
&gt;&gt; [root@cpn-int-store-03 ~]# s3cmd get
&gt;&gt; s3://riak-cs/user/9UND62Q1-EIDE9YO1GI0 -
&gt;&gt; s3://riak-cs/user/9UND62Q1-EIDE9YO1GI0 -&gt;  [1 of 1]
&gt;&gt; xml version="1.0" 
&gt; encoding="UTF-8"?&gt;foo...@example.comfoobarfoo
&gt;&gt; bar9UND62Q1-EIDE9YO1GI04o 333 of 333
&gt;&gt; 100% in 0s 43.04 kB/s
&gt;&gt; 
&gt;&gt; doneet&gt;6057fd7d3a7c43b06f839441585d35de197baa57a4696318803afd81c5887aecdisabled
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt;
&gt;&gt; Siddhu
&gt;&gt;
&gt;&gt; From: Dmitri Zagidulin 
&gt;&gt; Date: Wednesday, 9 October 2013 16:02
&gt;&gt;
&gt;&gt; To: Siddhu Warrier 
&gt;&gt; Cc: "riak-users@lists.basho.com" 
&gt;&gt; Subject: Re: Unable to configure Riak-CS-Control to manage users
&gt;&gt;
&gt;&gt; Thanks Siddhu,
&gt;&gt; Couple more questions.
&gt;&gt;
&gt;&gt; 1) Can you include a couple more sections from the Riak CS config
&gt;&gt; (specifically, the anonymous\\_user\\_creation section and the admin\\_key).
&gt;&gt;
&gt;&gt; 2) Just to double-check, can you re-include the Riak CS Control config?
&gt;&gt; (the whole riak\\_cs\\_control section).
&gt;&gt;
&gt;&gt; 3) Describe again exactly which parts are working and which aren't. What
&gt;&gt; do you see when you open the Riak CS Control web interface? (And which
&gt;&gt; commands are working with s3cmd?)
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Oct 9, 2013 at 10:50 AM, Siddhu Warrier (siwarrie) &lt;
&gt;&gt; siwar...@cisco.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Dimitri,
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you for your email. I just tried this. I still have the same
&gt;&gt;&gt; problem, except that I no longer get 403 errors in my Riak CS error log (as
&gt;&gt;&gt; a matter of fact, I get nothing at all in my Riak CS, Riak CS Control,
&gt;&gt;&gt; Stanchion, and Riak error logs).
&gt;&gt;&gt;
&gt;&gt;&gt; I've put the basic config section of my riak-cs/app.config here for
&gt;&gt;&gt; your reference.
&gt;&gt;&gt;
&gt;&gt;&gt; %% Riak CS http/https port and IP address to listen at
&gt;&gt;&gt; %% for object storage activity
&gt;&gt;&gt; {cs\\_ip, "10.0.1.202"},
&gt;&gt;&gt; {cs\\_port, 8080 } ,
&gt;&gt;&gt;
&gt;&gt;&gt; %% Riak node to which Riak CS accesses
&gt;&gt;&gt; {riak\\_ip, "10.0.1.202"},
&gt;&gt;&gt; {riak\\_pb\\_port, 8087 } ,
&gt;&gt;&gt;
&gt;&gt;&gt; %% Configuration for access to request
&gt;&gt;&gt; %% serialization service
&gt;&gt;&gt; {stanchion\\_ip, "10.0.1.202"},
&gt;&gt;&gt; {stanchion\\_port, 8085 },
&gt;&gt;&gt; {stanchion\\_ssl, false },
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;
&gt;&gt;&gt; Siddhu
&gt;&gt;&gt;
&gt;&gt;&gt; From: Dmitri Zagidulin 
&gt;&gt;&gt; Date: Wednesday, 9 October 2013 15:38
&gt;&gt;&gt; To: Siddhu Warrier 
&gt;&gt;&gt; Cc: "riak-users@lists.basho.com" 
&gt;&gt;&gt; Subject: Re: Unable to configure Riak-CS-Control to manage users
&gt;&gt;&gt;
&gt;&gt;&gt; (Just to be extra clear, that's meant to be a comma at the end of
&gt;&gt;&gt; that directive, not a period. Also, don't forget to restart Riak CS
&gt;&gt;&gt; Control, after changing the proxy host).
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Oct 9, 2013 at 10:36 AM, Dmitri Zagidulin 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Siddhu,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Can you try changing 'cs\\_proxy\\_host' to localhost? So:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {cs\\_proxy\\_host, "127.0.0.1" }.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; and retry.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Wed, Oct 9, 2013 at 9:55 AM, Siddhu Warrier (siwarrie) &lt;
&gt;&gt;&gt;&gt; siwar...@cisco.com&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I have a two node Riak CS (1.4) cluster set up on two nodes (node-1
&gt;&gt;&gt;&gt;&gt; and node-2 henceforth). Node-1 is the headnode. Both node-1 and node-2 are
&gt;&gt;&gt;&gt;&gt; running CentOS-6.4.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\*N\\*\\*ode-1\\*
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; - Riak 1.4.2
&gt;&gt;&gt;&gt;&gt; - Stanchion 1.4.1
&gt;&gt;&gt;&gt;&gt; - Riak-CS 1.4.1
&gt;&gt;&gt;&gt;&gt; - Riak-CS-Control 1.0.2
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\*N\\*\\*ode-2\\*
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; - Riak 1.4.2
&gt;&gt;&gt;&gt;&gt; - Riak-CS 1.4.1
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I have got Riak CS working, and have created admin credentials that
&gt;&gt;&gt;&gt;&gt; I've set correctly on stanchion, riak-cs, and riak-cs-control on node 1,
&gt;&gt;&gt;&gt;&gt; and on riak-cs on node 2. I am able to use the admin credentials to 
&gt;&gt;&gt;&gt;&gt; perform
&gt;&gt;&gt;&gt;&gt; operations on the bucket using s3cmd.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; However, when I try to list riak-cs users using the riak-cs-control,
&gt;&gt;&gt;&gt;&gt; I get no results. The error that comes up in /var/log/riak-cs.log is:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; 10.0.1.202 - - [09/Oct/2013:13:09:31 +0000] "GET /buckets/users/objects 
&gt;&gt;&gt;&gt;&gt; HTTP/1.1" 403 160 "" ""
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I also receive a 403 when I try to create an admin user.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I saw https://github.com/basho/riak\\_cs\\_control/issues/31 and set my
&gt;&gt;&gt;&gt;&gt; /etc/riak-cs-control/app.config file up to use the cs\\_proxy\\_host parameter
&gt;&gt;&gt;&gt;&gt; as well, though I'm not using proxies, but to no avail. I have reproduced
&gt;&gt;&gt;&gt;&gt; the relevant section of my riak-cs-control/app.config here:
&gt;&gt;&gt;&gt;&gt; {riak\\_cs\\_control, [
&gt;&gt;&gt;&gt;&gt; %% What port to run the application on.
&gt;&gt;&gt;&gt;&gt; {port, 8000 },
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; %% Instance of Riak CS you wish to talk to.
&gt;&gt;&gt;&gt;&gt; {cs\\_hostname, "10.0.1.202" },
&gt;&gt;&gt;&gt;&gt; {cs\\_port, 8080 },
&gt;&gt;&gt;&gt;&gt; {cs\\_protocol, "http" },
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; %% Proxy information; necessary if you are using
&gt;&gt;&gt;&gt;&gt; s3.amazonaws.com as
&gt;&gt;&gt;&gt;&gt; %% your hostname.
&gt;&gt;&gt;&gt;&gt; {cs\\_proxy\\_host, "10.0.1.202" },
&gt;&gt;&gt;&gt;&gt; {cs\\_proxy\\_port, 8080 },
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; %% Credentials you want the application to run as.
&gt;&gt;&gt;&gt;&gt; {cs\\_admin\\_key, "5VI-NIFLNIHKRNGKPBVX" },
&gt;&gt;&gt;&gt;&gt; {cs\\_admin\\_secret, "xxxxxxx" },
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; %% Specify the bucket name for administration options.
&gt;&gt;&gt;&gt;&gt; {cs\\_administration\\_bucket, "riak-cs" }
&gt;&gt;&gt;&gt;&gt; ]},
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Is there something I am missing/doing wrong?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Siddhu
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

