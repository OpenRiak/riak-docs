---
title: "Re: Can't update some keys"
description: ""
project: community
lastmod: 2012-07-27T09:41:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08102"
mailinglist_parent_id: "msg07925"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-07-27T09:41:56-07:00
---


Fabio,

Two things come to mind given your `bad\\_crc` error. Either a hintfile is
corrupt or one or more entries in the data files is corrupt. My guess is
the latter since this happens during a fold operation. I think code exists
to automatically purge corrupted entries but my knowledge of bitcask is
minimal. I hope that my response might elicit advise from someone more
familiar with bitcask.

-Z

On Fri, Jul 13, 2012 at 2:43 PM, Fabio Sato  wrote:

&gt; Hello all,
&gt;
&gt; I'm using Riak to store images, acting as a cache backend for a web map
&gt; server.
&gt;
&gt; We started using it in with just one node and we have run into problems
&gt; with corruption of data files, so we decided
&gt; to set up a new clean installation.
&gt;
&gt; Now we have 2 servers with 4 riak instances each (8 node cluster) and we
&gt; are having trouble updating some of our keys.
&gt;
&gt; Trying to update a key with curl returns a http timeout error:
&gt;
&gt; curl: (28) Operation timed out after 10005 milliseconds with 0 bytes
&gt; received
&gt;
&gt; Checking logfiles, it seems that we are having file data corruption again
&gt; so I would like to ask you if we have something wrong in our configuration:
&gt;
&gt; 2012-07-13 11:14:12.284 [error] &lt;0.31160.14&gt; CRASH REPORT Process
&gt; &lt;0.31160.14&gt; with 0 neighbours exited with reason: no case clause matching
&gt; {error,bad\\_crc,{state,#Ref&lt;0.0.38.40765&gt;,"570899077082383952423314387779798054553098649600",[{async\\_folds,true},{vnode\\_vclocks,true},{included\\_applications,[]},{allow\\_strfun,false},{reduce\\_js\\_vm\\_count,6},{storage\\_backend,riak\\_kv\\_bitcask\\_backend},{legacy\\_keylisting,false},{hook\\_js\\_vm\\_count,2},{listkeys\\_backpressure,true},{mapred\\_name,"mapred"},{stats\\_urlpath,"stats"},{legacy\\_stats,true},{js\\_thread\\_stack,16},{riak\\_kv\\_stat,true},{add\\_paths,[]},{http\\_url\\_encoding,on},{map\\_js\\_vm\\_count,8},{mapred\\_2i\\_pipe,...},...],...}}
&gt; in riak\\_kv\\_vnode:prepare\\_put/3 in gen\\_server:terminate/6
&gt;
&gt; We are using bitcask on a xfs filesystem. Our riak version is commit hash
&gt; 0c49d24e8ea5d3cf9d41427b6b9cdac69bb99135 and we are running it on a Debian
&gt; Squeeze 3.2.0-2 kernel.
&gt;
&gt;
&gt;
&gt; Thanks,
&gt; FÃ¡bio Sato
&gt;
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

