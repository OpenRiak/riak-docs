---
title: "Re: This sure looks like a bug...?"
description: ""
project: community
lastmod: 2011-04-18T18:59:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03084"
mailinglist_parent_id: "msg03083"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-04-18T18:59:51-07:00
---


I think you're missing a key point here, and that is that the vector clock 
doesn't store copies of the \\*values\\*, only the individual "touches" of 
identified clients. I'm not sure what computing the common ancestor is going to 
give you if you don't have the value. Vector clocks are essentially opaque to 
clients.

That said, I think the use-case you gave is one that can clearly bubble up to 
the user, e.g. "Someone else changed this record while you were editing it. Can 
you resolve the differences?" (Give the other person's name perhaps, highlight 
the fields that are different.)

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Apr 18, 2011, at 9:12 PM, Ben Tilly wrote:

&gt; Riak's small\\_vclock, big\\_vclock, young\\_vclock, and old\\_vclock
&gt; parameters already give control over pruning behavior. If there isn't
&gt; enough history to compute a common ancestor, then return nothing for
&gt; the common ancestor.
&gt; 
&gt; The use case here really isn't an SCM. The use case is when two
&gt; clients get simultaneous (within, say, 50 ms) requests to write to the
&gt; same object. When a third one tries to read the data 5s later, it
&gt; would be nice to have a way to figure out what to do. For this use
&gt; case you can limit the amount of history quite severely without loss.
&gt; 
&gt; Let's take a practical example of conflicting data structures:
&gt; 
&gt; {
&gt; "name": "Jane Doe",
&gt; "occupation": "n/a"
&gt; },
&gt; {
&gt; "name": "Jane Blow",
&gt; "husband": "Joe Blow",
&gt; "occupation": "secretary"
&gt; }
&gt; 
&gt; What should it be resolved to? Perhaps Jane just got divorced and
&gt; went to work as a secretary. Or she could have gotten married and
&gt; left her job. If you give me the common ancestor I can tell which
&gt; scenario to believe. Without it I can only guess badly. I don't want
&gt; to keep a history here. I want to resolve the discrepancy the next
&gt; time I see it (and log it somewhere important if I can't resolve it).
&gt; 
&gt; On Mon, Apr 18, 2011 at 5:38 PM, Sean Cribbs  wrote:
&gt;&gt; Yes, but vector clocks are for resolution of race-conditions and network 
&gt;&gt; partitions, not to provide an SCM history. Imagine how much space would be 
&gt;&gt; consumed by the history long enough to disambiguate an object that has been 
&gt;&gt; updated normally 1000 times, followed by one bad client that decides write 
&gt;&gt; to it without fetching the vector clock first.
&gt;&gt; 
&gt;&gt; Coda Hale put it well in his talk at the recent Riak Meetup: your data needs 
&gt;&gt; to be logically monotonic so that writes (and reads) can be retried until 
&gt;&gt; resolution is reached.
&gt;&gt; 
&gt;&gt; Also, we've found that assigning the client id to something that is relevant 
&gt;&gt; to your domain, e.g. real people, will help reduce surprises (and degenerate 
&gt;&gt; cases like sibling explosion) when it comes to vector-clock resolution.
&gt;&gt; 
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt;&gt; On Apr 18, 2011, at 8:15 PM, Aphyr wrote:
&gt;&gt; 
&gt;&gt;&gt;&gt; I actually had a question about that page. Why is it that when there
&gt;&gt;&gt;&gt; is a conflict we can only get the conflicting versions of the data?
&gt;&gt;&gt;&gt; If I'm going to try to resolve the conflict intelligently, I really
&gt;&gt;&gt;&gt; want the common ancestor as well so that I can try to do a 3-way
&gt;&gt;&gt;&gt; merge.
&gt;&gt;&gt; 
&gt;&gt;&gt; Good call. If an ancestor were available it would make counting and merging 
&gt;&gt;&gt; orthogonal changes \\*much\\* simpler.
&gt;&gt;&gt; 
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt;&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

