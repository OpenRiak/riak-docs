---
title: "Re: transfers failing lookup_timeout"
description: ""
project: community
lastmod: 2012-11-20T17:19:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09359"
mailinglist_parent_id: "msg08682"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-11-20T17:19:48-08:00
---


Hey Rich,

This looks like a known and since-resolved bug that was in 1.2.0. Riak
Search could get into a state where transfers would never finish and
bad things would happen. See the following:

http://docs.basho.com/riak/latest/references/Riak-Search---Settings/
https://github.com/basho/merge\\_index/pull/24

Sorry for the lateness. In the event that you're still running Riak
and haven't upgraded, this is fixed in 1.2.1.

Mark

On Mon, Sep 24, 2012 at 12:47 PM, Rich Sutton  wrote:
&gt; More information ...
&gt;
&gt; These errors come about a minute before the errors below:
&gt;
&gt; 2012-09-24 12:45:15.607 [info]
&gt; &lt;0.6099.0&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:126 Starting
&gt; ownership\\_handoff transfer of riak\\_search\\_vnode from
&gt; 'r...@sylvester.soiq.net' 1096126227998177188652763624537212264741949407232
&gt; to 'r...@daffyduck.soiq.net'
&gt; 1096126227998177188652763624537212264741949407232
&gt; 2012-09-24 12:45:15.607 [info]
&gt; &lt;0.6098.0&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:126 Starting
&gt; ownership\\_handoff transfer of riak\\_search\\_vnode from
&gt; 'r...@sylvester.soiq.net' 1004782375664995756265033322492444576013453623296
&gt; to 'r...@daffyduck.soiq.net'
&gt; 1004782375664995756265033322492444576013453623296
&gt; 2012-09-24 12:45:15.936 [error] &lt;0.1261.0&gt;@mi\\_server:handle\\_info:549
&gt; Unexpected info {#Port&lt;0.7254&gt;,{data,[2,0,0,0,0,0,0,0,1|&lt;&lt;128&gt;&gt;]}}
&gt; 2012-09-24 12:45:16.886 [error] &lt;0.1297.0&gt;@mi\\_server:handle\\_info:549
&gt; Unexpected info {#Port&lt;0.7250&gt;,{data,[2,0,0,0,0,0,0,0,1|&lt;&lt;0&gt;&gt;]}}
&gt;
&gt; Incidentally, this happens about once every minute. Some amount of memory
&gt; appears to leak, as the beam process reserved memory grows some each minute
&gt; until the kernel's OOM killer kicks in after a while.
&gt;
&gt; Rich
&gt;
&gt; On Mon, Sep 24, 2012 at 12:09 PM, Rich Sutton 
&gt; wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I've got a two node riak cluster set up for testing. After joining the
&gt;&gt; second node to the cluster, I've got some failing transfers. Restarts on
&gt;&gt; both nodes don't resolve the situation. Any ideas?
&gt;&gt;
&gt;&gt; From error.log on transferrer node (sylvester.soiq.net):
&gt;&gt;
&gt;&gt; 2012-09-24 12:06:35.598 [error] &lt;0.3180.0&gt; gen\\_server &lt;0.3180.0&gt;
&gt;&gt; terminated with reason: bad return value: lookup\\_timeout
&gt;&gt; 2012-09-24 12:06:35.599 [error]
&gt;&gt; &lt;0.3276.0&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:215 ownership\\_handoff
&gt;&gt; transfer of riak\\_search\\_vnode from 'r...@sylvester.soiq.net'
&gt;&gt; 1004782375664995756265033322492444576013453623296 to
&gt;&gt; 'r...@daffyduck.soiq.net' 1004782375664995756265033322492444576013453623296
&gt;&gt; failed because of
&gt;&gt; error:{badmatch,{error,{worker\\_crash,{bad\\_return\\_value,lookup\\_timeout},{fold,#Fun,#Fun}}}}
&gt;&gt; [{riak\\_core\\_handoff\\_sender,start\\_fold,5,[{file,"src/riak\\_core\\_handoff\\_sender.erl"},{line,161}]}]
&gt;&gt; 2012-09-24 12:06:35.617 [error]
&gt;&gt; &lt;0.3277.0&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:215 ownership\\_handoff
&gt;&gt; transfer of riak\\_search\\_vnode from 'r...@sylvester.soiq.net'
&gt;&gt; 1096126227998177188652763624537212264741949407232 to
&gt;&gt; 'r...@daffyduck.soiq.net' 1096126227998177188652763624537212264741949407232
&gt;&gt; failed because of
&gt;&gt; error:{badmatch,{error,{worker\\_crash,{bad\\_return\\_value,lookup\\_timeout},{fold,#Fun,#Fun}}}}
&gt;&gt; [{riak\\_core\\_handoff\\_sender,start\\_fold,5,[{file,"src/riak\\_core\\_handoff\\_sender.erl"},{line,161}]}]
&gt;&gt; 2012-09-24 12:06:35.618 [error] &lt;0.3180.0&gt; CRASH REPORT Process &lt;0.3180.0&gt;
&gt;&gt; with 0 neighbours exited with reason: bad return value: lookup\\_timeout in
&gt;&gt; gen\\_server:terminate/6 line 747
&gt;&gt; 2012-09-24 12:06:35.709 [error] &lt;0.1293.0&gt; Supervisor poolboy\\_sup had
&gt;&gt; child riak\\_core\\_vnode\\_worker started with
&gt;&gt; {riak\\_core\\_vnode\\_worker,start\\_link,undefined} at &lt;0.3180.0&gt; exit with reason
&gt;&gt; bad return value: lookup\\_timeout in context child\\_terminated
&gt;&gt; 2012-09-24 12:06:35.730 [error] &lt;0.3181.0&gt; gen\\_server &lt;0.3181.0&gt;
&gt;&gt; terminated with reason: bad return value: lookup\\_timeout
&gt;&gt; 2012-09-24 12:06:35.753 [error] &lt;0.3181.0&gt; CRASH REPORT Process &lt;0.3181.0&gt;
&gt;&gt; with 0 neighbours exited with reason: bad return value: lookup\\_timeout in
&gt;&gt; gen\\_server:terminate/6 line 747
&gt;&gt; 2012-09-24 12:06:35.773 [error] &lt;0.1310.0&gt; Supervisor poolboy\\_sup had
&gt;&gt; child riak\\_core\\_vnode\\_worker started with
&gt;&gt; {riak\\_core\\_vnode\\_worker,start\\_link,undefined} at &lt;0.3181.0&gt; exit with reason
&gt;&gt; bad return value: lookup\\_timeout in context child\\_terminated
&gt;&gt;
&gt;&gt;
&gt;&gt; rich@daffyduck:~$ sudo riak-admin member-status
&gt;&gt; Attempting to restart script through sudo -H -u riak
&gt;&gt; ================================= Membership
&gt;&gt; ==================================
&gt;&gt; Status Ring Pending Node
&gt;&gt;
&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt; valid 37.5% 50.0% 'r...@daffyduck.soiq.net'
&gt;&gt; valid 62.5% 50.0% 'r...@sylvester.soiq.net'
&gt;&gt;
&gt;&gt; -------------------------------------------------------------------------------
&gt;&gt; Valid:2 / Leaving:0 / Exiting:0 / Joining:0 / Down:0
&gt;&gt;
&gt;&gt; rich@daffyduck:~$ sudo riak-admin transfers
&gt;&gt; Attempting to restart script through sudo -H -u riak
&gt;&gt; 'r...@daffyduck.soiq.net' waiting to handoff 8 partitions
&gt;&gt;
&gt;&gt; Active Transfers:
&gt;&gt;
&gt;&gt; transfer type: ownership\\_handoff
&gt;&gt; vnode type: riak\\_search\\_vnode
&gt;&gt; partition: 1004782375664995756265033322492444576013453623296
&gt;&gt; started: 2012-09-24 18:24:41 [-81984015.00 us ago]
&gt;&gt; last update: no updates seen
&gt;&gt; objects transferred: unknown
&gt;&gt;
&gt;&gt; unknown
&gt;&gt; riak@sylvester.s =======================&gt; riak@daffyduck.s
&gt;&gt; unknown
&gt;&gt;
&gt;&gt; transfer type: ownership\\_handoff
&gt;&gt; vnode type: riak\\_search\\_vnode
&gt;&gt; partition: 1096126227998177188652763624537212264741949407232
&gt;&gt; started: 2012-09-24 18:24:51 [-91982788.00 us ago]
&gt;&gt; last update: no updates seen
&gt;&gt; objects transferred: unknown
&gt;&gt;
&gt;&gt; unknown
&gt;&gt; riak@sylvester.s =======================&gt; riak@daffyduck.s
&gt;&gt; unknown
&gt;&gt;
&gt;&gt; Rich
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Rich Sutton
&gt; CTO / VP of Engineering
&gt; socialiqnetworks.com
&gt; mobile 714-318-7737
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

