---
title: "Re: Proper way do delete datatypes ( map )"
description: ""
project: community
lastmod: 2014-10-02T11:12:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14979"
mailinglist_parent_id: "msg14972"
author_name: "Alexander Popov"
project_section: "mailinglistitem"
sent_date: 2014-10-02T11:12:33-07:00
---


Since I use http interface I decide for now to not delete records at all.
I just empty it by
{ remove :[allmykeys], update:{timestamp}}
command.
Probably later I will implement kind of task to kill lost empty items, but
now this way work fine for me. I will never get siblings headache and
yokozuna index is fine all time

P.s I'm realy appreciate new RIAK. It is incredible improvement. Great
work!
02.10.2014 20:10 пользователь "Russell Brown" 
написал:

&gt; Hi Alexander,
&gt;
&gt; I think you are deleting data-types the proper way.
&gt;
&gt; What is your `delete\\_mode` setting, please?
&gt;
&gt; I would guess that sibling you are seeing is a tombstone, which suggests
&gt; you have some concurrent update with the delete.
&gt;
&gt; You will only ever have a single CRDT sibling, and 1 (or possibly more)
&gt; tombstone siblings.
&gt;
&gt; If you write back just the binary CRDT sibling as the value in the normal
&gt; K/V interface, any concurrent data type updates will merge ok to a single
&gt; value.
&gt;
&gt; I don’t know about your Yokozuna question, but I think it is just that
&gt; Yokozuna indexes each sibling as an independent document.
&gt;
&gt; Let me know if that works out OK for you, please?
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt; On 2 Oct 2014, at 12:54, Alexander Popov  wrote:
&gt;
&gt; I have map bucket with some data( with neseted maps )
&gt; aprox structure( don't know does it matter or not ):
&gt; {
&gt; "update": {
&gt; "some\\_register": "value",
&gt; "some\\_flag": "disable",
&gt; "nested\\_map": {
&gt; "update": {
&gt; "nested1\\_map": {
&gt; "update": {
&gt; "some\\_register": "value",
&gt; "some\\_flag": "disable",
&gt; }
&gt; },
&gt; "nested1\\_map": {
&gt; "update": {
&gt; "some\\_register": "value",
&gt; "some\\_flag": "disable",
&gt; }
&gt; }
&gt; }
&gt; },
&gt; "some\\_counter": 13,
&gt; }
&gt; }
&gt;
&gt;
&gt; Updates works fine. Even simultaneous
&gt; But Sometimes I need recreate entire value, so I Delete it using
&gt; curl -XDELETE http://host:8098/types/maps/buckets/mybucket/keys/some
&gt;
&gt; After that sometimes siblings appears.
&gt;
&gt;
&gt; curl -H "Accept: multipart/mixed"
&gt; http://host:8098/types/maps/buckets/mybucket/keys/some
&gt;
&gt; show that confict with delete
&gt;
&gt; --XZ98hy0TJbr4sVETS44XBEJf7Yt
&gt; Last-Modified: Thu, 02 Oct 2014 11:29:15 GMT
&gt;
&gt; E
&gt; ��A�6-.... some binary
&gt; --XZ98hy0TJbr4sVETS44XBEJf7Yt
&gt; Content-Type: application/octet-stream
&gt; Link: ; rel="up"
&gt; Etag: 1MqocFt6qWeQxIw8bE1B8e
&gt; Last-Modified: Thu, 02 Oct 2014 11:29:03 GMT
&gt; X-Riak-Deleted: true
&gt;
&gt;
&gt; --XZ98hy0TJbr4sVETS44XBEJf7Yt--
&gt;
&gt;
&gt; Further updates to datatype using
&gt; http://host:8098/types/maps/buckets/mybucket/datatypes/some NOT create
&gt; new sibling. It is replace previous one.
&gt;
&gt; Problems:
&gt;
&gt; 1. I should remove datatype with different method? Or how to resolve such
&gt; conflicts? probably
&gt; Data I receive is binary, and query like
&gt; curl -H "Accept: multipart/mixed"
&gt; http://host:8098/types/maps/buckets/mybucket/datatypes/some
&gt; to get json data not works.Should I post it as binary back?
&gt;
&gt;
&gt; 2. I have also search index on this bucket.
&gt; each further updates to this datatype before resolution creates new
&gt; records in solr because
&gt; \\_yz\\_id includes sibling id:
&gt; 1\\*maps\\*mybucket\\*some\\*34\\*46hGXxyhuW3yn3L8bRHIml
&gt;
&gt; good news that when I delete record again all entries in solr deleted too.
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

