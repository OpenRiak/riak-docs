---
title: "Re: documentation for allow_mult=false"
description: ""
project: community
lastmod: 2011-11-02T10:06:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05421"
mailinglist_parent_id: "msg05420"
author_name: "Justin Karneges"
project_section: "mailinglistitem"
sent_date: 2011-11-02T10:06:49-07:00
---


On Wednesday, November 02, 2011 08:18:48 AM Ryan Zezeski wrote:
&gt; No, last\\_write\\_wins=true doesn't care about the value of allow\\_mult. Only
&gt; one should be true at the same time, and the default is to have both set to
&gt; false. Perhaps making an imaginary setting to displace these two would
&gt; help. Lets call this imaginary setting "conflict\\_resolution\\_method" which
&gt; can take on the three mutually exclusive values "stomp", "most\\_recent" and
&gt; "siblings".
&gt; 
&gt; stomp - overwrite the current value with the new value regardless of vector
&gt; clocks, just mutate the value with no regard, thus "stomp"
&gt; 
&gt; most\\_recent - use vclocks to monitor for conflicts, create siblings, and
&gt; pick the most recent write when a conflict does occur (i.e. let Riak handle
&gt; the conflict for you based on time)
&gt; 
&gt; siblings - use vclocks to monitor for conflicts, create siblings, and
&gt; return the siblings to the client when a conflict occurs for it to be
&gt; resolved by some application dependent logic
&gt; 
&gt; Now lets map my imaginary field to the actual fields
&gt; 
&gt; stomp = last\\_write\\_wins=true + allow\\_mult=false
&gt; 
&gt; most\\_recent = last\\_write\\_wins=false + allow\\_mult=false
&gt; 
&gt; siblings = last\\_write\\_wins=false + allow\\_mult=true
&gt; 
&gt; Notice that setting both to true has undefined semantics as they
&gt; are necessarily mutually exclusive.

Thanks for this clear explanation of the allowed settings. This confirms that 
allow\\_mult=false + last\\_write\\_wins=false indeed has its own behavior compared 
to other configurations.

If you recall from my original email, I had a table with that entry missing. 
We can now complete it:

allow\\_mult, last\\_write\\_wins
-----------
false, false -&gt; {write siblings, magically read single values}
true, false -&gt; write siblings, read siblings
false, true -&gt; writes overwrite existing, read single values
true, true -&gt; invalid

&gt; Also notice that stomp and most\\_recent might seem like the same thing on
&gt; the surface but they may have different outcomes in different situations.
&gt; For example, stomp would prove to be non-deterministic during the healing
&gt; of a split-brain because it will depend on the order of the hinted handoff
&gt; transfers. Honestly, you're best avoiding last\\_write\\_wins at this point
&gt; because it can cause non-obvious behavior and there is potential it may be
&gt; removed in the future.

Yes, they do seem like the same thing to me. Are you saying that with 
allow\\_mult=false + last\\_write\\_wins=false, you could end up with a winning 
write that occurred earlier than a losing write?

It would be great to see an explicit example of conflict resolution in this 
scenario.

Justin

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

