---
title: "Re: Unit testing persistence"
description: ""
project: community
lastmod: 2013-07-31T22:18:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11846"
mailinglist_parent_id: "msg11845"
author_name: "Jeremy Ong"
project_section: "mailinglistitem"
sent_date: 2013-07-31T22:18:34-07:00
---


Be advised, avoiding mocking/stubbing and making your tests "unit
tests" are mutually exclusive. A unit test by definition should not
have any dependencies whatsoever (on other modules even, let alone a
database!).

On Wed, Jul 31, 2013 at 9:41 PM, Wagner Camarao  wrote:
&gt; Hi all ~
&gt;
&gt; Great meetup today - looking forward to upgrading to 1.4
&gt;
&gt; I had a question Mark suggested posting here, then we discussed with a few
&gt; other folks too: How do we unit / integration test persistence with riak?
&gt;
&gt; Given a basic dev environment, e.g. running only one riak physical node
&gt; locally with all configs default, how do we surely read the data we just
&gt; wrote?
&gt;
&gt; I have tried setting DW=all (Durable Write - as recommended for best
&gt; consistency in the financial example from the little riak book - section for
&gt; developers, more than N/R/W) and tried also using {delete\\_mode, keep} in
&gt; riak\\_kv app.config (since I truncate the buckets after each test suite), but
&gt; still, I get intermittent test failures as eventually the data isn't
&gt; available for reading right after writing.
&gt;
&gt; Please note I'm trying to avoid mocking / stubbing as well as hacks like
&gt; "keep trying to read" until a certain timeout.
&gt;
&gt; I'm looking ideally for a simple configuration or any known best practices.
&gt;
&gt; Thanks
&gt; ~W
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

