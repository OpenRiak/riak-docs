---
title: "Re: Riak mapreduce error"
description: ""
project: community
lastmod: 2017-02-06T07:50:13-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17922"
mailinglist_parent_id: "msg17918"
author_name: "Magnus Kessler"
project_section: "mailinglistitem"
sent_date: 2017-02-06T07:50:13-08:00
---


On 3 February 2017 at 18:31, raghuveer sj  wrote:

&gt; Hi Team,
&gt;
&gt; I am trying to run mapreduce in erlang.
&gt;
&gt; curl -XPUT http://localhost:8098/buckets/training/keys/foo -H
&gt; 'Content-Type: text/plain' -d 'caremad data goes here'
&gt; curl -XPUT http://localhost:8098/buckets/training/keys/bar -H
&gt; 'Content-Type: text/plain' -d 'caremad caremad caremad caremad'
&gt; curl -XPUT http://localhost:8098/buckets/training/keys/baz -H
&gt; 'Content-Type: text/plain' -d 'nothing to see here'
&gt; curl -XPUT http://localhost:8098/buckets/training/keys/bam -H
&gt; 'Content-Type: text/plain' -d 'caremad caremad caremad'
&gt;
&gt; \\*Running in erlang shell :\\*
&gt;
&gt; ReFun = fun(O, \\_, Re) -&gt; case re:run(riak\\_object:get\\_value(O), Re,
&gt; [global]) of
&gt; {match, Matches} -&gt; [{riak\\_object:key(O), length(Matches)}];
&gt; nomatch -&gt; [{riak\\_object:key(O), 0}]
&gt; end end.
&gt;
&gt; code:which(riakc\\_pb\\_socket).
&gt; "./ebin/riakc\\_pb\\_socket.beam"
&gt;
&gt; {ok, Pid} = riakc\\_pb\\_socket:start\\_link("127.0.0.1", 8087).
&gt; {ok,&lt;0.36.0&gt;}
&gt;
&gt; riakc\\_pb\\_socket:ping(Pid).
&gt; pong
&gt;
&gt; {ok, Re} = re:compile("caremad").
&gt; {ok,{re\\_pattern,0,0,0,
&gt; &lt;&lt;69,82,67,80,85,0,0,0,0,0,0,0,81,0,0,0,255,255,255,255,
&gt; 255,255,...&gt;&gt;}}
&gt;
&gt; {ok, Riak} = riakc\\_pb\\_socket:start\\_link("127.0.0.1", 8087).
&gt; {ok,&lt;0.42.0&gt;}
&gt;
&gt; riakc\\_pb\\_socket:mapred\\_bucket(Riak, &lt;&lt;"training"&gt;&gt;, [{map, {qfun, ReFun},
&gt; Re, true}]).
&gt; \\*\\* 1: variable 'ReFun' is unbound\\*
&gt;
&gt; Trying to run the famous erlang sample program sample. I am stuck at this
&gt; error. Kindly help me out.
&gt;
&gt; Regards,
&gt; Raghuveer
&gt;
&gt;
Hi Raghuveer,

I have run the steps you provided, and found that they work fine for me.
Can you let me know which version of Riak you are running this against, and
which version of Erlang is used on the client side? Has the
riak-erlang-client been compiled with the same Erlang version?

Kind Regards,

Magnus

-- 
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

