---
title: "Re: Simple mapreduce with 2i returns different result"
description: ""
project: community
lastmod: 2013-04-17T03:56:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10916"
mailinglist_parent_id: "msg10909"
author_name: "Mattias Sjölinder"
project_section: "mailinglistitem"
sent_date: 2013-04-17T03:56:55-07:00
---


Ok, we got it. We have made a fix that is working for us handling the
result.

Thanks for your time and responses around this!

Regards,
Mattias


2013/4/17 OJ Reeves 

&gt; Hi guys,
&gt;
&gt; Russell is correct. In CI we gather the responses as they come in, in
&gt; whichever order they're received. We make some effort to flatten the
&gt; result, but we take the approach of being "smart enough to get you the
&gt; results, but no smarter".
&gt;
&gt; We don't do anything to reorder or manage the results in the way that the
&gt; HTTP interface does as we feel that's behaviour that the user of the
&gt; library should decide to implement should they desire it.
&gt;
&gt; HTH.
&gt; OJ
&gt;
&gt;
&gt;
&gt; On Wed, Apr 17, 2013 at 5:58 PM, Russell Brown wrote:
&gt;
&gt;&gt;
&gt;&gt; On 17 Apr 2013, at 08:54, Mattias Sjölinder  wrote:
&gt;&gt;
&gt;&gt; &gt; Thanks for your help. Your query returned the same number over and over
&gt;&gt; again just as expected.
&gt;&gt; &gt;
&gt;&gt; &gt; I think I have found the reason for my problem though. The client lib
&gt;&gt; CorrugatedIron seems to wrap each document in the MapReduce result into a
&gt;&gt; array turning the result into a nested array looking like:
&gt;&gt; &gt; [[{doc1}], [{doc2}], [{doc3}]] counting 3 arrays & 3 docs
&gt;&gt; &gt; and sometimes
&gt;&gt; &gt; [[{doc1}], [{doc2}, {doc3}]] counting 2 arrays and 2 docs (according to
&gt;&gt; my client code... :)
&gt;&gt; &gt;
&gt;&gt; &gt; Why the result for same query in CorrugatedIron and for a simple curl
&gt;&gt; differs I don't know but I will investigate it further.
&gt;&gt;
&gt;&gt; My guess is the client library streams the mapreduce results and gathers
&gt;&gt; the separate messages. So depending on how many chunks are sent by riak you
&gt;&gt; get a different nested array of responses.
&gt;&gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks again for your help!
&gt;&gt; &gt;
&gt;&gt; &gt; Best regards,
&gt;&gt; &gt; Mattias
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; 2013/4/16 Christian Dahlqvist 
&gt;&gt; &gt; Hi Mattias,
&gt;&gt; &gt;
&gt;&gt; &gt; The following curl query simply counts the number of inputs, and has
&gt;&gt; worked well for me in the past. Can you please run it against the cluster a
&gt;&gt; couple of times and see if it also return varying number of results?
&gt;&gt; &gt;
&gt;&gt; &gt; curl -XPOST http://localhost:8098/mapred
&gt;&gt; &gt; -H 'Content-Type: application/json'
&gt;&gt; &gt; -d '{"inputs":{
&gt;&gt; &gt; "bucket":"som-bucket",
&gt;&gt; &gt; "index":"userid\\_bin",
&gt;&gt; &gt; "key":"18481123123"
&gt;&gt; &gt; },
&gt;&gt; &gt; "query":[{"reduce":{"language":"erlang",
&gt;&gt; &gt; "module":"riak\\_kv\\_mapreduce",
&gt;&gt; &gt; "function":"reduce\\_count\\_inputs"
&gt;&gt; &gt; }}]}'
&gt;&gt; &gt;
&gt;&gt; &gt; Best regards,
&gt;&gt; &gt;
&gt;&gt; &gt; Christian
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On 16 Apr 2013, at 15:52, Mattias Sjölinder 
&gt;&gt; wrote:
&gt;&gt; &gt;
&gt;&gt; &gt;&gt; 18481123123
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt;
&gt; OJ Reeves
&gt; +61 431 952 586
&gt; http://buffered.io/
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

