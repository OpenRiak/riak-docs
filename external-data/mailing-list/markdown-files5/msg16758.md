---
title: "Creating a new bucket by s3cmd results in access denied"
description: ""
project: community
lastmod: 2015-11-11T00:14:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16758"
author_name: "野島 裕輔"
project_section: "mailinglistitem"
sent_date: 2015-11-11T00:14:37-08:00
---


I have installed the Riak, Stanchion and Riak CS to Ubuntu 14.04, and created 
an admin user.
Then I attempted to create the new bucket with s3cmd, but it resulted in 
AccessDenied error.

I tried the solution of 
http://riak-users.197444.n3.nabble.com/RIAK-CS-Unable-to-create-bucket-using-s3cmd-AccessDenied-td4032375.html,
 but still does not work.

I found another thread 
http://riak-users.197444.n3.nabble.com/ERROR-S3-error-403-AccessDenied-Access-Denied-with-s3cmd-tt4033610.html,
 but no one answered the thread.

Any ideas what was wrong with my setup?
Thanks for the help in advance.

-------------------------
$ s3cmd mb s3://test
DEBUG: Updating Config.Config encoding -&gt; UTF-8
DEBUG: Updating Config.Config follow\\_symlinks -&gt; False
DEBUG: Updating Config.Config verbosity -&gt; 30
DEBUG: Unicodising 'mb' using UTF-8
DEBUG: Unicodising 's3://test' using UTF-8
DEBUG: Command: mb
DEBUG: SignHeaders: 'PUT\\n\\n\\n\\nx-amz-date:Wed, 11 Nov 2015 07:36:55 
+0000\\n/test/'
DEBUG: CreateRequest: resource[uri]=/
DEBUG: SignHeaders: 'PUT\\n\\n\\n\\nx-amz-date:Wed, 11 Nov 2015 07:36:55 
+0000\\n/test/'
DEBUG: Processing request, please wait...
DEBUG: get\\_hostname(test): test.s3.amazonaws.com
DEBUG: format\\_uri(): http://test.s3.amazonaws.com/
DEBUG: Sending request method\\_string='PUT', 
uri='http://test.s3.amazonaws.com/', headers={'content-length': '0', 
'Authorization': 'AWS LS\\_P9JF815TCCKTFOD4O:USeKvJH40fSHJy8kZFnRyJxGgcY=', 
'x-amz-date': 'Wed, 11 Nov 2015 07:36:55 +0000'}, body=(0 bytes)
DEBUG: Response: {'status': 403, 'headers': {'date': 'Wed, 11 Nov 2015 07:36:55 
GMT', 'content-length': '159', 'content-type': 'application/xml', 'server': 
'Riak CS'}, 'reason': 'Forbidden', 'data': 'xml version="1.0" 
encoding="UTF-8"?`AccessDenied`Access 
Denied/test'}
DEBUG: S3Error: 403 (Forbidden)
DEBUG: HttpHeader: date: Wed, 11 Nov 2015 07:36:55 GMT
DEBUG: HttpHeader: content-length: 159
DEBUG: HttpHeader: content-type: application/xml
DEBUG: HttpHeader: server: Riak CS
DEBUG: ErrorXML: Code: 'AccessDenied'
DEBUG: ErrorXML: Message: 'Access Denied'
DEBUG: ErrorXML: Resource: '/test'
DEBUG: ErrorXML: RequestId: None
ERROR: Access to bucket 'test' was denied

-------------------------
/var/log/stanchion/console.log says that the presented signature does not match:

2015-11-11 07:36:55.683 [debug] &lt;0.169.0&gt;@stanchion\\_auth:authenticate:41 
Presented Signature: "rVYpULyFn0zsqUhizDUlQI+LfzA="
Calculated Signature: "aHCNYOFa7XT8PKS64fKNYyh7JGc="

-------------------------
My .s3cfg looks like:

[default]
access\\_key = LS\\_P9JF815TCCKTFOD4O
bucket\\_location = US
cloudfront\\_host = cloudfront.amazonaws.com
default\\_mime\\_type = binary/octet-stream
delete\\_removed = False
dry\\_run = False
enable\\_multipart = True
encoding = UTF-8
encrypt = False
follow\\_symlinks = False
force = False
get\\_continue = False
gpg\\_command = /usr/bin/gpg
gpg\\_decrypt = %(gpg\\_command)s -d --verbose --no-use-agent --batch --yes 
--passphrase-fd %(passphrase\\_fd)s -o %(output\\_file)s %(input\\_file)s
gpg\\_encrypt = %(gpg\\_command)s -c --verbose --no-use-agent --batch --yes 
--passphrase-fd %(passphrase\\_fd)s -o %(output\\_file)s %(input\\_file)s
gpg\\_passphrase = cybozu123
guess\\_mime\\_type = True
host\\_base = s3.amazonaws.com
host\\_bucket = %(bucket)s.s3.amazonaws.com
human\\_readable\\_sizes = False
invalidate\\_on\\_cf = False
list\\_md5 = False
log\\_target\\_prefix =
mime\\_type =
multipart\\_chunk\\_size\\_mb = 15
preserve\\_attrs = True
progress\\_meter = True
proxy\\_host = 127.0.0.1
proxy\\_port = 8080
recursive = False
recv\\_chunk = 4096
reduced\\_redundancy = False
secret\\_key = dz0oUJqZBowOmTobwyaCaZcrO7PgL69ArCSnfQ==
send\\_chunk = 4096
simpledb\\_host = sdb.amazonaws.com
skip\\_existing = False
socket\\_timeout = 300
urlencoding\\_mode = normal
use\\_https = False
verbosity = DEBUG
website\\_endpoint = http://%(bucket)s.s3-website-%(location)s.amazonaws.com/
website\\_error =
website\\_index = index.html
signature\\_v2 = True


-------------------------
Versions:

riak: 2.0.5
riak-cs: 2.0.1
stanchion: 2.0.0
s3cmd: 1.1.0-beta3

-------------------------
Traffic between Riak CS and Stanchion aquired by tcpdump is:

POST /buckets HTTP/1.1
content-type: application/json
content-md5: owB6xF/s2H7XLFzMR3vYnw==
content-length: 462
te:
host: 127.0.0.1:8085
authorization: MOSS LS\\_P9JF815TCCKTFOD4O:rVYpULyFn0zsqUhizDUlQI+LfzA=
date: Wed, 11 Nov 2015 07:36:55 GMT
connection: keep-alive

{"bucket":"test","requester":"LS\\_P9JF815TCCKTFOD4O","acl":{"version":1,"owner":{"display\\_name":"yusuke-nojima","canonical\\_id":"7a48a8c7c33b1f9e72793cd06e4ca9b505389543bf17f3c056be289d17d10bc0","key\\_id":"LS\\_
P9JF815TCCKTFOD4O"},"grants":[{"display\\_name":"yusuke-nojima","canonical\\_id":"7a48a8c7c33b1f9e72793cd06e4ca9b505389543bf17f3c056be289d17d10bc0","permissions":["FULL\\_CONTROL"]}],"creation\\_time":{"mega\\_seconds":1447,"seconds":227415,"micro\\_seconds":682371}}}


HTTP/1.1 403 Forbidden
Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho)
Date: Wed, 11 Nov 2015 07:36:55 GMT
Content-Length: 162

xml version="1.0" 
encoding="UTF-8"?`AccessDenied`Access 
Denied/test


-------------------------
"s3cmd ls" works fine:

$ s3cmd ls
DEBUG: Updating Config.Config encoding -&gt; UTF-8
DEBUG: Updating Config.Config follow\\_symlinks -&gt; False
DEBUG: Updating Config.Config verbosity -&gt; 30
DEBUG: Unicodising 'ls' using UTF-8
DEBUG: Command: ls
DEBUG: SignHeaders: 'GET\\n\\n\\n\\nx-amz-date:Wed, 11 Nov 2015 07:47:00 +0000\\n/'
DEBUG: CreateRequest: resource[uri]=/
DEBUG: SignHeaders: 'GET\\n\\n\\n\\nx-amz-date:Wed, 11 Nov 2015 07:47:00 +0000\\n/'
DEBUG: Processing request, please wait...
DEBUG: get\\_hostname(None): s3.amazonaws.com
DEBUG: format\\_uri(): http://s3.amazonaws.com/
DEBUG: Sending request method\\_string='GET', uri='http://s3.amazonaws.com/', 
headers={'content-length': '0', 'Authorization': 'AWS 
LS\\_P9JF815TCCKTFOD4O:y6iQZ6mli0mMQ7n7V/a1hJti0r8=', 'x-amz-date': 'Wed, 11 Nov 
2015 07:47:00 +0000'}, body=(0 bytes)
DEBUG: Response: {'status': 200, 'headers': {'date': 'Wed, 11 Nov 2015 07:47:00 
GMT', 'content-length': '273', 'content-type': 'application/xml', 'server': 
'Riak CS'}, 'reason': 'OK', 'data': 'xml version="1.0" 
encoding="UTF-8"?&lt;ListAllMyBucketsResult 
xmlns="http://s3.amazonaws.com/doc/2006-03-01/&quot;&gt;7a48a8c7c33b1f9e72793cd06e4ca9b505389543bf17f3c056be289d17d10bc0yusuke-nojima'}

-------------------------

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

