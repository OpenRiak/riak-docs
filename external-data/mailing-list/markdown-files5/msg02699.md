---
title: "Re: Multiple disks"
description: ""
project: community
lastmod: 2011-03-22T00:47:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02699"
mailinglist_parent_id: "msg02698"
author_name: "Joseph Blomstedt"
project_section: "mailinglistitem"
sent_date: 2011-03-22T00:47:58-07:00
---


Oh, I just realized that was only a partial solution to the problem. I
forgot to commit related logic that handles selecting the same
directory on vnode restart. That's what I get for sending out code
late at night. You'll want to maintain a partition-&gt;directory index
somewhere to really make it work (or search all directories for an
existing bitcask corresponding to the partition).

For what it's worth, my experiments a few months back in this area
just used a deterministic function to map partitions to a directory.
That's another approach.

-Joe

On Tue, Mar 22, 2011 at 1:25 AM, Joseph Blomstedt
 wrote:
&gt; Each vnode already opens a separate bitcask, therefore there isn't any
&gt; necessary factor preventing the desired behavior. It's just not coded
&gt; that way. While an individual bitcask must be a single directory,
&gt; there is no reason all vnodes need to open bitcasks within a shared
&gt; root directory.
&gt;
&gt; Luckily, it's easy to change this behavior. In fact, I played around
&gt; with the idea awhile back. This question prompted me to find/release
&gt; the code:
&gt; https://github.com/jtuple/riak\\_kv/commit/a8ab33224651e6850aed385e4c05c1993916a3e5
&gt;
&gt; That commit should apply against riak-0.14.1. It extends the bitcask
&gt; data\\_root config option to allow for multiple root paths as well as a
&gt; selection strategy (random or spread). Random just randomly chooses
&gt; one of the directories. Spread picks the directory containing the
&gt; fewest already-opened bitcasks -- although, this is a soft guarantee
&gt; since no effort is taken to address multiple vnodes choosing a
&gt; directory concurrently.
&gt;
&gt; Using paths that correspond to different mounted drives should do the trick.
&gt;
&gt; -Joe
&gt;
&gt;
&gt; On Mon, Mar 21, 2011 at 5:29 PM, Greg Nelson  wrote:
&gt;&gt; Hello,
&gt;&gt; We are currently evaluating Riak for an application that will store large
&gt;&gt; amounts of data in a write-heavy pattern.  We'd like to pack many disks into
&gt;&gt; each machine.  Currently, it appears that Bitcask uses exactly one directory
&gt;&gt; to store data.  What is the best way to have it use multiple disks?  Is this
&gt;&gt; something Innostore would handle better?
&gt;&gt; We'd like to avoid RAID since we'll be paying for redundancy at a higher
&gt;&gt; level with Riak (N=3, etc.).
&gt;&gt; We'd also like to avoid a JBOD type setup where a single disk failure brings
&gt;&gt; the whole node down, as we'll obviously be increasing those odds with each
&gt;&gt; disk.
&gt;&gt; What I'm wondering is, can each node distribute its vnodes across many
&gt;&gt; disks?  And if one of those disks fails, will Riak handle that appropriately
&gt;&gt; (i.e., the other vnodes continue to operate normally and hand-off data when
&gt;&gt; the new disk comes online)?
&gt;&gt; Thanks!
&gt;&gt; Greg
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

