---
title: "Re: Possible handoff stalls"
description: ""
project: community
lastmod: 2012-03-20T15:28:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07007"
mailinglist_parent_id: "msg07004"
author_name: "Michael Clemmons"
project_section: "mailinglistitem"
sent_date: 2012-03-20T15:28:41-07:00
---


[apologies for the delay on this email sent to armon only first]

I'm having similar issues on a testing cluster for 1.1.1rc1. I'm having 1
out of 4 nodes failing multiple times and not restarting well, there are
like 100 pending transfers. Only thing node is failing. I've stopped
pointing traffic at the nodes and have attempted to remove this machine
from the cluster.
Its slowly leaving but is moving very slowly for not much data, the
metadata is important and loosing any would be a significant time
consumer(but obviously not vital since we used a day old build).
What the likely hood that pull request will make it into a deb build in the
near future or will the make file generate a deb?
-Michael

On Mon, Mar 19, 2012 at 11:40 AM, Armon Dadgar wrote:

&gt; Okay, good to know this is a known issue. I attached the
&gt; logs for the last time this occurred in my original email.
&gt;
&gt; I'll try to capture this information if the problem occurs again.
&gt; Thanks.
&gt;
&gt; Best Regards,
&gt;
&gt; Armon Dadgar
&gt;
&gt; On Mar 19, 2012, at 11:36 AM, Jon Meredith wrote:
&gt;
&gt; Hi Armon,
&gt;
&gt; We've recently patched an issue that affects handoffs here
&gt; https://github.com/basho/riak\\_core/pull/153
&gt;
&gt; If the issue repeats for you, as well as the logs it would be very useful
&gt; if you could follow the instructions from the pull request above ro the
&gt; 'riak\\_core\\_handoff\\_manager:status().' command against all nodes.
&gt;
&gt; The pull request works around an issue where it looks like the kernel has
&gt; closed a socket (no evidence of it any longer with netstat/ss) but the
&gt; erlang process is still stuck in an receive call from it (gen\\_tcp:recv/2 to
&gt; be more precise).
&gt;
&gt; Please let us know if you hit it again.
&gt;
&gt; Best, Jon.
&gt;
&gt; On Mon, Mar 19, 2012 at 12:10 PM, Armon Dadgar wrote:
&gt;
&gt;&gt; I wanted to ping the mailing list and see if anybody else has encountered
&gt;&gt; stalls in the partition handoffs on Riak 1.1. We added a new node to our
&gt;&gt; cluster
&gt;&gt; last Friday, but noticed that the partition handoffs appear to have
&gt;&gt; stopped
&gt;&gt; after about 7-8 hours.
&gt;&gt;
&gt;&gt; Most of the handoffs completed, and the only handoffs that remained were
&gt;&gt; from node 3 to node 2.
&gt;&gt; The ring claimant (node 1), indicated that node 3 was unreachable (via
&gt;&gt; ring\\_status).
&gt;&gt; However, Riak control did not indicate that node 3 was unreachable, and
&gt;&gt; in fact it was
&gt;&gt; actually live and continuing to serve request.
&gt;&gt;
&gt;&gt; To resolve this, I tried to just restart node 3. I ran "riak stop"
&gt;&gt; multiple times, but this did
&gt;&gt; not actually seem to do anything (The node was continuing to run and
&gt;&gt; serve requests).
&gt;&gt; Next, I attached to the node and ran "init:stop()." This started to shut
&gt;&gt; down various
&gt;&gt; sub-systems, but the node was still running. Sending a SIGTERM signal to
&gt;&gt; the beam vm
&gt;&gt; finally killed it. Restarting the node with "riak start" worked as
&gt;&gt; expected,
&gt;&gt; and the node promptly resumed the handoffs, and finished in a few hours.
&gt;&gt;
&gt;&gt; I'm not sure exactly what the issue was, but something seemed to cause a
&gt;&gt; stalling of the handoffs.
&gt;&gt;
&gt;&gt; I've attached the contents of our console.log, erlang.log, error.log and
&gt;&gt; crash.log
&gt;&gt; from the relevant times if that is useful.
&gt;&gt;
&gt;&gt; Best Regards,
&gt;&gt;
&gt;&gt; Armon Dadgar
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Jon Meredith
&gt; Platform Engineering Manager
&gt; Basho Technologies, Inc.
&gt; jmered...@basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
-Michael
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

