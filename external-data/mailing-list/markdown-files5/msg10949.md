---
title: "Re: \"expected_binaries\" error in search"
description: ""
project: community
lastmod: 2013-04-22T14:13:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10949"
mailinglist_parent_id: "msg10928"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2013-04-22T14:13:40-07:00
---


Rob,

I reproduced this at the command line. Here I'm storing two documents, with
&gt; IDs 'doc8' and 'doc9', into a search-enabled bucket named 'test-search'.
&gt;
&gt; # This command works, even though 'lsh' is empty. I believe this is
&gt; because I've never put a field named 'lsh' in this bucket, 'test-search'.
&gt; curl -v -XPUT -H "Content-Type: application/json" -d '{"terms": "empty|en
&gt; string|en test|en", "lsh": "", "segments": "d do doc docs"}' '
&gt; http://riak.lumi:8098/riak/test-search/doc8?returnbody=true'
&gt;
&gt; # However, if I use the empty string for a field that has ever been
&gt; indexed before, \\*then\\* I get a crash.
&gt; curl -v -XPUT -H "Content-Type: application/json" -d '{"terms": "",
&gt; "segments": "d do doc docs"}' '
&gt; http://riak.lumi:8098/riak/test-search/doc9?returnbody=true'
&gt;

I copy/pasted your commands and could not reproduce. Both docs indexed
correctly and were returned when running the following search. However,
the reason this works is because it's going through KV and using the commit
hook to index. The error you originally pasted is from data being indexed
via the Riak Search Solr endpoint. They are two different things.

As it turns out there is a bug(?) in the Solr end-point. It doesn't like
empty fields. E.g. if I send the following XML I can reproduce the error.

---
xml version="1.0" encoding="UTF-8"?


docA
empty|en string|en test|en

d do doc docs


---

To confirm, here's what I see in the log:

2013-04-22 17:02:56.394 [error]
&lt;0.4452.0&gt;@riak\\_solr\\_indexer\\_wm:malformed\\_request:37 Unable to parse
request: {expected\\_binaries,&lt;&lt;"lsh"&gt;&gt;,[]}

I filed an issue: https://github.com/basho/riak\\_search/issues/141



&gt;
&gt; As requested, I typed that redbug command into the Erlang console, and at
&gt; the moment of the crash I get some output. The output baffles me, though.
&gt; The included ID is in the style of ID we use for actual documents, which
&gt; are stored in totally different buckets, and which I didn't refer to at all
&gt; in my testing.
&gt;

My guess is you tested this on the system while other writes were coming
in. This is what redbug is picking up.

-Z
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

