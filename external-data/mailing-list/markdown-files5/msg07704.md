---
title: "Re: 2i performance questions"
description: ""
project: community
lastmod: 2012-06-18T09:08:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07704"
mailinglist_parent_id: "msg07702"
author_name: "Tom Burdick"
project_section: "mailinglistitem"
sent_date: 2012-06-18T09:08:48-07:00
---


Hi Ryan,

I appreciate the response and look forward to seeing 2i rock harder
than ever before with all the changes you guys are pushing in.

I did make a mistake in my benchmark, and in reality it was closer to
70 req/s that I was getting across my concurrent erlang benchmark
workers.

HTTP got me in to the 350 - 400 req/s range which is significantly
better, using ab -n 1000 -c 10

Looking forward to seeing 2i be very fast!

-Tom

On Mon, Jun 18, 2012 at 9:26 AM, Ryan Zezeski  wrote:
&gt; Hi Tom, response inline.
&gt;
&gt; On Thu, Jun 14, 2012 at 3:29 PM, Tom Burdick  wrote:
&gt;
&gt;&gt;
&gt;&gt; retrieve\\_by\\_client(Db, Key) when is\\_binary(Key) -&gt;
&gt;&gt;    {ok, BKeys} = riakc\\_pb\\_socket:get\\_index(Db, ?bucket,
&gt;&gt; &lt;&lt;"client\\_id\\_bin"&gt;&gt;, Key),
&gt;&gt;    lists:map(fun([\\_Bucket, Key0]) -&gt;
&gt;&gt;        Key0
&gt;&gt;    end, BKeys).
&gt;&gt;
&gt;&gt; What I've noticed while benchmarking the put is that that is actually
&gt;&gt; quite fast and I can do that
&gt;&gt; at a pretty high rate even on my devrel setup, like 1000 puts/sec.
&gt;&gt;
&gt;&gt; However when doing retrieve\\_by\\_client at most I've seen 20
&gt;&gt; get\\_indexes/sec with latencies all over the place from a few
&gt;&gt; milliseconds up to a few seconds.
&gt;
&gt; I notice you're using the Erlang PB client.  This is the client we
&gt; recommend but a current shortfall of it re 2i is that it unnecessarily
&gt; uses map/reduce to collate the results.
&gt;
&gt; Bryan Find recently made some changes to Pipe, the system behind
&gt; map/reduce, that should improve latencies for queries that match
&gt; "larger" result sets.  How large I'm not sure, but the larger the
&gt; result set the more of an improvement you'll see is what I'm told.
&gt;
&gt; Sean Cribbs recently made some change to our protobuffs server that
&gt; will allow direct querying of 2i without the use of map/reduce.  IMO
&gt; this should greatly reduce your latencies.  However, the various
&gt; clients still need to be modified to take advantage of this.  I defer
&gt; to Sean on when that might be done.
&gt;
&gt; In the meantime you could try changing your query code to use the HTTP
&gt; interface and see if that brings you better latency.
&gt;
&gt; Oh, I just remember, Matthew Von-Maszewski has made some amazing
&gt; strides in our branch of leveldb in terms of
&gt; latency/throughput/robustness and that should result in trickle-down
&gt; improvements as well.
&gt;
&gt; All these changes, with the exception of the client modifications,
&gt; should be coming with our next release, 1.2.
&gt;
&gt;&gt;
&gt;&gt; I'm tempted to fire up fprof on Client:get\\_index just to see whats up
&gt;&gt; but I'm a bit scared at what I might see there :-)
&gt;
&gt; Feel free to fprof, my guess is most of the time will be spent in
&gt; map/reduce related code.  The other place 2i spends a majority of it's
&gt; time is sext decoding.
&gt;
&gt; -Z

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

