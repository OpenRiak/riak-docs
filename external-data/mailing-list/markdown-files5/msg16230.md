---
title: "Re: LevelDB"
description: ""
project: community
lastmod: 2015-06-08T09:42:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16230"
mailinglist_parent_id: "msg16227"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2015-06-08T09:42:06-07:00
---


Odd.

The tree builds fine, including the lock file, once the config was good:

/mnt
├── fast
│ └── leveldb
│ ├── 0
│ │ ├── CURRENT
│ │ ├── LOCK
│ │ ├── LOG
│ │ ├── MANIFEST-000002
│ │ ├── sst\\_0
│ │ ├── sst\\_1
│ │ ├── sst\\_2
│ │ └── sst\\_3
│ ├── 1096126227998177188652763624537212264741949407232
│ │ ├── CURRENT
│ │ ├── LOCK
│ │ ├── LOG
│ │ ├── MANIFEST-000002
│ │ ├── sst\\_0
│ │ ├── sst\\_1
│ │ ├── sst\\_2
│ │ └── sst\\_3

├── slow
│ └── leveldb
│ ├── 0
│ │ ├── sst\\_4
│ │ ├── sst\\_5
│ │ └── sst\\_6
│ ├── 1096126227998177188652763624537212264741949407232
│ │ ├── sst\\_4
│ │ ├── sst\\_5
│ │ └── sst\\_6

What, if anything is Riak building in your tree? Again, I had to create the 
leveldb directory in each path manually. Did a chmod a+rwx on directories 
fast, slow, fast/leveldb, and slow/leveldb. Then started the code and waited.

I was getting your LOCK crash before I added the data\\_root line to the config.

Matthew

P.S. It may be hours before I respond again. Heading to the airport now.


&gt; On Jun 8, 2015, at 12:24 PM, Joe Olson  wrote:
&gt; 
&gt; Also, I am testing as follows: make the changes to riak.conf, start riak as 
&gt; root,wait a few minutes and issue a 'riak ping' as root. Riak usually starts 
&gt; for 10-15 seconds, and then crashes (doesn't respond to the ping anymore)
&gt; 
&gt; 
&gt; 
&gt; From: "Joe Olson" 
&gt; To: "Matthew Von-Maszewski" 
&gt; Sent: Monday, June 8, 2015 11:22:24 AM
&gt; Subject: Re: LevelDB
&gt; 
&gt; I think our email just crossed each other. Let me try again.
&gt; 
&gt; 
&gt; 
&gt; From: "Joe Olson" 
&gt; To: "Matthew Von-Maszewski" 
&gt; Cc: "riak-users" 
&gt; Sent: Monday, June 8, 2015 11:21:26 AM
&gt; Subject: Re: LevelDB
&gt; 
&gt; Matt - thanks for the support.
&gt; 
&gt; Adding
&gt; leveldb.data\\_root=“./leveldb”
&gt; 
&gt; results in
&gt; "IO error: 
&gt; /mnt/fast/./leveldb/91343852333181432387730302044767688728495783936/LOCK: No 
&gt; such file or directory"
&gt; 
&gt; Changing it to 
&gt; leveldb.data\\_root=“leveldb”
&gt; 
&gt; results in 
&gt; "IO error: 
&gt; /mnt/fast/leveldb/91343852333181432387730302044767688728495783936/LOCK: No 
&gt; such file or directory"}
&gt; 
&gt; Running "riak start" as root has no effect, and I also double checked the 
&gt; directory permissions. I also manually created the leveldb subdirectory. 
&gt; Still get the same results.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; From: "Matthew Von-Maszewski" 
&gt; To: "Joe Olson" 
&gt; Cc: "riak-users" 
&gt; Sent: Monday, June 8, 2015 10:56:24 AM
&gt; Subject: Re: LevelDB
&gt; 
&gt; Joe,
&gt; 
&gt; Long story short, I am slowly rebuilding my debug setup. Taking longer than 
&gt; I thought. I suspect, but have not yet verified, that if you add one more 
&gt; line:
&gt; 
&gt; leveldb.data\\_root=“./leveldb”
&gt; 
&gt; … your troubles will go away. If you test that before I do, let me know your 
&gt; results. I will get the documentation updated if it works.
&gt; 
&gt; Matthew
&gt; 
&gt; 
&gt; On Jun 8, 2015, at 10:37 AM, Joe Olson  &gt; wrote:
&gt; 
&gt; 
&gt; 
&gt; Here you go. Thanks for the help. My riak.conf is mostly stock, except for 
&gt; the LevelDB changes.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; From: "Matthew Von-Maszewski" &gt;
&gt; To: "Mr. Technology" &gt;
&gt; Cc: "riak-users"  &gt;
&gt; Sent: Saturday, June 6, 2015 9:08:00 AM
&gt; Subject: Re: LevelDB
&gt; 
&gt; There is a script macro that puts paths together during program start. I 
&gt; will go look at that.
&gt; 
&gt; It would help if you would send your riak.conf file.
&gt; 
&gt; Matthew
&gt; 
&gt; 
&gt; On Jun 5, 2015, at 7:48 PM, Mr. Technology  &gt; wrote:
&gt; 
&gt; After installing Riak 2.1.1 on a 5 node Centos7 based test cluster, I 
&gt; followed the instructions at 
&gt; http://docs.basho.com/riak/latest/ops/advanced/backends/leveldb/ 
&gt;  to attempt 
&gt; to configure a tiered LevelDB backend.
&gt; 
&gt; My /etc/riak/riak.conf:
&gt; 
&gt; storage\\_backend = leveldb
&gt; leveldb.tiered = 4
&gt; leveldb.tiered.path.fast = /mnt/fast
&gt; leveldb.tiered.path.slow = /mnt/slow
&gt; 
&gt; Upon start, riak crashes with the following message in the log:
&gt; 
&gt; \\*\\* 
&gt; {function\\_clause,[{riak\\_kv\\_vnode,terminate,[{bad\\_return\\_value,{stop,{db\\_open,"IO
&gt; error: 
&gt; /mnt/fast//var/lib/riak/leveldb/159851741583067506678528028578343455274867621888/LOCK:
&gt; No such file or 
&gt; directory"}}},undefined],[{file,"src/riak\\_kv\\_vnode.erl"},{line,1155}]},{riak\\_core\\_vnode,terminate,3,[{file,"src/riak\\_core\\_vnode.erl"},{line,907}]},{gen\\_fsm,terminate,7,[{file,"gen\\_fsm.erl"},{line,597}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,239}]}]}
&gt; 
&gt; I assume the error is due to riak trying to write to the bogus path:
&gt; 
&gt; /mnt/fast//var/lib/riak/leveldb/159851741583067506678528028578343455274867621888/LOCK
&gt; 
&gt; (bogus due to the double slash above)
&gt; 
&gt; Is this a bug, erroneous documentation, or a configuration problem?? I 
&gt; followed the example as closely as I could.
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

