---
title: "Re: Urgent help with a down node."
description: ""
project: community
lastmod: 2013-07-08T09:05:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11418"
mailinglist_parent_id: "msg11417"
author_name: "John Caprice"
project_section: "mailinglistitem"
sent_date: 2013-07-08T09:05:00-07:00
---


Bryan,

Anything that interrupts the writing to or closing of that file can cause
this. This could be i/o errors related to the file system or the disk, a
Riak crash or kill etc. If you see this happen regularly it would be an
issue worth investigating.

Thanks,

John


On Mon, Jul 8, 2013 at 8:54 AM, Bryan Hughes  wrote:

&gt; Hi John,
&gt;
&gt; Thank you! Can you give any insight as to what is the cause of the
&gt; problem, or point me to any Basho Documentation detailing this?
&gt;
&gt; Cheers,
&gt; Bryan
&gt;
&gt;
&gt; On 7/8/13 8:22 AM, John Caprice wrote:
&gt;
&gt; Hey Bryan,
&gt;
&gt; This indicates a problem with the Bitcask data file. That data file,
&gt; according to the second error report, was truncated. You more than likely
&gt; did not experience any data loss as this would affect only a single
&gt; replica, and only those contained in that data file. To be safe, you can
&gt; repair the partition by attaching to Riak and running:
&gt;
&gt; riak\\_kv:repair(22835963083295358096932575511191922182123945984).
&gt;
&gt; after which you can detach from Riak with ctrl-d and monitor the status
&gt; of the repair in riak-admin transfers. This command will read-repair any
&gt; lost replicas due to the data file truncation.
&gt;
&gt; Thanks,
&gt;
&gt; John Caprice
&gt;
&gt;
&gt; On Mon, Jul 8, 2013 at 8:11 AM, Bryan Hughes  wrote:
&gt;
&gt;&gt; Andrew,
&gt;&gt;
&gt;&gt; Thanks for the tip on how to use Google. :) But that was not my
&gt;&gt; original question. I wanted to understand in more detail from the Basho
&gt;&gt; folks what
&gt;&gt;
&gt;&gt; 2013-07-07 12:51:42 =ERROR REPORT====
&gt;&gt; Hintfile
&gt;&gt; './data/bitcask/22835963083295358096932575511191922182123945984/3.bitcask.hint'
&gt;&gt; contains pointer 16555635 566 that is greater than total data size 16556032
&gt;&gt;
&gt;&gt; and
&gt;&gt;
&gt;&gt;
&gt;&gt; 2013-07-07 12:54:43 =ERROR REPORT====
&gt;&gt; Bad datafile entry, discarding(383/566 bytes)
&gt;&gt;
&gt;&gt; meant to my system. For example, did I lose data and if so, how do I
&gt;&gt; know what data was lost? More importantly is if this is data lost, how did
&gt;&gt; it happen. I ran fsck on all the disks and checked the health of the
&gt;&gt; system - which is all good.
&gt;&gt;
&gt;&gt; The later information was included for completeness.
&gt;&gt;
&gt;&gt; Bryan
&gt;&gt;
&gt;&gt;
&gt;&gt; On 7/8/13 12:49 AM, Andrew Berman wrote:
&gt;&gt;
&gt;&gt; Bryan,
&gt;&gt;
&gt;&gt; What version of Erlang? You should check this out:
&gt;&gt; https://github.com/basho/riak\\_kv/issues/411
&gt;&gt;
&gt;&gt; BTW - Google is your friend, which is how I found the above issue :)
&gt;&gt;
&gt;&gt; --Andrew
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sun, Jul 7, 2013 at 3:01 PM, Bryan Hughes wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Mark,
&gt;&gt;&gt;
&gt;&gt;&gt; DOH - sorry for the lack of detail. Didnt have enough coffee this
&gt;&gt;&gt; morning.
&gt;&gt;&gt;
&gt;&gt;&gt; OS: CentOS release 6.3 (Final)
&gt;&gt;&gt; Riak: Riak 1.2.1
&gt;&gt;&gt;
&gt;&gt;&gt; Hadnt had a chance to upgrade to 1.3 yet.
&gt;&gt;&gt;
&gt;&gt;&gt; Got the node back up - but not entirely sure why which is a little
&gt;&gt;&gt; concerning. Been verifying the data, and everything looks intact. When I
&gt;&gt;&gt; try to run riak-admin status, I get the following (note I am not entirely
&gt;&gt;&gt; sure this was the case when we first set the node up):
&gt;&gt;&gt;
&gt;&gt;&gt; $ riak-admin status
&gt;&gt;&gt; Status failed, see log for details
&gt;&gt;&gt;
&gt;&gt;&gt; The logs shows:
&gt;&gt;&gt;
&gt;&gt;&gt; 2013-07-07 14:55:03.858 [error] &lt;0.12982.0&gt;@riak\\_kv\\_console:status:173
&gt;&gt;&gt; Status failed error:function\\_clause
&gt;&gt;&gt; 2013-07-07 14:55:03.858 [error] emulator Error in process &lt;0.12983.0&gt; on
&gt;&gt;&gt; node 'riak@127.0.0.1' with exit value:
&gt;&gt;&gt; {badarg,[{erlang,system\\_info,[global\\_heaps\\_size],[]},{riak\\_kv\\_stat,system\\_stats,0,[{file,"src/riak\\_kv\\_stat.erl"},{line,421}]},{riak\\_kv\\_stat,produce\\_stats,0,[{file,"src/riak\\_kv\\_stat.erl"},{line,320}]},{timer,tc,3,[{file,"timer...
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; This is on a dev cluster with an out-of-the box configuration using
&gt;&gt;&gt; bitcask.
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks!
&gt;&gt;&gt;
&gt;&gt;&gt; Bryan
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 7/7/13 2:51 PM, Mark Phillips wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Bryan,
&gt;&gt;&gt;
&gt;&gt;&gt; I remember seeing something similar on the list a while ago. I'll dig
&gt;&gt;&gt; through the archives (Riak.markmail.org) if I have a few minutes later
&gt;&gt;&gt; tonight.
&gt;&gt;&gt;
&gt;&gt;&gt; In the mean time, what version of Riak is this? And what OS?
&gt;&gt;&gt;
&gt;&gt;&gt; Mark
&gt;&gt;&gt;
&gt;&gt;&gt; On Sunday, July 7, 2013, Bryan Hughes wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Anyone familiar with this error message?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2013-07-07 12:51:42 =ERROR REPORT====
&gt;&gt;&gt;&gt; Hintfile
&gt;&gt;&gt;&gt; './data/bitcask/22835963083295358096932575511191922182123945984/3.bitcask.hint'
&gt;&gt;&gt;&gt; contains pointer 16555635 566 that is greater than total data size 16556032
&gt;&gt;&gt;&gt; 2013-07-07 12:51:45 =ERROR REPORT====
&gt;&gt;&gt;&gt; Hintfile
&gt;&gt;&gt;&gt; './data/bitcask/114179815416476790484662877555959610910619729920/3.bitcask.hint'
&gt;&gt;&gt;&gt; contains pointer 17817310 567 that is greater than total data size
&gt;&gt;&gt;&gt; 17817600
&gt;&gt;&gt;&gt; 2013-07-07 12:51:46 =ERROR REPORT====
&gt;&gt;&gt;&gt; Hintfile
&gt;&gt;&gt;&gt; './data/bitcask/159851741583067506678528028578343455274867621888/3.bitcask.hint'
&gt;&gt;&gt;&gt; contains pointer 7573448 567 that is greater than total data size
&gt;&gt;&gt;&gt; 7573504
&gt;&gt;&gt;&gt; 2013-07-07 12:51:46 =ERROR REPORT====
&gt;&gt;&gt;&gt; Bad datafile entry 1:
&gt;&gt;&gt;&gt; {ok,&lt;&lt;131,104,2,109,0,0,0,9,65,80,73,67,79,85,78,84,83,109,0,0,0,33,55,56,54,57,52,49,56,49,94,103,111,115,101,114,118,105,99,101,95,99&gt;&gt;}
&gt;&gt;&gt;&gt; 2013-07-07 12:51:56 =ERROR REPORT====
&gt;&gt;&gt;&gt; Hintfile
&gt;&gt;&gt;&gt; './data/bitcask/730750818665451459101842416358141509827966271488/3.bitcask.hint'
&gt;&gt;&gt;&gt; contains pointer 13229833 581 that is greater than total data size 13230080
&gt;&gt;&gt;&gt; 2013-07-07 12:52:05 =ERROR REPORT====
&gt;&gt;&gt;&gt; Hintfile
&gt;&gt;&gt;&gt; './data/bitcask/1187470080331358621040493926581979953470445191168/3.bitcask.hint'
&gt;&gt;&gt;&gt; contains pointer 23465420 578 that is greater than total data size 23465984
&gt;&gt;&gt;&gt; 2013-07-07 12:52:06 =ERROR REPORT====
&gt;&gt;&gt;&gt; Hintfile
&gt;&gt;&gt;&gt; './data/bitcask/1210306043414653979137426502093171875652569137152/3.bitcask.hint'
&gt;&gt;&gt;&gt; contains pointer 27733824 578 that is greater than total data size 27734016
&gt;&gt;&gt;&gt; 2013-07-07 12:52:07 =ERROR REPORT====
&gt;&gt;&gt;&gt; Hintfile
&gt;&gt;&gt;&gt; './data/bitcask/1233142006497949337234359077604363797834693083136/3.bitcask.hint'
&gt;&gt;&gt;&gt; contains pointer 15014008 578 that is greater than total data size
&gt;&gt;&gt;&gt; 15014586
&gt;&gt;&gt;&gt; 2013-07-07 12:54:43 =ERROR REPORT====
&gt;&gt;&gt;&gt; Bad datafile entry, discarding(383/566 bytes)
&gt;&gt;&gt;&gt; 2013-07-07 12:54:45 =ERROR REPORT====
&gt;&gt;&gt;&gt; Bad datafile entry, discarding(276/567 bytes)
&gt;&gt;&gt;&gt; 2013-07-07 12:54:46 =ERROR REPORT====
&gt;&gt;&gt;&gt; Bad datafile entry, discarding(42/567 bytes)
&gt;&gt;&gt;&gt; 2013-07-07 12:54:57 =ERROR REPORT====
&gt;&gt;&gt;&gt; Bad datafile entry, discarding(233/581 bytes)
&gt;&gt;&gt;&gt; 2013-07-07 12:55:06 =ERROR REPORT====
&gt;&gt;&gt;&gt; Bad datafile entry, discarding(550/578 bytes)
&gt;&gt;&gt;&gt; 2013-07-07 12:55:07 =ERROR REPORT====
&gt;&gt;&gt;&gt; Bad datafile entry, discarding(178/578 bytes)
&gt;&gt;&gt;&gt; 2013-07-07 12:56:00 =ERROR REPORT====
&gt;&gt;&gt;&gt; Error in process &lt;0.1536.0&gt; on node 'riak@127.0.0.1' with exit value:
&gt;&gt;&gt;&gt; {badarg,[{erlang,system\\_info,[global\\_heaps\\_size],[]},{riak\\_kv\\_stat,system\\_stats,0,[{file,"src/riak\\_kv\\_stat.erl"},{line,421}]},{riak\\_kv\\_stat,produce\\_stats,0,[{file,"src/riak\\_kv\\_stat.erl"},{line,320}]},{timer,tc,3,[{file,"timer...
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Bryan Hughes
&gt;&gt;&gt;&gt; \\*Go Factory\\*
&gt;&gt;&gt;&gt; http://www.go-factory.net
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\*"Internet Class, Enterprise Grade"\\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt;
&gt;&gt;&gt; Bryan Hughes
&gt;&gt;&gt; CTO and Founder / \\*Go Factory\\*
&gt;&gt;&gt; (415) 515-7916
&gt;&gt;&gt;
&gt;&gt;&gt; http://www.go-factory.net
&gt;&gt;&gt;
&gt;&gt;&gt; \\*"Internet Class, Enterprise Grade"\\*
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

