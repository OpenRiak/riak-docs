---
title: "Re: Truncated bit-cask files"
description: ""
project: community
lastmod: 2017-02-14T08:56:47-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17980"
mailinglist_parent_id: "msg17979"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2017-02-14T08:56:47-08:00
---


Arun,

The AAE code uses leveldb for its storage of anti-entropy data, no matter which 
backend holds the user data. Therefore the error below suggests corruption 
within leveldb files (which is not impossible, but becoming really rare except 
with bad hardware or full disks).

Before wiping out the AAE directory, you should copy the LOG file within it. 
There are likely more useful error messages within that file ... maybe put the 
file in drop box or zip attach to a reply for us to review.

Matthew

&gt; On Feb 14, 2017, at 10:42 AM, Magnus Kessler  wrote:
&gt; 
&gt; On 14 February 2017 at 14:46, Arun Rajagopalan  &gt; wrote:
&gt; Hi Magnus
&gt; 
&gt; RIAK crashes on startup when I have trucated bitcask file
&gt; 
&gt; It also crashes when the AAE files are bad too I think. Example below
&gt; 
&gt; 2017-02-13 21:18:30 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\\_kv\\_index\\_hashtree:init/1
&gt; pid: &lt;0.6037.0&gt;
&gt; registered\\_name: []
&gt; exception exit: {{{badmatch,{error,{db\\_open,"Corruption: truncated record 
&gt; at end of file"}}},[{hashtree,new\\_segment\\_
&gt; store,2,[{file,"src/hashtree.erl"},{line,675}]},{hashtree,new,2,[{file,"src/hashtree.erl"},{line,246}]},{riak\\_kv\\_index\\_h
&gt; ashtree,do\\_new\\_tree,3,[{file,"src/riak\\_kv\\_index\\_hashtree.erl"},{line,610}]},{lists,foldl,3,[{file,"lists.erl"},{line,124
&gt; 8}]},{riak\\_kv\\_index\\_hashtree,init\\_trees,3,[{file,"src/riak\\_kv\\_index\\_hashtree.erl"},{line,474}]},{riak\\_kv\\_index\\_hashtree,
&gt; init,1,[{file,"src/riak\\_kv\\_index\\_hashtree.erl"},{line,268}]},{gen\\_server,init\\_it,6,[{file,"gen\\_server.erl"},{line,304}]}
&gt; ,{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,239}]}]},[{gen\\_server,init\\_it,6,[{file,"gen\\_server.erl"},{line
&gt; ,328}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,239}]}]}
&gt; ancestors: [&lt;0.715.0&gt;,riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.160.0&gt;]
&gt; messages: []
&gt; links: []
&gt; dictionary: []
&gt; trap\\_exit: false
&gt; status: running
&gt; heap\\_size: 1598
&gt; stack\\_size: 27
&gt; reductions: 889
&gt; neighbours:
&gt; 
&gt; 
&gt; Regards
&gt; Arun
&gt; 
&gt; 
&gt; Hi Arun,
&gt; 
&gt; The crash log you provided shows that there is a corrupted file in the AAE 
&gt; (anti\\_entropy) backend. Entries in console.log should have more information 
&gt; about which partition is affected. Please post output from the affected node 
&gt; at around 2017-02-13T21:18:30. As this is AAE data, it is safe to remove the 
&gt; directory named after the affected partition from the active\\_entropy 
&gt; directory before restarting the node. You may find that there is more than 
&gt; one affected partition, the next of which will be encountered after the 
&gt; attempted restart only. If this is the case, simply identify the next 
&gt; partition in the same way and remove it, too, until the node starts up 
&gt; successfully again.
&gt; 
&gt; Is there a reason why the nodes aren't shut down in the regular way?
&gt; 
&gt; Kind Regards,
&gt; 
&gt; Magnus
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Magnus Kessler
&gt; Client Services Engineer
&gt; Basho Technologies Limited
&gt; 
&gt; Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

