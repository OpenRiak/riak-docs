---
title: "Re: Initializing a commit hook"
description: ""
project: community
lastmod: 2016-11-18T15:05:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17769"
mailinglist_parent_id: "msg17768"
author_name: "Mav erick"
project_section: "mailinglistitem"
sent_date: 2016-11-18T15:05:20-08:00
---


Here you go ...

For the second url - I think you meant testbucket without the hyphen, Also
I think you have an extra "props" in there





\\* Hostname was NOT found in DNS cache
\\* Trying 127.0.0.1...
\\* Connected to localhost (127.0.0.1) port 8098 (#0)
&gt; GET /types/maps/props HTTP/1.1
&gt; User-Agent: curl/7.35.0
&gt; Host: localhost:8098
&gt; Accept: \\*/\\*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Vary: Accept-Encoding
\\* Server MochiWeb/1.1 WebMachine/1.10.6 (no drinks) is not blacklisted
&lt; Server: MochiWeb/1.1 WebMachine/1.10.6 (no drinks)
&lt; Date: Fri, 18 Nov 2016 22:27:56 GMT
&lt; Content-Type: application/json
&lt; Content-Length: 545
&lt;
\\* Connection #0 to host localhost left intact
{"props":{"active":true,"allow\\_mult":true,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod"
:"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"claimant":"riak@10.243.44.165
","datatype":"map","dvv\\_en
abled":true,"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"m
apreduce\\_linkfun"},"n\\_val":3,"notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit
":[{"mod":"commit\\_hooks","fun":"precommit\\_hook"
}],"pw":0,"r":"quorum","rw":"quorum","smal
l\\_vclock":50,"w":"quorum","young\\_vclock":20}}


and ...

$ curl -4vvv localhost:8098/types/maps/props/buckets/testbucket/props
\\* Hostname was NOT found in DNS cache
\\* Trying 127.0.0.1...
\\* Connected to localhost (127.0.0.1) port 8098 (#0)
&gt; GET /types/maps/props/buckets/testbucket/props HTTP/1.1
&gt; User-Agent: curl/7.35.0
&gt; Host: localhost:8098
&gt; Accept: \\*/\\*
&gt;
&lt; HTTP/1.1 404 Object Not Found
\\* Server MochiWeb/1.1 WebMachine/1.10.6 (no drinks) is not blacklisted
&lt; Server: MochiWeb/1.1 WebMachine/1.10.6 (no drinks)
&lt; Date: Fri, 18 Nov 2016 22:57:51 GMT
&lt; Content-Type: text/html
&lt; Content-Length: 193
&lt;
\\* Connection #0 to host localhost left intact
404 Not FoundNot Found
=========

The
requested document was no
t found on this server.

---

mochiweb+webmachine web
server

$


with the corrected url
$ curl -4vvv localhost:8098/types/maps/buckets/testbucket/props
\\* Hostname was NOT found in DNS cache
\\* Trying 127.0.0.1...
\\* Connected to localhost (127.0.0.1) port 8098 (#0)
&gt; GET /types/maps//buckets/testbucket/props HTTP/1.1
&gt; User-Agent: curl/7.35.0
&gt; Host: localhost:8098
&gt; Accept: \\*/\\*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Vary: Accept-Encoding
\\* Server MochiWeb/1.1 WebMachine/1.10.6 (no drinks) is not blacklisted
&lt; Server: MochiWeb/1.1 WebMachine/1.10.6 (no drinks)
&lt; Date: Fri, 18 Nov 2016 22:59:22 GMT
&lt; Content-Type: application/json
&lt; Content-Length: 565
&lt;
\\* Connection #0 to host localhost left intact
{"props":{"name":"testbucket","active":true,"allow\\_mult":true,"basic\\_quorum":false,"big\\_vclock":
chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"claimant":"
riak@10.243.44.165",
atype":"map","dvv\\_enabled":true,"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_
ink\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"notfound\\_ok":true,"old\\_vclock":86400,"postcomm
[],"pr":0,"precommit":[{"mod":"commit\\_hooks","fun":"precommit\\_hook"}
],"pw":0,"r":"quo
,"rw":"quorum","small\\_vclock":50,"w":"quorum","young\\_vclock":20}}$





On 18 November 2016 at 17:23, Luke Bakken  wrote:

&gt; What is the output of these commands?
&gt;
&gt; curl -4vvv localhost:8098/types/maps/props
&gt;
&gt; curl -4vvv localhost:8098/types/maps/props/buckets/test-bucket/props
&gt;
&gt; On Fri, Nov 18, 2016 at 2:21 PM, Mav erick  wrote:
&gt; &gt; Luke
&gt; &gt;
&gt; &gt; I was able to change the properties with your URL, but still the hooks
&gt; are
&gt; &gt; not being called for typed buckets ONLY.
&gt; &gt;
&gt; &gt; The hook is being called for all buckets with no type. So I am sure that
&gt; &gt; riak can find the beam file on all my nodes.
&gt; &gt;
&gt; &gt; I tried restarting riak on all nodes. Still same problem. The hook is
&gt; called
&gt; &gt; for buckets without a type, but wont be called for buckets with a type
&gt; &gt;
&gt; &gt;
&gt; &gt; On 18 November 2016 at 16:45, Luke Bakken  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Mav -
&gt; &gt;&gt;
&gt; &gt;&gt; You're not using the correct HTTP URL. You can use this command:
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; http://docs.basho.com/riak/kv/2.1.4/using/reference/bucket-
&gt; types/#updating-a-bucket-type
&gt; &gt;&gt;
&gt; &gt;&gt; Or this URL:
&gt; &gt;&gt;
&gt; &gt;&gt; curl -XPUT localhost:8098/types/maps/props -H 'Content-Type:
&gt; &gt;&gt; application/json' -d
&gt; &gt;&gt; '{"props":{"precommit":[{"mod":"myhooks","fun":"precommit\\_hook"}]}}'
&gt; &gt;&gt;
&gt; &gt;&gt; Please ensure that the "myhooks" beam file is on all Riak servers in a
&gt; &gt;&gt; directory that will be picked up by Riak when it starts:
&gt; &gt;&gt;
&gt; &gt;&gt; http://docs.basho.com/riak/kv/2.1.4/using/reference/custom-code/
&gt; &gt;&gt;
&gt; &gt;&gt; --
&gt; &gt;&gt; Luke Bakken
&gt; &gt;&gt; Engineer
&gt; &gt;&gt; lbak...@basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

