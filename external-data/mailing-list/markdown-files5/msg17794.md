---
title: "Re: Query data with Riak TS"
description: ""
project: community
lastmod: 2016-12-01T23:44:39-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17794"
mailinglist_parent_id: "msg17745"
author_name: "Stephen Etheridge"
project_section: "mailinglistitem"
sent_date: 2016-12-01T23:44:39-08:00
---


Jan,

What you want to do to calculate the "average" is not supported in the
subset of SQL available currently through Riak TS. However, it is an easy
operation with a small script using one of the supported client libraries.

I personally use the Python client library for all the demonstrations etc.
that I create and your calculation would be a very simple operation with a
results set from Riak TS which is returned as a DataFrame object which
through the Python Pandas library offers a number of one-line methods to
calculate "averages".

Regards
Stephen

On 14 November 2016 at 16:05, Andrei Zavada 
wrote:

&gt;
&gt;
&gt; On Mon, Nov 14, 2016 at 5:44 PM, Jan Paulus 
&gt; wrote:
&gt;
&gt;&gt; Hello Andrei,
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; thanks for the answer. It is good news that 1.5 will get the ODER BY and
&gt;&gt; LIMIT functionality.
&gt;&gt;
&gt;&gt; Unfortunately the current AVG implementation is not exactly what we are
&gt;&gt; looking for. The current implementation will sum up all points in the time
&gt;&gt; range and will it divide by the number of points. Currently Riak TS return
&gt;&gt; 4.5 for my example. We are looking for an average which takes into account
&gt;&gt; how long a value was persistent.
&gt;&gt;
&gt;&gt; ​
&gt; This​ seems to be a peculiar requirement that Riak TS cannot accommodate
&gt; (sorry for not reading your explanation carefully enough). Indeed, the AVG
&gt; function operates on numeric values as isolated scalars, and has no
&gt; knowledge of how long each value has persisted.
&gt;
&gt;
&gt;&gt;
&gt;&gt; Kind Regards,
&gt;&gt;
&gt;&gt; Jan Paulus
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\*Von:\\* Andrei Zavada [mailto:azav...@contractor.basho.com]
&gt;&gt; \\*Gesendet:\\* Montag, 14. November 2016 16:19
&gt;&gt; \\*An:\\* Jan Paulus
&gt;&gt; \\*Cc:\\* riak-users@lists.basho.com
&gt;&gt; \\*Betreff:\\* Re: Query data with Riak TS
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Hello Jan,
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; R​eplying to your questions inline:​​
&gt;&gt;
&gt;&gt; ​
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; we are testing Riak TS for our Application right now. I have a couple of
&gt;&gt; question how to query the data. We are measuring electric power which comes
&gt;&gt; in in odd time intervals.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; 1. Is it possible to query the value which has been received bevor at a
&gt;&gt; given time? In other words: Get the current / last value of a series.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; In Riak TS 1.4 (the latest release), you still have to specify the exact
&gt;&gt; range ​in the WHERE clause. Because of that, if you are only interested
&gt;&gt; in a single record that was added last before a certain time, you have to
&gt;&gt; do some guesswork to arrive at the suitable boundaries. Depending on the
&gt;&gt; rate of data ingress, the selection returned may contain one, a few, too
&gt;&gt; many, or no results at all. One workaround is to issue a sequence of
&gt;&gt; SELECTs, starting from a small range, with the lower boundary of the range
&gt;&gt; progressively moved back until you have the last record included (and
&gt;&gt; hopefully not many previous records which you are going to discard anyway).
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; In 1.5, we will support ORDER BY and LIMIT clauses which will allow a
&gt;&gt; much simpler solution, e.g.:
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; SELECT value FROM table
&gt;&gt; WHERE time &gt; 0 AND time &lt; $now
&gt;&gt; ORDER BY value DESC LIMIT 1
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; 2. Is it possible to query the average in respect to time?
&gt;&gt; For instance you have such a measurement reading:
&gt;&gt; time | value
&gt;&gt; -----------------
&gt;&gt; 09:31 | 4
&gt;&gt; 10:02 | 6
&gt;&gt; 10:05 | 3
&gt;&gt; And you want to query the average from 10:00 to 10:10. I would expect a
&gt;&gt; value of 4.1
&gt;&gt; 4 \\* 20% + 6 \\* 30% + 3 \\* 50% = 4.1
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; ​It is definitely possible:​
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; ﻿⁠⁠⁠⁠SELECT AVG(val
&gt;&gt;
&gt;&gt; ​ue​
&gt;&gt;
&gt;&gt; ) FROM
&gt;&gt;
&gt;&gt; ​table
&gt;&gt;
&gt;&gt; ​
&gt;&gt;
&gt;&gt; WHERE time &gt;
&gt;&gt;
&gt;&gt; ​=​
&gt;&gt;
&gt;&gt; ​'​2016-11-22
&gt;&gt;
&gt;&gt; 10
&gt;&gt;
&gt;&gt; ​:00'​
&gt;&gt;
&gt;&gt; AND time &lt;
&gt;&gt;
&gt;&gt; ​'2016-11-22 ​
&gt;&gt;
&gt;&gt; ​10:10'​
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; ​Note that you can specify timestamp values in ISO8601 format:
&gt;&gt; http://docs.basho.com/riak/ts/1.4.0/using/timerepresentations
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; ​
&gt;&gt;
&gt;&gt; 3. Is it possible to query 15 minutes average values for the last day? I
&gt;&gt; would expect 96 values with the average as described in question 2.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; No, you will have to issue 96 separate queries, each similar to the one
&gt;&gt; in (2) but with a different 15-min range.​
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Thanks a lot.
&gt;&gt; Jan Paulus
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
{ "name" : "Stephen Etheridge",
 "title" : "Solution Architect, EMEA",
 "Organisation" : "Basho Technologies, Inc",
 "Telephone" : "07814 406662",
 "email" : "mailto:setheri...@basho.com",
 "github" : "http://github.com/datalemming",
 "twitter" : "@datalemming"}
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

