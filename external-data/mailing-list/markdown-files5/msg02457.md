---
title: "Re: tuning riak for 100s of concurrent connections"
description: ""
project: community
lastmod: 2011-02-25T06:28:39-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02457"
mailinglist_parent_id: "msg02456"
author_name: "Nico Meyer"
project_section: "mailinglistitem"
sent_date: 2011-02-25T06:28:39-08:00
---


Whenever I see latencies which are roughly multiples of 40ms it screams
to me 'nagle algorithm'. I have seen this so often now, that the first
thing I check is, if the TCP\\_NODELAY option is set on the TCP socket on
both ends.

Am Freitag, den 25.02.2011, 08:14 -0600 schrieb Jeremiah Peschka:
&gt; Here's where the infrastructure guy in me kicks in:
&gt; 
&gt; 
&gt; What kind of drives are you using in your machines? What kind of NICs
&gt; do you have? Are the switches and NICs all forced to full duplex or
&gt; are they set to auto-configure?
&gt; 
&gt; 
&gt; Theoretically, you should be seeing performance much faster than 80ms
&gt; on GETs, or so I'd think.
&gt; 
&gt; -- 
&gt; Jeremiah Peschka
&gt; Microsoft SQL Server MVP
&gt; MCITP: Database Developer, DBA
&gt; 
&gt; 
&gt; On Thursday, February 24, 2011 at 10:12 PM, Wilson MacGyver wrote:
&gt; 
&gt; &gt; did you change the size of the thread pool? on the default setting
&gt; &gt; of
&gt; &gt; 64, I've noticed
&gt; &gt; some high startup time with the GET.
&gt; &gt; 
&gt; &gt; On Wed, Feb 23, 2011 at 3:08 PM, Bob Feldbauer
&gt; &gt;  wrote:
&gt; &gt; &gt; After importing data into Riak, I'm in a basically 100% GET
&gt; &gt; &gt; scenario. I
&gt; &gt; &gt; haven't done much load testing other than throwing live traffic at
&gt; &gt; &gt; it, but
&gt; &gt; &gt; with that I've seen ~150 concurrent connections.
&gt; &gt; &gt; 
&gt; &gt; &gt; I'm using Jetty app servers (Riak Java client) which are using
&gt; &gt; &gt; protobufs to
&gt; &gt; &gt; hit an HAProxy server, which load balances my 7 Riak nodes. I
&gt; &gt; &gt; really haven't
&gt; &gt; &gt; done anything special, other than using protobufs and fronting
&gt; &gt; &gt; Riak with
&gt; &gt; &gt; HAProxy.
&gt; &gt; &gt; 
&gt; &gt; &gt; Other than that, I would just say "use fast disks" and/or add
&gt; &gt; &gt; nodes as
&gt; &gt; &gt; needed to hit your capacity targets -- because with that traffic
&gt; &gt; &gt; and 7 nodes
&gt; &gt; &gt; with 1 1TB disk per node, I'm seeing ~0.5-&lt;1.0 load average on
&gt; &gt; &gt; Riak nodes as
&gt; &gt; &gt; iowait.
&gt; &gt; &gt; 
&gt; &gt; &gt; Feel free to hop on the #riak IRC channel and I'd be happy to try
&gt; &gt; &gt; to answer
&gt; &gt; &gt; any other questions about our setup.
&gt; &gt; &gt; 
&gt; &gt; &gt; - Bob Feldbauer
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; ---------- Forwarded message ----------
&gt; &gt; &gt; &gt; From: Wilson MacGyver
&gt; &gt; &gt; &gt; Date: Tue, Feb 22, 2011 at 7:15 PM
&gt; &gt; &gt; &gt; Subject: tuning riak for 100s of concurrent connections
&gt; &gt; &gt; &gt; To: riak-users Users
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Are there any guidelines/howtos on tuning riak nodes for 100s
&gt; &gt; &gt; &gt; (200-500) of concurrent connections
&gt; &gt; &gt; &gt; which are 99.9% HTTP GET?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Thanks,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; --
&gt; &gt; &gt; &gt; Omnem crede diem tibi diluxisse supremum.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; Omnem crede diem tibi diluxisse supremum.
&gt; &gt; 
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com



\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

