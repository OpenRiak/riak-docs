---
title: "Re: ListKeys or MapReduce"
description: ""
project: community
lastmod: 2013-02-14T00:21:43-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10122"
mailinglist_parent_id: "msg10101"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-02-14T00:21:43-08:00
---


Hi,

For buckets with a significant number of records, it makes a lot of sense to 
run the example I provided with 'do\\_prereduce' enabled as it will result in 
considerably less data being sent between the nodes. This can be enabled as 
follows:

curl -XPOST http://localhost:8098/mapred 
 -H 'Content-Type: application/json' 
 -d '{"inputs":{
 "bucket":"goog",
 "index":"$bucket",
 "key":"goog"
 },
 "query":[{"reduce":{"language":"erlang",
 "module":"riak\\_kv\\_mapreduce",
 "function":"reduce\\_count\\_inputs", 
 "arg":{"do\\_prereduce":true}}}]}'

Best regards,

Christian


On 14 Feb 2013, at 08:01, Christian Dahlqvist  wrote:

&gt; Hi Jeremiah,
&gt; 
&gt; It does indeed not seem to be documented on the main docs site, and I will 
&gt; try to correct this. The only place I have found it described is on the wiki 
&gt; for the Ruby client 
&gt; (https://github.com/basho/riak-ruby-client/wiki/Secondary-Indexes).
&gt; 
&gt; Below is also an example of a simple mapreduce job that shows how to count 
&gt; the number of records in the 'goog' bucket based on the $bucket secondary 
&gt; index:
&gt; 
&gt; curl -XPOST http://localhost:8098/mapred 
&gt; -H 'Content-Type: application/json' 
&gt; -d '{"inputs":{
&gt; "bucket":"goof",
&gt; "index":"$bucket",
&gt; "key":"goof"
&gt; },
&gt; "query":[{"reduce":{"language":"erlang",
&gt; "module":"riak\\_kv\\_mapreduce",
&gt; "function":"reduce\\_count\\_inputs"}}]}'
&gt; 
&gt; I hope this helps.
&gt; 
&gt; Best regards,
&gt; 
&gt; Christian
&gt; 
&gt; 
&gt; On 13 Feb 2013, at 18:12, Jeremiah Peschka  wrote:
&gt; 
&gt;&gt; Is this documented anywhere on the docs.basho.com site? 
&gt;&gt; 
&gt;&gt; Searching for $bucket produces search results just for "bucket" and Google 
&gt;&gt; says "No results found for site:docs.basho.com $bucket."
&gt;&gt; 
&gt;&gt; ---
&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt;&gt; MCITP: SQL Server 2008, MVP
&gt;&gt; Cloudera Certified Developer for Apache Hadoop
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Wed, Feb 13, 2013 at 10:08 AM, Christian Dahlqvist  
&gt;&gt; wrote:
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; In addition to the $key index, there is also a $bucket index available by 
&gt;&gt; default. This contains the name of the bucket, and can be used to get all 
&gt;&gt; keys in a specific bucket.
&gt;&gt; 
&gt;&gt; Best regards,
&gt;&gt; 
&gt;&gt; Christian
&gt;&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

