---
title: "Re: Strong consistent buckets ready after starting a cluster."
description: ""
project: community
lastmod: 2015-02-06T12:42:50-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15661"
mailinglist_parent_id: "msg15025"
author_name: "Sargun Dhillon"
project_section: "mailinglistitem"
sent_date: 2015-02-06T12:42:50-08:00
---


I really don't recommend doing this. Really, the cluster shouldn't be
changing often enough where the ensemble status is changing all that
often. You can do this by exploiting internal APIs that are accessible
over distributed Erlang in riak\\_ensemble. Though, connecting to the
cluster over distributed Erlang from your client is probably also less
than recommended because it adds extra complexity, and you're poking
at internal APIs that aren't meant to be exposed to the client.

If you want to know for your own sake, you can look at the output from
'riak-admin ensemble-status'

In order to do this programmatically, you'd want to hook into
riak\\_ensemble\\_manager, and interrogate it for the status of the
ensembles. I would start by looking at the code in
riak\\_kv/riak\\_kv\\_ensemble\\_console.erl to go down this route.

On Mon, Feb 2, 2015 at 3:35 AM, Zsolt Laky  wrote:
&gt; Hi All!
&gt;
&gt; I am using a dev cluster with three nodes on a Mac OS. After a boot, I start
&gt; the nodes and they are ok immediately for the default buckets, but for the
&gt; strong consistent type it took 10 minutes to get ready and perform as
&gt; expected.
&gt;
&gt; Here is a small example where a get returns with different values and at the
&gt; end it is ok and I can be sure the RIAK cluster is up and running for strong
&gt; consistent buckets. At the very beginning of startup I got
&gt; {error,&lt;&lt;"insufficient\\_vnodes\\_available"&gt;&gt;} replies but it is ok.
&gt;
&gt; My request for help is to find a way when I know the cluster is ready. I
&gt; understand, RIAK needs time to sync all the nodes after startup, on the
&gt; other hand I need to know when it gets ready for production and will give
&gt; consistent answers. Is there a command in erlang to check it? I also attach
&gt; part of the full log when I listed the keys and values in the buckets to see
&gt; when would I get the correct result. It took about 10 minutes to get there.
&gt;
&gt; Thanks in advance for thoughts and suggestions, your help is highly
&gt; appreciated.
&gt; Kind regards,
&gt; Zsolt
&gt;
&gt; ==============================
&gt; Type:"strong"
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,&lt;&lt;"timeout"&gt;&gt;}
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,&lt;&lt;"timeout"&gt;&gt;}
&gt; ok
&gt; ==============================
&gt; Type:"strong"
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,&lt;&lt;"failed"&gt;&gt;}
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,&lt;&lt;"timeout"&gt;&gt;}
&gt; ==============================
&gt; Type:"strong"
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,&lt;&lt;"failed"&gt;&gt;}
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,&lt;&lt;"failed"&gt;&gt;}
&gt; ==============================
&gt; Type:"strong"
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt; ...........................
&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,notfound}
&gt; ------------------------
&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,notfound}
&gt;
&gt;
&gt; ---
&gt; This email has been checked for viruses by Avast antivirus software.
&gt; http://www.avast.com
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

