---
title: "Re: Map Reduce in Ruby"
description: ""
project: community
lastmod: 2010-06-15T12:23:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00605"
mailinglist_parent_id: "msg00603"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-06-15T12:23:23-07:00
---


Matthew,

The Ruby client gets a little clever here and tries to determine which kind of 
phase you are submitting. If its a String that starts with "function", it 
assumes you are passing the source. Otherwise, it assumes you are using a 
built-in JS function. If you want to use an Erlang function, use an Array of 
two elements like so:

mr.reduce(["riak\\_kv\\_mapreduce","reduce\\_sum"], :keep =&gt; true)

I'd appreciate any ideas on how to improve that API.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Jun 15, 2010, at 3:02 PM, matthew rathbone wrote:

&gt; Hi all,
&gt; 
&gt; Does anyone know how I can specify one of the pre-existing javascript 
&gt; functions when running a map-reduce from ruby?
&gt; 
&gt; For example, I want to run a reduce method that 1) specifies that I'm not 
&gt; creating an anonymous function, and 2) calls one of the predefined functions, 
&gt; eg 'reduce\\_sum' (as seen here: 
&gt; http://bitbucket.org/basho/riak/src/tip/apps/riak\\_kv/src/riak\\_kv\\_mapreduce.erl)
&gt; 
&gt; Any ideas?
&gt; 
&gt; I know how to do it with an anonymous function:
&gt; reduce("function(values, arg){
&gt; sum = 0;
&gt; 
&gt; values.forEach(function(x){sum = sum + x;});
&gt; return 
&gt; [sum];
&gt; }" , nil, 
&gt; :keep =&gt; true).run
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

