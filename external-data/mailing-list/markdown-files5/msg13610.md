---
title: "Re: Riak crashing with {error,{badmatch,{error,eexist}}} in	bitcask:do_put/5 line 1232"
description: ""
project: community
lastmod: 2014-02-06T17:07:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13610"
mailinglist_parent_id: "msg13609"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2014-02-06T17:07:36-08:00
---


Hi Toby, this is a recently identified regression in 1.4.7.

Go into your bitcask data directories, and you'll likely see a number
of 0 byte data files and 18 byte hintfiles with the same file ID
number. Stop the node, move those aside and you should be back in
business. find can be used to automate the process. Another 1.4
release will be forthcoming to remedy the issue.

On Thu, Feb 6, 2014 at 4:20 PM, Toby Corkindale  wrote:
&gt; Our test environment Riak cluster is looking pretty unhealthy at the
&gt; moment, with quite a lot of crashes being reported. Is anyone able to
&gt; advise what the cause is?
&gt;
&gt; From error.log:
&gt;
&gt; [error] &lt;0.13413.31&gt; CRASH REPORT Process &lt;0.13413.31&gt; with 0
&gt; neighbours exited with reason: no match of right hand value
&gt; {error,{badmatch,{error,eexist}}} in bitcask:do\\_put/5 line 1232 in
&gt; gen\\_server:terminate/6 line 747
&gt;
&gt;
&gt; From crash.log:
&gt;
&gt; =ERROR REPORT====
&gt; \\*\\* Generic server &lt;0.5600.32&gt; terminating
&gt; \\*\\* Last message in was
&gt; {'EXIT',&lt;0.5599.32&gt;,{{badmatch,{error,{badmatch,{error,eexist}}}},[{bitcask,do\\_put,5,[{file,"src/bitcask.erl"},{line,1232}]},{bitcask,put,3,[{file,"src/bitcask.erl"},{line,244}]},{riak\\_kv\\_bitcask\\_backend,put,5,[{file,"src/riak\\_kv\\_bitcask\\_backend.erl"},{line,168}]},{riak\\_cs\\_kv\\_multi\\_backend,put,5,[{file,"src/riak\\_cs\\_kv\\_multi\\_backend.erl"},{line,255}]},{riak\\_kv\\_vnode,encode\\_and\\_put,6,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1776}]},{riak\\_kv\\_vnode,perform\\_put,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1162}]},{riak\\_kv\\_vnode,do\\_put,7,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1009}]},{riak\\_kv\\_vnode,handle\\_command,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,419}]}]}}
&gt; \\*\\* When Server state ==
&gt; {state,{&lt;0.5600.32&gt;,poolboy\\_sup},simple\\_one\\_for\\_one,[{child,undefined,riak\\_core\\_vnode\\_worker,{riak\\_core\\_vnode\\_worker,start\\_link,[[{worker\\_module,riak\\_core\\_vnode\\_worker},{worker\\_args,[91343852333181432387730302044767688728495783936,[],worker\\_props,&lt;0.5598.32&gt;]},{worker\\_callback\\_mod,riak\\_kv\\_worker},{size,10},{max\\_overflow,0}]]},temporary,5000,worker,[riak\\_core\\_vnode\\_worker]}],{set,10,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[&lt;0.5603.32&gt;],[&lt;0.5604.32&gt;],[&lt;0.5605.32&gt;],[&lt;0.5606.32&gt;],[&lt;0.5607.32&gt;],[&lt;0.5608.32&gt;],[&lt;0.5609.32&gt;],[&lt;0.5610.32&gt;],[],[],[],[],[],[],[&lt;0.5601.32&gt;],[&lt;0.5602.32&gt;]}}},0,1,[],poolboy\\_sup,{riak\\_core\\_vnode\\_worker,[{worker\\_module,riak\\_core\\_vnode\\_worker},{worker\\_args,[91343852333181432387730302044767688728495783936,[],worker\\_props,&lt;0.5598.32&gt;]},{worker\\_callback\\_mod,riak\\_kv\\_worker},{size,10},{max\\_overflow,0}]}}
&gt; \\*\\* Reason for termination ==
&gt; \\*\\* 
&gt; {{badmatch,{error,{badmatch,{error,eexist}}}},[{bitcask,do\\_put,5,[{file,"src/bitcask.erl"},{line,1232}]},{bitcask,put,3,[{file,"src/bitcask.erl"},{line,244}]},{riak\\_kv\\_bitcask\\_backend,put,5,[{file,"src/riak\\_kv\\_bitcask\\_backend.erl"},{line,168}]},{riak\\_cs\\_kv\\_multi\\_backend,put,5,[{file,"src/riak\\_cs\\_kv\\_multi\\_backend.erl"},{line,255}]},{riak\\_kv\\_vnode,encode\\_and\\_put,6,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1776}]},{riak\\_kv\\_vnode,perform\\_put,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1162}]},{riak\\_kv\\_vnode,do\\_put,7,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1009}]},{riak\\_kv\\_vnode,handle\\_command,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,419}]}]}
&gt; =CRASH REPORT====
&gt; crasher:
&gt; initial call: supervisor:poolboy\\_sup/1
&gt; pid: &lt;0.5600.32&gt;
&gt; registered\\_name: []
&gt; exception exit:
&gt; {{{badmatch,{error,{badmatch,{error,eexist}}}},[{bitcask,do\\_put,5,[{file,"src/bitcask.erl"},{line,1232}]},{bitcask,put,3,[{file,"src/bitcask.erl"},{line,244}]},{riak\\_kv\\_bitcask\\_backend,put,5,[{file,"src/riak\\_kv\\_bitcask\\_backend.erl"},{line,168}]},{riak\\_cs\\_kv\\_multi\\_backend,put,5,[{file,"src/riak\\_cs\\_kv\\_multi\\_backend.erl"},{line,255}]},{riak\\_kv\\_vnode,encode\\_and\\_put,6,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1776}]},{riak\\_kv\\_vnode,perform\\_put,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1162}]},{riak\\_kv\\_vnode,do\\_put,7,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1009}]},{riak\\_kv\\_vnode,handle\\_command,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,419}]}]},[{gen\\_server,terminate,6,[{file,"gen\\_server.erl"},{line,747}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]}
&gt; ancestors: 
&gt; [&lt;0.5599.32&gt;,&lt;0.5598.32&gt;,&lt;0.5479.32&gt;,riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.154.0&gt;]
&gt; messages: []
&gt; links: []
&gt; dictionary: []
&gt; trap\\_exit: true
&gt; status: running
&gt; heap\\_size: 6765
&gt; stack\\_size: 24
&gt; reductions: 1945
&gt; neighbours:
&gt; =ERROR REPORT====
&gt; \\*\\* Generic server &lt;0.11652.32&gt; terminating
&gt; \\*\\* Last message in was
&gt; {'DOWN',#Ref&lt;0.0.36.156577&gt;,process,&lt;0.5479.32&gt;,{{badmatch,{error,{badmatch,{error,eexist}}}},[{bitcask,do\\_put,5,[{file,"src/bitcask.erl"},{line,1232}]},{bitcask,put,3,[{file,"src/bitcask.erl"},{line,244}]},{riak\\_kv\\_bitcask\\_backend,put,5,[{file,"src/riak\\_kv\\_bitcask\\_backend.erl"},{line,168}]},{riak\\_cs\\_kv\\_multi\\_backend,put,5,[{file,"src/riak\\_cs\\_kv\\_multi\\_backend.erl"},{line,255}]},{riak\\_kv\\_vnode,encode\\_and\\_put,6,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1776}]},{riak\\_kv\\_vnode,perform\\_put,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1162}]},{riak\\_kv\\_vnode,do\\_put,7,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1009}]},{riak\\_kv\\_vnode,handle\\_command,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,419}]}]}}
&gt; \\*\\* When Server state == {state,undefined,undefined}
&gt; \\*\\* Reason for termination ==
&gt; \\*\\* 
&gt; {{badmatch,{error,badarg}},[{bitcask\\_file,handle\\_info,2,[{file,"src/bitcask\\_file.erl"},{line,170}]},{gen\\_server,handle\\_msg,5,[{file,"gen\\_server.erl"},{line,607}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]}
&gt; 2014-02-07 11:12:41 =CRASH REPORT====
&gt; crasher:
&gt; initial call: bitcask\\_file:init/1
&gt; pid: &lt;0.11652.32&gt;
&gt; registered\\_name: []
&gt; exception exit:
&gt; {{{badmatch,{error,badarg}},[{bitcask\\_file,handle\\_info,2,[{file,"src/bitcask\\_file.erl"},{line,170}]},{gen\\_server,handle\\_msg,5,[{file,"gen\\_server.erl"},{line,607}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]},[{gen\\_server,terminate,6,[{file,"gen\\_server.erl"},{line,747}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]}
&gt; ancestors: [&lt;0.5479.32&gt;,riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.154.0&gt;]
&gt; messages: []
&gt; links: []
&gt; dictionary: []
&gt; trap\\_exit: false
&gt; status: running
&gt; heap\\_size: 1597
&gt; stack\\_size: 24
&gt; reductions: 472
&gt; neighbours:
&gt; =ERROR REPORT====
&gt; \\*\\* State machine &lt;0.11640.32&gt; terminating
&gt; \\*\\* Last event in was timeout
&gt; \\*\\* When State == key\\_exchange
&gt; \\*\\* Data ==
&gt; {state,{91343852333181432387730302044767688728495783936,'riak@bld-riak01.strxxxxxxxata.internal'},{114179815416476790484662877555959610910619729920,'riak@bld-riak02.strxxxxxxxata.internal'},{91343852333181432387730302044767688728495783936,3},&lt;0.5596.32&gt;,&lt;9663.606.0&gt;,1,300000}
&gt; \\*\\* Reason for termination =
&gt; \\*\\* 
&gt; {normal,{gen\\_server,call,[&lt;0.5596.32&gt;,{compare,{91343852333181432387730302044767688728495783936,3},#Fun,#Fun},infinity]}}
&gt; 2014-02-07 11:12:41 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\\_kv\\_exchange\\_fsm:init/1
&gt; pid: &lt;0.11640.32&gt;
&gt; registered\\_name: []
&gt; exception exit:
&gt; {{normal,{gen\\_server,call,[&lt;0.5596.32&gt;,{compare,{91343852333181432387730302044767688728495783936,3},#Fun,#Fun},infinity]}},[{gen\\_fsm,terminate,7,[{file,"gen\\_fsm.erl"},{line,611}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]}
&gt; ancestors: [riak\\_kv\\_entropy\\_manager,riak\\_kv\\_sup,&lt;0.329.0&gt;]
&gt; messages: [{'DOWN',#Ref&lt;0.0.36.156489&gt;,process,&lt;0.5596.32&gt;,normal}]
&gt; links: []
&gt; dictionary: []
&gt; trap\\_exit: false
&gt; status: running
&gt; heap\\_size: 610
&gt; stack\\_size: 24
&gt; reductions: 271
&gt; neighbours:
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

