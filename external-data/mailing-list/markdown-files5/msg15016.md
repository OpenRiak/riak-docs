---
title: "Re: Not able to store data in original riak bucket"
description: ""
project: community
lastmod: 2014-10-11T23:18:42-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15016"
mailinglist_parent_id: "msg15015"
author_name: "ayush mishra"
project_section: "mailinglistitem"
sent_date: 2014-10-11T23:18:42-07:00
---


I still didn't get root cause. But I got the solution. It's working fine. I
would write a blog for this solution :)

On Sat, Oct 11, 2014 at 10:17 PM, ayush mishra 
wrote:

&gt; Hi Luke,
&gt;
&gt; Please find output of 'riak-debug' in attachment.
&gt;
&gt; Regards,
&gt; Ayush
&gt;
&gt; On Sat, Oct 11, 2014 at 8:48 PM, Luke Bakken  wrote:
&gt;
&gt;&gt; Hi Ayush,
&gt;&gt;
&gt;&gt; Please email me the output of "riak-debug" from this node.
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer / CSE
&gt;&gt; lbak...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Oct 10, 2014 at 9:46 PM, ayush mishra 
&gt;&gt; wrote:
&gt;&gt; &gt; This is related to precommit hook.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; When I hit below command for both buckets abc-client and abc-client1:-
&gt;&gt; &gt;
&gt;&gt; &gt; curl http://127.0.0.1:8098/riak/abc-client
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; {"props":{"allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dvv\\_enabled":false,"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"name":"abc-client","notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}],"pw":0,"r":"quorum","rw":"quorum","search":true,"small\\_vclock":50,"w":"quorum","young\\_vclock":20}}
&gt;&gt; &gt;
&gt;&gt; &gt; curl http://127.0.0.1:8098/riak/abc-client1
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; {"props":{"allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dvv\\_enabled":false,"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"name":"abc-client1","notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":"quorum","rw":"quorum","search":false,"small\\_vclock":50,"w":"quorum","young\\_vclock":20}}
&gt;&gt; &gt;
&gt;&gt; &gt; I tried to remove precommit hook by below command:-
&gt;&gt; &gt;
&gt;&gt; &gt; curl http://127.0.0.1:8098/riak/abc-client -X PUT -H "Content-Type:
&gt;&gt; &gt; application/json" -d '{"props":{"precommit":[]}}'
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; curl http://127.0.0.1:8098/riak/abc-client
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; {"props":{"allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dvv\\_enabled":false,"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"name":"abc-client","notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":"quorum","rw":"quorum","search":false,"small\\_vclock":50,"w":"quorum","young\\_vclock":20}}
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Now When I executed my code again, I again got same problem for
&gt;&gt; abc-client.
&gt;&gt; &gt; It again added precommit in abc-client.
&gt;&gt; &gt;
&gt;&gt; &gt; curl http://127.0.0.1:8098/riak/abc-client
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; {"props":{"allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dvv\\_enabled":false,"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"name":"abc-client","notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}],"pw":0,"r":"quorum","rw":"quorum","search":true,"small\\_vclock":50,"w":"quorum","young\\_vclock":20}}
&gt;&gt; &gt;
&gt;&gt; &gt; However it was still successfully storing data in abc-client1.
&gt;&gt; &gt;
&gt;&gt; &gt; I am not able to understand root cause. Could you please let me know
&gt;&gt; how to
&gt;&gt; &gt; stop adding precommit property in bucket.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On Sat, Oct 11, 2014 at 9:10 AM, ayush mishra &lt;
&gt;&gt; ayushmishra2...@gmail.com&gt;
&gt;&gt; &gt; wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Hi Luke,
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Here is some part of source code:-
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; val bucketName = "abc-client" client.createBucket(bucketName).execute()
&gt;&gt; &gt;&gt; val abc = new ABC(id, "abc")
&gt;&gt; &gt;&gt; val bucket = client.fetchBucket(bucketName).execute()
&gt;&gt; &gt;&gt; bucket.store(abc).execute()
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; I don't think that I am using Riak Search. From the error log, it
&gt;&gt; &gt;&gt; looks like there is a precommit hook defined in the properties for
&gt;&gt; &gt;&gt; abc-client. Because I also tried to uninstall and install riak two
&gt;&gt; &gt;&gt; times, but got same problem.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Is there any way to remove precommit hook?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On Sat, Oct 11, 2014 at 4:28 AM, Luke Bakken 
&gt;&gt; wrote:
&gt;&gt; &gt;&gt; &gt; Ayush,
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Are you using Riak Search? If so, are you using legacy search (1.0)
&gt;&gt; or
&gt;&gt; &gt;&gt; &gt; Yokozuna (2.0) ?
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Could you please execute the store operation to the abc-client bucket
&gt;&gt; &gt;&gt; &gt; using curl instead of the Java client?
&gt;&gt; &gt;&gt; &gt; --
&gt;&gt; &gt;&gt; &gt; Luke Bakken
&gt;&gt; &gt;&gt; &gt; Engineer / CSE
&gt;&gt; &gt;&gt; &gt; lbak...@basho.com
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; On Fri, Oct 10, 2014 at 10:25 AM, ayush mishra
&gt;&gt; &gt;&gt; &gt;  wrote:
&gt;&gt; &gt;&gt; &gt;&gt; I have installed riak 2.0.1 on my machine. I am trying to store an
&gt;&gt; &gt;&gt; &gt;&gt; object with a key in riak bucket. But I am stuck in a weird problem.
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; My actual bucket name is "abc-client".
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; When I try to save data in this bucket, I am getting below error on
&gt;&gt; &gt;&gt; &gt;&gt; console:
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; [error] ! step error
&gt;&gt; &gt;&gt; &gt;&gt; [error] RiakRetryFailedException:
&gt;&gt; &gt;&gt; &gt;&gt; com.basho.riak.client.http.response.RiakResponseRuntimeException:
&gt;&gt; &gt;&gt; &gt;&gt; 500 Internal Server
&gt;&gt; &gt;&gt; &gt;&gt; ErrorInternal Server Error
=====================

The server
&gt;&gt; &gt;&gt; &gt;&gt; encountered an error while processing this request:  

```
{error,
&gt;&gt; &gt;&gt; &gt;&gt; [error]     {error,badarg,
&gt;&gt; &gt;&gt; &gt;&gt; [error]         [{erlang,iolist_to_binary,
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt; [{hook_crashed,{riak_search_kv_hook,precommit,error,badarg}}],
&gt;&gt; &gt;&gt; &gt;&gt; [error]              []},
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt; {wrq,append_to_response_body,2,[{file,"src/wrq.erl"},{line,215}]},
&gt;&gt; &gt;&gt; &gt;&gt; [error]          {riak_kv_wm_object,handle_common_error,3,
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; [{file,"src/riak_kv_wm_object.erl"},{line,1144}]},
&gt;&gt; &gt;&gt; &gt;&gt; [error]          {webmachine_resource,resource_call,3,
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt; [{file,"src/webmachine_resource.erl"},{line,186}]},
&gt;&gt; &gt;&gt; &gt;&gt; [error]          {webmachine_resource,do,3,
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt; [{file,"src/webmachine_resource.erl"},{line,142}]},
&gt;&gt; &gt;&gt; &gt;&gt; [error]          {webmachine_decision_core,resource_call,1,
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt; [{file,"src/webmachine_decision_core.erl"},{line,48}]},
&gt;&gt; &gt;&gt; &gt;&gt; [error]          {webmachine_decision_core,accept_helper,1,
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt; [{file,"src/webmachine_decision_core.erl"},{line,612}]},
&gt;&gt; &gt;&gt; &gt;&gt; [error]          {webmachine_decision_core,decision,1,
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; [{file,"src/webmachine_decision_core.erl"},{line,580}]}]}}
```


---

mochiweb+webmachine
&gt;&gt; &gt;&gt; &gt;&gt; web server

 (DefaultRetrier.java:81)
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:79)
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:53)
&gt;&gt; &gt;&gt; &gt;&gt; [error]
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; com.basho.riak.client.operations.StoreObject.execute(StoreObject.java:148)
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; But When I change bucket name from "abc-client" to "abc-client1", I
&gt;&gt; am
&gt;&gt; &gt;&gt; &gt;&gt; able to store data successfully.
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; Can anyone help me to resolve this? Thanks in advance
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt; &gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

