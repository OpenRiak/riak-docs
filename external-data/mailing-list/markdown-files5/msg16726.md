---
title: "Latency of Riak KV drops with small size server goes long"
description: ""
project: community
lastmod: 2015-11-02T13:49:39-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16726"
author_name: "mtakahashi-ivi"
project_section: "mailinglistitem"
sent_date: 2015-11-02T13:49:39-08:00
---


I use Riak KV with small size server(c4.xlarge@AWS 1 instance). When I run
riak several days, latency of riak KV seems to be long.
So I checked latency of riak KV by using basho bench with smaller server. At
first, I checked write latency.
My questions are
1. Why write latency drops continuously? How can I avoid it?
2. yokozuna Java process becoms to allocate big siz of memory.
 Initially it is about 500MB, finally it become 2GB. JVM option set in
search.solr.jvm\\_options is "-Xmx1g", 2GB exceeds the value.
 Is it normal behavior?
3. Write latency also periodically drops every about 10000 sec. What is this
cicle?

------ Result summary -------
 

------ Benchmark environment -------
Basho bench server:
 c4.xlarge: 7.5GB RAM

Riak KV Server:
 c4.large: 3.75GB RAM

Riak version: 2.1.1
riak.conf:
 ring\\_size = 16
 storage\\_backend = leveldb
 search = on
 Any others except server addresses are same as default value.

Bucket property:
 {
 "props": {
 "name": "BUCKET\\_A",
 "active": true,
 "allow\\_mult": false,
 "basic\\_quorum": false,
 "big\\_vclock": 50,
 "chash\\_keyfun": {
 "mod": "riak\\_core\\_util",
 "fun": "chash\\_std\\_keyfun"
 },
 "claimant": "riak@172.31.0.160",
 "dvv\\_enabled": true,
 "dw": "quorum",
 "last\\_write\\_wins": false,
 "linkfun": {
 "mod": "riak\\_kv\\_wm\\_link\\_walker",
 "fun": "mapreduce\\_linkfun"
 },
 "n\\_val": 1,
 "notfound\\_ok": false,
 "old\\_vclock": 86400,
 "postcommit": [],
 "pr": 0,
 "precommit": [],
 "pw": 0,
 "r": 1,
 "rw": "quorum",
 "search\\_index": "BUCKET\\_A\\_SEARCH\\_INDEX",
 "small\\_vclock": 50,
 "w": 1,
 "young\\_vclock": 20
 }
 }

Basho bench configuration:
 "json\\_v" is not real one. I modified field names for this report.
-----
{mode, max}.

{duration, 4320}.

{concurrent, 300}.

{driver, basho\\_bench\\_driver\\_http}.

 %% Preload 1 million keys
{key\\_generator, {int\\_to\\_str, {uniform\\_int, 100000000}}}.
{value\\_generator, {fixed\\_bin, 100}}.

{generators, [
 {string\\_g, {key\\_generator, {int\\_to\\_str, {uniform\\_int, 50000}}}},
 {bucket\\_g, {key\\_generator, {int\\_to\\_str, {uniform\\_int, 3}}}}
]}.

{values, [
 {json\\_v,
{"{\\"attr1\\_i\\":0,\\"attr2\\_i\\":0,\\"attr3\\_s\\":\\"~s\\",\\"attr4\\_s\\":\\"\\",\\"attr5\\_i\\":4,\\"attr6\\_i\\":318,\\"attr7\\_i\\":9,\\"attr8\\_i\\":4,\\"attr9\\_i\\":14,\\"attr10\\_i\\":1010,\\"attr11\\_i\\":1005,\\"attr12\\_i\\":1015,\\"attr13\\_i\\":30,\\"attr14\\_i\\":15,\\"attr15\\_i\\":45,\\"attr16\\_i\\":19,\\"attr17\\_i\\":14,\\"attr18\\_i\\":24,\\"attr19\\_i\\":1,\\"attr20\\_l\\":1446088404435,\\"attr21\\_i\\":1,\\"attr22\\_s\\":\\"TEST:tstff:000000000000310\\",\\"attr23\\_i\\":3,\\"attr24\\_s\\":\\"TESTtstff000000000000310\\",\\"attr25\\_l\\":1445869988879,\\"attr26\\_l\\":1446088413157,\\"attr27\\_i\\":6473}",
[string\\_g]}}
]}.

{headers, [
 {json\\_h, [{'Content-Type', 'application/json'}]}
]}.

{targets, [
 {map\\_targets, [
 {"172.31.0.160", 8098, {"/types/BUCKET\\_TYPE\\_A/buckets/BUCKET\\_A/keys/~s",
[key\\_generator]}}
 ]}
]}.


{operations, [
 {{post, map\\_targets, json\\_v, json\\_h}, 1}
]}.
-----




--
View this message in context: 
http://riak-users.197444.n3.nabble.com/Latency-of-Riak-KV-drops-with-small-size-server-goes-long-tp4033651.html
Sent from the Riak Users mailing list archive at Nabble.com.

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

