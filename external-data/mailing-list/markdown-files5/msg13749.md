---
title: "Re: CRDT on Riak 2.0"
description: ""
project: community
lastmod: 2014-03-04T09:33:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13749"
mailinglist_parent_id: "msg13747"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2014-03-04T09:33:19-08:00
---


And you only need to send the context object if you’re removing things, so if 
you can partition your work between adds and removes, you can have more 
efficient adds.

On 4 Mar 2014, at 16:27, Sam Elliott  wrote:

&gt; Yes, batch your updates, it'll be much more efficient that way.
&gt; 
&gt; Do not try to decode the `context` object. Use it as an opaque value, as the 
&gt; data it holds could change without warning.
&gt; 
&gt; Sam 
&gt; 
&gt; -- 
&gt; Sam Elliott
&gt; Engineer
&gt; sam.elli...@basho.com
&gt; --
&gt; 
&gt; 
&gt; On Tuesday, 4 March 2014 at 10:22AM, EmiNarcissus wrote:
&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Hi Sean,
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thanks very much, that’s very helpful. Anyways, I’ve noticed in update\\_dt 
&gt;&gt; function they are preferred to apply a context dict, which in the mail list 
&gt;&gt; described as a encoded version of original object(dict,set, so to say on a 
&gt;&gt; single update action, each time a new record is being added/removed it will 
&gt;&gt; apply the full original object to the server?), so for frequently 
&gt;&gt; operations, how much performance difference is between batch/single actions?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; I’m only thinking about the possibilities on large dataset, but really in 
&gt;&gt; fact the dataset I’m planning to use at most contains 1-2k records is 
&gt;&gt; already big enough. currently I’m working on a project which using Riak Link 
&gt;&gt; to hold the identical items,also need to update the object data itself a 
&gt;&gt; lot(inside have a few counters(but indeed currently is just a number,didn’t 
&gt;&gt; put it into a separated counter yet), so is very non-efficient to update 
&gt;&gt; when new record is being inserted, don’t know if CRDT will provide more 
&gt;&gt; efficiency on that.
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On 2014年3月4日 at 下午11:12:03, Sam Elliott (sam.elli...@basho.com 
&gt;&gt; (mailto:sam.elli...@basho.com)) wrote:
&gt;&gt;&gt; To answer another thing brought up in your message:
&gt;&gt;&gt; 
&gt;&gt;&gt; When you say "big enough" set sizes of 10k, be very careful. Riak Data 
&gt;&gt;&gt; Types should not 
&gt;&gt;&gt; be larger than you would make a normal Riak Object. There's more guidance 
&gt;&gt;&gt; in this thread: 
&gt;&gt;&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2014-February/014722.html
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; Sam
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Sam Elliott
&gt;&gt;&gt; Engineer
&gt;&gt;&gt; sam.elli...@basho.com (mailto:sam.elli...@basho.com)
&gt;&gt;&gt; --
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On Tuesday, 4 March 2014 at 10:02AM, Sean Cribbs wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Hi Tim,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; We punted on sub-type queries for 2.0. We intend to address them in 2.1, 
&gt;&gt;&gt;&gt; so yes you must 
&gt;&gt;&gt; fetch the entire set or map in order to find out things like membership and 
&gt;&gt;&gt; cardinality. 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Tue, Mar 4, 2014 at 8:01 AM, EmiNarcissus 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; I’m now porting the riak 2.0 driver for twisted, it works beautifully now 
&gt;&gt;&gt;&gt;&gt; with what 
&gt;&gt;&gt; Yokozuna provides, also have a great back-port ability,really appreciate 
&gt;&gt;&gt; everything 
&gt;&gt;&gt; what this team have brought us XD. But because it still in lacks of 
&gt;&gt;&gt; document, I must read 
&gt;&gt;&gt; the implementation both from ruby and riakc-erl repo to get it 
&gt;&gt;&gt; started(erlang is okay 
&gt;&gt;&gt; for me, but I’m not quite familiar with ruby,sadly looks like only ruby’s 
&gt;&gt;&gt; client implementation 
&gt;&gt;&gt; is throughly right now).
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; So here is my question on the datatype implementation on CRDT system.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; From the code I can tell , fetch\\_dt/update\\_dt/modify\\_dt is what have been 
&gt;&gt;&gt;&gt;&gt; exposed 
&gt;&gt;&gt; from the pbc interface. Now I’m more focused on Set object, so each time 
&gt;&gt;&gt; client will fetch 
&gt;&gt;&gt; the whole set(fetch\\_dt) from the server and build the set on the local end, 
&gt;&gt;&gt; and maintain 
&gt;&gt;&gt; a add/remove operation list to send to the server when user does a 
&gt;&gt;&gt; update/add/remove 
&gt;&gt;&gt; action.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; But I’m a little bit confused here, like what redis provides, a set have 
&gt;&gt;&gt;&gt;&gt; a ismember function 
&gt;&gt;&gt; is being done on the server instead of fetch/test manner. Does this 
&gt;&gt;&gt; available for Riak 
&gt;&gt;&gt; 2.0 Set datatype(just like what Riak1.4 Counter object provided, it will do 
&gt;&gt;&gt; the operation 
&gt;&gt;&gt; on the server side,MISMEMBER a b, it will either return True/False). 
&gt;&gt;&gt; Currently I only 
&gt;&gt;&gt; can see add/update/delete operation on pbc proto file, and don’t have 
&gt;&gt;&gt; something alike, 
&gt;&gt;&gt; is that in a Todo list ? or will not implement at all(I will reconsider how 
&gt;&gt;&gt; the data should 
&gt;&gt;&gt; be structured if so). This feature will be really helpful when the dataset 
&gt;&gt;&gt; is big enough(like 
&gt;&gt;&gt; more than 10k values in it.)
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Best,
&gt;&gt;&gt;&gt;&gt; Tim Lee
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; @basho.com&gt;@me.com&gt;
&gt; 
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

