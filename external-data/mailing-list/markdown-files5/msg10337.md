---
title: "Re: {error, notfound} items in mapreduce during ownership handoff"
description: ""
project: community
lastmod: 2013-03-06T13:09:50-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10337"
mailinglist_parent_id: "msg10336"
author_name: "John Daily"
project_section: "mailinglistitem"
sent_date: 2013-03-06T13:09:50-08:00
---


I'm sorry this went unanswered, Jeremy. Thanks for the follow up.

Your code needs to be able to handle notfound errors and tombstones[1] 
regardless of ownership handoff. The coverage for the 2i or listkeys input will 
be calculated up front, with the work distributed to a node where the key is 
expected to be found, but it's always possible that the node selected may not 
have the data you want due to network or system errors that haven't yet healed.

Both the notfound and the fitting error in the logs (which is benign, and 
related to the notfound problem) should be less common under Riak 1.3, although 
ownership handoff will still exacerbate the problem.

[1] https://github.com/basho/riak\\_kv/issues/358

-John Daily
Technical Evangelist
jda...@basho.com


On Mar 6, 2013, at 3:14 PM, Jeremy Raymond  wrote:

&gt; So I should expect {error, notfound} inputs to map jobs while ownership 
&gt; handoff is in progress? Are the not found items actually unavailable during 
&gt; handoff or is this just not found on the old node, but will be picked up by 
&gt; the new node during the same mapreduce job?
&gt; 
&gt; --
&gt; Jeremy
&gt; 
&gt; 
&gt; On Thu, Feb 28, 2013 at 11:28 AM, Jeremy Raymond  wrote:
&gt; Yesterday I added a new node to my cluster. During the time when ownership 
&gt; handoff was happening (several hours of work) mapreduce map functions were 
&gt; receiving {error, notfound} as inputs. My Erlang mapred functions weren't 
&gt; designed to handle this. They hadn't encountered this before during normal 
&gt; operation. After the ownership handoff process completed the {error, 
&gt; notfound} inputs have stopped.
&gt; 
&gt; Any explanations for the {error, notfound} inputs during ownership handoff? 
&gt; Is this because a node is attempting to process an object now moved to 
&gt; another node? If this is the case would the notfound object be found on the 
&gt; other node in the same mapreduce job (i.e. still visible to the overall 
&gt; mapred process)? Should I assume {error, notfound} inputs for all mapred jobs 
&gt; as a valid possible input and always handle it?
&gt; 
&gt; I've also accumulated about 50MB of "Pipe worker startup failed:fitting was 
&gt; gone before startup" on each node during the ownership\\_transfer process. 
&gt; These messages are benign?
&gt; 
&gt; Thanks a lot.
&gt; 
&gt; --
&gt; Jeremy
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

