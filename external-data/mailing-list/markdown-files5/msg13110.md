---
title: "Re: [Confusing search docs] Enabling search on bucket in Riak 2.0"
description: ""
project: community
lastmod: 2013-11-27T14:38:25-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13110"
mailinglist_parent_id: "msg13106"
author_name: "Kartik Thakore"
project_section: "mailinglistitem"
sent_date: 2013-11-27T14:38:25-08:00
---


ok no go. I openned up the server, have a look:




http://99.249.29.26:8098/solr/logs/select?q=\\*:\\*&wt=json




http://99.249.29.26:8098/buckets/logs/keys?keys=true

On Wed, Nov 27, 2013 at 4:58 PM, Ryan Zezeski  wrote:

&gt; If a field isn't specified then it will default to 'text'. Which should
&gt; work for plain text. But just as a sanity check I'd also be curious to see
&gt; the results of the \\*:\\* query.
&gt; On Wed, Nov 27, 2013 at 11:15 AM, Eric Redmond  wrote:
&gt;&gt; That is not a valid solr query. You need to search by field:value. Try:
&gt;&gt;
&gt;&gt; http://192.168.1.10:8098/solr/logs/select?q=\\*:\\*
&gt;&gt;
&gt;&gt; Eric
&gt;&gt;
&gt;&gt; On Nov 27, 2013, at 7:23 AM, Kartik Thakore  wrote:
&gt;&gt;
&gt;&gt; Cool. I did the data activate and emptied out the bucket and set the props
&gt;&gt; and created a different index. Still no go
&gt;&gt;
&gt;&gt; Here is the data:
&gt;&gt; "[2013-11-27T15:21:30] [ERROR] [192.168.1.102] [zach.scratchd.ca] [0] [
&gt;&gt; thakore.kar...@gmail.com] test"
&gt;&gt;
&gt;&gt; Here is the search:
&gt;&gt; http://192.168.1.10:8098/solr/logs/select?q=\\*
&gt;&gt;
&gt;&gt; http://192.168.1.10:8098/solr/logs/select?q=test
&gt;&gt;
&gt;&gt;
&gt;&gt; No results found
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Nov 26, 2013 at 8:56 PM, Ryan Zezeski  wrote:
&gt;&gt;
&gt;&gt;&gt; Kartik,
&gt;&gt;&gt;
&gt;&gt;&gt; The pre7 tag incorporates the new bucket type integration. Bucket types
&gt;&gt;&gt; are a new feature in 2.0 that provide additional namespace support and more
&gt;&gt;&gt; efficient bucket properties (good for when you have many buckets with
&gt;&gt;&gt; custom properties). The particular code you are running against requires
&gt;&gt;&gt; that for data to be indexed in Yokozuna it must be stored under a
&gt;&gt;&gt; non-default bucket type. Since you are not specifying a type the logs
&gt;&gt;&gt; bucket lives under the default type where `yz\\_index` will not be applied.
&gt;&gt;&gt; This will be changed for 2.0 so that any type of bucket may be indexed. In
&gt;&gt;&gt; the meantime, try this:
&gt;&gt;&gt;
&gt;&gt;&gt; riak-admin bucket-type create data '{"props":{}}'
&gt;&gt;&gt; riak-admin bucket-type activate data
&gt;&gt;&gt;
&gt;&gt;&gt; curl -X PUT -H 'content-type: application/json' '
&gt;&gt;&gt; http://host:port/types/data/buckets/logs/props' -d
&gt;&gt;&gt; '{"props":{"yz\\_index":"allLogs"}}'
&gt;&gt;&gt;
&gt;&gt;&gt; That above will change soon as well. We are attempting to rename most
&gt;&gt;&gt; user facing parts of Yokozuna to just "search". This means that `yz\\_index`
&gt;&gt;&gt; will soon become `search\\_index`. Sorry for the inconvenience as things are
&gt;&gt;&gt; in a bit of flux leading up to 2.0.
&gt;&gt;&gt;
&gt;&gt;&gt; -Z
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Nov 26, 2013 at 5:59 PM, Kartik Thakore wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So finally got a chance to try this and I am running into issues (I am
&gt;&gt;&gt;&gt; on Riak 2.0pre7) btw.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have yz turned on:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://192.168.1.10:8098/yz
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I created the index with:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ curl -i http://192.168.1.10:8098/yz/index/allLogs
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; HTTP/1.1 200 OK
&gt;&gt;&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
&gt;&gt;&gt;&gt; Date: Tue, 26 Nov 2013 22:51:15 GMT
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Content-Type: application/json
&gt;&gt;&gt;&gt; Content-Length: 41
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {"name":"allLogs","schema":"\\_yz\\_default"}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; And associated the search to the bucket probs:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://192.168.1.10:8098/buckets/logs/props
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; props:
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; allow\\_mult: true,
&gt;&gt;&gt;&gt; basic\\_quorum: false,
&gt;&gt;&gt;&gt; big\\_vclock: 50,
&gt;&gt;&gt;&gt; chash\\_keyfun:
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; mod: "riak\\_core\\_util",
&gt;&gt;&gt;&gt; fun: "chash\\_std\\_keyfun"
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; },
&gt;&gt;&gt;&gt; dw: "quorum",
&gt;&gt;&gt;&gt; last\\_write\\_wins: false,
&gt;&gt;&gt;&gt; linkfun:
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; mod: "riak\\_kv\\_wm\\_link\\_walker",
&gt;&gt;&gt;&gt; fun: "mapreduce\\_linkfun"
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; },
&gt;&gt;&gt;&gt; n\\_val: 3,
&gt;&gt;&gt;&gt; name: "logs",
&gt;&gt;&gt;&gt; notfound\\_ok: true,
&gt;&gt;&gt;&gt; old\\_vclock: 86400,
&gt;&gt;&gt;&gt; postcommit: [ ],
&gt;&gt;&gt;&gt; pr: 0,
&gt;&gt;&gt;&gt; precommit: [ ],
&gt;&gt;&gt;&gt; pw: 0,
&gt;&gt;&gt;&gt; r: "quorum",
&gt;&gt;&gt;&gt; rw: "quorum",
&gt;&gt;&gt;&gt; small\\_vclock: 50,
&gt;&gt;&gt;&gt; w: "quorum",
&gt;&gt;&gt;&gt; young\\_vclock: 20,
&gt;&gt;&gt;&gt; yz\\_index: "allLogs"
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I put in a text/plain entry with:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=47ffPuWSln7VhlTl02raJA
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [2013-11-26T22:43:26] [ERROR] [192.168.1.102] [0] [
&gt;&gt;&gt;&gt; thakore.kar...@gmail.com] test
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=6IYwwPE27eUbs8ThaSOcTC
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [2013-11-26T22:39:59] [ERROR] [192.168.1.102] [0] [
&gt;&gt;&gt;&gt; thakore.kar...@gmail.com] test
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; But when I search:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://192.168.1.10:8098/search/allLogs?q=\\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; No results
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; http://192.168.1.10:8098/search/allLogs?q=test
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; No results
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Whats going on?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Nov 21, 2013 at 12:45 PM, Ryan Zezeski 
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; On Wed, Nov 20, 2013 at 3:48 PM, Kartik Thakore 
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; Thank you.
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; I am creating indexes with:
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; curl -i -XPUT http://192.168.1.10:8098/yz/index/allLogs \\
&gt;&gt;&gt;&gt; &gt;&gt; -H 'content-type: application/json' \\
&gt;&gt;&gt;&gt; &gt;&gt; -d '{"schema" : "\\_yz\\_default", "bucket" : "logs" }'
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; But when I check the index with:
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; curl -i http://192.168.1.10:8098/yz/index/allLogs
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; It drops the bucket association
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; HTTP/1.1 200 OK
&gt;&gt;&gt;&gt; &gt;&gt; Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
&gt;&gt;&gt;&gt; &gt;&gt; Date: Wed, 20 Nov 2013 20:45:21 GMT
&gt;&gt;&gt;&gt; &gt;&gt; Content-Type: application/json
&gt;&gt;&gt;&gt; &gt;&gt; Content-Length: 41
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; {"name":"allLogs","schema":"\\_yz\\_default"}
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Sorry, that documentation is out of date.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; To associate an index to a bucket you need to set the bucket's
&gt;&gt;&gt;&gt; properties.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; curl -XPUT -H 'content-type: application/json' '
&gt;&gt;&gt;&gt; http://localhost:8098/buckets/logs/props' -d
&gt;&gt;&gt;&gt; '{"props":{"yz\\_index":"allLogs"}}'
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; You can perform a GET on that same resource to check the yz\\_index
&gt;&gt;&gt;&gt; property is set.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; Also
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; what is going on here
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; curl -XPUT -H'content-type:application/json'
&gt;&gt;&gt;&gt; http://localhost:8098/buckets/people/keys/me \\
&gt;&gt;&gt;&gt; &gt;&gt; -d'{ "name\\_s" : "kartik" }'
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt; Why not:
&gt;&gt;&gt;&gt; &gt;&gt; curl -XPUT -H'content-type:application/json'
&gt;&gt;&gt;&gt; http://localhost:8098/rial/people/me \\
&gt;&gt;&gt;&gt; &gt;&gt; -d'{ "name\\_s" : "kartik" }'
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; In Riak 1.0.0 we changed the resource from '/riak//' to
&gt;&gt;&gt;&gt; '/buckets//keys/'. We were supposed to deprecate and
&gt;&gt;&gt;&gt; eventually remove the old resource but we never did. You can still use the
&gt;&gt;&gt;&gt; old style but I would recommend using the new style as it is what we use in
&gt;&gt;&gt;&gt; official docs and there is a chance perhaps the old resources don't stay up
&gt;&gt;&gt;&gt; to date with the latest features.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; -Z
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

