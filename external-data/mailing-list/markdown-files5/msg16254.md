---
title: "Re: Strong consistency only for missing keys?"
description: ""
project: community
lastmod: 2015-06-19T02:51:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16254"
mailinglist_parent_id: "msg16253"
author_name: "Sargun Dhillon"
project_section: "mailinglistitem"
sent_date: 2015-06-19T02:51:13-07:00
---


I doesn't actually sound like you need strong consistency at all.
Strong consistency can be set at a bucket-type level, and will get you
what you want, but it may be too heavy handed.

It sounds like the token should be written to Riak and you should be
getting a durable ack from Riak before ever granting the client to the
session. Given this, the "tunable CAP" controls in Riak may help you.

There is more on this here in these blog posts:
http://basho.com/posts/technical/understanding-riaks-configurable-behaviors-part-1/
http://basho.com/posts/technical/riaks-config-behaviors-part-2/
http://basho.com/posts/technical/riaks-config-behaviors-part-3/
http://basho.com/posts/technical/riaks-config-behaviors-part-4/
and this doc:
http://docs.basho.com/riak/2.0.0/dev/advanced/cap-controls/

You probably want to do:
n=3
pw=quorum
pr=quorum
notfound\\_ok=false
----

I might argue that this might be too heavy-handed, but I recommend
reading the above posts for a better understanding of the consistency,
and availability guarantees Riak can provide. At the end of the day,
you're trading off (availability, performance) vs. consistency.

On Fri, Jun 19, 2015 at 12:48 AM, Cosmin Marginean  wrote:
&gt; Hi Ilya
&gt;
&gt; Read “quorum” is unusual and a bit against the idea of distributed DB, but I
&gt; believe what you might find useful is enabling strong consistency, which you
&gt; can then chose to apply at a bucket(type) level:
&gt; \\* http://docs.basho.com/riak/latest/dev/advanced/strong-consistency/
&gt;
&gt; One of the reasons we chose Riak is precisely the fact that you can silo
&gt; your data into “consistent” and “available” within the same cluster. An
&gt; important thing to remember is that with strong consistency enabled you will
&gt; need a minimum of 3 nodes (yes, for your dev environment too), otherwise
&gt; writes to strong-consistent buckets will fail.
&gt;
&gt; Another relevant note here about strong consistency in Riak (and distributed
&gt; DB in general): is not so much about the performance impact, but more about
&gt; sacrificing availability to achieve this.
&gt; (The C vs A in the CAP theorem, if we are to oversimplify this)
&gt;
&gt; Regards
&gt; Cos
&gt;
&gt; On Friday, 19 June 2015 at 01:12, Ilya Kutukov wrote:
&gt;
&gt; Hi!
&gt;
&gt; I am planning to maintain session storage over Riak KV.
&gt;
&gt; Core case: when user is signing in to the service session token with some
&gt; meta is returning to the client and then saving for further usage. At the
&gt; back-end side this session key is placing to the session storage.
&gt;
&gt; Riak could response false "not found" when user is providing client-side
&gt; token on next request, what following instantly after the session record is
&gt; placed to Riak.
&gt;
&gt; From the end-user POV you log in, than you surprisingly not logged in, then
&gt; you are refreshing/restarting client and everything is back to normal. Bad
&gt; glitchy case.
&gt;
&gt; Riak have typical distributed DB problems when you are reading after write
&gt; instantly. Also there is a high consistency mode with performance
&gt; trade-offs.
&gt;
&gt; Is it possible to configure or modify Riak cluster to act hybrid way:
&gt;
&gt; Normally cluster is working in HA mode. E.g. on secondary index searches,
&gt; updates, deletions of the existing keys.
&gt;
&gt; But when you are directly asking for the key that seems to be missing the
&gt; full quorum is required to claim that there is really no such key on all
&gt; nodes in according partition to say "No". Any other case is "Yes" after long
&gt; or a short delay.
&gt; In theory, such behaviour will make deletion of keys slower, but situation
&gt; with false "not found" will be better.
&gt;
&gt; Or i'm missing some obvious way to resolve read-after-write problem like
&gt; proxying requests to the session storage through the single instance 3-rd
&gt; party cache?
&gt;
&gt;
&gt; --
&gt; Best regards,
&gt; Ilya Kutukov
&gt;
&gt; +7 962 909 10 35
&gt; post.i...@gmail.com
&gt; skype: blinkedeye
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

