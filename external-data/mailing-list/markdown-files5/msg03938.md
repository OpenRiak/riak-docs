---
title: "Re: No results provided by Riak search, another !"
description: ""
project: community
lastmod: 2011-07-05T14:36:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03938"
mailinglist_parent_id: "msg03937"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-07-05T14:36:22-07:00
---


You'll need to change the schema fields to "dymanic\\_field" in order to use
wildcards (\\*). Can you update the schema and test the issue again?

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Tue, Jul 5, 2011 at 2:13 PM, Germain Maurice &lt;
germain.maur...@linkfluence.net&gt; wrote:

&gt; \\*\\*
&gt; Hi Dan,
&gt;
&gt; No, i didn't change it.
&gt;
&gt;
&gt; Le 05/07/11 19:17, Dan Reverri a écrit :
&gt;
&gt; Hi Germain,
&gt;
&gt; Did you change the fields to "dynamic\\_field" in the schema?
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Tue, Jul 5, 2011 at 9:51 AM, Germain Maurice &lt;
&gt; germain.maur...@linkfluence.net&gt; wrote:
&gt;
&gt;&gt; Thanks Dan,
&gt;&gt;
&gt;&gt; I changed the fields in the schema as this :
&gt;&gt; - nsid -&gt; \\*\\_nsid
&gt;&gt; - favedate -&gt; \\*\\_favedate
&gt;&gt; - date\\_faved -&gt; \\*\\_date\\_faved
&gt;&gt;
&gt;&gt; In order to take it in account i did :
&gt;&gt;
&gt;&gt; search-cmd set-schema photostest My.schema
&gt;&gt; search-cmd clear-schema-cache
&gt;&gt; and reindexing data (reading/writing the documents in their own place)
&gt;&gt;
&gt;&gt; No change :(
&gt;&gt; I tried to use the fields : fans\\_data\\_nsid, fans\\_data\\_favedate
&gt;&gt; but no better result.
&gt;&gt;
&gt;&gt; I'm using Riak Search 0.14.2
&gt;&gt;
&gt;&gt; Just for checking :
&gt;&gt; curl http://localhost:8098/riak/photostest
&gt;&gt;
&gt;&gt; {"props":{"precommit":[{"fun":"precommit","mod":"riak\\_search\\_kv\\_hook"}]...}
&gt;&gt;
&gt;&gt; Le 05/07/11 18:27, Dan Reverri a écrit :
&gt;&gt;
&gt;&gt; Hi Germain,
&gt;&gt;
&gt;&gt; It looks like your document has nested fields which means the schema you
&gt;&gt; have defined won't match the fields produced by the pre-commit hook. The
&gt;&gt; pre-commit hook flattens JSON documents using an underscore ("\\_") between
&gt;&gt; nested fields (e.g. fans\\_data\\_nsid); your schema should be using the
&gt;&gt; flattened field name.
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Dan
&gt;&gt;
&gt;&gt; Daniel Reverri
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Jul 5, 2011 at 7:05 AM, Germain Maurice &lt;
&gt;&gt; germain.maur...@linkfluence.net&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hello everybody,
&gt;&gt;&gt;
&gt;&gt;&gt; I have a problem with Riak Search. I tried to find the solution by my
&gt;&gt;&gt; own, i tried all the solutions i found and no results.
&gt;&gt;&gt;
&gt;&gt;&gt; Firstly, i tried to use it with the default schema, it works but it
&gt;&gt;&gt; indexes too much data.
&gt;&gt;&gt; So, i set my own schema as this :
&gt;&gt;&gt; {
&gt;&gt;&gt; schema,
&gt;&gt;&gt; [
&gt;&gt;&gt; {version, "1.1"},
&gt;&gt;&gt; {n\\_val, 1},
&gt;&gt;&gt; {default\\_field, "nsid"},
&gt;&gt;&gt; {analyzer\\_factory, {erlang, text\\_analyzers,
&gt;&gt;&gt; standard\\_analyzer\\_factory}}
&gt;&gt;&gt; ],
&gt;&gt;&gt; [
&gt;&gt;&gt; {field, [
&gt;&gt;&gt; {name, "favedate"},
&gt;&gt;&gt; {type, string},
&gt;&gt;&gt; {analyzer\\_factory, {erlang, text\\_analyzers,
&gt;&gt;&gt; standard\\_analyzer\\_factory}}
&gt;&gt;&gt; ]},
&gt;&gt;&gt;
&gt;&gt;&gt; {field, [
&gt;&gt;&gt; {name, "date\\_faved"},
&gt;&gt;&gt; {type, string},
&gt;&gt;&gt; {analyzer\\_factory, {erlang, text\\_analyzers,
&gt;&gt;&gt; standard\\_analyzer\\_factory}}
&gt;&gt;&gt; ]},
&gt;&gt;&gt;
&gt;&gt;&gt; %% Everything else is skipped
&gt;&gt;&gt; {dynamic\\_field, [
&gt;&gt;&gt; {name, "\\*"},
&gt;&gt;&gt; {skip, true}
&gt;&gt;&gt; ]}
&gt;&gt;&gt; ]
&gt;&gt;&gt; }.
&gt;&gt;&gt;
&gt;&gt;&gt; Hook on precommit of my buckets are ok.
&gt;&gt;&gt; I set the schema for each of my buckets as this : "search-cmd set-schema
&gt;&gt;&gt; photostest My.schema"
&gt;&gt;&gt; Did a "search-cmd clear-schema-cache" command.
&gt;&gt;&gt;
&gt;&gt;&gt; I re-indexed all of my documents of the bucket however, these documents
&gt;&gt;&gt; are not indexed.
&gt;&gt;&gt; An example :
&gt;&gt;&gt;
&gt;&gt;&gt; { "fans":{
&gt;&gt;&gt; "data":[{"nsid":"83786678@N00",
&gt;&gt;&gt; "favedate":"1309539453"}
&gt;&gt;&gt; ,{"nsid":"33233619@N02",
&gt;&gt;&gt; "favedate":"1309539169"}]
&gt;&gt;&gt; , ...
&gt;&gt;&gt; Here is the answer of the index :
&gt;&gt;&gt;
&gt;&gt;&gt; {"responseHeader":{"status":0,"QTime":2,"params":{"q":"fans\\_data\\_nsid:83786678@N00
&gt;&gt;&gt; ","q.op":"or","filter":"","wt":"
&gt;&gt;&gt; json"}},"response":{"numFound":0,"start":0,"maxScore":"0.0","docs":[]}}
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; thank you !
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Germain Maurice
&gt;&gt;&gt; Administrateur Système/Réseau
&gt;&gt;&gt; Tel : +33.(0)1.42.43.54.33
&gt;&gt;&gt;
&gt;&gt;&gt; http://www.linkfluence.net
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Germain Maurice
&gt;&gt; Administrateur Système/Réseau
&gt;&gt; Tel : +33.(0)1.42.43.54.33
&gt;&gt; http://www.linkfluence.net
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

