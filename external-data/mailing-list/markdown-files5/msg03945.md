---
title: "Re: db.save() vs. db.update()"
description: ""
project: community
lastmod: 2011-07-06T08:00:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03945"
mailinglist_parent_id: "msg03944"
author_name: "francisco treacy"
project_section: "mailinglistitem"
sent_date: 2011-07-06T08:00:43-07:00
---


Didn't have a close look, but it seems like a bug in riak-js. Please
open an issue at https://github.com/frank06/riak-js/issues

If you have any doubt, \\*always\\* prefer `db.get()` and `db.save()`. I
kinda regret having agreed to include `db.update()`. If it's causing
confusion I will have to remove it.

Thanks,

Francisco


2011/7/6 Mathias Meyer :
&gt; Claus,
&gt;
&gt; it looks you're mixing up metadata objects with actual data objects when 
&gt; calling update. update does a get/put cycle, where it fetches an object, 
&gt; merges its attributes with the ones you hand over to update() and save the 
&gt; result back. Any change you accidentally pass in the meta object from a 
&gt; different part of your code that's fetching the object initially?
&gt;
&gt; Mathias Meyer
&gt; Developer Advocate, Basho Technologies
&gt;
&gt;
&gt; On Mittwoch, 6. Juli 2011 at 00:30, Claus Guttesen wrote:
&gt;
&gt;&gt; Hi.
&gt;&gt;
&gt;&gt; When saving a new record using db.update() getting the record using
&gt;&gt; curl has alot more info:
&gt;&gt;
&gt;&gt; curl "localhost:8098/riak/users/RQC6seqRIKkBNKQt65QMko3W66"
&gt;&gt; {"props":{"w":"quorum","r":"quorum","big\\_vclock":50,"old\\_vclock":86400,"n\\_val":3,"postcommit":[],"last\\_write\\_wins":false,"small\\_vclock":10,"allow\\_mult":false,"young\\_vclock":20,"rw":"quorum","pw":0,"dw":"quorum","linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"name":"users","chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"basic\\_quorum":true,"notfound\\_ok":false,"pr":0,"precommit":[]},"club":"BBIL","mname":"","year":"1967","gender":"male","fname":"Claus","lname":"Guttesen"}%
&gt;&gt;
&gt;&gt; When doing a db.save() with the same data I get:
&gt;&gt;
&gt;&gt; curl "localhost:8098/riak/users/RQC6seqRIKkBNKQt65QMko3W66"
&gt;&gt; {"fname":"Claus","mname":"","lname":"Guttesen","year":"1967","club":"BBIL","gender":"male"}
&gt;&gt;
&gt;&gt; If I do a db.save() first and then a db.update() the information is
&gt;&gt; also terse. Why is db.update() more verbose?
&gt;&gt;
&gt;&gt; I'm using riak-js v. 0.4.0.
&gt;&gt;
&gt;&gt; My idea was to add more information in addtion to name, club, year
&gt;&gt; born, gender. But when I edit the user and save it the previous data
&gt;&gt; gets overwritten. So I changed db.save() to db.update(), saved a new
&gt;&gt; user and noticed alot more info.
&gt;&gt;
&gt;&gt; --
&gt;&gt; regards
&gt;&gt; Claus
&gt;&gt;
&gt;&gt; When lenity and cruelty play for a kingdom,
&gt;&gt; the gentler gamester is the soonest winner.
&gt;&gt;
&gt;&gt; Shakespeare
&gt;&gt;
&gt;&gt; twitter.com/kometen (http://twitter.com/kometen)
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

