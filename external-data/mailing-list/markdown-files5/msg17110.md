---
title: "Re: Continuous HTTP POSTs to Riak"
description: ""
project: community
lastmod: 2016-03-04T00:20:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17110"
mailinglist_parent_id: "msg17108"
author_name: "Vitaly E"
project_section: "mailinglistitem"
sent_date: 2016-03-04T00:20:07-08:00
---


Hi Qiang,

Since you are running with allow\\_mult=false, make sure the clocks of your
Riak nodes are synchronized. If they are out of sync, newer values may get
overridden by older ones on read, depending on the node a request hits
first. Of course this won't cover 100% of cases because a perfect clock
synchronization is just impossible.

Also, setting notfound\\_ok to "false" may help if you encounter not founds
for keys you are sure have been written.

Good luck!
Vitaly

On Fri, Mar 4, 2016 at 5:19 AM, Qiang Cao  wrote:

&gt; Sargun, do you mean I should also pass back the vclock with the GET
&gt; request?
&gt;
&gt;
&gt; On Thu, Mar 3, 2016 at 10:05 PM, Qiang Cao  wrote:
&gt;
&gt;&gt; Thanks, Sargun and Alexander! I tried setting pr, pw, and sloppy\\_quorum.
&gt;&gt; It looks that these help. I got less stale values. But the issue wasn't
&gt;&gt; completely resolved. I'm using Riak 2.1.2.
&gt;&gt;
&gt;&gt; -Qiang
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Mar 3, 2016 at 9:46 PM, Sargun Dhillon  wrote:
&gt;&gt;
&gt;&gt;&gt; So, if you pass back the vclock while pr=pw=quorum, and sloppy\\_quorum
&gt;&gt;&gt; = false you should get RYOW consistency.
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu, Mar 3, 2016 at 6:25 PM, Christopher Mancini 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; &gt; If you don't need strong consistency for all Riak requests, just
&gt;&gt;&gt; certain
&gt;&gt;&gt; &gt; ones, then explore the use of R and N vals that can be passed along
&gt;&gt;&gt; with the
&gt;&gt;&gt; &gt; request or on a bucket-type level.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; On Thu, Mar 3, 2016 at 9:23 PM Mark Schmidt 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Hi Qiang,
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Other more skilled folks can correct me if I am wrong, but I believe
&gt;&gt;&gt; you
&gt;&gt;&gt; &gt;&gt; can enforce strong consistency on your nodes:
&gt;&gt;&gt; &gt;&gt; http://docs.basho.com/riak/latest/theory/concepts/strong-consistency/
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; If I recall, you will take a performance hit as all nodes must
&gt;&gt;&gt; receive the
&gt;&gt;&gt; &gt;&gt; data.
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Thanks,
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; - Mark Schmidt
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; From: riak-users [mailto:riak-users-boun...@lists.basho.com] On
&gt;&gt;&gt; Behalf Of
&gt;&gt;&gt; &gt;&gt; Qiang Cao
&gt;&gt;&gt; &gt;&gt; Sent: Thursday, March 03, 2016 6:13 PM
&gt;&gt;&gt; &gt;&gt; To: Dave King 
&gt;&gt;&gt; &gt;&gt; Cc: riak-users 
&gt;&gt;&gt; &gt;&gt; Subject: Re: Continuous HTTP POSTs to Riak
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Thanks, Dave! I'm aware of Riak's eventual consistency. I wonder how
&gt;&gt;&gt; I can
&gt;&gt;&gt; &gt;&gt; get Riak work in the way as I need. I'm in a situation where I expect
&gt;&gt;&gt; the
&gt;&gt;&gt; &gt;&gt; immediate GET reads the value I've just posted. And the GET request
&gt;&gt;&gt; isn't
&gt;&gt;&gt; &gt;&gt; sent out until the POST is done.
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Thanks,
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; -Qiang
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; On Thu, Mar 3, 2016 at 6:53 PM, Dave King  wrote:
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; You need to google 'Eventual consistency'.
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; - Peace
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Dave
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; On Thu, Mar 3, 2016 at 4:23 PM, Qiang Cao 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Hi All,
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; I use Riak as a KV store and send http requests to its REST API to
&gt;&gt;&gt; update
&gt;&gt;&gt; &gt;&gt; entries. Instead of using curl, I use Apache HttpClient to send
&gt;&gt;&gt; requests.
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; One thing bothering me is that sometimes I find the entry isn't
&gt;&gt;&gt; properly
&gt;&gt;&gt; &gt;&gt; updated after an HTTP POST/PUT. For example, if I do an HTTP GET on
&gt;&gt;&gt; the same
&gt;&gt;&gt; &gt;&gt; key immediately after an HTTP POST, the chance is good that I get a
&gt;&gt;&gt; stale
&gt;&gt;&gt; &gt;&gt; value. This happens when I continuously POST to a multi-node Riak,
&gt;&gt;&gt; and some
&gt;&gt;&gt; &gt;&gt; of the posts target the same key.
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Also, I find I don't have this issue if I use a single-node Riak. So I
&gt;&gt;&gt; &gt;&gt; think something wasn't correct with my multi-node Riak cluster (I set
&gt;&gt;&gt; &gt;&gt; "allow\\_mult" to false). Any thoughts?
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Thanks in advance!
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; Qiang
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; --
&gt;&gt;&gt; &gt; Sincerely,
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Christopher Mancini
&gt;&gt;&gt; &gt; -----------------------------
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; employee = {
&gt;&gt;&gt; &gt; purpose: solve problems with code,
&gt;&gt;&gt; &gt; phone: 7164625591,
&gt;&gt;&gt; &gt; email: cmanc...@basho.com,
&gt;&gt;&gt; &gt; github: http://www.github.com/christophermancini
&gt;&gt;&gt; &gt; }
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt; &gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

