---
title: "Re: Facing exception error in riak-erlang client in erlang shell	while doing Mapreduce"
description: ""
project: community
lastmod: 2014-05-17T08:16:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14224"
mailinglist_parent_id: "msg14223"
author_name: "Gopi Krishna"
project_section: "mailinglistitem"
sent_date: 2014-05-17T08:16:19-07:00
---


Hi,

I got it. very much thanks,one more doubt please clarify it.

same thing i have done for another bucket called "test" which contains data
in the form of key, value.

but when i do map reduce i am getting the following:

{ok, [{0,[S]}]} =
riakc\\_pb\\_socket:mapred(Pid,&lt;&lt;"test"&gt;&gt;,[{map,{qfun,Maps},none,true}]).
\\*\\* exception error: no match of right hand side value {ok,[{0,
 [&lt;&lt;"{\\"age\\":
24, \\"name\\": \\"krishna\\"}"&gt;&gt;,
 &lt;&lt;"{\\"age\\":
29, \\"name\\": \\"sharat\\"}"&gt;&gt;,
 &lt;&lt;"{\\"age\\":
27, \\"name\\": \\"anil\\"}"&gt;&gt;,
 &lt;&lt;"{\\"age\\":
28, \\"name\\": \\"kumar\\"}"&gt;&gt;,
 &lt;&lt;"{\\"age\\":
24, \\"name\\": \\"gopi\\"}"&gt;&gt;,
 &lt;&lt;"{\\"age\\":
25, \\"name\\": \\"ramesh\\"}"&gt;&gt;]}]}





On Sat, May 17, 2014 at 8:21 PM, Steve Vinoski  wrote:

&gt;
&gt;
&gt;
&gt; On Sat, May 17, 2014 at 10:04 AM, Gopi Krishna wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I am getting the following , don't know what was happening could you
&gt;&gt; please elaborate and explain the solution to this.
&gt;&gt;
&gt;&gt; I am working on erlang-riak-client.
&gt;&gt;
&gt;&gt;
&gt;&gt; 1&gt; {ok, Pid} = riakc\\_pb\\_socket:start\\_link('127.0.0.1',10017).
&gt;&gt; {ok,&lt;0.34.0&gt;}
&gt;&gt; 2&gt;
&gt;&gt; 2&gt;
&gt;&gt; 2&gt; Object = riakc\\_obj:new(&lt;&lt;"test\\_age"&gt;&gt;, &lt;&lt;"test1"&gt;&gt;, &lt;&lt;"gopi & 1"&gt;&gt;).
&gt;&gt; {riakc\\_obj,&lt;&lt;"test\\_age"&gt;&gt;,&lt;&lt;"test1"&gt;&gt;,undefined,[],
&gt;&gt; undefined,&lt;&lt;"gopi & 1"&gt;&gt;}
&gt;&gt; 3&gt;
&gt;&gt; 3&gt;
&gt;&gt; 3&gt; riakc\\_pb\\_socket:put(Pid,Object).
&gt;&gt; ok
&gt;&gt; 4&gt;
&gt;&gt; 4&gt; Mapf = fun(Obj,\\_,\\_) -&gt; [{I,1}|| I &lt;-
&gt;&gt; binary\\_to\\_term(riak\\_object:get\\_value(Object))] end.
&gt;&gt;
&gt;
&gt; There are two problems with your Mapf function:
&gt;
&gt; 1. The body of the function incorrectly uses Object, which is a variable
&gt; in your shell from command 2, rather than Obj, the incoming parameter to
&gt; the function. This is the source of the function\\_clause error you're
&gt; getting.
&gt;
&gt; 2. You've stored a binary value in your object, not an Erlang term, so
&gt; binary\\_to\\_term will fail here with a badarg exception. Change your Mapf
&gt; function to this instead:
&gt;
&gt; Mapf = fun(Obj,\\_,\\_) -&gt; [riak\\_object:get\\_value(Obj)] end.
&gt;
&gt; #Fun
&gt;&gt; 5&gt; {ok, [{0,[R]}]} =
&gt;&gt; riakc\\_pb\\_socket:mapred(Pid,&lt;&lt;"test\\_age"&gt;&gt;,[{map,{qfun,Mapf},none,true}])
&gt;&gt; 5&gt; .
&gt;&gt; \\*\\* exception error: no match of right hand side value
&gt;&gt; {error,&lt;&lt;"{\\"phase\\":0,\\"error\\":\\"function\\_clause\\",\\"input\\":\\"{ok,{r\\_object,&lt;&lt;\\\\\\"test\\_age\\\\\\"&gt;&gt;,&lt;&lt;\\\\\\"test1\\\\\\"&gt;&gt;,[{r\\_content,{dict"...&gt;&gt;}
&gt;&gt;
&gt;
&gt; If you make the changes I described above, you get:
&gt;
&gt; 5&gt; {ok, [{0,[R]}]} =
&gt; riakc\\_pb\\_socket:mapred(Pid,&lt;&lt;"test\\_age"&gt;&gt;,[{map,{qfun,Mapf},none,true}]).
&gt; {ok,[{0,[&lt;&lt;"gopi & 1"&gt;&gt;]}]}
&gt; 6&gt; R.
&gt; &lt;&lt;"gopi & 1"&gt;&gt;
&gt;
&gt; exactly as expected.
&gt;
&gt; --steve
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 

Thanks & Regards,
J.Gopi Krishna
+91-8341452934,
www.lintelindia.com
Lintel Technologies Pvt. LTD,Hyderabad.

This message contains confidential information and is intended for
recipient. If you are not the intended recipient you are notified that
disclosing, copying, distributing or taking any action in reliance on the
contents of this information is strictly prohibited. E-mail transmission
cannot be guaranteed to be secure or error-free as information could be
intercepted, corrupted, lost, destroyed, arrive late or incomplete, or
contain viruses. The sender therefore does not accept liability for any
errors or omissions in the contents of this message, which arise as a
result of e-mail transmission. If verification is required please request a
hard-copy version.
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

