---
title: "Re: Precommit hook function - no error log - how to debug?"
description: ""
project: community
lastmod: 2016-05-17T16:49:57-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17384"
mailinglist_parent_id: "msg17373"
author_name: "Sanket Agrawal"
project_section: "mailinglistitem"
sent_date: 2016-05-17T16:49:57-07:00
---


Luke,

Thank you so much for in-depth instructions for setting up multi-node dev
cluster on the same server. I have confirmed that the precommit hook now
works, with your instructions, as non-root user.

Especially, the instructions on doing dev build for 3 nodes were very
helpful! I will run a diff with my original installation to see what might
be the issue, and report back if I find anything.

Thanks again.

On Tue, May 17, 2016 at 5:03 PM, Luke Bakken  wrote:

&gt; Hello everyone -
&gt;
&gt; I have confirmed that precommit hooks are correctly called in a 3-node
&gt; environment, running on the same VM. Riak was both started by and is
&gt; running as a local user account (no "root" permissions necessary).
&gt;
&gt; Overview of the verification process can be found here:
&gt; https://gist.github.com/lukebakken/4c097233e2bfc4bf81233ce5581bde1d
&gt;
&gt; I built Riak using these commands:
&gt;
&gt; git clone git://github.com/basho/riak
&gt; cd riak && git co riak-2.1.4
&gt; make locked-deps
&gt; make stagedevrel DEVNODES=3
&gt;
&gt; Sanket -
&gt;
&gt; At this point, all indication is that this issue is due to something
&gt; specific to your environment. Since Amazon Linux is based on CentOS /
&gt; RedHat, the official packages for one of those distros \\*should\\* work.
&gt; I recommend that you use three separate servers and install official
&gt; packages on them, which should resolve this issue.
&gt;
&gt; If you start over from a source build \\*and\\* require multiple nodes to
&gt; run on the same server, please use "make stagedevrel DEVNODES=3"
&gt; rather than "make rel". This should correctly create three dev
&gt; directories, each with a separate Riak ready to run in them. Note that
&gt; this is \\*not\\* a supported production environment, but is appropriate
&gt; for testing.
&gt;
&gt; Thanks -
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt; On Tue, May 17, 2016 at 11:10 AM, Luke Bakken  wrote:
&gt; &gt;
&gt; &gt; Riak users subscribers -
&gt; &gt;
&gt; &gt; I would like to add the caveat that this workaround indicates an
&gt; environment-specific issue and not (at this point) a bug in Riak. I am
&gt; working to get to the root cause (pun intended)
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt; Luke
&gt; &gt; lbak...@basho.com
&gt; &gt;
&gt; &gt; On May 17, 2016 10:54 AM, "Sanket Agrawal" 
&gt; wrote:
&gt; &gt; &gt;
&gt; &gt; &gt; All, the issue is fixed now - the problem is that Riak precommit and
&gt; postcommit hooks seem to work only in root user mode. On AWS, switching
&gt; from ec2-user to root user fixed the precommit trigger issue.
&gt; &gt; &gt; That does raise the question of whether Riak should really be using
&gt; root user account. For example, Postgresql runs fine as non-root user.
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

