---
title: "Re: Durable writes and parallel reads"
description: ""
project: community
lastmod: 2011-11-03T16:21:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05439"
mailinglist_parent_id: "msg05388"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-11-03T16:21:38-07:00
---


Hi Erik,

Apologies it's taken so long to get back to you.

Durable writes:
 You're interpreting it correctly. DW means that the storage backend has
accepted the write. As the backends are pluggable and configurable so that
affects what durable means. For bitcask you can control the sync strategy
and there are similar controls for innodb. For the memory backend there is
no durable write. With hindsight it would have been better to have used
something like accepted write (AW) and write (W) rather than W/DW, but
we're fairly stuck with it now. Combining writes/acceptance is a very
interesting idea going forward, but doesn't fit well with the sync nature
of the backend API we have currently.

Parallel reads:
 With 1.0.0 we've introduced a thread pool to increase the concurrency
vnodes can use for listing keys. I'd like to improve on read concurrency.
 The current architecture ensures that a key is only updated by a single
thread which makes writing backend drivers simpler. We either need to add
support to the k/v vnode to ensure the property is true when being updated
in parallel or change the backend drivers to be tolerant of it.

The performance numbers are interesting. How many vnodes were you
simulating?

Jon.

On Mon, Oct 31, 2011 at 10:38 AM, Erik Søe Sørensen  wrote:

&gt; The following is a couple of questions (and suggestions) regarding the
&gt; technical sides of Riak performance and reliability.
&gt;
&gt; The questions have been prompted by reading Riak source code and by
&gt; discussions within our company.
&gt;
&gt; I suppose the common thread here is "latency hiding"...
&gt;
&gt; Durable Writes.
&gt; ---------------
&gt; The default for bitcask's 'sync\\_strategy' setting is not to flush to disk
&gt; explicitly at all.
&gt;
&gt; This means that a 'Durable Write' isn't actually durable; the difference
&gt; between 'W' and 'DW' replies is whether the write has made it past Riak, to
&gt; the OS - but not through the OS and down to disk.
&gt;
&gt; Is this correct?
&gt;
&gt; What I'd have expected, as a reaonably-performing alternative, is that
&gt; Riak would flush periodically - say, after at most W\\_flush writes or
&gt; MS\\_flush milliseconds, and send 'dw' replies for all of the relevant
&gt; requests (those written since last flush) at once after the flush has been
&gt; completed.
&gt; This would combine 'real' DW semantics with reasonable performance (and is
&gt; how I have handled a similar problem; my conceptions about what is right
&gt; and proper may of course be influenced by my own coding history...).
&gt;
&gt; (For kicks, MS\\_flush might even be dynamically determined by how long the
&gt; flush operations tend to take; the typical value of a flush duration,
&gt; multiplied by a small constant, would probably be a fitting value.)
&gt;
&gt;
&gt; Parallel Reads.
&gt; ---------------
&gt; Within a vnode, bitcask read operations happen in serial.
&gt; Is there any reason for reads not happening in parallel?
&gt;
&gt; For map/reduce operations, in particular, I imagine this might make a
&gt; difference, by giving the OS the opportunity to schedule disk accesses so
&gt; as to reduce seek time.
&gt;
&gt; (Unless of course Riak itself reorders the keys before reading, but I
&gt; don't believe this is the case - especially since the order would depend on
&gt; the backend: for bitcask, by time; for innostore, by key order, for
&gt; instance.)
&gt;
&gt; Of course, if each host has multiple vnodes, there will be some
&gt; parallellity even with serialized reads within each bitcask.
&gt;
&gt; Regards,
&gt; Erik Søe Sørensen
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\\*\\*mailman/listinfo/riak-users\\_\\*\\*lists.basho.com
&gt;



-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

