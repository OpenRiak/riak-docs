---
title: "Re: Error interpretation"
description: ""
project: community
lastmod: 2013-03-13T19:19:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10425"
mailinglist_parent_id: "msg10419"
author_name: "Tony Schwartz"
project_section: "mailinglistitem"
sent_date: 2013-03-13T19:19:48-07:00
---


Hi, I was struggling with an error that produced that error message. My
solution was to set the default bucket properties in app.config.

I set allow\\_mult to false and last\\_write\\_wins to true.

Go to app.config and under 'riak\\_core', you can add the 'default bucket
props' as shown here:

http://docs.basho.com/riak/1.2.1/references/Configuration-Files/#default\\_bucket\\_props

I was able to talk with Ryan Zezeski who recommended this solution to me,
saying that Riak Search creates buckets behind the scenes that rely on the
allow\\_mult being false.

Doing this does disable siblings and therefore conflict resolution, so you
can enable allow\\_mult: true, last\\_write\\_wins: false, and/or search
precommit on buckets individually via a set bucket properties call.

-Tony

On Wed, Mar 13, 2013 at 6:36 PM, Jeremiah Peschka &lt;
jeremiah.pesc...@gmail.com&gt; wrote:

&gt;
&gt;
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt;
&gt;
&gt; On Wed, Mar 13, 2013 at 6:27 PM, Kevin Burton wrote:
&gt;
&gt;&gt; So the only change you made was to enable search for the bucket. And
&gt;&gt; since I am not using search (just trying to store the object) you could
&gt;&gt; remove that also. Why did you feel that it was needed?
&gt;&gt;
&gt;
&gt; Because your initial error message was {precommit\\_fail,{hook\\_crashed,{\\*
&gt; riak\\_search\\_kv\\_hook\\*,precommit,error,badarg}}}
&gt;
&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\* \\*\\*
&gt;&gt;
&gt;&gt; This brings us back to the original question though. What does the error
&gt;&gt; tell me about the configuration? The test that everything works on the
&gt;&gt; Basho site is to save a binary image to the cluster and retrieve it. If
&gt;&gt; this is successful then the cluster seems healthy. I did this and there was
&gt;&gt; no errors. It seems that I get this error only when I try JSON data which
&gt;&gt; is the data I want to store. So what could be specifically wrong about my
&gt;&gt; configuration data that allows binary image data but throws an error when
&gt;&gt; saving JSON data?
&gt;&gt;
&gt; If you're saving to a different bucket, which your curl commands indicate,
&gt; my guess is that the cluster is healthy something is busted within your
&gt; bucket configuration for the buyseasons-orders bucket. Once you perform a
&gt; rolling update to 1.3 (or create a new cluster) you can reset the bucket
&gt; properties[1]. Or, if you want to be lazy, you could try saving to a random
&gt; bucket like "buyseasons-orders-asdf1234" or "CC5DF49B-D8D3-4B2D-ABBD-1
&gt; B63A4F10FFF".
&gt;
&gt; Either way, my suspicion remains that there is something nasty going on
&gt; with your bucket properties that's causing you some grief on this bucket.
&gt; Could you take a look at the bucket properties [2] and post them on list or
&gt; in a gist?
&gt;
&gt; [1]:
&gt; http://docs.basho.com/riak/latest/references/apis/http/HTTP-Reset-Bucket-Properties/
&gt;
&gt; [2]:
&gt; http://docs.basho.com/riak/latest/references/apis/http/HTTP-Get-Bucket-Properties/
&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\* \\*\\*
&gt;&gt;
&gt;&gt; \\*From:\\* Jeremiah Peschka [mailto:jeremiah.pesc...@gmail.com]
&gt;&gt; \\*Sent:\\* Wednesday, March 13, 2013 8:10 PM
&gt;&gt;
&gt;&gt; \\*To:\\* Kevin Burton
&gt;&gt; \\*Cc:\\* riak-users
&gt;&gt; \\*Subject:\\* Re: Error interpretation\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\* \\*\\*
&gt;&gt;
&gt;&gt; Try now, this appears to fall into the "Jeremiah can't work anything that
&gt;&gt; requires security" category.\\*\\*\\*\\*
&gt;&gt;
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; ---\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; MCITP: SQL Server 2008, MVP\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Cloudera Certified Developer for Apache Hadoop\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\* \\*\\*
&gt;&gt;
&gt;&gt; On Wed, Mar 13, 2013 at 6:06 PM, Kevin Burton 
&gt;&gt; wrote:\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Thank you. I was not trying to search I was just trying to store the
&gt;&gt; value.\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; When I try to open the file I get\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; The website declined to show this webpage\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; So I am not sure what changes you made.\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*From:\\* Jeremiah Peschka [mailto:jeremiah.pesc...@gmail.com]
&gt;&gt; \\*Sent:\\* Wednesday, March 13, 2013 7:41 PM
&gt;&gt; \\*To:\\* Kevin Burton
&gt;&gt; \\*Cc:\\* riak-users
&gt;&gt; \\*Subject:\\* Re: Error interpretation\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; I ran the sample code you sent over on my local machine and it ran
&gt;&gt; without error. I did have to enable riak search on an individual bucket by
&gt;&gt; setting bucket properties, but you can see the changes I made here:
&gt;&gt; http://clientresources.brentozar.com.s3.amazonaws.com/CITest.zip\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; You may not get the search results that you want from your JSON document
&gt;&gt; because it doesn't conform to the default Riak Search schema -
&gt;&gt; http://docs.basho.com/riak/latest/cookbooks/Riak-Search---Schema/#The-Default-Schema
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; ---\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; MCITP: SQL Server 2008, MVP\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Cloudera Certified Developer for Apache Hadoop\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; On Wed, Mar 13, 2013 at 5:32 PM, Kevin Burton 
&gt;&gt; wrote:\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Instead of using a binary file I tried a file that contains serialized
&gt;&gt; JSON data. I am getting pretty much the same error:\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; 500 Internal Server
&gt;&gt; ErrorInternal Se\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; rver Error
====================================

The server encountered an error while processing this
&gt;&gt; request:&gt;
&gt;&gt; &gt;
```
{error,****
&gt;&gt;
&gt;&gt;     {error,badarg,****
&gt;&gt;
&gt;&gt;         [{erlang,iolist_to_binary,****
&gt;&gt;
&gt;&gt;
&gt;&gt; [{hook_crashed,{riak_search_kv_hook,precommit,error,badarg}}],****
&gt;&gt;
&gt;&gt;              []},****
&gt;&gt;
&gt;&gt;
&gt;&gt; {wrq,append_to_response_body,2,[{file,"src/wrq.erl"},{line,205}]},****
&gt;&gt;
&gt;&gt;          {riak_kv_wm_object,handle_common_error,3,****
&gt;&gt;
&gt;&gt;              [{file,"src/riak_kv_wm_object.erl"},{line,998}]},****
&gt;&gt;
&gt;&gt;          {webmachine_resource,resource_call,3,****
&gt;&gt;
&gt;&gt;              [{file,"src/webmachine_resource.erl"},{line,183}]},****
&gt;&gt;
&gt;&gt;          {webmachine_resource,do,3,****
&gt;&gt;
&gt;&gt;              [{file,"src/webmachine_resource.erl"},{line,141}]},****
&gt;&gt;
&gt;&gt;          {webmachine_decision_core,resource_call,1,****
&gt;&gt;
&gt;&gt;              [{file,"src/webmachine_decision_core.erl"},{line,48}]},****
&gt;&gt;
&gt;&gt;          {webmachine_decision_core,accept_helper,0,****
&gt;&gt;
&gt;&gt;              [{file,"src/webmachine_decision_core.erl"},{line,606}]},****
&gt;&gt;
&gt;&gt;          {webmachine_decision_core,decision,1,****
&gt;&gt;
&gt;&gt;
&gt;&gt; [{file,"src/webmachine_decision_core.erl"},{line,577}]}]}}
```
\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; 

---

mochiweb+webmachine web server

\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; From\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; curl -XPUT http://devUBuntu01:8098/riak/buyseasons-orders/1 -H
&gt;&gt; "Content-type:application/json" --data-binary @test.json\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; So given this error any suggestions as to the meaning?\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; I can put the JSON file on dropbox or someother media if it is needed. \\*\\*
&gt;&gt; \\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Thank you.\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*From:\\* Kevin Burton [mailto:rkevinbur...@charter.net]
&gt;&gt; \\*Sent:\\* Wednesday, March 13, 2013 9:28 AM
&gt;&gt; \\*To:\\* 'Jeremiah Peschka'; 'riak-users'
&gt;&gt; \\*Subject:\\* RE: Error interpretation\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; So the question remains in my mind why\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; curl -XPUT http://devUbuntu01:8098/riak/images/1.jpg -H "Content-type:
&gt;&gt; image/jpeg" --data-binary @test.jpg\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; and the corresponding read\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; curl -v http://devUbuntu01:8098/riak/images/1.jpg &gt;test-read.jpg\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; work without error but the CI call to put fails? How are these different?
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*From:\\* riak-users 
&gt;&gt; [mailto:riak-users-boun...@lists.basho.com]
&gt;&gt; \\*On Behalf Of \\*Jeremiah Peschka
&gt;&gt; \\*Sent:\\* Tuesday, March 12, 2013 8:35 PM\\*\\*\\*\\*
&gt;&gt;
&gt;&gt;
&gt;&gt; \\*To:\\* riak-users
&gt;&gt; \\*Subject:\\* Re: Error interpretation\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Default leveldb config is (when built using `make devrel`): \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; %% eLevelDB Config\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; {eleveldb, [\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; {data\\_root, "./data/leveldb"}\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; ]},\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Drop everything but the data\\_root. Also: simplify your set up. You're
&gt;&gt; running into timeout errors in a networked environment. Test your
&gt;&gt; functionality on a local cluster (either 1 node or a devrel setup with 4
&gt;&gt; nodes). Validate your logic and functionality there.\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; I wish I could promise that I can help out at all, but I just got back
&gt;&gt; from 12 days out of the country and I'm booked solid for the next two
&gt;&gt; weeks. In short - my responses will be hit or miss at best.\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Good luck and godspeed.\\*\\*\\*\\*
&gt;&gt;
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; ---\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; MCITP: SQL Server 2008, MVP\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; Cloudera Certified Developer for Apache Hadoop\\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\*\\*\\*
&gt;&gt;
&gt;&gt; \\*\\* \\*\\*
&gt;&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

