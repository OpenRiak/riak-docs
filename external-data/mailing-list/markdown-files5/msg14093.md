---
title: "Re: reversing node removal?"
description: ""
project: community
lastmod: 2014-04-15T10:00:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14093"
mailinglist_parent_id: "msg14092"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2014-04-15T10:00:25-07:00
---


Hi Allen -

I hope you don't take my response as an assignment of blame. I created the
docs issue specifically because this case is not clear nor would I expect
Riak users to "just know" that your situation could happen when they use
"cluster leave" to remove Riak nodes from a cluster.

Every software system makes different decisions about protecting users from
potentially disruptive actions and none protect from all possible failure
scenarios. SQL Server does not protect you from inserting so much data you
fill a disk, for instance.

I'll also follow up with the Product team to discuss more insight into the
outcome of various "riak-admin cluster" operations.

--
Luke Bakken
CSE
lbak...@basho.com


On Tue, Apr 15, 2014 at 9:44 AM, Allen Landsidel
wrote:

&gt; I realize I made a mistake, it would just be nice if the UI could warn me
&gt; that I was about to do so, especially given the consequences.
&gt;
&gt; If it was simply showing me how much space each node was using (forget a
&gt; percentage or anything) that would've been enough to avert disaster. With
&gt; four nodes, if they're over 25% capacity (far lower than any sensible
&gt; warning level in a monitoring system), the cluster leave is going to fail.
&gt; The more nodes you add to the system, the lower you'd have to set that
&gt; warning threshold to alert you that you're in a state where you can't
&gt; safely retire a node.
&gt;
&gt;
&gt; On 4/15/2014 12:40, Luke Bakken wrote:
&gt;
&gt;&gt; Hi Allen -
&gt;&gt;
&gt;&gt; Failure / node leave situations should be taken into account during
&gt;&gt; cluster capacity planning. I've created an issue to more thoroughly
&gt;&gt; explain this in our documentation:
&gt;&gt;
&gt;&gt; https://github.com/basho/basho\\_docs/issues/1034
&gt;&gt;
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; CSE
&gt;&gt; lbak...@basho.com 
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Apr 15, 2014 at 9:28 AM, Allen Landsidel
&gt;&gt; &gt; wrote:
&gt;&gt;
&gt;&gt; Luke,
&gt;&gt;
&gt;&gt; I already do use nagios for that, but the disk space was fine before
&gt;&gt; I told one of the nodes to leave the cluster. That's my problem --
&gt;&gt; there was not enough free space in the cluster for it to move all
&gt;&gt; that nodes data. It accepted the leave and then ran me out of disk
&gt;&gt; space on all the other nodes, with no way to abort or recover.
&gt;&gt;
&gt;&gt; My only option was to add more space to the other nodes (as you
&gt;&gt; said, adding new nodes will not work until the leave is done), which
&gt;&gt; is easy enough in a virtualized environment but requires downtime.
&gt;&gt; In a bare metal environment, it could be catastrophic to the
&gt;&gt; cluster.
&gt;&gt;
&gt;&gt;
&gt;&gt; On 4/15/2014 12:19, Luke Bakken wrote:
&gt;&gt;
&gt;&gt; Hi Allen,
&gt;&gt;
&gt;&gt; Cluster leave does not check for disk space and in general, Riak
&gt;&gt; is not
&gt;&gt; aware of how much space it has available to itself (most db
&gt;&gt; systems
&gt;&gt; don't monitor disk space I think). I'll send a note to product
&gt;&gt; management about this. We recommend using a monitoring solution
&gt;&gt; (like
&gt;&gt; collectd + graphite) to keep an eye on available disk space.
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; CSE
&gt;&gt; lbak...@basho.com 
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

