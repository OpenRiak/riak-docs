---
title: "Re: Riak crash on node restarts"
description: ""
project: community
lastmod: 2011-11-18T03:56:22-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05653"
mailinglist_parent_id: "msg05652"
author_name: "Jeremy Raymond"
project_section: "mailinglistitem"
sent_date: 2011-11-18T03:56:22-08:00
---


Something else I tried to give the cluster more time to settle was to wait
until riak-admin transfers reported no pending transfers between updating
nodes. I've had cases where the transfers didn't complete within at least a
couple of hours of waiting. What would be typical amount of time for
pending transfers to complete?

--
Jeremy


On Fri, Nov 18, 2011 at 6:48 AM, Jeremy Raymond  wrote:

&gt; Hello,
&gt;
&gt; I'll setup my deploy script to capture this information and send you the
&gt; info off-list (probably sometime next week).
&gt;
&gt; --
&gt; Jeremy
&gt;
&gt; On 2011-11-15, at 1:16 PM, Jon Meredith wrote:
&gt;
&gt; Hi Joel,
&gt;
&gt; That's not a message I'd expect to see on a clean restart. We'll need
&gt; some more information to diagnose it. Next time it crashes, could you
&gt; provide the contents of your ring file (you can just grab the most recent
&gt; one out of /var/lib/riak/ring - location may vary depending on your
&gt; platform) and it would be very helpful if you could modify your deploy
&gt; script to capture the file list for the leveldb directory on \\*all\\* of your
&gt; nodes immediately before you bounce riak to do the update. When it
&gt; crashes, the console.log from all the nodes would also be useful. If any
&gt; of those files contain sensitive information, please contact me off list.
&gt;
&gt; BR, Jon
&gt;
&gt; On Tue, Nov 15, 2011 at 6:48 AM, Jeremy Raymond wrote:
&gt;
&gt;&gt; I'm using Riak 1.0.1 and I have a script that deploys updates to each of
&gt;&gt; my 3 nodes to update the Erlang mapred modules. What I do is stop a node,
&gt;&gt; deploy the new mapred modues, restart the node, wait for the riak\\_kv
&gt;&gt; service to start, then move onto the next node. Sometimes when I do this
&gt;&gt; one of the nodes that is not the current one being updated will go down.
&gt;&gt; Each time this has happened thus far it's been the same node that will go
&gt;&gt; down (the last one). I see this error in the logs:
&gt;&gt;
&gt;&gt; [error] Failed to start riak\\_kv\\_eleveldb\\_backend Reason: {db\\_open,"IO
&gt;&gt; error:
&gt;&gt; /var/lib/riak/leveldb/913438523331814323877303020447676887284957839360/MANIFEST-000002:
&gt;&gt; No such file or directory"}
&gt;&gt;
&gt;&gt; If I manually restart the node, things go back to normal. Any ideas on
&gt;&gt; what's going on? I've attached the error log.
&gt;&gt;
&gt;&gt; --
&gt;&gt; Jeremy
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Jon Meredith
&gt; Platform Engineering Manager
&gt; Basho Technologies, Inc.
&gt; jmered...@basho.com
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

