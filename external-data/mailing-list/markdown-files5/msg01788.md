---
title: "Re: using the erlang API for riak search"
description: ""
project: community
lastmod: 2010-12-14T11:30:26-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01788"
mailinglist_parent_id: "msg01778"
author_name: "carson li"
project_section: "mailinglistitem"
sent_date: 2010-12-14T11:30:26-08:00
---


Hi Rusty,

That makes sense but i'm still running into problems. My code is simple

Pid = get\\_riak\\_client(),
{ok, Results} = riak\\_pb\\_socket:search(Pid, "testB", "firstName:Billie").

This returns the following error.

{error,{error,undef,
 [{riak\\_pb\\_socket,search,[&lt;0.97.0&gt;,"testB","firstName:Billie"]},
 {webmachine\\_demo\\_resource,to\\_text,2},
 {webmachine\\_demo\\_resource,to\\_html,2},
 {webmachine\\_resource,resource\\_call,3},
 {webmachine\\_resource,do,3},
 {webmachine\\_decision\\_core,resource\\_call,1},
 {webmachine\\_decision\\_core,decision,1},
 {webmachine\\_decision\\_core,handle\\_request,2}]}}


So something isn't right, and i'm not getting any results back. What
exactly am i doing wrong? Just to double check that the query itself is
correct and the data is there, going to the terminal, and doing a
"search-cmd search testB "firstName:Billie" returns me

:: Searching for 'firstName:Billie' in testB...

------------------------------

index/id: testB/testK1
p -&gt; [0]
score -&gt; 0.5

------------------------------

 :: Found 1 results.


So i know the item is in there. is my syntax wrong? or am i missing
something?


On Tue, Dec 14, 2010 at 2:01 PM, Rusty Klophaus  wrote:

&gt; Hi Carson,
&gt;
&gt; You are definitely on the right track. The SearchQuery parameter is a
&gt; Lucene-syntax-ish search query, and the Bucket parameter is the bucket on
&gt; which to search. You can find more information on the query syntax here:
&gt; http://wiki.basho.com/display/RIAK/Riak+Search+-+Querying
&gt;
&gt; Usage is as follows:
&gt;
&gt; {ok, Pid} = riakc\\_pb\\_socket:start("127.0.0.1", "8087"),
&gt; Bucket = "json",
&gt; SearchQuery = "firstname:John"),
&gt; {ok, BucketKeyList} = riakc\\_pb\\_socket:search(Pid, Bucket, SearchQuery,
&gt; riakc\\_pb\\_socket:stop(Pid).
&gt;
&gt; You can also do more complicated things like using the results to spawn a
&gt; map/reduce operation by adding a MapReducePhases parameter. You can find
&gt; more information on map/reduce phases here:
&gt; http://wiki.basho.com/display/RIAK/MapReduce
&gt;
&gt; {ok, Result} = riakc\\_pb\\_socket:search(Pid, "json", "firstname:John",
&gt; MapReducePhases, TimeoutInMS),
&gt;
&gt; Best,
&gt; Rusty
&gt;
&gt; On Mon, Dec 13, 2010 at 4:33 PM, carson li 
&gt; wrote:
&gt;
&gt;&gt; hey everyone,
&gt;&gt;
&gt;&gt; i just started off with using riak search. (i have some basic riak
&gt;&gt; experience) and i don't know how to use the erlang api for riak to do search
&gt;&gt; queries.
&gt;&gt;
&gt;&gt; what i've done so far
&gt;&gt; ------------------------------
&gt;&gt; I have successfully installed the KV hook, put in a json document,
&gt;&gt; and also used the search-cmd to retrieve something. for reference i put
&gt;&gt; in the json
&gt;&gt;
&gt;&gt; {
&gt;&gt; firstname:"John",
&gt;&gt; lastName:"Smith"
&gt;&gt; }
&gt;&gt;
&gt;&gt; with the command curl -X PUT http://127.0.0.1:8098/riak/test/123 -H
&gt;&gt; "Content-Type: application/json" -d @test.json
&gt;&gt;
&gt;&gt; to retrieve something i by navigating to riah search's bin, then
&gt;&gt; ./search-cmd search json firstname:John
&gt;&gt;
&gt;&gt; the above works well.
&gt;&gt; now i'm buildling an aplpication with webmachine / erlang. and i want to
&gt;&gt; be able to perform searches as well.
&gt;&gt; the wiki indicates that the Erlang api should support this
&gt;&gt;
&gt;&gt; https://wiki.basho.com/display/RIAK/Riak+Search+-+Querying
&gt;&gt;
&gt;&gt; looking at riakc\\_pb\\_socket.erl, i see there is a search method that has
&gt;&gt; the signature search(Pid, Bucket, SearchQuery)
&gt;&gt;
&gt;&gt; so what exactly is SearchQuery, how is it supposed to look like. So it
&gt;&gt; just gets passed into a mapred\\_search?
&gt;&gt; I'm confused on how this works. Can someone please provide a simple
&gt;&gt; example, of how i can search for say firstname:John with the json above?
&gt;&gt;
&gt;&gt; any help would be greatly appreciated.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Carson Li
&gt;&gt; Liquid Analytics
&gt;&gt; carson...@liquidanalytics.com
&gt;&gt; 647-273-1024
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;


-- 
Carson Li
Liquid Analytics
carson...@liquidanalytics.com
647-273-1024
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

