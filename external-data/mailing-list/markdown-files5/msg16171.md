---
title: "Re: SolrSpatial Problem"
description: ""
project: community
lastmod: 2015-06-01T12:48:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16171"
mailinglist_parent_id: "msg16170"
author_name: "Drew Kerrigan"
project_section: "mailinglistitem"
sent_date: 2015-06-01T12:48:37-07:00
---


Hello Sinh

Here is a working example of the setup for a "find all records within X
miles of a lat,lon point":

https://gist.github.com/drewkerrigan/c7cabcbc46c10957248e

Without digging too much into the exact problem you're encountering, I
think at a high level you should not be attempting to modify the default
schema (http://localhost:8098/search/schema/\\_yz\\_default)

Any custom schemas should be named something other than \\_yz\\_default, like
"my\\_geo\\_schema".

Thanks,
Drew



On Mon, Jun 1, 2015 at 3:37 PM sinh nguyen  wrote:

&gt; My goal is trying to retrieve all locations within a boundary using Solr
&gt; function IsWithin(Polygon()). I am using 2.1.1 and follow this
&gt; documentation from solr
&gt; https://wiki.apache.org/solr/SolrAdaptersForLuceneSpatial4.
&gt;
&gt; First, I downloaded schema from Basho git hub
&gt;
&gt; https://raw.githubusercontent.com/basho/yokozuna/develop/priv/default\\_schema.xml
&gt;
&gt;
&gt; Then I added new fieldtype to schema.xml
&gt;
&gt;  class="solr.SpatialRecursivePrefixTreeFieldType"
&gt; 
&gt; spatialContextFactory="com.spatial4j.core.context.jts.JtsSpatialContextFactory"
&gt; distErrPct="0.025"
&gt; maxDistErr="0.000009"
&gt; units="degrees"
&gt; /&gt;
&gt;
&gt;
&gt; I added new field to schema.xml
&gt;
&gt;  stored="true" multiValued="true" /&gt;
&gt;
&gt;  multiValued="true" /&gt;
&gt;
&gt;
&gt; I uploaded to server
&gt;
&gt; curl -i -XPUT http://localhost:8098/search/schema/\\_yz\\_default \\
&gt; -H 'content-type: application/xml' \\
&gt; --data-binary @schema.xml
&gt;
&gt;
&gt; I create new object
&gt;
&gt; curl -i -H 'content-type: application/json' -X PUT 
&gt; 'http://localhost:8098/types/geo\\_type/buckets/stuff/keys/sf' -d 
&gt; '{"name\\_tssd":"San Francisco", 
&gt; "loc\\_geotest":"37.774929,-122.419416","myloc":"37.774929,-122.419416"}'
&gt;
&gt;
&gt; But Solr only indexes "name\\_tssd" and neither "loc\\_geotest" nor "myloc" is
&gt; indexed.
&gt;
&gt; Please help!
&gt;
&gt; PS: How do you remove custom schema.xml?
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

