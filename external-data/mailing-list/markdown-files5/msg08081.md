---
title: "Re: Riak 1.1.1 and eleveldb map/reduce timeouts"
description: ""
project: community
lastmod: 2012-07-26T03:03:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08081"
mailinglist_parent_id: "msg08065"
author_name: "Erik Hoogeveen"
project_section: "mailinglistitem"
sent_date: 2012-07-26T03:03:37-07:00
---


Hello John,

I'm not really an expert but looking at your crash log my first guess is that 
an error occurs in the reduce part of the map/reduce of the job itself.
More specifically I think you need to examine the meaning of this bit in your 
crash report:

&gt; {details,{fitting\\_details,{fitting,&lt;11882.27640.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,follow,1},{prereduce,0},riak\\_kv\\_w\\_reduce,{rct,#Fun,none},{fitting,&lt;11882.27639.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,&lt;&lt;103,28,147,16,123,67,248,114,104,204,9,54,33,62,81,41,129,84,203,83&gt;&gt;,1},[{sink,{fitting,&lt;11882.24969.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64}}]}]


But like I said, it's just a hunch.

Cheers,
Erik Hoogeveen

On 25 jul 2012, at 20:11, John Roy wrote:

&gt; Hi --
&gt; 
&gt; I'm seeing an issue with timeouts for map/reduces. We're running erlang 
&gt; files via a curl command, as
&gt; part of a haskell job. In the curl data we specify the timeout to be one 
&gt; hour (3,600,000 milliseconds --
&gt; see the example below). However, the job crashes (times out) after well less 
&gt; than an hour 
&gt; (genarally 450-1000 seconds). See the sample crash below.
&gt; 
&gt; Does anyone have an idea or insight on why that might occur? I've done some 
&gt; searching on the riak\\_kv
&gt; code but haven't been able to trace the error through it yet.
&gt; 
&gt; A sample mr (similar to this one) has 3398 keys which should map 278012 items 
&gt; to be reduced.
&gt; 
&gt; We're using eleveldb back end with riak 1.1.1 
&gt; 
&gt; One other note, we can be running more than one mr over the same data 
&gt; simultaneously.
&gt; 
&gt; Thanks for your help!
&gt; 
&gt; 
&gt; 
&gt; the input to the curls is something like this:
&gt; {
&gt; "inputs" : {
&gt; "bucket" : "data\\_bucket",
&gt; "index" : "minute\\_int",
&gt; "start" : 0,
&gt; "end" : 900
&gt; },
&gt; "query" : [
&gt; { "map" : {"language" : "erlang", "module" : "maps", "function" : 
&gt; "emitStatsFromList", "keep" : false } },
&gt; { "reduce" : {"language" : "erlang", "module" : "reduces", "function" 
&gt; : "reduceStatsList", "keep" : true } }
&gt; ],
&gt; "timeout" : 3600000
&gt; }
&gt; 
&gt; 
&gt; Here's a (cleansed) crash log:
&gt; 
&gt; 2012-07-24 08:01:44 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\\_pipe\\_vnode\\_worker:init/1
&gt; pid: &lt;0.28552.254&gt;
&gt; registered\\_name: []
&gt; exception exit: 
&gt; {timeout,{gen\\_server,call,[{riak\\_pipe\\_vnode\\_master,'r...@xx.xx.xx.xxx'},{return\\_vnode,{riak\\_vnode\\_req\\_v1,593735040165679310520246963290989976735222595584,{raw,#Ref&lt;11882.0.6211.103965&gt;,&lt;0.28552.254&gt;},{cmd\\_enqueue,{fitting,&lt;11882.27639.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,&lt;&lt;103,28,147,16,123,67,248,114,104,204,9,54,33,62,81,41,129,84,203,83&gt;&gt;,1},{"dummykey",1},infinity,[{593735040165679310520246963290989976735222595584,'r...@xx.xx.xx.xxx'}]}}}]}}
&gt; in function gen\\_fsm:terminate/7
&gt; in call from proc\\_lib:init\\_p\\_do\\_apply/3
&gt; ancestors: [&lt;0.348.0&gt;,&lt;0.347.0&gt;,riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.89.0&gt;]
&gt; messages: []
&gt; links: [&lt;0.348.0&gt;,&lt;0.347.0&gt;]
&gt; dictionary: 
&gt; [{eunit,[{module,riak\\_pipe\\_vnode\\_worker},{partition,662242929415565384811044689824565743281594433536},{&lt;0.347.0&gt;,&lt;0.347.0&gt;},{details,{fitting\\_details,{fitting,&lt;11882.27640.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,follow,1},{prereduce,0},riak\\_kv\\_w\\_reduce,{rct,#Fun,none},{fitting,&lt;11882.27639.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,&lt;&lt;103,28,147,16,123,67,248,114,104,204,9,54,33,62,81,41,129,84,203,83&gt;&gt;,1},[{sink,{fitting,&lt;11882.24969.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64}}]}]
&gt; trap\\_exit: false
&gt; status: running
&gt; heap\\_size: 317811
&gt; stack\\_size: 24
&gt; reductions: 14770819
&gt; neighbours:
&gt; 2012-07-24 08:01:44 =SUPERVISOR REPORT====
&gt; Supervisor: {&lt;0.348.0&gt;,riak\\_pipe\\_vnode\\_worker\\_sup}
&gt; Context: child\\_terminated
&gt; Reason: 
&gt; {timeout,{gen\\_server,call,[{riak\\_pipe\\_vnode\\_master,'r...@xx.xx.xx.xxx'},{return\\_vnode,{riak\\_vnode\\_req\\_v1,593735040165679310520246963290989976735222595584,{raw,#Ref&lt;11882.0.6211.103965&gt;,&lt;0.28552.254&gt;},{cmd\\_enqueue,{fitting,&lt;11882.27639.38&gt;,#Ref&lt;11882.0.6211.103965&gt;,&lt;&lt;103,28,147,16,123,67,248,114,104,204,9,54,33,62,81,41,129,84,203,83&gt;&gt;,1},{"dummykey",1},infinity,[{593735040165679310520246963290989976735222595584,'r...@xx.xx.xx.xxx'}]}}}]}}
&gt; Offender: 
&gt; [{pid,&lt;0.28552.254&gt;},{name,undefined},{mfargs,{riak\\_pipe\\_vnode\\_worker,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,2000},{child\\_type,worker}]
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

