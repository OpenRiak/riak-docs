---
title: "Re: [Confusing search docs] Enabling search on bucket in Riak 2.0"
description: ""
project: community
lastmod: 2013-11-26T15:00:25-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13097"
mailinglist_parent_id: "msg13057"
author_name: "Kartik Thakore"
project_section: "mailinglistitem"
sent_date: 2013-11-26T15:00:25-08:00
---


So finally got a chance to try this and I am running into issues (I am on
Riak 2.0pre7) btw.

I have yz turned on:

http://192.168.1.10:8098/yz

I created the index with:

$ curl -i http://192.168.1.10:8098/yz/index/allLogs
HTTP/1.1 200 OK
Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
Date: Tue, 26 Nov 2013 22:51:15 GMT
Content-Type: application/json
Content-Length: 41

{"name":"allLogs","schema":"\\_yz\\_default"}


And associated the search to the bucket probs:

http://192.168.1.10:8098/buckets/logs/props

{

props:
{

allow\\_mult: true,
basic\\_quorum: false,
big\\_vclock: 50,
chash\\_keyfun:
{

mod: "riak\\_core\\_util",
fun: "chash\\_std\\_keyfun"

},
dw: "quorum",
last\\_write\\_wins: false,
linkfun:
{

mod: "riak\\_kv\\_wm\\_link\\_walker",
fun: "mapreduce\\_linkfun"

},
n\\_val: 3,
name: "logs",
notfound\\_ok: true,
old\\_vclock: 86400,
postcommit: [ ],
pr: 0,
precommit: [ ],
pw: 0,
r: "quorum",
rw: "quorum",
small\\_vclock: 50,
w: "quorum",
young\\_vclock: 20,
yz\\_index: "allLogs"

}

}

I put in a text/plain entry with:

http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=47ffPuWSln7VhlTl02raJA

[2013-11-26T22:43:26] [ERROR] [192.168.1.102] [0] [thakore.kar...@gmail.com]
test

http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=6IYwwPE27eUbs8ThaSOcTC

[2013-11-26T22:39:59] [ERROR] [192.168.1.102] [0] [thakore.kar...@gmail.com]
test



But when I search:

http://192.168.1.10:8098/search/allLogs?q=\\*

No results

http://192.168.1.10:8098/search/allLogs?q=test

No results


Whats going on?







On Thu, Nov 21, 2013 at 12:45 PM, Ryan Zezeski  wrote:
&gt;
&gt;
&gt;
&gt;
&gt; On Wed, Nov 20, 2013 at 3:48 PM, Kartik Thakore  wrote:
&gt;&gt;
&gt;&gt; Thank you.
&gt;&gt;
&gt;&gt; I am creating indexes with:
&gt;&gt;
&gt;&gt; curl -i -XPUT http://192.168.1.10:8098/yz/index/allLogs \\
&gt;&gt; -H 'content-type: application/json' \\
&gt;&gt; -d '{"schema" : "\\_yz\\_default", "bucket" : "logs" }'
&gt;&gt;
&gt;&gt;
&gt;&gt; But when I check the index with:
&gt;&gt;
&gt;&gt; curl -i http://192.168.1.10:8098/yz/index/allLogs
&gt;&gt;
&gt;&gt; It drops the bucket association
&gt;&gt;
&gt;&gt; HTTP/1.1 200 OK
&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
&gt;&gt; Date: Wed, 20 Nov 2013 20:45:21 GMT
&gt;&gt; Content-Type: application/json
&gt;&gt; Content-Length: 41
&gt;&gt;
&gt;&gt; {"name":"allLogs","schema":"\\_yz\\_default"}
&gt;
&gt;
&gt; Sorry, that documentation is out of date.
&gt;
&gt; To associate an index to a bucket you need to set the bucket's properties.
&gt;
&gt; curl -XPUT -H 'content-type: application/json' '
http://localhost:8098/buckets/logs/props' -d
'{"props":{"yz\\_index":"allLogs"}}'
&gt;
&gt; You can perform a GET on that same resource to check the yz\\_index
property is set.
&gt;
&gt;&gt;
&gt;&gt; Also
&gt;&gt;
&gt;&gt; what is going on here
&gt;&gt;
&gt;&gt; curl -XPUT -H'content-type:application/json'
http://localhost:8098/buckets/people/keys/me \\
&gt;&gt; -d'{ "name\\_s" : "kartik" }'
&gt;&gt;
&gt;&gt; Why not:
&gt;&gt; curl -XPUT -H'content-type:application/json'
http://localhost:8098/rial/people/me \\
&gt;&gt; -d'{ "name\\_s" : "kartik" }'
&gt;
&gt;
&gt;
&gt; In Riak 1.0.0 we changed the resource from '/riak//' to
'/buckets//keys/'. We were supposed to deprecate and
eventually remove the old resource but we never did. You can still use the
old style but I would recommend using the new style as it is what we use in
official docs and there is a chance perhaps the old resources don't stay up
to date with the latest features.
&gt;
&gt;
&gt; -Z
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

