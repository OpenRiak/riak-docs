---
title: "Re: Invalid hintfiles"
description: ""
project: community
lastmod: 2013-09-29T18:14:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12430"
mailinglist_parent_id: "msg12316"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2013-09-29T18:14:10-07:00
---



On 19/09/13 12:02, Seth Thomas wrote:

Toby,

Although I haven't traced a root cause just yet I've had several reports
in IRC of odd behavior when using nginx as a load balancer for Riak CS.
In almost every case, removing nginx from the equation and switching to
haproxy or pointing directly at the nodes in the application has
resolved issues. It's anecdotal until I can actually determine a root
cause but it's worth testing out if you're experiencing trouble.


Thanks for mentioning that Seth.
I posted some stuff to the list some months ago about config tweaks I 
had to make to get nginx to play nicely with Riak. Out of the box it 
definitely didn't work quite right.


In this instance, I had been able to reproduce the problems when going 
directly to the nodes from applications.. but it's interesting to hear 
that nginx potentially has issues beyond those we've experienced, so 
I'll look at getting haproxy used at some point. I've used haproxy in 
smaller test clusters and it's certainly felt like a better fit.


Cheers,
Toby


On September 18, 2013 at 8:48:27 PM, Toby Corkindale
(toby.corkind...@strategicdata.com.au) wrote:


On 19/09/13 11:17, Luke Bakken wrote:
&gt; Hi Toby,
&gt;
&gt; Invalid hint files won't cause Riak to fail requests - there must have
&gt; been something else happening. Hint files are used by Riak to speed
&gt; start time when loading a large key set.
&gt;
&gt; You mentioned a "load-balancer pool" - are you using something like
&gt; HAProxy to load-balance requests to your Riak CS cluster?
&gt;
&gt; The "error: disconnected" message is a good clue. If you can provide
&gt; log files that may point to the cause.

Hi Luke,
I'm still seeing quite a few failed requests. I've been chasing the
hintfiles but I guess that was a red herring.

We're using nginx to load balance requests to Riak CS.
I tried going directly to each node in turn, and it didn't show that any
one node was reliably failing every request.

Hitting one server just now came up with OK/403/403/OK/OK.
Trying another was OK/OK/OK/OK/403 though.

Here's some logs from riak-cs:




\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

