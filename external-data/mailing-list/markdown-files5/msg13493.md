---
title: "Re: Riak Search and Yokozuna Backup Strategy"
description: ""
project: community
lastmod: 2014-01-27T11:42:35-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13493"
mailinglist_parent_id: "msg13463"
author_name: "Elias Levy"
project_section: "mailinglistitem"
sent_date: 2014-01-27T11:42:35-08:00
---


On Thu, Jan 23, 2014 at 10:25 AM, Joe Caswell  wrote:

&gt; Backing up LevelDB data files can be accomplished while the node is
&gt; running if the sst\\_x directories are backed up in numerical order. The
&gt; undesirable side effects of that could be duplicated data, inconsistent
&gt; manifest, or incomplete writes, which necessitates running the leveldb
&gt; repair process upon restoration for any vnode backed up while the node was
&gt; running. Since the data is initially written to the recovery log before
&gt; being appended to level 0, and any compaction operation fully writes the
&gt; data to its new location before removing it from its old location, if any
&gt; of these operations are interrupted, the data can be completely recovered
&gt; by leveldb repair.
&gt;
&gt; The only incomplete write that won't be recovered by the LevelDB repair
&gt; process is the initial write to the recovery log, limiting exposure to the
&gt; key being actively written at the time of the snapshot/backup. As long as
&gt; 2 vnodes in the same preflist are not backed up while simultaneously
&gt; writing the same key to the recovery log (i.e. rolling backups are good),
&gt; this key will be recovered by AAE/read repair after restoration.
&gt;

Joe, thanks for the information.

Will Riak detect a LevelDB that was not cleanly shutdown when it starts up
and start repair on its own?

If not, will Basho add a command to riak-admin to make it easy to repair
LevelDB backends while restoring them?

Any comments on the backup strategy for Yokozuna? Will it make use of
Solr's Replication Handler, or something more lower level? Will the node
need to be offline to backup it up?

Ryan Zezeski any thoughts?
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

