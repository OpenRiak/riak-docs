---
title: "Re: Different numFound request to riak search"
description: ""
project: community
lastmod: 2015-03-12T06:53:01-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15881"
mailinglist_parent_id: "msg15880"
author_name: "Roma Lakotko"
project_section: "mailinglistitem"
sent_date: 2015-03-12T06:53:01-07:00
---


Hello Zeeshan.

While i run queries no delete object is occurs.

Stats on production and developer nodes output something like this:
https://gist.github.com/romulka/d0254aa193a9dbb52b67

On dev container:

/etc/riak# grep anti\\_entropy \\*
riak.conf:anti\\_entropy = active
riak.conf.dpkg-dist:anti\\_entropy = active

ll -h /var/lib/riak/yz\\_anti\\_entropy/
total 264K
drwxrwxr-x 66 riak riak 4.0K Sep 25 12:08 ./
drwxr-xr-x 12 riak riak 4.0K Dec 9 12:19 ../
drwxr-xr-x 9 riak riak 4.0K Mar 12 12:01 0/
drwxr-xr-x 9 riak riak 4.0K Mar 12 12:01
1004782375664995756265033322492444576013453623296/
drwxr-xr-x 9 riak riak 4.0K Mar 12 12:01
1027618338748291114361965898003636498195577569280/
....

On prod:

grep anti\\_entropy \\* /etc/riak/ -&gt; empty

root@riak-21:/var/lib/riak/yz\\_anti\\_entropy# ll -h
total 64K
drwxrwxr-x 16 riak riak 4.0K Dec 4 03:44 ./
drwxr-xr-x 14 riak riak 4.0K Dec 9 12:10 ../
drwxr-xr-x 9 riak riak 4.0K Dec 4 03:44 0/
drwxr-xr-x 9 riak riak 4.0K Mar 12 12:57
1027618338748291114361965898003636498195577569280/
....

I'm already try re-save all keys, it doesn't helps.

Production cluster have 7 node, start from 3. So yes, nodes was
added/delete sometimes.

On dev, i have 1 instance in docker container, never added to cluster. But
data in that riak is imported from production cluster a while ago.

I can give you a copy of container, if you need to.

Thanks,
Ronan Lakotko



2015-03-12 16:36 GMT+03:00 Zeeshan Lakhani :

&gt; Hello Roma,
&gt;
&gt; Have you deleted this object at some point in your runs? Please make sure
&gt; AAE is running by checking search’s AAE status, `riak-admin search
&gt; aae-status`, and that data exists in the correct directory,
&gt; `./data/yz\\_anti\\_entropy` (
&gt; http://docs.basho.com/riak/latest/ops/advanced/configs/search/). You may
&gt; just need to perform a read-repair by performing a fetch of the object
&gt; itself first, before performing search queries again.
&gt;
&gt; Also, have you left or added nodes? I’m guessing that even your 1 node
&gt; instance is still running a cluster on that one node, right?
&gt;
&gt; Thanks.
&gt;
&gt; Zeeshan Lakhani
&gt; programmer |
&gt; software engineer at @basho |
&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org
&gt; twitter =&gt; @zeeshanlakhani
&gt;
&gt; On Mar 12, 2015, at 5:59 AM, Roma Lakotko  wrote:
&gt;
&gt; Each request to riak search return different results. It's return
&gt; different numFound.
&gt;
&gt; I use request like this:
&gt;
&gt;
&gt; http://localhost:8098/search/query/assets?wt=json&q=type:\\*&sort=\\_yz\\_rk%20asc
&gt;
&gt; If add start offset it can return:
&gt;
&gt;
&gt; http://localhost:8098/search/query/assets?wt=json&q=type:\\*&sort=\\_yz\\_rk%20asc&start=1247
&gt;
&gt; "response": {
&gt; "numFound": 1248,
&gt; "start": 1247,
&gt; "docs": [
&gt; {
&gt; "\\_yz\\_id": 
&gt; "1\\*default\\*assets\\*fff63ecf-a0c4-4ecf-b24d-c493ca3a302f\\*44",
&gt; "\\_yz\\_rk": "fff63ecf-a0c4-4ecf-b24d-c493ca3a302f",
&gt; "\\_yz\\_rt": "default",
&gt; "\\_yz\\_rb": "assets"
&gt; }
&gt; ]
&gt; }
&gt;
&gt;
&gt; On next request it return something like this
&gt;
&gt;
&gt; "numFound": 1224,
&gt; "start": 1247,
&gt; "docs": []
&gt;
&gt;
&gt; I have 1 node installation, and no process write to Riak.
&gt;
&gt; I have same problem this production cluster with 7 nodes.
&gt;
&gt;
&gt; Scheme for document
&gt;
&gt;
&gt; xml version="1.0" encoding="UTF-8" ?
&gt; 
&gt; 
&gt;  stored="false" /&gt;
&gt; 
&gt;  stored="false" /&gt;
&gt;
&gt;  stored="false" /&gt;
&gt;  stored="false" multiValued="true" /&gt;
&gt; 
&gt;  stored="false" /&gt;
&gt;  stored="false" /&gt;
&gt; 
&gt; 
&gt;
&gt; 
&gt;  multiValued="false" required="true"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;  multiValued="false"/&gt;
&gt;
&gt; 
&gt; 
&gt;
&gt; \\_yz\\_id
&gt;
&gt; 
&gt; 
&gt;  omitNorms="true"/&gt;
&gt;  sortMissingLast="true" omitNorms="true"/&gt;
&gt;  omitNorms="true"/&gt;
&gt;
&gt;  omitNorms="true"/&gt;
&gt; 
&gt;  class="solr.StrField" /&gt;
&gt;  omitNorms="true"&gt;
&gt; 
&gt; 
&gt; 
&gt;  replacement='е' replace='all'/&gt;
&gt; 
&gt; 
&gt; 
&gt;
&gt; 
&gt;
&gt;
&gt; Best regards,
&gt;
&gt; Roman
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

