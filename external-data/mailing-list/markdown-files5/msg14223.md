---
title: "Re: Facing exception error in riak-erlang client in erlang shell	while doing Mapreduce"
description: ""
project: community
lastmod: 2014-05-17T07:53:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14223"
mailinglist_parent_id: "msg14222"
author_name: "Steve Vinoski"
project_section: "mailinglistitem"
sent_date: 2014-05-17T07:53:32-07:00
---


On Sat, May 17, 2014 at 10:04 AM, Gopi Krishna  wrote:

&gt; Hi,
&gt;
&gt; I am getting the following , don't know what was happening could you
&gt; please elaborate and explain the solution to this.
&gt;
&gt; I am working on erlang-riak-client.
&gt;
&gt;
&gt; 1&gt; {ok, Pid} = riakc\\_pb\\_socket:start\\_link('127.0.0.1',10017).
&gt; {ok,&lt;0.34.0&gt;}
&gt; 2&gt;
&gt; 2&gt;
&gt; 2&gt; Object = riakc\\_obj:new(&lt;&lt;"test\\_age"&gt;&gt;, &lt;&lt;"test1"&gt;&gt;, &lt;&lt;"gopi & 1"&gt;&gt;).
&gt; {riakc\\_obj,&lt;&lt;"test\\_age"&gt;&gt;,&lt;&lt;"test1"&gt;&gt;,undefined,[],
&gt; undefined,&lt;&lt;"gopi & 1"&gt;&gt;}
&gt; 3&gt;
&gt; 3&gt;
&gt; 3&gt; riakc\\_pb\\_socket:put(Pid,Object).
&gt; ok
&gt; 4&gt;
&gt; 4&gt; Mapf = fun(Obj,\\_,\\_) -&gt; [{I,1}|| I &lt;-
&gt; binary\\_to\\_term(riak\\_object:get\\_value(Object))] end.
&gt;

There are two problems with your Mapf function:

1. The body of the function incorrectly uses Object, which is a variable in
your shell from command 2, rather than Obj, the incoming parameter to the
function. This is the source of the function\\_clause error you're getting.

2. You've stored a binary value in your object, not an Erlang term, so
binary\\_to\\_term will fail here with a badarg exception. Change your Mapf
function to this instead:

Mapf = fun(Obj,\\_,\\_) -&gt; [riak\\_object:get\\_value(Obj)] end.

#Fun
&gt; 5&gt; {ok, [{0,[R]}]} =
&gt; riakc\\_pb\\_socket:mapred(Pid,&lt;&lt;"test\\_age"&gt;&gt;,[{map,{qfun,Mapf},none,true}])
&gt; 5&gt; .
&gt; \\*\\* exception error: no match of right hand side value
&gt; {error,&lt;&lt;"{\\"phase\\":0,\\"error\\":\\"function\\_clause\\",\\"input\\":\\"{ok,{r\\_object,&lt;&lt;\\\\\\"test\\_age\\\\\\"&gt;&gt;,&lt;&lt;\\\\\\"test1\\\\\\"&gt;&gt;,[{r\\_content,{dict"...&gt;&gt;}
&gt;

If you make the changes I described above, you get:

5&gt; {ok, [{0,[R]}]} =
riakc\\_pb\\_socket:mapred(Pid,&lt;&lt;"test\\_age"&gt;&gt;,[{map,{qfun,Mapf},none,true}]).
{ok,[{0,[&lt;&lt;"gopi & 1"&gt;&gt;]}]}
6&gt; R.
&lt;&lt;"gopi & 1"&gt;&gt;

exactly as expected.

--steve
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

