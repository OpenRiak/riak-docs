---
title: "Re: Client get 503 response from riak server"
description: ""
project: community
lastmod: 2015-03-04T14:21:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15828"
mailinglist_parent_id: "msg15827"
author_name: "Bora Kou"
project_section: "mailinglistitem"
sent_date: 2015-03-04T14:21:16-08:00
---


Thank you for the suggestion Chris. I will try increasing zdbbl, but it
seems like we might have to move to Riak CS.

-Bora

On Wed, Mar 4, 2015 at 12:30 PM, Christopher Meiklejohn &lt;
cmeiklej...@basho.com&gt; wrote:

&gt;
&gt; &gt; On Mar 4, 2015, at 2:22 PM, Bora Kou  wrote:
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; We have a 6 nodes riak cluster configured with 256 size. We are using
&gt; versions 1.4.8. Occasionally, we see the server return 503 response.
&gt; Looking at the log, it seems that we have a lot of warning about reading
&gt; large object and busy\\_dist\\_port. The majority of the objects are less than
&gt; 2MB but we do have some large objects in the ranch of 5-15MB.
&gt; &gt;
&gt; &gt;
&gt; &gt; These are the two type of log entries we consistently see across all
&gt; nodes when that happen:
&gt; &gt;
&gt; &gt; 2015-03-04 17:53:48.149 [warning]
&gt; &lt;0.1142.0&gt;@riak\\_kv\\_vnode:do\\_get\\_object:1299 Reading large object of size
&gt; 5498696 from...
&gt; &gt;
&gt; &gt; 2015-03-04 19:06:35.824 [info]
&gt; &lt;0.95.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:92 monitor busy\\_dist\\_port
&gt; &lt;0.32259.1162&gt;
&gt; [{initial\\_call,{riak\\_kv\\_get\\_fsm,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.3353&gt;,'riak@servername...'}
&gt; &gt;
&gt; &gt; The doc suggest increasing +zdbbl to deal with busy\\_dist\\_port. But does
&gt; anybody have any other suggestion to what other parameters I should look at
&gt; to improve the situation?
&gt;
&gt; Hi Bora,
&gt;
&gt; Given that most of the internode communication of Riak is performed over
&gt; Distributed Erlang, which uses a single TCP connection between nodes,
&gt; storing large objects [3] can create throughput problems in the cluster
&gt; such as head of line blocking [1] and filling up the Erlang’s bounded
&gt; distribution buffers (messages are stored here waiting to be sent over the
&gt; TCP connection; any message attempting to perform a TCP send will
&gt; synchronize on this buffer) [2].
&gt;
&gt; Increasing zdbbl increases the size of this buffer, which, if you’re
&gt; system has the available memory is a smart choice. Carefully balance
&gt; increasing the distribution buffer size with available system memory, given
&gt; you don’t want to overflow into virtual memory, which will further slow
&gt; down your system.
&gt;
&gt; If you’re going to be storing objects greater than 1 MB, we recommend
&gt; using Riak CS.
&gt;
&gt; - Christopher
&gt;
&gt; [1] http://en.wikipedia.org/wiki/Head-of-line\\_blocking
&gt; [2]
&gt; http://docs.basho.com/riak/latest/community/faqs/logs/#riak-logs-have-busy\\_dist\\_port-messages
&gt; [3]
&gt; http://stackoverflow.com/questions/24389183/riak-returns-an-error-reading-large-object-of-size-when-a-mapreduce
&gt;
&gt; Christopher Meiklejohn
&gt; Senior Software Engineer
&gt; Basho Technologies, Inc.
&gt; cmeiklej...@basho.com
&gt;
&gt;


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

