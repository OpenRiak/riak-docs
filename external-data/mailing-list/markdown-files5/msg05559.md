---
title: "Re: Why is Riak Search using the leveldb backend?"
description: ""
project: community
lastmod: 2011-11-11T17:57:55-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05559"
mailinglist_parent_id: "msg05556"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2011-11-11T17:57:55-08:00
---


Elias,

This is an implementation detail of Search. It stores something we call a
"proxy object" under the bucket \\_rsid\\_ [1]. It does this so it
knows which entries to remove from the index when an object is
updated/deleted. To achieve your goal you should be able to set the
buckets `\\_rsid\\_bucket1` and `\\_rsid\\_bucket2` to use the `bucket1` and
`bucket2` backends, respectively.

-Ryan

[1]:
https://github.com/basho/riak\\_search/blob/1.0.1/src/riak\\_indexed\\_doc.erl#L314

On Fri, Nov 11, 2011 at 6:02 PM, Elias Levy wrote:

&gt; I've set up a brand new cluster, configured two buckets in it, and
&gt; configured search on both. The cluster is using the multibackend, and I've
&gt; created three instances of the leveldb backend, one each for my two
&gt; buckets, and a third one as a default, just in case.
&gt;
&gt; The config looks something like:
&gt;
&gt; {storage\\_backend, riak\\_kv\\_multi\\_backend},
&gt; {multi\\_backend\\_default, &lt;&lt;"leveldb"&gt;&gt;},
&gt; {&lt;&lt;"leveldb"&gt;&gt; , riak\\_kv\\_eleveldb\\_backend, [{data\\_root,
&gt; "/data/riak/leveldb"}]},
&gt; {&lt;&lt;"bucket1"&gt;&gt; , riak\\_kv\\_eleveldb\\_backend, [{data\\_root,
&gt; "/data/riak/bucket1"}, other config items ]},
&gt; {&lt;&lt;"bucket2"&gt;&gt; , riak\\_kv\\_eleveldb\\_backend, [{data\\_root,
&gt; "/data/riak/bucket2"},other config items ]},
&gt;
&gt; and
&gt;
&gt; {eleveldb, [ {data\\_root, "/data/riak/leveldb"} ]},
&gt;
&gt; Each of bucket1 and bucket two have had their bucket properties set to
&gt; utilize the backend named after them.
&gt;
&gt; The idea behind this is that we wanted to segregate data within different
&gt; buckets in the cluster, as they have different traffic patterns. It should
&gt; allow us to set leveldb parameters, such as the cache size, that are
&gt; appropriate for each set of data. We may also want to back them up at
&gt; different schedules.
&gt;
&gt; So having set up this cluster, I loaded a day's worth of data into it.
&gt; Now, when I look at the data folder I see I got data in
&gt; /data/riak/bucket1, /data/riak/bucket2, and in /data/riak/merge\\_index.
&gt; That much I expected. But I also seem to have data in /data/riak/leveldb.
&gt;
&gt; The client loading the data only inserts into bucket1 and bucket2.
&gt;
&gt; I can look at the leveldb data files under bucket1 and bucket2 and I see
&gt; my data. Running strings over the leveldb data files under the
&gt; /data/riak/leveldb shows data that appears related to Riak Search. E.g.:
&gt;
&gt; X-Riak-VTaga2asadaFaHakaKaraOa9aYaSa2aTaxamaQawaQaDa5awjjl
&gt; indexjjjl
&gt; X-Riak-Last-Modifiedh
&gt; $&gt;jjjh
&gt; riak\\_idx\\_docm
&gt; bucket1m
&gt; ?00b1a8ce42a54d81bf46d9bb7a7b4b21\\_5661725545713369108\\_1318223203l
&gt; i\\_ag\\_tsm
&gt; +00b1a8ce42a54d81bf46d9bb7a7b4b21\\_1318204800l
&gt; +00b1a8ce42a54d81bf46d9bb7a7b4b21\\_1318204800k
&gt; i\\_bg\\_tsm
&gt; +eacc2a8e434f4498a70aa6ce904efe19\\_1318222800l
&gt; +eacc2a8e434f4498a70aa6ce904efe19\\_1318222800k
&gt;
&gt;
&gt; i\\_ag\\_ts and i\\_bg\\_ts are two of our indexed fields, and those are the
&gt; values being indexed. So why is Riak Search storing data in the leveldb
&gt; backend? I thought it only used the merge\\_index backend. Is that wrong?
&gt;
&gt; Elias Levy
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

