---
title: "Re: Yokozuna - inconsistent number of documents found for the same	query"
description: ""
project: community
lastmod: 2014-12-01T21:14:05-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15288"
mailinglist_parent_id: "msg15287"
author_name: "Eric Redmond"
project_section: "mailinglistitem"
sent_date: 2014-12-01T21:14:05-08:00
---



On Dec 1, 2014, at 8:57 PM, Ryan Zezeski  wrote:

&gt; 
&gt; Eric Redmond writes:
&gt; 
&gt;&gt; This is a known issue, and we're still working on a fix.
&gt;&gt; 
&gt;&gt; https://github.com/basho/yokozuna/issues/426
&gt;&gt; 
&gt; 
&gt; I don't see how this issue is related to Oleksiy's problem. There is no
&gt; mention of removing or adding nodes. I think the key part of Oleksiy's
&gt; report is the association of an index \\_after\\_ data had already been
&gt; written. That data is sometimes missing. These two issues could be
&gt; related but I don't see anything in that GitHub report to indicate why.

The issue, sadly, hasn't been updated with what we know. It's mentioned in 
Zeeshan's gist, which should be moved to the main issue. But the issue is 
surrounding the AAE tree dropping documents, though we still aren't sure why. 
It initially appeared when adding/removing nodes, but noticed it could be 
reproduced by simply running AAE.

We'll update the issue.

&gt;&gt; 
&gt;&gt; On Nov 29, 2014, at 9:26 AM, Oleksiy Krivoshey  wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; 1. Create a bucket, insert some keys (10 keys - KeysA)
&gt;&gt;&gt; 2. Create Yokozuna Index, associate it with the bucket
&gt;&gt;&gt; 3. Add or update some new keys in the bucket (10 keys - KeysB)
&gt;&gt;&gt; 4. Wait for Search AAE to build and exchange the trees
&gt;&gt;&gt; 
&gt;&gt;&gt; Now when I issue a search query I will always get all 10 KeysB but a random 
&gt;&gt;&gt; amount of KeysA, for example the same query repeated 5 times may return:
&gt;&gt;&gt; 
&gt;&gt;&gt; 10 KeysB + 2 KeysA
&gt;&gt;&gt; 10 KeysB + 0 KeysA
&gt;&gt;&gt; 10 KeysB + 7 KeysA
&gt;&gt;&gt; 10 KeysB + 1 KeysA
&gt;&gt;&gt; 10 KeysB + 10 KeysA
&gt;&gt;&gt; 
&gt; 
&gt; Are there any errors in the logs? Does the count go up if you wait
&gt; longer? What does `riak-admin search aae-status` show?
&gt; 
&gt; -Z


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

