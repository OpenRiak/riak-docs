---
title: "Re: What is this...?"
description: ""
project: community
lastmod: 2012-01-22T12:50:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06365"
mailinglist_parent_id: "msg06364"
author_name: "Kresten Krab Thorup"
project_section: "mailinglistitem"
sent_date: 2012-01-22T12:50:59-08:00
---


Joe's first law [of protocol design]

 "Always include protocol identifier and version number in the first message"

I think I heard him say that when Tom presented BERT-RPC protocol at EUC 2010 
:-)

Maybe we should apply that rule to riak's PB protocol going forward?

Kresten

On Jan 22, 2012, at 20:55, "Mike Oxford"  wrote:

&gt; So stupid it hurts, and though it's embarrassing I should close the loop...
&gt; 
&gt; Env change on upgrade to 1.0.2 moved ports.
&gt; Tested 1.0.3 on the 1.0.2 bad config...then tested 1.0.0 against that
&gt; same bad config.
&gt; Intermittent success were due to the config not being 100% incorrect.
&gt; 
&gt; PB client doesn't work so well when running again a handoff port. /shame
&gt; 
&gt; Taunts/jeers accepted off-list. Thanks.
&gt; 
&gt; -mox
&gt; 
&gt; On Sat, Jan 21, 2012 at 8:29 PM, Mike Oxford  wrote:
&gt;&gt; I get this on a riakc\\_pb\\_socket:ping() ...
&gt;&gt; 
&gt;&gt; 20:24:04.361 [error] Handoff receiver for partition undefined exited
&gt;&gt; abnormally after processing 0 objects:
&gt;&gt; {noproc,{gen\\_fsm,sync\\_send\\_all\\_state\\_event,[undefined,{handoff\\_data,&lt;&lt;&gt;&gt;},60000]}}
&gt;&gt; 
&gt;&gt; -mox
&gt;&gt; 
&gt;&gt; On Sat, Jan 21, 2012 at 8:43 AM, Mike Oxford  wrote:
&gt;&gt;&gt; 3 node cluster of 1.0.2, level\\_db backend, pb interface. Build up a
&gt;&gt;&gt; store of 9 connections (3 to each node) and pull one out randomly.
&gt;&gt;&gt; 
&gt;&gt;&gt; --snip
&gt;&gt;&gt; 62&gt; 
&gt;&gt;&gt; riakc\\_pb\\_socket:list\\_keys(gen\\_server:call(forum\\_store:get\\_random\\_pid(alliance),
&gt;&gt;&gt; get\\_connector\\_pid), &lt;&lt;"alliance\\_overview"&gt;&gt;
&gt;&gt;&gt; {ok,[]}
&gt;&gt;&gt; 
&gt;&gt;&gt; 63&gt; 
&gt;&gt;&gt; riakc\\_pb\\_socket:list\\_keys(gen\\_server:call(forum\\_store:get\\_random\\_pid(alliance),
&gt;&gt;&gt; get\\_connector\\_pid), &lt;&lt;"alliance\\_overview"&gt;&gt;).
&gt;&gt;&gt; {ok,[]}
&gt;&gt;&gt; 
&gt;&gt;&gt; 64&gt; 
&gt;&gt;&gt; riakc\\_pb\\_socket:list\\_keys(gen\\_server:call(forum\\_store:get\\_random\\_pid(alliance),
&gt;&gt;&gt; get\\_connector\\_pid), "alliance\\_overview").
&gt;&gt;&gt; {ok,[]}
&gt;&gt;&gt; 
&gt;&gt;&gt; 65&gt; 
&gt;&gt;&gt; riakc\\_pb\\_socket:list\\_keys(gen\\_server:call(forum\\_store:get\\_random\\_pid(alliance),
&gt;&gt;&gt; get\\_connector\\_pid), "alliance\\_overview").
&gt;&gt;&gt; =ERROR REPORT==== 21-Jan-2012::08:23:11 ===
&gt;&gt;&gt; \\*\\* Generic server &lt;0.24647.5&gt; terminating
&gt;&gt;&gt; \\*\\* Last message in was {tcp,#Port&lt;0.5820&gt;,[255|&lt;&lt;"unknown\\_msg"&gt;&gt;]}
&gt;&gt;&gt; \\*\\* When Server state == {state,"127.0.0.1",2010,false,false,#Port&lt;0.5820&gt;,
&gt;&gt;&gt; {request,#Ref&lt;0.0.4.159143&gt;,
&gt;&gt;&gt; {rpblistkeysreq,"alliance\\_overview"},
&gt;&gt;&gt; undefined,
&gt;&gt;&gt; {106931976,&lt;0.25063.5&gt;},
&gt;&gt;&gt; 60000,#Ref&lt;0.0.4.159144&gt;},
&gt;&gt;&gt; {[],[]},
&gt;&gt;&gt; 1,[],infinity,100}
&gt;&gt;&gt; \\*\\* Reason for termination ==
&gt;&gt;&gt; \\*\\* {function\\_clause,[{riakclient\\_pb,decode,[undefined,&lt;&lt;"unknown\\_msg"&gt;&gt;]},
&gt;&gt;&gt; {riakc\\_pb\\_socket,handle\\_info,2},
&gt;&gt;&gt; {gen\\_server,handle\\_msg,5},
&gt;&gt;&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt;&gt;&gt; {error,{timeout,[]}}
&gt;&gt;&gt; 
&gt;&gt;&gt; 66&gt; 
&gt;&gt;&gt; riakc\\_pb\\_socket:list\\_keys(gen\\_server:call(forum\\_store:get\\_random\\_pid(alliance),
&gt;&gt;&gt; get\\_connector\\_pid), "alliance\\_overview").
&gt;&gt;&gt; {ok,[]}
&gt;&gt;&gt; --end snip
&gt;&gt;&gt; 
&gt;&gt;&gt; Riak console spits out the following at the same time...
&gt;&gt;&gt; 
&gt;&gt;&gt; --snip
&gt;&gt;&gt; nodes().08:23:11.154 [info] Handoff receiver for partition undefined
&gt;&gt;&gt; exited after processing 0 objects
&gt;&gt;&gt; --end snip
&gt;&gt;&gt; 
&gt;&gt;&gt; Error condition does not seem to follow any specific node and the
&gt;&gt;&gt; connections die when the error is thrown so its constantly building
&gt;&gt;&gt; new ones.
&gt;&gt;&gt; 
&gt;&gt;&gt; TIA.
&gt;&gt;&gt; 
&gt;&gt;&gt; -mox
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

