---
title: "Re: Old values on put call"
description: ""
project: community
lastmod: 2011-05-26T03:58:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03416"
mailinglist_parent_id: "msg03361"
author_name: "Mathias Meyer"
project_section: "mailinglistitem"
sent_date: 2011-05-26T03:58:09-07:00
---


Anthony,

currently there's no simple way to achieve what you're after. The API is 
modelled around a GET before you PUT model.

You can specify the option return\\_body when putting new data into Riak, like so:

{ok, RObj} = riak\\_pb\\_socket:put (.., NewObject, [return\\_body]),

That returns the freshly written data in the result. It's not exactly what you 
want, but could be used to achieve what you're after by deliberately creating 
siblings, by e.g. leaving out the vector clock. Specifying the return\\_body flag 
then will return the list of siblings created with this requests.

Be aware that abusing this technique with too many writes and not properly 
reconciling siblings may cause your Riak objects to grow in an unhealthy 
manner, and it's not exactly a recommended way of doing things.

It's an option but certainly not as simple as the one you're after, unless 
you're prepared to deal with the potential conflicts, and e.g. handle siblings 
immediately after you reconciled the differences between two objects in your 
compare() function, see [1] for more details.

Mathias Meyer
Developer Advocate, Basho Technologies

[1] http://wiki.basho.com/Vector-Clocks.html

On Mittwoch, 18. Mai 2011 at 23:28, Anthony Molinaro wrote:

&gt; Hi,
&gt; 
&gt; I'm working on an application where I am storing an erlang external term
&gt; format in riak. The entire structure gets updated at once, but I'd like to
&gt; see what is changing, so I have something like this (in pseudo code).
&gt; 
&gt; NewObject = construct\\_new(...),
&gt; OldObject = riak\\_pb\\_socket:get(...),
&gt; ok = riak\\_pb\\_socket:put (.., NewObject),
&gt; compare (OldObject, NewObject),
&gt; 
&gt; The idea being that I am updating the object everytime, but I would like
&gt; to have a general idea what has changed.
&gt; 
&gt; So I was wondering if there are any options for put to return the previous
&gt; value? That would allow me to remove the call to get and simply do something
&gt; like.
&gt; 
&gt; NewObject = construct\\_new(...),
&gt; OldObject = riak\\_pb\\_socket:put (.., NewObject),
&gt; compare (OldObject, NewObject),
&gt; 
&gt; Now I assume what I get back would depend a lot on what the w value is, but
&gt; in most cases, I tend to use the defaults. Also, I would think the old
&gt; values could be returned as a list in some cases where there was disagreement.
&gt; 
&gt; Anyway, would something like this be hard to implement in riak itself
&gt; (it's sort of a specialized use case, but I could see it being useful
&gt; in cases like mine where you always want a put to succeed, but you might
&gt; want to check what changed for tracking reasons, and I do understand that
&gt; you won't be absolutely accurate all the time, but I mostly am looking for
&gt; something scalable and mostly accurate).
&gt; 
&gt; -Anthony
&gt; 
&gt; -- 
&gt; ------------------------------------------------------------------------
&gt; Anthony Molinaro  (mailto:antho...@alumni.caltech.edu)&gt;
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com



\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

