---
title: "Re: Updating Counters on Riak 2.0 pre whatever"
description: ""
project: community
lastmod: 2013-10-22T13:16:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12735"
mailinglist_parent_id: "msg12732"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2013-10-22T13:16:23-07:00
---



On 22 Oct 2013, at 20:24, Jeremiah Peschka  wrote:

&gt; Hah! No worries at all. Thanks for the clarification. I'll rebuild.
&gt; 
&gt; I wasn't sure if I needed to try to figure out (from a client perspective) if 
&gt; I needed to use the CRDT syntax for 2.0 and newer and RpbCounterUpdateReq for 
&gt; 1.4.x and earlier. Good to know that I can blindly proceed.

Ok, this is a good question. And something we've been working on.
 
1.4 had counters, 2.0 has counters. Are they the same? Yes and no.
 
In 2.0 we add bucket types. We decided that CRDTs in 2.0 should take advantage 
of bucket types. The reason being that there is no sensible way to merge across 
types (how do you merge a Map with a Set? (we thought of a few ways, but non 
were intuitive)) It comes down to the reason for CRDTs: no conflicts, no 
siblings. If we allow different types in the same bucket then you can create 
the same key with two different types, which means siblings types: just as 
complex as siblings.
 
So, we restrict you to one CRDT type per bucket. But in 1.4 we didn't have this 
restriction. And we need to support 1.4 style counters.
 
If you use the 1.4 API or store counters in the default (untyped) bucket using 
the 2.0 API then you're interoperable between versions.
 
Sorry if it seems confusing. The point is that as a client developer you can 
access 1.4 counters through the 2.0 API by using the default bucket type OR 
continue support for the 1.4 API (or bolth.) Whichever you prefer.
 
I realise this might be an information overload, so feel free to ask questions 
about anything I wasn't clear enough about.

Cheers

Russell

&gt; 
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt; 
&gt; 
&gt; On Tue, Oct 22, 2013 at 2:07 PM, Russell Brown  wrote:
&gt; Yes! Sorry!
&gt; 
&gt; We broke backwards compatibility during development. We merged the patch 
&gt; today[1]. The develop branch works right now. It will get into the next pre 
&gt; (or whatever the next tag is called.)
&gt; 
&gt; Apologies again, it was easier for me to do the new work without thinking 
&gt; about backwards compatibility, then re-add old counters when the 2.0 stuff 
&gt; was done.
&gt; 
&gt; Let me know if you have any more issues going forward, please.
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; [1] https://github.com/basho/riak\\_kv/pull/697
&gt; On 22 Oct 2013, at 19:56, Jeremiah Peschka  wrote:
&gt; 
&gt; &gt; I'm attempting to create a counter on Riak 2.0 built from the develop on 
&gt; &gt; Sunday. When I send a counter increment message using RpbCounterUpdateReq, 
&gt; &gt; I get the following back from Riak:
&gt; &gt;
&gt; &gt; Riak returned an error. Code '0'. Message: Error processing incoming 
&gt; &gt; message: error:undef:[{riak\\_kv\\_counter,supported,
&gt; &gt; [],[]},
&gt; &gt; {riak\\_kv\\_pb\\_counter,process,
&gt; &gt; 2,
&gt; &gt; [{file,
&gt; &gt; 
&gt; &gt; "src/riak\\_kv\\_pb\\_counter.erl"},
&gt; &gt; {line,114}]},
&gt; &gt; {riak\\_api\\_pb\\_server,
&gt; &gt; process\\_message,4,
&gt; &gt; [{file,
&gt; &gt; 
&gt; &gt; "src/riak\\_api\\_pb\\_server.erl"},
&gt; &gt; {line,386}]},
&gt; &gt; {riak\\_api\\_pb\\_server,
&gt; &gt; connected,2,
&gt; &gt; [{file,
&gt; &gt; 
&gt; &gt; "src/riak\\_api\\_pb\\_server.erl"},
&gt; &gt; {line,228}]},
&gt; &gt; {riak\\_api\\_pb\\_server,
&gt; &gt; decode\\_buffer,2,
&gt; &gt; [{file,
&gt; &gt; 
&gt; &gt; "src/riak\\_api\\_pb\\_server.erl"},
&gt; &gt; {line,362}]},
&gt; &gt; {gen\\_fsm,handle\\_msg,7,
&gt; &gt; [{file,"gen\\_fsm.erl"},
&gt; &gt; {line,505}]},
&gt; &gt; {proc\\_lib,init\\_p\\_do\\_apply,3,
&gt; &gt; [{file,"proc\\_lib.erl"},
&gt; &gt; {line,239}]}]
&gt; &gt; ---
&gt; &gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; &gt; MCITP: SQL Server 2008, MVP
&gt; &gt; Cloudera Certified Developer for Apache Hadoop
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

