---
title: "Re: Expected vs Actual Bucket Behavior"
description: ""
project: community
lastmod: 2010-07-21T11:45:28-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00769"
mailinglist_parent_id: "msg00764"
author_name: "Curtis Caravone"
project_section: "mailinglistitem"
sent_date: 2010-07-21T11:45:28-07:00
---


Regarding #2, I think bitcask could be modified to support an efficient list
keys by bucket fairly easily, without sacrificing free buckets:

The current bitcask stores record locators (key, file\\_id, file\\_offset) in
memory in a big hash table by key (the bitcask key, in Riak's case, is the
Riak {bucket,key} as a binary).

What if the hash table were replaced with an in-memory btree? A good
implementation shouldn't take more memory than a hash table, and get/put
should still be very fast. The plus side is that one could then do a range
traversal of the btree to get all keys in a given bucket (assuming the right
comparison function for the btree). There wouldn't be any additional
overhead of extra file handles, etc. because everything for a vnode would
still be stored in one bitcask instance.

What do you think?

Curtis

On Wed, Jul 21, 2010 at 6:31 AM, Justin Sheehy  wrote:

&gt; I think that we are all (myself included) getting two different issues
&gt; a bit mixed up in this discussion:
&gt;
&gt; 1: storing an implicit index of keys in the Riak key/value store
&gt;
&gt; 2: making buckets separate in that a per-bucket operation's
&gt; performance would not be affected by the content of other buckets
&gt;
&gt; The thread started out with a request for #2, but included a
&gt; suggestion to do #1. These are actually two different topics.
&gt;
&gt; The first issue, implicitly storing a big index of keys, is
&gt; impractical in a distributed key/value storage system that has Riak's
&gt; availability goals. We are very unlikely to implement this as
&gt; described in the near future. However, we very much recognize that
&gt; there are many different ways that people would like to find their
&gt; data. In that light, we are working on multiple different efforts
&gt; that will use the Riak core to provide data storage with more than
&gt; just "simple" key/value access.
&gt;
&gt; The second issue, of isolating buckets, is a much simpler design
&gt; choice and is also a per-backend implementation detail. We can create
&gt; and provide an alternative bitcask adapter that does this. It will be
&gt; a real tradeoff: in exchange for buckets not impacting each other as
&gt; much, the system will consume more filehandles, be a bit less
&gt; efficient at rebalancing, and will generally make buckets no longer
&gt; "free". This is a reasonable tradeoff in either direction for various
&gt; applications, and I support making it available as a choice. I have
&gt; created a bugzilla entry to track it:
&gt; https://issues.basho.com/show\\_bug.cgi?id=480
&gt;
&gt; I hope that this helps to clarify the issue.
&gt;
&gt; -Justin
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

