---
title: "Re: Receiving ulimit warning despite setting it"
description: ""
project: community
lastmod: 2013-05-15T22:46:28-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11090"
mailinglist_parent_id: "msg11089"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2013-05-15T22:46:28-07:00
---



On 16/05/13 15:38, Jared Morrow wrote:

I've considered packaging separate files for configuring the limit
for people, but the user in me always felt like that was something
the sysadmin should have a say in. I rather dislike packages that
make system changes without my knowledge or consent. Maybe that is
just me?


It's not making a system change though -- it's only adjusting things for 
the riak/riakcs user.


Can you think of any situation where a user would WANT to stick to the 
default 1024 file-handle limit and yet be running Riak?


Now think of how often that situation occurs, compared to the number of 
times where the user DOES want the "good" number setup, and would just 
like to install Riak and then get on with their work?


It seems to me like it would be nice if Riak "just worked" when you 
installed it, instead of requiring each and every user to have to track 
something down in the docs and then configure it in their chef/puppet 
manifests. Don't you agree that is a desirable feature of good software? 
(ie. Sensible defaults)


Cheers,
Toby


On May 15, 2013, at 10:54 PM, Toby Corkindale
 wrote:


On 16/05/13 14:39, Toby Corkindale wrote:

On 16/05/13 14:24, Jared Morrow wrote:

Well the riak-cs / riak / stanchion scripts all drop privileges
using sudo. On RHEL/Centos this sudo exec carries the settings
from the calling user (in the case of init.d, root) so things
are fine there. On Ubuntu/Debian that does not always work.
So if you set the ulimit for the root user, it might not
propagate through to the riak-cs / riak / stanchion users.

So to change that, you should try to change it in
/etc/security/limits.conf.


My understanding is that only sessions opened through PAM will
be effected by the limits.d/\\* config files. ie. Not daemon
processes. (I've checked this anyway with the following
/etc/security/limits.d/riakcs.conf: riak-cs hard nofile
32002 riak-cs soft nofile 32001 )

As noted previously, this problem was not occurring on the
current Ubuntu LTS nodes; just the Debian Squeeze ones. Which
makes it particularly odd.

Thanks for your help so far; I'll continue to investigate and
report back if I find a solution.


I realised that the Riak CS user was called "riakcs" and not
"riak-cs". Once I changed that in the limits.d/riakcs.conf file,
riakcs started working without the file warning.

I also added in a line for the regular "riak" user while I was
there.

May I suggest you add this to the debian/ubuntu packages by
default? (ie. a file in /etc/security/limits.d/ )


Cheers, Toby

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_ riak-users mailing
list riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com



\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

