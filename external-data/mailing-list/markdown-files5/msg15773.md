---
title: "Re: Data modelling questions"
description: ""
project: community
lastmod: 2015-02-22T18:18:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15773"
mailinglist_parent_id: "msg15772"
author_name: "Jason Campbell"
project_section: "mailinglistitem"
sent_date: 2015-02-22T18:18:07-08:00
---


Coming at this from another angle, if you already have a permanent data store, 
and you are only reporting on each hour at a time, can you run the reports 
based on the log itself?

A lot of Riak’s advantage comes from the stability and availability of data 
storage, but S3 is already doing that for you. Riak can store the data, but 
I’m not sure what benefit it serves from my understanding of your problem.

Aggregates are usually quite small (even with more advanced things like 
histograms), so it’s relatively easy to parse a log line-by-line and produce 
aggregates in-memory for a report.

Can you give a bit more detail on why are you using Riak?

Hope this helps,
Jason

&gt; On 23 Feb 2015, at 13:03, AM  wrote:
&gt; 
&gt; Hi Jason, Christopher.
&gt; 
&gt; This is supposed to be an append-only time-limited data. I only intend to 
&gt; save about 2 weeks worth of data (which is yet another thing I need to figure 
&gt; out, ie how to vacate older data).
&gt; 
&gt; Re: querying, for the most part the system will be building out hourly 
&gt; reports based on geo, build and location information so I need to have a 
&gt; model that allows me to aggregate by timestamp + [each-of-geo-build-location] 
&gt; or just do it on the fly during ingestion.
&gt; 
&gt; Ingestion is yet another thing where I have some flexibility as it is a batch 
&gt; job, ie log files get dropped on S3 and we get notified (usually on an hourly 
&gt; basis, some logs on a 10-min basis) so I can massage it further but I am 
&gt; concerned that every place where I buffer is another opportunity for losing 
&gt; data and I would like to avoid reprocessing as much as possible.
&gt; 
&gt; Messages will already have the timestamp and msg-id and I will mostly be 
&gt; interested in aggregates. In some very rare cases I expect to be able to 
&gt; simply run map-reduce jobs for custom queries.
&gt; 
&gt; Given that, does my current model look reasonable?
&gt; 
&gt; Thanks.
&gt; AM
&gt; 
&gt; 
&gt; On 2/21/15 6:40 PM, Jason Campbell wrote:
&gt;&gt; I have the same questions as Christopher.
&gt;&gt; 
&gt;&gt; Does this data need to change, or is it write-once?
&gt;&gt; What information do you have when querying?
&gt;&gt; - Will you already have timestamp and msg-id?
&gt;&gt; - If not, you may want to consider aggregating everything into a single 
&gt;&gt; key. This is easier of the data isn’t changing.
&gt;&gt; What data will you typically be querying?
&gt;&gt; - Will you typically be looking for a single element of data, or aggregates 
&gt;&gt; (graphing or mapping for example)?
&gt;&gt; - If aggregates, what fields are you aggregating on (timestamp, geo, 
&gt;&gt; location, etc) and which will be fixed?
&gt;&gt; 
&gt;&gt; The aggregate question may need a little more explanation, so I will use an 
&gt;&gt; example.
&gt;&gt; 
&gt;&gt; I have been working on time-series data with my key being: 
&gt;&gt; ::
&gt;&gt; Node-id and metric-id are fixed, they will never be merged in an aggregate 
&gt;&gt; way, and I have them before querying.
&gt;&gt; Timestamp is my aggregate value, I may need a single timestamp, or hundreds 
&gt;&gt; of thousands of timestamps (to draw a graph). For this reason, I grouped my 
&gt;&gt; metrics by 5 minute block instead of one key per timestamp. I also created 
&gt;&gt; aggregates with relevant averages and such for 1 hour, 1 day and 1 month to 
&gt;&gt; reduce the amount of key lookups for large graphs.
&gt;&gt; 
&gt;&gt; So it depends what visualisations you want. If you are going to be mapping 
&gt;&gt; the most recent data based on the geo or location, I would include 
&gt;&gt; aggregates for that. If you are more interested in timestamp, group by 
&gt;&gt; that. Because Riak doesn’t have multi-key consistency though, also choose 
&gt;&gt; an canonical source of data. If you store the same data in multiple keys, 
&gt;&gt; they will diverge at some point. Decide now which is the real source, and 
&gt;&gt; which are derived, it will make your life easier when fixing data later.
&gt;&gt; 
&gt;&gt; Also keep in mind typical periods and data size. There was no point for me 
&gt;&gt; to create a 1 minute increment since the 5 minute data was an acceptable 
&gt;&gt; size. Sure it’s a waste to transmit 4 minutes of data I don’t need, but 
&gt;&gt; it’s measured in milliseconds (mainly unserialising JSON in my app), so it 
&gt;&gt; doesn’t matter to me and makes larger aggregates much more performant.
&gt;&gt; 
&gt;&gt;&gt; On 22 Feb 2015, at 03:44, Christopher Meiklejohn  
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Feb 20, 2015, at 5:35 PM, AM  wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Hi All.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I am currently looking at using Riak as a data store for time series data. 
&gt;&gt;&gt;&gt; Currently we get about 1.5T of data in JSON format that I intend to 
&gt;&gt;&gt;&gt; persist in Riak. I am having some difficulty figuring out how to model it 
&gt;&gt;&gt;&gt; such that I can fulfill the use cases I have been handed.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; The data is provided in several types of log formats with some common 
&gt;&gt;&gt;&gt; fields:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; - timestamp
&gt;&gt;&gt;&gt; - geo
&gt;&gt;&gt;&gt; - s/w build #
&gt;&gt;&gt;&gt; - location #
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; - .... whole bunch of other key value pairs.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; For the most part I will need to provide aggregated views based on geo. 
&gt;&gt;&gt;&gt; There are some views based on s/w build # and location #. The aggregation 
&gt;&gt;&gt;&gt; will be on an hourly basis.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; The model that I came up with:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; [][-]: 
&gt;&gt;&gt; Hi AM,
&gt;&gt;&gt; 
&gt;&gt;&gt; Additionally, it would be great if you could provide additional information 
&gt;&gt;&gt; on how you plan on querying both the original and aggregated values. 
&gt;&gt;&gt; Querying is usually the most difficult part to get right in Riak, and your 
&gt;&gt;&gt; query pattern will be very important in establishing the best way to lay 
&gt;&gt;&gt; out this data on disk.
&gt;&gt;&gt; 
&gt;&gt;&gt; - Chris
&gt;&gt;&gt; 
&gt;&gt;&gt; Christopher Meiklejohn
&gt;&gt;&gt; Senior Software Engineer
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; cmeiklej...@basho.com
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

