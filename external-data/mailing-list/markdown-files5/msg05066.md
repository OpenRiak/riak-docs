---
title: "Re: Secondary Index ??"
description: ""
project: community
lastmod: 2011-10-06T02:22:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05066"
mailinglist_parent_id: "msg05052"
author_name: "Roland Karlsson"
project_section: "mailinglistitem"
sent_date: 2011-10-06T02:22:49-07:00
---


Maybe my question below was not clear enough.

I wonder why get\\_index() returns a list
of lists (containing bucket/key pairs), when mapred()
wants a list of tuples (containing bucket/key pairs).
Looks like an unnecessary conversion by the user too me.

/Roland




----- Original Message -----
From: "Roland Karlsson" 
To: riak-users@lists.basho.com
Sent: Wednesday, October 5, 2011 4:33:17 PM
Subject: Re: Secondary Index ??

Thanx - now it works!

Your explanations were very good.

I also found I had to change from bitcask to eleveldb.

I added one object with the same index and then I got the answer

{ok, [[&lt;&lt;"persons"&gt;&gt;,&lt;&lt;"kenny"&gt;&gt;],[&lt;&lt;"persons"&gt;&gt;,&lt;&lt;"bosse"&gt;&gt;]]}

Hmmm ... why is it a list in a list?

/Roland




----- Original Message -----
From: "Russell Brown" 
To: "Roland Karlsson" 
Cc: riak-users@lists.basho.com
Sent: Wednesday, October 5, 2011 3:12:04 PM
Subject: Re: Secondary Index ??


On 5 Oct 2011, at 13:45, Roland Karlsson wrote:

&gt; Hi,
&gt; 
&gt; I might not look hard enough - but I cannot find how to use
&gt; the secondary indices from the riakc erlang client interface.
&gt; No example and no manual.

Ooops, we'll get on that.

&gt; 
&gt; I need a simple example how to write an indexed object
&gt; and also a simple example how to look it up via the index.
&gt; 
&gt; This is my own try to write and lookup an object
&gt; It does not work :)

Doesn't work crash or doesn't work, you get {ok, []} when you query the index?

&gt; 
&gt; ----------------------------------------------------------
&gt; write\\_index(Pid) -&gt; 
&gt; 
&gt; 
&gt; 
&gt; Bucket = &lt;&lt;"persons"&gt;&gt;,
&gt; Key = &lt;&lt;"bosse"&gt;&gt;,
&gt; Index = {&lt;&lt;"lives"&gt;&gt;, &lt;&lt;"sumatra"&gt;&gt;},

Indexes should have a suffix of either \\_bin for binary or \\_int for integer.

&gt; Obj = riakc\\_obj:new(Bucket, Key, &lt;&lt;"1949"&gt;&gt;),
&gt; Meta = dict:store(?MD\\_INDEX, Index, dict:new()),

Index should be a list. If it \\*was\\* in a list you would have got an error 
{error,&lt;&lt;"{precommit\\_fail,[{unknown\\_field\\_type,&lt;&lt;\\"lives\\"&gt;&gt;}]}"&gt;&gt;} on put. 

&gt; Obj2 = riakc\\_obj:update\\_metadata(Obj, Meta),
&gt; riakc\\_pb\\_socket:put(Pid, Obj2).
&gt; ----------------------------------------------------------
&gt; read\\_index(Pid) -&gt;
&gt; Bucket = &lt;&lt;"persons"&gt;&gt;,
&gt; Index = &lt;&lt;"lives"&gt;&gt;,

Again, the suffix. or you'll get 
{error,&lt;&lt;"{inputs,[{unknown\\_field\\_type,&lt;&lt;\\"lives\\"&gt;&gt;}]}"&gt;&gt;} when you do that 
get\\_index.

&gt; IndexKey = &lt;&lt;"sumatra"&gt;&gt;,
&gt; riakc\\_pb\\_socket:get\\_index(Pid, Bucket, Index, IndexKey). 
&gt; 
&gt; 
&gt; ----------------------------------------------------------

Do \\_all\\_ that and I get {ok,[[&lt;&lt;"persons"&gt;&gt;,&lt;&lt;"bosse"&gt;&gt;]]} as the output from 
get\\_index.

We'll get those docs updated.

Cheers

Russell
&gt; 
&gt; 
&gt; /Roland
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

