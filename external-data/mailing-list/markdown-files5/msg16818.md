---
title: "Re: Unable to create anonymous user"
description: ""
project: community
lastmod: 2015-11-25T11:31:30-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16818"
mailinglist_parent_id: "msg16813"
author_name: "Ben Rudolph"
project_section: "mailinglistitem"
sent_date: 2015-11-25T11:31:30-08:00
---


Thanks for the response Dmitri. Just double checked all those settings

1) I checked with stanchion ping and i'm also able to telnet into the
stanchion\\_host from the riak node
2)Double checked and it shows up in the logs:
&lt;0.142.0&gt;@riak\\_cs\\_config:warnings:120 `anonymous\\_user\\_creation` is set as
true. Set this as false when this CS nodes is populated as public service.
3) Yes
4) Yes

In case useful, here are our configs:
https://github.com/dimagi/commcarehq-ansible/tree/riak/ansible/roles/riakcs/templates

On Wed, Nov 25, 2015 at 10:04 AM, Dmitri Zagidulin 
wrote:

&gt; Hi Ben,
&gt;
&gt; Just to double-check:
&gt; 1) is Stanchion installed and running, when you try to create the user?
&gt; (and the stanchion\\_host entry is pointing to it, in cs config?)
&gt;
&gt; 2) is anonymous\\_user\\_creation = on in the config file?
&gt;
&gt; 3) do you have 'buckets.default.allow\\_mult = true' in the Riak config file?
&gt;
&gt; 4) (this is likely to be yes, but just to check) Have you restarted Riak
&gt; since configuring the advanced.config backend?
&gt;
&gt; Dmitri
&gt;
&gt; On Tue, Nov 24, 2015 at 6:40 PM, Ben Rudolph  wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I've almost completed the cluster setup but am running into issues with
&gt;&gt; anonymous user creation. All machines ping/pong and their IPs are matching.
&gt;&gt; When I run the curl command to create an anonymous user:
&gt;&gt;
&gt;&gt; curl -H 'Content-Type: application/json' -XPOST http://\\*\\*:8080/riak-cs/user
&gt;&gt; --data '{"email":"em...@email.com", "name":"admin\\_user"}'
&gt;&gt;
&gt;&gt; And I get an XML response that says Internal Server Error. The
&gt;&gt; console.log file looks like this:
&gt;&gt;
&gt;&gt; 2015-11-24 23:16:35.572 [error] &lt;0.439.0&gt; Webmachine error at path
&gt;&gt; "/riak-cs/user" :
&gt;&gt; {error,{error,{badmatch,{error,malformed\\_xml}},[{riak\\_cs\\_s3\\_response,xml\\_error\\_code,1,[{file,"src/riak\\_cs\\_s3\\_response.erl"},{line,335}]},{riak\\_cs\\_s3\\_response,error\\_response,1,[{file,"src/riak\\_cs\\_s3\\_response.erl"},{line,249}]},{riak\\_cs\\_wm\\_user,accept\\_json,2,[{file,"src/riak\\_cs\\_wm\\_user.erl"},{line,119}]},{webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_resource.erl"},{line,186}]},{webmachine\\_resource,do,3,[{file,"src/webmachine\\_resource.erl"},{line,142}]},{webmachine\\_decision\\_core,resource\\_call,...},...]}}
&gt;&gt; in riak\\_cs\\_s3\\_response:xml\\_error\\_code/1 line 335
&gt;&gt;
&gt;&gt; Which led me to this issue here
&gt;&gt; . However my
&gt;&gt; advanced.config already looks like this (which is what is suggested in the
&gt;&gt; issue):
&gt;&gt; [
&gt;&gt; {riak\\_kv, [
&gt;&gt; {add\\_paths, ["/usr/lib/riak-cs/lib/riak\\_cs-2.0.1/ebin"]},
&gt;&gt; {storage\\_backend, riak\\_cs\\_kv\\_multi\\_backend},
&gt;&gt; {multi\\_backend\\_prefix\\_list, [{&lt;&lt;"0b:"&gt;&gt;, be\\_blocks}]},
&gt;&gt; {multi\\_backend\\_default, be\\_default},
&gt;&gt; {multi\\_backend, [
&gt;&gt; {be\\_default, riak\\_kv\\_eleveldb\\_backend, [
&gt;&gt; {total\\_leveldb\\_mem\\_percent, 30},
&gt;&gt; {data\\_root, "/opt/data/riak/leveldb"}
&gt;&gt; ]},
&gt;&gt; {be\\_blocks, riak\\_kv\\_bitcask\\_backend, [
&gt;&gt; {data\\_root, "/opt/data/riak/bitcask"}
&gt;&gt; ]}
&gt;&gt; ]}
&gt;&gt; ]}
&gt;&gt; ].
&gt;&gt;
&gt;&gt; Any insight would be useful!
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Ben
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

