---
title: "Riak Merge On Restarts Only"
description: ""
project: community
lastmod: 2013-01-18T14:15:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09844"
author_name: "Ian Ha"
project_section: "mailinglistitem"
sent_date: 2013-01-18T14:15:16-08:00
---


Hi,

In our production system, we notice that merges are not taking place. We
have noticed, however, that when we restart riak (via a 'riak stop' then a
'riak start'), then the merges are triggered and our disk usage goes way
day (which is what we want). We use bitcask.

Why does this happen on a restart only and not at other times, even though
we have set our merge\\_window config setting to 'always'?

I'm assuming our config values are correct as the restart considers the
thresholds met to go ahead with a merge.

Also: Are there any tools out there that I can run on my data directory
that will tell me the size of the dead byte ratios? Would be nice to see
what the dead byte 'state' of my data dir is in so I can tell whether
indeed merge conditions are met.

Our bit cask configs are as follows in app.config:

{bitcask, [
 {data\\_root, "/var/lib/riak/bitcask"},
 {dead\\_bytes\\_merge\\_trigger, 268435456},
 {dead\\_bytes\\_threshold, 134217728},
 {expiry\\_secs, 3888000},
 {frag\\_merge\\_trigger, 40},
 {frag\\_threshold, 20},
 {merge\\_window, always},
 {small\\_file\\_threshold, 10485760},
 {sync\\_strategy, none}
 ]},


Thanks!
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

