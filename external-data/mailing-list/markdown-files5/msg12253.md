---
title: "Re: use Siblings to implement a message queue?"
description: ""
project: community
lastmod: 2013-09-12T19:53:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12253"
mailinglist_parent_id: "msg12250"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-09-12T19:53:23-07:00
---


---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Thu, Sep 12, 2013 at 9:45 AM, Alex Rice  wrote:

&gt; Hey all, thanks for the feedback, this is interesting!
&gt;
&gt; re: Those CRDT white papers look pretty complicated, I will definitely
&gt; will leave that to you hardcore mathematicians and computer scientists
&gt; :)
&gt; re: Riak 2.0, I see there are git branches for 2.0 related stuff in
&gt; Riak and in corrugatediron, I am guessing it's still too rough around
&gt; the edges for a newbie like me to be messing around with?
&gt;

I can't speak for Riak 2.0, but CorrugatedIron's support doesn't have any
tests supporting it... I hope to get on that next week to see where things
are. The only hold up is time on my end. I believe the riak branch should
be workable for development. There are features in CI that need clean up,
but I'll start pushing out RC builds through nuget for the adventurous.


&gt; re: RabbitMQ I had heard of it but am hesitant to add another
&gt; daemon/system dependency. But I am definitely considering your
&gt; advice, Guido!
&gt;
&gt; Also for this particular project (a multiplayer game) I may be able to
&gt; get away with Sets, don't actually really need proper Queues. Actually
&gt; I'm not sure. Just thinking out loud here.
&gt;
&gt; For a Set implementation in Riak, I am thinking of modeling it after
&gt; this blog post, I cannot find which at the moment, which described how
&gt; to implement a lock-free Set in Redis. Redis is not distributed, but I
&gt; think the data structure is still relevant:
&gt;
&gt; \\* To get around the eventual-consistency issue, a prerequisite would
&gt; be to always use R=1 and W=all. This will optimize it for reads
&gt; because there will be a process polling Riak to remove messages out of
&gt; the Set.
&gt; \\* In the Redis implementation, they used the atomic APPEND operation
&gt; to append entries into the set, as a list but with notation to add or
&gt; remove, prefixed with + or -. e.g.
&gt; +itemA
&gt; +itemB
&gt; -itemA
&gt; +itemC
&gt; =&gt; yields { itemB, itemC }
&gt; \\* Obviously Riak doesn't have atomic appends, however setting a bucket
&gt; to allow\\_mult = true, and always Put-ing with null vector clock, then
&gt; the Siblings feature should be equivalent. Instead of a value being
&gt; appended to, the Siblings would be populated with +itemA, +itemB,
&gt; -itemA, +itemC, etc.
&gt;

&gt;From an API perspective, you'll do something similar in Riak 2.0. The
CorrugatedIron operation would allow to atomically put individual items
into a set. I'm hoping to create change tracking data structures for use
with the get/put/delete functionality of Riak's server side CRDTs.


&gt; \\* Any process reading the Set is also be responsible for collating and
&gt; Put-ing the condensed set back, after it reaches some size limit or I
&gt; think they called it 'fragmentation'. This condense and re-Put
&gt; operation would be the tricky part, and would need to use vector clock
&gt; and ensure there are 0 siblings when finished. But it should be
&gt; possible? It seems like this is an uber-simplified form of a CRDT data
&gt; structure?
&gt;

If you're implementing the CRDT on the client side, you'll need to figure
out the garbage collection yourself. If you're able to use Riak's data
structures, then you can safely rely on someone else handling the problems
for you.

If it weren't for my day job, I'd have this CRDT support in CI by now ;)


&gt;
&gt; Thanks,
&gt; Alex
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Thu, Sep 12, 2013 at 2:12 AM, Guido Medina 
&gt; wrote:
&gt; &gt; Alex,
&gt; &gt;
&gt; &gt; RabbitMQ which is a good high performer, developed in Erlang and scales
&gt; just
&gt; &gt; as Riak.
&gt; &gt;
&gt; &gt; The old saying, the right tool for the right job, I like how fast Riak is
&gt; &gt; fetching/storing key values on a distributed environment, I don't like
&gt; Riak
&gt; &gt; for queues, is it because it wasn't designed for that? CRDT like CAS
&gt; &gt; operations on structures (to mention some for Java) like
&gt; LinkedBlockingQueue
&gt; &gt; and ConcurrentLinkedQueue should be painful enough to develop in a CRDT
&gt; &gt; environment, cause now you would be talking of guarding states of few
&gt; within
&gt; &gt; the same structure; say AtomicReference of several variables to warranty
&gt; a
&gt; &gt; non-blocking CAS operation, in this case heap and tail of the queue (Not
&gt; so
&gt; &gt; true for LinkedBlockingQueue)
&gt; &gt;
&gt; &gt; And performance of several CRDT for high performance queue I don't
&gt; actually
&gt; &gt; think is going to be good.
&gt; &gt;
&gt; &gt; If I were to use Riak for my big data environment and would like to match
&gt; &gt; Riak on a distributed queueing system then I would use like I said,
&gt; &gt; RabbitMQ.
&gt; &gt;
&gt; &gt; Guido.
&gt; &gt;
&gt; &gt;
&gt; &gt; On 12/09/13 00:29, Alex Rice wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi I'm very new to Riak. The allow\\_mult = true / Siblings feature is
&gt; &gt;&gt; very interesting. Could it be used to implement a high performance
&gt; &gt;&gt; collection like a Queue or Set, in a lock free manner? The Riak docs
&gt; &gt;&gt; make it sound like allow\\_mult is mainly for confict resolution and
&gt; &gt;&gt; degenerate cases, rather than a feature which a data structure could
&gt; &gt;&gt; be designed around. Does anyone have any links to share, or thoughts
&gt; &gt;&gt; about this broader issue?
&gt; &gt;&gt; Thanks much!
&gt; &gt;&gt; Alex
&gt; &gt;&gt;
&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

