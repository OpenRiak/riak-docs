---
title: "Mecking riakc_pb_socket:get/3"
description: ""
project: community
lastmod: 2015-11-02T07:24:08-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16725"
author_name: "Michael Martin"
project_section: "mailinglistitem"
sent_date: 2015-11-02T07:24:08-08:00
---



Hi all,

I'm trying to meck riakc\\_pb\\_socket:get/3 in my eunit tests, and 
consistently get a function\\_clause error.


The meck:expect looks like:

meck:expect(riakc\\_pb\\_socket, get, [Pid, ?RIAK\\_TYPE\\_AND\\_BUCKET, 
?TestOid], {ok, ?TestRiakObject}),


where Pid is a pid, the macro ?RIAK\\_TYPE\\_AND\\_BUCKET evaluates to 
{&lt;&lt;"buckettype"&gt;&gt;, &lt;&lt;"bucketname"&gt;&gt;},
and ?TestOid evalutes to 
&lt;&lt;"809876fd89ac405680b7251c2e57faa30004524100486220"&gt;&gt;).


With the exception of the Pid, the other arguments, as well as the 
expected response, are taken from a live,

running system, where the call to riakc\\_pb\\_socket:get/3 works as expected.

Looking at the source for riakc\\_pb\\_socket:get/3, I see that the -spec 
looks like:


-spec get(pid(), bucket(), key()) -&gt; {ok, riakc\\_obj()} | {error, term()}.

and the types bucket() and key() are defined as:
-type bucket() :: binary(). %% A bucket name.
-type key() :: binary(). %% A key name.

In reality, when using bucket types, shouldn't the bucket() type be a 
tuple? At any rate, changing it

to tuple() didn't help my case any.

Can anyone show me an example of a working meck:expect for 
riakc\\_pb\\_socket:get/3?


Thanks,
Michael

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

