---
title: "Re: Faster way to store a lot of small data?"
description: ""
project: community
lastmod: 2012-02-23T18:08:58-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06719"
mailinglist_parent_id: "msg06710"
author_name: "Eric Fong"
project_section: "mailinglistitem"
sent_date: 2012-02-23T18:08:58-08:00
---


Hi

I have a bash script put.sh:
----------------------------------------------------------------------------------------------------------
# upload file
#
# Bulk Upload:
# put.sh local-folder bucket-name prefix-inside-bucket
#
file=$1
bucket=$2
prefix=$3

if [ -d "$file" ]; then
 prefixRemove=$file find $file -type f -exec $0 {} $bucket $prefix \\;
 exit 0
fi

if [ -z "$type" ]; then
type=`file -i $file | awk '{print $2}'`
fi

# escape
bucket=$(echo $bucket | sed 's/~/~~/g' | sed 's/\\/\\+/~/g' )

key=$file
key=$(echo $key | sed 's/^\\.\\/\\+//g')
if [ -n "$prefixRemove" ]; then
 prefixRemove=$(echo $prefixRemove | sed 's/\\(\\/\\)/\\\\\\1/g')
 key=$(echo $key | eval "sed 's/$prefixRemove//g'")
fi
key=$(echo $prefix$key | sed 's/~/~~/g' | sed 's/\\/\\+/~/g')

#-H "x-riak-index-date\\_int:`date +%s`"
if [ -z "$test" ]; then
 curl -s -X PUT -T ${file} -H content-type:${type}
http://magic1:8098/buckets/${bucket}/keys/${key}
fi
echo http://magic1:8098/buckets/${bucket}/keys/${key}
----------------------------------------------------------------------------------------------------------


I think it is similar to what Russell did.
I think xargs -P is the key!

I have one machine and all bucket setting is default. Then, I think the N
is 3


Actually, I found another problem. Last night, I started to upload a lot of
small pngs into riak (total size is 900MB and each of them are 10KB). This
morning, I come back and found that riak eat up 40GB of my harddisk and it
is 100% full. I try to restart riak few times. Still cannot get the whole
riak work well again. I am using levelDB. Try to recover the whole system
first.

Eric

On Thu, Feb 23, 2012 at 10:59 PM, Russell Brown  wrote:

&gt;
&gt; On 23 Feb 2012, at 14:37, Jeremiah Peschka wrote:
&gt;
&gt; Out of interest, to those of us who are rusty on their shell scripting,
&gt; could you share the aforementioned script?
&gt;
&gt;
&gt;
&gt; find png\\_test -name "\\*.png" -print0 | xargs -0 -P 4 -I file curl -X
&gt; PUT localhost:8098/riak/file --data-binary @file -H"Content-Type: image/png"
&gt;
&gt; I'm a shell scripting n00b so there is probably a much better way. In this
&gt; case png\\_test is a directory I created with 1000\\*10k pngs. So the bucket
&gt; name is the directory name 'png\\_test'. Only works for a flat dir, it was
&gt; just something to check the times that Eric mentioned, please don't think
&gt; it is like a working script or anything.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt;
&gt; ---
&gt; Jeremiah Peschka
&gt; Managing Director, Brent Ozar PLF, LLC
&gt;
&gt;
&gt; On Thu, Feb 23, 2012 at 2:02 AM, Russell Brown wrote:
&gt;
&gt;&gt; Hi Eric,
&gt;&gt;
&gt;&gt; On 23 Feb 2012, at 08:45, Eric Fong wrote:
&gt;&gt;
&gt;&gt; &gt; Hi
&gt;&gt; &gt;
&gt;&gt; &gt; Help. I want to store few thousands of small png (each of them will
&gt;&gt; just be 10K) into riak.
&gt;&gt; &gt; But I find that is really slow (1 to 2 second for one png).
&gt;&gt; &gt;
&gt;&gt; &gt; Currently, I use a bash script to find and loop the directory
&gt;&gt; &gt; And curl PUT the png onto riak.
&gt;&gt; &gt;
&gt;&gt; &gt; Do we have a bulk upload or will it be faster if I use erlang or or
&gt;&gt; driver?
&gt;&gt; &gt; I need to upload 1000 small png within one minute. Can it be done?
&gt;&gt;
&gt;&gt; I imagine it is possible. I just managed to do it in 10seconds on my
&gt;&gt; laptop, single node with n=3 and r=2 using xargs and curl to put in
&gt;&gt; parallel.
&gt;&gt;
&gt;&gt; How many nodes do you have? What is your n-val?
&gt;&gt;
&gt;&gt; cheers
&gt;&gt;
&gt;&gt; Russell
&gt;&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Currently, I am on riak 1.01 and levelDB backend.
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks a lot!
&gt;&gt; &gt; --
&gt;&gt; &gt; Best Regards,
&gt;&gt; &gt; Eric Fong
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Best Regards,
Eric Fong
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

