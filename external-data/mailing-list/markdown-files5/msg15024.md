---
title: "Re: serving files from riak-cs to public via url"
description: ""
project: community
lastmod: 2014-10-13T22:03:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15024"
mailinglist_parent_id: "msg15021"
author_name: "Kota Uenishi"
project_section: "mailinglistitem"
sent_date: 2014-10-13T22:03:38-07:00
---


How about setting read-public acl to buckets instead of setting it each object?

BTW that seems valid JSON, or did you correctly put 'application/json'
as content-type when you put the policy?

On Tue, Oct 14, 2014 at 5:19 AM, Michael Grauer
 wrote:
&gt; Thanks Ali.
&gt;
&gt; I now am having a permissions issue it seems in accessing the objects.
&gt;
&gt; I try to curl the object
&gt;
&gt; http://10.x.x.x/test-bucket/pointclouds/4f55ed40ca08aeb57bf19257aa6601e85436ff0684aa2/static/metadata.ini
&gt;
&gt; and I get
&gt;
&gt; xml version="1.0"
 encoding="UTF-8"?&gt;`AccessDenied`Access
&gt; Denied/test-bucket/pointclouds/4f55ed40ca08aeb57bf19257aa6601e85436ff0684aa2/static/metadata.ini
&gt;
&gt;
&gt; When I request the ACL for this bucket from boto I get:
&gt;
&gt;  michael.grauer (owner) = FULL\\_CONTROL&gt;
&gt;
&gt; I would like to not have to set ACLs on each object in my bucket, as I
&gt; expect a large number of objects. I tried to set a bucket policy like this:
&gt;
&gt; {
&gt; "Version":"2008-10-17",
&gt; "Statement":[{
&gt; "Sid":"AllowPublicRead",
&gt; "Effect":"Allow",
&gt; "Principal": {
&gt; "AWS": "\\*"
&gt; },
&gt; "Action":["s3:GetObject"],
&gt; "Resource":["arn:aws:s3:::test-bucket/\\*"
&gt; ]
&gt; }
&gt; ]
&gt; }
&gt;
&gt;
&gt;
&gt; But this was not accepted by boto or s3cmd . boto told me
&gt; boto.exception.S3ResponseError: S3ResponseError: 415 Unsupported Media Type
&gt; , but there weren't any errors that I could see in the riak-cs logs.
&gt;
&gt; Can anyone point the way?
&gt;
&gt;
&gt; Thanks again
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Mon, Oct 13, 2014 at 2:53 PM, Ali Nikkhah 
&gt; wrote:
&gt;&gt;
&gt;&gt; Hi Mike,
&gt;&gt;
&gt;&gt; You are trying to resolve a domain name 'test-bucket.10.x.x.x,' which is
&gt;&gt; invalid. This is the part that is incorrect. There are a couple options:
&gt;&gt;
&gt;&gt; 0) You should be able to access the bucket by using
&gt;&gt; http://ip/bucket-name, like:
&gt;&gt;
&gt;&gt; http://10.x.x.x/test-bucket/my\\_key\\_path
&gt;&gt;
&gt;&gt; 1) For easier public access, you can then set up a resolvable domain
&gt;&gt; name in your DNS configuration for the bucket, i.e. add a dns entry
&gt;&gt; like:
&gt;&gt;
&gt;&gt; test-bucket..com
&gt;&gt;
&gt;&gt; pointing to the riak-cs proxy ip. As long as your proxy is set up
&gt;&gt; properly, you should then be able to access the object using:
&gt;&gt;
&gt;&gt; http://test-bucket..com/my\\_key\\_path
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; -Ali
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, 2014-10-13 at 14:11 -0400, Michael Grauer wrote:
&gt;&gt; &gt; Hi,
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; I'm very new to Riak-CS, and am investigating using it as a standin
&gt;&gt; &gt; for S3. I'd like to have a url that allows an anonymous
&gt;&gt; &gt; (unauthenticated) user to download an object from a bucket.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Riak 2.0.0-1
&gt;&gt; &gt; Riak CS 1.5.0-1
&gt;&gt; &gt; Stanchion 1.5.0-1
&gt;&gt; &gt; Ubuntu 14.04
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; I have test-bucket set up, and can connect to it, and upload and
&gt;&gt; &gt; download a file there all using an authenticated user that owns the
&gt;&gt; &gt; bucket, via boto.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; My Riak CS is running as 10.x.x.x , the internal IP of my AWS
&gt;&gt; &gt; instance, and proxied behind nginx.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; When I try to curl
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; curl -v http://test-bucket.10.x.x.x/my\\_key\\_path
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; I'm getting "could not resolve host: test-bucket.10.x.x.x"
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; My configuration is incorrect, but I'm uncertain of how to fix it.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Any help is appreciated!
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks,
&gt;&gt; &gt; Mike
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;



-- 
Kota UENISHI / @kuenishi
Basho Japan KK

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

