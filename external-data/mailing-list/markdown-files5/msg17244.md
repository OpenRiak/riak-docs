---
title: "Re: how to really delete keys from Riak"
description: ""
project: community
lastmod: 2016-04-20T12:34:04-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17244"
mailinglist_parent_id: "msg17246"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2016-04-20T12:34:04-07:00
---


Check out bitcask TTL, expiry. 
-Alexander 


@siculars
http://siculars.posthaven.com

Sent from my iRotaryPhone

&gt; On Apr 20, 2016, at 12:20, Shifeng Xiao  wrote:
&gt; 
&gt; Thanks for the information Alexander and Daniel, I appreciated it.
&gt; 
&gt; We are using Riak2.0 and bitcask as backend, and we are writing the keys once 
&gt; into bucket, keep it for a few hours, then delete it, never update the 
&gt; existing data.
&gt; 
&gt; 
&gt;&gt; On Wed, Apr 20, 2016 at 11:32 AM, Alexander Sicular  
&gt;&gt; wrote:
&gt;&gt; Hello Shifeng,
&gt;&gt; 
&gt;&gt; Riak uses Bitcask as its default data backend, it may also use leveldb
&gt;&gt; as a backend but must be configured to do so[0][1]. Both bitcask[2]
&gt;&gt; and leveldb[3] do not reclaim disk space immediately when a delete is
&gt;&gt; issued. Incidentally, neither do updates. Because Riak is
&gt;&gt; non-destructive, aka append only, aka no in-place updates, mutation
&gt;&gt; operations like updates or deletes are actually writes. For example, a
&gt;&gt; 10KB object that is updated four times in some short interval will
&gt;&gt; consume 50KB space (original 10KB + 4 x 10KB updates) until
&gt;&gt; merge/compaction occurs. A delete is actually a special zero byte
&gt;&gt; value write indicating a key is marked for deletion, aka a tombstone.
&gt;&gt; Bitcask will reclaim disk space via merge operations which may be
&gt;&gt; controlled by the user. Leveldb reclaims disk space via compaction
&gt;&gt; operations.
&gt;&gt; 
&gt;&gt; Architects and Developers should take into account their update/delete
&gt;&gt; ratios and consider how those will affect disk space consumption and
&gt;&gt; consider how deletes operate in distributed systems in general and
&gt;&gt; Riak in specific from an application perspective. John Daily wrote a
&gt;&gt; must read four part series on Riak's configurable behaviors that all
&gt;&gt; Riak developers should be familiar with. Part 3 deals specifically
&gt;&gt; with delete related considerations[4].
&gt;&gt; 
&gt;&gt; Thank you,
&gt;&gt; Alexander
&gt;&gt; 
&gt;&gt; [0] 
&gt;&gt; http://docs.basho.com/riak/kv/latest/setup/planning/backend/leveldb/#installing-eleveldb
&gt;&gt; [1] http://docs.basho.com/riak/kv/latest/configuring/backend/
&gt;&gt; [2] http://docs.basho.com/riak/kv/latest/setup/planning/backend/bitcask/
&gt;&gt; [3] http://docs.basho.com/riak/kv/latest/setup/planning/backend/leveldb/
&gt;&gt; [4] http://basho.com/posts/technical/riaks-config-behaviors-part-3/
&gt;&gt; 
&gt;&gt; On Wed, Apr 20, 2016 at 8:17 AM, Daniel Abrahamsson
&gt;&gt;  wrote:
&gt;&gt; &gt; Hi,
&gt;&gt; &gt;
&gt;&gt; &gt; What riak version and what riak backend are you using? For leveldb you have
&gt;&gt; &gt; to take compaction into account, and for older bitcask versions there are
&gt;&gt; &gt; known issues with data not being properly deleted.
&gt;&gt; &gt;
&gt;&gt; &gt; //Daniel
&gt;&gt; &gt;
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;
&gt; 
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

