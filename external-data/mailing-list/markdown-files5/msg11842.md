---
title: "Re: combining Riak (CS) and Spark/shark by speaking over s3 protocol"
description: ""
project: community
lastmod: 2013-07-31T06:47:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11842"
mailinglist_parent_id: "msg11839"
author_name: "gbrits"
project_section: "mailinglistitem"
sent_date: 2013-07-31T06:47:55-07:00
---


I appreciate the clarification. Objectsize for the dataset I'm currently
investigating is 8KB (on the bit exactly) so that would be loads of
overhead when going the Riak CS route.
Upfront I already figured Riak directly was a more efficient way to go, but
getting a nice Riak + Spark/Shark integration going (through S3) is worth a
lot to me as well. Some experimenting to do I guess :)

Thanks,
Geert-Jan


2013/7/31 Dan Kerrigan [via Riak Users] &lt;
ml-node+s197444n4028644...@n3.nabble.com&gt;

&gt; Geert-Jan
&gt;
&gt; Riak CS currently doesn't support the S3 Copy command. Flume and Hadoop
&gt; distcp create a temporary object and then attempts to Copy that object to
&gt; it's permanent location. Rename is a Copy then a Delete since the S3 API
&gt; doesn't support Rename.
&gt;
&gt; Regarding efficiency, Riak CS block sizes are 1MB (100 MB object, 100 Riak
&gt; Bitcask stored objects) so you can use the Bitcask calculator at [0] to get
&gt; a rough estimate requirements to store your particular dataset. Regarding
&gt; the impact to read latency, severe is probably not the right word but there
&gt; is an impact. Besides API support, your decision will, in part, come down
&gt; to how large your object sizes are going to be. The Riak FAQ [1] currently
&gt; suggests that Riak Object sizes should be less than 10MB. Riak CS on the
&gt; other hand can handle object sizes up to 5TB. If you are doing multi-key
&gt; retrieves for lots of small objects, Riak looks like the right choice
&gt; otherwise, go with Riak CS. Some basic testing would go a long way to find
&gt; the balance in your case.
&gt;
&gt; Respectfully -
&gt; Dan Kerrigan
&gt;
&gt; [0] http://docs.basho.com/riak/latest/ops/building/planning/bitcask/
&gt; [1]
&gt; http://docs.basho.com/riak/latest/community/faqs/developing/#is-there-a-limit-on-the-file-size-that-can-be-stor
&gt;
&gt;
&gt;
&gt; On Wed, Jul 31, 2013 at 4:43 AM, Geert-Jan Brits &lt;[hidden 
&gt; email]
&gt; &gt; wrote:
&gt;
&gt;&gt; Dan,
&gt;&gt;
&gt;&gt; Not sure if I understand the "renaming objects"-problem in Riak CS. Can
&gt;&gt; you elaborate?
&gt;&gt;
&gt;&gt; "I believe smaller object sizes would not be nearly as efficient as
&gt;&gt; working with plain Riak if only because of the overhead incurred by Riak
&gt;&gt; CS". Does this mean lack of efficiency in disk storage, in-mem or both?
&gt;&gt; Moreover I'm having this nagging thought that having to dig through the
&gt;&gt; manifest to find the blocks will severely impact read latency for
&gt;&gt; (multi-key) lookups as opposed to the normal bitcask / levelDB lookup. Is
&gt;&gt; this correct?
&gt;&gt;
&gt;&gt; Best,
&gt;&gt; Geert-Jan
&gt;&gt;
&gt;&gt;
&gt;&gt; 2013/7/30 Dan Kerrigan &lt;[hidden 
&gt;&gt; email]
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt;&gt; Geert-Jan -
&gt;&gt;&gt;
&gt;&gt;&gt; We're currently working on a somewhat similar project to integrate Flume
&gt;&gt;&gt; to ingest data into Riak CS for later processing using Hadoop. The
&gt;&gt;&gt; limitations of HDFS/S3, when using the s3:// or s3n:// URIs, seem to
&gt;&gt;&gt; revolve around renaming objects (copy/delete) in Riak CS. If you can avoid
&gt;&gt;&gt; that, this link should work fine.
&gt;&gt;&gt;
&gt;&gt;&gt; Regarding how data is stored in Riak CS, the data block storage is
&gt;&gt;&gt; Bitcask with manifest storage being held in LevelDB. Riak CS is optimized
&gt;&gt;&gt; for larger object sizes and I believe smaller object sizes would not be
&gt;&gt;&gt; nearly as efficient as working with plain Riak if only because of the
&gt;&gt;&gt; overhead incurred by Riak CS. The benefits of Riak generally carry over to
&gt;&gt;&gt; Riak CS so there shouldn't be any need to worry about losing raw power.
&gt;&gt;&gt;
&gt;&gt;&gt; Respectfully -
&gt;&gt;&gt; Dan Kerrigan
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Jul 30, 2013 at 2:21 PM, gbrits &lt;[hidden 
&gt;&gt;&gt; email]
&gt;&gt;&gt; &gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This may be totally missing the mark but I've been reading up on ways
&gt;&gt;&gt;&gt; to do
&gt;&gt;&gt;&gt; fast iterative processing in Storm or Spark/shark, with the ultimate
&gt;&gt;&gt;&gt; goal of
&gt;&gt;&gt;&gt; results ending up in Riak for fast multi-key retrieval.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I want this setup to be as lean as possible for obvious reasons so I've
&gt;&gt;&gt;&gt; started to look more closely at the possible Riak CS / Spark combo.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Apparently, please correct if wrong, Riak CS sits on top of Riak and is
&gt;&gt;&gt;&gt; S3-api compliant. Underlying the db for the objects is levelDB (which
&gt;&gt;&gt;&gt; would
&gt;&gt;&gt;&gt; have been my choice anyway, bc of the low in-mem key overhead)
&gt;&gt;&gt;&gt; Apparently
&gt;&gt;&gt;&gt; Bitcask is also used, although it's not clear to me what for exactly.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; At the same time Spark (with Shark on top, which is what Hive is for
&gt;&gt;&gt;&gt; Hadoop
&gt;&gt;&gt;&gt; if that in any way makes things clearer) can use HDFS or S3 as it's so
&gt;&gt;&gt;&gt; called 'deep store'.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Combining this it seems, Riak CS and Spark/Shark could be a nice pretty
&gt;&gt;&gt;&gt; tight combo providing interative and adhoc quering through Shark + all
&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt; excellent stuff of Riak through the S3 protocol which they both speak .
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Is this correct?
&gt;&gt;&gt;&gt; Would I loose any of the raw power of Riak when going with Riak CS?
&gt;&gt;&gt;&gt; Anyone
&gt;&gt;&gt;&gt; ever tried this combo?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; Geert-Jan
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; View this message in context:
&gt;&gt;&gt;&gt; http://riak-users.197444.n3.nabble.com/combining-Riak-CS-and-Spark-shark-by-speaking-over-s3-protocol-tp4028621.html
&gt;&gt;&gt;&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; [hidden email] 
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; [hidden email] 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; ------------------------------
&gt; If you reply to this email, your message will be added to the discussion
&gt; below:
&gt;
&gt; http://riak-users.197444.n3.nabble.com/combining-Riak-CS-and-Spark-shark-by-speaking-over-s3-protocol-tp4028621p4028644.html
&gt; To unsubscribe from combining Riak (CS) and Spark/shark by speaking over
&gt; s3 protocol, click 
&gt; here
&gt; .
&gt; NAML
&gt;




--
View this message in context: 
http://riak-users.197444.n3.nabble.com/combining-Riak-CS-and-Spark-shark-by-speaking-over-s3-protocol-tp4028621p4028647.html
Sent from the Riak Users mailing list archive at Nabble.com.\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

