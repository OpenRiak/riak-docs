---
title: "RE: Timeout when storing"
description: ""
project: community
lastmod: 2011-09-29T21:53:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04938"
mailinglist_parent_id: "msg04932"
author_name: "Jim Adler"
project_section: "mailinglistitem"
sent_date: 2011-09-29T21:53:25-07:00
---


Thanks Sean. I added the ulimit -n 10240 to /etc/default/riak, restarted riak, 
but that didn't work. 

Fyodor Yarochkin suggested that the bitcask files could be corrupted, but I 
wasn't sure which bitcask \\*.data or \\*.hint file to delete. Any pointers?

Here's the /var/log/riak/erlang.log:

=ERROR REPORT==== 29-Sep-2011::20:27:42 ===
\\*\\* State machine &lt;0.369.0&gt; terminating 
\\*\\* Last event in was {riak\\_vnode\\_req\\_v1,
 941983477185933521498468739836666790012612771840,
 {fsm,undefined,&lt;0.27704.1&gt;},
 {riak\\_kv\\_put\\_req\\_v1,
 {&lt;&lt;"nodes"&gt;&gt;,&lt;&lt;"screen\\_name-psych\\_ic-info"&gt;&gt;},
 {r\\_object,&lt;&lt;"nodes"&gt;&gt;,&lt;&lt;"screen\\_name-psych\\_ic-info"&gt;&gt;,
 [{r\\_content,
 {dict,3,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 {{[],[],[],[],[],[],[],[],[],[],
 [[&lt;&lt;"content-type"&gt;&gt;,97,112,112,108,105,99,97,
 116,105,111,110,47,106,115,111,110],
 [&lt;&lt;"X-Riak-VTag"&gt;&gt;,49,90,120,65,84,100,56,99,48,
 80,86,99,111,122,71,79,108,90,70,97,53,87]],
 [],[],
 [[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|
 {1317,353201,695471}]],
 [],[]}}},
 &lt;&lt;"{DELETED DATA}"&gt;&gt;}],
 [{&lt;&lt;2,65,205,48&gt;&gt;,{1,63484572401}}],
 {dict,1,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
 [[clean|true]],
 []}}},
 undefined},
 1174401,63484572401,
 [{returnbody,true}]}}
\\*\\* When State == active
\\*\\* Data == {state,941983477185933521498468739836666790012612771840,
 riak\\_kv\\_vnode,
 
{state,941983477185933521498468739836666790012612771840, 
 riak\\_kv\\_bitcask\\_backend,
 {#Ref&lt;0.0.0.3952&gt;,
 
"/var/lib/riak/bitcask/941983477185933521498468739836666790012612771840"},
 {dict,0,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],
 [],[],[]},
 {{[],[],[],[],[],[],[],[],[],[],[],[],[],
 [],[],[]}}},
 false},
 undefined,none,60000}
\\*\\* Reason for termination = 
\\*\\* {{badmatch,{error,emfile}},
 [{bitcask\\_fileops,create\\_file\\_loop,3},
 {bitcask,put,3},
 {riak\\_kv\\_bitcask\\_backend,put,3},
 {riak\\_kv\\_vnode,perform\\_put,3},
 {riak\\_kv\\_vnode,do\\_put,7},
 {riak\\_kv\\_vnode,handle\\_command,3},
 {riak\\_core\\_vnode,vnode\\_command,3},
 {gen\\_fsm,handle\\_msg,7}]}



-----Original Message-----
From: Sean Cribbs [mailto:s...@basho.com]
Sent: Thu 9/29/2011 3:02 PM
To: Jim Adler
Cc: riak-users@lists.basho.com
Subject: Re: Timeout when storing
 
Your environment has too few file handles. Retry starting riak after
setting `ulimit -n 1024` in the shell. Also see our wiki page about this
issue: http://wiki.basho.com/Open-Files-Limit.html You may need to set this
limit specifically for the 'riak' user.

Cheers,

-- 
Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://www.basho.com/

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

