---
title: "Re: I can't show a pdf from webmachine"
description: ""
project: community
lastmod: 2012-12-14T13:01:17-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09584"
mailinglist_parent_id: "msg09582"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-12-14T13:01:17-08:00
---


Julio,

You can't just give it the filename, you need to read the file. Something
like this should work:

to\\_pdf(ReqData, Context) -&gt;
 {ok, Body} = file:read\\_file("/root/sicap-rpt/reports/javascript.pdf"),
 {Body, ReqData, Context}.

On Fri, Dec 14, 2012 at 1:47 PM, Julio Cesar RÃ­os Gutierrez &lt;
jctau...@gmail.com&gt; wrote:

&gt; My source do not show a pdf in my page everything else is fine,
&gt;
&gt; This is the source code:
&gt;
&gt; ==============================================================
&gt; -module(rptPedidos\\_resource).
&gt;
&gt; -export([init/1, allowed\\_methods/2, process\\_post/2]).
&gt; -export([content\\_types\\_provided/2]).
&gt; -export([to\\_json/2, json\\_body/1]).
&gt;
&gt; -include\\_lib("webmachine/include/webmachine.hrl").
&gt;
&gt; %%init([]) -&gt; {ok, undefined}.
&gt; init(Config)-&gt;
&gt; {{trace, "/tmp"}, Config}.
&gt;
&gt; allowed\\_methods ( RD, Ctx )-&gt;
&gt; {['POST','GET','HEAD'], RD, Ctx}.
&gt;
&gt; %%content\\_types\\_provided ( RD, Ctx )-&gt;
&gt; %% {[{"application/json",to\\_json}],RD,Ctx}.
&gt;
&gt; content\\_types\\_provided ( RD, Ctx )-&gt;
&gt; {[{"application/pdf",to\\_pdf}], RD, Ctx }.
&gt;
&gt; to\\_pdf(ReqData, Context)-&gt;
&gt; Body = "/root/sicap-rpt/reports/javascript.pdf",
&gt; {Body, ReqData, Context}.
&gt;
&gt; to\\_json ( RD, Ctx )-&gt;
&gt; {json\\_body (wrq:req\\_qs(RD)), RD, Ctx}.
&gt;
&gt; process\\_post ( RD, Ctx )-&gt;
&gt; Data = mochiweb\\_util:parse\\_qs ( wrq:req\\_body ( RD ) ),
&gt; Struct = mochijson2:decode ( proplists:get\\_value ( "json", Data ) ),
&gt; Struct2 = proplists:get\\_value ( "json", Data ),
&gt; {struct, [{&lt;&lt;"nombre"&gt;&gt;, Nombre }]} = Struct,
&gt; RD1 = wrq:set\\_resp\\_header("Content-Type","application/pdf", RD ),
&gt; Ans = "attachment;filename=/root/sicap-rpt/reports/javascript.pdf",
&gt; RD2 = wrq:append\\_to\\_resp\\_body ( Ans, RD1 ),
&gt; {true, RD2,Ctx}.
&gt;
&gt; json\\_body ( QS )-&gt;
&gt; mochijson:encode ( { struct, QS } ).
&gt;
&gt;
&gt; ===============================================================
&gt;
&gt; any ideas why is wrong?
&gt;
&gt; --
&gt; JCesar
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

