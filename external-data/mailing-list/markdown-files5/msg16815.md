---
title: "Re: Unable to create anonymous user"
description: ""
project: community
lastmod: 2015-11-25T08:56:49-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16815"
mailinglist_parent_id: "msg16818"
author_name: "Dmitri Zagidulin"
project_section: "mailinglistitem"
sent_date: 2015-11-25T08:56:49-08:00
---


Ben,

Not sure what to advise. Your configs look ok.
I just downloaded a fresh copy of Riak CS 2.0.1, Stanchion, and a fresh
Riak 2.
I set up the configs just as you have (changing only the paths in
advanced.config to match my machine).
Cutting and pasting your curl line seems to result in correct user creation.
So, the dreaded "Works For Me (tm)".

The only thing I can think of is - double and triple-check all involved
firewalls.
Searching about for that error message let me to this thread:
http://riak-users.197444.n3.nabble.com/adding-auth-user-not-valid-td4033452.html

Which indicates that the error message can be caused by CS not being able
to access Stanchion. You mentioned that you can telnet into stanchion\\_host
from the riak node. Is Stanchion set to listen to the correct IP and port?

Dmitri







On Wed, Nov 25, 2015 at 10:16 AM, Ben Rudolph  wrote:

&gt; Thanks for the response Dmitri. Just double checked all those settings
&gt;
&gt; 1) I checked with stanchion ping and i'm also able to telnet into the
&gt; stanchion\\_host from the riak node
&gt; 2)Double checked and it shows up in the logs:
&gt; &lt;0.142.0&gt;@riak\\_cs\\_config:warnings:120 `anonymous\\_user\\_creation` is set as
&gt; true. Set this as false when this CS nodes is populated as public service.
&gt; 3) Yes
&gt; 4) Yes
&gt;
&gt; In case useful, here are our configs:
&gt; https://github.com/dimagi/commcarehq-ansible/tree/riak/ansible/roles/riakcs/templates
&gt;
&gt; On Wed, Nov 25, 2015 at 10:04 AM, Dmitri Zagidulin 
&gt; wrote:
&gt;
&gt;&gt; Hi Ben,
&gt;&gt;
&gt;&gt; Just to double-check:
&gt;&gt; 1) is Stanchion installed and running, when you try to create the user?
&gt;&gt; (and the stanchion\\_host entry is pointing to it, in cs config?)
&gt;&gt;
&gt;&gt; 2) is anonymous\\_user\\_creation = on in the config file?
&gt;&gt;
&gt;&gt; 3) do you have 'buckets.default.allow\\_mult = true' in the Riak config
&gt;&gt; file?
&gt;&gt;
&gt;&gt; 4) (this is likely to be yes, but just to check) Have you restarted Riak
&gt;&gt; since configuring the advanced.config backend?
&gt;&gt;
&gt;&gt; Dmitri
&gt;&gt;
&gt;&gt; On Tue, Nov 24, 2015 at 6:40 PM, Ben Rudolph  wrote:
&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I've almost completed the cluster setup but am running into issues with
&gt;&gt;&gt; anonymous user creation. All machines ping/pong and their IPs are matching.
&gt;&gt;&gt; When I run the curl command to create an anonymous user:
&gt;&gt;&gt;
&gt;&gt;&gt; curl -H 'Content-Type: application/json' -XPOST http://\\*\\*:8080/riak-cs/user
&gt;&gt;&gt; --data '{"email":"em...@email.com", "name":"admin\\_user"}'
&gt;&gt;&gt;
&gt;&gt;&gt; And I get an XML response that says Internal Server Error. The
&gt;&gt;&gt; console.log file looks like this:
&gt;&gt;&gt;
&gt;&gt;&gt; 2015-11-24 23:16:35.572 [error] &lt;0.439.0&gt; Webmachine error at path
&gt;&gt;&gt; "/riak-cs/user" :
&gt;&gt;&gt; {error,{error,{badmatch,{error,malformed\\_xml}},[{riak\\_cs\\_s3\\_response,xml\\_error\\_code,1,[{file,"src/riak\\_cs\\_s3\\_response.erl"},{line,335}]},{riak\\_cs\\_s3\\_response,error\\_response,1,[{file,"src/riak\\_cs\\_s3\\_response.erl"},{line,249}]},{riak\\_cs\\_wm\\_user,accept\\_json,2,[{file,"src/riak\\_cs\\_wm\\_user.erl"},{line,119}]},{webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_resource.erl"},{line,186}]},{webmachine\\_resource,do,3,[{file,"src/webmachine\\_resource.erl"},{line,142}]},{webmachine\\_decision\\_core,resource\\_call,...},...]}}
&gt;&gt;&gt; in riak\\_cs\\_s3\\_response:xml\\_error\\_code/1 line 335
&gt;&gt;&gt;
&gt;&gt;&gt; Which led me to this issue here
&gt;&gt;&gt; . However my
&gt;&gt;&gt; advanced.config already looks like this (which is what is suggested in the
&gt;&gt;&gt; issue):
&gt;&gt;&gt; [
&gt;&gt;&gt; {riak\\_kv, [
&gt;&gt;&gt; {add\\_paths, ["/usr/lib/riak-cs/lib/riak\\_cs-2.0.1/ebin"]},
&gt;&gt;&gt; {storage\\_backend, riak\\_cs\\_kv\\_multi\\_backend},
&gt;&gt;&gt; {multi\\_backend\\_prefix\\_list, [{&lt;&lt;"0b:"&gt;&gt;, be\\_blocks}]},
&gt;&gt;&gt; {multi\\_backend\\_default, be\\_default},
&gt;&gt;&gt; {multi\\_backend, [
&gt;&gt;&gt; {be\\_default, riak\\_kv\\_eleveldb\\_backend, [
&gt;&gt;&gt; {total\\_leveldb\\_mem\\_percent, 30},
&gt;&gt;&gt; {data\\_root, "/opt/data/riak/leveldb"}
&gt;&gt;&gt; ]},
&gt;&gt;&gt; {be\\_blocks, riak\\_kv\\_bitcask\\_backend, [
&gt;&gt;&gt; {data\\_root, "/opt/data/riak/bitcask"}
&gt;&gt;&gt; ]}
&gt;&gt;&gt; ]}
&gt;&gt;&gt; ]}
&gt;&gt;&gt; ].
&gt;&gt;&gt;
&gt;&gt;&gt; Any insight would be useful!
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Ben
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

