---
title: "Re: Riak Search. Indexing special chars. Internal Server Error."
description: ""
project: community
lastmod: 2012-08-20T07:43:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08327"
mailinglist_parent_id: "msg08325"
author_name: "Vladimir Shapovalov"
project_section: "mailinglistitem"
sent_date: 2012-08-20T07:43:11-07:00
---


Hi Ryan,

I'm using ver. 1.2.0 too. It happens only on bucket with indexing enabled.
I think it depends on the Analyzer factory.
My index schema was:
...
 {dynamic\\_field, [
 {name, "\\*"},
 {type, string},
 {analyzer\\_factory, {erlang, text\\_analyzers, \\*
whitespace\\_analyzer\\_factory\\*}}
 ]}
...

Since I've changed the default factory from
whitespace\\_analyzer\\_factory to standard\\_analyzer\\_factory
it seems to work.
My current index schema is:
...
 {dynamic\\_field, [
 {name, "\\*"},
 {type, string},
 {analyzer\\_factory, {erlang, text\\_analyzers, \\*
standard\\_analyzer\\_factory\\*}}
 ]}
...

It looks like the whitespace\\_analyzer\\_factory has some differences compare
to standard\\_analyzer\\_factory.

Thanks
Vladimir

On Mon, Aug 20, 2012 at 3:50 PM, Ryan Zezeski  wrote:

&gt;
&gt; On Mon, Aug 20, 2012 at 6:24 AM, Vladimir Shapovalov  &gt; wrote:
&gt;
&gt;&gt; Hi all,
&gt;&gt;
&gt;&gt; I'm trying to put some data in a bucket, witch has indexing enabled.
&gt;&gt; One key value has a special char ß (geman 
&gt;&gt; S-sharp).
&gt;&gt; It is UTF-8 encoded.
&gt;&gt;
&gt;&gt; The errror message i get:
&gt;&gt;
&gt;&gt; ---------------------------------------------------------------------------------------------
&gt;&gt;
&gt;&gt; Internal Server ErrorThe server encountered an error while processing this 
&gt;&gt; request:
&gt;&gt;
&gt;&gt; {error,
&gt;&gt; {error,badarg,
&gt;&gt; [{erlang,iolist\\_to\\_binary,
&gt;&gt; [{hook\\_crashed,
&gt;&gt; {riak\\_search\\_kv\\_hook,precommit,error,function\\_clause}}]},
&gt;&gt; {wrq,append\\_to\\_response\\_body,2},
&gt;&gt; {riak\\_kv\\_wm\\_object,handle\\_common\\_error,3},
&gt;&gt; {webmachine\\_resource,resource\\_call,3},
&gt;&gt; {webmachine\\_resource,do,3},
&gt;&gt; {webmachine\\_decision\\_core,resource\\_call,1},
&gt;&gt; {webmachine\\_decision\\_core,accept\\_helper,0},
&gt;&gt; {webmachine\\_decision\\_core,decision,1}]}}
&gt;&gt;
&gt;&gt; ------------------------------
&gt;&gt; mochiweb+webmachine web server
&gt;&gt;
&gt;&gt;
&gt;&gt; ---------------------------------------------------------------------------------------------
&gt;&gt;
&gt;&gt; Could anyone tell me please, how to store data special chars included 
&gt;&gt; correctly?
&gt;&gt;
&gt;&gt; How to deal with non ASCII chars in Riak, say coming from Russian or German 
&gt;&gt; languages?
&gt;&gt;
&gt;&gt; And why it causes riak\\_search\\_kv\\_hook to crash?
&gt;&gt;
&gt;&gt;
&gt;&gt; Thanks in Advance!
&gt;&gt;
&gt;&gt; Vladimir
&gt;&gt;
&gt;&gt;
&gt; Valdimir,
&gt;
&gt; I tried different combinations of things to reproduce your error: key
&gt; containing ß, bucket containing ß, plain text value with ß, JSON with ß,
&gt; etc. Everything worked fine for me and I got the expected number of
&gt; results.
&gt;
&gt; However, I tested on master (essentially version 1.2.0). What version of
&gt; Riak are you using?
&gt;
&gt; -Z
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

