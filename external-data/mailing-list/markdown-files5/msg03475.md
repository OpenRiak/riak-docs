---
title: "Re: Store whole database in memory"
description: ""
project: community
lastmod: 2011-05-28T11:36:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03475"
mailinglist_parent_id: "msg03474"
author_name: "Greg Nelson"
project_section: "mailinglistitem"
sent_date: 2011-05-28T11:36:23-07:00
---


Depending on the n\\_val you have set for that bucket, Riak will store the 
objects n times on n different nodes. There are two other parameters you should 
know about, r and w. When writing, Riak will wait for w of the n nodes to 
finish the write before returning. When reading, Riak will wait for r of the n 
nodes to respond before returning. This is the basics of how Riak does fault 
and partition tolerance, i.e. if one node is down your cluster still functions, 
and the r and w vals define a sort of "majority vote" threshold to handle a 
split-brain problem.

Anyway, for your purposes you could set w=1 and r=3 for faster writes at the 
expense of potentially slower reads. I've never tried this (or any of the 
backends besides bitcask) so I don't know what you should expect.

As for bulk insert and preserving locality, I don't know of a way to do that 
with Riak except to batch your 1000 keys into a single object, identified by 
one key. As far as Riak is concerned, it's just a 12KB opaque object, which 
your application would need to always write and read all at once.

If you don't batch like that, you should look for a discussion on this mailing 
list from last week regarding capacity planning and very small objects. There's 
a bit of overhead associated with each object that will be significant for 
objects as small as 12 bytes. You could skip over the parts about Bitcask 
overhead...

On Saturday, May 28, 2011 at 9:59 AM, Michael McClain wrote:

&gt; Thank you, Mike and Greg, for the response.
&gt; I've just replied to the list.
&gt; In my use case, I need to be able to write 100,000 keys per second. Where the 
&gt; key is very small (12 bytes). And I always insert 1000 keys at once, in a 
&gt; bulk insert. I would also like to preserve the locality of the keys inserted 
&gt; at once (so that they stay always in the same node). Do you know if that is 
&gt; possible?
&gt; 
&gt; Thank you
&gt; 
&gt; 2011/5/28 Mike Oxford 
&gt; &gt; With enough RAM you could just have it keep the whole thing in 
&gt; &gt; disk-cache...
&gt; &gt; 
&gt; &gt; -mox
&gt; &gt; 
&gt; &gt; 
&gt; &gt; On Fri, May 27, 2011 at 11:11 PM, Greg Nelson  &gt; (mailto:gro...@dropcam.com)&gt; wrote:
&gt; &gt; &gt; Michael,
&gt; &gt; &gt; 
&gt; &gt; &gt; You might want to check out riak\\_kv\\_ets\\_backend, 
&gt; &gt; &gt; riak\\_kv\\_gb\\_trees\\_backend, and riak\\_kv\\_cache\\_backend.
&gt; &gt; &gt; 
&gt; &gt; &gt; http://wiki.basho.com/Configuration-Files.html
&gt; &gt; &gt; 
&gt; &gt; &gt; -Greg
&gt; &gt; &gt; 
&gt; &gt; &gt; On Friday, May 27, 2011 at 10:35 PM, Michael McClain wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Hi,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Is it possible to store the whole database in memory?
&gt; &gt; &gt; &gt; In a similar way as Redis does.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I'm really interested in the distributed map reduce done by riak 
&gt; &gt; &gt; &gt; ("bring processing to the data, instead of data to processors), but I 
&gt; &gt; &gt; &gt; need faster writes/reads that a memory-only database could provide.
&gt; &gt; &gt; &gt; In case you don't support memory-only storage (no disk touched / all 
&gt; &gt; &gt; &gt; keys and data fitting the memory in all nodes) yet, do you plan on 
&gt; &gt; &gt; &gt; implementing it?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Thank you,
&gt; &gt; &gt; &gt; Michael
&gt; &gt; &gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; &gt; 
&gt; &gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

