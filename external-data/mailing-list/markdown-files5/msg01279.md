---
title: "Re: Some questions about Riak Search and Riak itself"
description: ""
project: community
lastmod: 2010-10-13T18:18:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01279"
mailinglist_parent_id: "msg01267"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2010-10-13T18:18:06-07:00
---


2010/10/13 Dmitry Demeshchuk :
&gt; I worked it out. Both shell and command-line search work good. Seems
&gt; like I've been doing something wrong before.

Excellent - good to hear.

&gt;&gt;&gt; 4. Do you have any tips and advice about working with Unicode in Riak 
&gt;&gt;&gt; Search?
&gt;&gt;
&gt;&gt; Encode everything in UTF-8. There may still be a few bugs we need to
&gt;&gt; work out, but our intended goal is to have everything in that
&gt;&gt; department "just work" once you're using UTF-8 everywhere.
&gt;
&gt; I'm not sure if I do everything right but here's the step-by step
&gt; description of my actions:
&gt;
&gt; 1. curl -v -d "{\\"title\\":\\"Статья 1\\", \\"tags\\":\\"псто, лытдыбр\\",
&gt; \\"body\\":\\"Я что-то здесь написал\\"}" -H "Content-Type:
&gt; application/json" http://127.0.0.1:8098/riak/posts
&gt;
&gt; (Note, there are cyrillic symbols)
&gt;
...snip...
&gt;
&gt; 3. curl -X POST -H "content-type: application/json"
&gt; http://localhost:8098/mapred -d '{"inputs":{"module":"riak\\_search",
&gt; "function":"mapred\\_search", "arg": ["posts", "title:Статья\\*"]},
&gt; "query":[{"map":{"language":"javascript","source":"Riak.mapValues",
&gt; "keep":true}}]}'
&gt;
...snip...
&gt;
&gt; Am I doing something wrong? Should I encode characters somehow before
&gt; I send them into RiakSearch?

Thanks for the excellent test case - very easy to reproduce. I
apologize for my delay in responding, but I wanted to make sure I had
all of my ducks in a row first.

So, no, you're doing nothing wrong. The default, Erlang-based
analyzer is, in fact, just ignoring non-ascii characters. I've
created an issue to track the fix to that analyzer here:

 https://issues.basho.com/show\\_bug.cgi?id=814

In the meantime, the easiest way to fix this issue is to use the
Java-based "DefaultAnalyzerFactory", which handles non-ascii
characters correctly (in my tests, at least; I look forward to yours).
 To use this analyzer, edit your schema file, and add the following
line to the first list in the schema:

 {analyzer\\_factory, "com.basho.search.analysis.DefaultAnalyzerFactory"}

(The example schemas on the wiki and in doc/using\\_search.org
demonstrate the proper placement of this line). After editing, use
the bin/search-cmd script to update the schema:

 $RIAK/bin/seach-cmd set\\_schema posts /path/to/your/schema.def

Riak Search should reindex any documents you have stored using the new
analyzer. Try your map/reduce query again, and I think you'll find it
working.

-Bryan

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

