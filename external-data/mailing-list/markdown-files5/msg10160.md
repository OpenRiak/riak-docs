---
title: "Re: 2i: url encoding/decoding of index names/values"
description: ""
project: community
lastmod: 2013-02-20T13:46:28-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10160"
mailinglist_parent_id: "msg10158"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-02-20T13:46:28-08:00
---


Hi Age,

One thing to consider is that Riak allows a secondary index to have multiple 
values. I can e.g. create an object with two values for a integer secondary 
index as follows:

 curl -X PUT -H "Content-Type: text/plain" -H 'x-riak-index-idx\\_int: 12' 
-H 'x-riak-index-idx\\_int: 13' -d 'data' 
http://localhost:8098/buckets/testbucket/keys/key2

When this object is retrieved, the secondary index with the two values will/may 
be presented in a single header containing a comma and a space to separate the 
values as follows:

 curl -v -X HEAD http://localhost:8098/buckets/testbucket/keys/key2
 &lt; HTTP/1.1 200 OK
 &lt; X-Riak-Vclock: a85hYGBgzGDKBVIcEQaWHIFK0u0ZTImMeawMRntnnuLLAgA=
 &lt; x-riak-index-idx\\_int: 12, 13
 &lt; Vary: Accept-Encoding
 &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
 &lt; Link: ; rel="up"
 &lt; Last-Modified: Wed, 20 Feb 2013 21:33:38 GMT
 &lt; ETag: "3Wz7RJnOL4ofIeX1hYDr84"
 &lt; Date: Wed, 20 Feb 2013 21:40:30 GMT
 &lt; Content-Type: text/plain
 &lt; Content-Length: 4

Best regards,

Christian


On 20 Feb 2013, at 20:56, Age Mooij  wrote:

&gt; Hi all,
&gt; 
&gt; I'm writing a new Scala (http) client library for Riak [1] and I ran into 
&gt; some trouble with special characters while implementing 2i. 
&gt; 
&gt; Reading through the docs, all the 2i examples are for simple one-word index 
&gt; names but I have not been able to find any rules about index names and values 
&gt; containing spaces, commas, and other special characters and how the HTTP api 
&gt; deals with encoding and decoding these?
&gt; 
&gt; My unit tests use the following troublesome corner cases:
&gt; 
&gt; - index values containing spaces
&gt; - index names containing spaces
&gt; - index values containing commas
&gt; 
&gt; I tried a number of approaches and none of them work for all three:
&gt; 
&gt; 1) Don't encode the index names or the values when creating "x-riak-index-" 
&gt; http headers but encode both the name and the value in the URL used to fetch 
&gt; by an index
&gt; 
&gt; This works fine for values containing spaces but creates illegal headers for 
&gt; index names containing spaces and breaks for values containing commas (the 
&gt; values get split into two).
&gt; 
&gt; 2) Encode everything
&gt; 
&gt; This creates valid headers and storing index values containing commas now 
&gt; works fine. The only trouble is that index fetching fails whenever there are 
&gt; spaces, commas or other encoded characters involved.
&gt; 
&gt; Could anyone enlighten me about the correct way to deal with these cases?
&gt; 
&gt; Regards,
&gt; Age
&gt; 
&gt; 
&gt; [1] https://github.com/agemooij/riak-scala-client
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

