---
title: "Re: Deciphering Key Filter Errors"
description: ""
project: community
lastmod: 2011-03-03T12:32:18-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02553"
mailinglist_parent_id: "msg02551"
author_name: "Jason J. W. Williams"
project_section: "mailinglistitem"
sent_date: 2011-03-03T12:32:18-08:00
---


...btw I've found with the key filter, I have to supply a JavaScript
map function if I want to use a JS reduce function. If I use just a JS
reduce function I get bad\\_json errors. However, my understanding is
that supplying a map function makes Riak load the key data, where as
supplying just a reduce function won't do that. So I'm in a bit of a
conundrum about how to preformat the output without issuing a map,
since the formatting I want to do is splitting the key name. Thank you
for your help.

-J

On Thu, Mar 3, 2011 at 1:26 PM, Dan Reverri  wrote:
&gt; A bug has already been filed for this issue:
&gt; https://issues.basho.com/show\\_bug.cgi?id=1002
&gt; Thanks,
&gt; Dan
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Thu, Mar 3, 2011 at 12:19 PM, Dan Reverri  wrote:
&gt;&gt;
&gt;&gt; Hi Jason,
&gt;&gt; I'm able to reproduce the issue when the keys I am filtering do not
&gt;&gt; contain the token. For example, if my token is "-" and my key is
&gt;&gt; "helloworld" the tokens for that key become:
&gt;&gt; ["helloworld"]
&gt;&gt; Grabbing the second element of that list returns an error:
&gt;&gt; 3&gt; string:tokens("helloworld", "-").
&gt;&gt; ["helloworld"]
&gt;&gt; 4&gt; lists:nth(2, ["helloworld"]).
&gt;&gt; \\*\\* exception error: no function clause matching lists:nth(1,[])
&gt;&gt; It seems Riak should catch errors during the filtering process and discard
&gt;&gt; keys that cause errors. I will file a bug.
&gt;&gt; Thanks,
&gt;&gt; Dan
&gt;&gt; Daniel Reverri
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Mar 3, 2011 at 10:28 AM, Jason J. W. Williams
&gt;&gt;  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; If someone could help me understand just this error, that would help a
&gt;&gt;&gt; lot: https://gist.github.com/852450
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you in advance.
&gt;&gt;&gt;
&gt;&gt;&gt; -J
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Mar 2, 2011 at 11:55 PM, Jason J. W. Williams
&gt;&gt;&gt;  wrote:
&gt;&gt;&gt; &gt; Hi,
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; I'm experimenting using key filters to implement indexes. My approach
&gt;&gt;&gt; &gt; is for each data key in bucket A, to create a new empty key in a
&gt;&gt;&gt; &gt; dedicated index bucket where the original key name and value of the
&gt;&gt;&gt; &gt; indexed field is encoded in the key name for a new index key.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Data key looks like this:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Bucket - riak\\_perf\\_test
&gt;&gt;&gt; &gt; Key - ccode\\_ : {"redeemed\\_count": 23 }
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; For each data key created, an index key is created:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Bucket - idx=redeemed\\_count=ccode
&gt;&gt;&gt; &gt; Key - ccode/23
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; (in both keys 23 changes on a per-key basis based on what
&gt;&gt;&gt; &gt; "redeemed\\_count" is set to)
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; My goal is to be able to do a key filtered Map Reduce job on
&gt;&gt;&gt; &gt; idx=redeemed\\_count=ccode that generates a list of all data key names
&gt;&gt;&gt; &gt; with a redeemed\\_count &lt; 50.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; The job (using curl) is here: https://gist.github.com/852451
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; It errors out almost immediately in sasl-error.log
&gt;&gt;&gt; &gt; (https://gist.github.com/852450), but the request doesn't immediately
&gt;&gt;&gt; &gt; error out to the client. The only error the client sees is an eventual
&gt;&gt;&gt; &gt; timeout error.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; So my question is, what is the error in sasl-error.log telling me is
&gt;&gt;&gt; &gt; wrong with my job construction? And also, why is there only a timeout
&gt;&gt;&gt; &gt; error generated to the client instead of a map\\_reduce\\_error as I've
&gt;&gt;&gt; &gt; seen for non-key filtered jobs?
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Thank you in advance for any help. I greatly appreciate it.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; -J
&gt;&gt;&gt; &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

