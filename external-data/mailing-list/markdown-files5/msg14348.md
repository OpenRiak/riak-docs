---
title: "Re: About Protocol Buffers"
description: ""
project: community
lastmod: 2014-06-23T07:39:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14348"
mailinglist_parent_id: "msg14347"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2014-06-23T07:39:26-07:00
---


Hi Alex,

By default, the client assumes new objects use JSON as the encoding. The
protocol buffers are only used on the wire to encode Riak's protocol. If
you want to use your own protobuffs messages, I suggest two things:

1. Decide on a `content\\_type` property for each of your data types and be
sure to assign that to each key as you create it. I've used
'application/pb-person' as an example below.
2. Register encoder and decoder functions [1] on the RiakClient object,
like so:

client.set\\_decoder('application/pb-person', Person.ParseFromString)
client.set\\_encoder('application/pb-person', lambda x: x.SerializeToString())

[1]
http://riak-python-client.readthedocs.org/en/latest/client.html#serialization

Cheers,


On Mon, Jun 23, 2014 at 9:19 AM, Alex De la rosa 
wrote:

&gt; Hi there,
&gt;
&gt; I just installed RIAK 2.0 beta 1 and was playing with the Python library
&gt; using 'pbc' (Protocol Buffers).
&gt;
&gt; test.py
&gt;
&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt; import riak
&gt; client = riak.RiakClient(host ='127.0.0.1', http\\_port = 8098, pb\\_port =
&gt; 8087, protocol = 'pbc')
&gt; bucket = client.bucket('people')
&gt;
&gt; key = bucket.new('alex', data={"username":"Alex","age":33})
&gt; key.store()
&gt;
&gt; print bucket.get('alex').encoded\\_data
&gt;
&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;
&gt; it works perfectly and it prints {"username": "Alex", "age": 33} as it
&gt; should print.
&gt;
&gt; However, I'm not using a proto file (person.proto) and compiling it into
&gt; binary for Python to use it... something like:
&gt;
&gt; person.proto
&gt;
&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt; message Person {
&gt; required string username = 1;
&gt; required int32 age = 2;
&gt; }
&gt;
&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;
&gt; xxx.py
&gt;
&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt; import person\\_pb2
&gt; person = person\\_pb2.Person()
&gt; person.username = "Alex"
&gt; person.age = 33
&gt; data = person.SerializeToString()
&gt;
&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;
&gt; Am I using the 'pbc' interface wrong? however, on Riak's examples page is
&gt; done also without the "proto" file... I'm a bit confused at the moment as
&gt; it changed the way I normally would use Protocol Buffers.
&gt;
&gt; Thanks,
&gt; Alex
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

