---
title: "Re: riak indexing/search issue with json"
description: ""
project: community
lastmod: 2010-12-31T00:10:32-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01864"
mailinglist_parent_id: "msg01863"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-12-31T00:10:32-08:00
---


Hi Joseph,

Are these results consistently reproducible? Can you provide the full
queries you are using?

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Thu, Dec 30, 2010 at 11:46 PM, Joseph Lambert  wrote:

&gt; Hello,
&gt;
&gt; I'm having a bit of a problem with k/v indexing and json objects in Riak
&gt; Search 0.13.0. I have JSON objects of this format:
&gt;
&gt; {
&gt; "id" : 1,
&gt; "users" : [1559620, 2619082],
&gt; "userData" : {
&gt; "viewedBy1559620" : {
&gt; "isDeleted" : "false"
&gt; }
&gt; "viewedBy2619082" : {
&gt; "isDeleted" : "false"
&gt; }
&gt; }
&gt; }
&gt;
&gt; My indexing schema is (also have tried with DefaulAnalyzerFactory):
&gt;
&gt; {
&gt; schema,
&gt; [
&gt; {version, "0.0.3"},
&gt; {default\\_field, "id"},
&gt; {default\\_op, "and"},
&gt; {n\\_val, 2},
&gt; {analyzer\\_factory,
&gt; "com.basho.search.analysis.WhitespaceAnalyzerFactory"}
&gt; ],
&gt; [
&gt; {field, [
&gt; {name, "id"},
&gt; {type, integer}
&gt; ]},
&gt; {field, [
&gt; {name, "users"},
&gt; {type, integer}
&gt; ]},
&gt; {dynamic\\_field, [
&gt; {name, "userData\\*isDeleted"},
&gt; {type, string}
&gt; ]},
&gt; {dynamic\\_field, [
&gt; {name, "\\*"},
&gt; {required, false},
&gt; {skip, true}
&gt; ]}
&gt; ]
&gt; }.
&gt;
&gt;
&gt; The appropriate fields are extracted by the extractor and this is the index
&gt; created by both factories:
&gt;
&gt; {riak\\_idx\\_doc,&lt;&lt;"test"&gt;&gt;,
&gt; &lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,
&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,
&gt; [{&lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,[0]}]},
&gt; {&lt;&lt;"userData\\_viewedBy1559620\\_isDeleted"&gt;&gt;,&lt;&lt;"false"&gt;&gt;,
&gt; [{&lt;&lt;"false"&gt;&gt;,[0]}]},
&gt; {&lt;&lt;"userData\\_viewedBy2619082\\_isDeleted"&gt;&gt;,&lt;&lt;"false"&gt;&gt;,
&gt; [{&lt;&lt;"false"&gt;&gt;,[0]}]},
&gt; {&lt;&lt;"users"&gt;&gt;,&lt;&lt;"1559620 2619082"&gt;&gt;,
&gt; [{&lt;&lt;"0002619082"&gt;&gt;,[1]},{&lt;&lt;"0001559620"&gt;&gt;,[0]}]}],
&gt; [],[],true}
&gt;
&gt; The problem comes when I am searching. If I run the following searches
&gt; 1.) users:0001559620
&gt; 2.) users:0002619082
&gt; 3.) userData\\_viewedBy1559620\\_isDeleted:false
&gt; 4.) userData\\_viewedBy2619082\\_isDeleted:false
&gt;
&gt; I get these results:
&gt;
&gt; using search:search from the riak console:
&gt; 1.) works
&gt; 2.) works
&gt; 3.) does not work
&gt; 4.) works
&gt;
&gt; The same queries from http using the solr interface (properly url encoded,
&gt; I swear):
&gt; 1.) does not work
&gt; 2.) works
&gt; 3.) does not work
&gt; 4.) does not work
&gt;
&gt; Now, from the interactive shell:
&gt; 1.) does not work
&gt; 2.) works
&gt; 3.) works
&gt; 4.) does not work
&gt;
&gt;
&gt; Can anyone help explain to me where I am going wrong?
&gt;
&gt; - Joe Lambert
&gt;
&gt; joseph.g.lamb...@gmail.com
&gt; +86 13656213284
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

