---
title: "Re: No more disk space on a node of my Riak cluster"
description: ""
project: community
lastmod: 2013-03-21T12:35:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10547"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2013-03-21T12:35:26-07:00
---


busy\\_dist\\_ports usually means that you're trying to push too much data
over your connections, but there are also other things that can
trigger it.

you can tune the amount of buffer that distributed erlang provides by adding
+zdbbl 

where  is the buffer size \\*in KB\\* \\*per other node in the
cluster\\*. the default is 1024 (i.e. one megabyte), but raising it to
8 or 16MB is often called for in busy clusters. If that doesn't help,
you may be affected by one of the other issues that I mentioned. That
said, I am not sure that this will help handoff, as it does not go
over distributed erlang.



On Thu, Mar 21, 2013 at 12:22 PM, Godefroy de Compreignac
 wrote:
&gt; Ok thanks Evan.
&gt; I didn't post them before on this thread because I thought it was just
&gt; "info", but I have a lot of messages like these:
&gt;
&gt; 2013-03-21 20:13:23.945 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.29558.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
&gt; 2013-03-21 20:13:26.295 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.29046.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.21529382&gt;,'riak@5.39.74.57'}
&gt; 2013-03-21 20:13:27.807 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.29046.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{erlang,crc32,2}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.21529382&gt;,'riak@5.39.74.57'}
&gt; 2013-03-21 20:13:27.843 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.21168.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.6629407&gt;,'riak@5.39.74.55'}
&gt; 2013-03-21 20:13:30.626 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.29558.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.6629407&gt;,'riak@5.39.74.55'}
&gt; 2013-03-21 20:13:30.771 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.24361.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
&gt; 2013-03-21 20:13:34.447 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.29558.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
&gt; 2013-03-21 20:13:36.210 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.6726.946&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.4656154&gt;,'riak@5.135.137.208'}
&gt; 2013-03-21 20:13:36.501 [info]
&gt; &lt;0.12276.176&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor
&gt; busy\\_dist\\_port &lt;0.32186.176&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.6629407&gt;,'riak@5.39.74.55'}
&gt;
&gt; I guess I have a problem with my network config...
&gt;
&gt; I precise that the servers hosting my Riak cluster are also running
&gt; Couchebase, Nginx and Elasticsearch, so a lot of trafic and connections.
&gt; /proc/sys/net/netfilter/nf\\_conntrack\\_count = 30-100K
&gt;
&gt;
&gt;
&gt; --
&gt; Godefroy de Compreignac
&gt;
&gt; Eklaweb CEO - www.eklaweb.com
&gt; EklaBlog CEO - www.eklablog.com
&gt;
&gt; +33(0)6 11 89 13 84
&gt; http://www.linkedin.com/in/godefroy
&gt; http://twitter.com/Godefroy
&gt;
&gt;
&gt; 2013/3/21 Evan Vigil-McClanahan 
&gt;&gt;
&gt;&gt; It could be a large number of things, unfortunately. To go through
&gt;&gt; them all it somewhat outside of my skill set. Maybe someone more
&gt;&gt; network savvy can provide some pointers?
&gt;&gt;
&gt;&gt; Perhaps checking with your network admin, or turning any software
&gt;&gt; firewalls on your nodes completely off, as a test?
&gt;&gt;
&gt;&gt; On Thu, Mar 21, 2013 at 11:44 AM, Godefroy de Compreignac
&gt;&gt;  wrote:
&gt;&gt; &gt; But I don't understand what could stop transfers. Maybe a kernel
&gt;&gt; &gt; setting?
&gt;&gt; &gt; How could I find out?
&gt;&gt; &gt;
&gt;&gt; &gt; --
&gt;&gt; &gt; Godefroy de Compreignac
&gt;&gt; &gt;
&gt;&gt; &gt; Eklaweb CEO - www.eklaweb.com
&gt;&gt; &gt; EklaBlog CEO - www.eklablog.com
&gt;&gt; &gt;
&gt;&gt; &gt; +33(0)6 11 89 13 84
&gt;&gt; &gt; http://www.linkedin.com/in/godefroy
&gt;&gt; &gt; http://twitter.com/Godefroy
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; 2013/3/21 Evan Vigil-McClanahan 
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Handoff is done by default on port 8099.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; I guess what I am getting at here is that this doesn't look like an
&gt;&gt; &gt;&gt; obvious riak problem, it's more likely that something on your network
&gt;&gt; &gt;&gt; or on your nodes is closing or interrupting those sockets; you'd most
&gt;&gt; &gt;&gt; likely get a different error if something internal to riak was causing
&gt;&gt; &gt;&gt; the transfers to fail.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On Thu, Mar 21, 2013 at 10:09 AM, Godefroy de Compreignac
&gt;&gt; &gt;&gt;  wrote:
&gt;&gt; &gt;&gt; &gt; The only limitation that I'd see is Haproy which have a time limit:
&gt;&gt; &gt;&gt; &gt; contimeout 5000
&gt;&gt; &gt;&gt; &gt; clitimeout 50000
&gt;&gt; &gt;&gt; &gt; srvtimeout 3600000
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; But Haproxy serves Riak on port 8098 and I configured Riak to use
&gt;&gt; &gt;&gt; &gt; port
&gt;&gt; &gt;&gt; &gt; 8097:
&gt;&gt; &gt;&gt; &gt; {pb\\_port, 8087 }
&gt;&gt; &gt;&gt; &gt; {http, [ {"5.39.68.152", 8097 } ]}
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; So I guess Riak use only port 8097 internally, without any
&gt;&gt; &gt;&gt; &gt; limitation.
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; And by checking logs, I see that a vnode transfer fails after a
&gt;&gt; &gt;&gt; &gt; random
&gt;&gt; &gt;&gt; &gt; duration, sometimes a few minutes.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

