---
title: "Re: Listing keys in a bucket"
description: ""
project: community
lastmod: 2010-09-04T13:03:31-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01023"
mailinglist_parent_id: "msg01020"
author_name: "John Axel Eriksson"
project_section: "mailinglistitem"
sent_date: 2010-09-04T13:03:31-07:00
---


Yeah, ok I see it now... guess I'm still too much in some sql mindset. We will 
store lots of files of the same type
so I guess I would need some way of separating them, perhaps by name or 
something into "directories". You're
right of course about not putting 10 000 files into a directory.

Actually, in some ways we do want to use riak as a distributed file system, but 
would also like to run queries against
the file metadata.

4 sep 2010 kl. 21.19 skrev Sean Cribbs:

&gt; You wouldn't put 10,000 files in a single directory on your computer, so 
&gt; there's no reason you would have to in Riak either. What about representing 
&gt; your directories as objects, too? The only thing you would require would be a 
&gt; known key that's the root of the hierarchy. For example:
&gt; 
&gt; /riak/files/\\_\\_root, which has links to:
&gt; -&gt; "/riak/files/images" (directory)
&gt; -&gt; "/riak/files/text" (directory)
&gt; -&gt; "/riak/files/index.html" (file)
&gt; 
&gt; "/riak/files/images" which has links to:
&gt; -&gt; "/riak/files/images%2Ffavicon.ico" (file)
&gt; -&gt; "/riak/files/images%2Flogo.jpg" (file)
&gt; 
&gt; (note I escape the slashes in the key names)
&gt; 
&gt; With proper use of links and tags, this is not a difficult problem. If you 
&gt; just want to mount Riak like a file system, you might look at Artur Bergman's 
&gt; riakfuse project.
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On Sep 4, 2010, at 2:51 PM, John Axel Eriksson wrote:
&gt; 
&gt;&gt; Yes, I've thought of this but as I understand it there is a bit of a problem 
&gt;&gt; attaching a large amount of links to a key which
&gt;&gt; would be necessary here am I right? If I had 10 000 files in riak that would 
&gt;&gt; mean 10 000 links attached to the "listing" key.
&gt;&gt; 
&gt;&gt; 4 sep 2010 kl. 20.44 skrev Matthew Scott:
&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On Sat, Sep 4, 2010 at 11:31, John Axel Eriksson  wrote:
&gt;&gt;&gt; Listing keys in a bucket has been described as "bad" and something you use 
&gt;&gt;&gt; in development but
&gt;&gt;&gt; not in production. I'm just starting out on Riak so I'm a newbie...
&gt;&gt;&gt; 
&gt;&gt;&gt; I'm thinking of building an application using Riak as filestorage and 
&gt;&gt;&gt; possibly much more than that, but it would
&gt;&gt;&gt; at least store lots of files with, perhaps, metadata attached. How would I 
&gt;&gt;&gt; then list files for display in a webapp if
&gt;&gt;&gt; I don't use key listing?
&gt;&gt;&gt; 
&gt;&gt;&gt; I'm still very much a Riak newb myself, but I'll take a shot at answering 
&gt;&gt;&gt; this one by suggesting the use of links.
&gt;&gt;&gt; 
&gt;&gt;&gt; From what I understand, links some quantity limits when you attach a large 
&gt;&gt;&gt; number, but adding and removing them is an inexpensive operation. (Someone 
&gt;&gt;&gt; fact check me on that please :)
&gt;&gt;&gt; 
&gt;&gt;&gt; - Create a key called 'listing', perhaps even in its own bucket to prevent 
&gt;&gt;&gt; namespace collision.
&gt;&gt;&gt; 
&gt;&gt;&gt; - Create links from that 'listing' key to metadata keys. Remember that you 
&gt;&gt;&gt; can attach a tag to each link to differentiate different types of links, 
&gt;&gt;&gt; such as "metadata".
&gt;&gt;&gt; 
&gt;&gt;&gt; - The metadata keys' values would contain file metadata in JSON form, and 
&gt;&gt;&gt; in turn have a link to the file contents key, tagged "contents".
&gt;&gt;&gt; 
&gt;&gt;&gt; - Remember to attach the proper mime type to the key containing your file 
&gt;&gt;&gt; contents.
&gt;&gt;&gt; 
&gt;&gt;&gt; - To get a file listing, do a map/reduce starting at "listing", following 
&gt;&gt;&gt; its "metadata" links and grabbing those values, then reduce to sort by a 
&gt;&gt;&gt; key.
&gt;&gt;&gt; 
&gt;&gt;&gt; - To get file contents, follow the "contents" link from the metadata key.
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Matthew Scott
&gt;&gt;&gt; ElevenCraft, Inc.
&gt;&gt;&gt; http://11craft.com/
&gt;&gt;&gt; +1 360 389-2512
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

