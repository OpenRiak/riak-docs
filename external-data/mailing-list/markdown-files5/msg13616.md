---
title: "Re: Riak pool connection"
description: ""
project: community
lastmod: 2014-02-08T06:09:44-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13616"
mailinglist_parent_id: "msg13615"
author_name: "Massimiliano Ciancio"
project_section: "mailinglistitem"
sent_date: 2014-02-08T06:09:44-08:00
---


Hi Sean,
thanks for your answer!

&gt; I believe it may still be possible for the node to be selected if no other
&gt; connections are available in the pool, because the logic used to establish a
&gt; new connection might not use the filter.

My problem is not to avoid that a node will be selected again after a
fail (well, if this can be avoided by sure it's better...) but to set
an order in the nodes: I want to connect first to the node on which my
app is running and only in case of fail to the other nodes. The reason
is to avoid network traffic: every instance of my app have to connect
to the node on the same machine where it resides.
How can I suggest a "preferred node" to RiakClient?
My first idea was to use a connection with only the preferred node
and, using a try/except, use an "emergency connection" with the list
of all nodes to be used only in case of fail. But it's not so
elegant....
Massimiliano

2014-02-08 13:47 GMT+01:00 Sean Cribbs :
&gt; Hi Massimilliano,
&gt;
&gt; The list of nodes does not imply an order of connection. Usually, a random
&gt; node is chosen after nodes with error rates greater than a threshold are
&gt; removed from the candidates. You can see the implementation in
&gt; RiakClient.\\_choose\\_node:
&gt; https://github.com/basho/riak-python-client/blob/master/riak/client/\\_\\_init\\_\\_.py#L278
&gt;
&gt; When a request fails such that the connection is known to be bad (such as a
&gt; TCP error), the retry logic filters out that node from existing connections.
&gt; I believe it may still be possible for the node to be selected if no other
&gt; connections are available in the pool, because the logic used to establish a
&gt; new connection might not use the filter. I will investigate further and
&gt; determine if this is actually the case.
&gt;
&gt;
&gt; On Sat, Feb 8, 2014 at 1:03 PM, Massimiliano Ciancio
&gt;  wrote:
&gt;&gt;
&gt;&gt; Hi all,
&gt;&gt; I'm using python client to connect to a five nodes riak server.
&gt;&gt; Since I'm running my app on the same servers on which is running Riak,
&gt;&gt; I want that the app on server x get and store data asking to the Riak
&gt;&gt; on the same server. If the Riak on the same server is not available,
&gt;&gt; tha app must connect to another Riak server randomly choosed.
&gt;&gt; How can I implement this?
&gt;&gt; Does the list of nodes passed to the RiakClient
&gt;&gt; (http://basho.github.io/riak-python-client/client.html) imply an
&gt;&gt; 'order of connection' ? That is, first connect to the first node then,
&gt;&gt; if this fails, connect to the second and so on...
&gt;&gt; Thanks in advance
&gt;&gt; Massimiliano
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

