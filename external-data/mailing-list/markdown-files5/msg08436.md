---
title: "Re: riakc_pb_socket:start_link question with a riak cluster"
description: ""
project: community
lastmod: 2012-09-02T23:40:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08436"
mailinglist_parent_id: "msg08435"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-09-02T23:40:07-07:00
---


Hi Brysn , 

There have been at least four chunks of code released to handle connection 
pooling ( in addition to poolboy);

http://wiki.basho.com/Community-Developed-Libraries-and-Projects.html#Client-Libraries-and-Frameworks.
 ( Scroll down to " Erlang".)

These might be worth a look. 

Mark
twitter.com/pharkmillups 



Mark


On Sep 3, 2012, at 6:40, Joseph Lambert  wrote:

&gt; Hi Bryan,
&gt; 
&gt; AFAIK, there is no built-in connection pooling for the Riak Erlang client. 
&gt; Each connection will only connect with one node and only that node, but since 
&gt; it's masterless you can connect to any node. You could roll your own 
&gt; connection pooling mechanism, or use something like Poolboy to handle it for 
&gt; you. Using Poolboy is convenient because it comes as a dependency of 
&gt; riak\\_core.
&gt; 
&gt; If you use Poolboy, you'll have to modify riakc\\_pb\\_socket slightly to account 
&gt; for the way poolboy initializes connections (add a start\\_link/1), or create a 
&gt; simple module to pass the initialization from poolboy to riakc\\_pb\\_socket.
&gt; 
&gt; - Joe Lambert
&gt; 
&gt; 
&gt; On Mon, Sep 3, 2012 at 11:41 AM, Bryan Hughes  wrote:
&gt; Hi Guys,
&gt; 
&gt; I have a question regarding Riak's protobuffer client gen\\_server process. I 
&gt; have a cluster of 5 nodes (machines), each with consecutive IP addresses. 
&gt; Our application is 100% erlang and runs on its own machine. The arguments to 
&gt; riakc\\_pb\\_socket:start\\_link/2 is an Address, Port and the optional Options. 
&gt; The Address and Port is the address of the riak server, but in the case of a 
&gt; masterless cluster of 5 machines, which address do I use? 
&gt; 
&gt; In reviewing the code for riakc\\_pb\\_socket.erl, the client opens a socket via 
&gt; gen\\_tcp to that particular node in the cluster and only that node. This 
&gt; means that there is a 1 to 1 connection between the riak node and the client. 
&gt; Is this correct? Maybe I am missing something?
&gt; 
&gt; If so, then it looks like I need to implement my own round-robin algorithm 
&gt; across a pool of protobuffer clients that I am managing, each bound to a 
&gt; different node in the cluster while testing "aliveness" with ping/2 and an 
&gt; immediate timeout?
&gt; 
&gt; Cheers,
&gt; Bryan
&gt; 
&gt; -- 
&gt; Bryan Hughes
&gt; Wobblesoft
&gt; 
&gt; http://www.wobblesoft.com
&gt; 
&gt; "Art is never finished, only abandoned. - Leonardo da Vinci"
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

