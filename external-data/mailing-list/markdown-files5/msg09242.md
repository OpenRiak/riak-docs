---
title: "mysterious Riak problems"
description: ""
project: community
lastmod: 2012-11-07T11:34:33-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09242"
author_name: "David Lowell"
project_section: "mailinglistitem"
sent_date: 2012-11-07T11:34:33-08:00
---


Hello Riak Folks,

The last three days, we've been having a string of problems with Riak. An 
otherwise healthy server running our full application stack will suddenly start 
throwing a bunch of errors in the logs. Although the Riak processes stay up, 
most or all requests to Riak fail during these periods.

The errors in the logs are predominantly describing "riak\\_kv\\_vnode worker pool 
crashed" and timeout conditions. This morning, we had this crashy behavior 
start immediately after a clean Riak startup, and making a single call to our 
API, so the logs are quite free of other noise. I've summarized those logs 
below for curious parties, and can attach the full set of logs if needed.

I forgot to check this morning, but during a similar outage on Monday, the Riak 
server was refusing connections to new clients.

Interestingly, after giving Riak a while with no traffic at all today (like 
15-30 minutes), it appears to have recovered without a restart. We've had 
similar recoveries during other "outages" of this type since Sunday evening. 
Facilitating this sort of recovery does seem to require shutting down all 
application KV requests for a while.

We're suspicious of some kind of corruption in the eleveldb on-disk files, 
because in past outages of this type, we've observed that the condition 
persists over reboots. But we don't have much more evidence than that. Is there 
a command we can run that will check over eleveldb files for corruption or 
inconsistency?

Other than that, what can cause "worker pool crashed" events? What do you know 
about the "timeouts" that are in these logs?

For the record, we're running Riak 1.2.0 on Ubuntu 10.04, eleveldb backend 
with 512 partitions. We're running predominantly in a single-node configuration 
on a bunch of isolated dev boxes at the moment, on our way to spreading out our 
512 vnodes onto 5 hosts in production.

Thanks for your help,

Dave

--
Dave Lowell
d...@connectv.com


2012-11-07 18:11:03.398 [info] &lt;0.7.0&gt; Application lager started on node 
'riak@10.0.3.11'

... normal startup messages ...

2012-11-07 18:11:50.109 [info] &lt;0.10582.0&gt;@riak\\_core:wait\\_for\\_application:419 
Wait complete for application riak\\_search (0 seconds)
2012-11-07 18:22:18.509 [error] &lt;0.2897.0&gt;@riak\\_core\\_vnode:handle\\_info:510 
105616329260241031198313161739262640092323250176 riak\\_kv\\_vnode worker pool 
crashed 
{timeout,{gen\\_server,call,[&lt;0.2902.0&gt;,{work,&lt;0.2900.0&gt;,{fold,#Fun,#Fun},{fsm,{96247562,{105616329260241031198313161739262640092323250176,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}
2012-11-07 18:22:18.509 [error] &lt;0.2899.0&gt; gen\\_fsm &lt;0.2899.0&gt; in state ready 
terminated with reason: 
{timeout,{gen\\_server,call,[&lt;0.2902.0&gt;,{work,&lt;0.2900.0&gt;,{fold,#Fun,#Fun},{fsm,{96247562,{105616329260241031198313161739262640092323250176,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}

... 13 more "riak\\_kv\\_vnode worker pool crashed" messages...

2012-11-07 18:22:21.245 [error] &lt;0.2899.0&gt; CRASH REPORT Process &lt;0.2899.0&gt; with 
0 neighbours exited with reason: 
{timeout,{gen\\_server,call,[&lt;0.2902.0&gt;,{work,&lt;0.2900.0&gt;,{fold,#Fun,#Fun},{fsm,{96247562,{105616329260241031198313161739262640092323250176,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}
 in gen\\_fsm:terminate/7 line 611
2012-11-07 18:22:21.844 [error] &lt;0.2944.0&gt; gen\\_fsm &lt;0.2944.0&gt; in state ready 
terminated with reason: 
{timeout,{gen\\_server,call,[&lt;0.2947.0&gt;,{work,&lt;0.2945.0&gt;,{fold,#Fun,#Fun},{fsm,{96247562,{114179815416476790484662877555959610910619729920,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}

... 13 more "CRASH REPORT Process  with 0 neighbours exited with reason" and 
"gen\\_fsm &lt;0.2989.0&gt; in state ready terminated with reason" message pairs

2012-11-07 18:23:21.427 [error] &lt;0.15322.0&gt; gen\\_server &lt;0.15322.0&gt; terminated 
with reason: 
{error,{case\\_clause,{error,timeout,[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[&lt;&lt;"1352256943.4983411"&gt;&gt;],[],[],[],...]}},...}
2012-11-07 18:23:21.495 [error] &lt;0.15322.0&gt; CRASH REPORT Process &lt;0.15322.0&gt; 
with 0 neighbours exited with reason: 
{error,{case\\_clause,{error,timeout,[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[&lt;&lt;"1352256943.4983411"&gt;&gt;],[],[],[],...]}},...}
 in gen\\_server:terminate/6 line 747
2012-11-07 18:23:21.525 [error] &lt;0.10590.0&gt; Supervisor riak\\_api\\_pb\\_sup had 
child undefined started with {riak\\_api\\_pb\\_server,start\\_link,undefined} at 
&lt;0.15322.0&gt; exit with reason 
{error,{case\\_clause,{error,timeout,[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[&lt;&lt;"1352256943.4983411"&gt;&gt;],[],[],[],...]}},...}
 in context child\\_terminated\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

