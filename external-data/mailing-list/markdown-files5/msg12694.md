---
title: "Re: Riak consumes too much memory"
description: ""
project: community
lastmod: 2013-10-18T11:26:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12694"
mailinglist_parent_id: "msg12693"
author_name: "Darren Govoni"
project_section: "mailinglistitem"
sent_date: 2013-10-18T11:26:43-07:00
---



Sounds nice. And then the question is
 what happens when that limit is reached on a node?

 On 10/18/2013 02:21 PM, Matthew Von-Maszewski wrote:


 
 The user has the option of setting a default memory limit in the
 app.config / riak.conf file (either absolute number or percentage
 of total system memory).  There is a default percentage (which I
 am still adjusting) if the user takes no action.
 

The single memory value is then dynamically partitioned to
 each Riak vnode (and AAE vnodes) as the server takes on more or
 fewer vnodes throughout normal operations and node failures.


There is no human interaction required once the memory limit
 is established.


Matthew




On Oct 18, 2013, at 2:08 PM, darren 
 wrote:



Is it smart enough to manage itself?
Or does it require human babysitting?





Sent from my
 Verizon Wireless 4G LTE Smartphone




 -------- Original message --------
 From: Matthew Von-Maszewski 
 
 Date: 10/18/2013 1:48 PM (GMT-05:00) 
 To: Dave Martorana 
 
 Cc: darren ,riak-users@lists.basho.com

 Subject: Re: Riak consumes too much memory 


 Dave,
 

flexcache will be a new feature in Riak 2.0.  There
 are some subscribers to this mailing list that like to
 download and try things early.  I was directing those
 subscribers to the GitHub branch that contains the
 work-in-progress code.


flexcache is a new method for sizing / accounting the
 memory used by leveldb.  It replaces the current method
 completely.  flexcache is therefore not an option, but
 an upgrade to the existing logic.


Again, the detailed discussion is here:  ttps://github.com/basho/leveldb/wiki/mv-flexcache


Matthew




On Oct 18, 2013, at 12:33 PM, Dave Martorana 
 wrote:



Matthew,



 For we who don't quite understand, can you
 explain - does this mean mv-flexcache is a
 feature that just comes with 2.0, or is it
 something that will need to be turned on, etc?



Thanks!



 Dave



On Thu, Oct 17, 2013 at
 9:45 PM, Matthew Von-Maszewski 
 wrote:


It is already in test and
 available for your download now:


https://github.com/basho/leveldb/tree/mv-flexcache


Discussion is here:


https://github.com/basho/leveldb/wiki/mv-flexcache



This code is slated for Riak 2.0.
  Enjoy!!



Matthew




 On Oct 17, 2013, at 20:50, darren 
 wrote:



But why isn't riak smart enough
 to adjust itself to the available
 memory or lack thereof?


No serious enterprise technology
 should just consume everything and
 crash.





Sent
 from my Verizon Wireless 4G LTE
 Smartphone




 -------- Original message --------
 From: Matthew Von-Maszewski 
 
 Date: 10/17/2013 8:38 PM (GMT-05:00) 
 To: ZhouJianhua 
 
 Cc: riak-users@lists.basho.com

 Subject: Re: Riak consumes too much
 memory 


 Greetings,
 

The default config targets 5
 servers and 16 to 32G of RAM.  Yes,
 the app.config needs some adjustment
 to achieve happiness for you:


- change ring\\_creation\\_size from
 64 to 16 (remove the % from the
 beginning of the line)
- add this line before
 "{data\\_root, }" in
 eleveldb section: "{max\\_open\\_files,
 40}," (be sure the comma is at the
 end of this line).


Good luck,
Matthew




On Oct 17, 2013, at 8:23 PM,
 ZhouJianhua 
 wrote:



Hi
 

I installed riak v1.4.2
 on ubuntu12.04(64bit, 4G
 RAM) with apt-get,  run it
 with default app.conf but
 change the backend to
 leveldb, and test it with https://github.com/tpjg/goriakpbc . 


Just keep putting (key,
 value) to an bucket,  the
 memory always increasing,
 and in the end it
 crashed, as it cannot
 allocate memory. 


Should
 i change the
 configuration or other?

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
 riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com










\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
 riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
















\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

