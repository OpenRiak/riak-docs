---
title: "Re: How to update existed schema"
description: ""
project: community
lastmod: 2014-11-25T09:59:22-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15246"
mailinglist_parent_id: "msg15243"
author_name: "Yang Zhenguo"
project_section: "mailinglistitem"
sent_date: 2014-11-25T09:59:22-08:00
---


Hi Eric,

Thanks a lot. Two more questions:
1. If I dont rewrite every value in Step 2, what's the result?
2. where is the index directories by default?

Regards,
Zhenguo

2014-11-26 1:44 GMT+08:00 Eric Redmond :

&gt; Yes, to be clear, there are currently a few options to reindex a schema
&gt; change. After you update the schema, you can:
&gt;
&gt; 1. create a new index and reattach
&gt; 2. rewrite every value inline
&gt; 3. delete the index directories on every node and let AAE rebuild them
&gt;
&gt; The new change will create a 4th option:
&gt;
&gt; 4. update the schema and let AAE fix the index.
&gt;
&gt; Then, we're working on a 5th option:
&gt;
&gt; 5. modify schemas via command-line, and start an inline, eventually
&gt; consistent index update
&gt;
&gt; And potentially a 6th option:
&gt;
&gt; 6. modify schemas via command-line, and force an atomic index update
&gt;
&gt; I can't post any ETAs, but "soon".
&gt;
&gt; Eric
&gt;
&gt;
&gt;
&gt; On Nov 25, 2014, at 9:35 AM, Alexander Sicular  wrote:
&gt;
&gt; You basically need to read and re-write each key as Geoff says. Hopefully
&gt; this gets automated in the future in some fashion.
&gt;
&gt; -Alexander
&gt;
&gt; @siculars
&gt; http://siculars.posthaven.com
&gt;
&gt; Sent from my iRotaryPhone
&gt;
&gt; On Nov 25, 2014, at 12:31, Geoff Garbers  wrote:
&gt;
&gt; Hey Zhenguo.
&gt;
&gt; I've actually just gone through something similar myself recently.
&gt; ​ ​
&gt; I found that the most reliable way to do this is as follows:
&gt;
&gt; 1. Update the schema (as you have shown)
&gt; 2. Attach to the Erlang console on each node, and run
&gt; rp(yz\\_index:reload(&lt;&lt;"index\\_name"&gt;&gt;)).
&gt; ​3. List all keys in the buckets with your bucket type, and pull and put
&gt; each of the objects in those buckets.
&gt;
&gt; It's not the most ideal way, but it's the most effective (from what I've
&gt; found) until the new sear​ch administration functionality becomes available.
&gt;
&gt; Regards,
&gt; Geoff
&gt;
&gt;
&gt;
&gt; Geoffrey Garbers
&gt; Senior Developer
&gt;
&gt; [image: Total Send] 
&gt;
&gt; Cell: +27 (0)766 476 920
&gt; Skype: geoff.garbers
&gt; ge...@totalsend.com
&gt; www.totalsend.com
&gt;
&gt; +1 347-431-0494 
&gt; +44 (0)203 519 1082 
&gt; +61 (0)3 9111 5760 
&gt; +27 (0)21 200 6981 
&gt;
&gt; On Tue, Nov 25, 2014 at 6:46 PM, Yang Zhenguo 
&gt; wrote:
&gt;
&gt;&gt; Any other options? :)
&gt;&gt;
&gt;&gt; 2014-11-26 0:42 GMT+08:00 Eric Redmond :
&gt;&gt;
&gt;&gt;&gt; Yes, that is one of the options.
&gt;&gt;&gt;
&gt;&gt;&gt; Eric
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Nov 25, 2014, at 8:40 AM, Yang Zhenguo  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Eric,
&gt;&gt;&gt;
&gt;&gt;&gt; Any suggestion for my requirement? create a new search index?
&gt;&gt;&gt;
&gt;&gt;&gt; Regards,
&gt;&gt;&gt; Zhenguo
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; 2014-11-26 0:24 GMT+08:00 Eric Redmond :
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Automatic updating of indexes due to schema changes doesn't exist yet.
&gt;&gt;&gt;&gt; It'll be added soon:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; https://github.com/basho/yokozuna/pull/427
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Eric
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Nov 25, 2014, at 8:21 AM, Yang Zhenguo 
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have an existed schema and I want to add one column in it, such as
&gt;&gt;&gt;&gt; &gt;&gt;&gt; /&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What's the steps to update it?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Since there is the search\\_index related to the schema and a bucket type
&gt;&gt;&gt;&gt; related to the search\\_index.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I tried to update the schema by the following commands:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {ok, SchemaData} = file:read\\_file("cartoons.xml"),
&gt;&gt;&gt;&gt; riakc\\_pb\\_socket:create\\_search\\_schema(Pid, &lt;&lt;"cartoons"&gt;&gt;, SchemaData).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; However, I can not search the object with new field.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks in advance.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Regards,
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Zhenguo Yang
&gt;&gt;&gt;&gt; www.prinbit.com
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Zhenguo Yang
&gt;&gt;&gt; MSN: zgyang...@hotmail.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Zhenguo Yang
&gt;&gt; MSN: zgyang...@hotmail.com
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;


-- 
Zhenguo Yang
MSN: zgyang...@hotmail.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

