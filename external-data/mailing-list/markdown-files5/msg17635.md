---
title: "Re: a weird error while post request to server for store object"
description: ""
project: community
lastmod: 2016-09-12T04:59:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17635"
mailinglist_parent_id: "msg17631"
author_name: "Christopher Mancini"
project_section: "mailinglistitem"
sent_date: 2016-09-12T04:59:15-07:00
---


Hi Alan,

So, the quick answer, is that CRDTs and secondary indexes are not supported
on riak-ts at the moment which explains why you are getting errors. To
complete the example you were working on, you would need to run it against
riak-kv.

The long answer is our goal is to have TS and KV merged together so you can
have the features of both on one instance of Riak but unfortunately I do
not have a timeline for when that will be available.

Chris

On Wed, Sep 7, 2016 at 9:43 PM HQS^∞^  wrote:

&gt; Hi Luke :
&gt; I'm sorry , I did not say clear my develop environment which I
&gt; mentioned. I deployed three riak-ts server(at least version 1.3) in
&gt; separate vmware virtual machine , PHP Client Libaray version is 2.0 and
&gt; the riak-ts version is 1.3.0.
&gt;
&gt; Regards
&gt; Alan
&gt;
&gt; ------------------ 原始邮件 ------------------
&gt; \\*发件人:\\* "Luke Bakken";;
&gt; \\*发送时间:\\* 2016年9月7日(星期三) 晚上9:27
&gt; \\*收件人:\\* "HQS^∞^";
&gt; \\*抄送:\\* "riak-users";
&gt; \\*主题:\\* Re: a weird error while post request to server for store object
&gt;
&gt; Hello Alan -
&gt;
&gt; Which PHP client library are you using?
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt; On Tue, Sep 6, 2016 at 10:29 PM, HQS^∞^  wrote:
&gt; &gt; dear everyone:
&gt; &gt; I follow the tutorial at
&gt; &gt; http://docs.basho.com/riak/kv/2.1.4/developing/usage/document-store/ ,
&gt; &gt; Step by Step Practice , when I've Post a request for store object , but
&gt; the
&gt; &gt; riak server respond 400 (Bad Request) , I review my code again and
&gt; again ,
&gt; &gt; but no problem found . see below:
&gt; &gt;
&gt; &gt; php
 &gt;
&gt; &gt;
&gt; &gt; class BlogPost {
&gt; &gt; var $\\_title = '';
&gt; &gt; var $\\_author = '';
&gt; &gt; var $\\_content = '';
&gt; &gt; var $\\_keywords = [];
&gt; &gt; var $\\_datePosted = '';
&gt; &gt; var $\\_published = false;
&gt; &gt; var $\\_bucketType = "cms";
&gt; &gt; var $\\_bucket = null;
&gt; &gt; var $\\_riak = null;
&gt; &gt; var $\\_location = null;
&gt; &gt; public function \\_\\_construct(Riak $riak, $bucket, $title, $author,
&gt; &gt; $content, array $keywords, $date, $published)
&gt; &gt; {
&gt; &gt; $this-&gt;\\_riak = $riak;
&gt; &gt; $this-&gt;\\_bucket = new Bucket($bucket, "cms");
&gt; &gt; $this-&gt;\\_location = new Riak\\Location('blog1',$this-&gt;\\_bucket,"cms");
&gt; &gt; $this-&gt;\\_title = $title;
&gt; &gt; $this-&gt;\\_author = $author;
&gt; &gt; $this-&gt;\\_content = $content;
&gt; &gt; $this-&gt;\\_keywords = $keywords;
&gt; &gt; $this-&gt;\\_datePosted = $date;
&gt; &gt; $this-&gt;\\_published = $published;
&gt; &gt; }
&gt; &gt;
&gt; &gt; public function store()
&gt; &gt; {
&gt; &gt; $setBuilder = (new UpdateSet($this-&gt;\\_riak));
&gt; &gt;
&gt; &gt; foreach($this-&gt;\\_keywords as $keyword) {
&gt; &gt; $setBuilder-&gt;add($keyword);
&gt; &gt; }
&gt; &gt; /\\*
&gt; &gt; (new UpdateMap($this-&gt;\\_riak))
&gt; &gt; -&gt;updateRegister('title', $this-&gt;\\_title)
&gt; &gt; -&gt;updateRegister('author', $this-&gt;\\_author)
&gt; &gt; -&gt;updateRegister('content', $this-&gt;\\_content)
&gt; &gt; -&gt;updateRegister('date', $this-&gt;\\_datePosted)
&gt; &gt; -&gt;updateFlag('published', $this-&gt;\\_published)
&gt; &gt; -&gt;updateSet('keywords', $setBuilder)
&gt; &gt; -&gt;withBucket($this-&gt;\\_bucket)
&gt; &gt; -&gt;build()
&gt; &gt; -&gt;execute();
&gt; &gt;
&gt; &gt; \\*/
&gt; &gt; $response = (new UpdateMap($this-&gt;\\_riak))
&gt; &gt; -&gt;updateRegister('title', $this-&gt;\\_title)
&gt; &gt; -&gt;updateRegister('author', $this-&gt;\\_author)
&gt; &gt; -&gt;updateRegister('content', $this-&gt;\\_content)
&gt; &gt; -&gt;updateRegister('date', $this-&gt;\\_datePosted)
&gt; &gt; -&gt;updateFlag('published', $this-&gt;\\_published)
&gt; &gt; -&gt;updateSet('keywords', $setBuilder)
&gt; &gt; -&gt;atLocation($this-&gt;\\_location)
&gt; &gt; -&gt;build()
&gt; &gt; -&gt;execute();
&gt; &gt;
&gt; &gt; echo '';
&gt; &gt; var\\_dump($response);
&gt; &gt; echo '';
&gt; &gt; }
&gt; &gt; }
&gt; &gt;
&gt; &gt; $node = (new Node\\Builder)
&gt; &gt; -&gt;atHost('192.168.111.2')
&gt; &gt; -&gt;onPort(8098)
&gt; &gt; -&gt;build();
&gt; &gt;
&gt; &gt; $riak = new Riak([$node]);
&gt; &gt;
&gt; &gt;
&gt; &gt; $keywords = ['adorbs', 'cheshire'];
&gt; &gt; $date = new \\DateTime('now');
&gt; &gt;
&gt; &gt;
&gt; &gt; $post1 = new BlogPost(
&gt; &gt; $riak,
&gt; &gt; 'cat\\_pics', // bucket
&gt; &gt; 'This one is so lulz!', // title
&gt; &gt; 'Cat Stevens', // author
&gt; &gt; 'Please check out these cat pics!', // content
&gt; &gt; $keywords, // keywords
&gt; &gt; $date, // date posted
&gt; &gt; true // published
&gt; &gt; );
&gt; &gt; $post1-&gt;store();
&gt; &gt;
&gt; &gt; the wireshark captured packet :
&gt; &gt;
&gt; &gt; 192.168.171.124(client ip) =&gt; 192.168.111.2(riak server ip) HTTP
&gt; &gt; 511 POST /types/cms/buckets/cat\\_pics/datatypes/alldoc? HTTP/1.1
&gt; &gt; (application/json)
&gt; &gt; 192.168.111.2 192.168.171.124 HTTP 251 HTTP/1.1 400 Bad
&gt; Request
&gt; &gt;
&gt; &gt; GET http://192.168.111.2:8098//types/cms/buckets/cat\\_pics/props
&gt; &gt;
&gt; {"props":{"name":"cat\\_pics","young\\_vclock":20,"w":"quorum","small\\_vclock":50,"search\\_index":"blog\\_posts","rw":"quorum","r":"quorum","pw":0,"precommit":[],"pr":0,"postcommit":[],"old\\_vclock":86400,"notfound\\_ok":true,"n\\_val":3,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"last\\_write\\_wins":false,"dw":"quorum","dvv\\_enabled":true,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"big\\_vclock":50,"basic\\_quorum":false,"allow\\_mult":true,"datatype":"map","active":true,"claimant":"
&gt; node1@192.168.111.1"}}
&gt; &gt;
&gt; &gt; please help me catch the bugs thanks in advance!
&gt; &gt;
&gt; &gt; regards
&gt; &gt;
&gt; &gt; Alan
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
-- 
Sincerely,

Christopher Mancini
-----------------------------

employee = {
 purpose: solve problems with code,
 phone: 7164625591,
 email: cmanc...@basho.com,
 github: http://www.github.com/christophermancini
}
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

