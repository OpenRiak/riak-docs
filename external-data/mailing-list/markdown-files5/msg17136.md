---
title: "Re: 2i indexes and keys request inconsistencies"
description: ""
project: community
lastmod: 2016-03-09T02:51:53-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17136"
mailinglist_parent_id: "msg17135"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2016-03-09T02:51:53-08:00
---


I wonder if you have some keys that are hanging around on one of the N 
partitions but are deleted elsewhere (and the tombstones reaped?). 2i uses 
coverage which is essentially r=1 on a covering set of vnodes. But you think 
read-repair/AAE would bring convergence, so it is perplexing. I wonder if we 
can get a look at the “phantom” keys. Either via r=1 GET or some attach to 
console, get directly from the backend magic.


On 9 Mar 2016, at 09:06, Alexander Popov  wrote:

&gt; @Matthew 
&gt; 
&gt; No, db activity was very low at this time, and keys returned by this queries 
&gt; was deleted long time ago ( some of them at Dec 2015 )
&gt; 
&gt; I got this issue when proceed maintenance task which touch all keys in DB, 
&gt; list all keys by /keys?keys=true query, read, upgrade, save.
&gt; 
&gt; We have some logic depends on 2i indexes results - ( count number of related 
&gt; keys ). But if it returns phantom keys,
&gt; I cannot trust this data, need to double check by getting each object, but 
&gt; this is more expensive operation
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Tue, Mar 8, 2016 at 10:21 PM, Matthew Von-Maszewski  
&gt; wrote:
&gt; Is the database being actively modified during your queries? 
&gt; 
&gt; Queries can lock down a "snapshot" within leveldb. The query operation can 
&gt; return keys that existed at the time of the snapshot, but have been 
&gt; subsequently deleted by normal operations.
&gt; 
&gt; In such a case, the query is correct in giving you the key and the 404 
&gt; afterward is also correct. They represent two different versions of the 
&gt; database over time.
&gt; 
&gt; Not sure if this is a valid scenario for you or not.
&gt; 
&gt; Matthew
&gt; 
&gt; 
&gt;&gt; On Mar 8, 2016, at 1:22 PM, Alexander Popov  wrote:
&gt;&gt; 
&gt;&gt; Noticied that sometimes 2i query and all keys requesrs returns extra records 
&gt;&gt; ~2% of all records.
&gt;&gt; 
&gt;&gt; When call this items by get request after, it returns 404 and after that 
&gt;&gt; key stops to returns in 2i and keys requests.
&gt;&gt; 
&gt;&gt; Does it normally or my database is corrupted?
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

