---
title: "Riak-S2 javascript aws-sdk failing on multi-part uploads"
description: ""
project: community
lastmod: 2016-01-13T13:25:58-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16948"
author_name: "John Fanjoy"
project_section: "mailinglistitem"
sent_date: 2016-01-13T13:25:58-08:00
---


Hello Everyone,

I have been doing some searching around to see if anyone has come across the 
specific issue I am having and can’t find anything. I have a project that 
provides a file upload interface through a website and puts the uploaded object 
into riak-cs. The front end uses the javascript aws-sdk 2.1.29 (tried .19 as 
well) with a patch I found using the list archives to fix up some url encoding 
issues with uploadIDs. Everything seems to work fine when the image is less 
than 5mb (max part size), however when the object is larger the ManagedUpload 
functionality of the S3 object is failing after the first part. I’ve tested the 
code I’m using against a vanilla AWS bucket and a 400+ mb file was uploaded 
without issue. I tested the same file with riak-cs using the aws-sdk and 
CyberDuck. Cyberduck was able to upload the file without any failure, but it 
has not been successful even once using the javascript library. I have turned 
the riak-cs debug logging on, and I am getting some errors logged, but I’m not 
really sure how useful they are:

```
2016-01-13 15:34:51.648 [error] &lt;0.1255.0&gt; Webmachine error at path 
"/buckets/three2016com-devopsdevel/objects/DeSMan\\_Ep1\\_Create\\_Website\\_720p\\_DRAFT%2520%25281%2529.mov/uploads/kL9dRGLaQCiZBNnPSpu5mw=="
 : 
{error,{error,{badmatch,{error,closed}},[{webmachine\\_request,recv\\_unchunked\\_body,3,[{file,"src/webmachine\\_request.erl"},{line,490}]},{riak\\_cs\\_wm\\_object\\_upload\\_part,accept\\_streambody,4,[{file,"src/riak\\_cs\\_wm\\_object\\_upload\\_part.erl"},{line,308}]},{riak\\_cs\\_wm\\_object\\_upload\\_part,accept\\_body,2,[{file,"src/riak\\_cs\\_wm\\_object\\_upload\\_part.erl"},{line,224}]},{riak\\_cs\\_wm\\_common,accept\\_body,2,[{file,"src/riak\\_cs\\_wm\\_common.erl"},{line,342}]},{webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_re..."},...]},...]}}
 in webmachine\\_request:recv\\_unchunked\\_body/3 line 490
```

This error does not show up when using Cyberduck or performing an upload that 
is &lt;5mb using javascript. I’ve tried riak-cs 1.5 and now risk-s2 2.1.0 with out 
any success. Any help you can offer would be greatly appreciated. If you have 
any questions for me or need additional information let me know and I’ll fill 
in any holes I left.



Thank you in advance,

John Fanjoy

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

