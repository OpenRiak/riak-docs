---
title: "Re: Riak 1.4.2 10G Ethernet Performance Problems"
description: ""
project: community
lastmod: 2013-10-28T08:01:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12776"
mailinglist_parent_id: "msg12765"
author_name: "Chris Read"
project_section: "mailinglistitem"
sent_date: 2013-10-28T08:01:33-07:00
---


Yes, we have have jumbo frames on.

Kernel and systems are in a good state. I've got the settings from the
Linux perf tuning guide on the riak docs. Testing with iperf(1) shows our
nodes can saturate the 10G interfaces without breaking a sweat - as long as
the packets are large enough...

1) http://iperf.sourceforge.net/


On Sat, Oct 26, 2013 at 11:36 AM, Sean Cribbs  wrote:

&gt; Chris,
&gt;
&gt; Are you using jumbo frames on your network? (MTU 9000 or w/e) That's just
&gt; one aspect, but we've also found there are many other kernel/TCP-stack
&gt; tunings that need to be done to get Riak to push the limits of the network.
&gt;
&gt;
&gt; On Fri, Oct 25, 2013 at 9:10 PM, Chris Read  wrote:
&gt;
&gt;&gt; Greetings all...
&gt;&gt;
&gt;&gt; Context: We're running Riak 1.4.2 on Ubuntu 12.04 using the Basho build
&gt;&gt; .deb package. Out object size varies between 1K and 512K
&gt;&gt;
&gt;&gt; I've been having some trouble trying to figure out why handoffs between
&gt;&gt; our nodes takes so long and never pushes the network card over 2.5 Gb/s.
&gt;&gt; Testing communication between nodes using iperf shows that the
&gt;&gt; configuration we have can sustain 10G.
&gt;&gt;
&gt;&gt; Further investigation shows that communication between nodes never uses
&gt;&gt; messages &gt; 4k which gets the network cards to top out on packages per
&gt;&gt; second before they reach the top bits per second.
&gt;&gt;
&gt;&gt; Possibly related: I see exactly the same problem when using Basho Bench
&gt;&gt; and the pb driver - I can never get the client to go over 2.5Gb/s. This is
&gt;&gt; pushing me to suspect erlang vm or something as the problem.
&gt;&gt;
&gt;&gt; Anyone seen this before? Is there a magic "use bigger messages" flag
&gt;&gt; hidden somewhere?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt;
&gt;&gt; Chris
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

