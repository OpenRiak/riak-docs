---
title: "RE: Is it possible to include node load into the consistency hashing	function in riak-core?"
description: ""
project: community
lastmod: 2012-10-16T05:37:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08932"
mailinglist_parent_id: "msg08917"
author_name: "Zhemzhitsky Sergey"
project_section: "mailinglistitem"
sent_date: 2012-10-16T05:37:36-07:00
---


Hello Bryan,

Thanks a lot for the ideas! 
In case of any results, I will necessarily share them.


Best Regards,
Sergey


-----Original Message-----
From: Bryan Fink [mailto:br...@basho.com] 
Sent: Monday, October 15, 2012 7:05 PM
To: Zhemzhitsky Sergey
Cc: riak-users
Subject: Re: Is it possible to include node load into the consistency hashing 
function in riak-core?

On Tue, Oct 9, 2012 at 11:59 AM, Zhemzhitsky Sergey 
 wrote:
&gt; What Iâ€™d like to achieve is to have the preferred list be sorted based 
&gt; on the current load (maybe erlang:statistics(run\\_queue)) of the nodes.
&gt;
&gt; Is it possible to change the hashing function somehow so that the 
&gt; vnode on the node with the minimal load is returned as the first one?

Hi, Sergey. It would not be possible to change the hashing function to take 
load into account. That function must \\*always\\* produce the same hash for each 
key - that's the "consistent" part of consistent hashing. If it didn't do that, 
then a request for a key might go to a completely different vnode every time.

After the hash is computed and the preflist is generated, it would be possible 
to re-sort the first N vnodes in the preference list, as you describe. However, 
except for edge cases where the network is overloaded, I don't think it will 
buy you much. Riak KV sends all of those first N requests as fast as it can, 
and then starts waiting for responses from them. So, getting a response to the 
least-loaded vnode a few microseconds sooner is unlikely to change performance.

Although, that overloaded-network case could prove interesting and valuable, 
and regular benchmarking could just prove me wrong. Also, Pipe could almost 
certainly benefit from such a behavior, since its operations usually target one 
vnode at a time instead of N. That is to say, please share your results if you 
do try this!

Hope that helps,
Bryan

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
CONFIDENTIALITY NOTICE: This email and any files attached to it may be conf 
idential. If you are not the intended recipient you are notified that using, 
copying, distributing or taking any action in reliance on the contents of this 
information is strictly prohibited. If you have received this email in error 
please notify the sender and delete this email. 
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

