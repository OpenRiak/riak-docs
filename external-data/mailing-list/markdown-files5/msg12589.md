---
title: "Re: riak 1.2.0-1 / Failed to merge"
description: ""
project: community
lastmod: 2013-10-10T07:17:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12589"
mailinglist_parent_id: "msg12590"
author_name: "Sebastian Gerlach"
project_section: "mailinglistitem"
sent_date: 2013-10-10T07:17:13-07:00
---


Hi Jon,

thanks for the quick replay and the offerred solution. we are running
the debian package version 1.2.0-1.

Is there a way to get a list of keys witch are in this files. To trigger
a read. We have over 25.000.000 Million records in riak an it's would be
grat to receive the richt ones. Not all.

Thanks in advanced.

Best regards
Sebastian


On 10/10/2013 04:09 PM, Jon Meredith wrote:
&gt; Hi Sebastian,
&gt; 
&gt; Sorry the log file is a little opaque. Bitcask is having problems
&gt; running the merge
&gt; on 
&gt; /var/lib/riak/bitcask/276886052384956216925307478073202056458252845056/4.bitcask.data
&gt; and 
&gt; /var/lib/riak/bitcask/276886052384956216925307478073202056458252845056/29.bitcask.data.
&gt; The zero length files are being created by the failed merges.
&gt; 
&gt; Something is corrupting the internal merge state structure. What
&gt; version of bitcask and riak are you running?
&gt; 
&gt; If you want some immediate reliefe, I would move the
&gt; 4.bitcask.data, 4.bitcask.data, 29.bitcask.hint and 29.bitcask.hint
&gt; files out of the bitcask directory to somewhere safe and remove all the
&gt; zero-length .data and .hint files and restart the node. Read repair
&gt; will fix the objects over time, or you could do more active repair by
&gt; retrieving all the objects. More recent versions of Riak have a manual
&gt; repair facility built in, but I'm guessing you're running something
&gt; before 1.2.
&gt; 
&gt; Jon
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Thu, Oct 10, 2013 at 7:05 AM, Sebastian Gerlach
&gt; &gt; wrote:
&gt; 
&gt; Hello,
&gt; 
&gt; we have a 12 node riak cluster. Since a while we have a log of messages
&gt; like this:
&gt; 
&gt; "2013-10-10 00:22:04.725 [error] &lt;0.5743.2160&gt; Failed to merge
&gt; 
&gt; ["/var/lib/riak/bitcask/276886052384956216925307478073202056458252845056",[{async\\_folds,true},{vnode\\_vclocks,true},{included\\_applications,[]},{allow\\_strfun,false},{reduce\\_js\\_vm\\_count,6},{storage\\_backend,riak\\_kv\\_bitcask\\_backend},{legacy\\_keylisting,false},{hook\\_js\\_vm\\_count,2},{listkeys\\_backpressure,true},{mapred\\_name,"mapred"},{stats\\_urlpath,"stats"},{legacy\\_stats,true},{js\\_thread\\_stack,16},{add\\_paths,[]},{http\\_url\\_encoding,on},{map\\_js\\_vm\\_count,8},{mapred\\_2i\\_pipe,true},{mapred\\_system,pipe},{js\\_max\\_vm\\_mem,8},{read\\_write,true}],["/var/lib/riak/bitcask/276886052384956216925307478073202056458252845056/29.bitcask.data","/var/lib/riak/bitcask/276886052384956216925307478073202056458252845056/4.bitcask.data"]]:
&gt; 
&gt; {{badrecord,mstate},[{bitcask,merge\\_files,1,[{file,"src/bitcask.erl"},{line,835}]},{bitcask,merge1,3,[{file,"src/bitcask.erl"},{line,509}]},{bitcask\\_merge\\_worker,do\\_merge,1,[{file,"src/bitcask\\_merge\\_worker.erl"},{line,130}]}]}
&gt; "
&gt; 
&gt; The provides directory have a lot of files with a size of zero. And the
&gt; number of files is much higher (2821 files) than in other directorys (30
&gt; files).
&gt; 
&gt; Does anyone has a solution or a hint.
&gt; 
&gt; Thanks a lot an best regards
&gt; Sebastian
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Jon Meredith
&gt; VP, Engineering
&gt; Basho Technologies, Inc.
&gt; jmered...@basho.com 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

