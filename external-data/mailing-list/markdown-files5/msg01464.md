---
title: "Re: Date format for Riak Search and its JSON output"
description: ""
project: community
lastmod: 2010-11-04T11:42:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01464"
mailinglist_parent_id: "msg01459"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2010-11-04T11:42:37-07:00
---


Hi Nicolas,

Thank you for the excellent description of the problem. There are currently
issues/bugs around date support in Riak Search, looks like you found
another. I'd recommend treating dates as strings for now. The issue you
described is now tracked here: https://issues.basho.com/show\\_bug.cgi?id=864

Best,
Rusty

On Thu, Nov 4, 2010 at 9:17 AM, Nicolas Fouch√© wrote:

&gt; Hi,
&gt;
&gt; I can't find the right format for dates in Riak Search, for fields
&gt; suffixed with "\\_dt". I tried rfc822 (e.g. "Thu, 04 Nov 2010 16:02:59
&gt; -0000"), and xmlschema/iso8601 (e.g. "2010-11-04T16:07:43Z"), but I
&gt; get an {unhandled\\_type,date} error when requesting my data in JSON. No
&gt; problem with XML.
&gt;
&gt; Here are the HTTP queries to reproduce the error:
&gt;
&gt; # Get the bucket props
&gt;
&gt; GET http://127.0.0.1:8098/riak/models?keys=false
&gt; {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ=="}
&gt;
&gt; # Set the pre-commit search hook
&gt;
&gt; PUT http://127.0.0.1:8098/riak/models
&gt; {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ==", "Content-Type"=&gt;"application/json"}
&gt;
&gt; {"props":{"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}]}}
&gt;
&gt; # Check if there are any keys to delete
&gt;
&gt; GET http://127.0.0.1:8098/riak/models?props=false&keys=true
&gt; {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ=="}
&gt;
&gt; # Post a JSON document with a date in rfc822 (day-of-week, DD
&gt; month-name CCYY hh:mm:ss zone)
&gt;
&gt; POST http://127.0.0.1:8098/riak/models?returnbody=true
&gt; {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ==", "Content-Type"=&gt;"application/json"}
&gt; {"time\\_dt":"Thu, 04 Nov 2010 16:02:59 -0000","value":"a value like
&gt; any other value","\\_type":"Model"}
&gt;
&gt; # Search for the object and request a JSON ouput =&gt; KO
&gt;
&gt; GET http://127.0.0.1:8098/solr/models/select?q=value%3Aother&wt=json
&gt; {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ=="}
&gt;
&gt; 500 Internal Server
&gt; ErrorInternal Server Error
=====================

The server
&gt; encountered an error while processing this
&gt; request:  

```
{error,{throw,{unhandled_type,date},
&gt;                [{riak_solr_output,convert_type,2},
&gt;                 {riak_indexed_doc,'-to_mochijson2/2-lc$^0/1-0-',2},
&gt;                 {riak_indexed_doc,'-to_mochijson2/2-lc$^0/1-0-',2},
&gt;                 {riak_indexed_doc,to_mochijson2,2},
&gt;                 {riak_solr_output,'-json_response/7-lc$^0/1-0-',2},
&gt;                 {riak_solr_output,json_response,7},
&gt;                 {riak_solr_searcher_wm,to_json,2},
&gt;
&gt;
&gt; {webmachine_resource,resource_call,3}]}}
```


---

mochiweb+webmachine
&gt; web server

[nfo@
&gt; 17:13:46]~/Code/tests/riak/search
&gt;
&gt; # Search for the object and request a XML ouput =&gt; OK
&gt;
&gt; GET http://127.0.0.1:8098/solr/models/select?q=value%3Aother&wt=xml
&gt;
&gt; xml version="1.0" encoding="UTF-8"?
&gt; 
&gt; 
&gt; 0
&gt; 1
&gt; 
&gt; on
&gt; 0
&gt; value:other
&gt; or
&gt; value
&gt; standard
&gt; 1.1
&gt; 2
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 67rGKh9XJSZBsPeet0LpdCzi1hz
&gt; 
&gt; Model
&gt; 
&gt; Thu, 04 Nov 2010 16:02:59 -0000
&gt; 
&gt; a value like any other value
&gt; 
&gt; 
&gt; 
&gt; 
&gt;
&gt; -- Nicolas
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

