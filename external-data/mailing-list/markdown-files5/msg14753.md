---
title: "Re: Counters inside Maps"
description: ""
project: community
lastmod: 2014-08-19T16:12:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14753"
mailinglist_parent_id: "msg14752"
author_name: "Alex De la rosa"
project_section: "mailinglistitem"
sent_date: 2014-08-19T16:12:13-07:00
---


Cool! Understood :)

Thanks!
Alex

On Wednesday, August 20, 2014, Sean Cribbs  wrote:

&gt; On Tue, Aug 19, 2014 at 3:34 PM, Alex De la rosa
&gt; &gt; wrote:
&gt; &gt; Hi Sean,
&gt; &gt;
&gt; &gt; I didn't created the bucket\\_type as a map datatype as at first i was just
&gt; &gt; testing simple Riak Search... then it occurred to me what if I want a
&gt; &gt; counter in the data? :)
&gt; &gt;
&gt; &gt; Your example is pretty straightforward to follow and simple. Just 2
&gt; &gt; questions:
&gt; &gt;
&gt; &gt; 1. key.counters['number'].increment(1) =&gt; No need to define a "counters"
&gt; &gt; data-type somewhere before putting it inside the map as we normally need
&gt; in
&gt; &gt; simple buckets? If it works automatically is great :)
&gt;
&gt; Yes, it works automatically. All included datatypes are available inside
&gt; maps.
&gt;
&gt; &gt;
&gt; &gt; 2. if we use "number\\_counter" instead of "number\\_i" does Search/SOLR
&gt; &gt; understand is an integer? in case you want to do a range... as somewhere
&gt; in
&gt; &gt; the docs I read that better to use "\\_s" for strings, "\\_b" for binary,
&gt; "\\_i"
&gt; &gt; for integers, etc... so SOLR knows how to treat the data... I believe
&gt; there
&gt; &gt; will be no strange behaviours for having "\\_register" instead of "\\_s" and
&gt; &gt; "\\_counter" instead of "\\_i", right?
&gt;
&gt; The default Solr schema that ships with Riak accounts for these
&gt; datatypes automatically and uses the appropriate index field type:
&gt;
&gt; https://github.com/basho/yokozuna/blob/develop/priv/default\\_schema.xml#L96-L104
&gt;
&gt; If you write your own schema, you will want to include or change the
&gt; schema fields appropriately.
&gt;
&gt; &gt;
&gt; &gt; Thanks!
&gt; &gt; Alex
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Aug 20, 2014 at 12:24 AM, Sean Cribbs  &gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Alex,
&gt; &gt;&gt;
&gt; &gt;&gt; Assuming you've already made your bucket-type with "map" as the
&gt; &gt;&gt; datatype, then "bucket.new()" will return you a Map instead of a
&gt; &gt;&gt; RiakObject. Translating your example above:
&gt; &gt;&gt;
&gt; &gt;&gt; key = bucket.new('lionelmessi')
&gt; &gt;&gt; key.registers['name'].assign('Messi')
&gt; &gt;&gt; key.registers['team'].assign('Barcelona')
&gt; &gt;&gt; key.counters['number'].increment(10)
&gt; &gt;&gt; key.store()
&gt; &gt;&gt;
&gt; &gt;&gt; Note that because Maps are based on mutation operations and not
&gt; &gt;&gt; replacing the value with new ones, you can later do this without
&gt; &gt;&gt; setting the entire value:
&gt; &gt;&gt;
&gt; &gt;&gt; key.counters['number'].increment(1)
&gt; &gt;&gt; key.store()
&gt; &gt;&gt;
&gt; &gt;&gt; This will also change your searches, however, in that the fields will
&gt; &gt;&gt; be suffixed with the embedded type you are using:
&gt; &gt;&gt;
&gt; &gt;&gt; r = client.fulltext\\_search('ix\\_footballers', 'team\\_register:Barcelona')
&gt; &gt;&gt;
&gt; &gt;&gt; Hope that helps!
&gt; &gt;&gt;
&gt; &gt;&gt; On Tue, Aug 19, 2014 at 2:59 PM, Alex De la rosa
&gt; &gt;&gt; &gt; wrote:
&gt; &gt;&gt; &gt; Imagine I have a Riak object "footballer" with some static fields:
&gt; name,
&gt; &gt;&gt; &gt; team, number. I store them like this now:
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; 1: CREATE INDEX FOR RIAK SEARCH
&gt; &gt;&gt; &gt; curl -XPUT "http://148.251.140.229:8098/search/index/ix\\_footballers"
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; 2: CREATE BUCKET TYPE
&gt; &gt;&gt; &gt; riak-admin bucket-type create tp\\_footballers
&gt; &gt;&gt; &gt; '{"props":{"allow\\_mult":false,"search\\_index":"ix\\_footballers"}}'
&gt; &gt;&gt; &gt; riak-admin bucket-type activate tp\\_footballers
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; 3: INSERT A PLAYER
&gt; &gt;&gt; &gt; bucket = client.bucket\\_type('tp\\_footballers').bucket('footballers')
&gt; &gt;&gt; &gt; key = bucket.new('lionelmessi', data={'name\\_s':'Messi',
&gt; &gt;&gt; &gt; 'team\\_s':'Barcelona', 'number\\_i':10}, content\\_type='application/json')
&gt; &gt;&gt; &gt; key.store()
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; 4: SEARCH FOR BARCELONA PLAYERS
&gt; &gt;&gt; &gt; r = client.fulltext\\_search('ix\\_footballers', 'team\\_s:Barcelona')
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; So far so good :) BUT... what if I want to have a field "goals\\_i" that
&gt; &gt;&gt; &gt; is a
&gt; &gt;&gt; &gt; counter that will be incremented each match day with the number of
&gt; goals
&gt; &gt;&gt; &gt; he
&gt; &gt;&gt; &gt; scored? What is the syntax/steps to do to set up "footballers" as a
&gt; MAP
&gt; &gt;&gt; &gt; and
&gt; &gt;&gt; &gt; then put a COUNTER inside? I know is possible as I read it in some
&gt; data
&gt; &gt;&gt; &gt; dump
&gt; &gt;&gt; &gt; some Basho employee passed me some time ago, but I can't manage to see
&gt; &gt;&gt; &gt; how
&gt; &gt;&gt; &gt; to do it now.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Thanks!
&gt; &gt;&gt; &gt; Alex
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; &gt; riak-users mailing list
&gt; &gt;&gt; &gt; riak-users@lists.basho.com 
&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;&gt; &gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; --
&gt; &gt;&gt; Sean Cribbs &gt;
&gt; &gt;&gt; Software Engineer
&gt; &gt;&gt; Basho Technologies, Inc.
&gt; &gt;&gt; http://basho.com/
&gt; &gt;
&gt; &gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs &gt;
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

