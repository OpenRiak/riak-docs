---
title: "Re: slow 2 node cluster"
description: ""
project: community
lastmod: 2011-11-20T12:14:27-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05691"
mailinglist_parent_id: "msg05690"
author_name: "Catalin Constantin"
project_section: "mailinglistitem"
sent_date: 2011-11-20T12:14:27-08:00
---


I am 100% sure the transfer rate is 10MBytes / second. This is not the
problem.
IOWAIT is also pretty low. iostat shows: iowait 4.69%

I have retried the test with one node, a new bucket newly created where i
have set: n to 1.
bucket.set\\_n\\_val(1)

Results are the same. Less than 300 inserts / second.

Any idea why riak is so slow on inserting data ?


On Sun, Nov 20, 2011 at 9:27 PM, Aphyr  wrote:

&gt; On 11/20/2011 05:19 AM, Catalin Constantin wrote:
&gt;
&gt;&gt; The connection between servers is 10MBytes / sec not 10Mbit / sec.
&gt;&gt;
&gt;
&gt; Are you sure? To my knowledge almost no ethernet gear runs at 10 MB/s.
&gt; It's almost always 10, 100, 1000, or 10000 Mb/s.
&gt;
&gt; It may be your n\\_val. If it's the default (3), one of your two machines
&gt; has to handle that third replica. That'll cut your throughput
&gt; significantly. Finally, your disks may be the bottleneck. I'd take a look
&gt; at iostat and look for significant (on our servers, 2.6% meant we were
&gt; thrashing) IO\\_WAIT time on the riak beam.smp process.
&gt;
&gt; --Kyle
&gt;
&gt; One row of data looks like this:
&gt;&gt; 309819178daz...@gmail.com
&gt;&gt; \\*\\*55942dzt1home2011-05-3116:22:\\*\\*102011-09-07
&gt;&gt; 17:03:48127.0.0.111
&gt;&gt;
&gt;&gt;
&gt;&gt; I use Protobuf transport.
&gt;&gt; If dw = 0 and w = 0 there is no wait for other replica nodes, right ?
&gt;&gt;
&gt;&gt; This should improve the write speed, correct ?
&gt;&gt;
&gt;&gt; On Sun, Nov 20, 2011 at 2:21 PM, Erik Søe Sørensen &gt; &gt; wrote:
&gt;&gt;
&gt;&gt; This depends quite a bit on the sizes of your objects.
&gt;&gt; Supposing an average size of 2KB, and n=3: on each write, on average
&gt;&gt; 1.5 of the replicas would be on the other node, implying inter-node
&gt;&gt; network traffic of 1.5\\*2KB=3KB (and this is just in one direction).
&gt;&gt; If your inter-node network connection is indeed 10Mbit ~ 1MB/s,
&gt;&gt; then 300 writes/s \\* 3KB = 0.9MB/s would just about saturate the
&gt;&gt; connection.
&gt;&gt;
&gt;&gt; You may want to check the network utilization.
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; From: 
&gt;&gt; riak-users-bounces@lists.\\*\\*basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; &gt;
&gt;&gt; [riak-users-bounces@lists.\\*\\*basho.com
&gt;&gt; 
&gt;&gt; &gt;]
&gt;&gt; On Behalf Of Catalin
&gt;&gt; Constantin [daz...@gmail.com ]
&gt;&gt;
&gt;&gt; Sent: 20 November 2011 11:10
&gt;&gt; To: riak-users@lists.basho.com 
&gt;&gt; 
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; Subject: slow 2 node cluster
&gt;&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I am trying to evaluate / run some tests on a 4 mil dataset.
&gt;&gt; I have 2 nodes setup (different machines - 8GB ram each, I7 cpus).
&gt;&gt; 10 MB connection between them.
&gt;&gt;
&gt;&gt; I am trying to insert data into riak using w=1 and dw=1 (also tried
&gt;&gt; with dw = 0, w = 0).
&gt;&gt; For each risk object i have 4 indexes (2 binary 2 int).
&gt;&gt; Riak backend is leveldb.
&gt;&gt;
&gt;&gt; I can't get more than 300 inserts per second.
&gt;&gt; I have also tried running 2 threads each hitting the different node.
&gt;&gt; Nothing changed too much.
&gt;&gt;
&gt;&gt; Is this normal behavior ?
&gt;&gt;
&gt;&gt; --
&gt;&gt; Catalin Constantin
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Catalin Constantin
&gt;&gt; Dazoot Software
&gt;&gt; http://www.dazoot.eu/
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/\\*\\*mailman/listinfo/riak-users\\_\\*\\*lists.basho.com
&gt;&gt;
&gt;


-- 
Catalin Constantin
Dazoot Software
http://www.dazoot.eu/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

