---
title: "Re: Riak Cluster Behavior - Clarification"
description: ""
project: community
lastmod: 2016-05-31T14:10:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17440"
mailinglist_parent_id: "msg17408"
author_name: "Vikram Lalit"
project_section: "mailinglistitem"
sent_date: 2016-05-31T14:10:36-07:00
---


Hi Alexander - thanks again for your inputs here. I believe the problem
here was with the sloppy quorum coming in when I brought down 1 node. The
failover node would get active and from what I understand from the
documentation, since the failover did not have the key and could
potentially respond faster than the fetch, I randomly failed to fetch any
data till all the read repairs completed.

Understand this much better now - many thanks once again...

On Tue, May 24, 2016 at 4:24 PM, Alexander Sicular 
wrote:

&gt; Hi Vikram,
&gt;
&gt; If you're using the defaults, two of copies may be on the same
&gt; machine. When using the default values (ring\\_size=64, n\\_val=3) you are
&gt; not guaranteed copies on distinct physical machines. Implement a
&gt; back-off retry design pattern. aka, fail once, try again with r=1.
&gt; Also, a read will trigger a read repair operation which will then copy
&gt; your data n\\_val times to surviving members of the cluster.
&gt;
&gt; Have you tried that?
&gt; -Alexander
&gt;
&gt; Read these blog posts for more info:
&gt;
&gt; http://basho.com/posts/technical/understanding-riaks-configurable-behaviors-part-1/
&gt; http://basho.com/posts/technical/riaks-config-behaviors-part-2/
&gt; http://basho.com/posts/technical/riaks-config-behaviors-part-3/
&gt; http://basho.com/posts/technical/riaks-config-behaviors-part-4/
&gt;
&gt; On Tue, May 24, 2016 at 3:08 PM, Vikram Lalit 
&gt; wrote:
&gt; &gt; It's returning no object at all for the relevant key. That too is random
&gt; -
&gt; &gt; every few calls it returns but then it doesn't.
&gt; &gt;
&gt; &gt; On May 24, 2016 4:06 PM, "Sargun Dhillon"  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; What do you mean it's not returning? It's returning stale data? Or
&gt; &gt;&gt; it's erroring?
&gt; &gt;&gt;
&gt; &gt;&gt; On Tue, May 24, 2016 at 7:34 AM, Vikram Lalit 
&gt; &gt;&gt; wrote:
&gt; &gt;&gt; &gt; Hi - I'd appreciate if someone can opine on the below behavior of Riak
&gt; &gt;&gt; &gt; that
&gt; &gt;&gt; &gt; I am observing... is that expected, or something wrong in my set-up /
&gt; &gt;&gt; &gt; understanding?
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; To summarize, I have a 3-node Riak cluster (separate EC2 AWS
&gt; instances)
&gt; &gt;&gt; &gt; with
&gt; &gt;&gt; &gt; a separate chat server connecting to them. When I write data on the
&gt; Riak
&gt; &gt;&gt; &gt; nodes, the process is successful and I can read all data correctly.
&gt; &gt;&gt; &gt; However,
&gt; &gt;&gt; &gt; as part of my testing, if I deliberately bring down one node (and then
&gt; &gt;&gt; &gt; remove it from the cluster using riak-admin cluster force-remove /
&gt; plan
&gt; &gt;&gt; &gt; /
&gt; &gt;&gt; &gt; commit), the client API is not able to fetch all the written data. In
&gt; &gt;&gt; &gt; fact,
&gt; &gt;&gt; &gt; there is an alternation of success and failure which happens rather
&gt; &gt;&gt; &gt; randomly.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; My initial suspicion was that it would be happening only during the
&gt; time
&gt; &gt;&gt; &gt; the
&gt; &gt;&gt; &gt; rebalancing is occurring (i.e. riak-admin ring-status is not fully
&gt; &gt;&gt; &gt; settled)
&gt; &gt;&gt; &gt; but I've seen this sporadic behavior post the same too.
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Does this have to do with the n and r values for the cluster and given
&gt; &gt;&gt; &gt; that
&gt; &gt;&gt; &gt; 1 node is down, the cluster does not succeed in returning results
&gt; &gt;&gt; &gt; reliably?
&gt; &gt;&gt; &gt; Also, does this mean that during the time a cluster is being
&gt; rebalanced
&gt; &gt;&gt; &gt; (even incl. addition of new nodes), the results could be arbitrary -
&gt; &gt;&gt; &gt; that
&gt; &gt;&gt; &gt; doesn't sound correct to me?
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Appreciate if someone can throw some light here? Also, the HTTP API
&gt; &gt;&gt; &gt; calls to
&gt; &gt;&gt; &gt; retrieve and set the n / r / w values for a specific bucket - couldn't
&gt; &gt;&gt; &gt; locate the same!
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Thanks much!
&gt; &gt;&gt; &gt; Vikram
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; &gt; riak-users mailing list
&gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

