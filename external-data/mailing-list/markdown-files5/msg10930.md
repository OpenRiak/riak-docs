---
title: "Re: \"expected_binaries\" error in search"
description: ""
project: community
lastmod: 2013-04-17T14:18:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10930"
mailinglist_parent_id: "msg10929"
author_name: "Rob Speer"
project_section: "mailinglistitem"
sent_date: 2013-04-17T14:18:48-07:00
---


So, actually, it turns out that's not exactly the command I typed. I
actually typed:

curl -v -XPUT -H "Content-Type: application/json" -d '{"terms": "",
segments: "d do doc docs"}' '
http://riak.lumi:8098/riak/test-search/doc9?returnbody=true'

That is, I left out a pair of quotation marks, so my document was not a
valid JSON document. If I add them in, it works.

This was not the same problem I originally encountered, then, because the
"expected\\_binaries" error occurred with correct, programmatically-generated
JSON.


On Wed, Apr 17, 2013 at 4:54 PM, Rob Speer  wrote:

&gt; Oh right, and here's the error I get over HTTP when I run the second
&gt; command:
&gt;
&gt; &gt; PUT /riak/test-search/doc9?returnbody=true HTTP/1.1
&gt; &gt; User-Agent: curl/7.27.0
&gt; &gt; Host: riak.lumi:8098
&gt; &gt; Accept: \\*/\\*
&gt; &gt; Content-Type: application/json
&gt; &gt; Content-Length: 39
&gt; &gt;
&gt; &lt; HTTP/1.1 500 Internal Server Error
&gt; &lt; Vary: Accept-Encoding
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.9.2 (someone had painted it blue)
&gt; &lt; Date: Wed, 17 Apr 2013 20:42:25 GMT
&gt; &lt; Content-Type: text/html
&gt; &lt; Content-Length: 1190
&gt; &lt;
&gt; 500 Internal Server
&gt; ErrorInternal Server Error
=====================

The server
&gt; encountered an error while processing this request:  

```
{error,
&gt;     {error,badarg,
&gt;         [{erlang,iolist_to_binary,
&gt;              [{hook_crashed,
&gt;                   {riak_search_kv_hook,precommit,error,function_clause}}],
&gt;              []},
&gt;          {wrq,append_to_response_body,2,[{file,"src/wrq.erl"},{line,205}]},
&gt;          {riak_kv_wm_object,handle_common_error,3,
&gt;              [{file,"src/riak_kv_wm_object.erl"},{line,998}]},
&gt;          {webmachine_resource,resource_call,3,
&gt;              [{file,"src/webmachine_resource.erl"},{line,183}]},
&gt;          {webmachine_resource,do,3,
&gt;              [{file,"src/webmachine_resource.erl"},{line,141}]},
&gt;          {webmachine_decision_core,resource_call,1,
&gt;              [{file,"src/webmachine_decision_core.erl"},{line,48}]},
&gt;          {webmachine_decision_core,accept_helper,0,
&gt;              [{file,"src/webmachine_decision_core.erl"},{line,606}]},
&gt;          {webmachine_decision_core,decision,1,
&gt;
&gt;  
&gt; [{file,"src/webmachine_decision_core.erl"},{line,577}]}]}}
```


---

mochiweb+webmachine
&gt; web server


&gt;
&gt;
&gt;
&gt; On Wed, Apr 17, 2013 at 4:51 PM, Rob Speer  wrote:
&gt;
&gt;&gt; I reproduced this at the command line. Here I'm storing two documents,
&gt;&gt; with IDs 'doc8' and 'doc9', into a search-enabled bucket named
&gt;&gt; 'test-search'.
&gt;&gt;
&gt;&gt; # This command works, even though 'lsh' is empty. I believe this is
&gt;&gt; because I've never put a field named 'lsh' in this bucket, 'test-search'.
&gt;&gt; curl -v -XPUT -H "Content-Type: application/json" -d '{"terms": "empty|en
&gt;&gt; string|en test|en", "lsh": "", "segments": "d do doc docs"}' '
&gt;&gt; http://riak.lumi:8098/riak/test-search/doc8?returnbody=true'
&gt;&gt;
&gt;&gt; # However, if I use the empty string for a field that has ever been
&gt;&gt; indexed before, \\*then\\* I get a crash.
&gt;&gt; curl -v -XPUT -H "Content-Type: application/json" -d '{"terms": "",
&gt;&gt; "segments": "d do doc docs"}' '
&gt;&gt; http://riak.lumi:8098/riak/test-search/doc9?returnbody=true'
&gt;&gt;
&gt;&gt;
&gt;&gt; As requested, I typed that redbug command into the Erlang console, and at
&gt;&gt; the moment of the crash I get some output. The output baffles me, though.
&gt;&gt; The included ID is in the style of ID we use for actual documents, which
&gt;&gt; are stored in totally different buckets, and which I didn't refer to at all
&gt;&gt; in my testing.
&gt;&gt;
&gt;&gt; 16:42:24 &lt;{mochiweb\\_acceptor,init,3}&gt; {riak\\_solr\\_xml\\_xform,xform,
&gt;&gt; [&lt;&lt;"xml version=\\"1.0\\"
&gt; ?&gt;uuid-10f1a788ead64125bd7251ffc5308882"&gt;&gt;]}
&gt;&gt;
&gt;&gt; 16:42:24 &lt;{mochiweb\\_acceptor,init,3}&gt; {riak\\_solr\\_xml\\_xform,xform,1} -&gt;
&gt;&gt; {ok,
&gt;&gt;
&gt;&gt; delete,
&gt;&gt;
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,
&gt;&gt;
&gt;&gt; &lt;&lt;"uuid-10f1a788ead64125bd7251ffc5308882"&gt;&gt;}]}
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Apr 16, 2013 at 2:55 PM, Ryan Zezeski  wrote:
&gt;&gt;
&gt;&gt;&gt; Rob,
&gt;&gt;&gt;
&gt;&gt;&gt; I don't know what the exact data is. The thing is that it doesn't seem
&gt;&gt;&gt;&gt; to cause an error on the client side; it just shows up in the server logs
&gt;&gt;&gt;&gt; to be noticed later.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; A non-2XX response will be returned. Verify that the response is 200.
&gt;&gt;&gt; If it isn't log an error in your app with the exact data passed.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have a suspicion, though. Is it possible that when I set one of the
&gt;&gt;&gt;&gt; search fields to the empty string, some protocol along the way turns that
&gt;&gt;&gt;&gt; into the empty list, which then fails the type-check?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; This is my initial suspicion as well. If you can figure out the data
&gt;&gt;&gt; causing the issue then run that redbug line while inserting the data. From
&gt;&gt;&gt; the output of that I should be able to figure out what is happening.
&gt;&gt;&gt;
&gt;&gt;&gt; -Z
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

