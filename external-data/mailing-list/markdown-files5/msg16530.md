---
title: "Re: Moving the anti-entropy directory (riak 1.4)"
description: ""
project: community
lastmod: 2015-09-16T01:13:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16530"
mailinglist_parent_id: "msg16529"
author_name: "Sujay Mansingh"
project_section: "mailinglistitem"
sent_date: 2015-09-16T01:13:16-07:00
---


Thanks for confirming Magnus.

Hopefully all the disk-usage alerts will now be a thing of the past!

Sujay

On Tue, Sep 15, 2015 at 2:59 PM, Magnus Kessler  wrote:

&gt; On 11 September 2015 at 11:45, Sujay Mansingh  wrote:
&gt;
&gt;&gt; On our riak cluster machines, we have a separate disk which stores all
&gt;&gt; the bitcask data (in /data)
&gt;&gt;
&gt;&gt; This is so that we can have a (relatively) small disk for the OS, and
&gt;&gt; have a big disk for /data.
&gt;&gt;
&gt;&gt; $ df -h / /data
&gt;&gt; Filesystem Size Used Avail Use% Mounted on
&gt;&gt; /dev/root 20G 11G 7.9G 57% /
&gt;&gt; /dev/md3 3.6T 277G 3.1T 9% /data
&gt;&gt;
&gt;&gt; However, especially more so lately, we see that the /var/lib/riak
&gt;&gt; directory often becomes very large.
&gt;&gt;
&gt;&gt; $ pwd
&gt;&gt; /var/lib/riak
&gt;&gt; $ du -hcs \\*
&gt;&gt; 9.3G anti\\_entropy
&gt;&gt; 1.1M kv\\_vnode
&gt;&gt; 104K ring
&gt;&gt; 9.3G total
&gt;&gt;
&gt;&gt; So we see that the anti\\_entropy directory takes up 9.3GB (almost half of
&gt;&gt; /). (Sometimes it balloons to 18GB, almost taking up the disk. We then
&gt;&gt; restart riak to get the disk usage down.)
&gt;&gt;
&gt;&gt; I want to move that directory off /.
&gt;&gt;
&gt;&gt; Here are the steps I want to perform on each node.
&gt;&gt;
&gt;&gt; 1. Stop riak
&gt;&gt; 2. Move /data to /riak/data (I will have to change the name of the
&gt;&gt; mount point)
&gt;&gt; 3. Move /var/lib/riak/anti\\_entropy to /riak/anti\\_entropy
&gt;&gt; 4. Change the following items in app.config
&gt;&gt; - Change {anti\\_entropy\\_data\\_dir, "/var/lib/riak/anti\\_entropy"}, to 
&gt;&gt; {anti\\_entropy\\_data\\_dir,
&gt;&gt; "/riak/anti\\_entropy"},
&gt;&gt; - Change {data\\_root, "/data"} to {data\\_root, "/riak/data"}
&gt;&gt; 5. Start riak
&gt;&gt;
&gt;&gt; I just wanted to confirm that if I move the files and change the config,
&gt;&gt; riak will simply start up and continue as before.
&gt;&gt;
&gt;&gt;
&gt; Hi Sujay,
&gt;
&gt; The steps you outlined are going to work fine. Please make sure that the
&gt; newly created '/riak' directory has the correct file permissions for the
&gt; 'riak' user.
&gt;
&gt; Regards,
&gt;
&gt; Magnus
&gt;
&gt;
&gt;&gt; Thanks!
&gt;&gt;
&gt;&gt; Sujay
&gt;&gt; ​
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Magnus Kessler
&gt; Client Services Engineer @ Basho
&gt;
&gt; Registered Office - 8 Lincoln’s Inn Fields London WC2A 3BP Reg 07970431
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

