---
title: "Re: Unable to create anonymous user"
description: ""
project: community
lastmod: 2015-11-25T10:15:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16816"
mailinglist_parent_id: "msg16815"
author_name: "Shawn Debnath"
project_section: "mailinglistitem"
sent_date: 2015-11-25T10:15:52-08:00
---


I have had issues where passing the POST body via —data didn’t work.

# Create credentials
curl -v --retry 5 --retry-delay 5 -XPOST "http://127.0.0.1:8080/riak-cs/user" \\
 -H "Content-Type: application/json" \\
 --data '{"email”:”f...@bar.com", "name”:"foobar”}'

Another way I have tried to do it via curl is:

curl –v -X POST -d @foobar.json "http://127.0.0.1:8080/riak-cs/user" --header 
"Content–Type:application/json”

Given you are having trouble diagnosing whats getting up there, a good thing to 
do would be increase the verbosity level for curl by doing –vvv.

Been using the above two methods successfully for a while in PROD. One thing to 
note is that I always run it from the server itself.


From: riak-users 
&gt; 
on behalf of Dmitri Zagidulin 
&gt;
Date: Wednesday, November 25, 2015 at 8:54 AM
To: Ben Rudolph &gt;
Cc: riak-users &gt;
Subject: Re: Unable to create anonymous user

Ben,

Not sure what to advise. Your configs look ok.
I just downloaded a fresh copy of Riak CS 2.0.1, Stanchion, and a fresh Riak 2.
I set up the configs just as you have (changing only the paths in 
advanced.config to match my machine).
Cutting and pasting your curl line seems to result in correct user creation.
So, the dreaded "Works For Me (tm)".

The only thing I can think of is - double and triple-check all involved 
firewalls.
Searching about for that error message let me to this thread:
http://riak-users.197444.n3.nabble.com/adding-auth-user-not-valid-td4033452.html

Which indicates that the error message can be caused by CS not being able to 
access Stanchion. You mentioned that you can telnet into stanchion\\_host from 
the riak node. Is Stanchion set to listen to the correct IP and port?

Dmitri







On Wed, Nov 25, 2015 at 10:16 AM, Ben Rudolph 
&gt; wrote:
Thanks for the response Dmitri. Just double checked all those settings

1) I checked with stanchion ping and i'm also able to telnet into the 
stanchion\\_host from the riak node
2)Double checked and it shows up in the logs:
&lt;0.142.0&gt;@riak\\_cs\\_config:warnings:120 `anonymous\\_user\\_creation` is set as true. 
Set this as false when this CS nodes is populated as public service.
3) Yes
4) Yes

In case useful, here are our configs: 
https://github.com/dimagi/commcarehq-ansible/tree/riak/ansible/roles/riakcs/templates

On Wed, Nov 25, 2015 at 10:04 AM, Dmitri Zagidulin 
&gt; wrote:
Hi Ben,

Just to double-check:
1) is Stanchion installed and running, when you try to create the user? (and 
the stanchion\\_host entry is pointing to it, in cs config?)

2) is anonymous\\_user\\_creation = on in the config file?

3) do you have 'buckets.default.allow\\_mult = true' in the Riak config file?

4) (this is likely to be yes, but just to check) Have you restarted Riak since 
configuring the advanced.config backend?

Dmitri

On Tue, Nov 24, 2015 at 6:40 PM, Ben Rudolph 
&gt; wrote:
Hi,

I've almost completed the cluster setup but am running into issues with 
anonymous user creation. All machines ping/pong and their IPs are matching. 
When I run the curl command to create an anonymous user:

curl -H 'Content-Type: application/json' -XPOST http://\\*\\*:8080/riak-cs/user 
--data '{"email":"em...@email.com", 
"name":"admin\\_user"}'

And I get an XML response that says Internal Server Error. The console.log file 
looks like this:

2015-11-24 23:16:35.572 [error] &lt;0.439.0&gt; Webmachine error at path 
"/riak-cs/user" : 
{error,{error,{badmatch,{error,malformed\\_xml}},[{riak\\_cs\\_s3\\_response,xml\\_error\\_code,1,[{file,"src/riak\\_cs\\_s3\\_response.erl"},{line,335}]},{riak\\_cs\\_s3\\_response,error\\_response,1,[{file,"src/riak\\_cs\\_s3\\_response.erl"},{line,249}]},{riak\\_cs\\_wm\\_user,accept\\_json,2,[{file,"src/riak\\_cs\\_wm\\_user.erl"},{line,119}]},{webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_resource.erl"},{line,186}]},{webmachine\\_resource,do,3,[{file,"src/webmachine\\_resource.erl"},{line,142}]},{webmachine\\_decision\\_core,resource\\_call,...},...]}}
 in riak\\_cs\\_s3\\_response:xml\\_error\\_code/1 line 335

Which led me to this issue here. 
However my advanced.config already looks like this (which is what is suggested 
in the issue):
[
 {riak\\_kv, [
 {add\\_paths, ["/usr/lib/riak-cs/lib/riak\\_cs-2.0.1/ebin"]},
 {storage\\_backend, riak\\_cs\\_kv\\_multi\\_backend},
 {multi\\_backend\\_prefix\\_list, [{&lt;&lt;"0b:"&gt;&gt;, be\\_blocks}]},
 {multi\\_backend\\_default, be\\_default},
 {multi\\_backend, [
 {be\\_default, riak\\_kv\\_eleveldb\\_backend, [
 {total\\_leveldb\\_mem\\_percent, 30},
 {data\\_root, "/opt/data/riak/leveldb"}
 ]},
 {be\\_blocks, riak\\_kv\\_bitcask\\_backend, [
 {data\\_root, "/opt/data/riak/bitcask"}
 ]}
 ]}
 ]}
].

Any insight would be useful!

Thanks,
Ben

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com




\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

