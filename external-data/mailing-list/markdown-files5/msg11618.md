---
title: "using 2i with protocol buffers"
description: ""
project: community
lastmod: 2013-07-18T23:11:35-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11618"
author_name: "Joey Yandle"
project_section: "mailinglistitem"
sent_date: 2013-07-18T23:11:35-07:00
---


Hi everbody,

I'm using riak to store large numbers of FX rates, to allow for deep
backtests of trading strategies. My code seems to be working, except
that I don't get any keys back from 2i range requests.

Here's the code which puts the rate into riak (the rate is itself a
protocol buffers object):

 std::string s = p-&gt;rate().time();
 std::string rate;
 p-&gt;rate().SerializeToString(&rate);

 mrx::riak::RpbPutReqPtr req(new mrx::riak::RpbPutReq());

 req-&gt;set\\_bucket(symbol);
 req-&gt;set\\_key(s);

 mrx::riak::RpbContent\\* content = req-&gt;mutable\\_content();

 content-&gt;set\\_value(rate);

 mrx::riak::RpbPair\\* index = content-&gt;add\\_indexes();

 index-&gt;set\\_key(vm["riak.index"].as());
 index-&gt;set\\_value(s);

Here's the code which does the index search:

 mrx::riak::RpbIndexReqPtr req(new mrx::riak::RpbIndexReq());

 req-&gt;set\\_bucket(symbol);
 req-&gt;set\\_index(vm["riak.index"].as());
 req-&gt;set\\_qtype(mrx::riak::RpbIndexReq::range);

 req-&gt;set\\_range\\_min(vm["rates.start"].as());
 req-&gt;set\\_range\\_max(vm["rates.end"].as());

I originally used the string "time" as the index key, and there was no
error when doing the put command. However, when trying to search with
this index, I got the following error:

 [{unknown\\_field\\_type,&lt;&lt;"time"&gt;&gt;}]

This error went away when I used "time\\_bin" as the index. However,
regardless of what I use as the index key when doing the put, I never
get any keys returned during the search.

Can someone point me to a working example of using protocol buffers to
do a put and subsequent index search? The examples online only show the
latter.

thanks,

Joey

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

