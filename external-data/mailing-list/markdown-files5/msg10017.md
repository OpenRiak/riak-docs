---
title: "Re: Bucket creation."
description: ""
project: community
lastmod: 2013-02-06T07:10:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10017"
mailinglist_parent_id: "msg10014"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-02-06T07:10:06-08:00
---


The NullReferenceException is painful, I agree. I've filed an bug report on
GitHub (https://github.com/DistributedNonsense/CorrugatedIron/issues/71) so
you can track the progress of a fix. IIRC, Riak actually sends a 404 back
to the client but we're not catching it for some reason. (I could be wrong,
I was watching Downton Abbey at the time.)

As far as reserved characters, I'm going to punt that back to the Basho
folks. Not out of spite, but just out of being busy.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Wed, Feb 6, 2013 at 6:54 AM, Kevin Burton wrote:

&gt; Thank you.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; As a slight suggestion. It would be helpful if the illegal characters were
&gt; documented someplace and in which situations they are illegal. Along the
&gt; lines of SQL and special characters it is well documented when there is a
&gt; requirement to use square brackets. Here getting a NullReferenceException
&gt; does not help in diagnosing that the problem is with special characters.\\*\\*
&gt; \\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; \\*From:\\* riak-users [mailto:riak-users-boun...@lists.basho.com] \\*On Behalf
&gt; Of \\*Jeremiah Peschka
&gt; \\*Sent:\\* Wednesday, February 06, 2013 8:45 AM
&gt; \\*To:\\* riak-users@lists.basho.com
&gt; \\*Subject:\\* Re: Bucket creation.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; Kevin - in this specific case, Riak itself will accept a slash in the key
&gt; name. It will not, however, accept a slash through the HTTP interface. See
&gt; http://riak.markmail.org/search/?q=slash#query:slash+page:1+mid:5j5jb4maepr3epc3+state:resultsThe
&gt; short version is that there's no sane way we can safely check strings
&gt; for validity since all bucket and key names are valid, but they're
&gt; different values of valid depending on the API you're using at the time.\\*\\*
&gt; \\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; As best as I can tell, there's no restriction on the riak KV side about
&gt; how a bucket or key is named. As far as Erlang is concerned it's just a
&gt; bunch of bytes masquerading as a string. If you do anything goofy and want
&gt; that goofy/unexpected name to work everywhere you need to properly escape
&gt; your bucket name. This is similar to how SQL Server requires square
&gt; brackets around reserved keywords or database objects with special
&gt; characters in their name (e.g. CREATE TABLE [i like data] ( id INT ); ). As
&gt; long as names are correctly escaped, you won't run into any problems.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; Continuing the same analogy, CorrugatedIron is a lot like ADO.NET. If I
&gt; create a SqlCommand with CommandText of "OMGWTFBBQ", The SqlCommand object
&gt; doesn't care trying to do or that what I passed in probably isn't valid
&gt; T-SQL, it only knows that I've given it a command that needs to be sent to
&gt; a SQL Server.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; OJ and I have debated how much smarts CorrugatedIron should have. Our
&gt; ultimate decision is that it should have just enough smarts to get the job
&gt; done and not a speck more. It's a relatively low level client (along the
&gt; lines of ADO.NET), but we do what we can to hide a lot of the nastiness
&gt; and idiosyncrasies of Riak from the user in places where it might get
&gt; confusing. One of the things we hide is the dual nature of Riak's API.
&gt; Almost all operations are supported via ProtocolBuffers (which doesn't care
&gt; about names) but a few are only supported through HTTP.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; I hope this helps clear up some of your questions.\\*\\*\\*\\*
&gt;
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; ---\\*\\*\\*\\*
&gt;
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited\\*\\*\\*\\*
&gt;
&gt; MCITP: SQL Server 2008, MVP\\*\\*\\*\\*
&gt;
&gt; Cloudera Certified Developer for Apache Hadoop\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; On Wed, Feb 6, 2013 at 5:32 AM, OJ Reeves  wrote:\\*\\*\\*\\*
&gt;
&gt; I am not aware of the rules in bucket naming, I don't even know if there
&gt; are any or if they're documented anywhere. All I can say is that I wouldn't
&gt; personally use a forward-slash because it's an obvious conflict with other
&gt; areas of the system.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; OJ\\*\\*\\*\\*
&gt;
&gt; On Wed, Feb 6, 2013 at 10:44 PM, Kevin Burton 
&gt; wrote:\\*\\*\\*\\*
&gt;
&gt; The set properties method returns without error on the "illegally named"
&gt; bucket as do all of the put operations. It is just the get properties
&gt; operation that returns an error. If the bucket is indeed improperly named
&gt; then the bug is in the operations that allow the bucket name. Right?\\*\\*\\*\\*
&gt;
&gt;
&gt; On Feb 5, 2013, at 10:44 PM, Alexander Moore  wrote:
&gt; \\*\\*\\*\\*
&gt;
&gt; I think the problem you are having here is that you are using an invalid
&gt; bucket name.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; "buyseasons/products" would actually refer to a bucket/key pair. Riak
&gt; doesn't have nested buckets. \\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; If you change your bucket name to "buyseasons-products" or
&gt; "buyseasons%20products" it should work.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; As for the weird/misleading exception, I'll report it to CorrugatedIron. \\*
&gt; \\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; Thanks,\\*\\*\\*\\*
&gt;
&gt; Alex Moore\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; I still have a question. Based on your input I modified the code slightly
&gt; as follows:\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; RiakBucketProperties bucketProperties = new
&gt; RiakBucketProperties();\\*\\*\\*\\*
&gt;
&gt; bucketProperties.SetNVal(4);\\*\\*\\*\\*
&gt;
&gt; bucketProperties.SetSearch(true);\\*\\*\\*\\*
&gt;
&gt; bucketProperties.SetAllowMultiple(true);\\*\\*\\*\\*
&gt;
&gt; bucketProperties.SetWVal("all");\\*\\*\\*\\*
&gt;
&gt; bucketProperties.SetRVal("quorum");\\*\\*\\*\\*
&gt;
&gt; if (!client.SetBucketProperties("buyseasons/products",
&gt; bucketProperties).IsSuccess)\\*\\*\\*\\*
&gt;
&gt; {\\*\\*\\*\\*
&gt;
&gt; Console.WriteLine("Setting bucket properties failed");\\*\\*\\*\\*
&gt;
&gt; }\\*\\*\\*\\*
&gt;
&gt; RiakResult riakBuckpropertiesResult =
&gt; client.GetBucketProperties("buyseasons/products", true);\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; But I get a NullReferenceException\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; at CorrugatedIron.Models.RiakBucketProperties.ReadQuorum(JObject props,
&gt; String key, Action`1 setter)\\*\\*\\*\\*
&gt;
&gt; at CorrugatedIron.Models.RiakBucketProperties..ctor(RiakRestResponse
&gt; response)\\*\\*\\*\\*
&gt;
&gt; at CorrugatedIron.RiakClient.GetBucketProperties(String bucket, Boolean
&gt; extended)\\*\\*\\*\\*
&gt;
&gt; . . . . .\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; So the bucket should have been created when I set the properties. But then
&gt; I tried to read the properties back and I get the exception.\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; \\*From:\\* Alexander Sicular [mailto:sicul...@gmail.com ]
&gt;
&gt; \\*Sent:\\* Tuesday, February 05, 2013 5:17 PM
&gt; \\*To:\\* Kevin Burton
&gt; \\*Cc:\\* riak-users
&gt; \\*Subject:\\* Re: Bucket creation.\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; "buckets" are a virtual concept. you dont need to "create" them. just
&gt; write a key to any bucket. also by modifying the default bucket parameters,
&gt; by adding the search hook on a bucket, let's say, you are also "creating"
&gt; the bucket.\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; -alexander\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; On Tue, Feb 5, 2013 at 6:09 PM, Kevin Burton 
&gt; wrote:\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; I have filed to find code that would create a bucket. It must be in the
&gt; past I have just put objects into a bucket and Riak must construct the
&gt; bucket if it does not exist. Now I would like to create the bucket and set
&gt; some properties on that bucket. But I donâ€™t know how to create the bucket.
&gt; \\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; So I have code like:\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; BuildProduct(source, destination);\\*\\*\\*\\*
&gt;
&gt; RiakObject value = new RiakObject("products",
&gt; keySku, JsonConvert.SerializeObject(destination))\\*\\*\\*\\*
&gt;
&gt; {\\*\\*\\*\\*
&gt;
&gt; ContentType = "application/json"\\*\\*\\*\\*
&gt;
&gt; };\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; RiakResult response =
&gt; client.Put(value, new RiakPutOptions { W = 2 });\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; But I would like to create the bucket and set properties on the bucket
&gt; before I put things into the bucket. Like:\\*\\*\\*\\*
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; RiakResult riakBuckpropertiesResult =
&gt; client.GetBucketProperties("products", true);\\*\\*\\*\\*
&gt;
&gt; if (riakBuckpropertiesResult.IsSuccess)\\*\\*\\*\\*
&gt;
&gt; {\\*\\*\\*\\*
&gt;
&gt; riakBuckpropertiesResult.Value\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com\\*\\*\\*\\*
&gt;
&gt;
&gt;
&gt; \\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; --
&gt;
&gt; OJ Reeves\\*\\*\\*\\*
&gt;
&gt; +61 431 952 586
&gt; http://buffered.io/\\*\\*\\*\\*
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

