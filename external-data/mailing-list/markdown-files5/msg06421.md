---
title: "RE: Fastest way to count number of items in Secondary Index query"
description: ""
project: community
lastmod: 2012-01-25T17:12:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06421"
mailinglist_parent_id: "msg06420"
author_name: "Jeremy Raymond"
project_section: "mailinglistitem"
sent_date: 2012-01-25T17:12:59-08:00
---


Iâ€™m using the Erlang PB interface in my application. The Erlang client gets the 
keys via this Input/Query in riakc\\_pb\\_socket:get\\_index/4 at 
https://github.com/basho/riak-erlang-client/blob/master/src/riakc\\_pb\\_socket.erl#L677

 

 Input = {index, Bucket, Index, Key},

 IdentityQuery = [{reduce,

 {modfun, riak\\_kv\\_mapreduce, reduce\\_identity},

 [{reduce\\_phase\\_only\\_1, true}],

 true}],

 

My queries can return hundreds of thousands of keys. Transferring all the keys 
to the client and then doing a length/1 on them is slower than feeding the 
index query directly into riak\\_kv\\_mapreduce:reduce\\_count\\_inputs/2 and returning 
only the sum. I thought there might be a shortcut to avoid mapred altogether. 
Does the http interface access to some internals not available to a PB client 
that avoids this mapreduce OR is the HTTP interface doing the same thing as the 
Erlang client and just doing an index query fed into reduce\\_identity?

 

--

Jeremy

 

From: Ian Plosker [mailto:i...@basho.com] 
Sent: Wednesday, January 25, 2012 5:55 PM
To: Jeremy Raymond
Cc: riak-users@lists.basho.com
Subject: Re: Fastest way to count number of items in Secondary Index query

 

Jeremy, 

 

Requests to 2i's HTTP interface will return keys rather the objects themselves. 
You may find better performance counting the returned keys rather than 
employing a M/R job.

 

-- 

Ian Plosker 

Developer Advocate

Basho Technologies

 

On Monday, January 23, 2012 at 2:27 PM, Jeremy Raymond wrote:

What is the fastest way to count the number of items in a secondary

index range query? I'm currently feeding an index input directly into

the riak\\_kv\\_mapreduce:reduce\\_count\\_inputs/2. Anything faster than

doing this? Anyway to query an index without loading the objects

themselves?

 

--

Jeremy

 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_

riak-users mailing list

riak-users@lists.basho.com

http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

