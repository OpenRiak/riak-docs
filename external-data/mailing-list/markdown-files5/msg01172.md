---
title: "Re: bitcask 42?"
description: ""
project: community
lastmod: 2010-09-30T22:24:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01172"
author_name: "Bruce Lowekamp"
project_section: "mailinglistitem"
sent_date: 2010-09-30T22:24:09-07:00
---


Dan,

Thanks for the suggestions. Our startup script currently starts riak on each 
node, then goes back and joins each node to node 1, waiting until ringready is 
ok before advancing. Appropriate pauses added, and we had to reduce the gossip 
interval to 10 seconds to make it run quickly enough.

What we found was that 4 is apparently a minimum number of partitions per node. 
 When we increased the partitions, we got better distribution up to 63 nodes. 
With 128 partitions, it stopped distributing them beyond the 42nd node added 
(and wasn't balancing on those nodes).

Don't know if that is documented anywhere or not. I've seen recommendations 
for having more partitions, but we weren't aware there was a correctness issue.

Bruce


On Sep 30, 2010, at 4:16 PM, Dan Reverri wrote:

&gt; Hi Michael,
&gt; 
&gt; There is no hard coded limit to the number of nodes that can belong to a 
&gt; cluster. Depending on how quickly you are adding nodes to the cluster you may 
&gt; be running into an issue with the ring not converging on a single state.
&gt; 
&gt; Can you try using the "riak-admin ringready" command between each join of a 
&gt; node? This command will return TRUE if the nodes all agree on a particular 
&gt; ring state. You should run this command until it returns TRUE after each join.
&gt; 
&gt; Also, Alexander is correct; you should deploy your nodes with an increased 
&gt; value for the "ring\\_creation\\_size" parameter in app.config. The typical 
&gt; recommendation is to have a minimum of 10 partitions per node and the value 
&gt; should be a power of 2 (64, 128, 256, 512, 1024). For a 63 node cluster a 
&gt; value of 1024 would work well.
&gt; 
&gt; Thanks,
&gt; Dan
&gt; 
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt; 
&gt; 
&gt; On Thu, Sep 30, 2010 at 12:02 PM, Alexander Sicular  
&gt; wrote:
&gt; The default vnode number is 64. If you are connecting 63 physical nodes 
&gt; togeter in one riak cluster than you really want to increase the number of 
&gt; vnodes. There is some recommended metric for physical nodes to vnodes. I 
&gt; think it's like a minimum of 4 vnodes per physical node. But I could be 
&gt; totally making that up. 
&gt; 
&gt; -Alexander. 
&gt; 
&gt; 
&gt; @siculars on twitter
&gt; http://siculars.posterous.com
&gt; 
&gt; Sent from my iPhone
&gt; 
&gt; On Sep 30, 2010, at 14:26, Michael Colussi  wrote:
&gt; 
&gt;&gt; Hey guys,
&gt;&gt; 
&gt;&gt; My team was trying to launch a 63 node Riak cluster yesterday, using version 
&gt;&gt; 0.13rc3 and the bitcask backend.
&gt;&gt; 
&gt;&gt; All 63 nodes agreed that the ring consisted of nodes 1-42 only.
&gt;&gt; 
&gt;&gt; Any ideas? Is there a hardcoded limit to the number of nodes allowed?
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

