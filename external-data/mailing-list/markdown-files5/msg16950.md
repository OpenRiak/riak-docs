---
title: "Re: Riak-S2 javascript aws-sdk failing on multi-part uploads"
description: ""
project: community
lastmod: 2016-01-13T14:36:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16950"
mailinglist_parent_id: "msg16948"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2016-01-13T14:36:19-08:00
---


Hi John,

Does CyberDuck automatically enable multi-part uploads for files
greater than a certain size? Does the aws-sdk support multi-part
uploads?
--
Luke Bakken
Engineer
lbak...@basho.com


On Wed, Jan 13, 2016 at 1:24 PM, John Fanjoy  wrote:
&gt; Hello Everyone,
&gt;
&gt; I have been doing some searching around to see if anyone has come across the
&gt; specific issue I am having and can’t find anything. I have a project that
&gt; provides a file upload interface through a website and puts the uploaded
&gt; object into riak-cs. The front end uses the javascript aws-sdk 2.1.29 (tried
&gt; .19 as well) with a patch I found using the list archives to fix up some url
&gt; encoding issues with uploadIDs. Everything seems to work fine when the image
&gt; is less than 5mb (max part size), however when the object is larger the
&gt; ManagedUpload functionality of the S3 object is failing after the first
&gt; part. I’ve tested the code I’m using against a vanilla AWS bucket and a 400+
&gt; mb file was uploaded without issue. I tested the same file with riak-cs
&gt; using the aws-sdk and CyberDuck. Cyberduck was able to upload the file
&gt; without any failure, but it has not been successful even once using the
&gt; javascript library. I have turned the riak-cs debug logging on, and I am
&gt; getting some errors logged, but I’m not really sure how useful they are:
&gt;
&gt; ```
&gt; 2016-01-13 15:34:51.648 [error] &lt;0.1255.0&gt; Webmachine error at path
&gt; "/buckets/three2016com-devopsdevel/objects/DeSMan\\_Ep1\\_Create\\_Website\\_720p\\_DRAFT%2520%25281%2529.mov/uploads/kL9dRGLaQCiZBNnPSpu5mw=="
&gt; :
&gt; {error,{error,{badmatch,{error,closed}},[{webmachine\\_request,recv\\_unchunked\\_body,3,[{file,"src/webmachine\\_request.erl"},{line,490}]},{riak\\_cs\\_wm\\_object\\_upload\\_part,accept\\_streambody,4,[{file,"src/riak\\_cs\\_wm\\_object\\_upload\\_part.erl"},{line,308}]},{riak\\_cs\\_wm\\_object\\_upload\\_part,accept\\_body,2,[{file,"src/riak\\_cs\\_wm\\_object\\_upload\\_part.erl"},{line,224}]},{riak\\_cs\\_wm\\_common,accept\\_body,2,[{file,"src/riak\\_cs\\_wm\\_common.erl"},{line,342}]},{webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_re..."},...]},...]}}
&gt; in webmachine\\_request:recv\\_unchunked\\_body/3 line 490
&gt; ```
&gt;
&gt; This error does not show up when using Cyberduck or performing an upload
&gt; that is &lt;5mb using javascript. I’ve tried riak-cs 1.5 and now risk-s2 2.1.0
&gt; with out any success. Any help you can offer would be greatly appreciated.
&gt; If you have any questions for me or need additional information let me know
&gt; and I’ll fill in any holes I left.
&gt;
&gt;
&gt;
&gt; Thank you in advance,
&gt;
&gt; John Fanjoy
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

