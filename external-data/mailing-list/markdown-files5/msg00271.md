---
title: "empty list when running the mapreduce script"
description: ""
project: community
lastmod: 2010-05-06T06:39:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00271"
mailinglist_parent_id: "msg00264"
author_name: "Matthew Pflueger"
project_section: "mailinglistitem"
sent_date: 2010-05-06T06:39:09-07:00
---


Hi Norman,

I ran into the same problem when following The Riak Fast Track. My
problem was that the script actually wasn't importing anything. I
changed the script as follows which worked. Maybe it will work for
you...

#!/usr/bin/env escript
main([Filename]) -&gt;
 {ok, Data} = file:read\\_file(Filename),
 %%Lines = tl(re:split(Data, "\\r?\\n", [{return, binary},trim])),
 Lines = tl(re:split(Data, "\\r\\n|\\n|\\r", [{return, binary},trim])),
 %%lists:foreach(fun(L) -&gt; LS = re:split(L, ","),
format\\_and\\_insert(LS) end, Lines).
 AccOut = lists:foldl(fun(L, AccIn) -&gt; LS = re:split(L, ","),
format\\_and\\_insert(LS, AccIn), AccIn + 1 end, 1, Lines),
 io:format("Inserted ~w lines~n", [AccOut]).

format\\_and\\_insert(Line, AccIn) -&gt;
 JSON = 
io\\_lib:format("{\\"Date\\":\\"~s\\",\\"Open\\":~s,\\"High\\":~s,\\"Low\\":~s,\\"Close\\":~s,\\"Volume\\":~s,\\"Adj
Close\\":~s}", Line),
 %%Command = io\\_lib:format("curl -X PUT
http://127.0.0.1:8091/riak/goog/~s -d '~s' -H 'content-type:
application/json'", [hd(Line),JSON]),
 Command = io\\_lib:format("curl -X PUT
http://127.0.0.1:8091/riak/goog/~w -d '~s' -H 'content-type:
application/json'", [AccIn,JSON]),
 io:format("Inserting line ~w: ~s~n", [AccIn, hd(Line)]),
 os:cmd(Command).


--Matthew

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

