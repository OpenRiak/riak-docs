---
title: "Re: LevelDB parameter planning - max_open_files"
description: ""
project: community
lastmod: 2014-04-04T08:15:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13997"
mailinglist_parent_id: "msg13995"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2014-04-04T08:15:55-07:00
---


Oleksiy,

Go to step 6: "Compare Step 2 and Step 5 â€¦". There is a link to an Excel 
spreadsheet at the end of the sentence "The above calculations are automated in 
this memory model spreadsheet.". Forget the text and use the spreadsheet 
(memory model spreadsheet).

Much of that text is still related to memory management of 1.2 and 1.3. Seems 
it did not get updated to 1.4. Hmm, that might be my fault.

Answers to your comments/questions below:

1. Step 3 on the page is just wrong with 1.4: open\\_file\\_memory = 
(max\\_open\\_files -10) \\* 4194304

2. average\\_sst\\_filesize is not relevant with 1.4. It was used to estimate the 
size of the bloom filter attached to each .sst file. There is now a fixed 
maximum of 150,001 bytes for the bloom filter, and it is the typical size for 
all files in levels 2 through 6.

3. The page is attempting to estimate the total memory usage of one vnode. 
The spreadsheet does the same. Therefore the maximum memory per either model 
is the "working memory per vnode" in Step 5, or the "working per vnode" line in 
the spreadsheet, multiplied by the number of vnodes active on the node (server).


Now let me make a related note / sales pitch. The upcoming Riak 2.0 eliminates 
all the manual calculations / planning. You tell Riak what percentage of 
memory is allocated to leveldb. leveldb then dynamically adjusts each vnode's 
allocation as your dataset changes and/or vnodes are moved to and from the node 
(server). 

Matthew


On Apr 4, 2014, at 5:08 AM, Oleksiy Krivoshey  wrote:

&gt; Can someone please suggest how to understand the formula for open\\_file\\_memory 
&gt; on this page: 
&gt; http://docs.basho.com/riak/latest/ops/advanced/backends/leveldb/#Parameter-Planning
&gt; 
&gt; 1. It definitely lacks some brackets, the correct formula is:
&gt; 
&gt; OPEN\\_FILE\\_MEMORY = (max\\_open\\_files-10) \\* (184 + (average\\_sst\\_filesize/2048) 
&gt; \\* (8+((key\\_size+value\\_size)/2048 +1)\\*0.6))
&gt; 
&gt; 
&gt; 2. How to estimate average\\_sst\\_filesize?
&gt; 
&gt; 
&gt; 3. does the result estimate the memory used by a single open file in any 
&gt; particular vnode? Or by a single vnode with max\\_open\\_files open? As 
&gt; max\\_open\\_files is a per vnode parameter then how to estimate the maximum 
&gt; memory used by leveldb if all vnodes have all max\\_open\\_files open? is it 
&gt; result\\*ring\\_size or result\\*ring\\_size\\*max\\_open\\_files?
&gt; 
&gt; 
&gt; Thanks!
&gt; 
&gt; -- 
&gt; Oleksiy
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

