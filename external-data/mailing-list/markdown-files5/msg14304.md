---
title: "Re: riak-cs reclaim storage"
description: ""
project: community
lastmod: 2014-06-09T09:48:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14304"
mailinglist_parent_id: "msg14303"
author_name: "Tyler Flint"
project_section: "mailinglistitem"
sent_date: 2014-06-09T09:48:36-07:00
---


Unfortunately, it doesn’t seem to have made a difference. 

I did restart the riak-cs process after updating the app.config. Triggering a 
riak-cs-gc batch did trigger a job, but did not seem to yield any results.

I’m a bit concerned that I’m unable to root cause the issue here. Is there some 
sort of visibility tools that I’m overlooking? I would assume that I’d be able 
to query into riak-cs and find “x entries are ready to be garbage collected” or 
something to provide some visibility. I’m not even sure if the problem is 
within riak-cs or riak/bitcask.

Are riak-cs and riak just black boxes? I can’t imagine this to be the case if 
people are using these solutions in production. Please tell me I’m just an 
idiot and not aware of some utility/configuration to make this work.

Thanks

On Jun 8, 2014, at 7:22 PM, Tyler Flint  wrote:

&gt; Yes it is riak 1.4.5
&gt; 
&gt; Let me see if that helps. 
&gt; 
&gt; Thanks
&gt; 
&gt; 
&gt; 
&gt;&gt; On Jun 8, 2014, at 7:20 PM, Kota Uenishi  wrote:
&gt;&gt; 
&gt;&gt; Spelling mistake, sorry:
&gt;&gt; 
&gt;&gt; {gc\\_paginated\\_indexes, true},
&gt;&gt; 
&gt;&gt;&gt; On Mon, Jun 9, 2014 at 10:10 AM, Kota Uenishi  wrote:
&gt;&gt;&gt; Hi,
&gt;&gt;&gt; 
&gt;&gt;&gt; Are you using 1.4.5? I'm not sure but you may have a log message like this:
&gt;&gt;&gt; 
&gt;&gt;&gt; "Error occurred trying to query from time 0 to ~p in gc key index. Reason: 
&gt;&gt;&gt; ~p"
&gt;&gt;&gt; 
&gt;&gt;&gt; in console.log. If so, it's even failing not only GC but in listing
&gt;&gt;&gt; objects to be collected. Then setting a line
&gt;&gt;&gt; 
&gt;&gt;&gt; {gc\\_pagenated\\_indexes, true},
&gt;&gt;&gt; 
&gt;&gt;&gt; into riak\\_cs section of your app.config . This is implicit option and
&gt;&gt;&gt; its default is false.
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Fri, Jun 6, 2014 at 11:52 PM, Tyler Flint  wrote:
&gt;&gt;&gt;&gt; Thank you in advance for any assistance.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; To explore riak-cs, I setup a 2 node cluster with riak and riak-cs on each 
&gt;&gt;&gt;&gt; node, and put the riak nodes on the same cluster. I then proceeded to use 
&gt;&gt;&gt;&gt; risk-cs by uploading a 3G file using the multi-part upload protocol. I was 
&gt;&gt;&gt;&gt; unaware, however, that I needed to finalize the multipart upload and thus 
&gt;&gt;&gt;&gt; had many in progress multi-part uploads. Through the duration of my 
&gt;&gt;&gt;&gt; troubleshooting, the storage on the filesystem grew to 224G. Once I 
&gt;&gt;&gt;&gt; discovered my error, I proceeded to cancel all of the previous uploads. At 
&gt;&gt;&gt;&gt; this point there are no uploads in progress, and only a single 3G file 
&gt;&gt;&gt;&gt; available in the bucket. However, it has been 48 hours since the 
&gt;&gt;&gt;&gt; exploration and the storage use is still 224G on both machines.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I have attempted multiple strategies in attempt to reclaim space, all 
&gt;&gt;&gt;&gt; without any effect.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Within riak-cs:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; - I have shortened the gc leeway duration to 5 minutes and set all of the 
&gt;&gt;&gt;&gt; gc intervals as low as 5 minutes.
&gt;&gt;&gt;&gt; - I have manually triggered the riak-cs-gc batch multiple times. (After 
&gt;&gt;&gt;&gt; running batch, status shows a gc run and eventually complete)
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Within riak:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; - I have adjusted the bitcask settings in attempt to trigger a merge.
&gt;&gt;&gt;&gt; - I have force merged all of the bitcask partitions manually in the erlang 
&gt;&gt;&gt;&gt; console.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; None of these strategies seem to have any effect whatsoever.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; At this point I’m not even sure where to start, nor do I know if the issue 
&gt;&gt;&gt;&gt; is within riak-cs or riak (via bitcask). Any suggestions would be 
&gt;&gt;&gt;&gt; appreciated.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Thanks
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Tyler
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Kota UENISHI / @kuenishi
&gt;&gt;&gt; Basho Japan KK
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; Kota UENISHI / @kuenishi
&gt;&gt; Basho Japan KK


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

