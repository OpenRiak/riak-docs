---
title: "Re: Testing netsplit in Riak"
description: ""
project: community
lastmod: 2017-02-22T11:25:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18010"
mailinglist_parent_id: "msg18009"
author_name: "Andrey Ershov"
project_section: "mailinglistitem"
sent_date: 2017-02-22T11:25:07-08:00
---


Alexander, thanks for your reply!

1) I've set erlang.distribution.nettick\\_time to 1 second and writes after
netsplit are very fast now. So this point is resolved. Do you know how this
parameter affects false positive ratio? Riak docs stay that every
nettick\\_time seconds netkernal will initiate remote processes
life-checking. However, it does not say anything about the mechanism. Do
you know how this failure detector works?
2) As for hinted handoff, I still can not find any solution. Variables that
I've tried to change:
 - vnode\\_management\\_timer from 10s to 1s
 - transfer\\_limit from 2 to 100
But still transfer take about a minute. Any other variables that I should
take a look at?

2017-02-22 21:12 GMT+03:00 Alexander Sicular :

&gt; 1. Check the erlang vm variable "nettick", I believe.
&gt;
&gt; 2. Hinted handoff resource allocation are configurable via config file or
&gt; at runtime.
&gt;
&gt; On Wed, Feb 22, 2017 at 12:07 Andrey Ershov  wrote:
&gt;
&gt;&gt; Hi, guys!
&gt;&gt;
&gt;&gt; I'm testing netsplit in Riak and can not achieve satisfiable behaviour.
&gt;&gt; I've just two nodes cluster and bucket with the following settings n=3,
&gt;&gt; w=2, r=2. And I have just a couple of entries.
&gt;&gt; Basically I have two problems:
&gt;&gt; 1) After the split, writes on one side of the partition start lagging
&gt;&gt; hard. It takes more than 1 minute for the first write to be become
&gt;&gt; successful. I understand that this is related to the process of setting up
&gt;&gt; backup vnodes in Riak, but is any way to speed up the process? Which
&gt;&gt; configuration parameters influence that?
&gt;&gt; 2) More weird problem is after netsplit. "riak-admin transfers" command
&gt;&gt; immediately reports that there should 5 partition transfers from one node
&gt;&gt; to another and 5 partition transfers in the opposite direction. But active
&gt;&gt; transfers output is empty!
&gt;&gt; I've put a watch on this command and active transfers are always empty.
&gt;&gt; Finally, it takes several minutes for Riak to finish hinted handoff.
&gt;&gt; Several minutes just for several keys!
&gt;&gt; What Riak is doing all this time? Anyway to speed up the process?
&gt;&gt; 3) The reason why I'm concerned about hinted-handoff speed is because, I
&gt;&gt; noticed that until this process finishes, I read stale data on both sides
&gt;&gt; of ex-netsplit.
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Thanks,
&gt;&gt; Andrey
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt; --
&gt;
&gt;
&gt; Alexander Sicular
&gt; Solutions Architect
&gt; Basho Technologies
&gt; 9175130679
&gt; @siculars
&gt;



-- 
С уважением,
Ершов Андрей
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

