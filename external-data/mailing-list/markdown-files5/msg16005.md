---
title: "Re: Java client: ConflictResolver for RiakObject, how to get the key?"
description: ""
project: community
lastmod: 2015-04-15T04:26:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16005"
mailinglist_parent_id: "msg16000"
author_name: "Henning Verbeek"
project_section: "mailinglistitem"
sent_date: 2015-04-15T04:26:11-07:00
---


I found a way to solve my problem:
http://stackoverflow.com/questions/29647674/determine-location-of-riakobject-during-conflict-resolution/29648677#29648677

On Mon, Apr 13, 2015 at 10:49 AM, Henning Verbeek  wrote:
&gt; I'm in the process of migrating my code from Riak 1.4 to Riak 2.0.
&gt;
&gt; In Riak 2.0, I'm storing binary data as a RiakObject:
&gt;
&gt; RiakObject obj = new RiakObject();
&gt; obj.setContentType(CONTENT\\_TYPE);
&gt; obj.setValue(BinaryValue.create(someByteArray));
&gt; StoreValue op = new StoreValue.Builder(obj)
&gt; .withLocation(new Location(ns, keyOfObject))
&gt; .withOption(StoreValue.Option.RETURN\\_BODY, false)
&gt; .build();
&gt;
&gt; A siphash-digest is computed over the byte-array beforehand, and is
&gt; stored in a separate object in Riak (I call it 'manifest').
&gt;
&gt; When fetching the binary data, I want to provide a custom
&gt; ConflictResolver. This resolver shall fetch the manifest to the binary
&gt; data, where it can look up the expected digest. This can then be used
&gt; for identifying and eliminating bad siblings. It can use the object's
&gt; key to identify the corresponding manifest.
&gt;
&gt; My problem is: how does the conflict resolver know the key?
&gt;
&gt; In Riak 1.4, I used IRiakObject to transport the data. The key was
&gt; available right on the IRiakObject:
&gt; public IRiakObject resolve(Collection siblings) {
&gt; ...
&gt; String key = siblings.iterator().next().getKey();
&gt; ...
&gt; }
&gt;
&gt; In Riak 2.0, the RiakObject does not expose this method. Is it
&gt; available maybe in the RiakUserMetadata ?
&gt;
&gt; As an alternative, should I maybe create a POJO to encapsulate both
&gt; key (annotated with @RiakKey ?) and byte[]-data? I guess, I'd need a
&gt; custom converter for that, right?
&gt;
&gt; Thanks,
&gt; Henning
&gt;
&gt; --
&gt; My other signature is a regular expression.
&gt; http://www.pray4snow.de



-- 
My other signature is a regular expression.
http://www.pray4snow.de

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

