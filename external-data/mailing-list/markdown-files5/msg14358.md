---
title: "Re: About Protocol Buffers"
description: ""
project: community
lastmod: 2014-06-24T02:45:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14358"
mailinglist_parent_id: "msg14356"
author_name: "Luc Perkins"
project_section: "mailinglistitem"
sent_date: 2014-06-24T02:45:34-07:00
---


Alex,

There's a mistake in that tutorial that I need to fix. Early in the
tutorial I instruct you to create a bucket type called \\*counters\\*, and then
later on I use the name \\*counter\\_bucket\\*. Silly mistake on my part. If you
establish that as the bucket type, it should work:

\\*bucket = client.bucket\\_type('counters').bucket('likes')\\*

Also be aware that you can call a bucket type that you set up to use
counters anything that you'd like. The only reserved term for bucket types
is \\*default\\*.

Luc


On Tue, Jun 24, 2014 at 12:31 AM, Alex De la rosa 
wrote:

&gt; By the way, I have the following error using PBC on Riak 2.0:
&gt;
&gt; test.py
&gt;
&gt; ------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------
&gt; import riak
&gt; client = riak.RiakClient(host ='127.0.0.1', http\\_port = 8098, pb\\_port =
&gt; 8087, protocol = 'pbc')
&gt; bucket = client.bucket\\_type('counter\\_bucket').bucket('likes')
&gt; counter = bucket.new('Barcelona')
&gt; counter.increment(5)
&gt;
&gt; ------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------
&gt;
&gt; OUTPUT:
&gt;
&gt; Traceback (most recent call last):
&gt; File "test.py", line 18, in 
&gt; bucket = client.bucket\\_type('counter\\_bucket').bucket('likes')
&gt; AttributeError: 'RiakClient' object has no attribute 'bucket\\_type'
&gt;
&gt; What is wrong? I was following the instructions at:
&gt; https://raw.githubusercontent.com/basho/basho\\_docs/2.0.0/source/languages/en/riak/dev/using/data-types.md
&gt;
&gt; Thanks,
&gt; Alex
&gt;
&gt;
&gt; On Mon, Jun 23, 2014 at 10:03 PM, Alex De la rosa  &gt; wrote:
&gt;
&gt;&gt; Hi Bret,
&gt;&gt;
&gt;&gt; Thanks for your reply, I had used Riak since version 0.14 via HTTP... for
&gt;&gt; 2.0 I decided to do the switch to PBC and I'm glad to hear all HTTP calls
&gt;&gt; has been migrated to PBC too :)
&gt;&gt;
&gt;&gt; Does anybody know an estimate date for version 2.0 to be out? I'm
&gt;&gt; starting a new project and I would love to be able to use 2.0 as "list"
&gt;&gt; buckets is a great feature for my needs.
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Alex
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Jun 23, 2014 at 9:57 PM, Brett Hazen  wrote:
&gt;&gt;
&gt;&gt;&gt; Alex -
&gt;&gt;&gt;
&gt;&gt;&gt; I suspect you may be looking at some older documentation. AFAIK all
&gt;&gt;&gt; HTTP functionality is now (Riak 2.0) supported via PBC so you can pick
&gt;&gt;&gt; either transport or the other for all of your communication. In the past
&gt;&gt;&gt; there was some functionality available only via HTTP. There are now some
&gt;&gt;&gt; direct queries to the Solr API which are available only via HTTP, but
&gt;&gt;&gt; that’s outside of Riak’s core [1].
&gt;&gt;&gt;
&gt;&gt;&gt; I’m sure those more in the know will correct me if I’ve misspoken.
&gt;&gt;&gt;
&gt;&gt;&gt; Brett
&gt;&gt;&gt;
&gt;&gt;&gt; [1] http://docs.basho.com/riak/2.0.0beta1/dev/advanced/search/
&gt;&gt;&gt;
&gt;&gt;&gt; On June 23, 2014 at 10:47:45 AM, Alex De la rosa (
&gt;&gt;&gt; alex.rosa....@gmail.com) wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Luc,
&gt;&gt;&gt;
&gt;&gt;&gt; Cool, thanks! I can see how to do it now:
&gt;&gt;&gt;
&gt;&gt;&gt; bucket = client.bucket\\_type('counter\\_bucket').bucket('counters')
&gt;&gt;&gt;
&gt;&gt;&gt; Will be checking it more to see what can I do that is not yet documented.
&gt;&gt;&gt;
&gt;&gt;&gt; The Python documentation says at one point: "Some requests are only
&gt;&gt;&gt; valid over 'http', and will always be sent via those transports, regardless
&gt;&gt;&gt; of which protocol is preferred.". Can I know which requests are HTTP only?
&gt;&gt;&gt; is it for something in particular? or they will be made into PBC at some
&gt;&gt;&gt; point?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Alex
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon, Jun 23, 2014 at 5:29 PM, Luc Perkins  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Alex,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It sounds like you're working mostly with the lower-level Python API at
&gt;&gt;&gt;&gt; the moment, but if you want to use the higher-level parts of the client for
&gt;&gt;&gt;&gt; interacting with Riak Data Types (sets, maps, and counters), there is a
&gt;&gt;&gt;&gt; tutorial here:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; https://raw.githubusercontent.com/basho/basho\\_docs/2.0.0/source/languages/en/riak/dev/using/data-types.md
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; You'll see the Python samples interspersed throughout. I know it's
&gt;&gt;&gt;&gt; annoying because it's just raw Markdown at the moment, but this will be
&gt;&gt;&gt;&gt; deployed to our normal docs site
&gt;&gt;&gt;&gt;  soon.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hope that helps!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Luc
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Mon, Jun 23, 2014 at 4:54 PM, Alex De la rosa &lt;
&gt;&gt;&gt;&gt; alex.rosa....@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi Sean,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks for your quick reply, is what i suspected, moreover after
&gt;&gt;&gt;&gt;&gt; checking riak.proto file in the source. So mainly the contents to store
&gt;&gt;&gt;&gt;&gt; (json or not json) is not PB encoded semantically, but is encoded as a
&gt;&gt;&gt;&gt;&gt; "body" field in the Message. That's good though.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Another question... is there any estimated date for Riak 2.0 to be
&gt;&gt;&gt;&gt;&gt; released? I'm playing with 2.0 beta 1 and the "list" object is a must-have
&gt;&gt;&gt;&gt;&gt; for me (same as the "counter" object that can be found in Riak 1.4).
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Is crucial for me to decide which technologies to use in my new
&gt;&gt;&gt;&gt;&gt; project; so far Riak 2.0 seems a great option, but I can not build under a
&gt;&gt;&gt;&gt;&gt; beta.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Another question now that I talk about "counters"... how do you do it
&gt;&gt;&gt;&gt;&gt; with Python's PBC? I can see the functions: RiakClient.get\\_counter()
&gt;&gt;&gt;&gt;&gt; and RiakClient.update\\_counter()... but... how do you create a new counter?
&gt;&gt;&gt;&gt;&gt; how do you specify the special connotations to the bucket?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt; Alex
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Mon, Jun 23, 2014 at 4:38 PM, Sean Cribbs  wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hi Alex,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; By default, the client assumes new objects use JSON as the encoding.
&gt;&gt;&gt;&gt;&gt;&gt; The protocol buffers are only used on the wire to encode Riak's protocol.
&gt;&gt;&gt;&gt;&gt;&gt; If you want to use your own protobuffs messages, I suggest two things:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 1. Decide on a `content\\_type` property for each of your data types
&gt;&gt;&gt;&gt;&gt;&gt; and be sure to assign that to each key as you create it. I've used
&gt;&gt;&gt;&gt;&gt;&gt; 'application/pb-person' as an example below.
&gt;&gt;&gt;&gt;&gt;&gt; 2. Register encoder and decoder functions [1] on the RiakClient
&gt;&gt;&gt;&gt;&gt;&gt; object, like so:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; client.set\\_decoder('application/pb-person', Person.ParseFromString)
&gt;&gt;&gt;&gt;&gt;&gt; client.set\\_encoder('application/pb-person', lambda x:
&gt;&gt;&gt;&gt;&gt;&gt; x.SerializeToString())
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; [1]
&gt;&gt;&gt;&gt;&gt;&gt; http://riak-python-client.readthedocs.org/en/latest/client.html#serialization
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Mon, Jun 23, 2014 at 9:19 AM, Alex De la rosa &lt;
&gt;&gt;&gt;&gt;&gt;&gt; alex.rosa....@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi there,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I just installed RIAK 2.0 beta 1 and was playing with the Python
&gt;&gt;&gt;&gt;&gt;&gt;&gt; library using 'pbc' (Protocol Buffers).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; test.py
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;&gt;&gt;&gt; import riak
&gt;&gt;&gt;&gt;&gt;&gt;&gt; client = riak.RiakClient(host ='127.0.0.1', http\\_port = 8098,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; pb\\_port = 8087, protocol = 'pbc')
&gt;&gt;&gt;&gt;&gt;&gt;&gt; bucket = client.bucket('people')
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; key = bucket.new('alex', data={"username":"Alex","age":33})
&gt;&gt;&gt;&gt;&gt;&gt;&gt; key.store()
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; print bucket.get('alex').encoded\\_data
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; it works perfectly and it prints {"username": "Alex", "age": 33} as
&gt;&gt;&gt;&gt;&gt;&gt;&gt; it should print.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; However, I'm not using a proto file (person.proto) and compiling it
&gt;&gt;&gt;&gt;&gt;&gt;&gt; into binary for Python to use it... something like:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; person.proto
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;&gt;&gt;&gt; message Person {
&gt;&gt;&gt;&gt;&gt;&gt;&gt; required string username = 1;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; required int32 age = 2;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxx.py
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;&gt;&gt;&gt; import person\\_pb2
&gt;&gt;&gt;&gt;&gt;&gt;&gt; person = person\\_pb2.Person()
&gt;&gt;&gt;&gt;&gt;&gt;&gt; person.username = "Alex"
&gt;&gt;&gt;&gt;&gt;&gt;&gt; person.age = 33
&gt;&gt;&gt;&gt;&gt;&gt;&gt; data = person.SerializeToString()
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Am I using the 'pbc' interface wrong? however, on Riak's examples
&gt;&gt;&gt;&gt;&gt;&gt;&gt; page is done also without the "proto" file... I'm a bit confused at the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; moment as it changed the way I normally would use Protocol Buffers.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Alex
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

