---
title: "Re: Very slow acquisition time (99 percentile) while fast median times"
description: ""
project: community
lastmod: 2016-05-02T08:24:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17272"
mailinglist_parent_id: "msg17271"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2016-05-02T08:24:14-07:00
---


Which Riak client are you using? Do you have it configured to connect
to all nodes in your cluster or just one?
--
Luke Bakken
Engineer
lbak...@basho.com


On Mon, May 2, 2016 at 7:40 AM, Guillaume Boddaert
 wrote:
&gt; Hi Luke,
&gt;
&gt; Well objsize seems to be 0, that's very troubling.
&gt; I can assure you that i am writing 75 items per second at the moment and
&gt; that I can pull data from the cluster.
&gt;
&gt;
&gt; admin@riak3:~$ sudo riak-admin status | grep -e 'objsize'
&gt;
&gt; consistent\\_get\\_objsize\\_100 : 0
&gt; consistent\\_get\\_objsize\\_95 : 0
&gt; consistent\\_get\\_objsize\\_99 : 0
&gt; consistent\\_get\\_objsize\\_mean : 0
&gt; consistent\\_get\\_objsize\\_median : 0
&gt; consistent\\_put\\_objsize\\_100 : 0
&gt; consistent\\_put\\_objsize\\_95 : 0
&gt; consistent\\_put\\_objsize\\_99 : 0
&gt; consistent\\_put\\_objsize\\_mean : 0
&gt; consistent\\_put\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_median : 0
&gt; write\\_once\\_put\\_objsize\\_100 : 0
&gt; write\\_once\\_put\\_objsize\\_95 : 0
&gt; write\\_once\\_put\\_objsize\\_99 : 0
&gt; write\\_once\\_put\\_objsize\\_mean : 0
&gt; write\\_once\\_put\\_objsize\\_median : 0
&gt;
&gt;
&gt;
&gt;
&gt; On 02/05/2016 16:13, Luke Bakken wrote:
&gt;&gt;
&gt;&gt; Hi Guillaume -
&gt;&gt;
&gt;&gt; What are the "objsize" stats for your cluster?
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer
&gt;&gt; lbak...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, May 2, 2016 at 4:45 AM, Guillaume Boddaert
&gt;&gt;  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I'm trying to setup a production environment with Riak as backend.
&gt;&gt;&gt; Unfortunately I have very slow write times that bottleneck my whole
&gt;&gt;&gt; system.
&gt;&gt;&gt;
&gt;&gt;&gt; Here is a sample of one of my node (riak-admin status | grep -e
&gt;&gt;&gt; '^node\\_put\\_fsm\\_time'):
&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_100 : 3305516
&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_95 : 230589
&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_99 : 1694593
&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_mean : 79864
&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_median : 14973
&gt;&gt;&gt;
&gt;&gt;&gt; As you can see, I have really good times for most of my writes, yet the
&gt;&gt;&gt; mean
&gt;&gt;&gt; time is not so good because a few writes are taking long (Up to 3
&gt;&gt;&gt; seconds)
&gt;&gt;&gt; How can I get rid of those slow insert ? Is that intended/normal ?
&gt;&gt;&gt;
&gt;&gt;&gt; My setup is the following:
&gt;&gt;&gt; 5 hosts (2CPU, %Cpu(s): 47,1 us, 1,3 sy, 0,0 ni, 51,3 id, 0,0 wa, 0,0
&gt;&gt;&gt; hi, 0,2 si, 0,0 st) , ring\\_size: 128, aae disabled.
&gt;&gt;&gt; Writes are w=1 dw=0
&gt;&gt;&gt; each host has 32go of ram, that is almost used for system caching only.
&gt;&gt;&gt; My data are stored on an openstack volume that support up to 3000IOPS.
&gt;&gt;&gt;
&gt;&gt;&gt; Here is an iostat sample for 1 minute:
&gt;&gt;&gt; avg-cpu: %user %nice %system %iowait %steal %idle
&gt;&gt;&gt; 38.00 0.00 1.81 0.03 0.08 60.07
&gt;&gt;&gt;
&gt;&gt;&gt; Device: tps kB\\_read/s kB\\_wrtn/s kB\\_read kB\\_wrtn
&gt;&gt;&gt; vda 0.37 0.00 2.27 0 136
&gt;&gt;&gt; vdb 9.60 0.00 294.53 0 17672
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;
&gt;&gt;&gt; Guilaume BODDAERT
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

