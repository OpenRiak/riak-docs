---
title: "Re: Initializing a commit hook"
description: ""
project: community
lastmod: 2016-11-18T13:38:05-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17766"
mailinglist_parent_id: "msg17765"
author_name: "Mav erick"
project_section: "mailinglistitem"
sent_date: 2016-11-18T13:38:05-08:00
---


Hi Luke

I tried that and didn't work for a bucket with bucket type = maps. My
erlang code below does work for buckets without types.

But I think its because I didn't set the hook for the typed bucket
correctly.Could you check my curl below, please ?

I did this to set the hook
curl -X PUT localhost:8098/riak/types/maps -H 'Content-Type:
application/json' -d
'{"props":{"precommit":[{"mod":"myhooks","fun":"precommit\\_hook"}]}}'

That returns 204, but when I get the props ...
curl http://localhost:8098/types/maps/props
{
 "props": {
 "active": true,
 "allow\\_mult": true,
 "basic\\_quorum": false,
 "big\\_vclock": 50,
 "chash\\_keyfun": {
 "fun": "chash\\_std\\_keyfun",
 "mod": "riak\\_core\\_util"
 },
 "claimant": "riak@10.243.44.165",
 "datatype": "map",
 "dvv\\_enabled": true,
 "dw": "quorum",
 "last\\_write\\_wins": false,
 "linkfun": {
 "fun": "mapreduce\\_linkfun",
 "mod": "riak\\_kv\\_wm\\_link\\_walker"
 },
 "n\\_val": 3,
 "notfound\\_ok": true,
 "old\\_vclock": 86400,
 "postcommit": [],
 "pr": 0,
 "precommit": [],
 "pw": 0,
 "r": "quorum",
 "rw": "quorum",
 "small\\_vclock": 50,
 "w": "quorum",
 "young\\_vclock": 20
 }
}

The hook code is ...

precommit\\_hook(Object) -&gt;
 case riak\\_object:bucket(Object) of
 {BucketType, Bucket} -&gt; Bstr = binary\\_to\\_list(Bucket), Btstr =
binary\\_to\\_list(BucketType);
 Bucket -&gt; Bstr = binary\\_to\\_list(Bucket), Btstr = &lt;&lt;""&gt;&gt;
 end,
 K = riak\\_object:key(Object),
 Kstr = binary\\_to\\_list(K),
 lager:info("MyHook Bucket type ~s, bucket ~s, key ~s [Btstr, Bstr,
Kstr]),
 Object.


On 18 November 2016 at 14:15, Luke Bakken  wrote:

&gt; Mav -
&gt;
&gt; Please remember to use "Reply All" so that the riak-users list can
&gt; learn from what you find out. Thanks.
&gt;
&gt; Thebucket = riak\\_object:bucket(Object),
&gt;
&gt; Can you check to see if "Thebucket" is really a two-tuple of
&gt; "{BucketType, Bucket}"? I believe that is what is returned.
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt; On Fri, Nov 18, 2016 at 10:54 AM, Mav erick  wrote:
&gt; &gt; I have some initializing to do - like connecting to a notification
&gt; server,
&gt; &gt; before I can use the commit hook. But I think I have figured that out now
&gt; &gt; that I learnt about supervisors and OTP
&gt; &gt;
&gt; &gt; I have one other question though ...
&gt; &gt; How do I get the bucket type of the bucket of the key that was committed
&gt; ?
&gt; &gt;
&gt; &gt; I am using these to get the key and bucket names. But I cant seem to
&gt; find a
&gt; &gt; call to get the bucket's bucket type
&gt; &gt;
&gt; &gt; Thebucket = riak\\_object:bucket(Object),
&gt; &gt; Thekey = riak\\_object:key(Object),
&gt; &gt;
&gt; &gt; Thanks !
&gt; &gt;
&gt; &gt; On 18 November 2016 at 12:14, Luke Bakken  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Mav -
&gt; &gt;&gt;
&gt; &gt;&gt; Can you go into more detail? The subject of your message is
&gt; &gt;&gt; "initializing a commit hook".
&gt; &gt;&gt;
&gt; &gt;&gt; --
&gt; &gt;&gt; Luke Bakken
&gt; &gt;&gt; Engineer
&gt; &gt;&gt; lbak...@basho.com
&gt; &gt;&gt;
&gt; &gt;&gt; On Thu, Nov 17, 2016 at 9:09 AM, Mav erick  wrote:
&gt; &gt;&gt; &gt; Folks
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Is there way RIAK can call an erlang function in a module when RIAK
&gt; &gt;&gt; &gt; starts
&gt; &gt;&gt; &gt; up ?
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; Thanks
&gt; &gt;&gt; &gt; Mav
&gt; &gt;
&gt; &gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

