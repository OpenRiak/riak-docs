---
title: "Re: Hinted handoff failed because of tcp errors"
description: ""
project: community
lastmod: 2016-11-01T02:17:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17726"
mailinglist_parent_id: "msg17725"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2016-11-01T02:17:03-07:00
---


Hi Ryan, yes, you can change a number of settings. Have you had a look
at http://docs.basho.com/riak/kv/2.1.4/using/admin/riak-admin/#transfer-limit
and 
http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2014-July/015529.html
?

-Alexander

On Tue, Nov 1, 2016 at 2:43 AM, Ryan Maclear  wrote:
&gt; Good Day,
&gt;
&gt; We have a 4 node riak cluster running inside AWS. The riak is riak-kv 2.1.2
&gt; with AAE enabled on Ubuntu 14.04.4 LTS
&gt;
&gt; We are in the process of replacing one node with another using the process
&gt; described here:
&gt;
&gt; http://docs.basho.com/riak/kv/2.1.4/using/cluster-operations/replacing-node/
&gt;
&gt; We have successfully replaced two of the nodes so far but we are having a
&gt; problem with the third. If we look at /var/log/riak/console.log we see the
&gt; start of the hinted handoff, and some time later (sometimes minutes and
&gt; sometimes hours) we see:
&gt;
&gt; 2016-10-31 06:30:40.090 [error]
&gt; &lt;0.19834.2101&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:272 hinted transfer of
&gt; riak\\_kv\\_vnode from 'r...@aew54.miranetworks.net'
&gt; 274031556999544297163190906134303066185487351808 to
&gt; 'r...@aew75.miranetworks.net'
&gt; 274031556999544297163190906134303066185487351808 failed because of TCP recv
&gt; timeout
&gt; 2016-10-31 06:30:40.090 [error]
&gt; &lt;0.187.0&gt;@riak\\_core\\_handoff\\_manager:handle\\_info:303 An outbound handoff of
&gt; partition riak\\_kv\\_vnode 274031556999544297163190906134303066185487351808 was
&gt; terminated for reason: {shutdown,timeout}
&gt;
&gt; So the handoff was terminated due to a tcp timeout. The handoff then starts
&gt; again.
&gt;
&gt; This has been going on for some times (about two weeks now).
&gt;
&gt; The current member status is as follows:
&gt;
&gt; riak-admin member-status
&gt; ================================= Membership
&gt; ==================================
&gt; Status Ring Pending Node
&gt; -------------------------------------------------------------------------------
&gt; leaving 0.0% -- 'r...@aew54.miranetworks.net'
&gt; valid 25.0% -- 'r...@aew59.miranetworks.net'
&gt; valid 25.0% -- 'r...@aew73.miranetworks.net'
&gt; valid 25.0% -- 'r...@aew74.miranetworks.net'
&gt; valid 25.0% -- 'r...@aew75.miranetworks.net'
&gt; -------------------------------------------------------------------------------
&gt; Valid:4 / Leaving:1 / Exiting:0 / Joining:0 / Down:0
&gt;
&gt;
&gt; Here are some questions:
&gt;
&gt; 1. What is the default tcp timeout?
&gt; 2. Is there any way to increase this timeout?
&gt; 3. Is there any way to increase the rate of handoff?
&gt; 4. Are there any other parameters we can tune to try and avoid this?
&gt;
&gt; The output from riak-admin transfers is as follows:
&gt;
&gt; 'r...@aew54.miranetworks.net' waiting to handoff 1 partitions
&gt;
&gt; Active Transfers:
&gt;
&gt; transfer type: hinted
&gt; vnode type: riak\\_kv\\_vnode
&gt; partition: 274031556999544297163190906134303066185487351808
&gt; started: 2016-11-01 05:30:47 [2.10 hr ago]
&gt; last update: 2016-11-01 07:36:51 [3.03 s ago]
&gt; total size: 78393086512 bytes
&gt; objects transferred: 11440967
&gt;
&gt; 1513 Objs/s
&gt; riak@aew54.miranetworks.n =======&gt; riak@aew75.miranetworks.n
&gt; et et
&gt; |====== | 15%
&gt; 1.53 MB/s
&gt;
&gt;
&gt; Thanks,
&gt; Ryan Maclear
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

