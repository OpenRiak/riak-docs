---
title: "Re: 2i Index Durability/Resilience"
description: ""
project: community
lastmod: 2013-10-07T14:49:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12536"
mailinglist_parent_id: "msg12535"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2013-10-07T14:49:07-07:00
---


Hi Brady,

The 2I indices are written in the same store as the main objects whenever
the main object is updated. If a primary node is down, the indices will be
written to a fallback node. When the fallback sees the primary come back
online and stops receiving requests for that partition it will send the
main object back to the primary and that will re-index it.

The docs could benefit with a little clarification. Secondary indices do
benefit from read repair, that is if the main object is spotted as being
out of date or missing during a get, it is rewritten with the up to date
information on all nodes. The anti-entropy mechanism that we are currently
missing is spotting corruption within leveldb itself. For example if part
of a the leveldb database storing a vnode is corrupted so that the .sst
files containing the index entries were destroyed there is no mechanism to
spot and repair that. We are intending to add that for the next major
release.

Jon


On Mon, Oct 7, 2013 at 2:39 PM, Brady Wetherington wrote:

&gt; What happens to your 2i indexes if you do a write and one of the nodes
&gt; you're trying to write to is down?
&gt;
&gt; http://docs.basho.com/riak/latest/dev/using/2i/ says:
&gt;
&gt;
&gt; - When you want or need anti-entropy. Since 2i is just metadata on the
&gt; KV object and the indexes reside on the same node, 2i piggybacks off of
&gt; read-repair.
&gt;
&gt; But
&gt; http://docs.basho.com/riak/latest/ops/running/recovery/repairing-indexes/says:
&gt;
&gt; Riak Secondary indexes (2i) currently have no form of anti-entropy (such
&gt; as read-repair). Furthermore, for performance and load balancing reasons,
&gt; 2i reads from 1 random node. This means that when a replica loss has
&gt; occurred, inconsistent results may be returned.
&gt; I am building a solution around 2i - so I just wanted to know if there was
&gt; any way to clarify these points - how resilient are these indexes? Under
&gt; what circumstances will they stop working (or return inconsistent results)?
&gt;
&gt; -B.
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Jon Meredith
VP, Engineering
Basho Technologies, Inc.
jmered...@basho.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

