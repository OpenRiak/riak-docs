---
title: "Re: Querying multiple 2i via Intersections"
description: ""
project: community
lastmod: 2013-07-27T09:14:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11793"
mailinglist_parent_id: "msg11791"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-07-27T09:14:56-07:00
---


No, I never said or hinted that you could join 2i indices using Riak Search.

You can, however, query against multiple indexed fields with Riak Search.
Here's what that would look like in CorrugatedIron:

 var req = new RiakSearchRequest
 {
 Query = new RiakFluentSearch("riak\\_search\\_bucket", "date")
 };

 req.Query.Search("2012-01-03")
 .And("category", "sandwiches");

 var result = Client.Search(req);


This becomes a Riak Search query on the riak\\_search\\_bucket with the
syntax date:2012-01-03
AND category:sandwiches

The trick with Riak Search is that the objects you're saving have to be
readable by Riak Search. If you can't encode field names in a way that is
expected by Search, you'll need to specify a search schema so that Riak
Search knows which data types to index.

See Using Search[1] and Search Schema[2] for implementation details

[1]: http://docs.basho.com/riak/latest/dev/using/search/
[2]: http://docs.basho.com/riak/latest/dev/advanced/search-schema/

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Sat, Jul 27, 2013 at 11:44 AM, Guido Medina wrote:

&gt; Are you saying that you can join two 2i indexes? Let's say you have a 2i
&gt; named "date" and another named "category" so you could get a list of
&gt; modified objects on a date and for a specific category with Riak Search?
&gt;
&gt; Guido.
&gt;
&gt;
&gt; On 27/07/13 16:32, Jeremiah Peschka wrote:
&gt;
&gt; Both Riak Search (currently) and Yokozuna (future) provide the ability to
&gt; perform joins of multiple indices on the same bucket objects.
&gt;
&gt; I find it best to think of 2i as an extension of what Riak KV already
&gt; does well - fast key based lookups.
&gt;
&gt; Search and Yokozuna provide complex query semantics.
&gt;
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt;
&gt;
&gt; On Sat, Jul 27, 2013 at 11:16 AM, Guido Medina 
&gt; wrote:
&gt;
&gt;&gt; Rohman,
&gt;&gt;
&gt;&gt; I think the reason for this is that the cluster will have to do the whole
&gt;&gt; intersection in memory, 2i only provides queries for 1 single index and
&gt;&gt; then return that result to either the client streaming or not, intersection
&gt;&gt; indeed will require a MapReduce job to get a hold of both lists and
&gt;&gt; intersect it, honestly, I wish that was possible, I think that's why I'm
&gt;&gt; learning Erlang at the moment, we all wanted "join" like functionality with
&gt;&gt; 2i to be honest but I don't think that is going to happen before version
&gt;&gt; 1.5 if ever.
&gt;&gt;
&gt;&gt; If you noticed, Riak 1.4 added 2i streaming which IMHO is like moving
&gt;&gt; farer away from handling results in memory, if you get the point of what I
&gt;&gt; mean. Join 2i queries in Riak will be an issue for a long time.
&gt;&gt;
&gt;&gt; HTH,
&gt;&gt;
&gt;&gt; Guido.
&gt;&gt;
&gt;&gt;
&gt;&gt; On 27/07/13 14:20, Antonio Rohman Fernandez wrote:
&gt;&gt;
&gt;&gt;&gt; Hi there,
&gt;&gt;&gt;
&gt;&gt;&gt; I didn't fully check the new release notes yet, but I guess that Riak
&gt;&gt;&gt; 1.4 doesn't have the ability to query multiple 2i at the same time... how
&gt;&gt;&gt; difficult may be to implement a multiple 2i query via their intersecting
&gt;&gt;&gt; items in their arrays? Maybe we could have this in future versions?
&gt;&gt;&gt;
&gt;&gt;&gt; I normally do this with scripts before doing a MapReduce, if the data I
&gt;&gt;&gt; want to look for is having 2 indexes conditions, I get the array of items
&gt;&gt;&gt; of each 2i query, then get only the items found on both arrays and use it
&gt;&gt;&gt; as a MapReduce input list.
&gt;&gt;&gt;
&gt;&gt;&gt; However, done in my app's side is a bit costly as Riak needs to give me
&gt;&gt;&gt; the full items arrays and then I need to process them to find repeated keys.
&gt;&gt;&gt;
&gt;&gt;&gt; I really wish for Riak to be able to query multiple 2i soon as it will
&gt;&gt;&gt; help a lot.
&gt;&gt;&gt;
&gt;&gt;&gt; Merci,
&gt;&gt;&gt; Rohman
&gt;&gt;&gt;
&gt;&gt;&gt; Sent from my iPhone
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing 
&gt; listriak-users@lists.basho.comhttp://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

