---
title: "Re: Riak Cluster Behavior - Clarification"
description: ""
project: community
lastmod: 2016-05-24T13:26:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17408"
mailinglist_parent_id: "msg17407"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2016-05-24T13:26:14-07:00
---


Hi Vikram,

If you're using the defaults, two of copies may be on the same
machine. When using the default values (ring\\_size=64, n\\_val=3) you are
not guaranteed copies on distinct physical machines. Implement a
back-off retry design pattern. aka, fail once, try again with r=1.
Also, a read will trigger a read repair operation which will then copy
your data n\\_val times to surviving members of the cluster.

Have you tried that?
-Alexander

Read these blog posts for more info:
http://basho.com/posts/technical/understanding-riaks-configurable-behaviors-part-1/
http://basho.com/posts/technical/riaks-config-behaviors-part-2/
http://basho.com/posts/technical/riaks-config-behaviors-part-3/
http://basho.com/posts/technical/riaks-config-behaviors-part-4/

On Tue, May 24, 2016 at 3:08 PM, Vikram Lalit  wrote:
&gt; It's returning no object at all for the relevant key. That too is random -
&gt; every few calls it returns but then it doesn't.
&gt;
&gt; On May 24, 2016 4:06 PM, "Sargun Dhillon"  wrote:
&gt;&gt;
&gt;&gt; What do you mean it's not returning? It's returning stale data? Or
&gt;&gt; it's erroring?
&gt;&gt;
&gt;&gt; On Tue, May 24, 2016 at 7:34 AM, Vikram Lalit 
&gt;&gt; wrote:
&gt;&gt; &gt; Hi - I'd appreciate if someone can opine on the below behavior of Riak
&gt;&gt; &gt; that
&gt;&gt; &gt; I am observing... is that expected, or something wrong in my set-up /
&gt;&gt; &gt; understanding?
&gt;&gt; &gt;
&gt;&gt; &gt; To summarize, I have a 3-node Riak cluster (separate EC2 AWS instances)
&gt;&gt; &gt; with
&gt;&gt; &gt; a separate chat server connecting to them. When I write data on the Riak
&gt;&gt; &gt; nodes, the process is successful and I can read all data correctly.
&gt;&gt; &gt; However,
&gt;&gt; &gt; as part of my testing, if I deliberately bring down one node (and then
&gt;&gt; &gt; remove it from the cluster using riak-admin cluster force-remove / plan
&gt;&gt; &gt; /
&gt;&gt; &gt; commit), the client API is not able to fetch all the written data. In
&gt;&gt; &gt; fact,
&gt;&gt; &gt; there is an alternation of success and failure which happens rather
&gt;&gt; &gt; randomly.
&gt;&gt; &gt;
&gt;&gt; &gt; My initial suspicion was that it would be happening only during the time
&gt;&gt; &gt; the
&gt;&gt; &gt; rebalancing is occurring (i.e. riak-admin ring-status is not fully
&gt;&gt; &gt; settled)
&gt;&gt; &gt; but I've seen this sporadic behavior post the same too.
&gt;&gt; &gt;
&gt;&gt; &gt; Does this have to do with the n and r values for the cluster and given
&gt;&gt; &gt; that
&gt;&gt; &gt; 1 node is down, the cluster does not succeed in returning results
&gt;&gt; &gt; reliably?
&gt;&gt; &gt; Also, does this mean that during the time a cluster is being rebalanced
&gt;&gt; &gt; (even incl. addition of new nodes), the results could be arbitrary -
&gt;&gt; &gt; that
&gt;&gt; &gt; doesn't sound correct to me?
&gt;&gt; &gt;
&gt;&gt; &gt; Appreciate if someone can throw some light here? Also, the HTTP API
&gt;&gt; &gt; calls to
&gt;&gt; &gt; retrieve and set the n / r / w values for a specific bucket - couldn't
&gt;&gt; &gt; locate the same!
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks much!
&gt;&gt; &gt; Vikram
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

