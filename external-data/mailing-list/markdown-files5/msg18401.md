---
title: "Node diversity work"
description: ""
project: community
lastmod: 2017-08-04T03:41:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18401"
author_name: "SEN, Ramen (NHS DIGITAL)"
project_section: "mailinglistitem"
sent_date: 2017-08-04T03:41:08-07:00
---


As part of a series of improvements and ongoing work on Riak KV we are doing 
here at NHS Digital, I have added a new bucket option to Riak KV, called 
'node\\_confirms'.

A full write-up is available: 
https://github.com/ramensen/riak\\_kv/blob/rs-physical-promises/docs/Node-Diversity.md

In summary, within the database clusters used for the NHS Spine, historically 
we have used the primary write option (pw=2) to ensure data isn't lost due to 
individual hardware failures, as a proxy for physical diversity guarantees. 
This has worked well, however can lead to a situation where a riak database 
cluster rejects some writes in the case of two node failures.

The solution is to more directly tie configuration options over diversity to 
the physical layout of the system at run-time, not the abstract concept of the 
ring, and the new node\\_confirms option allows operators to specify the number 
of diverse nodes that must confirm their writes before a write is considered 
successful.

Next Friday Martin (@masleeds) is planning to do a write-up of the testing so 
far of the core node\\_worker\\_pool to help with multi-data-centre anti-entropy.

Regards,
Ramen

?

Dr Ramen Sen
Lead Systems Engineer
Operations and Non-functional Test Lead
Spine 2 Core
NHS Digital

ramen....@nhs.net

NHS Digital provides information and technology for better health and care.
Find out more about who we are and what we do at 
www.digital.nhs.uk

@NHSDigital
enquir...@nhsdigital.nhs.uk
General enquiries: 0300 303 5678



\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*

This message may contain confidential information. If you are not the intended 
recipient please inform the
sender that you have received the message in error before deleting it.
Please do not disclose, copy or distribute information in this e-mail or take 
any action in relation to its contents. To do so is strictly prohibited and may 
be unlawful. Thank you for your co-operation.

NHSmail is the secure email and directory service available for all NHS staff 
in England and Scotland. NHSmail is approved for exchanging patient data and 
other sensitive information with NHSmail and other accredited email services.

For more information and to find out how you can switch, 
https://portal.nhs.net/help/joiningnhsmail

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

