---
title: "Re: Erlang API vs Erlang PBC"
description: ""
project: community
lastmod: 2011-01-21T05:36:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02039"
mailinglist_parent_id: "msg02036"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2011-01-21T05:36:19-08:00
---


I was hesitant to mention it at first, but since you broke the ice...I also
wrote my own pool. However, I took a different approach. My pool only
cares about doling out connections and making sure they are alive. One or
more processes could use the same conn at a given time (side question: is
that a problem?). My pool relies on the fact that each conn has N-1 other
conns after it before it gets reused, where N = the size of the pool.

That said, I hacked mine together in 15 minutes for something I needed at
work. It seemed to handle a reasonable load (100+ concurrent connections)
just fine, so I'm using it, but I don't know if I'd suggest anyone else
using it. I'm mainly putting it up here as contrast to your (David's) pool
and I was curious to get feedback if I'm doing anything insanely stupid?

https://gist.github.com/789616

-Ryan

On Fri, Jan 21, 2011 at 7:12 AM, David Dawson wrote:

&gt; I am not sure if this is any help but I have uploaded a protocol buffer
&gt; pool client for riak which requires you to pass a client\\_id for each
&gt; operation.
&gt;
&gt; https://github.com/DangerDawson/riakc\\_pb\\_pool
&gt;
&gt; It is very very basic, but does most of the useful things:
&gt;
&gt; - put / get / delete
&gt; - riak disconnects,
&gt; - Clients that die after leasing a riak connection ( connection is
&gt; returned to the pool )
&gt; - Dynamically increasing the size of the connection pool
&gt; - Queueing requests if there are no connections available
&gt; - Useful Statistics
&gt;
&gt; Of course the documentation is very sparse and needs improving, which I
&gt; will get round to.
&gt;
&gt; Dave
&gt;
&gt;
&gt; On 21 Jan 2011, at 00:43, Bob Ippolito wrote:
&gt;
&gt; &gt; Another issue we've run into is that the Erlang native client allows
&gt; &gt; you to store non-binary values, which can not be accessed from the
&gt; &gt; PBC.... so if you're not careful or don't know better, you'll be in
&gt; &gt; for some migration if you're trying to use other clients.
&gt; &gt;
&gt; &gt; The only real problem is that the PBC needs some additional software
&gt; &gt; around it to pool connections, where the Erlang native client got that
&gt; &gt; for free because it was leveraging Erlang distribution.
&gt; &gt;
&gt; &gt; On Fri, Jan 21, 2011 at 3:57 AM, Ryan Maclear 
&gt; wrote:
&gt; &gt;&gt; Agreed. So it therefore makes sense to start using the PBC from the
&gt; outset, allowing for future moving of the client app off any cluster node(s)
&gt; it might be residing on, as well as not being affecting by any subtle
&gt; changes to the internals of the riak\\_kv code base (specifically the non-PB
&gt; modules).
&gt; &gt;&gt;
&gt; &gt;&gt; On 20 Jan 2011, at 9:37 PM, Mojito Sorbet wrote:
&gt; &gt;&gt;
&gt; &gt;&gt;&gt; To me the major concern is that if you use the native (non-PB)
&gt; &gt;&gt;&gt; interface, your application cluster and the Riak cluster become merged
&gt; &gt;&gt;&gt; into one big Erlang cluster. The number of TCP connections can start
&gt; &gt;&gt;&gt; getting out of hand, and the work put on the cluster manager starts to
&gt; &gt;&gt;&gt; become significant.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt;&gt; riak-users mailing list
&gt; &gt;&gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

