---
title: "Re: Running riak from launchd?"
description: ""
project: community
lastmod: 2012-05-26T09:14:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07543"
mailinglist_parent_id: "msg07542"
author_name: "Will Moss"
project_section: "mailinglistitem"
sent_date: 2012-05-26T09:14:22-07:00
---


That doesn't seem like it solves the problem. launchd (and other tools like
it) don't want processes to daemonize themselves (which is what riak start
does). Is there a blessed way to run Riak not daemonized?

Will


On Sat, May 26, 2012 at 11:34 AM, Kelly McLaughlin  wrote:

&gt; Hi Izzy. Use riak start and then you can use riak attach if you need to
&gt; attach a console to the running instance.
&gt;
&gt; Kelly
&gt;
&gt; Sent from my iPhone
&gt;
&gt; On May 26, 2012, at 8:38 AM, Izzy Alanis  wrote:
&gt;
&gt; &gt; Has anyone gotten riak to run under launchd?
&gt; &gt;
&gt; &gt; Or, is there a way to run riak in console mode without the interactive
&gt; &gt; erlang shell?
&gt; &gt;
&gt; &gt; Launchd doesn't want its subprocesses to daemonize themselves. If I
&gt; &gt; set up a launch file to run riak in the foreground with "riak
&gt; &gt; console", its the same as running "riak console &lt; /dev/null" from the
&gt; &gt; command line, and (I'm guessing here:) the interactive shell sees the
&gt; &gt; end of stream and ends the console session.
&gt; &gt;
&gt; &gt; I expect you'd have the same problem using supervisor as your process
&gt; &gt; controller. Supervisor has a pixproxy program to help in these sort of
&gt; &gt; situations, but riak is not writing out a pid file either(?!).
&gt; &gt;
&gt; &gt; Things I've tried:
&gt; &gt;
&gt; &gt; Piping input from /dev/zero is understandably disastrous:
&gt; &gt;&gt; riak console &lt; /dev/zero
&gt; &gt;
&gt; &gt; Piping input from a fifo just hangs:
&gt; &gt;&gt; mkfifo &lt; /tmp/myfifo
&gt; &gt;&gt; riak console &lt; /tmp/myfifo
&gt; &gt;
&gt; &gt; This seems to mostly work (or might really work well with some extra
&gt; &gt; bash scripting):
&gt; &gt;&gt; mkfifo &lt; /tmp/myfifo
&gt; &gt;&gt; echo &gt; /tmp/myfifo &
&gt; &gt;&gt; riak console &lt; /tmp/myfifo
&gt; &gt; I have that last one in a wrapper script. I could add the bells and
&gt; &gt; whistles to make the fifo a random filename and make sure it gets
&gt; &gt; cleaned up after the script end, etc, etc, etc.
&gt; &gt;
&gt; &gt; Here's my launch config (below), FYI. I'm running it out of
&gt; &gt; /Library/LaunchDaemons, and errang \\*really\\* wants a HOME environment
&gt; &gt; variable which is a gotcha for anybody else out there!:
&gt; &gt;
&gt; &gt; Anybody else get something like this working?
&gt; &gt;
&gt; &gt; xml version="1.0" encoding="UTF-8"?
&gt; &gt;  &gt; "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Label
&gt; &gt; com.basho.riak
&gt; &gt; OnDemand
&gt; &gt; 
&gt; &gt; Program
&gt; &gt; /opt/riak/bin/riak-wrapper
&gt; &gt; EnvironmentVariables
&gt; &gt; 
&gt; &gt; HOME
&gt; &gt; /opt/riak/
&gt; &gt; 
&gt; &gt; StandardOutPath
&gt; &gt; /opt/riak/log/console.log
&gt; &gt; StandardErrorPath
&gt; &gt; /opt/riak/log/error.log
&gt; &gt; SoftResourceLimits
&gt; &gt; 
&gt; &gt; NumberOfFiles
&gt; &gt; 4096
&gt; &gt; 
&gt; &gt; HardResourceLimits
&gt; &gt; 
&gt; &gt; NumberOfFiles
&gt; &gt; 4096
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

