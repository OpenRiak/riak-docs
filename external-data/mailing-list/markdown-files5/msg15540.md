---
title: "Basho Product Alert: Serious Bug with Maps in upgrade to 2.0.4"
description: ""
project: community
lastmod: 2015-01-21T01:34:04-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15540"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2015-01-21T01:34:04-08:00
---


Hi,
Basho Engineering has uncovered a bug in the new Map and Set data structures 
[1] in Riak version 2.0.4. This code incorrectly handles a format upgrade 
resulting in the inability to read maps written by pre-2.0.4 releases on a 
2.0.4 node. The issue[2] manifests as a crash message in the log, and a timeout 
reading the map.

We’re working on a fix.

If you have Map data written pre-2.0.4 please hold off upgrading to 2.0.4. If 
you have no existing Map data it is safe to use 2.0.4.

Sadly, downgrading from 2.0.4 to 2.0.2 will be an issue if you have written Map 
data in 2.0.4, as 2.0.2 will not be able to read the 2.0.4 Maps, due to 
backwards incompatibility also.

The plan is as follows:

1. Address the compatibility issue so riak-2.0.5 will be able to read prior 
version map data, making upgrades safe
2. Provide a command you can run from the console to downgrade any map data 
from 2.0.4+ to a version readable by 2.0.x&lt;4. Making downgrades possible

Again, we’re extremely sorry, and we’re working on a fix right now, and 
reviewing the processes that lead to this issue.

There will soon be a Riak-2.0.5 release for hose wishing to upgrade from 
earlier 2.0.x releases, please wait for that.

Russell

[1] https://github.com/basho/riak\\_dt/pull/110
[2] https://github.com/basho/riak/issues/667
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

