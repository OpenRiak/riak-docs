---
title: "Re: Hard time with Riak 2.0.0pre5 features"
description: ""
project: community
lastmod: 2013-11-20T05:31:56-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13030"
mailinglist_parent_id: "msg13027"
author_name: "Valter Balegas"
project_section: "mailinglistitem"
sent_date: 2013-11-20T05:31:56-08:00
---


Hello,

I was able to activate strong consistency, but the node keeps generating 
siblings, when i execute two concurrent writes (Store two objects without 
vector clock).
I tried with the Riak 2.0.0.5pre package and the latest version on the 
repository. Am i missing anything? i was expecting operations to fail, in this 
case.

It seems that the error was caused by my Erlang version. The creation of the 
bucket type didn’t fail with R16B02.

Valter

No dia 20/11/2013, às 03:13, Jordan West  escreveu:

&gt; Valter,
&gt; 
&gt; You mentioned you are using a recent develop. Would you be able to pull down 
&gt; any recent changes and update-deps (or build a fresh devrel)? I just tried a 
&gt; fresh clone of develop and was unable to reproduce the same error. I, also, 
&gt; tried with R15B01 (Riak 2.0 is slated to use R16B02 right now). 
&gt; 
&gt; Alternatively, you should be able to workaround this by doing a `riak 
&gt; attach-direct` and defining the atom at the erlang shell:
&gt; 
&gt; 1&gt; consistent.
&gt; consistent
&gt; 
&gt; Jordan
&gt; 
&gt; 
&gt; On Tue, Nov 19, 2013 at 3:06 PM, Valter Balegas  wrote:
&gt; I can’t create the bucket type:
&gt; 
&gt; RPC to 'riak@127.0.0.1' failed: {'EXIT',
&gt; {badarg,
&gt; [{erlang,list\\_to\\_existing\\_atom,
&gt; ["consistent"],
&gt; []},
&gt; {riak\\_kv\\_wm\\_utils,erlify\\_bucket\\_prop,1,
&gt; [{file,"src/riak\\_kv\\_wm\\_utils.erl"},
&gt; {line,393}]},
&gt; {riak\\_kv\\_console,
&gt; '-bucket\\_type\\_create/2-lc$^0/1-0-',1,
&gt; [{file,"src/riak\\_kv\\_console.erl"},
&gt; {line,483}]},
&gt; {riak\\_kv\\_console,bucket\\_type\\_create,2,
&gt; [{file,"src/riak\\_kv\\_console.erl"},
&gt; {line,483}]},
&gt; {rpc,'-handle\\_call\\_call/6-fun-0-',5,
&gt; [{file,"rpc.erl"},{line,203}]}]}}
&gt; 
&gt; I activated the consensus in riak.conf in the etc dir (find command seems not 
&gt; to find the pattern anywhere else).
&gt; Is there any other way to create the bucket?
&gt; 
&gt; Valter
&gt; 
&gt; No dia 19/11/2013, às 18:10, Jordan West  escreveu:
&gt; 
&gt;&gt; On Tue, Nov 19, 2013 at 7:33 AM, Valter Balegas  wrote:
&gt;&gt; 
&gt;&gt; Strong consistency:
&gt;&gt; How does one activate this? As i understand, either the pb or the http 
&gt;&gt; clients do not accept the consistent property.
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Using strong consistency in the Tech Preview is a two-step process. First, 
&gt;&gt; turn on the feature in your riak.conf (the following command assumes you are 
&gt;&gt; using a devrel):
&gt;&gt; 
&gt;&gt; for d in dev/dev\\*; do sed -e 's/## enable\\_consensus = true/enable\\_consensus 
&gt;&gt; = true/' -i $d/etc/riak.conf; done
&gt;&gt; 
&gt;&gt; Then re(start) the cluster.
&gt;&gt; 
&gt;&gt; With the enable\\_consensus=true un-commented and the cluster running create a 
&gt;&gt; strongly consistent bucket type:
&gt;&gt; 
&gt;&gt; riak-admin bucket-type create  '{"props": {"consistent": true}}'
&gt;&gt; riak-admin bucket-type activate 
&gt;&gt; 
&gt;&gt; You can create and activate the bucket type without having 
&gt;&gt; enabled\\_consensus=true but both must be done to work with strongly 
&gt;&gt; consistent data.
&gt;&gt; 
&gt;&gt; Once that is done you can make requests, just like you would to eventually 
&gt;&gt; consistent data in Riak, but the semantics will be different. For example, 
&gt;&gt; if you make two PUT requests to the same key, w/ no vector clock\\*, the 
&gt;&gt; second request will fail because the data already exists. More details on 
&gt;&gt; semantics of strongly consistent requests can be found in this PR: 
&gt;&gt; https://github.com/basho/riak\\_kv/pull/710
&gt;&gt; 
&gt;&gt; Hope that helps get you started,
&gt;&gt; 
&gt;&gt; Jordan
&gt;&gt; 
&gt;&gt; \\* in strong consistency, the "vector clock" is not really a vector clock. 
&gt;&gt; its called such for familiarity, but like any real vector clock exposed to 
&gt;&gt; the client, should be treated like an opaque context.
&gt;&gt; 
&gt;&gt; Details about my environment:
&gt;&gt; -I’m running Mac OSX 10.9
&gt;&gt; -Erlang R15B01
&gt;&gt; -Compiling riak “develop” branch, from basho github
&gt;&gt; -Compiling riak-erlang-client “master” branch, from basho github.
&gt;&gt; -recompiled the latest versions of the branches just before writing this 
&gt;&gt; email.
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thank you for your help,
&gt;&gt; Valter
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

