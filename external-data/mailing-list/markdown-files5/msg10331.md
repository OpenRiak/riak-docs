---
title: "Re: Protection from listing buckets and other rogue queries"
description: ""
project: community
lastmod: 2013-03-06T09:41:13-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10331"
mailinglist_parent_id: "msg10330"
author_name: "John E. Vincent"
project_section: "mailinglistitem"
sent_date: 2013-03-06T09:41:13-08:00
---


Just a thought but we've been working on disabling certain API
operations at the proxy level. We have a subsystem that uses riak that
should NEVER see a DELETE call ever and we're planning on guaranteeing
that by blocking it at the proxy level.

Combined with the actual nodes being inaccessible in front of the
proxy it seems like this would work. Fair warning I haven't yet DONE
this. It's just on my todo.

On Wed, Mar 6, 2013 at 12:27 PM, John Daily  wrote:
&gt; I've been asking our engineers for help with this, and here's what I've 
&gt; found...
&gt;
&gt; In theory, you could use the standard OTP mechanism[1] via the console to 
&gt; stop and restart the riak\\_kv application to stop a (non-MapReduce) query, but 
&gt; that has not worked across all versions of Riak. The rolling cluster restart 
&gt; seems to be your best bet.
&gt;
&gt;
&gt; Regarding the HTTP API...
&gt;
&gt; I do not recommend doing this without careful testing, because it doesn't 
&gt; appear to be something we or our customers have done, but you should be able 
&gt; to comment out the http listener configuration item under riak\\_core in 
&gt; app.config on each node and then restart. In my very, very limited testing, I 
&gt; did have one node that seemed to die quietly after making the change, but 
&gt; I've not been able to reproduce it and the logs didn't have anything useful.
&gt;
&gt; The administrative console appears to work properly despite the change; the 
&gt; only functionality you should lose would be link walking.
&gt;
&gt;
&gt; It is possible to disable the Webmachine routes that expose bucket and key 
&gt; lists, but there's no built-in way to make that configuration change persist 
&gt; across restarts, so I haven't looked into the mechanism for that.
&gt;
&gt;
&gt; [1] application:stop(riak\\_kv), followed by application:start(riak\\_kv)
&gt;
&gt; -John Daily
&gt; Technical Evangelist
&gt; jda...@basho.com
&gt;
&gt;
&gt;
&gt; On Mar 5, 2013, at 10:01 AM, Chris Read  wrote:
&gt;
&gt;&gt; Greetings all...
&gt;&gt;
&gt;&gt; We have had a situation where someone ran a List Buckets query on the HTTP 
&gt;&gt; interface on a large cluster. This caused the whole system to become 
&gt;&gt; unresponsive and the only way we could think of to stop the load on the 
&gt;&gt; system was to restart the whole cluster.
&gt;&gt;
&gt;&gt; I've spent the morning trawling through the documentation, and can't find 
&gt;&gt; answers to the following:
&gt;&gt;
&gt;&gt; - Is it possible, and if so how does one go about terminating a query like 
&gt;&gt; this? I can see things like Pid in riak-admin top, what can I do with it?
&gt;&gt; - Can we run useful things over HTTP like the /admin console but have the 
&gt;&gt; rest of the HTTP API disabled?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt;
&gt;&gt; Chris
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

