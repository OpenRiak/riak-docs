---
title: "Re: Cluster start and 2i query"
description: ""
project: community
lastmod: 2014-03-08T09:37:21-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13776"
mailinglist_parent_id: "msg13768"
author_name: "Daniel Iwan"
project_section: "mailinglistitem"
sent_date: 2014-03-08T09:37:21-08:00
---


Hi Ciprian

Thanks for that info, helps a lot. That was my suspicion about 2i and
primary partitions.
I reproduced it with 4 riak nodes, stopping 2 of them and executing 2i
query.

Since placement of partitions is "random", does it mean I can have max one
node offline to be able to run 2i successfully?
In my original case nodes 4 and 5 were down.

Daniel



On 7 March 2014 15:08, Ciprian Manea [via Riak Users] &lt;
ml-node+s197444n4030631...@n3.nabble.com&gt; wrote:

&gt; Hi Daniel,
&gt;
&gt; Secondary index queries need at least 1/n\\_val primary partitions to be
&gt; available before it could run successfully and Riak would return
&gt; {error,insufficient\\_vnodes\\_available} while the required primary
&gt; partitions are coming up.
&gt;
&gt; I would suggest defensive programming (retrying the 2i queries on error)
&gt; as a way to mitigate this.
&gt;
&gt;
&gt; Thanks,
&gt; Ciprian
&gt;
&gt;
&gt; On Wed, Mar 5, 2014 at 11:06 PM, Daniel Iwan &lt;[hidden 
&gt; email]
&gt; &gt; wrote:
&gt;
&gt;&gt; Thanks Ciprian
&gt;&gt;
&gt;&gt; We already have wait-for-service in our script and it looks like it's not
&gt;&gt; a
&gt;&gt; sufficient condition to satisfy secondary index query.
&gt;&gt; How long application should wait before starting querying Riak using 2i?
&gt;&gt; Should we do riak-admin transfers to make sure there are no vnode
&gt;&gt; transfers
&gt;&gt; happening?
&gt;&gt;
&gt;&gt; I'm trying to figure it out what {error,insufficient\\_vnodes\\_available}
&gt;&gt; means
&gt;&gt; in terms of 2i query.
&gt;&gt; Does it mean not all primary partitions are up?
&gt;&gt;
&gt;&gt; Regards
&gt;&gt; Daniel
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; View this message in context:
&gt;&gt; http://riak-users.197444.n3.nabble.com/Cluster-start-and-2i-query-tp4030557p4030614.html
&gt;&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; [hidden email] 
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; [hidden email] 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; ------------------------------
&gt; If you reply to this email, your message will be added to the discussion
&gt; below:
&gt;
&gt; http://riak-users.197444.n3.nabble.com/Cluster-start-and-2i-query-tp4030557p4030631.html
&gt; To unsubscribe from Cluster start and 2i query, click 
&gt; here
&gt; .
&gt; NAML
&gt;




--
View this message in context: 
http://riak-users.197444.n3.nabble.com/Cluster-start-and-2i-query-tp4030557p4030639.html
Sent from the Riak Users mailing list archive at Nabble.com.\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

