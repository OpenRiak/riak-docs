---
title: "Re: Riak in Docker - Error folding keys - incomplete_hint"
description: ""
project: community
lastmod: 2015-10-22T16:55:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16698"
mailinglist_parent_id: "msg16697"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2015-10-22T16:55:25-07:00
---


Hi Hector,
You can see the Dockerfile here:
https://gist.github.com/TJC/cb3184705bc0eacde885

It's a work in progress, but also, not that involved.

Ubuntu 14.04 is used as both the docker host, and the docker container.
It's on the btrfs storage driver. (I've had too many issues with the other
two)
The Riak data directory is a volume, and is mounted to an external,
persistent location. (Which is also btrfs)

I suspect there's an issue around Riak shutting down uncleanly when the
docker container is stopped.
I have already had to add this to the start-up each time:
find /var/lib/riak -name "bitcask.\\*.lock" -delete

So it's clear that Riak is getting killed rather than shutting down
cleanly; but even so, I'd hope that Riak would cope with that, rather than
getting into a permanent state of throwing errors.

Toby


On Fri, 23 Oct 2015 at 00:01 Hector Castro  wrote:

&gt; Can't say I've paid enough attention to the logs in my single-machine
&gt; Riak within Docker setups to confirm.
&gt;
&gt; Do you have the container image definitions somewhere public? That may
&gt; help someone reproduce the issue. Also, did you ensure that the Riak
&gt; data directory is setup as a Docker volume?
&gt;
&gt; Other things that come to mind:
&gt;
&gt; - What OS is the Docker host running?
&gt; - What storage driver are you using for Docker?
&gt; - What file system is the Docker data directory using?
&gt;
&gt; --
&gt; Hector
&gt;
&gt;
&gt; On Thu, Oct 22, 2015 at 2:27 AM, Toby Corkindale  wrote:
&gt; &gt; Anyone?
&gt; &gt;
&gt; &gt; I note that after 24 hours (on a very lightly loaded test cluster) I'm
&gt; still
&gt; &gt; seeing these scroll by a lot - 600 an hour per node.
&gt; &gt; Really curious to know if this is expected behaviour or if this is
&gt; resulting
&gt; &gt; from some kind of node corruption.
&gt; &gt;
&gt; &gt; Cheers
&gt; &gt; Toby
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, 21 Oct 2015 at 12:23 Toby Corkindale  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi,
&gt; &gt;&gt; I've been working on getting Riak to run inside Docker containers - in a
&gt; &gt;&gt; multi-machine cluster. (Previous work I've seen has only run Riak as a
&gt; &gt;&gt; cluster all on the same machine.)
&gt; &gt;&gt; I thought I had it cracked, although I tripped up on the existing issue
&gt; &gt;&gt; with Riak and lockfiles[1]. But the nodes have been generating an awful
&gt; lot
&gt; &gt;&gt; of errors like the below, and I wondered if anyone here can give me an
&gt; &gt;&gt; explanation? (And, is it a problem?)
&gt; &gt;&gt;
&gt; &gt;&gt; 2015-10-21 01:19:23.567 [error] &lt;0.24495.0&gt; Error folding keys for
&gt; &gt;&gt; "/var/lib/riak/bitcask.1h/2283596
&gt; &gt;&gt; 30832953580969325755111919221821239459840/2.bitcask.data":
&gt; &gt;&gt; {incomplete\\_hint,4}
&gt; &gt;&gt;
&gt; &gt;&gt; 1: Related issues to the lockfiles --
&gt; &gt;&gt; I note that many are closed, but the problem still exists, and is
&gt; &gt;&gt; particularly triggered by using Docker and stopping/killing Riak more
&gt; &gt;&gt; violently than it likes.
&gt; &gt;&gt; https://github.com/basho/bitcask/issues/163 (closed)
&gt; &gt;&gt; https://github.com/basho/riak/issues/535 (open)
&gt; &gt;&gt; https://github.com/basho/bitcask/issues/167 (closed)
&gt; &gt;&gt; https://github.com/basho/bitcask/issues/99 (closed)
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

