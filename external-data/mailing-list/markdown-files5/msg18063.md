---
title: "Re: Object not found after successful PUT on S3 API"
description: ""
project: community
lastmod: 2017-03-06T09:29:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18063"
mailinglist_parent_id: "msg18062"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2017-03-06T09:29:52-08:00
---


Genuinely stumped then.

I’m surprised that dvv\\_enabled=false is the default as sibling explosion is bad.

I don’t know the CS code very well, but I assume a not\\_found means that either 
the manifest or some chunk is not found. I wonder if you can get the manifest 
and then see if any/all of the chunks are present?

On 6 Mar 2017, at 17:21, Daniel Miller  wrote:

&gt; &gt; Would be good to know the riak version
&gt; 
&gt; Riak 2.1.1
&gt; Riak CS 2.1.0
&gt; Stanchion 2.1.0
&gt; 
&gt; &gt; why the dvv\\_enabled bucket property is set to false, please?
&gt; 
&gt; Looks like that's the default. I haven't changed it.
&gt; 
&gt; &gt; Also, is there multi-datacentre replication involved?
&gt; 
&gt; no
&gt; 
&gt; &gt; Do you re-use your keys, for example, have the keys in question been 
&gt; &gt; created, deleted, and then re-created?
&gt; 
&gt; no
&gt; 
&gt; Thank you for the prompt follow-up.
&gt; 
&gt; Daniel
&gt; 
&gt; 
&gt; On Mon, Mar 6, 2017 at 10:38 AM, Russell Brown  
&gt; wrote:
&gt; Hi,
&gt; Would be good to know the riak version, and why the dvv\\_enabled bucket 
&gt; property is set to false, please? Also, is there multi-datacentre replication 
&gt; involved? Do you re-use your keys, for example, have the keys in question 
&gt; been created, deleted, and then re-created?
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; On 6 Mar 2017, at 15:07, Daniel Miller  wrote:
&gt; 
&gt; &gt; I recently had another case of a disappearing object. This time the object 
&gt; &gt; was successfully PUT, and (unlike the previous cases reported in this 
&gt; &gt; thread) for a period of time GETs were also successful. Then GETs started 
&gt; &gt; 404ing for no apparent reason. There are no errors in the logs to indicate 
&gt; &gt; that anything unusual happened. This is quite disconcerting. Is it normal 
&gt; &gt; that Riak CS just loses track of objects? At this point we are using CS as 
&gt; &gt; primary object storage, meaning we do not have the data stored in another 
&gt; &gt; database so it's critical that the data is not randomly lost.
&gt; &gt;
&gt; &gt; In the CS access logs I see
&gt; &gt;
&gt; &gt; # all prior GET requests for this object succeeding like this one. This is 
&gt; &gt; the last successful GET request:
&gt; &gt; [28/Feb/2017:14:42:35 +0000] "GET 
&gt; &gt; /buckets/blobdb/objects/commcarehq\\_\\_apps%2F3d2b... HTTP/1.0" 200 14923 "" 
&gt; &gt; "Boto3/1.4.0 Python/2.7.6 Linux/3.13.0-86-generic Botocore/1.4.53 Resource"
&gt; &gt; ...
&gt; &gt; # all GET requests for this object are now failing like this one (the first 
&gt; &gt; 404):
&gt; &gt; [02/Mar/2017:08:36:11 +0000] "GET 
&gt; &gt; /buckets/blobdb/objects/commcarehq\\_\\_apps%2F3d2b... HTTP/1.0" 404 240 "" 
&gt; &gt; "Boto3/1.4.0 Python/2.7.6 Linux/3.13.0-86-generic Botocore/1.4.53 Resource"
&gt; &gt;
&gt; &gt; The object name has been elided for readability. I do not know when this 
&gt; &gt; object was PUT into the cluster because I only have logs for the past 
&gt; &gt; month. Is there any way to dig further into Riak or Riak CS data to 
&gt; &gt; determine if the object content is actually completely lost or if there are 
&gt; &gt; any other details that might explain why it is now missing? Could I 
&gt; &gt; increase some logging parameters to get more information about what is 
&gt; &gt; going wrong when something like this happens?
&gt; &gt;
&gt; &gt; I have searched the logs for other 404 responses but found none (other than 
&gt; &gt; the two reported earlier), so this is the 3rd known missing object in the 
&gt; &gt; cluster. We retain logs for one month only (I'm increasing this now because 
&gt; &gt; of this issue), so it is possible that other objects have also gone 
&gt; &gt; missing, but I cannot see them since the logs have been truncated.
&gt; &gt;
&gt; &gt; The cluster now has 7 nodes instead of 9 (see earlier emails in this 
&gt; &gt; thread), and the riak storage backend is now leveldb instead of multi. I 
&gt; &gt; have attached config file templates for riak, raik-cs and stanchion (these 
&gt; &gt; are deployed with ansible).
&gt; &gt;
&gt; &gt; Bucket properties:
&gt; &gt; {
&gt; &gt; "props": {
&gt; &gt; "notfound\\_ok": true,
&gt; &gt; "n\\_val": 3,
&gt; &gt; "last\\_write\\_wins": false,
&gt; &gt; "allow\\_mult": true,
&gt; &gt; "dvv\\_enabled": false,
&gt; &gt; "name": "blobdb",
&gt; &gt; "r": "quorum",
&gt; &gt; "precommit": [],
&gt; &gt; "old\\_vclock": 86400,
&gt; &gt; "dw": "quorum",
&gt; &gt; "rw": "quorum",
&gt; &gt; "small\\_vclock": 50,
&gt; &gt; "write\\_once": false,
&gt; &gt; "basic\\_quorum": false,
&gt; &gt; "big\\_vclock": 50,
&gt; &gt; "chash\\_keyfun": {
&gt; &gt; "fun": "chash\\_std\\_keyfun",
&gt; &gt; "mod": "riak\\_core\\_util"
&gt; &gt; },
&gt; &gt; "postcommit": [],
&gt; &gt; "pw": 0,
&gt; &gt; "w": "quorum",
&gt; &gt; "young\\_vclock": 20,
&gt; &gt; "pr": 0,
&gt; &gt; "linkfun": {
&gt; &gt; "fun": "mapreduce\\_linkfun",
&gt; &gt; "mod": "riak\\_kv\\_wm\\_link\\_walker"
&gt; &gt; }
&gt; &gt; }
&gt; &gt; }
&gt; &gt;
&gt; &gt; I'll be happy to provide more context to help troubleshoot this issue.
&gt; &gt;
&gt; &gt; Thanks in advance for any help you can provide.
&gt; &gt;
&gt; &gt; Daniel
&gt; &gt;
&gt; &gt;
&gt; &gt; On Tue, Feb 14, 2017 at 11:52 AM, Daniel Miller  wrote:
&gt; &gt; Hi Luke,
&gt; &gt;
&gt; &gt; Sorry for the late response and thanks for following up. I haven't seen it 
&gt; &gt; happen since. At this point I'm going to wait and see if it happens again 
&gt; &gt; and hopefully get more details about what might be causing it.
&gt; &gt;
&gt; &gt; Daniel
&gt; &gt;
&gt; &gt; On Thu, Feb 9, 2017 at 1:02 PM, Luke Bakken  wrote:
&gt; &gt; Hi Daniel -
&gt; &gt;
&gt; &gt; I don't have any ideas at this point. Has this scenario happened again?
&gt; &gt;
&gt; &gt; --
&gt; &gt; Luke Bakken
&gt; &gt; Engineer
&gt; &gt; lbak...@basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Jan 25, 2017 at 2:11 PM, Daniel Miller  wrote:
&gt; &gt; &gt; Thanks for the quick response, Luke.
&gt; &gt; &gt;
&gt; &gt; &gt; There is nothing unusual about the keys. The format is a name + UUID + 
&gt; &gt; &gt; some
&gt; &gt; &gt; other random URL-encoded charaters, like most other keys in our cluster.
&gt; &gt; &gt;
&gt; &gt; &gt; There are no errors near the time of the incident in any of the logs (the
&gt; &gt; &gt; last [error] is from over a month before). I see lots of messages like 
&gt; &gt; &gt; this
&gt; &gt; &gt; in console.log:
&gt; &gt; &gt;
&gt; &gt; &gt; /var/log/riak/console.log
&gt; &gt; &gt; 2017-01-20 15:38:10.184 [info]
&gt; &gt; &gt; &lt;0.22902.1193&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:263 Repaired 2 keys 
&gt; &gt; &gt; during
&gt; &gt; &gt; active anti-entropy exchange of
&gt; &gt; &gt; {776422744832042175295707567380525354192214163456,3} between
&gt; &gt; &gt; {776422744832042175295707567380525354192214163456,'riak-fa...@fake3.fake.com'}
&gt; &gt; &gt; and
&gt; &gt; &gt; {822094670998632891489572718402909198556462055424,'riak-fa...@fake9.fake.com'}
&gt; &gt; &gt; 2017-01-20 15:40:39.640 [info]
&gt; &gt; &gt; &lt;0.21789.1193&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:263 Repaired 1 keys 
&gt; &gt; &gt; during
&gt; &gt; &gt; active anti-entropy exchange of
&gt; &gt; &gt; {936274486415109681974235595958868809467081785344,3} between
&gt; &gt; &gt; {959110449498405040071168171470060731649205731328,'riak-fa...@fake3.fake.com'}
&gt; &gt; &gt; and
&gt; &gt; &gt; {981946412581700398168100746981252653831329677312,'riak-fa...@fake5.fake.com'}
&gt; &gt; &gt; 2017-01-20 15:46:40.918 [info]
&gt; &gt; &gt; &lt;0.13986.1193&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:263 Repaired 2 keys 
&gt; &gt; &gt; during
&gt; &gt; &gt; active anti-entropy exchange of
&gt; &gt; &gt; {662242929415565384811044689824565743281594433536,3} between
&gt; &gt; &gt; {685078892498860742907977265335757665463718379520,'riak-fa...@fake3.fake.com'}
&gt; &gt; &gt; and
&gt; &gt; &gt; {707914855582156101004909840846949587645842325504,'riak-fa...@fake6.fake.com'}
&gt; &gt; &gt; 2017-01-20 15:48:25.597 [info]
&gt; &gt; &gt; &lt;0.29943.1193&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:263 Repaired 2 keys 
&gt; &gt; &gt; during
&gt; &gt; &gt; active anti-entropy exchange of
&gt; &gt; &gt; {776422744832042175295707567380525354192214163456,3} between
&gt; &gt; &gt; {776422744832042175295707567380525354192214163456,'riak-fa...@fake3.fake.com'}
&gt; &gt; &gt; and
&gt; &gt; &gt; {799258707915337533392640142891717276374338109440,'riak-fa...@fake0.fake.com'}
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks!
&gt; &gt; &gt; Daniel
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed, Jan 25, 2017 at 9:45 AM, Luke Bakken  wrote:
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; Hi Daniel -
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; This is a strange scenario. I recommend looking at all of the log
&gt; &gt; &gt;&gt; files for "[error]" or other entries at about the same time as these
&gt; &gt; &gt;&gt; PUTs or 404 responses.
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; Is there anything unusual about the key being used?
&gt; &gt; &gt;&gt; --
&gt; &gt; &gt;&gt; Luke Bakken
&gt; &gt; &gt;&gt; Engineer
&gt; &gt; &gt;&gt; lbak...@basho.com
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt;
&gt; &gt; &gt;&gt; On Wed, Jan 25, 2017 at 6:40 AM, Daniel Miller  
&gt; &gt; &gt;&gt; wrote:
&gt; &gt; &gt;&gt; &gt; I have a 9-node Riak CS cluster that has been working flawlessly for
&gt; &gt; &gt;&gt; &gt; about 3
&gt; &gt; &gt;&gt; &gt; months. The cluster configuration, including backend and bucket
&gt; &gt; &gt;&gt; &gt; parameters
&gt; &gt; &gt;&gt; &gt; such as N-value are using default settings. I'm using the S3 API to
&gt; &gt; &gt;&gt; &gt; communicate with the cluster.
&gt; &gt; &gt;&gt; &gt;
&gt; &gt; &gt;&gt; &gt; Within the past week I had an issue where two objects were PUT 
&gt; &gt; &gt;&gt; &gt; resulting
&gt; &gt; &gt;&gt; &gt; in
&gt; &gt; &gt;&gt; &gt; a 200 (success) response, but all subsequent GET requests for those two
&gt; &gt; &gt;&gt; &gt; keys
&gt; &gt; &gt;&gt; &gt; return status of 404 (not found). Other than the fact that they are now
&gt; &gt; &gt;&gt; &gt; missing, there was nothing out of the ordinary with these particular to
&gt; &gt; &gt;&gt; &gt; PUTs. Maybe I'm missing something, but this seems like a scenario that
&gt; &gt; &gt;&gt; &gt; should never happen. All information included here about PUTs and GETs
&gt; &gt; &gt;&gt; &gt; comes
&gt; &gt; &gt;&gt; &gt; from reviewing the CS access logs. Both objects were PUT on the same
&gt; &gt; &gt;&gt; &gt; node,
&gt; &gt; &gt;&gt; &gt; however GET requests returning 404 have been observed on all nodes.
&gt; &gt; &gt;&gt; &gt; There is
&gt; &gt; &gt;&gt; &gt; plenty of other traffic on the cluster involving GETs and PUTs that are
&gt; &gt; &gt;&gt; &gt; not
&gt; &gt; &gt;&gt; &gt; failing. I'm unsure of how to troubleshoot further to find out what may
&gt; &gt; &gt;&gt; &gt; have
&gt; &gt; &gt;&gt; &gt; happened to those objects and why they are now missing. What is the 
&gt; &gt; &gt;&gt; &gt; best
&gt; &gt; &gt;&gt; &gt; approach to figure out why an object that was successfully PUT seems to
&gt; &gt; &gt;&gt; &gt; be
&gt; &gt; &gt;&gt; &gt; missing?
&gt; &gt; &gt;&gt; &gt;
&gt; &gt; &gt;&gt; &gt; Thanks!
&gt; &gt; &gt;&gt; &gt; Daniel Miller
&gt; &gt; &gt;&gt; &gt;
&gt; &gt; &gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; &gt;&gt; &gt; riak-users mailing list
&gt; &gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; &gt;&gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

