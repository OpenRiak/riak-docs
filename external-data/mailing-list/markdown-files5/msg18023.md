---
title: "Re: Riak: reliable object deletion"
description: ""
project: community
lastmod: 2017-02-23T21:52:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18023"
mailinglist_parent_id: "msg18018"
author_name: "al so"
project_section: "mailinglistitem"
sent_date: 2017-02-23T21:52:19-08:00
---


Present both in Solr and Riak.

On Thu, Feb 23, 2017 at 6:02 AM, Fred Dushin  wrote:

&gt; Running a Solr query has no impact on writes -- Riak search queries are
&gt; direct pass throughs to Solr query and don't touch any of the salient Riak
&gt; systems (batching writes to Solr, YZ AAE, etc). I believe the timing of
&gt; the reappearance is a coincidence.
&gt;
&gt; Is it possible the object reappeared via MDC? Do you have record of the
&gt; reappeared object in your other cluster?
&gt;
&gt; Also, just to confirm, when you say the object reappeared -- it
&gt; re-appeared in Riak (and subsequently in Solr), correct? Or are you saying
&gt; you just find the object in Solr (via a search)?
&gt;
&gt; -Fred
&gt;
&gt; On Feb 23, 2017, at 1:43 AM, al so  wrote:
&gt;
&gt; Here is brief env:
&gt;&gt; Riak v 2.0.8 + Solr/ 5 node cluster/ MDC
&gt;&gt;
&gt;&gt; Problem:
&gt;&gt; Deleted object suddenly resurrected after few days. Solr search query(
&gt;&gt; "\\*:\\*") was executed around the time of reappearance.
&gt;&gt;
&gt;&gt; Bucket property for this reappeared object
&gt;&gt; {
&gt;&gt; "props": {
&gt;&gt; "name": "UsaHype",
&gt;&gt; "allow\\_mult": false,
&gt;&gt; "basic\\_quorum": false,
&gt;&gt; "big\\_vclock": 50,
&gt;&gt; "chash\\_keyfun": {
&gt;&gt; "mod": "riak\\_core\\_util",
&gt;&gt; "fun": "chash\\_std\\_keyfun"
&gt;&gt; },
&gt;&gt; "dvv\\_enabled": true,
&gt;&gt; "dw": "quorum",
&gt;&gt; "last\\_write\\_wins": false,
&gt;&gt; "linkfun": {
&gt;&gt; "mod": "riak\\_kv\\_wm\\_link\\_walker",
&gt;&gt; "fun": "mapreduce\\_linkfun"
&gt;&gt; },
&gt;&gt; "n\\_val": 3,
&gt;&gt; "notfound\\_ok": true,
&gt;&gt; "old\\_vclock": 86400,
&gt;&gt; "postcommit": [
&gt;&gt; {
&gt;&gt; "mod": "riak\\_repl\\_leader",
&gt;&gt; "fun": "postcommit"
&gt;&gt; },
&gt;&gt; {
&gt;&gt; "mod": "riak\\_repl2\\_rt",
&gt;&gt; "fun": "postcommit"
&gt;&gt; }
&gt;&gt; ],
&gt;&gt; "pr": 0,
&gt;&gt; "precommit": [
&gt;&gt;
&gt;&gt; ],
&gt;&gt; "pw": 0,
&gt;&gt; "r": "quorum",
&gt;&gt; "repl": true,
&gt;&gt; "rw": "quorum",
&gt;&gt; "small\\_vclock": 50,
&gt;&gt; "w": "quorum",
&gt;&gt; "young\\_vclock": 20
&gt;&gt; }
&gt;&gt; }
&gt;&gt;
&gt;&gt;
&gt;&gt; \\* delete\\_mode is not configured at all. Defaults to 3 sec? Do Tombstone 
&gt;&gt; still get created when no delete\\_mode at all in the config? Can we query 
&gt;&gt; metadata(\\*X-Riak-Deleted)\\* for this reappeared object.\\*
&gt;&gt;
&gt;&gt; How would one go about finding root cause. I do know the date when the
&gt;&gt; object was deleted from our app logs. I also seem to know when it
&gt;&gt; reappeared. Seems like a solr search ("\\*:\\*") in code was executed just
&gt;&gt; before this object reappeared? Look at AAE? Is there a way to find if Solr
&gt;&gt; and Riak backends are out-of-sync (AAE?).
&gt;&gt;
&gt;&gt; I understand tuning other params (allow\\_mult = true, ...) will have its
&gt;&gt; own implications.
&gt;&gt;
&gt;&gt; In summary:
&gt;&gt; How do I find root cause of this issue.
&gt;&gt; How to reliable delete an object.
&gt;&gt;
&gt;&gt; -Volk
&gt;&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

