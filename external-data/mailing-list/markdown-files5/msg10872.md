---
title: "Re: Unexpected Riak 1.3 crash"
description: ""
project: community
lastmod: 2013-04-12T08:19:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10872"
mailinglist_parent_id: "msg10860"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2013-04-12T08:19:10-07:00
---


The fastest fix is to lower the cache\\_size in app.config to 8,388,608 and see 
what happens.

Next is to lower the max\\_open\\_files to 30 in app.config. 

7G Ram is tight.

Matthew


On Apr 11, 2013, at 10:24 PM, thefosk  wrote:

&gt; OS process not running. I think that the whole cluster crashes because the
&gt; other nodes suddenly experience an increased traffic, which makes them crash
&gt; as well.
&gt; 
&gt; This happened on 1.3.1 also, but for some days now everything seems to be
&gt; stable. I guess the main reason why this was happening and may happen again,
&gt; is because Riak is taking too much memory from the system. This is the usage
&gt; that I experience on a random machine in my cluster, when no M/R jobs are
&gt; running:
&gt; 
&gt; Cpu(s): 0.2%us, 0.1%sy, 0.0%ni, 99.7%id, 0.0%wa, 0.0%hi, 0.0%si, 
&gt; 0.0%st
&gt; Mem: 7118944k total, 6619652k used, 499292k free, 11304k buffers
&gt; Swap: 0k total, 0k used, 0k free, 3173148k cached
&gt; 
&gt; PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 
&gt; 
&gt; 
&gt; 11392 riak 20 0 8917m 3.2g 40m S 2.7 46.5 2080:41 beam.smp 
&gt; 
&gt; When M/R jobs are running, almost the whole memory is full. I wonder if
&gt; there is a way to tell Riak to use less memory, at the cost of having slower
&gt; queries. By the way I also think my cluster is over provisioned. As stated
&gt; in the GitHub issue:
&gt; 
&gt; The cluster is made of 4 machines, 64 partitions, and n\\_val=2. Each server
&gt; has an average of 60GB of data stored. The machines are EC2 High CPU extra
&gt; large instances (c1.xlarge), as such they have:
&gt; 
&gt; 7 GiB of memory
&gt; 20 EC2 Compute Units (8 virtual cores with 2.5 EC2 Compute Units each)
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; --
&gt; View this message in context: 
&gt; http://riak-users.197444.n3.nabble.com/Unexpected-Riak-1-3-crash-tp4027359p4027649.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

