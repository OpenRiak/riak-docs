---
title: "Re: Protection from listing buckets and other rogue queries"
description: ""
project: community
lastmod: 2013-03-06T09:28:49-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10330"
mailinglist_parent_id: "msg10319"
author_name: "John Daily"
project_section: "mailinglistitem"
sent_date: 2013-03-06T09:28:49-08:00
---


I've been asking our engineers for help with this, and here's what I've found...

In theory, you could use the standard OTP mechanism[1] via the console to stop 
and restart the riak\\_kv application to stop a (non-MapReduce) query, but that 
has not worked across all versions of Riak. The rolling cluster restart seems 
to be your best bet.


Regarding the HTTP API...

I do not recommend doing this without careful testing, because it doesn't 
appear to be something we or our customers have done, but you should be able to 
comment out the http listener configuration item under riak\\_core in app.config 
on each node and then restart. In my very, very limited testing, I did have one 
node that seemed to die quietly after making the change, but I've not been able 
to reproduce it and the logs didn't have anything useful.

The administrative console appears to work properly despite the change; the 
only functionality you should lose would be link walking.


It is possible to disable the Webmachine routes that expose bucket and key 
lists, but there's no built-in way to make that configuration change persist 
across restarts, so I haven't looked into the mechanism for that.


[1] application:stop(riak\\_kv), followed by application:start(riak\\_kv)

-John Daily
Technical Evangelist
jda...@basho.com



On Mar 5, 2013, at 10:01 AM, Chris Read  wrote:

&gt; Greetings all...
&gt; 
&gt; We have had a situation where someone ran a List Buckets query on the HTTP 
&gt; interface on a large cluster. This caused the whole system to become 
&gt; unresponsive and the only way we could think of to stop the load on the 
&gt; system was to restart the whole cluster. 
&gt; 
&gt; I've spent the morning trawling through the documentation, and can't find 
&gt; answers to the following:
&gt; 
&gt; - Is it possible, and if so how does one go about terminating a query like 
&gt; this? I can see things like Pid in riak-admin top, what can I do with it?
&gt; - Can we run useful things over HTTP like the /admin console but have the 
&gt; rest of the HTTP API disabled?
&gt; 
&gt; Thanks,
&gt; 
&gt; Chris
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

