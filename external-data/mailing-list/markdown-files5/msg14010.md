---
title: "Re: RIAK 1.4.6 - Mass key deletion"
description: ""
project: community
lastmod: 2014-04-06T04:06:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14010"
mailinglist_parent_id: "msg13665"
author_name: "Edgar Veiga"
project_section: "mailinglistitem"
sent_date: 2014-04-06T04:06:23-07:00
---


Hi again!

Sorry to reopen this discussion, but I have another question regarding the
former post.

What if, instead of doing a mass deletion (We've already seen that it will
be non profitable, regarding disk space) I update all the values with an
empty JSON object "{}" ? Do you see any problem with this? I no longer need
those millions of values that are living in the cluster...

When the version 2.0 of riak runs stable I'll do the update and only then
delete those keys!

Best regards


On 18 February 2014 16:32, Edgar Veiga  wrote:

&gt; Ok, thanks a lot Matthew.
&gt;
&gt;
&gt; On 18 February 2014 16:18, Matthew Von-Maszewski wrote:
&gt;
&gt;&gt; Riak 2.0 is coming. Hold your mass delete until then. The "bug" is
&gt;&gt; within Google's original leveldb architecture. Riak 2.0 sneaks around to
&gt;&gt; get the disk space freed.
&gt;&gt;
&gt;&gt; Matthew
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Feb 18, 2014, at 11:10 AM, Edgar Veiga  wrote:
&gt;&gt;
&gt;&gt; The only/main purpose is to free disk space..
&gt;&gt;
&gt;&gt; I was a little bit concerned regarding this operation, but now with your
&gt;&gt; feedback I'm tending to don't do nothing, I can't risk the growing of
&gt;&gt; space...
&gt;&gt; Regarding the overhead I think that with a tight throttling system I
&gt;&gt; could control and avoid overloading the cluster.
&gt;&gt;
&gt;&gt; Mixed feelings :S
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On 18 February 2014 15:45, Matthew Von-Maszewski wrote:
&gt;&gt;
&gt;&gt;&gt; Edgar,
&gt;&gt;&gt;
&gt;&gt;&gt; The first "concern" I have is that leveldb's delete does not free disk
&gt;&gt;&gt; space. Others have executed mass delete operations only to discover they
&gt;&gt;&gt; are now using more disk space instead of less. Here is a discussion of the
&gt;&gt;&gt; problem:
&gt;&gt;&gt;
&gt;&gt;&gt; https://github.com/basho/leveldb/wiki/mv-aggressive-delete
&gt;&gt;&gt;
&gt;&gt;&gt; The link also describes Riak's database operation overhead. This is a
&gt;&gt;&gt; second "concern". You will need to carefully throttle your delete rate or
&gt;&gt;&gt; the overhead will likely impact your production throughput.
&gt;&gt;&gt;
&gt;&gt;&gt; We have new code to help quicken the actual purge of deleted data in
&gt;&gt;&gt; Riak 2.0. But that release is not quite ready for production usage.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; What do you hope to achieve by the mass delete?
&gt;&gt;&gt;
&gt;&gt;&gt; Matthew
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Feb 18, 2014, at 10:29 AM, Edgar Veiga  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Sorry, forgot that info!
&gt;&gt;&gt;
&gt;&gt;&gt; It's leveldb.
&gt;&gt;&gt;
&gt;&gt;&gt; Best regards
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 18 February 2014 15:27, Matthew Von-Maszewski wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Which Riak backend are you using: bitcask, leveldb, multi?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Matthew
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Feb 18, 2014, at 10:17 AM, Edgar Veiga 
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; Hi all!
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; I have a fairly trivial question regarding mass deletion on a riak
&gt;&gt;&gt;&gt; cluster, but firstly let me give you just some context. My cluster is
&gt;&gt;&gt;&gt; running with riak 1.4.6 on 6 machines with a ring of 256 nodes and 1Tb ssd
&gt;&gt;&gt;&gt; disks.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; I need to execute a massive object deletion on a bucket, I'm talking
&gt;&gt;&gt;&gt; of ~1 billion keys (The object average size is ~1Kb). I will not retrive
&gt;&gt;&gt;&gt; the keys from riak because a I have a file with all of them. I'll just
&gt;&gt;&gt;&gt; start a script that reads them from the file and triggers an HTTP DELETE
&gt;&gt;&gt;&gt; for each one.
&gt;&gt;&gt;&gt; &gt; The cluster will continue running on production with a quite high
&gt;&gt;&gt;&gt; load serving all other applications, while running this deletion.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; My question is simple, do I need to have any kind of extra concerns
&gt;&gt;&gt;&gt; regarding this action? Do you advise me on taking special attention to any
&gt;&gt;&gt;&gt; kind of metrics regarding riak or event the servers where it's running?
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Best regards!
&gt;&gt;&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

