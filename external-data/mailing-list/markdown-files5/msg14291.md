---
title: "Re: Using the 'fold' keys threshold"
description: ""
project: community
lastmod: 2014-06-05T08:36:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14291"
mailinglist_parent_id: "msg14217"
author_name: "Alex Moore"
project_section: "mailinglistitem"
sent_date: 2014-06-05T08:36:58-07:00
---


Hi Venkat,

You can find those settings in our docs: 
http://docs.basho.com/riak/1.4.9/ops/advanced/backends/bitcask/#Configuring-Bitcask
 (search for “Fold Keys Threshold”). 

In Bitcask when we do range operations like “List Keys” or other operations 
that require us to fold over all the data, we take a snapshot of the “Keydir” 
to get a consistent read. The Keydir is the hash table that holds the `key-&gt; 
latest object` mapping. When we do this snapshot, we also start a delta of any 
changes since the snapshot.

We use the two “Fold Keys Threshold” options `max\\_fold\\_age` and `max\\_fold\\_puts` 
only when Bitcask is processing one fold operation, and gets a request for a 
second one. These two options let the user choose whether to reuse the 
snapshot, or to block and get a new snapshot before starting the second fold. 
This lets you tradeoff between a potential performance boost and consistency.

By default we have Bitcask side toward consistency; it will get a new snapshot, 
by setting `max\\_fold\\_puts` to `0`. If any new puts come in, we must grab a new 
snapshot before folding again. 

 - Increasing `max\\_fold\\_puts` to `n` will let Bitcask reuse the snapshot 
if there are fewer than `n` changes in the delta.
 - Increasing `max\\_fold\\_age` to `s` will let Bitcask reuse the snapshot 
if the snapshot is younger than `s` microseconds. 

Setting either of these to positive values can let folds ignore recent changes, 
so you can run into stale data. Because of that, we recommend that you don’t 
change them.
I hope this helps.

Thanks,
Alex


On May 13, 2014, at 3:02 PM, Venkatachalam Subramanian 
 wrote:

&gt; Hi All,
&gt; 
&gt; It was very helpful to get my first few questions about Riak/Bitcacsk 
&gt; answered pretty quickly.
&gt; 
&gt; I just have a another question on the same lines,
&gt; 
&gt; I ran across the 'fold keys threshold' option in riak/bitcask.
&gt; I could not find enough information about the 'fold keys' option to 
&gt; understand it completely.
&gt; 
&gt; Could someone tell me what 'fold keys' option is? what does it do? when could 
&gt; we use it? 
&gt; Does it help when you want to get the list of all keys available?
&gt; 
&gt; I greatly appreciate your help.
&gt; Thank You.
&gt; 
&gt; -- 
&gt; Regards,
&gt; Venkat Subramanian
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

