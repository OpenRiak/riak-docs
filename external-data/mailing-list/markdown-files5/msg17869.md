---
title: "Re: Crash Log: yz_anti_entropy"
description: ""
project: community
lastmod: 2017-01-19T05:58:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17869"
mailinglist_parent_id: "msg17868"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2017-01-19T05:58:48-08:00
---


Damion,

Add the following settings within riak.conf:

leveldb.limited\\_developer\\_mem = on
ring\\_size = 8

Erase all data / vnodes and start over.

Matthew


&gt; On Jan 19, 2017, at 8:51 AM, Junk, Damion A  wrote:
&gt; 
&gt; Hi Magnus -
&gt; 
&gt; I've tried a wide range of parameters for leveldb.maximum\\_memory\\_percent 
&gt; ranging from 5 to 70. I also tried the leveldb.maximum\\_memory setting in 
&gt; bytes, ranging from 500MB to 4GB. I get the same results in the crash/console 
&gt; log no matter what the settings. But the log messages seem to indicate an 
&gt; issue with yokozuna, and not leveldb itself from what I can tell.
&gt; 
&gt; I set the max (-Xmx) to 2G for SOLR as well.
&gt; 
&gt; From the log messages, it looks like it's not actually the KV leveldb system 
&gt; that's crashing, but the yokozuna system. I'm not sure how to control or set 
&gt; memory here:
&gt; 
&gt;&gt; {badmatch,{error,{db\\_open,"IO error: lock 
&gt;&gt; /var/lib/riak/yz\\_anti\\_entropy/639406966332270026714112114313373821099470487552/LOCK:
&gt;&gt; Cannot allocate memory"}
&gt; 
&gt; This is a development node, running as a single (nojn-clustered) riak node. 
&gt; It has 14G memory, and at the time of trying changes with Riak, 9GB were 
&gt; free. 
&gt; 
&gt; 
&gt; To Recap:
&gt; 
&gt; There are no keys/values in the database at all. 
&gt; The only default settings I changed were:
&gt; 
&gt; storage\\_backend = leveldb
&gt; search = on
&gt; 
&gt; and when that didn't work, I started changing:
&gt; 
&gt; search.solr.jvm\\_options = -d64 -Xms1g -Xmx2g -XX:+UseStringCache 
&gt; -XX:+UseCompressedOops
&gt; leveldb.maximum\\_memory\\_percent = 5 .. 70 
&gt; 
&gt; and then when nothing seemed to change:
&gt; 
&gt; leveldb.maximum\\_memory = 1000000 ... 4000000000
&gt; 
&gt; 
&gt; Thanks for any assistance!
&gt; 
&gt; 
&gt; Damion
&gt; 
&gt; 
&gt;&gt; On Jan 19, 2017, at 3:33 AM, Magnus Kessler &gt; &gt; wrote:
&gt;&gt; 
&gt;&gt; Hi Damion,
&gt;&gt; 
&gt;&gt; Let me first state that AAE always uses leveldb, regardless of the storage 
&gt;&gt; backend chosen for Riak KV data. Could you please state how much physical 
&gt;&gt; memory your Riak nodes have, and what you have configured for 
&gt;&gt; "leveldb.maximum\\_memory.percent" in "riak.conf"? Have you changed the 
&gt;&gt; settings for "search.solr.jvm\\_options", in particular the memory allocated 
&gt;&gt; to Solr?
&gt;&gt; 
&gt;&gt; As a general rule, leveldb should have at least 350MB of memory available 
&gt;&gt; per partition, and performance has been shown to increase with up to 2GB 
&gt;&gt; (2.5 GB when also using Search and AAE) per partition. Please check that you 
&gt;&gt; have enough memory available in your system.
&gt;&gt; 
&gt;&gt; Kind Regards,
&gt;&gt; 
&gt;&gt; Magnus
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; Magnus Kessler
&gt;&gt; Client Services Engineer
&gt;&gt; Basho Technologies Limited
&gt;&gt; 
&gt;&gt; Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

