---
title: "Re: Riak CS: avoiding RAM overflow and OOM killer"
description: ""
project: community
lastmod: 2016-11-21T22:33:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17775"
mailinglist_parent_id: "msg17733"
author_name: "Daniel Miller"
project_section: "mailinglistitem"
sent_date: 2016-11-21T22:33:07-08:00
---


I found a similar question from over a year ago (
http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2015-July/017327.html),
and it sounds like leveldb is the way to go, although possibly not well
tested. Has anything changed with regard to Basho's (or anyone else)
experience with using leveldb backend instead of the mutli backend for CS?

On Fri, Nov 4, 2016 at 11:48 AM, Daniel Miller  wrote:

&gt; Hi,
&gt;
&gt; I have a Riak CS cluster up and running, and am anticipating exponential
&gt; growth in the number of key/value pairs over the next few years. From
&gt; reading the documentation and experience, I've concluded that the default
&gt; configuration of CS (with riak\\_cs\\_kv\\_multi\\_backend) keeps all keys in RAM.
&gt; The OOM killer strikes when Riak uses too much RAM, which is not good for
&gt; my sanity or sleep. Because of the amount of growth I am anticipating, it
&gt; seems unlikely that I can allocate enough RAM to keep up with the load.
&gt; Disk, on the other hand, is less constrained.
&gt;
&gt; A little background on the data set: I have a sparsely accessed key set.
&gt; By that I mean after a key is written, the more time passes with that key
&gt; not being accessed, the less likely it is to be accessed any time soon. At
&gt; any given time, most keys will be dormant. However, any given key \\*\\_could\\*\\_
&gt; be accessed at any time, so should be possible to retrieve it.
&gt;
&gt; I am currently running a smaller cluster (with smaller nodes: less RAM,
&gt; smaller disks) than I expect to use eventually. I am starting to hit some
&gt; growth-related issues that are prompting me to explore more options before
&gt; it becomes a dire situation.
&gt;
&gt; My question: Are there ways to tune Riak (CS) to support this scenario
&gt; gracefully? That is, are there ways to make Riak not load all keys into
&gt; RAM? It looks like leveldb is just what I want, but I'm a little nervous
&gt; switching over to only leveldb when the default/recommended config uses the
&gt; multi backend.
&gt;
&gt; As a stop-gap measure, I enabled swap (with swappiness = 0), which I
&gt; anticipated would kill performance, but was pleasantly surprised to see it
&gt; return to effectively no-swap performance levels after a short period of
&gt; lower performance. I'm guessing this is not a good long-term solution as my
&gt; dataset grows. The problem with using large amounts of swap is that each
&gt; time Riak starts it needs to read all keys into RAM. Long term, as our
&gt; dataset grows, the amount of time needed to read keys into RAM will cause a
&gt; very long restart time (and thus period of unavailability), which could
&gt; endanger availability for a prolonged period if multiple nodes go down at
&gt; once.
&gt;
&gt; Thanks!
&gt; Daniel Miller
&gt; Dimagi, Inc.
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

