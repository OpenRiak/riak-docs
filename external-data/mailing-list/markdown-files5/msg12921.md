---
title: "Re: Corrupted data using Riak Python Client on Win7 64 bit"
description: ""
project: community
lastmod: 2013-11-09T01:54:47-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12921"
mailinglist_parent_id: "msg12910"
author_name: "finkle mcgraw"
project_section: "mailinglistitem"
sent_date: 2013-11-09T01:54:47-08:00
---


Hi John and Engel,

Here's a link to a Dropbox folder with a set of file pairs (the source file
and the corrupted version that has taken a round trip via riak):
https://www.dropbox.com/sh/snfbiqm0jys9u2a/AZPF7\\_RcBT

John, to answer your questions:

\\*Windows--&gt;Riak--&gt;Ubuntu VM\\*
When uploading files from windows to riak, then downloading them to the
Ubuntu VM, inconsistencies appear also, but always for the same subset of
files (if I repeatedly download the same set of files from riak and verify
against the source files). This to me indicates that these files were
corrupted on the upload from windows to riak.

\\*Ubuntu VM--&gt;Riak--&gt;Windows\\*
When uploading the source files from Ubuntu VM (and after having verified
that they can be downloaded into the Ubuntu VM again without any problems)
and then downloading them to windows, inconsistencies appear. However,
these inconsistencies are varying from file to file from each download
round. I.e., by downloading a file a few times I eventually get a
non-corrupted version. This to me indicates that the files were correctly
uploaded to riak from the Ubuntu VM, but are corrupted somewhere in the
download flow on the windows machine.

Ergo: Data appears to be corrupted both when going upstream and when going
downstream somewhere inside the stack used by the riak python client on
windows 7 64 bit.

One more observation: I've done some byte for byte comparisons when
uploading/downloading, and the error rate appears to be on the order of 0.4
ppm.

Finkle







2013/11/9 John Daily 

&gt; (And the inverse would also be interesting to know.)
&gt;
&gt; -John
&gt;
&gt; On Nov 8, 2013, at 6:41 PM, John Daily  wrote:
&gt;
&gt; If you upload the files from Windows, and download them to the Ubuntu VM,
&gt; do inconsistencies ever appear?
&gt;
&gt; -John
&gt;
&gt; On Nov 8, 2013, at 4:58 PM, Engel Sanchez  wrote:
&gt;
&gt; Hello there,
&gt;
&gt; This looks puzzling. Just from looking at the code we haven't found
&gt; anything suspicious. Would you mind posting a pair of those files that
&gt; failed to match somewhere so we can look at the differences?
&gt;
&gt; Thanks for reporting this.
&gt;
&gt; Engel@Basho
&gt;
&gt;
&gt; On Fri, Nov 8, 2013 at 2:41 PM, finkle mcgraw wrote:
&gt;
&gt;&gt; Fellow Riak users,
&gt;&gt;
&gt;&gt; I've noticed that when I upload binary files with sizes of &gt;~1 MB to Riak
&gt;&gt; from my Windows 7 (64 bit) machine, then read the same data back again,
&gt;&gt; often it has a few corrupted bytes, while maintining the correct total data
&gt;&gt; length.
&gt;&gt;
&gt;&gt; Here's the Python script I use to provoke and detect the situation:
&gt;&gt; https://gist.github.com/anonymous/7376084
&gt;&gt;
&gt;&gt; Notice that I included the typical output when running the script at the
&gt;&gt; bottom of the gist. As you can see, for that particular run, half of the
&gt;&gt; dummy-data files were corrupted. The returned data from Riak has the exact
&gt;&gt; same length as the source, but not the exact same content. I've only done
&gt;&gt; brief analysis of how the corruptions appear within the files that are
&gt;&gt; detected as corrupted, but it looks like it's typically between 1 to 5
&gt;&gt; bytes that are altered, evenly distributed within the file.
&gt;&gt;
&gt;&gt; I get no exceptions or warnings from the Riak Python client. Everything
&gt;&gt; appears to be in order.
&gt;&gt;
&gt;&gt; So far I've tested this on two different windows machines against two
&gt;&gt; different Riak clusters (a five node Amazon cluster with a loadbalancer in
&gt;&gt; front, and a local devcluster running inside an Ubuntu 12.04 Virtual
&gt;&gt; Machine). The problems appear in all four possible combinations.
&gt;&gt;
&gt;&gt; However, if I run the script from within an Ubuntu VM, on one of the said
&gt;&gt; Windows machines, against any of the two Riak clusteres, the problems do
&gt;&gt; NOT appear.
&gt;&gt;
&gt;&gt; Another observation: If I generate 50 sample files, upload them, then
&gt;&gt; repeatedly try to download them over and over again, the script will detect
&gt;&gt; corruptions in different files on each repetition of downloading. E.g., on
&gt;&gt; round one it might say that file 1,5, and 19 were corrupted, but on round
&gt;&gt; two it might say 3, 8 and 19.
&gt;&gt;
&gt;&gt; Here is the riak stats-view from the Amazon cluster we're running (that I
&gt;&gt; tested the script agains):
&gt;&gt; https://gist.github.com/anonymous/7376379
&gt;&gt;
&gt;&gt; But as I said, the corruptions appear also when working locally between a
&gt;&gt; Win7 machine and a cluster running on a virtual Ubuntu 12.04 machine.
&gt;&gt;
&gt;&gt; Here are my local package versions, running on Python 2.7.5 64 bit on
&gt;&gt; Windows 7 64 bit:
&gt;&gt; protobuf==2.4.1
&gt;&gt; riak==2.0.1
&gt;&gt; riak-pb==1.4.1.1
&gt;&gt;
&gt;&gt; Any ideas? This seems relatively serious, unless it's some kind of brutal
&gt;&gt; oversight on my part.
&gt;&gt;
&gt;&gt; Finkle
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

