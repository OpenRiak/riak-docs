---
title: "Re: failed get after successful put"
description: ""
project: community
lastmod: 2014-04-30T15:46:29-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14160"
mailinglist_parent_id: "msg14159"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2014-04-30T15:46:29-07:00
---


The 2.0 solution to this is to create a bucket type
(http://docs.basho.com/riak/2.0.0beta1/dev/advanced/bucket-types/).
Once the type has been created pointed to that particular backend, any
buckets of that type created later will inherit that setting, so you
should be able to create as many of them as you like.

On Wed, Apr 30, 2014 at 4:17 PM, Oleksiy Krivoshey  wrote:
&gt; Yes, it really looks like the above scenario. It started happening when I
&gt; only had no more than 20 custom buckets - is that too much? Whats the
&gt; suggested limit? Will there be other issues when using a lot of buckets or
&gt; is it just for the first gossip period?
&gt;
&gt;
&gt; On 1 May 2014 01:12, Evan Vigil-McClanahan  wrote:
&gt;&gt;
&gt;&gt; I suspect that, given the large heap messages, you're seeing the known
&gt;&gt; issues where when a custom bucket is created and the moving that
&gt;&gt; metadata around the ring takes increasingly long. It isn't
&gt;&gt; recommended to create a large number of custom buckets at the moment.
&gt;&gt;
&gt;&gt; What the process likely looks like is this:
&gt;&gt;
&gt;&gt; 1. you do the set.
&gt;&gt; 2. bucket metadata starts being gossip around the ring.
&gt;&gt; 3. you do the put. it succeeds, but on some nodes, the metadata
&gt;&gt; hasn't been committed, so it's put into the default backend.
&gt;&gt; 4. gossip finishes.
&gt;&gt; 5. you do the get. it fails because now the bucket for this backend
&gt;&gt; has made 2 replicas unreachable.
&gt;&gt; 6. read repair happens, repopulating the 2 missing replicas.
&gt;&gt; 7. you re-get and it works.
&gt;&gt;
&gt;&gt; On Wed, Apr 30, 2014 at 4:04 PM, Oleksiy Krivoshey 
&gt;&gt; wrote:
&gt;&gt; &gt; The objects are really small (50 - 500 bytes).
&gt;&gt; &gt;
&gt;&gt; &gt; It doesn't happen if the bucket was already created.
&gt;&gt; &gt; It also does't happen if I don't call SetBucket at all (so using default
&gt;&gt; &gt; backend and options).
&gt;&gt; &gt; And it seems it doesn't happen if I call SetBucket but don't set
&gt;&gt; &gt; `backend`
&gt;&gt; &gt; property.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On 1 May 2014 00:51, Evan Vigil-McClanahan 
&gt;&gt; &gt; wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Does this continue if the bucket hasn't been created recently? Does
&gt;&gt; &gt;&gt; it matter how large the object is? Is it particularly large in this
&gt;&gt; &gt;&gt; case?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On Wed, Apr 30, 2014 at 3:47 PM, Oleksiy Krivoshey 
&gt;&gt; &gt;&gt; wrote:
&gt;&gt; &gt;&gt; &gt; Hi guys,
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; can someone please suggest what can be the reason for 'get'
&gt;&gt; &gt;&gt; &gt; immediately
&gt;&gt; &gt;&gt; &gt; following successful 'put' to fail?
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; I'm running a fully connected, healthy, 5 node Riak 2.0-beta1
&gt;&gt; &gt;&gt; &gt; cluster.
&gt;&gt; &gt;&gt; &gt; Using
&gt;&gt; &gt;&gt; &gt; a multiple backend feature, so the order of operations is:
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; 1. 'SetBucket' for a new bucket with a backend name. Wait for
&gt;&gt; &gt;&gt; &gt; successful
&gt;&gt; &gt;&gt; &gt; reply
&gt;&gt; &gt;&gt; &gt; 2. 'Put' object to bucket. Wait for successful reply (return\\_head:
&gt;&gt; &gt;&gt; &gt; true,
&gt;&gt; &gt;&gt; &gt; so
&gt;&gt; &gt;&gt; &gt; I get clock, vtag, etc back)
&gt;&gt; &gt;&gt; &gt; 3. 'Get' object from step 2. Returns empty response (missing object)
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; If I repeat 'Get' after just few moments - I will successfully
&gt;&gt; &gt;&gt; &gt; retrieve
&gt;&gt; &gt;&gt; &gt; the
&gt;&gt; &gt;&gt; &gt; object.
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; CAP options are all defaults (n: 3, etc). Happens with both custom
&gt;&gt; &gt;&gt; &gt; bitcask
&gt;&gt; &gt;&gt; &gt; and custom leveldb backends.
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; There are no errors in riak logs, but a lot of the following:
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; 2014-04-30 21:41:05.656 [info]
&gt;&gt; &gt;&gt; &gt; &lt;0.95.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:92 monitor large\\_heap
&gt;&gt; &gt;&gt; &gt; &lt;0.10689.74&gt;
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; [{initial\\_call,{erlang,apply,2}},{almost\\_current\\_function,{eval\\_bits,expr\\_grp,4}},{message\\_queue\\_len,0}]
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; [{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,79467343},{mbuf\\_size,0},{stack\\_size,394},{old\\_heap\\_size,0},{heap\\_size,28858704}]
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; --
&gt;&gt; &gt;&gt; &gt; Oleksiy
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; --
&gt;&gt; &gt; Oleksiy Krivoshey
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Oleksiy Krivoshey

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

