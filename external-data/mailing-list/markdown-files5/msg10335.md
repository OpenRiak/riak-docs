---
title: "Re: Protection from listing buckets and other rogue queries"
description: ""
project: community
lastmod: 2013-03-06T11:21:12-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10335"
mailinglist_parent_id: "msg10331"
author_name: "Chris Read"
project_section: "mailinglistitem"
sent_date: 2013-03-06T11:21:12-08:00
---


Thanks Johns...

Our main interface into Riak is via Erlang, we just like the HTTP for the
Big Green Check mark that tells us the cluster is ok.

What we'll probably do for now then is turn off the HTTP(S) interfaces and
write a little clone of sorts for the status.

It would be good if looking at least one of these could make it into the
backlog - being able to accidentally DOS yourself is a bit of a weakness...

Chris

On Wed, Mar 6, 2013 at 5:38 PM, John E. Vincent &lt;
lusis.org+riak-us...@gmail.com&gt; wrote:

&gt; Just a thought but we've been working on disabling certain API
&gt; operations at the proxy level. We have a subsystem that uses riak that
&gt; should NEVER see a DELETE call ever and we're planning on guaranteeing
&gt; that by blocking it at the proxy level.
&gt;
&gt; Combined with the actual nodes being inaccessible in front of the
&gt; proxy it seems like this would work. Fair warning I haven't yet DONE
&gt; this. It's just on my todo.
&gt;
&gt; On Wed, Mar 6, 2013 at 12:27 PM, John Daily  wrote:
&gt; &gt; I've been asking our engineers for help with this, and here's what I've
&gt; found...
&gt; &gt;
&gt; &gt; In theory, you could use the standard OTP mechanism[1] via the console
&gt; to stop and restart the riak\\_kv application to stop a (non-MapReduce)
&gt; query, but that has not worked across all versions of Riak. The rolling
&gt; cluster restart seems to be your best bet.
&gt; &gt;
&gt; &gt;
&gt; &gt; Regarding the HTTP API...
&gt; &gt;
&gt; &gt; I do not recommend doing this without careful testing, because it
&gt; doesn't appear to be something we or our customers have done, but you
&gt; should be able to comment out the http listener configuration item under
&gt; riak\\_core in app.config on each node and then restart. In my very, very
&gt; limited testing, I did have one node that seemed to die quietly after
&gt; making the change, but I've not been able to reproduce it and the logs
&gt; didn't have anything useful.
&gt; &gt;
&gt; &gt; The administrative console appears to work properly despite the change;
&gt; the only functionality you should lose would be link walking.
&gt; &gt;
&gt; &gt;
&gt; &gt; It is possible to disable the Webmachine routes that expose bucket and
&gt; key lists, but there's no built-in way to make that configuration change
&gt; persist across restarts, so I haven't looked into the mechanism for that.
&gt; &gt;
&gt; &gt;
&gt; &gt; [1] application:stop(riak\\_kv), followed by application:start(riak\\_kv)
&gt; &gt;
&gt; &gt; -John Daily
&gt; &gt; Technical Evangelist
&gt; &gt; jda...@basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mar 5, 2013, at 10:01 AM, Chris Read  wrote:
&gt; &gt;
&gt; &gt;&gt; Greetings all...
&gt; &gt;&gt;
&gt; &gt;&gt; We have had a situation where someone ran a List Buckets query on the
&gt; HTTP interface on a large cluster. This caused the whole system to become
&gt; unresponsive and the only way we could think of to stop the load on the
&gt; system was to restart the whole cluster.
&gt; &gt;&gt;
&gt; &gt;&gt; I've spent the morning trawling through the documentation, and can't
&gt; find answers to the following:
&gt; &gt;&gt;
&gt; &gt;&gt; - Is it possible, and if so how does one go about terminating a query
&gt; like this? I can see things like Pid in riak-admin top, what can I do with
&gt; it?
&gt; &gt;&gt; - Can we run useful things over HTTP like the /admin console but have
&gt; the rest of the HTTP API disabled?
&gt; &gt;&gt;
&gt; &gt;&gt; Thanks,
&gt; &gt;&gt;
&gt; &gt;&gt; Chris
&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

