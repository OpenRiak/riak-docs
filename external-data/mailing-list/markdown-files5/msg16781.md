---
title: "Re: MapReduce \"not_found\" from Solr search index"
description: ""
project: community
lastmod: 2015-11-17T06:18:40-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16781"
mailinglist_parent_id: "msg16780"
author_name: "Ellis Pritchard"
project_section: "mailinglistitem"
sent_date: 2015-11-17T06:18:40-08:00
---


Thanks, that certainly gets the answer for "how many matches" PDQ.

Still concerns me that MapReduce over search indexes doesn't seem to be
working for me, but if there's no obvious answer, I'll leave it at that
until I need it!

Ellis.


On 17 November 2015 at 14:09, Magnus Kessler  wrote:

&gt; On 16 November 2015 at 11:47, Ellis Pritchard 
&gt; wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I've configured a Solr search index ("erights-users") for my bucket
&gt;&gt; (named "missing", default type), containing a bunch of JSON documents, with
&gt;&gt; a search schema ("erightsuser"); this seems to be working OK for simple
&gt;&gt; queries, i.e. I can run a Solr query against it and it returns expected
&gt;&gt; results:
&gt;&gt;
&gt;&gt; $ curl http://localhost:8098/types/default/buckets/missing/props
&gt;&gt;
&gt;&gt;
&gt;&gt; {"props":{"allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dvv\\_enabled":false,"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"name":"missing","notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":"quorum","rw":"quorum","search\\_index":"erights-users","small\\_vclock":50,"w":"quorum","write\\_once":false,"young\\_vclock":20}}
&gt;&gt;
&gt;&gt;
&gt;&gt; $ curl
&gt;&gt; http://localhost:8098/search/query/erights-users?q=country.code:ANT
&gt;&gt;
&gt;&gt; xml version="1.0" encoding="UTF-8"?
&gt;&gt;
&gt;&gt; 0&gt; name="QTime"&gt;58&gt; name="q"&gt;country.code:ANT
&gt;&gt; 127.0.0.1:8093/internal\\_solr/erights-users&gt; name="127.0.0.1:8093"&gt;\\_yz\\_pn:64
&gt;&gt; OR (\\_yz\\_pn:61 AND (\\_yz\\_fpn:61)) OR \\_yz\\_pn:60 OR \\_yz\\_pn:57 OR \\_yz\\_pn:54 OR
&gt;&gt; \\_yz\\_pn:51 OR \\_yz\\_pn:48 OR \\_yz\\_pn:45 OR \\_yz\\_pn:42 OR \\_yz\\_pn:39 OR \\_yz\\_pn:36
&gt;&gt; OR \\_yz\\_pn:33 OR \\_yz\\_pn:30 OR \\_yz\\_pn:27 OR \\_yz\\_pn:24 OR \\_yz\\_pn:21 OR
&gt;&gt; \\_yz\\_pn:18 OR \\_yz\\_pn:15 OR \\_yz\\_pn:12 OR \\_yz\\_pn:9 OR \\_yz\\_pn:6 OR
&gt;&gt; \\_yz\\_pn:3&gt; maxScore="12.103038"&gt;PR&gt; name="country.code"&gt;ANTFIN&gt; name="industry.code"&gt;ENC&gt; name="contactAddress.country.code"&gt;ANT&gt; name="email"&gt;x...@xxx.com&gt; name="gid"&gt;10783b99-9483-414d-a6f8-eb330ff6dfac&gt; name="userId"&gt;10422205&gt; name="\\_yz\\_id"&gt;1\\*default\\*missing\\*10783b99-9483-414d-a6f8-eb330ff6dfac\\*51&gt; name="\\_yz\\_rk"&gt;10783b99-9483-414d-a6f8-eb330ff6dfac&gt; name="\\_yz\\_rt"&gt;defaultmissing ...
&gt;&gt;
&gt;&gt;
&gt;&gt; However, I'm trying to do a simple MapReduce on it, initially to count
&gt;&gt; the documents (following the example in the 2.1.1 riakdocs) and I always
&gt;&gt; seem to get 0 as a result:
&gt;&gt;
&gt;&gt; $ curl -XPOST http://localhost:8098/mapred -H 'Content-Type:
&gt;&gt; application/json' -d
&gt;&gt; '{"inputs":{"module":"yokozuna","function":"mapred\\_search","arg":["erights-users","country.code:ANT"]},"query":[{"map":{"language":"javascript","keep":false,"source":"function(v)
&gt;&gt; { return [1];
&gt;&gt; }"}},{"reduce":{"language":"javascript","keep":true,"name":"Riak.reduceSum"}}]}'
&gt;&gt;
&gt;&gt; [0]
&gt;&gt;
&gt;&gt;
&gt;&gt; If I run with {"keep": true} on the map operation, I get the following:
&gt;&gt;
&gt;&gt;
&gt;&gt; [[{"not\\_found":{"bucket\\_type":"default","bucket":"missing","key":"0063aac8-bb45-4051-a502-d541b41d327b","keydata":{}}},...
&gt;&gt;
&gt;&gt; (NB confusingly, my bucket is called "missing"!).
&gt;&gt;
&gt;&gt; Doing a GET for the keys that come back "not\\_found" works fine.
&gt;&gt;
&gt;&gt;
&gt;&gt; What am I missing?
&gt;&gt;
&gt;&gt;
&gt;&gt; Ellis.
&gt;&gt;
&gt;&gt; (Riak 2.1.1 MacOS X)
&gt;&gt;
&gt;&gt;
&gt;&gt; Hi Ellis,
&gt;
&gt; You don't mention why your use case requires MapReduce, but to simply
&gt; obtain the number of indexed objects there's a much easier way, using only
&gt; Solr query features:
&gt;
&gt; curl -s "
&gt; http://localhost:8098/search/query/erights-users?wt=json&q=country.code:ANT&rows=0
&gt; "
&gt; | python -mjson.tool | grep numFound
&gt;
&gt; The above asks Solr to return its results as JSON ('wt=json'), and
&gt; requests no actual objects, just the header information. The remainder of
&gt; the line uses the python 'json.tool' module to pretty-print the response,
&gt; and extracts the number.
&gt;
&gt; The various Riak clients also offer APIs to obtain search results and may
&gt; make it easier to extract the desired information.
&gt;
&gt; Please let me know if this helped.
&gt;
&gt; Regards,
&gt;
&gt; Magnus
&gt;
&gt;
&gt; --
&gt; Magnus Kessler
&gt; Client Services Engineer
&gt; Basho Technologies Limited
&gt;
&gt; Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
&gt;

-- 

------------------------------
This email was sent by a company owned by Pearson plc, registered office at 
80 Strand, London WC2R 0RL. Registered in England and Wales with company 
number 53723.
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

