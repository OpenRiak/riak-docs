---
title: "Re: Riak 2.1.4 crashes with Out of Memory Error"
description: ""
project: community
lastmod: 2017-05-04T00:06:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18200"
mailinglist_parent_id: "msg18196"
author_name: "Magnus Kessler"
project_section: "mailinglistitem"
sent_date: 2017-05-04T00:06:55-07:00
---


On 2 May 2017 at 14:56, Arulappan, Jerald (Jerald) 
wrote:

&gt; Hi,
&gt;
&gt; I am using a single node riak server 2.1.4 with bitcask as backend for
&gt; storing files.
&gt; The riak node stops working after every week. (Looks like when the active
&gt; anti-entropy process recreates the hash tree)
&gt; The sylog shows Out of memory Error. But the console.log shows "sst: No
&gt; such file or directory"
&gt; \\*Syslog Error:\\*
&gt;
&gt; Apr 26 17:39:37 TLCCBAPRO2 kernel: Out of memory: Kill process 16685
&gt; (beam.smp) score 824 or sacrifice child
&gt; Apr 26 17:39:37 TLCCBAPRO2 kernel: Killed process 16987 (sh)
&gt; total-vm:106168kB, anon-rss:116kB, file-rss:0kB
&gt; Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill process 16685
&gt; (beam.smp) score 824 or sacrifice child
&gt; Apr 26 17:39:41 TLCCBAPRO2 kernel: Killed process 30374 (memsup)
&gt; total-vm:4112kB, anon-rss:80kB, file-rss:0kB
&gt; Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill process 16685
&gt; (beam.smp) score 824 or sacrifice child
&gt; Apr 26 17:39:41 TLCCBAPRO2 kernel: Killed process 14351 (cpu\\_sup)
&gt; total-vm:4112kB, anon-rss:68kB, file-rss:0kB
&gt; Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill process 16685
&gt; (beam.smp) score 824 or sacrifice child
&gt; Apr 26 17:39:41 TLCCBAPRO2 kernel: Killed process 30385 (sh)
&gt; total-vm:106164kB, anon-rss:136kB, file-rss:416kB
&gt; Apr 26 17:44:48 TLCCBAPRO2 run\\_erl[16682]: Erlang closed the connection.
&gt;
&gt; \\*Console.log:\\*
&gt;
&gt; 2017-04-26 17:37:03.493 [info] 
&gt; &lt;0.625.0&gt;@riak\\_kv\\_vnode:maybe\\_create\\_hashtrees:227
&gt; riak\\_kv/91343852333181432387730302044767688728495783936: unable to start
&gt; index\\_hashtree: {error,{{badmatch,{error,{db\\_open,"IO error:
&gt; ./data/anti\\_entropy/91343852333181432387730302044767688728495783936/sst\\_0/001954.sst:
&gt; No such file or directory"}}},[{hashtree,new\\_segment\\_store,2,[{file,"src/
&gt; hashtree.erl"},{line,675}]},{hashtree,new,2,[{file,"src/
&gt; hashtree.erl"},{line,246}]},{riak\\_kv\\_index\\_hashtree,do\\_new\\_
&gt; tree,3,[{file,"src/riak\\_kv\\_index\\_hashtree.erl"},{line,
&gt; 610}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]},{
&gt; riak\\_kv\\_index\\_hashtree,init\\_trees,3,[{file,"src/riak\\_kv\\_
&gt; index\\_hashtree.erl"},{line,474}]},{riak\\_kv\\_index\\_
&gt; hashtree,init,1,[{file,"src/riak\\_kv\\_index\\_hashtree.erl"},{
&gt; line,268}]},{gen\\_server,init\\_it,6,[{file,"gen\\_server.erl"},
&gt; {line,304}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.
&gt; erl"},{line,239}]}]}}
&gt; 2017-04-26 17:37:03.515 [error] &lt;0.30178.2881&gt; CRASH REPORT Process
&gt; &lt;0.30178.2881&gt; with 0 neighbours exited with reason: no match of right hand
&gt; value {error,{db\\_open,"IO error: ./data/anti\\_entropy/
&gt; 936274486415109681974235595958868809467081785344/000037.sst: No such file
&gt; or directory"}} in hashtree:new\\_segment\\_store/2 line 675 in
&gt; gen\\_server:init\\_it/6 line 328
&gt; 2017-04-26 17:37:03.515 [info] 
&gt; &lt;0.623.0&gt;@riak\\_kv\\_vnode:maybe\\_create\\_hashtrees:227
&gt; riak\\_kv/45671926166590716193865151022383844364247891968: unable to start
&gt; index\\_hashtree: {error,{{badmatch,{error,{db\\_open,"IO error:
&gt; ./data/anti\\_entropy/45671926166590716193865151022383844364247891968/sst\\_0/002239.sst:
&gt; No such file or directory"}}},[{hashtree,new\\_segment\\_store,2,[{file,"src/
&gt; hashtree.erl"},{line,675}]},{hashtree,new,2,[{file,"src/
&gt; hashtree.erl"},{line,246}]},{riak\\_kv\\_index\\_hashtree,do\\_new\\_
&gt; tree,3,[{file,"src/riak\\_kv\\_index\\_hashtree.erl"},{line,
&gt; 610}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]},{
&gt; riak\\_kv\\_index\\_hashtree,init\\_trees,3,[{file,"src/riak\\_kv\\_
&gt; index\\_hashtree.erl"},{line,474}]},{riak\\_kv\\_index\\_
&gt; hashtree,init,1,[{file,"src/riak\\_kv\\_index\\_hashtree.erl"},{
&gt; line,268}]},{gen\\_server,init\\_it,6,[{file,"gen\\_server.erl"},
&gt; {line,304}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.
&gt; erl"},{line,239}]}]}}
&gt; 2017-04-26 17:37:03.516 [error] &lt;0.30207.2881&gt; CRASH REPORT Process
&gt; &lt;0.30207.2881&gt; with 0 neighbours exited with reason: no match of right hand
&gt; value {error,{db\\_open,"IO error: ./data/anti\\_entropy/
&gt; 45671926166590716193865151022383844364247891968/sst\\_0/002239.sst: No such
&gt; file or directory"}} in hashtree:new\\_segment\\_store/2 line 675 in
&gt; gen\\_server:init\\_it/6 line 328
&gt;
&gt;
&gt;
&gt; The complete logs are in the attached zip file. Any thoughts on the root
&gt; cause and possible solution to overcome this is much appreciated.
&gt;
&gt;
&gt;
&gt; Regards,
&gt;
&gt; Jerald
&gt;
&gt;
&gt;


Hi Jerald,

I suspect that there is a mis-configuration on your setup. Please check by
running `riak config effective | grep "\\_dir"`, what the values of
`platform\\_data\\_dir` and `anti\\_entropy.data\\_dir` are set to.

Kind Regards,

Magnus


-- 
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

