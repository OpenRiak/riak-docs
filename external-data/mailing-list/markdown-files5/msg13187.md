---
title: "Re: Stalled handoffs on a prod cluster after server crash"
description: ""
project: community
lastmod: 2013-12-10T07:49:10-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13187"
mailinglist_parent_id: "msg13180"
author_name: "Simon Effenberg"
project_section: "mailinglistitem"
sent_date: 2013-12-10T07:49:10-08:00
---


I had something like that once but with version 1.2 or 1.3 .. a rolling
restart helped in my case.

/s

On Mon, 9 Dec 2013 09:48:12 -0500
Ivaylo Panitchkov  wrote:

&gt; Hello,
&gt; 
&gt; We have a prod cluster of four machines running riak (1.1.4 2012-06-19)
&gt; Debian x86\\_64.
&gt; Two days ago one of the servers went down because of a hardware failure.
&gt; I force-removed the machine in question to re-balance the cluster before
&gt; adding the new machine.
&gt; Since then the cluster is operating properly, but I noticed some handoffs
&gt; are stalled now.
&gt; I had similar situation awhile ago that was solved by simply forcing the
&gt; handoffs, but this time the same approach didn't work.
&gt; Any ideas, solutions or just hints are greatly appreciated.
&gt; Below are cluster statuses. Replaced the IP addresses for security reason.
&gt; 
&gt; 
&gt; 
&gt; ~# riak-admin member\\_status
&gt; Attempting to restart script through sudo -u riak
&gt; ================================= Membership
&gt; ==================================
&gt; Status Ring Pending Node
&gt; -------------------------------------------------------------------------------
&gt; valid 45.3% 34.4% 'r...@aaa.aaa.aaa.aaa'
&gt; valid 26.6% 32.8% 'r...@bbb.bbb.bbb.bbb'
&gt; valid 28.1% 32.8% 'r...@ccc.ccc.ccc.ccc'
&gt; -------------------------------------------------------------------------------
&gt; Valid:3 / Leaving:0 / Exiting:0 / Joining:0 / Down:0
&gt; 
&gt; 
&gt; 
&gt; ~# riak-admin ring\\_status
&gt; Attempting to restart script through sudo -u riak
&gt; ================================== Claimant
&gt; ===================================
&gt; Claimant: 'r...@aaa.aaa.aaa.aaa'
&gt; Status: up
&gt; Ring Ready: true
&gt; 
&gt; ============================== Ownership Handoff
&gt; ==============================
&gt; Owner: r...@aaa.aaa.aaa.aaa
&gt; Next Owner: r...@bbb.bbb.bbb.bbb
&gt; 
&gt; Index: 22835963083295358096932575511191922182123945984
&gt; Waiting on: [riak\\_kv\\_vnode]
&gt; Complete: [riak\\_pipe\\_vnode]
&gt; 
&gt; Index: 570899077082383952423314387779798054553098649600
&gt; Waiting on: [riak\\_kv\\_vnode]
&gt; Complete: [riak\\_pipe\\_vnode]
&gt; 
&gt; Index: 1118962191081472546749696200048404186924073353216
&gt; Waiting on: [riak\\_kv\\_vnode]
&gt; Complete: [riak\\_pipe\\_vnode]
&gt; 
&gt; Index: 1392993748081016843912887106182707253109560705024
&gt; Waiting on: [riak\\_kv\\_vnode]
&gt; Complete: [riak\\_pipe\\_vnode]
&gt; 
&gt; -------------------------------------------------------------------------------
&gt; Owner: r...@aaa.aaa.aaa.aaa
&gt; Next Owner: r...@ccc.ccc.ccc.ccc
&gt; 
&gt; Index: 114179815416476790484662877555959610910619729920
&gt; Waiting on: [riak\\_kv\\_vnode]
&gt; Complete: [riak\\_pipe\\_vnode]
&gt; 
&gt; Index: 662242929415565384811044689824565743281594433536
&gt; Waiting on: [riak\\_kv\\_vnode]
&gt; Complete: [riak\\_pipe\\_vnode]
&gt; 
&gt; Index: 1210306043414653979137426502093171875652569137152
&gt; Waiting on: [riak\\_kv\\_vnode]
&gt; Complete: [riak\\_pipe\\_vnode]
&gt; 
&gt; -------------------------------------------------------------------------------
&gt; 
&gt; ============================== Unreachable Nodes
&gt; ==============================
&gt; All nodes are up and reachable
&gt; 
&gt; 
&gt; 
&gt; Thanks in advance,
&gt; Ivaylo
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Ivaylo Panitchkov
&gt; Software developer
&gt; Hibernum Creations Inc.
&gt; 
&gt; Ce courriel est confidentiel et peut aussi être protégé par la loi.Si vous
&gt; avez reçu ce courriel par erreur, veuillez nous en aviser immédiatement en
&gt; y répondant, puis supprimer ce message de votre système. Veuillez ne pas le
&gt; copier, l’utiliser pour quelque raison que ce soit ni divulguer son contenu
&gt; à quiconque.
&gt; This email is confidential and may also be legally privileged. If you have
&gt; received this email in error, please notify us immediately by reply email
&gt; and then delete this message from your system. Please do not copy it or use
&gt; it for any purpose or disclose its content.


-- 
Simon Effenberg | Site Ops Engineer | mobile.international GmbH
Fon: + 49-(0)30-8109 - 7173
Fax: + 49-(0)30-8109 - 7131

Mail: seffenb...@team.mobile.de
Web: www.mobile.de

Marktplatz 1 | 14532 Europarc Dreilinden | Germany


Geschäftsführer: Malte Krüger
HRB Nr.: 18517 P, Amtsgericht Potsdam
Sitz der Gesellschaft: Kleinmachnow 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

