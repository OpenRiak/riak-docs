---
title: "Re: last_write_wins"
description: ""
project: community
lastmod: 2014-01-30T08:26:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13541"
mailinglist_parent_id: "msg13537"
author_name: "Edgar Veiga"
project_section: "mailinglistitem"
sent_date: 2014-01-30T08:26:48-08:00
---


I'll try to explain this the best I can, although it's a simples
architecture I'm not describing it in my native language :)

I have a set of node.js workers (64 for now) that serve as a
cache/middleware layer for a dozen of php applications. Each worker deals
with a set of documents (it's not a distributed cache system). Each worker
updates the documents in memory, and tags them as dirty (just like OS file
cache), and from time to time (for now, it's a 5 seconds window interval),
a persister module will deal with the persistence of those dirty documents
to riak.
If the document isn't in memory, it will be fetched from riak.

If you want document X, you need to ask to the corresponding worker dealing
with it. Two different workers, don't deal with the same document.
That way we can guarantee that there will be no concurrent writes to riak.

Best Regards,




On 30 January 2014 10:46, Russell Brown  wrote:

&gt;
&gt; On 30 Jan 2014, at 10:37, Edgar Veiga  wrote:
&gt;
&gt; Also,
&gt;
&gt; Using last\\_write\\_wins = true, do I need to always send the vclock while on
&gt; a PUT request? In the official documention it says that riak will look only
&gt; at the timestamp of the requests.
&gt;
&gt;
&gt; Ok, from what you've said it sounds like you are always wanting to replace
&gt; what is at a key with the new information you are putting. If that is the
&gt; case, then you have the perfect use case for LWW=true. And indeed, you do
&gt; not need to pass a vclock with your put request. And it sounds like there
&gt; is no need for you to fetch-before-put since that is only to get context
&gt; /resolve siblings. Curious about your use case if you can share more.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt;
&gt;
&gt; Best regards,
&gt;
&gt;
&gt; On 29 January 2014 10:29, Edgar Veiga  wrote:
&gt;
&gt;&gt; Hi Russel,
&gt;&gt;
&gt;&gt; No, it doesn't depend. It's always a new value.
&gt;&gt;
&gt;&gt; Best regards
&gt;&gt;
&gt;&gt;
&gt;&gt; On 29 January 2014 10:10, Russell Brown  wrote:
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 29 Jan 2014, at 09:57, Edgar Veiga  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; tl;dr
&gt;&gt;&gt;
&gt;&gt;&gt; If I guarantee that the same key is only written with a 5 second
&gt;&gt;&gt; interval, is last\\_write\\_wins=true profitable?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; It depends. Does the value you write depend in anyway on the value you
&gt;&gt;&gt; read, or is it always that you are just getting a totally new value that
&gt;&gt;&gt; replaces what is in Riak (regardless what is in Riak)?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 27 January 2014 23:25, Edgar Veiga  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi there everyone!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I would like to know, if my current application is a good use case to
&gt;&gt;&gt;&gt; set last\\_write\\_wins to true.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Basically I have a cluster of node.js workers reading and writing to
&gt;&gt;&gt;&gt; riak. Each node.js worker is responsible for a set of keys, so I can
&gt;&gt;&gt;&gt; guarantee some kind of non distributed cache...
&gt;&gt;&gt;&gt; The real deal here is that the writing operation is not run evertime an
&gt;&gt;&gt;&gt; object is changed but each 5 seconds in a "batch insertion/update" style.
&gt;&gt;&gt;&gt; This brings the guarantee that the same object cannot be write to riak at
&gt;&gt;&gt;&gt; the same time, not event at the same seconds, there's always a 5 second
&gt;&gt;&gt;&gt; window between each insertion/update.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; That said, is it profitable to me if I set last\\_write\\_wins to true?
&gt;&gt;&gt;&gt; I've been facing some massive writting delays under high loads and it would
&gt;&gt;&gt;&gt; be nice if I have some kind of way to tune riak.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks a lot and keep up the good work!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

