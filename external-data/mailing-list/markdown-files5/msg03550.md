---
title: "Re: Correct way to use pbc/mapreduce to do multiget where keys and	bucket names are binary values?"
description: ""
project: community
lastmod: 2011-06-04T02:39:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03550"
mailinglist_parent_id: "msg03542"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-06-04T02:39:37-07:00
---



On 3 Jun 2011, at 00:55, Jacques wrote:

&gt; I'm horrible at character encoding but I don't think so once we use those 
&gt; strings in the Map Reduce json object. Unless we remove a bunch of 
&gt; characters from any character sets, I believe we would choke the json parsing 
&gt; on the riak side since ultimately the job would be read as a utf8 string.

Good point. I didn't think far enough downstream.

&gt; &lt;&gt;
&gt; 
&gt;&gt; I've noticed that there is a secondary erlang format that can be passed for 
&gt;&gt; map reduce jobs, must I use that? If so, does anyone have an example of a 
&gt;&gt; generating one of these from within Java?
&gt; 
&gt; The java PB client doesn't currently support the application/x-erlang-binary 
&gt; content-type for map/reduce jobs. I think that only the erlang pb client does.
&gt; 
&gt; I understand that the current client doesn't support this. I was more 
&gt; thinking that of using Jinterface to generate the erlang version of the map 
&gt; reduce job. I haven't worked with it and really don't have any knowledge 
&gt; around erlang types but figured it might be possible. I guess the question 
&gt; was whether anybody thought this was feasible. 

I think that is feasible. Use the OtpOutputStream and OtpInputStream to 
encode/decode. I'm playing with Jinterface right now to write a basho\\_bench 
driver for the Java client so I have that head on. I'll give it some time this 
weekend.

&gt; 
&gt; &lt;&gt; 
&gt; 
&gt; I was asking on the Riak side. Our real need is multi-get. We're looking for 
&gt; regular pulls of 20 random bucket/key values. We need to minimize the 
&gt; latency each of the pulls. I know that we could split this into 20 separate 
&gt; sockets. (ick... This gets ugly when we're talking about many simultaneous 
&gt; pulls from multiple servers. I'd rather not create pools of 100 sockets per 
&gt; requesting server if I could avoid it.) I was wondering whether if we sent 
&gt; four requests in a row to riak on the same socket, whether it would work on 
&gt; them all at once or serially. I'm guessing serially.

Serially.

&gt; 
&gt; I'm sure I can make it work utilizing the path you referenced above and 
&gt; base85 or base64. It is a simple return all values map job. Based on what 
&gt; you're saying it seems like we have three options:
&gt; 
&gt; - Use a string based binary encoding for our bucket/key names (e.g. base64)
&gt; - Use a truck load of sockets. (How will Riak perform if we are generating 
&gt; let's say 200-500 connections per riak node?)
&gt; - Try to figure out encoding an erlang version of the map reduce job using 
&gt; JInterface (assuming the MapReduce api supports binary buckets and keys if 
&gt; using an erlang content-type).
&gt; 
&gt; Am I missing any options? I'm inclined to see if option 3 is available 
&gt; unless someone says that is a fool's dream.

I like the sound of option 3 also. I'll have a look at it this weekend and get 
back to you.

&gt; 
&gt; Thanks,
&gt; Jacques
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

