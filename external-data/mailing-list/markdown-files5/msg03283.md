---
title: "Re: crash after single insert"
description: ""
project: community
lastmod: 2011-05-07T17:15:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03283"
mailinglist_parent_id: "msg03280"
author_name: "Eric Moritz"
project_section: "mailinglistitem"
sent_date: 2011-05-07T17:15:36-07:00
---


Dang, that was my guess but I wasn't sure if it was a red herring or not.

On Sat, May 7, 2011 at 11:25 AM, Gary William Flake  wrote:
&gt; That was it, Nico.  Thanks.
&gt;
&gt; I know we did a forced shutdown this week, which was probably the cause.  But 
&gt; I would have thought that riak would have taken care of its own lock file 
&gt; bookkeeping on restarting.
&gt;
&gt;
&gt;
&gt;
&gt; On May 7, 2011, at 12:45 AM, Nico Meyer wrote:
&gt;
&gt;&gt; Hi Gary,
&gt;&gt;
&gt;&gt; I had this problem before a few times.
&gt;&gt; It is cause by leftover files named 'bitcask.write.lock'. Normally theey 
&gt;&gt; should be cleared automatically after a crash. They contain the OS process 
&gt;&gt; ID of the erlang VM which created them, and if there is no such process 
&gt;&gt; bitcask deletes the file.
&gt;&gt; I believe that there might exists another process with the same process ID 
&gt;&gt; as the old riak process. Did you reboot the machine by any chance? since 
&gt;&gt; then the PIDs start counting up from 1 again.
&gt;&gt;
&gt;&gt; The easy fix for your problem is to delete all bitcask.write.lock files in 
&gt;&gt; your bitcask directory (e.g. 'rm /var/lib/bitcask/\\*/bitcask.write.lock').
&gt;&gt; If you are curious you could check if my hunch is right beforehand. Just 
&gt;&gt; look at the contents of any of these files (which looks like: PID 
&gt;&gt; /path/to/current/bitcaskfile/123456.bitcask.data), and see if there is 
&gt;&gt; another process with the PID.
&gt;&gt;
&gt;&gt; Cheers Nico
&gt;&gt;
&gt;&gt;
&gt;&gt; On 06.05.2011 23:08, Gary William Flake wrote:
&gt;&gt;&gt; Now trying 500 lines.
&gt;&gt;&gt; -- GWF
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On May 6, 2011, at 2:05 PM, Gary William Flake wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Resending with only the last 1000 lines from the log file, so that the 
&gt;&gt;&gt;&gt; list server doesn't reject it.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Any insights would be greatly appreciated.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -- GWF
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On May 6, 2011, at 1:48 PM, Gary William Flake wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Today, after running fine for a couple of weeks, I had erlang crash, 
&gt;&gt;&gt;&gt;&gt; making it so that riaksearch can only do reads but no writes.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Nothing has changed with the code and it had been running fine for weeks 
&gt;&gt;&gt;&gt;&gt; without a problem.  The sasl-error.log is attached.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Any ideas what's going on?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt; -- GWF
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

