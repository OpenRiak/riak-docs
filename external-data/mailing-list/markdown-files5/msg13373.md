---
title: "Re: Single node causing cluster to be extremely slow (leveldb)"
description: ""
project: community
lastmod: 2014-01-10T06:10:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13373"
mailinglist_parent_id: "msg13367"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2014-01-10T06:10:52-08:00
---


Sean,

Also you mentioned concern about +S 6:6. 2i queries in 1.4 added "sorting". 
Another heavy 2i user noticed that the sorting need more CPU for Erlang. They 
were happier after removing the +S.

And finally, those 2i queries that return "millions of results" … how long do 
those queries take to execute?

Matthew

On Jan 9, 2014, at 9:33 PM, Sean McKibben  wrote:

&gt; We have a 5 node cluster using elevelDB (1.4.2) and 2i, and this afternoon it 
&gt; started responding extremely slowly. CPU on member 4 was extremely high and 
&gt; we restarted that process, but it didn’t help. We temporarily shut down 
&gt; member 4 and cluster speed returned to normal, but as soon as we boot member 
&gt; 4 back up, the cluster performance goes to shit.
&gt; 
&gt; We’ve run in to this before but were able to just start with a fresh set of 
&gt; data after wiping machines as it was before we migrated to this bare-metal 
&gt; cluster. Now it is causing some pretty significant issues and we’re not sure 
&gt; what we can do to get it back to normal, many of our queues are filling up 
&gt; and we’ll probably have to take node 4 off again just so we can provide a 
&gt; regular quality of service.
&gt; 
&gt; We’ve turned off AAE on node 4 but it hasn’t helped. We have some transfers 
&gt; that need to happen but they are going very slowly.
&gt; 
&gt; 'riak-admin top’ on node 4 reports this:
&gt; Load: cpu 610 Memory: total 503852 binary 
&gt; 231544
&gt; procs 804 processes 179850 code 
&gt; 11588
&gt; runq 134 atom 533 ets 
&gt; 4581
&gt; 
&gt; Pid Name or Initial Func Time Reds Memory 
&gt; MsgQ Current Function
&gt; -------------------------------------------------------------------------------------------------------------------------------
&gt; &lt;6175.29048.3&gt; proc\\_lib:init\\_p/5 '-' 462231 51356760 
&gt; 0 mochijson2:json\\_bin\\_is\\_safe/1
&gt; &lt;6175.12281.6&gt; proc\\_lib:init\\_p/5 '-' 307183 64195856 
&gt; 1 gen\\_fsm:loop/7
&gt; &lt;6175.1581.5&gt; proc\\_lib:init\\_p/5 '-' 286143 41085600 
&gt; 0 mochijson2:json\\_bin\\_is\\_safe/1
&gt; &lt;6175.6659.0&gt; proc\\_lib:init\\_p/5 '-' 281845 13752 
&gt; 0 sext:decode\\_binary/3
&gt; &lt;6175.6666.0&gt; proc\\_lib:init\\_p/5 '-' 209113 21648 
&gt; 0 sext:decode\\_binary/3
&gt; &lt;6175.12219.6&gt; proc\\_lib:init\\_p/5 '-' 168832 16829200 
&gt; 0 riak\\_client:wait\\_for\\_query\\_results/4
&gt; &lt;6175.8403.0&gt; proc\\_lib:init\\_p/5 '-' 133333 13880 
&gt; 1 eleveldb:iterator\\_move/2
&gt; &lt;6175.8813.0&gt; proc\\_lib:init\\_p/5 '-' 119548 9000 
&gt; 1 eleveldb:iterator/3
&gt; &lt;6175.8411.0&gt; proc\\_lib:init\\_p/5 '-' 115759 34472 
&gt; 0 riak\\_kv\\_vnode:'-result\\_fun\\_ack/2-fun-0-'
&gt; &lt;6175.5679.0&gt; proc\\_lib:init\\_p/5 '-' 109577 8952 
&gt; 0 riak\\_kv\\_vnode:'-result\\_fun\\_ack/2-fun-0-'
&gt; Output server crashed: connection\\_lost
&gt; 
&gt; Based on that, is there anything anyone can think to do to try to bring 
&gt; performance back in to the land of usability? Does this thing appear to be 
&gt; something that may have been resolved in 1.4.6 or 1.4.7?
&gt; 
&gt; Only thing we can think of at this point might be to remove or force remove 
&gt; the member and join in a new freshly built one, but last time we attempted 
&gt; that (on a different cluster) our secondary indexes got irreparably damaged 
&gt; and only regained consistency when we copied every individual key to (this) 
&gt; new cluster! Not a good experience :( but i’m hopeful that 1.4.6 may have 
&gt; addressed some of our issues.
&gt; 
&gt; Any help is appreciated.
&gt; 
&gt; Thank you,
&gt; Sean McKibben
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

