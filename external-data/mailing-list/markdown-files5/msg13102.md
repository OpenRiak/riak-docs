---
title: "Re: [Confusing search docs] Enabling search on bucket in Riak 2.0"
description: ""
project: community
lastmod: 2013-11-26T17:57:21-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13102"
mailinglist_parent_id: "msg13097"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2013-11-26T17:57:21-08:00
---


Kartik,

The pre7 tag incorporates the new bucket type integration. Bucket types are
a new feature in 2.0 that provide additional namespace support and more
efficient bucket properties (good for when you have many buckets with
custom properties). The particular code you are running against requires
that for data to be indexed in Yokozuna it must be stored under a
non-default bucket type. Since you are not specifying a type the logs
bucket lives under the default type where `yz\\_index` will not be applied.
This will be changed for 2.0 so that any type of bucket may be indexed. In
the meantime, try this:

riak-admin bucket-type create data '{"props":{}}'
riak-admin bucket-type activate data

curl -X PUT -H 'content-type: application/json'
'http://host:port/types/data/buckets/logs/props'
-d '{"props":{"yz\\_index":"allLogs"}}'

That above will change soon as well. We are attempting to rename most user
facing parts of Yokozuna to just "search". This means that `yz\\_index` will
soon become `search\\_index`. Sorry for the inconvenience as things are in a
bit of flux leading up to 2.0.

-Z


On Tue, Nov 26, 2013 at 5:59 PM, Kartik Thakore  wrote:

&gt; So finally got a chance to try this and I am running into issues (I am on
&gt; Riak 2.0pre7) btw.
&gt;
&gt; I have yz turned on:
&gt;
&gt; http://192.168.1.10:8098/yz
&gt;
&gt; I created the index with:
&gt;
&gt; $ curl -i http://192.168.1.10:8098/yz/index/allLogs
&gt;
&gt; HTTP/1.1 200 OK
&gt; Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
&gt; Date: Tue, 26 Nov 2013 22:51:15 GMT
&gt;
&gt; Content-Type: application/json
&gt; Content-Length: 41
&gt;
&gt; {"name":"allLogs","schema":"\\_yz\\_default"}
&gt;
&gt;
&gt; And associated the search to the bucket probs:
&gt;
&gt; http://192.168.1.10:8098/buckets/logs/props
&gt;
&gt; {
&gt;
&gt; props:
&gt; {
&gt;
&gt; allow\\_mult: true,
&gt; basic\\_quorum: false,
&gt; big\\_vclock: 50,
&gt; chash\\_keyfun:
&gt; {
&gt;
&gt; mod: "riak\\_core\\_util",
&gt; fun: "chash\\_std\\_keyfun"
&gt;
&gt; },
&gt; dw: "quorum",
&gt; last\\_write\\_wins: false,
&gt; linkfun:
&gt; {
&gt;
&gt; mod: "riak\\_kv\\_wm\\_link\\_walker",
&gt; fun: "mapreduce\\_linkfun"
&gt;
&gt; },
&gt; n\\_val: 3,
&gt; name: "logs",
&gt; notfound\\_ok: true,
&gt; old\\_vclock: 86400,
&gt; postcommit: [ ],
&gt; pr: 0,
&gt; precommit: [ ],
&gt; pw: 0,
&gt; r: "quorum",
&gt; rw: "quorum",
&gt; small\\_vclock: 50,
&gt; w: "quorum",
&gt; young\\_vclock: 20,
&gt; yz\\_index: "allLogs"
&gt;
&gt; }
&gt;
&gt; }
&gt;
&gt; I put in a text/plain entry with:
&gt;
&gt;
&gt; http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=47ffPuWSln7VhlTl02raJA
&gt;
&gt; [2013-11-26T22:43:26] [ERROR] [192.168.1.102] [0] [
&gt; thakore.kar...@gmail.com] test
&gt;
&gt;
&gt; http://192.168.1.10:8098/riak/logs/26-11-2013T2260?vtag=6IYwwPE27eUbs8ThaSOcTC
&gt;
&gt; [2013-11-26T22:39:59] [ERROR] [192.168.1.102] [0] [
&gt; thakore.kar...@gmail.com] test
&gt;
&gt;
&gt;
&gt; But when I search:
&gt;
&gt; http://192.168.1.10:8098/search/allLogs?q=\\*
&gt;
&gt; No results
&gt;
&gt; http://192.168.1.10:8098/search/allLogs?q=test
&gt;
&gt; No results
&gt;
&gt;
&gt; Whats going on?
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Thu, Nov 21, 2013 at 12:45 PM, Ryan Zezeski  wrote:
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Nov 20, 2013 at 3:48 PM, Kartik Thakore 
&gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Thank you.
&gt; &gt;&gt;
&gt; &gt;&gt; I am creating indexes with:
&gt; &gt;&gt;
&gt; &gt;&gt; curl -i -XPUT http://192.168.1.10:8098/yz/index/allLogs \\
&gt; &gt;&gt; -H 'content-type: application/json' \\
&gt; &gt;&gt; -d '{"schema" : "\\_yz\\_default", "bucket" : "logs" }'
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; But when I check the index with:
&gt; &gt;&gt;
&gt; &gt;&gt; curl -i http://192.168.1.10:8098/yz/index/allLogs
&gt; &gt;&gt;
&gt; &gt;&gt; It drops the bucket association
&gt; &gt;&gt;
&gt; &gt;&gt; HTTP/1.1 200 OK
&gt; &gt;&gt; Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)
&gt; &gt;&gt; Date: Wed, 20 Nov 2013 20:45:21 GMT
&gt; &gt;&gt; Content-Type: application/json
&gt; &gt;&gt; Content-Length: 41
&gt; &gt;&gt;
&gt; &gt;&gt; {"name":"allLogs","schema":"\\_yz\\_default"}
&gt; &gt;
&gt; &gt;
&gt; &gt; Sorry, that documentation is out of date.
&gt; &gt;
&gt; &gt; To associate an index to a bucket you need to set the bucket's
&gt; properties.
&gt; &gt;
&gt; &gt; curl -XPUT -H 'content-type: application/json' '
&gt; http://localhost:8098/buckets/logs/props' -d
&gt; '{"props":{"yz\\_index":"allLogs"}}'
&gt; &gt;
&gt; &gt; You can perform a GET on that same resource to check the yz\\_index
&gt; property is set.
&gt; &gt;
&gt; &gt;&gt;
&gt; &gt;&gt; Also
&gt; &gt;&gt;
&gt; &gt;&gt; what is going on here
&gt; &gt;&gt;
&gt; &gt;&gt; curl -XPUT -H'content-type:application/json'
&gt; http://localhost:8098/buckets/people/keys/me \\
&gt; &gt;&gt; -d'{ "name\\_s" : "kartik" }'
&gt; &gt;&gt;
&gt; &gt;&gt; Why not:
&gt; &gt;&gt; curl -XPUT -H'content-type:application/json'
&gt; http://localhost:8098/rial/people/me \\
&gt; &gt;&gt; -d'{ "name\\_s" : "kartik" }'
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; In Riak 1.0.0 we changed the resource from '/riak//' to
&gt; '/buckets//keys/'. We were supposed to deprecate and
&gt; eventually remove the old resource but we never did. You can still use the
&gt; old style but I would recommend using the new style as it is what we use in
&gt; official docs and there is a chance perhaps the old resources don't stay up
&gt; to date with the latest features.
&gt; &gt;
&gt; &gt;
&gt; &gt; -Z
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

