---
title: "Re: occasional timeout when deleting key on multi-node Riak 1.4"
description: ""
project: community
lastmod: 2014-10-02T10:12:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14977"
mailinglist_parent_id: "msg14976"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2014-10-02T10:12:12-07:00
---



On 2 Oct 2014, at 17:59, Igor Senderovich  wrote:

&gt; There are no other errors in any of the logs at exactly the same time but 
&gt; there are periodic errors in error.log and console.log of the following form 
&gt; (and these occurred seconds before and after the crash):
&gt; 
&gt; 
&gt; \\*\\* Reason for termination =
&gt; \\*\\* 
&gt; {{case\\_clause,"immediate"},[{riak\\_kv\\_vnode,do\\_delete,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1321}]},{riak\\_core\\_vnode,vnode\\_command,3,[{file,"src/riak\\_core\\_vnode.erl"},{line,299}]},{gen\\_fsm,handle\\_m
&gt; sg,7,[{file,"gen\\_fsm.erl"},{line,494}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]}
&gt; 2014-10-02 12:07:57 =CRASH REPORT====
&gt; crasher:
&gt; initial call: poolboy:init/1
&gt; pid: &lt;0.30125.18&gt;
&gt; registered\\_name: []
&gt; exception exit: 
&gt; {{{case\\_clause,"immediate"},[{riak\\_kv\\_vnode,do\\_delete,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1321}]},{riak\\_core\\_vnode,vnode\\_command,3,

Can I see your config? Looks like you have delete\\_mode configured with the 
string “immediate” rather than the atom ‘immediate’.


Cheers

Russell

&gt; 
&gt; 
&gt; On Thu, Oct 2, 2014 at 12:20 PM, Dmitri Zagidulin  
&gt; wrote:
&gt; Thanks. Are there entries in any of the other logs? (like the crash dump).
&gt; 
&gt; Can you also provide more info on the nodes themselves. What size AWS 
&gt; instances are you running? Is the delete timeout happening while load 
&gt; testing? 
&gt; 
&gt; On Thu, Oct 2, 2014 at 12:11 PM, Igor Senderovich 
&gt;  wrote:
&gt; Thanks for your help, Dmitri,
&gt; 
&gt; I get the following in error.log:
&gt; 2014-10-02 12:05:45.037 [error] &lt;0.6359.19&gt; Webmachine error at path 
&gt; "/buckets/imc/keys/5134a18660494ea5553d2c90ef9eea2f" : "Service Unavailable"
&gt; 
&gt; And no, there is no load balancer on our cluster.
&gt; Thank you
&gt; 
&gt; 
&gt; On Thu, Oct 2, 2014 at 11:52 AM, Dmitri Zagidulin  
&gt; wrote:
&gt; One other question - are you using a load balancer for your cluster (like 
&gt; HAProxy or the like). In which case, take a look at its logs, also.
&gt; 
&gt; On Thu, Oct 2, 2014 at 11:51 AM, Dmitri Zagidulin  
&gt; wrote:
&gt; Igor,
&gt; Can you look in the riak log directory, in the error.log (and console log and 
&gt; crash dump file) to see if there's any entries, around the time of the delete 
&gt; operation? And post them here?
&gt; 
&gt; 
&gt; 
&gt; On Thu, Oct 2, 2014 at 11:45 AM, Igor Senderovich 
&gt;  wrote:
&gt; Hi,
&gt; 
&gt; I get a timeout when deleting a key, reproducible in about 1 in 10 times:
&gt; $ curl -i -vvv 
&gt; http://myhost:8098/buckets/imc/keys/5134a18660494ea5553d2c90ef9eea2f
&gt; 
&gt; \\* About to connect() to dp1.prod6.ec2.cmg.net port 8098
&gt; \\* Trying 10.12.239.90... connected
&gt; \\* Connected to dp1.prod6.ec2.cmg.net (10.12.239.90) port 8098
&gt; &gt; DELETE /buckets/imc/keys/5134a18660494ea5553d2c90ef9eea2f HTTP/1.1
&gt; &gt; User-Agent: curl/7.15.5 (x86\\_64-redhat-linux-gnu) libcurl/7.15.5 
&gt; &gt; OpenSSL/0.9.8b zlib/1.2.3 libidn/0.6.5
&gt; &gt; Host: dp1.prod6.ec2.cmg.net:8098
&gt; &gt; Accept: \\*/\\*
&gt; &gt;
&gt; &lt; HTTP/1.1 503 Service Unavailable
&gt; HTTP/1.1 503 Service Unavailable
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
&gt; Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
&gt; &lt; Date: Wed, 01 Oct 2014 16:11:41 GMT
&gt; Date: Wed, 01 Oct 2014 16:11:41 GMT
&gt; &lt; Content-Type: text/plain
&gt; Content-Type: text/plain
&gt; &lt; Content-Length: 18
&gt; Content-Length: 18
&gt; 
&gt; request timed out
&gt; \\* Connection #0 to host dp1.prod6.ec2.cmg.net left intact
&gt; \\* Closing connection #0
&gt; 
&gt; 
&gt; This is on Riak 1.4 on a 5 node cluster with an n-value of 3.
&gt; Thank you for your help
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

