---
title: "Re: Segmentation fault in eleveldb.so on Riak startup"
description: ""
project: community
lastmod: 2013-06-12T14:39:26-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11257"
mailinglist_parent_id: "msg11256"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2013-06-12T14:39:26-07:00
---


Vladimir,

Also, my colleague sent this to me after my first email. This is roughly the 
plan I intend to follow … if the LOG file gives us a direct pointer to a file 
corruption:

https://gist.github.com/gburd/b88aee6da7fee81dc036

However, your crash point suggests we might have to do a bit more work to 
isolate the bad input file. But I would be happy to be wrong and the above 
work as is.

Matthew


On Jun 12, 2013, at 5:13 PM, Matthew Von-Maszewski  wrote:

&gt; Vladimir,
&gt; 
&gt; I asked around the Basho chat room and you have a crash that has never been 
&gt; seen. This should be interesting.
&gt; 
&gt; The crash is happening during a compaction, specifically during the creation 
&gt; of the bloom filter for a new .sst file. Maybe we can isolate the old file 
&gt; that feeding this compaction and move it out of the way for further debugging 
&gt; … and get you running while the debugging happens off-line.
&gt; 
&gt; Would you tar/zip the following files (changing the paths as appropriate for 
&gt; your system):
&gt; 
&gt; tar -czf vladimir\\_LOGs.tgz /var/lib/riak/leveldb/\\*/LOG\\*
&gt; and your app.config file.
&gt; 
&gt; I will see if I can determine where the bad input file resides and help you 
&gt; get back running. Then we can decide how to look deeper for root cause.
&gt; 
&gt; Matthew
&gt; 
&gt; 
&gt; On Jun 12, 2013, at 4:02 PM, Vladimir Shabanov  wrote:
&gt; 
&gt;&gt; Hello,
&gt;&gt; 
&gt;&gt; I have a cluster of 8 Riak-1.3.1 nodes. Recently one of my nodes silently 
&gt;&gt; crashed. Nothing unusual was reported in logs.
&gt;&gt; 
&gt;&gt; When I've tried to start my node again it worked for few seconds and 
&gt;&gt; silently crashed again. I've run 'riak console' and seen "Segmentation 
&gt;&gt; fault".
&gt;&gt; 
&gt;&gt; gdb with dumped core shows:
&gt;&gt; 
&gt;&gt; Program terminated with signal 11, Segmentation fault.
&gt;&gt; #0 0x00007f162547fa30 in MurmurHash64A(void const\\*, int, unsigned int) ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; 
&gt;&gt; Backtrace shows that it happens somewhere in LevelDB compaction.
&gt;&gt; 
&gt;&gt; (gdb) bt
&gt;&gt; #0 0x00007f162547fa30 in MurmurHash64A(void const\\*, int, unsigned int) ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #1 0x00007f162547833c in leveldb::(anonymous 
&gt;&gt; namespace)::BloomFilterPolicy2::CreateFilter(leveldb::Slice const\\*, int, 
&gt;&gt; std::string\\*) const ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #2 0x00007f162548382d in leveldb::FilterBlockBuilder::GenerateFilter() ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #3 0x00007f1625483a58 in leveldb::FilterBlockBuilder::StartBlock(unsigned 
&gt;&gt; long) ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #4 0x00007f1625475175 in leveldb::TableBuilder::Flush() ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #5 0x00007f1625475395 in leveldb::TableBuilder::Add(leveldb::Slice const&, 
&gt;&gt; leveldb::Slice const&) () from 
&gt;&gt; /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #6 0x00007f162545b561 in 
&gt;&gt; leveldb::DBImpl::DoCompactionWork(leveldb::DBImpl::CompactionState\\*) () from 
&gt;&gt; /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #7 0x00007f162545bd3b in leveldb::DBImpl::BackgroundCompaction() ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #8 0x00007f162545ca5d in leveldb::DBImpl::BackgroundCall() ()
&gt;&gt; from /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #9 0x00007f162547bb38 in leveldb::(anonymous 
&gt;&gt; namespace)::PosixEnv::BGThreadWrapper(void\\*) () from 
&gt;&gt; /tank/riak-1.3.1/lib/eleveldb-1.3.0/priv/eleveldb.so
&gt;&gt; #10 0x00007f163366ab50 in start\\_thread () from 
&gt;&gt; /lib/x86\\_64-linux-gnu/libpthread.so.0
&gt;&gt; #11 0x00007f16331aca7d in clone () from /lib/x86\\_64-linux-gnu/libc.so.6
&gt;&gt; #12 0x0000000000000000 in ?? ()
&gt;&gt; 
&gt;&gt; gdb output in gist
&gt;&gt; https://gist.github.com/vshabanov/5768546
&gt;&gt; 
&gt;&gt; Why it's happening and how to bring the node back to life?
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

