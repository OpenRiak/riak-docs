---
title: "memory consumption"
description: ""
project: community
lastmod: 2013-08-02T03:13:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11867"
author_name: "Alexander Ilyin"
project_section: "mailinglistitem"
sent_date: 2013-08-02T03:13:13-07:00
---


Hi,

I have a few questions about Riak memory usage.
We're using Riak 1.3.1 on a 3 node cluster. According to bitcask capacity
calculator (
http://docs.basho.com/riak/1.3.1/references/appendices/Bitcask-Capacity-Planning/)
Riak should use about 30Gb of RAM for out data. Actually, it uses about
45Gb and I can't figure out why. I'm looking at %MEM column in top on each
node for a beam.smp process.

We have:
\\* about 235,000,000 keys
\\* one bucket with 1-byte name
\\* average key size about 24 bytes
\\* n\\_val = 2

Bucket properties:
{"props":{"allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":2,"name":"c","notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":"one","rw":"quorum","small\\_vclock":50,"w":"one","young\\_vclock":20}}

Disk usage is also about 1,5 times more than I have expected (270Gb instead
of 180Gb). I rechecked that I have n\\_val=2 (not 3), it seems alright. Why
this could happen?

Second question is about performance degradation when Riak uses almost all
available memory on the node. We see that 95/99 put percentiles twice as
large for nodes which don't have much free RAM. How much free memory I
should have to keep performance high?

And the last question about memory\\_total metric. riak-admin status returns
value which is less than actual memory consumption as seen in the top.
According to memory\\_total description (
http://docs.basho.com/riak/1.3.1/references/appendices/Inspecting-a-Node/)
they should be equal. Why they are not?


Alexander
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

