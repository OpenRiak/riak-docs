---
title: "Re: Erlang Map/Reduce error"
description: ""
project: community
lastmod: 2011-10-04T02:24:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05019"
mailinglist_parent_id: "msg05018"
author_name: "Kresten Krab Thorup"
project_section: "mailinglistitem"
sent_date: 2011-10-04T02:24:25-07:00
---


The error badfun most likely means that the function's code is not available 
inside Riak.

You need to add {add\\_paths, "/path/to/your/ebin"} in the riak\\_kv section in 
app.config. Read more about it here 
http://wiki.basho.com/MapReduce.html#MapReduce-via-the-Erlang-API

For an explanation of why the badfun happens, you can read this blog:
http://www.javalimit.com/2010/05/passing-funs-to-other-erlang-nodes.html
... which can also give you an idea to how to do it without loading the code 
into riak, i.e. something like this may likely work, but will invoke the 
interpreter inside riak; which may be too slow for your needs.

Kresten


1&gt; FunStr = "fun(O, undefined, none) -&gt; [riak\\_object:get\\_value(O)] end.".
2&gt; {ok, Tokens, \\_} = erl\\_scan:string(FunStr).
3&gt; {ok, [Form]} = erl\\_parse:parse\\_exprs(Tokens).
4&gt; Bindings = erl\\_eval:add\\_binding('B', 2, erl\\_eval:new\\_bindings()).
5&gt; {value, Fun, \\_} = erl\\_eval:expr(Form, Bindings).
6&gt; C:mapred([{&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;}, {&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key2"&gt;&gt;}], [{map, {qfun, 
Fun}, none, true}]).


Kresten




On Oct 4, 2011, at 11:00 AM, Lyes Amazouz wrote:

Hi everybody,

I'm learning how to execute a map/reduce using the riak\\_client module, so I 
tried this:

&gt;Map = fun(O, undefined, none) -&gt; [riak\\_object:get\\_value(O)] end.
&gt;C:mapred([{&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;}, {&lt;&lt;"buck"&gt;&gt;, &lt;&lt;"key2"&gt;&gt;}], [{map, {qfun, 
&gt;Map}, none, true}]).

but I got this error:

{error,{error,{badfun,#Fun},
 [{riak\\_kv\\_mapper,run\\_map,9},
 {riak\\_kv\\_mapper,'-do\\_map/2-fun-0-',9},
 {lists,foldl,3},
 {riak\\_kv\\_mapper,do\\_map,2},
 {gen\\_fsm,handle\\_msg,7},
 {proc\\_lib,init\\_p\\_do\\_apply,3}]}}

What is wring with my code??
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

