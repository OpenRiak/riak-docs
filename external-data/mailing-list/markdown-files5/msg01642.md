---
title: "Re: Python Driver Write Times"
description: ""
project: community
lastmod: 2010-11-28T12:07:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01642"
mailinglist_parent_id: "msg01638"
author_name: "Derek Sanderson"
project_section: "mailinglistitem"
sent_date: 2010-11-28T12:07:36-08:00
---


I'm using the defaults for the python library, so that would be the HTTP
Rest interface. There is support for the PBC interface, which I'm looking
into using now.

I had suspected that since I wasn't really using Riak in such a way as to
let it shine (ie, in a cluster of nodes), that might be part of my problem.

Thanks so much for the detailed response.

On Sun, Nov 28, 2010 at 12:10 PM, Greg Steffensen  wrote:

&gt; This is due to two factors:
&gt;
&gt; 1) Durability. MongoDB stores writes in RAM and flushes them to disk
&gt; periodically (by default, every 60 seconds, according to this page:
&gt; http://www.mongodb.org/display/DOCS/Durability+and+Repair). This means
&gt; that its writes can seem very, very fast, but if the machine goes down, you
&gt; could lose up to 60 seconds of data. Riak writes don't return until the
&gt; data has actually been persisted to disk. Casandra takes the same approach
&gt; as MongoDB, with the same trade-off.
&gt;
&gt; 2) Parallelism. This test isn't taking advantage of Riak's distributed
&gt; nature. Riak really shines when its run on a cluster of machines- you can
&gt; make your write throughput almost arbitrarily fast, as long as you're
&gt; willing add enough machines to the cluster.
&gt;
&gt; I doubt that you'll be able to get single-node Riak to write as fast as
&gt; Mongo, but I'd guess that that numbers will get a little closer if you do
&gt; several writes simultaneously in both by multi-threading using python's
&gt; threading module. Also, be sure that you're using Riak's protocol buffers
&gt; interface, instead of the REST (HTTP) one, which adds a lot of overhead- I
&gt; believe the python client supports both.
&gt;
&gt; Greg
&gt;
&gt;
&gt;
&gt; On Sun, Nov 28, 2010 at 11:48 AM, Derek Sanderson wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I've recently started to explore using Riak (v0.13.0-2) from Python
&gt;&gt; (v2.6.5) as a datastore, and I've run into a performance issue that I'm
&gt;&gt; unsure of the true origin of, and would like some input from users who have
&gt;&gt; been working with Riak and its Python drivers.
&gt;&gt;
&gt;&gt; I have 2 tests set up, one for Riak and another for MongoDB, both using
&gt;&gt; their respectively provided Python drivers. I'm constructing chunks of JSON
&gt;&gt; data consisting of a Person, who has an Address, and a purchase history
&gt;&gt; which contains 1 to 20 line items with some data about the item name, cost,
&gt;&gt; # puchased, etc. A very simple mockup of a purchase history. It does this
&gt;&gt; for 1 million "people" (my initial goal was to see how lookups fared when
&gt;&gt; you reach 1m+ records)
&gt;&gt;
&gt;&gt; When using MongoDB, the speed of inserts is incredibly fast. When using
&gt;&gt; Riak, however, there is a very noticeable lag after each insert. So much so
&gt;&gt; that when running side by side, the MongoDB test breaks into the 10,000s
&gt;&gt; before Riak hits it's first 1k.
&gt;&gt;
&gt;&gt; My main PC is a Windows7 i7 quad core, with 8 gigs of ram, on which I'm
&gt;&gt; running Ubuntu64 v10.04 on a VM, which has 2GB of memory allotted. On this
&gt;&gt; VM, I have Riak and MongoDB running concurrently.
&gt;&gt;
&gt;&gt; Here is a sample of how I'm using the Riak driver:
&gt;&gt;
&gt;&gt; riak\\_conn = RiakClient()
&gt;&gt; bucket = riak\\_conn.bucket("peopledb")
&gt;&gt; for i in range(1,1000000):
&gt;&gt; try:
&gt;&gt; new\\_obj = bucket.new("p" + str(i),MakePerson())
&gt;&gt; new\\_obj.store(return\\_body=False)
&gt;&gt; except Exception as e:
&gt;&gt; print e
&gt;&gt;
&gt;&gt; I'm wondering if there is something blatantly wrong I'm doing. I didn't
&gt;&gt; see any kind of batch-store method on the bucket (instead of calling store
&gt;&gt; on each object, simply persist the entirety of the bucket itself), and I
&gt;&gt; wasn't sure if this was an issue with my particular setup (maybe the
&gt;&gt; specifics of my VM are somehow throttling its performance), or maybe just a
&gt;&gt; known limitation that I wasn't aware of.
&gt;&gt;
&gt;&gt; To shed some light on the disparity, I re factored my persistence into
&gt;&gt; separate methods, and used a wrapper to pull out the execution times. Here
&gt;&gt; is a very condensed list of run times. The method in question, for both
&gt;&gt; datastores, simply creates a new "Person" and stores it. Nothing else.
&gt;&gt;
&gt;&gt; MakeRiakPerson took 40.139 ms
&gt;&gt; MakeRiakPerson took 40.472 ms
&gt;&gt; MakeRiakPerson took 40.651 ms
&gt;&gt; MakeRiakPerson took 51.630 ms
&gt;&gt; MakeRiakPerson took 36.733 ms
&gt;&gt;
&gt;&gt; MakeMongoPerson took 1.810 ms
&gt;&gt; MakeMongoPerson took 3.619 ms
&gt;&gt; MakeMongoPerson took 1.036 ms
&gt;&gt; MakeMongoPerson took 1.275 ms
&gt;&gt; MakeMongoPerson took 3.656 ms
&gt;&gt;
&gt;&gt; Thankyou in advance for any help that can be offered here. I'm incredibly
&gt;&gt; new to Riak as a whole, as well as very inexperienced when it comes to
&gt;&gt; working in a \\*nix environment, so I imagine there are countless ways I could
&gt;&gt; have shot myself in the foot without realizing it.
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

