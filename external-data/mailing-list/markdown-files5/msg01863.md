---
title: "riak indexing/search issue with json"
description: ""
project: community
lastmod: 2010-12-30T23:51:29-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01863"
author_name: "Joseph Lambert"
project_section: "mailinglistitem"
sent_date: 2010-12-30T23:51:29-08:00
---


Hello,

I'm having a bit of a problem with k/v indexing and json objects in Riak
Search 0.13.0. I have JSON objects of this format:

{
 "id" : 1,
 "users" : [1559620, 2619082],
 "userData" : {
 "viewedBy1559620" : {
 "isDeleted" : "false"
 }
 "viewedBy2619082" : {
 "isDeleted" : "false"
 }
 }
}

My indexing schema is (also have tried with DefaulAnalyzerFactory):

{
 schema,
 [
 {version, "0.0.3"},
 {default\\_field, "id"},
 {default\\_op, "and"},
 {n\\_val, 2},
 {analyzer\\_factory,
"com.basho.search.analysis.WhitespaceAnalyzerFactory"}
 ],
 [
 {field, [
 {name, "id"},
 {type, integer}
 ]},
 {field, [
 {name, "users"},
 {type, integer}
 ]},
 {dynamic\\_field, [
 {name, "userData\\*isDeleted"},
 {type, string}
 ]},
 {dynamic\\_field, [
 {name, "\\*"},
 {required, false},
 {skip, true}
 ]}
 ]
}.


The appropriate fields are extracted by the extractor and this is the index
created by both factories:

{riak\\_idx\\_doc,&lt;&lt;"test"&gt;&gt;,
 &lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,
 [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,
 [{&lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,[0]}]},
 {&lt;&lt;"userData\\_viewedBy1559620\\_isDeleted"&gt;&gt;,&lt;&lt;"false"&gt;&gt;,
 [{&lt;&lt;"false"&gt;&gt;,[0]}]},
 {&lt;&lt;"userData\\_viewedBy2619082\\_isDeleted"&gt;&gt;,&lt;&lt;"false"&gt;&gt;,
 [{&lt;&lt;"false"&gt;&gt;,[0]}]},
 {&lt;&lt;"users"&gt;&gt;,&lt;&lt;"1559620 2619082"&gt;&gt;,
 [{&lt;&lt;"0002619082"&gt;&gt;,[1]},{&lt;&lt;"0001559620"&gt;&gt;,[0]}]}],
 [],[],true}

The problem comes when I am searching. If I run the following searches
1.) users:0001559620
2.) users:0002619082
3.) userData\\_viewedBy1559620\\_isDeleted:false
4.) userData\\_viewedBy2619082\\_isDeleted:false

I get these results:

using search:search from the riak console:
1.) works
2.) works
3.) does not work
4.) works

The same queries from http using the solr interface (properly url encoded, I
swear):
1.) does not work
2.) works
3.) does not work
4.) does not work

Now, from the interactive shell:
1.) does not work
2.) works
3.) works
4.) does not work


Can anyone help explain to me where I am going wrong?

- Joe Lambert

joseph.g.lamb...@gmail.com
+86 13656213284
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

