---
title: "Re: Practical Riak cluster choices in AWS (number of nodes? AZ's?)"
description: ""
project: community
lastmod: 2013-08-11T17:59:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11974"
mailinglist_parent_id: "msg11973"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2013-08-11T17:59:16-07:00
---


+1 to what Jeremiah said, putting a 4 or 5 node cluster in each US West and
US East using MDC between them would be the optimum solution. I'm also not
buying consistent latencies between AZ's, but I've also not tested it
personally in a production environment. We have many riak-users members on
AWS, so hopefully more experienced people will chime in.

If you haven't seen them already, here's what I have in my "Riak on AWS"
bookmark folder:

http://media.amazonwebservices.com/AWS\\_NoSQL\\_Riak.pdf
http://docs.basho.com/riak/latest/ops/tuning/aws/
http://basho.com/riak-on-aws-deployment-options/

-Jared




On Sun, Aug 11, 2013 at 6:11 PM, Jeremiah Peschka &lt;
jeremiah.pesc...@gmail.com&gt; wrote:

&gt; I'd be wary of using EBS backed nodes for Riak - with only a single
&gt; ethernet connection, it wil be very easy to saturate the max of 1000mbps
&gt; available in a single AWS NIC (unless you're using cluster compute
&gt; instances). I'd be more worried about temporarily losing contact with a
&gt; node through network saturation than through AZ failure, truthfully.
&gt;
&gt; The beauty of Riak is that a node can drop and you can replace it with
&gt; minimal fuss. Use that to your advantage and make every node in the cluster
&gt; disposable.
&gt;
&gt; As far as doubling up in one AZ goes - if you're worried about AZ failure,
&gt; you should treat each AZ as a separate data center and design your failure
&gt; scenarios accordingly. Yes, Amazon say you should put one Riak node in each
&gt; AZ; I'm not buying that. With no guarantee around latency, and no control
&gt; around between DCs, you need to be very careful how much of that latency
&gt; you're willing to introduce into your application.
&gt;
&gt; Were I in your position, I'd stand up a 5 node cluster in US-WEST-2 and be
&gt; done with it. I'd consider Riak EE for my HA/DR solution once the business
&gt; decides that off-site HA/DR is something it wants/needs.
&gt;
&gt;
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt;
&gt;
&gt; On Sun, Aug 11, 2013 at 1:52 PM, Brady Wetherington 
&gt; wrote:
&gt;
&gt;&gt; Hi all -
&gt;&gt;
&gt;&gt; I have some questions about how I want my Riak stuff to work - I've
&gt;&gt; already asked these questions of some Basho people and gotten some answers,
&gt;&gt; but thought I would toss it out into the wider world to see what you all
&gt;&gt; have to say, too:
&gt;&gt;
&gt;&gt; First off - I know 5 instances is the "magic number" of instances to
&gt;&gt; have. If I understand the thinking here, it's that at the default
&gt;&gt; redundancy level ('n'?) of 3, it is most likely to start getting me some
&gt;&gt; scaling (e.g., performance &gt; just that of a single node), and yet also have
&gt;&gt; redundancy; whereby I can lose one box and not start to take a performance
&gt;&gt; hit.
&gt;&gt;
&gt;&gt; My question is - I think I can only do 4 in a way that makes sense. I
&gt;&gt; only have 4 AZ's that I can use right now; AWS won't let me boot instances
&gt;&gt; in 1a. My concern is if I try to do 5, I will be "doubling up" in one AZ -
&gt;&gt; and in AWS you're almost as likely to lose an entire AZ as you are a single
&gt;&gt; instance. And so, if I have instances doubled-up in one AZ (let's say
&gt;&gt; us-east-1e), and then I lose 1e, I've now lost two instances. What are the
&gt;&gt; chances that all three of my replicas of some chunk of my data are on those
&gt;&gt; two instances? I know that it's not guaranteed that all replicas are on
&gt;&gt; separate nodes.
&gt;&gt;
&gt;&gt; So is it better for me to ignore the recommendation of 5 nodes, and just
&gt;&gt; do 4? Or to ignore the fact that I might be doubling-up in one AZ? Also,
&gt;&gt; another note. These are designed to be 'durable' nodes, so if one should go
&gt;&gt; down I would expect to bring it back up \\*with\\* its data - or, if I
&gt;&gt; couldn't, I would do a force-replace or replace and rebuild it from the
&gt;&gt; other replicas. I'm definitely not doing instance-store. So I don't know if
&gt;&gt; that mitigates my need for a full 5 nodes. I would also consider losing one
&gt;&gt; node to be "degraded" and would probably seek to fix that problem as soon
&gt;&gt; as possible, so I wouldn't expect to be in that situation for long. I would
&gt;&gt; probably tolerate a drop in performance during that time, too. (Not a
&gt;&gt; super-severe one, but 20-30 percent? Sure.)
&gt;&gt;
&gt;&gt; What do you folks think?
&gt;&gt;
&gt;&gt; -B.
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

