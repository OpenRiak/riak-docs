---
title: "Re: Riak Search and Yokozuna Backup Strategy"
description: ""
project: community
lastmod: 2014-01-27T13:03:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13498"
mailinglist_parent_id: "msg13497"
author_name: "Elias Levy"
project_section: "mailinglistitem"
sent_date: 2014-01-27T13:03:36-08:00
---


On Mon, Jan 27, 2014 at 12:29 PM, Ryan Zezeski  wrote:

&gt; Any comments on the backup strategy for Yokozuna? Will it make use of
&gt;&gt; Solr's Replication Handler, or something more lower level? Will the node
&gt;&gt; need to be offline to backup it up?
&gt;&gt;
&gt;
&gt; There is no use of any Solr replication code--at all.
&gt;

I knew that. I mention the Solr Replication Handler because its one way
to make a backupof
Solr, even when there are no replicas of the index. It can be used to
have Solr create a backup by creating hard links to the index files.

Another issue is that various parts of Riak that write to disk may not be
&gt; snapshot safe. It's already been discussed how leveldb isn't. I'm willing
&gt; to bet Lucene isn't either. Any case where a logical operation requires
&gt; multiple filesystem writes you have to worry about the snapshot occurring
&gt; in the middle of the logical operation. I have no idea how Lucene would
&gt; deal with snapshots that occur at the wrong time. I'm unsure how good it is
&gt; at detecting, and more importantly, recovering from corruption.
&gt;

It appears that the recommended way to make a Lucene backup is to make use
of 
SnapshotDeletionPolicyto
take a snapshot, backup all the files the snapshot references, and
then
to release the snapshot.

So it would appear to do it properly, we'd need some support from Yokozuna
to take the snapshot, return a list of files to backup or back them up
itself (hard links?), and then to allow an application to signal it to
release the snapshot or release it itself if its doing the backup.
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

