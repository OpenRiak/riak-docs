---
title: "Re: Map phase timeout"
description: ""
project: community
lastmod: 2013-04-08T00:22:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10745"
mailinglist_parent_id: "msg10744"
author_name: "Matt Black"
project_section: "mailinglistitem"
sent_date: 2013-04-08T00:22:12-07:00
---


Thanks for the reply, Christian.

I didn't explain well enough in my first post - the map reduce operation is
merely loading a bunch of objects, and a Python script which makes the
connection to Riak then will write these objects to disk. (It's probably
obvious, but I'm using javascript and riak python client.)

The query itself has many map phases where a composite object is built up
from related objects spread across many buckets.

I was hoping there may be some kind of timeout I could adjust on a per-map
phase basis - clutching at straws really.

Cheers
Matt


On 8 April 2013 17:14, Christian Dahlqvist  wrote:

&gt; Hi,
&gt;
&gt; Without having access to the mapreduce functions you are running, I would
&gt; assume that a mapreduce job both writing data to disk as well as deleting
&gt; the written record from Riak might be quite slow. This is not really a use
&gt; case mapreduce was designed for, and when a mapreduce job crashes or times
&gt; out it is difficult to know how far along the processing of different
&gt; records it got.
&gt;
&gt; I would therefore recommend considering running this type of archiving and
&gt; delete job as an external batch process instead as it will give you better
&gt; control over the execution and avoid timeout problems.
&gt;
&gt; Best regards,
&gt;
&gt; Christian
&gt;
&gt;
&gt;
&gt; On 8 Apr 2013, at 00:49, Matt Black  wrote:
&gt;
&gt; &gt; Dear list,
&gt; &gt;
&gt; &gt; I'm currently getting a timeout during a single phase of a multi-phase
&gt; map reduce query. Is there anything I can do to assist this in running?
&gt; &gt;
&gt; &gt; It's purpose is to backup and remove objects from Riak, so it will run
&gt; periodically during quiet times moving old data out of Riak into file
&gt; storage.
&gt; &gt;
&gt; &gt; Traceback (most recent call last):
&gt; &gt; File "./tools/rolling\\_backup.py", line 185, in 
&gt; &gt; main()
&gt; &gt; File "./tools/rolling\\_backup.py", line 181, in main
&gt; &gt; args.func(\\*\\*kwargs)
&gt; &gt; File "/srv/backup/tools/mapreduce.py", line 295, in do\\_map\\_reduce
&gt; &gt; raise e
&gt; &gt; Exception:
&gt; {"phase":2,"error":"timeout","input":"[&lt;&lt;\\"cart-products\\"&gt;&gt;,&lt;&lt;\\"cd67d7f6e2688bc2089e6fa79506ac05-2\\"&gt;&gt;,{struct,[{&lt;&lt;\\"uid\\"&gt;&gt;,&lt;&lt;\\"cd67d7f6e2688bc2089e6fa79506ac05\\"&gt;&gt;},{&lt;&lt;\\"cart\\"&gt;&gt;,{struct,[{&lt;&lt;\\"expired\\_ts\\"&gt;&gt;,&lt;&lt;\\"2013-03-05T19:12:23.906228\\"&gt;&gt;},{&lt;&lt;\\"last\\_updated\\"&gt;&gt;,&lt;&lt;\\"2013-03-05T19:12:23.906242\\"&gt;&gt;},{&lt;&lt;\\"tags\\"&gt;&gt;,{struct,[{&lt;&lt;\\"type\\"&gt;&gt;,&lt;&lt;\\"AB\\"&gt;&gt;}]}},{&lt;&lt;\\"completed\\"&gt;&gt;,false},{&lt;&lt;\\"created\\"&gt;&gt;,&lt;&lt;\\"2013-03-04T02:10:18.638413\\"&gt;&gt;},{&lt;&lt;\\"products\\"&gt;&gt;,[{struct,[{&lt;&lt;\\"cost\\"&gt;&gt;,0},{&lt;&lt;\\"bundleName\\"&gt;&gt;,&lt;&lt;\\"Product\\"&gt;&gt;},...]},...]},...]}},...]}]","type":"exit","stack":"[{riak\\_kv\\_w\\_reduce,'-js\\_runner/1-fun-0-',3,[{file,\\"src/riak\\_kv\\_w\\_reduce.erl\\"},{line,283}]},{riak\\_kv\\_w\\_reduce,reduce,3,[{file,\\"src/riak\\_kv\\_w\\_reduce.erl\\"},{line,206}]},{riak\\_kv\\_w\\_reduce,maybe\\_reduce,2,[{file,\\"src/riak\\_kv\\_w\\_reduce.erl\\"},{line,157}]},{riak\\_pipe\\_vnode\\_worker,process\\_input,3,[{file,\\"src/riak\\_pipe\\_vnode\\_worker.erl\\"},{line,444}]},{riak\\_pipe\\_vnode\\_worker,wait\\_for\\_input,2,[{file,\\"src/riak\\_pipe\\_vnode\\_worker.erl\\"},{line,376}]},{gen\\_fsm,handle\\_msg,7,[{file,\\"gen\\_fsm.erl\\"},{line,494}]},{proc\\_lib,...}]"}
&gt; &gt;
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

