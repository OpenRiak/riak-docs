---
title: "issue on riak bulk loading---taking huge time"
description: ""
project: community
lastmod: 2012-05-10T02:55:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07415"
author_name: "Sangeetha.PattabiRaman2"
project_section: "mailinglistitem"
sent_date: 2012-05-10T02:55:16-07:00
---


Dear team,

FYI:we have a 4 quad core intel processor on each server on 2 node cluster with 
more than 1 TB of storage
I Ihave constructed the 2 node physical machine riak cluster with n\\_val 2 and 
my app.config ,vm.args are attached for your reference..

Please tell me where the bulk inserted data onto riak db gets stored on Local 
file system...its taking huge time to load small size itself...how to tune it 
to perform to large scale since we deal wit hbigdata of in few hungred 
GB's?????????????????

Cmd used:time ./load\\_data1m Customercalls1m.csv

./load\\_data100m CustomerCalls100m(got this error so changed default config of 
app.config...from 8 MB to 3072 MB
escript: exception error: no match of right hand side value {error,enoent}


size

Load time

No of mappersonapp.config

Js-max-vm-mem on app.config

Js-thread-stack

100k(10,lakhrows)-5 MB

20m39.625 seconds

48

3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)

3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)

1millionrows---54 MB

198m42.375seconds

48

3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)

3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)

.


./load\\_data script used:

#!/usr/local/bin/escript
main([Filename]) -&gt;
 {ok, Data} = file:read\\_file(Filename),
 Lines = tl(re:split(Data, "\\r?\\n", [{return, binary},trim])),
 lists:foreach(fun(L) -&gt; LS = re:split(L, ","), format\\_and\\_insert(LS) end, 
Lines).

format\\_and\\_insert(Line) -&gt;
 JSON = 
io\\_lib:format("{\\"id\\":\\"~s\\",\\"phonenumber\\":~s,\\"callednumber\\":~s,\\"starttime\\":~s,\\"endtime\\":~s,\\"status\\":~s}",
 Line),
 Command = io\\_lib:format("curl -X PUT 
http://10.232.5.169:8098/riak/CustomerCalls100k/~s -d '~s' -H 'content-type: 
application/json'", [hd(Line),JSON]),
 io:format("Inserting: ~s~n", [hd(Line)]),
 os:cmd(Command).



Thanks in advance!!!!!!!!!!waiting fr the reply...plz anyone help..struck u 
pwit hbulk loading.....and make me clear how riak splits the data and gets 
loaded on cluster
Thanks & regards
sangeetha


This e-mail and any files transmitted with it are for the sole use of the 
intended recipient(s) and may contain confidential and privileged information. 
If you are not the intended recipient(s), please reply to the sender and 
destroy all copies of the original message. Any unauthorized review, use, 
disclosure, dissemination, forwarding, printing or copying of this email, 
and/or any action taken in reliance on the contents of this e-mail is strictly 
prohibited and may be unlawful.
%% -\\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\\*-
%% ex: ts=4 sw=4 et
[
 %% Riak Core config
 {riak\\_core, [
 %% Default location of ringstate
 {ring\\_state\\_dir, "/var/lib/riak/ring"},

 %% http is a list of IP addresses and TCP ports that the Riak
 %% HTTP interface will bind.
 {http, [ {"10.232.5.169", 8098 } ]},

 %% https is a list of IP addresses and TCP ports that the Riak
 %% HTTPS interface will bind.
 %{https, [{ "10.232.15.169", 8098 }]},

 %% Default cert and key locations for https can be overridden
 %% with the ssl config variable, for example:
 %{ssl, [
 % {certfile, "/etc/riak/cert.pem"},
 % {keyfile, "/etc/riak/key.pem"}
 % ]},
 
 %% riak\\_handoff\\_port is the TCP port that Riak uses for
 %% intra-cluster data handoff.
 {handoff\\_port, 8099 },

 %% To encrypt riak\\_core intra-cluster data handoff traffic,
 %% uncomment the following line and edit its path to an
 %% appropriate certfile and keyfile. (This example uses a
 %% single file with both items concatenated together.)
 %{handoff\\_ssl\\_options, [{certfile, "/tmp/erlserver.pem"}]},

 %% Platform-specific installation paths (substituted by rebar)
 {platform\\_bin\\_dir, "/usr/sbin"},
 {platform\\_data\\_dir, "/var/lib/riak"},
 {platform\\_etc\\_dir, "/etc/riak"},
 {platform\\_lib\\_dir, "/usr/lib64/riak"},
 {platform\\_log\\_dir, "/var/log/riak"},
 {target\\_n\\_val, 2}
 ]},

 %% Riak KV config
 {riak\\_kv, [
 %% Storage\\_backend specifies the Erlang module defining the storage
 %% mechanism that will be used on this node.
 {storage\\_backend, riak\\_kv\\_bitcask\\_backend},

 %% pb\\_ip is the IP address that the Riak Protocol Buffers interface
 %% will bind to. If this is undefined, the interface will not run.
 {pb\\_ip, "127.0.0.1" },

 %% pb\\_port is the TCP port that the Riak Protocol Buffers interface
 %% will bind to
 {pb\\_port, 8087 },

 %% pb\\_backlog is the maximum length to which the queue of pending
 %% connections may grow. If set, it must be an integer &gt;= 0.
 %% By default the value is 5. If you anticipate a huge number of
 %% connections being initialised \\*simultaneously\\*, set this number
 %% higher.
 %% {pb\\_backlog, 64},

 %% raw\\_name is the first part of all URLS used by the Riak raw HTTP
 %% interface. See riak\\_web.erl and raw\\_http\\_resource.erl for
 %% details.
 %{raw\\_name, "riak"},

 %% mapred\\_name is URL used to submit map/reduce requests to Riak.
 {mapred\\_name, "mapred"},

 %% mapred\\_system indicates which version of the MapReduce
 %% system should be used: 'pipe' means riak\\_pipe will
 %% power MapReduce queries, while 'legacy' means that luke
 %% will be used
 {mapred\\_system, pipe},

 %% directory used to store a transient queue for pending
 %% map tasks
 %% Only valid when mapred\\_system == legacy
 %% {mapred\\_queue\\_dir, "/var/lib/riak/mr\\_queue" },

 %% Each of the following entries control how many Javascript
 %% virtual machines are available for executing map, reduce,
 %% pre- and post-commit hook functionnaged chan map8red6 to 24,18.
 {map\\_js\\_vm\\_count, 48},
 {reduce\\_js\\_vm\\_count, 18 },
 {hook\\_js\\_vm\\_count, 2 },

 %% Number of items the mapper will fetch in one request.
 %% Larger values can impact read/write performance for
 %% non-MapReduce requests.
 %% Only valid when mapred\\_system == legacy
 %% {mapper\\_batch\\_size, 5},

 %% js\\_max\\_vm\\_mem is the maximum amount of memory, in megabytes,
 %% allocated to the Javascript VMs. If unset, the default is
 %% 8MB.
 {js\\_max\\_vm\\_mem, 3072},

 %% js\\_thread\\_stack is the maximum amount of thread stack, in 
megabyes,
 %% allocate to the Javascript VMs. If unset, the default is 16MB.
 %% NOTE: This is not the same as the C thread stack.
 {js\\_thread\\_stack, 3072},

 %% Number of objects held in the MapReduce cache. These will be
 %% ejected when the cache runs out of room or the bucket/key
 %% pair for that entry changes
 %% Only valid when mapred\\_system == legacy
 %% {map\\_cache\\_size, 10000},

 %% js\\_source\\_dir should point to a directory containing Javascript
 %% source files which will be loaded by Riak when it initializes
 %% Javascript VMs.
 %{js\\_source\\_dir, "/tmp/js\\_source"},

 %% http\\_url\\_encoding determines how Riak treats URL encoded
 %% buckets, keys, and links over the REST API. When set to 'on'
 %% Riak always decodes encoded values sent as URLs and Headers.
 %% Otherwise, Riak defaults to compatibility mode where links
 %% are decoded, but buckets and keys are not. The compatibility
 %% mode will be removed in a future release.
 {http\\_url\\_encoding, on},

 %% riak\\_stat enables the use of the "riak-admin status" command to
 %% retrieve information the Riak node for performance and debugging 
needs
 {riak\\_kv\\_stat, true},
 {legacy\\_stats, false},

 %% Switch to vnode-based vclocks rather than client ids. This
 %% significantly reduces the number of vclock entries.
 %% Only set true if \\*all\\* nodes in the cluster are upgraded to 1.0
 {vnode\\_vclocks, true},

 %% This option enables compatability of bucket and key listing
 %% with 0.14 and earlier versions. Once a rolling upgrade to
 %% a version &gt; 0.14 is completed for a cluster, this should be
 %% set to false for improved performance for bucket and key
 %% listing operations.
 {legacy\\_keylisting, false}
 ]},

 %% Riak Search Config
 {riak\\_search, [
 %% To enable Search functionality set this 'true'.
 {enabled, true}
 ]},

 %% Merge Index Config
 {merge\\_index, [
 %% The root dir to store search merge\\_index data
 {data\\_root, "/var/lib/riak/merge\\_index"},

 %% The root dir to store secondary index merge\\_index data
 {data\\_root\\_2i, "/var/lib/riak/merge\\_index\\_2i"},

 %% Size, in bytes, of the in-memory buffer. When this
 %% threshold has been reached the data is transformed
 %% into a segment file which resides on disk.
 {buffer\\_rollover\\_size, 1048576},

 %% Overtime the segment files need to be compacted.
 %% This is the maximum number of segments that will be
 %% compacted at once. A lower value will lead to
 %% quicker but more frequent compactions.
 {max\\_compact\\_segments, 20}
 ]},

 %% Bitcask Config
 {bitcask, [
 {data\\_root, "/var/lib/riak/bitcask"}
 ]},

 %% eLevelDB Config
 {eleveldb, [
 {data\\_root, "/var/lib/riak/leveldb"}
 ]},

 %% Luwak Config
 {luwak, [
 {enabled, false}
 ]},

{lager, [
 %% What handlers to install with what arguments
 {handlers, [
 {lager\\_console\\_backend, info},
 {lager\\_file\\_backend, [
 {"/var/log/riak/error.log", error},
 {"/var/log/riak/console.log", info}
 ]}
 ]},
 %% Whether to write a crash log, and where.
 %% Commented/omitted/undefined means no crash logger.
 {crash\\_log, "/var/log/riak/crash.log"},
 %% Maximum size in bytes of events in the crash log.
 %% Default is 64kb.
 {crash\\_log\\_size, 65536},
 %% Whether to redirect error\\_logger messages into lager - defaults 
to true
 {error\\_logger\\_redirect, true}
 ]},

 %% riak\\_sysmon config
 {riak\\_sysmon, [
 %% To disable forwarding events of a particular type, use a
 %% limit of 0.
 {process\\_limit, 30},
 {port\\_limit, 30},

 %% Finding reasonable limits for a given workload is a matter
 %% of experimentation.
 {gc\\_ms\\_limit, 50},
 {heap\\_word\\_limit, 10485760}
 ]},

 %% SASL config
 {sasl, [
 {sasl\\_error\\_logger, false}
 ]}
].
## Name of the riak node
-name riak@10.232.5.169

## Cookie for distributed erlang. All nodes in the same cluster
## should use the same cookie or they will not be able to communicate.
-setcookie riak

## Heartbeat management; auto-restarts VM if it dies or becomes unresponsive
## (Disabled by default..use with caution!)
##-heart

## Enable kernel poll and a few async threads
+K true
+A 64

## Treat error\\_logger warnings as warnings
+W w

## Increase number of concurrent ports/sockets
-env ERL\\_MAX\\_PORTS 4096

## Tweak GC to run more often 
-env ERL\\_FULLSWEEP\\_AFTER 0

## Set the location of crash dumps
-env ERL\\_CRASH\\_DUMP /var/log/riak/erl\\_crash.dump

## Begin SSL distribution items, DO NOT DELETE OR EDIT THIS COMMENT

## To enable SSL encryption of the Erlang intra-cluster communication,
## un-comment the three lines below and make certain that the paths
## point to correct PEM data files. See docs TODO for details.

## -proto\\_dist inet\\_ssl
## -ssl\\_dist\\_opt client\\_certfile "/etc/riak/erlclient.pem"
## -ssl\\_dist\\_opt server\\_certfile "/etc/riak/erlserver.pem"

## End SSL distribution items, DO NOT DELETE OR EDIT THIS COMMENT


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

