---
title: "Re: Crashed node has Bitcask merge errors on restart"
description: ""
project: community
lastmod: 2011-08-05T08:00:50-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04240"
mailinglist_parent_id: "msg04239"
author_name: "Jeff Pollard"
project_section: "mailinglistitem"
sent_date: 2011-08-05T08:00:50-07:00
---


Hey David,

Thanks again for all your help, much appreciated. We've since restored from
our backup and the node appears healthy now. I checked the logs and saw
successful bitcask merges and read repairs were happening, so all appears
well.

I also upped the ulimit -n value based on your observation.

On Fri, Aug 5, 2011 at 7:07 AM, David Smith  wrote:

&gt; On Fri, Aug 5, 2011 at 6:49 AM, Jeff Pollard 
&gt; wrote:
&gt; &gt; Update: now the node has crashed, due to the following lines in the
&gt; &gt; sasl-error.log (see below). I've also attached the crash dump to this
&gt; &gt; email.
&gt; &gt; Real quickly though, just to confirm - If we wanted to restore the node
&gt; from
&gt; &gt; a recent backup, the procedure is as simple as:
&gt; &gt;
&gt; &gt; Stop the node.
&gt; &gt; Restore the bitcask and ring directories from a recent backup (~12 hours
&gt; &gt; old) to the node
&gt; &gt; Start the node
&gt; &gt;
&gt; &gt; That correct? Any gotchas or anything else I should know about that
&gt; &gt; process?
&gt;
&gt; You really only need to do the bitcask dirs, not the ring; also make
&gt; sure you move aside the bitcask files created interstitially.
&gt;
&gt; The {error, emfile} problem shows that you're hitting the ulimit -n
&gt; for your process. Make sure your ulimit is set appropriately. It can
&gt; also be helpful to remove any 0-length \\*.bitcask.data files.
&gt;
&gt; D.
&gt;
&gt; --
&gt; Dave Smith
&gt; Director, Engineering
&gt; Basho Technologies, Inc.
&gt; diz...@basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

