---
title: "Re: Reg:Continuous Periodic crashes after long operation"
description: ""
project: community
lastmod: 2017-01-27T05:44:31-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17894"
mailinglist_parent_id: "msg17886"
author_name: "Steven Joseph"
project_section: "mailinglistitem"
sent_date: 2017-01-27T05:44:31-08:00
---


I've had this issue again, this time I checked the output of lsof and it
seems like its the number of established connections are way high, I've
configured my application tasks to exit and cleanup connections
periodicaly. That should solve it.

Thanks guys.

Steven

On Fri, Jan 27, 2017 at 3:07 AM Matthew Von-Maszewski 
wrote:

&gt; FYI: this is the function that is crashing:
&gt;
&gt; get\\_uint32\\_measurement(Request, #internal{os\\_type = {unix, linux}}) -&gt;
&gt; {ok,F} = file:open("/proc/loadavg",[read,raw]), %%
&gt; &lt;--- crash line
&gt; {ok,D} = file:read(F,24),
&gt; ok = file:close(F),
&gt; {ok,[Load1,Load5,Load15,\\_PRun,PTotal],\\_} = io\\_lib:fread("~f ~f ~f
&gt; ~d/~d", D),
&gt; case Request of
&gt; ?avg1 -&gt; sunify(Load1);
&gt; ?avg5 -&gt; sunify(Load5);
&gt; ?avg15 -&gt; sunify(Load15);
&gt; ?ping -&gt; 4711;
&gt; ?nprocs -&gt; PTotal
&gt; end;
&gt;
&gt; Is there something unique about that open?
&gt;
&gt; Matthew
&gt;
&gt; &gt; On Jan 26, 2017, at 10:37 AM, Luke Bakken  wrote:
&gt; &gt;
&gt; &gt; Steven,
&gt; &gt;
&gt; &gt; You may be able to get information via the lsof command as to what
&gt; &gt; process(es) are using many file handles (if that is the cause).
&gt; &gt;
&gt; &gt; I searched for that particular error and found this GH issue:
&gt; &gt; https://github.com/emqtt/emqttd/issues/426
&gt; &gt;
&gt; &gt; Which directed me to this page:
&gt; &gt; https://github.com/emqtt/emqttd/wiki/linux-kernel-tuning
&gt; &gt;
&gt; &gt; Basho also has a set of recommended tuning parameters:
&gt; &gt; http://docs.basho.com/riak/kv/2.2.0/using/performance/
&gt; &gt;
&gt; &gt; Do you have other error entries in any of Riak's logs at around the
&gt; &gt; same time as these messages? Particularly crash.log.
&gt; &gt;
&gt; &gt; --
&gt; &gt; Luke Bakken
&gt; &gt; Engineer
&gt; &gt; lbak...@basho.com
&gt; &gt;
&gt; &gt; On Thu, Jan 26, 2017 at 4:42 AM, Steven Joseph 
&gt; wrote:
&gt; &gt;&gt; Hi Shaun,
&gt; &gt;&gt;
&gt; &gt;&gt; I have already set this to a very high value
&gt; &gt;&gt;
&gt; &gt;&gt; (r...@hawk1.streethawk.com)1&gt; os:cmd("ulimit -n").
&gt; &gt;&gt; "20000500\\n"
&gt; &gt;&gt; (r...@hawk1.streethawk.com)2&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; So the issue is not that the limit is low, but maybe a resource leak ?
&gt; As I
&gt; &gt;&gt; mentioned our application processes continuously run queries on the
&gt; cluster.
&gt; &gt;&gt;
&gt; &gt;&gt; Kind Regards
&gt; &gt;&gt;
&gt; &gt;&gt; Steven
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

