---
title: "MapReduce query returns case_clause badmatch?"
description: ""
project: community
lastmod: 2011-07-15T11:07:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04017"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-07-15T11:07:16-07:00
---


When running several maps and one reduce against a bucket, I'm getting an
error, info is below.
Any idea what I'm doing wrong?

Data submitted (printed as php-style array):
array
 (
 'inputs' =&gt; 'Course'
 'query' =&gt; array
 (
 '0' =&gt; array
 (
 'map' =&gt; array
 (
 'keep' =&gt; false
 'language' =&gt; 'javascript'
 'arg' =&gt; null
 'source' =&gt; 'function(v){return [v];}'
 )
 )
 '1' =&gt; array
 (
 'map' =&gt; array
 (
 'keep' =&gt; false
 'language' =&gt; 'javascript'
 'arg' =&gt; null
 'source' =&gt; '
 function(value){
 if(!value.not\\_found) {
 var object = Riak.mapValuesJson(value)[0];
 var val = object[\\"idNumber\\"].toLowerCase();
 if((val.match(/lbst/))) {
 return [value];
 }
 }
 return [];
 }
 '
 )
 )
 '2' =&gt; array
 (
 'map' =&gt; array
 (
 'keep' =&gt; false
 'language' =&gt; 'javascript'
 'arg' =&gt; null
 'source' =&gt; 'function(){return [1]}'
 )
 )
 '3' =&gt; array
 (
 'reduce' =&gt; array
 (
 'keep' =&gt; true
 'language' =&gt; 'javascript'
 'arg' =&gt; null
 'name' =&gt; 'Riak.reduceSum'
 )
 )
 )
 )


And here is the [start of] the response I get, below.
What's interesting is, I also get back the results of my query (or at least,
the contents of the bucket...).

 array
 (
 'headers' =&gt; array
 (
 'http\\_code' =&gt; 500
 'server' =&gt;
'MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)'
 'date' =&gt; 'Fri, 15 Jul 2011 18:02:25 GMT'
 'content-type' =&gt; 'text/html'
 'content-length' =&gt; '2453'
 )
 'body' =&gt;
'500 Internal Server
ErrorInternal Server Error
=====================

The server
encountered an error while processing this request:  

```
{error,
    {error,
        {case_clause,
            {{badmatch,
                 {struct,
                     [{&lt;&lt;\\"bucket\\"&gt;&gt;,&lt;&lt;\\"Course\\"&gt;&gt;},
                      {&lt;&lt;\\"key\\"&gt;&gt;,
.....
*



Jonathan Langevin
Systems Administrator
Loom Inc.
Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
www.loomlearning.com - Skype: intel352
*
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com


```
