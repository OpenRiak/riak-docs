---
title: "Re: Object not found after successful PUT on S3 API"
description: ""
project: community
lastmod: 2017-03-08T11:40:22-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18077"
mailinglist_parent_id: "msg18066"
author_name: "Daniel Miller"
project_section: "mailinglistitem"
sent_date: 2017-03-08T11:40:22-08:00
---


Thanks for taking the time to look into this Luke. I should have asked more
questions when I setup the configuration for leveldb backend since there is
no clear documentation for how configure CS with leveldb only.

In your current configuration, you are not using the expected prefix for
&gt; the block data. My guess is that on very rare occasions your data happens
&gt; to overwrite the manifest for a file. You may also have corrupted files at
&gt; this point without noticing it at all.
&gt;

&gt; \\*IMPORTANT:\\* you can't switch from your current configuration to this new
&gt; one without re-saving all of your data.
&gt;

Do you have a recommendation to get my data to a new state? Like will it
work if I create new nodes and replace each existing node with a new node
configured correctly? Or do I need a more involved migration process?


On Tue, Mar 7, 2017 at 3:58 PM, Luke Bakken  wrote:

&gt; Hi Daniel,
&gt;
&gt; Thanks for providing all of that information.
&gt;
&gt; You are missing important configuration for riak\\_kv that can only be
&gt; provided in an /etc/riak/advanced.config file. Please see the following
&gt; document, especially the section to which I link here:
&gt;
&gt; http://docs.basho.com/riak/cs/2.1.1/cookbooks/configuration/
&gt; riak-for-cs/#setting-up-the-proper-riak-backend
&gt;
&gt; [
&gt; {riak\\_kv, [
&gt; \\*% NOTE: double-check this path for your environment:\\*
&gt; {add\\_paths, ["/usr/lib/riak-cs/lib/riak\\_cs-2.1.1/ebin"]},
&gt; {storage\\_backend, riak\\_cs\\_kv\\_multi\\_backend},
&gt; {multi\\_backend\\_prefix\\_list, [{&lt;&lt;"0b:"&gt;&gt;, be\\_blocks}]},
&gt; {multi\\_backend\\_default, be\\_default},
&gt; {multi\\_backend, [
&gt; {be\\_default, riak\\_kv\\_eleveldb\\_backend, [
&gt; {data\\_root, "/opt/data/ecryptfs/riak"}
&gt; ]},
&gt; {be\\_blocks, riak\\_kv\\_eleveldb\\_backend, [
&gt; {data\\_root, "/opt/data/ecryptfs/riak\\_blocks"}
&gt; ]}
&gt; ]}
&gt; ]}
&gt; ].
&gt;
&gt; Your configuration will look like the above. The contents of this file are
&gt; merged with the contents of /etc/riak/riak.conf to produce the
&gt; configuration that Riak uses.
&gt;
&gt; Notice that I chose riak\\_kv\\_eleveldb\\_backend twice because of the
&gt; discussion you had previously about RAM usage and bitcask (
&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.
&gt; com/2016-November/018801.html)
&gt;
&gt; In your current configuration, you are not using the expected prefix for
&gt; the block data. My guess is that on very rare occasions your data happens
&gt; to overwrite the manifest for a file. You may also have corrupted files at
&gt; this point without noticing it at all.
&gt;
&gt; \\*IMPORTANT:\\* you can't switch from your current configuration to this new
&gt; one without re-saving all of your data.
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt; On Tue, Mar 7, 2017 at 6:47 AM, Daniel Miller  wrote:
&gt;
&gt;&gt; Responses inline.
&gt;&gt;
&gt;&gt; On Mon, Mar 6, 2017 at 3:04 PM, Luke Bakken  wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Daniel,
&gt;&gt;&gt;
&gt;&gt;&gt; Two questions:
&gt;&gt;&gt;
&gt;&gt;&gt; \\* Do you happen to have an /etc/riak/app.config file present?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; No.
&gt;&gt;
&gt;&gt; Not sure if relevant, but I did notice that /etc/riak-cs/advanced.config
&gt;&gt; does exist, which contradicts with what I said earlier. This is surprising
&gt;&gt; to me because I did not create this file. Maybe it was created by the riak
&gt;&gt; installer? Anyway, the content is:
&gt;&gt;
&gt;&gt; $ cat /etc/riak-cs/advanced.config
&gt;&gt; [
&gt;&gt; {riak\\_cs,
&gt;&gt; [
&gt;&gt; ]}
&gt;&gt; ].
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\* On one of your Riak nodes, could you please execute the following
&gt;&gt;&gt; commands:
&gt;&gt;&gt;
&gt;&gt;&gt; riak attach
&gt;&gt;&gt; rp(application:get\\_all\\_env(riak\\_kv)).
&gt;&gt;&gt;
&gt;&gt;&gt; Copy the output of the previous command and attach as a separate file
&gt;&gt;&gt; to your response. Please note that the period is significant. Use
&gt;&gt;&gt; CTRL-C CTRL-C to exit the "riak attach" session.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; Attached.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

