---
title: "Re: CRDT-map usage in erlang mapreduce via HTTP"
description: ""
project: community
lastmod: 2015-01-06T03:19:15-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15443"
mailinglist_parent_id: "msg15439"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2015-01-06T03:19:15-08:00
---


Hi Cezary,
The keys in a map are pairs, {FieldName, FieldType}, and when map reducing they 
haven’t been through the API layer to make the module names friendly, so rather 
than {my\\_name, set} you have {may\\_name, riak\\_dt\\_orswot}.

For example

 M = riak\\_kv\\_crdt:map\\_value(V).

 [{{&lt;&lt;"m1"&gt;&gt;,riak\\_dt\\_map},
 [{{x,riak\\_dt\\_orswot},[x]},
 {{y,riak\\_dt\\_orswot},[y]}]},
 {{&lt;&lt;"s1"&gt;&gt;,riak\\_dt\\_orswot},[s]}].

is a map with two fields, a map and a set. The map field is called {&lt;&lt;“m1”&gt;&gt;, 
riak\\_dt\\_map}. So to access it:

 prop lists:get\\_value({&lt;&lt;“m1”&gt;&gt;, riak\\_dt\\_orswot}, M).
 [{{x,riak\\_dt\\_orswot},[x]},
 {{y,riak\\_dt\\_orswot},[y]}]

And likewise to access the set values.

It would be helpful, I agree, if we added something like Bob Ippolito’s KVC[1] 
for Map reduce access to Map values. Please raise an issue against riak[2] as a 
feature request if you would like this for a future version.


riak\\_dt[3] (the library whose data types riak uses) is a purely functional 
library with no dependencies, so it is easy to play around on the console to 
help you write your map reduce functions before deploying them.

Hope that helps

Russell

[1] KVC - https://github.com/etrepum/kvc
[2] Riak - https://github.com/basho/riak/issues
[3] riak dt - https://github.com/basho/riak\\_kv/tree/2.0

On 4 Jan 2015, at 21:12, Cezary Kosko  wrote:

&gt; Hi,
&gt; I wanted to ask how you use a map data type in mapreduce. Calling 
&gt; riak\\_kv\\_crdt:map\\_value/1 seems to be but the start, I can't seem to be able 
&gt; to extract particular values - proplists:get\\_value/2 returns undefined for 
&gt; virtually every possible input, so right now I've localized the keys' index 
&gt; in proplists:get\\_keys/1's output and am calling 
&gt; proplists:get\\_value(lists:nth(\\_whatever\\_index\\_, 
&gt; proplists:get\\_keys(MapValue)), MapValue), but that's as bad as it gets.
&gt; 
&gt; Kind regards,
&gt; Cezary
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

