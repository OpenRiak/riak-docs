---
title: "Re: Riak on SAN"
description: ""
project: community
lastmod: 2013-10-03T07:21:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12490"
mailinglist_parent_id: "msg12485"
author_name: "Heinz Nikolaus Gies"
project_section: "mailinglistitem"
sent_date: 2013-10-03T07:21:06-07:00
---


Hi Guido,
I don’t see how snappy compression renders ZFS useless, you might do some 
things twice like crcing but it also protects on different layers. While the 
ZFS crc protects data on the disks the in app crc could protect the data ‘all’ 
the way up, compression wise you might not even turn on ZFS compression and 
even if you do, you could still get a higher ratio given that ZFS will use 
compression over the entire volume not ‘just’ the data in the DB.

That said there is a lot more to ZFS then compression and CRC ;) like 
snapshots, cloning, ARC ^^


On 03 Oct 2013, at 9:56, Guido Medina  wrote:

&gt; If using LevelDB backend, LevelDB has a nice compression (snappy), including 
&gt; CRC checks and all sort of data corruption checks, I have read on this mail 
&gt; list people that has required to disable snappy compression because it 
&gt; renders ZFS useless (not much to compress after that)
&gt; 
&gt; Hence, it is kind of related to using ZFS or not, if you go for ZFS whatever 
&gt; variant you will have to support two sub-systems, if you let LevelDB snappy 
&gt; compression on, you won't have to worry about it.
&gt; 
&gt; As for backup, Basho provides a sort of cluster-to-cluster replication tool, 
&gt; we built our own in Java, making backups per storage on every node won't make 
&gt; much sense due to CAP/distributed nature, replicating the keys to another 
&gt; cluster is what will make sense.
&gt; 
&gt; Hope that helps and is understandable,
&gt; 
&gt; Guido.
&gt; 
&gt; On 03/10/13 13:54, Pedram Nimreezi wrote:
&gt;&gt; Not sure what ZFS has to do with snappy compression, as it's a file system 
&gt;&gt; not a compression algorithm.. 
&gt;&gt; feature wise, ZFS is quite possibly the most enterprise file system around, 
&gt;&gt; including advanced data corruption prevention and remote backing up.. 
&gt;&gt; 
&gt;&gt; This would be a viable option in BSD/Solaris environments, at least for 
&gt;&gt; making snapshots.
&gt;&gt; Might make a nice write up for the Basho blog..
&gt;&gt; 
&gt;&gt; Backups for riak I think require a bit more consideration then file system 
&gt;&gt; snapshot send, 
&gt;&gt; and should include provisions for transferring data to smaller/larger 
&gt;&gt; clusters, transfer 
&gt;&gt; ring ownerships properly, etc. 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Thu, Oct 3, 2013 at 7:15 AM, Guido Medina  
&gt;&gt; wrote:
&gt;&gt; And for ZFS? I wouldn't recommend it, after Riak 1.4 snappy LevelDB 
&gt;&gt; compression does a nice job, why take the risk of yet another not so 
&gt;&gt; enterprise ready compression algorithms.
&gt;&gt; 
&gt;&gt; I could be wrong though,
&gt;&gt; 
&gt;&gt; Guido.
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On 03/10/13 12:11, Guido Medina wrote:
&gt;&gt;&gt; I have heard some SAN's horrors stories too, Riak nodes are so cheap that I 
&gt;&gt;&gt; don't see the point in even having any mirror on the node, here my points:
&gt;&gt;&gt; Erlang interprocess communication brings some network usage, why yet 
&gt;&gt;&gt; another network usage on replicating the data? If the whole idea of Riak is 
&gt;&gt;&gt; have your data replicated in different nodes.
&gt;&gt;&gt; If a node goes down or die for whatever reason, bring up another node and 
&gt;&gt;&gt; rebuild it.
&gt;&gt;&gt; If you want to really replicate your cluster Riak offers the enterprise 
&gt;&gt;&gt; replication which I'm quite sure will be less expensive than a SAN and will 
&gt;&gt;&gt; warranty to have your cluster ready to go somewhere else as a backup.
&gt;&gt;&gt; I would even go further, SSDs are so cheap and Riak nodes are so cheap now 
&gt;&gt;&gt; adays that I would even build a cluster using RAID 0 or RAID 5 SSDs (yes, 
&gt;&gt;&gt; no mirror with RAID 1, if too afraid, RAID 5), that will have a great 
&gt;&gt;&gt; impact on performance. Again, if something goes wrong with 1 node, refer to 
&gt;&gt;&gt; point 2.
&gt;&gt;&gt; SANs and all those "legacy" backup and replication IMHO are meant for other 
&gt;&gt;&gt; products, like an Oracle money eater DB server.
&gt;&gt;&gt; HTH,
&gt;&gt;&gt; Guido.
&gt;&gt;&gt; 
&gt;&gt;&gt; On 03/10/13 12:00, Brian Akins wrote:
&gt;&gt;&gt;&gt; So, call me naive, but couldn't ZFS be used as Heinze suggested?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I have some SAN horror stories - both operationally and from an economic 
&gt;&gt;&gt;&gt; perspective.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; /\\* Sincerely
&gt;&gt; -------------------------------------------------------------- 
&gt;&gt; Pedram Nimreezi - Chief Technology Officer \\*/
&gt;&gt; 
&gt;&gt; // The hardest part of design … is keeping features out. - Donald Norman
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

