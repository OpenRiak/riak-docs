---
title: "Re: Problem with deleting keys"
description: ""
project: community
lastmod: 2011-06-15T16:17:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03703"
mailinglist_parent_id: "msg03702"
author_name: "Greg Nelson"
project_section: "mailinglistitem"
sent_date: 2011-06-15T16:17:18-07:00
---


I was seeing some similar behavior recently on a local devrel cluster. With a 
node down, introducing DELETEs into the mix seemed to cause a fair bit of 
wonkiness. Especially with allow\\_mult=true.

I can consistently do something along these lines to reproduce at least one of 
the problems I was seeing:

curl -X PUT -H "Content-Type: text/plain" -d "bar" 
http://localhost:8091/riak/test/foo
curl http://localhost:8091/riak/test/foo # &lt;-- OK
curl -X DELETE http://localhost:8091/riak/test/foo
curl http://localhost:8091/riak/test/foo # &lt;-- OK (not found)
curl -X PUT -H "Content-Type: text/plain" -d "baz" 
http://localhost:8091/riak/test/foo
curl http://localhost:8091/riak/test/foo # &lt;-- siblings ("bar" and "baz")

I'm pretty sure this is related to bugs 260 
(https://issues.basho.com/show\\_bug.cgi?id=260) and 555 
(https://issues.basho.com/show\\_bug.cgi?id=555), but those suggest "rapid fire" 
PUTs and DELETEs being the cause, whereas I can insert pauses of any amount of 
time (minutes, hours) in my script above and see same behavior -- as long as at 
least one node is down.

What you're describing David \\*could\\* very well be a different issue, in which 
case apologies for the distraction!

-Greg

On Wednesday, June 15, 2011 at 3:55 PM, David Mitchell wrote:

&gt; Erlang: R13B04
&gt; Riak: 0.14.2
&gt; 
&gt; I have a three node cluster, and while one node was down, I deleted every key 
&gt; in a certain bucket. Then, I started the node that was down, and it joined 
&gt; the cluster.
&gt; 
&gt; Now, when do a listing on these keys in this bucket, and I get the entire 
&gt; list. I can also get the values of the bucket. However, when I try to 
&gt; delete the keys, the keys are not deleted.
&gt; 
&gt; Can anyone help me get the nodes back in a consistent state? I have tried 
&gt; restarting the nodes.
&gt; 
&gt; David
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

