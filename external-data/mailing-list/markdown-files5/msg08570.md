---
title: "Re: {error,insufficient_vnodes_available}"
description: ""
project: community
lastmod: 2012-09-17T07:50:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08570"
mailinglist_parent_id: "msg08569"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2012-09-17T07:50:14-07:00
---



On Sep 17, 2012, at 10:34 AM, Kresten Krab Thorup  wrote:

&gt; As I understand Paul's situation, the 3 nodes are up and running again. 
&gt; Should that not be enough to avoid the "insufficient vnodes" error?

Ah, yes. I've misunderstood. Serves me right for responding before I've had my 
morning coffee :)
I'm not immediately sure what could cause this (other than those 2 nodes not 
being available
\\_at the time of the request\\_).

Paul, can you verify that you're getting this same error from each node? Do all 
three
nodes return the same information for 'ring\\_status'?

Reid


&gt; 
&gt; After a node down, I can see that it should matters better by running "riak 
&gt; repair" of the involved partitions, but 2i should be able to run again when 
&gt; sufficient nodes comes back on line?
&gt; 
&gt; Kresten
&gt; 
&gt; On Sep 17, 2012, at 4:20 PM, Reid Draper 
&gt; &gt; wrote:
&gt; 
&gt; Paul,
&gt; 
&gt; It looks like you're running a 3-node cluster. If two of the nodes fail, 
&gt; you'll likely
&gt; not be able to run `coverage` queries like 2i and list-keys. If you need to 
&gt; be able
&gt; to sustain losing 2 nodes and still successfully run 2i, I'd suggest running 
&gt; at least
&gt; a 5 node cluster.
&gt; 
&gt; Reid
&gt; 
&gt; 
&gt; On Sep 17, 2012, at 6:07 AM, Paul Scheltema 
&gt; &gt; wrote:
&gt; 
&gt; recently 2 of the vm's running riak crashed. (probably not due to riak)
&gt; When i now run "curl $riak/buckets/$2/keys?keys=true" i get the following 
&gt; error message:
&gt; 
&gt; 500 Internal Server ErrorInternal 
&gt; Server Error
========================

The server encountered an error while processing this 
&gt; request:  

```
{error,{error,{badmatch,{error,insufficient_vnodes_available}},
&gt;              [{riak_kv_wm_keylist,produce_bucket_body,2},
&gt;               {webmachine_resource,resource_call,3},
&gt;               {webmachine_resource,do,3},
&gt;               {webmachine_decision_core,resource_call,1},
&gt;               {webmachine_decision_core,decision,1},
&gt;               {webmachine_decision_core,handle_request,2},
&gt;               {webmachine_mochiweb,loop,1},
&gt;               
&gt; {mochiweb_http,parse_headers,5}]}}
```


---

mochiweb+webmachine 
&gt; web server


&gt; 
&gt; == ring\\_status
&gt; root@03:/usr/local/riak/bin# ./riak-admin ring\\_status
&gt; ================================== Claimant 
&gt; ===================================
&gt; Claimant: 'riak@192.168.122.112'
&gt; Status: up
&gt; Ring Ready: true
&gt; 
&gt; ============================== Ownership Handoff 
&gt; ==============================
&gt; No pending changes.
&gt; 
&gt; ============================== Unreachable Nodes 
&gt; ==============================
&gt; All nodes are up and reachable
&gt; 
&gt; == ring ready
&gt; root@03:/usr/local/riak/bin# ./riak-admin ringready
&gt; TRUE All nodes agree on the ring 
&gt; ['riak@192.168.122.111',
&gt; 
&gt; 'riak@192.168.122.112',
&gt; 
&gt; 'riak@192.168.122.113']
&gt; 
&gt; == member status
&gt; root@03:/usr/local/riak/bin# ./riak-admin member\\_status
&gt; ================================= Membership 
&gt; ==================================
&gt; Status Ring Pending Node
&gt; -------------------------------------------------------------------------------
&gt; valid 34.4% -- 
&gt; 'riak@192.168.122.111'
&gt; valid 32.8% -- 
&gt; 'riak@192.168.122.112'
&gt; valid 32.8% -- 
&gt; 'riak@192.168.122.113'
&gt; -------------------------------------------------------------------------------
&gt; Valid:3 / Leaving:0 / Exiting:0 / Joining:0 / Down:0
&gt; 
&gt; == ulimit:
&gt; root@03:/usr/local/riak/etc# ulimit -a
&gt; core file size (blocks, -c) 0
&gt; data seg size (kbytes, -d) unlimited
&gt; scheduling priority (-e) 0
&gt; file size (blocks, -f) unlimited
&gt; pending signals (-i) 15584
&gt; max locked memory (kbytes, -l) 64
&gt; max memory size (kbytes, -m) unlimited
&gt; open files (-n) 1024
&gt; pipe size (512 bytes, -p) 8
&gt; POSIX message queues (bytes, -q) 819200
&gt; real-time priority (-r) 0
&gt; stack size (kbytes, -s) 8192
&gt; cpu time (seconds, -t) unlimited
&gt; max user processes (-u) 15584
&gt; virtual memory (kbytes, -v) unlimited
&gt; file locks (-x) unlimited
&gt; 
&gt; 
&gt; 
&gt; --
&gt; groeten
&gt; /paul
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; Mobile: + 45 2343 4626 | Skype: krestenkrabthorup | Twitter: @drkrab
&gt; Trifork A/S | Margrethepladsen 4 | DK- 8000 Aarhus C | Phone : +45 8732 
&gt; 8787 | www.trifork.com
&gt; 
&gt; 
&gt; 
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

