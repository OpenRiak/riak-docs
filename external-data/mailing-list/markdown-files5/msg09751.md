---
title: "Re: Riak and host names"
description: ""
project: community
lastmod: 2013-01-07T15:03:11-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09751"
mailinglist_parent_id: "msg09749"
author_name: "Charlie Voiselle"
project_section: "mailinglistitem"
sent_date: 2013-01-07T15:03:11-08:00
---


Matt:

You would need to use (or implement your own) DNS service that you could 
programmatically access--Route 53 has an API that you could use to create DNS 
entries that point to the internal addresses of your nodes. In very carefully 
re-reading the thread Deepak mentions, one problem that will occur is that each 
node needs to be able to resolve the other nodes by name also. The only way 
for this to occur reasonably, would be to register the internal addresses with 
a single point that they share. Some examples of free services that you might 
use for this are DynDns[1], DNSDynamic[2], or DNS-O-Matic[3]. I have also 
seen some projects floating around the web that might enable you to create a 
self-hosted dynamic DNS like opendyn[4] and GnuDIP[5]; however, I have had no 
occasion to use something like this in my own environment. Some additional 
discussion about creating your own Dynamic DNS server is also at 
http://unix.stackexchange.com/questions/29049/how-to-create-a-custom-dynamic-dns-solution

Hope this helps!
Charlie

[1] http://www.dyn.com
[2] http://www.dnsdynamic.org
[3] http://www.dnsomatic.com
[4] http://code.google.com/p/opendyn/
[5] http://gnudip2.sourceforge.net/

On Jan 7, 2013, at 5:00 PM, Matt Black  wrote:

&gt; Thanks for this Charlie.
&gt; 
&gt; I'm running a production Riak cluster on AWS which runs constantly, and I've 
&gt; been wondering how I might be able to easliy stop and start AWS nodes for a 
&gt; testing and benchmarking cluster (to save on cost).
&gt; 
&gt; By using the 'riaknode1.priv' hostname method you describe, would I be able 
&gt; to stop and then restart a whole cluster of nodes at once? (As described by 
&gt; Deepak, AWS assigns new IPs when a VM starts).
&gt; 
&gt; Thanks
&gt; Matt
&gt; 
&gt; 
&gt; On 8 January 2013 01:31, Charlie Voiselle  wrote:
&gt; Deepak:
&gt; 
&gt; When you name a node in app.config with -name it has to have a '.' in it, 
&gt; like r...@hostname.net As you have surmised, you can get around that if you 
&gt; use the -sname argument instead. 
&gt; 
&gt; They have to be done consistently. In your example, had you used the -sname 
&gt; argument, `riak@riaknode1` would work. Making a host entry `riaknode1.priv` 
&gt; that points to the local address would work with the -name argument.
&gt; 
&gt; The inportant thing about -name and -sname is that they can't mix within a 
&gt; cluster.
&gt; 
&gt; Cluster replace is designed to replace a node with a new one and transfer all 
&gt; the partitions. You can cheat and use it to rename a node though. 
&gt; 
&gt; The process to do this would look like the following:
&gt; 
&gt; Stop the node to rename with `riak stop`
&gt; Mark it 'down' from another node in the cluster using `riak-admin down «old 
&gt; nodename».
&gt; Rename the node in vm.args.
&gt; Delete the ring directory.
&gt; Start the node with `riak start`. 
&gt; It will come up as a single instance which you can verify with `riak-admin 
&gt; member-status`.
&gt; Join the node to the cluster with `riak-admin cluster join «cluster nodename» 
&gt; `
&gt; Set it to replace the old instance of itself with `riak-admin cluster replace 
&gt; «old nodename» «new nodename»
&gt; Plan the changes with `riak-admin cluster plan`
&gt; Commit the changes with `riak-admin cluster commit`
&gt; 
&gt; As you can see, this is a very large effort, so best to use hostnames that 
&gt; aren't moving around. Apologies for you getting this twice, Deepak. I failed 
&gt; to reply to the list as well.
&gt; 
&gt; Hope this makes sense...
&gt; Charlie
&gt; 
&gt; On Jan 1, 2013, at 2:43 PM, Deepak Balasubramanyam  
&gt; wrote:
&gt; 
&gt;&gt; I took the AWS EC2 riak image for a spin today. I have a query regarding 
&gt;&gt; riak nodes and how they behave when the machine reboots.
&gt;&gt; 
&gt;&gt; When an EC2 instance reboots, the internal ip / internal DNS / external DNS 
&gt;&gt; change. This renders the app.config and -name argument on vm.args incorrect. 
&gt;&gt; I was exploring solutions to deal with this problem. 
&gt;&gt; 
&gt;&gt; 1. Preventive measures
&gt;&gt; 
&gt;&gt; Someone on this thread dated May 2011 suggested using host file entries that 
&gt;&gt; point to the local internal IP address. That does not seem to work. Riak 
&gt;&gt; fails with the following error when I add a new entry to /etc/hosts and 
&gt;&gt; configure vm.args with -name riak@riaknode1
&gt;&gt; 
&gt;&gt; Hostname riaknode1 is illegal
&gt;&gt; 
&gt;&gt; I confirmed that riaknode1 pings correctly before starting riak. I guess 
&gt;&gt; erlang tries to match the hostname of the system resulting in this failure ? 
&gt;&gt; Can anyone throw some light on this ?
&gt;&gt; 
&gt;&gt; 2. Use -sname
&gt;&gt; 
&gt;&gt; Is starting the erlang VM with the sname flag an option if it will help 
&gt;&gt; prevent the 'illegal hostname' error ? 
&gt;&gt; Disclaimer: My knowledge of erlang is close to zilch, so sorry if that 
&gt;&gt; option sounded like something you could dismiss easily :)
&gt;&gt; 
&gt;&gt; 3. Use cluster replace
&gt;&gt; 
&gt;&gt; a. I understand that the IPs in app.config and vm.args can be replaced with 
&gt;&gt; the correct IP on a restart and using a subsequent 'cluster replace' command 
&gt;&gt; will do. Will executing the 'cluster plan' and 'cluster commit' commands now 
&gt;&gt; produce network chatter ? 
&gt;&gt; 
&gt;&gt; b . What happens if 2 nodes go down and one was joined with the other. They 
&gt;&gt; both have 2 different IP addresses on restart. How will 'cluster replace' 
&gt;&gt; work now ?
&gt;&gt; 
&gt;&gt; Do let me know your thoughts.
&gt;&gt; 
&gt;&gt; Thanks
&gt;&gt; -Deepak
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

