---
title: "Re: Riak CS expiration"
description: ""
project: community
lastmod: 2015-02-08T21:40:29-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15667"
mailinglist_parent_id: "msg15659"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2015-02-08T21:40:29-08:00
---


On 7 February 2015 at 06:21, Kota Uenishi  wrote:
&gt; Bitcask doesn't have such interface like hooking anything. As of
&gt; internal data structure of Riak CS built on top of Riak, bitcask keys
&gt; don't correspond simply to leveldb key. Say, things like this cannot
&gt; happen: "all tombstones of blocks of this object were collected and
&gt; space were reclaimed by merged, so I'm gonna officially hit S3
&gt; interface to delete that object". This is because blocks are
&gt; distributed all across the cluster.
&gt;
&gt; I'd rather recommend to make up a simple cron job that walks over
&gt; objects and see timestamp and hit CS API to delete them when they're
&gt; old, or wait for lifecycle API gets implemented.

Definitely. And it's seriously only a few lines of code -- mine is
implemented like this, in Scala:

 val allFiles = s3.listObjects(sys.env("S3\\_BUCKET"))

 allFiles filter(\\_.getLastModifiedDate.before(expiryDate)) foreach { f =&gt;
 logger.info(s"Expiring file=${f.getKey}")
 s3.deleteObject(bucket, f.getKey)
 }


&gt; On Fri, Feb 6, 2015 at 12:24 AM, Damien Krotkine  wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; As far as I understand, Riak CS uses bitcask for data storage and
&gt;&gt; leveldb for metadata.
&gt;&gt;
&gt;&gt; Trying to implement expiration of data in riak cs, bitcask expiration
&gt;&gt; works fine, but of course metadata are still in the leveldb backend. Is
&gt;&gt; there any way to expire metadata from riak cs automatically ?
&gt;&gt;
&gt;&gt; Ideally, I'd like to be able to install a hook or callback on the
&gt;&gt; bitcask compaction. Is that possible ?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; dams
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; --
&gt; Kota UENISHI / @kuenishi
&gt; Basho Japan KK
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com



-- 
Turning and turning in the widening gyre
The falcon cannot hear the falconer
Things fall apart; the center cannot hold
Mere anarchy is loosed upon the world

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

