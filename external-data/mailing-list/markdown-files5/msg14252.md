---
title: "Re: Loosing data with bucket types,	custom backend and active data entropy"
description: ""
project: community
lastmod: 2014-05-21T04:35:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14252"
mailinglist_parent_id: "msg14251"
author_name: "Oleksiy Krivoshey"
project_section: "mailinglistitem"
sent_date: 2014-05-21T04:35:24-07:00
---


I think I've found that rare case when I don't get deletedvlock before
'put' in my code.

Sorry for bothering everyone :)


On 21 May 2014 14:15, Oleksiy Krivoshey  wrote:

&gt; I think its a different issue and might be my own misunderstanding:
&gt;
&gt; The actual order of operations is (all same key):
&gt;
&gt; 1. write
&gt; 3. read
&gt; 4. delete
&gt; 5. write
&gt; 6. read - failed
&gt;
&gt; So it might be tombstone problem. However I always do 'get' with
&gt; 'deletedvclock: true' before 'put' or 'delete' and provide a vclock.
&gt;
&gt;
&gt; On 21 May 2014 12:10, Oleksiy Krivoshey  wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I have a quite rare problem of lost data in Riak 2.0 beta1. I can hardly
&gt;&gt; replicate it but when it happens it looks like this order of operations:
&gt;&gt;
&gt;&gt; (All operations are using bucket types).
&gt;&gt;
&gt;&gt; 1. write some data (KEY1) - ok
&gt;&gt; 2. read that data (KEY1) - ok
&gt;&gt; 3. message appears in riak console.log:
&gt;&gt; 2014-05-21 08:15:03.328 [info]
&gt;&gt; &lt;0.15793.157&gt;@riak\\_kv\\_exchange\\_fsm:key\\_exchange:256 Repaired 1 keys during
&gt;&gt; active anti-entropy exchange of
&gt;&gt; {1450083655789255239155218544960687058564870569984,3} between {0,'
&gt;&gt; riak@10.0.1.1'} and {1450083655789255239155218544960687058564870569984,'
&gt;&gt; riak@10.0.1.3'}
&gt;&gt; 4. read data (KEY1) - ok
&gt;&gt; 5. write new data (KEY1) - ok
&gt;&gt; 6. read data (KEY1) - no such key
&gt;&gt;
&gt;&gt; All happens within 10-20 seconds.
&gt;&gt;
&gt;&gt; Can someone give any hint on this?
&gt;&gt;
&gt;&gt; Running riak2.0.0\\_beta1 on Ubuntu 14.04
&gt;&gt;
&gt;&gt; Bucket type:
&gt;&gt;
&gt;&gt; {"props":{"backend":"fs\\_chunks","allow\\_mult":"false"}}
&gt;&gt;
&gt;&gt; fs\\_chunks backend:
&gt;&gt;
&gt;&gt; {&lt;&lt;"fs\\_chunks"&gt;&gt;, riak\\_kv\\_bitcask\\_backend, [
&gt;&gt; {data\\_root, "/var/lib/riak/fs\\_chunks"}
&gt;&gt; ]}
&gt;&gt;
&gt;&gt; Thanks!
&gt;&gt;
&gt;&gt; --
&gt;&gt; Oleksiy Krivoshey
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Oleksiy Krivoshey
&gt;



-- 
Oleksiy Krivoshey
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

