---
title: "Re: Riak mapreduce error"
description: ""
project: community
lastmod: 2017-02-09T01:41:53-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17942"
mailinglist_parent_id: "msg17922"
author_name: "raghuveer sj"
project_section: "mailinglistitem"
sent_date: 2017-02-09T01:41:53-08:00
---


Hi Magnus,

Previously i had used developer branch as master build was failing. Now
with the latest changes i see :

10&gt; riakc\\_pb\\_socket:mapred\\_bucket(Riak, &lt;&lt;"training"&gt;&gt;, [{map, {qfun,
ReFun}, Re, true}]).
{error,&lt;&lt;"{\\"phase\\":0,\\"error\\":\\"{badfun,#Fun}\\",\\"input\\":\\"{ok,{r\\_object,&lt;&lt;\\\\\\"
training\\\\\\"&gt;&gt;,&lt;&lt;\\\\\\"bar\\\\\\"&gt;&gt;"...&gt;&gt;}

Please help me out.

Regards,
Raghuveer

On Mon, Feb 6, 2017 at 9:18 PM, Magnus Kessler  wrote:

&gt; On 3 February 2017 at 18:31, raghuveer sj  wrote:
&gt;
&gt;&gt; Hi Team,
&gt;&gt;
&gt;&gt; I am trying to run mapreduce in erlang.
&gt;&gt;
&gt;&gt; curl -XPUT http://localhost:8098/buckets/training/keys/foo -H
&gt;&gt; 'Content-Type: text/plain' -d 'caremad data goes here'
&gt;&gt; curl -XPUT http://localhost:8098/buckets/training/keys/bar -H
&gt;&gt; 'Content-Type: text/plain' -d 'caremad caremad caremad caremad'
&gt;&gt; curl -XPUT http://localhost:8098/buckets/training/keys/baz -H
&gt;&gt; 'Content-Type: text/plain' -d 'nothing to see here'
&gt;&gt; curl -XPUT http://localhost:8098/buckets/training/keys/bam -H
&gt;&gt; 'Content-Type: text/plain' -d 'caremad caremad caremad'
&gt;&gt;
&gt;&gt; \\*Running in erlang shell :\\*
&gt;&gt;
&gt;&gt; ReFun = fun(O, \\_, Re) -&gt; case re:run(riak\\_object:get\\_value(O), Re,
&gt;&gt; [global]) of
&gt;&gt; {match, Matches} -&gt; [{riak\\_object:key(O), length(Matches)}];
&gt;&gt; nomatch -&gt; [{riak\\_object:key(O), 0}]
&gt;&gt; end end.
&gt;&gt;
&gt;&gt; code:which(riakc\\_pb\\_socket).
&gt;&gt; "./ebin/riakc\\_pb\\_socket.beam"
&gt;&gt;
&gt;&gt; {ok, Pid} = riakc\\_pb\\_socket:start\\_link("127.0.0.1", 8087).
&gt;&gt; {ok,&lt;0.36.0&gt;}
&gt;&gt;
&gt;&gt; riakc\\_pb\\_socket:ping(Pid).
&gt;&gt; pong
&gt;&gt;
&gt;&gt; {ok, Re} = re:compile("caremad").
&gt;&gt; {ok,{re\\_pattern,0,0,0,
&gt;&gt; &lt;&lt;69,82,67,80,85,0,0,0,0,0,0,0,81,0,0,0,255,255,255,255,
&gt;&gt; 255,255,...&gt;&gt;}}
&gt;&gt;
&gt;&gt; {ok, Riak} = riakc\\_pb\\_socket:start\\_link("127.0.0.1", 8087).
&gt;&gt; {ok,&lt;0.42.0&gt;}
&gt;&gt;
&gt;&gt; riakc\\_pb\\_socket:mapred\\_bucket(Riak, &lt;&lt;"training"&gt;&gt;, [{map, {qfun,
&gt;&gt; ReFun}, Re, true}]).
&gt;&gt; \\*\\* 1: variable 'ReFun' is unbound\\*
&gt;&gt;
&gt;&gt; Trying to run the famous erlang sample program sample. I am stuck at this
&gt;&gt; error. Kindly help me out.
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; Raghuveer
&gt;&gt;
&gt;&gt;
&gt; Hi Raghuveer,
&gt;
&gt; I have run the steps you provided, and found that they work fine for me.
&gt; Can you let me know which version of Riak you are running this against, and
&gt; which version of Erlang is used on the client side? Has the
&gt; riak-erlang-client been compiled with the same Erlang version?
&gt;
&gt; Kind Regards,
&gt;
&gt; Magnus
&gt;
&gt; --
&gt; Magnus Kessler
&gt; Client Services Engineer
&gt; Basho Technologies Limited
&gt;
&gt; Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

