---
title: "Re: Strong consistent buckets ready after starting a cluster."
description: ""
project: community
lastmod: 2015-02-06T13:24:13-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15662"
mailinglist_parent_id: "msg15661"
author_name: "Zsolt Laky"
project_section: "mailinglistitem"
sent_date: 2015-02-06T13:24:13-08:00
---


Hi Dhillon,

Thanks for the answer. You sched the light.

As I need it only during dev, riak-admin ensemble-status will help I believe.

cheers,
zsolt

&gt; On 06 Feb 2015, at 21:41, Sargun Dhillon  wrote:
&gt; 
&gt; I really don't recommend doing this. Really, the cluster shouldn't be
&gt; changing often enough where the ensemble status is changing all that
&gt; often. You can do this by exploiting internal APIs that are accessible
&gt; over distributed Erlang in riak\\_ensemble. Though, connecting to the
&gt; cluster over distributed Erlang from your client is probably also less
&gt; than recommended because it adds extra complexity, and you're poking
&gt; at internal APIs that aren't meant to be exposed to the client.
&gt; 
&gt; If you want to know for your own sake, you can look at the output from
&gt; 'riak-admin ensemble-status'
&gt; 
&gt; In order to do this programmatically, you'd want to hook into
&gt; riak\\_ensemble\\_manager, and interrogate it for the status of the
&gt; ensembles. I would start by looking at the code in
&gt; riak\\_kv/riak\\_kv\\_ensemble\\_console.erl to go down this route.
&gt; 
&gt;&gt; On Mon, Feb 2, 2015 at 3:35 AM, Zsolt Laky  wrote:
&gt;&gt; Hi All!
&gt;&gt; 
&gt;&gt; I am using a dev cluster with three nodes on a Mac OS. After a boot, I start
&gt;&gt; the nodes and they are ok immediately for the default buckets, but for the
&gt;&gt; strong consistent type it took 10 minutes to get ready and perform as
&gt;&gt; expected.
&gt;&gt; 
&gt;&gt; Here is a small example where a get returns with different values and at the
&gt;&gt; end it is ok and I can be sure the RIAK cluster is up and running for strong
&gt;&gt; consistent buckets. At the very beginning of startup I got
&gt;&gt; {error,&lt;&lt;"insufficient\\_vnodes\\_available"&gt;&gt;} replies but it is ok.
&gt;&gt; 
&gt;&gt; My request for help is to find a way when I know the cluster is ready. I
&gt;&gt; understand, RIAK needs time to sync all the nodes after startup, on the
&gt;&gt; other hand I need to know when it gets ready for production and will give
&gt;&gt; consistent answers. Is there a command in erlang to check it? I also attach
&gt;&gt; part of the full log when I listed the keys and values in the buckets to see
&gt;&gt; when would I get the correct result. It took about 10 minutes to get there.
&gt;&gt; 
&gt;&gt; Thanks in advance for thoughts and suggestions, your help is highly
&gt;&gt; appreciated.
&gt;&gt; Kind regards,
&gt;&gt; Zsolt
&gt;&gt; 
&gt;&gt; ==============================
&gt;&gt; Type:"strong"
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt;&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,&lt;&lt;"timeout"&gt;&gt;}
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt;&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,&lt;&lt;"timeout"&gt;&gt;}
&gt;&gt; ok
&gt;&gt; ==============================
&gt;&gt; Type:"strong"
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt;&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,&lt;&lt;"failed"&gt;&gt;}
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt;&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,&lt;&lt;"timeout"&gt;&gt;}
&gt;&gt; ==============================
&gt;&gt; Type:"strong"
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt;&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,&lt;&lt;"failed"&gt;&gt;}
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt;&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,&lt;&lt;"failed"&gt;&gt;}
&gt;&gt; ==============================
&gt;&gt; Type:"strong"
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_msuser"&gt;&gt;
&gt;&gt; ...........................
&gt;&gt; Key:"{msuser\\_actor,\\"z2\\",lamardan}" Value:Error:{error,notfound}
&gt;&gt; ------------------------
&gt;&gt; Bucket:&lt;&lt;"Actors\\_mssession"&gt;&gt;
&gt;&gt; Key:"{mssession\\_actor,\\"z2\\",zschat,0}" Value:Error:{error,notfound}
&gt;&gt; 
&gt;&gt; 
&gt;&gt; ---
&gt;&gt; This email has been checked for viruses by Avast antivirus software.
&gt;&gt; http://www.avast.com
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

