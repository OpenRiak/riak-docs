---
title: "Re: Yokozuna performance: single large index vs many smaller indexes"
description: ""
project: community
lastmod: 2014-11-22T06:14:43-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15212"
mailinglist_parent_id: "msg15162"
author_name: "Eric Redmond"
project_section: "mailinglistitem"
sent_date: 2014-11-22T06:14:43-08:00
---


Geoff, comments inline.

On Nov 13, 2014, at 3:13 PM, Geoff Garbers  wrote:

&gt; Hi all.
&gt; 
&gt; I've been looking around for a bit with some sort of guidelines as to how 
&gt; best to structure search indexes within Riak 2.0 - and have yet to come up 
&gt; with anything that satisfies my questions.
&gt; 
&gt; I came across https://github.com/basho/yokozuna/blob/develop/docs/ADMIN.md, 
&gt; where it talks about the one-to-one and many-to-one ways of indexing. It 
&gt; mentions in passing the potential for lower latency of queries and efficient 
&gt; deletion of index data when using the one-to-one method - without really 
&gt; mentioning too much about when one method could significantly outweigh the 
&gt; other in performance.
&gt; 
&gt; However, something I'm still not sure on is when is it considered a good idea 
&gt; to use multiple indexes, versus one massive index.
&gt; 
&gt; If you'll bear with me, I'll use this simple scenario:
&gt; I have lists, and I have contacts within these lists. In total, I have 100 
&gt; million contacts that I am dealing with. Each of them not more than 20KB in 
&gt; size, and they all follow the exact same JSON object structure. Ignoring 
&gt; application design for simplicity's sake, let's say I could choose between 
&gt; the following two ways of storing lists and contacts:
&gt; 
&gt; Having two buckets: lists and contacts.
&gt; All 100 million contacts are stored in the contacts bucket. Each contact 
&gt; object is linked to its corresponding list through a list\\_key property, and 
&gt; all the contacts are stored in the same single search index.
&gt; 
&gt; Having multiple buckets: lists, and for each list, having a separate bucket 
&gt; contacts\\_{listkey}.
&gt; Using this structure, each contact\\_{listkey} bucket would have its own search 
&gt; index.
&gt; With these two scenarios in mind; and making the assumption that we're 
&gt; dealing with 100 million contacts:
&gt; Which would be the better method of implementing the search indexes?
If you have 100M contacts, and giving each contacts it's own index might be 
fine, but note that indexes have their own overhead in both Solr and Riak 
cluster metadata. I wouldn't go this route if your contact\\_listkey measures in 
the hundreds or thousands.
&gt; At which point would one solution be far better than the other?
If your cluster has 100M objects, note that a solr shard wouldn't have 100M 
objects. Instead, if you had a, say, 10 node cluster, depending on your 
replication value, a single solr node would have 30M.
&gt; How much does Yokozuna differ from stock-standard Solr? All the search 
&gt; results I could find on Solr specifically weren't talking about indexes 
&gt; greater than 60,000 objects, yet Riak is required to be able to deal with 
&gt; 100's of millions of rows.

Solr can't manage far more than 60k objects (I've run 10M on my laptop, 100M 
per shard is safe, and I hear the tip-top limit per shard is 2 Billion unique 
terms per index segment due to Lucene's implementation). I think you'll have to 
experiment with your use-case and hardware, but you shouldn't have a problem.

&gt; Any help at all with this is really appreciated.
&gt; At some point, I do realise that I will need to set this up for myself, and 
&gt; performance my own tests on it. However, I was hoping that those currently 
&gt; using Riak in production might have some more insight into this.
&gt; 
&gt; Regards,
&gt; Geoff
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

