---
title: "Re: Issues with high node load and very slow response"
description: ""
project: community
lastmod: 2014-07-28T09:47:57-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14564"
mailinglist_parent_id: "msg14558"
author_name: "Jordan West"
project_section: "mailinglistitem"
sent_date: 2014-07-28T09:47:57-07:00
---


Chaim,

&gt;From the output you provided I think the handoff issue a symptom of the CPU
usage (the check that is performed is failing to complete before timing
out) . Could you run `riak-debug` on the nodes (or at least the ones with
high CPU usage) and make the archives available to me for download. If
you'd prefer to keep that off-list please email me directly.

Jordan


On Mon, Jul 28, 2014 at 8:59 AM, Chaim Solomon 
wrote:

&gt;
&gt; On Mon, Jul 28, 2014 at 6:50 PM, Jordan West  wrote:
&gt;
&gt;&gt; Unfortunately, there is more than one case that can cause this message to
&gt;&gt; occur. Can you try one more command (from any node in the cluster):
&gt;&gt;
&gt;&gt; ```
&gt;&gt; rpc:multicall([node() | nodes()], yz\\_solr, cores, [], 5000).
&gt;&gt; ```
&gt;&gt;
&gt;&gt;
&gt; (riak@10.128.138.25)1&gt; rpc:multicall([node() | nodes()], yz\\_solr, cores,
&gt; [], 5000).
&gt; {[{ok,[&lt;&lt;"content-items"&gt;&gt;,&lt;&lt;"linkmeta"&gt;&gt;,
&gt; &lt;&lt;"products\\_search\\_results"&gt;&gt;,
&gt; &lt;&lt;"single\\_product\\_search\\_results"&gt;&gt;,&lt;&lt;"sites"&gt;&gt;]},
&gt; {ok,[&lt;&lt;"content-items"&gt;&gt;,&lt;&lt;"linkmeta"&gt;&gt;,
&gt; &lt;&lt;"products\\_search\\_results"&gt;&gt;,
&gt; &lt;&lt;"single\\_product\\_search\\_results"&gt;&gt;,&lt;&lt;"sites"&gt;&gt;]},
&gt; {ok,[&lt;&lt;"content-items"&gt;&gt;,&lt;&lt;"linkmeta"&gt;&gt;,
&gt; &lt;&lt;"products\\_search\\_results"&gt;&gt;,
&gt; &lt;&lt;"single\\_product\\_search\\_results"&gt;&gt;,&lt;&lt;"sites"&gt;&gt;]},
&gt; {ok,[&lt;&lt;"content-items"&gt;&gt;,&lt;&lt;"linkmeta"&gt;&gt;,
&gt; &lt;&lt;"products\\_search\\_results"&gt;&gt;,
&gt; &lt;&lt;"single\\_product\\_search\\_results"&gt;&gt;,&lt;&lt;"sites"&gt;&gt;]}],
&gt; ['riak@10.128.179.86','riak@10.128.220.135',
&gt; 'riak@10.128.137.185']}
&gt;
&gt;
&gt;
&gt;&gt; I'm working on a patch to improve the logging here (so running these
&gt;&gt; commands won't be necessary) but that may take a bit to get reviewed.
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; Only one node (10.128.220.135) is giving me this:
&gt;&gt;&gt; 2014-07-28 10:31:31.618 [error] &lt;0.847.706&gt;@yz\\_kv:index:206 failed to
&gt;&gt;&gt; index object {&lt;&lt;"linkmeta"&gt;&gt;,&lt;&lt;"http://scn.sap.com/thread/3262664"&gt;&gt;}
&gt;&gt;&gt; with error {"Failed to index docs",{error,req\\_timedout}} because
&gt;&gt;&gt; [{yz\\_solr,index,3,[{file,"src/yz\\_solr.erl"},{line,192}]},{yz\\_kv,index,7,[{file,"src/yz\\_kv.erl"},{line,258}]},{yz\\_kv,index,3,[{file,"src/yz\\_kv.erl"},{line,193}]},{riak\\_kv\\_vnode,actual\\_put,6,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1416}]},{riak\\_kv\\_vnode,perform\\_put,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1404}]},{riak\\_kv\\_vnode,do\\_put,7,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1199}]},{riak\\_kv\\_vnode,handle\\_command,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,485}]},{riak\\_core\\_vnode,vnode\\_command,3,[{file,"src/riak\\_core\\_vnode.erl"},{line,345}]}]
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; My suspicion is the command above will shed some light on the error here.
&gt;&gt;
&gt;&gt; Also, so we don't leave behind the main issue of CPU usage, is this node
&gt;&gt; one of the two having problems? Which is the other?
&gt;&gt;
&gt;
&gt; Here is the top from top for the nodes:
&gt; 10.128.137.185
&gt; 20170 riak 20 0 16.543g 1.113g 3780 S 193.2 56.9 11991:45
&gt; 19745 riak 20 0 2390844 241996 3352 S 6.7 11.8 503:56.44
&gt;
&gt; 10.128.138.25
&gt; 628 riak 20 0 2841444 499964 2000 S 123.7 24.4 5779:46
&gt; 1074 riak 20 0 14.265g 1.014g 928 S 1.0 51.8 254:03.19
&gt;
&gt; 10.128.220.135
&gt; 3153 riak 20 0 16.479g 978376 0 S 100.2 47.7 6357:07
&gt; 2729 riak 20 0 2650512 481620 2828 S 11.0 23.5 1398:58
&gt;
&gt; Chaim Solomon
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

