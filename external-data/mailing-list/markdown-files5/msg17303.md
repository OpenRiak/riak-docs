---
title: "Re: How to increase Riak write performance for sequential	alpha-numeric keys"
description: ""
project: community
lastmod: 2016-05-05T17:04:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17303"
mailinglist_parent_id: "msg17302"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2016-05-05T17:04:23-07:00
---


I failed to mention these links that give additional details concerning the 
timed grooming feature:

discussion of the timed grooming feature is here:

 https://github.com/basho/leveldb/wiki/mv-timed-grooming

discussion of the timed grooming fix and disable is here:

 https://github.com/basho/leveldb/wiki/mv-timed-grooming2


&gt; On May 5, 2016, at 7:59 PM, Matthew Von-Maszewski  wrote:
&gt; 
&gt; Alex,
&gt; 
&gt; I am making a guess. I would be better able to support this guess with data 
&gt; from leveldb LOG files of one server.
&gt; 
&gt; The performance difference between the sequential keys and the reverse of the 
&gt; sequential keys is informative. The reverse ordered keys essentially become 
&gt; more like "random keys" within the leveldb key space. Overtime, they 
&gt; disperse to different .sst table files scattering the "focal point" of the 
&gt; read-before-write operations. The sequential keys are keeping all newly 
&gt; written data within the same .sst table file, i.e. the same "focal point".
&gt; 
&gt; And there is a new tuning called "timed grooming" in the Riak 2.1.3 and 2.1.4 
&gt; releases that has a bug. The bug can cause more frequent compaction cycles 
&gt; than intended for 2.1.3 and 2.1.4 under some work loads. Your particular 
&gt; sequential keys might be such a load. This is what the LOG files would 
&gt; indicate. The biggest impact of more frequent compaction cycles is that the 
&gt; Linux page cache and leveldb block caches get invalidated more often causing 
&gt; longer read cycles to determine "nothing is there" in the read-before-write 
&gt; operation of Riak.
&gt; 
&gt; Your higher ring size is likely not helping, but there is math that can prove 
&gt; or disprove this assumption. And again, the base numbers are within the LOG 
&gt; files.
&gt; 
&gt; We do have an eleveldb patch release available. You would have to manual 
&gt; install it on each of the nodes. The patch disables the timed grooming and 
&gt; contains some critical bug fixes that lead to the Riak 2.1.4 release. You 
&gt; would need to tell me which operating system package you originally download 
&gt; for Riak, then I can send an appropriate link.
&gt; 
&gt; Matthew
&gt; 
&gt; 
&gt;&gt; On May 5, 2016, at 10:11 AM, alexc155  wrote:
&gt;&gt; 
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; Thanks for your reply.
&gt;&gt; 
&gt;&gt; I don't think that write\\_once is going to work for us as we have to
&gt;&gt; periodically update the data (although if we remove the data before
&gt;&gt; re-inserting it, would that work?)
&gt;&gt; 
&gt;&gt; Why does read-before-write slow down new writes so much?
&gt;&gt; 
&gt;&gt; Some new information we've found - it seems that if we write the data and
&gt;&gt; then update it, we get fast speeds too. It's just the initial write of the
&gt;&gt; data that is slow.
&gt;&gt; 
&gt;&gt; So why is writing sequential keys so much slower than updating them or
&gt;&gt; writing non-sequential keys?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; --
&gt;&gt; View this message in context: 
&gt;&gt; http://riak-users.197444.n3.nabble.com/How-to-increase-Riak-write-performance-for-sequential-alpha-numeric-keys-tp4034219p4034225.html
&gt;&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

