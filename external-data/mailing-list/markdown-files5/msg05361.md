---
title: "Re: eleveldb make test failure"
description: ""
project: community
lastmod: 2011-10-28T19:47:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05361"
mailinglist_parent_id: "msg05349"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2011-10-28T19:47:19-07:00
---


Phil,

I tried reproducing the issue on OSX, Ubuntu 11, and Fedora 13 with no luck.
 The curiosity I have is the following

&gt; undefined symbol: \\_ZN6snappy13RawUncompressEPKcmPc'"}}
&gt; \\*\\*\\* test module not found \\*\\*\\*
&gt;
You have -DSNAPPY being passed into the compiler, and it appears that is
where the 'undefined symbol' error is coming from. We don't compile with
snappy installed, so I'm not too familiar with its versions. So if I was
you, I'd either double check if your snappy install is up to date, or simply
disable its use. To do that, it seems like if you make a simple change to:
 c\\_src/leveldb/Makefile

Simply comment out the following section

# If Snappy is installed, add compilation and linker flags
&gt;&gt;
&gt;&gt;
&gt;
&gt; # (see http://code.google.com/p/snappy/)
&gt;&gt;
&gt;&gt;
&gt;
&gt; ifeq ($(SNAPPY), 1)
&gt;
&gt; SNAPPY\\_CFLAGS=-DSNAPPY
&gt;
&gt; SNAPPY\\_LDFLAGS=-lsnappy
&gt;
&gt; else
&gt;
&gt; SNAPPY\\_CFLAGS=
&gt;
&gt; SNAPPY\\_LDFLAGS=
&gt;
&gt; endif
&gt;
&gt;


Then try a 'make clean' and 'make test' again.

If you are still having issues after that, please let me know.

-Jared



On Fri, Oct 28, 2011 at 1:09 PM, Phil Sorber  wrote:

&gt; I am trying to do some benchmarking with eleveldb but even getting the
&gt; basic 'make test' going is failing. Am I doing something obviously
&gt; wrong here?
&gt;
&gt; Also, I tried to put the eleveldb driver into basho bench, but not
&gt; sure if that is the intent there.
&gt;
&gt; $ make test
&gt; ./rebar compile
&gt; ==&gt; eleveldb (compile)
&gt; make[1]: Entering directory `/home/phil/git/basho/eleveldb/c\\_src/leveldb'
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/builder.cc -o db/builder.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/c.cc -o db/c.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/db\\_impl.cc -o db/db\\_impl.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/db\\_iter.cc -o db/db\\_iter.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/filename.cc -o db/filename.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/dbformat.cc -o db/dbformat.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/log\\_reader.cc -o db/log\\_reader.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/log\\_writer.cc -o db/log\\_writer.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/memtable.cc -o db/memtable.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/repair.cc -o db/repair.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/table\\_cache.cc -o db/table\\_cache.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/version\\_edit.cc -o db/version\\_edit.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/version\\_set.cc -o db/version\\_set.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY db/write\\_batch.cc -o db/write\\_batch.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY port/port\\_posix.cc -o port/port\\_posix.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/block.cc -o table/block.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/block\\_builder.cc -o table/block\\_builder.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/format.cc -o table/format.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/iterator.cc -o table/iterator.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/merger.cc -o table/merger.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/table.cc -o table/table.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/table\\_builder.cc -o table/table\\_builder.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY table/two\\_level\\_iterator.cc -o table/two\\_level\\_iterator.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/arena.cc -o util/arena.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/cache.cc -o util/cache.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/coding.cc -o util/coding.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/comparator.cc -o util/comparator.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/crc32c.cc -o util/crc32c.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/env.cc -o util/env.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/env\\_posix.cc -o util/env\\_posix.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/hash.cc -o util/hash.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/histogram.cc -o util/histogram.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/logging.cc -o util/logging.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/options.cc -o util/options.o
&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt; -DSNAPPY util/status.cc -o util/status.o
&gt; rm -f libleveldb.a
&gt; ar -rs libleveldb.a ./db/builder.o ./db/c.o ./db/db\\_impl.o
&gt; ./db/db\\_iter.o ./db/filename.o ./db/dbformat.o ./db/log\\_reader.o
&gt; ./db/log\\_writer.o ./db/memtable.o ./db/repair.o ./db/table\\_cache.o
&gt; ./db/version\\_edit.o ./db/version\\_set.o ./db/write\\_batch.o
&gt; ./port/port\\_posix.o ./table/block.o ./table/block\\_builder.o
&gt; ./table/format.o ./table/iterator.o ./table/merger.o ./table/table.o
&gt; ./table/table\\_builder.o ./table/two\\_level\\_iterator.o ./util/arena.o
&gt; ./util/cache.o ./util/coding.o ./util/comparator.o ./util/crc32c.o
&gt; ./util/env.o ./util/env\\_posix.o ./util/hash.o ./util/histogram.o
&gt; ./util/logging.o ./util/options.o ./util/status.o
&gt; ar: creating libleveldb.a
&gt; make[1]: Leaving directory `/home/phil/git/basho/eleveldb/c\\_src/leveldb'
&gt; Compiled src/eleveldb.erl
&gt; Compiling c\\_src/eleveldb.cc
&gt; ./rebar eunit
&gt; ==&gt; eleveldb (eunit)
&gt; Compiled test/basho\\_bench\\_driver\\_eldb.erl
&gt; Compiled src/eleveldb.erl
&gt; undefined
&gt;
&gt; =ERROR REPORT==== 28-Oct-2011::14:52:58 ===
&gt; The on\\_load function for module eleveldb returned {error,
&gt; {load\\_failed,
&gt; "Failed to load
&gt; NIF library: '/home/phil/git/basho/eleveldb/priv/eleveldb.so:
&gt; undefined symbol: \\_ZN6snappy13RawUncompressEPKcmPc'"}}
&gt; \\*\\*\\* test module not found \\*\\*\\*
&gt; ::eleveldb
&gt;
&gt; =======================================================
&gt; Failed: 0. Skipped: 0. Passed: 0.
&gt; One or more tests were cancelled.
&gt; ERROR: One or more eunit tests failed.
&gt; make: \\*\\*\\* [test] Error 1
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

