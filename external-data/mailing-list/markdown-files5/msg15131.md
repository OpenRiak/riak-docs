---
title: "Re: RiakCS poor s3 upload speeds 2MB/s"
description: ""
project: community
lastmod: 2014-11-08T07:36:05-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15131"
mailinglist_parent_id: "msg15130"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2014-11-08T07:36:05-08:00
---


Hi David,

Could you please provide a bit more information?

\\* The version of Riak and Riak CS you are using
\\* A description of the files you are uploading. What size are they and are
you using multipart uploads?

Thanks
--
Luke Bakken
Engineer / CSE
lbak...@basho.com

On Fri, Nov 7, 2014 at 6:41 AM, David Meekin 
wrote:

&gt; Hi,
&gt;
&gt;
&gt;
&gt; I’ve setup a test 4 node RiakCS cluster on HP BL460c hardware and I can’t
&gt; seem to get S3 upload speeds above 2MB/s
&gt;
&gt; I’m connecting direct to RiackCS on one of the nodes so there is no load
&gt; balancing software in place.
&gt;
&gt; I have also installed s3cmd locally onto one of the nodes and the speeds
&gt; locally are the same.
&gt;
&gt; These 4 nodes also run a test CEPH cluster with RadosGW and s3 uploads to
&gt; CEPH achieve 125MB/s
&gt;
&gt; Any help would be appreciated as I’m currently evaluating both CEPH and
&gt; RiakCS.
&gt;
&gt;
&gt;
&gt; Configs below:
&gt;
&gt;
&gt;
&gt; %%%RIACK – app.config
&gt;
&gt; %% -\\*- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil -\\*-
&gt;
&gt; %% ex: ft=erlang ts=4 sw=4 et
&gt;
&gt; [
&gt;
&gt; %% Riak Client APIs config
&gt;
&gt; {riak\\_api, [
&gt;
&gt; {pb\\_backlog, 256},
&gt;
&gt; {pb, [ {"172.19.153.180", 8087 } ]}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% Riak Core config
&gt;
&gt; {riak\\_core, [
&gt;
&gt;
&gt;
&gt; {default\\_bucket\\_props, [{allow\\_mult, true}]},
&gt;
&gt;
&gt;
&gt; {ring\\_state\\_dir, "/var/lib/riak/ring"},
&gt;
&gt;
&gt;
&gt; {http, [ {"172.19.153.180", 8098 } ]},
&gt;
&gt; {https, [{ "172.19.153.180", 8096 }]},
&gt;
&gt; {ssl, [
&gt;
&gt; {certfile, "/etc/riak/cert.pem"},
&gt;
&gt; {keyfile, "/etc/riak/key.pem"}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; {handoff\\_port, 8099 },
&gt;
&gt;
&gt;
&gt; {dtrace\\_support, false},
&gt;
&gt;
&gt;
&gt; {platform\\_bin\\_dir, "/usr/sbin"},
&gt;
&gt; {platform\\_data\\_dir, "/var/lib/riak"},
&gt;
&gt; {platform\\_etc\\_dir, "/etc/riak"},
&gt;
&gt; {platform\\_lib\\_dir, "/usr/lib64/riak/lib"},
&gt;
&gt; {platform\\_log\\_dir, "/var/log/riak"}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% Riak KV config
&gt;
&gt; {riak\\_kv, [
&gt;
&gt; {add\\_paths, ["/usr/lib64/riak-cs/lib/riak\\_cs-1.5.2/ebin"]},
&gt;
&gt; {storage\\_backend, riak\\_cs\\_kv\\_multi\\_backend},
&gt;
&gt; {multi\\_backend\\_prefix\\_list, [{&lt;&lt;"0b:"&gt;&gt;, be\\_blocks}]},
&gt;
&gt; {multi\\_backend\\_default, be\\_default},
&gt;
&gt; {multi\\_backend, [
&gt;
&gt; {be\\_default, riak\\_kv\\_eleveldb\\_backend, [
&gt;
&gt; {max\\_open\\_files, 50},
&gt;
&gt; {data\\_root, "/var/lib/riak/leveldb"}
&gt;
&gt; ]},
&gt;
&gt; {be\\_blocks, riak\\_kv\\_bitcask\\_backend, [
&gt;
&gt; {data\\_root, "/var/lib/riak/bitcask"}
&gt;
&gt; ]}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; {anti\\_entropy, {on, []}},
&gt;
&gt;
&gt;
&gt; {anti\\_entropy\\_build\\_limit, {1, 3600000}},
&gt;
&gt; {anti\\_entropy\\_expire, 604800000},
&gt;
&gt;
&gt;
&gt; {anti\\_entropy\\_concurrency, 2},
&gt;
&gt; {anti\\_entropy\\_tick, 15000},
&gt;
&gt;
&gt;
&gt; {anti\\_entropy\\_data\\_dir, "/var/lib/riak/anti\\_entropy"},
&gt;
&gt;
&gt;
&gt; {anti\\_entropy\\_leveldb\\_opts, [{write\\_buffer\\_size, 4194304},
&gt;
&gt; {max\\_open\\_files, 20}]},
&gt;
&gt;
&gt;
&gt; {mapred\\_name, "mapred"},
&gt;
&gt;
&gt;
&gt; {mapred\\_2i\\_pipe, true},
&gt;
&gt;
&gt;
&gt; {map\\_js\\_vm\\_count, 8 },
&gt;
&gt; {reduce\\_js\\_vm\\_count, 6 },
&gt;
&gt; {hook\\_js\\_vm\\_count, 2 },
&gt;
&gt;
&gt;
&gt; {js\\_max\\_vm\\_mem, 8},
&gt;
&gt;
&gt;
&gt; {js\\_thread\\_stack, 16},
&gt;
&gt;
&gt;
&gt; {http\\_url\\_encoding, on},
&gt;
&gt;
&gt;
&gt; {vnode\\_vclocks, true},
&gt;
&gt;
&gt;
&gt; {listkeys\\_backpressure, true},
&gt;
&gt;
&gt;
&gt; {fsm\\_limit, 50000},
&gt;
&gt;
&gt;
&gt; {object\\_format, v1}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% Riak Search Config
&gt;
&gt; {riak\\_search, [
&gt;
&gt; {enabled, false}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% Merge Index Config
&gt;
&gt; {merge\\_index, [
&gt;
&gt; {data\\_root, "/var/lib/riak/merge\\_index"},
&gt;
&gt;
&gt;
&gt; {buffer\\_rollover\\_size, 1048576},
&gt;
&gt;
&gt;
&gt; {max\\_compact\\_segments, 20}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% Bitcask Config
&gt;
&gt; {bitcask, [
&gt;
&gt; {io\\_mode, erlang},
&gt;
&gt;
&gt;
&gt; {data\\_root, "/var/lib/riak/bitcask"}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% eLevelDB Config
&gt;
&gt; {eleveldb, [
&gt;
&gt; {data\\_root, "/var/lib/riak/leveldb"}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% Lager Config
&gt;
&gt; {lager, [
&gt;
&gt; {handlers, [
&gt;
&gt; {lager\\_file\\_backend, [
&gt;
&gt; {"/var/log/riak/error.log", error,
&gt; 10485760, "$D0", 5},
&gt;
&gt; {"/var/log/riak/console.log", info,
&gt; 10485760, "$D0", 5}
&gt;
&gt; ]}
&gt;
&gt; ] },
&gt;
&gt;
&gt;
&gt; {crash\\_log, "/var/log/riak/crash.log"},
&gt;
&gt;
&gt;
&gt; {crash\\_log\\_msg\\_size, 65536},
&gt;
&gt;
&gt;
&gt; {crash\\_log\\_size, 10485760},
&gt;
&gt;
&gt;
&gt; {crash\\_log\\_date, "$D0"},
&gt;
&gt;
&gt;
&gt; {crash\\_log\\_count, 5},
&gt;
&gt;
&gt;
&gt; {error\\_logger\\_redirect, true},
&gt;
&gt;
&gt;
&gt; {error\\_logger\\_hwm, 100}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% riak\\_sysmon config
&gt;
&gt; {riak\\_sysmon, [
&gt;
&gt; {process\\_limit, 30},
&gt;
&gt; {port\\_limit, 2},
&gt;
&gt;
&gt;
&gt; {gc\\_ms\\_limit, 0},
&gt;
&gt; {heap\\_word\\_limit, 40111000},
&gt;
&gt;
&gt;
&gt; {busy\\_port, true},
&gt;
&gt; {busy\\_dist\\_port, true}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% SASL config
&gt;
&gt; {sasl, [
&gt;
&gt; {sasl\\_error\\_logger, false}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; %% riak\\_control config
&gt;
&gt; {riak\\_control, [
&gt;
&gt; {enabled, true},
&gt;
&gt;
&gt;
&gt; {auth, userlist},
&gt;
&gt;
&gt;
&gt; {userlist, [{"admin", "password"}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; {admin, true}
&gt;
&gt; ]}
&gt;
&gt; ].
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; %%%RiakCS – app.config
&gt;
&gt; %% -\\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\\*-
&gt;
&gt; %% ex: ts=4 sw=4 et
&gt;
&gt; [
&gt;
&gt; %% Riak CS configuration
&gt;
&gt; {riak\\_cs, [
&gt;
&gt; %% == Basic Configuration ==
&gt;
&gt;
&gt;
&gt; %% Riak CS http/https port and IP address to listen at
&gt;
&gt; %% for object storage activity
&gt;
&gt; {cs\\_ip, "172.19.153.180"},
&gt;
&gt; {cs\\_port, 8080 } ,
&gt;
&gt; {riak\\_ip, "172.19.153.180"},
&gt;
&gt; {riak\\_pb\\_port, 8087 } ,
&gt;
&gt; {stanchion\\_ip, "172.19.153.180"},
&gt;
&gt; {stanchion\\_port, 8085 },
&gt;
&gt; {stanchion\\_ssl, false },
&gt;
&gt; {anonymous\\_user\\_creation, true},
&gt;
&gt; {admin\\_key, "\\_UJJOXXQEXW3XAWUGSQD"},
&gt;
&gt; {admin\\_secret, "8bkzcxZDIKsmjJUhEEJkpcM6g5\\_X7gSazryBGA=="},
&gt;
&gt;
&gt;
&gt; {cs\\_root\\_host, "s3.amazonaws.com"},
&gt;
&gt; {connection\\_pools,
&gt;
&gt; [
&gt;
&gt; {request\\_pool, {128, 0} },
&gt;
&gt; {bucket\\_list\\_pool, {5, 0} }
&gt;
&gt; ]},
&gt;
&gt; {rewrite\\_module, riak\\_cs\\_s3\\_rewrite },
&gt;
&gt; {auth\\_module, riak\\_cs\\_s3\\_auth },
&gt;
&gt; {fold\\_objects\\_for\\_list\\_keys, true},
&gt;
&gt;
&gt;
&gt; {n\\_val\\_1\\_get\\_requests, true},
&gt;
&gt; {cs\\_version, 10300 },
&gt;
&gt; {access\\_log\\_flush\\_factor, 1},
&gt;
&gt; {access\\_log\\_flush\\_size, 1000000},
&gt;
&gt; {access\\_archive\\_period, 3600},
&gt;
&gt; {access\\_archiver\\_max\\_backlog, 2},
&gt;
&gt; {storage\\_schedule, []},
&gt;
&gt; {storage\\_archive\\_period, 86400},
&gt;
&gt; {usage\\_request\\_limit, 744},
&gt;
&gt; {leeway\\_seconds, 86400},
&gt;
&gt; {gc\\_interval, 900},
&gt;
&gt; {gc\\_retry\\_interval, 21600},
&gt;
&gt; {gc\\_paginated\\_indexes, true},
&gt;
&gt;
&gt;
&gt; {trust\\_x\\_forwarded\\_for, false},
&gt;
&gt; {dtrace\\_support, false}
&gt;
&gt;
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; {webmachine, [
&gt;
&gt; {server\\_name, "Riak CS"},
&gt;
&gt;
&gt;
&gt; {log\\_handlers, [
&gt;
&gt; {webmachine\\_log\\_handler,
&gt; ["/var/log/riak-cs"]},
&gt;
&gt; {riak\\_cs\\_access\\_log\\_handler, []}
&gt;
&gt; ]}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; {lager, [
&gt;
&gt; {handlers, [
&gt;
&gt; {lager\\_console\\_backend, info},
&gt;
&gt; {lager\\_file\\_backend, [{file,
&gt; "/var/log/riak-cs/error.log"},
&gt;
&gt; {level, error},
&gt;
&gt; {size, 10485760},
&gt;
&gt; {date, "$D0"},
&gt;
&gt; {count, 5}]},
&gt;
&gt; {lager\\_file\\_backend, [{file,
&gt; "/var/log/riak-cs/console.log"},
&gt;
&gt; {level, info},
&gt;
&gt; {size, 10485760},
&gt;
&gt; {date, "$D0"},
&gt;
&gt; {count, 5}]}
&gt;
&gt; ]},
&gt;
&gt; {crash\\_log, "/var/log/riak-cs/crash.log"},
&gt;
&gt; {crash\\_log\\_msg\\_size, 65536},
&gt;
&gt;
&gt;
&gt; {crash\\_log\\_size, 10485760},
&gt;
&gt;
&gt;
&gt; {crash\\_log\\_date, "$D0"},
&gt;
&gt;
&gt;
&gt; {crash\\_log\\_count, 5},
&gt;
&gt;
&gt;
&gt; {error\\_logger\\_redirect, true}
&gt;
&gt; ]},
&gt;
&gt;
&gt;
&gt; {sasl, [
&gt;
&gt; {sasl\\_error\\_logger, false}
&gt;
&gt; ]}
&gt;
&gt; ].
&gt;
&gt;
&gt;
&gt; Thanks,
&gt;
&gt;
&gt;
&gt; Dave
&gt;
&gt; Tel: +441616699154 Mob: +44 7525 405543
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;
&gt; This e-mail is sent on behalf of Auto Trader Group Limited, Registered
&gt; Office: Auto Trader House, Cutbush Park Industrial Estate, Danehill, Lower
&gt; Earley, Reading, Berkshire, RG6 4UT (Registered in England No. 4768833).
&gt; This email and any files transmitted with it are confidential and may be
&gt; legally privileged, and intended solely for the use of the individual or
&gt; entity to whom they are addressed. If you have received this email in error
&gt; please notify the sender. This email message has been swept for the
&gt; presence of computer viruses.
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

