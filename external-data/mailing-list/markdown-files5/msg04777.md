---
title: "Re: Precommit Hook Difficulties"
description: ""
project: community
lastmod: 2011-09-19T10:47:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04777"
mailinglist_parent_id: "msg04764"
author_name: "Greg Pascale"
project_section: "mailinglistitem"
sent_date: 2011-09-19T10:47:43-07:00
---


Actually it looks like I can remove the JSON decode/encode and I still see
the same issue. Just reading and writing the value is enough, so all I'm
doing now is

\\*precommit(RiakObject) -&gt;\\*
\\* Value = riak\\_object:get\\_value(RiakObject),\\*
\\* riak\\_object:apply\\_updates(\\*
\\* riak\\_object:update\\_value(RiakObject, Value)).\\*

I'm really baffled here. The only documentation I know of for this code is
at
http://basho.github.com/riak-erlang-client/riak-erlang-client/riakc\\_obj.html
and
it really doesn't say much.

-Greg
Clipboard

On Sat, Sep 17, 2011 at 4:11 PM, Greg Pascale  wrote:

&gt; Hi,
&gt;
&gt; I'm trying to write a simple precommit hook to modify a JSON object by
&gt; removing certain fields. The simplest way to do this, I figure, is to decode
&gt; the object's value with mochijson2, remove the fields I don't want,
&gt; re-encode it, and update the value.
&gt;
&gt; What happens, though, is my object ends up somehow mangled. When I inspect
&gt; it via curl, it sort of looks like JSON, but characters like "{" and ":"
&gt; seem to be replaced with garbage.
&gt;
&gt; For example, what should read "hostname":"www.google.com" looks like \\*
&gt; hostnamea"ja:la"mwww.google.coma"j\\*
&gt;
&gt; To try to diagnose the issue, I reduced my hook to the simplest possible
&gt; case. I don't even modify the JSON, I just decode the object and re-encode
&gt; exactly the same value, but I still have the problem. The code is pasted
&gt; below
&gt;
&gt; \\*precommit(RiakObject) -&gt;\\*
&gt; \\* Value = riak\\_object:get\\_value(RiakObject),\\*
&gt; \\* {struct, TermList} = mochijson2:decode(Value),\\*
&gt; \\* riak\\_object:apply\\_updates(\\*
&gt; \\* riak\\_object:update\\_value(RiakObject, \\*
&gt; \\* mochijson2:encode({struct,
&gt; TermList}))).\\*
&gt;
&gt; Can anybody point out what I'm doing wrong?
&gt;
&gt; --
&gt; Greg
&gt; Clipboard  is hiring
&gt; !
&gt;
&gt;


-- 
Greg
Clipboard  is hiring
!
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

