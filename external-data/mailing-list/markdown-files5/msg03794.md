---
title: "Re: Link Walking via Map Reduce"
description: ""
project: community
lastmod: 2011-06-22T22:59:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03794"
mailinglist_parent_id: "msg03793"
author_name: "Andrew Berman"
project_section: "mailinglistitem"
sent_date: 2011-06-22T22:59:48-07:00
---


Hey Ryan,

Here is the error from the sasl log.  It looks like some sort of
encoding error.  Any thoughts on how to fix this?  I am storing the
data as BERT encoded binary and I set the content-type as
application/octet-stream.

Thanks for your help!

Andrew

ERROR REPORT==== 9-Jun-2011::21:37:05 ===
\\*\\* Generic server &lt;0.5996.21&gt; terminating
\\*\\* Last message in was {batch\\_dispatch,
                        {map,
                         {jsanon,&lt;&lt;"function(value) {return [value];}"&gt;&gt;},
                         [{struct,
                           [{&lt;&lt;"bucket"&gt;&gt;,&lt;&lt;"user"&gt;&gt;},
                            {&lt;&lt;"key"&gt;&gt;,&lt;&lt;"LikiWUPJSFuxtrhCYpsPfg"&gt;&gt;},
                            {&lt;&lt;"vclock"&gt;&gt;,

&lt;&lt;"a85hYGBgzGDKBVIsLKaZdzOYEhnzWBmes6Yd58sCAA=="&gt;&gt;},
                            {&lt;&lt;"values"&gt;&gt;,
                             [{struct,
                               [{&lt;&lt;"metadata"&gt;&gt;,
                                 {struct,
                                  [{&lt;&lt;"X-Riak-VTag"&gt;&gt;,
                                    &lt;&lt;"1KnL9Dlma9Yg4eMhRuhwtx"&gt;&gt;},
                                   {&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;,
                                    &lt;&lt;"Fri, 10 Jun 2011 03:05:11 GMT"&gt;&gt;}]}},
                                {&lt;&lt;"data"&gt;&gt;,

&lt;&lt;131,108,0,0,0,18,104,2,100,0,6,114,...&gt;&gt;}]}]}]},
 &lt;&lt;"user"&gt;&gt;,none]}}
\\*\\* When Server state == {state,&lt;0.143.0&gt;,riak\\_kv\\_js\\_map,#Port&lt;0.92614&gt;,true}
\\*\\* Reason for termination ==
\\*\\* {function\\_clause,[{js\\_driver,eval\\_js,
 [#Port&lt;0.92614&gt;,{error,bad\\_encoding},5000]},
 {riak\\_kv\\_js\\_vm,invoke\\_js,2},
 {riak\\_kv\\_js\\_vm,define\\_invoke\\_anon\\_js,3},
 {riak\\_kv\\_js\\_vm,handle\\_call,3},
 {gen\\_server,handle\\_msg,5},
 {proc\\_lib,init\\_p\\_do\\_apply,3}]}

=CRASH REPORT==== 9-Jun-2011::21:37:05 ===
  crasher:
    initial call: riak\\_kv\\_js\\_vm:init/1
    pid: &lt;0.5996.21&gt;
    registered\\_name: []
    exception exit:
{function\\_clause,[{js\\_driver,eval\\_js,[#Port&lt;0.92614&gt;,{error,bad\\_encoding},5000]},{riak\\_kv\\_js\\_vm,invoke\\_js,2},{riak\\_kv\\_js\\_vm,define\\_invoke\\_anon\\_js,3},{riak\\_kv\\_js\\_vm,handle\\_call,3},{gen\\_server,handle\\_msg,5},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
      in function  gen\\_server:terminate/6
      in call from proc\\_lib:init\\_p\\_do\\_apply/3
    ancestors: [riak\\_kv\\_js\\_sup,riak\\_kv\\_sup,&lt;0.128.0&gt;]
    messages: []
    links: [&lt;0.142.0&gt;,&lt;0.6009.21&gt;]
    dictionary: []
    trap\\_exit: false
    status: running
    heap\\_size: 4181
    stack\\_size: 24
    reductions: 2586
  neighbours:
    neighbour: 
[{pid,&lt;0.6009.21&gt;},{registered\\_name,[]},{initial\\_call,{riak\\_kv\\_mapper,init,[Argument\\_\\_1]}},{current\\_function,{gen,do\\_call,4}},{ancestors,[riak\\_kv\\_mapper\\_sup,riak\\_kv\\_sup,&lt;0.128.0&gt;]},{messages,[]},{links,[&lt;0.5996.21&gt;,&lt;12337.6227.21&gt;,&lt;0.162.0&gt;]},{dictionary,[]},{trap\\_exit,false},{status,waiting},{heap\\_size,987},{stack\\_size,53},{reductions,1043}]
=SUPERVISOR REPORT==== 9-Jun-2011::21:37:05 ===
     Supervisor: {local,riak\\_kv\\_js\\_sup}
     Context:    child\\_terminated
     Reason:
{function\\_clause,[{js\\_driver,eval\\_js,[#Port&lt;0.92614&gt;,{error,bad\\_encoding},5000]},{riak\\_kv\\_js\\_vm,invoke\\_js,2},{riak\\_kv\\_js\\_vm,define\\_invoke\\_anon\\_js,3},{riak\\_kv\\_js\\_vm,handle\\_call,3},{gen\\_server,handle\\_msg,5},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
     Offender:
[{pid,&lt;0.5996.21&gt;},{name,undefined},{mfargs,{riak\\_kv\\_js\\_vm,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,2000},{child\\_type,worker}]

On Wed, Jun 22, 2011 at 6:10 PM, Ryan Zezeski  wrote:
&gt;
&gt; Andrew,
&gt; Maybe you could elaborate on the error?  I tested this against master (commit 
&gt; below) just now with success.
&gt; 2b1a474f836d962fa035f48c05452e22fc6c2193 Change dependency to allow for 
&gt; R14B03 as well as R14B02
&gt; -Ryan
&gt; On Wed, Jun 22, 2011 at 7:03 PM, Andrew Berman  wrote:
&gt;&gt;
&gt;&gt; Hello,
&gt;&gt; I'm having issues link walking using the Map Reduce link function.  I am 
&gt;&gt; using HEAD from Git, so it's possible that's the issue, but here is what is 
&gt;&gt; happening.
&gt;&gt; I've got two buckets, user and user\\_email where user\\_email contains a link 
&gt;&gt; to the user.
&gt;&gt; When I run this:
&gt;&gt; {
&gt;&gt;     "inputs": [
&gt;&gt;         [
&gt;&gt;             "user\\_email",
&gt;&gt;             "myem...@email.com"
&gt;&gt;         ]
&gt;&gt;     ],
&gt;&gt;     "query": [
&gt;&gt;         {
&gt;&gt;             "link": {
&gt;&gt;                 "bucket": "user",
&gt;&gt;                 "tag": "user"
&gt;&gt;             }
&gt;&gt;         }
&gt;&gt;     ]
&gt;&gt; }
&gt;&gt; I only get [["user","LikiWUPJSFuxtrhCYpsPfg","user"]] returned.  The second 
&gt;&gt; I add a map function, even the simplest one (function(v) { [v] } I get a 
&gt;&gt; "map\\_reduce error":
&gt;&gt; {
&gt;&gt;     "inputs": [
&gt;&gt;         [
&gt;&gt;             "user\\_email",
&gt;&gt;             "myem...@email.com"
&gt;&gt;         ]
&gt;&gt;     ],
&gt;&gt;     "query": [
&gt;&gt;         {
&gt;&gt;             "link": {"bucket":"user", "tag":"user"}
&gt;&gt;         }
&gt;&gt;        ,{
&gt;&gt;             "map": {
&gt;&gt;                 "language": "javascript",
&gt;&gt;                 "source": "function(v) { return[v]; }"
&gt;&gt;             }
&gt;&gt;         }
&gt;&gt;     ]
&gt;&gt; }
&gt;&gt; Is this functionality broken?  I am following what it says on the Wiki for 
&gt;&gt; the MapRed version of link walking.  When I use HTTP link walking, it works 
&gt;&gt; correctly.
&gt;&gt; Thanks,
&gt;&gt; Andrew
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

