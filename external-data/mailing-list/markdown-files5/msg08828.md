---
title: "Re: riak exiting when number partitions > 128"
description: ""
project: community
lastmod: 2012-10-08T18:22:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08828"
mailinglist_parent_id: "msg08827"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2012-10-08T18:22:24-07:00
---


Like Alex, I state ulimit -n directly in my start Riak start up scripts.
For my local dev instance it looks like this:

### Generic Riak dev version setup
function riak\\_dev\\_start() {
 local CURRENT=`pwd`;

 ulimit -n 1024;

 cd ~/Projects/riak/dev
 echo "Starting riak node 1 on 127.0.0.1"
 dev1/bin/riak start
 echo "Starting riak node 2 on 127.0.0.1"
 dev2/bin/riak start
 echo "Starting riak node 3 on 127.0.0.1"
 dev3/bin/riak start
 echo "Starting riak node 4 on 127.0.0.1"
 dev4/bin/riak start

 cd $CURRENT
}

I'd definitely try bumping ulimit in your riak startup scripts themselves
and see if that eliminates the issues that you're running into.
---
Jeremiah Peschka
Managing Director, Brent Ozar PLF, LLC


On Mon, Oct 8, 2012 at 6:11 PM, Alexander Sicular wrote:

&gt; I don't think you're setting it correctly. I usually set it in the
&gt; terminal before calling riak start. Or set it system wide, different ways
&gt; to do it depending on your os.
&gt;
&gt;
&gt; @siculars
&gt; http://siculars.posterous.com
&gt;
&gt; Sent from my iRotaryPhone
&gt;
&gt; On Oct 8, 2012, at 21:00, David Lowell  wrote:
&gt;
&gt; I'm starting to want to move past the default Riak configs, for example,
&gt; by running with a larger number of partitions than the default 64. However,
&gt; today when bumping up the "ring\\_creation\\_size" config param to 256 or
&gt; higher Riak started failing soon after startup with messages about "Too
&gt; many open files". For the record, I'm using the ELevelDB back-end.
&gt;
&gt; I've seen the documentation about the need for ring\\_creation\\_size \\*
&gt; max\\_open\\_files file descriptors with levelDB. I've upped the system open
&gt; files limit for the riak user to 100k, so I don't think I'm hitting that
&gt; system limit. So it feels like I'm hitting a limit configured within the
&gt; application somewhere.
&gt;
&gt; It doesn't feel like changing levelDB's 'max\\_open\\_files' configuration is
&gt; the issue here, as I'm using the default/minimum value of 20 for that
&gt; parameter. Any other setting would increase open files.
&gt;
&gt; So I could use a pointer here from folks who have been here. I suspect
&gt; there is something very simple required here.
&gt;
&gt; Thanks folks!
&gt;
&gt; Dave
&gt;
&gt; ps. For the record, my data set is empty on this host, and for
&gt; completeness I'm blowing away the ring state when I fiddle with the
&gt; ring\\_creation\\_size parameter.
&gt;
&gt; --
&gt; Dave Lowell
&gt; d...@connectv.com
&gt;
&gt;
&gt; 2012-10-09 00:50:17.430 [info] &lt;0.7.0&gt; Application riak\\_kv started on node
&gt; 'riak@10.0.3.81'
&gt; 2012-10-09 00:50:17.456 [info] &lt;0.7.0&gt; Application merge\\_index started on
&gt; node 'riak@10.0.3.81'
&gt; 2012-10-09 00:50:17.459 [info] &lt;0.1316.0&gt;@riak\\_core:wait\\_for\\_service:445
&gt; Waiting for service riak\\_kv to start (0 seconds)
&gt; 2012-10-09 00:50:17.525 [info]
&gt; &lt;0.1303.0&gt;@riak\\_core:wait\\_for\\_application:419 Wait complete for application
&gt; riak\\_kv (0 seconds)
&gt; 2012-10-09 00:50:37.366 [error] &lt;0.5081.0&gt;@riak\\_kv\\_vnode:init:265 Failed
&gt; to start riak\\_kv\\_eleveldb\\_backend Reason: {db\\_open,"IO error:
&gt; /var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
&gt; Too many open files"}
&gt; 2012-10-09 00:50:37.423 [notice] &lt;0.5081.0&gt;@riak:stop:46 "backend module
&gt; failed to start."
&gt; 2012-10-09 00:50:37.424 [error] &lt;0.5081.0&gt; CRASH REPORT Process &lt;0.5081.0&gt;
&gt; with 0 neighbours exited with reason: {db\\_open,"IO error:
&gt; /var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
&gt; Too many open files"} in gen\\_fsm:init\\_it/6 line 371
&gt; 2012-10-09 00:50:37.429 [info] &lt;0.494.0&gt;@riak\\_kv\\_js\\_vm:terminate:240
&gt; Spidermonkey VM (pool: riak\\_kv\\_js\\_hook) host stopping (&lt;0.494.0&gt;)
&gt; 2012-10-09 00:50:37.673 [error] &lt;0.138.0&gt; Supervisor riak\\_core\\_vnode\\_sup
&gt; had child undefined started with {riak\\_core\\_vnode,start\\_link,undefined} at
&gt; &lt;0.5081.0&gt; exit with reason {db\\_open,"IO error:
&gt; /var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
&gt; Too many open files"} in context child\\_terminated
&gt; 2012-10-09 00:50:37.736 [error] &lt;0.153.0&gt; gen\\_server
&gt; riak\\_core\\_vnode\\_manager terminated with reason: no match of right hand
&gt; value {error,{db\\_open,"IO error:
&gt; /var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
&gt; Too many open files"}} in riak\\_core\\_vnode\\_manager:get\\_vnode/3 line 489
&gt; 2012-10-09 00:50:37.799 [error] &lt;0.153.0&gt; CRASH REPORT Process
&gt; riak\\_core\\_vnode\\_manager with 0 neighbours exited with reason: no match of
&gt; right hand value {error,{db\\_open,"IO error:
&gt; /var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
&gt; Too many open files"}} in riak\\_core\\_vnode\\_manager:get\\_vnode/3 line 489 in
&gt; gen\\_server:terminate/6 line 747
&gt; 2012-10-09 00:50:37.844 [error] &lt;0.136.0&gt; Supervisor riak\\_core\\_sup had
&gt; child riak\\_core\\_vnode\\_manager started with
&gt; riak\\_core\\_vnode\\_manager:start\\_link() at &lt;0.153.0&gt; exit with reason no match
&gt; of right hand value {error,{db\\_open,"IO error:
&gt; /var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
&gt; Too many open files"}} in riak\\_core\\_vnode\\_manager:get\\_vnode/3 line 489 in
&gt; context child\\_terminated
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

