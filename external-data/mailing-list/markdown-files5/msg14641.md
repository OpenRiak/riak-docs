---
title: "Re: Issues with search (2.0)"
description: ""
project: community
lastmod: 2014-08-11T07:49:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14641"
mailinglist_parent_id: "msg14638"
author_name: "Jordan West"
project_section: "mailinglistitem"
sent_date: 2014-08-11T07:49:36-07:00
---


Chaim,

Some comments inline:

On Mon, Aug 11, 2014 at 4:14 AM, Chaim Solomon 
wrote:

&gt; Hi,
&gt;
&gt; I've been running into an issue with the yz search acting up.
&gt;
&gt; I've been getting a lot of these:
&gt;
&gt; 2014-08-11 06:45:22.005 [error] &lt;0.913.0&gt;@yz\\_kv:index:206 failed to index
&gt; object {&lt;&lt;"bucketname"&gt;&gt;,&lt;&lt;"123"&gt;&gt;} with error {"Failed to index
&gt; docs",{error,req\\_timedout}} because [{yz\\_solr,index,3,[{file,"s
&gt;
&gt; rc/yz\\_solr.erl"},{line,192}]},{yz\\_kv,index,7,[{file,"src/yz\\_kv.erl"},{line,258}]},{yz\\_kv,index,3,[{file,
&gt;
&gt; "src/yz\\_kv.erl"},{line,193}]},{riak\\_kv\\_vnode,actual\\_put,6,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1416}]},
&gt;
&gt; {riak\\_kv\\_vnode,perform\\_put,3,[{file,"src/riak\\_kv\\_vnode.erl"},{line,1404}]},{riak\\_kv\\_vnode,do\\_put,7,[{fil
&gt;
&gt; e,"src/riak\\_kv\\_vnode.erl"},{line,1199}]},{riak\\_kv\\_vnode,handle\\_command,3,[{file,"src/riak\\_kv\\_vnode.erl"}
&gt;
&gt; ,{line,485}]},{riak\\_core\\_vnode,vnode\\_command,3,[{file,"src/riak\\_core\\_vnode.erl"},{line,345}]}]
&gt;
&gt; and the Java process uses a lot of CPU and eventually runs out of memory
&gt; or something like that and gets stuck. Killing the process gets the cluster
&gt; back up and running.
&gt;
&gt; I am guessing that it may be data corruption on the yz data on one node.
&gt;
&gt; Clearing away the yz data on that node and restarting riak makes the
&gt; system work again - and I guess AAE will rebuild the index.
&gt;
&gt;
This sounds very similar to the issue last week. I would certainly like to
rule out any sort of data corruption (are you thinking your disks are
corrupting the data or are you assuming Solr is?).

However, it is also possible, like the last issue, that the node/cluster
simply does not have enough memory. When you delete the data Solr no longer
has anything to cache in-memory thus using significantly less. As
discussed, the recommended minimum


&gt; But I'm wondering why a crashing Java on one node practically takes down
&gt; the search on the cluster. Shouldn't Riak be more resilient than that?
&gt;

The hard part here is, at least initially, the Java process doesn't crash,
it just starts to timeout. In distributed systems a slow-node is often
worse than a down node. Riak, prior to 1.4 had something called "health
check" that would mark a node down in this situation. Unfortunately in some
workloads, and I believe given your cluster's limited resources it would
happen here, this often results in excessive work being offloaded to
another node, which also does not have sufficient resources and around we
go until the entire cluster falls over. A capacity problem, typically, can
only be solved by adding more capacity.


&gt;
&gt; Is there a explicit reindex command for the full text search subsystem?
&gt;
&gt; Could Riak keep an eye on the java process and restart it if it crashes or
&gt; runs away?
&gt;
&gt;
Riak does manage the JVM process (starting/stopping/restarting) .I agree
that if we could include run-away process, like in your case, that would be
even better. I would have to think a bit more about how this would work (to
prevent the same problems mentioned above with the old-style health check)

Jordan



&gt; Chaim Solomon
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

