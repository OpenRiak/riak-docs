---
title: "Re: Ok, I am stumped. Losing data or riak stop"
description: ""
project: community
lastmod: 2016-02-26T08:32:46-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17089"
mailinglist_parent_id: "msg17086"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2016-02-26T08:32:46-08:00
---


What I failed to say, was make the copy after you populate and stop, but before 
you attempt to start Riak again.

Matthew

&gt; On Feb 26, 2016, at 11:19 AM, Joe Olson  wrote:
&gt; 
&gt; 
&gt; 
&gt; Negative.
&gt; 
&gt; I have ring size set to 8, leveldb split across two sets of drives ("fast" 
&gt; and "slow", but meaningless on the test Vagrant box...just two separate 
&gt; directories). I checked all of the ../leveldb/\\* directories. All LOG files 
&gt; are identical, and no errors in any of them.
&gt; 
&gt; I will try to build another Vagrant machine with the default riak.conf and 
&gt; see if I can get this to repeat. It is almost as if the KV pairs are not 
&gt; persisting to disk at all.
&gt; 
&gt; 
&gt; From: "Matthew Von-Maszewski" 
&gt; To: "Joe Olson" 
&gt; Cc: "riak-users" , "cmancini" 
&gt; Sent: Friday, February 26, 2016 10:12:15 AM
&gt; Subject: Re: Ok, I am stumped. Losing data or riak stop
&gt; 
&gt; Joe,
&gt; 
&gt; Are there any error messages in the leveldb LOG and/or LOG.old files? These 
&gt; files are located within each vnode's directory, likely 
&gt; /var/lib/riak/data/leveldb/\\*/LOG\\* on your machine.
&gt; 
&gt; The LOG files are not to be confused with 000xxx.log files. The lower case 
&gt; \\*.log files are the recovery files that should contain the keys you are 
&gt; missing. If they are not loading properly, the LOG files should have clues.
&gt; 
&gt; Matthew
&gt; 
&gt; On Feb 26, 2016, at 11:04 AM, Christopher Mancini  &gt; wrote:
&gt; 
&gt; Hey Joe,
&gt; 
&gt; I will do my best to help, but I am not the most experienced with Riak 
&gt; operations. Your best bet to get to a solution as fast as possible is to 
&gt; include the full users group, which I have added to the recipients of this 
&gt; message.
&gt; 
&gt; 1. Are the Riak data directories within Vagrant shared directories between 
&gt; the host and guest? I have had issues with OS file system caching before when 
&gt; working with web server files.
&gt; 
&gt; 2. What version of Ubuntu are you using?
&gt; 
&gt; 3. How did you install Riak on Ubuntu?
&gt; 
&gt; 4. Have you tried restoring the original distribution riak.conf file and seen 
&gt; if the issue persists? This would help you determine if the issue is your 
&gt; config or something with your environment.
&gt; 
&gt; Chris
&gt; 
&gt; On Fri, Feb 26, 2016 at 10:55 AM Joe Olson  &gt; wrote:
&gt; 
&gt; Chris - 
&gt; 
&gt; I cannot figure out what is going on. Here is my test case. Configuration 
&gt; file attached. I am running a single node of Riak on a vagrant box with a 
&gt; level DB back end. I don't even have to bring the box down, merely stopping 
&gt; and restarting riak '(riak stop' and 'riak start' or 'risk restart) causes 
&gt; all the keys to be lost. The riak node is set up on a Vagrant box. But 
&gt; again....I do not have to bring the machine up or down to get this error.
&gt; 
&gt; I've also deleted the ring info in /var/lib/riak/ring, and deleted all the 
&gt; leveldb files. In this case, the bucket type is just n\\_val = 1, and the ring 
&gt; size is the minimum of 8. 
&gt; 
&gt; Is it possible Riak is not flushing RAM to disk after write? The keys only 
&gt; reside in RAM?
&gt; 
&gt; My test procedure:
&gt; 
&gt; ====On a remote machine=====
&gt; 
&gt; riak01@ubuntu:/etc$ curl -i http:// 
&gt; &lt;&gt;:8098/types/n1/buckets/test/keys?keys=true
&gt; HTTP/1.1 200 OK
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho)
&gt; Date: Fri, 26 Feb 2016 13:14:59 GMT
&gt; Content-Type: application/json
&gt; Content-Length: 17
&gt; 
&gt; {"keys":["test"]}
&gt; 
&gt; riak01@ubuntu:/etc$
&gt; 
&gt; 
&gt; 
&gt; ====On the single Riak node itself====
&gt; 
&gt; [vagrant@i-2016022519 -9bb5c84f riak]$ sudo riak stop
&gt; ok
&gt; [vagrant@i-2016022519 -9bb5c84f riak]$ sudo riak start
&gt; [vagrant@i-2016022519 -9bb5c84f riak]$ sudo riak ping
&gt; pong
&gt; 
&gt; 
&gt; 
&gt; ====Back to the remote machine====
&gt; 
&gt; riak01@ubuntu:/etc$ curl -i http:// 
&gt; &lt;&gt;:8098/types/n1/buckets/test/keys?keys=true
&gt; HTTP/1.1 200 OK
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho)
&gt; Date: Fri, 26 Feb 2016 13:16:34 GMT
&gt; Content-Type: application/json
&gt; Content-Length: 11
&gt; 
&gt; {"keys":[]}
&gt; 
&gt; riak01@ubuntu:/etc$
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sincerely,
&gt; 
&gt; Christopher Mancini
&gt; -----------------------------
&gt; 
&gt; employee = {
&gt; purpose: solve problems with code,
&gt; phone: 7164625591,
&gt; email: cmanc...@basho.com ,
&gt; github: http://www.github.com/christophermancini 
&gt; 
&gt; }
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

