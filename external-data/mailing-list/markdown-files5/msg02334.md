---
title: "Re: Python client performance issue"
description: ""
project: community
lastmod: 2011-02-16T02:34:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02334"
mailinglist_parent_id: "msg02322"
author_name: "Nico Meyer"
project_section: "mailinglistitem"
sent_date: 2011-02-16T02:34:24-08:00
---


Ah, I see it now. The thing is, we don't usually install libraries on
each machine manually but build Debian packages for them. In our case we
missed the automatically installed protobuf-2.3. I have to check the
difference in performance.

But back to the original problem. The other obvious culprit is the json
encoder/decoder. By default riak-client uses the built in json module,
which is also notoriously slow, especially at decoding as some sources
suggest (e.g.
http://shane.willowrise.com/archives/python-json-performance/), but I'm
to lazy to check myself right now ;-).

Since Mike uses the default of return\\_body=True for the store(), his
date has to be encoded AND decoded on every put.

Mike: can you first try to replace 'entry.store()' with
'entry.store(return\\_body=False)'? That should already be much faster. If
it is still not fast enough you can replace the default encoder/decoder
by using the client.set\\_encoder/set\\_decoder methods.

Cheers,
Nico


Am Dienstag, den 15.02.2011, 10:05 -0800 schrieb Andy Gross:
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Sorry, I should have been more clear. The Python client depends on
&gt; "protobuf&gt;=2.3.0" in setup.py, so people are already most likely using
&gt; protobufs-2.3.0.
&gt; 
&gt; 
&gt; - Andy
&gt; 
&gt; On Tuesday, February 15, 2011 at 3:09 AM, Nico Meyer wrote:
&gt; 
&gt; &gt; Hi Andy.
&gt; &gt; 
&gt; &gt; I am not quite sure what you mean, is the protobuf library included
&gt; &gt; with
&gt; &gt; riak-python-client? Or are you talking about the version of the
&gt; &gt; protobuf
&gt; &gt; compiler that was used to create riakclient\\_pb2.py from 
&gt; &gt; riakclient.proto?
&gt; &gt; 
&gt; &gt; Cheers,
&gt; &gt; Nico
&gt; &gt; 
&gt; &gt; Am Dienstag, den 15.02.2011, 02:23 -0800 schrieb Andy Gross:
&gt; &gt; &gt; python-riak-client already uses version 2.3.0. Adventurous types
&gt; &gt; &gt; might want to check out https://github.com/Greplin/fast-python-pb,
&gt; &gt; &gt; which wraps the C/C++ protocol buffers library. 
&gt; &gt; &gt; 
&gt; &gt; &gt; -- 
&gt; &gt; &gt; Andy Gross
&gt; &gt; &gt; Principal Architect
&gt; &gt; &gt; Basho Technologies, Inc.




\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

