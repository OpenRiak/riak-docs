---
title: "Re: RiakError: timeout"
description: ""
project: community
lastmod: 2014-03-18T07:08:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13834"
mailinglist_parent_id: "msg13832"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2014-03-18T07:08:09-07:00
---


An explicit RiakError with 'timeout' as the string usually indicates that
the server replied with that text in the response. You might need to check
that the node(s) you are connected to aren't overloaded or having other
issues. You can also make the timeout higher than the default 60sec by
passing a number in milliseconds (or the string 'infinity' to disable the
timeout).


On Tue, Mar 18, 2014 at 7:30 AM, Ciprian Manea  wrote:

&gt; Hi Massimiliano,
&gt;
&gt; As a first step I would recommend setting pb\\_backlog to 64 or 128 in your
&gt; app.config
&gt;
&gt; How are you distributing the load from your python clients to the Riak
&gt; cluster? Is every python client connecting directly to one Riak node or do
&gt; you have a pool of Riak servers configured in each client?
&gt;
&gt;
&gt; Thanks,
&gt; Ciprian
&gt;
&gt;
&gt; On Tue, Mar 18, 2014 at 8:49 AM, Massimiliano Ciancio &lt;
&gt; massimili...@ciancio.net&gt; wrote:
&gt;
&gt;&gt; I tried to raise each param in sysctl.con (now the configuration is a
&gt;&gt; bit strange with all that 9s :-)
&gt;&gt; But I still get many "RiakError: timeout" :(
&gt;&gt; Have you any suggestion, please?
&gt;&gt; Thanks in advance
&gt;&gt; Massimiliano
&gt;&gt;
&gt;&gt; fs.file-max = 999999
&gt;&gt; vm.swappiness = 0
&gt;&gt; net.ipv4.tcp\\_max\\_syn\\_backlog = 999999
&gt;&gt; net.core.somaxconn = 999999
&gt;&gt; net.ipv4.tcp\\_timestamps = 0
&gt;&gt; net.ipv4.tcp\\_sack = 1
&gt;&gt; net.ipv4.tcp\\_window\\_scaling = 1
&gt;&gt; net.ipv4.tcp\\_fin\\_timeout = 15
&gt;&gt; net.ipv4.tcp\\_keepalive\\_intvl = 30
&gt;&gt; net.ipv4.tcp\\_tw\\_reuse = 1
&gt;&gt; net.ipv4.tcp\\_tw\\_recycle = 1
&gt;&gt; vm.max\\_map\\_count = 32000000
&gt;&gt; net.core.rmem\\_default = 8388608
&gt;&gt; net.core.rmem\\_max = 8388608
&gt;&gt; net.core.wmem\\_default = 8388608
&gt;&gt; net.core.wmem\\_max = 8388608
&gt;&gt; net.core.netdev\\_max\\_backlog = 999999
&gt;&gt;
&gt;&gt; 2014-03-17 21:15 GMT+01:00 Michael Dillon :
&gt;&gt; &gt; On the server which is sending write requests to the Riak cluster, you
&gt;&gt; may
&gt;&gt; &gt; have run into some network limits, possibly max sockets or one of the
&gt;&gt; &gt; network buffer settings. I would try to tune your kernel for a high
&gt;&gt; level of
&gt;&gt; &gt; network traffic and try again. Or just split your load across more than
&gt;&gt; one
&gt;&gt; &gt; server.
&gt;&gt; &gt;
&gt;&gt; &gt; If you are going to have very high loads of requests going to a Riak
&gt;&gt; cluster
&gt;&gt; &gt; it is a good idea to put a load balancer in front of it so that you
&gt;&gt; spread
&gt;&gt; &gt; the requests across nodes in the cluster. Riak's clustering only
&gt;&gt; distributes
&gt;&gt; &gt; work AFTER Riak receives the requests. If you sent all your Riak
&gt;&gt; requests to
&gt;&gt; &gt; just one member of the cluster, then you can potentially create an
&gt;&gt; incoming
&gt;&gt; &gt; network bottleneck on that server.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On Mon, Mar 17, 2014 at 11:34 AM, Massimiliano Ciancio
&gt;&gt; &gt;  wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Hi list,
&gt;&gt; &gt;&gt; I'm in troubles...
&gt;&gt; &gt;&gt; I'm getting many timeout errors from Riak (see traceback at end of
&gt;&gt; mail).
&gt;&gt; &gt;&gt; I'm using a 5 node Debian cluster. Riak version is 1.4.8. Riak Python
&gt;&gt; &gt;&gt; client is installed with 'pip install riak' and is up to date.
&gt;&gt; &gt;&gt; The errors come from different processes on the same machine trying to
&gt;&gt; &gt;&gt; write intensively on Riak, using each one their own connection.
&gt;&gt; &gt;&gt; The errors start after some time the processes are running.
&gt;&gt; &gt;&gt; What can I check?
&gt;&gt; &gt;&gt; Thanks in advance
&gt;&gt; &gt;&gt; Massimiliano
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Traceback (most recent call last):
&gt;&gt; &gt;&gt; ...
&gt;&gt; &gt;&gt; File "/usr/local/lib/python2.7/dist-packages/riak/bucket.py", line
&gt;&gt; &gt;&gt; 206, in get
&gt;&gt; &gt;&gt; return obj.reload(r=r, pr=pr, timeout=timeout)
&gt;&gt; &gt;&gt; File "/usr/local/lib/python2.7/dist-packages/riak/riak\\_object.py",
&gt;&gt; &gt;&gt; line 307, in reload
&gt;&gt; &gt;&gt; self.client.get(self, r=r, pr=pr, timeout=timeout)
&gt;&gt; &gt;&gt; File
&gt;&gt; "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py",
&gt;&gt; &gt;&gt; line 127, in wrapper
&gt;&gt; &gt;&gt; return self.\\_with\\_retries(pool, thunk)
&gt;&gt; &gt;&gt; File
&gt;&gt; "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py",
&gt;&gt; &gt;&gt; line 69, in \\_with\\_retries
&gt;&gt; &gt;&gt; return fn(transport)
&gt;&gt; &gt;&gt; File
&gt;&gt; "/usr/local/lib/python2.7/dist-packages/riak/client/transport.py",
&gt;&gt; &gt;&gt; line 125, in thunk
&gt;&gt; &gt;&gt; return fn(self, transport, \\*args, \\*\\*kwargs)
&gt;&gt; &gt;&gt; File
&gt;&gt; "/usr/local/lib/python2.7/dist-packages/riak/client/operations.py",
&gt;&gt; &gt;&gt; line 333, in get
&gt;&gt; &gt;&gt; return transport.get(robj, r=r, pr=pr, timeout=timeout)
&gt;&gt; &gt;&gt; File
&gt;&gt; &gt;&gt;
&gt;&gt; "/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/transport.py",
&gt;&gt; &gt;&gt; line 146, in get
&gt;&gt; &gt;&gt; MSG\\_CODE\\_GET\\_RESP)
&gt;&gt; &gt;&gt; File
&gt;&gt; &gt;&gt;
&gt;&gt; "/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/connection.py",
&gt;&gt; &gt;&gt; line 43, in \\_request
&gt;&gt; &gt;&gt; return self.\\_recv\\_msg(expect)
&gt;&gt; &gt;&gt; File
&gt;&gt; &gt;&gt;
&gt;&gt; "/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/connection.py",
&gt;&gt; &gt;&gt; line 55, in \\_recv\\_msg
&gt;&gt; &gt;&gt; raise RiakError(err.errmsg)
&gt;&gt; &gt;&gt; RiakError: 'timeout'
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; --
&gt;&gt; &gt; PageFreezer.com
&gt;&gt; &gt; #200 - 311 Water Street
&gt;&gt; &gt; Vancouver, BC V6B 1B8
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

