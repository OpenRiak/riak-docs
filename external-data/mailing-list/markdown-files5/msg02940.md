---
title: "Re: Store() Performance"
description: ""
project: community
lastmod: 2011-04-08T11:11:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02940"
mailinglist_parent_id: "msg02939"
author_name: "Kev Burns"
project_section: "mailinglistitem"
sent_date: 2011-04-08T11:11:52-07:00
---


Gui,

I was talking to Andy Gross at a drinkup last month and he told me about a
config var which might help speed up your import.
http://wiki.basho.com/Configuration-Files.html#disable\\_http\\_nagle

&gt; disable\\_http\\_nagle
&gt;
&gt; When set to true, this option will disable the Nagle buffering algorithm
&gt; for HTTP traffic. This is equivalent to setting the TCP\\_NODELAY option on
&gt; the HTTP socket. The setting defaults to false. If you experience
&gt; consistent minimum latencies in multiples of 20 milliseconds, setting this
&gt; option to true may reduce latency.
&gt;
So the way I understand it, by default Riak waits for a few ms after
receiving an HTTP request to see if there are any more requests right behind
it so that it can roll them up and processes them as a batch. Given that
you're running 1 import script, you've only got 1 process throwing things
into Riak so disabling this flag may speed you up considerably.

You might also consider breaking the file into chunks and running multiple
import scripts concurrently.

And lastly if you don't already have HAproxy or something similar to
distribute reads/writes evenly across your cluster, that's definitely
something you'll want to set up.

- Kev
c: +001 (650) 521-7791


On Fri, Apr 8, 2011 at 9:32 AM, Gui Pinto  wrote:

&gt; Awesome..
&gt; I'll quickly hack out what I need for the quick import, and hope you can
&gt; release your re-write.
&gt;
&gt;
&gt; Gui Pinto
&gt; Software Engineer at Chitika
&gt;
&gt;
&gt; On Fri, Apr 8, 2011 at 12:26 PM, Mark Steele wrote:
&gt;
&gt;&gt; I've re-written the php library to use keep alives (and various other
&gt;&gt; tweaks). Let me see what I can do about releasing the code.
&gt;&gt;
&gt;&gt; The current php library simply instantiates a new curl instance for each
&gt;&gt; request, making it less than optimal.
&gt;&gt;
&gt;&gt; Mark Steele
&gt;&gt; Bering Media Inc.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Apr 8, 2011 at 12:23 PM, Gui Pinto  wrote:
&gt;&gt;
&gt;&gt;&gt; Hey Everyone, thanks for all of the recommendations.
&gt;&gt;&gt;
&gt;&gt;&gt; I've tried importing using the example load\\_data 
&gt;&gt;&gt; scriptavailable
&gt;&gt;&gt; on the Fast Track, and have last tried the PHP library.
&gt;&gt;&gt;
&gt;&gt;&gt; Both of these execute a straight-foward CURL -X PUT request.. which makes
&gt;&gt;&gt; me think Mark might have just guessed it..
&gt;&gt;&gt; Keep-alive not being used definitely explains the 200-writes/second cap.
&gt;&gt;&gt;
&gt;&gt;&gt; I'm going to take a look into the PHP library and test this theory.
&gt;&gt;&gt;
&gt;&gt;&gt; Gui Pinto
&gt;&gt;&gt; Software Engineer at Chitika
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Apr 8, 2011 at 10:01 AM, Mark Steele wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If using HTTP, make sure you're using keep-alives. That will be a
&gt;&gt;&gt;&gt; gigantic speed boost.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The protocol buffer API is much faster if you're client language
&gt;&gt;&gt;&gt; supports it.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Mark Steele
&gt;&gt;&gt;&gt; Bering Media Inc.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Apr 7, 2011 at 10:58 PM, matthew hawthorne &lt;
&gt;&gt;&gt;&gt; mhawtho...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi Gui,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I recently pushed 70 million records of size 1K each into a 5-node
&gt;&gt;&gt;&gt;&gt; Riak cluster (which was replicating to another 5-node cluster) at
&gt;&gt;&gt;&gt;&gt; around 1000 writes/second using basho\\_bench and the REST interface. I
&gt;&gt;&gt;&gt;&gt; probably could have pushed it further, but I wanted to confirm that it
&gt;&gt;&gt;&gt;&gt; could maintain the load for the entire data set, which it did.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; My point being that your speed-limit of 200 writes/second is likely
&gt;&gt;&gt;&gt;&gt; specific to your configuration.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I wonder:
&gt;&gt;&gt;&gt;&gt; 1) what's your average write latency?
&gt;&gt;&gt;&gt;&gt; 2) how big is your connection pool?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Because it's possible that you don't have enough connections available
&gt;&gt;&gt;&gt;&gt; to handle your desired load.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; -matt
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Thu, Apr 7, 2011 at 6:01 PM, Gui Pinto  wrote:
&gt;&gt;&gt;&gt;&gt; &gt; Hey guys,
&gt;&gt;&gt;&gt;&gt; &gt; I'm attempting to importing 300M+ objects into a Riak cluster, but
&gt;&gt;&gt;&gt;&gt; have
&gt;&gt;&gt;&gt;&gt; &gt; quickly reached the REST API's speed-limit at 200-store()'s per
&gt;&gt;&gt;&gt;&gt; second..
&gt;&gt;&gt;&gt;&gt; &gt; At the rate of 200/s, I'm looking at 20-days to import this data set!
&gt;&gt;&gt;&gt;&gt; That
&gt;&gt;&gt;&gt;&gt; &gt; can't be the fastest method to do this..
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; Any recommendations?
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; Thanks!
&gt;&gt;&gt;&gt;&gt; &gt; Gui Pinto
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

