---
title: "Re: Performance Issues with LevelDB Backend on 1.0.0RC1"
description: ""
project: community
lastmod: 2011-09-26T11:45:57-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04882"
mailinglist_parent_id: "msg04880"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-09-26T11:45:57-07:00
---


Hi JB,

The gossip crashes you are seeing are the result in some changes to the way
gossiping takes place. There can be a spike in gossip requests around
transfer at the moment. The next RC should have a change to mitigate it if
we can get it reviewed in time. I didn't see any errors related to leveldb
in there.

Jon Meredith
Basho Technologies.

On Mon, Sep 26, 2011 at 12:37 PM, JB Smith  wrote:

&gt; We are seeing similar issues using levelDB with 1.0.0RC1
&gt;
&gt; We run a 6 way cluster on EC2 64bit micro instances.
&gt;
&gt; Initially we had assumed that there may be some issue with small memory
&gt; environments.
&gt;
&gt; on 0.14.2 things would seem to balance out and stabilize.
&gt;
&gt; on 1.0.0RC1, once this sort of report starts showing up, it tends to run
&gt; out of control until the node crashes.
&gt;
&gt; We also use a multi backend configuration as follows:
&gt;
&gt; {storage\\_backend, riak\\_kv\\_multi\\_backend},
&gt; {multi\\_backend\\_default, &lt;&lt;"eleveldb"&gt;&gt;},
&gt; {multi\\_backend, [
&gt; {&lt;&lt;"eleveldb"&gt;&gt;, riak\\_kv\\_eleveldb\\_backend, []},
&gt; {&lt;&lt;"sessions"&gt;&gt;, riak\\_kv\\_bitcask\\_backend, [
&gt; {expiry\\_secs, 7200},
&gt; {data\\_root, "/riak/data/bitcask\\_sessions"}]}
&gt; ]},
&gt;
&gt; We are now storing over 150,000 keys in the levelDB buckets
&gt;
&gt; 17:17:03.282 [error] CRASH REPORT Process [] with 0 neighbours crashed with
&gt; reason:
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,122743301572712549771012593372656581728916209664,'
&gt; riak...@riak004.xx.com','riak...@riak005.xx.com',riak\\_pipe\\_vnode}]}}
&gt; 17:17:04.299 [error] Supervisor riak\\_core\\_vnode\\_sup had child undefined
&gt; started with {riak\\_core\\_vnode,start\\_link,undefined} at &lt;0.16220.0&gt; exit with
&gt; reason
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,122743301572712549771012593372656581728916209664,'
&gt; riak...@riak004.xx.com','riak...@riak005.xx.com',riak\\_pipe\\_vnode}]}} in
&gt; context child\\_terminated
&gt; 17:17:05.814 [info] monitor long\\_gc &lt;0.44.0&gt;
&gt; [{name,lager\\_crash\\_log},{initial\\_call,{lager\\_crash\\_log,init,1}},{almost\\_current\\_function,{gen,do\\_call,4}}]
&gt; [{timeout,1501},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,1597},{mbuf\\_size,0},{stack\\_size,285},{old\\_heap\\_size,0},{heap\\_size,1179}]
&gt; 17:17:07.349 [error] gen\\_fsm &lt;0.16589.0&gt; in state active terminated with
&gt; reason:
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,161992613122126446500115457532517697979441741824,'
&gt; riak...@riak004.xx.com','riak...@riak006.xx.com',riak\\_pipe\\_vnode}]}}
&gt; 17:17:07.351 [info] monitor long\\_gc &lt;0.101.0&gt;
&gt; [{name,riak\\_core\\_ring\\_manager},{initial\\_call,{gen,init\\_it,7}},{almost\\_current\\_function,{erl\\_syntax,is\\_tree,1}}]
&gt; [{timeout,1510},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,317811},{mbuf\\_size,0},{stack\\_size,2363},{old\\_heap\\_size,0},{heap\\_size,275697}]
&gt; 17:17:10.345 [error] CRASH REPORT Process [] with 0 neighbours crashed with
&gt; reason:
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,161992613122126446500115457532517697979441741824,'
&gt; riak...@riak004.xx.com','riak...@riak006.xx.com',riak\\_pipe\\_vnode}]}}
&gt; 17:17:10.348 [info] monitor long\\_gc &lt;0.17891.0&gt;
&gt; [{initial\\_call,{erlang,apply,2}},{almost\\_current\\_function,{erl\\_scan,set\\_attribute,3}}]
&gt; [{timeout,1481},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,121393},{mbuf\\_size,0},{stack\\_size,99},{old\\_heap\\_size,0},{heap\\_size,116704}]
&gt; 17:17:11.847 [error] gen\\_server &lt;0.16590.0&gt; terminated with reason:
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,161992613122126446500115457532517697979441741824,'
&gt; riak...@riak004.xx.com','riak...@riak006.xx.com',riak\\_pipe\\_vnode}]}}
&gt; 17:17:13.339 [info] monitor long\\_gc &lt;0.17891.0&gt;
&gt; [{initial\\_call,{erlang,apply,2}},{almost\\_current\\_function,{erl\\_expand\\_records,expr,2}}]
&gt; [{timeout,1473},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,317811},{mbuf\\_size,0},{stack\\_size,1364},{old\\_heap\\_size,0},{heap\\_size,151085}]
&gt; 17:17:13.342 [error] CRASH REPORT Process [] with 0 neighbours crashed with
&gt; reason:
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,161992613122126446500115457532517697979441741824,'
&gt; riak...@riak004.xx.com','riak...@riak006.xx.com',riak\\_pipe\\_vnode}]}}
&gt; 17:17:14.842 [error] Supervisor riak\\_core\\_vnode\\_sup had child undefined
&gt; started with {riak\\_core\\_vnode,start\\_link,undefined} at &lt;0.16589.0&gt; exit with
&gt; reason
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,161992613122126446500115457532517697979441741824,'
&gt; riak...@riak004.xx.com','riak...@riak006.xx.com',riak\\_pipe\\_vnode}]}} in
&gt; context child\\_terminated
&gt; 17:17:14.857 [error] gen\\_fsm &lt;0.15083.0&gt; in state active terminated with
&gt; reason:
&gt; {timeout,{gen\\_server,call,[riak\\_core\\_gossip,{finish\\_handoff,72076008481650973993443441457199504387328704512,'
&gt; riak...@riak004.xx.com','riak...@riak006.xx.com',riak\\_kv\\_vnode}]}}
&gt; 17:17:16.338 [info] monitor long\\_gc &lt;0.17891.0&gt;
&gt; [{initial\\_call,{erlang,apply,2}},{almost\\_current\\_function,{zlib,deflateInit,2}}]
&gt; [{timeout,1470},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,75025},{mbuf\\_size,0},{stack\\_size,34},{old\\_heap\\_size,0},{heap\\_size,36434}]
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

