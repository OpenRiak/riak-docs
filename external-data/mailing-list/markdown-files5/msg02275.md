---
title: "Re: Schema Architecture, Map Reduce & Key Lists"
description: ""
project: community
lastmod: 2011-02-10T14:59:01-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02275"
mailinglist_parent_id: "msg02270"
author_name: "Mat Ellis"
project_section: "mailinglistitem"
sent_date: 2011-02-10T14:59:01-08:00
---


Thanks Bryan, that certainly looks interesting. The clicks are amended but just 
once and only a tiny percentage (when they convert). We're basically doing what 
you describe: taking a click stream and processing it once into a set of 
summary tables for reporting & decision making. We'll take a look at it as soon 
as we've finished getting our head around the Ripple goodness.

Cheers

M.

On Feb 10, 2011, at 11:54 AM, Bryan Fink wrote:

&gt; On Thu, Feb 10, 2011 at 12:35 PM, Mat Ellis  wrote:
&gt;&gt; We are converting a mysql based schema to Riak using Ripple. We're tracking
&gt;&gt; a lot of clicks, and each click belongs to a cascade of other objects:
&gt;&gt; click -&gt; placement -&gt; campaign -&gt; customer
&gt;&gt; i.e. we do a lot of operations on these clicks grouped by placement or sets
&gt;&gt; of placements.
&gt; … snip …
&gt;&gt; On a related noob-note, what would be the best way of creating a set of the
&gt;&gt; clicks for a given placement? Map Reduce or Riak Search or some other
&gt;&gt; method?
&gt; 
&gt; Hi, Mat. I have an alternative strategy I think you could try if
&gt; you're up for stepping outside of the Ripple interface. Your incoming
&gt; clicks reminded me of other stream data I've processed before, so the
&gt; basic idea is to store clicks as a stream, and then process that
&gt; stream later. The tools I'd use to do this are Luwak[1] and
&gt; luwak\\_mr[2].
&gt; 
&gt; First, store all clicks, as they arrive, in one Luwak file (or maybe
&gt; one Luwak file per host accepting clicks, depending on your service's
&gt; arrangement). Luwak has a streaming interface that's available
&gt; natively in distributed Erlang, or over HTTP by exploiting the
&gt; "chunked" encoding type. Roll over to a new file on whatever
&gt; convenient trigger you like (time period, timeout, manual
&gt; intervention, etc.).
&gt; 
&gt; Next, use map/reduce to process the stream. The luwak\\_mr utility will
&gt; allow you to specify a Luwak file by name, and it will handle toss
&gt; each of the chunks of that file to various cluster nodes for
&gt; processing. The first stage of your map/reduce query just needs to be
&gt; able to handle any single chunk of the file.
&gt; 
&gt; I've posted a few examples about how to use the luwak\\_mr
&gt; utility.[3][4][5] They deal with analyzing events in baseball games
&gt; (another sort of stream of events).
&gt; 
&gt; Pros:
&gt; - No need to list keys.
&gt; - The time to process a day's data should be proportional to the
&gt; number of clicks on that day (i.e. proportional to the size of the
&gt; file).
&gt; 
&gt; Caveats:
&gt; - Luwak works best with write-once data. Modifying a block of a
&gt; Luwak file after it has been written causes the block to be copied,
&gt; and the old version of the block is not deleted. (Even if some of
&gt; your data is modification-heavy, this might work for the non-modified
&gt; parts … like the key list for a day's clicks?)
&gt; - I don't have good numbers for Luwak's speed/efficiency.
&gt; - I've only recently started experimenting with Luwak in this
&gt; map/reducing manner, so I'm not sure if there are other pitfalls.
&gt; 
&gt; [1] http://wiki.basho.com/Luwak.html
&gt; [2] http://contrib.basho.com/luwak\\_mr.html
&gt; [3] http://blog.beerriot.com/2011/01/16/mapreducing-luwak/
&gt; [4] 
&gt; http://blog.basho.com/2011/01/20/baseball-batting-average%2c-using-riak-map/reduce/
&gt; [5] http://blog.basho.com/2011/01/26/fixing-the-count/


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

