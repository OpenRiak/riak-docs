---
title: "Re: using 2i with protocol buffers"
description: ""
project: community
lastmod: 2013-07-19T01:25:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11623"
mailinglist_parent_id: "msg11618"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-07-19T01:25:43-07:00
---


Hi Joey,

When using secondary indexes the index names must end in either `\\_int` for 
integer indexes or `\\_bin` for binary indexes in order for them to be recognised 
by the system [1]. All indexes must be set when you write the objects.

You must also ensure that the bucket you are writing the objects to are using 
either the memory or leveldb backends as bitcask does not support secondary 
indexes. Can you verify that this is the case? Are there any error messages in 
the logs?

Which exact client version are you using?

[1] 
http://docs.basho.com/riak/latest/cookbooks/Secondary-Indexes---Configuration/

Best regards,

Christian



On 19 Jul 2013, at 07:09, Joey Yandle  wrote:

&gt; Hi everbody,
&gt; 
&gt; I'm using riak to store large numbers of FX rates, to allow for deep
&gt; backtests of trading strategies. My code seems to be working, except
&gt; that I don't get any keys back from 2i range requests.
&gt; 
&gt; Here's the code which puts the rate into riak (the rate is itself a
&gt; protocol buffers object):
&gt; 
&gt; std::string s = p-&gt;rate().time();
&gt; std::string rate;
&gt; p-&gt;rate().SerializeToString(&rate);
&gt; 
&gt; mrx::riak::RpbPutReqPtr req(new mrx::riak::RpbPutReq());
&gt; 
&gt; req-&gt;set\\_bucket(symbol);
&gt; req-&gt;set\\_key(s);
&gt; 
&gt; mrx::riak::RpbContent\\* content = req-&gt;mutable\\_content();
&gt; 
&gt; content-&gt;set\\_value(rate);
&gt; 
&gt; mrx::riak::RpbPair\\* index = content-&gt;add\\_indexes();
&gt; 
&gt; index-&gt;set\\_key(vm["riak.index"].as());
&gt; index-&gt;set\\_value(s);
&gt; 
&gt; Here's the code which does the index search:
&gt; 
&gt; mrx::riak::RpbIndexReqPtr req(new mrx::riak::RpbIndexReq());
&gt; 
&gt; req-&gt;set\\_bucket(symbol);
&gt; req-&gt;set\\_index(vm["riak.index"].as());
&gt; req-&gt;set\\_qtype(mrx::riak::RpbIndexReq::range);
&gt; 
&gt; req-&gt;set\\_range\\_min(vm["rates.start"].as());
&gt; req-&gt;set\\_range\\_max(vm["rates.end"].as());
&gt; 
&gt; I originally used the string "time" as the index key, and there was no
&gt; error when doing the put command. However, when trying to search with
&gt; this index, I got the following error:
&gt; 
&gt; [{unknown\\_field\\_type,&lt;&lt;"time"&gt;&gt;}]
&gt; 
&gt; This error went away when I used "time\\_bin" as the index. However,
&gt; regardless of what I use as the index key when doing the put, I never
&gt; get any keys returned during the search.
&gt; 
&gt; Can someone point me to a working example of using protocol buffers to
&gt; do a put and subsequent index search? The examples online only show the
&gt; latter.
&gt; 
&gt; thanks,
&gt; 
&gt; Joey
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

