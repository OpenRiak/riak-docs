---
title: "Re: Maps with multiple buckets"
description: ""
project: community
lastmod: 2013-12-18T14:25:13-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13296"
mailinglist_parent_id: "msg13295"
author_name: "John Daily"
project_section: "mailinglistitem"
sent_date: 2013-12-18T14:25:13-08:00
---


Alex Moore and I provided some general time series advice and links on 
StackOverflow recently: 
http://stackoverflow.com/questions/19384686/what-is-the-most-efficient-way-to-store-time-series-in-riak-with-heavy-reads

Broadly speaking, issuing dynamic queries via MapReduce is going to be less 
desirable than building responses to the questions you’re going to ask later, 
as the data arrives. As you’ve already seen, writing MapReduce queries is 
rather painful, and Riak’s max performance/availability/scalability is achieved 
when serving key/value requests.

-John


On Dec 18, 2013, at 5:02 PM, Bryce Verdier  wrote:

&gt; So in playing with things a little bit, I don't think that this list of 
&gt; bucket-key pairs is going to work for me.
&gt; 
&gt; I'm using riak counters to keep tabs of various customers ID's as they travel 
&gt; through our system. So when Bob first shows up, he's seen by one set of 
&gt; servers. Adding 1 to the counter for Bob within some bucket. When he 
&gt; interacts with us, we'll see Bob again in another service. And thus add 1 to 
&gt; another counter for Bob within another bucket.
&gt; 
&gt; so:
&gt; buckets/initial/counters/Bob =&gt; 1
&gt; and:
&gt; buckets/interact/counters/Bob =&gt; 1
&gt; 
&gt; Currently I'm using 2 MR queries to get the list of counts for all customers 
&gt; from both buckets and combine these data sets within the client. I'm trying 
&gt; to see if its possible to do this within 1 query. Maybe return something like:
&gt; {"Bob": [1,1]}
&gt; in json.
&gt; 
&gt; I know that riak\\_kv\\_counter:value() requires a RiakObject to get the data. I 
&gt; the case of a MR I know the key and that its in another bucket. Is it 
&gt; possible to get the RiakObject based on those two items?
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On 12/17/2013 05:09 PM, Jeremiah Peschka wrote:
&gt;&gt; The allowable inputs to an MR map phase include a list of bucket key pairs. 
&gt;&gt; If you know your keys in advance the problem is solved.
&gt;&gt; 
&gt;&gt; Can you describe a bit more about how you're using MR? Is this an ad hoc 
&gt;&gt; query? A predictable report? Time based?
&gt;&gt; 
&gt;&gt; ---
&gt;&gt; sent from a tiny portion of the hive mind...
&gt;&gt; in this case, a phone
&gt;&gt; 
&gt;&gt; On Dec 17, 2013 4:51 PM, "Bryce Verdier"  wrote:
&gt;&gt; Hi All,
&gt;&gt; 
&gt;&gt; I have a question concerning map-reduce. I have two buckets with counters 
&gt;&gt; enabled that have similar keys to track two different metrics. At the moment 
&gt;&gt; in order to combine these two datasets together I have to make 2 different 
&gt;&gt; map-reduce queries and combine the data within the client. I'm wondering 
&gt;&gt; if/how it might be possible to combine both of these queries into one. I'm 
&gt;&gt; thinking that Links are a possibility, but I'm not sure if it would or how 
&gt;&gt; viable a solution it would be.
&gt;&gt; 
&gt;&gt; Any and all advice is welcomed.
&gt;&gt; 
&gt;&gt; Thanks in advance,
&gt;&gt; Bryce
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

