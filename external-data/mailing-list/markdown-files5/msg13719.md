---
title: "Re: 1.4.8 problem with Bitcask merges"
description: ""
project: community
lastmod: 2014-02-26T22:00:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13719"
mailinglist_parent_id: "msg13718"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2014-02-26T22:00:07-08:00
---


Looking over the changes from 1.4.7 -&gt; 1.4.8 I don't see any changes
that would be likely to affect merges.

It it possible that it's been happening for longer?

Can you give a rough description of your workload so I can make a
start on reproducing the issue tomorrow?

On Wed, Feb 26, 2014 at 7:52 PM, John Welter  wrote:
&gt; Hi everyone,
&gt;
&gt; Upgraded to 1.4.8 and got into some issues with AAE overloading our vnodes. 
&gt; We've worked around that.
&gt;
&gt; But now we're seeing a merge issue manifest itself since we are into our 
&gt; nightly merge window.
&gt;
&gt; I see several vnodes on multiple nodes with similar in the logs:
&gt;
&gt; 2014-02-26 20:27:39.736 [info] &lt;0.1040.0&gt; 
&gt; "/var/lib/riak/bitcask/639406966332270026714112114313373821099470487552" 
&gt; needs\\_merge: []
&gt; 2014-02-26 20:27:39.736 [info] &lt;0.29858.20&gt; Merged {[],[]} in 1.0e-6 seconds.
&gt; 2014-02-26 20:30:39.739 [info] &lt;0.1040.0&gt; 
&gt; "/var/lib/riak/bitcask/639406966332270026714112114313373821099470487552" 
&gt; needs\\_merge: []
&gt; 2014-02-26 20:30:39.739 [info] &lt;0.32391.20&gt; Merged {[],[]} in 2.0e-6 seconds.
&gt; 2014-02-26 20:33:39.742 [info] &lt;0.1040.0&gt; 
&gt; "/var/lib/riak/bitcask/639406966332270026714112114313373821099470487552" 
&gt; needs\\_merge: []
&gt; 2014-02-26 20:33:39.742 [info] &lt;0.2113.21&gt; Merged {[],[]} in 1.0e-6 seconds.
&gt; 2014-02-26 20:36:39.744 [info] &lt;0.1040.0&gt; 
&gt; "/var/lib/riak/bitcask/639406966332270026714112114313373821099470487552" 
&gt; needs\\_merge: []
&gt; 2014-02-26 20:36:39.744 [info] &lt;0.4756.21&gt; Merged {[],[]} in 1.0e-6 seconds.
&gt; 2014-02-26 20:39:39.746 [info] &lt;0.1040.0&gt; 
&gt; "/var/lib/riak/bitcask/639406966332270026714112114313373821099470487552" 
&gt; needs\\_merge: []
&gt; 2014-02-26 20:39:39.746 [info] &lt;0.7288.21&gt; Merged {[],[]} in 1.0e-6 seconds.
&gt;
&gt; Looking at that vnodes bit cask folder:
&gt;
&gt; root@app25u:/var/lib/riak/bitcask/639406966332270026714112114313373821099470487552#
&gt; ls -ltrh
&gt; total 7.3G
&gt; -rw-rw-r-- 1 riak riak 499M Jun 22 2013 2.bitcask.data
&gt; -rw-rw-r-- 1 riak riak 2.4M Jun 22 2013 2.bitcask.hint
&gt; -rw-rw-r-- 1 riak riak 43K Oct 3 11:25 9.bitcask.hint
&gt; -rw-rw-r-- 1 riak riak 15M Oct 3 11:25 9.bitcask.data
&gt; -rw-rw-r-- 1 riak riak 51M Oct 6 19:35 12.bitcask.data
&gt; -rw-rw-r-- 1 riak riak 129K Oct 6 20:49 12.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 121M Dec 23 20:56 15.bitcask.data
&gt; -rw-r--r-- 1 riak riak 301K Dec 23 21:19 15.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 804K Feb 5 12:41 17.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 304M Feb 5 12:41 17.bitcask.data
&gt; -rw-r--r-- 1 riak riak 2.0G Feb 5 12:42 18.bitcask.data
&gt; -rw-r--r-- 1 riak riak 5.0M Feb 5 12:42 18.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 2.0G Feb 5 12:43 20.bitcask.data
&gt; -rw-r--r-- 1 riak riak 5.1M Feb 5 12:43 20.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 1.7G Feb 5 12:43 22.bitcask.data
&gt; -rw-r--r-- 1 riak riak 8.7M Feb 5 12:43 22.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 495M Feb 23 17:30 77.bitcask.data
&gt; -rw-r--r-- 1 riak riak 1.5M Feb 23 17:34 77.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 71M Feb 26 09:05 78.bitcask.data
&gt; -rw-r--r-- 1 riak riak 194K Feb 26 09:06 78.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 13M Feb 26 18:05 80.bitcask.data
&gt; -rw-r--r-- 1 riak riak 33K Feb 26 18:05 80.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 75K Feb 26 18:32 79.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 28M Feb 26 18:32 79.bitcask.data
&gt; -rw------- 1 riak riak 93 Feb 26 18:32 bitcask.write.lock
&gt; -rw-r--r-- 1 riak riak 1.7K Feb 26 20:45 81.bitcask.hint
&gt; -rw-r--r-- 1 riak riak 667K Feb 26 20:45 81.bitcask.data
&gt;
&gt; We're starting riak via the /etc/init.d/riak script and have a 
&gt; /etc/default/riak file with ulimit -n 65535 in it so open files should not be 
&gt; an issue (and have not been previously with 1.4.7 and earlier).
&gt;
&gt; Any suggestions?
&gt;
&gt; Thanks,
&gt;
&gt; John
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

