---
title: "Re: riak search and basic write operations"
description: ""
project: community
lastmod: 2012-10-02T15:24:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08794"
author_name: "Brian Roach"
project_section: "mailinglistitem"
sent_date: 2012-10-02T15:24:34-07:00
---


Greetings!

First and foremost, search and secondary indexes (2i) are not the same thing.

You need to enable 2i and use the ELevelDB backend as described here:
http://wiki.basho.com/Secondary-Indexes---Configuration-and-Examples.html

Secondly, the default Converter (JSONConverter) in the Java client
does support serializing/deserializing of secondary indexes. The page
you link to in the cookbook is demonstrating how to write your own
custom converter (for something other than JSON), and its first
example does not support them.

Enable 2i in Riak, annotate your POJO as you have, and use the default
Converter and you should be fine; nothing else is needed.

On Tue, Oct 2, 2012 at 4:03 PM, kamiseq  wrote:
&gt; hej I am a bit confused about search functionality and basic
&gt; read/write operations.
&gt;
&gt; Im using recent (1.0.6) java client and pb cluster riak client. just
&gt; for testing Im only using two local machines joined into one cluster.
&gt; storing and reading objects works fine with key(let say I have users
&gt; bucket and I generate id from timestamp).
&gt;
&gt; but
&gt; 1. I cannot fetch objects using rest client in firefox after I store
&gt; objects using java client (I ll check with curl) but I can query for
&gt; keys in bucket (http://192.168.0.121:8098/riak/users/?keys=true&props=false).
&gt; 2. I followed 
&gt; https://github.com/basho/riak-java-client/wiki/Using-a-custom-Converter
&gt; and I annotated one of the field with @RiakIndex(name = "user\\_email")
&gt; and now I tried to look-up this object with email but I got
&gt; Caused by: com.basho.riak.client.RiakException: java.io.IOException:
&gt; {"phase":"index","error":"{indexes\\_not\\_supported,riak\\_kv\\_bitcask\\_backend}","input":"{cover,[{1370157784997721485815954530671515330927436759040,[1370157784997721485815954530671515330927436759040]}],{&lt;&lt;\\"users\\"&gt;&gt;,{eq,&lt;&lt;\\"user\\_email\\_bin\\"&gt;&gt;,&lt;&lt;\\"js@gm.com1\\"&gt;&gt;}}}","type":"result","stack":"[]"}
&gt; at com.basho.riak.client.query.MapReduce.execute(MapReduce.java:80)
&gt; at 
&gt; com.basho.riak.client.raw.pbc.PBClientAdapter.fetchIndex(PBClientAdapter.java:436)
&gt;
&gt; I ve google a bit and all I could find was this
&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-September/005749.html
&gt; post a year old now. which points out that search needs to be enabled
&gt; in app.config file. I changed settings and restarted both machines.
&gt; but I keep getting same exception every time.
&gt; 3. in same 
&gt; https://github.com/basho/riak-java-client/wiki/Using-a-custom-Converter
&gt; tutorial I read that default converter is not marshalling indexes,
&gt; links and metadata and it shows how to get and restore those
&gt; information back but looking into code for default converter
&gt; implementation I could find the same lines of code as in the article
&gt;
&gt; Map usermetaData =
&gt; usermetaConverter.getUsermetaData(domainObject);
&gt; RiakIndexes indexes = riakIndexConverter.getIndexes(domainObject);
&gt; Collection links = 
&gt; riakLinksConverter.getLinks(domainObject);
&gt;
&gt; return RiakObjectBuilder.newBuilder(bucket, key)
&gt; .withValue(value)
&gt; .withVClock(vclock)
&gt; .withUsermeta(usermetaData)
&gt; .withIndexes(indexes)
&gt; .withLinks(links)
&gt; .withContentType(Constants.CTYPE\\_OCTET\\_STREAM)
&gt; .build();
&gt; 4. can I specify data encoding it seems that it is not UTF-8
&gt; 5. I also saw in app.config that vnode\\_vclocks is set to true, so
&gt; should I still set clientId on riak client?? I read it will be skipped
&gt; anyway now.
&gt;
&gt; thanks for any comments
&gt;
&gt; pozdrawiam
&gt; Paweł Kamiński
&gt;
&gt; kami...@gmail.com
&gt; pkaminski....@gmail.com
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

