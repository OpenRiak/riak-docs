---
title: "Re: Riak and Spring"
description: ""
project: community
lastmod: 2014-08-11T07:29:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14639"
mailinglist_parent_id: "msg14618"
author_name: "Michael Duergner"
project_section: "mailinglistitem"
sent_date: 2014-08-11T07:29:36-07:00
---


I used Riak as a storage backend for several Spring based projects over the
last three or so year - currently working on one that uses an
implementation of the CrudRepository interface with Riak 2.0 with both pure
Jackson serialised models as well as custom serialisation with map type
CRDTs.

There's a blog series I just started to write about using Riak 2.0 CRDTs
with a Spring based application at http://michael.duergner.com/


On Wed, Aug 6, 2014 at 11:06 AM, Simon Hartley &lt;
simon.hart...@williamhill.com&gt; wrote:

&gt; Hi,
&gt;
&gt;
&gt;
&gt; Thanks, for your suggestions.
&gt;
&gt;
&gt;
&gt; I’ve done something similar, but injected the client config directly into
&gt; the client bean in the application configuration (not via the
&gt; HTTPClientConfigFactory). E.g:
&gt;
&gt;
&gt;
&gt; @ComponentScan
&gt;
&gt; @EnableAutoConfiguration
&gt;
&gt; \\*public\\* \\*class\\* Application {
&gt;
&gt;
&gt;
&gt; @Value( "${riak.pool.host}" ) \\*private\\* String poolHost;
&gt;
&gt; @Value( "${riak.pool.port}" ) \\*private\\* \\*int\\* poolPort;
&gt;
&gt; @Value( "${riak.pool.timeout.connection}" ) \\*private\\* \\*long\\*
&gt; poolTimeoutConnection;
&gt;
&gt; @Value( "${riak.pool.timeout.idle}" ) \\*private\\* \\*long\\* poolTimeoutIdle
&gt; ;
&gt;
&gt; @Value( "${riak.pool.timeout.request}" ) \\*private\\* \\*int\\*
&gt; poolTimeoutRequest;
&gt;
&gt; @Value( "${riak.pool.buffersize}" ) \\*private\\* \\*int\\* poolBufferSize;
&gt;
&gt;
&gt;
&gt; @Bean
&gt;
&gt; \\*public\\* \\*static\\* PropertyPlaceholderConfigurer properties(){
&gt;
&gt; PropertyPlaceholderConfigurer ppc = \\*new\\*
&gt; PropertyPlaceholderConfigurer();
&gt;
&gt; ClassPathResource[] resources = \\*new\\* ClassPathResource[ ]{ \\*new\\*
&gt; ClassPathResource( "app.properties" ) };
&gt;
&gt; ppc.setLocations(resources);
&gt;
&gt; ppc.setIgnoreUnresolvablePlaceholders(\\*true\\*);
&gt;
&gt; \\*return\\* ppc;
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; @Bean
&gt;
&gt; @Scope("singleton")
&gt;
&gt; IRiakClient riakClient() \\*throws\\* Exception{
&gt;
&gt;
&gt;
&gt; //create a single client connection configuration using the
&gt; property file values
&gt;
&gt; Configuration config = (\\*new\\* PBClientConfig.Builder())
&gt;
&gt;
&gt; .withConnectionTimeoutMillis(poolTimeoutConnection)
&gt;
&gt;
&gt; .withIdleConnectionTTLMillis(poolTimeoutIdle)
&gt;
&gt;
&gt; .withRequestTimeoutMillis(poolTimeoutRequest)
&gt;
&gt;
&gt; .withHost(poolHost)
&gt;
&gt;
&gt; .withPort(poolPort)
&gt;
&gt;
&gt; .withSocketBufferSizeKb(poolBufferSize)
&gt;
&gt;
&gt; .build();
&gt;
&gt;
&gt;
&gt; //create the singleton \\*Riak\\* client using the connection
&gt; configuration
&gt;
&gt; IRiakClient client = RiakFactory.\\*newClient\\*(config);
&gt;
&gt;
&gt;
&gt; \\*return\\* client;
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; \\*public\\* \\*static\\* \\*void\\* main(String[] args) {
&gt;
&gt;
&gt;
&gt; SpringApplication.\\*run\\*(Application.\\*class\\*, args);
&gt;
&gt; }
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; I’m not aware of any obvious benefits of one method over the other. If
&gt; anyone can enlighten me please do so J
&gt;
&gt;
&gt;
&gt; Thanks,
&gt;
&gt;
&gt;
&gt; Simon.
&gt;
&gt;
&gt;
&gt; \\*From:\\* Mark Richard Thomas [mailto:mark.tho...@equifax.com]
&gt; \\*Sent:\\* 06 August 2014 09:50
&gt; \\*To:\\* Simon Hartley; riak-users@lists.basho.com
&gt; \\*Subject:\\* RE: Riak and Spring
&gt;
&gt;
&gt;
&gt; Hello
&gt;
&gt;
&gt;
&gt; 1) Create a riakClient bean (applicationContext.xml)
&gt;
&gt;
&gt;
&gt; 
&gt; factory-method=\\*"newClient"\\*&gt;
&gt;
&gt; 
&gt;
&gt; 
&gt;
&gt;
&gt;
&gt; 2) create a HTTPClientConfigFactory bean in which you can specify
&gt; the host and port:
&gt;
&gt;
&gt;
&gt; package com.webapp.util;
&gt;
&gt;
&gt;
&gt; import org.apache.http.client.HttpClient;
&gt;
&gt; import org.springframework.beans.factory.FactoryBean;
&gt;
&gt; import org.springframework.beans.factory.annotation.Autowired;
&gt;
&gt; import org.springframework.beans.factory.annotation.Value;
&gt;
&gt; import org.springframework.stereotype.Component;
&gt;
&gt;
&gt;
&gt; import com.basho.riak.client.raw.http.HTTPClientConfig;
&gt;
&gt;
&gt;
&gt; @Component
&gt;
&gt; public class HTTPClientConfigFactory implements
&gt; FactoryBean {
&gt;
&gt;
&gt;
&gt; @Value("${${environment}.host}")
&gt;
&gt; private String host;
&gt;
&gt; @Value("${${environment}.port}")
&gt;
&gt; private int port;
&gt;
&gt;
&gt;
&gt; @Autowired
&gt;
&gt; HttpClient httpClient;
&gt;
&gt;
&gt;
&gt; public HTTPClientConfig getObject() throws Exception {
&gt;
&gt; return new
&gt; HTTPClientConfig.Builder().withHttpClient(httpClient)
&gt;
&gt;
&gt; .withHost(host).withPort(port).build();
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; @Override
&gt;
&gt; public Class  getObjectType() {
&gt;
&gt; return HTTPClientConfig.class;
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; @Override
&gt;
&gt; public boolean isSingleton() {
&gt;
&gt; return true;
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; @Override
&gt;
&gt; protected void finalize() throws Throwable {
&gt;
&gt;
&gt; httpClient.getConnectionManager().shutdown();
&gt;
&gt; }
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; 3) Use the RiakClient within a service:
&gt;
&gt;
&gt;
&gt; @Autowired
&gt;
&gt; \\*private\\* IRiakClient client;
&gt;
&gt;
&gt;
&gt; \\*public\\* Name getName(String sname) {
&gt;
&gt; \\*try\\* {
&gt;
&gt; Name name = client.fetchBucket(\\*NAMEBUCKET\\*
&gt; ).execute()
&gt;
&gt; .fetch(sname, Name.\\*class\\*).execute();
&gt;
&gt; \\*if\\* (name == \\*null\\*) {
&gt;
&gt; \\*throw\\* \\*new\\* ResourceNotFoundException(sname);
&gt;
&gt; }
&gt;
&gt; \\*return\\* name;
&gt;
&gt; } \\*catch\\* (UnresolvedConflictException |
&gt; RiakRetryFailedException
&gt;
&gt; | ConversionException e) {
&gt;
&gt; \\*throw\\* \\*new\\* ServiceUnavailableException(sname);
&gt;
&gt; }
&gt;
&gt; }
&gt;
&gt;
&gt;
&gt; Mark Thomas | Software Engineer | Equifax UK
&gt;
&gt;
&gt;
&gt; p: +44 (0)208 941 0573
&gt;
&gt; m: +44 (0)7908 798 270
&gt;
&gt; e: mark.tho...@equifax.com
&gt;
&gt;
&gt;
&gt; Equifax Ltd, Capital House, 25 Chapel Street, London, NW1 5DS
&gt;
&gt;
&gt;
&gt; \\*From:\\* riak-users [mailto:riak-users-boun...@lists.basho.com
&gt; ] \\*On Behalf Of \\*Simon Hartley
&gt; \\*Sent:\\* 30 July 2014 15:37
&gt; \\*To:\\* riak-users@lists.basho.com
&gt; \\*Subject:\\* [IE]:Riak and Spring
&gt;
&gt;
&gt;
&gt; Hi,
&gt;
&gt;
&gt;
&gt; I’m looking at using a Riak backend in a new component.
&gt;
&gt;
&gt;
&gt; My current client is a Spring shop. I’m not all that knowledgable about
&gt; the intricaies of Spring , so this question many not make sense, but I am
&gt; hoping to integrate Riak in a Spring friendly way.
&gt;
&gt;
&gt;
&gt; I was looking at the spring-projects/spring-data-keyvalue
&gt;  project, but
&gt; that’s been deprecated in favour of spring-projects/spring-data-riak
&gt;  which is empty.
&gt;
&gt;
&gt;
&gt; Does anyone know of a Spring-Riak integration project that is high quality
&gt; and currently active - preferably with excellent documentation and
&gt; examples ;)
&gt;
&gt;
&gt;
&gt; Thanks,
&gt;
&gt;
&gt;
&gt; Simon.
&gt;
&gt; Confidentiality: The contents of this e-mail and any attachments
&gt; transmitted with it are intended to be confidential to the intended
&gt; recipient; and may be privileged or otherwise protected from disclosure. If
&gt; you are not an intended recipient of this e-mail, do not duplicate or
&gt; redistribute it by any means. Please delete it and any attachments and
&gt; notify the sender that you have received it in error. This e-mail is sent
&gt; by a William Hill PLC group company. The William Hill group companies
&gt; include, among others, William Hill PLC (registered number 4212563),
&gt; William Hill Organization Limited (registered number 278208), William Hill
&gt; US HoldCo Inc, WHG (International) Limited (registered number 99191) and
&gt; WHG Trading Limited (registered number 101439). Each of William Hill PLC,
&gt; William Hill Organization Limited is registered in England and Wales and
&gt; has its registered office at Greenside House, 50 Station Road, Wood Green,
&gt; London N22 7TP. William Hill U.S. HoldCo, Inc. is 160 Greentree Drive,
&gt; Suite 101, Dover 19904, Kent, Delaware, United States of America. Each of
&gt; WHG (International) Limited and WHG Trading Limited is registered in
&gt; Gibraltar and has its registered office at 6/1 Waterport Place, Gibraltar.
&gt; Unless specifically indicated otherwise, the contents of this e-mail are
&gt; subject to contract; and are not an official statement, and do not
&gt; necessarily represent the views, of William Hill PLC, its subsidiaries or
&gt; affiliated companies. Please note that neither William Hill PLC, nor its
&gt; subsidiaries and affiliated companies can accept any responsibility for any
&gt; viruses contained within this e-mail and it is your responsibility to scan
&gt; any emails and their attachments. William Hill PLC, its subsidiaries and
&gt; affiliated companies may monitor e-mail traffic data and also the content
&gt; of e-mails for effective operation of the e-mail system, or for security,
&gt; purposes..
&gt;
&gt; Equifax Limited is registered in England with Registered No. 2425920. 
&gt; Registered
&gt; Office: Capital House, 25 Chapel Street, London NW1 5DS. Equifax Limited is
&gt; authorised and regulated by the Financial Conduct Authority.
&gt;
&gt; Equifax Touchstone Limited is registered in Scotland with Registered No.
&gt; SC113401. Registered Office: 54 Deerdykes View, Westfield Park, Cumbernauld
&gt; G68 9HN.
&gt;
&gt; Equifax Commercial Services Limited is registered in the Republic of
&gt; Ireland with Registered No. 215393. Registered Office: IDA Business &
&gt; Technology Park, Rosslare Road, Drinagh, Wexford.
&gt;
&gt;
&gt;
&gt; This message contains information from Equifax which may be confidential
&gt; and privileged. If you are not an intended recipient, please refrain from
&gt; any disclosure, copying, distribution or use of this information and note
&gt; that such actions are prohibited. If you have received this transmission in
&gt; error, please notify by e-mail postmas...@equifax.com.
&gt; Confidentiality: The contents of this e-mail and any attachments
&gt; transmitted with it are intended to be confidential to the intended
&gt; recipient; and may be privileged or otherwise protected from disclosure. If
&gt; you are not an intended recipient of this e-mail, do not duplicate or
&gt; redistribute it by any means. Please delete it and any attachments and
&gt; notify the sender that you have received it in error. This e-mail is sent
&gt; by a William Hill PLC group company. The William Hill group companies
&gt; include, among others, William Hill PLC (registered number 4212563),
&gt; William Hill Organization Limited (registered number 278208), William Hill
&gt; US HoldCo Inc, WHG (International) Limited (registered number 99191) and
&gt; WHG Trading Limited (registered number 101439). Each of William Hill PLC,
&gt; William Hill Organization Limited is registered in England and Wales and
&gt; has its registered office at Greenside House, 50 Station Road, Wood Green,
&gt; London N22 7TP. William Hill U.S. HoldCo, Inc. is 160 Greentree Drive,
&gt; Suite 101, Dover 19904, Kent, Delaware, United States of America. Each of
&gt; WHG (International) Limited and WHG Trading Limited is registered in
&gt; Gibraltar and has its registered office at 6/1 Waterport Place, Gibraltar.
&gt; Unless specifically indicated otherwise, the contents of this e-mail are
&gt; subject to contract; and are not an official statement, and do not
&gt; necessarily represent the views, of William Hill PLC, its subsidiaries or
&gt; affiliated companies. Please note that neither William Hill PLC, nor its
&gt; subsidiaries and affiliated companies can accept any responsibility for any
&gt; viruses contained within this e-mail and it is your responsibility to scan
&gt; any emails and their attachments. William Hill PLC, its subsidiaries and
&gt; affiliated companies may monitor e-mail traffic data and also the content
&gt; of e-mails for effective operation of the e-mail system, or for security,
&gt; purposes..
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Mit freundlichen Grüßen / With kind regards

Michael Dürgner
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

