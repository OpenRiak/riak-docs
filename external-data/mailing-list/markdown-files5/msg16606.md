---
title: "Re: riak 2.1.1 : Erlang crash dump"
description: ""
project: community
lastmod: 2015-10-03T17:45:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16606"
mailinglist_parent_id: "msg16605"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2015-10-03T17:45:07-07:00
---


Girish,

This feels like a sibling explosion to me. I cannot help prove or fix it. 
Writing this paragraph as bait for others to help.

Matthew

Sent from my iPad

&gt; On Oct 3, 2015, at 8:34 PM, Girish Shankarraman  
&gt; wrote:
&gt; 
&gt; Thank you for the response, Jon.
&gt; 
&gt; So I changed it to 50% and it crashed again.
&gt; I have a 5 nodes cluster with 60GB RAM on each node. Ring size is set to 64. 
&gt; (Attached riak conf if any one has some ideas).
&gt; 
&gt; I still see the erlang process consuming the entire capacity of the system 
&gt; (52 GB).
&gt; 
&gt; PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
&gt; 24256 riak 20 0 67.134g 0.052t 18740 D 0.0 90.0 2772:44 beam.smp
&gt; 
&gt; ---- Cluster Status ----
&gt; Ring ready: true
&gt; 
&gt; +--------------------+------+-------+-----+-------+
&gt; | node |status| avail |ring |pending|
&gt; +--------------------+------+-------+-----+-------+
&gt; | (C) riak@20.0.0.11 |valid | up | 20.3| -- |
&gt; | riak@20.0.0.12 |valid | up | 20.3| -- |
&gt; | riak@20.0.0.13 |valid | up | 20.3| -- |
&gt; | riak@20.0.0.14 |valid | up | 20.3| -- |
&gt; | riak@20.0.0.15 |valid | up | 18.8| -- |
&gt; 
&gt; Thanks,
&gt; 
&gt; — Girish Shankarraman
&gt; 
&gt; 
&gt; From: Jon Meredith 
&gt; Date: Thursday, October 1, 2015 at 2:06 PM
&gt; To: girish shankarraman , 
&gt; "riak-users@lists.basho.com" 
&gt; Subject: Re: riak 2.1.1 : Erlang crash dump
&gt; 
&gt; It looks like Riak was unable to allocate 4Gb of memory. You may have to 
&gt; reduce the amount of memory allocated for leveldb from the default 70%, try 
&gt; setting this in your /etc/riak/riak.conf file
&gt; 
&gt; leveldb.maximum\\_memory.percent = 50
&gt; 
&gt; The memory footprint for Riak should stabilize after a few hours and on 
&gt; servers with smaller amounts of memory, the 30% left over may not be enough.
&gt; 
&gt; Please let us know how you get on.
&gt; 
&gt;&gt; On Wed, Sep 30, 2015 at 5:31 PM Girish Shankarraman 
&gt;&gt;  wrote:
&gt;&gt; I have 7 node cluster for riak with a ring\\_size of 128.
&gt;&gt; 
&gt;&gt; System Details:
&gt;&gt; Each node is a VM with 16GB of memory.
&gt;&gt; The backend is using leveldb.
&gt;&gt; sys\\_system\\_architecture : &lt;&lt;"x86\\_64-unknown-linux-gnu"&gt;&gt;
&gt;&gt; sys\\_system\\_version : &lt;&lt;"Erlang R16B02\\_basho8 (erts-5.10.3) [source] [64-bit] 
&gt;&gt; [smp:4:4] [async-threads:64] [kernel-poll:true] [frame-pointer]"&gt;&gt;
&gt;&gt; riak\\_control\\_version : &lt;&lt;"2.1.1-0-g5898c40"&gt;&gt;
&gt;&gt; cluster\\_info\\_version : &lt;&lt;"2.0.2-0-ge231144"&gt;&gt;
&gt;&gt; yokozuna\\_version : &lt;&lt;"2.1.0-0-gcb41c27”&gt;&gt;
&gt;&gt; 
&gt;&gt; Scenario:
&gt;&gt; We have up to 400-1000 json records being written/sec. Each record might be 
&gt;&gt; a few 100 bytes.
&gt;&gt; I see the following crash message in the erlang logs after a few hours of 
&gt;&gt; processing. Any suggestions on what could be going on here ?
&gt;&gt; 
&gt;&gt; ===== Tue Sep 29 20:20:56 UTC 2015
&gt;&gt; [os\\_mon] memory supervisor port (memsup): Erlang has closed^M
&gt;&gt; [os\\_mon] cpu supervisor port (cpu\\_sup): Erlang has closed^M
&gt;&gt; ^M
&gt;&gt; Crash dump was written to: /var/log/riak/erl\\_crash.dump^M
&gt;&gt; eheap\\_alloc: Cannot allocate 3936326656 bytes of memory (of type "heap").^M
&gt;&gt; 
&gt;&gt; Also tested running this at 50GB per Riak Node(VM) and things work but 
&gt;&gt; memory keeps growing, so throwing hardware at it doesn’t seem very scalable.
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; — Girish Shankarraman
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

