---
title: "Re: Very slow acquisition time (99 percentile) while fast median times"
description: ""
project: community
lastmod: 2016-05-02T08:34:55-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17274"
mailinglist_parent_id: "msg17273"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2016-05-02T08:34:55-07:00
---


Could you please check the objsize stats on every Riak node? If they
are all zero then ... ????
--
Luke Bakken
Engineer
lbak...@basho.com


On Mon, May 2, 2016 at 8:26 AM, Guillaume Boddaert
 wrote:
&gt; My clients are working through an haproxy box configured on round-robin.
&gt;
&gt; I've switched from PBC to HTTP to provide you this:
&gt;
&gt; May 2 15:24:12 intrabalancer haproxy[29677]: my\\_daemon\\_box:53456
&gt; [02/May/2016:15:24:12.390] riak\\_rest riak\\_rest\\_backend/riak2 6/0/1/54/61 503
&gt; 222 - - ---- 5/4/2/1/0 0/0 "PUT
&gt; /types/activity\\_fr/buckets/twitter/keys/727126697699594240?dw=1&timeout=50&returnbody=true
&gt; HTTP/1.1"
&gt; May 2 15:24:12 intrabalancer haproxy[29677]: my\\_daemon\\_box:53455
&gt; [02/May/2016:15:24:12.339] riak\\_rest riak\\_rest\\_backend/riak3 57/0/0/54/111
&gt; 503 222 - - ---- 5/4/1/1/0 0/0 "PUT
&gt; /types/activity\\_fr/buckets/twitter/keys/727126698291023872?dw=1&timeout=50&returnbody=true
&gt; HTTP/1.1"
&gt; May 2 15:24:12 intrabalancer haproxy[29677]: my\\_daemon\\_box:53454
&gt; [02/May/2016:15:24:12.285] riak\\_rest riak\\_rest\\_backend/riak5 63/0/0/106/169
&gt; 503 222 - - ---- 5/4/0/1/0 0/0 "PUT
&gt; /types/activity\\_fr/buckets/twitter/keys/727126698249064449?dw=1&timeout=50&returnbody=true
&gt; HTTP/1.1"
&gt; May 2 15:24:12 intrabalancer haproxy[29677]: my\\_daemon\\_box:53455
&gt; [02/May/2016:15:24:12.451] riak\\_rest riak\\_rest\\_backend/riak5 13/0/1/58/72
&gt; 503 222 - - ---- 5/4/3/1/0 0/0 "PUT
&gt; /types/activity\\_fr/buckets/twitter/keys/727126696256802816?dw=1&timeout=50&returnbody=true
&gt; HTTP/1.1"
&gt; May 2 15:24:12 intrabalancer haproxy[29677]: my\\_daemon\\_box:53456
&gt; [02/May/2016:15:24:12.451] riak\\_rest riak\\_rest\\_backend/riak4 10/0/1/62/73
&gt; 503 222 - - ---- 5/4/2/1/0 0/0 "PUT
&gt; /types/activity\\_fr/buckets/twitter/keys/727126698425212929?dw=1&timeout=50&returnbody=true
&gt; HTTP/1.1"
&gt; May 2 15:24:12 intrabalancer haproxy[29677]: my\\_daemon\\_box:53453
&gt; [02/May/2016:15:24:12.397] riak\\_rest riak\\_rest\\_backend/riak1 66/0/0/63/129
&gt; 503 222 - - ---- 5/4/1/1/0 0/0 "PUT
&gt; /types/activity\\_fr/buckets/twitter/keys/727126698215485440?dw=1&timeout=50&returnbody=true
&gt; HTTP/1.1"
&gt;
&gt; Yet objsize is still 0 on puts:
&gt; admin@riak1:~$ sudo riak-admin status | grep -e 'objsize'
&gt; consistent\\_get\\_objsize\\_100 : 0
&gt; consistent\\_get\\_objsize\\_95 : 0
&gt; consistent\\_get\\_objsize\\_99 : 0
&gt; consistent\\_get\\_objsize\\_mean : 0
&gt; consistent\\_get\\_objsize\\_median : 0
&gt; consistent\\_put\\_objsize\\_100 : 0
&gt; consistent\\_put\\_objsize\\_95 : 0
&gt; consistent\\_put\\_objsize\\_99 : 0
&gt; consistent\\_put\\_objsize\\_mean : 0
&gt; consistent\\_put\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_counter\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_map\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_objsize\\_100 : 10916
&gt; node\\_get\\_fsm\\_objsize\\_95 : 7393
&gt; node\\_get\\_fsm\\_objsize\\_99 : 8845
&gt; node\\_get\\_fsm\\_objsize\\_mean : 4098
&gt; node\\_get\\_fsm\\_objsize\\_median : 3891
&gt; node\\_get\\_fsm\\_set\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_set\\_objsize\\_median : 0
&gt; write\\_once\\_put\\_objsize\\_100 : 0
&gt; write\\_once\\_put\\_objsize\\_95 : 0
&gt; write\\_once\\_put\\_objsize\\_99 : 0
&gt; write\\_once\\_put\\_objsize\\_mean : 0
&gt; write\\_once\\_put\\_objsize\\_median : 0
&gt;
&gt;
&gt;
&gt; G.
&gt;
&gt;
&gt; On 02/05/2016 17:21, Luke Bakken wrote:
&gt;&gt;
&gt;&gt; Which Riak client are you using? Do you have it configured to connect
&gt;&gt; to all nodes in your cluster or just one?
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer
&gt;&gt; lbak...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, May 2, 2016 at 7:40 AM, Guillaume Boddaert
&gt;&gt;  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Luke,
&gt;&gt;&gt;
&gt;&gt;&gt; Well objsize seems to be 0, that's very troubling.
&gt;&gt;&gt; I can assure you that i am writing 75 items per second at the moment and
&gt;&gt;&gt; that I can pull data from the cluster.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; admin@riak3:~$ sudo riak-admin status | grep -e 'objsize'
&gt;&gt;&gt;
&gt;&gt;&gt; consistent\\_get\\_objsize\\_100 : 0
&gt;&gt;&gt; consistent\\_get\\_objsize\\_95 : 0
&gt;&gt;&gt; consistent\\_get\\_objsize\\_99 : 0
&gt;&gt;&gt; consistent\\_get\\_objsize\\_mean : 0
&gt;&gt;&gt; consistent\\_get\\_objsize\\_median : 0
&gt;&gt;&gt; consistent\\_put\\_objsize\\_100 : 0
&gt;&gt;&gt; consistent\\_put\\_objsize\\_95 : 0
&gt;&gt;&gt; consistent\\_put\\_objsize\\_99 : 0
&gt;&gt;&gt; consistent\\_put\\_objsize\\_mean : 0
&gt;&gt;&gt; consistent\\_put\\_objsize\\_median : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_counter\\_objsize\\_100 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_counter\\_objsize\\_95 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_counter\\_objsize\\_99 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_counter\\_objsize\\_mean : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_counter\\_objsize\\_median : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_map\\_objsize\\_100 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_map\\_objsize\\_95 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_map\\_objsize\\_99 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_map\\_objsize\\_mean : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_map\\_objsize\\_median : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_objsize\\_100 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_objsize\\_95 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_objsize\\_99 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_objsize\\_mean : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_objsize\\_median : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_set\\_objsize\\_100 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_set\\_objsize\\_95 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_set\\_objsize\\_99 : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_set\\_objsize\\_mean : 0
&gt;&gt;&gt; node\\_get\\_fsm\\_set\\_objsize\\_median : 0
&gt;&gt;&gt; write\\_once\\_put\\_objsize\\_100 : 0
&gt;&gt;&gt; write\\_once\\_put\\_objsize\\_95 : 0
&gt;&gt;&gt; write\\_once\\_put\\_objsize\\_99 : 0
&gt;&gt;&gt; write\\_once\\_put\\_objsize\\_mean : 0
&gt;&gt;&gt; write\\_once\\_put\\_objsize\\_median : 0
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 02/05/2016 16:13, Luke Bakken wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Guillaume -
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What are the "objsize" stats for your cluster?
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Luke Bakken
&gt;&gt;&gt;&gt; Engineer
&gt;&gt;&gt;&gt; lbak...@basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Mon, May 2, 2016 at 4:45 AM, Guillaume Boddaert
&gt;&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I'm trying to setup a production environment with Riak as backend.
&gt;&gt;&gt;&gt;&gt; Unfortunately I have very slow write times that bottleneck my whole
&gt;&gt;&gt;&gt;&gt; system.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Here is a sample of one of my node (riak-admin status | grep -e
&gt;&gt;&gt;&gt;&gt; '^node\\_put\\_fsm\\_time'):
&gt;&gt;&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_100 : 3305516
&gt;&gt;&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_95 : 230589
&gt;&gt;&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_99 : 1694593
&gt;&gt;&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_mean : 79864
&gt;&gt;&gt;&gt;&gt; node\\_put\\_fsm\\_time\\_median : 14973
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; As you can see, I have really good times for most of my writes, yet the
&gt;&gt;&gt;&gt;&gt; mean
&gt;&gt;&gt;&gt;&gt; time is not so good because a few writes are taking long (Up to 3
&gt;&gt;&gt;&gt;&gt; seconds)
&gt;&gt;&gt;&gt;&gt; How can I get rid of those slow insert ? Is that intended/normal ?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; My setup is the following:
&gt;&gt;&gt;&gt;&gt; 5 hosts (2CPU, %Cpu(s): 47,1 us, 1,3 sy, 0,0 ni, 51,3 id, 0,0 wa,
&gt;&gt;&gt;&gt;&gt; 0,0
&gt;&gt;&gt;&gt;&gt; hi, 0,2 si, 0,0 st) , ring\\_size: 128, aae disabled.
&gt;&gt;&gt;&gt;&gt; Writes are w=1 dw=0
&gt;&gt;&gt;&gt;&gt; each host has 32go of ram, that is almost used for system caching only.
&gt;&gt;&gt;&gt;&gt; My data are stored on an openstack volume that support up to 3000IOPS.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Here is an iostat sample for 1 minute:
&gt;&gt;&gt;&gt;&gt; avg-cpu: %user %nice %system %iowait %steal %idle
&gt;&gt;&gt;&gt;&gt; 38.00 0.00 1.81 0.03 0.08 60.07
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Device: tps kB\\_read/s kB\\_wrtn/s kB\\_read kB\\_wrtn
&gt;&gt;&gt;&gt;&gt; vda 0.37 0.00 2.27 0 136
&gt;&gt;&gt;&gt;&gt; vdb 9.60 0.00 294.53 0 17672
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Guilaume BODDAERT
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

