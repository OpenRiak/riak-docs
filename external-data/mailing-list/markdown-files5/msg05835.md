---
title: "Re: Secondary Index Map and reduce order and performance"
description: ""
project: community
lastmod: 2011-12-01T05:41:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05835"
mailinglist_parent_id: "msg05818"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2011-12-01T05:41:06-08:00
---


On Wed, Nov 30, 2011 at 4:28 PM, Sajithkumar Kizhakkiniyil
 wrote:
&gt; If my understanding is correct a reduce phase with
&gt; riak\\_kv\\_mapreduce.reduce\\_identity is needed for secondary index query.

Hi, Sajithkumar. The reduce\\_identity function is only needed if the
result you want is the list of bucket/key pairs. If you are instead
extracting the value of the object in a map phase, you can leave the
reduce\\_identity call out.

In fact, reduce\\_identity's proclivity for bucket/key pairs is the
reason your MapReduce query is so slow when reduce\\_identity is tacked
on the end. That function throws an exception for any input it gets
that is \\*not\\* a bucket/key pair. If you look in your Riak log, you'll
likely see hundreds of messages along the lines of
"throw:{unhandled\\_entry,…} reducing: …". The reason you get your
expected result back instead of an error is a fluke caused by this
known issue: https://issues.basho.com/show\\_bug.cgi?id=1185

If you're mapping over the objects generated by a 2i query, leave
reduce\\_identity out, and your query will be much happier.

-Bryan

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

