---
title: "Re: Practical Riak cluster choices in AWS (number of nodes? AZ's?)"
description: ""
project: community
lastmod: 2013-08-11T17:13:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11973"
mailinglist_parent_id: "msg11969"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2013-08-11T17:13:22-07:00
---


I'd be wary of using EBS backed nodes for Riak - with only a single
ethernet connection, it wil be very easy to saturate the max of 1000mbps
available in a single AWS NIC (unless you're using cluster compute
instances). I'd be more worried about temporarily losing contact with a
node through network saturation than through AZ failure, truthfully.

The beauty of Riak is that a node can drop and you can replace it with
minimal fuss. Use that to your advantage and make every node in the cluster
disposable.

As far as doubling up in one AZ goes - if you're worried about AZ failure,
you should treat each AZ as a separate data center and design your failure
scenarios accordingly. Yes, Amazon say you should put one Riak node in each
AZ; I'm not buying that. With no guarantee around latency, and no control
around between DCs, you need to be very careful how much of that latency
you're willing to introduce into your application.

Were I in your position, I'd stand up a 5 node cluster in US-WEST-2 and be
done with it. I'd consider Riak EE for my HA/DR solution once the business
decides that off-site HA/DR is something it wants/needs.


---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Sun, Aug 11, 2013 at 1:52 PM, Brady Wetherington wrote:

&gt; Hi all -
&gt;
&gt; I have some questions about how I want my Riak stuff to work - I've
&gt; already asked these questions of some Basho people and gotten some answers,
&gt; but thought I would toss it out into the wider world to see what you all
&gt; have to say, too:
&gt;
&gt; First off - I know 5 instances is the "magic number" of instances to have.
&gt; If I understand the thinking here, it's that at the default redundancy
&gt; level ('n'?) of 3, it is most likely to start getting me some scaling
&gt; (e.g., performance &gt; just that of a single node), and yet also have
&gt; redundancy; whereby I can lose one box and not start to take a performance
&gt; hit.
&gt;
&gt; My question is - I think I can only do 4 in a way that makes sense. I only
&gt; have 4 AZ's that I can use right now; AWS won't let me boot instances in
&gt; 1a. My concern is if I try to do 5, I will be "doubling up" in one AZ - and
&gt; in AWS you're almost as likely to lose an entire AZ as you are a single
&gt; instance. And so, if I have instances doubled-up in one AZ (let's say
&gt; us-east-1e), and then I lose 1e, I've now lost two instances. What are the
&gt; chances that all three of my replicas of some chunk of my data are on those
&gt; two instances? I know that it's not guaranteed that all replicas are on
&gt; separate nodes.
&gt;
&gt; So is it better for me to ignore the recommendation of 5 nodes, and just
&gt; do 4? Or to ignore the fact that I might be doubling-up in one AZ? Also,
&gt; another note. These are designed to be 'durable' nodes, so if one should go
&gt; down I would expect to bring it back up \\*with\\* its data - or, if I
&gt; couldn't, I would do a force-replace or replace and rebuild it from the
&gt; other replicas. I'm definitely not doing instance-store. So I don't know if
&gt; that mitigates my need for a full 5 nodes. I would also consider losing one
&gt; node to be "degraded" and would probably seek to fix that problem as soon
&gt; as possible, so I wouldn't expect to be in that situation for long. I would
&gt; probably tolerate a drop in performance during that time, too. (Not a
&gt; super-severe one, but 20-30 percent? Sure.)
&gt;
&gt; What do you folks think?
&gt;
&gt; -B.
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

