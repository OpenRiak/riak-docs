---
title: "Re: Riak Search - searching across all fields"
description: ""
project: community
lastmod: 2012-12-18T13:24:31-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09622"
mailinglist_parent_id: "msg09594"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2012-12-18T13:24:31-08:00
---


I only mention this as I too have a small userbase/data footprint for one of my 
projects and in that project I have "squashed" all fields together in a 
catchall field within a json blob exactly because of this problem. Because of 
the project size doing so is an acceptable performance hit in terms of 
processing and disk space. Separately I have also put together systems that 
have automagically constructed the appropriate RiakSearch search string. For 
example a search for "medical books" would turn into:

(title:medical\\* description:medical\\* title:books\\* description:books\\* ) AND 
group:1468Madison

Here I am specifically searching though the title and description fields and 
the default search operator in this case is OR, as set in the schema file. 
Group, in this case, is a further internal filter automatically appended. 
Again, all this happens in application space and Riak is oblivious to it.

Constructing your search strings would also apply to the magic Ryan is brewing 
with Yokozuna. Either in your application or a hook/module built into Riak.

-Alexander Sicular

@siculars

On Dec 15, 2012, at 12:43 AM, Matt Painter wrote:

&gt; Thanks so much Ryan - yokozuna sounds most promising. If I were building a 
&gt; small system (relatively simple, small user base) that will be 
&gt; production-ready in a few months, do you think that Yokozuna could cut the 
&gt; mustard? I see that it's officially an experimental prototype, but do you 
&gt; think it's stable 'enough' in its current state? Sorry if this is an 
&gt; impossible question to answer with too many variables...
&gt; 
&gt; I must confess that using a forked Riak makes me a touch queasy for anything 
&gt; other than playpen stuff. Do you think that a combo deal of Riak + 
&gt; elasticsearch could be a suitable compromise for the time-being? 
&gt; 
&gt; 
&gt; On 15 December 2012 06:13, Ryan Zezeski  wrote:
&gt; Matt, comments inline
&gt; 
&gt; 
&gt; On Tue, Dec 11, 2012 at 3:35 AM, Matt Painter  wrote:
&gt; 
&gt; Apart from a single default value, is it possible for Riak Search to search 
&gt; for a keyword across all fields in a document without having to specify the 
&gt; field up front as a prefix in one's search term?
&gt; 
&gt; A field must be specified to search, but a default field may be specified in 
&gt; the schema [1]. This field will be searched if one is not specified. But 
&gt; there is no way to do a search against all fields. It is always over one 
&gt; field.
&gt; 
&gt; 
&gt; I'm guessing that one solution could be a post-commit hook which recursively 
&gt; iterates over all fields and squashes them into a secondary default value 
&gt; field - but since I know even less about Erlang and am just starting out with 
&gt; Riak, I thought it prudent to see if there was a more straightforward 
&gt; solution...
&gt; 
&gt; Your use case immediately makes me think of Solr copy fields. You index 
&gt; everything under their individual fields but all values get copied into a 
&gt; catch-all field so that all content may be searched easily. However, with 
&gt; this you lose the ability to know which field it came from. Riak Search 
&gt; doesn't have copy field functionality. You'd have to concatenate all the 
&gt; data into a field on your application side. The new search solution I've 
&gt; been working on, Yokozuna, uses Solr underneath and therefore does support 
&gt; copy fields [2].
&gt; 
&gt; You could create a pre-commit hook to do this field-squashing but I think you 
&gt; would be better off doing it in your application. To do it via a hook you'd 
&gt; have to make sure it runs before the search hook (I can't remember if you can 
&gt; force specific order of pre-commit hooks). It would also have an effect on 
&gt; your write latencies as more pre-processing would have to be done. Finally, 
&gt; you would have to write Erlang.
&gt; 
&gt; 
&gt; The use case is this:
&gt; 
&gt; We are providing an object + metadata store for users to deposit files and 
&gt; any number of related fragments of structured JSON metadata. We are not 
&gt; enforcing any metadata schema - and therefore can't know up-front any field 
&gt; names - but would like the ability for a dumb keyword search from a website 
&gt; to return references to the records they have deposited in Riak. Essentially, 
&gt; providing a Google-like interface.
&gt; 
&gt; (As a side question, Is Riak Search mature enough for these type of very 
&gt; generic searches? I know that it's "inspired by" Lucene and "Lucene-like", 
&gt; but I don't know how many of Lucene's goodies are present - or is it just a 
&gt; case of invoking analysers provided by Lucene for things like stemming, and 
&gt; all will be pretty much equivalent for most situations?)
&gt; 
&gt; There are no "goodies present" \\_at all\\_. Riak Search is an in-house 
&gt; implementation, completely written in Erlang. It's only connection to 
&gt; Lucene/Solr is a superficial interface that looks very much like Lucene/Solr. 
&gt; E.g. you mention stemming, there is no stemming support in Riak Search and 
&gt; would be a non-trivial addition. This is one of the big reasons Yokozuna is 
&gt; being written [2]. The world of search is vast and complicated, best to 
&gt; start with proven solution and build from that.
&gt; 
&gt; Riak Search generally starts causing pain when you have searches that match 
&gt; tens of thousands of documents. The runtime is proportional to the size of 
&gt; the result set. In fact, Riak Search has a hard-coded upper limit to fail 
&gt; queries that match 100K or more documents (although it does the work to get 
&gt; 100K results and then drops it all on the floor so you still use 
&gt; resources/times). For example, if a lot of your files were pictures and were 
&gt; tagged with something like {"type":"picture"} then a search for "picture" is 
&gt; probably going to cause issues. Things really start to hurt when you do 
&gt; conjunction queries with multiple large result sets, e.g. "funny AND 
&gt; picture". Once again, this is not the case with Yokozuna, which in my 
&gt; benchmarking thus far has shown flat latencies regardless of result set size.
&gt; 
&gt; -Z
&gt; 
&gt; [1]: 
&gt; http://docs.basho.com/riak/latest/cookbooks/Riak-Search---Schema/#Defining-a-Schema
&gt; 
&gt; [2]: https://github.com/rzezeski/yokozuna
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Matt Painter
&gt; m...@deity.co.nz
&gt; +64 21 115 9378
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

