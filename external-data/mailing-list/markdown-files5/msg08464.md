---
title: "Re: MapReduce job not stopping"
description: ""
project: community
lastmod: 2012-09-06T09:29:42-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08464"
mailinglist_parent_id: "msg08462"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2012-09-06T09:29:42-07:00
---


On Thu, Sep 6, 2012 at 11:22 AM, shaharke  wrote:
&gt; IMO it makes more sense that Riak will cancel the job once the connection
&gt; with the client is terminated. Is this a bug in Riak?

Riak won't notice that an HTTP client has terminated the connection
until it attempts to send some portion of the response to it. There
are two cases where this won't happen until the query has finished
completely:

 1. non-streamed responses (the default)
 2. queries that end with reduce phases (also somewhat true for
queries that contain reduce phases in any position)

In both of these cases, Riak has no reason to talk to the client until
the query finishes, and so it ignores the state of the socket until
that time. This is a general issue for Webmachine (the HTTP server
that Riak uses).

If you expect to cancel large MapReduce requests often, I suggest
using the Protocol Buffers interface, which does monitor the
connection state.

-Bryan

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

