---
title: "Re: Deciphering Key Filter Errors"
description: ""
project: community
lastmod: 2011-03-03T12:19:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02550"
mailinglist_parent_id: "msg02546"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-03-03T12:19:48-08:00
---


Hi Jason,

I'm able to reproduce the issue when the keys I am filtering do not contain
the token. For example, if my token is "-" and my key is "helloworld" the
tokens for that key become:
["helloworld"]

Grabbing the second element of that list returns an error:
3&gt; string:tokens("helloworld", "-").
["helloworld"]
4&gt; lists:nth(2, ["helloworld"]).
\\*\\* exception error: no function clause matching lists:nth(1,[])

It seems Riak should catch errors during the filtering process and discard
keys that cause errors. I will file a bug.

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Thu, Mar 3, 2011 at 10:28 AM, Jason J. W. Williams &lt;
jasonjwwilli...@gmail.com&gt; wrote:

&gt; If someone could help me understand just this error, that would help a
&gt; lot: https://gist.github.com/852450
&gt;
&gt; Thank you in advance.
&gt;
&gt; -J
&gt;
&gt; On Wed, Mar 2, 2011 at 11:55 PM, Jason J. W. Williams
&gt;  wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I'm experimenting using key filters to implement indexes. My approach
&gt; &gt; is for each data key in bucket A, to create a new empty key in a
&gt; &gt; dedicated index bucket where the original key name and value of the
&gt; &gt; indexed field is encoded in the key name for a new index key.
&gt; &gt;
&gt; &gt; Data key looks like this:
&gt; &gt;
&gt; &gt; Bucket - riak\\_perf\\_test
&gt; &gt; Key - ccode\\_ : {"redeemed\\_count": 23 }
&gt; &gt;
&gt; &gt; For each data key created, an index key is created:
&gt; &gt;
&gt; &gt; Bucket - idx=redeemed\\_count=ccode
&gt; &gt; Key - ccode/23
&gt; &gt;
&gt; &gt; (in both keys 23 changes on a per-key basis based on what
&gt; &gt; "redeemed\\_count" is set to)
&gt; &gt;
&gt; &gt;
&gt; &gt; My goal is to be able to do a key filtered Map Reduce job on
&gt; &gt; idx=redeemed\\_count=ccode that generates a list of all data key names
&gt; &gt; with a redeemed\\_count &lt; 50.
&gt; &gt;
&gt; &gt; The job (using curl) is here: https://gist.github.com/852451
&gt; &gt;
&gt; &gt; It errors out almost immediately in sasl-error.log
&gt; &gt; (https://gist.github.com/852450), but the request doesn't immediately
&gt; &gt; error out to the client. The only error the client sees is an eventual
&gt; &gt; timeout error.
&gt; &gt;
&gt; &gt; So my question is, what is the error in sasl-error.log telling me is
&gt; &gt; wrong with my job construction? And also, why is there only a timeout
&gt; &gt; error generated to the client instead of a map\\_reduce\\_error as I've
&gt; &gt; seen for non-key filtered jobs?
&gt; &gt;
&gt; &gt; Thank you in advance for any help. I greatly appreciate it.
&gt; &gt;
&gt; &gt; -J
&gt; &gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

