---
title: "Re: new cluster -- riak starts and dies on each vm."
description: ""
project: community
lastmod: 2013-09-15T11:20:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12269"
mailinglist_parent_id: "msg12268"
author_name: "Eric Redmond"
project_section: "mailinglistitem"
sent_date: 2013-09-15T11:20:08-07:00
---


Fwiw, that link is old, and should have redirected. The new perf tuning doc
is here.

http://docs.basho.com/riak/latest/ops/tuning/linux/

Eric
On Sep 15, 2013 10:56 AM, "Evan Vigil-McClanahan" 
wrote:

&gt; Riak is no longer built or tested on 32 bit machines, so that could
&gt; potentially be a problem.
&gt;
&gt; This document has some recommendations on tunings for linux that can
&gt; affect the OOM killer and VM system, most notably the vm.swappiness
&gt; sysctl:
&gt; http://docs.basho.com/riak/latest/cookbooks/Linux-Performance-Tuning/
&gt;
&gt; It could be that leveldb by default now maps more than 4GB of virtual
&gt; memory, expecting the large virtual memory spaces of 64 bit systems
&gt; and smart VM work to use memory efficiently. In that case, you'll
&gt; want to tune down the number of open files for leveldb, the number
&gt; write buffer bounds, and potentially the cache size, although that's
&gt; pretty low by default.
&gt;
&gt; On Sun, Sep 15, 2013 at 9:05 AM, Daniel Rathbone
&gt;  wrote:
&gt; &gt;
&gt; &gt; I'm setting up a new small riak cluster - 8 VMs, 4GB each. Riak starts
&gt; and
&gt; &gt; dies after a few seconds on each VM. I'd like to figure out why.
&gt; &gt;
&gt; &gt; I'm running riak 1.4.1, built from source on ubuntu 12.04 (32 bit). I
&gt; have
&gt; &gt; AAE and search turned off and my backend is set to leveldb. Ring size is
&gt; 64.
&gt; &gt; All the other settings are default.
&gt; &gt;
&gt; &gt; The crash.log files show errors that look like these:
&gt; &gt;
&gt; &gt; 2013-09-14 22:48:25 =SUPERVISOR REPORT====
&gt; &gt; Supervisor: {local,riak\\_core\\_vnode\\_proxy\\_sup}
&gt; &gt; Context: shutdown\\_error
&gt; &gt; Reason:
&gt; &gt;
&gt; {{{function\\_clause,[{riak\\_kv\\_vnode,terminate,[{bad\\_return\\_value,{stop,{db\\_open,"IO
&gt; &gt; error:
&gt; &gt;
&gt; ./data/leveldb/1027618338748291114361965898003636498195577569280/000002.dbtmp:
&gt; &gt; Cannot allocate
&gt; &gt;
&gt; memory"}}},undefined],[{file,"src/riak\\_kv\\_vnode.erl"},{line,838}]},{riak\\_core\\_vnode,terminate,3,[{file,"src/riak\\_core\\_vnode.erl"},{line,849}]},{gen\\_fsm,terminate,7,[{file,"gen\\_fsm.erl"},{line,586}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]},{gen\\_fsm,sync\\_send\\_event,[&lt;0.19541.3&gt;,wait\\_for\\_init,infinity]}},{gen\\_server,call,[riak\\_core\\_vnode\\_manager,{205523667749658222872393179600727299639115513856,riak\\_kv\\_vnode,get\\_vnode},infinity]}}
&gt; &gt; Offender:
&gt; &gt;
&gt; [{pid,&lt;0.471.0&gt;},{name,{riak\\_kv\\_vnode,205523667749658222872393179600727299639115513856}},{mfargs,{riak\\_core\\_vnode\\_proxy,start\\_link,[riak\\_kv\\_vnode,205523667749658222872393179600727299639115513856]}},{restart\\_type,permanent},{shutdown,5000},{child\\_type,worker}]
&gt; &gt;
&gt; &gt; 2013-09-14 22:48:25 =SUPERVISOR REPORT====
&gt; &gt; Supervisor: {local,riak\\_core\\_sup}
&gt; &gt; Context: child\\_terminated
&gt; &gt; Reason: shutdown
&gt; &gt; Offender:
&gt; &gt;
&gt; [{pid,&lt;0.151.0&gt;},{name,riak\\_core\\_vnode\\_proxy\\_sup},{mfargs,{riak\\_core\\_vnode\\_proxy\\_sup,start\\_link,[]}},{restart\\_type,permanent},{shutdown,5000},{child\\_type,supervisor}]
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; I don't understand why riak "Cannot allocate memory" as my system memory
&gt; use
&gt; &gt; is under 20%. Is there a config parameter I must change?
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt; Daniel
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

