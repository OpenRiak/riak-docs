---
title: "Re: Adding nodes to cluster"
description: ""
project: community
lastmod: 2015-01-24T13:47:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15586"
mailinglist_parent_id: "msg15585"
author_name: "Sargun Dhillon"
project_section: "mailinglistitem"
sent_date: 2015-01-24T13:47:42-08:00
---


1) Potentially re-enable AAE after migration. As your cluster gets
bigger, the likelihood of any node failing in the cluster goes up.
Replica divergence only becomes scarier in light of this. Losing data
!= awesome.

6) There shouldn't be any problems, but for safe measures you should
probably upgrade the old ones before the migration.



On Sat, Jan 24, 2015 at 1:31 PM, Edgar Veiga  wrote:
&gt; Sargun,
&gt;
&gt; Regarding 1) - AAE is disabled. We had a problems with it and there's a lot
&gt; of threads here in the mailing list regarding this. AAE won't stop using
&gt; more and more disk space and the only solution was disabling it! Since then
&gt; the cluster has been pretty stable...
&gt;
&gt; Regarding 6) Can you or anyone in basho confirm that there won't be any
&gt; problems using the latest (1.4.12) version of riak in the new nodes and only
&gt; upgrading the old ones after this process is completed?
&gt;
&gt; Thanks a lot for the other tips, you've been very helpful!
&gt;
&gt; Best regards,
&gt; Edgar
&gt;
&gt; On 24 January 2015 at 21:09, Sargun Dhillon  wrote:
&gt;&gt;
&gt;&gt; Several things:
&gt;&gt; 1) If you have data at rest that doesn't change, make sure you have
&gt;&gt; AAE, and it's ran before your cluster is manipulated. Given that
&gt;&gt; you're running at 85% space, I would be a little worried to turn it
&gt;&gt; on, because you might run out of disk space. You can also pretty
&gt;&gt; reasonably put the AAE trees on magnetic storage. AAE is nice in the
&gt;&gt; sense that you \\_know\\_ your cluster is consistent at a point in time.
&gt;&gt;
&gt;&gt; 2) Make sure you're getting SSDs of roughly the same quality. I've
&gt;&gt; seen enterprise SSDs get higher and higher latency as time goes on,
&gt;&gt; due to greater data protection features. We don't need any of that.
&gt;&gt; Basho\\_bench is your friend if you have the time.
&gt;&gt;
&gt;&gt; 3) Do it all in one go. This will enable handoffs more cleanly, and all at
&gt;&gt; once.
&gt;&gt;
&gt;&gt; 4) Do not add the new nodes to the load balancer until handoff is
&gt;&gt; done. At least experimentally, latency increases slightly on the
&gt;&gt; original cluster, but the target nodes have pretty awful latency.
&gt;&gt;
&gt;&gt; 5) Start with a handoff\\_limit of 1. You can easily raise this. If
&gt;&gt; things look good, you can increase it. We're not optimizing for the
&gt;&gt; total time to handoff, we really should be optimizing for individual
&gt;&gt; vnode handoff time.
&gt;&gt;
&gt;&gt; 6) If you're using Leveldb, upgrade to the most recent version of Riak
&gt;&gt; 1.4. There have been some improvements. 1.4.9 made me happier. I think
&gt;&gt; it's reasonable for the new nodes to start on 1.4.12, and the old
&gt;&gt; nodes to be switched over later.
&gt;&gt;
&gt;&gt; 7) Watch your network utilization. Keep your disk latency flat. Stop
&gt;&gt; it if it spikes. Start from enabling one node with the lowest usage
&gt;&gt; and see if it works.
&gt;&gt;
&gt;&gt;
&gt;&gt; These are the things I can think of immediately.
&gt;&gt;
&gt;&gt; On Sat, Jan 24, 2015 at 12:42 PM, Alexander Sicular 
&gt;&gt; wrote:
&gt;&gt; &gt; I would probably add them all in one go so you have one vnode migration
&gt;&gt; &gt; plan that gets executed. What is your ring size? How much data are we
&gt;&gt; &gt; talking about? It's not necessarily the number of keys but rather the total
&gt;&gt; &gt; amount of data and how quickly that data can move en mass between machines.
&gt;&gt; &gt;
&gt;&gt; &gt; -Alexander
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; @siculars
&gt;&gt; &gt; http://siculars.posthaven.com
&gt;&gt; &gt;
&gt;&gt; &gt; Sent from my iRotaryPhone
&gt;&gt; &gt;
&gt;&gt; &gt;&gt; On Jan 24, 2015, at 15:37, Ed  wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Hi everyone!
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; I have a riak cluster, working in production for about one year, with
&gt;&gt; &gt;&gt; the following characteristics:
&gt;&gt; &gt;&gt; - Version 1.4.8
&gt;&gt; &gt;&gt; - 6 nodes
&gt;&gt; &gt;&gt; - leveldb backend
&gt;&gt; &gt;&gt; - replication (n) = 3
&gt;&gt; &gt;&gt; ~ 3 billion keys
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; My ssd's are reaching 85% of capacity and we have decided to buy 6 more
&gt;&gt; &gt;&gt; nodes to expand the cluster.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Have you got any kind of advice on executing this operation or should I
&gt;&gt; &gt;&gt; just follow the documentation on adding new nodes to a cluster?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Best regards!
&gt;&gt; &gt;&gt; Edgar
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

