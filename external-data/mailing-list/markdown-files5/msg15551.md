---
title: "Re: RiakCS poor s3 upload speeds 2MB/s"
description: ""
project: community
lastmod: 2015-01-21T04:41:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15551"
mailinglist_parent_id: "msg15537"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2015-01-21T04:41:16-08:00
---


On 21 January 2015 at 15:22, Luke Bakken  wrote:
&gt; Hi Toby -
&gt;
&gt; Are you using the stock bitcask configuration for merging?

Hi Luke,
Yes, pretty much.

&gt; On Tue, Jan 20, 2015 at 5:07 PM, Toby Corkindale  wrote:
&gt;&gt; Hi Kota,
&gt;&gt; I had a bit of an off-list chat about this a while ago, plus continued
&gt;&gt; to investigate locally, and eventually achieved some faster speeds,
&gt;&gt; around 15MByte/sec writes.
&gt;&gt; Things that were changed:
&gt;&gt; \\* Adjusted Riak CS GC to be spread out over the cluster much more.
&gt;&gt; \\* Tweaked up the put buffers and concurrency further
&gt;&gt; \\* Moved most of the files out of CS and into Amazon S3+Glacier
&gt;&gt; \\* Switched from nginx to haproxy
&gt;&gt; \\* simplified firewalling for internal clients
&gt;&gt;
&gt;&gt; Each one of those changes made a small to modest improvement, but
&gt;&gt; overall combined to make a quite noticeable improvement.
&gt;&gt;
&gt;&gt; I did notice something odd though -- despite moving most of the data
&gt;&gt; out of the cluster, the disk-space-in-use by Riak is still very large
&gt;&gt; compared to the amount stored. I mean, we moved more than 90% of the
&gt;&gt; data out of the cluster, yet the actual disk space used only halved.
&gt;&gt; For every gigabyte of file stored in CS, dozens of gigabytes are
&gt;&gt; actually on disk!
&gt;&gt;
&gt;&gt; Either the garbage collection algorithm is very, very lazy, or somehow
&gt;&gt; something has gone a bit wrong in the past, which might have explained
&gt;&gt; part of the performance problems.
&gt;&gt;
&gt;&gt; We're going to look at redeploying a new, fresh cluster based on Riak
&gt;&gt; 2 in the not too distant future, once Riak CS looks like it's approved
&gt;&gt; for use there, and maybe that'll clear all of this up.
&gt;&gt;
&gt;&gt; Toby



-- 
Turning and turning in the widening gyre
The falcon cannot hear the falconer
Things fall apart; the center cannot hold
Mere anarchy is loosed upon the world

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

