---
title: "Re: Riak 2.0 Search Issues"
description: ""
project: community
lastmod: 2015-03-05T07:16:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15835"
mailinglist_parent_id: "msg15833"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-03-05T07:16:14-08:00
---


Hey Steve,

We’re currently tracking this issue, 
https://github.com/basho/yokozuna/issues/442 
, and are working on testing out 
a patch internally. I will update you as soon as we get clarity there.

As a possible workaround, I would attempt to delete the `core.properties` file 
located in the search root\\_directory/index of each node 
(./data/yz/&lt;&gt;). This file should then be recreated on the next 
attempt to creating the core on the Solr side, 
https://github.com/basho/yokozuna/blob/92ca14cc35b46c8e7ac86cad6d92547e68e8d917/src/yz\\_index.erl#L171
 
.

If that doesn’t work, you can then delete or `mv` that search-root/index 
directory out of the way, for which it will then get recreated and AAE will 
sync the data.

Thanks.

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\\_we\\_love | paperswelove.org
twitter =&gt; @zeeshanlakhani

&gt; On Mar 5, 2015, at 9:02 AM, Steve Garon  wrote:
&gt; 
&gt; In solr.log, the kind of exceptions that I'm getting right now is the 
&gt; following:
&gt; 
&gt; 1. IO Error while trying to get the size of the 
&gt; Directory:java.io.FileNotFoundException: SOME\\_RAMDOM\\_FILE (.doc, .pos, .fnm, 
&gt; .si, .nv, .gen extensions)
&gt; 2. SolrException.java:120 null:org.apache.sorl.common.SolrException: Core 
&gt; with name 'BUCKET NAME' already exists. 
&gt; 3. SolrException.java:120 null:org.eclipse.jetty.io.EofException
&gt; 4. Server refused connection 
&gt; 5. IOException occured when talking to server
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Steve
&gt; 
&gt; On 5 March 2015 at 08:50, Steve Garon  &gt; wrote:
&gt; Yes I do have yz\\_events,handle\\_info in crash log. Tons of them actually and 
&gt; they have a big ass strack trace attached to each of them.
&gt; 
&gt; It would be hard for me to provide you with logs. If you have specific 
&gt; questions you want answers to I'd be happy to help though.
&gt; 
&gt; 
&gt; Steve
&gt; 
&gt; On 4 March 2015 at 14:20, Zeeshan Lakhani  &gt; wrote:
&gt; Hey Steve,
&gt; 
&gt; Sorry to see you’re having new issues.
&gt; 
&gt; We’ll have the fix for “space in the key” out soon; it’s currently under 
&gt; review. And, I know that this issue is unrelated.
&gt; 
&gt; I have a few different routes/thoughts for you, but are you seeing anything 
&gt; related to `yz\\_events,handle\\_info` in your crash logs? Also, can you 
&gt; gist/pastebin me your solr logs? I’d like to seem if it correlates with 
&gt; something we’re currently looking at. 
&gt; 
&gt; Thanks. 
&gt; 
&gt; Zeeshan Lakhani
&gt; programmer | 
&gt; software engineer at @basho | 
&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org 
&gt; 
&gt; twitter =&gt; @zeeshanlakhani
&gt; 
&gt;&gt; On Mar 4, 2015, at 10:39 AM, Steve Garon &gt; &gt; wrote:
&gt;&gt; 
&gt;&gt; Hey all, 
&gt;&gt; 
&gt;&gt; We were having the "space in the key" bug in our cluster so we went through 
&gt;&gt; the whole dataset, backing it up to json file and removing the spaces in the 
&gt;&gt; keys. Then we trashed our whole cluster and restart from scratch reimporting 
&gt;&gt; the whole data. Everything worked like a charm for two weeks but this 
&gt;&gt; weekend, not sure what happened but AAE died again. 
&gt;&gt; 
&gt;&gt; I have two issues now: 
&gt;&gt; 1. AAE is trying to recreate an index that already exists and crashes with 
&gt;&gt; an "Already exists" error ... I get this in my error log every 15 seconds
&gt;&gt; 2. AAE crashes while iterating through entropy data with a request timeout 
&gt;&gt; error every hour followed by tons of failed to index objects with request 
&gt;&gt; timeout as well. Stack trace looks like this:
&gt;&gt; 
&gt;&gt; [error] emulator Error in process &lt;025931.7166&gt; on node 'riak@IP' with exit 
&gt;&gt; value: {function\\_clause,[{yz\\_entropy,iterate\\_entropy\\_data,[&lt;&lt;11 
&gt;&gt; bytes&gt;&gt;,[{continuation,&lt;&lt;159 
&gt;&gt; bytes&gt;&gt;},{limit,100},{partition,12}],#Fun&gt; (TRUNCATED)
&gt;&gt; 
&gt;&gt; [error] &lt;0.1371.0&gt;@yz\\_kv:index:215 failed to index object 
&gt;&gt; {{&lt;&lt;"TYPE"&gt;&gt;,&lt;&lt;"BUCKET"&gt;&gt;},&lt;&lt;"KEY"&gt;&gt;} with error {"Failed to index 
&gt;&gt; docs",{error,req\\_timeout}} because ... (REPEATED MULTIPLE TIME FOR DIFFERENT 
&gt;&gt; KEYS)
&gt;&gt; 
&gt;&gt; I tried clearing the yz anti-entropy tree and reinitialising the 
&gt;&gt; yz\\_entropy\\_mgr with no luck. Anything I can do to fix this? 
&gt;&gt; 
&gt;&gt; Oh FYI, I cannot insert data with spaces in the key anymore because we are 
&gt;&gt; using a wrapper on top of riak that will prevent us to do so therefore my 
&gt;&gt; issues are not related to this for sure.
&gt;&gt; 
&gt;&gt; These are some config changes that may be good to know for more context.
&gt;&gt; We added this to ibrowse.conf:
&gt;&gt; {dest, "localhost", 8093, 100, 1000, []}.
&gt;&gt; 
&gt;&gt; Jetty is set with minthread 80, acceptors 80, and is using the NIO connector.
&gt;&gt; 
&gt;&gt; All our solr buckets have filterCache disabled with softcommits set to 10s 
&gt;&gt; instead of 1.
&gt;&gt; 
&gt;&gt; Our riak.conf has background\\_manager turned on with AAE and handoff using it.
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Steve
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com 
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com 
&gt;&gt; 
&gt; 
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

