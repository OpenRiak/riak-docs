---
title: "Re: About Protocol Buffers"
description: ""
project: community
lastmod: 2014-06-23T07:57:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14349"
mailinglist_parent_id: "msg14348"
author_name: "Alex De la rosa"
project_section: "mailinglistitem"
sent_date: 2014-06-23T07:57:03-07:00
---


Hi Sean,

Thanks for your quick reply, is what i suspected, moreover after checking
riak.proto file in the source. So mainly the contents to store (json or not
json) is not PB encoded semantically, but is encoded as a "body" field in
the Message. That's good though.

Another question... is there any estimated date for Riak 2.0 to be
released? I'm playing with 2.0 beta 1 and the "list" object is a must-have
for me (same as the "counter" object that can be found in Riak 1.4).

Is crucial for me to decide which technologies to use in my new project; so
far Riak 2.0 seems a great option, but I can not build under a beta.

Another question now that I talk about "counters"... how do you do it with
Python's PBC? I can see the functions: RiakClient.get\\_counter()
and RiakClient.update\\_counter()... but... how do you create a new counter?
how do you specify the special connotations to the bucket?

Thanks,
Alex


On Mon, Jun 23, 2014 at 4:38 PM, Sean Cribbs  wrote:

&gt; Hi Alex,
&gt;
&gt; By default, the client assumes new objects use JSON as the encoding. The
&gt; protocol buffers are only used on the wire to encode Riak's protocol. If
&gt; you want to use your own protobuffs messages, I suggest two things:
&gt;
&gt; 1. Decide on a `content\\_type` property for each of your data types and be
&gt; sure to assign that to each key as you create it. I've used
&gt; 'application/pb-person' as an example below.
&gt; 2. Register encoder and decoder functions [1] on the RiakClient object,
&gt; like so:
&gt;
&gt; client.set\\_decoder('application/pb-person', Person.ParseFromString)
&gt; client.set\\_encoder('application/pb-person', lambda x:
&gt; x.SerializeToString())
&gt;
&gt; [1]
&gt; http://riak-python-client.readthedocs.org/en/latest/client.html#serialization
&gt;
&gt; Cheers,
&gt;
&gt;
&gt; On Mon, Jun 23, 2014 at 9:19 AM, Alex De la rosa 
&gt; wrote:
&gt;
&gt;&gt; Hi there,
&gt;&gt;
&gt;&gt; I just installed RIAK 2.0 beta 1 and was playing with the Python library
&gt;&gt; using 'pbc' (Protocol Buffers).
&gt;&gt;
&gt;&gt; test.py
&gt;&gt;
&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt; import riak
&gt;&gt; client = riak.RiakClient(host ='127.0.0.1', http\\_port = 8098, pb\\_port =
&gt;&gt; 8087, protocol = 'pbc')
&gt;&gt; bucket = client.bucket('people')
&gt;&gt;
&gt;&gt; key = bucket.new('alex', data={"username":"Alex","age":33})
&gt;&gt; key.store()
&gt;&gt;
&gt;&gt; print bucket.get('alex').encoded\\_data
&gt;&gt;
&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;
&gt;&gt; it works perfectly and it prints {"username": "Alex", "age": 33} as it
&gt;&gt; should print.
&gt;&gt;
&gt;&gt; However, I'm not using a proto file (person.proto) and compiling it into
&gt;&gt; binary for Python to use it... something like:
&gt;&gt;
&gt;&gt; person.proto
&gt;&gt;
&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt; message Person {
&gt;&gt; required string username = 1;
&gt;&gt; required int32 age = 2;
&gt;&gt; }
&gt;&gt;
&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;
&gt;&gt; xxx.py
&gt;&gt;
&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt; import person\\_pb2
&gt;&gt; person = person\\_pb2.Person()
&gt;&gt; person.username = "Alex"
&gt;&gt; person.age = 33
&gt;&gt; data = person.SerializeToString()
&gt;&gt;
&gt;&gt; --------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
&gt;&gt;
&gt;&gt; Am I using the 'pbc' interface wrong? however, on Riak's examples page is
&gt;&gt; done also without the "proto" file... I'm a bit confused at the moment as
&gt;&gt; it changed the way I normally would use Protocol Buffers.
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Alex
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

