---
title: "Re: too_many_results error"
description: ""
project: community
lastmod: 2011-03-03T05:07:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02539"
mailinglist_parent_id: "msg02537"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2011-03-03T05:07:06-08:00
---


Hi John,

It sounds like there might be a misunderstanding here. The error is not
indicating that the index has grown to large, it's indicating that you are
running a query with many, many results - enough to potentially gobble up
all of your memory. Rather than let this happen, Riak Search tries to detect
the situation and fails the query rather than crashing.

The intention is that most people will never bump up against the max\\_results
setting. The few who do will have special use cases with especially large
queries, and when this happens, it's going to require just a little testing
and tuning to find a number that is large enough to handle their queries
while still small enough to prevent memory exhaustion. It sounds like you
fall into this situation. If you are running on big servers, you can safely
bump up the number, the value depends on both your available memory and your
object size.

Best,
Rusty



On Thu, Mar 3, 2011 at 6:42 AM, John Axel Eriksson  wrote:

&gt; Well, I'm in this situation atm. I guess I could go and change the
&gt; max\\_results setting but really - this actually
&gt; means that I can't search my data and to me, it's more important to be able
&gt; to search than to get an error when
&gt; my index has grown too large. I understand that there's nothing for this in
&gt; the solr spec, but getting an error because
&gt; I've indexed too much data is kind of unexpected.
&gt;
&gt; I'm not familiar with the internals but I would've expected the rows
&gt; parameter to be applied before the max\\_results limit - not
&gt; the other way around. I suspect there's a reason for this, but still - my
&gt; data is now in an unsearchable state.
&gt;
&gt; 16 jan 2011 kl. 15.06 skrev Rusty Klophaus:
&gt;
&gt; That's one way of looking at it. The other viewpoint is that given the
&gt; choice between returning a partial (a.k.a. incorrect) result set vs. failing
&gt; loudly, the safest option is to fail loudly.
&gt;
&gt; Ideally there would be a way to return a partial result set with an
&gt; indication in Solr that the result set is partial, but:
&gt;
&gt; 1) The Solr spec doesn't indicate a way to include such a message (at least
&gt; none that I could find)
&gt; 2) This is the first iteration of this feature, so we decided to keep it
&gt; simple until we have more detailed information on what people need.
&gt;
&gt; So with that in mind, how would you prefer this be handled? I'm open to
&gt; rethinking the behavior.
&gt;
&gt; Best,
&gt; Rusty
&gt;
&gt;
&gt; On Sun, Jan 16, 2011 at 8:53 AM, Eric Moritz wrote:
&gt;
&gt;&gt; That sounds like a bug rather that a feature to me. For instance if I
&gt;&gt; wrote 100,001 blog entries, the search engine breaks hard for a query trying
&gt;&gt; to find my latest tweets.
&gt;&gt;
&gt;&gt; Is that what would happen?
&gt;&gt; ---------- Forwarded message ----------
&gt;&gt; From: "Rusty Klophaus" 
&gt;&gt; Date: Jan 16, 2011 8:42 AM
&gt;&gt; Subject: Re: Re: too\\_many\\_results error
&gt;&gt; To: "Eric Moritz" 
&gt;&gt; Cc: "riak-users@lists.basho.com" 
&gt;&gt;
&gt;&gt; Hi Eric,
&gt;&gt;
&gt;&gt; This is a failsafe that is applied prior to the 'rows' parameter.
&gt;&gt;
&gt;&gt; It is applied separately to provide a hard system limit, intended to allow
&gt;&gt; the cluster administrator to guard against a malicious user, a client
&gt;&gt; application that accidentally requests too much data, etc.
&gt;&gt;
&gt;&gt; Best,
&gt;&gt; Rusty
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sun, Jan 16, 2011 at 8:38 AM, Eric Moritz wrote:
&gt;&gt;
&gt;&gt;&gt; Would using the rows URL parameter fix this or is the error occurring
&gt;&gt;&gt; prior to the result being limited?
&gt;&gt;&gt; ---------- Forwarded message ----------
&gt;&gt;&gt; From: "Rusty Klophaus" 
&gt;&gt;&gt; Date: Jan 16, 2011 8:34 AM
&gt;&gt;&gt; Subject: Re: too\\_many\\_results error
&gt;&gt;&gt; To: "Malka Feldman" 
&gt;&gt;&gt; Cc: 
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Malka,
&gt;&gt;&gt;
&gt;&gt;&gt; The error you see is caused by a protective configuration setting that is
&gt;&gt;&gt; new in the 0.14 release. By default, the system will stop the query after
&gt;&gt;&gt; 100,000 results and return an error to the system. It is intended to prevent
&gt;&gt;&gt; Riak Search from grabbing all available memory when faced with a large
&gt;&gt;&gt; result set.
&gt;&gt;&gt;
&gt;&gt;&gt; You can override this by setting the 'max\\_search\\_results' setting in the
&gt;&gt;&gt; etc/app.config file.
&gt;&gt;&gt;
&gt;&gt;&gt; Best,
&gt;&gt;&gt; Rusty
&gt;&gt;&gt;
&gt;&gt;&gt; On Sun, Jan 16, 2011 at 7:11 AM, Malka Feldman wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi
&gt;&gt;&gt;&gt; I try to get results from query through solr , but I get the error of
&gt;&gt;&gt;&gt; too many results
&gt;&gt;&gt;&gt; the query is :
&gt;&gt;&gt;&gt; http://79.125.59.136:8098/solr/user\\_profile/select?q=country:USA
&gt;&gt;&gt;&gt; I know I can have hundreds of thousands of answers, can it hold them?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; the error :
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {error,
&gt;&gt;&gt;&gt; {throw,
&gt;&gt;&gt;&gt; {too\\_many\\_results,
&gt;&gt;&gt;&gt; {scope,#Ref&lt;0.0.78.140604&gt;,"user\\_profile","value",
&gt;&gt;&gt;&gt; {scope,#Ref&lt;0.0.78.140603&gt;,undefined,"country",
&gt;&gt;&gt;&gt; {term,#Ref&lt;0.0.78.140609&gt;,&lt;&lt;"USA"&gt;&gt;,
&gt;&gt;&gt;&gt; [{'riak@10.230.7.111',28438},
&gt;&gt;&gt;&gt; {'riak@10.230.21.243',28438},
&gt;&gt;&gt;&gt; {'riak@10.230.45.195',28438}],
&gt;&gt;&gt;&gt; 28438.0,1.0,
&gt;&gt;&gt;&gt; #Fun}}}},
&gt;&gt;&gt;&gt; [{riak\\_search\\_client,'-search/5-fun-0-',4},
&gt;&gt;&gt;&gt; {riak\\_search\\_client,fold\\_results,5},
&gt;&gt;&gt;&gt; {riak\\_search\\_client,search,6},
&gt;&gt;&gt;&gt; {riak\\_search\\_client,search\\_doc,6},
&gt;&gt;&gt;&gt; {riak\\_solr\\_searcher\\_wm,run\\_query,1},
&gt;&gt;&gt;&gt; {riak\\_solr\\_searcher\\_wm,to\\_xml,2},
&gt;&gt;&gt;&gt; {webmachine\\_resource,resource\\_call,3},
&gt;&gt;&gt;&gt; {webmachine\\_resource,do,3}]}}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; thanks,
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\*Malka Feldman\\*
&gt;&gt;&gt;&gt; Tribase LTD.
&gt;&gt;&gt;&gt; 41 Shimon Hatzadik St.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Elad, Israel
&gt;&gt;&gt;&gt; Tel. 074-7122736 Fax. 03-9075211 Cell. 972-54-8370828
&gt;&gt;&gt;&gt; m al...@3basegroup.com
&gt;&gt;&gt;&gt; www.3basegroup.com 
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; [image: cid:image001.jpg@01CB2DDB.3AC492C0]
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

