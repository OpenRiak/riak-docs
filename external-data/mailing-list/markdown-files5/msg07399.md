---
title: "Re: Riak cluster unresponsive after single node failure"
description: ""
project: community
lastmod: 2012-05-08T11:12:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07399"
mailinglist_parent_id: "msg07398"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-05-08T11:12:40-07:00
---


Hey Armon,

So "monitor busy\\_dist\\_port" means your nodes aren't talking but we need to
figure out why. Specifically it looks like you're kv vnodes aren't able to
communicate.

First questions

\\* Which backend are you using?
\\* What OS?
\\* What size are your values?
\\* What is the typical traffic (ops/second) on the cluster?

Also, if you could send a copy of your vm.args (probably best off-list)
that would be helpful, too.

Mark

On Tue, May 8, 2012 at 10:25 AM, Armon Dadgar wrote:

&gt; We are currently running a 4 node cluster with 1.1.2 on Ubuntu 10.04, and
&gt; are experiencing an issue where losing a single node has cause the entire
&gt; cluster to fail.
&gt;
&gt; Nagios reported that node 1 had failed, shortly after, all the logs are
&gt; filled with:
&gt; 2012-05-08 08:13:22.319 [error] &lt;0.27873.2568&gt;@riak\\_kv\\_put\\_fsm:prepare:199
&gt; Unable to forward put for
&gt; {&lt;&lt;"session"&gt;&gt;,&lt;&lt;"3a538aaa-b503-4a2e-94f9-7b62074815c7"&gt;&gt;} to '
&gt; r...@east-riak-001.cluster.kiip.me' - nodedown
&gt; 2012-05-08 08:21:11.890 [error]
&gt; &lt;0.16614.2569&gt;@riak\\_core\\_handoff\\_sender:start\\_fold:178 Handoff of partition
&gt; riak\\_kv\\_vnode 456719261665907161938651510223838443642478919680 from '
&gt; r...@east-riak-004.cluster.kiip.me' to 'r...@east-riak-001.cluster.kiip.me'
&gt; failed exit:{noproc,{gen\\_server2,call,[{riak\\_kv\\_handoff\\_listener,'
&gt; r...@east-riak-001.cluster.kiip.me'},handoff\\_port,infinity]}}
&gt; 2012-05-08 08:23:18.005 [error] &lt;0.19071.2569&gt;@riak\\_kv\\_put\\_fsm:prepare:199
&gt; Unable to forward put for
&gt; {&lt;&lt;"session"&gt;&gt;,&lt;&lt;"7a015cff-d361-4a38-a624-004f3e7bc76a"&gt;&gt;} to '
&gt; r...@east-riak-001.cluster.kiip.me' - timeout
&gt; 2012-05-08 08:23:21.312 [error] &lt;0.19178.2569&gt;@riak\\_kv\\_put\\_fsm:prepare:199
&gt; Unable to forward put for
&gt; {&lt;&lt;"session"&gt;&gt;,&lt;&lt;"b9bd30fa-ddba-4219-b1d9-e4b761797615"&gt;&gt;} to '
&gt; r...@east-riak-001.cluster.kiip.me' - timeout
&gt; ...
&gt; 2012-05-08 08:30:26.379 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor busy\\_dist\\_port
&gt; &lt;0.4921.2570&gt;
&gt; [{initial\\_call,{riak\\_kv\\_put\\_fsm,init,1}},{almost\\_current\\_function,{erlang,bif\\_return\\_trap,1}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.35446433&gt;,'r...@east-riak-001.cluster.kiip.me'}
&gt; 2012-05-08 08:30:26.556 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:89 Monitor got
&gt; {suppressed,port\\_events,7}
&gt; 2012-05-08 08:30:26.616 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor busy\\_dist\\_port
&gt; &lt;0.4930.2570&gt;
&gt; [{initial\\_call,{riak\\_kv\\_put\\_fsm,init,1}},{almost\\_current\\_function,{erlang,bif\\_return\\_trap,1}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.35446433&gt;,'r...@east-riak-001.cluster.kiip.me'}
&gt; 2012-05-08 08:30:27.565 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:89 Monitor got
&gt; {suppressed,port\\_events,4}
&gt; 2012-05-08 08:30:27.668 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor busy\\_dist\\_port
&gt; &lt;0.3151.2570&gt;
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{erlang,bif\\_return\\_trap,1}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.35446433&gt;,'r...@east-riak-001.cluster.kiip.me'}
&gt; ...
&gt; 2012-05-08 10:20:30.088 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor busy\\_dist\\_port
&gt; &lt;0.31200.2576&gt; [{initial\\_call,{riak\\_kv\\_put\\_fsm,init,1}},{almost\\_curren
&gt; t\\_function,{erlang,bif\\_return\\_trap,1}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.35534018&gt;,'r...@east-riak-001.cluster.kiip.me'}
&gt; 2012-05-08 10:20:31.261 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor busy\\_dist\\_port
&gt; &lt;0.31202.2576&gt; [{initial\\_call,{riak\\_kv\\_put\\_fsm,init,1}},{almost\\_curren
&gt; t\\_function,{erlang,bif\\_return\\_trap,1}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.35534018&gt;,'r...@east-riak-001.cluster.kiip.me'}
&gt; 2012-05-08 10:20:32.736 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor busy\\_dist\\_port
&gt; &lt;0.1629.2570&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current
&gt; \\_function,{erlang,bif\\_return\\_trap,1}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.35534018&gt;,'r...@east-riak-001.cluster.kiip.me'}
&gt; 2012-05-08 10:20:33.552 [info]
&gt; &lt;0.77.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:89 Monitor got
&gt; {suppressed,port\\_events,3}
&gt;
&gt; Now all the logs are basically being completely filled with "monitor
&gt; busy\\_dist\\_port &lt;0.22647.2610&gt;
&gt; [{initial\\_call,{riak\\_kv\\_put\\_fsm,init,1}},{almost\\_current\\_function,{erlang,bif\\_return\\_trap,1}},{message\\_queue\\_len,0}]
&gt; {#Port&lt;0.35563927&gt;,'r...@east-riak-001.cluster.kiip.me'}" or similar.
&gt;
&gt; Riak-admin is unable to report any information about the cluster, and same
&gt; with Riak Control.
&gt; Both just timeout and return:
&gt;
&gt; production-vpc east-riak-002 riak $ riak-admin ring\\_status
&gt; Attempting to restart script through sudo -u riak
&gt; RPC to 'r...@east-riak-002.cluster.kiip.me' failed: {'EXIT',
&gt; {timeout,
&gt; {gen\\_server,call,
&gt; [riak\\_core\\_gossip,
&gt; legacy\\_gossip]}}}
&gt;
&gt; At this point, the cluster has stopped responding to any requests as far
&gt; as I can tell,
&gt; or any operations that do complete take well over 60 seconds for a single
&gt; put with w=1.
&gt;
&gt; Wondering if anybody else has seen this, and if so any advise for getting
&gt; it resolved?
&gt;
&gt; Best Regards,
&gt;
&gt; Armon Dadgar
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

