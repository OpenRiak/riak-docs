---
title: "Re: Backup/restore progress/ETA?"
description: ""
project: community
lastmod: 2013-08-23T03:38:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12123"
mailinglist_parent_id: "msg11941"
author_name: "Denis Zhdanov"
project_section: "mailinglistitem"
sent_date: 2013-08-23T03:38:58-07:00
---


Hi All,

Also just tried to restore production data on testing cluster. As you can
see on image - http://s8.postimg.org/eu201p9d1/riak\\_rstore.png - it starts
at 480 op/sec and quickly drops to asymptotical 50... We have several
millions of keys, so, it will literally takes ages to restore all data.
Backing up individual bitcask/ring directories and restoring with reip
working like a charm, but require complete stop of testing cluster
operations.

With best regards,
 Denis.


2013/8/8 Guillermo 

&gt; Having the same problem. Still running a restore of 2.7 gb. In my case is
&gt; 1M keys of 1kb average, and a dump file of 2.7Gb.
&gt; Was running for at least one day already.
&gt; The cpu in that node is 100% (seems like only one core being used).
&gt;
&gt; The backup was done in another cluster with smaller instances, and only
&gt; take 15 min.
&gt;
&gt; Attached is riak-admin top.
&gt; riak\\_control\\_session is always the one in the top.
&gt;
&gt; ---
&gt;
&gt; Load: cpu 8 Memory: total 256505 binary
&gt;&gt; 8984
&gt;&gt; procs 3275 processes 183808 code
&gt;&gt; 11393
&gt;&gt; runq 0 atom 613 ets
&gt;&gt; 9604
&gt;&gt; Pid Name or Initial Func Time Reds
&gt;&gt; Memory MsgQ Current Function
&gt;&gt;
&gt;&gt; -------------------------------------------------------------------------------------------------------------------------------
&gt;&gt; &lt;6167.1386.0&gt; riak\\_control\\_session '-' 706921
&gt;&gt; 972024 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.150.0&gt; riak\\_core\\_vnode\\_manager '-' 47456
&gt;&gt; 386472 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.88.0&gt; memsup '-' 15537
&gt;&gt; 88448 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.91.0&gt; erlang:apply/2 '-' 10115
&gt;&gt; 2600 0 cpu\\_sup:measurement\\_server\\_loop/1
&gt;&gt; &lt;6167.759.0&gt; riak\\_kv\\_stat\\_sj\\_3 '-' 5542
&gt;&gt; 5720 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.760.0&gt; riak\\_kv\\_stat\\_sj\\_4 '-' 4819
&gt;&gt; 5720 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.758.0&gt; riak\\_kv\\_stat\\_sj\\_2 '-' 4195
&gt;&gt; 2704 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.734.0&gt; riak\\_kv\\_put\\_fsm\\_sj\\_2 '-' 4160
&gt;&gt; 8736 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.80.0&gt; riak\\_sysmon\\_filter '-' 4158
&gt;&gt; 13656 0 gen\\_server:loop/6
&gt;&gt; &lt;6167.167.0&gt; riak\\_core\\_stat\\_cache '-' 3293
&gt;&gt; 21512 0 gen\\_server:loop/6
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Wed, Aug 7, 2013 at 10:42 PM, Justin  wrote:
&gt;
&gt;&gt; Would you expect a restore of this size to take this long?
&gt;&gt;
&gt;&gt; My cluster is comprised of 6 nodes, bitcask, and ring size of 128.
&gt;&gt;
&gt;&gt; Total of 1.2 million keys/objects in a single bucket.
&gt;&gt;
&gt;&gt; I have some fairly large objects. A few, less than 10, are around if not
&gt;&gt; greater than 1GB. Less than 1000 are greater than 10MB but less than 100MB.
&gt;&gt;
&gt;&gt; Hope this helps. Thanks
&gt;&gt; On Aug 6, 2013 3:34 PM, "Justin"  wrote:
&gt;&gt;
&gt;&gt;&gt; Hey Mark,
&gt;&gt;&gt;
&gt;&gt;&gt; ~ 613GB
&gt;&gt;&gt;
&gt;&gt;&gt; ls -lhtra /var/lib/riak/backups/all\\_nodes.20130725.bak
&gt;&gt;&gt; -rw-r--r-- 1 riak riak 613G Jul 25 20:47
&gt;&gt;&gt; /var/lib/riak/backups/all\\_nodes.20130725.bak
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Aug 6, 2013 at 2:24 PM, Mark Phillips  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Justin,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; For starters, how much data are you restoring?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Mark
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Mon, Aug 5, 2013 at 2:46 PM, Justin  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hello all,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Is there any way to determine progress/percent complete?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; This has been running for 3 days now. I figured it would finish over
&gt;&gt;&gt;&gt;&gt; the weekend but it hasn't.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # riak-admin restore riak@ riak
&gt;&gt;&gt;&gt;&gt; /var/lib/riak/backups/all\\_nodes.20130725.bak
&gt;&gt;&gt;&gt;&gt; Restoring from '/var/lib/riak/backups/all\\_nodes.20130725.bak' to
&gt;&gt;&gt;&gt;&gt; cluster to which 'riak@ belongs.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I'm reluctant to kill it. It could be nearly complete OR it could be 3
&gt;&gt;&gt;&gt;&gt; more days from finishing. The alternative is to clear my Riak cluster and
&gt;&gt;&gt;&gt;&gt; re-import/ETL the data from scratch, which takes at least 5 days.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; In addition to determining progress for "restore", I'm also interested
&gt;&gt;&gt;&gt;&gt; in determining progress for "backup".
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks for the help.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Kind regards,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Guillermo √Ålvarez
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

