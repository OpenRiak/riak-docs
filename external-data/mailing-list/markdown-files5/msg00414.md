---
title: "Re: Storage of time-series data"
description: ""
project: community
lastmod: 2010-05-18T17:06:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00414"
mailinglist_parent_id: "msg00407"
author_name: "Joel Pitt"
project_section: "mailinglistitem"
sent_date: 2010-05-18T17:06:41-07:00
---


Thanks Sean. Looks like 3 might be the best plan.

And, pre/post-commit hooks... cool! I didn't see those - that's
something I've been looking for (since I'd prefer to keep that kind of
stuff happening on the data nodes rather than in the client/app
itself).

One further question, is there any limitation to how the number of
buckets can scale? If you're recommending using them to box data by
minute I'm guessing that # buckets can increase without worry, but is
this still the case if say I started binning into buckets by second?

J

On Wed, May 19, 2010 at 1:53 AM, Sean Cribbs  wrote:
&gt; Joel,
&gt;
&gt; Riak's only query mechanism aside from simple key retrieval is map-reduce.  
&gt; However, there are a number of strategies you could take, depending on what 
&gt; you want to query. I don't know the requirements of your application, but 
&gt; here are some options:
&gt;
&gt; 1) Store the data either keyed on the timestamp, or as separate objects 
&gt; linked from a timestamp object.
&gt; 2) Create buckets for each time-window you want to track.  For example, if I 
&gt; wanted to box data by minute, I'd make bucket names that look like: 
&gt; 2010-05-18T09.46.  Then if I want all the data from that minute, I'd run a 
&gt; map-reduce query with that bucket name as the inputs.
&gt; 3) Create your own secondary indexes with a post-commit hook or code in your 
&gt; application for year, month, day, etc.  The secondary index would be, like 
&gt; #1, keys that only contain links to the actual data.
&gt;
&gt; With any of these options (which are by no means exhaustive), your map-reduce 
&gt; query will need to sort the data in a reduce phase if you require 
&gt; chronological ordering. Also, if you're building your own indexes in separate 
&gt; buckets, depending on the write throughput of your application, you might 
&gt; want to build in some sort of conflict resolution and turn on allow\\_mult so 
&gt; that concurrent updates are not lost.
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; On May 17, 2010, at 8:31 PM, Joel Pitt wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I'm trying to work out the best way of storing temporal data in Riak.
&gt;&gt;
&gt;&gt; I've been investigating several NoSQL solutions and originally started
&gt;&gt; out using CouchDB, however I want to move to a db that scales more
&gt;&gt; gradually (CouchDB scales, but you really have to set up the
&gt;&gt; architecture before-hand and I'd prefer to be able to build a cluster
&gt;&gt; a node at a time)
&gt;&gt;
&gt;&gt; In CouchDB, I use a multi-level key in a map-reduce view to create an
&gt;&gt; index by time. Each reduce level corresponds to year, month, day,
&gt;&gt; time... so I can easily get aggregate data for say a month.
&gt;&gt;
&gt;&gt; In addition to Riak I'm investigating Cassandra. In Cassandra the way
&gt;&gt; to store time series is by making the column keys timestamps and
&gt;&gt; sorting columns by TimeUUID. This allows one to do slices across a
&gt;&gt; range of time. This isn't exactly the same as what I have in CouchDB,
&gt;&gt; but by consensus it seems to be the way to store a time index.
&gt;&gt;
&gt;&gt; Any suggestions for working with or creating time indexes in Riak?
&gt;&gt;
&gt;&gt; Ideally I'd be able to query documents with a time range to either get
&gt;&gt; the documents, or to calculate aggregate statistics using a map-reduce
&gt;&gt; task.
&gt;&gt;
&gt;&gt; Any information appreciated :-)
&gt;&gt;
&gt;&gt; Joel Pitt, PhD | http://ferrouswheel.me | +64 21 101 7308
&gt;&gt; NetEmpathy Co-founder | http://netempathy.com
&gt;&gt; OpenCog Developer | http://opencog.org
&gt;&gt; Board member, Humanity+ | http://humanityplus.org
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

