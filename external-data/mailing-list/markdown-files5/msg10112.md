---
title: "Re: Tune Riak for fast inserts - populate DB"
description: ""
project: community
lastmod: 2013-02-13T01:53:08-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10112"
mailinglist_parent_id: "msg10111"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2013-02-13T01:53:08-08:00
---



On 13 Feb 2013, at 09:44, Bogdan Flueras  wrote:

&gt; Ok, so I've done something like this:
&gt; Bucket bucket = client.createBucket("foo"); // lastWriteWins(true) doesn't 
&gt; work for Protobuf
&gt; 
&gt; when I insert I have:
&gt; bucket.store(someKey, someValue).withoutFetch().pw(1).execute();
&gt; 
&gt; It looks like it's 20% faster than before. Is there something I could further 
&gt; tweak ?

The .pw(1) is redundant. All riak inserts are pw(1) by default. Setting last 
write wins will get you a speed gain, since it means the riak node will not 
attempt a read before it writes your data. Maybe use the HTTP client to set 
this property?

How many threads are you using? How are you getting the data to be written to 
the writing processes?

Cheers

Russell

&gt; 
&gt; ing. Bogdan Flueras
&gt; 
&gt; 
&gt; 
&gt; On Wed, Feb 13, 2013 at 10:19 AM, Bogdan Flueras  
&gt; wrote:
&gt; Each thread has it's own bucket instance (pointing to the same location) and 
&gt; I don't re-fetch the bucket per insert.
&gt; Thank you very much!
&gt; 
&gt; ing. Bogdan Flueras
&gt; 
&gt; 
&gt; 
&gt; On Wed, Feb 13, 2013 at 10:14 AM, Russell Brown  wrote:
&gt; 
&gt; On 13 Feb 2013, at 08:07, Bogdan Flueras  wrote:
&gt; 
&gt; &gt; How to set the bucket to last write? Is it in the builder?
&gt; 
&gt; Something like:
&gt; 
&gt; Bucket b = client.createBucket("my\\_bucket").lastWriteWins(true);
&gt; 
&gt; Also, after you've created the bucket, do you use it from all threads? You 
&gt; don't re-fetch the bucket per-insert operation, do you?
&gt; 
&gt; But the "withoutFecth()" option is probably going to be the biggest 
&gt; performance increase, and safe if you are only doing inserts.
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; &gt; I'll have a look..
&gt; &gt; Yes, I use more threads and the bucket is configured to spread the load 
&gt; &gt; across all nodes.
&gt; &gt;
&gt; &gt; Thanks, I'll have a deeper look into the API and let you know about my 
&gt; &gt; results.
&gt; &gt;
&gt; &gt; ing. Bogdan Flueras
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Feb 13, 2013 at 10:02 AM, Russell Brown  
&gt; &gt; wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; On 13 Feb 2013, at 07:37, Bogdan Flueras  wrote:
&gt; &gt;
&gt; &gt; &gt; Hello all,
&gt; &gt; &gt; I've got a 5 node cluster with Riak 1.2.1, all machines are multicore,
&gt; &gt; &gt; with min 4GB RAM.
&gt; &gt; &gt;
&gt; &gt; &gt; I want to insert something like 50 million records in Riak with the java 
&gt; &gt; &gt; client (Protobuf used) with default settings. I've tried also with HTTP 
&gt; &gt; &gt; protocol and set w = 1 but got some problems.
&gt; &gt; &gt;
&gt; &gt; &gt; However the process is very slow: it doesn't write more than 6GB/ hour or 
&gt; &gt; &gt; aprox. 280 KB/second.
&gt; &gt; &gt; To have all my data filled in, it would take aprox 2 days !!
&gt; &gt; &gt;
&gt; &gt; &gt; What can I do to have the data filled into Riak ASAP?
&gt; &gt; &gt; How should I configure the cluster ? (vm.args/ app.config) I don't care 
&gt; &gt; &gt; so much about consistency at this point.
&gt; &gt;
&gt; &gt; If you are certain to be only inserting new data setting your bucket(s) to 
&gt; &gt; last write wins will speed things up. Also, are you using multiple threads 
&gt; &gt; for the Java client insert? Spreading the load across all five nodes? Are 
&gt; &gt; you using the "withoutFetch()" option on the java client?
&gt; &gt;
&gt; &gt; Cheers
&gt; &gt;
&gt; &gt; Russell
&gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Thank you,
&gt; &gt; &gt; ing. Bogdan Flueras
&gt; &gt; &gt;
&gt; &gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt; 
&gt; 
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

