---
title: "Re: Deleting items from search index increases disk usage"
description: ""
project: community
lastmod: 2012-10-29T05:20:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09069"
mailinglist_parent_id: "msg09065"
author_name: "Jeremy Raymond"
project_section: "mailinglistitem"
sent_date: 2012-10-29T05:20:11-07:00
---


So the only way to actually free the disk space consumed by the
tombstones in the search index is to bring down the cluster and blow
away the merge index (at /var/lib/riak/merge\\_index)?

--
Jeremy


On Fri, Oct 26, 2012 at 9:14 AM, Jeremy Raymond  wrote:
&gt; Yes I've read about the tombstoning, but figured writing the tombstone
&gt; would overwrite the existing item (at worst the data usage would stay
&gt; the same) vs writing something new (the data usage is growing).
&gt;
&gt; In another list post [2] from John M he outlines the tombstone removal
&gt; behaviour. I've just re-read this. With the default settings for Riak,
&gt; to have the tombstones removed from the search index I'll need to read
&gt; the deleted items again (but not the actual items, I'd need to read
&gt; the item's index somehow)?
&gt;
&gt; [2]:http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-October/006048.html
&gt;
&gt; --
&gt; Jeremy
&gt;
&gt;
&gt; On Fri, Oct 26, 2012 at 8:40 AM, Vladimir Shapovalov
&gt;  wrote:
&gt;&gt; Hi Jeremy,
&gt;&gt;
&gt;&gt; As far I'm concerned, delete operation doesn't delete the data physically,
&gt;&gt; just mark it as deleted. I've encountered that problem a while ago and was
&gt;&gt; also surprised about that fact that the data grows instead of reduce.
&gt;&gt;
&gt;&gt; Cheers
&gt;&gt; Vladimir
&gt;&gt;
&gt;&gt; On Fri, Oct 26, 2012 at 2:26 PM, Jeremy Raymond  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; I had Riak search enabled on a bucket containing millions of items. I
&gt;&gt;&gt; no longer need these items to be searchable so I uninstalled search on
&gt;&gt;&gt; the bucket via search-cmd. I'm looking to free the space consumed by
&gt;&gt;&gt; the search index for this bucket. Following a previous post [1] on
&gt;&gt;&gt; this list I'm deleting the items from the search index by running
&gt;&gt;&gt; search:delete\\_docs/1. After getting through about 1 million items I'm
&gt;&gt;&gt; seeing a noticeable increase in disk usage across the 3 node cluster,
&gt;&gt;&gt; an increase of about 7GB per node.
&gt;&gt;&gt;
&gt;&gt;&gt; Any ideas on why my disk usage would be increasing rather than
&gt;&gt;&gt; decreasing? The data in the cluster is static, the only activity is me
&gt;&gt;&gt; deleting the items from the search index.
&gt;&gt;&gt;
&gt;&gt;&gt; I'm running riak 1.1.2 with leveldb as the backend.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; [1]:http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-September/005696.html
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Jeremy
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

