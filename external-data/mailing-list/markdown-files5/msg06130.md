---
title: "Re: Absolute consistency"
description: ""
project: community
lastmod: 2012-01-05T08:35:39-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06130"
mailinglist_parent_id: "msg06129"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2012-01-05T08:35:39-08:00
---


When n=3 in a three node cluster, sometimes two of those n are on the same
node.

@siculars
http://siculars.posterous.com

Sent from my rotary phone.
On Jan 5, 2012 11:07 AM, "Thomas Bakketun" 
wrote:

&gt; Hello,
&gt;
&gt; Riak is based on eventual consistency concept, but sometimes it's
&gt; desirable to have absolute consistency. I though it would be possible to
&gt; implement this on top of Riak with the help of pr and wr parameters of
&gt; fetch and store, but when testing this I sometimes get worrying results.
&gt;
&gt; I have at test setup with Riak nodes in three virtual machines running
&gt; on my desktop machine. The test bucket has n\\_val=3 and allow\\_mult=true.
&gt;
&gt; On my desktop machine I constantly read from every node like this:
&gt; watch curl -v "'http://192.168.100.21:8098/riak/test/foo?pr=quorum'"
&gt;
&gt; When I pause two of the virtual machines, the remaining one starts to
&gt; fail with error message "PR-value unsatisfied: 1/2", just as expected.
&gt; But occasionally it will returns 200 OK for about 10 seconds, before it
&gt; starts returning "PR-value unsatisfied: 1/2". I can't predictably
&gt; reproduce this situation, but it's seems to happen when I resume a
&gt; machine that was paused when the other machines where running too.
&gt;
&gt; Pausing virtual machines to simulate downtime might be a bit
&gt; unrealistic. Still it concerns me that Riak can return stale data. Here
&gt; is an example:
&gt;
&gt; First I wrote a value when all nodes where up. Then I pause one of the
&gt; nodes and wrote a new value. Then I paused the two remaining nodes and
&gt; resume the first node. For a few seconds the first node then returned
&gt; 200 OK with the old value when though I supplied pr=quorum.
&gt;
&gt; I have also been able to do successful writes with w, dw and pw=quorum
&gt; with only one machine running. I thing the node also returned 200 OK
&gt; when the object was read with pr=quorum right after.
&gt;
&gt; The tests where done with Riak 1.0.0-1 running on Ubuntu 10.10 64 bit.
&gt;
&gt; --
&gt; Thomas Bakketun, Senior software developer
&gt; T. +47 21 53 69 40
&gt; Copyleft Solutions
&gt; www.copyleftsolutions.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

