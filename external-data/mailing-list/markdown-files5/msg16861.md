---
title: "Re: Riak 2 Netty BlockingOperationException"
description: ""
project: community
lastmod: 2015-12-14T10:33:46-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16861"
mailinglist_parent_id: "msg16860"
author_name: "Alex Moore"
project_section: "mailinglistitem"
sent_date: 2015-12-14T10:33:46-08:00
---


Hi Riak4me,

What are your min / max connection settings for the RiakNode objects you
have set up?

It looks like during your Update command, the Riak client attempted to get
another connection for the store, but you were out of available connections
and the thread blocked. Netty doesn't like blocked threads, so it threw
the io.netty.util.concurrent.BlockingOperationException.

Thanks,
Alex

On Mon, Dec 14, 2015 at 12:28 PM, Riak4me 
wrote:

&gt; I am trying to use the Riak 2 java client. After some testing, I found that
&gt; during a put request to Riak, I consistently get a
&gt; BlockingOperationException from Netty. I've tried different connection
&gt; configs, operation queue size..etc. Could this be a bug in usage of
&gt; ChannelFuture.await? Thanks. Here's most of the stacktrace.
&gt;
&gt; io.netty.util.concurrent.BlockingOperationException:
&gt; DefaultChannelPromise@5da44ece(incomplete)
&gt; at
&gt;
&gt; io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:396)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelPromise.checkDeadLock(DefaultChannelPromise.java:157)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt; io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:257)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelPromise.await(DefaultChannelPromise.java:129)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt; io.netty.channel.DefaultChannelPromise.await(DefaultChannelPromise.java:28)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt; com.basho.riak.client.core.RiakNode.doGetConnection(RiakNode.java:671)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt; com.basho.riak.client.core.RiakNode.getConnection(RiakNode.java:640)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at com.basho.riak.client.core.RiakNode.execute(RiakNode.java:574)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.core.DefaultNodeManager.executeOnNode(DefaultNodeManager.java:90)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt; com.basho.riak.client.core.RiakCluster.execute(RiakCluster.java:321)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt; com.basho.riak.client.core.RiakCluster.execute(RiakCluster.java:239)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.api.commands.kv.StoreValue.executeAsync(StoreValue.java:118)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.api.commands.kv.UpdateValue$1.handle(UpdateValue.java:183)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.api.commands.ListenableFuture.notifyListeners(ListenableFuture.java:78)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.api.commands.CoreFutureAdapter.handle(CoreFutureAdapter.java:120)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.core.FutureOperation.fireListeners(FutureOperation.java:131)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.core.FutureOperation.setResponse(FutureOperation.java:170)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at com.basho.riak.client.core.RiakNode.onSuccess(RiakNode.java:836)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; com.basho.riak.client.core.netty.RiakResponseHandler.channelRead(RiakResponseHandler.java:58)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelHandlerContext.invokeChannelRead(DefaultChannelHandlerContext.java:340)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelHandlerContext.fireChannelRead(DefaultChannelHandlerContext.java:326)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:155)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.handler.codec.ByteToMessageCodec.channelRead(ByteToMessageCodec.java:108)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelHandlerContext.invokeChannelRead(DefaultChannelHandlerContext.java:340)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelHandlerContext.fireChannelRead(DefaultChannelHandlerContext.java:326)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:785)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:116)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt; io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:494)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:461)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:378)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:350)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:101)
&gt; [netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at java.lang.Thread.run(Thread.java:745) [na:1.8.0\\_40]
&gt; 16:44:36.569 ns-trinculo [nioEventLoopGroup-2-1] WARN
&gt; i.n.channel.DefaultChannelPipeline - An exception was thrown by a user
&gt; handler's exceptionCaught() method while handling the following exception:
&gt; io.netty.util.concurrent.BlockingOperationException:
&gt; DefaultChannelPromise@5da44ece(incomplete)
&gt; at
&gt;
&gt; io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:396)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelPromise.checkDeadLock(DefaultChannelPromise.java:157)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt; io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:257)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt;
&gt; io.netty.channel.DefaultChannelPromise.await(DefaultChannelPromise.java:129)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt; io.netty.channel.DefaultChannelPromise.await(DefaultChannelPromise.java:28)
&gt; ~[netty-all-4.0.17.Final.jar:4.0.17.Final]
&gt; at
&gt; com.basho.riak.client.core.RiakNode.doGetConnection(RiakNode.java:671)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at
&gt; com.basho.riak.client.core.RiakNode.getConnection(RiakNode.java:640)
&gt; ~[riak-client-2.0.2.jar:na]
&gt; at com.basho.riak.client.core.RiakNode.execute(RiakNode.java:574)
&gt; ~[riak-client-2.0.2.jar:na]
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/Riak-2-Netty-BlockingOperationException-tp4033787.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

