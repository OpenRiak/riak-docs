---
title: "Re: Multiple writes to same key/value"
description: ""
project: community
lastmod: 2013-03-05T07:20:02-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10320"
mailinglist_parent_id: "msg10316"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2013-03-05T07:20:02-08:00
---


Yes. That's the point of CRDTs: as long as operations are not lost,
they will converge on a single value. However, in the absence of
partial failures, the timescale of convergence is MUCH smaller than
something a single user would experience (see also
http://pbs.cs.berkeley.edu/). Quickly liking/unliking something (which
requires a read/modify/write cycle in the client) will still converge,
but it also may depend on the "bias" of the set-type you pick (some
prefer "add" and some prefer "remove" in the case of concurrent
writes). There are probably also small user-experience things you can
do there, like disable the button until you get a successful response.

On Mon, Mar 4, 2013 at 6:02 PM, Jimmy Ho  wrote:
&gt; Hi Sean,
&gt;
&gt; Another question, for the User object in the described scenario, would CRDT
&gt; set still be required?
&gt;
&gt; Say, if an user clicked like and unlike multiple times in a short period of
&gt; time, is it correct in saying that two riak nodes could potentially be
&gt; updating the same User object in an non deterministic order ?
&gt;
&gt; Thanks
&gt; Regards, Jimmy.
&gt;
&gt;
&gt; On Sun, Mar 3, 2013 at 3:54 PM, Sean Cribbs  wrote:
&gt;&gt;
&gt;&gt; Hi Jimmy,
&gt;&gt;
&gt;&gt; Sorry for taking this off-list; I meant to reply-all on that message!
&gt;&gt; Anyway, we do have a work-in-progress CRDT integration and we hope to
&gt;&gt; have it production-ready later this year.
&gt;&gt;
&gt;&gt; On Sun, Mar 3, 2013 at 9:02 AM, Jimmy Ho  wrote:
&gt;&gt; &gt; Hi Sean,
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks for the quick response.
&gt;&gt; &gt; All makes good sense.
&gt;&gt; &gt;
&gt;&gt; &gt; Am using python, found this on git hub which seems to do what I need
&gt;&gt; &gt; (will
&gt;&gt; &gt; need to test it further)
&gt;&gt; &gt;
&gt;&gt; &gt; https://github.com/ericmoritz/riak\\_crdt
&gt;&gt; &gt;
&gt;&gt; &gt; Any future plans to built CRDT features into Riak, or is it something
&gt;&gt; &gt; believed to sit more at the client side to implement merging/conflict
&gt;&gt; &gt; resolution?
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks for the help.
&gt;&gt; &gt; Regards,
&gt;&gt; &gt; Jimmy
&gt;&gt; &gt;
&gt;&gt; &gt; On Sat, Mar 2, 2013 at 8:57 PM, Sean Cribbs  wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Jimmy,
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Links are going to quickly become difficult to manage.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; This is the perfect problem for a CRDT, probably an OR-set. The nice
&gt;&gt; &gt;&gt; thing about CRDTs is that even when multiple writers are involved,
&gt;&gt; &gt;&gt; there's a single way to merge conflicts which always moves toward the
&gt;&gt; &gt;&gt; real value (monotonic). When someone clicks the "like button", you
&gt;&gt; &gt;&gt; would add their user ID to the set. (Assuming they can un-like, you
&gt;&gt; &gt;&gt; would remove them from the set when they do that.) You would probably
&gt;&gt; &gt;&gt; do something similar for the other direction, the user's list of post
&gt;&gt; &gt;&gt; -- but is easy to manage from the concurrent-writes standpoint, since
&gt;&gt; &gt;&gt; a user is probably the only one modifying that. If you never need to
&gt;&gt; &gt;&gt; "un-like", then the set only grows and is thus simpler to put
&gt;&gt; &gt;&gt; together.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Unfortunately, the CRDT support built into Riak is somewhat limited
&gt;&gt; &gt;&gt; right now. You would need to implement the convergent set yourself, or
&gt;&gt; &gt;&gt; use an existing client-side library. Here are a few:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; \\* Knockbox (Clojure) https://github.com/reiddraper/knockbox
&gt;&gt; &gt;&gt; \\* Statebox (Erlang) https://github.com/mochi/statebox
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; A quick search on Github will find you a lot of other options, too (in
&gt;&gt; &gt;&gt; various states of completion).
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On Sat, Mar 2, 2013 at 2:10 PM, Jimmy Ho  wrote:
&gt;&gt; &gt;&gt; &gt; Hi guys,
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Am currently designing the data schema for an application; I have a
&gt;&gt; &gt;&gt; &gt; question
&gt;&gt; &gt;&gt; &gt; hoping some of you could help. Thanks in advance.
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; One of the functionalities is a 'like button' to posts
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Each post is stored as an object in Riak, eg /post/
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; To like a post, I am planning on creating a link from user object to
&gt;&gt; &gt;&gt; &gt; the
&gt;&gt; &gt;&gt; &gt; post object, and the reverse direction, such that it would be easier
&gt;&gt; &gt;&gt; &gt; to
&gt;&gt; &gt;&gt; &gt; link-walk/mapreduce.
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; My question is, if a particular post is very very popular, and
&gt;&gt; &gt;&gt; &gt; everyone
&gt;&gt; &gt;&gt; &gt; is
&gt;&gt; &gt;&gt; &gt; pressing 'like'. Would the write requests (to the post's object
&gt;&gt; &gt;&gt; &gt; header)
&gt;&gt; &gt;&gt; &gt; conflict each other?
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Is the above a bad schema design from that perspective? Any
&gt;&gt; &gt;&gt; &gt; suggestion
&gt;&gt; &gt;&gt; &gt; of a
&gt;&gt; &gt;&gt; &gt; better design?
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Thanks.
&gt;&gt; &gt;&gt; &gt; Regards, Jimmy
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; --
&gt;&gt; &gt;&gt; Sean Cribbs 
&gt;&gt; &gt;&gt; Software Engineer
&gt;&gt; &gt;&gt; Basho Technologies, Inc.
&gt;&gt; &gt;&gt; http://basho.com/
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs 
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;
&gt;



-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

