---
title: "Re: Issues with high node load and very slow response"
description: ""
project: community
lastmod: 2014-07-27T22:56:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14557"
mailinglist_parent_id: "msg14556"
author_name: "Chaim Solomon"
project_section: "mailinglistitem"
sent_date: 2014-07-27T22:56:16-07:00
---


Hi,


Responses inline

On Mon, Jul 28, 2014 at 5:30 AM, Jordan West  wrote:

&gt; Unfortunately, there are several conditions that could cause this. To rule
&gt; out the obvious ones can you verify that `riak@10.128.137.185` has search
&gt; enabled. If it is the case that search is enabled we can try a few
&gt; different things to debug further.
&gt;
&gt;
All nodes have search=on in the riak.conf and I see the Java process.

Attaching to 'riak@10.128.138.25' (via "riak attach") and using the shell,
&gt; if you could provide the output of:
&gt;
&gt; ```
&gt; rpc:multicall([node() | nodes()], app\\_helper, get\\_env, [yokozuna, enabled,
&gt; false], 5000).
&gt; ```
&gt;
&gt; Eshell V5.10.3 (abort with ^G)
(riak@10.128.138.25)1&gt; rpc:multicall([node() | nodes()], app\\_helper,
get\\_env, [yokozuna, enabled, false], 5000).
{[true,true,true,true,true,true,true],[]}

As well as:
&gt;
&gt; ```
&gt; [riak\\_core\\_node\\_watcher:services(N) || N &lt;- [node() | nodes()]].
&gt; ```
&gt;
&gt; (riak@10.128.138.25)2&gt; [riak\\_core\\_node\\_watcher:services(N) || N &lt;-
[node() | nodes()]].
[[yokozuna,riak\\_pipe,riak\\_kv],
 [yokozuna,riak\\_pipe,riak\\_kv],
 [yokozuna,riak\\_pipe,riak\\_kv],
 [yokozuna,riak\\_pipe,riak\\_kv],
 [yokozuna,riak\\_pipe,riak\\_kv],
 [yokozuna,riak\\_pipe,riak\\_kv],
 [yokozuna,riak\\_pipe,riak\\_kv]]

And finally:
&gt;
&gt; ```
&gt; yz\\_kv:is\\_metadata\\_consistent('riak@10.127.137.185').
&gt; ```
&gt;
&gt; (riak@10.128.138.25)3&gt; yz\\_kv:is\\_metadata\\_consistent('riak@10.127.137.185
').
\\*\\* exception exit: {{nodedown,'riak@10.127.137.185'},
 {gen\\_server,call,
 [{riak\\_core\\_metadata\\_hashtree,
 'riak@10.127.137.185'},
 {prefix\\_hash,{core,bucket\\_types}},
 1000]}}
 in function gen\\_server:call/3 (gen\\_server.erl, line 188)
 in call from yz\\_kv:is\\_metadata\\_consistent/1 (src/yz\\_kv.erl, line 433)

Based on the output of those we can debug further.
&gt;
&gt; Additionally, its entirely possible that when we get rid of that error it
&gt; will not resolve the primary issue (CPU usage/request slowness). However,
&gt; the check that is the source of that log message can block in the request
&gt; path, so something funky could certainly be going on.
&gt;


Chaim Solomon
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

