---
title: "Re: Lowlevel Access to RiakCS objects?"
description: ""
project: community
lastmod: 2014-03-28T15:36:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13950"
mailinglist_parent_id: "msg13946"
author_name: "Brian Akins"
project_section: "mailinglistitem"
sent_date: 2014-03-28T15:36:24-07:00
---


I know of at least one case that uses riak cs for live HLS video at scale, 
which is somewhat similar to your use case, so this is not uncharted territory. 
While technically it's possible you can design and implement something more 
efficient than CS, that may be effort better spent in other areas of you 
application. JMO.

Sent from my iPhone

&gt; On Mar 28, 2014, at 10:53 AM, Martin Alpers  wrote:
&gt; 
&gt; Thanks for your answer, Tom.
&gt; 
&gt; I wanted to avoid the overhead of one segemting layers whose objects are 
&gt; segmented by yet another layer, but come to think of it, since Riak can store 
&gt; chunks up to 1MB in size, why not use Riak directly?
&gt; And I wanted to avoid additional complexity of additional code which 
&gt; basically mimics RiakCS.
&gt; 
&gt; But I see nothing to prevent me from doing all that segmentation stuff. 
&gt; Having slept a night over it, I think it is the way to go.
&gt; 
&gt; So thanks for the feedback, and for taking your time to read my question in 
&gt; the first place.
&gt; 
&gt; Best regards,
&gt; Martin
&gt; 
&gt;&gt; Hi Martin,
&gt;&gt; 
&gt;&gt; The short answer is no, Riak CS does not expose lower level access to the
&gt;&gt; blocks that are replicated to Riak.
&gt;&gt; 
&gt;&gt; That said, I'm curious, is anything preventing you from segmenting your
&gt;&gt; videos and writing a playlist + the segements to Riak CS? This would allow
&gt;&gt; you to seed varnish, while at the same time reducing the cost of a cache
&gt;&gt; miss to something reasonable for users.
&gt;&gt; 
&gt;&gt; Regards,
&gt;&gt; Tom
&gt;&gt; 
&gt;&gt;&gt; On Thu, Mar 27, 2014 at 3:05 PM, Martin Alpers  wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Hi all,
&gt;&gt;&gt; 
&gt;&gt;&gt; is there a canonical way to access RiakCS objects on a lower level? If I
&gt;&gt;&gt; remember correctly, RiakCS basically distributes larger objects into chunks
&gt;&gt;&gt; of one megabye each, and mapreduces them together on retrieval.
&gt;&gt;&gt; I would like to read those chunks for caching purposes.
&gt;&gt;&gt; 
&gt;&gt;&gt; For those interested in why I would wnat that:
&gt;&gt;&gt; A Riak/RiakCS cluster is the heart of our yet-to-be-implemented video
&gt;&gt;&gt; delivery cluster. A video management system will enable registered user to
&gt;&gt;&gt; upload their videos and the public can watch them.
&gt;&gt;&gt; In order to reduce intra-cluster traffic, we intent to cache the videos,
&gt;&gt;&gt; preferably in RAM.
&gt;&gt;&gt; We do not have any numbers on how often users would skip parts of the
&gt;&gt;&gt; video and generate range requests. If that case is really common, we would
&gt;&gt;&gt; prefer to serve them from cache as well, at least with Varnish and Squid,
&gt;&gt;&gt; some users would experience unacceptably long delays.
&gt;&gt;&gt; We looked out for a cache that could pipe through any request on an URL on
&gt;&gt;&gt; which caching is in progress and serve from cache afterwards.
&gt;&gt;&gt; 
&gt;&gt;&gt; The problem with both Varnish and Squid (and I suppose most caches,
&gt;&gt;&gt; because this behaviour seems reasonable in most cases) boils down to
&gt;&gt;&gt; treating a caching in progress as a cache hit.
&gt;&gt;&gt; My colleague started to write his own caching proxy in NodeJS, but using
&gt;&gt;&gt; asynchronous callbacks to check if a file exists, and to create it if it
&gt;&gt;&gt; does not, strikes me as somewhat couragous for production.
&gt;&gt;&gt; 
&gt;&gt;&gt; Now while we cannot risk to let some users wait for hundreds of megabytes
&gt;&gt;&gt; to be cached before delivery begins, and while we want at least to be
&gt;&gt;&gt; prepared to face many more range requests than the average "wget was
&gt;&gt;&gt; interrupted" case, it occurred to me thata few megabytes are not an issue
&gt;&gt;&gt; at multi-fast-ethernet speed.
&gt;&gt;&gt; So if we can split our files into objects small enough, we could code a
&gt;&gt;&gt; proxy that translates a range request into one or more normal requests for
&gt;&gt;&gt; those chunks, cuts off a certain offset of the first chunk if the range of
&gt;&gt;&gt; the orignal request began somewhere off the boundary, and reconcatenates
&gt;&gt;&gt; those chunks in correct order for delivery.
&gt;&gt;&gt; So the cache would never have to be bypassed, and the whole headache of
&gt;&gt;&gt; telling a complete hit from one "in progress" would be gone.
&gt;&gt;&gt; 
&gt;&gt;&gt; Since RiakCS has already split our files into small pieces, and somehow
&gt;&gt;&gt; tracks them, so could we possibly piggyback on that?
&gt;&gt;&gt; 
&gt;&gt;&gt; And by the way, I just came across the memory backend. I assume it is
&gt;&gt;&gt; distributed like the persistent ones, so it will not help me redice
&gt;&gt;&gt; internal traffic, right?
&gt;&gt;&gt; 
&gt;&gt;&gt; Any input is highly appreciated.
&gt;&gt;&gt; 
&gt;&gt;&gt; Best Regards
&gt;&gt;&gt; Martin
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Greetings, Martin Alpers
&gt;&gt;&gt; 
&gt;&gt;&gt; martin-alp...@web.de; Public Key ID: 10216CFB
&gt;&gt;&gt; Tel: +49 431/90885691; Mobile: +49 176/66185173
&gt;&gt;&gt; JID: martin.alp...@jabber.org
&gt;&gt;&gt; FYI: http://apps.opendatacity.de/stasi-vs-nsa/
&gt;&gt;&gt; 
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; -- 
&gt; Greetings, Martin Alpers
&gt; 
&gt; martin-alp...@web.de; Public Key ID: 10216CFB
&gt; Tel: +49 431/90885691; Mobile: +49 176/66185173
&gt; JID: martin.alp...@jabber.org
&gt; FYI: http://apps.opendatacity.de/stasi-vs-nsa/
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

