---
title: "Query on Riak Search in a cluster of 3 nodes behind ELB is giving	different result everytime"
description: ""
project: community
lastmod: 2015-04-01T00:52:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15939"
author_name: "Vitaliy E"
project_section: "mailinglistitem"
sent_date: 2015-04-01T00:52:03-07:00
---


Hello everyone,

I've just joined the list, and am a bit late to the party. Sorry about
that. Thought I would contribute an answer anyway.

Santi, what is you n\\_val?

I observed the behavior you are describing on Riak 2.0.0 with n\\_val=3 in
two cases:

1. One of the nodes was not part of the cluster although the cluster was
thinking it was. Don't ask me how that happened. Obviously, when a request
hit that node part of the entries could not be found there.

2. Look for indexing errors in Solr console and Riak logs. Each Riak node
has its own Solr "repository", so if an entry fails to be indexed on any of
them, search results will be inconsistent depending on which set of nodes
returns it. Let's say you have replicas on nodes A, B, and C. Entry X
failed to be indexed on A, entry Y failed to be indexed on A and B, and
entry Z was indexed OK on all nodes. Then you may get {X,Y,Z}, {X,Z}, or
{Z} as your search results.

In our case the indexing failures were caused by disk/filesystem errors.

Regards,
Vitaly
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

