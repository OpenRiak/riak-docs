---
title: "Re: Riak ruby client runtime error"
description: ""
project: community
lastmod: 2012-06-22T07:03:54-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07745"
mailinglist_parent_id: "msg07744"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-06-22T07:03:54-07:00
---


Hi Anand,

You need to give the Riak::Client which port(s) to connect to. If you're
doing the devrel 4-node setup, it would look like this:

client = Riak::Client.new(:nodes =&gt; [{:http\\_port =&gt; 8091},{:http\\_port
=&gt;8092},{:http\\_port=&gt;8093},{:http\\_port =&gt;8094}])

Obviously you would need to add the :pb\\_port to those if you want to use
the Protocol Buffers transport.

On Fri, Jun 22, 2012 at 9:49 AM, Anand Hegde  wrote:

&gt; Hello , I just installed riak on my OS X machine and got the 4 node
&gt; cluster working.
&gt;
&gt; Here is my output for the command
&gt;
&gt; $ ps aux | grep beam
&gt;
&gt; anandhegde 1075 0.1 0.9 2519676 37548 s002 Ss+ 10:49AM
&gt; 1:34.84 /Users/anandhegde/dev/dev2/libexec/erts-5.8.5/bin/beam.smp -K true
&gt; -A 64 -W w -- -root /Users/anandhegde/dev/dev2/libexec -progname riak --
&gt; -home /Users/anandhegde -- -boot
&gt; /Users/anandhegde/dev/dev2/libexec/releases/1.1.2/riak -embedded -config
&gt; /Users/anandhegde/dev/dev2/libexec/etc/app.config -pa ./lib/basho-patches
&gt; -name dev2@127.0.0.1 -setcookie riak -- console
&gt; anandhegde 938 0.1 0.9 2519524 38152 s001 Ss+ 10:49AM
&gt; 1:36.31 /Users/anandhegde/dev/dev1/libexec/erts-5.8.5/bin/beam.smp -K true
&gt; -A 64 -W w -- -root /Users/anandhegde/dev/dev1/libexec -progname riak --
&gt; -home /Users/anandhegde -- -boot
&gt; /Users/anandhegde/dev/dev1/libexec/releases/1.1.2/riak -embedded -config
&gt; /Users/anandhegde/dev/dev1/libexec/etc/app.config -pa ./lib/basho-patches
&gt; -name dev1@127.0.0.1 -setcookie riak -- console
&gt; anandhegde 1295 0.0 0.9 2519188 37416 s004 Ss+ 10:49AM
&gt; 1:40.47 /Users/anandhegde/dev/dev4/libexec/erts-5.8.5/bin/beam.smp -K true
&gt; -A 64 -W w -- -root /Users/anandhegde/dev/dev4/libexec -progname riak --
&gt; -home /Users/anandhegde -- -boot
&gt; /Users/anandhegde/dev/dev4/libexec/releases/1.1.2/riak -embedded -config
&gt; /Users/anandhegde/dev/dev4/libexec/etc/app.config -pa ./lib/basho-patches
&gt; -name dev4@127.0.0.1 -setcookie riak -- console
&gt; anandhegde 1185 0.0 0.9 2519576 36764 s003 Ss+ 10:49AM
&gt; 1:39.91 /Users/anandhegde/dev/dev3/libexec/erts-5.8.5/bin/beam.smp -K true
&gt; -A 64 -W w -- -root /Users/anandhegde/dev/dev3/libexec -progname riak --
&gt; -home /Users/anandhegde -- -boot
&gt; /Users/anandhegde/dev/dev3/libexec/releases/1.1.2/riak -embedded -config
&gt; /Users/anandhegde/dev/dev3/libexec/etc/app.config -pa ./lib/basho-patches
&gt; -name dev3@127.0.0.1 -setcookie riak -- console
&gt; anandhegde 7115 0.0 0.0 2434892 540 s000 R+ 7:13PM
&gt; 0:00.00 grep beam
&gt;
&gt;
&gt; After this I installed the riak-ruby-client gem as given here -
&gt; https://github.com/basho/riak-ruby-client/
&gt;
&gt; I am trying to run a simple script based on the documentation provided at
&gt; the github page. This is my script -
&gt;
&gt; require 'riak'
&gt;
&gt; client = Riak::Client.new
&gt;
&gt; bucket=client.bucket("doc")
&gt; object = bucket.get\\_or\\_new("index.html")
&gt; object.data="some body content here"
&gt; object.content\\_type="text/html"
&gt; object.store
&gt;
&gt; puts client['doc']['index.html']
&gt;
&gt;
&gt; and when I run this using $ ruby script.rb
&gt;
&gt; I get the following error -
&gt;
&gt; /Users/anandhegde/.rvm/gems/ruby-1.9.3-p0/gems/riak-client-1.0.3/lib/riak/client.rb:450:in
&gt; `rescue in recover\\_from': Connection refused - connect(2) (RuntimeError)
&gt; from
&gt; /Users/anandhegde/.rvm/gems/ruby-1.9.3-p0/gems/riak-client-1.0.3/lib/riak/client.rb:422:in
&gt; `recover\\_from'
&gt; from
&gt; /Users/anandhegde/.rvm/gems/ruby-1.9.3-p0/gems/riak-client-1.0.3/lib/riak/client.rb:284:in
&gt; `http'
&gt; from
&gt; /Users/anandhegde/.rvm/gems/ruby-1.9.3-p0/gems/riak-client-1.0.3/lib/riak/client.rb:129:in
&gt; `backend'
&gt; from
&gt; /Users/anandhegde/.rvm/gems/ruby-1.9.3-p0/gems/riak-client-1.0.3/lib/riak/client.rb:277:in
&gt; `get\\_object'
&gt; from
&gt; /Users/anandhegde/.rvm/gems/ruby-1.9.3-p0/gems/riak-client-1.0.3/lib/riak/bucket.rb:88:in
&gt; `get'
&gt; from
&gt; /Users/anandhegde/.rvm/gems/ruby-1.9.3-p0/gems/riak-client-1.0.3/lib/riak/bucket.rb:106:in
&gt; `get\\_or\\_new'
&gt; from riak\\_client.rb:6:in `'
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

