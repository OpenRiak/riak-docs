---
title: "Re: Date format for Riak Search and its JSON output"
description: ""
project: community
lastmod: 2010-11-04T12:15:31-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01465"
mailinglist_parent_id: "msg01464"
author_name: "Nicolas Fouché"
project_section: "mailinglistitem"
sent_date: 2010-11-04T12:15:31-07:00
---


I monkey-patched Riak::Client::CurbBackend to get useful logs
https://gist.github.com/662986

Best,
Nicolas

On Thu, Nov 4, 2010 at 7:42 PM, Rusty Klophaus  wrote:
&gt; Hi Nicolas,
&gt; Thank you for the excellent description of the problem. There are currently
&gt; issues/bugs around date support in Riak Search, looks like you found
&gt; another. I'd recommend treating dates as strings for now. The issue you
&gt; described is now tracked here: https://issues.basho.com/show\\_bug.cgi?id=864
&gt; Best,
&gt; Rusty
&gt;
&gt; On Thu, Nov 4, 2010 at 9:17 AM, Nicolas Fouché 
&gt; wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I can't find the right format for dates in Riak Search, for fields
&gt;&gt; suffixed with "\\_dt". I tried rfc822 (e.g. "Thu, 04 Nov 2010 16:02:59
&gt;&gt; -0000"), and xmlschema/iso8601 (e.g. "2010-11-04T16:07:43Z"), but I
&gt;&gt; get an {unhandled\\_type,date} error when requesting my data in JSON. No
&gt;&gt; problem with XML.
&gt;&gt;
&gt;&gt; Here are the HTTP queries to reproduce the error:
&gt;&gt;
&gt;&gt; # Get the bucket props
&gt;&gt;
&gt;&gt; GET http://127.0.0.1:8098/riak/models?keys=false
&gt;&gt;        {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt;&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ=="}
&gt;&gt;
&gt;&gt; # Set the pre-commit search hook
&gt;&gt;
&gt;&gt; PUT http://127.0.0.1:8098/riak/models
&gt;&gt;        {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt;&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ==", "Content-Type"=&gt;"application/json"}
&gt;&gt;
&gt;&gt;  {"props":{"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}]}}
&gt;&gt;
&gt;&gt; # Check if there are any keys to delete
&gt;&gt;
&gt;&gt; GET http://127.0.0.1:8098/riak/models?props=false&keys=true
&gt;&gt;        {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt;&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ=="}
&gt;&gt;
&gt;&gt; # Post a JSON document with a date in rfc822 (day-of-week, DD
&gt;&gt; month-name CCYY hh:mm:ss zone)
&gt;&gt;
&gt;&gt; POST http://127.0.0.1:8098/riak/models?returnbody=true
&gt;&gt;        {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt;&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ==", "Content-Type"=&gt;"application/json"}
&gt;&gt;        {"time\\_dt":"Thu, 04 Nov 2010 16:02:59 -0000","value":"a value like
&gt;&gt; any other value","\\_type":"Model"}
&gt;&gt;
&gt;&gt; # Search for the object and request a JSON ouput =&gt; KO
&gt;&gt;
&gt;&gt; GET http://127.0.0.1:8098/solr/models/select?q=value%3Aother&wt=json
&gt;&gt;        {"Accept"=&gt;"multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5",
&gt;&gt; "X-Riak-ClientId"=&gt;"A1Q9KQ=="}
&gt;&gt;
&gt;&gt;  500 Internal Server
&gt;&gt; ErrorInternal Server Error
=====================

The server
&gt;&gt; encountered an error while processing this
&gt;&gt; request:  

```
{error,{throw,{unhandled_type,date},
&gt;&gt;                [{riak_solr_output,convert_type,2},
&gt;&gt;                 {riak_indexed_doc,'-to_mochijson2/2-lc$^0/1-0-',2},
&gt;&gt;                 {riak_indexed_doc,'-to_mochijson2/2-lc$^0/1-0-',2},
&gt;&gt;                 {riak_indexed_doc,to_mochijson2,2},
&gt;&gt;                 {riak_solr_output,'-json_response/7-lc$^0/1-0-',2},
&gt;&gt;                 {riak_solr_output,json_response,7},
&gt;&gt;                 {riak_solr_searcher_wm,to_json,2},
&gt;&gt;
&gt;&gt;
&gt;&gt; {webmachine_resource,resource_call,3}]}}
```


---

mochiweb+webmachine
&gt;&gt; web server

[nfo@
&gt;&gt; 17:13:46]~/Code/tests/riak/search
&gt;&gt;
&gt;&gt; # Search for the object and request a XML ouput =&gt; OK
&gt;&gt;
&gt;&gt; GET http://127.0.0.1:8098/solr/models/select?q=value%3Aother&wt=xml
&gt;&gt;
&gt;&gt;  xml version="1.0" encoding="UTF-8"?
&gt;&gt;  
&gt;&gt;    
&gt;&gt;      0
&gt;&gt;      1
&gt;&gt;      
&gt;&gt;        on
&gt;&gt;        0
&gt;&gt;        value:other
&gt;&gt;        or
&gt;&gt;        value
&gt;&gt;        standard
&gt;&gt;        1.1
&gt;&gt;        2
&gt;&gt;      
&gt;&gt;    
&gt;&gt;    
&gt;&gt;      
&gt;&gt;        67rGKh9XJSZBsPeet0LpdCzi1hz
&gt;&gt;        
&gt;&gt;        Model
&gt;&gt;        
&gt;&gt;        Thu, 04 Nov 2010 16:02:59 -0000
&gt;&gt;        
&gt;&gt;        a value like any other value
&gt;&gt;        
&gt;&gt;      
&gt;&gt;    
&gt;&gt;  
&gt;&gt;
&gt;&gt; -- Nicolas
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

