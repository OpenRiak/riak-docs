---
title: "Re: Riak on SAN"
description: ""
project: community
lastmod: 2013-10-02T19:26:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12480"
mailinglist_parent_id: "msg12475"
author_name: "John E. Vincent"
project_section: "mailinglistitem"
sent_date: 2013-10-02T19:26:45-07:00
---


Man I go away for a few hours for family time and off things go ;)

So this lead to some interesting convos on twitter and here. Others have
addressed some things. I figure it helps to explain the sad lonely world I
live in - It's called "Enterprise".

A few folks are somewhat aware that our product uses Riak under the covers.
We have a hosted SaaS version and we also allow customers to install it
entirely isolated on their own networks. The only people who do this are
traditional enterprises.

The very first question that comes up during an installation after "you
need HOW many servers?" is "How do I back this up". Since we use LevelDB,
we have the worst of backup options - coordinated node shutdown and
tarball'ing. The thing is we can't say to them "you never need to back this
up. Just add more nodes!"

That doesn't check the box they have. That doesn't meet the legal and
industry guidelines they have to follow. So now that they've swallowed the
"you need 5 servers just for the DB" we now hit them with "your backup
strategy involves this complicated orchestrated shutdown process and some
tarballs". When faced with that, we ran into a new issue. They started
doing vm snapshots and stupid shit like vmotioning the instances (oh yes,
they virtualize it =/).

If you aren't familiar with vmotion, it's basically vmware's bullshit that
says they can somehow defy the laws of physics. If you read the details on
exactly what vmotion does (hint - it doesn't actually take the node offline
- vmware just "buffers" the pending network requests among other things),
you can see how this can TOTALLY fuck up Riak clusters.

Anyway so this is the world we have to live in and we have to provide
something that resembles a backup they can DR from. Our normal course of
action is to tell them to contact Basho for RiakDS and go multi-site. SAN
based snapshots largely meet that need for them.

For what it's worth, this is not just a problem with Riak and there are
legitimate use cases for wanting to have a "copy" of production data for
testing new code against. The biggest problem is once you get data IN to
riak (and other stores), it's REALLY difficult to prune it outside of
expensive "walk all the things", an external index of some kind or
resorting to application-level business logic tooling.

I'm not making a judgement call. Trade offs are a thing but it's definitely
a issue. At this point I'm considering resorting to a post-commit hook
machination of some kind.


On Wed, Oct 2, 2013 at 6:02 PM, Jeremiah Peschka  wrote:

&gt; Responses inline.
&gt;
&gt; TL;DR - I actually agree with John, SANs make management of storage
&gt; stupidly easy, but you pay more money for it. Make the right decision for
&gt; your org, but make sure you can monitor and backup that decision. The SAN
&gt; isn't a magic box. And a Drobo b1200i [2] is definitely not a SAN.
&gt;
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt;
&gt;
&gt; On Wed, Oct 2, 2013 at 2:12 PM, John E. Vincent &lt;
&gt; lusis.org+riak-us...@gmail.com&gt; wrote:
&gt;
&gt;&gt; I'm going to take a competing view here.
&gt;&gt;
&gt;&gt; SAN is a bit overloaded of a term at this point. Nothing precludes a SAN
&gt;&gt; from being performant or having SSDs. Yes the cost is overkill for fiber
&gt;&gt; but iSCSI is much more realistic. Alternately you can even do ATAoE.
&gt;&gt;
&gt;
&gt; Agreed. You can buy a glorified direct attached storage device with a few
&gt; ethernet ports in it, but vendors will call it a SAN.
&gt;
&gt;
&gt;&gt;
&gt;&gt; From a hardware perspective, if I have 5 pizza boxes as riak nodes, I can
&gt;&gt; only fit so many disks in them. Meanwhile I can add another shelf to my SAN
&gt;&gt; and expand as needed.
&gt;&gt;
&gt;
&gt; We have the ability to cram 16x 960GB SSDs into the front of a Dell R720
&gt; for about $550 per drive... no SAN vendor can beat you on price for that.
&gt; SAN storage is an order of magnitude more expensive, but...
&gt;
&gt;
&gt;&gt; Additionally backup of a SAN is MUCH easier than backup of a riak node
&gt;&gt; itself. It's a snapshot and you're done. Mind you nothing precludes you
&gt;&gt; from doing LVM snapshots in the OS but you still need to get the data OFF
&gt;&gt; that system for it to be truly backed up.
&gt;&gt;
&gt;
&gt; The products worth of being called a SAN offer you fantastic features like
&gt; application aware volume snapshots, multi-site async and synchronous block
&gt; level synchronization, and all kinds of amazing features that mean you
&gt; never need to think about your storage beyond "HEY THERE, MAGIC BOX, I NEED
&gt; 500GB OF SPACE!"
&gt;
&gt;
&gt;&gt;
&gt;&gt; I love riak and other distributed stores but backing them up is NOT a
&gt;&gt; solved problem. Walking all keys, coordinating the take down of all your
&gt;&gt; nodes in a given order or whatever your strategy is a serious pain point.
&gt;&gt;
&gt;&gt; Using a SAN or local disk also doesn't excuse you from watching I/O
&gt;&gt; performance. With a SAN I get multiple redundant paths to a block device
&gt;&gt; and I don't get that necessarily with local storage.
&gt;&gt;
&gt;&gt; Just my two bits.
&gt;&gt;
&gt;
&gt; For many applications, if you need storage performance outside of the main
&gt; chassis, you could also look at an approach like Microsoft take with the
&gt; Fast Track Data Warehouse Reference Architecture [1]. For those who don't
&gt; want to read, you line up the ability of your CPUs to process data with the
&gt; ability of your disks to produce data. For SQL Server, you assume ~300MB/s
&gt; of processing per core. Core count \\* 300MB/s = total combined disk speed.
&gt; It's easy to use something like a Dell MD1220 or an HP MSA to get this kind
&gt; of performance, too, without breaking the bank and upgrading to something
&gt; like a 3PAR or EMC.
&gt;
&gt;
&gt; [1]:
&gt; http://www.microsoft.com/en-us/sqlserver/solutions-technologies/data-warehousing/reference-architecture.aspx
&gt; [2]: http://www.droboworks.com/B1200i.asp?gclid=CPbhhL2T-bkCFeI-Mgod0hEAaA
&gt;
&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Oct 2, 2013 at 2:18 AM, Jeremiah Peschka &lt;
&gt;&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Could you do it? Sure.
&gt;&gt;&gt;
&gt;&gt;&gt; Should you do it? No.
&gt;&gt;&gt;
&gt;&gt;&gt; An advantage of Riak is that you can avoid the cost of SAN storage by
&gt;&gt;&gt; getting duplication at the machine level rather than rely on your storage
&gt;&gt;&gt; vendor to provide it.
&gt;&gt;&gt;
&gt;&gt;&gt; Running Riak on a SAN also exposes you to the SAN becoming your
&gt;&gt;&gt; bottleneck; you only have so many fiber/iSCSI ports and a fixed number of
&gt;&gt;&gt; disks. The risk of storage contention is high, too, so you can run into
&gt;&gt;&gt; latency issues that are difficult to diagnose without looking into both
&gt;&gt;&gt; Riak as well as the storage system.
&gt;&gt;&gt;
&gt;&gt;&gt; Keeping cost in mind, too, SAN storage is about 10x the cost of consumer
&gt;&gt;&gt; grade SSDs. Not to mention feature licensing and support... The cost
&gt;&gt;&gt; comparison isn't favorable.
&gt;&gt;&gt;
&gt;&gt;&gt; Please note: Even though your vendor calls it a SAN, that doesn't mean
&gt;&gt;&gt; it's a SAN.
&gt;&gt;&gt; On Oct 1, 2013 11:08 PM, "Guy Morton"  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Does this make sense?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Guy Morton
&gt;&gt;&gt;&gt; Web Development Manager
&gt;&gt;&gt;&gt; Brüel & Kjær EMS
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This e-mail is confidential and may be read, copied and used only by
&gt;&gt;&gt;&gt; the intended recipient. If you have received it in error, please contact
&gt;&gt;&gt;&gt; the sender immediately by return e-mail. Please then delete the e-mail and
&gt;&gt;&gt;&gt; do not disclose its contents to any other person.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

