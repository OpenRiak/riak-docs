---
title: "Re: RIAK-CS crashing with many HEAD requests"
description: ""
project: community
lastmod: 2013-04-11T11:59:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10855"
mailinglist_parent_id: "msg10842"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2013-04-11T11:59:09-07:00
---


Stefan,

I have been able to reproduce the problem you saw and I have opened a
github issue to address it here: https://github.com/basho/riak\\_cs/issues/532.
Thanks again for the report and we should have a fix for it pushed to
github very soon.

Kelly

On Wed, Apr 10, 2013 at 5:42 PM, Kelly McLaughlin  wrote:

&gt; Stefan,
&gt;
&gt; Thanks for the report. We will investigate this and let you know what we
&gt; find.
&gt;
&gt; Kelly
&gt;
&gt; On Wed, Apr 10, 2013 at 5:05 AM, Silasi Stefan wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I'm testing RIAK-CS as an S3 alternative and I get some strange crashing
&gt;&gt; when reading data from it. The following is reproducible with each run of
&gt;&gt; the python script.
&gt;&gt;
&gt;&gt; conn = boto.connect\\_s3(
&gt;&gt; aws\\_access\\_key\\_id = access\\_key,
&gt;&gt; aws\\_secret\\_access\\_key = secret\\_key,
&gt;&gt; host = riak\\_host,
&gt;&gt; proxy = riak\\_host,
&gt;&gt; proxy\\_port = 8080,
&gt;&gt; calling\\_format = boto.s3.connection.OrdinaryCallingFormat(),
&gt;&gt; debug = 2,
&gt;&gt; is\\_secure = False,
&gt;&gt; )
&gt;&gt;
&gt;&gt; bucket = conn.create\\_bucket('bucket\\_name')
&gt;&gt;
&gt;&gt; for row in rows:
&gt;&gt; key=bucket.new\\_key(valid\\_key\\_name)
&gt;&gt; if key.exists():
&gt;&gt; key.open\\_read()
&gt;&gt;
&gt;&gt;
&gt;&gt; If I monitor the riak-cs memory usage, it is growing and growing until
&gt;&gt; it's using all RAM+SWAP, then it crashes.
&gt;&gt; In the console log, the following line is appended before RIAK-CS crashes:
&gt;&gt;
&gt;&gt; 2013-04-10 08:28:40.802 [info] &lt;0.41.0&gt; alarm\\_handler:
&gt;&gt; {set,{system\\_memory\\_high\\_watermark,[]}}
&gt;&gt;
&gt;&gt; Nothing related in the error.log.
&gt;&gt; In access.log I see a lot of HEAD requests for the objects stored.
&gt;&gt;
&gt;&gt; Current architecture looks like this:
&gt;&gt; - 3 virtual machines with 4 cores, 4gb ram, 2gb swap and 1tb disk each
&gt;&gt; - RIAK installed on all of them, configured as cluster
&gt;&gt; - stanchion installed on all of them
&gt;&gt; - RIAK-CS installed on all of them, configured to "speak" only with local
&gt;&gt; RIAK
&gt;&gt; - about 10GB of data storred in each RIAK with N=3.
&gt;&gt;
&gt;&gt; The strange thing is that if I move the connect-to part in the FOR loop,
&gt;&gt; RIAK-CS memory usage doesn't go over 300MB. Any ideas what could be wrong?
&gt;&gt;
&gt;&gt; Thank you,
&gt;&gt; Stefan.
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

