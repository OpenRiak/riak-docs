---
title: "Re: FYI: How to do secondary indexing with Riak behind Nginx"
description: ""
project: community
lastmod: 2011-10-06T06:49:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05071"
mailinglist_parent_id: "msg05069"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2011-10-06T06:49:51-07:00
---


That aside, I thought there were other reasons for not using nginx in front
of riak. Http 1.0 vs http 1.1 support. For that reason I front Riak with
haproxy.

Thoughts?

@siculars
http://siculars.posterous.com

Sent from my rotary phone.
On Oct 6, 2011 9:32 AM, "Mårten Gustafson" 
wrote:
&gt; Howdy,
&gt;
&gt; = Background
&gt;
&gt; During the Riak 1.0 webinar I played around with Nginx and encountered
&gt; a problem with secondary indexing when accessing Riak (over HTTP)
&gt; through Nginx. I had a quick chat with Sean about it on IRC[1] and
&gt; then I forgot it. The problem is that Nginx won't handle header names
&gt; with underscores "properly".
&gt;
&gt; AFAICT it's perfectly legal with underscores in headers according to
&gt; RFC 2616[2], I also found a discussion on StackOverflow[3] that came
&gt; to the same conclusion.
&gt;
&gt;
&gt; = Solution
&gt;
&gt; In your nginx.conf in the relevant server-section add the following:
&gt; underscores\\_in\\_headers on;
&gt;
&gt;
&gt;
&gt; /mårten.
&gt;
&gt; [1] http://irclogger.com/.riak/2011-09-21 @ 14:33
&gt; [2] http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2
&gt; [3]
http://stackoverflow.com/questions/964519/php-http-post-incorrect-headers
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

