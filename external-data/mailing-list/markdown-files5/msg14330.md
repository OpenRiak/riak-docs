---
title: "Re: leveldb issues."
description: ""
project: community
lastmod: 2014-06-19T09:38:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14330"
mailinglist_parent_id: "msg14329"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2014-06-19T09:38:34-07:00
---


Running repair now may have detected damage done to your data long ago. Repair 
reads every file and tests the CRC on every block in the file.

Two known issues might have caused the original corruption:

https://github.com/basho/leveldb/wiki/mv-verify-compactions 

or 

https://github.com/basho/leveldb/wiki/mv-async-close


Also, there is a bug in the 532bb commit that can cause level-0 files to be 
wrongly deleted. I suggest pulling the latest to get rid of that bug.

Matthew


On Jun 19, 2014, at 12:24 PM, Theo Schlossnagle  wrote:

&gt; I'm using basho/leveldb as of commit: 
&gt; 532bb6351e7835e862c8508520780bfc9d0c2b78 (no snappy)
&gt; 
&gt; I have an issue with some small sized database... they claim corruption, but 
&gt; when running a repair I have a nonsensical amount of sst's moved into "lost"
&gt; 
&gt; Worse, the files moved to "lost" have very very old creation times (in 
&gt; months). The system has been restarted successfully many times in the 
&gt; interim, leading to more confusion.
&gt; 
&gt; I'm looking for pointers to get to the bottom of this. It isn't critical 
&gt; thatI recover this data, but it is critical that I don't see this manifest 
&gt; when it does matter.
&gt; 
&gt; Before repair:
&gt; 
&gt; 40960 108441.log
&gt; 1 CURRENT
&gt; 0 LOCK
&gt; 3 LOG
&gt; 3 LOG.old
&gt; 92 MANIFEST-108439
&gt; 469 sst\\_0
&gt; 1 sst\\_1
&gt; 188185 sst\\_2
&gt; 4189331 sst\\_3
&gt; 6343660 sst\\_4
&gt; 1 sst\\_5
&gt; 1 sst\\_6
&gt; 
&gt; After repair:
&gt; 
&gt; 40960 108452.log
&gt; 1 CURRENT
&gt; 0 LOCK
&gt; 3 LOG
&gt; 3 LOG.old
&gt; 28 MANIFEST-108450
&gt; 8221971 lost
&gt; 2362 sst\\_0
&gt; 1 sst\\_1
&gt; 188185 sst\\_2
&gt; 2352071 sst\\_3
&gt; 1 sst\\_4
&gt; 1 sst\\_5
&gt; 1 sst\\_6
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Theo Schlossnagle
&gt; 
&gt; http://omniti.com/is/theo-schlossnagle
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

