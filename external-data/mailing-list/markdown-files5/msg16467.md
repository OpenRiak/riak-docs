---
title: "Re: indexes_not_supported,riak_kv_bitcask_backend error on multi	backend with leveldb"
description: ""
project: community
lastmod: 2015-08-27T20:17:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16467"
mailinglist_parent_id: "msg16466"
author_name: "Bora Kou"
project_section: "mailinglistitem"
sent_date: 2015-08-27T20:17:45-07:00
---


We found the issue. It turned out that the "storage\\_backend" setting is
still bitcask on all the node except the one I was testing on. After
making sure all node have "storage\\_backend = multi", the secondary index
works as expected. My bad, sorry for the noise :(

-Bora

On Thu, Aug 27, 2015 at 5:05 PM, Bora Kou  wrote:

&gt; Hi,
&gt;
&gt; I am testing out riak kv multi backend with leveldb and bitcask. I
&gt; configured bitcask as the default backend and leveldb with bucket-type. I
&gt; am using riak kv version 2.0.5-1.
&gt;
&gt; I am able to do http PUT with index, but when I try to GET with the index,
&gt; it give me "{error,{indexes\\_not\\_supported,riak\\_kv\\_bitcask\\_backend}}}"
&gt;
&gt; Am I missing something? Is this type of setting supported?
&gt;
&gt; Here is the information:
&gt;
&gt; ## PUT (with index work fine)
&gt; \\*curl -v -XPUT
&gt; localhost:8098/types/xfiles/buckets/xfiles\\_master\\_aws\\_pod98/keys/john \\\\*
&gt; \\* -H "x-riak-index-email\\_bin: j...@example.com " \\\\*
&gt; \\* -d 'John Testing'\\*
&gt;
&gt; \\*\\* About to connect() to localhost port 8098 (#0)\\*
&gt; \\*\\* Trying 127.0.0.1... connected\\*
&gt; \\*&gt; PUT /types/xfiles/buckets/xfiles\\_master\\_aws\\_pod98/keys/john HTTP/1.1\\*
&gt; \\*&gt; User-Agent: curl/7.22.0 (x86\\_64-pc-linux-gnu) libcurl/7.22.0
&gt; OpenSSL/1.0.1 zlib/1.2.3.4  libidn/1.23 librtmp/2.3\\*
&gt; \\*&gt; Host: localhost:8098\\*
&gt; \\*&gt; Accept: \\*/\\*\\*
&gt; \\*&gt; x-riak-index-email\\_bin: j...@example.com \\*
&gt; \\*&gt; Content-Length: 12\\*
&gt; \\*&gt; Content-Type: application/x-www-form-urlencoded\\*
&gt; \\*&gt; \\*
&gt; \\*\\* upload completely sent off: 12out of 12 bytes\\*
&gt; \\*&lt; HTTP/1.1 204 No Content\\*
&gt; \\*&lt; Vary: Accept-Encoding\\*
&gt; \\*&lt; Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)\\*
&gt; \\*&lt; Date: Thu, 27 Aug 2015 23:32:20 GMT\\*
&gt; \\*&lt; Content-Type: application/x-www-form-urlencoded\\*
&gt; \\*&lt; Content-Length: 0\\*
&gt; \\*&lt; \\*
&gt; \\*\\* Connection #0 to host localhost left intact\\*
&gt; \\*\\* Closing connection #0\\*
&gt;
&gt; ## GET INDEX (got error)
&gt; \\*curl -v
&gt; localhost:8098/types/xfiles/buckets/xfiles\\_master\\_aws\\_pod98/index/email\\_bin/j...@example.com
&gt; \\*
&gt;
&gt; \\*\\* About to connect() to localhost port 8098 (#0)\\*
&gt; \\*\\* Trying 127.0.0.1... connected\\*
&gt; \\*&gt; GET
&gt; /types/xfiles/buckets/xfiles\\_master\\_aws\\_pod98/index/email\\_bin/j...@example.com
&gt;  HTTP/1.1\\*
&gt; \\*&gt; User-Agent: curl/7.22.0 (x86\\_64-pc-linux-gnu) libcurl/7.22.0
&gt; OpenSSL/1.0.1 zlib/1.2.3.4  libidn/1.23 librtmp/2.3\\*
&gt; \\*&gt; Host: localhost:8098\\*
&gt; \\*&gt; Accept: \\*/\\*\\*
&gt; \\*&gt; \\*
&gt; \\*&lt; HTTP/1.1 500 Internal Server Error\\*
&gt; \\*&lt; Vary: Accept-Encoding\\*
&gt; \\*&lt; Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)\\*
&gt; \\*&lt; Date: Thu, 27 Aug 2015 23:41:52 GMT\\*
&gt; \\*&lt; Content-Type: text/html\\*
&gt; \\*&lt; Content-Length: 305\\*
&gt; \\*&lt; \\*
&gt; \\*\\* Connection #0 to host localhost left intact\\*
&gt; \\*\\* Closing connection #0\\*
&gt; \\*500 Internal Server
&gt; ErrorInternal Server Error
=====================

The server
&gt; encountered an error while processing this
&gt; request:  

```
{error,{error,{indexes_not_supported,riak_kv_bitcask_backend}}}
```


---

mochiweb+webmachine
&gt; web server

\\*
&gt;
&gt; ## GET THE KEY (work fine)
&gt; \\*curl
&gt; localhost:8098/types/xfiles/buckets/xfiles\\_master\\_aws\\_pod98/keys/john\\*
&gt; \\*John Testing\\*
&gt;
&gt;
&gt; ## BUCKET-TYPE
&gt; \\*riak-admin bucket-type list\\*
&gt; \\*default (active)\\*
&gt; \\*xfiles (active)\\*
&gt;
&gt; \\*riak-admin bucket-type status xfiles\\*
&gt; \\*xfiles is active\\*
&gt;
&gt; \\*active: true\\*
&gt; \\*allow\\_mult: true\\*
&gt; \\*backend: &lt;&lt;"leveldb\\_multi"&gt;&gt;\\*
&gt; \\*basic\\_quorum: false\\*
&gt; \\*big\\_vclock: 50\\*
&gt; \\*chash\\_keyfun: {riak\\_core\\_util,chash\\_std\\_keyfun}\\*
&gt; \\*claimant: 'r...@riak-test1.example.com '\\*
&gt; \\*dvv\\_enabled: true\\*
&gt; \\*dw: quorum\\*
&gt; \\*last\\_write\\_wins: false\\*
&gt; \\*linkfun: {modfun,riak\\_kv\\_wm\\_link\\_walker,mapreduce\\_linkfun}\\*
&gt; \\*n\\_val: 3\\*
&gt; \\*notfound\\_ok: true\\*
&gt; \\*old\\_vclock: 86400\\*
&gt; \\*postcommit: []\\*
&gt; \\*pr: 0\\*
&gt; \\*precommit: []\\*
&gt; \\*pw: 0\\*
&gt; \\*r: quorum\\*
&gt; \\*rw: quorum\\*
&gt; \\*small\\_vclock: 50\\*
&gt; \\*w: quorum\\*
&gt; \\*young\\_vclock: 20\\*
&gt;
&gt;
&gt; ## MY CONFIGURATION (6 nodes)
&gt; \\*cat /etc/riak/riak.conf | grep multi\\*
&gt; \\*storage\\_backend = multi\\*
&gt; \\*multi\\_backend.bitcask\\_multi.storage\\_backend = bitcask\\*
&gt; \\*multi\\_backend.bitcask\\_multi.bitcask.data\\_root = /var/lib/riak/bitcask\\*
&gt; \\*multi\\_backend.leveldb\\_multi.storage\\_backend = leveldb\\*
&gt; \\*multi\\_backend.leveldb\\_multi.leveldb.data\\_root = /var/lib/riak/leveldb\\*
&gt; \\*multi\\_backend.leveldb\\_multi.leveldb.maximum\\_memory.percent = 30\\*
&gt; \\*multi\\_backend.leveldb\\_multi.leveldb.compaction.trigger.tombstone\\_count =
&gt; 1000\\*
&gt; \\*multi\\_backend.default = bitcask\\_multi\\*
&gt;
&gt; \\*cat /var/lib/riak/generated.configs/\\* | grep multi\\*
&gt; \\* {storage\\_backend,riak\\_kv\\_multi\\_backend},\\*
&gt; \\* {multi\\_backend\\_default,&lt;&lt;"bitcask\\_multi"&gt;&gt;},\\*
&gt; \\* {multi\\_backend,\\*
&gt; \\* [{&lt;&lt;"bitcask\\_multi"&gt;&gt;,riak\\_kv\\_bitcask\\_backend,\\*
&gt; \\* {&lt;&lt;"leveldb\\_multi"&gt;&gt;,riak\\_kv\\_eleveldb\\_backend,\\*
&gt;
&gt;
&gt;
&gt;
&gt; Thank you,
&gt;
&gt;
&gt; -Bora
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

