---
title: "Re: Put failure: too many siblings"
description: ""
project: community
lastmod: 2016-06-16T23:46:54-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17487"
mailinglist_parent_id: "msg17485"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2016-06-16T23:46:54-07:00
---


What version of riak\\_kv is behind this riak\\_cs install, please? Is it really 
2.1.3 as stated below? This looks and sounds like sibling explosion, which is 
fixed in riak 2.0 and above. Are you sure that you are using the DVV enabled 
setting for riak\\_cs bucket properties? Can you post your bucket properties 
please?

On 16 Jun 2016, at 23:54, Vladyslav Zakhozhai  
wrote:

&gt; Hello.
&gt; 
&gt; I see very interesting and confusing thing.
&gt; 
&gt; From my previous letter you can see that siblings count on manifest objects 
&gt; is about 100 (actualy it is in range 100-300). Unfortunately my problem is 
&gt; that almost all PUT requests are failing with 500 Internal Server error.
&gt; 
&gt; I've tried today set max\\_siblings riak option to 500. And there were 
&gt; successfull PUT requests but not for long. Now I see in riak logs error with 
&gt; "max siblings", but actual count of them is 500+ (earlier it was 100-300 as 
&gt; I've mentioned).
&gt; 
&gt; Period of time between max\\_siblings=500 and errors in log is about 30 
&gt; minutes. And I want to point your attention that I've forbid PUT method on 
&gt; haproxy - frontend for riak cs.
&gt; 
&gt; 
&gt; 
&gt; On Mon, Jun 6, 2016 at 1:17 AM Vladyslav Zakhozhai 
&gt;  wrote:
&gt; Hi, Luke.
&gt; 
&gt; Thank you for your answer. I did not understand you completely about 
&gt; transfer-limit. How does it relate to my problem. Transfer limit - is a limit 
&gt; of concurrent data transfer from different nodes. Am I wright? You mean that 
&gt; riak can handoff one partition from several nodes concurrently?
&gt; 
&gt; Now I have transfer-limit 1 on all riak nodes.
&gt; 
&gt; But I am not sure that my cluster will be converged ever. All nodes 
&gt; experiences low memory and are killed by OOM Killer periodically. I try to 
&gt; add new nodes to the cluster but due problem with OOM killer this process is 
&gt; very-very slow.
&gt; 
&gt; In the official docs I've read:
&gt; 
&gt; "Sibling explosion occurs when an object rapidly collects siblings that are 
&gt; not reconciled. This can lead to a variety of problems, including degraded 
&gt; performance, especially if many objects in a cluster suffer from siblings 
&gt; explosion. At the extreme, having an enormous object in a node can cause 
&gt; reads of that object to crash the entire node. Other issues include undue 
&gt; latency and out-of-memory errors."
&gt; 
&gt; I mentioned that new nodes in the cluster do not experience such problems (I 
&gt; mean out of RAM).
&gt; 
&gt; Regarding to siblings maybe your are right, this is manifest object. I can 
&gt; recognize key name but not bucket name. But more than 100 siblings on many 
&gt; keys is really confused me. Each time I try to PUT some object to Riak via 
&gt; Riak CS S3 interface I got errors with siblings.
&gt; 
&gt; On Fri, Jun 3, 2016 at 6:43 PM Luke Bakken  wrote:
&gt; Hi Vladyslav,
&gt; 
&gt; If you recognize the full name of the object raising the sibling
&gt; warning, it is most likely a manifest object. Sometimes, during hinted
&gt; handoff, you can see these messages. They should resolve after handoff
&gt; completes.
&gt; 
&gt; Please see the documentation for the transfer-limit command as well:
&gt; 
&gt; http://docs.basho.com/riak/kv/2.1.4/using/admin/riak-admin/#transfer-limit
&gt; 
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt; 
&gt; 
&gt; On Fri, Jun 3, 2016 at 2:55 AM, Vladyslav Zakhozhai
&gt;  wrote:
&gt; &gt; Hi.
&gt; &gt;
&gt; &gt; I have a trouble with PUT to Riak CS cluster. During this process I
&gt; &gt; periodically see the following message in Riak error.log:
&gt; &gt;
&gt; &gt; 2016-06-03 11:15:55.201 [error]
&gt; &gt; &lt;0.15536.142&gt;@riak\\_kv\\_vnode:encode\\_and\\_put:2253 Put failure: too many
&gt; &gt; siblings for object OBJECT\\_NAME (101)
&gt; &gt;
&gt; &gt; and also
&gt; &gt;
&gt; &gt; 2016-06-03 12:41:50.678 [error]
&gt; &gt; &lt;0.20448.515&gt;@riak\\_api\\_pb\\_server:handle\\_info:331 Unrecognized message
&gt; &gt; {7345880,{error,{too\\_many\\_siblings,101}}}
&gt; &gt;
&gt; &gt; Here OBJECT\\_NAME - is the name of object in Riak which has too many
&gt; &gt; siblings.
&gt; &gt;
&gt; &gt; I definitely sure that this objects are static. Nobody deletes is, nobody
&gt; &gt; rewrites it. I have no idea why more than 100 siblings of this object
&gt; &gt; occurs.
&gt; &gt;
&gt; &gt; The following effect of this issue occurs:
&gt; &gt;
&gt; &gt; Great amount of keys are loaded to RAM. I almost out of RAM (Do each sibling
&gt; &gt; has it own key or key duplicate?).
&gt; &gt; Nodes are slow - adding new nodes are too slow
&gt; &gt; Presence of "too many siblings" affects ownership handoffs
&gt; &gt;
&gt; &gt; So I have several questions:
&gt; &gt;
&gt; &gt; Do hinted or ownership handoffs can affect siblings count (I mean can
&gt; &gt; siblings be created during ownership of hinted handoffs)
&gt; &gt; Is there any workaround of this issue. Do I need remove siblings manually or
&gt; &gt; it removes during merges, read repairs and so on
&gt; &gt;
&gt; &gt;
&gt; &gt; My configuration:
&gt; &gt;
&gt; &gt; riak from basho's packages - 2.1.3-1
&gt; &gt; riak cs from basho's packages - 2.1.0-1
&gt; &gt; 24 riak/riak-cs nodes
&gt; &gt; 32 GB RAM per node
&gt; &gt; AAE is disabled
&gt; &gt;
&gt; &gt;
&gt; &gt; I appreciate you help.
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

