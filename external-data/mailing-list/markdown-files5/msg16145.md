---
title: "Re: Riak 1.4.12 high I/O while almost idle"
description: ""
project: community
lastmod: 2015-05-22T06:55:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16145"
mailinglist_parent_id: "msg16144"
author_name: "Doug Rohrer"
project_section: "mailinglistitem"
sent_date: 2015-05-22T06:55:45-07:00
---


Try running `riak-admin top` on the node to see what's going on:

http://docs.basho.com/riak/1.4.12/ops/running/tools/riak-admin/#top 


This may give you some insight into what that node is doing.

Doug


&gt; On May 22, 2015, at 9:52 AM, Timo Gatsonides  wrote:
&gt; 
&gt; I have a 7 node Riak cluster. Most nodes are on 1.4.10 and I am currently 
&gt; migrating the nodes from RedHat to Ubuntu (and Ext4 -&gt; ZFS). 
&gt; 
&gt; One of the nodes is running Ubuntu 14 with ZFS for the data and has Riak 
&gt; 1.4.12 installed. On this node Riak is continuously reading and writing a lot 
&gt; of data. Even hours after it is started. There are no running transfers 
&gt; (riak-admin transfers). The other nodes are not very busy, almost no CPU, no 
&gt; I/O. For this one node see the output of iotop, uname -a, riak-admin status 
&gt; and some recent logging below.
&gt; 
&gt; There is nothing obvious in the Riak logging, except that there is an 
&gt; occasional reading/writing large object (once a minute or so, objects of 
&gt; around 5Mb-10Mb).
&gt; 
&gt; Is there a way to see what Riak is doing, what it is reading/writing?
&gt; 
&gt; Thanks,
&gt; Timo
&gt; 
&gt; Total DISK READ : 81.99 M/s | Total DISK WRITE : 33.33 M/s
&gt; Actual DISK READ: 39.59 M/s | Actual DISK WRITE: 241.72 M/s
&gt; TID PRIO USER DISK READ DISK WRITE SWAPIN IO&gt; COMMAND 
&gt; 
&gt; 8723 be/4 riak 23.82 M/s 12.05 M/s 0.00 % 80.54 % beam.smp -K true 
&gt; -A 64~ -smp enable -- console
&gt; 8725 be/4 riak 4.80 M/s 814.60 B/s 0.00 % 72.67 % beam.smp -K true 
&gt; -A 64~ -smp enable -- console
&gt; 8657 be/4 riak 3.83 M/s 814.60 B/s 0.00 % 68.98 % beam.smp -K true 
&gt; -A 64~ -smp enable -- console
&gt; 698 be/0 root 0.00 B/s 0.00 B/s 0.00 % 47.67 % [txg\\_sync]
&gt; 8724 be/4 riak 13.07 M/s 7.68 M/s 0.00 % 39.04 % beam.smp -K true 
&gt; -A 64~ -smp enable -- console
&gt; 8726 be/4 riak 50.91 K/s 13.59 M/s 0.00 % 36.77 % beam.smp -K true 
&gt; -A 64~ -smp enable -- console
&gt; 7917 be/4 root 51.11 K/s 0.00 B/s 0.00 % 4.26 % [kworker/u16:5]
&gt; 234 be/3 root 0.00 B/s 1629.19 B/s 0.00 % 0.01 % [jbd2/sda6-8]
&gt; 8302 be/4 riak 0.00 B/s 814.60 B/s 0.00 % 0.00 % run\\_erl -daemon 
&gt; /tmp/r~ /usr/sbin/riak console
&gt; 9942 be/4 root 0.00 B/s 0.00 B/s 0.00 % 0.00 % [kworker/u16:6]
&gt; 10319 be/4 root 0.00 B/s 0.00 B/s 0.00 % 0.00 % [kworker/u16:0]
&gt; 10320 be/4 root 0.00 B/s 0.00 B/s 0.00 % 0.00 % [kworker/u16:1]
&gt; 8401 be/4 riak 0.00 B/s 814.60 B/s 0.00 % 0.00 % beam.smp -K true 
&gt; -A 
&gt; 
&gt; #uname -a
&gt; Linux tx4 3.13.0-49-generic #83-Ubuntu SMP Fri Apr 10 20:11:33 UTC 2015 
&gt; x86\\_64 x86\\_64 x86\\_64 GNU/Linux
&gt; 
&gt; sys\\_system\\_version : &lt;&lt;"Erlang R15B01 (erts-5.9.1) [source] [64-bit] 
&gt; [smp:8:8] [async-threads:64] [kernel-poll:true]"&gt;&gt;
&gt; sys\\_system\\_architecture : &lt;&lt;"x86\\_64-unknown-linux-gnu"&gt;&gt;
&gt; sys\\_threads\\_enabled : true
&gt; sys\\_thread\\_pool\\_size : 64
&gt; sys\\_wordsize : 8
&gt; ring\\_num\\_partitions : 64
&gt; ring\\_creation\\_size : 64
&gt; storage\\_backend : riak\\_kv\\_multi\\_backend
&gt; erlydtl\\_version : &lt;&lt;"0.7.0"&gt;&gt;
&gt; riak\\_control\\_version : &lt;&lt;"1.4.12-0-g964c5db"&gt;&gt;
&gt; cluster\\_info\\_version : &lt;&lt;"1.2.4"&gt;&gt;
&gt; riak\\_search\\_version : &lt;&lt;"1.4.12-0-g7fe0e00"&gt;&gt;
&gt; merge\\_index\\_version : &lt;&lt;"1.3.2-0-gcb38ee7"&gt;&gt;
&gt; riak\\_kv\\_version : &lt;&lt;"1.4.12-0-gc6bbd66"&gt;&gt;
&gt; 
&gt; 1-minute stats for ...
&gt; -------------------------------------------
&gt; riak\\_kv\\_stat\\_ts : 1432301431
&gt; vnode\\_gets : 748
&gt; vnode\\_gets\\_total : 10051
&gt; vnode\\_puts : 182
&gt; vnode\\_puts\\_total : 3690
&gt; vnode\\_index\\_refreshes : 0
&gt; vnode\\_index\\_refreshes\\_total : 0
&gt; vnode\\_index\\_reads : 10
&gt; vnode\\_index\\_reads\\_total : 100
&gt; vnode\\_index\\_writes : 182
&gt; vnode\\_index\\_writes\\_total : 3686
&gt; vnode\\_index\\_writes\\_postings : 2
&gt; vnode\\_index\\_writes\\_postings\\_total : 139
&gt; vnode\\_index\\_deletes : 0
&gt; vnode\\_index\\_deletes\\_total : 0
&gt; vnode\\_index\\_deletes\\_postings : 0
&gt; vnode\\_index\\_deletes\\_postings\\_total : 13
&gt; node\\_gets : 0
&gt; node\\_gets\\_total : 0
&gt; node\\_get\\_fsm\\_siblings\\_mean : 0
&gt; node\\_get\\_fsm\\_siblings\\_median : 0
&gt; node\\_get\\_fsm\\_siblings\\_95 : 0
&gt; node\\_get\\_fsm\\_siblings\\_99 : 0
&gt; node\\_get\\_fsm\\_siblings\\_100 : 0
&gt; node\\_get\\_fsm\\_objsize\\_mean : 0
&gt; node\\_get\\_fsm\\_objsize\\_median : 0
&gt; node\\_get\\_fsm\\_objsize\\_95 : 0
&gt; node\\_get\\_fsm\\_objsize\\_99 : 0
&gt; node\\_get\\_fsm\\_objsize\\_100 : 0
&gt; node\\_get\\_fsm\\_time\\_mean : 0
&gt; node\\_get\\_fsm\\_time\\_median : 0
&gt; node\\_get\\_fsm\\_time\\_95 : 0
&gt; node\\_get\\_fsm\\_time\\_99 : 0
&gt; node\\_get\\_fsm\\_time\\_100 : 0
&gt; node\\_puts : 64
&gt; node\\_puts\\_total : 1196
&gt; node\\_put\\_fsm\\_time\\_mean : 691827
&gt; node\\_put\\_fsm\\_time\\_median : 2168
&gt; node\\_put\\_fsm\\_time\\_95 : 4415096
&gt; node\\_put\\_fsm\\_time\\_99 : 8226455
&gt; node\\_put\\_fsm\\_time\\_100 : 12045311
&gt; read\\_repairs : 0
&gt; read\\_repairs\\_total : 0
&gt; coord\\_redirs\\_total : 0
&gt; 
&gt; ==&gt; /var/log/riak/erlang.log.1 &lt;==
&gt; 08:41:19.235 [info] monitor long\\_gc &lt;0.7.0&gt; 
&gt; [{name,application\\_controller},{initial\\_call,{application\\_controller,start,1}},{almost\\_current\\_function,{gen\\_server,loop,6}},{message\\_queue\\_len,0}]
&gt; 
&gt; [{timeout,293},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,6765},{mbuf\\_size,0},{stack\\_size,23},{old\\_heap\\_size,0},{heap\\_size,2142}]
&gt; 08:41:19.437 [warning] Writing very large object (19730102 bytes) to &lt;&lt;...&gt;&gt;
&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt; 2015-05-22 08:41:19.235 [info] 
&gt; &lt;0.96.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:92 monitor long\\_gc &lt;0.7.0&gt; 
&gt; [{name,application\\_controller},{initial\\_call,{application\\_controller,start,1}},{almost\\_current\\_function,{gen\\_server,loop,6}},{message\\_queue\\_len,0}]
&gt; 
&gt; [{timeout,293},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,6765},{mbuf\\_size,0},{stack\\_size,23},{old\\_heap\\_size,0},{heap\\_size,2142}]
&gt; 2015-05-22 08:41:19.437 [warning] 
&gt; &lt;0.710.0&gt;@riak\\_kv\\_vnode:encode\\_and\\_put\\_no\\_sib\\_check:1900 Writing very large 
&gt; object (19730102 bytes) to &lt;&lt;...&gt;&gt;
&gt; ==&gt; /var/log/riak/erlang.log.1 &lt;==
&gt; 08:41:23.417 [info] monitor long\\_gc &lt;0.436.0&gt; 
&gt; [{name,proxy\\_riak\\_kv\\_vnode\\_68507889249886074290797726533575766546371837952},{initial\\_call,{riak\\_core\\_vnode\\_proxy,init,1}},{almost\\_current\\_function,{riak\\_core\\_vnode\\_proxy,loop,2}},{message\\_queue\\_len,0}]
&gt; 
&gt; [{timeout,2093},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,987},{mbuf\\_size,0},{stack\\_size,5},{old\\_heap\\_size,0},{heap\\_size,481}]
&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt; 2015-05-22 08:41:23.417 [info] 
&gt; &lt;0.96.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:92 monitor long\\_gc &lt;0.436.0&gt; 
&gt; [{name,proxy\\_riak\\_kv\\_vnode\\_68507889249886074290797726533575766546371837952},{initial\\_call,{riak\\_core\\_vnode\\_proxy,init,1}},{almost\\_current\\_function,{riak\\_core\\_vnode\\_proxy,loop,2}},{message\\_queue\\_len,0}]
&gt; 
&gt; [{timeout,2093},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,987},{mbuf\\_size,0},{stack\\_size,5},{old\\_heap\\_size,0},{heap\\_size,481}]
&gt; ==&gt; /var/log/riak/erlang.log.1 &lt;==
&gt; 08:41:25.319 [warning] Reading large object of size 12178287 from &lt;&lt;...&gt;&gt;
&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt; 2015-05-22 08:41:25.319 [warning] &lt;0.707.0&gt;@riak\\_kv\\_vnode:do\\_get\\_object:1365 
&gt; Reading large object of size 12178287 from &lt;&lt;.."&gt;&gt;
&gt; ==&gt; /var/log/riak/erlang.log.1 &lt;==
&gt; 08:42:00.687 [info] monitor long\\_gc &lt;0.707.0&gt; 
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{eleveldb,get,3}},{message\\_queue\\_len,7}]
&gt; 
&gt; [{timeout,485},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,2584},{mbuf\\_size,0},{stack\\_size,46},{old\\_heap\\_size,0},{heap\\_size,909}]
&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt; 2015-05-22 08:42:00.687 [info] 
&gt; &lt;0.96.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:92 monitor long\\_gc &lt;0.707.0&gt; 
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{eleveldb,get,3}},{message\\_queue\\_len,7}]
&gt; 
&gt; [{timeout,485},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,2584},{mbuf\\_size,0},{stack\\_size,46},{old\\_heap\\_size,0},{heap\\_size,909}]
&gt; ==&gt; /var/log/riak/erlang.log.1 &lt;==
&gt; 08:42:40.036 [info] monitor long\\_gc &lt;0.712.0&gt; 
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{eleveldb,write,3}},{message\\_queue\\_len,0}]
&gt; 
&gt; [{timeout,759},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,4181},{mbuf\\_size,0},{stack\\_size,73},{old\\_heap\\_size,0},{heap\\_size,1683}]
&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt; 2015-05-22 08:42:40.036 [info] 
&gt; &lt;0.96.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:92 monitor long\\_gc &lt;0.712.0&gt; 
&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{eleveldb,write,3}},{message\\_queue\\_len,0}]
&gt; 
&gt; [{timeout,759},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,4181},{mbuf\\_size,0},{stack\\_size,73},{old\\_heap\\_size,0},{heap\\_size,1683}]
&gt; 
&gt; 
&gt; Some of the non-standard /etc/riak/vm.args:
&gt; 
&gt; ## Increase number of concurrent ports/sockets
&gt; -env ERL\\_MAX\\_PORTS 64000
&gt; ## Tweak GC to run more often 
&gt; -env ERL\\_FULLSWEEP\\_AFTER 0
&gt; ## Set the location of crash dumps
&gt; -env ERL\\_CRASH\\_DUMP /var/log/riak/erl\\_crash.dump
&gt; ## Raise the ETS table limit
&gt; -env ERL\\_MAX\\_ETS\\_TABLES 256000
&gt; ## Force the erlang VM to use SMP
&gt; -smp enable
&gt; ## For nodes with many busy\\_dist\\_port events, Basho recommends
&gt; ## raising the sender-side network distribution buffer size.
&gt; ## 32MB may not be sufficient for some workloads and is a suggested
&gt; ## starting point.
&gt; ## The Erlang/OTP default is 1024 (1 megabyte).
&gt; ## See: http://www.erlang.org/doc/man/erl.html#%2bzdbbl 
&gt; 
&gt; +zdbbl 32768
&gt; ## Raise the default erlang process limit 
&gt; +P 256000
&gt; 
&gt; 
&gt; Some of the non-standard /etc/riak/app.config:
&gt; 
&gt; %% -\\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\\*-
&gt; %% ex: ts=4 sw=4 et
&gt; [
&gt; %% For firewall config limit ports
&gt; { kernel, [
&gt; {inet\\_dist\\_listen\\_min, 6000},
&gt; {inet\\_dist\\_listen\\_max, 7999}
&gt; ]},
&gt; %% Riak Client APIs config
&gt; %% riak\\_handoff\\_port is the TCP port that Riak uses for
&gt; %% intra-cluster data handoff.
&gt; {handoff\\_port, 8099 },
&gt; {handoff\\_concurrency, 3}, 
&gt; 
&gt; %% Riak KV config
&gt; {riak\\_kv, [
&gt; %% Storage\\_backend specifies the Erlang module defining the 
&gt; storage
&gt; %% mechanism that will be used on this node.
&gt; 
&gt; {storage\\_backend, riak\\_kv\\_multi\\_backend},
&gt; {multi\\_backend\\_default, &lt;&lt;"eleveldb"&gt;&gt;},
&gt; {multi\\_backend, [ 
&gt; {&lt;&lt;"eleveldb"&gt;&gt;, riak\\_kv\\_eleveldb\\_backend, [
&gt; {data\\_root, "/data/riak/leveldb"}
&gt; ]},
&gt; {&lt;&lt;"fs"&gt;&gt;, riak\\_kv\\_eleveldb\\_backend, [
&gt; {data\\_root, "/bigdata/riak/bigleveldb"}
&gt; ]},
&gt; {&lt;&lt;"cache"&gt;&gt;, riak\\_kv\\_memory\\_backend, [
&gt; {max\\_memory, 16}, %% 16Mb
&gt; {ttl, 86400} %% 1 Day in seconds
&gt; ]}
&gt; ]},
&gt; 
&gt; {anti\\_entropy, {off, []}},
&gt; {vnode\\_vclocks, true},
&gt; {legacy\\_keylisting, false},
&gt; {listkeys\\_backpressure, true},
&gt; {legacy\\_vnode\\_routing, false},
&gt; {fsm\\_limit, 50000},
&gt; {object\\_format, v1}
&gt; ]},
&gt; {riak\\_search, [
&gt; %% To enable Search functionality set this 'true'.
&gt; {enabled, false}
&gt; ]},
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

