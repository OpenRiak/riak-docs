---
title: "Re: Quickly deleting + recreating item in Riak deletes new item"
description: ""
project: community
lastmod: 2013-07-14T14:26:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11523"
mailinglist_parent_id: "msg11522"
author_name: "Seth Bunce"
project_section: "mailinglistitem"
sent_date: 2013-07-14T14:26:38-07:00
---


I had a similar problem. I mitigated the problem by appending a
current timestamp (in nanoseconds) to the keys I'm using in my tests.
This way I don't have to worry about waiting for Riak to reap
tombstones after 3 seconds and I don't have to use
delete\\_mode=immediate. I still do a list keys + delete before each
test.

I still have one flakey test where new keys disappear randomly. In the
test I do: get (to check if key exists), put (if key doesn't exist),
repeat. Sometimes this fails to find the key I just put. This is with
default bucket options, and no w/pw/r/pr specified, using a single
connection to one node in a 5 node Riak 1.3.1 cluster. I don't know
what's going on here.

On Sun, Jul 14, 2013 at 9:28 AM, Matthew Dawson  wrote:
&gt; Hello,
&gt;
&gt; I've been playing around with Riak for a new app I'm building. I'm currently
&gt; playing around with my own mini-cluster along with my test suite for the app.
&gt; The Riak cluster is a four node cluster running across a laptop and a desktop
&gt; (so two nodes per physical machine). I'm also running with the default
&gt; setting for delete\\_mode, but I've tried both keep or immediate without any
&gt; change for my problem.
&gt;
&gt; In my test suite, at the end of every test I delete all the keys inside my
&gt; Riak cluster (manually by listing keys then deleting them one by one). Also,
&gt; some of my items share the same key name for testing. Usually this works just
&gt; fine, and my tests all pass.
&gt;
&gt; However, occasionally one of my newly created items disappears from the test
&gt; clusters, and my test errors out complaining the object could not be found.
&gt; This seems to happen especially often if a node has been stopped and started.
&gt;
&gt; I'm pretty sure the system is successfully creating the item, so I'm wondering
&gt; if this is expected behaviour from Riak, and if there some way for me to work
&gt; around this.
&gt;
&gt;
&gt; Also, on another note I'm seeing read latencies from Riak of around 10-20ms
&gt; per key. Is this typical? My write speeds seem to be significantly less then
&gt; that.
&gt; --
&gt; Matthew
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

