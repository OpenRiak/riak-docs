---
title: "Re: Logical operators in Ripple"
description: ""
project: community
lastmod: 2011-06-05T20:58:21-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03565"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-06-05T20:58:21-07:00
---


When in doubt, I always look at the spec. In this case: 
https://github.com/seancribbs/ripple/blob/master/riak-client/spec/riak/map\\_reduce/filter\\_builder\\_spec.rb

So you'll want to do something roughly like:

filter { Riak::MapReduce::FilterBuilder.new }
filter.tokenize "-", "1" do
eq "test"
end

There's a really good chance that's wrong since I'm only looking at some Ruby 
in an editor and not testing against a running Riak cluster right now. 
Hopefully that sets you on the right track or else angries up someone who will 
correct me. 
--- 
Jeremiah Peschka
Founder, Brent Ozar PLF


On Sunday, June 5, 2011 at 7:46 PM, Ryan Caught wrote:

&gt; Hi,
&gt; I'm having a problem with Ripple and logical operator key filters. Has anyone 
&gt; managed to get "and" or "or" key filter combinations working?
&gt; 
&gt; When I run the following: 
&gt; 
&gt; require 'ripple'
&gt; 
&gt; client = Riak::Client.new
&gt; bucket = client.bucket("test\\_bucket")
&gt; 
&gt; one = Riak::RObject.new(bucket, "test-123") 
&gt; one.content\\_type = "application/json"
&gt; one.data = '{"name": "test-123"}'
&gt; one.store
&gt; 
&gt; two = Riak::RObject.new(bucket, "test-456") 
&gt; two.content\\_type = "application/json"
&gt; two.data = '{"name": "test-456"}'
&gt; two.store
&gt; 
&gt; 
&gt; results\\_1 = Riak::MapReduce.new(client). 
&gt; add("visitors", [["tokenize", "-", 1], ["eq", "test"]]).
&gt; map("Riak.mapValuesJson", :keep =&gt; true).run
&gt; # Works as expected
&gt; p results\\_1
&gt; 
&gt; results\\_2 = Riak::MapReduce.new(client).
&gt; add("visitors", [["ends\\_with", "123"]]).
&gt; map("Riak.mapValuesJson", :keep =&gt; true).run
&gt; # Works as expected
&gt; p results\\_2
&gt; 
&gt; results\\_3 = Riak::MapReduce.new(client).
&gt; add("test\\_bucket", ["and", [["tokenize", "-", 1], ["eq", "test"]],
&gt; [["ends\\_with", "123"]]
&gt; ]). 
&gt; map("Riak.mapValuesJson", :keep =&gt; true).run
&gt; # Error
&gt; p results\\_3
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; This is what the error report says:
&gt; 
&gt; =ERROR REPORT==== 5-Jun-2011::19:42:34 ===
&gt; webmachine error: path="/mapred"
&gt; {error,{error,function\\_clause,
&gt; [{riak\\_client,build\\_exprs,
&gt; [[&lt;&lt;"and"&gt;&gt;,
&gt; [[&lt;&lt;"tokenize"&gt;&gt;,&lt;&lt;"-"&gt;&gt;,1],
&gt; [&lt;&lt;"eq"&gt;&gt;,&lt;&lt;"test"&gt;&gt;]],
&gt; [[&lt;&lt;"ends\\_with"&gt;&gt;,&lt;&lt;"123"&gt;&gt;]]],
&gt; [],
&gt; {riak\\_client,'riak@127.0.0.1 (mailto:riak@127.0.0.1)',&lt;&lt;6,82,5,153&gt;&gt;}]},
&gt; {riak\\_client,build\\_filter,2},
&gt; {riak\\_client,stream\\_list\\_keys,6},
&gt; {riak\\_client,mapred\\_bucket\\_stream,7},
&gt; {riak\\_client,mapred\\_bucket,6},
&gt; {riak\\_kv\\_wm\\_mapred,process\\_post,2},
&gt; {webmachine\\_resource,resource\\_call,3},
&gt; {webmachine\\_resource,do,3}]}}
&gt; 
&gt; 
&gt; 
&gt; Any ideas? 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

