---
title: "Re: Simple mapreduce with 2i returns different result"
description: ""
project: community
lastmod: 2013-04-17T01:00:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10910"
mailinglist_parent_id: "msg10909"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2013-04-17T01:00:05-07:00
---



On 17 Apr 2013, at 08:54, Mattias Sjölinder  wrote:

&gt; Thanks for your help. Your query returned the same number over and over again 
&gt; just as expected. 
&gt; 
&gt; I think I have found the reason for my problem though. The client lib 
&gt; CorrugatedIron seems to wrap each document in the MapReduce result into a 
&gt; array turning the result into a nested array looking like:
&gt; [[{doc1}], [{doc2}], [{doc3}]] counting 3 arrays & 3 docs
&gt; and sometimes 
&gt; [[{doc1}], [{doc2}, {doc3}]] counting 2 arrays and 2 docs (according to my 
&gt; client code... :)
&gt; 
&gt; Why the result for same query in CorrugatedIron and for a simple curl differs 
&gt; I don't know but I will investigate it further. 

My guess is the client library streams the mapreduce results and gathers the 
separate messages. So depending on how many chunks are sent by riak you get a 
different nested array of responses.

&gt; 
&gt; 
&gt; Thanks again for your help!
&gt; 
&gt; Best regards,
&gt; Mattias
&gt; 
&gt; 
&gt; 
&gt; 2013/4/16 Christian Dahlqvist 
&gt; Hi Mattias,
&gt; 
&gt; The following curl query simply counts the number of inputs, and has worked 
&gt; well for me in the past. Can you please run it against the cluster a couple 
&gt; of times and see if it also return varying number of results?
&gt; 
&gt; curl -XPOST http://localhost:8098/mapred 
&gt; -H 'Content-Type: application/json' 
&gt; -d '{"inputs":{
&gt; "bucket":"som-bucket",
&gt; "index":"userid\\_bin",
&gt; "key":"18481123123"
&gt; },
&gt; "query":[{"reduce":{"language":"erlang",
&gt; "module":"riak\\_kv\\_mapreduce",
&gt; "function":"reduce\\_count\\_inputs"
&gt; }}]}'
&gt; 
&gt; Best regards,
&gt; 
&gt; Christian
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On 16 Apr 2013, at 15:52, Mattias Sjölinder  wrote:
&gt; 
&gt;&gt; 18481123123
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

