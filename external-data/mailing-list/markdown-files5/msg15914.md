---
title: "Re: Trouble with Riak Search JSON Extractor"
description: ""
project: community
lastmod: 2015-03-23T09:08:31-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15914"
mailinglist_parent_id: "msg15911"
author_name: "Matt Brooks"
project_section: "mailinglistitem"
sent_date: 2015-03-23T09:08:31-07:00
---


Zeeshan,

Is there a way to reload the index manually? I tried running
"rp(yz\\_index:reload(&lt;&lt;"index\\_name"&gt;&gt;))." on each node as suggested on a
GitHub issue, and though I got an "ok" response back listing each nodes in
the cluster, I still could not query using the updated schema. I even
deleted all of my K/V pairs and re-added them with changed keys.

Thank you,
Matt.

On Sun, Mar 22, 2015 at 10:21 PM Matt Brooks  wrote:

&gt; I see. I'll be looking forward to the future release! Thank you, Zeeshan.
&gt;
&gt; Matt.
&gt;
&gt; On Sun, Mar 22, 2015 at 9:57 PM Zeeshan Lakhani 
&gt; wrote:
&gt;
&gt;&gt; Hey Matt,
&gt;&gt;
&gt;&gt; Thanks for clarifying the situation. Yes, I’m working on auto-reloading
&gt;&gt; and re-syncing data along with changes to schemas; it’ll be in a future
&gt;&gt; release. Currently, you can add fields to the schema, for example, for new
&gt;&gt; sets of data, and reload the index if you `riak attach` into one of the
&gt;&gt; running nodes and reload the index across the cluster (based on
&gt;&gt; https://github.com/basho/yokozuna/pull/260), e.g.
&gt;&gt; https://github.com/basho/yokozuna/issues/130#issuecomment-43802826.
&gt;&gt;
&gt;&gt; Zeeshan Lakhani
&gt;&gt; programmer |
&gt;&gt; software engineer at @basho |
&gt;&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org
&gt;&gt; twitter =&gt; @zeeshanlakhani
&gt;&gt;
&gt;&gt; On Mar 22, 2015, at 9:37 PM, Matt Brooks  wrote:
&gt;&gt;
&gt;&gt; Just discovered this on GitHub https://github.com/
&gt;&gt; basho/yokozuna/issues/130. Looks like auto-reloading is a work in
&gt;&gt; progress.
&gt;&gt;
&gt;&gt; On Sun, Mar 22, 2015 at 9:24 PM Matt Brooks  wrote:
&gt;&gt;
&gt;&gt;&gt; Not getting any errors... but I did notice something interesting after
&gt;&gt;&gt; deleting the nodes on my system and then reconfiguring them.
&gt;&gt;&gt;
&gt;&gt;&gt; If the first time I set up a schema I add the multivalued field in
&gt;&gt;&gt; question, everything works. If I then change the schema and then update it
&gt;&gt;&gt; over HTTP, the changes do not take affect.
&gt;&gt;&gt;
&gt;&gt;&gt; For example, when I reconfigured the nodes on my system I added kept the
&gt;&gt;&gt; multivalued "groups" field I mentioned above. I then added some users and
&gt;&gt;&gt; was able to successfully retrieve them using q=groups:\\* or something more
&gt;&gt;&gt; specific. I then changed the schema from "groups" to "groups.id" and
&gt;&gt;&gt; PUT it on the server successfully (a subsequent GET returned the new
&gt;&gt;&gt; schema). I also updated the users so that the "groups" array was changed to
&gt;&gt;&gt; an array of JSON objects, each with an "id" field that would match the "
&gt;&gt;&gt; groups.id" field in the schema. I then tried to query the users using
&gt;&gt;&gt; q=groups.id:\\*. This failed.
&gt;&gt;&gt;
&gt;&gt;&gt; Do changed to the schema not cause the solr indexes to update?
&gt;&gt;&gt;
&gt;&gt;&gt; PS: I dug around in $RIAK/data/yz/user/conf and noticed a user.xml file.
&gt;&gt;&gt; The file held the ORIGINAL schema, not the updated one.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Sun, Mar 22, 2015 at 6:45 PM Zeeshan Lakhani 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hello Matt,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Are you receiving any indexing errors in your logs (check the Solr logs
&gt;&gt;&gt;&gt; as well)? To be sure, I just wrote a test (using our erlang pb api,
&gt;&gt;&gt;&gt; https://github.com/basho/yokozuna/pull/474/files#diff-5
&gt;&gt;&gt;&gt; d0015658ff90b94cb1a00329ffafe00R251) using a custom schema, and I
&gt;&gt;&gt;&gt; didn’t run into any troubles; I also checked via the http api. If you have
&gt;&gt;&gt;&gt; the required \\_yz\\* fields, you should get those back with the document. If
&gt;&gt;&gt;&gt; you want the groups items themselves, you’d have to make `stored` true.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Zeeshan Lakhani
&gt;&gt;&gt;&gt; programmer |
&gt;&gt;&gt;&gt; software engineer at @basho |
&gt;&gt;&gt;&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org
&gt;&gt;&gt;&gt; twitter =&gt; @zeeshanlakhani
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Mar 22, 2015, at 4:13 PM, Matt Brooks  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have a quick question about a search schema that would index an array
&gt;&gt;&gt;&gt; of strings in a JSON object. I am storing user data in JSON that looks
&gt;&gt;&gt;&gt; something like this:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt; "name" : "John Smith",
&gt;&gt;&gt;&gt; "email" : "jsm...@gmail.com",
&gt;&gt;&gt;&gt; "groups" : [
&gt;&gt;&gt;&gt; "3304cf79",
&gt;&gt;&gt;&gt; "abe155cf"
&gt;&gt;&gt;&gt; ]}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The custom schema I use for users includes this field entry:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;&gt; multiValued="true"/&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I also have the following field type entry:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I assumed that these entries would allow me to search for users using a
&gt;&gt;&gt;&gt; query like:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; curl $RIAK/search/query/user?wt=json&q=groups:3304cf79
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; But no docs are returned. I'm almost certain I have an issue with my
&gt;&gt;&gt;&gt; schema. How can I query users by string entries in the "groups" array?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thank you,
&gt;&gt;&gt;&gt; Matt.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

