---
title: "Re: Querying 2i using erlang native api"
description: ""
project: community
lastmod: 2013-07-19T14:27:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11644"
mailinglist_parent_id: "msg11642"
author_name: "luigi max"
project_section: "mailinglistitem"
sent_date: 2013-07-19T14:27:10-07:00
---


I saw those before, the part that was not clear to me is what constitutes a
 -Query :: riak\\_index:query\\_def().
Any test I did in riak console timed out.


On Fri, Jul 19, 2013 at 2:20 PM, Sean Cribbs  wrote:

&gt; Aha, that clears things up. I'd be careful about that (the effects of
&gt; post-commit hooks will be invisible to your application) but you can use
&gt; these functions in riak\\_client:
&gt;
&gt; -export([get\\_index/4,get\\_index/3]).
&gt; -export([stream\\_get\\_index/4,stream\\_get\\_index/3]).
&gt;
&gt;
&gt;
&gt; On Fri, Jul 19, 2013 at 3:48 PM, luigi max  wrote:
&gt;
&gt;&gt; What I am trying to do is access 2i information from a post commit hook
&gt;&gt; written in erlang. What is the best way to do it from there?
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Jul 19, 2013 at 1:32 PM, Sean Cribbs  wrote:
&gt;&gt;
&gt;&gt;&gt; You should avoid using the internal client (which isn't a client,
&gt;&gt;&gt; really), except for debugging. Instead, use
&gt;&gt;&gt; https://github.com/basho/riak-erlang-client or any of our other
&gt;&gt;&gt; language-specific clients. See also
&gt;&gt;&gt; http://docs.basho.com/riak/latest/references/Client-Libraries/
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Jul 19, 2013 at 3:21 PM, luigi max  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have been looking around the Riak docs and as many other places that
&gt;&gt;&gt;&gt; I can think of and I can't seem to find how to query 2i with the Riak
&gt;&gt;&gt;&gt; internal erlang client.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I can do a query to 2i with the http interface with:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; /buckets/TEST/index/pos\\_int/1/15
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; and it returns
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {"keys":["set2i"]}
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I can create an entry with the following code (loaded into riak):
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Robj = riak\\_object:new(&lt;&lt;"TEST"&gt;&gt;, &lt;&lt;"set2i"&gt;&gt;, void, "application/json"),
&gt;&gt;&gt;&gt; Lst = [{"pos\\_int", 5}],
&gt;&gt;&gt;&gt; Meta = dict:store(&lt;&lt;"index"&gt;&gt;,Lst, dict:new()),
&gt;&gt;&gt;&gt; I2obj = riak\\_object:update\\_metadata(Robj, Meta)
&gt;&gt;&gt;&gt; {ok,C} = riak:local\\_client().
&gt;&gt;&gt;&gt; C:put(I2obj).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This works nicely, but the problem I have is with trying to figure out
&gt;&gt;&gt;&gt; how to do the same query using the native api for riak. The documentation
&gt;&gt;&gt;&gt; for anything to do with the riak internal client is effectively non
&gt;&gt;&gt;&gt; existent.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; What all I need:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; - information on how to do a integer range query
&gt;&gt;&gt;&gt; - information on my other 2i query options, in case I need it
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Any help is much appreciated.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; By Luke Harvey;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; LinkedIn Profile: http://www.linkedin.com/in/lukeharvey00
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; By Luke Harvey;
&gt;&gt;
&gt;&gt; LinkedIn Profile: http://www.linkedin.com/in/lukeharvey00
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;



-- 
By Luke Harvey;

LinkedIn Profile: http://www.linkedin.com/in/lukeharvey00
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

