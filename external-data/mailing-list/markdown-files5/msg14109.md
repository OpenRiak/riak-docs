---
title: "Re: Socket returned short packet length 0 - expected 4"
description: ""
project: community
lastmod: 2014-04-17T10:45:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14109"
mailinglist_parent_id: "msg14102"
author_name: "Jason Wang"
project_section: "mailinglistitem"
sent_date: 2014-04-17T10:45:46-07:00
---


Sean,

RE http vs pbc port: Verified that our production environment is using the
pbc protocol on port 8087.

RE crashlog: There are no entries in console.log, crash.log and error.log
for over a month.

RE HAprodxy: Our clients are connecting to the Riak servers. No reverse
proxy systems are in between.

Anything else I can look into?

Jason


On Wed, Apr 16, 2014 at 1:02 PM, Sean Cribbs  wrote:

&gt; Hi Jason,
&gt;
&gt; We usually see these errors when someone connects to the HTTP port instead
&gt; of the PB port. First, check that your client is configured correctly.
&gt; Also, please check the server logs for any crashes related to
&gt; riak\\_api\\_pb\\_server, and paste those here if present.
&gt;
&gt; It is also conceivable this could occur if the socket were closed before
&gt; anything were sent, that is, the read buffer on it is empty, so it returns
&gt; 0. I don't know of any specific reason that might happen unless you are
&gt; using haproxy between the client and the server (see related PR/issue
&gt; https://github.com/basho/riak\\_api/pull/54).
&gt;
&gt;
&gt; On Tue, Apr 15, 2014 at 6:34 PM, Jason Wang  wrote:
&gt;
&gt;&gt; HI all,
&gt;&gt;
&gt;&gt; In production, we are experiencing "Socket returned short packet length 0
&gt;&gt; - expected 4" exceptions whenever we try to store an object &gt;20K in size.
&gt;&gt; In addition, the exception typically takes over 60 seconds to manifest. The
&gt;&gt; content of each object is an bytearray.
&gt;&gt;
&gt;&gt; Any idea what could be causing this exception?
&gt;&gt;
&gt;&gt; Other details:
&gt;&gt; Library: Python
&gt;&gt; Version: riak==2.0.1, riak-pb==1.4.1.1
&gt;&gt; Protocol: pbc
&gt;&gt; Steps to reproduce: N/A. This only happens in production, not on dev
&gt;&gt; machines.
&gt;&gt;
&gt;&gt; Thanks in advance,
&gt;&gt;
&gt;&gt; Jason
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

