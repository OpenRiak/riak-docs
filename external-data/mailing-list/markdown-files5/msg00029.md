---
title: "Re: Issue with riak_client:list_keys"
description: ""
project: community
lastmod: 2010-04-13T12:08:54-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00029"
mailinglist_parent_id: "msg00028"
author_name: "Alexander Zhuravlev"
project_section: "mailinglistitem"
sent_date: 2010-04-13T12:08:54-07:00
---


On Tue, Apr 13, 2010 at 11:03 PM, Dan Reverri  wrote:
&gt; This list\\_keys method is updated asynchronously so it may not immediately
&gt; reflect the addition or removal of keys. The list\\_keys method should
&gt; eventually reflect the deletion of the key. Can you try running list\\_keys
&gt; after a delay?

We have just run the following command:

(r...@macbook-siden)9&gt; C:list\\_keys(&lt;&lt;"aaa"&gt;&gt;).
{ok,[&lt;&lt;"key1"&gt;&gt;]}

it still shows the same information (it has been about 5 hours since
we run the first C:list\\_keys command).

&gt; On Tue, Apr 13, 2010 at 11:13 AM, Alexander Zhuravlev
&gt;  wrote:
&gt;&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; We are having an issue with riak\\_client:list\\_keys function.
&gt;&gt; The thing is that the function returns information about the keys which
&gt;&gt; were successfully deleted from a bucket. For example, please check
&gt;&gt; output from our tests below:
&gt;&gt;
&gt;&gt; (r...@macbook-siden)1&gt; {ok, C} =
&gt;&gt; riak:client\\_connect('r...@macbook-siden').
&gt;&gt; {ok,{riak\\_client,'r...@macbook-siden',&lt;&lt;7,122,127,92&gt;&gt;}}
&gt;&gt; (r...@macbook-siden)2&gt; O0 = riak\\_object:new(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;,
&gt;&gt; "val1").
&gt;&gt; {r\\_object,&lt;&lt;"aaa"&gt;&gt;,&lt;&lt;"key1"&gt;&gt;,
&gt;&gt;         [{r\\_content,{dict,0,16,16,8,80,48,
&gt;&gt;                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;&gt;                           {{[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt;&gt;                     "val1"}],
&gt;&gt;         [],
&gt;&gt;         {dict,1,16,16,8,80,48,
&gt;&gt;               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;&gt;               {{[],[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt;&gt;         undefined}
&gt;&gt; (r...@macbook-siden)3&gt; C:put(O0, 2).
&gt;&gt; ok
&gt;&gt; (r...@macbook-siden)4&gt; C:list\\_keys(&lt;&lt;"aaa"&gt;&gt;).
&gt;&gt; {ok,[&lt;&lt;"key1"&gt;&gt;]}
&gt;&gt; (r...@macbook-siden)5&gt; C:delete(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;, 2).
&gt;&gt; ok
&gt;&gt; (r...@macbook-siden)6&gt; C:get(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;, 2).
&gt;&gt; {error,notfound}
&gt;&gt; (r...@macbook-siden)7&gt; C:list\\_keys(&lt;&lt;"aaa"&gt;&gt;).
&gt;&gt; {ok,[&lt;&lt;"key1"&gt;&gt;]}
&gt;&gt;
&gt;&gt; backend = ets
&gt;&gt; riak 0.9.1
&gt;&gt;
&gt;&gt; As you can see the key was successfully deleted (as it can be confirmed by
&gt;&gt; the output from riak\\_client:get call), but riak\\_client:list\\_keys still
&gt;&gt; reports that the key
&gt;&gt; exists in the bucket. Is this the intended behavior of did we hit a bug in
&gt;&gt; riak?
&gt;&gt; Please advise.
&gt;&gt;
&gt;&gt; Thanks.
&gt;&gt;
&gt;&gt; --
&gt;&gt; Alexander Zhuravlev
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;



-- 
Alexander Zhuravlev

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

