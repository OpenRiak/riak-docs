---
title: "Re: Generic server memsup terminating Mountain Lion"
description: ""
project: community
lastmod: 2014-09-14T08:57:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14892"
mailinglist_parent_id: "msg14882"
author_name: "Bryan Hunt"
project_section: "mailinglistitem"
sent_date: 2014-09-14T08:57:47-07:00
---


Spiro,

I am somewhat clueless on OSX, but I use the following command when
starting Riak, and it seems to work for me:

sudo launchctl limit maxfiles 65536 65536
ulimit -n 65536

Bryan

On Wed, Sep 10, 2014 at 1:54 AM, Toby Corkindale  wrote:

&gt; Are you trying to use Riak CS for file storage, or are you just using Riak
&gt; and storing 20M against a single key?
&gt; It's not clear from your email.
&gt;
&gt; I ask because if you're in the latter case, it's just not going to work --
&gt; I believe the maximum per key is around a single megabyte.
&gt;
&gt; On 10 September 2014 07:30, Spiro N 
&gt; wrote:
&gt;
&gt;&gt; S
&gt;&gt; \\*orry, I am sure you have posted in regards to this topic before but I am
&gt;&gt; at a stand still. It just started after doing a "get"\\*
&gt;&gt; \\*the video was about 20 MB. The beam.smp spikes at 100 and riak crashes.
&gt;&gt; I have done everything the Docs ask for and I provided all that I feel may
&gt;&gt; be relevant below. However I don't know what I don't know and could use
&gt;&gt; some help. Mountain Lion does not let you set the ulmit to unlimited.\\*
&gt;&gt;
&gt;&gt; \\*Thanks in advance for anything at all that may help.\\*
&gt;&gt;
&gt;&gt; \\*Spiro\\*
&gt;&gt;
&gt;&gt;
&gt;&gt; \\*This is my limit, I am running Mountain Lion 10.8.5\\*
&gt;&gt;
&gt;&gt; server:riak gvs$ launchctl limit
&gt;&gt; cpu unlimited unlimited
&gt;&gt; filesize unlimited unlimited
&gt;&gt; data unlimited unlimited
&gt;&gt; stack 8388608 67104768
&gt;&gt; core 0 unlimited
&gt;&gt; rss unlimited unlimited
&gt;&gt; memlock unlimited unlimited
&gt;&gt; maxproc 709 1064
&gt;&gt; \\*maxfiles 65336 1000000 \\*
&gt;&gt; ----------------------------------------------------------
&gt;&gt;
&gt;&gt; \\*This is my Bitcask content\\*
&gt;&gt; server:lib gvs$ cd /usr/local/var/lib/riak/
&gt;&gt; server:riak gvs$ ls bitcask/\\*/\\* |wc -l
&gt;&gt; 206
&gt;&gt; --------------------------------------------------------------
&gt;&gt; \\*This is the crash.log message\\*
&gt;&gt;
&gt;&gt;
&gt;&gt; 2014-09-09 14:34:51 =ERROR REPORT====
&gt;&gt; \\*\\* Generic server memsup terminating
&gt;&gt; \\*\\* Last message in was
&gt;&gt; {'EXIT',&lt;0.20807.0&gt;,{emfile,[{erlang,open\\_port,[{spawn,"/bin/sh -s unix:cmd
&gt;&gt; 2&gt;&1"},[stream]],[]},{os,start\\_port\\_srv\\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\\_port\\_srv\\_loop,0,[{file,"os.erl"},{line,270}]}]}}
&gt;&gt; \\*\\* When Server state ==
&gt;&gt; {state,{unix,darwin},false,undefined,undefined,false,60000,30000,0.8,0.05,&lt;0.20807.0&gt;,#Ref&lt;0.0.0.120573&gt;,undefined,[reg],[]}
&gt;&gt; \\*\\* Reason for termination ==
&gt;&gt; \\*\\* {emfile,[{erlang,open\\_port,[{spawn,"/bin/sh -s unix:cmd
&gt;&gt; 2&gt;&1"},[stream]],[]},{os,start\\_port\\_srv\\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\\_port\\_srv\\_loop,0,[{file,"os.erl"},{line,270}]}]}
&gt;&gt; 2014-09-09 14:34:51 =CRASH REPORT====
&gt;&gt; crasher:
&gt;&gt; initial call: memsup:init/1
&gt;&gt; pid: &lt;0.20806.0&gt;
&gt;&gt; registered\\_name: memsup
&gt;&gt; exception exit: {{emfile,[{erlang,open\\_port,[{spawn,"/bin/sh -s
&gt;&gt; unix:cmd
&gt;&gt; 2&gt;&1"},[stream]],[]},{os,start\\_port\\_srv\\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\\_port\\_srv\\_loop,0,[{file,"os.erl"},{line,270}]}]},[{gen\\_server,terminate,6,[{file,"gen\\_server.erl"},{line,747}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]}
&gt;&gt; ancestors: [os\\_mon\\_sup,&lt;0.96.0&gt;]
&gt;&gt; messages: []
&gt;&gt; links: [&lt;0.97.0&gt;]
&gt;&gt; dictionary: []
&gt;&gt; trap\\_exit: true
&gt;&gt; status: running
&gt;&gt; heap\\_size: 377
&gt;&gt; stack\\_size: 24
&gt;&gt; reductions: 204
&gt;&gt; neighbours:
&gt;&gt; 2014-09-09 14:34:51 =SUPERVISOR REPORT====
&gt;&gt; Supervisor: {local,os\\_mon\\_sup}
&gt;&gt; Context: child\\_terminated
&gt;&gt; Reason: {emfile,[{erlang,open\\_port,[{spawn,"/bin/sh -s unix:cmd
&gt;&gt; 2&gt;&1"},[stream]],[]},{os,start\\_port\\_srv\\_handle,1,[{file,"os.erl"},{line,254}]},{os,start\\_port\\_srv\\_loop,0,[{file,"os.erl"},{line,270}]}]}
&gt;&gt; Offender:
&gt;&gt; [{pid,&lt;0.20806.0&gt;},{name,memsup},{mfargs,{memsup,start\\_link,[]}},{restart\\_type,permanent},{shutdown,2000},{child\\_type,worker}]
&gt;&gt;
&gt;&gt; 2014-09-09 14:34:51 =SUPERVISOR REPORT====
&gt;&gt; Supervisor: {local,os\\_mon\\_sup}
&gt;&gt; Context: shutdown
&gt;&gt; Reason: reached\\_max\\_restart\\_intensity
&gt;&gt; Offender: [{pid,&lt;0.20806.0&gt;},{name,memsup},{mfargs,{memsup,st
&gt;&gt;
&gt;&gt; ------------------------------------------------------------------------------------------------
&gt;&gt; \\*This is the error.log message\\*
&gt;&gt;
&gt;&gt; server:riak gvs$ tail error.log
&gt;&gt; 2014-09-09 17:00:25.907 [error] &lt;0.439.1&gt; gen\\_server memsup terminated
&gt;&gt; with reason: maximum number of file descriptors exhausted, check ulimit -n
&gt;&gt; 2014-09-09 17:00:25.908 [error] &lt;0.439.1&gt; CRASH REPORT Process memsup
&gt;&gt; with 0 neighbours exited with reason: maximum number of file descriptors
&gt;&gt; exhausted, check ulimit -n in gen\\_server:terminate/6 line 747
&gt;&gt; 2014-09-09 17:00:25.908 [error] &lt;0.97.0&gt; Supervisor os\\_mon\\_sup had child
&gt;&gt; memsup started with memsup:start\\_link() at &lt;0.439.1&gt; exit with reason
&gt;&gt; maximum number of file descriptors exhausted, check ulimit -n in context
&gt;&gt; child\\_terminated
&gt;&gt; 2014-09-09 17:00:25.908 [error] &lt;0.442.1&gt; gen\\_server memsup terminated
&gt;&gt; with reason: maximum number of file descriptors exhausted, check ulimit -n
&gt;&gt; 2014-09-09 17:00:25.908 [error] &lt;0.442.1&gt; CRASH REPORT Process memsup
&gt;&gt; with 0 neighbours exited with reason: maximum number of file descriptors
&gt;&gt; exhausted, check ulimit -n in gen\\_server:terminate/6 line 747
&gt;&gt; 2014-09-09 17:00:25.909 [error] &lt;0.97.0&gt; Supervisor os\\_mon\\_sup had child
&gt;&gt; memsup started with memsup:start\\_link() at &lt;0.442.1&gt; exit with reason
&gt;&gt; maximum number of file descriptors exhausted, check ulimit -n in context
&gt;&gt; child\\_terminated
&gt;&gt; 2014-09-09 17:00:25.909 [error] &lt;0.445.1&gt; gen\\_server memsup terminated
&gt;&gt; with reason: maximum number of file descriptors exhausted, check ulimit -n
&gt;&gt; 2014-09-09 17:00:25.909 [error] &lt;0.445.1&gt; CRASH REPORT Process memsup
&gt;&gt; with 0 neighbours exited with reason: maximum number of file descriptors
&gt;&gt; exhausted, check ulimit -n in gen\\_server:terminate/6 line 747
&gt;&gt; 2014-09-09 17:00:25.909 [error] &lt;0.97.0&gt; Supervisor os\\_mon\\_sup had child
&gt;&gt; memsup started with memsup:start\\_link() at &lt;0.445.1&gt; exit with reason
&gt;&gt; maximum number of file descriptors exhausted, check ulimit -n in context
&gt;&gt; child\\_terminated
&gt;&gt; 2014-09-09 17:00:25.910 [error] &lt;0.97.0&gt; Supervisor os\\_mon\\_sup had child
&gt;&gt; memsup started with memsup:start\\_link() at &lt;0.445.1&gt; exit with reason
&gt;&gt; reached\\_max\\_restart\\_intensity in context shutdown
&gt;&gt;
&gt;&gt; --------------------------------------------------------------------------------------------------
&gt;&gt; \\*This is the erlang.log\\*
&gt;&gt;
&gt;&gt; server:riak gvs$ tail erlang.log.1
&gt;&gt; Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:4:4] [async-threads:64]
&gt;&gt; [kernel-poll:true]
&gt;&gt;
&gt;&gt; Eshell V5.9.1 (abort with ^G)
&gt;&gt; (riak@172.16.205.254)1&gt;
&gt;&gt; ===== ALIVE Tue Sep 9 16:29:28 EDT 2014
&gt;&gt;
&gt;&gt; ===== ALIVE Tue Sep 9 16:44:28 EDT 2014
&gt;&gt;
&gt;&gt; ===== ALIVE Tue Sep 9 16:59:28 EDT 2014
&gt;&gt; {"Kernel pid
&gt;&gt; terminated",application\\_controller,"{application\\_terminated,os\\_mon,shutdown}"}
&gt;&gt; server:riak gvs$
&gt;&gt;
&gt;&gt; This message and any attachments are intended only for the use of the
&gt;&gt; addressee and may contain information that is privileged and confidential.
&gt;&gt; If the reader of the message is not the intended recipient or an authorized
&gt;&gt; representative of the intended recipient, you are hereby notified that any
&gt;&gt; dissemination of this communication is strictly prohibited. If you have
&gt;&gt; received this communication in error, notify the sender immediately by
&gt;&gt; return email and delete the message and any attachments from your system.
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Turning and turning in the widening gyre
&gt; The falcon cannot hear the falconer
&gt; Things fall apart; the center cannot hold
&gt; Mere anarchy is loosed upon the world
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

