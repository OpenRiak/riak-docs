---
title: "Re: Deleting data from LevelDB backend"
description: ""
project: community
lastmod: 2013-09-26T03:56:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12409"
mailinglist_parent_id: "msg12379"
author_name: "Simon Effenberg"
project_section: "mailinglistitem"
sent_date: 2013-09-26T03:56:13-07:00
---


Thanks Matthew,

but one thing I didn't get. If I delete a sst file.. should I delete
(by hand) the MANIFEST file to trigger a repair or is it done
automatically within Riak if it detects that a sst file which is
referenced in the MANIFEST is missing?

Cheers
Simon

On Wed, 25 Sep 2013 09:58:51 -0400
Matthew Von-Maszewski  wrote:

&gt; Simon,
&gt; 
&gt; I want to point out again that I do not like my answer … but currently lack a 
&gt; better one. The manual delete of .sst files should be treated as a last 
&gt; resort. Only do it if you really, really cannot wait for normal compactions 
&gt; to purge the old data.
&gt; 
&gt; To your question:
&gt; 
&gt; leveldb keeps a list of .sst table files in its MANIFEST file. If the .sst 
&gt; table files are deleted manually, the MANIFEST is no longer accurate. An 
&gt; inaccurate MANIFEST file leads to leveldb internal errors and sometimes 
&gt; infinite loops.
&gt; 
&gt; The repair process erases the current MANIFEST file and builds a new one 
&gt; based upon the files actually found on disk.
&gt; 
&gt; WARNING: repair takes a really, really long time in Riak 1.2.0 … it gets 
&gt; better in 1.2.1 … and improves to something quite reasonable by 1.3 and 1.4.
&gt; 
&gt; A discussion about repair can be found here:
&gt; 
&gt; https://github.com/basho/leveldb/wiki/repair-notes
&gt; 
&gt; Matthew
&gt; 
&gt; 
&gt; On Sep 25, 2013, at 9:38 AM, Simon Effenberg  
&gt; wrote:
&gt; 
&gt; &gt; On Wed, 25 Sep 2013 09:15:33 -0400
&gt; &gt; Matthew Von-Maszewski  wrote:
&gt; &gt; 
&gt; &gt;&gt; - run Riak repair on the vnode so that leveldb can create a MANIFEST that 
&gt; &gt;&gt; matches the files remaining.
&gt; &gt; 
&gt; &gt; what do you mean with this? Wait for AAE? Request each key to trigger
&gt; &gt; read repair or do I miss something?
&gt; &gt; 
&gt; &gt; We are in a similar situation.. only sst\\_4 exists in our situation but
&gt; &gt; we also delete old stuff regularly..
&gt; &gt; 
&gt; &gt; Cheers
&gt; &gt; Simon 
&gt; &gt; 
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 


-- 
Simon Effenberg | Site Ops Engineer | mobile.international GmbH
Fon: + 49-(0)30-8109 - 7173
Fax: + 49-(0)30-8109 - 7131

Mail: seffenb...@team.mobile.de
Web: www.mobile.de

Marktplatz 1 | 14532 Europarc Dreilinden | Germany


Geschäftsführer: Malte Krüger
HRB Nr.: 18517 P, Amtsgericht Potsdam
Sitz der Gesellschaft: Kleinmachnow 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

