---
title: "Re: Erlang PB client"
description: ""
project: community
lastmod: 2013-07-15T16:35:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11546"
mailinglist_parent_id: "msg11542"
author_name: "Igor Karymov"
project_section: "mailinglistitem"
sent_date: 2013-07-15T16:35:24-07:00
---


We have two different unlinked riak clusters.
One used for statistic aggregation across the system. This one heavily
abuse riak secondary indexes range query feature, so we have to grow it
with caution.
Another one used as our main storage. Both clusters have different
backends, different nodes count, and occasionally different riak version.
Our library handle this use case.
Also we implemented keep alive pings to each riak node inside each cluster
(one special keep\\_alive connection to each node, that periodically call pb
client ping function).
This mechanism allow us handle gracefully downs and ups of riak nodes
 inside one cluster (if a particular node of the cluster stops responding,
the pool is temporarily stops route requests to it).
With this small update external load balancer is no needed anymore.


2013/7/16 Mark Phillips 

&gt; Hi Igor,
&gt;
&gt;
&gt; On Mon, Jul 15, 2013 at 3:00 PM, Igor Karymov  wrote:
&gt;
&gt;&gt; Unfortunately this library is not included into "community projects" wiki
&gt;&gt; page list and i have no idea how-to fix this. Maybe somebody from basho
&gt;&gt; guys can help us.
&gt;&gt;
&gt;&gt;
&gt;
&gt; I just went ahead and opened a pull request to add it the docs [1]. Feel
&gt; free to do so in the future when you've got something to add.
&gt;
&gt;
&gt; &gt; Also our library provide interface wrapper and multicluster
&gt; configuration.
&gt;
&gt; Can you elaborate on how the multicluster configuration works and how you
&gt; are using it in production?
&gt;
&gt; Best,
&gt;
&gt; Mark
&gt;
&gt;
&gt; [1] https://github.com/basho/basho\\_docs/pull/489
&gt;
&gt;
&gt;&gt;
&gt;&gt; 2013/7/16 Konstantin Kalin 
&gt;&gt;
&gt;&gt;&gt; Thank you for sharing it. I built similar application already (pool +
&gt;&gt;&gt; multi-node connections) after I had got confirmation that there is no
&gt;&gt;&gt; "official way" :) Lucky it wasn't hard at all and laid down into existing
&gt;&gt;&gt; prototype nicely (mostly because it's in-house app).
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you,
&gt;&gt;&gt; Konstantin.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon, Jul 15, 2013 at 2:43 PM, Igor Karymov wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi. Maybe this will be usefull for you:
&gt;&gt;&gt;&gt; https://github.com/unisontech/uriak\\_pool
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; We was have to write our own solution, because poolboy was not be able
&gt;&gt;&gt;&gt; handle riak nodes ups and downs gracefully.
&gt;&gt;&gt;&gt; Also our library provide interface wrapper and multicluster
&gt;&gt;&gt;&gt; configuration.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2013/7/11 Sean Cribbs 
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; We intend to overhaul the Erlang client soon. In the meantime, Riak CS
&gt;&gt;&gt;&gt;&gt; has done exactly what Jeremy has suggested. Look here:
&gt;&gt;&gt;&gt;&gt; https://github.com/basho/riak\\_cs/blob/develop/src/riak\\_cs\\_riakc\\_pool\\_worker.erl
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Wed, Jul 10, 2013 at 5:46 PM, Konstantin Kalin &lt;
&gt;&gt;&gt;&gt;&gt; konstantin.ka...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Oopsâ€¦ was looking at wrong column. Sorry and thanks for the advice.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Thank you,
&gt;&gt;&gt;&gt;&gt;&gt; Konstantin.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Jul 10, 2013, at 3:41 PM, Jeremy Ong wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; The X there indicates that it does not support connection pooling out
&gt;&gt;&gt;&gt;&gt;&gt; of the box in contrast to the check. I'd look at poolboy (to use in
&gt;&gt;&gt;&gt;&gt;&gt; conjunction with riakc\\_pb\\_socket) and riakpool (which pulls in
&gt;&gt;&gt;&gt;&gt;&gt; riak-erlang-client as a dependency).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Wed, Jul 10, 2013 at 3:33 PM, Konstantin Kalin &lt;
&gt;&gt;&gt;&gt;&gt;&gt; konstantin.ka...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Looking at
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://docs.basho.com/riak/latest/references/Client-Libraries/ I
&gt;&gt;&gt;&gt;&gt;&gt;&gt; see that Erlang riak client should support Cluster connections/pools. 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; But
&gt;&gt;&gt;&gt;&gt;&gt;&gt; looking at Erlang riak client source code I would say that it doesn't
&gt;&gt;&gt;&gt;&gt;&gt;&gt; support Cluster connections/pools out of box. And I have to develop my 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; own
&gt;&gt;&gt;&gt;&gt;&gt;&gt; code to have load balancing/connection pool. Is it right and the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; documentation is incorrect and needs to be updated?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thank you,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Konstantin.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

