---
title: "Re: Migration from memcachedb to riak"
description: ""
project: community
lastmod: 2013-07-10T04:07:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11443"
mailinglist_parent_id: "msg11440"
author_name: "Edgar Veiga"
project_section: "mailinglistitem"
sent_date: 2013-07-10T04:07:32-07:00
---


Hi Damien,

Well let's dive into this a little bit.

I told you guys that bitcask was not an option due to a bad past
experiencie with couchbase (sorry, in the previous post I wrote couchdb),
that uses the same architecture as bitcask, keys in memory and values in
disk.

We started the migration to couchbase, and were already using 3 physical
nodes and only had imported 5% of the real data! That was one of the main
reasons for choosing a solution like riak + leveldb, to delete the keys fit
in memory bottleneck..

Now, here's a tipical key (It's large :D, x=letter and 0=numbers ):

xxxxxxx\\_xxxxxxxx\\_xxxxxxxx\\_00000xxxxx\\_0000000000\\_00000000000\\_0000000xxxxxx

We are using the php serialize native function!

Best regards



On 10 July 2013 11:43, damien krotkine  wrote:

&gt;
&gt;
&gt;
&gt; On 10 July 2013 11:03, Edgar Veiga  wrote:
&gt;
&gt;&gt; Hi Guido.
&gt;&gt;
&gt;&gt; Thanks for your answer!
&gt;&gt;
&gt;&gt; Bitcask it's not an option due to the amount of ram needed.. We would
&gt;&gt; need a lot more of physical nodes so more money spent...
&gt;&gt;
&gt;
&gt; Why is it not an option?
&gt;
&gt; If you use Bitcask, then each node needs to store its keys in memory. It's
&gt; usually not a lot. In a precedent email I asked you the average lenght of
&gt; \\*keys\\*, but you gave us the average length of \\*values\\* :)
&gt;
&gt; We have 1 billion keys and fits on a 5 nodes Ring. ( check out
&gt; http://docs.basho.com/riak/1.2.0/references/appendices/Bitcask-Capacity-Planning/).
&gt; Our bucket names are 1 letter, our keys are 10 chars long.
&gt;
&gt; What does a typical key look like ? Also, what are you using to serialize
&gt; your php objects? Maybe you could paste a typical value somewhere as well
&gt;
&gt; Damien
&gt;
&gt;
&gt;&gt;
&gt;&gt; Instead we're using less machines with SSD disks to improve elevelDB
&gt;&gt; performance.
&gt;&gt;
&gt;&gt; Best regards
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On 10 July 2013 09:58, Guido Medina  wrote:
&gt;&gt;
&gt;&gt;&gt; Well, I rushed my answer before, if you want performance, you probably
&gt;&gt;&gt; want Bitcask, if you want compression then LevelDB, the following links
&gt;&gt;&gt; should help you decide better:
&gt;&gt;&gt;
&gt;&gt;&gt; http://docs.basho.com/riak/1.2.0/tutorials/choosing-a-backend/Bitcask/
&gt;&gt;&gt; http://docs.basho.com/riak/1.2.0/tutorials/choosing-a-backend/LevelDB/
&gt;&gt;&gt;
&gt;&gt;&gt; Or multi, use one as default and then the other for specific buckets:
&gt;&gt;&gt;
&gt;&gt;&gt; http://docs.basho.com/riak/1.2.0/tutorials/choosing-a-backend/Multi/
&gt;&gt;&gt;
&gt;&gt;&gt; HTH,
&gt;&gt;&gt;
&gt;&gt;&gt; Guido.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On 10/07/13 09:53, Guido Medina wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Then you are better off with Bitcask, that will be the fastest in your
&gt;&gt;&gt; case (no 2i, no searches, no M/R)
&gt;&gt;&gt;
&gt;&gt;&gt; HTH,
&gt;&gt;&gt;
&gt;&gt;&gt; Guido.
&gt;&gt;&gt;
&gt;&gt;&gt; On 10/07/13 09:49, Edgar Veiga wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hello all!
&gt;&gt;&gt;
&gt;&gt;&gt; I have a couple of questions that I would like to address all of you
&gt;&gt;&gt; guys, in order to start this migration the best as possible.
&gt;&gt;&gt;
&gt;&gt;&gt; Context:
&gt;&gt;&gt; - I'm responsible for the migration of a pure key/value store that for
&gt;&gt;&gt; now is being stored on memcacheDB.
&gt;&gt;&gt; - We're serializing php objects and storing them.
&gt;&gt;&gt; - The total size occupied it's ~2TB.
&gt;&gt;&gt;
&gt;&gt;&gt; - The idea it's to migrate this data to a riak cluster with elevelDB
&gt;&gt;&gt; backend (starting with 6 nodes, 256 partitions. This thing is scaling very
&gt;&gt;&gt; fast).
&gt;&gt;&gt; - We only need to access the information by key. \\*We won't need neither
&gt;&gt;&gt; map/reduces, searches or secondary indexes\\*. It's a pure key/value
&gt;&gt;&gt; store!
&gt;&gt;&gt;
&gt;&gt;&gt; My questions are:
&gt;&gt;&gt; - Do you have any riak fine tunning tip regarding this use case (due to
&gt;&gt;&gt; the fact that we will only use the key/value capabilities of riak)?
&gt;&gt;&gt; - It's expected that those 2TB would be reduced due to the levelDB
&gt;&gt;&gt; compression. Do you think we should compress our objects to on the client?
&gt;&gt;&gt;
&gt;&gt;&gt; Best regards,
&gt;&gt;&gt; Edgar Veiga
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing 
&gt;&gt;&gt; listriak-users@lists.basho.comhttp://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

