---
title: "Cluster start and 2i query"
description: ""
project: community
lastmod: 2014-02-22T14:31:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13697"
author_name: "Daniel Iwan"
project_section: "mailinglistitem"
sent_date: 2014-02-22T14:31:48-08:00
---


On 5 node cluster when our servers boot our application (which runs on the
same nodes as riak and queries localhost) I got

Caused by: com.basho.riak.client.RiakRetryFailedException:
com.basho.riak.pbc.RiakError: {error,insufficient\\_vnodes\\_available}
 at com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:79)
at com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
 at com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
at com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
 at com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:53)
at
com.basho.riak.client.query.indexes.FetchIndex.execute(FetchIndex.java:66)
 at server.distributeddb.riak.d.c(SourceFile:461)
... 15 more
Caused by: com.basho.riak.pbc.RiakError:
{error,insufficient\\_vnodes\\_available}
 at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:125)
at com.basho.riak.pbc.RiakClient.processIndexReply(RiakClient.java:446)
 at com.basho.riak.pbc.RiakClient.index(RiakClient.java:374)
at
com.basho.riak.client.raw.pbc.PBClientAdapter$3.write(PBClientAdapter.java:445)
 at
com.basho.riak.client.raw.query.indexes.BinRangeQuery.write(BinRangeQuery.java:52)
at
com.basho.riak.client.raw.pbc.PBClientAdapter.fetchIndex(PBClientAdapter.java:460)
 at
com.basho.riak.client.query.indexes.FetchIndex$1.call(FetchIndex.java:68)
at com.basho.riak.client.query.indexes.FetchIndex$1.call(FetchIndex.java:66)
 at com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:72)
... 21 more

This happened during 2i query on node boot when Riak was not yet ready and
our app started to query Riak. In my case 2 nodes were slower with booting

I know about wait-for-service which probably should be used but I'm not
100% sure it would solve the problem.
I suppose my question is how can I make sure Riak is stable enough to start
querying via 2i
and avoid insufficient\\_vnodes\\_available?
Should I wait until at least allNodes-1 is up and running (wait-for-service
reorts Riak node ready?)

On a related note. Does 2i query uses primary vnodes to select covering set?

Regards
Daniel
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

