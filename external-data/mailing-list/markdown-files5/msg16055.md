---
title: "Re: Yokozuna queries slow"
description: ""
project: community
lastmod: 2015-04-21T13:03:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16055"
mailinglist_parent_id: "msg16047"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-04-21T13:03:23-07:00
---


Nice Steve.

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\\_we\\_love | paperswelove.org
twitter =&gt; @zeeshanlakhani

&gt; On Apr 21, 2015, at 3:57 PM, Steve Garon  wrote:
&gt; 
&gt; Jason, 
&gt; 
&gt; Comment the  section in the bucket's solrconfig.xml and 
&gt; restart riak. Now your queries will be fast again :-)
&gt; 
&gt; 
&gt; Steve
&gt; 
&gt; On 21 April 2015 at 04:24, Zeeshan Lakhani  &gt; wrote:
&gt; No real workaround other than what you described or looking into 
&gt; config/fq-no-cache settings as mentioned in 
&gt; http://lucidworks.com/blog/advanced-filter-caching-in-solr/ 
&gt;  and playing 
&gt; around with those.
&gt; 
&gt; Riak is now at 2.1.0. I hope that one of the next few point releases will see 
&gt; the fix. 
&gt; 
&gt; 
&gt; Zeeshan Lakhani
&gt; programmer | 
&gt; software engineer at @basho | 
&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org 
&gt; 
&gt; twitter =&gt; @zeeshanlakhani
&gt; 
&gt;&gt; On Apr 21, 2015, at 4:11 AM, Jason Campbell &gt; &gt; wrote:
&gt;&gt; 
&gt;&gt; Thanks Zeeshan for the info.
&gt;&gt; 
&gt;&gt; Is there a workaround in the mean time, or is the only option to handle 
&gt;&gt; queries to the individual nodes ourselves?
&gt;&gt; 
&gt;&gt; Is there a planned timeframe for the 2.0.1 release?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Jason
&gt;&gt; 
&gt;&gt;&gt; On 21 Apr 2015, at 16:13, Zeeshan Lakhani &gt;&gt; &gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Hey Jason,
&gt;&gt;&gt; 
&gt;&gt;&gt; We’re working on performance issues with YZ filter queries, e.g. 
&gt;&gt;&gt; https://github.com/basho/yokozuna/issues/392 
&gt;&gt;&gt; , and coverage plan 
&gt;&gt;&gt; generation/caching, and our CliServ team has started doing a ton of 
&gt;&gt;&gt; benchmarks as well.
&gt;&gt;&gt; 
&gt;&gt;&gt; You can bypass YZ, but then you’d have to create a way to generate your own 
&gt;&gt;&gt; coverage plans and other things involving distributed solr that YZ gives 
&gt;&gt;&gt; you. Nonetheless, we’re actively working on improving these issues you’ve 
&gt;&gt;&gt; encountered. 
&gt;&gt;&gt; 
&gt;&gt;&gt; Zeeshan Lakhani
&gt;&gt;&gt; programmer | 
&gt;&gt;&gt; software engineer at @basho | 
&gt;&gt;&gt; org. member/founder of @papers\\_we\\_love | paperswelove.org 
&gt;&gt;&gt; 
&gt;&gt;&gt; twitter =&gt; @zeeshanlakhani
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Apr 21, 2015, at 1:06 AM, Jason Campbell &gt;&gt;&gt; &gt; wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I'm currently trying to debug slow YZ queries, and I've narrowed down the 
&gt;&gt;&gt;&gt; issue, but not sure how to solve it.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; First off, we have about 80 million records in Riak (and YZ), but the 
&gt;&gt;&gt;&gt; queries return relatively few (a thousand or so at most). Our query times 
&gt;&gt;&gt;&gt; are anywhere from 800ms to 1.5s.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I have been experimenting with queries directly on the Solr node, and it 
&gt;&gt;&gt;&gt; seems to be a problem with YZ and the way it does vnode filters.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Here is the same query, emulating YZ first:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt; "responseHeader":{
&gt;&gt;&gt;&gt; "status":0,
&gt;&gt;&gt;&gt; "QTime":958,
&gt;&gt;&gt;&gt; "params":{
&gt;&gt;&gt;&gt; "q":"timestamp:[1429579919010 TO 1429579921010]",
&gt;&gt;&gt;&gt; "indent":"true",
&gt;&gt;&gt;&gt; "fq":"\\_yz\\_pn:55 OR \\_yz\\_pn:40 OR \\_yz\\_pn:25 OR \\_yz\\_pn:10",
&gt;&gt;&gt;&gt; "rows":"0",
&gt;&gt;&gt;&gt; "wt":"json"}},
&gt;&gt;&gt;&gt; "response":{"numFound":80,"start":0,"docs":[]
&gt;&gt;&gt;&gt; }}
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; And the same query, but including the vnode filter in the main body 
&gt;&gt;&gt;&gt; instead of using a filter query:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt; "responseHeader":{
&gt;&gt;&gt;&gt; "status":0,
&gt;&gt;&gt;&gt; "QTime":1,
&gt;&gt;&gt;&gt; "params":{
&gt;&gt;&gt;&gt; "q":"timestamp:[1429579919010 TO 1429579921010] AND (\\_yz\\_pn:55 OR 
&gt;&gt;&gt;&gt; \\_yz\\_pn:40 OR \\_yz\\_pn:25 OR \\_yz\\_pn:10)",
&gt;&gt;&gt;&gt; "indent":"true",
&gt;&gt;&gt;&gt; "rows":"0",
&gt;&gt;&gt;&gt; "wt":"json"}},
&gt;&gt;&gt;&gt; "response":{"numFound":80,"start":0,"docs":[]
&gt;&gt;&gt;&gt; }}
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I understand there is a caching benefit to using filter queries, but a 
&gt;&gt;&gt;&gt; performance difference of 100x or greater doesn't seem worth it, 
&gt;&gt;&gt;&gt; especially with a constant data stream.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Is there a way to make YZ do this, or is the only way to query Solr 
&gt;&gt;&gt;&gt; directly, bypassing YZ? Does anyone have any other suggestions of how to 
&gt;&gt;&gt;&gt; make this faster?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; The timestamp field is a SolrTrieLongField with default settings if anyone 
&gt;&gt;&gt;&gt; is curious.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; Jason
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com 
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com 
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com 
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com 
&gt; 
&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

