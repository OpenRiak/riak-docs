---
title: "Re: 2i: url encoding/decoding of index names/values"
description: ""
project: community
lastmod: 2013-02-21T01:44:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10162"
mailinglist_parent_id: "msg10160"
author_name: "Age Mooij"
project_section: "mailinglistitem"
sent_date: 2013-02-21T01:44:52-08:00
---


I know, that's the reason why I thought it was probably best to encode the 
values coming in because otherwise I would have to reject any value coming into 
my client if it would contain spaces or (especially) commas.

Unfortunately an index fetch (url encoded both name and value) will then never 
match. How do you encode the index fetch URL in such a way that it matches 
encoded values?

Age


On Feb 20, 2013, at 22:45, Christian Dahlqvist  wrote:

&gt; Hi Age,
&gt; 
&gt; One thing to consider is that Riak allows a secondary index to have multiple 
&gt; values. I can e.g. create an object with two values for a integer secondary 
&gt; index as follows:
&gt; 
&gt; curl -X PUT -H "Content-Type: text/plain" -H 'x-riak-index-idx\\_int: 12' 
&gt; -H 'x-riak-index-idx\\_int: 13' -d 'data' 
&gt; http://localhost:8098/buckets/testbucket/keys/key2
&gt; 
&gt; When this object is retrieved, the secondary index with the two values 
&gt; will/may be presented in a single header containing a comma and a space to 
&gt; separate the values as follows:
&gt; 
&gt; curl -v -X HEAD http://localhost:8098/buckets/testbucket/keys/key2
&gt; &lt; HTTP/1.1 200 OK
&gt; &lt; X-Riak-Vclock: a85hYGBgzGDKBVIcEQaWHIFK0u0ZTImMeawMRntnnuLLAgA=
&gt; &lt; x-riak-index-idx\\_int: 12, 13
&gt; &lt; Vary: Accept-Encoding
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt; &lt; Link: ; rel="up"
&gt; &lt; Last-Modified: Wed, 20 Feb 2013 21:33:38 GMT
&gt; &lt; ETag: "3Wz7RJnOL4ofIeX1hYDr84"
&gt; &lt; Date: Wed, 20 Feb 2013 21:40:30 GMT
&gt; &lt; Content-Type: text/plain
&gt; &lt; Content-Length: 4
&gt; 
&gt; Best regards,
&gt; 
&gt; Christian
&gt; 
&gt; 
&gt; On 20 Feb 2013, at 20:56, Age Mooij  wrote:
&gt; 
&gt;&gt; Hi all,
&gt;&gt; 
&gt;&gt; I'm writing a new Scala (http) client library for Riak [1] and I ran into 
&gt;&gt; some trouble with special characters while implementing 2i. 
&gt;&gt; 
&gt;&gt; Reading through the docs, all the 2i examples are for simple one-word index 
&gt;&gt; names but I have not been able to find any rules about index names and 
&gt;&gt; values containing spaces, commas, and other special characters and how the 
&gt;&gt; HTTP api deals with encoding and decoding these?
&gt;&gt; 
&gt;&gt; My unit tests use the following troublesome corner cases:
&gt;&gt; 
&gt;&gt; - index values containing spaces
&gt;&gt; - index names containing spaces
&gt;&gt; - index values containing commas
&gt;&gt; 
&gt;&gt; I tried a number of approaches and none of them work for all three:
&gt;&gt; 
&gt;&gt; 1) Don't encode the index names or the values when creating "x-riak-index-" 
&gt;&gt; http headers but encode both the name and the value in the URL used to fetch 
&gt;&gt; by an index
&gt;&gt; 
&gt;&gt; This works fine for values containing spaces but creates illegal headers for 
&gt;&gt; index names containing spaces and breaks for values containing commas (the 
&gt;&gt; values get split into two).
&gt;&gt; 
&gt;&gt; 2) Encode everything
&gt;&gt; 
&gt;&gt; This creates valid headers and storing index values containing commas now 
&gt;&gt; works fine. The only trouble is that index fetching fails whenever there are 
&gt;&gt; spaces, commas or other encoded characters involved.
&gt;&gt; 
&gt;&gt; Could anyone enlighten me about the correct way to deal with these cases?
&gt;&gt; 
&gt;&gt; Regards,
&gt;&gt; Age
&gt;&gt; 
&gt;&gt; 
&gt;&gt; [1] https://github.com/agemooij/riak-scala-client
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

