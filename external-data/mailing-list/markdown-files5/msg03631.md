---
title: "Re: Pros/Cons to not storing JSON"
description: ""
project: community
lastmod: 2011-06-09T15:01:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03631"
mailinglist_parent_id: "msg03628"
author_name: "Andrew Berman"
project_section: "mailinglistitem"
sent_date: 2011-06-09T15:01:44-07:00
---


Well, I'd rather not do it that way and converting it to a string. But
another thing I can do is convert the record to a proplist and then store
that in the database. When I pull it out of the database, I would have to
loop through the fields of the record definition, use each field as a key in
the proplist to get the value out of the proplist. This would avoid the
issue Sean raised with storing a record directly.

On Thu, Jun 9, 2011 at 2:41 PM, Evans, Matthew  wrote:

&gt; Hi,
&gt;
&gt;
&gt;
&gt; Why not convert your term to a string, and then you can do map reduce can’t
&gt; you?
&gt;
&gt;
&gt;
&gt; Term to a string…
&gt;
&gt;
&gt;
&gt; 1&gt; Term = [{one,1},{two,2},{three,3}].
&gt;
&gt; [{one,1},{two,2},{three,3}]
&gt;
&gt; 2&gt; String = lists:flatten(io\\_lib:format("~p.", [Term])).
&gt;
&gt; "[{one,1},{two,2},{three,3}]."
&gt;
&gt;
&gt;
&gt; Save “String” in riak…
&gt;
&gt;
&gt;
&gt; Then back to a term…
&gt;
&gt;
&gt;
&gt; 3&gt; String = "[{one,1},{two,2},{three,3}].".
&gt;
&gt; "[{one,1},{two,2},{three,3}]."
&gt;
&gt; 4&gt; {ok,Tok,\\_} = erl\\_scan:string(String).
&gt;
&gt; 5&gt; {ok,Term} = erl\\_parse:parse\\_term(Tok).
&gt;
&gt; {ok,[{one,1},{two,2},{three,3}]}
&gt;
&gt;
&gt;
&gt; /Matt
&gt;
&gt;
&gt; ------------------------------
&gt;
&gt; \\*From:\\* riak-users-boun...@lists.basho.com [mailto:
&gt; riak-users-boun...@lists.basho.com] \\*On Behalf Of \\*Will Moss
&gt; \\*Sent:\\* Thursday, June 09, 2011 5:27 PM
&gt; \\*To:\\* Sean Cribbs
&gt; \\*Cc:\\* riak-users
&gt; \\*Subject:\\* Re: Pros/Cons to not storing JSON
&gt;
&gt;
&gt;
&gt; Hey Andrew,
&gt;
&gt;
&gt;
&gt; We're using BSON (bsonspec.org), because it stores binary (and other) data
&gt; types better than JSON and is also faster and more wire efficient (sounds
&gt; like about the same reasons you're considering leaving JSON). There are also
&gt; libraries to parse BSON it in just about every language.
&gt;
&gt;
&gt;
&gt; I haven't tried using it in a Erlang map-reduce yet (we don't do
&gt; map-reduces for any of our production work), but there is a library out
&gt; there so it shouldn't be too hard.
&gt;
&gt;
&gt;
&gt; Will
&gt;
&gt;
&gt;
&gt; On Thu, Jun 9, 2011 at 2:24 PM, Sean Cribbs  wrote:
&gt;
&gt; Andrew,
&gt;
&gt; I think you're on the right track here, but I might add that you'll want to
&gt; have upgrade paths available if you're using records -- that is, version
&gt; them -- so that you can evolve their structure over time. That could be a
&gt; little hairy unless done carefully.
&gt;
&gt; That said, you could use BERT as the serialization format, making
&gt; implementing JavaScript M/R functions a little easier, and interop with
&gt; other languages.
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt;
&gt; On Jun 9, 2011, at 5:14 PM, Andrew Berman wrote:
&gt;
&gt; &gt; I am using Riak using the Erlang Client API (PB) and I was storing my
&gt; documents as JSON and then converting them to records when I pull them out
&gt; of Riak, but I got to thinking that maybe this isn't the greatest approach.
&gt; I'm thinking that maybe it's better to store documents just as the record
&gt; itself (Erlang binary) and then just converting the binary back to the
&gt; record when I pull them from Riak. I was wondering what the pros/cons are
&gt; to this approach. Here's my list so far:
&gt; &gt;
&gt; &gt; Pros:
&gt; &gt;
&gt; &gt; Native Erlang is stored, so less time to convert to the record
&gt; &gt; Better support for nested records
&gt; &gt; Smaller storage requirements and hence faster on the wire (?)
&gt; &gt;
&gt; &gt; Cons:
&gt; &gt;
&gt; &gt; Not readable through Rekon (or other utils) without modification
&gt; &gt; Can't use standard M/R functions which analyze the document (have to
&gt; write all custom functions using Erlang)
&gt; &gt; Not portable across languages
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt;
&gt; &gt; Andrew
&gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

