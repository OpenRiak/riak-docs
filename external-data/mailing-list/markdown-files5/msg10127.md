---
title: "Re: ListKeys or MapReduce"
description: ""
project: community
lastmod: 2013-02-14T04:41:10-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10127"
mailinglist_parent_id: "msg10101"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-02-14T04:41:10-08:00
---


Hi OJ,

The do\\_prereduce parameter makes it possible to have the first iteration of the 
reduce phase execute where the preceding map phase generated output. This can, 
as in the example I provided, be used to reduce the amount of data that needs 
to be sent across the network. This is described in greater detail here: 
http://docs.basho.com/riak/latest/references/appendices/MapReduce-Implementation/

As it is possible to set it to be enabled by default in the app.config, it 
should be fine to always specify it for reduce phases preceded by a map phase. 

Best regards,

Christian


On 14 Feb 2013, at 12:21, OJ Reeves  wrote:

&gt; Chris,
&gt; 
&gt; I've never heard of do\\_prereduce before. What kind of effect does this have? 
&gt; That is, if someone were to use it all the time, regardless of the amount of 
&gt; data being returned, would this be a bad thing?
&gt; 
&gt; Thanks.
&gt; OJ
&gt; 
&gt; On Thu, Feb 14, 2013 at 6:19 PM, Christian Dahlqvist  
&gt; wrote:
&gt; Hi,
&gt; 
&gt; For buckets with a significant number of records, it makes a lot of sense to 
&gt; run the example I provided with 'do\\_prereduce' enabled as it will result in 
&gt; considerably less data being sent between the nodes. This can be enabled as 
&gt; follows:
&gt; 
&gt; curl -XPOST http://localhost:8098/mapred 
&gt; -H 'Content-Type: application/json' 
&gt; -d '{"inputs":{
&gt; "bucket":"goog",
&gt; "index":"$bucket",
&gt; "key":"goog"
&gt; },
&gt; "query":[{"reduce":{"language":"erlang",
&gt; "module":"riak\\_kv\\_mapreduce",
&gt; "function":"reduce\\_count\\_inputs", 
&gt; "arg":{"do\\_prereduce":true}}}]}'
&gt; 
&gt; Best regards,
&gt; 
&gt; Christian
&gt; 
&gt; 
&gt; On 14 Feb 2013, at 08:01, Christian Dahlqvist  wrote:
&gt; 
&gt;&gt; Hi Jeremiah,
&gt;&gt; 
&gt;&gt; It does indeed not seem to be documented on the main docs site, and I will 
&gt;&gt; try to correct this. The only place I have found it described is on the wiki 
&gt;&gt; for the Ruby client 
&gt;&gt; (https://github.com/basho/riak-ruby-client/wiki/Secondary-Indexes).
&gt;&gt; 
&gt;&gt; Below is also an example of a simple mapreduce job that shows how to count 
&gt;&gt; the number of records in the 'goog' bucket based on the $bucket secondary 
&gt;&gt; index:
&gt;&gt; 
&gt;&gt; curl -XPOST http://localhost:8098/mapred 
&gt;&gt; -H 'Content-Type: application/json' 
&gt;&gt; -d '{"inputs":{
&gt;&gt; "bucket":"goof",
&gt;&gt; "index":"$bucket",
&gt;&gt; "key":"goof"
&gt;&gt; },
&gt;&gt; "query":[{"reduce":{"language":"erlang",
&gt;&gt; "module":"riak\\_kv\\_mapreduce",
&gt;&gt; "function":"reduce\\_count\\_inputs"}}]}'
&gt;&gt; 
&gt;&gt; I hope this helps.
&gt;&gt; 
&gt;&gt; Best regards,
&gt;&gt; 
&gt;&gt; Christian
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On 13 Feb 2013, at 18:12, Jeremiah Peschka  
&gt;&gt; wrote:
&gt;&gt; 
&gt;&gt;&gt; Is this documented anywhere on the docs.basho.com site? 
&gt;&gt;&gt; 
&gt;&gt;&gt; Searching for $bucket produces search results just for "bucket" and Google 
&gt;&gt;&gt; says "No results found for site:docs.basho.com $bucket."
&gt;&gt;&gt; 
&gt;&gt;&gt; ---
&gt;&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt;&gt;&gt; MCITP: SQL Server 2008, MVP
&gt;&gt;&gt; Cloudera Certified Developer for Apache Hadoop
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On Wed, Feb 13, 2013 at 10:08 AM, Christian Dahlqvist  
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; Hi,
&gt;&gt;&gt; 
&gt;&gt;&gt; In addition to the $key index, there is also a $bucket index available by 
&gt;&gt;&gt; default. This contains the name of the bucket, and can be used to get all 
&gt;&gt;&gt; keys in a specific bucket.
&gt;&gt;&gt; 
&gt;&gt;&gt; Best regards,
&gt;&gt;&gt; 
&gt;&gt;&gt; Christian
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; 
&gt; OJ Reeves
&gt; +61 431 952 586
&gt; http://buffered.io/

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

