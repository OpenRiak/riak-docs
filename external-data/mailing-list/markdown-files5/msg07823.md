---
title: "Re: Throughput issue contd. On Joyend Riak Smartmachine"
description: ""
project: community
lastmod: 2012-06-27T13:34:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07823"
mailinglist_parent_id: "msg07809"
author_name: "Yousuf Fauzan"
project_section: "mailinglistitem"
sent_date: 2012-06-27T13:34:45-07:00
---


I get this error when I increase the number of threads accessing a single
connection. Something related to getting unexpected number of bytes on the
connection.

On Wednesday, June 27, 2012, Reid Draper  wrote:
&gt;
&gt; On Jun 27, 2012, at 8:41 AM, Yousuf Fauzan wrote:
&gt;
&gt; So I created an array of clients using the following code
&gt; Clients = [riak.RiakClient(e, port=8087,
transport\\_class=riak.RiakPbcTransport) for e in NODES]
&gt;
&gt; Sounds like you're bringing your concurrency back down to 3 (because you
have three nodes). Give
&gt; something like 10 connections \\_per\\_ node a try, so 30 connections.
&gt;
&gt; After this I assigned each thread a particular id ranging from 0 to
Number of Nodes
&gt; So each thread now communicates with a single node.
&gt; Even after this, I am getting &lt;100 writes/sec
&gt;
&gt; On Wed, Jun 27, 2012 at 5:35 PM, Yousuf Fauzan 
wrote:
&gt;
&gt; Oh! I think that may be an issue with my code then.
&gt; Let me make some changes and get back to you.
&gt;
&gt; On Wed, Jun 27, 2012 at 5:25 PM, Reid Draper  wrote:
&gt;
&gt; On Jun 27, 2012, at 7:48 AM, Yousuf Fauzan wrote:
&gt;
&gt; This is great.
&gt; I was loading data using Python. My code would spawn 10 threads and put
data in a queue. All threads would read data from this queue.
&gt; However, all threads were hitting the same server/load balancer.
&gt; I tried a different setup too. Where I spawned processes with each
process having its own queue. In this case too, all processes were hitting
the same server.
&gt; I just now made a change to my code. So now I have 10 threads randomly
selecting a node and storing data in it.
&gt; Again, I am getting around 50 writes/sec
&gt;
&gt; When the threads randomly pick a node, do they create a new connection to
it, or do they pull the connection from
&gt; a pool? As you saw with the throughput difference between curl and
python, persistent connections make
&gt; big difference.
&gt;
&gt; Could there be something wrong with the way I have written my loader
script?
&gt;
&gt; On Wed, Jun 27, 2012 at 5:10 PM, Russell Brown 
wrote:
&gt;
&gt; On 27 Jun 2012, at 12:36, Yousuf Fauzan wrote:
&gt;
&gt; So I changed concurrency to 10 and put all the IPs of the nodes in basho
bench config.
&gt; Throughput is now around 1500.
&gt;
&gt; I guess you can now try 5 or 15 concurrent workers and see which is
optimal for that set up to get a good feel for the sizing of any connection
pools for your application.
&gt; You can also see how adding nodes and adding workers effects your results
to help you size the cluster you need for your expected usage.
&gt; Cheers
&gt; Russell
&gt;
&gt; On Wed, Jun 27, 2012 at 4:40 PM, Russell Brown 
wrote:
&gt;
&gt; On 27 Jun 2012, at 12:09, Yousuf Fauzan wrote:
&gt;
&gt; I used examples/riakc\\_pb.config
&gt; {mode, max}.
&gt; {duration, 10}.
&gt; {concurrent, 1}.
&gt;
&gt; Try upping this. On my local 3 node cluster with 8gb ram and an old,
cheap quad core per box I'd set concurrency to 10 workers.
&gt;
&gt; {driver, basho\\_bench\\_driver\\_riakc\\_pb}.
&gt; {key\\_generator, {int\\_to\\_bin, {uniform\\_int, 10000}}}.
&gt; {value\\_generator, {fixed\\_bin, 10000}}.
&gt; {riakc\\_pb\\_ips, [{}]}.
&gt;
&gt; I add all the IPs here, one entry per node.
&gt;
&gt; {riakc\\_pb\\_replies, 1}.
&gt; {operations, [{get, 1}, {update, 1}]}.
&gt;
&gt; On Wed, Jun 27, 2012 at 4:37 PM, Russell Brown 
wrote:
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

