---
title: "Re: Error when trying to use a javascript custom extractor in	Riaksearch"
description: ""
project: community
lastmod: 2011-05-22T14:54:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03386"
mailinglist_parent_id: "msg03385"
author_name: "Greg Pascale"
project_section: "mailinglistitem"
sent_date: 2011-05-22T14:54:06-07:00
---


Yes that's the reference I've been using. I went with the {struct,
JsonProplist} option because it can be set via the HTTP API.

-Greg

On Sat, May 21, 2011 at 11:48 PM, Andrew Berman  wrote:

> I'll preface this by saying I've never used this feature....
>
> rs\_extractfun should be set to one of the values defined in the Other
> Encodings section (
> http://wiki.basho.com/Riak-Search---Indexing-and-Querying-Riak-KV-Data.html).
> In your case, {jsanon, "function(a,b){return{\"user\":\"gpascale\",
> \"name\":\"greg\"};}"}
>
> Hope that helps,
>
> Andrew
>
> On Sat, May 21, 2011 at 7:48 PM, Greg Pascale  wrote:
>
>> I've been banging my head against the wall trying to get a javascript
>> custom extractor working. Here is the simplest example I could come up with
>> to reproduce the error.
>>
>> \*curl -v -X PUT -H "Content-Type: application/json"
>> http://localhost:8098/riak/test -d @data\*
>>
>> where \*@data\* is a file that looks like
>>
>> \*{"props":\*
>> \* {"rs\_extractfun":\*
>> \* {"language" : "javascript", \*
>> \* "source" : "function(a,b){return{\"user\":\"gpascale\",
>> \"name\":\"greg\"};}"\*
>> \* }\*
>> \* }\*
>> \*}\*
>> \*
>> \*
>> This completes successfully, and I can verify it by looking at the
>> properties of the "test" bucket.
>>
>> \*{"props":{"allow\_mult":true,"basic\_quorum":true,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"test","notfound\_ok":false,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"riak\_search\_kv\_hook","fun":"precommit"}],"pw":0,"r":"quorum","rs\_extractfun":{"language":"javascript","source":"function(a,b){return{\"user\":\"gpascale\",
>> \"name\":\"greg\"};}"},"rw":"quorum","small\_vclock":10,"w":"quorum","young\_vclock":20}}
>> \*
>>
>> However, when I try to insert something into the bucket, I get an error
>>
>> \*curl -X PUT http://localhost:8098/riak/test/test1 -d "Hello, world!"\*
>>
>> \*{error,badarg,\*
>> \* [{erlang,iolist\_to\_binary,\*
>> \* [{hook\_crashed,\*
>> \* {riak\_search\_kv\_hook,precommit,exit,\*
>> \* {noproc,\*
>> \* {gen\_server,call,\*
>> \* [riak\_search\_js\_extract,reserve\_vm,\*
>> \* infinity]}}}}]},\*
>> \* {wrq,append\_to\_response\_body,2},\*
>> \* {riak\_kv\_wm\_raw,accept\_doc\_body,2},\*
>> \* {webmachine\_resource,resource\_call,3},\*
>> \* {webmachine\_resource,do,3},\*
>> \* {webmachine\_decision\_core,resource\_call,1},\*
>> \* {webmachine\_decision\_core,accept\_helper,0},\*
>> \* {webmachine\_decision\_core,decision,1}]}}\*
>> \*
>> \*
>> It doesn't matter if the thing I insert is a string, as above, or real
>> json object that matches my schema - the error is the same. Any ideas what
>> might be going on here?
>>
>> Thanks,
>> -Greg
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

