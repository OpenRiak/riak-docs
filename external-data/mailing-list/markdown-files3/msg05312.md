---
title: "Re: 2i query, weird null results, java pbclient"
description: ""
project: community
lastmod: 2011-10-25T12:32:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05312"
mailinglist_parent_id: "msg05300"
author_name: "Alexander Robbins"
project_section: "mailinglistitem"
sent_date: 2011-10-25T12:32:36-07:00
---


Those methods both work with the RawClient and give good results. Thanks for
the help!

Alex

On Tue, Oct 25, 2011 at 1:03 PM, Russell Brown  wrote:

>
> On 25 Oct 2011, at 18:48, Alexander Robbins wrote:
>
> > That code snippet isn't working because I've got a RawClient instance and
> its mapReduce method wants a MapReduceSpec. I ran into this problem while
> trying to use search also. I ended up making a search object and then
> serializing it to json and providing it to the MapReduceSpec constructor,
> then passing the resulting MapReduceSpec into the mapReduce method on
> RawClient. Is there a better way? I considered just using String.format to
> put the variables into a handwritten json string and using that to
> instantiate the MapReduceSpec.
> >
> > Thanks!
> > Alex
> >
> > My gross method of making a MapReduceSpec:
> > final Map mapReduceObject = new HashMap Object>();
> > final Map inputs = new HashMap();
> > final List query = new ArrayList();
> > final List searchTerms = new ArrayList();
> > searchTerms.add(bucket);
> > searchTerms.add(terms);
> > inputs.put("module", "riak\_search");
> > inputs.put("function", "mapred\_search");
> > inputs.put("arg", searchTerms);
> > final Map reduce = new HashMap();
> > reduce.put("language", "erlang");
> > reduce.put("module", "riak\_kv\_mapreduce");
> > reduce.put("function", "reduce\_identity");
> > final Map> map1 = new
> HashMap>();
> > map1.put("reduce", reduce);
> > query.add(map1);
> > mapReduceObject.put("inputs", inputs);
> > mapReduceObject.put("query", query);
> > final MapReduceSpec spec = new MapReduceSpec(new
> Gson().toJson(mapReduceObject));
>
> OK. So the high-level libraries are there to help, even if you have a
> RawClient, try this:
>
> IndexQuery q = new BinValueQuery(BinIndex.named("docUID"),
> "mentions",
> "5b9d1a6250dbd3e77ff004a12d06958745ee32844ad4aa668001bbe69b5efcf8");
> MapReduce mr = new IndexMapReduce(YOUR\_RAW\_CLIENT\_INSTANCE,
> indexQuery);
>
> mr.addReducePhase(NamedErlangFunction.REDUCE\_IDENTITY,
> "{reduce\_phase\_only\_1, true}");
> MapReduceResult result = mr.execute();
> Collection r = result.getResult(String[].class);
>
> You can do the same thing with the search map reduce
>
> MapReduce mr = new SearchMapReduce(YOUR\_RAW\_CLIENT, "bucket", "your
> search query");
>
> And then use the MapReduce methods to add phases and execute as before.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

