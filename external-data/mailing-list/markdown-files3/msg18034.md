---
title: "Re: Update metadata of entries in bucket"
description: ""
project: community
lastmod: 2017-02-25T01:18:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18034"
mailinglist_parent_id: "msg18033"
author_name: "Grigory Fateyev"
project_section: "mailinglistitem"
sent_date: 2017-02-25T01:18:36-08:00
---


Luke, thank you for the answer!

I did this, my code is:

```
update\_users(Item) ->
 Value = binary\_to\_term(riak\_object:get\_value(Item)),
 [{\_Key, Value}] = statebox:value(Item),
 Record = project\_schema\_user:new(Value),
 NewMetadata = project\_schema\_user:riak\_metadata(Record),
 NewItem = riak\_object:update\_metadata(Item, NewMetadata),
 AItem = riak\_object:apply\_updates(NewItem),
 RiakcObj = to\_riakc\_obj(AItem),
 %% lager:info("Item ~p", [RiakcObj]),
 ok = redgage\_riak\_client:put(RiakcObj),
 [].

to\_riakc\_obj(Object) when element(1, Object) =:= r\_object ->
 #riakc\_obj{
 bucket = riak\_object:bucket(Object),
 key = riak\_object:key(Object),
 vclock = riak\_object:encode\_vclock(riak\_object:vclock(Object)),
 contents = riak\_object:get\_contents(Object)
 %% updatemetadata = riak\_object:get\_update\_metadata(Object),
 %% updatevalue = riak\_object:get\_update\_value(Object)
 }.

```

It works! I had a problem with vclock. I got vclock from r\_object, but it's
vclock:vclock()
type. Now I encode it. As you can see commented out two record's fields:
updatemetadata
and updatevalue. How do these fields work?


2017-02-25 0:40 GMT+03:00 Luke Bakken :

> Hi Grigory,
>
> Check out this article:
> http://basho.com/posts/technical/webinar-recap-mapreduce-querying-in-riak/
>
> Specifically, the use of riak:local\_client() and C:put
> --
> Luke Bakken
> Engineer
> lbak...@basho.com
>
>
> On Thu, Feb 23, 2017 at 10:38 AM, Grigory Fateyev 
> wrote:
> > Hello!
> >
> > I'm trying to write riak\_pipe command that updates metadata, the code:
> > https://gist.github.com/greggy/7d7fa3102d89673019410c6e244650cd
> >
> > I'm getting every entry in update\_metadata/1 then creating a new
> metadata,
> > updating it in Item.
> >
> > My question is how to update r\_object in a bucket?
> >
> > Thank you!
> >
> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > riak-users mailing list
> > riak-users@lists.basho.com
> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> >
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

