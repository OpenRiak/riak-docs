---
title: "Re: Truncated bit-cask files"
description: ""
project: community
lastmod: 2017-02-14T01:50:27-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17975"
mailinglist_parent_id: "msg17974"
author_name: "Magnus Kessler"
project_section: "mailinglistitem"
sent_date: 2017-02-14T01:50:27-08:00
---


On 13 February 2017 at 19:56, Arun Rajagopalan  wrote:

> Hello Riak Users
>
> We have situations where we dont or cant gracefully stop riak. When that
> happens we occasionally get a truncated last-record in bitcask files
>
> If I delete those bitcask dir and the anti\_entropy directory, Riak
> rebuilds those bitcask files correctly
>
> Is there a way to rectify those borken bitcask files ?
>
> Thanks
> Arun
>
>
>
Hi Arun,

There should be no need to remove truncated bitcask files. Any objects up
to the point of truncation should still be available to Riak. However, it
may take longer for the affected partition to start up, as the
corresponding hint file will not match the data file, and Riak will scan
the latter to populate the key set it keeps in memory.

By removing anti\_entropy files you are forcing the AAE trees to be rebuilt.
Once this has completed, AAE will fill back any objects missing due to the
truncated bitcask files. You can also force a full partition repair by
following the instructions from the documentation [0].

Can you let me know why you cannot shut down the node gracefully? Unclean
shutdowns should be a last resort and not part of normal operating
procedures.

Kind Regards,

Magnus


[0]:
http://docs.basho.com/riak/kv/2.2.0/using/repair-recovery/repairs/#repairing-partitions
.

-- 
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

