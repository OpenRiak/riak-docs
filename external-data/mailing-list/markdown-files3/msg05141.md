---
title: "Re: Basho Bench HTTP Inserts Causing Innostore Crashes"
description: ""
project: community
lastmod: 2011-10-12T12:00:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05141"
mailinglist_parent_id: "msg05137"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-10-12T12:00:14-07:00
---


Brian,

I've opened a bugzilla ticket for the problem at the root of this. You can view 
the details and status here: https://issues.basho.com/show\_bug.cgi?id=1244. 
Thanks again for the report!

Kelly


On Oct 12, 2011, at 9:49 AM, Brian Bickerton wrote:

> Riak version: 1.0.0
> Backend: InnoStore 1.0.3.1
> 4-node cluster
> 
> I've gotten http basho bench to run successfully with the Bitcask and LevelDB 
> backends, but I'm having trouble with Innostore. I get no throughput and all 
> errors. The logs show children crashing due to a "bad argument in call to 
> erlang:size(undefined)". Basic inserts from curl work and I was able to 
> install rekon, which leads me to believe it's an issue with the bench testing 
> itself. Rate and concurrency don't appear to matter. 
> 
> Error log snip:
> 
> 2011-10-12 15:28:49.060 [error] <0.4751.1> gen\_fsm <0.4751.1> in state active 
> terminated with reason: bad argument in call to erlang:size(undefined) in 
> innostore:get/2
> 2011-10-12 15:28:49.061 [error] <0.4751.1> CRASH REPORT Process <0.4751.1> 
> with 0 neighbours crashed with reason: bad argument in call to 
> erlang:size(undefined) in innostore:get/2
> 2011-10-12 15:28:49.061 [error] <0.95.0> Supervisor riak\_core\_vnode\_sup had 
> child undefined started with {riak\_core\_vnode,start\_link,undefined} at 
> <0.4751.1> exit with reason bad argument in call to erlang:size(undefined) in 
> innostore:get/2 in context child\_terminated
> 
> Crash Log snip:
> 
> 2011-10-12 15:28:43 =CRASH REPORT====
> crasher:
> initial call: riak\_core\_vnode:init/1
> pid: <0.4734.1>
> registered\_name: []
> exception exit: 
> {badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak\_kv\_innostore\_backend,get,3},{riak\_kv\_vnode,do\_get\_term,3},{riak\_kv\_vnode,do\_get,4},{riak\_core\_vnode,vnode\_command,3},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
> in function gen\_fsm:terminate/7
> in call from proc\_lib:init\_p\_do\_apply/3
> ancestors: [riak\_core\_vnode\_sup,riak\_core\_sup,<0.91.0>]
> messages: [{'EXIT',<0.4736.1>,shutdown},{'EXIT',#Port<0.14591>,normal}]
> links: [<0.95.0>]
> dictionary: 
> [{{innostore,{store,#Port<0.14591>,<<105,0,0,0,0,0,0,0>>,0}},{store,#Port<0.14591>,<<105,0,0,0,0,0,0,0>>,0}}]
> trap\_exit: true
> status: running
> heap\_size: 610
> stack\_size: 24
> reductions: 3941
> neighbours:
> 2011-10-12 15:28:43 =SUPERVISOR REPORT====
> Supervisor: {local,riak\_core\_vnode\_sup}
> Context: child\_terminated
> Reason: 
> {badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak\_kv\_innostore\_backend,get,3},{riak\_kv\_vnode,do\_get\_term,3},{riak\_kv\_vnode,do\_get,4},{riak\_core\_vnode,vnode\_command,3},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
> Offender: 
> [{pid,<0.4734.1>},{name,undefined},{mfargs,{riak\_core\_vnode,start\_link,undefined}},{restart\_type,temporary},{shutdown,300000},{child\_type,worker}]
> 
> Basho Bench config (worked with Bitcask and LevelDB):
> 
> {mode, max}
> {duration, 300}.
> {concurrent, 1000}.
> {driver, basho\_bench\_driver\_http\_raw}.
> {code\_paths, ["deps/ibrowse"]}.
> {http\_raw\_ips, [the, four, node, addresses]}.
> {key\_generator, {partitioned\_sequential\_int, 500000000}}.
> {value\_generator, {fixed\_bin, 15}}.
> {http\_raw\_port, 8098}.
> {http\_raw\_path, "/riak/holder"}.
> {operations, [{insert, 1}]}.
> 
> Any help would be greatly appreciated.
> 
> Brian Bickerton
> Web Engineer
> OmniTI Computer Consulting, Inc.
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

