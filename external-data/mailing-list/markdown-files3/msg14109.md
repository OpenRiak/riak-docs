---
title: "Re: Socket returned short packet length 0 - expected 4"
description: ""
project: community
lastmod: 2014-04-17T10:45:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14109"
mailinglist_parent_id: "msg14102"
author_name: "Jason Wang"
project_section: "mailinglistitem"
sent_date: 2014-04-17T10:45:46-07:00
---


Sean,

RE http vs pbc port: Verified that our production environment is using the
pbc protocol on port 8087.

RE crashlog: There are no entries in console.log, crash.log and error.log
for over a month.

RE HAprodxy: Our clients are connecting to the Riak servers. No reverse
proxy systems are in between.

Anything else I can look into?

Jason


On Wed, Apr 16, 2014 at 1:02 PM, Sean Cribbs  wrote:

> Hi Jason,
>
> We usually see these errors when someone connects to the HTTP port instead
> of the PB port. First, check that your client is configured correctly.
> Also, please check the server logs for any crashes related to
> riak\_api\_pb\_server, and paste those here if present.
>
> It is also conceivable this could occur if the socket were closed before
> anything were sent, that is, the read buffer on it is empty, so it returns
> 0. I don't know of any specific reason that might happen unless you are
> using haproxy between the client and the server (see related PR/issue
> https://github.com/basho/riak\_api/pull/54).
>
>
> On Tue, Apr 15, 2014 at 6:34 PM, Jason Wang  wrote:
>
>> HI all,
>>
>> In production, we are experiencing "Socket returned short packet length 0
>> - expected 4" exceptions whenever we try to store an object >20K in size.
>> In addition, the exception typically takes over 60 seconds to manifest. The
>> content of each object is an bytearray.
>>
>> Any idea what could be causing this exception?
>>
>> Other details:
>> Library: Python
>> Version: riak==2.0.1, riak-pb==1.4.1.1
>> Protocol: pbc
>> Steps to reproduce: N/A. This only happens in production, not on dev
>> machines.
>>
>> Thanks in advance,
>>
>> Jason
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>>
>
>
> --
> Sean Cribbs 
> Software Engineer
> Basho Technologies, Inc.
> http://basho.com/
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

