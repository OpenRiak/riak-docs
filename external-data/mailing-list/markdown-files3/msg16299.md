---
title: "Re: get failures on consistent buckets"
description: ""
project: community
lastmod: 2015-07-16T06:19:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16299"
mailinglist_parent_id: "msg16298"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2015-07-16T06:19:44-07:00
---


Questions are in-line...

> We are in the testing phase of an application subsystem that uses Riak
> 2.1.1 and a bucket type with consistency on and n=5 (per Basho docs).
>
> Client side is .net using the Basho .net client.
>
> As the testing volume has risen, we are encountering get failures that
> seem to have a communication-related flavor.
>
> Things like: ³CommunicationError: Unable to read data from the transport
> connection: A connection attempt failed because the connected party did
> not properly respond after a period of time, or established connection
> failed because connected host has failed to respond²

That is a socket read timeout. Could you provide the web.config from
your app server, at least the Riak related sections?

> ³CommunicationError: Riak returned an error. Code Œ0¹. Message timeout²

That is an error within Riak. I'll be able to use riak-debug output to
see if anything coincides. If you have logs of these exceptions with
timestamps that would be ideal.

> even ³ClusterOffline: unable to access functioning Riak node².

That happens when all nodes return an error and health check in the
client has not established that they are accessible again.

> The only things in any of my ³crash² logs are:
> {function\_clause,[{webmachine\_request,peer\_from\_peername,[{error,enotconn},
> {webmachine\_request,{wm\_reqstate,#Port<0.12171987>,[],undefined,undefined,u
> And there are a number of these, over time, but all of the application
> interaction with the cluster is via PB, not rest.

Do you have haproxy configured to detect node status via the /ping
endpoint? Would you mind sharing your haproxy.conf file and your
haproxy log?

> Prior to going to consistent buckets, we did not see these.

> and the traffic
> rate and object sizes quite variable.

Do you know what your max object size is?

Finally, could you please run "riak-debug" on all nodes in your
cluster and make the generated \*.tar.gz files available via dropbox or
some other means. This should be used to share the information I
requested above, as well. Please email my @basho email with the secret
link.

--
Luke Bakken
Engineer
lbak...@basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

