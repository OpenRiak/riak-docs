---
title: "Re: Lots of bitcask files for a vnode, unable to merge"
description: ""
project: community
lastmod: 2011-06-30T18:38:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03896"
mailinglist_parent_id: "msg03894"
author_name: "David Smith"
project_section: "mailinglistitem"
sent_date: 2011-06-30T18:38:03-07:00
---


The fix is quite easy -- you can safely delete any zero-length files
(while the node is down!).

How it got to that state is less clear. The "every three minutes"
suggests that the vnode triggers a merge only to find there is nothing
to actually merge. It is odd, however, that it doesn't clean up the
big list of files. If you delete the zero-length files and bring the
node back up, does it get back into this state again?

D.

On Thu, Jun 30, 2011 at 7:27 PM, Aphyr  wrote:
> One of the vnodes on one of my hosts has a \*lot\* of bitcask data/hint files,
> and makes a new one every 3 minutes. In the logs, I get
>
> =ERROR REPORT==== 30-Jun-2011::20:24:14 ===
> Failed to merge
> ["/var/lib/riak/bitcask/794976964837219653749465284983368790965189869568",
> [],
> ...HUGE LIST OF DATA FILES...
>
> in bitcask\_fileops:fold\_loop, bitcask:merge\_single\_entry, merge\_files,
> merge1, bitcask\_merge\_worker:do\_merge.
>
> Here's the directory:
>
> ...
> -rw-------   1 riak riak         0 2011-06-30 19:55 1309481706.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 19:55 1309481706.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 19:58 1309481886.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 19:58 1309481886.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 20:01 1309482066.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 20:01 1309482066.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 20:04 1309482246.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 20:04 1309482246.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 20:07 1309482426.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 20:07 1309482426.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 20:10 1309482606.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 20:10 1309482606.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 20:13 1309482786.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 20:13 1309482786.bitcask.hint
> -rw-------   1 riak riak     32948 2011-06-30 20:21 1309482913.bitcask.data
> -rw-r--r--   1 riak riak      1043 2011-06-30 20:21 1309482913.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 20:18 1309483092.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 20:18 1309483092.bitcask.hint
> -rw-------   1 riak riak         0 2011-06-30 20:21 1309483272.bitcask.data
> -rw-r--r--   1 riak riak         0 2011-06-30 20:21 1309483272.bitcask.hint
>
> Any ideas as to how it could have gotten into this state, and how to fix it?
>
> --Kyle
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>



-- 
Dave Smith
Director, Engineering
Basho Technologies, Inc.
diz...@basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

