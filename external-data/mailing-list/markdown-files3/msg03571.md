---
title: "RE: Key-Filters with logical AND operation and with tokenize"
description: ""
project: community
lastmod: 2011-06-06T06:55:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03571"
mailinglist_parent_id: "msg03541"
author_name: "David Mitchell"
project_section: "mailinglistitem"
sent_date: 2011-06-06T06:55:38-07:00
---


Can someone confirm that the logical AND operation used with tokenize does not 
work? According to the website (http://wiki.basho.com/Key-Filters.html), it 
should work, but it does not work for me.

David


From: David Mitchell
Sent: Thursday, June 02, 2011 6:41 PM
To: 'riak-users@lists.basho.com'
Subject: Key-Filters with logical AND operation and with tokenize

I am trying to use the following Key-Filters with logical AND operation and 
tokenize, but I am getting errors. Anyone know what might be wrong? Is it 
possible to use tokenize with the logical AND?

Erlang: R13B04
Riak: 0.14.2

Bucket: zip
Key: 22305-0-1-3

The following does not work:
{
 "inputs" : {
 "bucket" : "zip",
 "key\_filters" : ["and", [["starts\_with", 
"22305-0"]], [["tokenize", "-", 4], ["between", "1", "3"]]]
 },
 "query" : [{
 "map" : {
 "keep" : true,
 "language" : 
"javascript",
 "arg" : null,
 "source" : 
"function (v) { return [Riak.mapValuesJson(v)[0]]; }"
 }
 }
 ]
}

I get the following error:
{error,{error,function\_clause,[{riak\_client,build\_exprs,[[<<\"and\">>,[[<<\"starts\_with\">>,<<\"22305-0\">>]],[[<<\"tokenize\">>,<<\"-\">>,2],[<<\"between\">>,<<\"1\">>,<<\"3\">>]]],[],{riak\_client,'riak@10.0.60.208',<<3,171,198,76>>}]},{riak\_client,build\_filter,2},{riak\_client,stream\_list\_keys,6},{riak\_client,mapred\_bucket\_stream,7},{riak\_client,mapred\_bucket,6},{riak\_kv\_wm\_mapred,process\_post,2},{webmachine\_resource,resource\_call,3},{webmachine\_resource,do,3}]}}

The following does work:
{
 "inputs" : {
 "bucket" : "zip",
 "key\_filters" : [["tokenize", "-", 4], 
["between", "1", "5"]]
 },
 "query" : [{
 "map" : {
 "keep" : true,
 "language" : 
"javascript",
 "arg" : null,
 "source" : 
"function (v) { return [Riak.mapValuesJson(v)[0]]; }"
 }
 }
 ]
}

David

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

