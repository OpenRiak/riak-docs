---
title: "Re: How to make Riak work faster (writing)"
description: ""
project: community
lastmod: 2012-11-03T03:55:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09180"
mailinglist_parent_id: "msg09169"
author_name: "Uruka Dark"
project_section: "mailinglistitem"
sent_date: 2012-11-03T03:55:52-07:00
---


Jared,

Thank you for you time and reply.

I got impressed by your numbers and I started to double check my settings.
I found a big problem here, my third machine (the one out of the cluster,
making the load), was not talking to Riak in gigabit speed, it was 100 Mbs.
I changed the network cable and it's working fine now.
I ran my python script again and I already could see better results: 252
ops/sec (before the fix it was 175 ops/sec).

I also ran your benchmark .config, and these are my numbers:
https://dl.dropbox.com/u/308392/summary.png

As you can see, even so, I'm still far from your results.. not even close,
and now I'm using Bitcask.
Anyway, my current position is much better than at the beggining. I'll
double-check all over again, cause now I have a confirmation that there is
something wrong.

If you have any suggestion, please, let me know.
Once again, thank you.

On Sat, Nov 3, 2012 at 3:08 AM, Jared Morrow  wrote:

> I forgot to mention that 2000 ops/sec was on bitcask, not memory. I
> didn't bother with the memory backend.
>
> -Jared
>
>
> On Sat, Nov 3, 2012 at 12:05 AM, Jared Morrow  wrote:
>
>> Uruka,
>>
>> So looking at your results something is really wrong with your setup. I
>> was surprised by your numbers, so I made two VM's each with only 1gb of RAM
>> on two different boxes also on a 1gb switch.
>>
>> I ran a put of 100,000 keys at 10kb in size.
>>
>> I didn't do any tuning at all on the VM's and these were quick Ubuntu
>> 10.04 VM's with 2 virtual CPU's and 1 gig of ram. I also didn't change any
>> settings in Riak, except for the IP address and listening ports.
>>
>> Here is the summary of the results showing around 2000 ops/sec
>> https://dl.dropbox.com/u/183971/summary.png
>>
>> So my main thought is that you weren't actually using N=1 for your puts
>> and you were using the default N value of 3, meaning you were writing each
>> key/value 3 times, and with 2 nodes this is doing a lot of writes to the
>> same disk multiple times.
>>
>> To be sure you have N=1, you can use 'riak attach' on each node and enter
>> the following command:
>>
>> riak\_core\_bucket:set\_bucket(<<"pop1">>,[{n\_val,1}]).
>>
>>
>> If you bucket name is "pop1" as in my case. That name is completely
>> arbitrary.
>>
>> Sorry I'm late to this thread, I had to find some time to setup the test.
>>
>> For reference I used https://github.com/basho/basho\_bench for the
>> benchmark. With the following .config file
>> https://gist.github.com/e630b63f4a025a0fb634
>>
>> Hope this helps,
>> Jared
>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

