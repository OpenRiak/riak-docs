---
title: "Re: Put failure: too many siblings"
description: ""
project: community
lastmod: 2017-05-31T12:45:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18253"
mailinglist_parent_id: "msg18232"
author_name: "Vladyslav Zakhozhai"
project_section: "mailinglistitem"
sent_date: 2017-05-31T12:45:23-07:00
---


Hi,

I've changed default bucket prop "dvv\_enabled" on production system (27
nodes) without any issues (couple of days ago):

NewProps = [case Prop of {dvv\_enabled,false} -> {dvv\_enabled,true}; Other
-> Other end || Prop <- application:get\_env(riak\_core,
default\_bucket\_props)].
riak\_core\_util:rpc\_every\_member\_ann(application, set\_env, [riak\_core,
default\_bucket\_props, NewProps], 5000).

This simple script will do the trick. And also the configuration of riak
has been changed.

Another question is about old siblings workaround. Russell said that I need
to manage it manually. But now I have no idea what can I do in this case. I
mean will siblings be resolved during read repairs, hinted handoffs, etc or
not. Or I do need to resolve them manually?




On Fri, May 26, 2017 at 11:41 PM Vladyslav Zakhozhai <
v.zakhoz...@smartweb.com.ua> wrote:

> Hi Magnus,
>
> Thank you for the tip and clarification. I'll give it a try.
>
> On Thu, May 25, 2017 at 4:24 PM Magnus Kessler  wrote:
>
>> On 25 May 2017 at 09:39, Vladyslav Zakhozhai > > wrote:
>>
>>> Hi,
>>>
>>> I've been trying to change dvv\_enabled for default bucket type. But this
>>> is impossible with riak-admin:
>>>
>>> riak-admin bucket-type update default '{"props":{"dvv\_enabled":true}}'
>>> Error updating bucket type default:
>>> no\_default\_update
>>>
>>> I think that workaround for this is changing default props in riak
>>> config:
>>>
>>> {riak\_core, [
>>>
>>> {default\_bucket\_props, [
>>> {allow\_mult, true},
>>> {dvv\_enabled, true}
>>> ]},
>>> ...
>>>
>>> (yes, I still use old-style configs)
>>>
>>> And then I need to restart all riak nodes. Here is two questions:
>>> 1. Is this approach correct?
>>> 2. Is it ok to have different default\_bucket\_props value on different
>>> nodes of the same cluster (in short period of time)?
>>>
>>> I have to restart 27 riak nodes. There is several billions of keys in
>>> riak and each node starts wery slow (20-30-60 min; bitcask backend). So I
>>> can't change default\_bucket\_props simultaneously in a such way.
>>>
>>> I also can change this parameter in riak console, i.e.
>>>
>>> application:set\_env(riak\_core, default\_bucket\_props, [{dvv\_enabled,
>>> true}, ......]). But what I need to do for applying this changes?
>>>
>>>
>> Hi Vladyslav,
>>
>> The recommended approach for changing the default bucket type's
>> properties is to change the settings in `riak.conf` or `advanced.config`.
>> However, I just checked that any settings changed through a set\_env call
>> also seem to be reflected in the runtime configuration.
>>
>> If you'd like to try this, I recommend making the change on a test
>> cluster first, as I have not verified if this causes issues on a production
>> CS cluster. The set\_env call should pass in the complete set of bucket type
>> properties, not just the changes. You can try the following (with default
>> default bucket-type properties):
>>
>> riak\_core\_util:rpc\_every\_member\_ann(application, set\_env, [riak\_core,
>> default\_bucket\_props,
>> [{allow\_mult,false},{big\_vclock,50},{chash\_keyfun,{riak\_core\_util,chash\_std\_keyfun}},{dvv\_enabled,
>> false},{dw,quorum},{last\_write\_wins,false},{linkfun,{modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}},{n\_val,3},{notfound\_ok,true},{old\_vclock,86400},{postcommit,[]},{pr,0},{precommit,[]},{pw,0},{r,quorum},{repl,true},{rw,quorum},{small\_vclock,50},{w,quorum},{write\_once,false},{young\_vclock,20}]],
>> 5000).
>>
>>
>> If you go down this route, please don't forget to also make changes to
>> the configuration files, in order to these settings to persist across a
>> restart.
>>
>> Kind Regards,
>>
>> Magnus
>>
>> --
>> Magnus Kessler
>> Client Services Engineer
>> Basho Technologies Limited
>>
>> Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

