---
title: "Re: Reaping Tombstones"
description: ""
project: community
lastmod: 2016-12-30T07:38:18-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17824"
mailinglist_parent_id: "msg17823"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2016-12-30T07:38:18-08:00
---


The current release of global expiry does not support retroactively dating and 
removing objects. Only newly written objects get expiry.

The code for retroactively dating objects exists and will be part of a future 
release.

Matthew


> On Dec 30, 2016, at 10:30 AM, Arun Rajagopalan  
> wrote:
> 
> Thanks Matthew & Luca
> 
> Re: global expiry - will that option retroactively remove objects? That is 
> remove objects that became "unneeded" before the option was set ?
> Same question w.r.t delete\_mode
> 
> Re: Map / Reduce - I am not sure the delete would remove the tombstone unless 
> I set the delete\_mode to immediate AND there are no copies on non-primary 
> nodes. Or am I mistaken ?
> 
> 
> On Fri, Dec 30, 2016 at 10:11 AM, Luca Favatella 
>  > wrote:
> On 30 December 2016 at 15:06, Matthew Von-Maszewski  > wrote:
> > Greetings,
> >
> > I am not able to answer your tombstone questions. That question needs a
> > better expert.
> >
> > Just wanted to point out that Riak now has global expiry in both the leveldb
> > and bitcask backends. That might be a quicker solution for your frequent
> > delete operations:
> >
> > http://basho.com/products/riak-kv/global-object-expiration/ 
> > 
> >
> > Technical details for the leveldb expiry are found here:
> > https://github.com/basho/leveldb/wiki/mv-expiry 
> > 
> >
> > Matthew
> >
> > On Dec 30, 2016, at 9:55 AM, Arun Rajagopalan  > >
> > wrote:
> >
> > Hello Riakers
> >
> > I wonder if there is anyway to delete all tombstones that were left behind
> > when delete\_mode was set to 'keep'
> 
> Hi Arun,
> 
> Brute-force rate-limited map-reduce custom application code looking
> for `X-Riak-Deleted` in object metadata and then deleting? Refs:
> \* 
> http://docs.basho.com/riak/kv/2.2.0/developing/app-guide/advanced-mapreduce/#map-phase
> 
> 
> \* 
> https://github.com/basho/basho\_docs/blob/6b2f42a7243bfded737bd62eed12c490376c67e2/content/riak/kv/2.2.0/developing/app-guide/advanced-mapreduce.md#map-phase
> 
> 
> 
> Interested to hear if you come up with a better way though.
> 
> 
> > Also how do I estimate how much space the tombstones take ? We have a ton of
> > large scale and frequent delete operations and I suspect some space is used
> > by Tombstones. I would like to find out if it is significant enough to
> > warrant some cleanup.
> 
> I understand this is a separate question - I am not sure about the answer.
> 
> 
> > If it does, how do I remove them?
> 
> I believe I proposed an answer above.
> 
> 
> Regards
> Luca
> 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

