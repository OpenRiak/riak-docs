---
title: "Re: 404 Error in Live Cluster"
description: ""
project: community
lastmod: 2012-09-17T09:59:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08574"
mailinglist_parent_id: "msg08567"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-09-17T09:59:09-07:00
---


Hi Praveen,

There are a few things that could be contributing the to 404s.

The most likely issue has to do with your "n" and "r" values. With an
"r" of 1, and a laggy node in your cluster, you could have a situation
that resembled a netsplit. (At the moment, Riak does better with
downed nodes than laggy ones.) Laggy responses will result in you
returning a notfound to the client if you're only waiting for 1 of 2
existing replicas and have "{notfound\_ok, true}".

Potential solutions to this (assuming it's the problem):

\* consider retrying a number of times with your client logic; there is
some information about why you might want to do this on the wiki [0]
\* change to "{notfound\_ok, false}" because otherwise if a "not\_found"
comes back on the first response, it'll be treated as valid
\* increase R to 2.

There are a few other potential culprits, but this is the most-likely.
Let us know if any of that helps.

Mark

[0] http://wiki.basho.com/Client-Implementation-Guide.html


On Mon, Sep 17, 2012 at 4:01 AM, Praveen Baratam
 wrote:
> The frequency of error is now more common. Upto 1 failed request in 10. This
> is breaking everything.
>
>
> On Mon, Sep 17, 2012 at 3:04 PM, Praveen Baratam 
> wrote:
>>
>> Here are some more details about the cluster.
>>
>> {ring\_creation\_size, 1024},
>>
>> {default\_bucket\_props, [
>> {n\_val, 2},
>> {r, 1},
>> {w, 1},
>> {allow\_mult, false},
>> {last\_write\_wins, false},
>> {precommit, []},
>> {postcommit, []},
>> {chash\_keyfun, {riak\_core\_util, chash\_std\_keyfun}},
>> {linkfun, {modfun, riak\_kv\_wm\_link\_walker, mapreduce\_linkfun}}
>> ]},
>>
>> {storage\_backend, riak\_kv\_multi\_backend},
>> {multi\_backend\_default, <<"store">>},
>> {multi\_backend, [
>> {<<"store">>, riak\_kv\_bitcask\_backend, [
>> {data\_root, "/var/lib/riak/bitcask/store"}
>> ]},
>> {<<"cache">>, riak\_kv\_bitcask\_backend, [
>> {data\_root, "/var/lib/riak/bitcask/cache"},
>> {expiry\_secs, 21600}
>> ]}
>> ]},
>>
>> On using Riaknostic I am seeing these errors.
>>
>> [warning] The following preflists do not satisfy the n\_val:
>> [[{973382926425464638881751031164555683013033197568,'riak@178.238.237.241'},.....
>> a big list similar to this...]
>>
>> Please help. We are stuck.
>>
>> Praveen
>>
>>
>>
>> On Mon, Sep 17, 2012 at 4:18 AM, Praveen Baratam
>>  wrote:
>>>
>>> Hello Everybody,
>>>
>>> We are currently alpha testing out our Webapp which uses Riak for storing
>>> binary files (< 2 MB) with n\_val as 2. We currently have 3 nodes in the
>>> cluster and all files are stored in the same bucket. We are using Bitcask
>>> engine.
>>>
>>> Sometimes we see 404 error cropping up when accessing these keys. This
>>> happens only once in a day or so and all existing keys are accessible most
>>> of the time. We are only trying to access the keys that we have put in Riak
>>> so there is no doubt of their existence.
>>>
>>> Can a network split cause such an error? Is there anything we can do to
>>> avoid such corner cases.
>>>
>>> Thank you
>>>
>>> Praveen
>>
>>
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

