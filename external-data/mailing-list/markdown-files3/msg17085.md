---
title: "Re: Yokozuna inconsistent search results"
description: ""
project: community
lastmod: 2016-02-26T08:20:57-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17085"
mailinglist_parent_id: "msg17080"
author_name: "Oleksiy Krivoshey"
project_section: "mailinglistitem"
sent_date: 2016-02-26T08:20:57-08:00
---


regarding the coverage plan, is there any way to get it with protocol
buffers API? As RpbSearchQueryResp messages doesn't seem to contain
anything but docs:

message RpbSearchQueryResp {
 repeated RpbSearchDoc docs = 1; // Result documents
 optional float max\_score = 2; // Maximum score
 optional uint32 num\_found = 3; // Number of results
}


On Fri, 26 Feb 2016 at 17:51 Oleksiy Krivoshey  wrote:

> Yes, AAE is enabled:
>
> anti\_entropy = active
>
> anti\_entropy.use\_background\_manager = on
> handoff.use\_background\_manager = on
>
> anti\_entropy.throttle.tier1.mailbox\_size = 0
> anti\_entropy.throttle.tier1.delay = 5ms
>
> anti\_entropy.throttle.tier2.mailbox\_size = 50
> anti\_entropy.throttle.tier2.delay = 50ms
>
> anti\_entropy.throttle.tier3.mailbox\_size = 100
> anti\_entropy.throttle.tier3.delay = 500ms
>
> anti\_entropy.throttle.tier4.mailbox\_size = 200
> anti\_entropy.throttle.tier4.delay = 2000ms
>
> anti\_entropy.throttle.tier5.mailbox\_size = 500
> anti\_entropy.throttle.tier5.delay = 5000ms
>
> However the output of "riak-admin search aae-status" looks like this:
> http://oleksiy.sirv.com/misc/search-aae.png
>
>
> On Fri, 26 Feb 2016 at 17:13 Fred Dushin  wrote:
>
>> I would check the coverage plans that are being used for the different
>> queries, which you can usually see in the headers of the resulting
>> document. When you run a search query though yokozuna, it will use a
>> coverage plan from riak core to find a minimal set of nodes (and
>> partitions) to query to get a set of results, and the coverage plan may
>> change every few seconds. You might be hitting nodes that have
>> inconsistencies or are in need of repair. Do you have AAE enabled?
>>
>> -Fred
>>
>> > On Feb 26, 2016, at 8:36 AM, Oleksiy Krivoshey 
>> wrote:
>> >
>> > Hi!
>> >
>> > Riak 2.1.3
>> >
>> > Having a stable data set (no documents deleted in months) I'm receiving
>> inconsistent search results with Yokozuna. For example first query can
>> return num\_found: 3000 (correct), the same query repeated in next seconds
>> can return 2998, or 2995, then 3000 again. Similar inconsistency happens
>> when trying to receive data in pages (using start/rows options): sometimes
>> I get the same document twice (in different pages), sometimes some
>> documents are missing completely.
>> >
>> > There are no errors or warning in Yokozuna logs. What should I look for
>> in order to debug the problem?
>> >
>> > Thanks!
>> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> > riak-users mailing list
>> > riak-users@lists.basho.com
>> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

