---
title: "Re: Updating metadata with Erlang PBC"
description: ""
project: community
lastmod: 2010-05-26T06:01:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00434"
mailinglist_parent_id: "msg00433"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2010-05-26T06:01:11-07:00
---



Hi Mikl,

Thanks for the test case - it's definitely a bug in the PB client. I'll 
file a bug for you and work on a fix as soon as I have a chance.


Jon

On 5/26/10 5:45 AM, Mikl Kurkov wrote:

Hi!

It seems that protobuffers client doesn't allow to update metadata of
object.

Example:

`-module(test).
-compile(export_all).

test1(Host, Port) ->
 {ok,C} = riakc_pb_socket:start_link(Host, Port),
 O0 = riakc_obj:new(<<"b">>,<<"k">>,<<"d">>),
 {ok, O1} = riakc_pb_socket:put(C, O0, [return_body]),
 M1 = riakc_obj:get_metadata(O1),
 M2 = dict:store(<<"Links">>, [{{<<"b">>,<<"k1">>},<<"t1">>}], M1),
 O2 = riakc_obj:update_metadata(O1, M2),
 riakc_pb_socket:put(C, O2).`

Runnig test:test1("localhost", 8081), I see error
{error,{required\_field\_is\_undefined,1,bytes}}.

After tracing I realised that missing field is Value from RpbContent
structure.
So updating value with riakc\_obj:update\_value/2 before calling put does the
trick.
But I think metadata supposed to be updated without need of updating value.

--
Mikl




\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

