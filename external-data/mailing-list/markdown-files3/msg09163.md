---
title: "Re: Deleting items from search index increases disk usage"
description: ""
project: community
lastmod: 2012-11-02T09:32:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09163"
mailinglist_parent_id: "msg09105"
author_name: "Jeremy Raymond"
project_section: "mailinglistitem"
sent_date: 2012-11-02T09:32:02-07:00
---


I cycled through the compaction on another node. Again after 3 rounds
compaction has stopped. On one node the merge index is 26 GB on the other
21 GB. So it looks like I've hit the 5 segment compaction no-op condition
on both nodes.

What would account for the difference in merge\_index size? Shouldn't these
be relatively the same? There must still be tombstones in there...

On my production cluster the merge\_index is ~44GB. I estimate that
approximately 90 - 95% of the index data belongs to the bucket I no longer
want indexed. Manually deleting items from the index then manually
triggering compaction doesn't look like it will scale. Will this workflow
work to re-build the search index. I need to keep the cluster available for
writes while doing this:

1. In a rolling fashion, disable Riak Search one node at a time.
2. Delete the contents of the merge\_index on each node.
3. In a rolling fashion, re-enable Riak Search on each node.
4. Reindex the items to be included in the search index.

This should do the trick right? Do I need to disable search before clearing
out the merge\_index folders or would disabling the search index on the
buckets via search-cmd be enough (and then re-enabling) before re-indexing?

--
Jeremy


On Fri, Nov 2, 2012 at 11:19 AM, Ryan Zezeski  wrote:

> "Active" is any segment file that has the suffix .data.
>
> [Sent from my iPhone]
>
> On Nov 2, 2012, at 11:11 AM, Jeremy Raymond  wrote:
>
> When do segments become active/inactive?
>
> --
> Jeremy
>
>
> On Fri, Nov 2, 2012 at 10:50 AM, Ryan Zezeski  wrote:
>
>>
>>
>> On Fri, Nov 2, 2012 at 9:52 AM, Jeremy Raymond wrote:
>>
>>> Some files changed and some didn't.
>>> Not really sure how to interpret the differences.
>>>
>>>
>> Another thing, compacting will occur only if there are 6 or more active
>> segments. So once you get down to 5 segments or less compaction becomes a
>> noop.
>>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

