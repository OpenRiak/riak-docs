---
title: "Re: How to create a flag type (context_required) using	riak-erlang-client/riakc_flag"
description: ""
project: community
lastmod: 2015-08-06T15:35:04-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16377"
mailinglist_parent_id: "msg16376"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2015-08-06T15:35:04-07:00
---


Hi,
It’s a long story.

The short answer is: you can’t with that client, it has strong opinions so the 
best thing to do is this: have your app interpret the absence of a flag as 
false (the bottom/default value for a flag.)

The long story: the semantic for the flag is “observed remove” or “add-wins” 
(in fact the semantic is “add-wins”, “observe remove” is just how it does it) 
which means you have to observe an enabled flag (which will have a context) in 
order to disable it. The context tells riak at exactly what logical time you 
observed the enabled flag. This is to prevent a request to “disable flag” at 
the same logical time as an “enable flag” winning over the “enable” in a 
race/by chance. Ideally the absence of a flag would be indicated by the client 
as the flag’s default/bottom value (disabled/false) however, for some reason we 
went with a kind of 3-state deal of does-not-exist/enabled/disabled. My opinion 
is that this was a bad idea. But it is the state of the world, and so we have 
to live with it for now. In future, I think it should be possible to use 
“new/0” to create a flag in the bottom state. It’s something we know how to do, 
we just haven’t done it yet. Sorry.

Cheers

Russell

On 6 Aug 2015, at 17:43, 王昊  wrote:

> When I try this in Erlang:(saving a new Map object to a bucket through )
> 
> Map = riakc\_map:new(),
> Map1 = riakc\_map:update({<<"published\_b">>, flag},
> fun(F) -> riakc\_flag:disable(F) end, Map);
> 
> I got context\_required. How could I create a false flag? I tried enable/1, it 
> seems ok. Should I use new/0?
> 
> --
> 
> Hao Wang
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

