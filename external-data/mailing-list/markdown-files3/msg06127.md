---
title: "Delta updates using pre-commit hooks"
description: ""
project: community
lastmod: 2012-01-04T07:11:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06127"
author_name: "Marek Zawirski"
project_section: "mailinglistitem"
sent_date: 2012-01-04T07:11:37-08:00
---


Hi,

we are trying use Riak as a storage layer for experimental
higher-level data types updated by clients, using a set of
well-defined operations. To this end, each data type instance is
stored under a single key. One problem with this approach is that
after client modifies even a small piece of the data structure, it
needs to write (and transfer) the whole data structure back to Riak.
We are looking for a way to reduce this overhead by sending just a
delta operation, preferably without partitioning the data structure to
several keys.

One approach we thought about is to perform operations on Riak-side
using pre-commit hooks or similar technique. I.e. reconstruct the new
value on Riak using original old value + delta send by client. The
operations (deltas) we are talking about have necessary properties to
ensure convergence. Still, it seems there a couple technical issues
involved, we are looking how to solve them:
1) pre-commit API seems to only offer access to the object value
passed by client during write and not the old value; I wonder - am I
able to read the value from the store in pre-commit hook? In
particular, the value previously read by the client writing,
identified by version vector?
2) pre-commit hooks are executed on the coordinator node; is there an
easy way in Riak to apply operations at data nodes instead?

Thanks for any info that can help addressing these issues.

Regards,
Marek Zawirski

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

