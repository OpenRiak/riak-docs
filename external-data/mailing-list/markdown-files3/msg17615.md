---
title: "RE: speeding up bulk loading"
description: ""
project: community
lastmod: 2016-08-31T12:33:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17615"
mailinglist_parent_id: "msg17610"
author_name: "Travis Kirstine"
project_section: "mailinglistitem"
sent_date: 2016-08-31T12:33:05-07:00
---


Magnus

Thanks for your reply. We’re are using the riack C client library for riak 
(https://github.com/trifork/riack) which is used within an application called 
MapCache to store 256x256 px images with a corresponding key within riak. 
Currently we have 75 million images to transfer from disk into riak which is 
being done concurrently. Periodically this transfer process will crash

Riak is setup using n=3 on 5 nodes with a leveldb backend. Each server has 
45GB of memory and 16 cores with standard hard drives. We made no significant 
modification to the riak.conf except upping the leveldb.maximum\_memory.percent 
to 70 and tweeking the sysctl.conf as follows

vm.swappiness = 0
net.ipv4.tcp\_max\_syn\_backlog = 40000
net.core.somaxconn = 40000
net.core.wmem\_default = 8388608
net.core.rmem\_default = 8388608
net.ipv4.tcp\_sack = 1
net.ipv4.tcp\_window\_scaling = 1
net.ipv4.tcp\_fin\_timeout = 15
net.ipv4.tcp\_keepalive\_intvl = 30
net.ipv4.tcp\_tw\_reuse = 1
net.ipv4.tcp\_moderate\_rcvbuf = 1
# Increase the open file limit
# fs.file-max = 65536 # current setting

I have seen this error in the logs
2016-08-30 22:26:07.180 [error] <0.20777.512> CRASH REPORT Process 
<0.20777.512> with 0 neighbours crashed with reason: no function clause 
matching webmachine\_request:peer\_from\_peername({error,enotconn}, 
{webmachine\_request,{wm\_reqstate,#Port<0.2817336>,[],undefined,undefined,undefined,{wm\_reqdata,'GET',...},...}})
 line 150

Regards

From: Magnus Kessler [mailto:mkess...@basho.com]
Sent: August-31-16 4:08 AM
To: Travis Kirstine 
Cc: riak-users@lists.basho.com
Subject: Re: speeding up bulk loading

On 26 August 2016 at 22:20, Travis Kirstine 
> 
wrote:
Is there any way to speed up bulk loading? I wondering if I should be tweeking 
the erlang, aae or other config options?



Hi Travis,

Excuse the late reply; your message had been stuck in the moderation queue. 
Please consider subscribing to this list.

Without knowing more about how you perform bulk uploads, it's difficult to 
recommend any changes. Are you using the HTTP REST API or one of the client 
libraries, which use protocol buffers by default? What concerns do you have 
about the upload performance? Please let us know a bit more about your setup.

Kind Regards,

Magnus


--
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincoln’s Inn Fields London WC2A 3BP Reg 07970431
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

