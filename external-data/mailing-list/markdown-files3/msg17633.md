---
title: "Re: Spaces in the search string"
description: ""
project: community
lastmod: 2016-09-08T13:30:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17633"
mailinglist_parent_id: "msg17629"
author_name: "sean mcevoy"
project_section: "mailinglistitem"
sent_date: 2016-09-08T13:30:07-07:00
---


Hi Alexander,
Unfortunately it didn't shake with any satisfaction.
I'm sure there's an easy answer, and I hope I'll get back to search for it
some day.
But for now me & my pragmatic overlords have gone for a work-around
solution that avoids the problem.
//Sean.


On Wed, Sep 7, 2016 at 2:06 PM, Alexander Sicular 
wrote:

> Hi Sean, Familiarize yourself with the default schema[0], if that is what
> you're using. Also check details around this specific type of search around
> the web[1].
>
> Let us know how it shakes out,
> -Alexander
>
>
> [0] https://raw.githubusercontent.com/basho/yokozuna/develop/priv/default\_
> schema.xml
> [1] http://stackoverflow.com/questions/10023133/solr-
> wildcard-query-with-whitespace
>
>
>
> On Wednesday, September 7, 2016, sean mcevoy 
> wrote:
>
>> Hi again!
>>
>> Apologies for the premature post earlier. I thought I had a solution when
>> I didn't get the error but when I got around to plugging it into my
>> application it's still not doing everything that I need.
>> I've narrowed it down to this minimal testcase, first setup the index &
>> insert the data:
>>
>>
>> {ok,Pid} = riakc\_pb\_socket:start("127.0.0.1", 10017).
>> ok = riakc\_pb\_socket:create\_search\_index(Pid, <<"test\_index">>,
>> <<"\_yz\_default">>, []).
>> ok = riakc\_pb\_socket:set\_search\_index(Pid, <<"test\_bucket">>,
>> <<"test\_index">>).
>> RO = riakc\_obj:new(<<"test\_bucket">>, <<"test\_key">>,
>> <<"{\"name\_s\":\"my test name\",\"age\_i\":2}">>, "application/json").
>> ok = riakc\_pb\_socket:put(Pid, RO).
>>
>>
>> Now I can get the hit when search for a partial name with wildcards & no
>> escapes or spaces:
>> 521>
>> 521> riakc\_pb\_socket:search(Pid, <<"test\_index">>, <<"name\_s:\*test\* AND
>> age\_i:2">>, []).
>> {ok,{search\_results,[{<<"test\_index">>,
>> [{<<"score">>,<<"1.22776079999999998549e+00">>},
>> {<<"\_yz\_rb">>,<<"test\_bucket">>},
>> {<<"\_yz\_rt">>,<<"default">>},
>> {<<"\_yz\_rk">>,<<"test\_key">>},
>> {<<"\_yz\_id">>,<<"1\*default\*tes
>> t\_bucket\*test\_key\*57">>},
>> {<<"name\_s">>,<<"my test name">>},
>> {<<"age\_i">>,<<"2">>}]}],
>> 1.2277607917785645,1}}
>>
>>
>> And I can get the hit when I search for the full name with spaces & the
>> escaped quotes:
>> 522>
>> 522> riakc\_pb\_socket:search(Pid, <<"test\_index">>, <<"name\_s:\"my test
>> name\" AND age\_i:2">>, []).
>> {ok,{search\_results,[{<<"test\_index">>,
>> [{<<"score">>,<<"1.00736960000000008719e+00">>},
>> {<<"\_yz\_rb">>,<<"test\_bucket">>},
>> {<<"\_yz\_rt">>,<<"default">>},
>> {<<"\_yz\_rk">>,<<"test\_key">>},
>> {<<"\_yz\_id">>,<<"1\*default\*tes
>> t\_bucket\*test\_key\*58">>},
>> {<<"name\_s">>,<<"my test name">>},
>> {<<"age\_i">>,<<"2">>}]}],
>> 1.0073696374893188,1}}
>>
>>
>> But how can I search for a partial name with spaces:
>> 523>
>> 523> riakc\_pb\_socket:search(Pid, <<"test\_index">>, <<"name\_s:\"\*y test
>> na\*\" AND age\_i:2">>, []).
>> {ok,{search\_results,[],0.0,0}}
>> 524>
>> 524>
>>
>>
>> I get the feeling that I'm missing something really obvious but can't see
>> it. Any more pointers appreciated!
>>
>> //Sean.
>>
>>
>> On Wed, Sep 7, 2016 at 10:11 AM, sean mcevoy 
>> wrote:
>>
>>> Hi Jason,
>>>
>>> Thanks for the kick, I just needed to look closer!
>>> Yes, had tried escaping but one of my utility functions for dynamically
>>> building the search string had been stripping it out again. D'oh!
>>>
>>> Curiously, just escaping the space doesn't work as in the example in the
>>> stackoverflow post.
>>> Putting the search term in an inner string and escaping its quotes both
>>> feels more natural and does work so I'm going with something more like:
>>>
>>> 409>
>>> 409>
>>> 409> riakc\_pb\_socket:search(Pid, <<"test\_index">>, <<"name\_s:\"we rt\"
>>> AND age\_i:0">>, []).
>>> {ok,{search\_results,[],0.0,0}}
>>> 410>
>>> 410>
>>> 410> riakc\_pb\_socket:search(Pid, <<"test\_index">>, <<"name\_s:we\ rt AND
>>> age\_i:0">>, []).
>>> {error,<<"Query unsuccessful check the logs.">>}
>>> 411>
>>> 411>
>>>
>>> Cheers,
>>> //Sean.
>>>
>>>
>>> On Tue, Sep 6, 2016 at 2:48 PM, Jason Voegele 
>>> wrote:
>>>
>>>> Hi Sean,
>>>>
>>>> Have you tried escaping the space in your query?
>>>>
>>>> http://stackoverflow.com/questions/10023133/solr-wildcard-qu
>>>> ery-with-whitespace
>>>>
>>>>
>>>> On Sep 5, 2016, at 6:24 PM, sean mcevoy  wrote:
>>>>
>>>> Hi List,
>>>>
>>>> We have a solr index where we store something like:
>>>> <<"{\"key\_s\":\"ID\",\"body\_s\":\"some test string\"}">>}],
>>>>
>>>> Then we try to do a riakc\_pb\_socket:search with the pattern:
>>>> <<"body\_s:\*test str\*">>
>>>>
>>>> The request will fail with an error message telling us to check the
>>>> logs and in there we find:
>>>>
>>>> 2016-09-05 13:37:29.271 [error] <0.12067.10>@yz\_pb\_search:maybe\_process:107
>>>> {solr\_error,{400,"http://localhost:10014/internal\_solr/crm\_d
>>>> b.campaign\_index/select",<<"{\"error\":{\"msg\":\"no field name
>>>> specified in query and no default specified via 'df'
>>>> param\",\"code\":400}}\n">>}} [{yz\_solr,search,3,[{file,"src
>>>> /yz\_solr.erl"},{line,284}]},{yz\_pb\_search,maybe\_process,3,[{
>>>> file,"src/yz\_pb\_search.erl"},{line,78}]},{riak\_api\_pb\_server
>>>> ,process\_message,4,[{file,"src/riak\_api\_pb\_server.erl"},{lin
>>>> e,388}]},{riak\_api\_pb\_server,connected,2,[{file,"src/riak\_
>>>> api\_pb\_server.erl"},{line,226}]},{riak\_api\_pb\_server,decode\_
>>>> buffer,2,[{file,"src/riak\_api\_pb\_server.erl"},{line,364}]},{
>>>> gen\_fsm,handle\_msg,7,[{file,"gen\_fsm.erl"},{line,505}]},{
>>>> proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,239}]}]
>>>>
>>>>
>>>> Through experiment I've figured out that it doesn't like the space as
>>>> it seems to think the part of the search string after that space is a new
>>>> key to search for. Which seems fair enough.
>>>>
>>>> Anyone know of a work-around? Or am I formatting my request incorrectly?
>>>>
>>>> Thanks in advance.
>>>> //Sean.
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>>
>>>
>>
>
> --
>
>
> Alexander Sicular
> Solutions Architect
> Basho Technologies
> 9175130679
> @siculars
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

