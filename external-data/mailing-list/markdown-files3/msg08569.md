---
title: "Re: {error,insufficient_vnodes_available}"
description: ""
project: community
lastmod: 2012-09-17T07:34:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08569"
mailinglist_parent_id: "msg08568"
author_name: "Kresten Krab Thorup"
project_section: "mailinglistitem"
sent_date: 2012-09-17T07:34:15-07:00
---


As I understand Paul's situation, the 3 nodes are up and running again. Should 
that not be enough to avoid the "insufficient vnodes" error?

After a node down, I can see that it should matters better by running "riak 
repair" of the involved partitions, but 2i should be able to run again when 
sufficient nodes comes back on line?

Kresten

On Sep 17, 2012, at 4:20 PM, Reid Draper 
> wrote:

Paul,

It looks like you're running a 3-node cluster. If two of the nodes fail, you'll 
likely
not be able to run `coverage` queries like 2i and list-keys. If you need to be 
able
to sustain losing 2 nodes and still successfully run 2i, I'd suggest running at 
least
a 5 node cluster.

Reid


On Sep 17, 2012, at 6:07 AM, Paul Scheltema 
> wrote:

recently 2 of the vm's running riak crashed. (probably not due to riak)
When i now run "curl $riak/buckets/$2/keys?keys=true" i get the following error 
message:

500 Internal Server ErrorInternal 
Server Error
======================

The server encountered an error while processing this 
request:  

```
{error,{error,{badmatch,{error,insufficient_vnodes_available}},
              [{riak_kv_wm_keylist,produce_bucket_body,2},
               {webmachine_resource,resource_call,3},
               {webmachine_resource,do,3},
               {webmachine_decision_core,resource_call,1},
               {webmachine_decision_core,decision,1},
               {webmachine_decision_core,handle_request,2},
               {webmachine_mochiweb,loop,1},
               
{mochiweb_http,parse_headers,5}]}}
```


---

mochiweb+webmachine web 
server



== ring\_status
root@03:/usr/local/riak/bin# ./riak-admin ring\_status
================================== Claimant ===================================
Claimant: 'riak@192.168.122.112'
Status: up
Ring Ready: true

============================== Ownership Handoff ==============================
No pending changes.

============================== Unreachable Nodes ==============================
All nodes are up and reachable

== ring ready
root@03:/usr/local/riak/bin# ./riak-admin ringready
TRUE All nodes agree on the ring 
['riak@192.168.122.111',
 
'riak@192.168.122.112',
 
'riak@192.168.122.113']

== member status
root@03:/usr/local/riak/bin# ./riak-admin member\_status
================================= Membership ==================================
Status Ring Pending Node
-------------------------------------------------------------------------------
valid 34.4% -- 
'riak@192.168.122.111'
valid 32.8% -- 
'riak@192.168.122.112'
valid 32.8% -- 
'riak@192.168.122.113'
-------------------------------------------------------------------------------
Valid:3 / Leaving:0 / Exiting:0 / Joining:0 / Down:0

== ulimit:
root@03:/usr/local/riak/etc# ulimit -a
core file size (blocks, -c) 0
data seg size (kbytes, -d) unlimited
scheduling priority (-e) 0
file size (blocks, -f) unlimited
pending signals (-i) 15584
max locked memory (kbytes, -l) 64
max memory size (kbytes, -m) unlimited
open files (-n) 1024
pipe size (512 bytes, -p) 8
POSIX message queues (bytes, -q) 819200
real-time priority (-r) 0
stack size (kbytes, -s) 8192
cpu time (seconds, -t) unlimited
max user processes (-u) 15584
virtual memory (kbytes, -v) unlimited
file locks (-x) unlimited



--
groeten
/paul

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



Mobile: + 45 2343 4626 | Skype: krestenkrabthorup | Twitter: @drkrab
Trifork A/S | Margrethepladsen 4 | DK- 8000 Aarhus C | Phone : +45 8732 
8787 | www.trifork.com





\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

