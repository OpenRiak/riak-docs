---
title: "Re: Bad MapReduce job brings the Riak to a screeching halt?"
description: ""
project: community
lastmod: 2012-08-30T05:56:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08405"
mailinglist_parent_id: "msg08397"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2012-08-30T05:56:05-07:00
---


On Wed, Aug 29, 2012 at 11:07 PM, Brad Heller  wrote:
> The issue I'm facing: I tried to run an improperly-formatted MapReduce job
> against a bucket with about 45k keys in it and it seemed to crash Riak.

…snip…

> So my question is: Why did this completely kill Riak? This makes me pretty
> nervous--a bug in our app has the potential to bring down the ring! Is there
> anything we can do to protect against this?

Hi, Brad. Indeed, you have found a bug around our validation of
keyfilters. I've filed an issue to track it:

https://github.com/basho/riak\_kv/issues/387

The short version is that nested keyfilters (those inside and/or/not
clauses) are not validated until execution time. The manner in which
they are executed means that any failures they have happen on each
vnode processing them, so there is quite a bit more error handling and
logging going on.

I don't think this should have "crashed" Riak, though. The query would
have hung until its timeout, and there would have been quite a spew in
the logs, but Riak should have remained running and able to handle
other requests (barring a second problem, possibly related to KV vnode
workers dying like this during a fold operation). Could you share more
details about what you meant by "crash", please?

Thanks for reporting this.

Cheers,
Bryan

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

