---
title: "Re: ACLs not being set correctly for riak-cs"
description: ""
project: community
lastmod: 2015-03-02T18:22:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15810"
mailinglist_parent_id: "msg15807"
author_name: "Shawn Debnath"
project_section: "mailinglistitem"
sent_date: 2015-03-02T18:22:19-08:00
---


Filed https://github.com/basho/riak\_cs/issues/1081

Thanks,
Shawn


On 2/27/15, 2:18 PM, "Seema Jethani" > 
wrote:

Shawn

Would you be able to open a github issue for this? We will look into this issue 
for you. Thanks!



Date: Mon, 23 Feb 2015 20:41:16 +0000
From: Shawn Debnath >
To: "riak-users@lists.basho.com" 
>
Subject: ACLs not being set correctly for riak-cs
Message-ID: 
<8ab97aa2-f38f-423a-bf8a-98f915806...@debnath.net>
Content-Type: text/plain; charset="utf-8"

Hi there,

I can't seem to be able to get ACLs set properly on newly created buckets in 
riak-cs. I am using s3curl to push the payload up via PUT /?acl and it returns 
200 OK. However, a GET /?acl returns an xml payload with missing IDs. Without 
manually pushing new ACLs, the default ACLs correctly gives access to the 
owner, but as soon as I push a custom ACL set, it screws up the grants for both 
the owner and the other users.

NOTE: The keys below are for a private test environment so substitute your 
values accordingly.

Any help appreciated on pointing me to the right direction!

Thanks,
Shawn



Here are the three user IDs, keys and secrets. I want the owner to retain full 
control while I want to grant WRITE privileges to publisher and READ privileges 
to reader.


 admin\_id: feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e
 admin\_key: 1049V\_JJHPH7TO\_QPWVC
 admin\_secret: lMQsnn3Cukk1UR28FAtoZiap9KEOjBRgYKiVVg==
 publisher\_id: 
5efc8fb59754a6d11eb1a36c501a8ef7b1be44b0300fbe3df354423b7a115ac5
 publisher\_key: D-YBO-QHCHU9MEHNZR1D
 publisher\_secret: nin5LA4WHEuJeTuzN-qCWBXsOvTyUbdPuDQ3eg==
 reader\_id: de6831d6da88df325d474f7f6c1f708596998c54fc0817685f8c67f1d8cab239
 reader\_key: \_QOKYEHYM6S-YDDHGSYF
 reader\_secret: sFc1HBhjQzfr70Yda-ke257LHkVCPNAN0chs9A==



feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e

FULL\_CONTROL



5efc8fb59754a6d11eb1a36c501a8ef7b1be44b0300fbe3df354423b7a115ac5

WRITE



de6831d6da88df325d474f7f6c1f708596998c54fc0817685f8c67f1d8cab239

READ




$ bin/s3curl.pl --debug --id ${RIAK\_ADMIN\_KEY} --key 
${RIAK\_ADMIN\_SECRET} --acl private -- -s -v -x localhost:50201 -X PUT 
http://social-media.cs.domain.com/

s3curl: Found the url: 
host=social-media.cs.domain.com; port=; 
uri=/; query=;
s3curl: vanity endpoint signing case
s3curl: StringToSign='PUT\n\n\nMon, 23 Feb 2015 20:03:15 
+0000\nx-amz-acl:private\n/social-media/'
s3curl: signature='v48ovqQBnqfEcBZ7kPedpbs1Xt4='
s3curl: exec curl -H Date: Mon, 23 Feb 2015 20:03:15 +0000 -H Authorization: 
AWS 1049V\_JJHPH7TO\_QPWVC:v48ovqQBnqfEcBZ7kPedpbs1Xt4= -H x-amz-acl: private -L 
-s -v -x localhost:50201 -X PUT http://social-media.cs.domain.com/
\* Hostname was NOT found in DNS cache
\* Trying 127.0.0.1...
\* Connected to localhost (127.0.0.1) port 50201 (#0)
> PUT http://social-media.cs.domain.com/ HTTP/1.1
> User-Agent: curl/7.37.1
> Host: social-media.cs.domain.com
> Accept: \*/\*
> Proxy-Connection: Keep-Alive
> Date: Mon, 23 Feb 2015 20:03:15 +0000
> Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:v48ovqQBnqfEcBZ7kPedpbs1Xt4=
> x-amz-acl: private
>
< HTTP/1.1 200 OK
\* Server Riak CS is not blacklisted
< Server: Riak CS
< Date: Mon, 23 Feb 2015 20:03:16 GMT
< Content-Type: application/xml
< Content-Length: 0
<
\* Connection #0 to host localhost left intact



$ bin/s3curl.pl --debug --id ${RIAK\_ADMIN\_KEY} --key 
${RIAK\_ADMIN\_SECRET} --put /tmp/riak-cs-bucket-policy.xml -- -s -v -x 
localhost:50201 -X PUT http://social-media.cs.domain.com/?acl

s3curl: Found the url: 
host=social-media.cs.domain.com; port=; 
uri=/; query=acl;
s3curl: vanity endpoint signing case
s3curl: StringToSign='PUT\n\n\nMon, 23 Feb 2015 20:03:21 
+0000\n/social-media/?acl'
s3curl: signature='QAcPGgB1tZO2+U4M0TvP4Q4uyxQ='
s3curl: exec curl -H Date: Mon, 23 Feb 2015 20:03:21 +0000 -H Authorization: 
AWS 1049V\_JJHPH7TO\_QPWVC:QAcPGgB1tZO2+U4M0TvP4Q4uyxQ= -L -T 
/tmp/riak-cs-bucket-policy.xml -s -v -x localhost:50201 -X PUT 
http://social-media.cs.domain.com/?acl
\* Hostname was NOT found in DNS cache
\* Trying 127.0.0.1...
\* Connected to localhost (127.0.0.1) port 50201 (#0)
> PUT http://social-media.cs.domain.com/?acl HTTP/1.1
> User-Agent: curl/7.37.1
> Host: social-media.cs.domain.com
> Accept: \*/\*
> Proxy-Connection: Keep-Alive
> Date: Mon, 23 Feb 2015 20:03:21 +0000
> Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:QAcPGgB1tZO2+U4M0TvP4Q4uyxQ=
> Content-Length: 1003
> Expect: 100-continue
>
< HTTP/1.1 100 Continue
\* We are completely uploaded and fine
< HTTP/1.1 200 OK
\* Server Riak CS is not blacklisted
< Server: Riak CS
< Date: Mon, 23 Feb 2015 20:03:21 GMT
< Content-Type: application/xml
< Content-Length: 0
<
\* Connection #0 to host localhost left intact



bin/s3curl.pl --debug --id ${RIAK\_ADMIN\_KEY} --key 
${RIAK\_ADMIN\_SECRET} -- -s -v -x localhost:50201 -X GET 
http://social-media.cs.domain.com/?acl

xml version="1.0" encoding="UTF-8"?


feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e
riak-cs-admin







FULL\_CONTROL






READ






WRITE




s3curl: Found the url: 
host=riak-cs.cs.domain.com; port=; uri=/users; 
query=;
s3curl: vanity endpoint signing case
s3curl: StringToSign='GET\n\n\nMon, 23 Feb 2015 20:30:30 +0000\n/riak-cs/users'
s3curl: signature='mOcYNLzS/3PFkXhU8tnM14HQVoI='
s3curl: exec curl -H Date: Mon, 23 Feb 2015 20:30:30 +0000 -H Authorization: 
AWS 1049V\_JJHPH7TO\_QPWVC:mOcYNLzS/3PFkXhU8tnM14HQVoI= -L -s -v -x 
localhost:50201 -X GET http://riak-cs.cs.domain.com/users
\* Hostname was NOT found in DNS cache
\* Trying 127.0.0.1...
\* Connected to localhost (127.0.0.1) port 50201 (#0)
> GET http://riak-cs.cs.domain.com/users HTTP/1.1
> User-Agent: curl/7.37.1
> Host: riak-cs.cs.domain.com
> Accept: \*/\*
> Proxy-Connection: Keep-Alive
> Date: Mon, 23 Feb 2015 20:30:30 +0000
> Authorization: AWS 1049V\_JJHPH7TO\_QPWVC:mOcYNLzS/3PFkXhU8tnM14HQVoI=
>
< HTTP/1.1 200 OK
< Vary: Accept
< Transfer-Encoding: chunked
\* Server Riak CS is not blacklisted
< Server: Riak CS
< Date: Mon, 23 Feb 2015 20:30:30 GMT
< Content-Type: multipart/mixed; boundary=TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
<
--TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
Content-Type: application/xml


xml version="1.0" encoding="UTF-8"?


riak-cs-publis...@domain.com
riak-cs-publisher
publisher
D-YBO-QHCHU9MEHNZR1D
nin5LA4WHEuJeTuzN-qCWBXsOvTyUbdPuDQ3eg==
5efc8fb59754a6d11eb1a36c501a8ef7b1be44b0300fbe3df354423b7a115ac5
enabled


riak-cs-rea...@domain.com
riak-cs-reader
reader
\_QOKYEHYM6S-YDDHGSYF
sFc1HBhjQzfr70Yda-ke257LHkVCPNAN0chs9A==
de6831d6da88df325d474f7f6c1f708596998c54fc0817685f8c67f1d8cab239
enabled


--TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
Content-Type: application/xml


xml version="1.0" encoding="UTF-8"?


riak-cs-ad...@domain.com
riak-cs-admin
admin
1049V\_JJHPH7TO\_QPWVC
lMQsnn3Cukk1UR28FAtoZiap9KEOjBRgYKiVVg==
feab26c2fec623a34e7d60e620b42a7786eca3223b5e2faebc5d248a34f3239e
enabled


--TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O
Content-Type: application/xml


xml version="1.0" encoding="UTF-8"?

\* Connection #0 to host localhost left intact
--TCW5KE8FRZPTJ9HK2PL896Q8A5V2F9O--

-------------- next part --------------
An HTML attachment was scrubbed...
URL: 






--
Seema Jethani
Director of Product Management, Basho
4083455739 | @seemaj
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

