---
title: "enotconn error"
description: ""
project: community
lastmod: 2016-09-14T07:24:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17645"
author_name: "Travis Kirstine"
project_section: "mailinglistitem"
sent_date: 2016-09-14T07:24:33-07:00
---


Hi all,

I'm using haproxy with a riak 2.1.4 in a 5 node cluster. I'm getting fairly 
consistent enotconn errors in riak which happen to coincide with client 
failures. We've setup haproxy as recommended 
(https://gist.github.com/gburd/1507077) see below. I'm running a leveldb 
backend with 9 GB max memory (I can go higher if needed). I'm not sure at this 
point if I have a network issue or leveldb / riak issue.

2016-09-14 08:10:16 =CRASH REPORT====
 crasher:
 initial call: mochiweb\_acceptor:init/3
 pid: <0.28104.442>
 registered\_name: []
 exception error: 
{function\_clause,[{webmachine\_request,peer\_from\_peername,[{error,enotconn},{webmachine\_request,{wm\_reqstate,#Port<0.6539192>,[],undefined,undefined,undefined,{wm\_reqdata,'GET',http,{1,0},"defined\_in\_wm\_req\_srv\_init","defined\_in\_wm\_req\_srv\_init",defined\_on\_call,defined\_in\_load\_dispatch\_data,"/ping","/ping",[],defined\_in\_load\_dispatch\_data,"defined\_in\_load\_dispatch\_data",500,1073741824,67108864,[],[],{0,nil},not\_fetched\_yet,false,{0,nil},<<>>,follow\_request,undefined,undefined,[]},undefined,undefined,undefined}}],[{file,"src/webmachine\_request.erl"},{line,150}]},{webmachine\_request,get\_peer,1,[{file,"src/webmachine\_request.erl"},{line,124}]},{webmachine,new\_request,2,[{file,"src/webmachine.erl"},{line,69}]},{webmachine\_mochiweb,loop,2,[{file,"src/webmachine\_mochiweb.erl"},{line,49}]},{mochiweb\_http,headers,5,[{file,"src/mochiweb\_http.erl"},{line,96}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,239}]}]}
 ancestors: ['http://192.168.18.64:8098\_mochiweb',riak\_api\_sup,<0.319.0>]
 messages: []
 links: [<0.325.0>,#Port<0.6539192>]
 dictionary: []
 trap\_exit: false
 status: running
 heap\_size: 987
 stack\_size: 27
 reductions: 963
 neighbours:


# haproxy.cfg
global
 log 127.0.0.1 local2 info
 chroot /var/lib/haproxy
 pidfile /var/run/haproxy.pid
 maxconn 256000
 user haproxy
 group haproxy
 spread-checks 5
 daemon
 quiet
 stats socket /var/lib/haproxy/stats
defaults
 log global
 option httplog
 option dontlognull
 option redispatch
 timeout connect 5000
 maxconn 256000

frontend main \*:80
 mode http
 acl url\_static path\_beg -i /static /images /javascript 
/stylesheets
 acl url\_static path\_end -i .jpg .gif .png .css .js

backend static
 balance roundrobin
 server static 127.0.0.1:4331 check

backend app
 mode http
 balance roundrobin
 server wmts1riak 192.168.18.72:80 check
 server wmts2riak 192.168.18.73:80 check

backend riak\_rest\_backend
 mode http
 balance roundrobin
 option httpchk GET /ping
 option httplog
 server riak1 192.168.18.64:8098 weight 1 maxconn 1024 check
 server riak2 192.168.18.65:8098 weight 1 maxconn 1024 check
 server riak3 192.168.18.66:8098 weight 1 maxconn 1024 check
 server riak4 192.168.18.67:8098 weight 1 maxconn 1024 check
 server riak5 192.168.18.68:8098 weight 1 maxconn 1024 check

frontend riak\_rest
 bind \*:8098
 mode http
 option contstats
 default\_backend riak\_rest\_backend

backend riak\_protocol\_buffer\_backend
 balance leastconn
 mode tcp
 option tcpka
 option srvtcpka
 server riak1 192.168.18.64:8087 weight 1 maxconn 1024 check
 server riak2 192.168.18.65:8087 weight 1 maxconn 1024 check
 server riak3 192.168.18.66:8087 weight 1 maxconn 1024 check
 server riak4 192.168.18.67:8087 weight 1 maxconn 1024 check
 server riak5 192.168.18.68:8087 weight 1 maxconn 1024 check

frontend riak\_protocol\_buffer
 bind \*:8087
 mode tcp
 option tcplog
 option contstats
 mode tcp
 option tcpka
 option srvtcpka
 default\_backend riak\_protocol\_buffer\_backend












\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

