---
title: "Connection Pool with Erlang PB Client Necessary?"
description: ""
project: community
lastmod: 2011-07-25T16:03:57-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04059"
author_name: "Andrew Berman"
project_section: "mailinglistitem"
sent_date: 2011-07-25T16:03:57-07:00
---


I know that this subject has been brought up before, but I'm still
wondering what the value of a connection pool is with Riak. In my
app, I'm using Webmachine resources to talk to a gen\_server which in
turn talks to Riak. So, in other words, the Webmachine resources
never talk to Riak directly, they must always talk to the gen\_server
to deal with Riak. Since Erlang processes are so small and fast to
create, is there really any overhead in having the gen\_server create a
new connection (with the same client id) each time it needs to access
Riak?

So the pseudo-code would look like this:

my\_webmachine\_resource.erl
========================

some\_service:persist(MyRecord).

some\_service.erl
==============

persist(MyRecord) ->
 riak\_repository:load(LoadSomething),
 riak\_repository:persist(MyRecord),
 riak\_repository:persist(SomethingElse).

riak\_repository.erl (this is the gen\_server)
================================

persist(...) -> call (...)
load(...) -> call(...)

call(....) ->
 Pid = get\_connection(ClientId),
 DoAction(Pid, ....),
 close\_connection(Pid) %% Is this even necessary?

Thoughts?

Another approach I thought of was:

some\_service.erl
==============

persist(SomeRecord) ->
 riak\_repository:execute(fun(Pid) ->
 riak\_repository:persist(..., Pid),
 riak\_repository:load(...., Pid).
 end).

riak\_repository.erl
==============

execute(Fun) ->
 try
 Pid = get\_connection(),
 Fun(Pid)
 after
 close\_connection(Pid)
 end

Is one of these approaches better than the other in dealing with Riak
and vclocks?

Thanks,

Andrew

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

