---
title: "Re: Upgrading 0.14.2 cluster to 1.2"
description: ""
project: community
lastmod: 2012-08-09T13:16:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08248"
mailinglist_parent_id: "msg08238"
author_name: "Sebastian Cohnen"
project_section: "mailinglistitem"
sent_date: 2012-08-09T13:16:45-07:00
---


Hey all,

looks like I'm already stuck :-/

I'm trying to test the upgrade on a stage cluster (with 2 nodes). What I did so 
far:
\* downloaded 1.2
\* stopped riak
\* backup /var/lib/riak/ring and /etc/riak
\* installed 1.2
\* changed app.config and vm.args (just node name, ring creation size, config 
for our multi-backends)
\* started riak again

riak-admin status looked fine, ring membership is fine, both nodes answer 
requests. As hinted by Jon, I attached to riak console and run 
riak\_core\_capability:all(). As far as I can tell, everything looks okay here 
too.

What is not working is: riak-admin transfers. It is not working on both nodes. 
For the state situation this is not a big deal, for production this would be a 
potential problem.

I've pasted the output of "riak\_core\_capability:all()." and command output of 
riak-admin transfers here: https://gist.github.com/3307714

Is there anything I can do about that?


Best

Sebastian


PS: What's interesting is that I think that I saw a similar behavior while 
trying to upgrade to 1.1.4 a few days ago. I have to double check that though.

On 09.08.2012, at 14:08, Sebastian Cohnen  wrote:

> I'm actually thinking about taking the risk. We only have a small 3-node 
> cluster with ~50GB of data with relatively little traffic (and we don't have 
> any 2i, nor do we use search or MR).
> 
> I'll backup the data files, the ring state and everything else I find and 
> give it a try. If anything strange happens, we roll back and do the 
> additional 1.1.4 step.
> 
> Thanks for the information and help so far!
> 
> On 08.08.2012, at 19:57, Jon Meredith  wrote:
> 
>> Only test coverage. We didn't run direct testing to 0.14.2 - we also 
>> deliberately made the decision not to remove some older code that would have 
>> broken 0.14 upgrades until the next major release. 
>> 
>> It all depends on your risk tolerance - we didn't make any file format 
>> changes to bitcask so your data should be safe. If you wanted to try it, I 
>> would take a backup of the ring directory in case you had to downgrade the 
>> node again for any reason.
>> 
>> On the newly upgraded node you could run riak\_core\_capability:all(). on the 
>> riak console, that would double-check that the settings matched the required 
>> rolling upgrade settings, and make sure you do a diff of your 
>> app.config/vm.args against the new package to check there aren't any 
>> settings missing.
>> 
>> Jon.
>> 
>> On Wed, Aug 8, 2012 at 11:39 AM, Sebastian Cohnen 
>>  wrote:
>> I'm curious, are there any special reasons for your recommendation?
>> 
>> On 08.08.2012, at 19:38, Jon Meredith  wrote:
>> 
>>> I would recommend going 0.14.2 -> 1.1.4 -> 1.2, making sure you follow the 
>>> pre-1.0 upgrade instructions on http://wiki.basho.com/Rolling-Upgrades.html
>>> 
>>> Once you do the upgrade from 1.2, the capabilities system will kick in and 
>>> the old legacy settings mentioned in the rolling upgrade will no longer be 
>>> used (if you need to you can override them with the new capability override 
>>> mechanism).
>>> 
>>> Jon.
>>> 
>>> On Wed, Aug 8, 2012 at 10:23 AM, Nathan Wilken  wrote:
>>> Is an intermediate upgrade recommended? 0.14.2 --> 1.0/1.1 --> 1.2?
>>> 
>>> 
>>> 
>>> From: riak-users-boun...@lists.basho.com 
>>> [riak-users-boun...@lists.basho.com] on behalf of Sean Cribbs 
>>> [s...@basho.com]
>>> Sent: Wednesday, August 08, 2012 6:35 AM
>>> To: Sebastian Cohnen
>>> Cc: riak-users@lists.basho.com
>>> Subject: Re: Upgrading 0.14.2 cluster to 1.2
>>> 
>>> Sebastian,
>>> 
>>> While it might work, we did not specifically test upgrades from 0.14.2, 
>>> only 1.0 and 1.1.
>>> 
>>> On Wed, Aug 8, 2012 at 7:08 AM, Sebastian Cohnen 
>>>  wrote:
>>> Hey list,
>>> 
>>> is it a good idea to upgrade a small (3 node) cluster straight to 1.2 from 
>>> 0.14.2. Especially with riak's 1.2 capabilities negotiation, it feels like 
>>> the upgrade process should be much simpler now? We don't do any M/R jobs 
>>> currently and we are only using bitcask right now.
>>> 
>>> 
>>> Best
>>> 
>>> Sebastian
>>> 
>>> 
>>> 
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>> 
>>> 
>>> 
>>> --
>>> Sean Cribbs 
>>> Software Engineer
>>> Basho Technologies, Inc.
>>> http://basho.com/
>>> 
>>> 
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>> 
>>> 
>>> 
>>> 
>>> --
>>> Jon Meredith
>>> Platform Engineering Manager
>>> Basho Technologies, Inc.
>>> jmered...@basho.com
>>> 
>> 
>> 
>> 
>> 
>> -- 
>> Jon Meredith
>> Platform Engineering Manager
>> Basho Technologies, Inc.
>> jmered...@basho.com
>> 
> 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

