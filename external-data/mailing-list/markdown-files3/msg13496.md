---
title: "Re: Riak Search and Yokozuna Backup Strategy"
description: ""
project: community
lastmod: 2014-01-27T12:21:33-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13496"
mailinglist_parent_id: "msg13495"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2014-01-27T12:21:33-08:00
---



On Jan 27, 2014, at 3:06 PM, Elias Levy  wrote:

> On Mon, Jan 27, 2014 at 11:57 AM, Matthew Von-Maszewski  
> wrote:
> 
> Google's designed leveldb to always assume it was not cleanly shutdown. If 
> the startup can read the most recent MANIFEST file, leveldb cleans up the 
> rest of the mess.
> 
> However, using the backup strategy previously discussed (backup sst\_? 
> directories numerically … rsync or tar) creates a scenario where the MANIFEST 
> file is likely incorrect in a manner that leveldb will not detect (hmm … 
> maybe it could detect it but no one thought to add a test). That is why we 
> always recommend (require!) that you manually run repair after a restore.
> 
> So, yes, but its not sufficient. Got it. Thanks.
> 
> And I assume that currently requires attaching to the Riak console and 
> executing something like:
> 
> eleveldb:repair("/var/db/riak/leveldb/442446784738847563128068650529343492278651453440",
> []).
> 
> for every vnode LevelDB in any eleveldb backend?
> 

So, yes. But the underlying theory is that restore via backups is the last 
ditch effort when all the N=3 / active anti-entropy (and multi-datacenter 
replication) niceties have failed (like when your datacenter is flooded).

That said, Basho's product management is working aggressively to define a 
better, more holistic backup/restore feature to add after the 2.0 release.

Matthew

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

