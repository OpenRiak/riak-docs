---
title: "Objects in Riak Search sometimes match based on their old values"
description: ""
project: community
lastmod: 2013-04-19T12:15:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10940"
author_name: "Rob Speer"
project_section: "mailinglistitem"
sent_date: 2013-04-19T12:15:46-07:00
---


I believe this is the same issue reported here:
http://riak-users.197444.n3.nabble.com/Issue-on-riak-search-when-update-bucket-tt4026629.html

Here's what's happening in my tests:

1. test\_riak\_10717-docs is a DB with about five documents in it. I have
enabled search on it, via PUT /riak/test\_riak\_10717-docs, with the
value {"props":{"search":true}}.

2. I PUT a document like this to
/riak/test\_riak\_10717-docs/uuid-623bb1d0f9384fc4a3d76eacf47cc6e7?w=3&r=3 :
{"text": "The sun is a mass of incandescent gas"}

(There are actually more fields in the document, but they seem irrelevant
unless someone tells me that they're not.)

3. I GET
/riak/test\_riak\_10717-docs/uuid-623bb1d0f9384fc4a3d76eacf47cc6e7?r=3 :
{"text": "The sun is a mass of incandescent gas"}

4. I PUT a revised document to
/riak/test\_riak\_10717-docs/uuid-623bb1d0f9384fc4a3d76eacf47cc6e7?w=3&r=3,
using the X-Riak-Vclock header that I just got in step 3:
{"text": "The sun is a miasma of incandescent plasma"}

5. I GET /solr/test\_riak\_10717-docs/select?wt=json&q=text:mass
{"text": "The sun is a miasma of incandescent plasma"}

6. I GET /solr/test\_riak\_10717-docs/select?wt=json&q=text:miasma
{"text": "The sun is a miasma of incandescent plasma"}

The document is indexed under both "mass" and "miasma", even though it does
not contain the word "mass".

This happens maybe 1/3 of the time. The other times, it works correctly,
only matching searches for "miasma".

How do I fix this? Is it a bug in Riak Search or a bug in how I'm using it?
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

