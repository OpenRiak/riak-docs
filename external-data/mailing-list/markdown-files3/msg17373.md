---
title: "Re: Precommit hook function - no error log - how to debug?"
description: ""
project: community
lastmod: 2016-05-16T08:22:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17373"
mailinglist_parent_id: "msg17369"
author_name: "Sanket Agrawal"
project_section: "mailinglistitem"
sent_date: 2016-05-16T08:22:14-07:00
---


Shouldn't precommit body show up in cluster-info first before we try to
test it with an object? I just set the precommit hook for test\_kv bucket
type which has no custom property set. Curl on props shows precommit, but
cluster-info doesn't (took another dump after 5 minutes of precommit hook
creation). No sasl logging is triggered either though the debug mode is on.

Curl output for test\_kv props:
>
>

> $ curl localhost:8098/types/test\_kv/props
>
> {"props":{"active":true,"allow\_mult":true,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"claimant":"
> riak1@127.0.0.1
> ","dvv\_enabled":true,"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"rtriggers","fun":"pre\_all"}],"pw":0,"r":"quorum","rw":"quorum","small\_vclock":50,"w":"quorum","young\_vclock":20}}




Cluster-info dump after setting the props - precommit body is still empty
in the cluster-info for test\_kv bucket type:


> grep -A15 test\_kv cluster\_info.txt |grep precommit
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},
> {\*precommit\*,[]},


On Mon, May 16, 2016 at 10:48 AM, Luke Bakken  wrote:

> Hi Sanket,
>
> Thanks for providing that information, this is the first time that the
> "write\_once" bucket type property was mentioned.
>
> If you set the precommit hook on a different bucket type where there
> are \*no other\* custom bucket type properties set, does the precommit
> hook run successfully?
>
> --
> Luke Bakken
> Engineer
> lbak...@basho.com
>
> On Mon, May 16, 2016 at 7:17 AM, Sanket Agrawal
>  wrote:
> > Hi Luke,
> >
> > More on the precommit hook debugging I just did - I might have a handle
> on
> > what the problem is. I took a cluster-info dump for all the nodes in the
> > cluster. In the dump, precommit is set to [] for all the buckets in the
> > cluster. The reason for that seems to be that the bucket type with
> > "write-once" property where precommit hook is set, is not in the cluster
> > somehow!
> >
> > The bucket type name is "test\_kv\_wo". Let us grep for it in
> cluster\_info.txt
> > - it doesn't show up at all (another bucket type "test\_kv" shows up
> > instead):
> >>
> >> $ grep test\_kv cluster\_info.txt | sort -u
> >> [[{bucket,<<"test\_kv">>}|
> >> {name,<<"test\_kv">>},
> >
> >
> > Now, let us verify we can get the props for the bucket type fine from
> curl:
> >>
> >> $ curl localhost:8098/types/test\_kv\_wo/buckets/uuid\_log/props:
> >>
> >>
> {"props":{"name":"uuid\_log","active":true,"allow\_mult":true,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"claimant":"
> riak1@127.0.0.1
> ","dvv\_enabled":true,"dw":"quorum","last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"uuid\_log","notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"rtriggers","fun":"pre\_uuid"}],"pw":0,"r":"quorum","rw":"quorum","small\_vclock":50,"w":"quorum","write\_once":true,"young\_vclock":20}}
> >
> >
> >
> > So, the problem might be missing bucket types in the cluster since they
> > don't show up in cluster-info at all? The same thing happens with LWW
> bucket
> > type that I created, test\_kv\_lww. It doesn't show up either. CRDT bucket
> > types show up fine.
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

