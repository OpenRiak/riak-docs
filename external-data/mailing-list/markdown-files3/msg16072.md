---
title: "Re: Reindexing solr after backup restore"
description: ""
project: community
lastmod: 2015-04-24T07:38:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16072"
mailinglist_parent_id: "msg16071"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-04-24T07:38:19-07:00
---


Hey Jason,

Here’s a little more discussion on Yokozuna backup strategies: 
http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2014-January/014514.html
 
.

Nonetheless, I wouldn’t say the behavior’s expected, but we’re going to be 
adding more to the docs on how to rebuild indexes.

To do so, you could just remove the yz\_anti\_entropy directory, and make AAE 
more aggressive, via

```
rpc:multicall([node() | nodes()], application, set\_env, [yokozuna, 
anti\_entropy\_build\_limit, {100, 1000}]).
rpc:multicall([node() | nodes()], application, set\_env, [yokozuna, 
anti\_entropy\_concurrency, 4])
```

and the indexes will rebuild. You can try to initialize the building of trees 
with `yz\_entropy\_mgr:init([])` via `riak attach`, but a restart would also kick 
AAE into gear. There’s a bit more related info on this thread: 
http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2015-March/016929.html
 
.

Thanks.

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\_we\_love | paperswelove.org
twitter => @zeeshanlakhani

> On Apr 24, 2015, at 1:34 AM, Jason Campbell  wrote:
> 
> I think I figured it out.
> 
> I followed this guide: 
> http://docs.basho.com/riak/latest/ops/running/nodes/renaming/#Clusters-from-Backups
> 
> The first Riak node (changed with riak-admin reip) kept it's Solr index. 
> However, the other nodes when joined via riak-admin cluster force-replace, 
> dropped their Solr indexes.
> 
> Is this expected? If so, it should really be in the docs, and there should 
> be another way to restore a cluster keeping Solr intact.
> 
> Also, is there a way to rebuild a Solr index?
> 
> Thanks,
> Jason
> 
>> On 24 Apr 2015, at 15:16, Jason Campbell  wrote:
>> 
>> I've just done a backup and restore of our production Riak cluster, and 
>> Yokozuna has dropped from around 125 million records to 25million. 
>> Obviously the IPs have changed, and although the Riak cluster is stable, I'm 
>> not sure Solr handled the transition as nicely.
>> 
>> Is there a way to force Solr to rebuild the indexes, or at least get back to 
>> the state it was in before the backup?
>> 
>> Also, is this expected behaviour?
>> 
>> Thanks,
>> Jason
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

