---
title: "Re: RiakCS poor s3 upload speeds 2MB/s"
description: ""
project: community
lastmod: 2014-11-08T07:36:05-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15131"
mailinglist_parent_id: "msg15130"
author_name: "Luke Bakken"
project_section: "mailinglistitem"
sent_date: 2014-11-08T07:36:05-08:00
---


Hi David,

Could you please provide a bit more information?

\* The version of Riak and Riak CS you are using
\* A description of the files you are uploading. What size are they and are
you using multipart uploads?

Thanks
--
Luke Bakken
Engineer / CSE
lbak...@basho.com

On Fri, Nov 7, 2014 at 6:41 AM, David Meekin 
wrote:

> Hi,
>
>
>
> I’ve setup a test 4 node RiakCS cluster on HP BL460c hardware and I can’t
> seem to get S3 upload speeds above 2MB/s
>
> I’m connecting direct to RiackCS on one of the nodes so there is no load
> balancing software in place.
>
> I have also installed s3cmd locally onto one of the nodes and the speeds
> locally are the same.
>
> These 4 nodes also run a test CEPH cluster with RadosGW and s3 uploads to
> CEPH achieve 125MB/s
>
> Any help would be appreciated as I’m currently evaluating both CEPH and
> RiakCS.
>
>
>
> Configs below:
>
>
>
> %%%RIACK – app.config
>
> %% -\*- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil -\*-
>
> %% ex: ft=erlang ts=4 sw=4 et
>
> [
>
> %% Riak Client APIs config
>
> {riak\_api, [
>
> {pb\_backlog, 256},
>
> {pb, [ {"172.19.153.180", 8087 } ]}
>
> ]},
>
>
>
> %% Riak Core config
>
> {riak\_core, [
>
>
>
> {default\_bucket\_props, [{allow\_mult, true}]},
>
>
>
> {ring\_state\_dir, "/var/lib/riak/ring"},
>
>
>
> {http, [ {"172.19.153.180", 8098 } ]},
>
> {https, [{ "172.19.153.180", 8096 }]},
>
> {ssl, [
>
> {certfile, "/etc/riak/cert.pem"},
>
> {keyfile, "/etc/riak/key.pem"}
>
> ]},
>
>
>
> {handoff\_port, 8099 },
>
>
>
> {dtrace\_support, false},
>
>
>
> {platform\_bin\_dir, "/usr/sbin"},
>
> {platform\_data\_dir, "/var/lib/riak"},
>
> {platform\_etc\_dir, "/etc/riak"},
>
> {platform\_lib\_dir, "/usr/lib64/riak/lib"},
>
> {platform\_log\_dir, "/var/log/riak"}
>
> ]},
>
>
>
> %% Riak KV config
>
> {riak\_kv, [
>
> {add\_paths, ["/usr/lib64/riak-cs/lib/riak\_cs-1.5.2/ebin"]},
>
> {storage\_backend, riak\_cs\_kv\_multi\_backend},
>
> {multi\_backend\_prefix\_list, [{<<"0b:">>, be\_blocks}]},
>
> {multi\_backend\_default, be\_default},
>
> {multi\_backend, [
>
> {be\_default, riak\_kv\_eleveldb\_backend, [
>
> {max\_open\_files, 50},
>
> {data\_root, "/var/lib/riak/leveldb"}
>
> ]},
>
> {be\_blocks, riak\_kv\_bitcask\_backend, [
>
> {data\_root, "/var/lib/riak/bitcask"}
>
> ]}
>
> ]},
>
>
>
>
>
> {anti\_entropy, {on, []}},
>
>
>
> {anti\_entropy\_build\_limit, {1, 3600000}},
>
> {anti\_entropy\_expire, 604800000},
>
>
>
> {anti\_entropy\_concurrency, 2},
>
> {anti\_entropy\_tick, 15000},
>
>
>
> {anti\_entropy\_data\_dir, "/var/lib/riak/anti\_entropy"},
>
>
>
> {anti\_entropy\_leveldb\_opts, [{write\_buffer\_size, 4194304},
>
> {max\_open\_files, 20}]},
>
>
>
> {mapred\_name, "mapred"},
>
>
>
> {mapred\_2i\_pipe, true},
>
>
>
> {map\_js\_vm\_count, 8 },
>
> {reduce\_js\_vm\_count, 6 },
>
> {hook\_js\_vm\_count, 2 },
>
>
>
> {js\_max\_vm\_mem, 8},
>
>
>
> {js\_thread\_stack, 16},
>
>
>
> {http\_url\_encoding, on},
>
>
>
> {vnode\_vclocks, true},
>
>
>
> {listkeys\_backpressure, true},
>
>
>
> {fsm\_limit, 50000},
>
>
>
> {object\_format, v1}
>
> ]},
>
>
>
> %% Riak Search Config
>
> {riak\_search, [
>
> {enabled, false}
>
> ]},
>
>
>
> %% Merge Index Config
>
> {merge\_index, [
>
> {data\_root, "/var/lib/riak/merge\_index"},
>
>
>
> {buffer\_rollover\_size, 1048576},
>
>
>
> {max\_compact\_segments, 20}
>
> ]},
>
>
>
> %% Bitcask Config
>
> {bitcask, [
>
> {io\_mode, erlang},
>
>
>
> {data\_root, "/var/lib/riak/bitcask"}
>
> ]},
>
>
>
> %% eLevelDB Config
>
> {eleveldb, [
>
> {data\_root, "/var/lib/riak/leveldb"}
>
> ]},
>
>
>
> %% Lager Config
>
> {lager, [
>
> {handlers, [
>
> {lager\_file\_backend, [
>
> {"/var/log/riak/error.log", error,
> 10485760, "$D0", 5},
>
> {"/var/log/riak/console.log", info,
> 10485760, "$D0", 5}
>
> ]}
>
> ] },
>
>
>
> {crash\_log, "/var/log/riak/crash.log"},
>
>
>
> {crash\_log\_msg\_size, 65536},
>
>
>
> {crash\_log\_size, 10485760},
>
>
>
> {crash\_log\_date, "$D0"},
>
>
>
> {crash\_log\_count, 5},
>
>
>
> {error\_logger\_redirect, true},
>
>
>
> {error\_logger\_hwm, 100}
>
> ]},
>
>
>
> %% riak\_sysmon config
>
> {riak\_sysmon, [
>
> {process\_limit, 30},
>
> {port\_limit, 2},
>
>
>
> {gc\_ms\_limit, 0},
>
> {heap\_word\_limit, 40111000},
>
>
>
> {busy\_port, true},
>
> {busy\_dist\_port, true}
>
> ]},
>
>
>
> %% SASL config
>
> {sasl, [
>
> {sasl\_error\_logger, false}
>
> ]},
>
>
>
> %% riak\_control config
>
> {riak\_control, [
>
> {enabled, true},
>
>
>
> {auth, userlist},
>
>
>
> {userlist, [{"admin", "password"}
>
> ]},
>
>
>
> {admin, true}
>
> ]}
>
> ].
>
>
>
>
>
> %%%RiakCS – app.config
>
> %% -\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\*-
>
> %% ex: ts=4 sw=4 et
>
> [
>
> %% Riak CS configuration
>
> {riak\_cs, [
>
> %% == Basic Configuration ==
>
>
>
> %% Riak CS http/https port and IP address to listen at
>
> %% for object storage activity
>
> {cs\_ip, "172.19.153.180"},
>
> {cs\_port, 8080 } ,
>
> {riak\_ip, "172.19.153.180"},
>
> {riak\_pb\_port, 8087 } ,
>
> {stanchion\_ip, "172.19.153.180"},
>
> {stanchion\_port, 8085 },
>
> {stanchion\_ssl, false },
>
> {anonymous\_user\_creation, true},
>
> {admin\_key, "\_UJJOXXQEXW3XAWUGSQD"},
>
> {admin\_secret, "8bkzcxZDIKsmjJUhEEJkpcM6g5\_X7gSazryBGA=="},
>
>
>
> {cs\_root\_host, "s3.amazonaws.com"},
>
> {connection\_pools,
>
> [
>
> {request\_pool, {128, 0} },
>
> {bucket\_list\_pool, {5, 0} }
>
> ]},
>
> {rewrite\_module, riak\_cs\_s3\_rewrite },
>
> {auth\_module, riak\_cs\_s3\_auth },
>
> {fold\_objects\_for\_list\_keys, true},
>
>
>
> {n\_val\_1\_get\_requests, true},
>
> {cs\_version, 10300 },
>
> {access\_log\_flush\_factor, 1},
>
> {access\_log\_flush\_size, 1000000},
>
> {access\_archive\_period, 3600},
>
> {access\_archiver\_max\_backlog, 2},
>
> {storage\_schedule, []},
>
> {storage\_archive\_period, 86400},
>
> {usage\_request\_limit, 744},
>
> {leeway\_seconds, 86400},
>
> {gc\_interval, 900},
>
> {gc\_retry\_interval, 21600},
>
> {gc\_paginated\_indexes, true},
>
>
>
> {trust\_x\_forwarded\_for, false},
>
> {dtrace\_support, false}
>
>
>
> ]},
>
>
>
> {webmachine, [
>
> {server\_name, "Riak CS"},
>
>
>
> {log\_handlers, [
>
> {webmachine\_log\_handler,
> ["/var/log/riak-cs"]},
>
> {riak\_cs\_access\_log\_handler, []}
>
> ]}
>
> ]},
>
>
>
> {lager, [
>
> {handlers, [
>
> {lager\_console\_backend, info},
>
> {lager\_file\_backend, [{file,
> "/var/log/riak-cs/error.log"},
>
> {level, error},
>
> {size, 10485760},
>
> {date, "$D0"},
>
> {count, 5}]},
>
> {lager\_file\_backend, [{file,
> "/var/log/riak-cs/console.log"},
>
> {level, info},
>
> {size, 10485760},
>
> {date, "$D0"},
>
> {count, 5}]}
>
> ]},
>
> {crash\_log, "/var/log/riak-cs/crash.log"},
>
> {crash\_log\_msg\_size, 65536},
>
>
>
> {crash\_log\_size, 10485760},
>
>
>
> {crash\_log\_date, "$D0"},
>
>
>
> {crash\_log\_count, 5},
>
>
>
> {error\_logger\_redirect, true}
>
> ]},
>
>
>
> {sasl, [
>
> {sasl\_error\_logger, false}
>
> ]}
>
> ].
>
>
>
> Thanks,
>
>
>
> Dave
>
> Tel: +441616699154 Mob: +44 7525 405543
>
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>
> This e-mail is sent on behalf of Auto Trader Group Limited, Registered
> Office: Auto Trader House, Cutbush Park Industrial Estate, Danehill, Lower
> Earley, Reading, Berkshire, RG6 4UT (Registered in England No. 4768833).
> This email and any files transmitted with it are confidential and may be
> legally privileged, and intended solely for the use of the individual or
> entity to whom they are addressed. If you have received this email in error
> please notify the sender. This email message has been swept for the
> presence of computer viruses.
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

