---
title: "Re: What is this...?"
description: ""
project: community
lastmod: 2012-01-21T19:24:32-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06360"
mailinglist_parent_id: "msg06359"
author_name: "Zheng Zhibin"
project_section: "mailinglistitem"
sent_date: 2012-01-21T19:24:32-08:00
---


I think this basically due to different definition of Protocol Buffers between 
Riak and Riak Erlang Client.

Updated them into the same version, and make clean & make, this should help.

Zheng Zhibin

在 2012-1-22，上午11:18， Zheng Zhibin 写道：

> saw the code in "deps/riak\_core/src/riak\_core\_handoff\_receiver.erl"
> 
> process\_message(?PT\_MSG\_INIT, MsgData, State=#state{vnode\_mod=VNodeMod}) ->
> <> = MsgData,
> lager:info("Receiving handoff data for partition ~p:~p", [VNodeMod, 
> Partition]),
> {ok, VNode} = riak\_core\_vnode\_master:get\_vnode\_pid(Partition, VNodeMod),
> State#state{partition=Partition, vnode=VNode};
> process\_message(?PT\_MSG\_OBJ, MsgData, State=#state{vnode=VNode, count=Count}) 
> ->
> Msg = {handoff\_data, MsgData},
> case gen\_fsm:sync\_send\_all\_state\_event(VNode, Msg, 60000) of
> ok ->
> State#state{count=Count+1};
> E={error, \_} ->
> exit(E)
> end;
> process\_message(?PT\_MSG\_OLDSYNC, MsgData, State=#state{sock=Socket,
> tcp\_mod=TcpMod}) ->
> TcpMod:send(Socket, <PT\_MSG\_OLDSYNC:8,"sync">),
> <> = MsgData,
> VNodeMod = binary\_to\_atom(VNodeModBin, utf8),
> State#state{vnode\_mod=VNodeMod};
> process\_message(?PT\_MSG\_SYNC, \_MsgData, State=#state{sock=Socket,
> tcp\_mod=TcpMod}) ->
> TcpMod:send(Socket, <PT\_MSG\_SYNC:8, "sync">),
> State;
> process\_message(?PT\_MSG\_CONFIGURE, MsgData, State) ->
> ConfProps = binary\_to\_term(MsgData),
> State#state{vnode\_mod=proplists:get\_value(vnode\_mod, ConfProps),
> partition=proplists:get\_value(partition, ConfProps)};
> process\_message(\_, \_MsgData, State=#state{sock=Socket,
> tcp\_mod=TcpMod}) ->
> TcpMod:send(Socket, <<255:8,"unknown\_msg">>),
> State.
> 
> Your request message sent from riak-erlang-client has been droped to the last 
> one of matching.
> 
> 
> Zheng Zhibin
> 
> 在 2012-1-22，上午12:43， Mike Oxford 写道：
> 
>> 3 node cluster of 1.0.2, level\_db backend, pb interface. Build up a
>> store of 9 connections (3 to each node) and pull one out randomly.
>> 
>> --snip
>> 62> 
>> riakc\_pb\_socket:list\_keys(gen\_server:call(forum\_store:get\_random\_pid(alliance),
>> get\_connector\_pid), <<"alliance\_overview">>
>> {ok,[]}
>> 
>> 63> 
>> riakc\_pb\_socket:list\_keys(gen\_server:call(forum\_store:get\_random\_pid(alliance),
>> get\_connector\_pid), <<"alliance\_overview">>).
>> {ok,[]}
>> 
>> 64> 
>> riakc\_pb\_socket:list\_keys(gen\_server:call(forum\_store:get\_random\_pid(alliance),
>> get\_connector\_pid), "alliance\_overview").
>> {ok,[]}
>> 
>> 65> 
>> riakc\_pb\_socket:list\_keys(gen\_server:call(forum\_store:get\_random\_pid(alliance),
>> get\_connector\_pid), "alliance\_overview").
>> =ERROR REPORT==== 21-Jan-2012::08:23:11 ===
>> \*\* Generic server <0.24647.5> terminating
>> \*\* Last message in was {tcp,#Port<0.5820>,[255|<<"unknown\_msg">>]}
>> \*\* When Server state == {state,"127.0.0.1",2010,false,false,#Port<0.5820>,
>> {request,#Ref<0.0.4.159143>,
>> {rpblistkeysreq,"alliance\_overview"},
>> undefined,
>> {106931976,<0.25063.5>},
>> 60000,#Ref<0.0.4.159144>},
>> {[],[]},
>> 1,[],infinity,100}
>> \*\* Reason for termination ==
>> \*\* {function\_clause,[{riakclient\_pb,decode,[undefined,<<"unknown\_msg">>]},
>> {riakc\_pb\_socket,handle\_info,2},
>> {gen\_server,handle\_msg,5},
>> {proc\_lib,init\_p\_do\_apply,3}]}
>> {error,{timeout,[]}}
>> 
>> 66> 
>> riakc\_pb\_socket:list\_keys(gen\_server:call(forum\_store:get\_random\_pid(alliance),
>> get\_connector\_pid), "alliance\_overview").
>> {ok,[]}
>> --end snip
>> 
>> Riak console spits out the following at the same time...
>> 
>> --snip
>> nodes().08:23:11.154 [info] Handoff receiver for partition undefined
>> exited after processing 0 objects
>> --end snip
>> 
>> Error condition does not seem to follow any specific node and the
>> connections die when the error is thrown so its constantly building
>> new ones.
>> 
>> TIA.
>> 
>> -mox
>> 
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

