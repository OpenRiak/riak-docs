---
title: "MR Output Changes"
description: ""
project: community
lastmod: 2011-09-24T13:40:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04853"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-09-24T13:40:00-07:00
---


While building out functionality in CorrugatedIron to coincide with the Riak 
1.0.0 release, I've run into something a bit odd.

MapReduce phases with a keep set to true are returning in multiple 
RpbMapRedResp messages. I expected this, especially since hte API says it's 
possible. What's causing the issue is the output format.

When I MR via the HTTP API, I get results like this:

[["riak\_index\_tests","5"],["riak\_index\_tests","6"],["riak\_index\_tests","7"],["riak\_index\_tests","4"],["riak\_index\_tests","8"],["riak\_index\_tests","3"],["riak\_index\_tests","2"],["riak\_index\_tests","0"],["riak\_index\_tests","1"],["riak\_index\_tests","9"]]

When I execute the same MR through the PB API I get results that look like this:

[["riak\_index\_tests","1"]][["riak\_index\_tests","6"]][["riak\_index\_tests","0"]][["riak\_index\_tests","7"]][["riak\_index\_tests","8"]][["riak\_index\_tests","4"]][["riak\_index\_tests","9"]][["riak\_index\_tests","2"]][["riak\_index\_tests","3"]][["riak\_index\_tests","5"]]

The MR query itself, just to make sure I haven't done something wrong, is this:

curl -H "Content-Type: application/json" $RIAK/mapred -d @- 
{"inputs":{"bucket":"riak\_index\_tests","index":"age\_int","key":32},"query":[{"reduce":{"language":"erlang","module":"riak\_kv\_mapreduce","function":"reduce\_identity","keep":true}}]}

and this:

{"inputs":{"bucket":"riak\_index\_tests","index":"age\_int","key":32},"query":[{"reduce":{"language":"erlang","module":"riak\_kv\_mapreduce","function":"reduce\_identity","keep":true}}]}

Is there a reason that Riak is returning discrete JSON chunks instead of 
streaming back raw bytes to the client? Is there less documented change in Riak 
1.0 that will prevent this type of behavior (which incidentally didn't crop up 
until the 1.0 pre-release builds).
---
Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
Microsoft SQL Server MVP


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

