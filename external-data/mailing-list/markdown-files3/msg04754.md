---
title: "Problems Executing Erlang Map Reduce"
description: ""
project: community
lastmod: 2011-09-15T11:32:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04754"
author_name: "bill robertson"
project_section: "mailinglistitem"
sent_date: 2011-09-15T11:32:22-07:00
---


I have a 0.14.2 dev database set up from the riak fast track tutorial.

I created an Erlang application that creates a new route for webmachine upon
startup.

configure\_webmachine() ->
 webmachine\_router:add\_route(
 {["foo", bar, '\*'], myapp\_myresource, []}).

I modified vm.args for all three instances to point to the application by
adding the following lines.

-pa /home/me/my\_app/ebin
-s my\_app

I am able to reach the /foo URL from all three instances of Riak
(localhost:8091-93). So I assume that every instance also has access to my
map-reduce code too.

Also included in the application is a module with a test map-reduce query in
it. I have a binary encoded Erlang term stored in the database, and I am
down to simply trying to just retrieve the one entry and return 'something'
from a map function. (i.e. I've been cutting things out until there is
nothing left to cut out), and I am receiving errors.

Here is the mapred code.

 Conn = riakc\_pb\_socket:start("127.0.0.1", 8091),
 A = fun(Value, Key, Arg) -> args(Value, Key, Arg) end,
 Result = riakc\_pb\_socket:mapred(Conn, [{<<"bucket">>, <<"key">>}],
 [{map, {qfun, A}, none, true}]),

args(\_Value, \_Key, \_Arg) ->
 [args].

This code bombs, and then I get the following back from webmachine in the
browsers (binary goo elided).

Internal Server Error
The server encountered an error while processing this request:

{error,
 {exit,
 {{function\_clause,
 [{gen,call,
 [{ok,<0.268.0>},
 '$gen\_call',
 {req,
 {rpbmapredreq,
 <<131,108, ...,106>>,
 <<"application/x-erlang-binary">>},
 60100,
 {1061003,<0.252.0>}},
 60000]},
 {gen\_server,call,3},
 {riakc\_pb\_socket,mapred,5},
 {myapp\_mapred,do\_mapred,6},
 {myapp\_myresource,to\_html,2},
 {webmachine\_resource,resource\_call,3},
 {webmachine\_resource,do,3},
 {webmachine\_decision\_core,resource\_call,1}]},
 {gen\_server,call,
 [{ok,<0.268.0>},
 {req,
 {rpbmapredreq,
 <<131,108, ...,106>>,
 <<"application/x-erlang-binary">>},
 60100,
 {1061003,<0.252.0>}},
 60000]}},
 [{gen\_server,call,3},
 {riakc\_pb\_socket,mapred,5},
 {myapp\_mapred,do\_mapred,6},
 {myapp\_myresource,to\_html,2},
 {webmachine\_resource,resource\_call,3},
 {webmachine\_resource,do,3},
 {webmachine\_decision\_core,resource\_call,1},
 {webmachine\_decision\_core,decision,1}]}}

sasl-error.log and erlang.log has the same error information as from the
browser on the node that I made the request to. I checked the logs of one of
the other nodes and found nothing.

I must be doing something wrong, but I have no idea what.

Any suggestions as to what to do?
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

