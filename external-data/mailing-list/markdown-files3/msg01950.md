---
title: "Re: Riak Search: deleting a value without indexing causes a 500 error"
description: ""
project: community
lastmod: 2011-01-11T05:30:35-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01950"
mailinglist_parent_id: "msg01932"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2011-01-11T05:30:35-08:00
---


Hi Eric,

The system expects that someone will run "search-cmd install BUCKET" before
storing data in the bucket. When that happens, deletes work fine. This
problem only seems to appear when somebody stores data in a bucket, \*then\*
sets the indexing flag, and \*then\* tries to delete some of the non-indexed
data.

This could be handled better by the system, though, and others have run into
this same problem, so I've filed a bug. Tracking here:
https://issues.basho.com/show\_bug.cgi?id=970

Thanks for your email, and thanks for the detailed error message.

Best,
Rusty

On Sun, Jan 9, 2011 at 2:49 PM, Eric Moritz wrote:

> It appears that if I try to delete a key before it has been indexed,
> an error occurs.
>
> If I do the following, a 500 occurs:
>
> (x)e...@eric-1000he:~/Projects/x/src/search\_test$ . resty
> http://localhost:8098\*
> (x)e...@eric-1000he:~/Projects/x/src/search\_test$ PUT /riak/uhoh/foo
> '{"test": "testing"}'
> (x)e...@eric-1000he:~/Projects/x/src/search\_test$ GET /riak/uhoh/foo
> {"test": "testing"}
> (x)e...@eric-1000he:~/Projects/x/src/search\_test$ search-cmd install uhoh
> Attempting to restart script through sudo -u riak
>
> :: Installing Riak Search <--> KV hook on bucket 'uhoh'.
> (x)e...@eric-1000he:~/Projects/x/src/search\_test$ DELETE /riak/uhoh/foo
> 500 Internal Server
> ErrorInternal Server Error
=====================

The server
> encountered an error while processing this
> request:  

```
{error,badarg,
>       [{erlang,iolist_to_binary,[notfound]},
>        {wrq,append_to_response_body,2},
>        {riak_kv_wm_raw,delete_resource,2},
>        {webmachine_resource,resource_call,3},
>        {webmachine_resource,do,3},
>        {webmachine_decision_core,resource_call,1},
>        {webmachine_decision_core,decision,1},
>
>  
> {webmachine_decision_core,handle_request,2}]}
```


---

mochiweb+webmachine
> web server


>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

