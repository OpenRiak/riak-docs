---
title: "Re: Logical operators in Ripple"
description: ""
project: community
lastmod: 2011-06-05T21:28:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03566"
mailinglist_parent_id: "msg03564"
author_name: "Ryan Caught"
project_section: "mailinglistitem"
sent_date: 2011-06-05T21:28:10-07:00
---


Not according to the docs. http://wiki.basho.com/Key-Filters.html

On Sun, Jun 5, 2011 at 8:48 PM, Jeremiah Peschka  wrote:

> Shouldn't that last ends\_with only be a single nested array, not a doubly
> nested array?
>
> ---
> Jeremiah Peschka
> Founder, Brent Ozar PLF
>
> On Sunday, June 5, 2011 at 8:40 PM, Ryan Caught wrote:
>
> Yeah, I did look at the spec. The first two results work fine, it's only
> the "and" based key filter that throws the error.
>
> On Sun, Jun 5, 2011 at 8:30 PM, Jeremiah Peschka <
> jeremiah.pesc...@gmail.com> wrote:
>
> When in doubt, I always look at the spec. In this case:
> https://github.com/seancribbs/ripple/blob/master/riak-client/spec/riak/map\_reduce/filter\_builder\_spec.rb
>
> So you'll want to do something roughly like:
>
> filter { Riak::MapReduce::FilterBuilder.new }
> filter.tokenize "-", "1" do
> eq "test"
> end
>
> There's a really good chance that's wrong since I'm only looking at some
> Ruby in an editor and not testing against a running Riak cluster right now.
> Hopefully that sets you on the right track or else angries up someone who
> will correct me.
>
> ---
> Jeremiah Peschka
> Founder, Brent Ozar PLF
>
> On Sunday, June 5, 2011 at 7:46 PM, Ryan Caught wrote:
>
> Hi,
> I'm having a problem with Ripple and logical operator key filters. Has
> anyone managed to get "and" or "or" key filter combinations working?
>
> When I run the following:
>
> require 'ripple'
>
> client = Riak::Client.new
> bucket = client.bucket("test\_bucket")
>
> one = Riak::RObject.new(bucket, "test-123")
> one.content\_type = "application/json"
> one.data = '{"name": "test-123"}'
> one.store
>
> two = Riak::RObject.new(bucket, "test-456")
> two.content\_type = "application/json"
> two.data = '{"name": "test-456"}'
> two.store
>
>
> results\_1 = Riak::MapReduce.new(client).
> add("visitors", [["tokenize", "-", 1], ["eq", "test"]]).
> map("Riak.mapValuesJson", :keep => true).run
> # Works as expected
> p results\_1
>
> results\_2 = Riak::MapReduce.new(client).
> add("visitors", [["ends\_with", "123"]]).
> map("Riak.mapValuesJson", :keep => true).run
> # Works as expected
> p results\_2
>
> results\_3 = Riak::MapReduce.new(client).
> add("test\_bucket", ["and", [["tokenize", "-", 1], ["eq",
> "test"]],
> [["ends\_with", "123"]]
> ]).
> map("Riak.mapValuesJson", :keep => true).run
> # Error
> p results\_3
>
>
>
>
> This is what the error report says:
>
> =ERROR REPORT==== 5-Jun-2011::19:42:34 ===
> webmachine error: path="/mapred"
> {error,{error,function\_clause,
> [{riak\_client,build\_exprs,
> [[<<"and">>,
> [[<<"tokenize">>,<<"-">>,1],
> [<<"eq">>,<<"test">>]],
> [[<<"ends\_with">>,<<"123">>]]],
> [],
> {riak\_client,'riak@127.0.0.1
> ',<<6,82,5,153>>}]},
> {riak\_client,build\_filter,2},
> {riak\_client,stream\_list\_keys,6},
> {riak\_client,mapred\_bucket\_stream,7},
> {riak\_client,mapred\_bucket,6},
> {riak\_kv\_wm\_mapred,process\_post,2},
> {webmachine\_resource,resource\_call,3},
> {webmachine\_resource,do,3}]}}
>
>
> Any ideas?
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

