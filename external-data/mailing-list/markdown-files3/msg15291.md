---
title: "Re: Yokozuna - inconsistent number of documents found for the same	query"
description: ""
project: community
lastmod: 2014-12-01T22:51:03-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15291"
mailinglist_parent_id: "msg15287"
author_name: "Oleksiy Krivoshey"
project_section: "mailinglistitem"
sent_date: 2014-12-01T22:51:03-08:00
---


Hi Ryan,

There are no errors, 'search aae-status' shows that all trees have already
been created and synced.

When I first noticed this issue I was running a dev setup (single node) and
had about 500 keys in total. I waited over 7 days and still was
experiencing this issue. During these 7 days the AAE continued to repair
keys according to logs, but 'search aae-status' was showing that all trees
were already synced (and re-synced).

I then created a test Riak setup (again single node) with just 20 keys. I
replicated the problem, waited for 'aae-status' to show all synced trees
(about 2 days) and wrote about the problem here. During these tests I
\_sometimes\_ received full set of documents as stated in my original email -
for me that was an indication that all keys have already been repaired.

Now, 6 days after that I can no longer replicate it - I always get full set
of documents.The last message from AAE key\_exchange was logged yesterday (5
days after test setup was created).

So it seems that for 20 keys it finally started working after 5-6 days.


On 2 December 2014 at 06:57, Ryan Zezeski  wrote:

>
> Eric Redmond writes:
>
> > This is a known issue, and we're still working on a fix.
> >
> > https://github.com/basho/yokozuna/issues/426
> >
>
> I don't see how this issue is related to Oleksiy's problem. There is no
> mention of removing or adding nodes. I think the key part of Oleksiy's
> report is the association of an index \_after\_ data had already been
> written. That data is sometimes missing. These two issues could be
> related but I don't see anything in that GitHub report to indicate why.
>
> >
> > On Nov 29, 2014, at 9:26 AM, Oleksiy Krivoshey 
> wrote:
> >>>
> >> 1. Create a bucket, insert some keys (10 keys - KeysA)
> >> 2. Create Yokozuna Index, associate it with the bucket
> >> 3. Add or update some new keys in the bucket (10 keys - KeysB)
> >> 4. Wait for Search AAE to build and exchange the trees
> >>
> >> Now when I issue a search query I will always get all 10 KeysB but a
> random amount of KeysA, for example the same query repeated 5 times may
> return:
> >>
> >> 10 KeysB + 2 KeysA
> >> 10 KeysB + 0 KeysA
> >> 10 KeysB + 7 KeysA
> >> 10 KeysB + 1 KeysA
> >> 10 KeysB + 10 KeysA
> >>
>
> Are there any errors in the logs? Does the count go up if you wait
> longer? What does `riak-admin search aae-status` show?
>
> -Z
>



-- 
Oleksiy Krivoshey
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

