---
title: "Map reduce weirdness on Riak 1.3"
description: ""
project: community
lastmod: 2013-04-06T11:12:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10731"
author_name: "Kartik Thakore"
project_section: "mailinglistitem"
sent_date: 2013-04-06T11:12:45-07:00
---


Hello,

I recently setup a test cluster to try to do a tech demo web application on.

I have been having some weirdness with the map reduce functionality.

My database is here:

http://aimed.cc:8098/riak/rekon/go#/buckets/test\_rand\_docs

The cluster has 5 nodes
ulimit 4096

This is Riak 1.3.0 release on Debian with 663 of free memory.

I am running this map reduce:

curl -X POST -H "content-type: application/json" \
 http://aimed.cc:8098/mapred --data @-<<\EOF
{"inputs": "test\_rand\_docs",
"query":[{"map":{"language":"javascript","source":"
 function (v) {
 var r = {};
 var data = JSON.parse(v.values[0].data);
 r.data = data;
 r.key = v.key;
 return [ r ];
 }
"}},{"reduce":{"language":"javascript","source":"
 function (v) {
 var r = {};
 for( var i in v )
 {
 var doc = v[i];
 if( doc['data'] !== undefined) {
 var age = doc['data']['age\_int'];
 if ( age !== undefined && age > 10 && age <25 ){
 r[doc['key']] = doc['data'];
 }
 }
 }
 return [ r ];

 }
"}}]


my result is randomly:

[{"9DYMGV0B6Jdn5DivoTExiqyDYUC":{"age\_int":24},"JQYUs2onC822EOzMaToz71j77e":{"age\_int":18},"AcrUwotAdYaV5zitaMylnUgYsWY":{"age\_int":24}}]


or

[{"LYJpg97ZA5qjZTTv2cfavmRgxLb":{"age\_int":11}}]

but it is clear with this:

http://aimed.cc:8098/solr/test\_rand\_docs/select?q=age\_int:[10%20TO%2025]


that there are 134 records ....

so what is going on?


Is it low memory? Or that it is on a XEN machine (Linode)? Is there a
scaleable memory server vendor (AWS or w/e) I should consider?

Thanks,
Kartik Thakore
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

