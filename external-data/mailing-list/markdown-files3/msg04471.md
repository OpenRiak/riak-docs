---
title: "Re: odd error on mapreduce"
description: ""
project: community
lastmod: 2011-08-26T03:33:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04471"
mailinglist_parent_id: "msg04456"
author_name: "Giancarlo Frison"
project_section: "mailinglistitem"
sent_date: 2011-08-26T03:33:12-07:00
---


If i serialize the body as Json I catch errors any more instead of protobuf
object representation (application/octet-stream).
Would be an mapreduce bug?

Is it possibile to skirt any body parsing during the mapreduce? Just for
evaluating headers values?

Thanks,

Giancarlo Frison



On Thu, Aug 25, 2011 at 3:48 PM, Giancarlo Frison wrote:

> Hi all,
>
> I'm performing a mapreduce call for retrieving objects with a peculiar tag
> link:
>
> {"inputs": "minos","query": [{"map": {"language": "javascript","source":
> "function(v){ if(v.values[0].metadata.Links!=null &&
> v.values[0].metadata.Links[0][0]==\"eclass-com\_chelab\_core\_minos\"
> &&v.values[0].metadata.Links[0][1]==\"State\"
> &&v.values[0].metadata.Links[0][2]==\"iof\") {return [v.key]; } else return
> [];}"}}]}
>
> I have an object stored in binary format(protobuf) that the body is (json
> format):
>
> {
> "name": "2login",
> "type": "start",
> "transitions": [
> {
> "name": "logon",
> "nextState": "logged",
> "guard": "request.user!=null && request.password!=null",
> "activity": {
> "name": "call-login",
> "serviceName": "http://apigeoname",
> "condition": "this.password==request.password"
> }
> }
> ]
> }
>
> and the mapreduce works fine.
>
> IF I change JUST 'serviceName' element to 'http://apigeonames' adding the
> last char 's' I encounter and error in the mapreduce above.
> the error log is:
>
>
>
> Error JSON encoding arguments: [{struct,
> [{<<"bucket">>,<<"minos">>},
> {<<"key">>,<<"2login">>},
> {<<"vclock">>,
>
> <<"a85hYGBgzGDKBVIsLNdPbMpgSmTMY2XYIXvmOF8WAA==">>},
> {<<"values">>,
> [{struct,
> [{<<"metadata">>,
> {struct,
> [{<<"Links">>,
>
> [[<<"eclass-com\_chelab\_core\_minos">>,
> <<"State">>,<<"iof">>]]},
> {<<"X-Riak-VTag">>,
> <<"1uFeJm9wytHzl66Pxjsunx">>},
> {<<"content-type">>,
> <<"application/octet-stream">>},
> {<<"X-Riak-Last-Modified">>,
> <<"Fri, 26 Aug 2011 13:38:00
> GMT">>}]}},
> {<<"data">>,
> <<26,128,1,10,5,108,111,103,111,
> 110,18,6,108,111,103,103,101,
> 100,26,44,114,101,113,117,101,
> 115,116,46,117,115,101,114,33,
> 61,110,117,108,108,32,38,38,32,
> 114,101,113,117,101,115,116,46,
> 112,97,115,115,119,111,114,100,
> 33,61,110,117,108,108,34,65,18,
> 18,104,116,116,112,58,47,47,97,
> 112,105,103,101,111,110,97,109,
> 101,115,34,10,99,97,108,108,45,
> 108,111,103,105,110,42,31,116,
> 104,105,115,46,112,97,115,115,
> 119,111,114,100,61,61,114,101,
> 113,117,101,115,116,46,112,97,
> 115,115,119,111,114,100,42,6,
>
> 50,108,111,103,105,110,64,6>>}]}]}]},
> undefined,none]
>
> {error,
> {no\_candidate\_nodes,exhausted\_preflist,
> [{riak\_kv\_mapred\_planner,claim\_keys,3},
> {riak\_kv\_map\_phase,handle\_info,2},
> {luke\_phase,handle\_info,3},
> {gen\_fsm,handle\_msg,7},
> {proc\_lib,init\_p\_do\_apply,3}],
> [{{5680,'riak@127.0.0.1'},
> [{pid,<0.12932.0>},
> {keys,
> {{730750818665451459101842416358141509827966271488,
> 'riak@127.0.0.1'},
> [{riak\_kv\_map\_input,
> {<<"minos">>,<<"2login">>},
> [{name,<<"minos">>},
> {n\_val,3},
> {allow\_mult,false},
> {last\_write\_wins,false},
> {precommit,[]},
> {postcommit,[]},
> {chash\_keyfun,{riak\_core\_util,chash\_std\_keyfun}},
> {linkfun,
>
> {modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}},
> {old\_vclock,86400},
> {young\_vclock,20},
> {big\_vclock,50},
> {small\_vclock,10},
> {r,quorum},
> {w,quorum},
> {dw,quorum},
> {rw,quorum}],
> undefined,
> [{730750818665451459101842416358141509827966271488,
> 'riak@127.0.0.1'}]}]}}]},
> {<0.12932.0>,{5680,'riak@127.0.0.1'}}]}}
>
>
> have you any idea about this problem?
>
> Thanks,
>
>
> Giancarlo Frison
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

