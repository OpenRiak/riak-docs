---
title: "Re: Python Client Thread Safe?"
description: ""
project: community
lastmod: 2012-02-27T10:47:18-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06756"
mailinglist_parent_id: "msg06751"
author_name: "Armon Dadgar"
project_section: "mailinglistitem"
sent_date: 2012-02-27T10:47:18-08:00
---


Hey Jim,

The PBC client does not share any state between clients,
but it is not safe to use a single client with multiple threads,
since the underlying socket will be shared.

If you have multiple threads, just make sure to use multiple
clients.

Best Regards,

Armon Dadgar

> 
> Message: 1
> Date: Sun, 26 Feb 2012 19:39:38 +0000
> From: Jim Adler 
> To: "riak-users@lists.basho.com" 
> Subject: Python Client Thread Safe?
> Message-ID: 
> Content-Type: text/plain; charset="us-ascii"
> 
> I'm getting the following error while using protocol buffers
> (RiakPbcTransport) with more than one thread (stack trace below):
> 
> Socket returned short packet length 0 - expected 4'
> 
> I'm using the 1.3.0 Python client on Mac and Ubuntu 11.04 and have seen
> the same error on both OS's. A single-thread works fine as does the
> RiakHttpTransport.
> 
> Anyone have this problem?
> 
> Thanks,
> Jim
> 
> File 
> "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
> b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/bucket.py", line 260,
> in get
> return obj.reload(r)
> File 
> "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
> b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/riak\_object.py", line
> 373, in reload
> Result = t.get(self, r, vtag)
> File 
> "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
> b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
> line 195, in get
> msg\_code, resp = self.send\_msg(MSG\_CODE\_GET\_REQ, req, None)
> File 
> "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
> b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
> line 387, in send\_msg
> return self.recv\_msg(conn, expect)
> File 
> "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
> b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
> line 413, in recv\_msg
> self.recv\_pkt(conn)
> File 
> "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
> b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
> line 460, in recv\_pkt
> len(nmsglen))
> RiakError: 'Socket returned short packet length 0 - expected 4'
> 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

