---
title: "Re: No results provided by Riak search, another !"
description: ""
project: community
lastmod: 2011-07-05T09:27:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03930"
mailinglist_parent_id: "msg03928"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-07-05T09:27:45-07:00
---


Hi Germain,

It looks like your document has nested fields which means the schema you
have defined won't match the fields produced by the pre-commit hook. The
pre-commit hook flattens JSON documents using an underscore ("\_") between
nested fields (e.g. fans\_\*\*data\_nsid); your schema should be using the
flattened field name.

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Tue, Jul 5, 2011 at 7:05 AM, Germain Maurice <
germain.maur...@linkfluence.net> wrote:

> Hello everybody,
>
> I have a problem with Riak Search. I tried to find the solution by my own,
> i tried all the solutions i found and no results.
>
> Firstly, i tried to use it with the default schema, it works but it indexes
> too much data.
> So, i set my own schema as this :
> {
> schema,
> [
> {version, "1.1"},
> {n\_val, 1},
> {default\_field, "nsid"},
> {analyzer\_factory, {erlang, text\_analyzers,
> standard\_analyzer\_factory}}
> ],
> [
> {field, [
> {name, "favedate"},
> {type, string},
> {analyzer\_factory, {erlang, text\_analyzers,
> standard\_analyzer\_factory}}
> ]},
>
> {field, [
> {name, "date\_faved"},
> {type, string},
> {analyzer\_factory, {erlang, text\_analyzers,
> standard\_analyzer\_factory}}
> ]},
>
> %% Everything else is skipped
> {dynamic\_field, [
> {name, "\*"},
> {skip, true}
> ]}
> ]
> }.
>
> Hook on precommit of my buckets are ok.
> I set the schema for each of my buckets as this : "search-cmd set-schema
> photostest My.schema"
> Did a "search-cmd clear-schema-cache" command.
>
> I re-indexed all of my documents of the bucket however, these documents are
> not indexed.
> An example :
>
> { "fans":{
> "data":[{"nsid":"83786678@N00"\*\*,
> "favedate":"1309539453"}
> ,{"nsid":"33233619@N02",
> "favedate":"1309539169"}]
> , ...
> Here is the answer of the index :
> {"responseHeader":{"status":0,\*\*"QTime":2,"params":{"q":"fans\_\*\*
> data\_nsid:83786678@N00","q.op"\*\*:"or","filter":"","wt":"
> json"}},"response":{"numFound"\*\*:0,"start":0,"maxScore":"0.0",\*\*
> "docs":[]}}
>
>
> thank you !
>
> --
> Germain Maurice
> Administrateur Système/Réseau
> Tel : +33.(0)1.42.43.54.33
>
> http://www.linkfluence.net
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

