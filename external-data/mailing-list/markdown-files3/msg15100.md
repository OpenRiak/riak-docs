---
title: "Re: Running MapReduce when deleting record is causing	bad_utf8_character_code error"
description: ""
project: community
lastmod: 2014-10-30T03:49:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15100"
mailinglist_parent_id: "msg15091"
author_name: "Naveen Tamanam"
project_section: "mailinglistitem"
sent_date: 2014-10-30T03:49:14-07:00
---


HI Luke,

My problem got solved.
Joe Caswell  helped me that,

A Riak tombstone is an ordinary Riak object with a 0-length value (<<>>)
and X-Riak-Deleted set to true in the metadata. The docs (
http://docs.basho.com/riak/latest/dev/advanced/mapreduce/) suggest checking
for X-Riak-Deleted:true in the object metadata. At the start of your map
phase function, check if the object passed in is a tombstone, and return []
instead of processing it.





On Wed, Oct 29, 2014 at 11:36 PM, Luke Bakken  wrote:

> Hi Naveen,
>
> What is your map reduce query?
> --
> Luke Bakken
> Engineer / CSE
> lbak...@basho.com
>
>
> On Mon, Oct 20, 2014 at 11:59 AM, Naveen Tamanam
>  wrote:
> > Hi,
> >
> > Running map-reduce when deleting the record causing the
> > bad\_utf8\_character\_code
> > error. I mean doing both things simultaneously causing the error
> >
> > Here is the traceback
> >
> > Error running MapReduce operation. Headers: {'content-length': '1312',
> > 'server': 'MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)',
> > 'connection': 'close', 'date': 'Mon, 20 Oct 2014 18:23:08 GMT',
> > 'content-type': 'text/html', 'http\_code': 500} Body:
> '500
> > Internal Server ErrorInternal Server
> Error
=======================

The
> > server encountered an error while processing this
> > request:  

```
{error,{exit,{ucs,{bad_utf8_character_code}},\n
> >  [{xmerl_ucs,from_utf8,1,[{file,"xmerl_ucs.erl"},{line,185}]},
> >  {mochijson2,json_encode_string,2,
> >  [{file,"src/mochijson2.erl"},{line,186}]},
> >    {mochijson2,\'-json_encode_proplist/2-fun-0-\',3,
> >  [{file,"src/mochijson2.erl"},{line,167}]},
> >    {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
> >  {mochijson2,json_encode_proplist,2,
> >   [{file,"src/mochijson2.erl"},{line,170}]},
> >  {riak_kv_wm_mapred,send_error,2,
> >    [{file,"src/riak_kv_wm_mapred.erl"},\n
> > {line,70}]},\n
> {riak_kv_wm_mapred,pipe_mapred_nonchunked,3,\n
> > [{file,"src/riak_kv_wm_mapred.erl"},\n
> > {line,214}]},\n              {webmachine_resource,resource_call,3,\n
> > [{file,"src/webmachine_resource.erl"},\n
> >                 {line,186}]}]}}
```


---

mochiweb+webmachine
> web
> > server

'
> >
> >
> >
> > I have observed that, every time I do both things simultaneously casing
> the
> > error. But later on after a while map-reduce query is working fine.
> > Is this mean, can't I run the map-reduce queries while deleting keys from
> > other client?
> >
> >
> > --
> > Thanks & Regards,
> > Naveen Tamanam
> >
> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > riak-users mailing list
> > riak-users@lists.basho.com
> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> >
>



-- 
Thanks & Regards,
Naveen Tamanam
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

