---
title: "Re: Key Filter Timeout"
description: ""
project: community
lastmod: 2011-10-23T13:13:28-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05251"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-10-23T13:13:28-07:00
---


Jim,

Looks like you are possibly using both the legacy key listing option and the 
legacy map reduce. Assuming all your nodes are on Riak 1.0, check your 
app.config files on all nodes and make sure mapred\_system is set to pipe and 
legacy\_keylisting is set to false. If that's not already the case you should 
see better performance. If you are still getting the same or similar errors 
with those setting in place, please respond with what they are so we can look 
into it more. Thanks.

Kelly

On Oct 23, 2011, at 12:38 PM, Jim Adler wrote:

> I'm trying to run a very simplified key filter that's timing out. I've got 
> about 8M keys in a 3-node cluster, 15 GB memory, num\_partitions=256, LevelDB 
> backend.
> 
> I'm thinking this should be pretty quick. What am I doing wrong?
> 
> Jim
> 
> Here's the query:
> 
> curl -v -d 
> '{"inputs":{"bucket":"nodes","key\_filters":[["eq","user\_id-xxxxxxx-info"]]},"query":[{"reduce":{"language":"erlang","module":"riak\_kv\_mapreduce","function":"reduce\_identity"}}]}'
> -H "Content-Type: application/json" http://xx.xx.xx.xx:8098/mapred
> 
> Here's the log:
> 
> 18:25:08.892 [error] gen\_fsm <0.20795.0> in state executing terminated with 
> reason: {error,flow\_timeout}
> 18:25:08.961 [error] CRASH REPORT Process <0.20795.0> with 2 neighbours 
> crashed with reason: {error,flow\_timeout}
> 18:25:08.963 [error] Supervisor luke\_flow\_sup had child undefined started 
> with {luke\_flow,start\_link,undefined} at <0.20795.0> exit with reason 
> {error,flow\_timeout} in context child\_terminated
> 18:25:08.966 [error] gen\_fsm <0.20798.0> in state waiting\_kl terminated with 
> reason: {error,flow\_timeout}
> 18:25:08.971 [error] CRASH REPORT Process <0.20798.0> with 0 neighbours 
> crashed with reason: {error,flow\_timeout}
> 18:25:08.980 [error] Supervisor riak\_kv\_keys\_fsm\_legacy\_sup had child 
> undefined started with {riak\_kv\_keys\_fsm\_legacy,start\_link,undefined} at 
> <0.20798.0> exit with reason {error,flow\_timeout} in context child\_terminated
> 18:25:08.983 [error] Supervisor luke\_phase\_sup had child undefined started 
> with {luke\_phase,start\_link,undefined} at <0.20797.0> exit with reason 
> {error,flow\_timeout} in context child\_terminated
> 18:25:08.996 [error] Supervisor luke\_phase\_sup had child undefined started 
> with {luke\_phase,start\_link,undefined} at <0.20796.0> exit with reason 
> {error,flow\_timeout} in context child\_terminated
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

