---
title: "Riak search query timeout issues with 1.2.1 stable"
description: ""
project: community
lastmod: 2012-12-05T05:06:55-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09428"
author_name: "Abhinav Singh"
project_section: "mailinglistitem"
sent_date: 2012-12-05T05:06:55-08:00
---


Hello Everyone,

We are facing an issue where search queries works fine on my local dev box 
(which have riak-1.2.1rc2 installed).
However same queries timeout on our production boxes (which have riak-1.2.1 
installed):

QUERY:
/select?wt=json&q=to:733d5cb23129734585af7b9fe16b1bbc5daa5b5c AND tags:(message)

RESPONSE:
{error,{error,{case\_clause,timeout},
 [{riak\_search\_client,search\_doc,8},
 {riak\_search\_utils,run\_query,7},
 {riak\_solr\_searcher\_wm,to\_json,2},
 {webmachine\_resource,resource\_call,3},
 {webmachine\_resource,do,3},
 {webmachine\_decision\_core,resource\_call,1},
 {webmachine\_decision\_core,decision,1},
 {webmachine\_decision\_core,handle\_request,2}]}}
Here are the logs as seen inside riak error.log file:

2012-12-05 14:49:59.777 [error] <0.1035.0>@mi\_server:handle\_info:524 
lookup/range failure: 
{{badfun,#Fun},[{mi\_server,iterate,6},{mi\_server,lookup,8}]}
2012-12-05 14:49:59.777 [error] emulator Error in process <0.17345.11> on node 
'riak@172.17.3.82' with exit value: 
{{badfun,#Fun},[{mi\_server,iterate,6},{mi\_server,lookup,8}]}
2012-12-05 14:50:58.321 [error] <0.15946.11> webmachine error: 
path="/solr/ejabberd\_doc/select"
{error,{error,{case\_clause,timeout},[{riak\_search\_client,search\_doc,8},{riak\_search\_utils,run\_query,7},{riak\_solr\_searcher\_wm,to\_json,2},{webmachine\_resource,resource\_call,3},{webmachine\_resource,do,3},{webmachine\_decision\_core,resource\_call,1},{webmachine\_decision\_core,decision,1},{webmachine\_decision\_core,handle\_request,2}]}}

This query does succeed sometimes (1-5%), but fails most of the times.
I want to know if the above logs indicate towards a particular error with our 
riak cluster?

Since this query has never failed on my local development box, 
I suspect either it has to do with something that changed between 1.2.1rc2 and 
1.2.1-stable release or something that is related to our production riak 
cluster.

Feedback and help is greatly appreciated. Thanks in advance.

--
Abhinav Singh
http://abhinavsingh.com/\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

