---
title: "Re: Question: {error,{error,insufficient_vnodes_available}}"
description: ""
project: community
lastmod: 2011-11-30T19:18:23-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05826"
mailinglist_parent_id: "msg05791"
author_name: "Chung-Hung (Walter) Tsai"
project_section: "mailinglistitem"
sent_date: 2011-11-30T19:18:23-08:00
---


Hi Dan,

Thanks for your reply.
Indeed, I saw the "insufficient\_vnodes\_available" error message with
only one node on the machine.
What we did was just install the official 1.0.2's deb version and
modifying vm.args and app.config.

The only changes in our setting are:
A. app.config:
- (http ip ..
- {pb\_ib ..
- storage\_backend points to storage\_backend, riak\_kv\_eleveldb\_backend

B. vm.args
-name
-setcookie

And the db ran smoothly for many days, then crashed for the 1st time.
It got recovered after we adjusted the ulimit.
Then it crashed again with the error message as above.

We don't have the other vnodes up-and-running in the machine at this
moment, though I was thinking it might be a solution and trying.
I tried to add an additional node and join the original node, but
fails. Then I leave it as it is.
Odd is, the DB comes back.

Here is our riak-admin info:

1. We don't have MapReduce procedures in it.

2. "#riak-admin status" shows:

Attempting to restart script through sudo -u riak
1-minute stats for 'riak@my-ip-address'
-------------------------------------------
vnode gets : 138
vnode\_puts : 78
vnode\_index\_reads : 0
vnode\_index\_writes : 0
vnode\_index\_writes\_postings : 0
vnode\_index\_deletes : 0
vnode\_index\_deletes\_postings : 0
read\_repairs : 1
vnode\_gets\_total : 490203
vnode\_puts\_total : 199436
vnode\_index\_reads\_total : 0
vnode\_index\_writes\_total : 0
vnode\_index\_writes\_postings\_total : 0
vnode\_index\_deletes\_total : 0
vnode\_index\_deletes\_postings\_total : 0
node\_gets : 42
node\_gets\_total : 163369
node\_get\_fsm\_time\_mean : 409
node\_get\_fsm\_time\_median : 397
node\_get\_fsm\_time\_95 : 674
node\_get\_fsm\_time\_99 : 734
node\_get\_fsm\_time\_100 : 748
node\_puts : 24
node\_puts\_total : 66478
node\_put\_fsm\_time\_mean : 968
node\_put\_fsm\_time\_median : 1000
node\_put\_fsm\_time\_95 : 1599
node\_put\_fsm\_time\_99 : 1719
node\_put\_fsm\_time\_100 : 1735
node\_get\_fsm\_siblings\_mean : 1
node\_get\_fsm\_siblings\_median : 1
node\_get\_fsm\_siblings\_95 : 1
node\_get\_fsm\_siblings\_99 : 1
node\_get\_fsm\_siblings\_100 : 1
node\_get\_fsm\_objsize\_mean : 3609
node\_get\_fsm\_objsize\_median : 1280
node\_get\_fsm\_objsize\_95 : 29952
node\_get\_fsm\_objsize\_99 : 31385
node\_get\_fsm\_objsize\_100 : 31422
read\_repairs\_total : 1
coord\_redirs\_total : 0
cpu\_nprocs : 441
cpu\_avg1 : 51
cpu\_avg5 : 33
cpu\_avg15 : 54
mem\_total : 8383463424
mem\_allocated : 8280829952
disk : [{"/",724427316,3},
 {"/dev",4088508,1},
 {"/dev/shm",4093488,0},
 {"/var/run",4093488,1},
 {"/var/lock",4093488,0},
 {"/lib/init/rw",4093488,0},
 {"/var/lib/ureadahead/debugfs",724427316,3},
 {"/boot",256665,20}]
nodename : 'riak@my-ip-address'
connected\_nodes : []
sys\_driver\_version : <<"1.5">>
sys\_global\_heaps\_size : 0
sys\_heap\_type : private
sys\_logical\_processors : 8
sys\_otp\_release : <<"R14B03">>
sys\_process\_count : 1225
sys\_smp\_support : true
sys\_system\_version : <<"Erlang R14B03 (erts-5.8.4) [source] [64-bit]
[smp:8:8] [rq:8] [async-threads:64] [kernel-poll:true]">>
sys\_system\_architecture : <<"x86\_64-unknown-linux-gnu">>
sys\_threads\_enabled : true
sys\_thread\_pool\_size : 64
sys\_wordsize : 8
ring\_members : ['riak@my-ip-address']
ring\_num\_partitions : 64
ring\_ownership : <<"[{'riak@my-ip-address',64}]">>
ring\_creation\_size : 64
storage\_backend : riak\_kv\_eleveldb\_backend
ssl\_version : <<"4.1.5">>
public\_key\_version : <<"0.12">>
runtime\_tools\_version : <<"1.8.5">>
basho\_stats\_version : <<"1.0.1">>
riak\_search\_version : <<"1.0.2">>
merge\_index\_version : <<"1.0.1">>
luwak\_version : <<"1.1.2">>
skerl\_version : <<"1.1.0">>
riak\_kv\_version : <<"1.0.2">>
bitcask\_version : <<"1.3.0">>
luke\_version : <<"0.2.4">>
erlang\_js\_version : <<"1.0.0">>
mochiweb\_version : <<"1.5.1">>
inets\_version : <<"5.6">>
riak\_pipe\_version : <<"1.0.2">>
riak\_core\_version : <<"1.0.2">>
riak\_sysmon\_version : <<"1.0.0">>
webmachine\_version : <<"1.9.0">>
crypto\_version : <<"2.0.3">>
os\_mon\_version : <<"2.2.6">>
cluster\_info\_version : <<"1.2.0">>
sasl\_version : <<"2.1.9.4">>
lager\_version : <<"0.9.4">>
basho\_metrics\_version : <<"1.0.0">>
stdlib\_version : <<"1.17.4">>
kernel\_version : <<"2.14.4">>
executing\_mappers : 0
memory\_total : 1088568880
memory\_processes : 1041629696
memory\_processes\_used : 1041593360
memory\_system : 46939184
memory\_atom : 1031585
memory\_atom\_used : 999738
memory\_binary : 2593768
memory\_code : 9301939
memory\_ets : 656408


3. "# riak-admin ring\_status" shows:

Attempting to restart script through sudo -u riak
================================== Claimant ===================================
Claimant: 'riak@my-ip-address'
Status: up
Ring Ready: true

============================== Ownership Handoff ==============================
No pending changes.

============================== Unreachable Nodes ==============================
All nodes are up and reachable


4. "# riak-admin member\_status" shows

Attempting to restart script through sudo -u riak
================================= Membership ==================================
Status Ring Pending Node
-------------------------------------------------------------------------------
valid 100.0% -- 'riak@my-ip-address'
-------------------------------------------------------------------------------
Valid:1 / Leaving:0 / Exiting:0 / Joining:0 / Down:0


Thanks,
Walter

2011/11/30 Dan Reverri :
> Hi Walter,
> It is not recommended to run more than 1 node per machine. Also, creating a
> new node by copying/pasting an existing node is not a good idea.
> Were you seeing "insufficient vnodes" before you tried adding nodes?
> Was the node under any load? MapReduce, ListKeys, etc.
> What does "riak-admin status" return on the original node?
> What does "riak-admin ring\_status" return on the original node?
> What does "riak-admin "member\_status" return on the original node?
> I am concerned that the addition of copied nodes may be creating additional
> issues. I would recommend getting the cluster back to a steady state with a
> single node. Once this is complete we can review the issues and determine
> what the problem might be.
> Thanks,
> Dan
> Daniel Reverri
> Developer Advocate
> Basho Technologies, Inc.
> d...@basho.com
>
>
> On Mon, Nov 28, 2011 at 3:06 PM, Chung-Hung (Walter) Tsai
>  wrote:
>>
>> Hi Dan,
>>
>> Yes, I use non-default name parameter and reip it.
>>
>> Please find my setting and setup info as below:
>>
>> Version: 1.0.2, .deb
>> Linux: Unbuntu 10.4, 64bits
>> Vnode: I didn't specify the other 2 nodes specifically, just used
>> default setting and did riak start.
>> The DB has a bumping due to insufficient file descriptor and got
>> resolved after I set ulimit and sysctl for system-wide parameters.
>> It ran ok for several days but since yesterday, it gave us the error
>> message regarding insufficient vnodes errors.
>>
>> I'm trying to setup 2 additional nodes by copying and modding
>> necessary files (e.g. /usr/sbin/riak to /usr/sbin/riakN) manually now.
>> But they each become a single cluster with just a single member in it
>> and doesn't allow other vnodes to join.
>> When I launch "riak-admin", it shows something like " ... 100% ...
>> riak@MY-IP-ADDRESS"
>>
>>
>> Thanks,
>> Walter
>>
>> 2011/11/29 Dan Reverri :
>> > Hi Walter,
>> > Have you made any changes to your configuration recently such as
>> > changing
>> > the "-name" parameter in vm.args?
>> > Thanks,
>> > Dan
>> > Daniel Reverri
>> > Developer Advocate
>> > Basho Technologies, Inc.
>> > d...@basho.com
>> >
>> >
>> > On Mon, Nov 28, 2011 at 1:04 AM, Chung-Hung (Walter) Tsai
>> >  wrote:
>> >>
>> >> Hello everyone,
>> >>
>> >> We just saw many errors like this:
>> >>
>> >> 2011-11-27 23:02:01.129 [error] <0.700.0> webmachine error:
>> >> path="/buckets/.. (SKIPPED).....ui"
>> >> {error,{error,insufficient\_vnodes\_available}}
>> >>
>> >> The DB went well for several days, but now our riak cannot be
>> >> connected from our code since the errors appear.
>> >> Does anyone know how to resolve the issue?
>> >>
>> >>
>> >> Thanks,
>> >> Walter
>> >>
>> >> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> >> riak-users mailing list
>> >> riak-users@lists.basho.com
>> >> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>> >
>> >
>
>

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

