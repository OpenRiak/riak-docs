---
title: "Re: Running multiple Riak instances."
description: ""
project: community
lastmod: 2010-07-31T07:08:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00819"
mailinglist_parent_id: "msg00818"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2010-07-31T07:08:37-07:00
---



The reip command needs to execute when the node is \*not\* running. Fyi.

-Alexander


@siculars on twitter
http://siculars.posterous.com

Sent from my iPhone

On Jul 31, 2010, at 6:40, francisco treacy 
 wrote:



Misha,

I \*think\* I had the same problem.

Perhaps you started your nodes when they were still called 'riak', and
that may be the reason why -progname remains?

Did you update the ring file? This worked for me:

riak-testing/bin/riak-admin reip r...@127.0.0.1 test...@127.0.0.1
riak-production/bin/riak-admin reip r...@127.0.0.1 
product...@127.0.0.1


Francisco


2010/7/25 Misha Gorodnitzky :

Ya, I changed that in my vm.staging.args config file. However, in the
process list I see these two processes:

 /usr/lib/riak/erts-5.7.5/bin/run\_erl -daemon /var/run/riak-staging/
/var/log/riak-staging exec /usr/sbin/riak console -
 /usr/lib/riak/erts-5.7.5/bin/beam.smp -K true -A 5 -- -root
/usr/lib/riak -progname riak -- -home /var/lib/riak -- -boot
/usr/lib/riak/releases/0.12.0/riak -embedded -config
/etc/riak/app.staging.config -name riak\_stag...@127.0.0.1 -setcookie
riak-staging -home /var/lib/riak-staging -- console -

The second one being a child to the first. I can see that the -name 
is

being set there, what worries me is that -progname is 'riak', I'm not
sure if that needs to be unique or not, or how to change it.


--M

On 25 July 2010 17:29, Grant Schofield  wrote:
Does the second vm.args have the same -name setting as the first 
node? Each node will need to have a unique name configured.


Grant Schofield
Developer Advocate
Basho Technologies, Inc.


On Jul 25, 2010, at 9:00 AM, Misha Gorodnitzky wrote:


Hi all,

I'm trying to run multiple instances of Riak on my server with the
goal to run both the staging environment and eventually the 
production

environment on the same server (I only have one for this project).
This is an Ubuntu server and if at all possible I'd prefer not to
build Riak from source, although I understand that it would be 
easier

to have multiple instances running that way. I would rather keep
software managed with the package manager here.

What I've done is I've modified /usr/sbin/riak to allow 
specifying the
config files to use (app.config, vm.args), the log dir, run dir 
(for

the pipe) and the home dir, and I can startup an instance of Riak
using my "staging" environment. However, when I try to start up the
second Riak instance, it fails with just a couple of things
out-of-the-ordinary in it's logs:

 =INFO REPORT==== 25-Jul-2010::13:54:35 ===
 application: riak\_kv
 exited: {shutdown,{riak\_kv\_app,start,[normal,[]]}}
 type: permanent
 =INFO REPORT==== 25-Jul-2010::13:54:35 ===
 alarm\_handler: {clear,system\_memory\_high\_watermark}
 {"Kernel pid 
terminated" 
,application\_controller,"{application\_start\_failure,riak\_kv, 
{shutdown,{riak\_kv\_app,start,[normal,[]]}}}"}^M

 Kernel pid terminated (application\_controller)
({application\_start\_failure,riak\_kv,{shutdown,{riak\_kv\_app,start, 
[normal,[]]}}})^M


And the Riak process that's already running logs this:

 \*\* Connection attempt from disallowed node 
'riak\_stag...@127.0.0.1' \*\*


Any ideas what this might be? Has anyone managed to do this using 
the

Riak .deb package?

Thanks,

--Misha

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com





\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

