---
title: "Re: Map phase timeout"
description: ""
project: community
lastmod: 2013-04-08T00:16:28-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10744"
mailinglist_parent_id: "msg10740"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-04-08T00:16:28-07:00
---


Hi,

Without having access to the mapreduce functions you are running, I would 
assume that a mapreduce job both writing data to disk as well as deleting the 
written record from Riak might be quite slow. This is not really a use case 
mapreduce was designed for, and when a mapreduce job crashes or times out it is 
difficult to know how far along the processing of different records it got. 

I would therefore recommend considering running this type of archiving and 
delete job as an external batch process instead as it will give you better 
control over the execution and avoid timeout problems. 

Best regards,

Christian



On 8 Apr 2013, at 00:49, Matt Black  wrote:

> Dear list, 
> 
> I'm currently getting a timeout during a single phase of a multi-phase map 
> reduce query. Is there anything I can do to assist this in running?
> 
> It's purpose is to backup and remove objects from Riak, so it will run 
> periodically during quiet times moving old data out of Riak into file storage.
> 
> Traceback (most recent call last):
> File "./tools/rolling\_backup.py", line 185, in 
> main()
> File "./tools/rolling\_backup.py", line 181, in main
> args.func(\*\*kwargs)
> File "/srv/backup/tools/mapreduce.py", line 295, in do\_map\_reduce
> raise e
> Exception: 
> {"phase":2,"error":"timeout","input":"[<<\"cart-products\">>,<<\"cd67d7f6e2688bc2089e6fa79506ac05-2\">>,{struct,[{<<\"uid\">>,<<\"cd67d7f6e2688bc2089e6fa79506ac05\">>},{<<\"cart\">>,{struct,[{<<\"expired\_ts\">>,<<\"2013-03-05T19:12:23.906228\">>},{<<\"last\_updated\">>,<<\"2013-03-05T19:12:23.906242\">>},{<<\"tags\">>,{struct,[{<<\"type\">>,<<\"AB\">>}]}},{<<\"completed\">>,false},{<<\"created\">>,<<\"2013-03-04T02:10:18.638413\">>},{<<\"products\">>,[{struct,[{<<\"cost\">>,0},{<<\"bundleName\">>,<<\"Product\">>},...]},...]},...]}},...]}]","type":"exit","stack":"[{riak\_kv\_w\_reduce,'-js\_runner/1-fun-0-',3,[{file,\"src/riak\_kv\_w\_reduce.erl\"},{line,283}]},{riak\_kv\_w\_reduce,reduce,3,[{file,\"src/riak\_kv\_w\_reduce.erl\"},{line,206}]},{riak\_kv\_w\_reduce,maybe\_reduce,2,[{file,\"src/riak\_kv\_w\_reduce.erl\"},{line,157}]},{riak\_pipe\_vnode\_worker,process\_input,3,[{file,\"src/riak\_pipe\_vnode\_worker.erl\"},{line,444}]},{riak\_pipe\_vnode\_worker,wait\_for\_input,2,[{file,\"src/riak\_pipe\_vnode\_worker.erl\"},{line,376}]},{gen\_fsm,handle\_msg,7,[{file,\"gen\_fsm.erl\"},{line,494}]},{proc\_lib,...}]"}
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

