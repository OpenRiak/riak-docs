---
title: "Ruby client not working when a node is down"
description: ""
project: community
lastmod: 2010-05-28T11:19:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00453"
author_name: "Johan Harjono"
project_section: "mailinglistitem"
sent_date: 2010-05-28T11:19:43-07:00

---


Hello,

I managed to set up a riak cluster running on 7 different machines.
Everything is working perfectly when all 7 nodes are running. However, when
I stopped one of the nodes, the ruby client library
http://github.com/seancribbs/ripple no longer work properly.

-bash-3.2# irb
irb(main):001:0> require 'rubygems'
=> true
irb(main):002:0> require 'riak'
=> true
irb(main):003:0> client = Riak::Client.new({:host => '10.10.1.36'})
curb library not found! Please `gem install curb` for better performance.
=> #
irb(main):004:0> b = client.bucket('users')
/usr/lib/ruby/1.8/timeout.rb:54:in `rbuf\_fill': execution expired
(Timeout::Error)
from /usr/lib/ruby/1.8/timeout.rb:56:in `timeout'
from /usr/lib/ruby/1.8/timeout.rb:76:in `timeout'
from /usr/lib/ruby/1.8/net/protocol.rb:132:in `rbuf\_fill'
from /usr/lib/ruby/1.8/net/protocol.rb:116:in `readuntil'
from /usr/lib/ruby/1.8/net/protocol.rb:126:in `readline'
from /usr/lib/ruby/1.8/net/http.rb:2020:in `read\_status\_line'
from /usr/lib/ruby/1.8/net/http.rb:2009:in `read\_new'
from /usr/lib/ruby/1.8/net/http.rb:1050:in `request'
from
/usr/lib/ruby/gems/1.8/gems/riak-client-0.7.0/lib/riak/client/net\_http\_backend.rb:33:in
`perform'
from /usr/lib/ruby/1.8/net/http.rb:543:in `start'
from /usr/lib/ruby/1.8/net/http.rb:440:in `start'
from
/usr/lib/ruby/gems/1.8/gems/riak-client-0.7.0/lib/riak/client/net\_http\_backend.rb:25:in
`perform'
from
/usr/lib/ruby/gems/1.8/gems/riak-client-0.7.0/lib/riak/client/http\_backend.rb:71:in
`get'
from /usr/lib/ruby/gems/1.8/gems/riak-client-0.7.0/lib/riak/client.rb:120:in
`bucket'
from (irb):4:in `irb\_binding'
from /usr/lib/ruby/1.8/irb/workspace.rb:52:in `irb\_binding'
from /usr/lib/ruby/1.8/irb/workspace.rb:52

Using curl to send HTTP request manually works perfectly even when nodes are
down. It's only using the riak-client for ruby that is problematic. Bringing
the fallen node back up solved the problem for ruby (but of course the whole
point is that riak should be available even when some nodes are down). Has
anyone ever encountered this problem before?

thanks,
Johan
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

