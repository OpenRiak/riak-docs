---
title: "Multiple Index Queries using Riak and Python"
description: ""
project: community
lastmod: 2012-02-24T02:05:56-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06726"
author_name: "Sreejith K"
project_section: "mailinglistitem"
sent_date: 2012-02-24T02:05:56-08:00

---


Hi everyone,

I wrote a simple Python wrapper which makes use of Riak Secondary Indexes
and MapReduce for Qerying multiple indexes at once. I know it might not be
the ideal solution but thought It'd be a kind of cool stuff to do. Here is
how it works.

1. Queries Multiple Indexes and get the associated keys
2. Pass the keys to a MapReduce job where Multiple filters are again
evaluated. The map phase applies all the conditions to individual keys

 client = riak.RiakClient('localhost', 8091)
 bucket = client.bucket('test\_multi\_index')

 bucket.new('sree', {'name': 'Sreejith', 'age': '25'}).\
 add\_index('name\_bin', 'Sreejith').\
 add\_index('age\_int', 25).store()
 bucket.new('vishnu', {'name': 'Vishnu', 'age': '31'}).\
 add\_index('name\_bin', 'Vishnu').\
 add\_index('age\_int', 31).store()

 query = RiakMultiIndexQuery(client, 'test\_multi\_index')
 for res in query.filter('age', '<', 50).filter('name', '==',
'Vishnu').run(): :
 print res

But the inequality filters are based on MIN and MAX values for both \*bin\*and
\*int \*indexes (I set that to 99999999999999999 for \*int\* and '' for \*bin\*).
I'm not sure if that is correct or there is another way to achieve that.

Suggestions and patches are always welcome :-)

https://github.com/semk/utils/blob/master/riak\_multi\_query.py

--
Regards,

Sreejith K
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

