---
title: "riak mapreduce failure"
description: ""
project: community
lastmod: 2011-07-06T21:10:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03950"
author_name: "Matt Graham"
project_section: "mailinglistitem"
sent_date: 2011-07-06T21:10:39-07:00

---


Hi,
I'm trying to test out riak's mapreduce for just a simple case but I
can't get it to work. Maybe someone can help with what I'm doing
wrong. I have the latest build of Riak available for Ubuntu
installed.

I add an object to riak, that works. I can then fetch it. Then I try
to run a mapreduce on that bucket and it fails.

mdg@maple:~/tmp$ curl -i -d 6 http://127.0.0.1:8098/riak/test/2
HTTP/1.1 204 No Content
Vary: Accept-Encoding
Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
Date: Thu, 07 Jul 2011 03:47:00 GMT
Content-Type: application/x-www-form-urlencoded
Content-Length: 0

mdg@maple:~/tmp$ curl -i http://127.0.0.1:8098/riak/test/2
HTTP/1.1 200 OK
X-Riak-Vclock: a85hYGBgzGDKBVIs7JvMrDOYEhnzWBlMVnQe58sCAA==
Vary: Accept-Encoding
Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
Link: ; rel="up"
Last-Modified: Tue, 05 Jul 2011 09:33:16 GMT
ETag: "4fhdlMvPAPNw4SegwaTNMv"
Date: Thu, 07 Jul 2011 03:47:09 GMT
Content-Type: application/x-www-form-urlencoded
Content-Length: 1

6
mdg@maple:~/tmp$curl -i -d
'{"inputs":"test","query":[{"map":{"language":"javascript","source":"function(value)
{ return value; }","keep":true}}]}' -H "Content-Type:
application/json" http://127.0.0.1:8098/mapred
HTTP/1.1 500 Internal Server Error
Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
Date: Thu, 07 Jul 2011 03:47:22 GMT
Content-Type: text/html
Content-Length: 692

500 Internal Server
ErrorInternal Server Error
=====================

The server
encountered an error while processing this
request:  

```
{error,{exit,{json_encode,{bad_term,{<<"bucket">>,<<"test">>}}},
             [{mochijson2,json_encode,2},
              {mochijson2,'-json_encode_array/2-fun-0-',3},
              {lists,foldl,3},
              {mochijson2,json_encode_array,2},
              {riak_kv_wm_mapred,process_post,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              
{webmachine_decision_core,resource_call,1}]}}
```


---

mochiweb+webmachine
web server




I get that json\_encode error every time. Any ideas on how to not get
that or how to work around it?

Thanks,
Matt

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

