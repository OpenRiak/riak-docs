---
title: "Re: Reg:Continuous Periodic crashes after long operation"
description: ""
project: community
lastmod: 2017-01-26T08:08:23-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17886"
mailinglist_parent_id: "msg17885"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2017-01-26T08:08:23-08:00
---


FYI: this is the function that is crashing:

get\_uint32\_measurement(Request, #internal{os\_type = {unix, linux}}) ->
 {ok,F} = file:open("/proc/loadavg",[read,raw]), %% <--- 
crash line
 {ok,D} = file:read(F,24),
 ok = file:close(F),
 {ok,[Load1,Load5,Load15,\_PRun,PTotal],\_} = io\_lib:fread("~f ~f ~f ~d/~d", 
D),
 case Request of
 ?avg1 -> sunify(Load1);
 ?avg5 -> sunify(Load5);
 ?avg15 -> sunify(Load15);
 ?ping -> 4711;
 ?nprocs -> PTotal
 end;

Is there something unique about that open?

Matthew

> On Jan 26, 2017, at 10:37 AM, Luke Bakken  wrote:
> 
> Steven,
> 
> You may be able to get information via the lsof command as to what
> process(es) are using many file handles (if that is the cause).
> 
> I searched for that particular error and found this GH issue:
> https://github.com/emqtt/emqttd/issues/426
> 
> Which directed me to this page:
> https://github.com/emqtt/emqttd/wiki/linux-kernel-tuning
> 
> Basho also has a set of recommended tuning parameters:
> http://docs.basho.com/riak/kv/2.2.0/using/performance/
> 
> Do you have other error entries in any of Riak's logs at around the
> same time as these messages? Particularly crash.log.
> 
> --
> Luke Bakken
> Engineer
> lbak...@basho.com
> 
> On Thu, Jan 26, 2017 at 4:42 AM, Steven Joseph  wrote:
>> Hi Shaun,
>> 
>> I have already set this to a very high value
>> 
>> (r...@hawk1.streethawk.com)1> os:cmd("ulimit -n").
>> "20000500\n"
>> (r...@hawk1.streethawk.com)2>
>> 
>> 
>> So the issue is not that the limit is low, but maybe a resource leak ? As I
>> mentioned our application processes continuously run queries on the cluster.
>> 
>> Kind Regards
>> 
>> Steven
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

