---
title: "riak-admin leave behavior"
description: ""
project: community
lastmod: 2012-04-23T18:11:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07298"
author_name: "Michael Radford"
project_section: "mailinglistitem"
sent_date: 2012-04-23T18:11:39-07:00

---


A coworker who's testing various backup and recovery strategies (using
riak 1.1.2) told me that while watching a node running "riak-admin
leave", he saw the disk usage of the leveldb data directory slowly
shrinking, and when the node had completed leaving, the directory was
the same size as an empty, newly started node's.

I'm curious why that might be, and why the deletion would be
incremental...he was interpreting it as the actual data being handed
off to the other nodes.

That would be surprising, since we were told in no uncertain terms
that running "riak-admin leave" did not proactively create new
replicas of any objects that the node's vnodes had been responsible
for, but rather, taking a node out of a cluster with n=3 would
temporarily leave some fraction of the objects with only 2 replicas
until their keys had been read, triggering read repair.

So is the deletion from the leaving node just to be polite in case
someone wants to join the node to a different cluster after leaving?
(And maybe it's somewhat incremental just because it's done on a
per-vnode basis?)

Mike

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

