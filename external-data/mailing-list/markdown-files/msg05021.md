---
title: "Re: Delete takes 5 seconds in riak 1.0 ???"
description: ""
project: community
lastmod: 2011-10-04T03:30:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05021"
mailinglist_parent_id: "msg04989"
author_name: "Roland Karlsson"
project_section: "mailinglistitem"
sent_date: 2011-10-04T03:30:03-07:00
---


Another comment

I also tried an implementation of the test code where delete
waited in a loop as long as the tombstone was still there.
But as far as I can see it might then wait forever. Or at least
several minutes - until I did not care to wait any longer.

Is that so - an a tombstone exist forever?

/Roland



----- Original Message -----
From: "Jon Meredith" 
To: "Roland Karlsson" 
Cc: riak-users@lists.basho.com
Sent: Monday, October 3, 2011 5:02:27 PM
Subject: Re: Delete takes 5 seconds in riak 1.0 ???

Hi Roland, 


Riak deletes by first writing a tombstone and then when all replicas are in 
sync removing the object from the underlying key/value store. We have made some 
changes in 1.0.0 to increase the length of time the tombstones are around when 
all nodes are up (in the Delete Changes section of the release notes here 
https://github.com/basho/riak/blob/1.0/RELEASE-NOTES.org ). 


If you just want to make sure the object is deleted, you could use the 
deletedvclock option on the get request. You will get a 3-tuple {error, 
notfound, VClock} until the tombstone is removed, then a 2-tuple of {error, 
notfound} when it has gone. 


If you wish to rewrite the key, you can use the returned vclock on a new object 
O = riakc\_obj:set\_vclock(riakc\_obj:new(<<"b">>,<<<"k">>,<,"v">>), VClock) 


and it will overwrite the tombstone for you. 


Best Regards, 


Jon Meredith 
Basho Technologies 


On Mon, Oct 3, 2011 at 6:49 AM, Roland Karlsson < 
roland.karls...@erlang-solutions.com > wrote: 


Hi Basho, 

I had written some simple tests using riakc client library. 

The tests are attached to this mail. 

In particular I made this call in the tests at the start of 
of each test in order to get a clean DB. 

riakc\_pb\_socket:delete(Pid, Bucket, Key), 

In 0.14 that worked just fine. But ... in 1.0 it did not work. 
The tests failed and complained about siblings. 

But ... after some time of experimenting I found that if I 
added a sleep of 5 seconds after the delete ... then the tests 
were OK again. 

Is this correct? Does delete take 5 seconds? 

NOTE that the attached file assumes inits is started. 

/Roland 

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ 
riak-users mailing list 
riak-users@lists.basho.com 
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com 



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

