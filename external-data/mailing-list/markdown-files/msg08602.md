---
title: "Re: Evolving data model"
description: ""
project: community
lastmod: 2012-09-19T15:52:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08602"
mailinglist_parent_id: "msg08601"
author_name: "Todd Cullen"
project_section: "mailinglistitem"
sent_date: 2012-09-19T15:52:36-07:00
---


ThoughtLeadr uses Bip's approach. Its essential lazy schema migration.

On Wed, Sep 19, 2012 at 3:03 PM, Reid Draper  wrote:

> I have also used Bip's method and found it successful. You do need to be
> careful to make sure
> all reads of your data go through this upgrade-path, but that is easy once
> you realize it :).
>
>
> Reid
>
> On Sep 19, 2012, at 5:44 PM, Bip Thelin  wrote:
>
> We use a technique that works well for our use case:
> We store everything as JSON and use the erlang-client, for every object we
> store we add an opaque schema\_version tag to the JSON and then in our model
> encode/decode routine we parse this schema\_version and if the version is
> not the latest according to the model we recurse and upgrade the payload
> all the way up to the current version and then return the new object to the
> client and spawn an async process that saves the new object back.
>
> So for instance an object is at schema\_version 1 when it get's read. The
> model is now on version 5 there will be five functions, i.e:
> upgrade\_version(2, Payload) ->
> do\_something();
> upgrade\_version(3, Payload) ->
> etc...
>
> every function knows how to upgrade itself from it's former version so
> fast forwarding through version is easy and every object will get upgraded
> eventually (if the get read).
>
> --
> Bip Thelin
>
> KIVRA | Lugnets AllÃ© 1 | 120 33 Stockholm
> Tel 08-533 335 37 | Mob 0735-18 18 90
> www.kivra.com
>
>
>
>
> On 19 sep 2012, at 00:55, Allen Johnson  wrote:
>
> Hey everyone,
>
> I'm beginning to experiment with Riak and I'm trying to better
> understand how to model my data. One question I have at the moment is
> how to evolve my data with a data store such as Riak? I know that
> it's schema-less and that I can add new fields as needed but I'm
> thinking more about the existing documents.
>
> For example, say hypothetically, that I have a fairly successful
> riak-based app. As the application code continues to evolve over
> several versions I begin to find a "better" way to model my data. By
> this time I have already stored many, many documents. What is the
> appropriate path here? Do I version my documents with metadata and
> rely on my application code to continue to deal with old-style
> documents -- or do I perform some sort of bulk transformation on these
> existing documents?
>
> Thanks,
> Allen
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>


-- 
Cheers,

Todd Cullen | Founder & CEO of ThoughtLeadr
177 Post Street, #550 SF 94108
e. t...@thoughtleadr.com p. 415-254-0787
twitter: @shakakai  skype: todd.cullen

 Fast Company covers
ThoughtLeadr
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

