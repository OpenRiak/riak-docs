---
title: "Re: Low PUT throughput using Riak"
description: ""
project: community
lastmod: 2012-02-06T11:48:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06548"
mailinglist_parent_id: "msg06535"
author_name: "Ian Plosker"
project_section: "mailinglistitem"
sent_date: 2012-02-06T11:48:07-08:00
---


Hussam, 

You should consider upping the number of concurrent workers and point them at 
multiple nodes in your cluster. Further, you should use the 
`basho\_bench\_driver\_riakc\_pb` driver. The riak client which the 
`basho\_bench\_driver\_riakclient` driver uses is an internal component of Riak 
and should not be used in client apps.

A good example can be found here of using the `basho\_bench\_driver\_riakc\_pb` 
with multiple nodes and multiple concurrent workers:

https://github.com/basho/basho\_bench/blob/master/examples/riakc\_pb.devrel.config
 

-- 
Ian Plosker 
Developer Advocate
Basho Technologies, Inc.



On Friday, February 3, 2012 at 2:16 PM, Hussam Abu-Libdeh wrote:

> Sure!
> 
> Here is the basho\_bench config file I used to benchmark Riak: (recall,
> this was testing a single-node cluster)
> 
> {mode, max}.
> {duration, 4}.
> {concurrent, 1}.
> {driver, basho\_bench\_driver\_riakclient}.
> {code\_paths, ["deps/stats",
> "/usr/er/riak/deps/riak\_kv",
> "/usr/er/riak/deps/riak\_core"]}.
> {key\_generator, {int\_to\_bin, {uniform\_int, 1000000}}}.
> {value\_generator, {fixed\_bin, 10000}}.
> {riakclient\_nodes, ['riak@10.1.1.3 (mailto:riak@10.1.1.3)']}.
> {riakclient\_mynode, ['riak\_bench@10.1.1.3 (mailto:riak\_bench@10.1.1.3)', 
> longnames]}.
> {riakclient\_replies, 1}.
> {operations, [{put, 1}]}.
> 
> 
> And for reference, here is the bash\_bench config file I used to
> benchmark Bitcask:
> 
> {mode, max}.
> {duration, 4}.
> {concurrent, 1}.
> {driver, basho\_bench\_driver\_bitcask}.
> {key\_generator, {int\_to\_bin, {uniform\_int, 1000000}}}.
> {value\_generator, {fixed\_bin, 10000}}.
> {operations, [{put, 1}]}.
> {code\_paths, ["deps/stats", "/usr/er/riak/deps/bitcask"]}.
> {bitcask\_dir, "/usr/er/bitcask.bench"}.
> {bitcask\_flags, [{sync\_strategy, none}]}.
> 
> 
> Thanks,
> 
> On Fri, Feb 3, 2012 at 11:05 AM, Ian Plosker  (mailto:i...@basho.com)> wrote:
> > Hussam,
> > 
> > Could you paste the contents of your basho\_bench config into an email and
> > send it over?
> > 
> > --
> > Ian Plosker 
> > Developer Advocate
> > Basho Technologies
> > 
> > On Thursday, February 2, 2012 at 7:33 PM, Hussam Abu-Libdeh wrote:
> > 
> > Hello,
> > 
> > I am trying to benchmark Riak on a local cluster. I have Riak v1.0.2
> > compiled from source. I am benchmarking using Basho's benchmarking
> > tool, and I used Riaknostic to help me with configuration. My machines
> > are all Dual Xeon with 2GB of RAM and 1Gb ethernet. I get about 50MB/s
> > write throughput on the local disks, and the local disks are mounted
> > with the noatime flag as Riaknostic suggested.
> > 
> > I benchmarked the write throughput of Bitcask by running a local
> > experiment where 1 worker was continuously writing 10K fixed\_binary
> > objects ( {value\_generator, {fixed\_bin, 10000}}. ) with the only
> > bitcask-specific flag being: {bitcask\_flags, [{sync\_strategy, none}]}.
> > I got about 50 MB/s write throughput from Bitcask, so that is good.
> > 
> > Then I tried to benchmark Riak. I setup a cluster of 8 Riak nodes with
> > the same configuration as used for Bitcask. I used the riakclient
> > driver from the benchmarking suite, and set the required riak\_client
> > replies to 1. The client was generating PUT operations continuously
> > with 10K binaries as before. I only got a throughput of about 4 MB/s.
> > I thought this might be an issue of storing extra copies due to
> > replication, so I modified the app.config file on all the nodes to
> > specify that N, R, and W are all set to 1. No improvement. I thought
> > this could be an issue in the network, so I benchmarked a single-node
> > cluster, with the client being local to the same machine (and N,R,W
> > all set to 1), and I still got the same low throughput. Finally, out
> > of desperation, I even modified the target\_n\_val parameter to 1 and
> > the ring\_creation\_size to 1 so there is only 1 Bitcask directory, ran
> > the experiment with 1 local client, and I still got the same very low
> > throughput.
> > 
> > Any help would be greatly appreciated. I have been stuck at this for a
> > while now.
> > 
> > Thanks,
> > 
> > --Hussam
> > 
> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > riak-users mailing list
> > riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> > 
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 
> 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

