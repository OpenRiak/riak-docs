---
title: "Re: Search precommit hook bug?"
description: ""
project: community
lastmod: 2011-09-20T07:53:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04795"
mailinglist_parent_id: "msg04729"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2011-09-20T07:53:39-07:00
---


Elias,

It's hard to say from just this one stacktrace but it seems that the
vnode/leveldb backend might be failing under load causing the R value to go
unmet. The Search hook has to perform a read of a special object it stores
in the backend and that's what is failing here. However, the root cause
seems to be vnodes failing. I say this because of the presence of the
`{r\_val\_unsatisfied,2,1}` msg. Could you check the error and crash log
files and see if you can't find other traces that might shed more light on
this?

-Ryan

On Thu, Sep 15, 2011 at 2:09 AM, Elias Levy wrote:

> While loading some data into a test cluster I using riak 1.0.0pre2 I came
> across some sort of search related bug.
>
> The cluster is configured with 3 nodes, N is 3, W is 1, WD is 0, and I am
> connecting to protocol buffers. The program to load data can be configured
> to use one or more connections using non-blocking IO connected across the
> three nodes. I've successfully loaded several GB of data in a bucket with a
> bitcask backend using 12 concurrent connections.
>
> Then I decided to switching to a leveldb backend. When I did so, about 10
> seconds into loading data I get the following error:
>
> 2011-09-15 05:43:19.161 [error]
> <0.17255.0>@riak\_kv\_put\_fsm:decode\_precommit:607 Problem invoking pre-commit
> hook riak\_search\_kv\_hook:precommit ->
> error:{case\_clause,{error,{r\_val\_unsatisfied,2,1}}}
>
> [{riak\_indexed\_doc,put,3},{riak\_search\_kv\_hook,precommit,1},{riak\_kv\_put\_fsm,invoke\_hook,4},{riak\_kv\_put\_fsm,precommit,2},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]
>
> Now, the interesting part is that if I run the program again, using the
> same input data, the loading succeeded without any errors.
>
> This occurs with some of my other input files, although sometimes I need to
> try loading them a few times before it succeeds. Maybe there are some
> records that trigger the issue, but only if a key is newly inserted?
>
> Elias Levy
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

