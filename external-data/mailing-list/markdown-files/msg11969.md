---
title: "Practical Riak cluster choices in AWS (number of nodes? AZ's?)"
description: ""
project: community
lastmod: 2013-08-11T13:54:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11969"
author_name: "Brady Wetherington"
project_section: "mailinglistitem"
sent_date: 2013-08-11T13:54:16-07:00

---


Hi all -

I have some questions about how I want my Riak stuff to work - I've already
asked these questions of some Basho people and gotten some answers, but
thought I would toss it out into the wider world to see what you all have
to say, too:

First off - I know 5 instances is the "magic number" of instances to have.
If I understand the thinking here, it's that at the default redundancy
level ('n'?) of 3, it is most likely to start getting me some scaling
(e.g., performance > just that of a single node), and yet also have
redundancy; whereby I can lose one box and not start to take a performance
hit.

My question is - I think I can only do 4 in a way that makes sense. I only
have 4 AZ's that I can use right now; AWS won't let me boot instances in
1a. My concern is if I try to do 5, I will be "doubling up" in one AZ - and
in AWS you're almost as likely to lose an entire AZ as you are a single
instance. And so, if I have instances doubled-up in one AZ (let's say
us-east-1e), and then I lose 1e, I've now lost two instances. What are the
chances that all three of my replicas of some chunk of my data are on those
two instances? I know that it's not guaranteed that all replicas are on
separate nodes.

So is it better for me to ignore the recommendation of 5 nodes, and just do
4? Or to ignore the fact that I might be doubling-up in one AZ? Also,
another note. These are designed to be 'durable' nodes, so if one should go
down I would expect to bring it back up \*with\* its data - or, if I
couldn't, I would do a force-replace or replace and rebuild it from the
other replicas. I'm definitely not doing instance-store. So I don't know if
that mitigates my need for a full 5 nodes. I would also consider losing one
node to be "degraded" and would probably seek to fix that problem as soon
as possible, so I wouldn't expect to be in that situation for long. I would
probably tolerate a drop in performance during that time, too. (Not a
super-severe one, but 20-30 percent? Sure.)

What do you folks think?

-B.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

