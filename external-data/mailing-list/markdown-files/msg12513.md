---
title: "understanding optimistic concurrency in Riak"
description: ""
project: community
lastmod: 2013-10-03T21:21:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12513"
author_name: "Alex Rice"
project_section: "mailinglistitem"
sent_date: 2013-10-03T21:21:56-07:00

---


Just trying to paraphrase how I understand it from the Riak docs, plus
helpful feedback from Jeremiah :) Please correct if I'm not really
groking it!

with allow\_multi = false, the default setting

- To achieve CAS\* -ish behavior for updates, you can always send the
vector clock with a Put. If it fails with a modified message, then you
can retry on the client side. This is the basic optimistic
concurrency usage.
- If you also set w = all on Puts then this is \*almost\* guaranteed to
be a true global CAS operation.
- The big exception mainly being extremely frequent writes for that
key, plus some other edge cases.

with allow\_multi = true

- You can still use the vector clock to get CAS-ish behavior as above.
- You also have to resolve Sibings through client side logic each time you Get
- It's \*still\* not guaranteed to be global CAS , there are special
cases like hinted handoff, clock skew, gnarly stuff involving the
speed of light etc.

\* CAS = check and set

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

