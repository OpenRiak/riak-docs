---
title: "Re: Riak 1.4.12 high I/O while almost idle"
description: ""
project: community
lastmod: 2015-05-22T06:55:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16145"
mailinglist_parent_id: "msg16144"
author_name: "Doug Rohrer"
project_section: "mailinglistitem"
sent_date: 2015-05-22T06:55:45-07:00
---


Try running `riak-admin top` on the node to see what's going on:

http://docs.basho.com/riak/1.4.12/ops/running/tools/riak-admin/#top 


This may give you some insight into what that node is doing.

Doug


> On May 22, 2015, at 9:52 AM, Timo Gatsonides  wrote:
> 
> I have a 7 node Riak cluster. Most nodes are on 1.4.10 and I am currently 
> migrating the nodes from RedHat to Ubuntu (and Ext4 -> ZFS). 
> 
> One of the nodes is running Ubuntu 14 with ZFS for the data and has Riak 
> 1.4.12 installed. On this node Riak is continuously reading and writing a lot 
> of data. Even hours after it is started. There are no running transfers 
> (riak-admin transfers). The other nodes are not very busy, almost no CPU, no 
> I/O. For this one node see the output of iotop, uname -a, riak-admin status 
> and some recent logging below.
> 
> There is nothing obvious in the Riak logging, except that there is an 
> occasional reading/writing large object (once a minute or so, objects of 
> around 5Mb-10Mb).
> 
> Is there a way to see what Riak is doing, what it is reading/writing?
> 
> Thanks,
> Timo
> 
> Total DISK READ : 81.99 M/s | Total DISK WRITE : 33.33 M/s
> Actual DISK READ: 39.59 M/s | Actual DISK WRITE: 241.72 M/s
> TID PRIO USER DISK READ DISK WRITE SWAPIN IO> COMMAND 
> 
> 8723 be/4 riak 23.82 M/s 12.05 M/s 0.00 % 80.54 % beam.smp -K true 
> -A 64~ -smp enable -- console
> 8725 be/4 riak 4.80 M/s 814.60 B/s 0.00 % 72.67 % beam.smp -K true 
> -A 64~ -smp enable -- console
> 8657 be/4 riak 3.83 M/s 814.60 B/s 0.00 % 68.98 % beam.smp -K true 
> -A 64~ -smp enable -- console
> 698 be/0 root 0.00 B/s 0.00 B/s 0.00 % 47.67 % [txg\_sync]
> 8724 be/4 riak 13.07 M/s 7.68 M/s 0.00 % 39.04 % beam.smp -K true 
> -A 64~ -smp enable -- console
> 8726 be/4 riak 50.91 K/s 13.59 M/s 0.00 % 36.77 % beam.smp -K true 
> -A 64~ -smp enable -- console
> 7917 be/4 root 51.11 K/s 0.00 B/s 0.00 % 4.26 % [kworker/u16:5]
> 234 be/3 root 0.00 B/s 1629.19 B/s 0.00 % 0.01 % [jbd2/sda6-8]
> 8302 be/4 riak 0.00 B/s 814.60 B/s 0.00 % 0.00 % run\_erl -daemon 
> /tmp/r~ /usr/sbin/riak console
> 9942 be/4 root 0.00 B/s 0.00 B/s 0.00 % 0.00 % [kworker/u16:6]
> 10319 be/4 root 0.00 B/s 0.00 B/s 0.00 % 0.00 % [kworker/u16:0]
> 10320 be/4 root 0.00 B/s 0.00 B/s 0.00 % 0.00 % [kworker/u16:1]
> 8401 be/4 riak 0.00 B/s 814.60 B/s 0.00 % 0.00 % beam.smp -K true 
> -A 
> 
> #uname -a
> Linux tx4 3.13.0-49-generic #83-Ubuntu SMP Fri Apr 10 20:11:33 UTC 2015 
> x86\_64 x86\_64 x86\_64 GNU/Linux
> 
> sys\_system\_version : <<"Erlang R15B01 (erts-5.9.1) [source] [64-bit] 
> [smp:8:8] [async-threads:64] [kernel-poll:true]">>
> sys\_system\_architecture : <<"x86\_64-unknown-linux-gnu">>
> sys\_threads\_enabled : true
> sys\_thread\_pool\_size : 64
> sys\_wordsize : 8
> ring\_num\_partitions : 64
> ring\_creation\_size : 64
> storage\_backend : riak\_kv\_multi\_backend
> erlydtl\_version : <<"0.7.0">>
> riak\_control\_version : <<"1.4.12-0-g964c5db">>
> cluster\_info\_version : <<"1.2.4">>
> riak\_search\_version : <<"1.4.12-0-g7fe0e00">>
> merge\_index\_version : <<"1.3.2-0-gcb38ee7">>
> riak\_kv\_version : <<"1.4.12-0-gc6bbd66">>
> 
> 1-minute stats for ...
> -------------------------------------------
> riak\_kv\_stat\_ts : 1432301431
> vnode\_gets : 748
> vnode\_gets\_total : 10051
> vnode\_puts : 182
> vnode\_puts\_total : 3690
> vnode\_index\_refreshes : 0
> vnode\_index\_refreshes\_total : 0
> vnode\_index\_reads : 10
> vnode\_index\_reads\_total : 100
> vnode\_index\_writes : 182
> vnode\_index\_writes\_total : 3686
> vnode\_index\_writes\_postings : 2
> vnode\_index\_writes\_postings\_total : 139
> vnode\_index\_deletes : 0
> vnode\_index\_deletes\_total : 0
> vnode\_index\_deletes\_postings : 0
> vnode\_index\_deletes\_postings\_total : 13
> node\_gets : 0
> node\_gets\_total : 0
> node\_get\_fsm\_siblings\_mean : 0
> node\_get\_fsm\_siblings\_median : 0
> node\_get\_fsm\_siblings\_95 : 0
> node\_get\_fsm\_siblings\_99 : 0
> node\_get\_fsm\_siblings\_100 : 0
> node\_get\_fsm\_objsize\_mean : 0
> node\_get\_fsm\_objsize\_median : 0
> node\_get\_fsm\_objsize\_95 : 0
> node\_get\_fsm\_objsize\_99 : 0
> node\_get\_fsm\_objsize\_100 : 0
> node\_get\_fsm\_time\_mean : 0
> node\_get\_fsm\_time\_median : 0
> node\_get\_fsm\_time\_95 : 0
> node\_get\_fsm\_time\_99 : 0
> node\_get\_fsm\_time\_100 : 0
> node\_puts : 64
> node\_puts\_total : 1196
> node\_put\_fsm\_time\_mean : 691827
> node\_put\_fsm\_time\_median : 2168
> node\_put\_fsm\_time\_95 : 4415096
> node\_put\_fsm\_time\_99 : 8226455
> node\_put\_fsm\_time\_100 : 12045311
> read\_repairs : 0
> read\_repairs\_total : 0
> coord\_redirs\_total : 0
> 
> ==> /var/log/riak/erlang.log.1 <==
> 08:41:19.235 [info] monitor long\_gc <0.7.0> 
> [{name,application\_controller},{initial\_call,{application\_controller,start,1}},{almost\_current\_function,{gen\_server,loop,6}},{message\_queue\_len,0}]
> 
> [{timeout,293},{old\_heap\_block\_size,0},{heap\_block\_size,6765},{mbuf\_size,0},{stack\_size,23},{old\_heap\_size,0},{heap\_size,2142}]
> 08:41:19.437 [warning] Writing very large object (19730102 bytes) to <<...>>
> ==> /var/log/riak/console.log <==
> 2015-05-22 08:41:19.235 [info] 
> <0.96.0>@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc <0.7.0> 
> [{name,application\_controller},{initial\_call,{application\_controller,start,1}},{almost\_current\_function,{gen\_server,loop,6}},{message\_queue\_len,0}]
> 
> [{timeout,293},{old\_heap\_block\_size,0},{heap\_block\_size,6765},{mbuf\_size,0},{stack\_size,23},{old\_heap\_size,0},{heap\_size,2142}]
> 2015-05-22 08:41:19.437 [warning] 
> <0.710.0>@riak\_kv\_vnode:encode\_and\_put\_no\_sib\_check:1900 Writing very large 
> object (19730102 bytes) to <<...>>
> ==> /var/log/riak/erlang.log.1 <==
> 08:41:23.417 [info] monitor long\_gc <0.436.0> 
> [{name,proxy\_riak\_kv\_vnode\_68507889249886074290797726533575766546371837952},{initial\_call,{riak\_core\_vnode\_proxy,init,1}},{almost\_current\_function,{riak\_core\_vnode\_proxy,loop,2}},{message\_queue\_len,0}]
> 
> [{timeout,2093},{old\_heap\_block\_size,0},{heap\_block\_size,987},{mbuf\_size,0},{stack\_size,5},{old\_heap\_size,0},{heap\_size,481}]
> ==> /var/log/riak/console.log <==
> 2015-05-22 08:41:23.417 [info] 
> <0.96.0>@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc <0.436.0> 
> [{name,proxy\_riak\_kv\_vnode\_68507889249886074290797726533575766546371837952},{initial\_call,{riak\_core\_vnode\_proxy,init,1}},{almost\_current\_function,{riak\_core\_vnode\_proxy,loop,2}},{message\_queue\_len,0}]
> 
> [{timeout,2093},{old\_heap\_block\_size,0},{heap\_block\_size,987},{mbuf\_size,0},{stack\_size,5},{old\_heap\_size,0},{heap\_size,481}]
> ==> /var/log/riak/erlang.log.1 <==
> 08:41:25.319 [warning] Reading large object of size 12178287 from <<...>>
> ==> /var/log/riak/console.log <==
> 2015-05-22 08:41:25.319 [warning] <0.707.0>@riak\_kv\_vnode:do\_get\_object:1365 
> Reading large object of size 12178287 from <<..">>
> ==> /var/log/riak/erlang.log.1 <==
> 08:42:00.687 [info] monitor long\_gc <0.707.0> 
> [{initial\_call,{riak\_core\_vnode,init,1}},{almost\_current\_function,{eleveldb,get,3}},{message\_queue\_len,7}]
> 
> [{timeout,485},{old\_heap\_block\_size,0},{heap\_block\_size,2584},{mbuf\_size,0},{stack\_size,46},{old\_heap\_size,0},{heap\_size,909}]
> ==> /var/log/riak/console.log <==
> 2015-05-22 08:42:00.687 [info] 
> <0.96.0>@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc <0.707.0> 
> [{initial\_call,{riak\_core\_vnode,init,1}},{almost\_current\_function,{eleveldb,get,3}},{message\_queue\_len,7}]
> 
> [{timeout,485},{old\_heap\_block\_size,0},{heap\_block\_size,2584},{mbuf\_size,0},{stack\_size,46},{old\_heap\_size,0},{heap\_size,909}]
> ==> /var/log/riak/erlang.log.1 <==
> 08:42:40.036 [info] monitor long\_gc <0.712.0> 
> [{initial\_call,{riak\_core\_vnode,init,1}},{almost\_current\_function,{eleveldb,write,3}},{message\_queue\_len,0}]
> 
> [{timeout,759},{old\_heap\_block\_size,0},{heap\_block\_size,4181},{mbuf\_size,0},{stack\_size,73},{old\_heap\_size,0},{heap\_size,1683}]
> ==> /var/log/riak/console.log <==
> 2015-05-22 08:42:40.036 [info] 
> <0.96.0>@riak\_core\_sysmon\_handler:handle\_event:92 monitor long\_gc <0.712.0> 
> [{initial\_call,{riak\_core\_vnode,init,1}},{almost\_current\_function,{eleveldb,write,3}},{message\_queue\_len,0}]
> 
> [{timeout,759},{old\_heap\_block\_size,0},{heap\_block\_size,4181},{mbuf\_size,0},{stack\_size,73},{old\_heap\_size,0},{heap\_size,1683}]
> 
> 
> Some of the non-standard /etc/riak/vm.args:
> 
> ## Increase number of concurrent ports/sockets
> -env ERL\_MAX\_PORTS 64000
> ## Tweak GC to run more often 
> -env ERL\_FULLSWEEP\_AFTER 0
> ## Set the location of crash dumps
> -env ERL\_CRASH\_DUMP /var/log/riak/erl\_crash.dump
> ## Raise the ETS table limit
> -env ERL\_MAX\_ETS\_TABLES 256000
> ## Force the erlang VM to use SMP
> -smp enable
> ## For nodes with many busy\_dist\_port events, Basho recommends
> ## raising the sender-side network distribution buffer size.
> ## 32MB may not be sufficient for some workloads and is a suggested
> ## starting point.
> ## The Erlang/OTP default is 1024 (1 megabyte).
> ## See: http://www.erlang.org/doc/man/erl.html#%2bzdbbl 
> 
> +zdbbl 32768
> ## Raise the default erlang process limit 
> +P 256000
> 
> 
> Some of the non-standard /etc/riak/app.config:
> 
> %% -\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\*-
> %% ex: ts=4 sw=4 et
> [
> %% For firewall config limit ports
> { kernel, [
> {inet\_dist\_listen\_min, 6000},
> {inet\_dist\_listen\_max, 7999}
> ]},
> %% Riak Client APIs config
> %% riak\_handoff\_port is the TCP port that Riak uses for
> %% intra-cluster data handoff.
> {handoff\_port, 8099 },
> {handoff\_concurrency, 3}, 
> 
> %% Riak KV config
> {riak\_kv, [
> %% Storage\_backend specifies the Erlang module defining the 
> storage
> %% mechanism that will be used on this node.
> 
> {storage\_backend, riak\_kv\_multi\_backend},
> {multi\_backend\_default, <<"eleveldb">>},
> {multi\_backend, [ 
> {<<"eleveldb">>, riak\_kv\_eleveldb\_backend, [
> {data\_root, "/data/riak/leveldb"}
> ]},
> {<<"fs">>, riak\_kv\_eleveldb\_backend, [
> {data\_root, "/bigdata/riak/bigleveldb"}
> ]},
> {<<"cache">>, riak\_kv\_memory\_backend, [
> {max\_memory, 16}, %% 16Mb
> {ttl, 86400} %% 1 Day in seconds
> ]}
> ]},
> 
> {anti\_entropy, {off, []}},
> {vnode\_vclocks, true},
> {legacy\_keylisting, false},
> {listkeys\_backpressure, true},
> {legacy\_vnode\_routing, false},
> {fsm\_limit, 50000},
> {object\_format, v1}
> ]},
> {riak\_search, [
> %% To enable Search functionality set this 'true'.
> {enabled, false}
> ]},
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

