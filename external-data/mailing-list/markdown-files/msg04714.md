---
title: "Re: riak-1.0.0pre2 segfaults"
description: ""
project: community
lastmod: 2011-09-14T14:07:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04714"
mailinglist_parent_id: "msg04678"
author_name: "Jeff Pollard"
project_section: "mailinglistitem"
sent_date: 2011-09-14T14:07:15-07:00
---


FWIW, we also ran in to intermittent segfaullts in erlang\_js\_drv.so on
Ubuntu 10.04on EC2 and ended up rewriting our M/R jobs in erlang. We saw
log lines like this:

Aug 11 16:29:08 ip-10-66-190-207 kernel: [3281113.735644] beam.smp[22173]:
> segfault at 8 ip 00007fe7842a6412 sp 00007fe7877f5d40 error 4 in
> erlang\_js\_drv.so[7fe784275000+e6000]
> Aug 11 16:33:38 ip-10-66-190-207 kernel: [3281659.604561] beam.smp[25277]:
> segfault at 2a9 ip 00007fe67323bef6 sp 00007fe676523d38 error 4 in
> erlang\_js\_drv.so[7fe673209000+e6000]
> Aug 11 22:31:09 ip-10-66-190-207 kernel: [3303109.375523] beam.smp[26178]:
> segfault at 18 ip 00007f4a21865af2 sp 00007f4a24a46c98 error 4 in
> erlang\_js\_drv.so[7f4a2180f000+e6000]


Not sure if it's related to your issue or not, but we were told it was
likely this bug:

https://issues.basho.com/show\_bug.cgi?id=1151

On Mon, Sep 12, 2011 at 7:19 PM, Ryan Zezeski  wrote:

> Henrik,
>
> I'm not familiar with riaktant but it looks like an invalid query is being
> passed in. I.e. an empty query. This empty query causes and error in the
> query parser and then it appears a segfault in the js driver.
>
> E.g. here I replicate the error at the console:
>
> (riak@127.0.0.1)5> search:search(<<"bucket">>, <<>>).
> \*\* exception error: no match of right hand side value
> {error,{lucene\_parse,"syntax error before: "}}
> in function riak\_search\_client:parse\_query/3
> in call from search:search/3
>
> -Ryan
>
> On Mon, Sep 12, 2011 at 4:09 PM, Henrik Johansen  wrote:
>
>> Hello list,
>>
>> I have been playing with single node riak-1.0.0pre2 cluster & riaktant
>> today and somehow I managed to get riak to segfault every time I tried using
>> the MapReduce functions in riaktant.
>>
>> Riak-1.0.0pre2 was installed using the 64-bit Debian package on my
>> Ubuntu 11.04 laptop - riaktant was pulled form GitHub.
>>
>> I have gathered some relevant info below - if I can assist in any way
>> please let me know ...
>>
>> dmesg :
>> [10488.941750] beam.smp[1496]: segfault at 7f4d61d73ff8 ip
>> 00007f4d5ea7a83e sp 00007f4d61d74000 error 6 in
>> erlang\_js\_drv.so[7f4d5ea35000+\*\*e6000]
>> [10944.335495] beam.smp[4681]: segfault at 7fcda9892ff8 ip
>> 00007fcda386783e sp 00007fcda9893000 error 6 in
>> erlang\_js\_drv.so[7fcda3822000+\*\*e6000]
>> [11658.589251] beam.smp[6604]: segfault at 7fee7166eff8 ip
>> 00007fee6dc4983e sp 00007fee7166f000 error 6 in
>> erlang\_js\_drv.so[7fee6dc04000+\*\*e6000]
>>
>> crash.log :
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_builder\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1556.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> builder,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,brutal\_kill},{child\_\*\*type,worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_fitting\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1558.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> fitting,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,2000},{child\_type,\*\*worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_fitting\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1559.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> fitting,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,2000},{child\_type,\*\*worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_fitting\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1557.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> fitting,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,2000},{child\_type,\*\*worker}]
>>
>> error.log :
>> 2011-09-12 21:49:03.025 [error] <0.132.0> Supervisor riak\_pipe\_builder\_sup
>> had child at module undefined at <0.1556.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.028 [error] <0.133.0> Supervisor riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1558.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.031 [error] <0.133.0> Supervisor riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1559.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.033 [error] <0.133.0> Supervisor riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1557.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>>
>> /HenrikJ
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com
>>
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

