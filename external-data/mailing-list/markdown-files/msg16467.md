---
title: "Re: indexes_not_supported,riak_kv_bitcask_backend error on multi	backend with leveldb"
description: ""
project: community
lastmod: 2015-08-27T20:17:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16467"
mailinglist_parent_id: "msg16466"
author_name: "Bora Kou"
project_section: "mailinglistitem"
sent_date: 2015-08-27T20:17:45-07:00
---


We found the issue. It turned out that the "storage\_backend" setting is
still bitcask on all the node except the one I was testing on. After
making sure all node have "storage\_backend = multi", the secondary index
works as expected. My bad, sorry for the noise :(

-Bora

On Thu, Aug 27, 2015 at 5:05 PM, Bora Kou  wrote:

> Hi,
>
> I am testing out riak kv multi backend with leveldb and bitcask. I
> configured bitcask as the default backend and leveldb with bucket-type. I
> am using riak kv version 2.0.5-1.
>
> I am able to do http PUT with index, but when I try to GET with the index,
> it give me "{error,{indexes\_not\_supported,riak\_kv\_bitcask\_backend}}}"
>
> Am I missing something? Is this type of setting supported?
>
> Here is the information:
>
> ## PUT (with index work fine)
> \*curl -v -XPUT
> localhost:8098/types/xfiles/buckets/xfiles\_master\_aws\_pod98/keys/john \\*
> \* -H "x-riak-index-email\_bin: j...@example.com " \\*
> \* -d 'John Testing'\*
>
> \*\* About to connect() to localhost port 8098 (#0)\*
> \*\* Trying 127.0.0.1... connected\*
> \*> PUT /types/xfiles/buckets/xfiles\_master\_aws\_pod98/keys/john HTTP/1.1\*
> \*> User-Agent: curl/7.22.0 (x86\_64-pc-linux-gnu) libcurl/7.22.0
> OpenSSL/1.0.1 zlib/1.2.3.4  libidn/1.23 librtmp/2.3\*
> \*> Host: localhost:8098\*
> \*> Accept: \*/\*\*
> \*> x-riak-index-email\_bin: j...@example.com \*
> \*> Content-Length: 12\*
> \*> Content-Type: application/x-www-form-urlencoded\*
> \*> \*
> \*\* upload completely sent off: 12out of 12 bytes\*
> \*< HTTP/1.1 204 No Content\*
> \*< Vary: Accept-Encoding\*
> \*< Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)\*
> \*< Date: Thu, 27 Aug 2015 23:32:20 GMT\*
> \*< Content-Type: application/x-www-form-urlencoded\*
> \*< Content-Length: 0\*
> \*< \*
> \*\* Connection #0 to host localhost left intact\*
> \*\* Closing connection #0\*
>
> ## GET INDEX (got error)
> \*curl -v
> localhost:8098/types/xfiles/buckets/xfiles\_master\_aws\_pod98/index/email\_bin/j...@example.com
> \*
>
> \*\* About to connect() to localhost port 8098 (#0)\*
> \*\* Trying 127.0.0.1... connected\*
> \*> GET
> /types/xfiles/buckets/xfiles\_master\_aws\_pod98/index/email\_bin/j...@example.com
>  HTTP/1.1\*
> \*> User-Agent: curl/7.22.0 (x86\_64-pc-linux-gnu) libcurl/7.22.0
> OpenSSL/1.0.1 zlib/1.2.3.4  libidn/1.23 librtmp/2.3\*
> \*> Host: localhost:8098\*
> \*> Accept: \*/\*\*
> \*> \*
> \*< HTTP/1.1 500 Internal Server Error\*
> \*< Vary: Accept-Encoding\*
> \*< Server: MochiWeb/1.1 WebMachine/1.10.5 (jokes are better explained)\*
> \*< Date: Thu, 27 Aug 2015 23:41:52 GMT\*
> \*< Content-Type: text/html\*
> \*< Content-Length: 305\*
> \*< \*
> \*\* Connection #0 to host localhost left intact\*
> \*\* Closing connection #0\*
> \*500 Internal Server
> ErrorInternal Server Error
=====================

The server
> encountered an error while processing this
> request:  

```
{error,{error,{indexes_not_supported,riak_kv_bitcask_backend}}}
```


---

mochiweb+webmachine
> web server

\*
>
> ## GET THE KEY (work fine)
> \*curl
> localhost:8098/types/xfiles/buckets/xfiles\_master\_aws\_pod98/keys/john\*
> \*John Testing\*
>
>
> ## BUCKET-TYPE
> \*riak-admin bucket-type list\*
> \*default (active)\*
> \*xfiles (active)\*
>
> \*riak-admin bucket-type status xfiles\*
> \*xfiles is active\*
>
> \*active: true\*
> \*allow\_mult: true\*
> \*backend: <<"leveldb\_multi">>\*
> \*basic\_quorum: false\*
> \*big\_vclock: 50\*
> \*chash\_keyfun: {riak\_core\_util,chash\_std\_keyfun}\*
> \*claimant: 'r...@riak-test1.example.com '\*
> \*dvv\_enabled: true\*
> \*dw: quorum\*
> \*last\_write\_wins: false\*
> \*linkfun: {modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}\*
> \*n\_val: 3\*
> \*notfound\_ok: true\*
> \*old\_vclock: 86400\*
> \*postcommit: []\*
> \*pr: 0\*
> \*precommit: []\*
> \*pw: 0\*
> \*r: quorum\*
> \*rw: quorum\*
> \*small\_vclock: 50\*
> \*w: quorum\*
> \*young\_vclock: 20\*
>
>
> ## MY CONFIGURATION (6 nodes)
> \*cat /etc/riak/riak.conf | grep multi\*
> \*storage\_backend = multi\*
> \*multi\_backend.bitcask\_multi.storage\_backend = bitcask\*
> \*multi\_backend.bitcask\_multi.bitcask.data\_root = /var/lib/riak/bitcask\*
> \*multi\_backend.leveldb\_multi.storage\_backend = leveldb\*
> \*multi\_backend.leveldb\_multi.leveldb.data\_root = /var/lib/riak/leveldb\*
> \*multi\_backend.leveldb\_multi.leveldb.maximum\_memory.percent = 30\*
> \*multi\_backend.leveldb\_multi.leveldb.compaction.trigger.tombstone\_count =
> 1000\*
> \*multi\_backend.default = bitcask\_multi\*
>
> \*cat /var/lib/riak/generated.configs/\* | grep multi\*
> \* {storage\_backend,riak\_kv\_multi\_backend},\*
> \* {multi\_backend\_default,<<"bitcask\_multi">>},\*
> \* {multi\_backend,\*
> \* [{<<"bitcask\_multi">>,riak\_kv\_bitcask\_backend,\*
> \* {<<"leveldb\_multi">>,riak\_kv\_eleveldb\_backend,\*
>
>
>
>
> Thank you,
>
>
> -Bora
>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

