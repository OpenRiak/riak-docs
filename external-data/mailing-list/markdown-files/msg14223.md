---
title: "Re: Facing exception error in riak-erlang client in erlang shell	while doing Mapreduce"
description: ""
project: community
lastmod: 2014-05-17T07:53:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14223"
mailinglist_parent_id: "msg14222"
author_name: "Steve Vinoski"
project_section: "mailinglistitem"
sent_date: 2014-05-17T07:53:32-07:00
---


On Sat, May 17, 2014 at 10:04 AM, Gopi Krishna  wrote:

> Hi,
>
> I am getting the following , don't know what was happening could you
> please elaborate and explain the solution to this.
>
> I am working on erlang-riak-client.
>
>
> 1> {ok, Pid} = riakc\_pb\_socket:start\_link('127.0.0.1',10017).
> {ok,<0.34.0>}
> 2>
> 2>
> 2> Object = riakc\_obj:new(<<"test\_age">>, <<"test1">>, <<"gopi & 1">>).
> {riakc\_obj,<<"test\_age">>,<<"test1">>,undefined,[],
> undefined,<<"gopi & 1">>}
> 3>
> 3>
> 3> riakc\_pb\_socket:put(Pid,Object).
> ok
> 4>
> 4> Mapf = fun(Obj,\_,\_) -> [{I,1}|| I <-
> binary\_to\_term(riak\_object:get\_value(Object))] end.
>

There are two problems with your Mapf function:

1. The body of the function incorrectly uses Object, which is a variable in
your shell from command 2, rather than Obj, the incoming parameter to the
function. This is the source of the function\_clause error you're getting.

2. You've stored a binary value in your object, not an Erlang term, so
binary\_to\_term will fail here with a badarg exception. Change your Mapf
function to this instead:

Mapf = fun(Obj,\_,\_) -> [riak\_object:get\_value(Obj)] end.

#Fun
> 5> {ok, [{0,[R]}]} =
> riakc\_pb\_socket:mapred(Pid,<<"test\_age">>,[{map,{qfun,Mapf},none,true}])
> 5> .
> \*\* exception error: no match of right hand side value
> {error,<<"{\"phase\":0,\"error\":\"function\_clause\",\"input\":\"{ok,{r\_object,<<\\\"test\_age\\\">>,<<\\\"test1\\\">>,[{r\_content,{dict"...>>}
>

If you make the changes I described above, you get:

5> {ok, [{0,[R]}]} =
riakc\_pb\_socket:mapred(Pid,<<"test\_age">>,[{map,{qfun,Mapf},none,true}]).
{ok,[{0,[<<"gopi & 1">>]}]}
6> R.
<<"gopi & 1">>

exactly as expected.

--steve
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

