---
title: "Re: Index query mapreduce error"
description: ""
project: community
lastmod: 2011-11-11T09:19:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05553"
mailinglist_parent_id: "msg05530"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-11-11T09:19:09-08:00
---


Ben,

The problem is you are using the legacy MapReduce system instead of the new 
pipe system. If you edit the riak app.config and change the mapred\_system 
setting to pipe instead of legacy, it should resolve the issue. The app.config 
file can be found in /etc/riak if you installed from one of the prebuilt 
packages. 

Kelly


On Nov 9, 2011, at 5:26 PM, Ben Kempe wrote:

> Hi everybody,
> We have JSON data in a Riak 1.0/leveldb bucket with an index createdat\_int.
> 
> http://localhost:8098/buckets/data/index/createdat\_int/50000/1320883249
> 
> works, but
> 
> curl -X POST \
> -H "content-type: application/json" \
> -d @- \
> http://localhost:8098/mapred \
> < {
> "inputs":{
> "bucket":"data",
> "index":"createdat\_int",
> "start":"50000",
> "end":"1320883249"
> },
> "query":[
> {
> "reduce":{
> "language":"erlang",
> "module":"riak\_kv\_mapreduce",
> "function":"reduce\_identity",
> "keep":true
> }
> }
> ]
> }
> EOF
> 
> fails with the following message:
> 
> {throw,
> {invalid\_inputdef,
> {index,<<"data">>,<<"createdat\_int">>,50000,
> 1320883249}},
> [{riak\_client,mapred\_dynamic\_inputs\_stream,4},
> {riak\_kv\_wm\_mapred,legacy\_mapred,2},
> {webmachine\_resource,resource\_call,3},
> {webmachine\_resource,do,3},
> {webmachine\_decision\_core,resource\_call,1},
> {webmachine\_decision\_core,decision,1},
> {webmachine\_decision\_core,handle\_request,2},
> 
> {webmachine\_mochiweb,loop,1}]}}

---

mochiweb+webmachine web 
> server
> 
> What's the cause for this problem?
> I tried to stay close to the examples in the docs.
> 
> Thanks, Ben
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com



