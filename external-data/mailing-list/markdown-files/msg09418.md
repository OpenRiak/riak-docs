---
title: "Re: Erlang MR bulk fetch"
description: ""
project: community
lastmod: 2012-12-02T17:31:11-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09418"
mailinglist_parent_id: "msg09417"
author_name: "Elias Levy"
project_section: "mailinglistitem"
sent_date: 2012-12-02T17:31:11-08:00
---


I should mention that I can't use the existing map\_identify function.
 Doing so causes the PB connection to die. Presumably there is some binary
data within the RObject that cases an error when Riak tries to convert it
to JSON.


On Sun, Dec 2, 2012 at 5:26 PM, Elias Levy wrote:

> While processing a request I am finding that I am spending most of my time
> fetching data from Riak. As I am using the Ruby client I can't
> parallelise them, as it does not support non-blocking IO and I don't want
> to spawn many threads.
>
> For these requests I am willing to accept an R of 1, so I can use a MR job
> as a bulk fetch, but I would prefer to avoid the JS VM, as its rather
> slow and I don't want to worry about running out of VMs at the wrong time.
>
> I can easily fetch the values using only Erlang MR by adding the keys to
> my MR object and doing
>
> map(["riak\_kv\_mapreduce", "map\_object\_value"], :arg => [ true ],
> :keep => true).
>
> but this gives me an array of values. I need to to know the which values
> are associated with what key, and my values do not include the key or
> otherwise allow me to map them.
>
> From looking at the Riak code there does not seem to exist an exported
> Erlang map function that will return a value with its key.
>
> Did I miss one? Is such a function somewhere in the source? If not,
> anyone have one handy they'd like to share?
>
>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

