---
title: "Re: Riak.mapValuesJson crashes on \r\n"
description: ""
project: community
lastmod: 2011-03-23T14:14:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02718"
mailinglist_parent_id: "msg02717"
author_name: "Michael Ossareh"
project_section: "mailinglistitem"
sent_date: 2011-03-23T14:14:15-07:00
---


Thanks for the super quick response - 3 minutes!

I grabbed Crockford's json2.js and had to disable his check for existing
implementations. I've documented this here:
http://ossareh.posterous.com/how-to-patch-riak-0140-to-avoid-the-newline-p

Cheers,

mike

On Wed, Mar 23, 2011 at 13:34, Aphyr  wrote:

> Newline parsing is broken in JSON2.js shipped with Riak. Drop a more recent
> version of JSON2.js in the directory referred to by js\_source\_dir in
> app.config's riak\_kv section, e.g.
>
> {js\_source\_dir, "/etc/riak/js/"}
>
> and reload the node.
>
> --Kyle
>
>
> On 03/23/2011 01:31 PM, Michael Ossareh wrote:
>
>> Greets,
>>
>> https://gist.github.com/883872
>>
>> That stack trace is the product of calling Riak.mapValuesJson in a map
>> phase of a map reduce job. I checked the same parsing against Chrome and
>> Firefox and they both parse the string as I'd expect. The object, as a
>> string, that is being parsed is:
>>
>> "{\"bar\":\"baz\\r\\nfrob\"}"
>>
>> The setup is: Riak 0.14.0 on Mac OS X 10.6.6 and CentOS 5.5
>>
>>
>> Any advice / pointers, greatly appreciated. Also, let me know if there
>> is anything else I can do to help.
>>
>> Cheers,
>>
>> mike
>>
>>
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

