---
title: "Re: Riak map reduce returning all results"
description: ""
project: community
lastmod: 2011-01-27T04:54:35-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02132"
mailinglist_parent_id: "msg02131"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-01-27T04:54:35-08:00
---


mapValuesJson (
https://github.com/basho/riak\_kv/blob/master/priv/mapred\_builtins.js#L45)
takes a JSON formatted string and returns it as a JavaScript object. You'll
still need to do something with it to make the magic happen.

mr = Riak::MapReduce.new(client)
mr.add("stocks")
mr.map("function(value, keyData, arg) {
 var data = Riak.mapValuesJson(value)[0];
 if (data.abr == "GOOG") {
 // magic happens here
 return [data];
 }
}", :keep => true, :language => "JavaScript")



Jeremiah Peschka
Microsoft SQL Server MVP
MCITP: Database Developer, DBA


On Thu, Jan 27, 2011 at 7:37 AM, Joshua Partogi wrote:

> Hi all,
>
> I am trying to do map reduce with the ruby client as such:
> client = Ripple.client
> Riak::MapReduce.new(client).
> add("stocks").
> map("Riak.mapValuesJson", :arg => "GOOG", :keep => true)
>
> where the JSON document inside the bucket is as such:
>
> { "abr" : "GOOG" }
> { "abr" : "AAPL" }
>
> However instead of returning only one result it is returning all values in
> the bucket.
>
> What am I doing wrong here?
>
> Thanks heaps for the help.
>
> --
> http://twitter.com/jpartogi 
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

