---
title: "Re: Recommended riak configuration options for better performance"
description: ""
project: community
lastmod: 2014-06-05T06:46:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14288"
mailinglist_parent_id: "msg14287"
author_name: "Alex Moore"
project_section: "mailinglistitem"
sent_date: 2014-06-05T06:46:22-07:00
---


Hi Naveen,

You are running out of MR workers, you’ll either have to:
a) Increase the worker limits on the current nodes (particularly 
map\_js\_vm\_count and reduce\_js\_vm\_count)
b) Add more nodes (and thereby more workers)
c) Do less MR work.
d) Implement your MapReduce functions in Erlang to avoid the JS VM altogether

Bryan Fink has a nice writeup on how to estimate your MR worker needs here: 
http://riak-users.197444.n3.nabble.com/Follow-up-Riak-Map-Reduce-error-preflist-exhausted-tp4024330p4024380.html

Thanks,
Alex

On Jun 4, 2014, at 7:58 AM, Naveen Tamanam  wrote:

> Hi Guys, 
> 
> 
> I have 5 nodes riak cluster in use. Each machine is having 16GB ram. All 
> those 5 machines are 
> ​dedicated for riak only. No other application is there to eat resources. ​ 
> ​I use to do a lot of work with
> map reduce queries. Having a may map reduce queries with both map and reduce 
> phases. 
> I have many cases with the the following error and log messages, ​
> ​ 
> "error":"[preflist\_exhausted]"
> RiakError: 'could not get a response' 
> All VMs are busy
> 
> I know above errors can be avoided with fine tuned riak configuration 
> options. I am looking for recommended values
> Here are few riak configuration options currently I have on each node, 
> 
> { kernel, [
> {inet\_dist\_listen\_min, 6000},
> {inet\_dist\_listen\_max, 7999}
> ]},
> 
> {map\_js\_vm\_count, 48 },
> {reduce\_js\_vm\_count, 26 },
> {hook\_js\_vm\_count, 12 },
> {js\_max\_vm\_mem, 32},
> {js\_thread\_stack, 16}
> 
> 
> 
> 
> 
> 
> 
> 
> 
> ​
> -- 
> Thanks & Regards,
> Naveen Tamanam ​​
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

