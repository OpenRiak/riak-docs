---
title: "Re: Riak search fails to index via riakc_pb client"
description: ""
project: community
lastmod: 2014-03-31T08:20:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13955"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2014-03-31T08:20:08-07:00

---


>
> Index via the erlang client (error)
>
> ===================================
>
> Eshell V5.9.2 (abort with ^G)
> 1> {ok, Conn} = riakc\_pb\_socket:start\_link("localhost", 8087).
> {ok,<0.34.0>}
> 2> Body = <<"{\"name\_s\":\"tom\"}">>.
> <<"{\"name\_s\":\"tom\"}">>
> 3> Object2Store = 
> riakc\_obj:new({<<"testtype">>,<<"somebucket">>},<<"00001">>,Body).
>
> {riakc\_obj,{<<"testtype">>,<<"somebucket">>},
> <<"00002">>,undefined,[],undefined,
> <<"{\"name\_s\":\"tom\"}">>}
> 4> ok = riakc\_pb\_socket:put(Conn,Object2Store).
> ok
>
> The object is stored (in riak), but not indexed (in solr):
> $ curl "http://localhost:8098/types/testtype/buckets/somebucket/keys/
> 00001"
> {"name\_s":"tom"}
>
> ==> /../riak-yokozuna-0.14.0-src/rel/riak/log/console.log <==
> 2014-03-31 16:26:11.568 [error] <0.1448.0>@yz\_kv:index:204 failed to
> index object {{<<"testtype">>,<<"somebucket">>},<<"00001">>} with error
> badarg because
> [{dict,fetch,[<<"content-type">>,{dict,4,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[[<<"dot">>|{<<35,9,254,249,83,57,16,45>>,{1,63563491571}}]],[],[],[],[],[],[[<<"X-Riak-VTag">>,53,117,84,48,117,57,84,88,70,88,98,79,53,77,77,76,103,67,102,55,100,74]],[[<<"index">>]],[],[[<<"X-Riak-Last-Modified">>|{1396,272371,362491}]],[],[]}}}],[{file,"dict.erl"},{line,125}]},{yz\_doc,extract\_fields,1,[{file,"src/yz\_doc.erl"},{line,99}]},{yz\_doc,make\_doc,5,[{file,"src/yz\_doc.erl"},{line,71}]},{yz\_doc,'-make\_docs/4-lc$^0/1-0-',5,[{file,"src/yz\_doc.erl"},{line,60}]},{yz\_kv,index,7,[{file,"src/yz\_kv.erl"},{line,249}]},{yz\_kv,index,3,[{file,"src/yz\_kv.erl"},{line,191}]},{riak\_kv\_vnode,actual\_put,6,[{file,"src/riak\_kv\_vnode.erl"},{line,1391}]},{riak\_kv\_vnode,perform\_put,3,[{file,"src/riak\_kv\_vnode.erl"},{line,1380}]}]
>

You failed to provide a content-type when building the object. It's
not easy to see if you aren't used to Erlang but the error in the log
shows a failure to find the key <<"content-type">> in the object's
metadata.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

