---
title: "Re: Issues with high node load and very slow response"
description: ""
project: community
lastmod: 2014-07-27T22:56:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14557"
mailinglist_parent_id: "msg14556"
author_name: "Chaim Solomon"
project_section: "mailinglistitem"
sent_date: 2014-07-27T22:56:16-07:00
---


Hi,


Responses inline

On Mon, Jul 28, 2014 at 5:30 AM, Jordan West  wrote:

> Unfortunately, there are several conditions that could cause this. To rule
> out the obvious ones can you verify that `riak@10.128.137.185` has search
> enabled. If it is the case that search is enabled we can try a few
> different things to debug further.
>
>
All nodes have search=on in the riak.conf and I see the Java process.

Attaching to 'riak@10.128.138.25' (via "riak attach") and using the shell,
> if you could provide the output of:
>
> ```
> rpc:multicall([node() | nodes()], app\_helper, get\_env, [yokozuna, enabled,
> false], 5000).
> ```
>
> Eshell V5.10.3 (abort with ^G)
(riak@10.128.138.25)1> rpc:multicall([node() | nodes()], app\_helper,
get\_env, [yokozuna, enabled, false], 5000).
{[true,true,true,true,true,true,true],[]}

As well as:
>
> ```
> [riak\_core\_node\_watcher:services(N) || N <- [node() | nodes()]].
> ```
>
> (riak@10.128.138.25)2> [riak\_core\_node\_watcher:services(N) || N <-
[node() | nodes()]].
[[yokozuna,riak\_pipe,riak\_kv],
 [yokozuna,riak\_pipe,riak\_kv],
 [yokozuna,riak\_pipe,riak\_kv],
 [yokozuna,riak\_pipe,riak\_kv],
 [yokozuna,riak\_pipe,riak\_kv],
 [yokozuna,riak\_pipe,riak\_kv],
 [yokozuna,riak\_pipe,riak\_kv]]

And finally:
>
> ```
> yz\_kv:is\_metadata\_consistent('riak@10.127.137.185').
> ```
>
> (riak@10.128.138.25)3> yz\_kv:is\_metadata\_consistent('riak@10.127.137.185
').
\*\* exception exit: {{nodedown,'riak@10.127.137.185'},
 {gen\_server,call,
 [{riak\_core\_metadata\_hashtree,
 'riak@10.127.137.185'},
 {prefix\_hash,{core,bucket\_types}},
 1000]}}
 in function gen\_server:call/3 (gen\_server.erl, line 188)
 in call from yz\_kv:is\_metadata\_consistent/1 (src/yz\_kv.erl, line 433)

Based on the output of those we can debug further.
>
> Additionally, its entirely possible that when we get rid of that error it
> will not resolve the primary issue (CPU usage/request slowness). However,
> the check that is the source of that log message can block in the request
> path, so something funky could certainly be going on.
>


Chaim Solomon
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

