---
title: "Re: Riak2.0 with Solr Search: index on one node contains not all	entries"
description: ""
project: community
lastmod: 2015-03-25T07:12:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15925"
mailinglist_parent_id: "msg15924"
author_name: "Zeeshan Lakhani"
project_section: "mailinglistitem"
sent_date: 2015-03-25T07:12:07-07:00
---


Hello Michael,

First off, that section of the docs related to search index repair that you 
linked to is not referring to Riak Search 2.0 with Solr, and the link itself is 
actually pointing to Riak 1.4.7. Weâ€™ll update them accordingly for the current 
incarnation of Riak Search (for the 2.0 series).

Just to be sure, does your custom schema include the required fields, as 
mentioned in the docs: 
http://docs.basho.com/riak/latest/dev/advanced/search-schema/#Custom-Schemas? 
 
Are these Riak nodes joined? Whatâ€™s your ring size, n\_val value?

How are you querying the Solr nodes to know which node has the data and which 
one doesn't? Coverage is R=1, so you would be getting a different number on 
some search queries (using the standard /search/query/?...) if its 
only on one of the Solr cores.

Can you also post me a screenshot of your search AAE exchanges, e.g. 
`riak-admin search aae-status`? You could look at this thread, 
http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2015-March/016926.html
 
,
 for answers on how to perform read-repair/repair the AAE tree.

Thanks.

Zeeshan Lakhani
programmer | 
software engineer at @basho | 
org. member/founder of @papers\_we\_love | paperswelove.org
twitter => @zeeshanlakhani

> On Mar 25, 2015, at 6:42 AM, Michael Weibel  wrote:
> 
> Hi all,
> 
> I have on a test environment two riak nodes and each of them has solr 
> activated which index 3 buckets using a custom schema.
> After testing a bit back and forth, I have the case that on one solr node, an 
> entry is not in the index (I know in which node though). 
> Fetching the specific key in the bucket works however, both nodes have the 
> respective entry.
> 
> 1) How can this happen? I don't see any error/warning in the logs (neither 
> solr nor riak logs). 
> 2) Is there a possibility to fix this without having to do e.g. a PUT on the 
> specific key with the same content in order to update it?
> 
> I tried to run a repair on the failing node using the guide: 
> http://docs.basho.com/riak/1.4.7/ops/running/recovery/repairing-indexes/#Repairing-Search-Indexes
> 
> 
> When running the repair command on the partitions I received, it gave me 
> however a [{, down}, {...}] response, which gives me an 
> uncomfortable feeling, but I didn't really figure out yet what this means 
> exactly. 
> 
> Thanks a lot for your help :)
> 
> Best,
> Michael
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

