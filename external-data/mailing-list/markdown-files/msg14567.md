---
title: "Re: riak 2.0 - java client 'unavailable' exception"
description: ""
project: community
lastmod: 2014-07-28T16:57:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg14567"
mailinglist_parent_id: "msg14566"
author_name: "Joseph Blomstedt"
project_section: "mailinglistitem"
sent_date: 2014-07-28T16:57:07-07:00
---


This means the consistency sub-system is not enabled/active. You can
verify this with the output of `riak-admin ensemble-status`.

To enable strong consistency you must:

1) Set 'strong\_consistency = on' in riak.conf.
2) Have at least a 3 node cluster.

You can address #2 by setting up 3+ local developer nodes as detailed
in the 5 minute tutorial:
http://docs.basho.com/riak/2.0.0/quickstart

Alternatively, you can override the need for 3 nodes and use 1 node.

To do that,

1) Run 'riak attach' to attach to your Riak's node console
2) Enter (including the period): riak\_ensemble\_manager:enable().
3) Enter (including the period): riak\_core\_ring\_manager:force\_update().
3) Detach from the console using: Ctrl-C a

After either approach, re-check `riak-admin ensemble-status`. It may
take up to a minute for the consistency sub-system to be enabled.

If you haven't already, please take a look at the temporary (until we
finish updating docs.basho.com) strong consistency related
documentation (linked from the 2.0 RC1 release notes) here:
https://github.com/basho/riak\_ensemble/blob/wip/riak-2.0-user-docs/riak\_consistent\_user\_docs.md

Regards,
Joe

On Mon, Jul 28, 2014 at 3:05 PM, Jason W  wrote:
> Hi,
>
> I am trying out 2.0 w/ just one local node, created a strongly consistent
> bucket type. But keep getting below exception. If I just use the default
> bucket type, everything works fine. Here is the bucket type detail with
> consistency bit on.
>
> young\_vclock: 20
> w: quorum
> small\_vclock: 50
> rw: quorum
> r: quorum
> pw: 0
> precommit: []
> pr: 0
> postcommit: []
> old\_vclock: 86400
> notfound\_ok: true
> n\_val: 1
> linkfun: {modfun,riak\_kv\_wm\_link\_walker,mapreduce\_linkfun}
> last\_write\_wins: false
> dw: quorum
> dvv\_enabled: true
> chash\_keyfun: {riak\_core\_util,chash\_std\_keyfun}
> big\_vclock: 50
> basic\_quorum: false
> allow\_mult: true
> consistent: true
> active: true
> claimant: 'riak@0.0.0.0'
>
> Here is the java code
>
> List addresses = new LinkedList();
>
> addresses.add("172.16.0.254");
>
> RiakClient riakClient = RiakClient.newClient(addresses);
>
> try {
>
> Location wildeGeniusQuote = new Location(new
> Namespace("strongly\_consistent2", "sample"), emp.getId());
>
> BinaryValue text =
> BinaryValue.create(objectMapper.writeValueAsBytes(sampleObj));
>
> RiakObject obj = new RiakObject()
>
> .setContentType("text/plain")
>
> .setValue(text);
>
> StoreValue store = new
> StoreValue.Builder(obj).withLocation(wildeGeniusQuote)
>
> .withOption(Option.ASIS, true)
>
> .withOption(Option.DW, new Quorum(1))
>
> .withOption(Option.IF\_NONE\_MATCH, true)
>
> .withOption(Option.IF\_NOT\_MODIFIED, true)
>
> .withOption(Option.PW, new Quorum(1))
>
> .withOption(Option.N\_VAL, 1)
>
> .withOption(Option.RETURN\_BODY, true)
>
> .withOption(Option.RETURN\_HEAD, true)
>
> .withOption(Option.SLOPPY\_QUORUM, true)
>
> .withOption(Option.TIMEOUT, 1000)
>
> .withOption(Option.W, new Quorum(1))
>
> .build();
>
> riakClient.execute(store);
>
> } catch (Exception e) {
>
> e.printStackTrace();
>
> return null;
>
> }
>
> Am I still missing something? Thanks.
>
>
>
> Caused by: com.basho.riak.client.core.netty.RiakResponseException:
> unavailable
>
> at
> com.basho.riak.client.core.netty.RiakResponseHandler.channelRead(RiakResponseHandler.java:52)
>
> at
> io.netty.channel.DefaultChannelHandlerContext.invokeChannelRead(DefaultChannelHandlerContext.java:340)
>
> at
> io.netty.channel.DefaultChannelHandlerContext.fireChannelRead(DefaultChannelHandlerContext.java:326)
>
> at
> io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:155)
>
> at
> io.netty.handler.codec.ByteToMessageCodec.channelRead(ByteToMessageCodec.java:108)
>
> at
> io.netty.channel.DefaultChannelHandlerContext.invokeChannelRead(DefaultChannelHandlerContext.java:340)
>
> at
> io.netty.channel.DefaultChannelHandlerContext.fireChannelRead(DefaultChannelHandlerContext.java:326)
>
> at
> io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:785)
>
> at
> io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:116)
>
> at
> io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:494)
>
> at
> io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:461)
>
> at
> io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:378)
>
> at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:350)
>
> at
> io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:101)
>
> ... 1 more
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>



-- 
Joseph Blomstedt 
Principal Engineer
Basho Technologies, Inc.
http://www.basho.com/

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

