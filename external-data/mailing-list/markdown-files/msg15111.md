---
title: "UTF-8 encoding issue with Riak potobuffer"
description: ""
project: community
lastmod: 2014-11-01T22:54:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15111"
author_name: "kushagra singh"
project_section: "mailinglistitem"
sent_date: 2014-11-01T22:54:39-07:00

---


Hello list,

I am using Riak 2.0.0rc1 and nlf’s riakpbc  
client. While performing a map reduce operation with the request input: inputs: 
['test1', 'mapred\_test’] where ‘test1’ is the bucket type and executing the 
‘Riak.mapValuesJson’ function, I am getting the following error:

{ [Error: Error processing stream message: 
exit:{ucs,{bad\_utf8\_character\_code}}:[{xmerl\_ucs,
 
from\_utf8,
 1,
 [{file,
 
"xmerl\_ucs.erl"},
 {line,
 
185}]},
 
{mochijson2,
 
json\_encode\_string,
 2,
 [{file,
 
"src/mochijson2.erl"},
 {line,
 
186}]},
 
{mochijson2,
 
'-json\_encode\_proplist/2-fun-0-',
 3,
 [{file,
 
"src/mochijson2.erl"},
 {line,
 
167}]},
 {lists,
 foldl,
 3,
 [{file,
 
"lists.erl"},
 {line,
 
1248}]},
 
{mochijson2,
 
json\_encode\_proplist,
 2,
 [{file,
 
"src/mochijson2.erl"},
 {line,
 
170}]},
 
{riak\_kv\_pb\_mapred,
 
process\_stream,
 3,
 [{file,
 
"src/riak\_kv\_pb\_mapred.erl"},
 {line,
 
142}]},
 
{riak\_api\_pb\_server,
 
process\_stream,
 5,
 [{file,
 
"src/riak\_api\_pb\_server.erl"},
 {line,
 
411}]},
 
{riak\_api\_pb\_server,
 
handle\_info,
 3,
 [{file,
 
"src/riak\_api\_pb\_server.erl"},
 {line,
 
319}]}]] code: 0 }

Other operations like listing keys and contents work fine. For example, the 
value of key '44dd14d4-8d53-460d-8e64-258d375d65fc’ (uuid4) is: 
{ context: ,
 type: 3,
 value: 
 { map\_value: 
 [ { field: { name: 'volume', type: 3 },
 register\_value: '2325100' },
 { field: { name: 'open', type: 3 }, register\_value: '514.43' },
 { field: { name: 'low', type: 3 }, register\_value: '511.40' },
 { field: { name: 'high', type: 3 }, register\_value: '517.45' },
 { field: { name: 'date', type: 3 },
 register\_value: '2007-08-27' },
 { field: { name: 'close', type: 3 }, register\_value: '513.26' },
 { field: { name: 'adjusted close', type: 3 },
 register\_value: '513.26' } ] } }

The code for the nodejs script and python script for populating the db: 
https://gist.github.com/singhkushagra/92c18f8ca2ba73976127 


Any help ?

cheers,
Kushagra Singh

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

