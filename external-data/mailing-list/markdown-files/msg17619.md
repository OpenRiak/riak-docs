---
title: "Riak KV memory backend did't discarding oldest objects when met max	memory"
description: ""
project: community
lastmod: 2016-08-31T21:00:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17619"
author_name: "周磊"
project_section: "mailinglistitem"
sent_date: 2016-08-31T21:00:07-07:00

---


Dear Friends,
I'm sorry to disturb you, could you help on this?

ENV

OS: CenterOS 6.5
Riak KV:2.1.4
Installed by:

wget
http://s3.amazonaws.com/downloads.basho.com/riak/2.1/2.1.4/rhel/6/riak-2.1.4-1.el6.x86\_64.rpm
sudo rpm -Uvh riak-2.1.4-1.el6.x86\_64.rpm

My Setting:

storage\_backend = multi
multi\_backend.bitcask\_multi.storage\_backend = bitcask
multi\_backend.bitcask\_multi.bitcask.data\_root = /var/lib/riak/bitcask\_mult
multi\_backend.memory\_multi.storage\_backend = memory
multi\_backend.memory\_multi.memory\_backend.max\_memory\_per\_vnode = 2MB
multi\_backend.default = memory\_multi

Document

http://docs.basho.com/riak/kv/2.1.4/setup/planning/backend/memory/


When the threshold value that you set has been met in a particular vnode, Riak
will begin discarding objects, beginning with the \*oldest\* object and
proceeding until memory usage returns below the allowable threshold.
You can configure maximum memory using the
memory\_backend.max\_memory\_per\_vnode setting. You can specify
max\_memory\_per\_vnode however you’d like, using kilobytes, megabytes, or
even gigabytes.

Setps

1.Use sh to Loop POST [512kb] files
(0.ts,index.m3u8,1.ts,index.m3u8,2.ts,index.m3u8........)
2.When meet the max memory 2 MB, some object discarded but not beginning
with the oldest object(index.m3u8 discarded)
curl.sh.txt 

http://10.20.122.45:8098/buckets/test/keys?keys=true

{"keys":["217.ts","212.ts","203.ts","210.ts","173.ts","166.ts","200.ts","199.ts","192.ts","215.ts","129.ts","124.ts","208.ts","179.ts","198.ts","196.ts","185.ts","97.ts","219.ts","114.ts","201.ts","190.ts","165.ts","223.ts","220.ts","214.ts","222.ts","211.ts","209.ts","213.ts","183.ts","143.ts","205.ts","171.ts","139.ts","66.ts","142.ts","122.ts","216.ts","170.ts","162.ts","194.ts","119.ts","105.ts","178.ts","160.ts","158.ts","221.ts","193.ts","187.ts","197.ts","159.ts","155.ts","218.ts","207.ts","184.ts","188.ts","181.ts","176.ts","206.ts","202.ts","195.ts"]}



Best Regards & Thanks

John
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

