---
title: "Is this idiotic?"
description: ""
project: community
lastmod: 2011-01-11T16:34:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01955"
author_name: "Eric Moritz"
project_section: "mailinglistitem"
sent_date: 2011-01-11T16:34:48-08:00

---


I'm still getting a feel for schema design in Riak. I need to fetch
blog entries using a compound index of (author, tag).

This is what I've come up with.

I have two buckets:

/riak/entry/{id}
/riak/entries\_by\_author\_and\_tag/{author\_id}.{tag}

Assume the keys are url safe.

Stored in entries\_by\_author\_and\_tag is a document that is just a JSON
document that is:

{
 author\_id: string,
 tag: string,
 entry\_keys: {
 entry\_key: {pub\_dt: iso8601zulu\_string},
 ...
 }
}

When I need to locate entries by a list of [(author\_id, tag)] I map
the entries\_by\_author\_and\_tag documents to a list of {entry\_key:"",
pub\_dt:""} objects and then sort and limit them in the reduce phase.

This works, but it feel really dirty to me. Is this just plain dumb?
It feels dumb.

At first I figured I would just store the {author\_id}.{tag} keys as a
author\_tag\_list in the entry and user Riak Search to fetch them but
because a user could follow hundreds or thousands of author/tag pairs,
the query string to fetch those entries would get too large. I assume
that looking up a 1000 entries\_by\_author\_tag documents could be too
slow, I'll have to test that out.

Thanks,
Eric.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

