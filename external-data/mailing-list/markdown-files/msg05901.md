---
title: "Re: Why is the data lost in luwak"
description: ""
project: community
lastmod: 2011-12-08T22:13:33-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05901"
mailinglist_parent_id: "msg05895"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-12-08T22:13:33-08:00
---


Fisher,

Currently you're using the asynchronous api so you won't be able to determine 
if the send calls actually succeed or not. The synchronous api is probably 
going to be what you want to use. There are some examples in the luwak readme 
file that should help you get started with it. 

Kelly


On Dec 8, 2011, at 9:57 PM, vuleetu wrote:

> Hi, Kelly
> 
> Actually, i did it as you said yesterday. it still return the
> unexpected size. If i remove flush() call, it will work. So right now
> this is a big problem now. the problem is the portion data of file is
> lost. I does not happen every time.
> 
> Is there any way to let me know if the write to riak via luwak is
> success or not? because the connection to RiakNode might be down
> during the write operation using luwak\_put\_stream:send().
> 
> 
> RiakNode = 'riak@127.0.0.1'.
> {ok, Riak} = riak:client\_connect(RiakNode).
> 
> luwak\_put\_stream:send()
> 
> %% assume node is down at this point
> 
> %% continue write
> luwak\_put\_stream:send()
> luwak\_put\_stream:send()
> 
> luwak\_put\_stream:close().
> 
> 
> I don't know if the write is successful or not, so it may cause the
> data lost sometime, is that right?
> 
> 
> Thanks
> Fisher
> 
> On Fri, Dec 9, 2011 at 12:51 AM, Kelly McLaughlin  wrote:
>> Fisher,
>> 
>> Yeah don't use flush. Make the calls to send to put the data and then call 
>> close and you should get the expected behavior.
>> 
>> Kelly
>> 
>> On Dec 7, 2011, at 11:13 PM, vuleetu wrote:
>> 
>>> On Thu, Dec 8, 2011 at 1:57 PM, Kelly McLaughlin  wrote:
>>>> Fisher,
>>>> 
>>>> You need to call luwak\_put\_stream:close(Ps) to force the flush. That should
>>>> get it for you. Cheers.
>>>> 
>>>> Kelly
>>> 
>>> Hi, Kelly
>>> 
>>> RiakNode = 'riak@127.0.0.1'.
>>> {ok, Riak} = riak:client\_connect(RiakNode).
>>> {ok, RiakFile} = luwak\_file:create(Riak, <<"testabc22yeah3">>, dict:new()).
>>> Ps = luwak\_put\_stream:start(Riak, RiakFile, 0, 1000000).
>>> luwak\_put\_stream:send(Ps, <<"1234">>).
>>> luwak\_put\_stream:flush(Ps).
>>> {ok, RiakFile2} = luwak\_file:get(Riak, <<"testabc22yeah3">>).
>>> luwak\_file:length(Riak, RiakFile2). %% Length is 4
>>> luwak\_put\_stream:send(Ps, <<"56789">>).
>>> luwak\_put\_stream:close(Ps).
>>> {ok, RiakFile3} = luwak\_file:get(Riak, <<"testabc22yeah3">>).
>>> luwak\_file:length(Riak, RiakFile3). %% Length still 13
>>> 
>>> 
>>> After i call close(), I still get the unexpected size(13bytes), is
>>> this the expected behavior? Can I not call flush() manually on a
>>> stream?
>>> 
>>> this is the version info:
>>> luwak-1.1.0
>>> riak\_core-1.0.0 riak\_kv-1.0.0 riak\_pipe-1.0.0
>>> riak\_search-1.0.0 riak\_sysmon-1.0.0 riakc-1.2.0
>>> 
>>> Thanks,
>>> 
>>> Fisher
>>> 
>>> 
>>>> 
>>>> On Dec 7, 2011, at 10:05 PM, vuleetu wrote:
>>>> 
>>>> luwak\_put\_stream:send(Ps, <<"56789">>).
>>>> luwak\_put\_stream:flush(Ps).
>>>> {ok, RiakFile3} = luwak\_file:get(Riak, <<"testabc22yeah3">>).
>>>> luwak\_file:length(Riak, RiakFile3).
>>>> 
>>>> 
>>> 
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>> 


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

