---
title: "Re: Unable to store certain documents in Riak - child_terminated	errors"
description: ""
project: community
lastmod: 2012-02-02T12:07:57-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06507"
mailinglist_parent_id: "msg06506"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-02-02T12:07:57-08:00
---


Michael,

It looks like the second argument to the called function [1]
(last\_write\_wins), is a binary <<"true">> instead of the appropriate atom.
Set the bucket property "last\_write\_wins" to true like so:

curl -X PUT -H "Content-Type: application/json" -d
'{"props":{"last\_write\_wins":true}}' http://riakhost/buckets/documents/props

Make sure to substitute "riakhost" with whatever host/port combo your Riak
node is running on.

[1] https://github.com/basho/riak\_kv/blob/1.0/src/riak\_kv\_vnode.erl#L638

On Thu, Feb 2, 2012 at 2:58 PM, Michael Jakl wrote:

> As it turns out, the 1.0.3 upgrade has nothing to do with the problem,
> I've downgraded to 1.0.2 yielding the same errors.
>
> 2012-02-02 20:56:47.405 [error] <0.352.0> gen\_fsm <0.352.0> in state
> active terminated with reason: no function clause matching
> riak\_kv\_vnode:put\_merge(true, <<"true">>,
>
> {r\_object,<<"documents">>,<<"Twitter\_164711056936144897">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
>
> {r\_object,<<"documents">>,<<"Twitter\_164711056936144897">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> <<202,121,10,114,78,248,151,255>>, 63495431807)
> 2012-02-02 20:56:47.407 [error] <0.352.0> CRASH REPORT Process
> <0.352.0> with 0 neighbours crashed with reason: no function clause
> matching riak\_kv\_vnode:put\_merge(true, <<"true">>,
>
> {r\_object,<<"documents">>,<<"Twitter\_164711056936144897">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
>
> {r\_object,<<"documents">>,<<"Twitter\_164711056936144897">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> <<202,121,10,114,78,248,151,255>>, 63495431807)
> 2012-02-02 20:56:47.409 [error] <0.95.0> Supervisor
> riak\_core\_vnode\_sup had child undefined started with
> {riak\_core\_vnode,start\_link,undefined} at <0.352.0> exit with reason
> no function clause matching riak\_kv\_vnode:put\_merge(true, <<"true">>,
>
> {r\_object,<<"documents">>,<<"Twitter\_164711056936144897">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
>
> {r\_object,<<"documents">>,<<"Twitter\_164711056936144897">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> <<202,121,10,114,78,248,151,255>>, 63495431807) in context
> child\_terminated
>
> Anyone got an idea what I could try to get it working?
>
> Cheers,
> Michael
>
>
> On Thu, Feb 2, 2012 at 17:40, Michael Jakl 
> wrote:
> > Hi, I've recently upgraded to Riak 1.0.3, now Riak won't accept
> > certain documents anymore.
> >
> > I'm running Riak 1.0.3 in a three node configuration on Linux Debian
> > 6.0 with increased file-handle-limit and the eleveldb backend.
> > On the client side I use the java client, also version 1.0.3. I've
> > tried the protocol buffer and the HTTP connection, both with the same
> > result.
> >
> > Is there something obvious in the logs I haven't seen? Other types of
> > documents are accepted as always.
> >
> > Is it possible that the document is malformed since the error message
> > contains "no function clause matching riak\_kv\_vnode:put\_merge"?
> >
> > I'm not 100% sure it has to do with the upgrade, but the times seem to
> > correlate.
> >
> > Please help,
> > Michael
> >
> > console.log:
> > 2012-02-02 17:22:09.445 [error] <0.402.0> gen\_fsm <0.402.0> in state
> > active terminated with reason: no function clause matching
> > riak\_kv\_vnode:put\_merge(true, <<"true">>,
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> > <<202,121,10,114,78,248,151,237>>, 63495418929)
> > 2012-02-02 17:22:09.447 [error] <0.402.0> CRASH REPORT Process
> > <0.402.0> with 0 neighbours crashed with reason: no function clause
> > matching riak\_kv\_vnode:put\_merge(true, <<"true">>,
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> > <<202,121,10,114,78,248,151,237>>, 63495418929)
> > 2012-02-02 17:22:09.449 [error] <0.105.0> Supervisor
> > riak\_core\_vnode\_sup had child undefined started with
> > {riak\_core\_vnode,start\_link,undefined} at <0.402.0> exit with reason
> > no function clause matching riak\_kv\_vnode:put\_merge(true, <<"true">>,
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> > <<202,121,10,114,78,248,151,237>>, 63495418929) in context
> > child\_terminated
> > 2012-02-02 17:26:09.477 [error] <0.2494.0> gen\_fsm <0.2494.0> in state
> > active terminated with reason: no function clause matching
> > riak\_kv\_vnode:put\_merge(true, <<"true">>,
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> > <<202,121,10,114,78,248,151,237>>, 63495419169)
> > 2012-02-02 17:26:09.480 [error] <0.2494.0> CRASH REPORT Process
> > <0.2494.0> with 0 neighbours crashed with reason: no function clause
> > matching riak\_kv\_vnode:put\_merge(true, <<"true">>,
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> > <<202,121,10,114,78,248,151,237>>, 63495419169)
> > 2012-02-02 17:26:09.483 [error] <0.105.0> Supervisor
> > riak\_core\_vnode\_sup had child undefined started with
> > {riak\_core\_vnode,start\_link,undefined} at <0.2494.0> exit with reason
> > no function clause matching riak\_kv\_vnode:put\_merge(true, <<"true">>,
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> >
> {r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[]...}...}...}]...},
> > <<202,121,10,114,78,248,151,237>>, 63495419169) in context
> > child\_terminated
> >
> > crash.log
> > 2012-02-02 17:26:09 =SUPERVISOR REPORT====
> > Supervisor: {local,riak\_core\_vnode\_sup}
> > Context: child\_terminated
> > Reason:
> >
> {function\_clause,[{riak\_kv\_vnode,put\_merge,[true,<<"true">>,{r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[<<"Links">>]],[],[],[],[],[],[],[],[[<<"content-type">>,116,101,120,116,47,112,108,97,105,110],[<<"X-Riak-VTag">>,51,52,68,86,115,119,97,66,70,115,48,88,71,87,82,90,52,106,109,48,88,99]],[[<<"index">>]],[],[[<<"X-Riak-Last-Modified">>|{1328,199729,299974}]],[],[[<<"charset">>,85,84,70,45,56],[<<"X-Riak-Meta">>]]}}},<<"{"\_original":{"contributors":null,"truncated":false,"text":"#Health
> > Chinese workers kidnapped in Egypt freed: BEIJING (Reuters) -
> > Twenty-five Chinese kidnapped in Egypt wer...
> > http://t.co/bJ3gberQ
> ","in\_reply\_to\_status\_id":null,"id":164708349135433728,"source":"> href=\"http://twitterfeed.com\"
> >
> rel=\"nofollow\">twitterfeed","retweeted":false,"coordinates":null,"entities":{"user\_mentions":[],"hashtags":[{"indices":[0,7],"text":"Health"}],"urls":[{"indices":[116,136],"url":"
> http://t.co/bJ3gberQ","expanded\_url":"http://j.mp/wvSByE","display\_url":"
> j.mp/wvSByE
> "}]},"in\_reply\_to\_screen\_name":null,"id\_str":"164708349135433728","retweet\_count":0,"in\_reply\_to\_user\_id":null,"favorited":false,"user":{"follow\_request\_sent":null,"profile\_use\_background\_image":true,"id":242603575,"verified":false,"profile\_image\_url\_https":"
> https://si0.twimg.com/profile\_images/1225118000/Lean\_Fit\_Lifestyle2\_normal.jpg
> ","profile\_sidebar\_fill\_color":"DDEEF6","geo\_enabled":false,"profile\_text\_color":"333333","followers\_count":4872,"protected":false,"location":"72829
> >
> Engstingen","default\_profile\_image":false,"id\_str":"242603575","utc\_offset":null,"statuses\_count":6642,"description":"Health
> > & Fitness is your source for health articles and information about
> > nutrition, diseases, medical conditions, weight loss, exercise and
> > more...
> ","friends\_count":5238,"profile\_link\_color":"0084B4","profile\_image\_url":"
> http://a3.twimg.com/profile\_images/1225118000/Lean\_Fit\_Lifestyle2\_normal.jpg
> ","notifications":null,"show\_all\_inline\_media":false,"profile\_background\_image\_url\_https":"
> https://si0.twimg.com/profile\_background\_images/324146416/TwitterBG\_1.jpg
> ","profile\_background\_color":"737479","profile\_background\_image\_url":"
> http://a3.twimg.com/profile\_background\_images/324146416/TwitterBG\_1.jpg
> ","screen\_name":"HealthzFitness","lang":"en","following":null,"profile\_background\_tile":false,"favourites\_count":0,"name":"Health
> > Fitness","url":"http://j.mp/v9pTtf","created\_at":"Tue Jan 25 04:39:46
> > +0000
> 2011","contributors\_enabled":false,"time\_zone":null,"profile\_sidebar\_border\_color":"C0DEED","default\_profile":false,"is\_translator":false,"listed\_count":20},"geo":null,"in\_reply\_to\_user\_id\_str":null,"possibly\_sensitive":false,"created\_at":"Wed
> > Feb 01 13:55:05 +0000
> >
> 2012","possibly\_sensitive\_editable":true,"in\_reply\_to\_status\_id\_str":null,"place":null},"contentType":"text","language":"EN","title":"@HealthzFitness:
> > #Health Chinese workers kidnapped in Egypt freed: BEIJING (Reuters) -
> > Twenty-five Chinese kidnapped in Egypt wer...
> > http://t.co/bJ3gberQ","sourceName":"Twitter
> >
> @HealthzFitness","country":"--","author":"HealthzFitness","mediaType":"Microblog","publishDate":"2012-02-01T13:55:05Z","content":"#Health
> > Chinese workers kidnapped in Egypt freed: BEIJING (Reuters) -
> > Twenty-five Chinese kidnapped in Egypt wer... http://t.co/bJ3gberQ
> > ","link":"
> https://twitter.com/#!/HealthzFitness/status/164708349135433728
> ","provider":"Twitter","homepage":"http://twitter.com/HealthzFitness
> ","id":"Twitter\_164708349135433728","tags":{"Topic":["Twenty-Five","Workers","Egypt"],"Location":["Egypt","BEIJING"]}}">>}],[{<<115,130,209,154,78,248,151,255>>,{1,63495418929}}],{dict,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[[clean|true]],[]}}},undefined},{r\_object,<<"documents">>,<<"Twitter\_164708349135433728">>,[{r\_content,{dict,7,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[<<"Links">>]],[],[],[],[],[],[],[],[[<<"content-type">>,116,101,120,116,47,112,108,97,105,110],[<<"X-Riak-VTag">>,55,102,102,103,56,122,49,48,79,66,88,70,122,75,88,72,85,79,79,70,101,68]],[[<<"index">>]],[],[[<<"X-Riak-Last-Modified">>|{1328,199969,482660}]],[],[[<<"charset">>,85,84,70,45,56],[<<"X-Riak-Meta">>]]}}},<<"{"\_original":{"contributors":null,"truncated":false,"text":"#Health
> > Chinese workers kidnapped in Egypt freed: BEIJING (Reuters) -
> > Twenty-five Chinese kidnapped in Egypt wer...
> > http://t.co/bJ3gberQ
> ","in\_reply\_to\_status\_id":null,"id":164708349135433728,"source":"> href=\"http://twitterfeed.com\"
> >
> rel=\"nofollow\">twitterfeed","retweeted":false,"coordinates":null,"entities":{"user\_mentions":[],"hashtags":[{"indices":[0,7],"text":"Health"}],"urls":[{"indices":[116,136],"url":"
> http://t.co/bJ3gberQ","expanded\_url":"http://j.mp/wvSByE","display\_url":"
> j.mp/wvSByE
> "}]},"in\_reply\_to\_screen\_name":null,"id\_str":"164708349135433728","retweet\_count":0,"in\_reply\_to\_user\_id":null,"favorited":false,"user":{"follow\_request\_sent":null,"profile\_use\_background\_image":true,"id":242603575,"verified":false,"profile\_image\_url\_https":"
> https://si0.twimg.com/profile\_images/1225118000/Lean\_Fit\_Lifestyle2\_normal.jpg
> ","profile\_sidebar\_fill\_color":"DDEEF6","geo\_enabled":false,"profile\_text\_color":"333333","followers\_count":4872,"protected":false,"location":"72829
> >
> Engstingen","default\_profile\_image":false,"id\_str":"242603575","utc\_offset":null,"statuses\_count":6642,"description":"Health
> > & Fitness is your source for health articles and information about
> > nutrition, diseases, medical conditions, weight loss, exercise and
> > more...
> ","friends\_count":5238,"profile\_link\_color":"0084B4","profile\_image\_url":"
> http://a3.twimg.com/profile\_images/1225118000/Lean\_Fit\_Lifestyle2\_normal.jpg
> ","notifications":null,"show\_all\_inline\_media":false,"profile\_background\_image\_url\_https":"
> https://si0.twimg.com/profile\_background\_images/324146416/TwitterBG\_1.jpg
> ","profile\_background\_color":"737479","profile\_background\_image\_url":"
> http://a3.twimg.com/profile\_background\_images/324146416/TwitterBG\_1.jpg
> ","screen\_name":"HealthzFitness","lang":"en","following":null,"profile\_background\_tile":false,"favourites\_count":0,"name":"Health
> > Fitness","url":"http://j.mp/v9pTtf","created\_at":"Tue Jan 25 04:39:46
> > +0000
> 2011","contributors\_enabled":false,"time\_zone":null,"profile\_sidebar\_border\_color":"C0DEED","default\_profile":false,"is\_translator":false,"listed\_count":20},"geo":null,"in\_reply\_to\_user\_id\_str":null,"possibly\_sensitive":false,"created\_at":"Wed
> > Feb 01 13:55:05 +0000
> >
> 2012","possibly\_sensitive\_editable":true,"in\_reply\_to\_status\_id\_str":null,"place":null},"contentType":"text","language":"EN","title":"@HealthzFitness:
> > #Health Chinese workers kidnapped in Egypt freed: BEIJING (Reuters) -
> > Twenty-five Chinese kidnapped in Egypt wer...
> > http://t.co/bJ3gberQ","sourceName":"Twitter
> >
> @HealthzFitness","country":"--","author":"HealthzFitness","mediaType":"Microblog","publishDate":"2012-02-01T13:55:05Z","content":"#Health
> > Chinese workers kidnapped in Egypt freed: BEIJING (Reuters) -
> > Twenty-five Chinese kidnapped in Egypt wer... http://t.co/bJ3gberQ
> > ","link":"
> https://twitter.com/#!/HealthzFitness/status/164708349135433728
> ","provider":"Twitter","homepage":"http://twitter.com/HealthzFitness
> ","id":"Twitter\_164708349135433728","tags":{"Topic":["Twenty-Five","Workers","Egypt"],"Location":["Egypt","BEIJING"]}}">>}],[{<<115,130,209,154,78,248,151,255>>,{1,63495418929}}],{dict,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[[clean|true]],[]}}},undefined},<<202,121,10,114,78,248,151,237>>,63495419169]},{riak\_kv\_vnode,prepare\_put,2},{riak\_kv\_vnode,do\_put,7},{riak\_kv\_vnode,handle\_command,3},{riak\_core\_vnode,vnode\_command,3},{gen\_fsm,handle\_msg,7},{proc\_lib,init\_p\_do\_apply,3}]}
> > Offender:
> >
> [{pid,<0.2494.0>},{name,undefined},{mfargs,{riak\_core\_vnode,start\_link,undefined}},{restart\_type,temporary},{shutdown,300000},{child\_type,worker}]
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>



-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

