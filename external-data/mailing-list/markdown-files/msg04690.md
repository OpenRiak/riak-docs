---
title: "Riak Socket Exception using PBCClient"
description: ""
project: community
lastmod: 2011-09-13T16:39:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04690"
author_name: "Harshal Dhir"
project_section: "mailinglistitem"
sent_date: 2011-09-13T16:39:56-07:00

---


Folks,


I am using Riak Search v0.14.2 5-Node-cluster. We are trying to write a
distributed application using RabbitMQ. But, for some reason riak is
bombing out on me and giving me "Broken Pipe" exceptions.

We are using the latest riak java pbc client.

Here is the detailed error:com.sna.cube.iface:
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:75)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:51)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
com.basho.riak.client.operations.StoreObject.execute(StoreObject.java:116)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
com.basho.riak.client.bucket.DomainBucket.store(DomainBucket.java:139)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
org.com.sna.base.service.component.RiakService.save(DataService.scala:30)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
org.com.sna.base.iface.data.Persistable$class.save(Persistable.scala:16)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
org.com.sna.base.model.document.DocumentCategory.save(DocumentCategory.scal
a:22)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
org.com.sna.cube.iface.CubeProcessorComponent$SimpleConsumer.processMessage
(CubeProcessorComponent.scala:90)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
org.com.sna.cube.iface.CubeProcessorComponent$SimpleConsumer.handleDelivery
(CubeProcessorComponent.scala:68)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:292)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel
.java:154)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:99)
ERR [20110913-16:26:15.231] org.dell.sna.cube.iface:
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:443)



Thanks
Harshal









On 9/12/11 7:19 PM, "riak-users-requ...@lists.basho.com"
 wrote:

>Send riak-users mailing list submissions to
> riak-users@lists.basho.com
>
>To subscribe or unsubscribe via the World Wide Web, visit
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>or, via email, send a message with subject or body 'help' to
> riak-users-requ...@lists.basho.com
>
>You can reach the person managing the list at
> riak-users-ow...@lists.basho.com
>
>When replying, please edit your Subject line so it is more specific
>than "Re: Contents of riak-users digest..."
>
>
>Today's Topics:
>
> 1. Re: Question from a noob about link walking (Dan Reverri)
> 2. Misbehaving bucket (Jeremy Raymond)
> 3. Re: Misbehaving bucket (Daniel Reverri)
> 4. Re: Misbehaving bucket (Jeremy Raymond)
> 5. riak-1.0.0pre2 segfaults (Henrik Johansen)
> 6. Riak Recap for September 9 - 11 (Mark Phillips)
> 7. Re: riak-1.0.0pre2 segfaults (Mark Phillips)
> 8. Re: riak-1.0.0pre2 segfaults (Ryan Zezeski)
>
>
>----------------------------------------------------------------------
>
>Message: 1
>Date: Mon, 12 Sep 2011 09:18:25 -0700
>From: Dan Reverri 
>To: Antonio Fern?ndez Vara 
>Cc: riak-users 
>Subject: Re: Question from a noob about link walking
>Message-ID:
>
>
>Content-Type: text/plain; charset="iso-8859-1"
>
>Hi Antonio,
>
>Links only work in one direction so it is not possible to find the items
>that link to an object. You would need to apply links on both sides of the
>relationship.
>
>Thanks,
>Dan
>
>Daniel Reverri
>Developer Advocate
>Basho Technologies, Inc.
>d...@basho.com
>
>
>2011/9/12 Antonio Fern?ndez Vara 
>
>> Hi,
>>
>> I'm using Ruby and I'm trying to learn how to use Riak basics, now I'm
>> learning links and I have a question I know will be so easy to answer by
>> you, experts :).
>>
>> I know how to search with a simple MapReduce query what items I'm
>>linking,
>> but now the opposite, what items links me.
>>
>> As little concept I've made this simple script, just it creates 10
>>items in
>> a bucket, 20 relations as follow, 20 as like (I don't try to do the next
>> graph thing, just was the first tags that come to my brain): (BTW: I
>>have
>> tryed to find how this is done in ripple but seems I need to study more
>>to
>> obtain the answer looking the code Sean wrote).
>>
>> As you can see, I just create those 10 items in the bucket (1..10) and
>> randomly add the relations. The mapreduce function works showing me all
>>the
>> links in each relation for each object in the last iteration.
>>
>> Now, I'm trying to find how to get the reverse.
>>
>> Thank you in advance. Hope someone can get some time and help me.
>>
>> -- test-creator.rb --
>> require 'rubygems'
>> require 'riak'
>>
>> client = Riak::Client.new
>> client.http\_port = 8091
>>
>> bucket\_name = "users8" #change for test in different bucket
>>
>> bucket = client.bucket(bucket\_name)
>>
>> 10.times do |n|
>> o = bucket.new("#{n + 1}")
>> o.data = "#{n + 1}"
>> o.store
>> end
>>
>> 20.times do |n|
>> source = rand(10) + 1
>> destination = rand(10) + 1
>> puts "#{source} --> follow --> #{destination}"
>> o = bucket["#{source}"]
>> o.links << Riak::Link.new(bucket\_name, destination, 'follow')
>> o.store
>> end
>>
>> 20.times do |n|
>> source = rand(10) + 1
>> destination = rand(10) + 1
>> puts "#{source} --> like --> #{destination}"
>> o = bucket["#{source}"]
>> o.links << Riak::Link.new(bucket\_name, destination, 'like')
>> o.store
>> end
>>
>> 10.times do |n|
>> results = Riak::MapReduce.new(client).add(bucket\_name, "#{n +
>> 1}").link(:bucket => bucket\_name, :tag => 'follow').map("function(v) {
>> return [JSON.parse(v.values[0].data)]; }", :keep => true).run
>> puts "follow #{n + 1} = "
>> p results
>> results = Riak::MapReduce.new(client).add(bucket\_name, "#{n +
>> 1}").link(:bucket => bucket\_name, :tag => 'like').map("function(v) {
>>return
>> [JSON.parse(v.values[0].data)]; }", :keep => true).run
>> puts "like #{n + 1} = "
>> p results
>> end
>>
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>>
>-------------- next part --------------
>An HTML attachment was scrubbed...
>URL:
>0110912/7f27e784/attachment-0001.html>
>
>------------------------------
>
>Message: 2
>Date: Mon, 12 Sep 2011 13:13:16 -0400
>From: Jeremy Raymond 
>To: riak-users@lists.basho.com
>Subject: Misbehaving bucket
>Message-ID:
>
>
>Content-Type: text/plain; charset="iso-8859-1"
>
>Hello,
>
>I have a bucket with about 70 items in it the Keys look like this
><<"1294549200\_UbEu1topckAFu2UYy3spr8AG5lc">> and the values are about 2.8K
>of JSON. For some reason operations on data in this bucket are extremely
>slow. It takes between 5 - 10 seconds to read a value of of the bucket by
>it's key using the Erlang protobuf client. When I do the reads the CPU of
>the node I'm connecting to spikes using up 100% usage on the Riak beam
>process.
>
>I can read data out of any of the other 9 buckets in the system some of
>which have a lot more items in them (one as > 16k items) and the
>operations
>are super fast.
>
>There are no errors in the sasl-error.log files and everything looks
>normal
>in the erlang.log files. Any ideas on what may cause a bucket to churn
>like
>this?
>
>- Jeremy
>-------------- next part --------------
>An HTML attachment was scrubbed...
>URL:
>0110912/3ca0c903/attachment-0001.html>
>
>------------------------------
>
>Message: 3
>Date: Mon, 12 Sep 2011 10:43:59 -0700
>From: Daniel Reverri 
>To: Jeremy Raymond 
>Cc: "riak-users@lists.basho.com" 
>Subject: Re: Misbehaving bucket
>Message-ID: 
>Content-Type: text/plain; charset=us-ascii
>
>Hi Jeremy
>
>Are you doing a full bucket query or retrieving individual objects?
>
>Is your bucket configured to allow siblings (allow\_mult=true)? Do the
>objects being retrieved have many siblings?
>
>Are you using multiple backends?
>
>Thanks
>Dan
>
>Sent from my iPhone
>
>On Sep 12, 2011, at 10:13 AM, Jeremy Raymond  wrote:
>
>> Hello,
>>
>> I have a bucket with about 70 items in it the Keys look like this
>><<"1294549200\_UbEu1topckAFu2UYy3spr8AG5lc">> and the values are about
>>2.8K of JSON. For some reason operations on data in this bucket are
>>extremely slow. It takes between 5 - 10 seconds to read a value of of
>>the bucket by it's key using the Erlang protobuf client. When I do the
>>reads the CPU of the node I'm connecting to spikes using up 100% usage
>>on the Riak beam process.
>>
>> I can read data out of any of the other 9 buckets in the system some of
>>which have a lot more items in them (one as > 16k items) and the
>>operations are super fast.
>>
>> There are no errors in the sasl-error.log files and everything looks
>>normal in the erlang.log files. Any ideas on what may cause a bucket to
>>churn like this?
>>
>> - Jeremy
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
>
>
>------------------------------
>
>Message: 4
>Date: Mon, 12 Sep 2011 14:22:43 -0400
>From: Jeremy Raymond 
>To: Daniel Reverri 
>Cc: "riak-users@lists.basho.com" 
>Subject: Re: Misbehaving bucket
>Message-ID:
>
>
>Content-Type: text/plain; charset="iso-8859-1"
>
>I did riakc\_pb\_socket:list\_keys/2 which completes quickly, then fetched
>each
>object individually by the key using riakc\_pb\_socket:get/3 which was slow.
>
>The bucket uses the default settings (see below), allow\_mult=false, using
>a
>single bitcask backend.
>
>I came across this problem because one of the Riak nodes was reporting via
>Nagios to be short of disk space. Investigating I found that
>/var/lib/riak/bitcask was taking up about 24GB of disk. This much disk
>usage
>was crazy big, since there's probably less than 100MB of data I'm storing
>in
>Riak. Since my original email I've deleted all item in the misbehaving
>bucket (it took several tries as the read slowness/CPU usage
>also appeared on delete operations). The bitcask folder is now 44MB in
>size
>(down from 24GB!). I've repopulated the data in the bucket now storing 157
>items. Things seem to be back to normal for this bucket.
>
>Perhaps I inadvertently pushed something large into the bucket, but each
>of
>the items I put in there was only about 3K in size - this doesn't seem
>likely to me.
>
>
>Bucket Properties:
>{"props":{"name":"suite\_diff","n\_val":3,"allow\_mult":false,"last\_write\_win
>s":false,"precommit":[],"postcommit":[],"chash\_keyfun":{"mod":"riak\_core\_u
>til","fun":"chash\_std\_keyfun"},"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","
>fun":"mapreduce\_linkfun"},"old\_vclock":86400,"young\_vclock":20,"big\_vclock
>":50,"small\_vclock":10,"r":"quorum","w":"quorum","dw":"quorum","rw":"quoru
>m"}}
>
>- Jeremy
>
>
>On Mon, Sep 12, 2011 at 1:43 PM, Daniel Reverri  wrote:
>
>> Hi Jeremy
>>
>> Are you doing a full bucket query or retrieving individual objects?
>>
>> Is your bucket configured to allow siblings (allow\_mult=true)? Do the
>> objects being retrieved have many siblings?
>>
>> Are you using multiple backends?
>>
>> Thanks
>> Dan
>>
>> Sent from my iPhone
>>
>> On Sep 12, 2011, at 10:13 AM, Jeremy Raymond 
>>wrote:
>>
>> > Hello,
>> >
>> > I have a bucket with about 70 items in it the Keys look like this
>> <<"1294549200\_UbEu1topckAFu2UYy3spr8AG5lc">> and the values are about
>>2.8K
>> of JSON. For some reason operations on data in this bucket are extremely
>> slow. It takes between 5 - 10 seconds to read a value of of the bucket
>>by
>> it's key using the Erlang protobuf client. When I do the reads the CPU
>>of
>> the node I'm connecting to spikes using up 100% usage on the Riak beam
>> process.
>> >
>> > I can read data out of any of the other 9 buckets in the system some
>>of
>> which have a lot more items in them (one as > 16k items) and the
>>operations
>> are super fast.
>> >
>> > There are no errors in the sasl-error.log files and everything looks
>> normal in the erlang.log files. Any ideas on what may cause a bucket to
>> churn like this?
>> >
>> > - Jeremy
>> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> > riak-users mailing list
>> > riak-users@lists.basho.com
>> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>>
>-------------- next part --------------
>An HTML attachment was scrubbed...
>URL:
>0110912/ba1262bd/attachment-0001.html>
>
>------------------------------
>
>Message: 5
>Date: Mon, 12 Sep 2011 22:09:47 +0200
>From: Henrik Johansen 
>To: riak-users@lists.basho.com
>Subject: riak-1.0.0pre2 segfaults
>Message-ID: <20110912200947.GA6356@warrier>
>Content-Type: text/plain; charset=us-ascii; format=flowed
>
>Hello list,
>
>I have been playing with single node riak-1.0.0pre2 cluster & riaktant
>today and somehow I managed to get riak to segfault every time I tried
>using the MapReduce functions in riaktant.
>
>Riak-1.0.0pre2 was installed using the 64-bit Debian package on my
>Ubuntu 11.04 laptop - riaktant was pulled form GitHub.
>
>I have gathered some relevant info below - if I can assist in any way
>please let me know ...
>
>dmesg :
>[10488.941750] beam.smp[1496]: segfault at 7f4d61d73ff8 ip
>00007f4d5ea7a83e sp 00007f4d61d74000 error 6 in
>erlang\_js\_drv.so[7f4d5ea35000+e6000]
>[10944.335495] beam.smp[4681]: segfault at 7fcda9892ff8 ip
>00007fcda386783e sp 00007fcda9893000 error 6 in
>erlang\_js\_drv.so[7fcda3822000+e6000]
>[11658.589251] beam.smp[6604]: segfault at 7fee7166eff8 ip
>00007fee6dc4983e sp 00007fee7166f000 error 6 in
>erlang\_js\_drv.so[7fee6dc04000+e6000]
>
>crash.log :
>2011-09-12 21:49:03 =SUPERVISOR REPORT====
> Supervisor: {local,riak\_pipe\_builder\_sup}
> Context: child\_terminated
> Reason:
>
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
> error before:
>
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
> Offender:
>
>[{pid,<0.1556.0>},{name,undefined},{mfargs,{riak\_pipe\_builder,start\_link,u
>ndefined}},{restart\_type,temporary},{shutdown,brutal\_kill},{child\_type,wor
>ker}]
>
>2011-09-12 21:49:03 =SUPERVISOR REPORT====
> Supervisor: {local,riak\_pipe\_fitting\_sup}
> Context: child\_terminated
> Reason:
>
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
> error before:
>
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
> Offender:
>
>[{pid,<0.1558.0>},{name,undefined},{mfargs,{riak\_pipe\_fitting,start\_link,u
>ndefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
>
>2011-09-12 21:49:03 =SUPERVISOR REPORT====
> Supervisor: {local,riak\_pipe\_fitting\_sup}
> Context: child\_terminated
> Reason:
>
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
> error before:
>
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
> Offender:
>
>[{pid,<0.1559.0>},{name,undefined},{mfargs,{riak\_pipe\_fitting,start\_link,u
>ndefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
>
>2011-09-12 21:49:03 =SUPERVISOR REPORT====
> Supervisor: {local,riak\_pipe\_fitting\_sup}
> Context: child\_terminated
> Reason:
>
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
> error before:
>
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
> Offender:
>
>[{pid,<0.1557.0>},{name,undefined},{mfargs,{riak\_pipe\_fitting,start\_link,u
>ndefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
>
>error.log :
>2011-09-12 21:49:03.025 [error] <0.132.0> Supervisor
>riak\_pipe\_builder\_sup had child at module undefined at <0.1556.0> exit
>with reason
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
>error before:
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
>in context child\_terminated
>2011-09-12 21:49:03.028 [error] <0.133.0> Supervisor
>riak\_pipe\_fitting\_sup had child at module undefined at <0.1558.0> exit
>with reason
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
>error before:
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
>in context child\_terminated
>2011-09-12 21:49:03.031 [error] <0.133.0> Supervisor
>riak\_pipe\_fitting\_sup had child at module undefined at <0.1559.0> exit
>with reason
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
>error before:
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
>in context child\_terminated
>2011-09-12 21:49:03.033 [error] <0.133.0> Supervisor
>riak\_pipe\_fitting\_sup had child at module undefined at <0.1557.0> exit
>with reason
>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{e
>rror,{lucene\_parse,"syntax
>error before:
>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{riak
>\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_pip
>e,'-send\_inputs\_async/3-fun-0-',3}]}
>in context child\_terminated
>
>/HenrikJ
>
>
>
>------------------------------
>
>Message: 6
>Date: Mon, 12 Sep 2011 16:38:42 -0700
>From: Mark Phillips 
>To: riak-users 
>Subject: Riak Recap for September 9 - 11
>Message-ID:
>
>
>Content-Type: text/plain; charset=ISO-8859-1
>
>Afternoon, Evening, Morning to All
>
>For today's Recap: talks, blog posts, jobs, and more.
>
>Enjoy.
>
>Mark
>
>Community Manager
>Basho Technologies
>wiki.basho.com
>twitter.com/pharkmillups
>------------------------
>
>Riak Recap for September 9 - 11
>========================
>
>1) Mark Cavage wrote a lengthy post on just about everything you would
>ever want to know about LDAP. More importantly he explains why he's
>working on it at Joyent and why they are using Riak with LDAP.
>
>\* Read here --->
>http://blog.nodejs.org/2011/09/08/ldapjs-a-reprise-of-ldap/
>
>2) Basho COO Tony Falco was in the Wall St. Journal talking about the
>history of Basho and Riak, why Riak is so compelling. Basho is part of
>the "Small Business, Large Innovation" competition the WSJ is running
>and we could use your vote.
>
>\* Read and vote here ---> \*
>http://blogs.wsj.com/biginnovation/2011/09/09/basho-technologies/
>
>3) Strange Loop is less than a week away, so here's the rundown of
>Riak-flavored talks happening in St. Louis next week.
>
>\* Susan Potter will be talking about using riak\_core to build
>distributed applications --->
>https://thestrangeloop.com/sessions/dynamo-is-not-just-for-datastores
>\* Kresten Krab Thorup will be talking about Bringing Riak to the
>Mobile Platform --->
>https://thestrangeloop.com/sessions/bringing-riak-to-the-mobile-platform
>\* Sean Cribbs will be talking about Riak's MapReduce in relation to
>traditional SQL --->
>https://thestrangeloop.com/sessions/wrap-your-sql-head-around-riak-mapredu
>ce
>
>I'll also be in attendance. Ping me if you'll be there.
>
>4) Ethan Gunderson built a Riak Rubik's cube.
>
>\* Picture here ---> http://twitpic.com/6k0int
>
>5) One great job to pass along:
>
>\* truSEF, a financial services startup in NYC, is hiring Senior
>Software Engineers to work on their infrastructure (and there's a lot
>of Riak involved). Details here ---> http://truesef.com/jobs/sse.html
>
>
>
>------------------------------
>
>Message: 7
>Date: Mon, 12 Sep 2011 18:41:59 -0700
>From: Mark Phillips 
>To: Henrik Johansen 
>Cc: riak-users@lists.basho.com
>Subject: Re: riak-1.0.0pre2 segfaults
>Message-ID:
>
>
>Content-Type: text/plain; charset=ISO-8859-1
>
>Thanks for the thorough report, Henrik!
>
>We're looking into it and will let you know if we need any more info.
>
>Mark
>
>On Mon, Sep 12, 2011 at 1:09 PM, Henrik Johansen  wrote:
>> Hello list,
>>
>> I have been playing with single node riak-1.0.0pre2 cluster & riaktant
>>today
>> and somehow I managed to get riak to segfault every time I tried using
>>the
>> MapReduce functions in riaktant.
>>
>> Riak-1.0.0pre2 was installed using the 64-bit Debian package on my
>> Ubuntu 11.04 laptop - riaktant was pulled form GitHub.
>>
>> I have gathered some relevant info below - if I can assist in any way
>> please let me know ...
>>
>> dmesg :
>> [10488.941750] beam.smp[1496]: segfault at 7f4d61d73ff8 ip
>>00007f4d5ea7a83e
>> sp 00007f4d61d74000 error 6 in erlang\_js\_drv.so[7f4d5ea35000+e6000]
>> [10944.335495] beam.smp[4681]: segfault at 7fcda9892ff8 ip
>>00007fcda386783e
>> sp 00007fcda9893000 error 6 in erlang\_js\_drv.so[7fcda3822000+e6000]
>> [11658.589251] beam.smp[6604]: segfault at 7fee7166eff8 ip
>>00007fee6dc4983e
>> sp 00007fee7166f000 error 6 in erlang\_js\_drv.so[7fee6dc04000+e6000]
>>
>> crash.log :
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> ? ? Supervisor: {local,riak\_pipe\_builder\_sup}
>> ? ? Context: ? ?child\_terminated
>> ? ? Reason:
>>
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> ? ? error before:
>>
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> ? ? Offender:
>>
>>
>>[{pid,<0.1556.0>},{name,undefined},{mfargs,{riak\_pipe\_builder,start\_link,
>>undefined}},{restart\_type,temporary},{shutdown,brutal\_kill},{child\_type,w
>>orker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> ? ? Supervisor: {local,riak\_pipe\_fitting\_sup}
>> ? ? Context: ? ?child\_terminated
>> ? ? Reason:
>>
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> ? ? error before:
>>
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> ? ? Offender:
>>
>>
>>[{pid,<0.1558.0>},{name,undefined},{mfargs,{riak\_pipe\_fitting,start\_link,
>>undefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> ? ? Supervisor: {local,riak\_pipe\_fitting\_sup}
>> ? ? Context: ? ?child\_terminated
>> ? ? Reason:
>>
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> ? ? error before:
>>
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> ? ? Offender:
>>
>>
>>[{pid,<0.1559.0>},{name,undefined},{mfargs,{riak\_pipe\_fitting,start\_link,
>>undefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> ? ? Supervisor: {local,riak\_pipe\_fitting\_sup}
>> ? ? Context: ? ?child\_terminated
>> ? ? Reason:
>>
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> ? ? error before:
>>
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> ? ? Offender:
>>
>>
>>[{pid,<0.1557.0>},{name,undefined},{mfargs,{riak\_pipe\_fitting,start\_link,
>>undefined}},{restart\_type,temporary},{shutdown,2000},{child\_type,worker}]
>>
>> error.log :
>> 2011-09-12 21:49:03.025 [error] <0.132.0> Supervisor
>>riak\_pipe\_builder\_sup
>> had child at module undefined at <0.1556.0> exit with reason
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> error before:
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.028 [error] <0.133.0> Supervisor
>>riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1558.0> exit with reason
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> error before:
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.031 [error] <0.133.0> Supervisor
>>riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1559.0> exit with reason
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> error before:
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.033 [error] <0.133.0> Supervisor
>>riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1557.0> exit with reason
>>
>>{{modfun,riak\_search,mapred\_search,[<<"syslog">>,<<>>]},error,{badmatch,{
>>error,{lucene\_parse,"syntax
>> error before:
>>
>>"}}},[{riak\_search\_client,parse\_query,3},{riak\_search,parse\_query,3},{ria
>>k\_search,mapred\_search,3},{riak\_kv\_mrc\_pipe,send\_inputs,3},{riak\_kv\_mrc\_p
>>ipe,'-send\_inputs\_async/3-fun-0-',3}]}
>> in context child\_terminated
>>
>> /HenrikJ
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>
>
>
>------------------------------
>
>Message: 8
>Date: Mon, 12 Sep 2011 22:19:19 -0400
>From: Ryan Zezeski 
>To: Henrik Johansen 
>Cc: riak-users@lists.basho.com
>Subject: Re: riak-1.0.0pre2 segfaults
>Message-ID:
>
>
>Content-Type: text/plain; charset="iso-8859-1"
>
>Henrik,
>
>I'm not familiar with riaktant but it looks like an invalid query is being
>passed in. I.e. an empty query. This empty query causes and error in the
>query parser and then it appears a segfault in the js driver.
>
>E.g. here I replicate the error at the console:
>
>(riak@127.0.0.1)5> search:search(<<"bucket">>, <<>>).
>\*\* exception error: no match of right hand side value
>{error,{lucene\_parse,"syntax error before: "}}
> in function riak\_search\_client:parse\_query/3
> in call from search:search/3
>
>-Ryan
>
>On Mon, Sep 12, 2011 at 4:09 PM, Henrik Johansen  wrote:
>
>> Hello list,
>>
>> I have been playing with single node riak-1.0.0pre2 cluster & riaktant
>> today and somehow I managed to get riak to segfault every time I tried
>>using
>> the MapReduce functions in riaktant.
>>
>> Riak-1.0.0pre2 was installed using the 64-bit Debian package on my
>> Ubuntu 11.04 laptop - riaktant was pulled form GitHub.
>>
>> I have gathered some relevant info below - if I can assist in any way
>> please let me know ...
>>
>> dmesg :
>> [10488.941750] beam.smp[1496]: segfault at 7f4d61d73ff8 ip
>>00007f4d5ea7a83e
>> sp 00007f4d61d74000 error 6 in erlang\_js\_drv.so[7f4d5ea35000+\*\*e6000]
>> [10944.335495] beam.smp[4681]: segfault at 7fcda9892ff8 ip
>>00007fcda386783e
>> sp 00007fcda9893000 error 6 in erlang\_js\_drv.so[7fcda3822000+\*\*e6000]
>> [11658.589251] beam.smp[6604]: segfault at 7fee7166eff8 ip
>>00007fee6dc4983e
>> sp 00007fee7166f000 error 6 in erlang\_js\_drv.so[7fee6dc04000+\*\*e6000]
>>
>> crash.log :
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_builder\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1556.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> builder,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,brutal\_kill},{child\_\*\*type,worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_fitting\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1558.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> fitting,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,2000},{child\_type,\*\*worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_fitting\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1559.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> fitting,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,2000},{child\_type,\*\*worker}]
>>
>> 2011-09-12 21:49:03 =SUPERVISOR REPORT====
>> Supervisor: {local,riak\_pipe\_fitting\_sup}
>> Context: child\_terminated
>> Reason:
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> Offender:
>> [{pid,<0.1557.0>},{name,\*\*undefined},{mfargs,{riak\_pipe\_\*\*
>> fitting,start\_link,undefined}}\*\*,{restart\_type,temporary},{\*\*
>> shutdown,2000},{child\_type,\*\*worker}]
>>
>> error.log :
>> 2011-09-12 21:49:03.025 [error] <0.132.0> Supervisor
>>riak\_pipe\_builder\_sup
>> had child at module undefined at <0.1556.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.028 [error] <0.133.0> Supervisor
>>riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1558.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.031 [error] <0.133.0> Supervisor
>>riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1559.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>> 2011-09-12 21:49:03.033 [error] <0.133.0> Supervisor
>>riak\_pipe\_fitting\_sup
>> had child at module undefined at <0.1557.0> exit with reason
>> {{modfun,riak\_search,mapred\_\*\*search,[<<"syslog">>,<<>>]},\*\*
>> error,{badmatch,{error,{\*\*lucene\_parse,"syntax
>> error before:
>> "}}},[{riak\_search\_client,\*\*parse\_query,3},{riak\_search,\*\*
>> parse\_query,3},{riak\_search,\*\*mapred\_search,3},{riak\_kv\_mrc\_\*\*
>> pipe,send\_inputs,3},{riak\_kv\_\*\*mrc\_pipe,'-send\_inputs\_async/\*\*
>> 3-fun-0-',3}]}
>> in context child\_terminated
>>
>> /HenrikJ
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>>
>>http://lists.basho.com/\*\*mailman/listinfo/riak-users\_\*\*lists.basho.com>tp://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com>
>>
>-------------- next part --------------
>An HTML attachment was scrubbed...
>URL:
>0110912/90888d12/attachment.html>
>
>------------------------------
>
>\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>riak-users mailing list
>riak-users@lists.basho.com
>http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
>
>End of riak-users Digest, Vol 26, Issue 22
>\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

