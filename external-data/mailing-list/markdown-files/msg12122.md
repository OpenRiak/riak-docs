---
title: "Riak mapred with key filtering using Erlang client"
description: ""
project: community
lastmod: 2013-08-23T03:34:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12122"
author_name: "Maciek Borzecki"
project_section: "mailinglistitem"
sent_date: 2013-08-23T03:34:05-07:00

---


Hi guys,

I can't really figure out how to properly call riakc\_pb\_socket:mapred
with key filtering in Erlang Riak client.

I can't really tell if specs or the documentation is correct on this,
but I would assume that the doc is outdated. Hence the question, is key
filtering still avaialble in erlang client and how it is to be used
correctly?

According to online documentation from here:
 
http://docs.basho.com/riak/latest/dev/using/keyfilters/#Constructing-key-filters
call is to be done like this (docs for 1.2 through 1.4 have the same example):
: riakc\_pb\_socket:mapred(Pid,
: { <<"invoices">>, [[<<"ends\_with">>,<<"0603">>]]},
: Query).

This is out of sync with mapred spec in 1.3 headers (and 1.4):
: %% @doc Perform a MapReduce job across the cluster.
: %% See the MapReduce documentation for explanation of behavior.
: %% @equiv mapred(Inputs, Query, default\_timeout(mapred))
: -spec mapred(pid(), mapred\_inputs(), [mapred\_queryterm()]) ->
: {ok, mapred\_result()} |
: {error, {badqterm, mapred\_queryterm()}} |
: {error, timeout} |
: {error, term()}.
: mapred(Pid, Inputs, Query) ->
: mapred(Pid, Inputs, Query, default\_timeout(mapred\_timeout)).

Where mapred\_inputs is typed as follows:
: -type bucket() :: binary(). %% A bucket name.
: -type key() :: binary(). %% A key name.
: -type mapred\_inputs() :: [{bucket(), key()} | {bucket(), key(), term()}] |
: {modfun, Module::atom(), Function::atom(), [term()]} 
|
: bucket() |
: {index, bucket(), Index::binary(), key()} |
: {index, bucket(), Index::binary(),
: StartKey::key(), EndKey::key()}.

The example form documentation will not match the type specs, making
dialyzer to complain a lot.


Thanks,
--
Maciej BorzcÄ™ki
Senior Software Developer at Open-RnD Sp. z o.o., Poland
www.open-rnd.pl
mobile: +48 889 117 365, fax: +48 42 657 9079

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

