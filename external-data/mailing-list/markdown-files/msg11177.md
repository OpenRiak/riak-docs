---
title: "Re: Riak CS 1.3 S3 access does not seem to mark s3 deleted file as	truly deleted"
description: ""
project: community
lastmod: 2013-05-27T01:06:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11177"
mailinglist_parent_id: "msg11143"
author_name: "Toby Corkindale"
project_section: "mailinglistitem"
sent_date: 2013-05-27T01:06:34-07:00
---



On 22/05/13 06:18, Idan Shinberg wrote:

Thus , I fear Riak never treats their data as "dead-bytes" and they
never get merged

I created 2 buckets using s3cmd and made several tens of uploads of
32mb sized files , deleting them right afterwards ( with proper s3cmd
commands , of course) .

I ended up with no buckets and no keys in my riak s3 database ,
however , directory /var/lib/riak/bitcask/ 64 partitions now occupy 15GB
worth of space

several riak restarts did not trigger any merges , and my merge settings
are set to impose very though merge triggering criterias , So I'm
guessing the only reason the data is not being cleared is the fact that
it's still in use ...

Relevant riak-cs config :



Have you tried adjusting the leeway\_seconds and gc\_intervals?
I think Riak CS hangs onto things for a day by default.. Your config 
below looked like you'd tried changing that to 30 seconds, but I wonder 
if maybe that's actually \*too fast\*? Maybe try something like 15 minutes?


I don't know though.. just a thought I'd had.



/\* %% == Garbage Collection ==\*/
/\*
\*/
/\* %% The number of seconds to retain the block\*/
/\* %% for an object after it has been deleted.\*/
/\* %% This leeway time is set to give the delete\*/
/\* %% indication time to propogate to all replicas.\*/
/\* %% 86400 is 24-hours.\*/
/\* {leeway\_seconds, 30},\*/
/\*
\*/
/\* %% How often the garbage collection daemon\*/
/\* %% waits in-between gc batches.\*/
/\* %% 900 is 15-minutes.\*/
/\* {gc\_interval, 60},\*/
/\*
\*/
/\* %% How long a move to the garbage\*/
/\* %% collection to do list can remain\*/
/\* %% failed, before we retry it.\*/
/\* %% 21600 is 6-hours.\*/
/\* {gc\_retry\_interval,300},\*/





\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

