---
title: "RE: Riak 2.1.4 crashes with Out of Memory Error"
description: ""
project: community
lastmod: 2017-05-04T01:58:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg18201"
mailinglist_parent_id: "msg18200"
author_name: "Jerald"
project_section: "mailinglistitem"
sent_date: 2017-05-04T01:58:18-07:00
---


Hi Magnus Kessler,

The configuration looks good.

[root@server205 bin]# ./riak config effective | grep "\_dir"
anti\_entropy.data\_dir = $(platform\_data\_dir)/anti\_entropy
bitcask.data\_root = $(platform\_data\_dir)/bitcask
leveldb.data\_root = $(platform\_data\_dir)/leveldb
log.console.file = $(platform\_log\_dir)/console.log
log.crash.file = $(platform\_log\_dir)/crash.log
log.error.file = $(platform\_log\_dir)/error.log
platform\_bin\_dir = ./bin
platform\_data\_dir = ./data
platform\_etc\_dir = ./etc
platform\_lib\_dir = ./lib
platform\_log\_dir = ./log
ring.state\_dir = $(platform\_data\_dir)/ring
search.anti\_entropy.data\_dir = $(platform\_data\_dir)/yz\_anti\_entropy
search.root\_dir = $(platform\_data\_dir)/yz
search.temp\_dir = $(platform\_data\_dir)/yz\_temp

Regards,
Jerald
Emerging Products and Technologies | Avaya
Voice +91 44 6108 4258 | ajer...@avaya.com | Chennai, 
India

From: Magnus Kessler [mailto:mkess...@basho.com]
Sent: Thursday, May 04, 2017 12:36 PM
To: Arulappan, Jerald (Jerald) \*\*CTR\*\* 
Cc: riak-users@lists.basho.com
Subject: Re: Riak 2.1.4 crashes with Out of Memory Error

On 2 May 2017 at 14:56, Arulappan, Jerald (Jerald) 
> wrote:
Hi,

I am using a single node riak server 2.1.4 with bitcask as backend for storing 
files.
The riak node stops working after every week. (Looks like when the active 
anti-entropy process recreates the hash tree)
The sylog shows Out of memory Error. But the console.log shows "sst: No such 
file or directory"
Syslog Error:

Apr 26 17:39:37 TLCCBAPRO2 kernel: Out of memory: Kill process 16685 (beam.smp) 
score 824 or sacrifice child
Apr 26 17:39:37 TLCCBAPRO2 kernel: Killed process 16987 (sh) total-vm:106168kB, 
anon-rss:116kB, file-rss:0kB
Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill process 16685 (beam.smp) 
score 824 or sacrifice child
Apr 26 17:39:41 TLCCBAPRO2 kernel: Killed process 30374 (memsup) 
total-vm:4112kB, anon-rss:80kB, file-rss:0kB
Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill process 16685 (beam.smp) 
score 824 or sacrifice child
Apr 26 17:39:41 TLCCBAPRO2 kernel: Killed process 14351 (cpu\_sup) 
total-vm:4112kB, anon-rss:68kB, file-rss:0kB
Apr 26 17:39:41 TLCCBAPRO2 kernel: Out of memory: Kill process 16685 (beam.smp) 
score 824 or sacrifice child
Apr 26 17:39:41 TLCCBAPRO2 kernel: Killed process 30385 (sh) total-vm:106164kB, 
anon-rss:136kB, file-rss:416kB
Apr 26 17:44:48 TLCCBAPRO2 run\_erl[16682]: Erlang closed the connection.

Console.log:

2017-04-26 17:37:03.493 [info] 
<0.625.0>@riak\_kv\_vnode:maybe\_create\_hashtrees:227 
riak\_kv/91343852333181432387730302044767688728495783936: unable to start 
index\_hashtree: {error,{{badmatch,{error,{db\_open,"IO error: 
./data/anti\_entropy/91343852333181432387730302044767688728495783936/sst\_0/001954.sst:
 No such file or 
directory"}}},[{hashtree,new\_segment\_store,2,[{file,"src/hashtree.erl"},{line,675}]},{hashtree,new,2,[{file,"src/hashtree.erl"},{line,246}]},{riak\_kv\_index\_hashtree,do\_new\_tree,3,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,610}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]},{riak\_kv\_index\_hashtree,init\_trees,3,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,474}]},{riak\_kv\_index\_hashtree,init,1,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,268}]},{gen\_server,init\_it,6,[{file,"gen\_server.erl"},{line,304}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,239}]}]}}
2017-04-26 17:37:03.515 [error] <0.30178.2881> CRASH REPORT Process 
<0.30178.2881> with 0 neighbours exited with reason: no match of right hand 
value {error,{db\_open,"IO error: 
./data/anti\_entropy/936274486415109681974235595958868809467081785344/000037.sst:
 No such file or directory"}} in hashtree:new\_segment\_store/2 line 675 in 
gen\_server:init\_it/6 line 328
2017-04-26 17:37:03.515 [info] 
<0.623.0>@riak\_kv\_vnode:maybe\_create\_hashtrees:227 
riak\_kv/45671926166590716193865151022383844364247891968: unable to start 
index\_hashtree: {error,{{badmatch,{error,{db\_open,"IO error: 
./data/anti\_entropy/45671926166590716193865151022383844364247891968/sst\_0/002239.sst:
 No such file or 
directory"}}},[{hashtree,new\_segment\_store,2,[{file,"src/hashtree.erl"},{line,675}]},{hashtree,new,2,[{file,"src/hashtree.erl"},{line,246}]},{riak\_kv\_index\_hashtree,do\_new\_tree,3,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,610}]},{lists,foldl,3,[{file,"lists.erl"},{line,1248}]},{riak\_kv\_index\_hashtree,init\_trees,3,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,474}]},{riak\_kv\_index\_hashtree,init,1,[{file,"src/riak\_kv\_index\_hashtree.erl"},{line,268}]},{gen\_server,init\_it,6,[{file,"gen\_server.erl"},{line,304}]},{proc\_lib,init\_p\_do\_apply,3,[{file,"proc\_lib.erl"},{line,239}]}]}}
2017-04-26 17:37:03.516 [error] <0.30207.2881> CRASH REPORT Process 
<0.30207.2881> with 0 neighbours exited with reason: no match of right hand 
value {error,{db\_open,"IO error: 
./data/anti\_entropy/45671926166590716193865151022383844364247891968/sst\_0/002239.sst:
 No such file or directory"}} in hashtree:new\_segment\_store/2 line 675 in 
gen\_server:init\_it/6 line 328

The complete logs are in the attached zip file. Any thoughts on the root cause 
and possible solution to overcome this is much appreciated.

Regards,
Jerald



Hi Jerald,

I suspect that there is a mis-configuration on your setup. Please check by 
running `riak config effective | grep "\_dir"`, what the values of 
`platform\_data\_dir` and `anti\_entropy.data\_dir` are set to.

Kind Regards,

Magnus


--
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

