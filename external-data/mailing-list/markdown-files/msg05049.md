---
title: "Re: Secondary Index ??"
description: ""
project: community
lastmod: 2011-10-05T06:12:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05049"
mailinglist_parent_id: "msg05048"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-10-05T06:12:17-07:00
---



On 5 Oct 2011, at 13:45, Roland Karlsson wrote:

> Hi,
> 
> I might not look hard enough - but I cannot find how to use
> the secondary indices from the riakc erlang client interface.
> No example and no manual.

Ooops, we'll get on that.

> 
> I need a simple example how to write an indexed object
> and also a simple example how to look it up via the index.
> 
> This is my own try to write and lookup an object
> It does not work :)

Doesn't work crash or doesn't work, you get {ok, []} when you query the index?

> 
> ----------------------------------------------------------
> write\_index(Pid) -> 
> 
> 
> 
> Bucket = <<"persons">>,
> Key = <<"bosse">>,
> Index = {<<"lives">>, <<"sumatra">>},

Indexes should have a suffix of either \_bin for binary or \_int for integer.

> Obj = riakc\_obj:new(Bucket, Key, <<"1949">>),
> Meta = dict:store(?MD\_INDEX, Index, dict:new()),

Index should be a list. If it \*was\* in a list you would have got an error 
{error,<<"{precommit\_fail,[{unknown\_field\_type,<<\"lives\">>}]}">>} on put. 

> Obj2 = riakc\_obj:update\_metadata(Obj, Meta),
> riakc\_pb\_socket:put(Pid, Obj2).
> ----------------------------------------------------------
> read\_index(Pid) ->
> Bucket = <<"persons">>,
> Index = <<"lives">>,

Again, the suffix. or you'll get 
{error,<<"{inputs,[{unknown\_field\_type,<<\"lives\">>}]}">>} when you do that 
get\_index.

> IndexKey = <<"sumatra">>,
> riakc\_pb\_socket:get\_index(Pid, Bucket, Index, IndexKey). 
> 
> 
> ----------------------------------------------------------

Do \_all\_ that and I get {ok,[[<<"persons">>,<<"bosse">>]]} as the output from 
get\_index.

We'll get those docs updated.

Cheers

Russell
> 
> 
> /Roland
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

