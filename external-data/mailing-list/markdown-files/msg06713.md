---
title: "Re: is there easy way to transfer mongo collections to riak?"
description: ""
project: community
lastmod: 2012-02-23T10:23:25-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06713"
mailinglist_parent_id: "msg06705"
author_name: "Will Moss"
project_section: "mailinglistitem"
sent_date: 2012-02-23T10:23:25-08:00
---


Hey Dominik,

To answer the question in your subject line, no. To quote one of the guys I
work with, "You're the bitch of data." That said, I'm extremely happy we
did it. Riak does what it says it's going to do when it says it will and
doesn't seem to really ever go down. I can't say the same for Mongo.

We did this for some of the data we have in Mongo (and are planning to move
the rest in the near future) and it certainly wasn't painless. What we did
that worked reasonably well was:
1. Change all our mongo query patterns so that we were effectively using it
a key-value store (i.e. no secondary indexes or other complex queries).
2. Write code that read an existing record from Mongo and wrote it to Riak.
The actual schema stayed about the same, but we decided to go with protocol
buffers in Riak since they are much more efficient at representing data. We
mapped a single collection to a single bucket in Riak.
3. Change all the queries to Riak instead of Mongo.
4. Then, when we were ready to actually kick off the migration, we migrated
uses as the logged in. So, if they had not been migrated, we delayed their
login slightly while we copied the necessary data out of mongo and into
Riak.

The biggest problem we ran into was conflict resolution. We did a few
things wrong with our resolution function early on that caused our cluster
to get very angry (read: tap out gigabit between the nodes). The best
advice I can give you when your new cluster starts running is to watch the
object size and sibling count numbers like a hawk. If either of those look
like they are consistently rising, I'll wager most anything that you've got
a problem is your resolution code.

Happy to provide more lessons learned if you have specific questions once
you get started.

Will


2012/2/23 Dominik MagoÅ„ 

> Hi,
>
> I'm considering to change mongo to riak - was trying to find what's the
> best way to get data from mongo collections and put them to the riak?
>
> Thanks,
> Dominik
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

