---
title: "Re: Riak MR returns JSON Object on occasion"
description: ""
project: community
lastmod: 2012-12-19T12:04:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09635"
mailinglist_parent_id: "msg09634"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2012-12-19T12:04:09-08:00
---


It looks like mochijson2 has an assumption that anything that looks
like a proplist (a list of 2-tuples) gets turned into a hash.

7> list\_to\_binary(mochijson2:encode([{a , b}, {foo, bar}])).
<<"{\"a\":\"b\",\"foo\":\"bar\"}">>

This is likely something that should be documented, but it doesn't
seem fixable, at least on the MR side, as JSON has no 'tuple' notion.
A workaround for the time being would be to use a list of length-2
lists.

Clients should probably not explode on seeing this.

On Wed, Dec 19, 2012 at 2:36 PM, Elias Levy  wrote:
> Resending as I did not get a response from Basho folks.
>
> Is this expected behavior?
>
>
>
> On Fri, Dec 14, 2012 at 5:08 PM, Elias Levy 
> wrote:
>>
>> It appears that the Riak MR API can on occasions return a JSON Object,
>> rather than an Array. This blows up the Ruby client, and I am guessing
>> probably some other ones. I've opened an issue for the Ruby client. See
>> https://github.com/basho/riak-ruby-client/issues/67.
>>
>> I came across the issue while writing an Erlang map phase function to bulk
>> fetch values while returning their key. The function is:
>>
>> map\_object\_key\_value({error, notfound}, \_, \_) -> [];
>> map\_object\_key\_value(RiakObject, \_, \_) ->
>> [{ riak\_object:key(RiakObject), riak\_object:get\_value(RiakObject) }].
>>
>> It appears that Riak (or mochijson2?) will convert an array of 2 tuples
>> into a JSON hash when returning the data.
>>
>> This is actually quite nice, at least for this application, as its exactly
>> what I want, but it seems is either undocumented or a bug, since clients do
>> not respond well to it.
>>
>> Thoughts?
>>
>> Elias Levy
>
>
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

