---
title: "MapReduce query returns case_clause badmatch?"
description: ""
project: community
lastmod: 2011-07-15T11:07:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04017"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-07-15T11:07:16-07:00

---


When running several maps and one reduce against a bucket, I'm getting an
error, info is below.
Any idea what I'm doing wrong?

Data submitted (printed as php-style array):
array
 (
 'inputs' => 'Course'
 'query' => array
 (
 '0' => array
 (
 'map' => array
 (
 'keep' => false
 'language' => 'javascript'
 'arg' => null
 'source' => 'function(v){return [v];}'
 )
 )
 '1' => array
 (
 'map' => array
 (
 'keep' => false
 'language' => 'javascript'
 'arg' => null
 'source' => '
 function(value){
 if(!value.not\_found) {
 var object = Riak.mapValuesJson(value)[0];
 var val = object[\"idNumber\"].toLowerCase();
 if((val.match(/lbst/))) {
 return [value];
 }
 }
 return [];
 }
 '
 )
 )
 '2' => array
 (
 'map' => array
 (
 'keep' => false
 'language' => 'javascript'
 'arg' => null
 'source' => 'function(){return [1]}'
 )
 )
 '3' => array
 (
 'reduce' => array
 (
 'keep' => true
 'language' => 'javascript'
 'arg' => null
 'name' => 'Riak.reduceSum'
 )
 )
 )
 )


And here is the [start of] the response I get, below.
What's interesting is, I also get back the results of my query (or at least,
the contents of the bucket...).

 array
 (
 'headers' => array
 (
 'http\_code' => 500
 'server' =>
'MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)'
 'date' => 'Fri, 15 Jul 2011 18:02:25 GMT'
 'content-type' => 'text/html'
 'content-length' => '2453'
 )
 'body' =>
'500 Internal Server
ErrorInternal Server Error
=====================

The server
encountered an error while processing this request:  

```
{error,
    {error,
        {case_clause,
            {{badmatch,
                 {struct,
                     [{<<\"bucket\">>,<<\"Course\">>},
                      {<<\"key\">>,
.....
*



Jonathan Langevin
Systems Administrator
Loom Inc.
Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
www.loomlearning.com - Skype: intel352
*
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com


```
