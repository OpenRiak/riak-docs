---
title: "Re: using the erlang API for riak search"
description: ""
project: community
lastmod: 2010-12-14T11:36:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01789"
mailinglist_parent_id: "msg01788"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2010-12-14T11:36:42-08:00
---


Hi Carson,

That looks like a simple typo. ;-) The name of the module is
'riakc\_pb\_socket' module. Notice the 'c' after 'riak'.

Best,
Rusty

On Tue, Dec 14, 2010 at 2:30 PM, carson li wrote:

> Hi Rusty,
>
> That makes sense but i'm still running into problems. My code is simple
>
> Pid = get\_riak\_client(),
> {ok, Results} = riak\_pb\_socket:search(Pid, "testB", "firstName:Billie").
>
> This returns the following error.
>
> {error,{error,undef,
> [{riak\_pb\_socket,search,[<0.97.0>,"testB","firstName:Billie"]},
> {webmachine\_demo\_resource,to\_text,2},
> {webmachine\_demo\_resource,to\_html,2},
> {webmachine\_resource,resource\_call,3},
> {webmachine\_resource,do,3},
> {webmachine\_decision\_core,resource\_call,1},
> {webmachine\_decision\_core,decision,1},
> {webmachine\_decision\_core,handle\_request,2}]}}
>
>
> So something isn't right, and i'm not getting any results back. What
> exactly am i doing wrong? Just to double check that the query itself is
> correct and the data is there, going to the terminal, and doing a
> "search-cmd search testB "firstName:Billie" returns me
>
> :: Searching for 'firstName:Billie' in testB...
>
> ------------------------------
>
> index/id: testB/testK1
> p -> [0]
> score -> 0.5
>
> ------------------------------
>
> :: Found 1 results.
>
>
> So i know the item is in there. is my syntax wrong? or am i missing
> something?
>
>
> On Tue, Dec 14, 2010 at 2:01 PM, Rusty Klophaus  wrote:
>
>> Hi Carson,
>>
>> You are definitely on the right track. The SearchQuery parameter is a
>> Lucene-syntax-ish search query, and the Bucket parameter is the bucket on
>> which to search. You can find more information on the query syntax here:
>> http://wiki.basho.com/display/RIAK/Riak+Search+-+Querying
>>
>> Usage is as follows:
>>
>> {ok, Pid} = riakc\_pb\_socket:start("127.0.0.1", "8087"),
>> Bucket = "json",
>> SearchQuery = "firstname:John"),
>> {ok, BucketKeyList} = riakc\_pb\_socket:search(Pid, Bucket, SearchQuery,
>> riakc\_pb\_socket:stop(Pid).
>>
>> You can also do more complicated things like using the results to spawn a
>> map/reduce operation by adding a MapReducePhases parameter. You can find
>> more information on map/reduce phases here:
>> http://wiki.basho.com/display/RIAK/MapReduce
>>
>> {ok, Result} = riakc\_pb\_socket:search(Pid, "json", "firstname:John",
>> MapReducePhases, TimeoutInMS),
>>
>> Best,
>> Rusty
>>
>> On Mon, Dec 13, 2010 at 4:33 PM, carson li > liquidanalytics.com> wrote:
>>
>>> hey everyone,
>>>
>>> i just started off with using riak search. (i have some basic riak
>>> experience) and i don't know how to use the erlang api for riak to do search
>>> queries.
>>>
>>> what i've done so far
>>> ------------------------------
>>> I have successfully installed the KV hook, put in a json document,
>>> and also used the search-cmd to retrieve something. for reference i put
>>> in the json
>>>
>>> {
>>> firstname:"John",
>>> lastName:"Smith"
>>> }
>>>
>>> with the command curl -X PUT http://127.0.0.1:8098/riak/test/123 -H
>>> "Content-Type: application/json" -d @test.json
>>>
>>> to retrieve something i by navigating to riah search's bin, then
>>> ./search-cmd search json firstname:John
>>>
>>> the above works well.
>>> now i'm buildling an aplpication with webmachine / erlang. and i want to
>>> be able to perform searches as well.
>>> the wiki indicates that the Erlang api should support this
>>>
>>> https://wiki.basho.com/display/RIAK/Riak+Search+-+Querying
>>>
>>> looking at riakc\_pb\_socket.erl, i see there is a search method that has
>>> the signature search(Pid, Bucket, SearchQuery)
>>>
>>> so what exactly is SearchQuery, how is it supposed to look like. So it
>>> just gets passed into a mapred\_search?
>>> I'm confused on how this works. Can someone please provide a simple
>>> example, of how i can search for say firstname:John with the json above?
>>>
>>> any help would be greatly appreciated.
>>>
>>>
>>>
>>> --
>>> Carson Li
>>> Liquid Analytics
>>> carson...@liquidanalytics.com
>>> 647-273-1024
>>>
>>>
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>
>>>
>>
>
>
> --
> Carson Li
> Liquid Analytics
> carson...@liquidanalytics.com
> 647-273-1024
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

