---
title: "Re: Riak crashed with MANIFEST not found"
description: ""
project: community
lastmod: 2012-05-25T18:37:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07536"
mailinglist_parent_id: "msg07535"
author_name: "Nam Nguyen"
project_section: "mailinglistitem"
sent_date: 2012-05-25T18:37:03-07:00
---


Hi Justin,

I had essentially done the same thing you suggested. I moved the affected 
directory out of leveldb and restarted riak. Though I did not run repair, it 
seemed to go well. The nodes are leaving the cluster now.

However, it has been three hours and riak-admin transfers still shows many 
partitions to handoff. I'm not sure if I should wait for more before doing a 
force-remove.

Thanks,
Nam


On May 25, 2012, at 5:38 PM, jshoffstall wrote:

> Hi, Nam, 
> 
> On the node that is reporting the LevelDB Manifest error, I would do the
> following: 
> 
> 1. Stop the node if it isn't down already. 
> 
> 2. Backup
> /var/lib/riak/leveldb/502391187832497878132516661246222288006726811648 to
> another folder outside of /var/lib/riak/leveldb. 
> 
> 3. Run the erl binary included with Riak (typically underneath
> /usr/lib/riak/erts-\*/bin or /usr/lib64/riak/erts-\*/bin in Linux) to startup
> an Erlang shell. 
> 
> 4. Issue the following to open the node's LevelDB database: 
> [application:set\_env(eleveldb, Var, Val) || {Var, Val} <- 
> [{max\_open\_files, 2000}, 
> {block\_size, 1048576}, 
> {cache\_size, 20\*1024\*1024\*1024}, 
> {sync, false}, 
> {data\_root, "/var/lib/riak/leveldb"}]]. 
> 
> 5. Run 
> eleveldb:repair("502391187832497878132516661246222288006726811648", []). 
> 
> 6. After the repair has completed, run 
> q(). 
> or hit ^c twice to exit the shell. 
> 
> 7. Restart Riak. 
> 
> Let us know how this goes. If you run into any more trouble, ping the list
> and we'll give you a hand! 
> 
> Regards, 
> 
> Justin Shoffstall 
> Developer Advocate | Basho Technologies, Inc. 
> 
> 
> --
> View this message in context: 
> http://riak-users.197444.n3.nabble.com/Riak-crashed-with-MANIFEST-not-found-tp4015987p4016113.html
> Sent from the Riak Users mailing list archive at Nabble.com.
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

