---
title: "preflist_exhausted with map-reduce and riak-js"
description: ""
project: community
lastmod: 2012-04-02T15:25:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07116"
mailinglist_parent_id: "msg07106"
author_name: "Matthew Tovbin"
project_section: "mailinglistitem"
sent_date: 2012-04-02T15:25:32-07:00
---


Unfortunately, yes, Jon.

Here are my log files after setting 128/128 for 'map\_js\_vm\_count' and
'reduce\_js\_vm\_count' accordingly and restarting all the nodes (see attached
app.config).

If you need any other information provided or tests performed please let me
know.

\*-Console.log:\*
2012-04-02 15:16:56.848 [notice]
<0.22138.162>@riak\_kv\_js\_manager:blocking\_dispatch:247 JS call failed: All
VMs are busy.
2012-04-02 15:16:56.853 [error] <0.22121.162> gen\_fsm <0.22121.162> in
state wait\_pipeline\_shutdown terminated with reason: {sink\_died,shutdown}
2012-04-02 15:16:56.860 [error] <0.22121.162> CRASH REPORT Process
<0.22121.162> with 0 neighbours crashed with reason: {sink\_died,shutdown}
2012-04-02 15:16:56.862 [error] <0.1451.0> Supervisor riak\_pipe\_builder\_sup
had child undefined started with {riak\_pipe\_builder,start\_link,undefined}
at <0.22121.162> exit with reason {sink\_died,shutdown} in context
child\_terminated

\*-Error.log:\*
\*\* State machine <0.22121.162> terminating
\*\* Last message in was
{'DOWN',#Ref<0.0.33.48784>,process,<0.22119.162>,shutdown}
\*\* When State == wait\_pipeline\_shutdown
\*\* Data ==
{state,[{sink,{fitting,<0.22119.162>,#Ref<0.0.33.48768>,{riak\_kv\_pipe\_get,bkey\_chash},{riak\_kv\_pipe\_get,bkey\_nval}}},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},{log,{sink,{fitting,<0.21554.162>,#Ref<0.0.33.48768>,sink,undefined}}}],{pipe,<0.22121.162>,[{listkeys,{fitting,<0.22122.162>,#Ref<0.0.33.48768>,{chash,key\_of},1}}],{fitting,<0.22119.162>,#Ref<0.0.33.48768>,{riak\_kv\_pipe\_get,bkey\_chash},{riak\_kv\_pipe\_get,bkey\_nval}}},[{{fitting,<0.22122.162>,#Ref<0.0.33.48768>,{chash,key\_of},1},#Ref<0.0.33.48787>}],#Ref<0.0.33.48784>}
\*\* Reason for termination =
\*\* {sink\_died,shutdown}
2012-04-02 15:16:56 =CRASH REPORT====
 crasher:
 initial call: riak\_pipe\_builder:init/1
 pid: <0.22121.162>
 registered\_name: []
 exception exit: {sink\_died,shutdown}
 in function gen\_fsm:terminate/7
 in call from proc\_lib:init\_p\_do\_apply/3
 ancestors: [riak\_pipe\_builder\_sup,riak\_pipe\_sup,<0.1448.0>]
 messages: [{'DOWN',#Ref<0.0.33.48787>,process,<0.22122.162>,shutdown}]
 links: [<0.1451.0>]
 dictionary:
[{eunit,[{module,riak\_pipe\_builder},{ref,#Ref<0.0.33.48768>},{spec,[{fitting\_spec,listkeys,riak\_kv\_pipe\_listkeys,undefined,{chash,key\_of},1,64}]},{options,[{sink,{fitting,<0.22119.162>,#Ref<0.0.33.48768>,{riak\_kv\_pipe\_get,bkey\_chash},{riak\_kv\_pipe\_get,bkey\_nval}}},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},{log,{sink,{fitting,<0.21554.162>,#Ref<0.0.33.48768>,sink,undefined}}}]},{fittings,[{{fitting,<0.22122.162>,#Ref<0.0.33.48768>,{chash,key\_of},1},#Ref<0.0.33.48787>}]}]}]
 trap\_exit: false
 status: running
 heap\_size: 987
 stack\_size: 24
 reductions: 251
 neighbours:
2012-04-02 15:16:56 =SUPERVISOR REPORT====
 Supervisor: {local,riak\_pipe\_builder\_sup}
 Context: child\_terminated
 Reason: {sink\_died,shutdown}
 Offender:
[{pid,<0.22121.162>},{name,undefined},{mfargs,{riak\_pipe\_builder,start\_link,undefined}},{restart\_type,temporary},{shutdown,brutal\_kill},{child\_type,worker}]


-Matthew



On Mon, Apr 2, 2012 at 12:27, Jon Meredith  wrote:

> Very strange.
>
> Are you seeing the
>
> 16:40:50.037 [notice] JS call failed: All VMs are busy.
>
> message in your console.log files on any of the nodes in your cluster?
>
> Jon
>
>
> On Mon, Apr 2, 2012 at 11:48 AM, Matthew Tovbin wrote:
>
>> Jon,
>>
>> Thanks for the reply. I tried increasing the 'map\_js\_vm\_count' and
>> 'reduce\_js\_vm\_count' on the cluster to the values you suggested 24/18
>> and even larger ones 32/24 and 128/128, but with no success - I still get
>> the same error in the console log of the node.
>>
>> What are we missing?!
>>
>> -Matthew
>>
>>
>>
>>
>>


app.config
Description: Binary data
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

