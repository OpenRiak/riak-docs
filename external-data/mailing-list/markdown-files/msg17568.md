---
title: "riak TS max concurrent queries + overload error"
description: ""
project: community
lastmod: 2016-07-27T15:20:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg17568"
author_name: "Chris.Johnson"
project_section: "mailinglistitem"
sent_date: 2016-07-27T15:20:40-07:00

---


Hello!

We are experiencing error messages from the client that we don’t totally 
understand. They look like the following:



Checking the riak error and crash logs, I’m seeing “overload” errors which I 
assume is causing the “no response from backend” client errors:

{error,
 badarg,
 [{erlang,iolist\_to\_binary,[overload],[]},
 
{riak\_kv\_ts\_svc,make\_rpberrresp,2,[{file,"src/riak\_kv\_ts\_svc.erl"},{line,483}]},
 
{riak\_kv\_ts\_svc,sub\_tsqueryreq,4,[{file,"src/riak\_kv\_ts\_svc.erl"},{line,445}]},
 {riak\_kv\_pb\_ts,process,2,[{file,"src/riak\_kv\_pb\_ts.erl"},{line,71}]},
 
{riak\_api\_pb\_server,process\_message,4,[{file,"src/riak\_api\_pb\_server.erl"},{line,388}]},
 
{riak\_api\_pb\_server,connected,2,[{file,"src/riak\_api\_pb\_server.erl"},{line,226}]},
 {riak\_api\_pb\_server,decode\_buffer,2,[{file,...},...]},...]}

I’m curious if these overload errors are caused by clients requesting more 
concurrent TS queries than our current setting for 
timeseries\_max\_concurrent\_queries allows OR if the the 
timeseries\_max\_concurrent\_queries is set too high and we are causing riak to 
crash.

Do you have any recommendations on what timeseries\_max\_concurrent\_queries 
should be set to relative to hardward specs? I assume it should be limited 
based on disk I/O bandwidth.

Also, does anyone have any recommendations on query pooling so we can guarantee 
that multiple clients will not generate more queries than the cluster can 
handle? I like HAProxy for HTTP connection pooling but it doesn’t seem like it 
would work well for limiting the number of global queries from multiple PBC 
clients.

Thank you!

Chris
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

