---
title: "Re: Problem with fast track"
description: ""
project: community
lastmod: 2010-12-05T19:56:34-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01728"
mailinglist_parent_id: "msg01722"
author_name: "David Smith"
project_section: "mailinglistitem"
sent_date: 2010-12-05T19:56:34-08:00
---


This issue is now fixed in riak\_kv HEAD:

https://github.com/basho/riak\_kv/commit/7dda1073e2c3cc3c020c08974441e803eb967714

If you're building from source, you'll need to make sure deps/riak\_kv
is updated accordingly.

D.

On Sun, Dec 5, 2010 at 8:43 AM, David Smith  wrote:
> The specific bug was introduced here (line 298 or so):
>
> https://github.com/basho/riak\_kv/commit/016c62efade1ec5cd663ff01ef6ec0e92e31b1d9
>
> I inadvertently changed a literal while reworking the patch. The Right
> Fix (tm) should have been to use the constants in riak\_kv\_wm\_raw.hrl
> to avoid this specific type of bug. I'll open a bug later today and
> correct this problem.
>
> My apologies for the inconvenience.
>
> D.
>
> On Sun, Dec 5, 2010 at 8:31 AM, David Smith  wrote:
>> This bug appears to be related to some recently landed enhancements to
>> ETags generation in webmachine. I'll take a closer look later today.
>>
>> Thanks,
>>
>> D.
>>
>> On Sat, Dec 4, 2010 at 10:18 PM, Bryan Nagle
>>  wrote:
>>> I re-did my installation from the tarball instead of git, and your right,
>>> its now working perfectly.  Thank you for the quick response.
>>> Bryan Nagle
>>> Liquid Analytics
>>> bryan.na...@liquidanalytics.com
>>>
>>>
>>> On Sat, Dec 4, 2010 at 11:55 PM, Sean Cribbs  wrote:
>>>>
>>>> This is a bug that was introduced recently. Try using the source tarball
>>>> for now ( http://downloads.basho.com/riak/riak-0.13/riak-0.13.0.tar.gz ),
>>>> we'll fix this before 0.14 is released.
>>>>
>>>> Sean Cribbs 
>>>> Developer Advocate
>>>> Basho Technologies, Inc.
>>>> http://basho.com/
>>>> On Dec 4, 2010, at 11:41 PM, Bryan Nagle wrote:
>>>>
>>>> Hi,
>>>> I am new to Riak, and am trying to go through the fast track
>>>> get familiar with it.  However, I am running into a specific problem that I
>>>> have not been able to find a solution for.  I am trying this on two 
>>>> separate
>>>> machines, both running ubuntu 10.04 64, and am having the exact same issue
>>>> on both.  I am following the fast track to the letter, and I have started
>>>> over from scratch on my riak checkout (stop nodes, rm -rf riak, git clone)
>>>> multiple times.  I am currently stuck on this page:
>>>>  https://wiki.basho.com/display/RIAK/Building+a+Development+Environment
>>>> From the stats:
>>>>>
>>>>> "ring\_ownership":
>>>>> "[{'d...@127.0.0.1',21},{'d...@127.0.0.1',21},{'d...@127.0.0.1',22}]"
>>>>
>>>> First I run:
>>>>>
>>>>> $ curl -v -X PUT HTTP://127.0.0.1:8091/riak/images/1.jpg -H
>>>>> "Content-type: image/jpeg" --data-binary @temp.jpg
>>>>>
>>>>> \* About to connect() to 127.0.0.1 port 8091 (#0)
>>>>>
>>>>> \*   Trying 127.0.0.1... connected
>>>>>
>>>>> \* Connected to 127.0.0.1 (127.0.0.1) port 8091 (#0)
>>>>>
>>>>> > PUT /riak/images/1.jpg HTTP/1.1
>>>>>
>>>>> > User-Agent: curl/7.19.7 (x86\_64-pc-linux-gnu) libcurl/7.19.7
>>>>> > OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15
>>>>>
>>>>> > Host: 127.0.0.1:8091
>>>>>
>>>>> > Accept: \*/\*
>>>>>
>>>>> > Content-type: image/jpeg
>>>>>
>>>>> > Content-Length: 5389
>>>>>
>>>>> > Expect: 100-continue
>>>>>
>>>>> >
>>>>>
>>>>> < HTTP/1.1 100 Continue
>>>>>
>>>>> < HTTP/1.1 204 No Content
>>>>>
>>>>> < Vary: Accept-Encoding
>>>>>
>>>>> < Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
>>>>>
>>>>> < Date: Sun, 05 Dec 2010 04:32:58 GMT
>>>>>
>>>>> < Content-Type: image/jpeg
>>>>>
>>>>> < Content-Length: 0
>>>>>
>>>>> <
>>>>>
>>>>> \* Connection #0 to host 127.0.0.1 left intact
>>>>>
>>>>> \* Closing connection #0
>>>>
>>>> This does not return any errors, so I am assuming it is succeeding.
>>>> I then attempt to get this image back - either from a web browser, or from
>>>> curl, and I'm getting:
>>>>>
>>>>> $ curl HTTP://127.0.0.1:8091/riak/images/1.jpg
>>>>>
>>>>> 500 Internal Server
>>>>> ErrorInternal Server Error
=====================

The server
>>>>> encountered an error while processing this
>>>>> request:  

```
[{webmachine_util,escape_quotes,
>>>>>
>>>>>      [{error,
>>>>>
>>>>>           {error,badarg,
>>>>>
>>>>>               [{dict,fetch,
>>>>>
>>>>>                    [<<"X-Riak-VTag">>,
>>>>>
>>>>>                     {dict,5,16,16,8,80,48,
>>>>>
>>>>>
>>>>>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>>>>
>>>>>                         {{[],[],
>>>>>
>>>>>                           [[<<"Links">>]],
>>>>>
>>>>>                           [],[],
>>>>>
>>>>>
>>>>>  [[<<"X-Riak-Tag">>,50,100,74,65,99,120,88,114,71,
>>>>>
>>>>>
>>>>>  119,69,51,55,115,102,56,55,82,82,66,101,109]],
>>>>>
>>>>>                           [],[],[],[],
>>>>>
>>>>>
>>>>>  [[<<"content-type">>,105,109,97,103,101,47,106,112,
>>>>>
>>>>>                             101,103]],
>>>>>
>>>>>                           [],[],
>>>>>
>>>>>
>>>>>  [[<<"X-Riak-Last-Modified">>|{1291,523577,973790}]],
>>>>>
>>>>>                           [],
>>>>>
>>>>>                           [[<<"X-Riak-Meta">>]]}}}]},
>>>>>
>>>>>                {riak_kv_wm_raw,generate_etag,2},
>>>>>
>>>>>                {webmachine_resource,resource_call,3},
>>>>>
>>>>>                {webmachine_resource,do,3},
>>>>>
>>>>>                {webmachine_decision_core,resource_call,1},
>>>>>
>>>>>                {webmachine_decision_core,decision,1},
>>>>>
>>>>>                {webmachine_decision_core,handle_request,2},
>>>>>
>>>>>                {webmachine_mochiweb,loop,1}]}},
>>>>>
>>>>>       "\""]},
>>>>>
>>>>>  {webmachine_decision_core,decision,1},
>>>>>
>>>>>  {webmachine_decision_core,handle_request,2},
>>>>>
>>>>>  {webmachine_mochiweb,loop,1},
>>>>>
>>>>>  {mochiweb_http,headers,5},
>>>>>
>>>>>  {proc_lib,init_p_do_apply,3}]
```


---

mochiweb+webmachine
>>>>> web server


>>>>
>>>> I have also tried uploading json.  If I add "returnbody=true" to the url,
>>>> I see the json body displayed at the end of the curl put command. However,
>>>> when I try to access it afterwards, I get the exact same error as above.  
>>>> If
>>>> anyone has any ideas about what is going on, I would greatly appreciate it.
>>>> Thanks,
>>>> Bryan Nagle
>>>> Liquid Analytics
>>>> bryan.na...@liquidanalytics.com
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>
>>>
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>
>>>
>>
>

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

