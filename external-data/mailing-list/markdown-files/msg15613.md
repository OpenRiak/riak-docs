---
title: "Subtle issues with configuring bitcask sync and merge intervals"
description: ""
project: community
lastmod: 2015-01-31T02:30:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15613"
author_name: "Daniel Abrahamsson"
project_section: "mailinglistitem"
sent_date: 2015-01-31T02:30:07-08:00

---


Hi,

I just wanted to share some experiences configuring Riak, in case some one
else would bump into the same issues.

Bitcask has a sync\_strategy option and a merge\_check\_interval option. The
first one is for forcing Bitcask to sync to disk and the second one is to
ask Bitcask to check if files could be merged. Setting any of these to an
interval less or equal to riak\_kv.vnode\_inactivity\_timeout (defaults to 60
seconds) will have the unexpected effect of making Riak unable to perform
handoffs.

This is due to that a vnode has to be inactive (not receive any messages)
for vnode\_inactivity\_timeout milliseconds before it shuts down and starts
handoff. The merge check and sync options are implemented as messages being
sent to the vnode, and thus setting these values too low will prevent the
vnode from ever becoming inactive.

This applies to Riak 1.3.x, 1.4.x and riak 2.0.x. I have filed a pull
request documenting this at https://github.com/basho/basho\_docs/pull/1511

//Daniel
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

