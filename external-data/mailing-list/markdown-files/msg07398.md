---
title: "Riak cluster unresponsive after single node failure"
description: ""
project: community
lastmod: 2012-05-08T10:25:53-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07398"
author_name: "Armon Dadgar"
project_section: "mailinglistitem"
sent_date: 2012-05-08T10:25:53-07:00

---


We are currently running a 4 node cluster with 1.1.2 on Ubuntu 10.04, and 
are experiencing an issue where losing a single node has cause the entire
cluster to fail.

Nagios reported that node 1 had failed, shortly after, all the logs are filled 
with:
2012-05-08 08:13:22.319 [error] <0.27873.2568>@riak\_kv\_put\_fsm:prepare:199 
Unable to forward put for 
{<<"session">>,<<"3a538aaa-b503-4a2e-94f9-7b62074815c7">>} to 
'r...@east-riak-001.cluster.kiip.me' - nodedown
2012-05-08 08:21:11.890 [error] 
<0.16614.2569>@riak\_core\_handoff\_sender:start\_fold:178 Handoff of partition 
riak\_kv\_vnode 456719261665907161938651510223838443642478919680 from 
'r...@east-riak-004.cluster.kiip.me' to 'r...@east-riak-001.cluster.kiip.me' 
failed 
exit:{noproc,{gen\_server2,call,[{riak\_kv\_handoff\_listener,'r...@east-riak-001.cluster.kiip.me'},handoff\_port,infinity]}}
2012-05-08 08:23:18.005 [error] <0.19071.2569>@riak\_kv\_put\_fsm:prepare:199 
Unable to forward put for 
{<<"session">>,<<"7a015cff-d361-4a38-a624-004f3e7bc76a">>} to 
'r...@east-riak-001.cluster.kiip.me' - timeout
2012-05-08 08:23:21.312 [error] <0.19178.2569>@riak\_kv\_put\_fsm:prepare:199 
Unable to forward put for 
{<<"session">>,<<"b9bd30fa-ddba-4219-b1d9-e4b761797615">>} to 
'r...@east-riak-001.cluster.kiip.me' - timeout
...
2012-05-08 08:30:26.379 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:85 monitor busy\_dist\_port 
<0.4921.2570> 
[{initial\_call,{riak\_kv\_put\_fsm,init,1}},{almost\_current\_function,{erlang,bif\_return\_trap,1}},{message\_queue\_len,0}]
 {#Port<0.35446433>,'r...@east-riak-001.cluster.kiip.me'}
2012-05-08 08:30:26.556 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:89 Monitor got 
{suppressed,port\_events,7}
2012-05-08 08:30:26.616 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:85 monitor busy\_dist\_port 
<0.4930.2570> 
[{initial\_call,{riak\_kv\_put\_fsm,init,1}},{almost\_current\_function,{erlang,bif\_return\_trap,1}},{message\_queue\_len,0}]
 {#Port<0.35446433>,'r...@east-riak-001.cluster.kiip.me'}
2012-05-08 08:30:27.565 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:89 Monitor got 
{suppressed,port\_events,4}
2012-05-08 08:30:27.668 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:85 monitor busy\_dist\_port 
<0.3151.2570> 
[{initial\_call,{riak\_core\_vnode,init,1}},{almost\_current\_function,{erlang,bif\_return\_trap,1}},{message\_queue\_len,0}]
 {#Port<0.35446433>,'r...@east-riak-001.cluster.kiip.me'}
...
2012-05-08 10:20:30.088 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:85 monitor busy\_dist\_port 
<0.31200.2576> [{initial\_call,{riak\_kv\_put\_fsm,init,1}},{almost\_curren
t\_function,{erlang,bif\_return\_trap,1}},{message\_queue\_len,0}] 
{#Port<0.35534018>,'r...@east-riak-001.cluster.kiip.me'}
2012-05-08 10:20:31.261 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:85 monitor busy\_dist\_port 
<0.31202.2576> [{initial\_call,{riak\_kv\_put\_fsm,init,1}},{almost\_curren
t\_function,{erlang,bif\_return\_trap,1}},{message\_queue\_len,0}] 
{#Port<0.35534018>,'r...@east-riak-001.cluster.kiip.me'}
2012-05-08 10:20:32.736 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:85 monitor busy\_dist\_port 
<0.1629.2570> [{initial\_call,{riak\_core\_vnode,init,1}},{almost\_current
\_function,{erlang,bif\_return\_trap,1}},{message\_queue\_len,0}] 
{#Port<0.35534018>,'r...@east-riak-001.cluster.kiip.me'}
2012-05-08 10:20:33.552 [info] 
<0.77.0>@riak\_core\_sysmon\_handler:handle\_event:89 Monitor got 
{suppressed,port\_events,3}




Now all the logs are basically being completely filled with "monitor 
busy\_dist\_port <0.22647.2610> 
[{initial\_call,{riak\_kv\_put\_fsm,init,1}},{almost\_current\_function,{erlang,bif\_return\_trap,1}},{message\_queue\_len,0}]
 {#Port<0.35563927>,'r...@east-riak-001.cluster.kiip.me'}" or similar.

Riak-admin is unable to report any information about the cluster, and same with 
Riak Control.
Both just timeout and return:

production-vpc east-riak-002 riak $ riak-admin ring\_status
Attempting to restart script through sudo -u riak
RPC to 'r...@east-riak-002.cluster.kiip.me' failed: {'EXIT',
 {timeout,
 {gen\_server,call,
 [riak\_core\_gossip,
 legacy\_gossip]}}}


At this point, the cluster has stopped responding to any requests as far as I 
can tell,
or any operations that do complete take well over 60 seconds for a single put 
with w=1.

Wondering if anybody else has seen this, and if so any advise for getting it 
resolved?

Best Regards,

Armon Dadgar

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

