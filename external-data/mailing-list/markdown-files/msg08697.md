---
title: "Ring sanity checker for Nagios"
description: ""
project: community
lastmod: 2012-09-25T14:21:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08697"
author_name: "Mark Smith"
project_section: "mailinglistitem"
sent_date: 2012-09-25T14:21:27-07:00

---


Hi all,

Here at Bump, we recently had a problem where a Riak node that we
wiped incorrectly reconnected to our cluster. This node had no idea
about the ring status and so assumed it owned all of the partitions.
None of them panicked or failed, so we had an undetected split-brain
situation going on that caused application problems.

To guard against this in the future, I wrote a Nagios plugin that some
of you might find useful:

 https://github.com/xb95/nagios-plugins/blob/master/check\_riak\_ring.py

It can be run like this:

 check\_riak\_ring.py --down-ok hostA hostB hostC

It will then talk to those hosts, determine what nodes they're
connected to, and recursively check until it has talked to every node
in the cluster. It then examines the state-of-the-ring that each node
believes is true and alerts if somebody disagrees.

The --down-ok flag is there so it doesn't alert if a node is
unreachable. You can skip using that flag if you'd prefer it to alert
whenever it can't talk to a node.


-- 
Mark Smith // Operations Lead
m...@bumptechnologies.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

