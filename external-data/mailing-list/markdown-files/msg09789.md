---
title: "Re: Socket closed during write?"
description: ""
project: community
lastmod: 2013-01-10T09:57:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09789"
mailinglist_parent_id: "msg09784"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2013-01-10T09:57:45-08:00
---


Does this happen on all of the nodes, or just one? One client, or all
of them? A particular type of request, or just at random?

On Thu, Jan 10, 2013 at 1:29 AM, Brad Heller  wrote:
> I'm using regular ol' ruby-riak client to write to the bucket. It's all 
> pretty much out of the box. There is an ELB in front of the ring with SSL on 
> the ELB and on passed through to the ring, if that's significant.
>
> Nothing special that I can identify. I can attempt to instrument our code 
> further...
>
> On Jan 9, 2013, at 10:05 PM, Evan Vigil-McClanahan  
> wrote:
>
>> The last time I saw this particular error it was someone on a 64bit
>> client setting the content length value incorrectly via libcurl.
>> Requests would work on 64 bit nodes but fail on 32 bit nodes,
>> presumably because the HTTP client was handing the socket a garbage
>> value to read, thereby killing it.
>>
>> Timeouts will generally return a different error. You might be
>> looking at some TCP or HTTP issue. How are you connecting? Is there
>> anything special about the requests that are failing?
>>
>> On Wed, Jan 9, 2013 at 7:29 PM, Brad Heller  wrote:
>>> Hey all,
>>>
>>> I've got a mysterious error with Riak. Certain writes seem to result in an
>>> interesting error being raised by the coordinating node (rem, I'm assuming
>>> it's the coordinating node):
>>>
>>> webmachine error: path="/buckets/my\_bucket/keys"
>>> {error,{error,{badmatch,{error,closed}},
>>> [{webmachine\_request,recv\_unchunked\_body,4,[{file,"src/webmachine\_request.erl"},{line,418}]},
>>> {webmachine\_request,do\_recv\_body,2,[{file,"src/webmachine\_request.erl"},{line,377}]},
>>> {webmachine\_request,call,2,[{file,"src/webmachine\_request.erl"},{line,149}]},
>>> {wrq,req\_body,1,[{file,"src/wrq.erl"},{line,112}]},
>>> {riak\_kv\_wm\_object,accept\_doc\_body,2,[{file,"src/riak\_kv\_wm\_object.erl"},{line,595}]},
>>> {webmachine\_resource,resource\_call,3,[{file,"src/webmachine\_resource.erl"},{line,169}]},
>>> {webmachine\_resource,do,3,[{file,"src/webmachine\_resource.erl"},{line,128}]},
>>> {webmachine\_decision\_core,resource\_call,1,[{file,"src/webmachine\_decision\_core.erl"},{line,48}]}]}
>>>
>>> Web machine returns a 500 error when this happens. I saw online that this
>>> could be the result of a socket being closed out from under the connection
>>> [1]. Any idea how I can get to the bottom of this? Due to the nature of the
>>> reproduction steps, I don't have access to the payload causing the crash
>>> 'till it's actually \*in\* Riak. Someone in #riak on IRC suggested that this
>>> could be the result of write timeouts. Ideas?
>>>
>>> Thanks,
>>>
>>> Brad Heller
>>>
>>> 1:
>>> http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2011-October/006078.html
>>>
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>
>

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

