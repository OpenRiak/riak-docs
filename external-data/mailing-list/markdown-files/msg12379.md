---
title: "Re: Deleting data from LevelDB backend"
description: ""
project: community
lastmod: 2013-09-25T07:01:30-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12379"
mailinglist_parent_id: "msg12377"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2013-09-25T07:01:30-07:00
---


Simon,

I want to point out again that I do not like my answer … but currently lack a 
better one. The manual delete of .sst files should be treated as a last 
resort. Only do it if you really, really cannot wait for normal compactions to 
purge the old data.

To your question:

leveldb keeps a list of .sst table files in its MANIFEST file. If the .sst 
table files are deleted manually, the MANIFEST is no longer accurate. An 
inaccurate MANIFEST file leads to leveldb internal errors and sometimes 
infinite loops.

The repair process erases the current MANIFEST file and builds a new one based 
upon the files actually found on disk.

WARNING: repair takes a really, really long time in Riak 1.2.0 … it gets 
better in 1.2.1 … and improves to something quite reasonable by 1.3 and 1.4.

A discussion about repair can be found here:

https://github.com/basho/leveldb/wiki/repair-notes

Matthew


On Sep 25, 2013, at 9:38 AM, Simon Effenberg  wrote:

> On Wed, 25 Sep 2013 09:15:33 -0400
> Matthew Von-Maszewski  wrote:
> 
>> - run Riak repair on the vnode so that leveldb can create a MANIFEST that 
>> matches the files remaining.
> 
> what do you mean with this? Wait for AAE? Request each key to trigger
> read repair or do I miss something?
> 
> We are in a similar situation.. only sst\_4 exists in our situation but
> we also delete old stuff regularly..
> 
> Cheers
> Simon 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

