---
title: "Re: Search Crashes"
description: ""
project: community
lastmod: 2013-11-20T11:48:54-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13041"
mailinglist_parent_id: "msg13036"
author_name: "Gabriel Littman"
project_section: "mailinglistitem"
sent_date: 2013-11-20T11:48:54-08:00
---


Resending without entire thread:


On Wed, Nov 20, 2013 at 11:38 AM, Gabriel Littman  wrote:

> Hi Ryan,
>
> Thanks for your response, let me get right into it.
>
> 1) We are installed via deb package
> ii riak 1.4.1-1
> Riak is a distributed data store
>
> 2) We did recently upgrade our to riak python library 2.0 but I also have
> a cluster still on the 1.4 client that has similar problems.
>
> 3) We less recently upgraded riak itself from 1.2.x to 1.4. We ended up
> starting with an empty riak store in the processes. Honestly we've had
> many problems with search index even under 1.2. Mostly riak would get into
> a state where it would continuously crash after startup until we
> deleted /var/lib/riak/merge\_index on the node and then rebuilt the search
> index via read/write. The particular problems I'm having now I cannot
> confirm if they were happening under riak 1.2 or not.
>
> looks like allow\_mult is false, but I just confirmed with my colleague
> that \*it was previously set to true\* so it could be that we have a hold
> over issue from that.
> $ curl 'http://10.1.2.95:8098/buckets/ctv\_tvdata/props'
>
> {"props":{"allow\_mult":false,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},"dw":0,"last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"ctv\_tvdata","notfound\_ok":false,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"fun":"precommit","mod":"riak\_search\_kv\_hook"},{"mod":"riak\_search\_kv\_hook","fun":"precommit"}],"pw":0,"r":1,"rw":1,"search":true,"small\_vclock":50,"w":1,"young\_vclock":20}}
>
> Since it is now set to false now would you have a suggestion on how to
> clear the problem? (Delete merge\_index?)
>
> I can package up my logs and send them to you directly if we still feel
> it's needed.
>
> Thank you so much for your help,
>
> Gabe
>
>
>
> On Wed, Nov 20, 2013 at 9:39 AM, Ryan Zezeski  wrote:
>
>> Hi Gabriel,
>>
>> First, let me verify a few things.
>>
>> 1. You are on Riak 1.4? Which patch version? 1.4.2?
>>
>> 2. You recently upgraded you client? Did you have any of these failures
>> before upgrading the client?
>>
>> 3. Have you made any other changes between the time your system was
>> working and the time it started exhibiting these failures? For example, set
>> allow\_mult=true?
>>
>> Given that you are having 'badmatch' hook crashes during insert I have
>> the suspicion that allow\_mult was recently changed to true as the Riak
>> Search hook cannot deal with siblings. What does the following curl show:
>>
>> curl 'http://host:port/buckets/ctv\_tvdata/props'
>>
>> If that has 'allow\_mult: true' then that is your issue.
>>
>> As for your search operations. I'm not sure why they are failing. If you
>> want you could tar.gz all the logs for each node and email that to me.
>>
>> -Z
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

