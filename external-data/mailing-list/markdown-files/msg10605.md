---
title: "Re: Issue with Riak CS Pre-Authenticated URL"
description: ""
project: community
lastmod: 2013-03-27T10:58:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg10605"
mailinglist_parent_id: "msg10604"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2013-03-27T10:58:41-07:00
---


Dave,

This is indeed a bug. I have a fix ready and I will be pushing it up to
github later today. In the meantime, I've opened an issue to track the
problem. Thanks for the report!

https://github.com/basho/riak\_cs/issues/515

Kelly

On Wed, Mar 27, 2013 at 9:18 AM, Kelly McLaughlin  wrote:

> Hey Dave. I'll try to reproduce this issue and get back to you about what
> I find. Thanks.
>
> Kelly
>
> On Wed, Mar 27, 2013 at 8:38 AM, Dave Finster  wrote:
>
>> Just adding a bit more info at the request of shino1.
>>
>> I've got a URL
>>
>>
>> http://intranet-development.myriakcs.com/fdcddce0-78ca-0130-bc9c-482a14143152?AWSAccessKeyId=1PBIAEUBPVXSASP0HKLC&Expires=1364393156&Signature=WMRuKTl73/TcmBj1UyH5agdg+NU=
>>
>> which yields
>>
>> 
>> `AccessDenied`
>> Access Denied
>> 
>> /intranet-development/fdcddce0-78ca-0130-bc9c-482a14143152
>> 
>> 
>> 
>>
>> I've got an nginx server out the front of 2 CS instances but I've also
>> run that URL directly against the CS instances and encountered the same
>> result. I don't see any entries in the logs for Riak/Riak CS/Stanchion
>> about the request aside from the 403 in the CS access logs.
>>
>> Cheers,
>> Dave
>>
>> Begin forwarded message:
>>
>> \*From: \*Dave Finster 
>> \*Subject: \*\*Issue with Riak CS Pre-Authenticated URL\*
>> \*Date: \*27 March 2013 11:46:41 PM AEST
>> \*To: \*riak-users@lists.basho.com
>>
>> Hi Everyone
>>
>> Have been playing with Riak and now CS for a little while and have got
>> everything working by just using the aws-sdk gem and dropped my CS
>> credentials and endpoint in. I do seem to have encountered an issue with
>> the generation of pre-authenticated urls, or the query string auth method.
>> The aws-sdk uses the S3Object.url\_for method (source here:
>> https://github.com/aws/aws-sdk-ruby/blob/master/lib/aws/s3/s3\_object.rb )
>> which appears to property follow the auth guidelines (
>> http://docs.aws.amazon.com/AmazonS3/latest/dev/RESTAuthentication.html#RESTAuthenticationQueryStringAuth
>> ).
>>
>> I'm trying to do a simple GET request for a file in a bucket and every
>> URL that gets generated comes back with 'Access Denied' and 403. The CS
>> access logs also show the same.
>>
>> Wondering if anyone has any tips for diagnosing this issue further. At
>> the moment I've just got my Ruby code downloading the stored file to a
>> TempFile and then feeding that back to the client. Using s3cmd and aws-sdk
>> to fetch the file works fine - just seems to be something to do with the
>> query string auth method.
>>
>> Thanks,
>> Dave
>>
>>
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

