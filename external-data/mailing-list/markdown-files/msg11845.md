---
title: "Unit testing persistence"
description: ""
project: community
lastmod: 2013-07-31T21:43:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg11845"
author_name: "Wagner Camarao"
project_section: "mailinglistitem"
sent_date: 2013-07-31T21:43:22-07:00

---


Hi all ~

Great meetup today - looking forward to upgrading to 1.4

I had a question Mark suggested posting here, then we discussed with a few
other folks too: How do we unit / integration test persistence with riak?

Given a basic dev environment, e.g. running only one riak physical node
locally with all configs default, how do we surely read the data we just
wrote?

I have tried setting DW=all (Durable Write - as recommended for best
consistency in the financial example from the little riak book - section
for developers, more than N/R/W) and tried also using {delete\_mode, keep}
in riak\_kv app.config (since I truncate the buckets after each test suite),
but still, I get intermittent test failures as eventually the data isn't
available for reading right after writing.

Please note I'm trying to avoid mocking / stubbing as well as hacks like
"keep trying to read" until a certain timeout.

I'm looking ideally for a simple configuration or any known best practices.

Thanks
~W
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

