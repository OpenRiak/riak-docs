---
title: "Re: Putting Specific Bucket/Key Combination Gives Timeout"
description: ""
project: community
lastmod: 2011-03-14T05:44:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02631"
mailinglist_parent_id: "msg02630"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-03-14T05:44:36-07:00
---


We are aware of some race-conditions caused by repeatedly accessing a key 
around DELETE requests. Here's one bug:

https://issues.basho.com/show\_bug.cgi?id=555

If you need to clear the data after a test run, I would suggest using the 
'riak\_kv\_test\_backend' from the Ripple project, or simply shut down Riak and 
delete the contents of the bitcask directory.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Mar 14, 2011, at 8:27 AM, Runar Jordahl wrote:

> I am running unit tests against my single-node Riak database installed
> on Ubuntu 10.10 64 bit. The tests write a few objects (key/value) to
> the database, and then end by deleting all keys in the test bucket.
> The test bucket is named “epigenttest”, the key I use is “test”.
> 
> Today the database entered a state where my default bucket/key used
> for tests failed: If I tried doing a PUT using the following URL, I
> got a timeout:
> http://riaktest:8098/riak/epigenttest/test
> 
> However, if I modified the bucket or the key, the operation worked.
> 
> I could always reproduce the problem using bucket/key
> epigenttest/test. I suspect that the database had corrupt data, which
> prevented me from putting epigenttest/test.
> 
> Before running the unit test, Riak reported that the database was empty:
> http://riaktest:8098/riak?buckets=true
> {"buckets":[]}
> 
> I managed to get out of the problem by running “riak reboot”. I cannot
> reproduce the problem again.
> 
> Could there be a bug in Riak when adding/deleting/putting the same
> key? Below I include the result of running Riak Stats.
> 
> 
> Kind regards
> Runar Jordahl
> 
> 
> 
> http://riaktest:8098/stats
> {
> "vnode\_gets": 3,
> "vnode\_puts": 0,
> "read\_repairs": 0,
> "vnode\_gets\_total": 1277,
> "vnode\_puts\_total": 511,
> "node\_gets": 1,
> "node\_gets\_total": 427,
> "node\_get\_fsm\_time\_mean": 25691.0,
> "node\_get\_fsm\_time\_median": 25691,
> "node\_get\_fsm\_time\_95": 25691,
> "node\_get\_fsm\_time\_99": 25691,
> "node\_get\_fsm\_time\_100": 25691,
> "node\_puts": 1,
> "node\_puts\_total": 201,
> "node\_put\_fsm\_time\_mean": 60000872.0,
> "node\_put\_fsm\_time\_median": 60000872,
> "node\_put\_fsm\_time\_95": 60000872,
> "node\_put\_fsm\_time\_99": 60000872,
> "node\_put\_fsm\_time\_100": 60000872,
> "read\_repairs\_total": 5,
> "cpu\_nprocs": 292,
> "cpu\_avg1": 56,
> "cpu\_avg5": 61,
> "cpu\_avg15": 64,
> "mem\_total": 1050324992,
> "mem\_allocated": 521408512,
> "nodename": "riak@127.0.0.1",
> "connected\_nodes": [
> 
> ],
> "sys\_driver\_version": "1.5",
> "sys\_global\_heaps\_size": 0,
> "sys\_heap\_type": "private",
> "sys\_logical\_processors": 1,
> "sys\_otp\_release": "R13B04",
> "sys\_process\_count": 212,
> "sys\_smp\_support": false,
> "sys\_system\_version": "Erlang R13B04 (erts-5.7.5) [source] [rq:1]
> [async-threads:64] [kernel-poll:true]",
> "sys\_system\_architecture": "i486-pc-linux-gnu",
> "sys\_threads\_enabled": true,
> "sys\_thread\_pool\_size": 64,
> "sys\_wordsize": 4,
> "ring\_members": [
> "riak@127.0.0.1"
> ],
> "ring\_num\_partitions": 64,
> "ring\_ownership": "[{'riak@127.0.0.1',64}]",
> "ring\_creation\_size": 64,
> "storage\_backend": "riak\_kv\_bitcask\_backend",
> "pbc\_connects\_total": 0,
> "pbc\_connects": 0,
> "pbc\_active": 0,
> "cluster\_info\_version": "1.0.0",
> "luwak\_version": "1.0.0",
> "skerl\_version": "1.0.0",
> "riak\_kv\_version": "0.14.0",
> "riak\_core\_version": "0.14.0",
> "bitcask\_version": "1.1.5",
> "luke\_version": "0.2.3",
> "webmachine\_version": "1.8.0",
> "mochiweb\_version": "1.7.1",
> "erlang\_js\_version": "0.5.0",
> "runtime\_tools\_version": "1.8.3",
> "crypto\_version": "1.6.4",
> "os\_mon\_version": "2.2.5",
> "riak\_err\_version": "1.0.0",
> "sasl\_version": "2.1.9",
> "stdlib\_version": "1.16.5",
> "kernel\_version": "2.13.5",
> "executing\_mappers": 0
> }
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

