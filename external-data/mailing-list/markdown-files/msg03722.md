---
title: "Re: Correct way to use pbc/mapreduce to do multiget where keys and	bucket names are binary values?"
description: ""
project: community
lastmod: 2011-06-16T10:14:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03722"
mailinglist_parent_id: "msg03556"
author_name: "Jacques"
project_section: "mailinglistitem"
sent_date: 2011-06-16T10:14:47-07:00
---


Well that figures. In micro benchmarks (always unreliable), the two are
not even close . The 20 separate gets blow the map reduce multiget out of
the water. With info likely in os disk cache, we see:

20 gets including forking/joining: ~25ms total
single map reduce multiget using erlang: ~250ms

I guess there must be a lot of overhead using the map reduce framework.

This is for my local single node testing cluster. I'll have to retest in a
multinode cluster...

Is this in alignment with what others are seeing?

Thanks,
Jacques

On Thu, Jun 16, 2011 at 9:52 AM, Jacques  wrote:

> Thanks for the info. As a note, I found that the javascript function was
> having trouble return binary values.
>
> I followed your suggestion and am now using the following function. (Here
> for others.)
>
> -module(multiget).
> -export([key\_value/3]).
>
> key\_value({error, notfound}, \_KD, \_) ->
> none;
> key\_value(RiakObject, \_KD, \_) ->
> [riak\_object:bucket(RiakObject),riak\_object:key(RiakObject),
> riak\_object:get\_value(RiakObject)].
>
>
> Thanks again for your help. I haven't done performance tests yet but am
> hoping that this is more performant than 20 individual gets.
>
> I must say that I'm still quite surprised that a key value store of Riak's
> caliber doesn't have a native binary multiget within the core pbc api.
>
> Jacques
>
> On Thu, Jun 16, 2011 at 5:03 AM, Russell Brown wrote:
>
>> Hi Jaques,
>> Sorry for the slow reply. I think this one just slipped by me.
>>
>> Ok. answers inline below:
>>
>> On 14 Jun 2011, at 18:26, Jacques wrote:
>>
>> Does anybody have any insight on my questions below?
>>
>> Thanks,
>> Jacques
>>
>>
>> On Tue, Jun 7, 2011 at 6:12 PM, Jacques  wrote:
>>
>>> I've been working on this. I have it working with an anonymous
>>> javascript function. I was hoping to move it to using the
>>> "map\_object\_value" built-in erlang function. However, when I attempt to use
>>> this function, I get failures if any of my keys don't exist. Is there a way
>>> to construct my map phase so that it gracefully handles not founds and just
>>> returns what it finds?
>>
>>
>> Yes. riak\_kv\_mapreduce:map\_object\_value accepts an arg value of
>> either "filter\_notfound", "include\_notfound" or "include\_keydata", so your
>> not found values can be omitted by passing "filter\_notfound" as the arg
>> value for the map phase (instead of ATOM\_NONE in your construction.)
>>
>>
>>> Also, using this function, is there a way to return the bucket and key
>>> names?
>>>
>>
>> No not using riak\_kv\_mapreduce:map\_object\_value, you could use
>> riak\_kv\_mapreduce:map\_identity to get the whole riak object (meta data, key
>> and value) or just write your own map reduce function that returns the data
>> you want (and can filter out the not founds just like map\_object\_value)
>>
>> Or can one assume the response order is identical to the order of inputs?
>>>
>>
>> No.
>>
>> deletia
>>
>>
>> Cheers
>>
>> Russell
>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

