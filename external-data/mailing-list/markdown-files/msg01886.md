---
title: "Re: riak indexing/search issue with json"
description: ""
project: community
lastmod: 2011-01-04T23:43:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01886"
mailinglist_parent_id: "msg01885"
author_name: "Joseph Lambert"
project_section: "mailinglistitem"
sent_date: 2011-01-04T23:43:09-08:00
---


Ok, sorry to spam the list,

After upgrading to 0.14.0rc1, it works, except for the list data from solr.
Still the mochijson error.

But, the other problems go away, so maybe it was just the error with the
list in mochijson.

- Joe Lambert

joseph.g.lamb...@gmail.com


On Wed, Jan 5, 2011 at 11:32 AM, Joseph Lambert
wrote:

> Also, I'm getting this with the list:
>
> =ERROR REPORT==== 5-Jan-2011::11:20:29 ===
> webmachine error: path="/solr/test/select"
> {error,{error,badarg,
> [{erlang,list\_to\_integer,["1971 2"]},
> {riak\_search\_utils,to\_integer,1},
> {riak\_indexed\_doc,'-to\_mochijson2/2-lc$^0/1-0-',2},
> {riak\_indexed\_doc,'-to\_mochijson2/2-lc$^0/1-0-',2},
> {riak\_indexed\_doc,to\_mochijson2,2},
> {riak\_solr\_output,'-json\_response/7-lc$^0/1-0-',2},
> {riak\_solr\_output,json\_response,7},
> {riak\_solr\_searcher\_wm,to\_json,2}]}}
>
> when I query Solr.
>
> - Joe Lambert
>
> joseph.g.lamb...@gmail.com
> +86 13656213284
>
>
> On Wed, Jan 5, 2011 at 10:46 AM, Joseph Lambert <
> joseph.g.lamb...@gmail.com> wrote:
>
>> I can definitely repeat this.
>>
>> It seems to work correctly with the array of integers consistently from
>> the erlang console, but the second key in the array does not show using the
>> solr interface. For example, [1971, 2] when indexed as integers will work
>> from console with search:search(<<"test">>, <<"users:0000001971">>) and
>> search:search(<<"test">>, <<"users:0000000002">>), but using http and the
>> solr interface, only
>>
>>
>> http://192.168.1.32:8098/solr/test/select?q=users%3A0000001971&start=0&rows=10&sort=lastUpdatedAt+desc&wt=json'
>> will work (2 is the second key in the array).
>>
>> However, keys like:
>>
>> userData\_viewedBy1559620\_isDeleted
>>
>> do not work at all. It is getting extracted and indexed, but does not work
>> when you search on that value from erlang console, http, or command line.
>>
>> Please tell me I made a mistake and should just kick myself :).
>>
>>
>>
>> - Joe Lambert
>>
>> joseph.g.lamb...@gmail.com
>>
>>
>> On Fri, Dec 31, 2010 at 4:18 PM, Joseph Lambert <
>> joseph.g.lamb...@gmail.com> wrote:
>>
>>> Seems that they are. I haven't repeated over large numbers of different
>>> tests though
>>>
>>> example:
>>>
>>> search:search(<<"test">>, <<"users:0002619082">>).
>>>
>>> curl '
>>> http://192.168.1.47:8098/solr/test/select?q=userData\_viewedBy2619082\_isDeleted%3Afalse&wt=json
>>> '
>>>
>>> riak\_search> s(users:0002619082).
>>>
>>> I've got a sinking feeling it's something I am doing wrong.
>>>
>>>
>>> - Joe Lambert
>>>
>>> joseph.g.lamb...@gmail.com
>>> +86 13656213284
>>>
>>>
>>> On Fri, Dec 31, 2010 at 4:10 PM, Dan Reverri  wrote:
>>>
>>>> Hi Joseph,
>>>>
>>>> Are these results consistently reproducible? Can you provide the full
>>>> queries you are using?
>>>>
>>>> Thanks,
>>>> Dan
>>>>
>>>> Daniel Reverri
>>>> Developer Advocate
>>>> Basho Technologies, Inc.
>>>> d...@basho.com
>>>>
>>>>
>>>> On Thu, Dec 30, 2010 at 11:46 PM, Joseph Lambert <
>>>> joseph.g.lamb...@gmail.com> wrote:
>>>>
>>>>> Hello,
>>>>>
>>>>> I'm having a bit of a problem with k/v indexing and json objects in
>>>>> Riak Search 0.13.0. I have JSON objects of this format:
>>>>>
>>>>> {
>>>>> "id" : 1,
>>>>> "users" : [1559620, 2619082],
>>>>> "userData" : {
>>>>> "viewedBy1559620" : {
>>>>> "isDeleted" : "false"
>>>>> }
>>>>> "viewedBy2619082" : {
>>>>> "isDeleted" : "false"
>>>>> }
>>>>> }
>>>>> }
>>>>>
>>>>> My indexing schema is (also have tried with DefaulAnalyzerFactory):
>>>>>
>>>>> {
>>>>> schema,
>>>>> [
>>>>> {version, "0.0.3"},
>>>>> {default\_field, "id"},
>>>>> {default\_op, "and"},
>>>>> {n\_val, 2},
>>>>> {analyzer\_factory,
>>>>> "com.basho.search.analysis.WhitespaceAnalyzerFactory"}
>>>>> ],
>>>>> [
>>>>> {field, [
>>>>> {name, "id"},
>>>>> {type, integer}
>>>>> ]},
>>>>> {field, [
>>>>> {name, "users"},
>>>>> {type, integer}
>>>>> ]},
>>>>> {dynamic\_field, [
>>>>> {name, "userData\*isDeleted"},
>>>>> {type, string}
>>>>> ]},
>>>>> {dynamic\_field, [
>>>>> {name, "\*"},
>>>>> {required, false},
>>>>> {skip, true}
>>>>> ]}
>>>>> ]
>>>>> }.
>>>>>
>>>>>
>>>>> The appropriate fields are extracted by the extractor and this is the
>>>>> index created by both factories:
>>>>>
>>>>> {riak\_idx\_doc,<<"test">>,
>>>>> <<"6e3833626637965f1df837b63cdcc34b">>,
>>>>> [{<<"id">>,<<"6e3833626637965f1df837b63cdcc34b">>,
>>>>> [{<<"6e3833626637965f1df837b63cdcc34b">>,[0]}]},
>>>>> {<<"userData\_viewedBy1559620\_isDeleted">>,<<"false">>,
>>>>> [{<<"false">>,[0]}]},
>>>>> {<<"userData\_viewedBy2619082\_isDeleted">>,<<"false">>,
>>>>> [{<<"false">>,[0]}]},
>>>>> {<<"users">>,<<"1559620 2619082">>,
>>>>> [{<<"0002619082">>,[1]},{<<"0001559620">>,[0]}]}],
>>>>> [],[],true}
>>>>>
>>>>> The problem comes when I am searching. If I run the following searches
>>>>> 1.) users:0001559620
>>>>> 2.) users:0002619082
>>>>> 3.) userData\_viewedBy1559620\_isDeleted:false
>>>>> 4.) userData\_viewedBy2619082\_isDeleted:false
>>>>>
>>>>> I get these results:
>>>>>
>>>>> using search:search from the riak console:
>>>>> 1.) works
>>>>> 2.) works
>>>>> 3.) does not work
>>>>> 4.) works
>>>>>
>>>>> The same queries from http using the solr interface (properly url
>>>>> encoded, I swear):
>>>>> 1.) does not work
>>>>> 2.) works
>>>>> 3.) does not work
>>>>> 4.) does not work
>>>>>
>>>>> Now, from the interactive shell:
>>>>> 1.) does not work
>>>>> 2.) works
>>>>> 3.) works
>>>>> 4.) does not work
>>>>>
>>>>>
>>>>> Can anyone help explain to me where I am going wrong?
>>>>>
>>>>> - Joe Lambert
>>>>>
>>>>> joseph.g.lamb...@gmail.com
>>>>> +86 13656213284
>>>>>
>>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>>> riak-users mailing list
>>>>> riak-users@lists.basho.com
>>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>>
>>>>>
>>>>
>>>
>>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

