---
title: "Riak storage backend change"
description: ""
project: community
lastmod: 2012-09-23T03:41:32-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08651"
author_name: "hs raghu"
project_section: "mailinglistitem"
sent_date: 2012-09-23T03:41:32-07:00

---


Hi,

 I have query related to Riak storage backend change for buckets.

 In my setup I have defined different storage backends,
mainly differentiated based on r,w,dw values.

 I created a bucket using HTTP api (it used default 'bitcask\_mult'
backend).

 %% Storage\_backend specifies the Erlang module defining the
storage
 %% mechanism that will be used on this node.
 {storage\_backend, riak\_kv\_multi\_backend},

 %% Adding multi backend storage related plugins
 {multi\_backend\_default, <<"bitcask\_mult">>},
 {multi\_backend, [

 %% individual backends
 {<<"bitcask\_mult">>, riak\_kv\_bitcask\_backend, [
 %% bitcask configuration
 {data\_root, "./data/bitcask"},
 {open\_timeout, 4},
 {sync\_strategy, {seconds, 60}},
 {max\_file\_size, 16#80000000},
 {merge\_window, {6, 7}},
 {frag\_merge\_trigger, 60},
 {dead\_bytes\_merge\_trigger, 536870912},
 {max\_fold\_age, -1},
 {max\_fold\_puts, 0},
 {expiry\_secs, 86400}
 ]},

 {<<"bitcask\_mult\_l">>, riak\_kv\_bitcask\_backend, [
 %% bitcask configuration
 {data\_root, "./data/bitcask\_l"},
 {open\_timeout, 4},
 {n\_val,3},
 {r,1},
 {w,1},
 {dw,1},
 {allow\_mult,true},
 {last\_write\_wins,false},
 {sync\_strategy, {seconds, 10}},
 {max\_file\_size, 16#80000000},
 {merge\_window, {6, 7}},
 {frag\_merge\_trigger, 60},
 {dead\_bytes\_merge\_trigger, 536870912},
 {max\_fold\_age, -1},
 {max\_fold\_puts, 0},
 {expiry\_secs, 86400}
 ]},


 So when I get bucket it shows all the default properties such as
"r":"quorum", "w":"quorum", etc ..
 I changed the storage backend for the bucket to 'bitcask\_mult\_l' which
has different values for r:1,w:1,dw:1, etc.

 After changing the backend I restarted node (all the nodes on cluster).
However, I am still getting the old quorum values ...
 so my queries are:

 1. Is there something missing in configuration?
 2. Do I have to specifically update (bucket properties with) all the
quorum and other properties of new storage backend
(manually/programatically) ?
 3. What is the proper way of configuring multiple buckets with
respective storage backends?

 Any help or pointer is highly appreciated.

Command used to change bucket backend:

> curl -X PUT -H "Content-Type: application/json" \
> -d '{"props":{"backend":"bitcask\_mult\_l"}}' \
> http://localhost:8098/riak/test

Result show old/stale quorum related properties:

 > curl http://192.168.21.201:8098/riak/test
{"props":{"allow\_mult":false,"backend":"bitcask\_mult\_l"
,"basic\_quorum":false,"big\_vclock":50,"chash\_keyfun":{"mod":"riak\_core\_util","fun":"chash\_std\_keyfun"},
"dw":"quorum"
,"last\_write\_wins":false,"linkfun":{"mod":"riak\_kv\_wm\_link\_walker","fun":"mapreduce\_linkfun"},"n\_val":3,"name":"test","notfound\_ok":true,"old\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,
"r":"quorum","rw":"quorum","search":false,"small\_vclock":50,"w":"quorum"
,"young\_vclock":20}}
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

