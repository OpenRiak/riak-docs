---
title: "Re: riak_core data handoff/rebalance"
description: ""
project: community
lastmod: 2011-06-30T14:39:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03887"
mailinglist_parent_id: "msg03886"
author_name: "Joel Meyer"
project_section: "mailinglistitem"
sent_date: 2011-06-30T14:39:41-07:00
---


On Thu, Jun 30, 2011 at 2:27 PM, Joseph Blomstedt <
joseph.blomst...@gmail.com> wrote:

> The code you're looking for is the "should\_handoff" fun in
> riak\_core\_vnode.erl:
>
> https://github.com/basho/riak\_core/blob/riak\_core-0.14.2/src/riak\_core\_vnode.erl


Thanks, Joe - much appreciated.

Joel


> There is a timer in the vnodes that fires periodically, and the vnode
> will check it's current ring to determine if it is still the owner for
> the index it represents. If it's not the current owner, the vnode
> initiates handoff to the current owner. This design allows handoff to
> occur both due to ring changes (join/leave) as well as for hinted
> handoff (eg. when a write destined for a node was sent to a secondary
> node during a temporary partition/downtime, and is later handed off to
> the real node).
>
> -Joe
>
> On Thu, Jun 30, 2011 at 3:04 PM, Joel Meyer  wrote:
> > I'm trying to understand when and how data handoff between nodes is
> > triggered in riak\_core. I was under the impression that data would be
> > shuffled when a new node joined the cluster or an existing node left the
> > cluster, but maybe that's not the case? It looks like joining a cluster
> is
> > accomplished by gossiping your ring with a node in the cluster that you
> wish
> > to join (riak\_core\_gossip:send\_ring(NodeInCluster, node())). Looking
> through
> > the code I don't see anywhere that a partitions data is transferred once
> an
> > updated ring is agreed upon. Leaving a cluster seems to be handled
> > similarly, but I don't see any handoff triggered in this case either. I
> must
> > be missing something obvious? I'm looking at tag riak\_core-0.14.2.
> > Thanks,
> > Joel
> > \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> > riak-users mailing list
> > riak-users@lists.basho.com
> > http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> >
> >
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

