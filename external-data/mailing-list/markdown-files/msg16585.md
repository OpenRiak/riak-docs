---
title: "Re: Yokozuna indexes too slow"
description: ""
project: community
lastmod: 2015-10-01T07:13:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg16585"
mailinglist_parent_id: "msg16581"
author_name: "Jason Voegele"
project_section: "mailinglistitem"
sent_date: 2015-10-01T07:13:02-07:00
---


Hello Ilyas, I’ve got a few questions for you to help diagnose the performance 
problem.

\* What Riak version are you running?

\* Are you using the default solrconfig on the index, or a custom configuration?

\* You say that there is a 200x slow down when Yokozuna indexing is enabled. Do 
you have any specific numbers? A graph would be helpful if you can generate one.

\* When you say that Yokozuna takes up 100% of one core, have you been able to 
narrow that down to specific process within Yokozuna or Riak? Using “riak-admin 
top” might help here.

\* Can you provide your JVM configuration (heap settings, etc.)?


> On Oct 1, 2015, at 2:18 AM, ilyas  wrote:
> 
> 
> Hello to the Riak community! 
> I have a cluster of 5 nodes (hardware servers with SSDs, 8 CPU cores, 16GB of 
> RAM, most of it is free). When I store data to the database (up to 1 000 000 
> keys) without indexes, everything happens very quickly. If I create an index 
> for yokozuna and do the same, the store rate decreases greatly (200 times). 
> The process yokozuna takes up 100% of the time one core of CPU, other cores 
> are not loaded. Keys are short strings (16 symbols), values are json strings 
> (length is about 200 characters). 
> How can I find out the reason of such performance and fix it?
> 
> creation of bucket:
> 
> #!/bin/bash
> 
> RIAK\_HOST="127.0.0.1:8098"
> 
> #define search scheme
> curl -XPUT $RIAK\_HOST/search/schema/dbsearch -H 
> 'Content-Type:application/xml' --data-binary @dbSchema.xml
> 
> # create search index for scheme
> curl -XPUT $RIAK\_HOST/search/index/user\_idx\_bin -H 'Content-Type: 
> application/json' -d '{"schema":"dbsearch"}'
> 
> # create bucket type for leleldb backend
> sudo /usr/sbin/riak-admin bucket-type create leveldb 
> '{"props":{"backend":"leveldb\_mult"}}'
> sudo /usr/sbin/riak-admin bucket-type activate leveldb
> 
> #create buckets with known backends and indexes
> curl -XPUT $RIAK\_HOST/types/leveldb/buckets/SomeBucket/props -H 
> 'Content-Type: application/json' -d 
> '{"props":{"search\_index":"user\_idx\_bin"}}'
> 
> index scheme:
> 
> xml version="1.0" encoding="UTF-8" ?
> 
> 
> 
> 
> 
> 
> 
> 
> 
>  multiValued="false" required="true"/>
>  multiValued="false"/>
>  multiValued="false"/>
>  multiValued="false"/>
>  multiValued="false"/>
>  multiValued="false"/>
>  multiValued="false"/>
>  multiValued="false"/>
>  multiValued="false"/>
> 
> 
> 
> 
> 
> 
> 
> 
> 
>  positionIncrementGap="0"/>
>  multiValued="true" class="solr.StrField" />
> 
> 
> \_yz\_id
> 
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

