---
title: "Re: empty sibling after a DELETE then PUT"
description: ""
project: community
lastmod: 2011-10-05T15:22:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05057"
mailinglist_parent_id: "msg05056"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-10-05T15:22:16-07:00
---


Hi Eric,

What you are seeing is probably a result of some changes we've made to
deletes. After you issue the DELETE, Riak creates a tombstone object first
and then removes it. 1.0 now adds a delay of 3s by default. If you do a
get during that time you should see an X-Riak-Vclock line for the 404
message after the delete.

If you use that vclock with the put then the tombstone will be removed. The
feature wasn't well publicized so has not made it into the clients yet.
 There should be more info to follow on deletes soon. If you really want
the old behavior, add {delete\_mode, immediate} to the riak\_kv section of
your app.config

Jon Meredith
Basho Technologies.

On Wed, Oct 5, 2011 at 1:13 PM, Eric Moritz wrote:

> If I enabled allow\_multi on a bucket and do I DELETE followed by a PUT
> I am getting a 300 response with one sibling having the body of the
> PUT and a second sibling with an empty body. If that the expected
> behavior?
>
> I wrote a script that would start with a reconciled value. Get the
> VClock of the current value. Then do every permutation of a PUT with
> (Pv) and without (P) the VClock and a DELETE with (Dv) and without (D)
> the vClock and I see the following result:
>
> Pv Dv 404
> Dv Pv 300
> Pv D 404
> D Pv 300
>
> Is it expected that a delete creates a blank sibling like that and
> therefore we should treat empty body's as deleted?
>
> Thanks,
> Eric Moritz.
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

