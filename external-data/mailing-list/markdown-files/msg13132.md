---
title: "Limit compaction I/O"
description: ""
project: community
lastmod: 2013-12-01T23:37:02-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13132"
author_name: "Timo Gatsonides"
project_section: "mailinglistitem"
sent_date: 2013-12-01T23:37:02-08:00

---



I have upgraded two nodes in my cluster from 1.3.2 to 1.4.2. After the upgrade 
it appears both started a compaction, as mentioned here: 
https://github.com/basho/riak/blob/1.4/RELEASE-NOTES.md#leveldb-13-to-14-conversion.
 In my case I think this may have also triggered compactions at level 5 
(finally) - see this earlier thread about stale data not getting removed: 
http://lists.basho.com/pipermail/riak-users\_lists.basho.com/2013-September/013392.html.
 Which is good as the 2TB drive dedicated for this data was almost filled 
completely. After the compaction finished, some 12-16 hours later, about 200Gb 
of data was removed.

Two questions remain:
1) can someone please confirm that indeed the upgrade from 1.3 to 1.4 triggered 
the compactions, all the way to the level 5 compactions?
2) is there some way to limit the I/O for the compactions?

The problem was that during the compaction the node was really slow to respond 
(I took it out of the HAProxy config), the CPU load was no problem, around 30% 
on a single core only, however the iowait was high. Using iostat I noticed the 
disk continuously reading AND writing around 30Mb/s (normal, spinning disk, 
SATA).

Kind regards,
Timo





smime.p7s
Description: S/MIME cryptographic signature
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

