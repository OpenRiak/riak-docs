---
title: "Riak MR returns JSON Object on occasion"
description: ""
project: community
lastmod: 2012-12-14T17:09:21-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09591"
author_name: "Elias Levy"
project_section: "mailinglistitem"
sent_date: 2012-12-14T17:09:21-08:00

---


It appears that the Riak MR API can on occasions return a JSON Object,
rather than an Array. This blows up the Ruby client, and I am guessing
probably some other ones. I've opened an issue for the Ruby client. See
https://github.com/basho/riak-ruby-client/issues/67.

I came across the issue while writing an Erlang map phase function to bulk
fetch values while returning their key. The function is:

map\_object\_key\_value({error, notfound}, \_, \_) -> [];
map\_object\_key\_value(RiakObject, \_, \_) ->
 [{ riak\_object:key(RiakObject), riak\_object:get\_value(RiakObject) }].

It appears that Riak (or mochijson2?) will convert an array of 2 tuples
into a JSON hash when returning the data.

This is actually quite nice, at least for this application, as its exactly
what I want, but it seems is either undocumented or a bug, since clients do
not respond well to it.

Thoughts?

Elias Levy
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

