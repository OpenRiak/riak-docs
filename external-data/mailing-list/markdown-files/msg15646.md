---
title: "Re: Mapred unable to find keys that use bucket types"
description: ""
project: community
lastmod: 2015-02-05T12:47:40-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15646"
mailinglist_parent_id: "msg15644"
author_name: "Mikhail Pustovalov"
project_section: "mailinglistitem"
sent_date: 2015-02-05T12:47:40-08:00
---


Hi Chris,

Thank you for the prompt reply.
Although that is exactly what I do. I've noticed that bucket can now be
both binary or a tuple {binary, binary} where the first element is bucket
type and the second is bucket. And it works for put/get operations and for
mapred\_bucket which traverses the whole bucket. But what I am trying to
achieve is traverse only specified keys and that doesn't seem to work for
mapred queiries. Here are the commands that work:
simple get:
riakc\_pb\_socket:get(Pid,{<<"bucket\_type">>,<<"bucket">>},<>).
mapred over the whole bucket:
riakc\_pb\_socket:mapred\_bucket(Pid, {<<"bucket\_type">>,<<"bucket">>}, [{map,
{modfun, rc\_mapred, map\_kv\_pairs}, none, true}]).
but this one fails with the result {ok,[{0,[{error,notfound}]}]}:
riakc\_pb\_socket:mapred(Pid, [{{<<"bucket\_type">>,<<"bucket">>},<>}],[{map,
{modfun, rc\_mapred, map\_kv\_pairs}, none, true}]).

If you can run a mapred query over specified keys could you please show me
an example?

Thanks,
Michael


On Thu Feb 05 2015 at 10:16:32 PM Christopher Meiklejohn <
cmeiklej...@basho.com> wrote:

>
> > On Feb 5, 2015, at 10:55 AM, Mikhail Pustovalov 
> wrote:
> >
> > Hello,
> > I am using MapReduce just as a way to get multiple keys in one query (I
> couldn't find a better way). My code used to work with Riak v.1.4 but now
> when I try to run it against the latest version (2.0.4) mapred queries
> return {error, notfound} for each key supplied.
> > I have created a bucket type, put my keys inside a bucket in that type.
> Simple 'put' and 'get' work fine. This line returns requested object:
> > riakc\_pb\_socket:get(Pid,{<<"avs\_n2">>,<<"avatars">>},<<
> 145,3,100,41,46>>).
> > This line though:
> > riakc\_pb\_socket:mapred(Pid, 
> > [{{<<"avs\_n2">>,<<"avatars">>},<<145,3,100,41,46>>}],[{map,
> {modfun, rc\_mapred, map\_kv\_pairs}, none, true}]).
> > returns this:
> > {ok,[{0,[{error,notfound}]}]}
> > Seems like mapred functions are unable to query using bucket types.
> Without bucket types everything still works fine.
> > Also mapred\_bucket over a whole bucket also works fine.
> > Please, advise. Is it possible to use mapred with newly introduced
> bucket types when I want only specific keys and not the full scan of a
> bucket?
>
> Hi Mikhail,
>
> You’ll need to specify the bucket type as part of the bucket name when
> performing the map reduce, for example, for inputs for the “maps” bucket
> type and “users” bucket, you should use {<<“maps”>>, <<“users”>>} as the
> bucket name for riakc\_pb\_socket.
>
> Thanks,
> - Chris
>
> Christopher Meiklejohn
> Senior Software Engineer
> Basho Technologies, Inc.
> cmeiklej...@basho.com
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

