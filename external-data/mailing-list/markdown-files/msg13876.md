---
title: "Re: Cleaning up bucket after basho_bench run"
description: ""
project: community
lastmod: 2014-03-21T21:46:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13876"
mailinglist_parent_id: "msg13875"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2014-03-21T21:46:16-07:00
---


Did some double checking on the off chance that I gave you some bad
advice. Here's the function that the erlang client uses to accumulate
the outcome of stream\_list\_keys et al:
https://github.com/basho/riak-erlang-client/blob/master/src/riakc\_pb\_socket.erl#L2146-L2155

here is how you get the request id:
https://github.com/basho/riak-erlang-client/blob/master/src/riakc\_pb\_socket.erl#L490-L494

On Fri, Mar 21, 2014 at 9:29 PM, Evan Vigil-McClanahan
 wrote:
> You don't want to recurse when you get the {ReqID, done} message, you
> should just stop there.
>
> On Fri, Mar 21, 2014 at 6:20 PM, István  wrote:
>> With help of Evan (evanmcc) on the IRC channel I was able to kick off
>> the clean up job using riak-erlang-client.
>>
>> Here is the code:
>>
>> https://gist.github.com/l1x/9698847
>>
>> It sometimes behaves a bit weirdly, the PB client returns {40127151,
>> done} or something similar, that I can't recognize why but it
>> definitely deleted some of the keys so far. I am letting it run for a
>> while and see what happens.
>>
>> Regards,
>> Istvan
>>
>>
>> On Wed, Mar 19, 2014 at 1:02 AM, Christian Dahlqvist
>>  wrote:
>>> Hi Istvan,
>>>
>>> Did you run the Basho Bench clean-up job with the following settings?
>>>
>>> {driver, basho\_bench\_driver\_riakc\_pb}.
>>> {key\_generator, {int\_to\_bin, {partitioned\_sequential\_int, 10000000}}}.
>>> {operations, [{delete, 1}]}.
>>>
>>> Also, how did you verify that the data was not deleted?
>>>
>>> Best regards,
>>>
>>> Christian
>>>
>>>
>>>
>>>
>>> On Wed, Mar 19, 2014 at 6:49 AM, István  wrote:
>>>>
>>>> Hi,
>>>>
>>>> I was trying to delete all of the keys generated with the following:
>>>>
>>>> {key\_generator, {int\_to\_bin, {uniform\_int, 10000000}}}.
>>>>
>>>> I have used this for the deletion:
>>>>
>>>> {key\_generator, {int\_to\_bin, {partitioned\_sequential\_int, 10000000}}}.
>>>>
>>>> I has completed but unfortunately was not deleting any data....
>>>>
>>>> Next is to use the Erlang client and see if I can list the keys and
>>>> delete them, or try to use the Erlang interface for MR.
>>>>
>>>> Regards,
>>>> Istvan
>>>>
>>>>
>>>>
>>>> On Sat, Mar 15, 2014 at 1:38 PM, Christian Dahlqvist
>>>>  wrote:
>>>> > Hi Istvan,
>>>> >
>>>> > Depending on how you have run your Basho Bench job(s), you could try
>>>> > deleting the generated keys by running a separate Basho Bench job based
>>>> > on a
>>>> > partitioned\_sequential\_int key generator and only delete operations.
>>>> >
>>>> > Best regards,
>>>> >
>>>> > Christian
>>>> >
>>>> >
>>>> >
>>>> > On Fri, Mar 14, 2014 at 5:00 PM, István  wrote:
>>>> >>
>>>> >> Hi,
>>>> >>
>>>> >> I am trying to clean up some of the test data that was inserted by
>>>> >> basho\_bench. The first approach to use curl and streaming the keys
>>>> >> fails like this:
>>>> >>
>>>> >> # curl -XGET -i http://127.0.0.1:8098/buckets/test/keys?keys=stream
>>>> >> HTTP/1.1 200 OK
>>>> >> Vary: Accept-Encoding
>>>> >> Transfer-Encoding: chunked
>>>> >> Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
>>>> >> Date: Fri, 14 Mar 2014 16:59:08 GMT
>>>> >> Content-Type: application/json
>>>> >>
>>>> >> curl: (18) transfer closed with outstanding read data remaining
>>>> >>
>>>> >> When I am trying to the same thing with MapReduce it fails like this:
>>>> >>
>>>> >> curl -X POST "http://localhost:8098/mapred" -H "Content-Type:
>>>> >> application/json" -d '{
>>>> >> "inputs": "test",
>>>> >> "query": [
>>>> >> {
>>>> >> "map": {
>>>> >> "language": "javascript",
>>>> >> "source": "function(riakObject) { return
>>>> >> [riakObject.key];
>>>> >> }"
>>>> >> }
>>>> >> }
>>>> >> ]
>>>> >> }'
>>>> >>
>>>> >> Error:
>>>> >>
>>>> >>
>>>> >>
>>>> >> {"phase":0,"error":"bad\_utf8\_character\_code","input":"{ok,{r\_object,<<\"test\">>,<<0,116,71,0>>,[{r\_content,{dict,3,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[[<<\"X-Riak-VTag\">>,71,81,80,81,87,76,105,54,113,120,97,116,114,106,51,86,72,53,67,50,82]],[[<<\"index\">>]],[],[[<<\"X-Riak-Last-Modified\">>|{1391,27501,255280}]],[],[]}}},<<75,191,51,171,193,113,206,163,24,68,247,188,84,72,5,72,179,195,99,44,202,122,136,31,250,94,166,5,160,199,182,137,40,6,253,115,100,4,34,67,64,10,25,210,58,23,104,97,228,...>>}],...},...}"}
>>>> >>
>>>> >> I am wondering how else could I just get a list of keys in that
>>>> >> bucket. The ultimate goal is to be able to delete them all.
>>>> >>
>>>> >> Thank you in advance,
>>>> >> Istvan
>>>> >>
>>>> >> --
>>>> >> the sun shines for all
>>>> >>
>>>> >> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> >> riak-users mailing list
>>>> >> riak-users@lists.basho.com
>>>> >> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>> >
>>>> >
>>>>
>>>>
>>>>
>>>> --
>>>> the sun shines for all
>>>
>>>
>>
>>
>>
>> --
>> the sun shines for all
>>
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

