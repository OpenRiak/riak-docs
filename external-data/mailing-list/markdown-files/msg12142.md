---
title: "Re: Hit a snag in using the MultiPartUpload"
description: ""
project: community
lastmod: 2013-08-27T15:10:50-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg12142"
mailinglist_parent_id: "msg12140"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2013-08-27T15:10:50-07:00
---


Hi Shannon. I think the problem you are having is that you are trying to use the POST method to upload a part when you should be using PUT. Riak CS interprets a POST request that includes the uploadId like you are sending to be an attempt to complete the multipart upload and that is why you are seeing that error. I think if you use PUT to upload the parts it should work fine for you.Kelly  On August 27, 2013 at 3:23:45 PM, Shannon Monasco (shannon.mona...@markit.com) wrote: 

Hi,
 
Sorry if I havenât RTFM enough, but I couldnât find a link to archived mailing-list items.  If anyone can point me to that Iâd be happy to stumble through it for a while.
 
That aside my issue as follows:
 
I get my uploadId and then on my first part upload I get:
 
RESPONSE
========
Status : 477 Internal Server Error (CommunicationLayer.debugResponse:307)(Client#8-1)
2013-08-27 14:53:12,231 DEBUG > Headers:
  null=HTTP/1.1 477 Internal Server Error
  Date=Tue, 27 Aug 2013 20:52:17 GMT
  Content-Length=0
  Content-Type=application/xml
  Server=Riak CS (CommunicationLayer.debugResponse:317)(Client#8-1)
 
When I send something like:
 
REQUEST
=======
Method : POST
URI    : http://xxxxxxxxxxxxx:8080/test-bucket/asdfghj?partNumber=1
       &uploadId=QRvSDKtLThaxblNQQVNzxA%3D%3D
Headers:
  Date=Tue, 27 Aug 2013 20:53:07 GMT
  Content-Type=binary/octet-stream
Request Body Data:
asdfjkl;
 
The bucket is there as it let me start it.  Thatâs the right key and uploadId.  The only interesting thing I can find in the logs is:
 
20:52:07.758 [debug] STS: ["DELETE","\n",[],"\n",[],"\n",["Tue, 27 Aug 2013 20:53:02 GMT","\n"],[],["/test-bucket/asdfghj",[]]]^M
20:52:07.775 [debug] STS: ["POST","\n",[],"\n","application/octet-stream","\n",["Tue, 27 Aug 2013 20:53:02 GMT","\n"],[["x-amz-meta-foo",":",<<"Bar">>,"\n"],["x-amz-meta-fooalso",":",<<"BarAlso">>,"\n"]],["/test-bucket/asdfghj","?uploads"]]^M
20:52:13.198 [debug] STS: ["POST","\n",[],"\n","binary/octet-stream","\n",["Tue, 27 Aug 2013 20:53:07 GMT","\n"],[],["/test-bucket/asdfghj","?partNumber=1&uploadId=QRvSDKtLThaxblNQQVNzxA=="]]^M
3899- fatal: expected\_element\_start\_tag
 
Iâm still making our POC, so Iâm sure Iâm doing something wrong, but I have no idea what âexpected\_element\_start\_tagâ refers to or how I can affect it.
 
Weâre running a compiled from source Riak-CS 1.4.0, stanchion 1.4.0 and Riak 1.4.1 on CentOS 4 (yea itâs old, but Iâd expect to get it working if I can get it compiled from source.)  With the following Erlang
 
[xxxxxxxxx@xxxxxxxxx riak]$ erl
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false]
 
Eshell V5.9.1  (abort with ^G)
1>
 
Thank you for your time,
Shannon Monasco



This e-mail, including accompanying communications and attachments, is strictly confidential and only for the intended recipient. Any retention, use or disclosure not expressly authorised by Markit is prohibited. This
 email is subject to all waivers and other terms at the following link: http://www.markit.com/en/about/legal/email-disclaimer.page

Please visit http://www.markit.com/en/about/contact/contact-us.page? for contact information on our offices worldwide.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

