---
title: "Re: Best practice for using erlang modules in riak?"
description: ""
project: community
lastmod: 2011-06-02T14:01:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03538"
mailinglist_parent_id: "msg03537"
author_name: "Aphyr"
project_section: "mailinglistitem"
sent_date: 2011-06-02T14:01:23-07:00
---



On 06/02/2011 01:49 PM, Sylvain Niles wrote:

Is there any open source code out there using erlang functions via
ripple or rest that I can look at to see a fully functional flow?


I made a lot of stupid mistakes getting this to work. Leaving add\_paths 
commented out, not using arrays in arguments to #map and #reduce, not 
exporting the functions, incorrect arities, not compiling the code... 
etc. Hopefully this helps some.


Oh, and forgive the erlang; this was my first function. ;-)

--Kyle

-module(structs).

-export([
 from\_dict/1,
 sort\_by\_value/2,
 unique/2
]).

...

% Sorts a list of structs by a given value.
sort\_by\_value(Structs, [Key, <<"asc">>]) ->
 lists:sort(
 fun({struct, A}, {struct, B}) ->
 proplists:get\_value(Key, A) < proplists:get\_value(Key, B)
 end,
 Structs
 );
sort\_by\_value(Structs, [Key, <<"desc">>]) ->
 lists:sort(
 fun({struct, A}, {struct, B}) ->
 proplists:get\_value(Key, A) > proplists:get\_value(Key, B)
 end,
 Structs
 );
sort\_by\_value(Structs, Key) ->
 sort\_by\_value(Structs, [Key, <<"asc">>])

--------------------------------------------------------------------

{riak\_kv, [
 ...
 {add\_paths, ["/etc/riak/erl/"]},
 ...
]}

--------------------------------------------------------------------

$ cd /etc/riak/erl/
$ erlc structs.erl
$ riak attach
> l(structs).

--------------------------------------------------------------------

 results = Tablet::Comment.mr(items).
 map(['tablet', 'map\_to\_links\_with\_data'], :arg => 'user').
 map(['tablet', 'map\_to\_keydata\_with\_data'], :arg => ['user', 
['name', 'thumbnail']]).
 reduce(['structs', 'sort\_by\_value'], :arg => ['created\_at', 
'desc'], :keep => true).run


--Kyle

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

