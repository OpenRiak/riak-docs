---
title: "Re: setting default bucket props"
description: ""
project: community
lastmod: 2010-04-28T11:05:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00205"
mailinglist_parent_id: "msg00204"
author_name: "Matthew Pflueger"
project_section: "mailinglistitem"
sent_date: 2010-04-28T11:05:00-07:00
---


Changing the r,w values on the client side fixed my problem... Thanks!

--Matthew



On Wed, Apr 28, 2010 at 13:44, Sean Cribbs  wrote:
> Not currently.  The defaults are hard-coded in the HTTP resource as:
> r = 2, w = 2, dw = 0, rw = 2
>
> Sean Cribbs 
> Developer Advocate
> Basho Technologies, Inc.
> http://basho.com/
>
> On Apr 28, 2010, at 1:38 PM, Matthew Pflueger wrote:
>
>> Stupid question: Is there a way to set the default read values for a
>> request on the server side when a client doesn't explicitly set them?
>>
>> --Matthew
>>
>>
>>
>> On Wed, Apr 28, 2010 at 12:38, Justin Sheehy  wrote:
>>> If the N value for the bucket is lower than the R or W value in a
>>> request, then the request cannot succeed.  That sounds likely in this
>>> case.  An upcoming release will provide more useful messages when
>>> someone makes that particular client error.
>>>
>>> -Justin
>>>
>>>
>>>
>>> On Wed, Apr 28, 2010 at 12:35 PM, Matthew Pflueger
>>>  wrote:
>>>> Doing what Sean suggested worked (or just specifying the chash\_fun in
>>>> the default\_bucket\_props).  Now I'm running into weird behavior that
>>>> I'm guessing is related to the n\_val setting.  I'm running three nodes
>>>> all on separate machines joined with a ring partition size of 64
>>>> (22,21,21).  On a fourth machine I'm running a load test in which a
>>>> process spawns 10 threads per node, each thread connecting to a one of
>>>> the nodes via protobuffs getting and putting random key/values in one
>>>> bucket.  In my previous tests I used the default settings for the
>>>> bucket (n\_val of 3) and everything ran smoothly for many hours.  Now
>>>> I'm trying to set the default\_bucket\_props just changing the n\_val to
>>>> 1.  No errors in the logs and all clients connect successfully.
>>>> However, pretty much all communication times-out which does not happen
>>>> with the default bucket props (changing the n\_val back to 3 fixes the
>>>> problem).
>>>>
>>>> --Matthew
>>>>
>>>>
>>>>
>>>> On Wed, Apr 28, 2010 at 11:39, Sean Cribbs  wrote:
>>>>> We used to have a function that would merge the values from app.config 
>>>>> with
>>>>> the hardcoded defaults for bucket properties.  I've opened an issue on
>>>>> bugzilla for this problem (Bug 123). In the meantime, remove the stuff
>>>>> you've set, start up the console, and run this in the Erlang shell:
>>>>> application:get\_all\_env(riak\_core).
>>>>> From that output, copy the default\_bucket\_props and modify what you want.
>>>>> Sean Cribbs 
>>>>> Developer Advocate
>>>>> Basho Technologies, Inc.
>>>>> http://basho.com/
>>>>> On Apr 28, 2010, at 10:57 AM, Matthew Pflueger wrote:
>>>>>
>>>>> Forgot to say I'm using riak-0.10.1...
>>>>>
>>>>> --Matthew
>>>>>
>>>>>
>>>>>
>>>>> On Wed, Apr 28, 2010 at 10:56, Matthew Pflueger
>>>>>  wrote:
>>>>>
>>>>> I am trying to set the default n\_val in my app.config.  I'm not
>>>>>
>>>>> getting any errors on startup but when a client tries to put some data
>>>>>
>>>>> a process crashes eventually causing a time-out on the client side...
>>>>>
>>>>> app.config part:
>>>>>
>>>>> [
>>>>>
>>>>>  %% Riak Core config
>>>>>
>>>>>  {riak\_core, [
>>>>>
>>>>>              %% Default location of ringstate
>>>>>
>>>>>              {ring\_state\_dir, "data/ring"},
>>>>>
>>>>>              %% Default bucket props
>>>>>
>>>>>              {default\_bucket\_props, [{n\_val, 1}]},
>>>>>
>>>>>
>>>>> I'm seeing the following in the logs:
>>>>>
>>>>> sasl-error.log:
>>>>>
>>>>> =CRASH REPORT==== 28-Apr-2010::15:36:22 ===
>>>>>
>>>>>  crasher:
>>>>>
>>>>>    initial call: riak\_kv\_put\_fsm:init/1
>>>>>
>>>>>    pid: <0.505.0>
>>>>>
>>>>>    registered\_name: []
>>>>>
>>>>>    exception exit: {undef,[{riak\_core\_bucket,defaults,[]},
>>>>>
>>>>>                            {riak\_core\_util,chash\_key,1},
>>>>>
>>>>>                            {riak\_kv\_put\_fsm,initialize,2},
>>>>>
>>>>>                            {gen\_fsm,handle\_msg,7},
>>>>>
>>>>>                            {proc\_lib,init\_p\_do\_apply,3}]}
>>>>>
>>>>>      in function  gen\_fsm:terminate/7
>>>>>
>>>>>    ancestors: [<0.504.0>]
>>>>>
>>>>>    messages: []
>>>>>
>>>>>    links: []
>>>>>
>>>>>    dictionary: []
>>>>>
>>>>>    trap\_exit: false
>>>>>
>>>>>    status: running
>>>>>
>>>>>    heap\_size: 1597
>>>>>
>>>>>    stack\_size: 24
>>>>>
>>>>>    reductions: 475
>>>>>
>>>>>  neighbours:
>>>>>
>>>>> erlang.log.1
>>>>>
>>>>> =ERROR REPORT==== 28-Apr-2010::15:36:22 ===
>>>>>
>>>>> \*\* State machine <0.503.0> terminating
>>>>>
>>>>> \*\* Last event in was timeout
>>>>>
>>>>> \*\* When State == initialize
>>>>>
>>>>> \*\*      Data  == {state,
>>>>>
>>>>>                     {r\_object,<<"profiles">>,<<"DymvhHkDplIEmpowMdQ35Q">>,
>>>>>
>>>>>                         [{r\_content,
>>>>>
>>>>>                              {dict,0,16,16,8,80,48,
>>>>>
>>>>>                                  
>>>>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>>>>
>>>>>                                   [],[]},
>>>>>
>>>>>
>>>>>  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>>>>
>>>>>                                    [],[]}}},
>>>>>
>>>>>                              <<>>}],
>>>>>
>>>>>                         [{<<31,41,45,38>>,{1,63439684582}}],
>>>>>
>>>>>                         {dict,1,16,16,8,80,48,
>>>>>
>>>>>
>>>>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>>>>
>>>>>                             {{[],[],[],[],[],[],[],[],[],[],
>>>>>
>>>>>                               
>>>>> [[<<"content-type">>,97,112,112,108,105,99,97,
>>>>>
>>>>>
>>>>> 116,105,111,110,47,111,99,116,101,116,45,115,
>>>>>
>>>>>                                 116,114,101,97,109]],
>>>>>
>>>>>                               [],[],[],[],[]}}},
>>>>>
>>>>>                         <<4,155,69,121,249,86,125,168,81,201,133,2,65,248,
>>>>>
>>>>>                           238,53,23,1,40,242,226,220,30,37,113,164,204,34,
>>>>>
>>>>>
>>>>> 199,41,155,198,77,100,101,234,83,233,181,96,207,10,
>>>>>
>>>>>                           ...lots more data...
>>>>>
>>>>> \*\* Reason for termination =
>>>>>
>>>>> \*\* {'function not exported',[{riak\_core\_bucket,defaults,[]},
>>>>>
>>>>>                             {riak\_core\_util,chash\_key,1},
>>>>>
>>>>>                             {riak\_kv\_put\_fsm,initialize,2},
>>>>>
>>>>>                             {gen\_fsm,handle\_msg,7},
>>>>>
>>>>>                             {proc\_lib,init\_p\_do\_apply,3}]}
>>>>>
>>>>>
>>>>>
>>>>> --Matthew
>>>>>
>>>>>
>>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>>> riak-users mailing list
>>>>> riak-users@lists.basho.com
>>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>>
>>>>>
>>>>
>>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>>> riak-users mailing list
>>>> riak-users@lists.basho.com
>>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>>>>
>>>
>
>

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

