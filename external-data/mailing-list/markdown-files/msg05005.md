---
title: "Re: script erlang contrib function"
description: ""
project: community
lastmod: 2011-10-03T14:05:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05005"
mailinglist_parent_id: "msg05004"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-10-03T14:05:10-07:00
---



On 3 Oct 2011, at 21:58, francisco treacy wrote:

> I was giving the bucket\_inspector example because I happen to need it now. I 
> know I can write it in another lang in one minute, but since I'll be using 
> other Erlang contrib I wanted (and still want) to see how that would work; 
> but well, nevermind if it's not that straightforward.

There might be a more straight forward way, but I made a quick example here 
https://github.com/russelldb/bad\_bucket\_inspector

It is a bit overkill since it downloads and compiles riak\_kv (and all its 
dependancies), but still, there it is, if it helps. Basically it uses rebar to 
escriptize a wrapper around the bucket\_inspector module.

Cheers

Russell

> 
> Francisco
> 
> 
> 2011/10/3 Russell Brown 
> 
> On 3 Oct 2011, at 20:43, francisco treacy wrote:
> 
>> Hi Greg
>> 
>> Thanks, but what I'm really after is executing a script (non-interactive)
>> 
>> This is what i've got:
>> 
>> #!/usr/bin/env escript
>> %% -\*- erlang -\*-
>> %%! -name riakinspect -setcookie riak
>> 
>> main([]) ->
>> %{ok, Client} = riak:client\_connect('riaksearch@127.0.0.1'),
>> % i have the module compiled in /tmp
>> code:add\_path("/tmp"),
>> bucket\_inspector:inspect(<<"bucket">>, 'riaksearch@127.0.0.1').
>> 
>> 
>> Outputs:
>> 
>> escript: exception error: undefined function riak:client\_connect/1
>> in function bucket\_inspector:inspect/2
>> in call from erl\_eval:local\_func/5
>> in call from escript:interpret/4
>> in call from escript:start/1
>> in call from init:start\_it/1
>> in call from init:start\_em/1
>> 
>> Looks like it can't find riak in its path. I could pass-in a client, but 
>> have no clue how.
>> 
>> tl;dr I want to do something like this: http://contrib.basho.com/usage.html 
>> but on a script.
> 
> 
> Why not just script the remote client of your choice in the language you 
> \_are\_ comfortable with to do the same thing? Say if you're a pythonista use 
> the python client to list keys and fetch each key. That is all the contrib 
> does, or am I missing something?
> 
>> 
>> Thanks,
>> Francisco
>> 
>> 
>> 
>> 2011/10/3 Greg Pascale 
>> Hey Francisco,
>> 
>> If what you're looking to do is connect to Riak in Erlang without having to 
>> run 'riak attach', try this little bit of magic.
>> 
>> http://www.clipboard.com/clip/LR04fvr5rXWvT\_\_G
>> 
>> The value for "cookie" will be "riak" unless you've changed it.
>> 
>> -- 
>> Greg
>> Clipboard
>> 
>> On Monday, October 3, 2011 at 6:20 AM, francisco treacy wrote:
>> 
>>> Please? at least a pointer!
>>> 
>>> 2011/9/29 francisco treacy 
>>>> I'm wanting to use the `bucket\_inspector` contrib function (but have zero 
>>>> Erlang experience).
>>>> 
>>>> Following the "usage" page, I do the following:
>>>> $ /opt/riak/erts-5.7.5/bin/erlc -o /tmp /tmp/bucket\_inspector.erl
>>>> $ riak attach
>>>> (riak@127.0.0.1)1> code:add\_path("/tmp").
>>>> (riak@127.0.0.1)2> m(bucket\_inspector).
>>>> (riak@127.0.0.1)3> bucket\_inspector:inspect(<<"bucket">>, 
>>>> 'riaksearch@127.0.0.1').
>>>> And it works.
>>>> 
>>>> Now, if I want to run that non-interactively, as a script, how should I 
>>>> proceed?
>>>> 
>>>> I played around with escript but I can't seem to load the Riak path (so 
>>>> the script will fail at `code` et al)
>>>> 
>>>> Thanks,
>>>> 
>>>> Francisco
>>> 
>>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>>> riak-users mailing list
>>> riak-users@lists.basho.com
>>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
>> 
>> 
>> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>> riak-users mailing list
>> riak-users@lists.basho.com
>> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com
> 
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

