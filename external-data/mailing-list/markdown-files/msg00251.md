---
title: "Re: node data migration"
description: ""
project: community
lastmod: 2010-05-04T14:06:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00251"
mailinglist_parent_id: "msg00245"
author_name: "Grant Schofield"
project_section: "mailinglistitem"
sent_date: 2010-05-04T14:06:38-07:00
---


There would be 2 ways to such an upgrade. 

You could backup the node and shut it down cleanly. Other nodes in the cluster 
will take over for the shutdown node as long as your R, N , and W values were 
able to cope with the change. If you make a copy of your data directory, 
including the ring and data store directory, you could put them back in place 
and start the node as normal after the upgrade. This is predicated on you not 
changing the node name (IP), but if you did want to change it you could use the 
reip feature. This is probably the easiest way to do the upgrade, but if your 
cluster is small I would recommend the second method

The second way would be to tell the node to leave the cluster. This will 
transfer all of the data out of the node to several different nodes which will 
take its place in the ring. Currently this can only be done via a bin/riak 
attach command. Run the following:
 {ok, C} = riak:local\_client(),
 Res = C:remove\_from\_cluster(node()),
 io:format("~p\n", [Res]).

Once the node leaves the cluster and hands off all of its partitions you should 
see the data directory get smaller and empty out completely once all of the 
data has handed off to other nodes. Once you do the upgrade you can setup a 
new Riak node on the host, start it, and join the cluster just like you would 
any other new node.

Thanks,
Grant Schofield
Developer Advocate
Basho Technologies


On May 4, 2010, at 3:02 PM, Matthew Pflueger wrote:

> Scenario: I need to upgrade the OS of my nodes in my cluster which
> will result in a reboot of each node. What would be the process to
> nicely migrate data away from each node?
> 
> If my understanding is correct, performing a nice shutdown of a riak
> node via `riak stop` will migrate the data away from the node. Am I
> correct? If so, approximately how long would it take to do the
> migration if say each node represents 1 gig of data? Does that whole
> gig get migrated away or only the data that is not replicated?
> 
> 
> --Matthew
> 
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
> riak-users mailing list
> riak-users@lists.basho.com
> http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

