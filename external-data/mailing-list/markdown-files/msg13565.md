---
title: "Returning after long period to old project to notice riak-cs stopped	working"
description: ""
project: community
lastmod: 2014-02-02T09:14:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg13565"
author_name: "De Bunge"
project_section: "mailinglistitem"
sent_date: 2014-02-02T09:14:36-08:00

---


Initially it looked like some access rights issue
so I've updated /etc/riak-cs/app.config
and /etc/stanchion/app.config
with my admin's keys so I could use s3-cmd to figure out why some users
lost access to database.

but now it fails to start (see below).
riak-cs starts only after machine being rebooted, and fails first time
then I try to manipulate files with boto.

riak-cs console
Node 'riak-cs@127.0.0.1' not responding to pings.
config is OK
Exec: /usr/lib/riak-cs/erts-5.9.1/bin/erlexec -boot
/usr/lib/riak-cs/releases/1.3.1/riak-cs -embedded -config
/etc/riak-cs/app.config -pa
/usr/lib/riak-cs/lib/basho-patches -args\_file
/etc/riak-cs/vm.args -- console
Root: /usr/lib/riak-cs
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:4:4]
[async-threads:64] [kernel-poll:true]

opening log file: "/var/log/riak-cs/access.log.2014\_01\_29\_23"
00:45:05.232 [info] Application lager started on node 'riak-cs@127.0.0.1'
00:45:05.233 [info] Application poolboy started on node 'riak-cs@127.0.0.1'
00:45:05.253 [info] Application folsom started on node 'riak-cs@127.0.0.1'
Eshell V5.9.1 (abort with ^G)
(riak-cs@127.0.0.1)1> 00:45:05.330 [error] CRASH REPORT Process
<0.129.0> with 0 neighbours exited with reason: {tcp,econnrefused} in
gen\_server:init\_it/6 line 320
/usr/lib/riak-cs/lib/os\_mon-2.2.9/priv/bin/memsup: Erlang has closed.
 
Erlang has closed
 
 
{"Kernel pid
terminated",application\_controller,"{application\_start\_failure,riak\_cs,{shutdown,{riak\_cs\_app,start,[normal,[]]}}}"}
Kernel pid terminated (application\_controller)
({application\_start\_failure,riak\_cs,{shutdown,{riak\_cs\_app,start,[normal,[]]}}})


Here are my config files:


cat /etc/riak-cs/app.config
%% -\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\*-
%% ex: ts=4 sw=4 et
[
 %% Riak CS configuration
 {riak\_cs, [
 %% == Basic Configuration ==

 %% Riak CS http/https port and IP address to listen at
 %% for object storage activity
 {cs\_ip, "0.0.0.0"},
 {cs\_port, 8080 } ,

 %% Riak node to which Riak CS accesses
 {riak\_ip, "127.0.0.1"},
 {riak\_pb\_port, 8087 } ,

 %% Configuration for access to request
 %% serialization service
 {stanchion\_ip, "127.0.0.1"},
 {stanchion\_port, 8085 },
 {stanchion\_ssl, false },

 %% Enable this to allow the creation of an admin user
 %% when setting up a system. It is recommended to only
 %% enable this temporarily unless your use-case
 %% specifically dictates letting anonymous users to
 %% create accounts.
 {anonymous\_user\_creation, true},

 %% Admin user credentials. Admin access like
 %% /riak-cs/stats requires this entry to be set
 %% properly. The credentials specified here must match
 %% the admin credentials specified in the stanchion
 %% app.config for the system to function properly.
 {admin\_key, "JRG1FHSN-LR27WQGBD1G"},
 {admin\_secret, "n7rjS9rdXvMa6ji5BPaiw5NBK9yB2V6J\_J2gow=="},

 %% Port and IP address to listen on for system
 %% administration tasks. Uncomment the following lines
 %% to use a separate IP and port for administrative
 %% API calls.
 %% {admin\_ip, "0.0.0.0"},
 %% {admin\_port, 8887 } ,

 %% If SSL needed, un-comment. Without SSL
 %% section, CS will be accessible via http.
 %% {ssl, [
 %% {certfile, "./etc/cert.pem"},
 %% {keyfile, "./etc/key.pem"}
 %% ]},

 %% Root host name which Riak CS accepts.
 %% Your CS bucket at s3.example.com will be accessible
 %% via URL like http://bucket.s3.example.com/object/name
 {cs\_root\_host, "s3.amazonaws.com"},

 %% Connection pools
 %% Each pool is specified as a nested
 %% tuple of {Name, {FixedSize, OverflowSize}}
 {connection\_pools,
 [
 {request\_pool, {128, 0} },
 {bucket\_list\_pool, {5, 0} }
 ]},

 %% == Rolling upgrade support ==

 %% Riak CS version number. This is used to selectively
 %% enable new features for the current version to better
 %% support rolling upgrades. New installs should not
 %% need to modify this. If peforming a rolling upgrade
 %% then set this value to 0 until all nodes have been
 %% upgraded and then set back to the original value.
 {cs\_version, 10300 },

 %% == Usage recording ==

 %% How often to flush the access log; integer factor of
 %% access\_archive\_period (1 == once per period; 2 ==
 %% twice per period, etc.)
 {access\_log\_flush\_factor, 1},

 %% Additional access log flush trigger - flush after
 %% this many accesses are recorded, even if the flush
 %% interval has not expired; integer number of accesses
 {access\_log\_flush\_size, 1000000},

 %% How large each access archive object is. Should be a
 %% multiple of access\_log\_flush\_interval; integer number
 %% of seconds (3600 == 1 hour)
 {access\_archive\_period, 3600},

 %% How many access logs are allowed to pile up in the
 %% archiver's queue before it starts skipping to catch
 %% up; integer number of logs
 {access\_archiver\_max\_backlog, 2},

 %% When to automatically start storage calculation
 %% batches; list of "HHMM" UTC times
 %% ([] == do not automatically calculation;
 %% ["0600"] == automatically calculate at 6am UTC every day;
 %% ["0600","1945"] == automatically calculate at 6am and
 %% again at 7:45pm every day)
 {storage\_schedule, []},

 %% How large each storage archive object is. Should be
 %% chosen such that each storage\_schedule entry falls in
 %% a different period; integer number of seconds
 %% (86400 == 1 day)
 {storage\_archive\_period, 86400},

 %% How many archive periods a user can request in one
 %% usage read, applied independently to access and
 %% storage; integer number of intervals (744 == 1 month
 %% @ 1 hour intervals)
 {usage\_request\_limit, 744},

 %% == Garbage Collection ==

 %% The number of seconds to retain the block
 %% for an object after it has been deleted.
 %% This leeway time is set to give the delete
 %% indication time to propogate to all replicas.
 %% 86400 is 24-hours.
 {leeway\_seconds, 86400},

 %% How often the garbage collection daemon
 %% waits in-between gc batches.
 %% 900 is 15-minutes.
 {gc\_interval, 900},

 %% How long a move to the garbage
 %% collection to do list can remain
 %% failed, before we retry it.
 %% 21600 is 6-hours.
 {gc\_retry\_interval, 21600},

 %% == DTrace ==

 %% If your Erlang virtual machine supports DTrace (or
 %% user-space SystemTap), set dtrace\_support to true.
 {dtrace\_support, false}

 ]},

 {webmachine, [
 %% custom server name at http response header "Server:
Riak CS"
 {server\_name, "Riak CS"},

 %% The webmachine\_log\_handler entry can be
 %% commented-out or removed to disable access
 %% logging. Do not remove the
 %% riak\_cs\_access\_log\_handler entry.
 {log\_handlers, [
 {webmachine\_log\_handler,
["/var/log/riak-cs"]},
 {riak\_cs\_access\_log\_handler, []}
 ]}
 ]},

 {lager, [
 %% What handlers to install with what arguments
 %% The defaults for the logfiles are to rotate the files when
 %% they reach 10Mb or at midnight, whichever comes first, and keep
 %% the last 5 rotations. See the lager README for a description of
 %% the time rotation format:
 %% https://github.com/basho/lager/blob/master/README.org
 %%
 %% If you wish to disable rotation, you can either set the
size to 0
 %% and the rotation time to "", or instead specify a 2-tuple
that only
 %% consists of {Logfile, Level}.
 {handlers, [
 {lager\_console\_backend, info},
 {lager\_file\_backend, [
 
{"/var/log/riak-cs/error.log", error, 10485760, "$D0", 5},
 
{"/var/log/riak-cs/console.log", info, 10485760, "$D0", 5}
 ]}
 ]},

 %% Whether to write a crash log, and where.
 %% Commented/omitted/undefined means no crash logger.
 {crash\_log, "/var/log/riak-cs/crash.log"},

 %% Maximum size in bytes of events in the crash log - defaults
to 65536
 {crash\_log\_msg\_size, 65536},

 %% Maximum size of the crash log in bytes, before its rotated, set
 %% to 0 to disable rotation - default is 0
 {crash\_log\_size, 10485760},

 %% What time to rotate the crash log - default is no time
 %% rotation. See the lager README for a description of this
format:
 %% https://github.com/basho/lager/blob/master/README.org
 {crash\_log\_date, "$D0"},

 %% Number of rotated crash logs to keep, 0 means keep only the
 %% current one - default is 0
 {crash\_log\_count, 5},

 %% Whether to redirect error\_logger messages into lager -
defaults to true
 {error\_logger\_redirect, true}
 ]},

 %% SASL config
 {sasl, [
 {sasl\_error\_logger, false}
 ]},

 %% riak control
 {riak\_cs\_control, [
 %% What port to run the application on.
 {port, 8000 },

 %% Instance of Riak CS you wish to talk to.
 {cs\_hostname, "0.0.0.0" },
 {cs\_port, 80 },
 {cs\_protocol, "http" },

 %% Proxy information; necessary if you are using s3.amazonaws.com as
 %% your hostname.
 {cs\_proxy\_host, "localhost" },
 {cs\_proxy\_port, 8080 },

 %% Credentials you want the application to run as.
 {cs\_admin\_key, "JRG1FHSN-LR27WQGBD1G"},
 {cs\_admin\_secret, "n7rjS9rdXvMa6ji5BPaiw5NBK9yB2V6J\_J2gow=="},

 %% Specify the bucket name for administration options.
 {cs\_administration\_bucket, "riak-cs" }
 ]}
].


cat /etc/stanchion/app.config
%% -\*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -\*-
%% ex: ts=4 sw=4 et
[
 %% Stanchion config
 {stanchion, [
 {stanchion\_ip, "127.0.0.1"},
 {stanchion\_port, 8085 } ,

 %%{ssl, [
 %% {certfile, "./etc/cert.pem"},
 %% {keyfile, "./etc/key.pem"}
 %% ]},

 {auth\_bypass, false } ,

 %% Riak connection details
 {riak\_ip, "127.0.0.1"},
 {riak\_pb\_port, 8087 },

 %% Admin user credentials
 {admin\_key, "JRG1FHSN-LR27WQGBD1G"},
 {admin\_secret,
"n7rjS9rdXvMa6ji5BPaiw5NBK9yB2V6J\_J2gow=="}
 ]},

 {lager, [
 %% What handlers to install with what arguments
 %% The defaults for the logfiles are to rotate the files when
 %% they reach 10Mb or at midnight, whichever comes first, and keep
 %% the last 5 rotations. See the lager README for a description of
 %% the time rotation format:
 %% https://github.com/basho/lager/blob/master/README.org
 %%
 %% If you wish to disable rotation, you can either set the
size to 0
 %% and the rotation time to "", or instead specify a 2-tuple
that only
 %% consists of {Logfile, Level}.
 {handlers, [
 {lager\_console\_backend, info},
 {lager\_file\_backend, [
 
{"/var/log/stanchion/error.log", error, 10485760, "$D0", 5},
 
{"/var/log/stanchion/console.log", info, 10485760, "$D0", 5}
 ]}
 ]},

 %% Whether to write a crash log, and where.
 %% Commented/omitted/undefined means no crash logger.
 {crash\_log, "/var/log/stanchion/crash.log"},

 %% Maximum size in bytes of events in the crash log - defaults
to 65536
 {crash\_log\_msg\_size, 65536},

 %% Maximum size of the crash log in bytes, before its rotated, set
 %% to 0 to disable rotation - default is 0
 {crash\_log\_size, 10485760},

 %% What time to rotate the crash log - default is no time
 %% rotation. See the lager README for a description of this
format:
 %% https://github.com/basho/lager/blob/master/README.org
 {crash\_log\_date, "$D0"},

 %% Number of rotated crash logs to keep, 0 means keep only the
 %% current one - default is 0
 {crash\_log\_count, 5},

 %% Whether to redirect error\_logger messages into lager -
defaults to true
 {error\_logger\_redirect, true}
 ]},

 %% SASL config
 {sasl, [
 {sasl\_error\_logger, false}
 ]}
].


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

