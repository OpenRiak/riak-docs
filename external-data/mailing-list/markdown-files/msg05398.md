---
title: "Re: Indexing of intermediate nested fields in Riak search"
description: ""
project: community
lastmod: 2011-10-31T14:48:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05398"
mailinglist_parent_id: "msg05376"
author_name: "Elias Levy"
project_section: "mailinglistitem"
sent_date: 2011-10-31T14:48:05-07:00
---


Any ideas on this? Should indexing for sub-objects in an array with the
same field names in a JSON document work?



On Sun, Oct 30, 2011 at 6:56 AM, Elias Levy wrote:

> On Sat, Oct 29, 2011 at 9:59 PM, Elias Levy 
> wrote:
>
>> I am wondering if Riak search can index intermediate nested fields. When
>> indexing json data through the KV precommit hook, the underscore is
>> understood in the schema as indicating nesting. Thus, foo\_bar will index
>> the value "bah" of field "bar" in the json document { "foo" : { "bar" :
>> "bah" } }.
>>
>> What I'd like to know is if it can instead index the key "bar" in the
>> same json document. In my current use case I want to be able to find
>> documents with certain values for "bar" for these types of documents.
>>
>> Can this be done by simply indexing the field "foo"? Does search know to
>> index all keys in "foo" if foo is a hash, or all its values if it is an
>> array?
>>
>
> My testing on 1.0.0 shows that this appears not to work. Looking at the
> source for the search kv extractor gives the impression that a workaround
> would be to instead store { "foo" : [ { "x": "bar", "y": "bah"}, { "x":
> "woo", "y": "zoo" }, ... ]} and index "foo\_z" to be able to search for
> "bar" and "woo". I.e. it appears the extractor will index each subdocument
> in the array.
>
> At least that is what json\_text() function implies with the tests:
>
> {<<"
> {\"menu\": {
> \"id\": \"file\",
> \"value\": \"File\",
> \"popup\": {
> \"menuitem\": [
> {\"value\": \"New\", \"onclick\": \"CreateNewDoc()\"},
> {\"value\": \"Open\", \"onclick\": \"OpenDoc()\"},
> {\"value\": \"Close\", \"onclick\": \"CloseDoc()\"}
> ]
> }
> }}">>,
> [{<<"menu\_id">>, <<"file">>},
> {<<"menu\_value">>, <<"File">>},
> {<<"menu\_popup\_menuitem\_value">>, <<"New">>},
> {<<"menu\_popup\_menuitem\_onclick">>, <<"CreateNewDoc()">>},
> {<<"menu\_popup\_menuitem\_value">>, <<"Open">>},
> {<<"menu\_popup\_menuitem\_onclick">>, <<"OpenDoc()">>},
> {<<"menu\_popup\_menuitem\_value">>, <<"Close">>},
> {<<"menu\_popup\_menuitem\_onclick">>, <<"CloseDoc()">>}]},
> %% From 
> http://www.ibm.com/developerworks/library/x-atom2json.html
>
>
>> The implication of the above code is that you can search for
> menu\_popup\_menuitem\_value:New or menu\_popup\_menuitem\_value:Open and find
> the doc. But my testing shows this not to work. If any of the documents
> in the array have the same fields, those fields will not be indexed.
>
> E.g. if I set my schema to index foo\_bar and insert {"foo": [ { "bar" :
> "baz" }, {"xxx":"yyy"} ] }, I can search for foo\_bar:baz and receive a
> match. If I instead insert '{"foo": [ { "bar" : "baz" }, {"bar":"yyy"} ]
> }' and search for foo\_bar:baz I receive no match.
>
> Is this expected behavior or a bug?
>
> Elias
>
>
>
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

