---
title: "Durable writes and parallel reads"
description: ""
project: community
lastmod: 2011-10-31T09:38:44-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05388"
author_name: "Erik Søe Sørensen"
project_section: "mailinglistitem"
sent_date: 2011-10-31T09:38:44-07:00

---



The following is a couple of questions (and suggestions) regarding the
technical sides of Riak performance and reliability.

The questions have been prompted by reading Riak source code and by
discussions within our company.

I suppose the common thread here is "latency hiding"...

Durable Writes.
---------------
The default for bitcask's 'sync\_strategy' setting is not to flush to 
disk explicitly at all.


This means that a 'Durable Write' isn't actually durable; the difference 
between 'W' and 'DW' replies is whether the write has made it past Riak, 
to the OS - but not through the OS and down to disk.


Is this correct?

What I'd have expected, as a reaonably-performing alternative, is that 
Riak would flush periodically - say, after at most W\_flush writes or 
MS\_flush milliseconds, and send 'dw' replies for all of the relevant 
requests (those written since last flush) at once after the flush has 
been completed.
This would combine 'real' DW semantics with reasonable performance (and 
is how I have handled a similar problem; my conceptions about what is 
right and proper may of course be influenced by my own coding history...).


(For kicks, MS\_flush might even be dynamically determined by how long 
the flush operations tend to take; the typical value of a flush 
duration, multiplied by a small constant, would probably be a fitting 
value.)



Parallel Reads.
---------------
Within a vnode, bitcask read operations happen in serial.
Is there any reason for reads not happening in parallel?

For map/reduce operations, in particular, I imagine this might make a 
difference, by giving the OS the opportunity to schedule disk accesses 
so as to reduce seek time.


(Unless of course Riak itself reorders the keys before reading, but I 
don't believe this is the case - especially since the order would depend 
on the backend: for bitcask, by time; for innostore, by key order, for 
instance.)


Of course, if each host has multiple vnodes, there will be some 
parallellity even with serialized reads within each bitcask.


Regards,
Erik Søe Sørensen


\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

