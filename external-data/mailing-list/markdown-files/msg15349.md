---
title: "Error on node shutdown Riak Cluster"
description: ""
project: community
lastmod: 2014-12-11T08:51:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg15349"
author_name: "Garrido"
project_section: "mailinglistitem"
sent_date: 2014-12-11T08:51:42-08:00

---


Hello, 

We detect in our cluster that some is wrong with that, when we shutdown a 
single node from the running cluster (bin/riak stop), the connections from the 
riak erlang client of remain nodes are disconnected, 

This is a log from riak console.log

2014-12-11 10:38:17.915 [error] <0.820.15> CRASH REPORT Process <0.820.15> with 
0 neighbours exited with reason: 
{throw,{error,data\_not\_available,{<<"search">>,<<"type\_profile">>,<<"notes">>}},[{riak\_search\_op\_term,preplan,2,[{file,"src/riak\_search\_op\_term.erl"},{line,49}]},{riak\_search\_op\_scope,preplan,2,[{file,"src/riak\_search\_op\_scope.erl"},{line,25}]},{riak\_search\_op,'-preplan/2-lc$^0/1-0-',2,[{file,"src/riak\_search\_op.erl"},{line,30}]},{riak\_search\_op,'-preplan/2-lc$^0/1-0-',2,[{file,"src/riak\_search\_op.erl"},{line,30}]},{riak\_search\_op\_intersection,preplan,2,[{file,"src/riak\_search\_op\_intersecti..."},...]},...]}
 in gen\_server:terminate/6 line 747
2014-12-11 10:38:17.915 [error] <0.302.0> Supervisor riak\_api\_pb\_sup had child 
undefined started with {riak\_api\_pb\_server,start\_link,undefined} at <0.820.15> 
exit with reason 
{throw,{error,data\_not\_available,{<<"search">>,<<"type\_profile">>,<<"notes">>}},[{riak\_search\_op\_term,preplan,2,[{file,"src/riak\_search\_op\_term.erl"},{line,49}]},{riak\_search\_op\_scope,preplan,2,[{file,"src/riak\_search\_op\_scope.erl"},{line,25}]},{riak\_search\_op,'-preplan/2-lc$^0/1-0-',2,[{file,"src/riak\_search\_op.erl"},{line,30}]},{riak\_search\_op,'-preplan/2-lc$^0/1-0-',2,[{file,"src/riak\_search\_op.erl"},{line,30}]},{riak\_search\_op\_intersection,preplan,2,[{file,"src/riak\_search\_op\_intersecti..."},...]},...]}
 in context child\_terminated
2014-12-11 10:38:18.494 [error] <0.830.15> gen\_server <0.830.15> terminated 
with reason: 
{throw,{error,data\_not\_available,{<<"search">>,<<"type\_profile">>,<<"notes">>}},[{riak\_search\_op\_term,preplan,2,[{file,"src/riak\_search\_op\_term.erl"},{line,49}]},{riak\_search\_op\_scope,preplan,2,[{file,"src/riak\_search\_op\_scope.erl"},{line,25}]},{riak\_search\_op,'-preplan/2-lc$^0/1-0-',2,[{file,"src/riak\_search\_op.erl"},{line,30}]},{riak\_search\_op,'-preplan/2-lc$^0/1-0-',2,[{file,"src/riak\_search\_op.erl"},{line,30}]},{riak\_search\_op\_intersection,preplan,2,[{file,"src/riak\_search\_op\_intersecti..."},...]},â€¦]}

We are running riak with Legacy Search, and we use Riak 1.4.x

From our cluster this is the member status:

sh bin/riak-admin member-status
================================= Membership ==================================
Status Ring Pending Node
-------------------------------------------------------------------------------
valid 17.2% -- 'riak1@10.136.89.98'
valid 17.2% -- 'riak2@10.136.89.98'
valid 17.2% -- 'riak3@10.136.89.99'
valid 17.2% -- 'riak4@10.136.89.99'
valid 15.6% -- 'riak5@10.136.89.100'
valid 15.6% -- 'riak6@10.136.89.101'
-------------------------------------------------------------------------------
Valid:6 / Leaving:0 / Exiting:0 / Joining:0 / Down:0

I hope you can help us with this, we use this in a production environment and 
for now we cannot migrate our system to riak 2.0 which is better, 

Thank you,



\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\_lists.basho.com

