<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: have a new node take over the role of a downed,	unrecoverable node?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01318" id="c">
<link rel="index" href="maillist.html#01318" id="i">
<link rel="prev" href="msg01317.html" id="p">
<link rel="next" href="msg01319.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01318.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+have+a+new+node+take+over+the+role+of+a+downed%2C%09unrecoverable+node%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: have a new node take over the role of a downed,	unrecoverable node?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101016" rel="nofollow">Sat, 16 Oct 2010 20:57:58 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
On Oct 16, 2010, at 9:52 PM, Leonid Riaboshtan wrote:

&gt; &gt;&gt; However, you'll need to reip on all machines.
&gt; 
&gt; Hmm, isn't stuff like that should be treated automaticly by Riak? I mean I 
&gt; have a cluster where nodes leave, nodes come. And after each come/leave I 
&gt; need to do something to nodes in entire cluster to entroduce/remove new/old 
&gt; node and repartion the data?
&gt; </pre><pre>

There are two kinds of &quot;coming&quot; and &quot;leaving&quot; -- temporary and permanent.  
Temporary absences, yes, are handled automatically with things like hinted 
handoff and read repair.  Permanent absences -- as in the case of EC2 instance 
outage -- are things that need to be handled by a competent system 
administrator or developer.  The truth is, changes to the ring state are 
expensive - it needs to be gossiped around, data needs to shift around the 
cluster.  If Riak were automatically making those operational decisions for 
you, performance and stability would suffer.

As a side note, the needing to reip on all machines is a problem with the 
`reip` command, not the core gossip functionality.

&gt; And question sounds rather strange to me, what is the node role in system 
&gt; where all nodes are equal? It's everywhere said that  Riak will automatically 
&gt; re-balance data as nodes join and leave the cluster. It's not the case when 
&gt; node becomes unreachable and cluster would repartion data to keep it solid 
&gt; (like keeping n_val for keys)? 
&gt; 

Yes, n_val is still respected -- fallbacks take over for the missing node(s), 
even in an extended outage.  In the quoted sentence, we're talking about more 
permanent membership changes.

&gt; Or something else should watch for nodes states and tell cluster that node is 
&gt; down? 
&gt; 
&gt; It's also said that:
&gt; The ring state is shared around the cluster by means of a &quot;gossip protocol&quot;. 
&gt; Whenever a node changes its claim on the ring, it announces its change via 
&gt; this protocol. It also periodically re-announces what it knows about the 
&gt; ring, in case any nodes missed previous updates.
&gt; 

Actually, Erlang's built-in networking takes care of a lot of the checking for 
node availability; connected nodes will periodically send heartbeat messages to 
one another.  If a node becomes unavailable, it is removed from preflists and 
fallbacks take over.  The gossip protocol is for propagating changes to the 
ring state around the cluster. If the ring were frequently unstable (temporary 
partitions/failures affecting membership), you'd have a lot of trouble 
performing normal operations.

As I said above, the key difference here is between temporary and permanent 
failures.

&gt; Isn't cluster checking on unavailable nodes that way too?
&gt; 
&gt; I'm not offending anyone, just trying to make things more clear for myself.
&gt; 

Not offended, your questions are important to answer and demonstrate a lack of 
clarity in our documentation.  Any suggestions you have on how to clear that up 
would be appreciated!


Sean Cribbs &lt;s...@basho.com&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a></pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01317.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01318">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01318">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01319.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01311.html">have a new node take over the role of a downed, unrecove...</a></span> <span class="sender italic">Jesse Newland</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01312.html">Re: have a new node take over the role of a downed,...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01313.html">Re: have a new node take over the role of a dow...</a></span> <span class="sender italic">Jesse Newland</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01314.html">Re: have a new node take over the role of a...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01315.html">Re: have a new node take over the role ...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01316.html">Re: have a new node take over the ...</a></span> <span class="sender italic">Jesse Newland</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01317.html">Re: have a new node take over ...</a></span> <span class="sender italic">Leonid Riaboshtan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: have a new node take o...</span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: have a new node take over the role of a downed,	unrecoverable node?">
<input type="hidden" name="msgid" value="9BA3A75F-A695-462A-9A8C-4643F3ABF51A@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01318.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+have+a+new+node+take+over+the+role+of+a+downed%2C%09unrecoverable+node%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01317.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01319.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">9BA3A75F-A695-462A-9A8C-4643F3ABF51A@basho.com</li>
</ul>
</div>
</body>
</html>
