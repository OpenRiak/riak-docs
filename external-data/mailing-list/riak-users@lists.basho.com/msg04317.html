<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: High volume data series storage and queries</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04317" id="c">
<link rel="index" href="maillist.html#04317" id="i">
<link rel="prev" href="msg04314.html" id="p">
<link rel="next" href="msg04320.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04317.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+volume+data+series+storage+and+queries%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: High volume data series storage and queries</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremiah+Peschka%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremiah Peschka</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110810" rel="nofollow">Wed, 10 Aug 2011 06:39:47 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
---
Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
 Microsoft SQL Server MVP</pre><pre>

On Aug 10, 2011, at 6:14 AM, Ciprian Dorin Craciun wrote:

&gt; 
&gt;    Furthermore, to back my claims I've put on Github the old code
&gt; which I've used to benchmark different databases -- Riak or other
&gt; key-value stores are not included except BerkeleyDB, but I've included
&gt; others like Hypertable which could be a good choice -- at the
&gt; following address (you can easily extend the &quot;framework&quot; to include
&gt; new backends):
&gt;        <a  rel="nofollow" href="https://github.com/cipriancraciun/sds-benchmark">https://github.com/cipriancraciun/sds-benchmark</a>
&gt; 
&gt;    Also there is a &quot;so-called&quot; report I've put up at that time in the
&gt; same place at -- the second link is the content of the wkipage and
&gt; there are also images which GitHub doesn't display in the page:
&gt;        <a  rel="nofollow" href="https://github.com/cipriancraciun/sds-benchmark/tree/master/results">https://github.com/cipriancraciun/sds-benchmark/tree/master/results</a>
&gt;        
&gt; <a  rel="nofollow" href="https://github.com/cipriancraciun/sds-benchmark/blob/master/results/results.mediawiki">https://github.com/cipriancraciun/sds-benchmark/blob/master/results/results.mediawiki</a>
&gt; 
&gt;    For the record we've tested up to 100m records on some
&gt; data-stores, but on some other (like PostgreSQL and MySQL we've
&gt; stopped at 10 million as the insertion rate dropped tremendously).
&gt; 
&gt;    My conclusion from this experiment was: any database which is
&gt; backed by a tree-like data structure (almost all use B trees or
&gt; derivate) will get to a grinding halt in insert speed if the
&gt; clustering keys (clientid + timpstamp in this case) don't exhibit any
&gt; kind of locality (as is your case). See the quote from my report:
&gt; ~~~~
&gt; * this section applies to Postgres and SQLite, as MonetDB behaved Ok;
&gt; * it seems that the initial insert speed is good for the first couple
&gt; million records;
&gt; * as the data accumulates and new inserts are done, the indices start
&gt; to be rewritten, and consume the entire disk bandwidth; (the initial
&gt; good speed is due the fact that the indices fit into the RAM memory;)
&gt; * if the inserts are done without any indices defined, the insert
&gt; speed is incredible (600k in the case of Postgres), but the scan speed
&gt; is under 100;
&gt; * maybe, it is possible, that this behavior is specific to any
&gt; database which uses trees (like BerkeleyDB?);
&gt; ~~~~

There are a lot of items in your benchmark that lead to the performance 
problems that you saw with RDBMSes. Notably turning fsync off. An RDBMS will 
constantly stream writes to a write ahead log before committing them to disk. 
Most RDBMSes do this every minute or so. You can adjust your RDBMS so that when 
it checkpoints it can either dump all rows to disk as fast as possible or else 
attempt to determine an optimal rate to write at so that other read operations 
can continue and only experience minimal I/O blocking from writes. 

With a clustering key of clientid + timestamp, you'll see tremendous B-tree 
fragmentation on the unique index supporting the clustering key without using 
some kind of table level partitioning - either as an RDBMS feature in MSSQL 
Server or using something like partitioned views in PostgreSQL.

With any sufficiently complex system (an RDBMS is arguably more complex than 
most operating systems), you do need to apply some level of domain specific 
knowledge to the problem and then tune appropriately.


&gt; 
&gt;    Hope this helps you,
&gt;    Ciprian.
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04314.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04317">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04317">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04320.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04311.html">Re: High volume data serie...</a></span> <span class="sender italic">Paul O</span></li>
<li class="icons-email"><span class="subject"><a href="msg04315.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg04316.html">Re: High volume data serie...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li class="icons-email"><span class="subject"><a href="msg04318.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04310.html">Re: High volume data series st...</a></span> <span class="sender italic">Paul O</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04260.html">Re: High volume data series storage and queries</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04266.html">Re: High volume data series storage and queries</a></span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04304.html">Re: High volume data series storage and que...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04313.html">Re: High volume data series storage and...</a></span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04314.html">Re: High volume data series storage...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: High volume data series st...</span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04320.html">Re: High volume data serie...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li class="icons-email"><span class="subject"><a href="msg04321.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04345.html">Re: High volume data series st...</a></span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04348.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: High volume data series storage and queries">
<input type="hidden" name="msgid" value="76A9D293-B894-476F-9DA0-39A9BB7A0484@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04317.html">
<input type="submit" value=" Jeremiah Peschka ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+volume+data+series+storage+and+queries%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04314.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04320.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">76A9D293-B894-476F-9DA0-39A9BB7A0484@gmail.com</li>
</ul>
</div>
</body>
</html>
