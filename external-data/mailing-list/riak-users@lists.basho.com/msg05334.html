<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Search failure: stream_timeout</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05334" id="c">
<link rel="index" href="maillist.html#05334" id="i">
<link rel="prev" href="msg05333.html" id="p">
<link rel="next" href="msg05240.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05334.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Search+failure%5C%3A+stream_timeout%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Search failure: stream_timeout</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Elias+Levy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Elias Levy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111027" rel="nofollow">Thu, 27 Oct 2011 14:10:18 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Thu, Oct 27, 2011 at 1:06 PM, Ryan Zezeski &lt;rzeze...@basho.com&gt; wrote:</pre><pre>

&gt; This is indeed the case.  Even in the case of an intersection, Search will
&gt; run all sub-queries to completion and then combine them at a coordinator
&gt; based on the query plan.  If any of the sub-queries returns a large number
&gt; of results then latency will start to suffer and timeouts may occur.
&gt;  However, all hope is not lost.  Search has a notion of &quot;inline fields.&quot;
&gt;  These fields are analyzed just like any other field but unlike a normal
&gt; field the results are stored alongside _every_ term entry in the index for
&gt; efficient access.
&gt;

Thanks.  This is indeed what I did, at least for searching using the Solr
API.  As, the MR input search mechanism does not allow for a filter, but our
key includes the field we want to index on, I implemented the filter as a
reduce phase before any map phases the filters out keys.  I am currently
evaluating the performance of both options.

I would appear the Solr API is faster most of the time, but because the
currently the sort option is applied after the rows option, I had to resort
to using the undocumented presort option to sort by key, which in our use
includes the field we want to filter on (timestamp), and then apply start
and rows.  Alas, since presort only sort in ascending order and start does
not take negative indices if I want to get the most recent objects, I have
to perform the query twice.  Once to get the result count, then another to
get the actual results I want after I've computed the offset into the
results.  In such cases, MR may be faster.



&gt; If you don't have #1 then I would say it's a sign you probably want to use
&gt; secondary indices because #2 is basically a form of tagging and that's what
&gt; secondary indices were built for.
&gt;

I look forward to the evolution of secondary indices, but right now they are
too basic for our needs. Many of our queries are compounded.  And while the
intersection of all subqueries results in a set of manageable size, any
single subquery can be rather large.  Thus, there is no natural secondary
key that will return a low cardinality result set than can be filtered
further through MR.

Elias
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05333.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05334">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05334">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05240.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05237.html">Search failure: stream_timeout</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05238.html">Re: Search failure: stream_timeout</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05333.html">Re: Search failure: stream_timeout</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Search failure: stream_timeout</span> <span class="sender italic">Elias Levy</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Search failure: stream_timeout">
<input type="hidden" name="msgid" value="CAFDmHdNaxk7BKjYuXyJX4vGhz78geudHTvKVMcE5i9_5hYFoJA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05334.html">
<input type="submit" value=" Elias Levy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Search+failure%5C%3A+stream_timeout%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05333.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05240.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAFDmHdNaxk7BKjYuXyJX4vGhz78geudHTvKVMcE5i9_5hYFoJA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
