<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Stale index entries after delete</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#18090" id="c">
<link rel="index" href="maillist.html#18090" id="i">
<link rel="prev" href="msg18089.html" id="p">
<link rel="next" href="msg18091.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18090.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Stale+index+entries+after+delete%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Stale index entries after delete</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Fred+Dushin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Fred Dushin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170317" rel="nofollow">Fri, 17 Mar 2017 05:27:09 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello Bernard,

Thank you for writing this up, and apologies for the delay in responding.</pre><pre>

I have not been able to readily reproduce this in my test environment, and our 
Riak tests (e.g., [1]) test scenarios very much like this.

If this is a test environment, can you try stopping riak, deleting your 
data/yz_anti_entropy directory, and restarting?  Monitor the output of 
riak-admin search aae-status for all trees to rebuild and all exchanges to 
complete, and check to verify that your search results are correct?

Also, if you have any additional bucket properties configured (e.g., strong 
consistency, allow_mult, lww, etc), please send those along.

[1] <a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/develop/riak_test/yz_siblings.erl">https://github.com/basho/yokozuna/blob/develop/riak_test/yz_siblings.erl</a>

&gt; On Mar 14, 2017, at 11:39 PM, Bernard Duggan &lt;bern...@hippware.com&gt; wrote:
&gt; 
&gt; Hi list,
&gt; We're seeing some weird behaviour that I haven't been able to find any decent 
&gt; explanation for. Essentially, after deleting records out of a bucket, the 
&gt; records continue to persist in the solr index for that bucket type.
&gt; 
&gt; Things that might matter:
&gt; * We're using v2.2.1 (and also saw it on 2.2.0)
&gt; * We're using the `memory` storage backend for Riak.
&gt; * The indices showing the problem have various schemas, but it happens with 
&gt; `_yz_default` as easily as any others.
&gt; * `anti_entropy` and `search` are both turned on.
&gt; * This happens on single-node developer &quot;clusters&quot; with n_val set to 3. We 
&gt; haven't tried any other configurations yet.
&gt; 
&gt; The problem doesn't seem to take any special actions to trigger - we write a 
&gt; few objects to a bucket and they show up in the index. Then we delete them, 
&gt; wait a few seconds to make sure everything's caught up, and read the index 
&gt; and they're often (though it seems not always - I haven't been able to pin 
&gt; down the exact circumstances) still there. It's also reproducible if we stop 
&gt; and start riak (which clears out the memory-backed buckets but doesn't seem 
&gt; to do the same for the indices).
&gt; 
&gt; Is this a known issue with/feature of memory-backed buckets or is there 
&gt; somewhere else we should look?
&gt; 
&gt; Cheers,
&gt; 
&gt; Bernard
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18089.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#18090">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18090">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18091.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg18089.html">Stale index entries after delete</a></span> <span class="sender italic">Bernard Duggan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Stale index entries after delete</span> <span class="sender italic">Fred Dushin</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Stale index entries after delete">
<input type="hidden" name="msgid" value="4F4FDA51-78E3-45EC-AE1E-C17C2E496922@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18090.html">
<input type="submit" value=" Fred Dushin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Stale+index+entries+after+delete%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18089.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18091.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4F4FDA51-78E3-45EC-AE1E-C17C2E496922@basho.com</li>
</ul>
</div>
</body>
</html>
