<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: stalled handoffs with riak 1.3.1 and eleveldb</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#11060" id="c">
<link rel="index" href="maillist.html#11060" id="i">
<link rel="prev" href="msg11052.html" id="p">
<link rel="next" href="msg11053.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11060.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+stalled+handoffs+with+riak+1.3.1+and+eleveldb%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: stalled handoffs with riak 1.3.1 and eleveldb</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Simon+Effenberg%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Simon Effenberg</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130513" rel="nofollow">Mon, 13 May 2013 05:35:03 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I found this in the logs for hours:
</pre><pre>

2013-05-12 04:39:13.002 UTC [info] 
&lt;0.188.0&gt;@riak_core_handoff_manager:handle_info:279 An outbound handoff of 
partition riak_kv_vnode 884893569477695126256137301058686984557302906880 was 
terminated for reason: {shutdown,max_concurrency}


after the rolling restart it started working:

2013-05-12 05:11:52.277 UTC [info] 
&lt;0.4696.0&gt;@riak_core_handoff_sender:start_fold:130 Starting hinted_handoff 
transfer of riak_kv_vnode from 'riak@10.46.109.201' 
1255977969581244695331291653115555720016817029120 to 'riak@10.46.109.205' 
1255977969581244695331291653115555720016817029120


also the AAE was suddenly working:

2013-05-12 06:44:35.889 UTC [info] 
&lt;0.7820.3&gt;@riak_kv_exchange_fsm:key_exchange:204 Repaired 1 keys during active 
anti-entropy exchange of {108470824645652950960429733678161630365088743424,12} 
between {137015778499772148581595453067151533092743675904,'riak@10.46.109.201'} 
and {14272476927059598810582859694494951363827
4662400,'riak@10.46.109.202'}

The situation started to long ago so I have no log files for the start of this 
event except some error logs which only shows:

** Removing (timedout) connection **
2013-05-05 00:35:30 UTC =ERROR REPORT====
** Node 'riak@10.47.109.205' not responding **
** Removing (timedout) connection **
2013-05-05 00:35:30 UTC =ERROR REPORT====
** Node 'riak@10.47.109.201' not responding **
** Removing (timedout) connection **
2013-05-05 00:35:30 UTC =ERROR REPORT====
** Node 'riak@10.47.109.202' not responding **
** Removing (timedout) connection **
2013-05-05 00:36:30 UTC =ERROR REPORT====
** Node 'riak@10.47.109.202' not responding **
** Removing (timedout) connection **
2013-05-05 00:36:30 UTC =ERROR REPORT====
** Node 'riak@10.47.109.205' not responding **

this &quot;could&quot; be the start of the problem and we have had some weird network 
issues between to DC's at this timeframe with some broken TCP connections. But 
it looks like Riak wasn't able to get out of this situation by itself without a 
rolling restart.

Any ideas?

Cheers,
Simon


On Sun, 12 May 2013 07:34:50 +0200
Simon Effenberg &lt;seffenb...@team.mobile.de&gt; wrote:

&gt; Hi list,
&gt; 
&gt; this morning I did a &quot;riak-admin transfers&quot; on the riak machines and
&gt; saw this:
&gt; 
&gt; [root@kriak46-1:~]# riak-admin transfers
&gt; Attempting to restart script through sudo -H -u riak
&gt; 'riak@10.47.109.206' waiting to handoff 30 partitions
&gt; 'riak@10.47.109.202' waiting to handoff 3 partitions
&gt; 'riak@10.47.109.201' waiting to handoff 15 partitions
&gt; 'riak@10.46.109.206' waiting to handoff 1 partitions
&gt; 'riak@10.46.109.205' waiting to handoff 1 partitions
&gt; 'riak@10.46.109.204' waiting to handoff 29 partitions
&gt; 'riak@10.46.109.203' waiting to handoff 16 partitions
&gt; 'riak@10.46.109.202' waiting to handoff 17 partitions
&gt; 'riak@10.46.109.201' waiting to handoff 3 partitions
&gt; 
&gt; Active Transfers:
&gt; 
&gt; and this didn't changed for at least 15 minutes while checking.
&gt; 
&gt; I also did on each node:
&gt; 
&gt; riak-admin ring-status
&gt; 
&gt; and every node said:
&gt; 
&gt; Attempting to restart script through sudo -H -u riak
&gt; ================================== Claimant 
&gt; ===================================
&gt; Claimant:  'riak@10.46.109.201'
&gt; Status:     up
&gt; Ring Ready: true
&gt; 
&gt; ============================== Ownership Handoff 
&gt; ==============================
&gt; No pending changes.
&gt; 
&gt; ============================== Unreachable Nodes 
&gt; ==============================
&gt; All nodes are up and reachable
&gt; 
&gt; 
&gt; So why do I not see any &quot;Ownership Handoff&quot; on some nodes (or is this 
&gt; &quot;another&quot; handoff)?
&gt; Also how could I get rid of the waiting handoffs?
&gt; 
&gt; My solution was a rolling restart which helped. But I don't know how it was 
&gt; possible to get into this situation and also it would be nice to resolve it 
&gt; without a rolling restart.
&gt; 
&gt; Any ideas?
&gt; 
&gt; Cheers,
&gt; Simon
&gt; 



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11052.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#11060">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#11060">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11053.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11052.html">stalled handoffs with riak 1.3.1 and eleveldb</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: stalled handoffs with riak 1.3.1 and eleveldb</span> <span class="sender italic">Simon Effenberg</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: stalled handoffs with riak 1.3.1 and eleveldb">
<input type="hidden" name="msgid" value="20130513143335.b7d148f17cbbbb5fa6e594ea@team.mobile.de">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11060.html">
<input type="submit" value=" Simon Effenberg ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+stalled+handoffs+with+riak+1.3.1+and+eleveldb%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11052.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11053.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20130513143335.b7d148f17cbbbb5fa6e594ea@team.mobile.de</li>
</ul>
</div>
</body>
</html>
