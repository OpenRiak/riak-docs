<!DOCTYPE html>
<html lang="en">
<head>
<title>[ANN] 2i Range Query Bug and Upcoming Fix</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10568" id="c">
<link rel="index" href="maillist.html#10568" id="i">
<link rel="prev" href="msg10565.html" id="p">
<link rel="next" href="msg10570.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10568.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22%5C%5BANN%5C%5D+2i+Range+Query+Bug+and+Upcoming+Fix%22&amp;o=newest" rel="nofollow"><span itemprop="name">[ANN] 2i Range Query Bug and Upcoming Fix</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jordan+West%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jordan West</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130322" rel="nofollow">Fri, 22 Mar 2013 13:15:11 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>It was recently reported, via the mailing list [1] [2], that 2i range
queries involving integers greater than or equal to 2147483647 (0x7fffffff)
could return
missing results. This bug was confirmed and the cause was identified to be
an issue with the encoding library sext [3], which Riak uses for indexes
stored in
eleveldb.  Sext serializes Erlang terms to a binary while preserving
sort order. For these large integers, this was not the case. Since the 2i
implementation relies on this property, some range queries were
affected.</pre><pre>

The issue in sext was quickly patched [4] and will be included in the
next version of Riak (1.3.1).  New installations of Riak 1.3.1 will
immediately take advantage of the change. However, the fix introduces
an incompatibility in the encoding of big integers. Integer
indexes containing values greater than or equal to 2147483647
already written to disk with Riak 1.3 and below will need to be rewritten,
so that range queries over them will return the correct results.

Riak 1.3.1 will include a utility, as part of
`riak-admin`, that will perform the reformatting of these indexes
while the node is online. After the affected indexes have been
reformatted on all nodes, range queries will begin returning the
correct results for previously written data. The utility should be run
against any riak cluster using 2i after upgrading the entire cluster
to 1.3.1, regardless of whether or not large integer index values are
used. It will report how many indexes were affected (rewritten). Unaffected
indexes are not modified and new writes will be written in the correct
format.

More details on how to run the utility will be provided with the release of
Riak 1.3.1. We wanted to begin raising awareness on this now so 2i users
upgrading to 1.3.1 can take advantage of the fix as soon as it is released.
The changes have  been merged into the 1.3 branch. The original branch can
be found on GitHub [5]. If you have any questions or concerns, please let
us know.

Cheers,
Jordan

[1]
<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2013-March/011276.html">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2013-March/011276.html</a>

[2] <a  rel="nofollow" href="https://github.com/basho/riak_kv/issues/499">https://github.com/basho/riak_kv/issues/499</a>

[3] <a  rel="nofollow" href="https://github.com/uwiger/sext">https://github.com/uwiger/sext</a>

[4]
<a  rel="nofollow" href="https://github.com/uwiger/sext/commit/ff10beb7a791f04ad439d2c1c566251901dd6bdc">https://github.com/uwiger/sext/commit/ff10beb7a791f04ad439d2c1c566251901dd6bdc</a>

[5] <a  rel="nofollow" href="https://github.com/basho/riak_kv/tree/jrw-eas-2i-fix-keys-backport">https://github.com/basho/riak_kv/tree/jrw-eas-2i-fix-keys-backport</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10565.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10568">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10568">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10570.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="[ANN] 2i Range Query Bug and Upcoming Fix">
<input type="hidden" name="msgid" value="CANvRNdcMh6vOxXw6uGa46bi6=DHKZUAjScqeXsyHX8LT71GA6A@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10568.html">
<input type="submit" value=" Jordan West ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22%5C%5BANN%5C%5D+2i+Range+Query+Bug+and+Upcoming+Fix%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10565.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10570.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANvRNdcMh6vOxXw6uGa46bi6=DHKZUAjScqeXsyHX8LT71GA6A@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
