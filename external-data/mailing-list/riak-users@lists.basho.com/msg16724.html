<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Ownership handoff timed out</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16724" id="c">
<link rel="index" href="maillist.html#16724" id="i">
<link rel="prev" href="msg16723.html" id="p">
<link rel="next" href="msg16707.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16724.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ownership+handoff+timed+out%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Ownership handoff timed out</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Vladyslav+Zakhozhai%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Vladyslav Zakhozhai</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20151030" rel="nofollow">Fri, 30 Oct 2015 04:24:55 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

Matthew thank you for information.</pre><pre>


On Thu, Oct 29, 2015 at 8:19 PM Matthew Von-Maszewski &lt;matth...@basho.com&gt;
wrote:

&gt; I queried Basho’s Client Services team.  They tell me the upgrade /
&gt; coexist should be no problem.
&gt;
&gt; Matthew
&gt;
&gt; On Oct 29, 2015, at 1:38 PM, Vladyslav Zakhozhai &lt;
&gt; v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt;
&gt; Matthew can you describe the bug more detail?
&gt;
&gt; My plan was to migrate to eleveldb and only then to migrate to Riak 2.0.
&gt; It seems that I need to change my plans to migrate to Riak 2.0 first. It is
&gt; sad.
&gt;
&gt; Is it safe to migrate Riak 1.4.12/Riak CS 1.5.0 to Riak 2.0 on production
&gt; environment? According to official upgrade guides I can upgrade nodes one
&gt; by one in the same cluster. So Riak 2.0 and Riak 1.4.12 nodes can coexist
&gt; in one cluster. Am I right?
&gt;
&gt; Thank you.
&gt;
&gt; On Thu, Oct 29, 2015 at 7:04 PM Matthew Von-Maszewski &lt;matth...@basho.com&gt;
&gt; wrote:
&gt;
&gt;&gt; Sad to say your LOG files suggest the same bug as seen elsewhere and
&gt;&gt; fixed by recent changes in the leveldb code.
&gt;&gt;
&gt;&gt; The tougher issue is that the fixes are currently only available for our
&gt;&gt; 2.0 product series.  A backport would be non-trivial due to the number of
&gt;&gt; places changed between 1.4 and 2.0 and the number of places the fix
&gt;&gt; overlaps those changes.  The corrected code is tagged “2.0.9” in eleveldb
&gt;&gt; and leveldb.
&gt;&gt;
&gt;&gt; The only path readily available to you is to have your receiving cluster
&gt;&gt; upgraded to 2.0 Riak CS and manually build/patch eleveldb to the 2.0.9
&gt;&gt; version. Then start your handoffs.   (eleveldb version 2.0.9 is not present
&gt;&gt; in any shipping version of Riak … yet).
&gt;&gt;
&gt;&gt; I will write again if I can think of an easier solution.  But nothing is
&gt;&gt; occurring to me or the team members I have queried.
&gt;&gt;
&gt;&gt; Matthew
&gt;&gt;
&gt;&gt; On Oct 29, 2015, at 12:14 PM, Vladyslav Zakhozhai &lt;
&gt;&gt; v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; Matthew thank for you answer. eleveldb LOGs are attached.
&gt;&gt; Here is LOGs from 2 eleveldb nodes (eggeater was not restarted; what
&gt;&gt; about rattlesnake I'm not sure).
&gt;&gt;
&gt;&gt; On Thu, Oct 29, 2015 at 5:24 PM Matthew Von-Maszewski &lt;matth...@basho.com&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; There was a known eleveldb bug with handoff receiving that could cause a
&gt;&gt;&gt; timeout.  But it does not sound like bug fits your symptoms.  However, I am
&gt;&gt;&gt; willing to verify my diagnosis.  I would need you to gather the LOG files
&gt;&gt;&gt; from all vnodes on the RECEIVING side (or at least from the vnode that you
&gt;&gt;&gt; are attempting and is failing).
&gt;&gt;&gt;
&gt;&gt;&gt; I will check it for the symptoms of the known bug.
&gt;&gt;&gt;
&gt;&gt;&gt; Note:  the LOG files reset on each restart of Riak.  So you must gather
&gt;&gt;&gt; the LOG files right after the failure without restarting Riak.
&gt;&gt;&gt;
&gt;&gt;&gt; Matthew
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Oct 29, 2015, at 11:11 AM, Vladyslav Zakhozhai &lt;
&gt;&gt;&gt; v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I want to make small update. Jon your hint about problems on sender side
&gt;&gt;&gt; is correct. As I've already told there problems with available resources on
&gt;&gt;&gt; sender nodes. There are no enough available RAM which is a cause of
&gt;&gt;&gt; swapiness and load on disks. Restarting of sender nodes helps me (at least
&gt;&gt;&gt; temoprarily).
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu, Oct 29, 2015 at 12:19 PM Vladyslav Zakhozhai &lt;
&gt;&gt;&gt; v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Average size of objects in Riak - 300 Kb. This objects are images. This
&gt;&gt;&gt;&gt; data updates very very rearly (there almost no updates).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I have GC turned on and works:
&gt;&gt;&gt;&gt; root@python:~# riak-cs-gc status
&gt;&gt;&gt;&gt; There is no garbage collection in progress
&gt;&gt;&gt;&gt;   The current garbage collection interval is: 900
&gt;&gt;&gt;&gt;   The current garbage collection leeway time is: 86400
&gt;&gt;&gt;&gt;   Last run started at: 20151029T100600Z
&gt;&gt;&gt;&gt;   Next run scheduled for: 20151029T102100Z
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Network misconfigurations were not detected. The result of your script
&gt;&gt;&gt;&gt; shows correct info.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; But I see that almost all nodes with bitcask suffers from low free
&gt;&gt;&gt;&gt; memory and they swapped. I think that it can be an issue. But my question
&gt;&gt;&gt;&gt; is, what workaround is for this problem.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've wrote in my first post that I tuned handoff_timeout and
&gt;&gt;&gt;&gt; handoff_receive_timeout (now this vaules are 300000 and 600000). But
&gt;&gt;&gt;&gt; situation is the same.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Tue, Oct 27, 2015 at 4:06 PM Jon Meredith &lt;jmered...@basho.com&gt;
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Handoff problems without obvious disk issues can be due to the
&gt;&gt;&gt;&gt;&gt; database containing large objects.  Do you frequently update objects in 
&gt;&gt;&gt;&gt;&gt; CS,
&gt;&gt;&gt;&gt;&gt; and if so have you had garbage collection running?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; The timeout is happening on the receiver side after not receiving any
&gt;&gt;&gt;&gt;&gt; tcp data for handoff_receive_timeout *milli*seconds.  I know you said you
&gt;&gt;&gt;&gt;&gt; increased it, but not how high.  I would bump that up to 300000 to give 
&gt;&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt;&gt; sender a chance to read larger objects off disk.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; To check if the sender is transmitting, on the source node you could
&gt;&gt;&gt;&gt;&gt; run
&gt;&gt;&gt;&gt;&gt;   redbug:start(&quot;riak_core_handoff_sender:visit_item&quot;, [{arity,
&gt;&gt;&gt;&gt;&gt; true},{print_file,&quot;/tmp/visit_item.log&quot;},{time, 3600000},{msgs, 
&gt;&gt;&gt;&gt;&gt; 1000000}]).
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; That file should fill fairly fast with an entry for every object the
&gt;&gt;&gt;&gt;&gt; sender tries to transmit.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; There's a long shot it could be network misconfiguration. Run this
&gt;&gt;&gt;&gt;&gt; from the source node having problems
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; rpc:multicall(erlang, apply, [fun() -&gt; TargetNode = node(),
&gt;&gt;&gt;&gt;&gt; [_Name,Host] = string:tokens(atom_to_list(TargetNode), &quot;@&quot;), {ok, Port} =
&gt;&gt;&gt;&gt;&gt; riak_core_gen_server:call({riak_core_handoff_listener, TargetNode},
&gt;&gt;&gt;&gt;&gt; handoff_port), HandoffIP = riak_core_handoff_listener:get_handoff_ip(),
&gt;&gt;&gt;&gt;&gt; TNHandoffIP = case HandoffIP of error -&gt; Host; {ok, &quot;0.0.0.0&quot;} -&gt; Host;
&gt;&gt;&gt;&gt;&gt; {ok, Other} -&gt; Other end, {node(), HandoffIP, TNHandoffIP,
&gt;&gt;&gt;&gt;&gt; inet:gethostbyname(TNHandoffIP), Port} end, []]).
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; and it will print out a a list of remote nodes and IP addresses (and
&gt;&gt;&gt;&gt;&gt; hopefully an empty list of failed nodes)
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; {[{'dev1@127.0.0.1',          &lt;---- node name
&gt;&gt;&gt;&gt;&gt;   {ok,&quot;0.0.0.0&quot;},             &lt;---- handoff ip address configured in
&gt;&gt;&gt;&gt;&gt; app.config
&gt;&gt;&gt;&gt;&gt;   &quot;127.0.0.1&quot;,                &lt;---- hostname passed to socket open
&gt;&gt;&gt;&gt;&gt;   {ok,{hostent,&quot;127.0.0.1&quot;,[],inet,4,[{127,0,0,1}]}}, &lt;--- DNS entry
&gt;&gt;&gt;&gt;&gt; for hostname
&gt;&gt;&gt;&gt;&gt;   10019}],                    &lt;---- handoff port
&gt;&gt;&gt;&gt;&gt;  []} &lt;--- empty list of errors
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Good luck, Jon.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Tue, Oct 27, 2015 at 3:55 AM Vladyslav Zakhozhai &lt;
&gt;&gt;&gt;&gt;&gt; v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Jon thank you for the answer. During approval of my mail to this list
&gt;&gt;&gt;&gt;&gt;&gt; I've troubleshoot my issue more deep. And yes, your are right. Neither
&gt;&gt;&gt;&gt;&gt;&gt; {error, enotconn} nor max_concurrency is my problem.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I'm going to migrate my cluster entierly to eleveldb only, i.e. I
&gt;&gt;&gt;&gt;&gt;&gt; need to refuse using bitcask. I have a talk with basho support and they
&gt;&gt;&gt;&gt;&gt;&gt; said that it is tricky to tune bitcask on servers with 32 GB RAM (and I
&gt;&gt;&gt;&gt;&gt;&gt; guess that it is not tricky, but it is impossible, because bitcask loads
&gt;&gt;&gt;&gt;&gt;&gt; all keys in memory regardless of free available RAM). With LevelDB I have
&gt;&gt;&gt;&gt;&gt;&gt; opportunity to tune using RAM on servers.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; So I have 15 nodes with multibackend (bitcask for data and leveldb
&gt;&gt;&gt;&gt;&gt;&gt; for metadata). 2 additional servers are without multibackend - only with
&gt;&gt;&gt;&gt;&gt;&gt; leveldb. Now I'm not sure do I need still use mutibackend with 
&gt;&gt;&gt;&gt;&gt;&gt; levedb-only
&gt;&gt;&gt;&gt;&gt;&gt; backend.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; And my problem is (as I mentioned earlier) the following. On
&gt;&gt;&gt;&gt;&gt;&gt; leveldb-only nodes I see handoffs timedout and no further progress.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On multibackend hosts I have configuration:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; {riak_kv, [
&gt;&gt;&gt;&gt;&gt;&gt;        {add_paths, [&quot;/usr/lib/riak-cs/lib/riak_cs-1.5.0/ebin&quot;]},
&gt;&gt;&gt;&gt;&gt;&gt;        {storage_backend, riak_cs_kv_multi_backend},
&gt;&gt;&gt;&gt;&gt;&gt;        {multi_backend_prefix_list, [{&lt;&lt;&quot;0b:&quot;&gt;&gt;, be_blocks}]},
&gt;&gt;&gt;&gt;&gt;&gt;        {multi_backend_default, be_default},
&gt;&gt;&gt;&gt;&gt;&gt;        {multi_backend, [
&gt;&gt;&gt;&gt;&gt;&gt;            {be_default, riak_kv_eleveldb_backend, [
&gt;&gt;&gt;&gt;&gt;&gt;                {max_open_files, 50},
&gt;&gt;&gt;&gt;&gt;&gt;                {data_root, &quot;/var/lib/riak/leveldb&quot;}
&gt;&gt;&gt;&gt;&gt;&gt;            ]},
&gt;&gt;&gt;&gt;&gt;&gt;            {be_blocks, riak_kv_bitcask_backend, [
&gt;&gt;&gt;&gt;&gt;&gt;                {data_root, &quot;/var/lib/riak/bitcask&quot;}
&gt;&gt;&gt;&gt;&gt;&gt;            ]}
&gt;&gt;&gt;&gt;&gt;&gt;        ]},
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; And for hosts with leveldb-only backend:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; {riak_kv, [
&gt;&gt;&gt;&gt;&gt;&gt;             {storage_backend, riak_kv_eleveldb_backend},
&gt;&gt;&gt;&gt;&gt;&gt; ...
&gt;&gt;&gt;&gt;&gt;&gt; {eleveldb, [
&gt;&gt;&gt;&gt;&gt;&gt;             {data_root, &quot;/var/lib/riak/leveldb&quot;}
&gt;&gt;&gt;&gt;&gt;&gt; (default values for leveldb)
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; In leveldb logs I see nothing that could help me (no errors in logs).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Mon, Oct 26, 2015 at 3:57 PM Jon Meredith &lt;jmered...@basho.com&gt;
&gt;&gt;&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I suspect your {error,enotconn} messages are unrelated - that's
&gt;&gt;&gt;&gt;&gt;&gt;&gt; likely to be caused by an HTTP client closing the connection while Riak
&gt;&gt;&gt;&gt;&gt;&gt;&gt; looks up  some networking information about the requestor.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; The max_concurrency message you are seeing is related to the handoff
&gt;&gt;&gt;&gt;&gt;&gt;&gt; transfer limit - it should be labelled as informational. When a node has
&gt;&gt;&gt;&gt;&gt;&gt;&gt; data to handoff it starts the handoff sender process and if there are
&gt;&gt;&gt;&gt;&gt;&gt;&gt; either too many local handoff processes or too many on the remote side 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; it
&gt;&gt;&gt;&gt;&gt;&gt;&gt; exits with max_concurrency.  You could increase with riak-admin
&gt;&gt;&gt;&gt;&gt;&gt;&gt; transfer-limit but that probably won't help if you're timing out.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; As you're using the multi-backend you're transferring data from
&gt;&gt;&gt;&gt;&gt;&gt;&gt; bitcask and leveldb.  The next place I would look is in the leveldb LOG
&gt;&gt;&gt;&gt;&gt;&gt;&gt; files to see if there are any leveldb vnodes that are having problems
&gt;&gt;&gt;&gt;&gt;&gt;&gt; that's preventing repair.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Jon
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Mon, Oct 26, 2015 at 7:15 AM Vladyslav Zakhozhai &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I have a problem with persistent timeouts during ownership
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; handoffs. I've tried to surf over Internet and current mail list but no
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; success.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I have Riak 1.4.12 cluster with 17 nodes. Almost all nodes use
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; multibackend with bitcask and eleveldb as storage backends (we need
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; multiple backend for Riak CS 1.5.0 integration).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Now I'm working to migrate Riak cluster to eleveldb as primary and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; only backend. For now I have 2 nodes with eleveldb backend in the same
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; cluster.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; During ownership handoff process I permanently see errors of timed
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; out handoff receivers and sender.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Here is partial output of riak-admin transfers:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ...
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; transfer type: ownership_transfer
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; vnode type: riak_kv_vnode
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; partition: 331121464707782692405522344912282871640797216768
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; started: 2015-10-21 08:32:55 [46.66 min ago]
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; last update: no updates seen
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; total size: unknown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; objects transferred: unknown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;                            unknown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak@taipan.pleiad.uaprom  =======&gt;  r...@eggeater.pleiad.uapr
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;                                      om
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;         |                                           |   0%
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;                            unknown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; transfer type: ownership_transfer
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; vnode type: riak_kv_vnode
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; partition: 336830455478606531929755488790080852186328203264
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; started: 2015-10-21 08:32:54 [46.68 min ago]
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; last update: no updates seen
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; total size: unknown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; objects transferred: unknown
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ...
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Some of partition handoffs state never updates, some of them
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; terminates after partial handoff objects and never starts again.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I see nothing in logs but following:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On receiver side:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2015-10-21 11:33:55.131 [error]
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.25390.1266&gt;@riak_core_handoff_receiver:handle_info:105 Handoff 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; receiver
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; for partition 331121464707782692405522344912282871640797216768 timed 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; out
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; after processing 0 objects.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On sender side:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2015-10-21 11:01:58.879 [error] &lt;0.13177.1401&gt; CRASH REPORT Process
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.13177.1401&gt; with 0 neighbours crashed with reason: no function 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; clause
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; matching webmachine_request:peer_from_peername({error,enotconn},
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; {webmachine_request,{wm_reqstate,#Port&lt;0.50978116&gt;,[],undefined,undefined,undefined,{wm_reqdata,...},...}})
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; line 150
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 2015-10-21 11:32:50.055 [error] &lt;0.207.0&gt; Supervisor
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak_core_handoff_sender_sup had child riak_core_handoff_sender started
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; with {riak_core_handoff_sender,start_link,undefined} at &lt;0.22312.1090&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; exit
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; with reason max_concurrency in context child_terminated
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; {error, enotconn} - seems to be network issue. But I have no any
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; problems with network. All hosts resolve their neighbors correctly and
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /etc/hosts on each node are correct.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I've tried to increase handoff_timeout and handoff_receive_timeout.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; But no success.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Forcing handoff helped me but for short period of time:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; rpc:multicall([node() | nodes()], riak_core_vnode_manager, 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; force_handoffs, []).
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I see progress of handoffs (riak-admin transfers) but then I see 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; handoff timed out again.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; A week ago I've joined 4 nodes with bitcask. And there was no such 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; problems.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I'm confused a little bit and need to understand my next steps in 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; troubleshooting this issue.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; &lt;eggeater-leveldb-logs-old.tar.gz&gt;&lt;rattlesnake-leveldb-logs-old.tar.gz&gt;
&gt;&gt; &lt;rattlesnake-leveldb-logs.tar.gz&gt;&lt;eggeater-leveldb-logs.tar.gz&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16723.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16724">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16724">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16707.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16704.html">Ownership handoff timed out</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16705.html">Re: Ownership handoff timed out</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16708.html">Re: Ownership handoff timed out</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16706.html">Re: Ownership handoff timed out</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16716.html">Re: Ownership handoff timed out</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16715.html">Re: Ownership handoff timed ou...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16718.html">Re: Ownership handoff time...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16721.html">Re: Ownership handoff ...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg16722.html">Re: Ownership handoff ...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li class="icons-email"><span class="subject"><a href="msg16723.html">Re: Ownership handoff ...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Ownership handoff ...</span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Ownership handoff timed out">
<input type="hidden" name="msgid" value="CAArBN7HHmO1D99CMXVFBAfkqUbsZ4_rVujWAozCc1ayesqaHog@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16724.html">
<input type="submit" value=" Vladyslav Zakhozhai ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ownership+handoff+timed+out%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16723.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16707.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAArBN7HHmO1D99CMXVFBAfkqUbsZ4_rVujWAozCc1ayesqaHog@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
