<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Node will not leave cluster</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07625" id="c">
<link rel="index" href="maillist.html#07625" id="i">
<link rel="prev" href="msg07622.html" id="p">
<link rel="next" href="msg07626.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07625.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Node+will+not+leave+cluster%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Node will not leave cluster</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Swinney%2C+Austin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Swinney, Austin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120606" rel="nofollow">Wed, 06 Jun 2012 08:20:47 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Dave,

I'm no expert, however, I using riak (1.1.1 2012-03-07) RedHat x86_64.</pre><pre>

I typically issue the leave command for the node.  When:

--  all it's Ownership Handoffs (riak-admin ring_status) are done
--  it is at 0.0% in both Ring and Pending in `riak-admin member_status`
--  tailing the log on the node ( /var/log/riak/console.log ) stops showing 
handoffs

Then I take it to be done leaving.  The documentation says, &quot;When all data is 
handed off, the Erlang VM process eventually exits.&quot;  But in my experience with 
this version, that never happens.  Maybe I'm just too impatient?

So I do that manually:

-- stop the node's riak on the node with `riak stop`
-- from another node, mark it as down (riak-admin down 
r...@xxx.x.x.xx&lt;<a  rel="nofollow" href="mailto:r...@xxx.x.x.xx">mailto:r...@xxx.x.x.xx</a>&gt;)

Then it stays in the down list of hosts.

I'm probably doing this all wrong and just clarifying how NOT to do it.  :-P

Best Regards,

Austin

On Jun 6, 2012, at 10:26 AM, David Greenstein wrote:


I've issued the riak-admin leave command on one of my nodes but it does not 
seem to ever leave the cluster of 4 nodes. I've opened up all firewall ports to 
make sure the repartitioning isn't being blocked. riak-admin status on all 
nodes shows the node in question it is still connected and a ring_member. If I 
issue the riak-admin leave command again the error states the node is already 
in the process of leaving. I've made sure no clients are connecting to the node 
that left as well. I'm also still seeing bit cast Merge log messages in the 
console.log of the node that left.

Has anyone experienced this issue and have some clues as to possible causes?

Thank you!
Dave Greenstein


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07622.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07625">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07625">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07626.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07622.html">Node will not leave cluster</a></span> <span class="sender italic">David Greenstein</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Node will not leave cluster</span> <span class="sender italic">Swinney, Austin</span></li>
<li class="icons-email"><span class="subject"><a href="msg07626.html">Re: Node will not leave cluster</a></span> <span class="sender italic">David Greenstein</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07627.html">Re: Node will not leave cluster</a></span> <span class="sender italic">Swinney, Austin</span></li>
<li class="icons-email"><span class="subject"><a href="msg07636.html">Re: Node will not leave cluster</a></span> <span class="sender italic">David Greenstein</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Node will not leave cluster">
<input type="hidden" name="msgid" value="1E3580C4-66A8-4B79-BE31-DA6ABA69BB16@vimeo.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07625.html">
<input type="submit" value=" Swinney, Austin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Node+will+not+leave+cluster%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07622.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07626.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">1E3580C4-66A8-4B79-BE31-DA6ABA69BB16@vimeo.com</li>
</ul>
</div>
</body>
</html>
