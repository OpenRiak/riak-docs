<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Possible handoff stalls</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07007" id="c">
<link rel="index" href="maillist.html#07007" id="i">
<link rel="prev" href="msg07004.html" id="p">
<link rel="next" href="msg07008.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07007.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Possible+handoff+stalls%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Possible handoff stalls</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Michael+Clemmons%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Michael Clemmons</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120320" rel="nofollow">Tue, 20 Mar 2012 15:28:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>[apologies for the delay on this email sent to armon only first]

I'm having similar issues on a testing cluster for 1.1.1rc1.  I'm having 1
out of 4 nodes failing multiple times and not restarting well, there are
like 100 pending transfers.  Only thing node is failing.  I've stopped
pointing traffic at the nodes and have attempted to remove this machine
from  the cluster.
Its slowly leaving but is moving very slowly for not much data, the
metadata is important and loosing any would be a significant time
consumer(but obviously not vital since we used a day old build).
What the likely hood that pull request will make it into a deb build in the
near future or will the make file generate a deb?
-Michael</pre><pre>

On Mon, Mar 19, 2012 at 11:40 AM, Armon Dadgar &lt;armon.dad...@gmail.com&gt;wrote:

&gt; Okay, good to know this is a known issue. I attached the
&gt; logs for the last time this occurred in my original email.
&gt;
&gt; I'll try to capture this information if the problem occurs again.
&gt; Thanks.
&gt;
&gt; Best Regards,
&gt;
&gt; Armon Dadgar
&gt;
&gt; On Mar 19, 2012, at 11:36 AM, Jon Meredith wrote:
&gt;
&gt; Hi Armon,
&gt;
&gt; We've recently patched an issue that affects handoffs here
&gt; <a  rel="nofollow" href="https://github.com/basho/riak_core/pull/153">https://github.com/basho/riak_core/pull/153</a>
&gt;
&gt; If the issue repeats for you, as well as the logs it would be very useful
&gt; if you could follow the instructions from the pull request above ro the
&gt; 'riak_core_handoff_manager:status().' command against all nodes.
&gt;
&gt; The pull request works around an issue where it looks like the kernel has
&gt; closed a socket (no evidence of it any longer with netstat/ss) but the
&gt; erlang process is still stuck in an receive call from it (gen_tcp:recv/2 to
&gt; be more precise).
&gt;
&gt; Please let us know if you hit it again.
&gt;
&gt; Best, Jon.
&gt;
&gt; On Mon, Mar 19, 2012 at 12:10 PM, Armon Dadgar &lt;armon.dad...@gmail.com&gt;wrote:
&gt;
&gt;&gt; I wanted to ping the mailing list and see if anybody else has encountered
&gt;&gt; stalls in the partition handoffs on Riak 1.1. We added a new node to our
&gt;&gt; cluster
&gt;&gt; last Friday, but noticed that the partition handoffs appear to have
&gt;&gt; stopped
&gt;&gt; after about 7-8 hours.
&gt;&gt;
&gt;&gt; Most of the handoffs completed, and the only handoffs that remained were
&gt;&gt; from node 3 to node 2.
&gt;&gt; The ring claimant (node 1), indicated that node 3 was unreachable (via
&gt;&gt; ring_status).
&gt;&gt; However, Riak control did not indicate that node 3 was unreachable, and
&gt;&gt; in fact it was
&gt;&gt; actually live and continuing to serve request.
&gt;&gt;
&gt;&gt; To resolve this, I tried to just restart node 3. I ran &quot;riak stop&quot;
&gt;&gt; multiple times, but this did
&gt;&gt; not actually seem to do anything (The node was continuing to run and
&gt;&gt; serve requests).
&gt;&gt; Next, I attached to the node and ran &quot;init:stop().&quot; This started to shut
&gt;&gt; down various
&gt;&gt; sub-systems, but the node was still running. Sending a SIGTERM signal to
&gt;&gt; the beam vm
&gt;&gt; finally killed it. Restarting the node with &quot;riak start&quot; worked as
&gt;&gt; expected,
&gt;&gt; and the node promptly resumed the handoffs, and finished in a few hours.
&gt;&gt;
&gt;&gt; I'm not sure exactly what the issue was, but something seemed to cause a
&gt;&gt; stalling of the handoffs.
&gt;&gt;
&gt;&gt; I've attached the contents of our console.log, erlang.log, error.log and
&gt;&gt; crash.log
&gt;&gt; from the relevant times if that is useful.
&gt;&gt;
&gt;&gt;  Best Regards,
&gt;&gt;
&gt;&gt; Armon Dadgar
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Jon Meredith
&gt; Platform Engineering Manager
&gt; Basho Technologies, Inc.
&gt; jmered...@basho.com
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;


-- 
-Michael
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07004.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07007">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07007">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07008.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07002.html">Possible handoff stalls</a></span> <span class="sender italic">Armon Dadgar</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07003.html">Re: Possible handoff stalls</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07004.html">Re: Possible handoff stalls</a></span> <span class="sender italic">Armon Dadgar</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Possible handoff stalls</span> <span class="sender italic">Michael Clemmons</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07008.html">Re: Possible handoff stalls</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07009.html">Re: Possible handoff stalls</a></span> <span class="sender italic">Michael Clemmons</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Possible handoff stalls">
<input type="hidden" name="msgid" value="CABfaNM4B=7GCCwj4YF2JGC1gFZ4srPJ0S740V2uTAuaa_DnCfw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07007.html">
<input type="submit" value=" Michael Clemmons ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Possible+handoff+stalls%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07004.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07008.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CABfaNM4B=7GCCwj4YF2JGC1gFZ4srPJ0S740V2uTAuaa_DnCfw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
