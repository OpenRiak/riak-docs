<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Strange spike</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07594" id="c">
<link rel="index" href="maillist.html#07594" id="i">
<link rel="prev" href="msg07590.html" id="p">
<link rel="next" href="msg07583.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07594.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strange+spike%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Strange spike</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Nam+Nguyen%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Nam Nguyen</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120601" rel="nofollow">Fri, 01 Jun 2012 09:45:21 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sounds like a good plan, Greg.

By the way, I joined back the old node into the cluster (making it 6-node 
cluster now). And it seems to me that the spike occurs only on that node.</pre><pre>

To summarize the problem so far, for the benefits of other list members:

1. The latency spike occurred on one particular node.

2. I took that node out of the cluster, and put in another one. Spikes seemed 
to happen on all nodes when the cluster were converging and shortly after that. 
The new node seemed to perform a little bit worse than the rest of the cluster.

3. I rejoin the old node to the cluster. Spike seems to be localized to it 
again. The spike is, however, less intensive and a little bit shorter in 
duration. New node seems to be doing on par with the rest.

I'll wait for version 1.2.

Cheers,
Nam


On Jun 1, 2012, at 2:36 AM, Greg Burd wrote:

&gt; Hey Nam,
&gt; 
&gt; It is safe to restart but my advice is to wait until we release 1.2.0 in the 
&gt; next week or two. It has a boat-load of fixes to LevelDB one of which I'm 
&gt; fairly sure is impacting you. Changing these settings as you've indicated is 
&gt; unlikely to make a difference if my intuition is correct.
&gt; 
&gt; -greg 
&gt; 
&gt; @gregburd
&gt; Developer Advocate, Basho Technologies | <a  rel="nofollow" href="http://basho.com">http://basho.com</a> | @basho
&gt; 
&gt; 
&gt; On Thursday, May 31, 2012 at 9:22 PM, Nam Nguyen wrote:
&gt; 
&gt;&gt; Hi Seth,
&gt;&gt; 
&gt;&gt; Yes, I am using the default config.
&gt;&gt; 
&gt;&gt; Is it safe to change these values and restart riak?
&gt;&gt; 
&gt;&gt; Nam
&gt;&gt; 
&gt;&gt; On May 31, 2012, at 11:24 AM, Seth Benton wrote:
&gt;&gt;&gt; Hey,
&gt;&gt;&gt; 
&gt;&gt;&gt; Apologies if this is the wrong place for this, but I just updated the 
&gt;&gt;&gt; eLevelDB wiki page to mention randomization of the write buffer length (via 
&gt;&gt;&gt; setting write_buffer_size_min and write_buffer_size_max). Before there was 
&gt;&gt;&gt; no mention of these config parameters. Perhaps people were just using 
&gt;&gt;&gt; levelDB's 4MB default buffer size, causing all the vnodes to compact at the 
&gt;&gt;&gt; same time? Or are there default write_buffer_size_min and 
&gt;&gt;&gt; write_buffer_size_max parameters under the hood?
&gt;&gt;&gt; 
&gt;&gt;&gt; <a  rel="nofollow" href="http://wiki.basho.com/LevelDB.html">http://wiki.basho.com/LevelDB.html</a>
&gt;&gt;&gt; 
&gt;&gt;&gt; P.S. Mathew V is getting back to me shortly on changes to this page due to 
&gt;&gt;&gt; changes in 1.2.
&gt;&gt;&gt; 
&gt;&gt;&gt; Seth
&gt;&gt;&gt; (Tech Writer)
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On Thu, May 31, 2012 at 9:26 AM, Nam Nguyen &lt;n...@tinyco.com 
&gt;&gt;&gt; (<a  rel="nofollow" href="mailto:n...@tinyco.com">mailto:n...@tinyco.com</a>)&gt; wrote:
&gt;&gt;&gt;&gt; Hi Sean,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; You are right. At first I thought it was localized to that one particular 
&gt;&gt;&gt;&gt; node. Now others are also exhibiting the same symptom.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I am putting in another node. 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;&gt; Nam
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On May 30, 2012, at 11:23 PM, Sean Cribbs wrote:
&gt;&gt;&gt;&gt;&gt; Nam,
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; The LevelDB storage backend has a known issue where compaction can stall 
&gt;&gt;&gt;&gt;&gt; a heavily-loaded node for a long time (we've seen 60 seconds or more in 
&gt;&gt;&gt;&gt;&gt; production clusters). We're very sorry about this, but an improvement 
&gt;&gt;&gt;&gt;&gt; will be available in the next release. In the meantime, DO NOT make the 
&gt;&gt;&gt;&gt;&gt; node leave the cluster - this will only make things worse! It might be 
&gt;&gt;&gt;&gt;&gt; worth adding another node to the cluster, but I suggest you wait until 
&gt;&gt;&gt;&gt;&gt; the node finishes compaction.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; On Wed, May 30, 2012 at 10:43 PM, Nam Nguyen &lt;n...@tinyco.com 
&gt;&gt;&gt;&gt;&gt; (<a  rel="nofollow" href="mailto:n...@tinyco.com">mailto:n...@tinyco.com</a>)&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; My 5-node cluster exhibits a strange spike on one particular node.
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; Overall, the mean get time is about 1ms. This node occasionally shoots 
&gt;&gt;&gt;&gt;&gt;&gt; up to 40ms.
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; During those times, %iowait is still the same as it is before the spike. 
&gt;&gt;&gt;&gt;&gt;&gt; No error. Console log shows many lines like the below, which I don't 
&gt;&gt;&gt;&gt;&gt;&gt; think relevant to the spike.
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 2012-05-30 21:29:50.591 [info] 
&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.72.0&gt;@riak_core_sysmon_handler:handle_event:85 monitor long_gc 
&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.938.0&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; [{initial_call,{riak_core_vnode,init,1}},{almost_current_function,{gen_fsm,loop,7}},{message_queue_len,0}]
&gt;&gt;&gt;&gt;&gt;&gt;  
&gt;&gt;&gt;&gt;&gt;&gt; [{timeout,185},{old_heap_block_size,0},{heap_block_size,2584},{mbuf_size,0},{stack_size,55},{old_heap_size,0},{heap_size,804}]
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; The cluster is set up uniformly. Ubuntu 64bit, m2.2xlarge instance. Riak 
&gt;&gt;&gt;&gt;&gt;&gt; 1.1.2 with LevelDB backend.
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; What would be the best course of actions for me?
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; I plan to:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; - riak-admin leave on that node
&gt;&gt;&gt;&gt;&gt;&gt; - set up new instance
&gt;&gt;&gt;&gt;&gt;&gt; - riak-admin reip the new instance
&gt;&gt;&gt;&gt;&gt;&gt; - riak-admin join it to the cluster
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;&gt;&gt;&gt; Nam
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt;&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; -- 
&gt;&gt;&gt;&gt;&gt; Sean Cribbs &lt;s...@basho.com (<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>)&gt;
&gt;&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; 


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07590.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07594">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07594">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07583.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07579.html">Strange spike</a></span> <span class="sender italic">Nam Nguyen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07581.html">Re: Strange spike</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07585.html">Re: Strange spike</a></span> <span class="sender italic">Nam Nguyen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07586.html">Re: Strange spike</a></span> <span class="sender italic">Seth Benton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07587.html">Re: Strange spike</a></span> <span class="sender italic">Nam Nguyen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07590.html">Java Client: Connection pool recovery.</a></span> <span class="sender italic">Guido Medina</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Strange spike</span> <span class="sender italic">Nam Nguyen</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Strange spike">
<input type="hidden" name="msgid" value="7FD5BBD3-5025-48C3-BD66-305074D4D0A5@tinyco.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07594.html">
<input type="submit" value=" Nam Nguyen ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strange+spike%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07590.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07583.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">7FD5BBD3-5025-48C3-BD66-305074D4D0A5@tinyco.com</li>
</ul>
</div>
</body>
</html>
