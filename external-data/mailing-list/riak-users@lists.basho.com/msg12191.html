<!DOCTYPE html>
<html lang="en">
<head>
<title>Download stops at certain megabyte boundary (RiakCS)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd10.html#12191" id="c">
<link rel="index" href="mail10.html#12191" id="i">
<link rel="prev" href="msg12185.html" id="p">
<link rel="next" href="msg12195.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12191.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Download+stops+at+certain+megabyte+boundary+%5C%28RiakCS%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Download stops at certain megabyte boundary (RiakCS)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Martin+Alpers%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Martin Alpers</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130904" rel="nofollow">Wed, 04 Sep 2013 08:39:34 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello everyone on the list,

I run a test cluster for RiakCS, running on three nodes, mostly using defaults.
Mostly meaning that all modifications were necessary to make RiakCS run, but no 
tweaks have taken place yet.</pre><pre>

Now after figuring out how to make objects publicly available we tried to 
download it again, but we saw a strange behavior:
* downloading from the frist node stopped at exactly 3MB, i.e. 3145728 bytes
* downloading from the second node stopped at exactly 22MB
* downloading from the third node stopped at exactly 16MB
* downloading from the first node using s3cmd stopped at exactly 2MB
* downloading from the first node using wget stopped several times precisely on 
MB boundaries, but continued afterwards until the download was complete
All halts are abrupt, a 2Mb download slows down to 0b in an instant.
The first two cases were exactly the same for a friend of mine, the remaining 
were only tested by myself.

If you want to test that for yourself, the file can be found at 
<a  rel="nofollow" href="http://85.10.193.103:6080$x/xyz/spying_nsa.webm">http://85.10.193.103:6080$x/xyz/spying_nsa.webm</a>, where $x is the number of the 
node.

When I first uploaded the file, I interupted c3cmd (Crtl-C) because I had 
forgotten to allow it to be read publicly, and then reuploaded it.
However, I uploaded the file again to another bucket, available at at 
.../abc/sn.webm, and it shows the same behavior.
The number might be different, but the third node is unresponsive as well.
Naturally I had checked if the processes are still up, and &quot;riak-admin 
member-status&quot;, and did not find any peculiarities.

I read in the docs about the &quot;enable_multipart&quot; setting in .s3cfg, but mine is 
&quot;False&quot; and uploading a file of 25MB worked nicely.
(See 
<a  rel="nofollow" href="http://docs.basho.com/riakcs/latest/cookbooks/configuration/Configuring-an-S3-Client/">http://docs.basho.com/riakcs/latest/cookbooks/configuration/Configuring-an-S3-Client/</a>)
My .s3cfg was generated by s3cmd and the only modified settings are those for 
login and proxy settings.
For reference, the file, redacted only to remove credentials, can be found as 
an attachment to this mail.

Now what could I have done wrong?
I had several configuration errors in the /etc/riak-cs/app.configs of the 
cluster, fixed them, and restarted riak-cs, but the problem persists.
Could it be a setting in .s3cfg?
What about ulimit? It is still defaulting to 1024, but this is a cluster 
storing a mere 500MB or so, and less than 30 files, serving a few objects per 
hour.
I mean, what would that number look like on a production cluster if 1024 is too 
little for such low-profile testing?
For the same reason, I am sure that IO is not the problem - my 2Mb ADSL will be 
the bottleneck, and 50kb upload even more so.

I have another problem that might or might not be related, and is described 
much easier:
s3cmd ls s3://abc
WARNING: Retrying failed request: /?delimiter=/ ('')
WARNING: Waiting 3 sec...
WARNING: Retrying failed request: /?delimiter=/ ('')
WARNING: Waiting 6 sec...
^CSee ya!
Happens when I try to list objects of a non-empty bucket. Any ideas on that one?

One remaining question:
root@riak3:~# riak-admin diag
...
[&quot;sh: 1: exec: sysctl: not found&quot;],
...
root@riak3:~#
I know how this message comes about:
sysctl lives under /sbin, which is not in $PATH for any user except root.
Should I care? What is the best way to fix that? I can think of a few.

Platform information:
Three instances of KVM, running Debian 7 (Squeeze), each connected to the KVM 
host using routed TAP devices
Erlang: Version: 1:15.b.1-dfsg-4 (R15B01 is needed to compile Riak, so this 
looks fine for me)
Prebuilt riak and riak-cs packages built for Debian 6 (Squeeze)
To meet dependencies, libssl0.9.8 from Squeeze was installed using dpkg -i
(Wheezy &quot;only&quot; has libssl1.0.0, which does not satisfy said dependency.)

Big thanks to anyone who has a look at my problems.
Any help is highly appreciated and I will gladly provide any information that I 
failed to provide in the first place.
-- 
Greetings, Martin Alpers
--
martin-alp...@web.de
Mobile: 0176/66185173, but I prefer typing to talking (:
Jabber: martin.alp...@jabber.org
My mails are signed using GPG to verify their origin; request my public key 
(10216CFB).
See also: <a  rel="nofollow" href="http://apps.opendatacity.de/stasi-vs-nsa/">http://apps.opendatacity.de/stasi-vs-nsa/</a>
</pre><pre>[default]
bucket_location = DE
cloudfront_host = cloudfront.amazonaws.com
default_mime_type = binary/octet-stream
delete_removed = False
dry_run = False
enable_multipart = False
encoding = UTF-8
encrypt = False
follow_symlinks = False
force = False
get_continue = False
gpg_command = /usr/bin/gpg
gpg_decrypt = %(gpg_command)s -d --verbose --no-use-agent --batch --yes 
--passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)s
gpg_encrypt = %(gpg_command)s -c --verbose --no-use-agent --batch --yes 
--passphrase-fd %(passphrase_fd)s -o %(output_file)s %(input_file)s
gpg_passphrase = 
guess_mime_type = True
host_base = s3.amazonaws.com
host_bucket = %(bucket)s.s3.amazonaws.com
human_readable_sizes = False
invalidate_on_cf = False
list_md5 = False
log_target_prefix = 
mime_type = 
multipart_chunk_size_mb = 15
preserve_attrs = True
progress_meter = True
proxy_host = 85.10.193.103
proxy_port = 60801
recursive = False
recv_chunk = 4096
reduced_redundancy = False
send_chunk = 4096
simpledb_host = sdb.amazonaws.com
skip_existing = False
socket_timeout = 300
urlencoding_mode = normal
use_https = False
verbosity = WARNING
website_endpoint = http://%(bucket)s.s3-website-%(location)s.amazonaws.com/
website_error = 
website_index = index.html
</pre>
<p><strong><a href="msg12191/signature.asc" ><img src="../attachment.png" alt="Attachment:" width=27 height=28></a>
<a href="msg12191/signature.asc" >signature.asc</a></strong><br>
<em>Description:</em> Digital signature</p>
<pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12185.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd10.html#12191">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail10.html#12191">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12195.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Download stops at certain megabyte boundary (RiakCS)</span> <span class="sender italic">Martin Alpers</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12195.html">Re: Download stops at certain megabyte boundary (R...</a></span> <span class="sender italic">Shunichi Shinohara</span></li>
<li class="icons-email"><span class="subject"><a href="msg12204.html">Re: Download stops at certain megabyte boundary (R...</a></span> <span class="sender italic">Seth Thomas</span></li>
<li class="icons-email"><span class="subject"><a href="msg12218.html">Re: Download stops at certain megabyte boundary (R...</a></span> <span class="sender italic">Shunichi Shinohara</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12228.html">Re: Download stops at certain megabyte boundar...</a></span> <span class="sender italic">Shunichi Shinohara</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Download stops at certain megabyte boundary (RiakCS)">
<input type="hidden" name="msgid" value="20130904142031.GA29035@laptop1.westhand.de">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12191.html">
<input type="submit" value=" Martin Alpers ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Download+stops+at+certain+megabyte+boundary+%5C%28RiakCS%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12185.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12195.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20130904142031.GA29035@laptop1.westhand.de</li>
</ul>
</div>
</body>
</html>
