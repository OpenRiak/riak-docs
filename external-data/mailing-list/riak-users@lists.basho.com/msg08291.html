<!DOCTYPE html>
<html lang="en">
<head>
<title>Schema design - version history and time travel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08291" id="c">
<link rel="index" href="maillist.html#08291" id="i">
<link rel="prev" href="msg08290.html" id="p">
<link rel="next" href="msg08314.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08291.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Schema+design+%5C-+version+history+and+time+travel%22&amp;o=newest" rel="nofollow"><span itemprop="name">Schema design - version history and time travel</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Patrik+Sundberg%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Patrik Sundberg</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120815" rel="nofollow">Wed, 15 Aug 2012 03:54:20 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

I have a domain where I want to be able to &quot;time travel&quot;. I don't have many
of updates (many more reads), but when there is an update I need to
preserve history and create new versions. Setting my local &quot;application
time&quot; determines which version of a particular piece of data is fetched,
and I can go back in time and recreate how things looked previously. One
can't change the past, just create new versions in the &quot;future&quot; relative to
last version. Using a model of &quot;starting point + replaying deltas&quot; to get
to a given time is not a good idea, it's an ever evolving state where
snapshots are cheap enough to store and reduces complexity a lot.</pre><pre>

My domain objects are in the order of a couple of hundred types, each type
having some pure data properties (10s, up to hundreds, easily represented
as JSON blobs) and in the order of tens, maximum hundreds of has_one and
has_many type relationships to other objects (which can be of different
type). The relationships only require one direction, always from parent to
child (sourced to destination). An object has a given unique ID, and a
version of that object has a given unique valid time period (with the
latest version having an implicit &quot;infinity&quot; end of period).

The queries are mostly to find a data property or a relationship for a
given object. A few special cases may be for range queries and exact
queries on properties, easily taken care of by 2i queries.

I'm trying to think of if and how my domain would be fitted into a riak
&quot;schema&quot;. My hunch of starting point:
- map object types to buckets
- make the unique object IDs the keys in the bucket to represent the
concept of that object
- not sure how to represent the links to versions of that particular object
- the versions themselves may be either in the same bucket or in a another
bucket (think &quot;cars&quot; and &quot;car-versions&quot; or using &quot;cars&quot; for both)
- a version has a JSON value with its properties, some 2i for any possible
exact and range queries I need
- the has_one and has_many links i could do in several ways. first decision
is if to point them to the object identity or directly to a specific
version. then can use Link, can use 2i, can store IDs in the JSON and do a
2 query fetch to get there
- 99% of read operations are of the type &quot;given the time of X, give me the
property or relation Y of object with ID Z&quot;

Anyone having built something similar with a time snapshot/version angle
with experience to share? Any input in general appreciated.

Thanks,
Patrik
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08290.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08291">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08291">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08314.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Schema design - version history and time travel</span> <span class="sender italic">Patrik Sundberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08314.html">Re: Schema design - version history and time travel</a></span> <span class="sender italic">Patrik Sundberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08374.html">Re: Schema design - version history and time trav...</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08377.html">Re: Schema design - version history and time ...</a></span> <span class="sender italic">Patrik Sundberg</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Schema design - version history and time travel">
<input type="hidden" name="msgid" value="CAEzHAquvftLA6VOmBKBT1Bb6S-evCWozoYQeDzt5NM+txD_zNQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08291.html">
<input type="submit" value=" Patrik Sundberg ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Schema+design+%5C-+version+history+and+time+travel%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08290.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08314.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAEzHAquvftLA6VOmBKBT1Bb6S-evCWozoYQeDzt5NM+txD_zNQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
