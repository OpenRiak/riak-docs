<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak replication and quorum</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03330" id="c">
<link rel="index" href="maillist.html#03330" id="i">
<link rel="prev" href="msg03328.html" id="p">
<link rel="next" href="msg03414.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03330.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+replication+and+quorum%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak replication and quorum</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Peter+Fales%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Peter Fales</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110513" rel="nofollow">Fri, 13 May 2011 11:06:10 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sean,

Thanks to you and Ben for clarifying how that works.  Since that was 
so helpful, I'll ask a followup question, and also a question on 
a mostly un-related topic...</pre><pre>

1) When I've removed a couple of nodes and the remaining nodes pick up 
the slack, is there any way for me to look under the hood and see that?
I'm using wget to fetch the '.../stats' URL from one of the remaing 
live nodes, and under ring_ownership it still lists the original 4
nodes, each one owning 1/4 or the total partitions.   That's part of
reason why I didn't think the data ownership had been moved.

2) My test involves sending a large number of read/write requests to the 
cluster from multiple client connections and timing how long each request
takes.   I find that the vast majority of the requests are processed 
quickly (a few milliseconds to 10s of milliseconds).  However, every once
in while, the server seems to &quot;hang&quot; for a while.  When that happens
the response can take several hundred milliseconds or even several 
seconds.   Is this something that is known and/or expected?   There 
doesn't seem to be any pattern to how often it happens -- typically 
I'll see it a &quot;few&quot; times during a 10-minute test run.   Sometimes
it will go for several minutes without a problem.   I haven't ruled
out a problem with my test client, but it's fairly simple-minded C++
program using the protocol buffers interface, so I don't think there
is too much that can go wrong on that end.

Thanks again for your help!


On Fri, May 13, 2011 at 12:06:06PM -0400, Sean Cribbs wrote:
&gt; Peter,
&gt; 
&gt; You've hit on a major feature of Riak: to be available in the face of network 
&gt; and hardware failure.  
&gt; 
&gt; When a node is down, other nodes (ones that do not &quot;own&quot; the replicas for a 
&gt; given key) will pick up the slack and serve read and write requests on behalf 
&gt; of the downed node.  This means that while the node(s) is down, you could 
&gt; write a key to the cluster and read it back while still satisfying quorum.  
&gt; The standard quorum considers fallback nodes to be as valid as non-fallbacks 
&gt; (we're also in the process of implementing a way for you to be more strict 
&gt; about that, if you so desire).  When the downed nodes return, writes that 
&gt; were sent to fallbacks are returned to their proper owners via hinted handoff.
&gt; 
&gt; This feature lets your application that uses Riak stay available (even if in 
&gt; a degraded state), despite multiple failures. We consider this A Good Thing.
&gt; 
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt; 
&gt; On May 13, 2011, at 11:13 AM, Peter Fales wrote:
&gt; 
&gt; &gt; 
&gt; &gt; I'm a Riak newbie, trying to get some familiarity with the system by
&gt; &gt; runing some tests on Amazon EC2.   I'm seeing some behavior that I don't 
&gt; &gt; understand...
&gt; &gt; 
&gt; &gt; I've set up a test where I create a 4-node cluster using 4 EC2 machines.
&gt; &gt; I've created a bucket with n_val=4, r=quorum, and w=quorum.   For
&gt; &gt; n_val=4, the quorum should be 3, so I thought I would have to have at
&gt; &gt; least 3 nodes in service for my read and write operations to succeed.
&gt; &gt; During my test, I start sending read/write requests to two of the nodes
&gt; &gt; (and I see the CPU load go up on all four nodes, so I know they are
&gt; &gt; talking to each other).  Then I reboot the other two nodes.  At that 
&gt; &gt; point, I was expecting the reads and writes to start failing, but in 
&gt; &gt; fact I usually don't see any problems.  (sometimes the query that is 
&gt; &gt; in progress at the time may fail or timeout, but if I establish a new
&gt; &gt; connection to the server, and start sending read/write requests again,
&gt; &gt; those requests will go through, even with only two of the 4 nodes in 
&gt; &gt; service)
&gt; &gt; 
&gt; &gt; I suspect I'm just missing something obvious, but I don't understand how
&gt; &gt; I can run with just two nodes.  What am I missing?
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; Peter Fales
&gt; &gt; Alcatel-Lucent
&gt; &gt; Member of Technical Staff
&gt; &gt; 1960 Lucent Lane
&gt; &gt; Room: 9H-505
&gt; &gt; Naperville, IL 60566-7033
&gt; &gt; Email: peter.fa...@alcatel-lucent.com
&gt; &gt; Phone: 630 979 8031
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

-- 
Peter Fales
Alcatel-Lucent
Member of Technical Staff
1960 Lucent Lane
Room: 9H-505
Naperville, IL 60566-7033
Email: peter.fa...@alcatel-lucent.com
Phone: 630 979 8031

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03328.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03330">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03330">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03414.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03326.html">Riak replication and quorum</a></span> <span class="sender italic">Peter Fales</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03327.html">Re: Riak replication and quorum</a></span> <span class="sender italic">Ben Tilly</span></li>
<li class="icons-email"><span class="subject"><a href="msg03328.html">Re: Riak replication and quorum</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak replication and quorum</span> <span class="sender italic">Peter Fales</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03414.html">Re: Riak replication and quorum</a></span> <span class="sender italic">Mathias Meyer</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak replication and quorum">
<input type="hidden" name="msgid" value="20110513180547.GE17967@alcatel-lucent.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03330.html">
<input type="submit" value=" Peter Fales ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+replication+and+quorum%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03328.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03414.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20110513180547.GE17967@alcatel-lucent.com</li>
</ul>
</div>
</body>
</html>
