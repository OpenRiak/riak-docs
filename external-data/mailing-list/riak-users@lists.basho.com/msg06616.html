<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: A couple of questions about Riak</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06616" id="c">
<link rel="index" href="maillist.html#06616" id="i">
<link rel="prev" href="msg06615.html" id="p">
<link rel="next" href="msg06627.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06616.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+A+couple+of+questions+about+Riak%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: A couple of questions about Riak</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Aphyr%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Aphyr</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120216" rel="nofollow">Thu, 16 Feb 2012 01:18:57 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
</pre><pre>

On 02/16/2012 01:07 AM, Jerome Renard wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hello,

I am really interested into Riak but I would like to know if my goals
can be achieved with for my project.

The use case is the following :

- I need to support 10 000 writes/second minimum. Object size will be
from 1kb to 5kb
</pre></blockquote><pre style="margin: 0em;">

Definitely. 10 SSDs should do it.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- I need to organize data in buckets. Bucket 'dc1' would store all my
data from data center one, bucket 'dc2' would store all my data from
data center two, etc. The size of a bucket is going to grow large
really quickly; (Would links be a more relevant alternative ?)
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Yes; buckets are just prefixed namespaces for keys. You can have vast 
</tt><tt>numbers of keys in a bucket. Links are something totally different.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- I need to search on these data : full-text search + facets. Searches
will most likely be date based range queries;
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Riak_search and secondary indices may meet your needs, but read the docs 
</tt><tt>carefully. You may also be interested in
</tt><pre style="margin: 0em;">
<a  rel="nofollow" href="http://www.meetup.com/San-Francisco-Riak-Meetup/events/51287272/">http://www.meetup.com/San-Francisco-Riak-Meetup/events/51287272/</a>

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- Those data are meant to expire after a certain period of time, so I
will have to run large delete operations every week/month/year.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Yup, readily doable. Just be aware that listing keys in stock Riak can 
</tt><tt>be expensive. Search or 2I may reduce that load.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- I can get a replication factor of 2 if needed instead of 3 by default;
</pre></blockquote><pre style="margin: 0em;">

Yup. Just set n_val in the bucket properties once and you're good.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- I need to get my disk space back when I remove data. This may sounds
odd to some users, but people who come from a MySQL/InnoDB
background know that removing large amounts of data does not mean you
will get your disk space back ;)
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Bitcask and leveldb both reclaim space. Bitcask is log-structured so 
</tt><tt>you'll see some (configurable) amount of dead space--in my 
</tt><tt>continuous-compaction environment, roughly 15-30% dead bytes on top of 
</tt><tt>the &quot;real&quot; dataset.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Based on the use case described below my questions are:

- I am sure Riak can achieve the required write speed. But is there
any hardware recommandations for storing Tb of quickly growing data ?
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>It sounds like your data might be largely immutable and write heavy. In 
</tt><tt>that case I would try a small number of partitions per host, bitcask, 
</tt><tt>huge amounts of spinning disk, and lots of RAM cache on top of that. 
</tt><tt>Those writes will translate into big stripey writes on top of the disk. 
</tt><tt>If you can afford SSDs that's the obvious option.
</tt><pre style="margin: 0em;">

</pre><tt>Be aware that bitcask does not support compression--but if your 
</tt><tt>filesystem performs block-level compression then you should see 
</tt><tt>excellent savings. The riak robject structure on disk is quite fluffy 
</tt><tt>and compresses well. We see ~30% on snappy block-level compression in 
</tt><tt>leveldb.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- Which storage backend would be the most relevant to me ? Bitcast or LevelDB ?
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Leveldb supports secondary indexes, but I don't understand its 
</tt><tt>performance characteristics across a variety of read/write loads. Maybe 
</tt><tt>someone else can chime in?
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- Does riak-search support facetted search ? (I would say yes but I
found no documentation in the wiki about that)
</pre></blockquote><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- Will it be a problem if I decide to run Riak on ZFS + compression enabled ?
</pre></blockquote><pre style="margin: 0em;">

I suspect it would work quite well. If you try it, please report back!

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
If you need any more details feel free to ask.

Thanks in advance for your feedback.

Best Regards,

--
Jérôme Renard
<a  rel="nofollow" href="http://39web.fr">http://39web.fr</a> | <a  rel="nofollow" href="http://jrenard.info">http://jrenard.info</a> | <a  rel="nofollow" href="http://twitter.com/jeromerenard">http://twitter.com/jeromerenard</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06615.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06616">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06616">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06627.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06615.html">A couple of questions about Riak</a></span> <span class="sender italic">Jerome Renard</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: A couple of questions about Riak</span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06627.html">Re: A couple of questions about Riak</a></span> <span class="sender italic">Paul Armstrong</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06624.html">Re: A couple of questions about Riak</a></span> <span class="sender italic">Paul Armstrong</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: A couple of questions about Riak">
<input type="hidden" name="msgid" value="4F3CC9FF.60409@aphyr.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06616.html">
<input type="submit" value=" Aphyr ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+A+couple+of+questions+about+Riak%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06615.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06627.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4F3CC9FF.60409@aphyr.com</li>
</ul>
</div>
</body>
</html>
