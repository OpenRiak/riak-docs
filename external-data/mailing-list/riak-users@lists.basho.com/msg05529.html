<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: configurable prefix for consistent hashing?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05529" id="c">
<link rel="index" href="maillist.html#05529" id="i">
<link rel="prev" href="msg05528.html" id="p">
<link rel="next" href="msg05515.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05529.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+configurable+prefix+for+consistent+hashing%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: configurable prefix for consistent hashing?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Nate+Lawson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Nate Lawson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111109" rel="nofollow">Wed, 09 Nov 2011 16:08:05 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Nov 9, 2011, at 3:49 PM, Nate Lawson wrote:

&gt; On Nov 9, 2011, at 3:33 PM, Elias Levy wrote:
&gt; 
&gt;&gt; On Wed, Nov 9, 2011 at 3:29 PM, Phil Stanhope &lt;stanh...@gmail.com&gt; wrote:
&gt;&gt; Tread carefully here ... by forcing localilty ... you will sacrifice high 
&gt;&gt; availability by algorithmically creating a bias and a single point of 
&gt;&gt; failure in the cluster. 
&gt;&gt; 
&gt;&gt; You don't have to loose high availability, your data is still being 
&gt;&gt; replicated, but you can create hot spots.  Known your data.
&gt; 
&gt; Correct. Partitioning based on SHA-1(DocumentID) is the same situation as 
&gt; doing it based on SHA-1(entire_key), which is how Riak currently works. Even 
&gt; if &quot;entire_key&quot; and &quot;DocumentID&quot; are both just simple counters, it is the 
&gt; same situation.
&gt; 
&gt; We would only need worry if the pair BucketName + DocumentID was not unique 
&gt; (say, skewed towards 0 or something). In that case, we'd need to analyze the 
&gt; distribution of DocumentID values to be sure the partition is balanced.</pre><pre>


Sorry to reply to myself, but I wanted to add more detail.

You have multiple ways you could generate partitions: bucket, key-prefix, key, 
or even key+value. The question is really, &quot;how many items do I need before the 
law of large numbers gets me enough balancing?&quot; The answer depends on the data, 
as Elias mentioned.

Obviously, partitioning based only on bucket would be bad if you wrote mostly 
to one bucket. But more subtly, you could write equally to all buckets but 
store the largest or most frequently-accessed values in only one bucket.

Even Riak's current partitioning scheme could be imbalanced if you only stored 
large values in keys whose SHA-1 has a certain prefix. That's admittedly 
extremely unlikely, which is why Riak chose this scheme. But it could happen.

Anyway, overriding the default partitioning function is something that should 
always be an advanced-only feature and &quot;know your data&quot; first ...

-Nate


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05528.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05529">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05529">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05515.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05514.html">configurable prefix for consistent hashing?</a></span> <span class="sender italic">Nate Lawson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05519.html">Re: configurable prefix for consistent hashing?</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05526.html">Re: configurable prefix for consistent hashing?</a></span> <span class="sender italic">Phil Stanhope</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05527.html">Re: configurable prefix for consistent hashing?</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05528.html">Re: configurable prefix for consistent hash...</a></span> <span class="sender italic">Nate Lawson</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: configurable prefix for consistent...</span> <span class="sender italic">Nate Lawson</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: configurable prefix for consistent hashing?">
<input type="hidden" name="msgid" value="745DAE6E-65AC-485C-B70A-88287CBE9393@root.org">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05529.html">
<input type="submit" value=" Nate Lawson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+configurable+prefix+for+consistent+hashing%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05528.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05515.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">745DAE6E-65AC-485C-B70A-88287CBE9393@root.org</li>
</ul>
</div>
</body>
</html>
