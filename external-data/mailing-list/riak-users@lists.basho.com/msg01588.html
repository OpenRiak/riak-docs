<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: java driver : lisKeys() returned also deleted keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01588" id="c">
<link rel="index" href="maillist.html#01588" id="i">
<link rel="prev" href="msg01587.html" id="p">
<link rel="next" href="msg01589.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01588.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+java+driver+%5C%3A+lisKeys%5C%28%5C%29+returned+also+deleted+keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: java driver : lisKeys() returned also deleted keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Brisbin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Brisbin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101120" rel="nofollow">Sat, 20 Nov 2010 20:04:03 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>FWIW- I've been working on Riak support for the spring-data project, which is 
Spring's NoSQL abstraction that will support a whole slew of NoSQL databases. 
I'm using it as the basis for the Grails Gorm support for Riak, which I'm also 
writing. It has support for getting and setting POJOs and whatnot using the 
Jackson JSON mapper. I've also included a fairly basic Map/Reduce abstraction.</pre><pre>

This uses the Spring 3.0 RestTemplate abstraction rather than relying on a 
specific driver. It also uses the built-in conversion support for reading and 
writing JSON data and other types supported by the Spring 3.0.5 conversion 
mechanism.

I see you're using the PB driver, so none of this might apply to your case 
(we've talked about a good way to support both the REST API and the PB API in 
the same codebase but haven't decided on the best way to do that, if at all). 
It seems to be pretty easy to use and with the built-in support for ETag 
caching, it does make a difference in app performance.

<a  rel="nofollow" href="https://github.com/SpringSource/spring-data-keyvalue">https://github.com/SpringSource/spring-data-keyvalue</a>


Thanks!

J. Brisbin
<a  rel="nofollow" href="http://jbrisbin.com/">http://jbrisbin.com/</a>


On Nov 20, 2010, at 2:28 PM, Andrea Campolonghi wrote:

&gt; Andy,
&gt; 
&gt; I am testing but the issue is that Riak really miss a valid java driver.
&gt; The one I am using is fine but has great issue of memory leaks ... sometimes 
&gt; driver hangs ( riak is not even getting the connection ).
&gt; 
&gt; I will restart my server test and try again ....
&gt; 
&gt; Andrea
&gt; 
&gt; 2010/11/20 Andrea Campolonghi &lt;acampolon...@gmail.com&gt;
&gt; Andy,
&gt; 
&gt; great to know.
&gt; So you know is there a way to get if this marker?
&gt; 
&gt; Andrea
&gt; 
&gt; 2010/11/20 Andy Gross &lt;a...@basho.com&gt;
&gt; 
&gt; 
&gt; Hi Andrea,
&gt; 
&gt; Key deletion in Riak doesn't occur immediately in Riak - keys are first 
&gt; marked with a tombstone marker and then reaped asynchronously.   If you 
&gt; insert a sleep between the delete() and keys() calls (try a few seconds) - 
&gt; does the test pass?
&gt; 
&gt; - Andy
&gt; 
&gt; 
&gt; On Sat, Nov 20, 2010 at 10:02 AM, Andrea Campolonghi &lt;acampolon...@gmail.com&gt; 
&gt; wrote:
&gt; I am having this issues with the java driver :
&gt; <a  rel="nofollow" href="https://github.com/krestenkrab/riak-java-pb-client">https://github.com/krestenkrab/riak-java-pb-client</a>
&gt; 
&gt; After deleting a key the listKeys method still return it.
&gt; The following test case put and delete one simple key and fails when counting 
&gt; the listKeys item.
&gt; 
&gt; Any Suggestion?
&gt; 
&gt; public class RiakCacheTest extends TestCase {
&gt; 
&gt; 
&gt; private RiakClient rc;
&gt; 
&gt; private String host = &quot;172.16.194.134&quot;;
&gt; 
&gt; private int port = 8087;
&gt; 
&gt; private String bucket = &quot;bucket&quot;;
&gt; 
&gt; 
&gt; 
&gt; @Override
&gt; 
&gt; protected void setUp() throws Exception {
&gt; 
&gt; rc = new RiakClient(this.host,this.port);
&gt; 
&gt; rc.setClientID(this.getClass().toString());
&gt; 
&gt; }
&gt; 
&gt; 
&gt; 
&gt; public void testRemove(){
&gt; 
&gt; String key = &quot;key&quot;;
&gt; 
&gt; String value = &quot;Andrea&quot;;
&gt; 
&gt; 
&gt; RiakObject obj = new RiakObject(this.bucket, key, value);
&gt; 
&gt; 
&gt; try{
&gt; 
&gt; this.rc.store(obj);
&gt; 
&gt; assertTrue(getValue(key).equals(value));
&gt; 
&gt; assertEquals(keys().size(),1);
&gt; 
&gt; 
&gt; this.rc.delete(this.bucket, key);
&gt; 
&gt; assertNull(getValue(key));
&gt; 
&gt; assertEquals(keys().size(),0);
&gt; 
&gt; 
&gt; }catch(IOException e){
&gt; 
&gt; e.printStackTrace();
&gt; 
&gt; }
&gt; 
&gt; 
&gt; }
&gt; 
&gt; 
&gt; private String getValue(String key){
&gt; 
&gt; String fetched = &quot;&quot;;
&gt; 
&gt; try{
&gt; 
&gt; RiakObject[] ros = this.rc.fetch(this.bucket, key);
&gt; 
&gt; for(RiakObject ro : ros){
&gt; 
&gt; return ro.getValue().toStringUtf8();
&gt; 
&gt; }
&gt; 
&gt; }catch(IOException e){
&gt; 
&gt; e.printStackTrace();
&gt; 
&gt; }
&gt; 
&gt; return null;
&gt; 
&gt; }
&gt; 
&gt; 
&gt; 
&gt; private List keys() {
&gt; 
&gt; ArrayList&lt;String&gt; result = new ArrayList&lt;String&gt;();
&gt; 
&gt; ByteString bucket = ByteString.copyFromUtf8(this.bucket);
&gt; 
&gt; 
&gt; try{
&gt; 
&gt; KeySource keys = this.rc.listKeys(bucket);
&gt; 
&gt; while(keys.hasNext()){
&gt; 
&gt; String key = keys.next().toStringUtf8();
&gt; 
&gt; result.add(key);
&gt; 
&gt; }       
&gt; 
&gt; }catch(IOException e){
&gt; 
&gt; e.printStackTrace();
&gt; 
&gt; }
&gt; 
&gt; return result;
&gt; 
&gt; }
&gt; 
&gt; 
&gt; 
&gt; }
&gt; 
&gt; 
&gt; -- 
&gt; Andrea Campolonghi
&gt; 
&gt; Cell : +39 347 2298435
&gt; acampolon...@gmail.com
&gt; and...@andreacfm.com
&gt; <a  rel="nofollow" href="http://www.andreacfm.com">http://www.andreacfm.com</a>
&gt; 
&gt; Railo Team
&gt; and...@getrailo.org
&gt; <a  rel="nofollow" href="http://getrailo.org">http://getrailo.org</a>
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Andrea Campolonghi
&gt; 
&gt; Cell : +39 347 2298435
&gt; acampolon...@gmail.com
&gt; and...@andreacfm.com
&gt; <a  rel="nofollow" href="http://www.andreacfm.com">http://www.andreacfm.com</a>
&gt; 
&gt; Railo Team
&gt; and...@getrailo.org
&gt; <a  rel="nofollow" href="http://getrailo.org">http://getrailo.org</a>
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Andrea Campolonghi
&gt; 
&gt; Cell : +39 347 2298435
&gt; acampolon...@gmail.com
&gt; and...@andreacfm.com
&gt; <a  rel="nofollow" href="http://www.andreacfm.com">http://www.andreacfm.com</a>
&gt; 
&gt; Railo Team
&gt; and...@getrailo.org
&gt; <a  rel="nofollow" href="http://getrailo.org">http://getrailo.org</a>
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>







</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01587.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01588">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01588">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01589.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01584.html">java driver : lisKeys() returned also deleted keys</a></span> <span class="sender italic">Andrea Campolonghi</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01585.html">Re: java driver : lisKeys() returned also deleted ...</a></span> <span class="sender italic">Andy Gross</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01586.html">Re: java driver : lisKeys() returned also dele...</a></span> <span class="sender italic">Andrea Campolonghi</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01587.html">Re: java driver : lisKeys() returned also ...</a></span> <span class="sender italic">Andrea Campolonghi</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: java driver : lisKeys() returned a...</span> <span class="sender italic">Jon Brisbin</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: java driver : lisKeys() returned also deleted keys">
<input type="hidden" name="msgid" value="50147D36-CE06-4763-B728-081656F23935@jbrisbin.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01588.html">
<input type="submit" value=" Jon Brisbin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+java+driver+%5C%3A+lisKeys%5C%28%5C%29+returned+also+deleted+keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01587.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01589.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">50147D36-CE06-4763-B728-081656F23935@jbrisbin.com</li>
</ul>
</div>
</body>
</html>
