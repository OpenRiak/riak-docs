<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riak-erlang segfault</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08955" id="c">
<link rel="index" href="maillist.html#08955" id="i">
<link rel="prev" href="msg08953.html" id="p">
<link rel="next" href="msg08816.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08955.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-erlang+segfault%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riak-erlang segfault</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Tomas+Charvat%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Tomas Charvat</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121017" rel="nofollow">Wed, 17 Oct 2012 14:28:31 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi jared, im not quite sure right now. I think it touch /proc due to file 
desriptor check. Since grsecutity prevent non root aps touching proc it cant 
run under riak user. Im sorry i cant provide more informations now. Problem is 
strictly related to kernels with grsecurity patch. There is also problem with 
mprotect  on beam.smp. It has to off. It can be done via paxctl -m 
/path/beam.smp</pre><pre>

cheers
tomad


Jared Morrow &lt;ja...@basho.com&gt; napsal(a):

&gt;Tomas,
&gt;
&gt;Maybe I'm not following, but what in Riak is trying to access files in
&gt;`/sys`?  Although we don't test on Gentoo, I'd like to enable you to
&gt;install it without having to modify your kernel settings.
&gt;
&gt;Thanks,
&gt;Jared
&gt;
&gt;On Tue, Oct 9, 2012 at 9:46 AM, Tomas Charvat &lt;t...@excello.cz&gt; wrote:
&gt;
&gt;&gt;  We have manage to fix mentioned segfault byt disabling sysfs
&gt;restriction
&gt;&gt; in hardened Gentoo kernel.
&gt;&gt; It has fixed segfault issues.
&gt;&gt; Sysfs/debugfs restriction
&gt;&gt;
&gt;&gt; *Configuration option: CONFIG_GRKERNSEC_SYSFS_RESTRICT*
&gt;&gt; If you say Y here, sysfs (the pseudo-filesystem mounted at /sys) and
&gt;any
&gt;&gt; filesystem normally mounted under it (e.g. debugfs) will only be
&gt;accessible
&gt;&gt; by root. These filesystems generally provide access to hardware and
&gt;debug
&gt;&gt; information that isn't appropriate for unprivileged users of the
&gt;system.
&gt;&gt; Sysfs and debugfs have also become a large source of new
&gt;vulnerabilities,
&gt;&gt; ranging from infoleaks to local compromise.
&gt;&gt;
&gt;&gt; There has been very little oversight with an eye toward security
&gt;involved
&gt;&gt; in adding new exporters of information to these filesystems, so their
&gt;use
&gt;&gt; is discouraged.
&gt;&gt;
&gt;&gt; This option is equivalent to a chmod 0700 of the mount paths.
&gt;&gt; cheers
&gt;&gt; Tomas
&gt;&gt;
&gt;&gt;
&gt;&gt; On 10/07/2012 08:50 PM, Evan Vigil-McClanahan wrote:
&gt;&gt;
&gt;&gt; The first thing that strikes me is that you have HIPE enabled on your
&gt;&gt; erlang, and the version isn't the one we build with.  This isn't
&gt;&gt; something riak is usually happy with.
&gt;&gt;
&gt;&gt; If you're doing 1.2, try rebuilding riak with R15B01 compiled with
&gt;&gt; --diable-hipe.
&gt;&gt;
&gt;&gt; The config file is usually called app.config, as well, but that might
&gt;&gt; have been a typo on your part.
&gt;&gt;
&gt;&gt; On Sun, Oct 7, 2012 at 3:28 AM, Tomas Charvat &lt;t...@excello.cz&gt;
&gt;&lt;t...@excello.cz&gt; wrote:
&gt;&gt;
&gt;&gt;  Hallo, I have fresh system and Im getting segfaults with
&gt;riak/erlang.
&gt;&gt; erl_crash.dump attached
&gt;&gt; Any tip what could be possible wrong ?
&gt;&gt; Bin /usr/lib64/riak/erts-5.9/bin/erlexec has same problem as
&gt;&gt; /usr/lib64/erlang/erts-5.9/bin/erlexec
&gt;&gt; Result is that riak cant find /etc/riak/app.conf
&gt;&gt; erl, erlc are working without any problem
&gt;&gt;
&gt;&gt; cheers
&gt;&gt; Tomas
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing
&gt;listriak-users@lists.basho.com<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08953.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08955">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08955">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08816.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08815.html">Re: riak-erlang segfault</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08841.html">Re: riak-erlang segfault</a></span> <span class="sender italic">Martin Woods</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08947.html">Re: riak-erlang segfault</a></span> <span class="sender italic">Martin Woods</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08952.html">Re: riak-erlang segfault</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg08844.html">Re: riak-erlang segfault</a></span> <span class="sender italic">Tomas Charvat</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08953.html">Re: riak-erlang segfault</a></span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: riak-erlang segfault</span> <span class="sender italic">Tomas Charvat</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riak-erlang segfault">
<input type="hidden" name="msgid" value="e60c770b-9175-4043-8cb4-70eda4a98db4@email.android.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08955.html">
<input type="submit" value=" Tomas Charvat ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-erlang+segfault%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08953.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08816.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">e60c770b-9175-4043-8cb4-70eda4a98db4@email.android.com</li>
</ul>
</div>
</body>
</html>
