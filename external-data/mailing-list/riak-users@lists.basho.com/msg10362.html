<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Delete keys still in Riak db</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10362" id="c">
<link rel="index" href="mail2.html#10362" id="i">
<link rel="prev" href="msg10361.html" id="p">
<link rel="next" href="msg10373.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10362.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Delete+keys+still+in+Riak+db%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Delete keys still in Riak db</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremy+Raymond%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremy Raymond</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130308" rel="nofollow">Fri, 08 Mar 2013 04:09:24 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I've see this behaviour as well. The only thing I've found to be reliable is to 
actually try to read the objects as you describe below and discard the keys if 
notfound in application logic. This obviously sucks if your trying to interact 
with the key index as a light weight way to count items. I've found I have to 
feed the keys to a mapreduce job that will count objects that actually exist to 
get accurate counts. Kinda sounds like a Bloom filter - false positives are 
possible but false negatives are not. So you if do find a key, you actually 
have to check yourself to see if the item actually exists. But if the key isn't 
found, then you know it's not there.</pre><pre>

--
Jeremy


On 2013-03-08, at 4:50 AM, Daniel Iwan &lt;iwan.dan...@gmail.com&gt; wrote:

&gt; Hi
&gt; 
&gt; What worries me though is:
&gt; 
&gt; 1) number of keys changes when i do listing, shouldn't that number be 
&gt; constant?
&gt; If I do:
&gt; <a  rel="nofollow" href="http://127.0.0.1:8098/buckets/TX/index/$key/0/zzz">http://127.0.0.1:8098/buckets/TX/index/$key/0/zzz</a>' | grep keys | awk 
&gt; '{split($0,a,/,/); for (i in a) print a[i]}' | wc -l
&gt; 
&gt; I'm getting 12, 15 or 20 keys randomly. I believe all of them has been deleted
&gt; 
&gt; 2) Very often when I do get query e.g
&gt; curl 
&gt; '<a  rel="nofollow" href="http://127.0.0.1:8098/riak/TX/eb602276-15c0-2756-ee54-d04b77230afd:af79a2e4-874a-11e2-ba5c-bb1a97c2eacb:1362676559911">http://127.0.0.1:8098/riak/TX/eb602276-15c0-2756-ee54-d04b77230afd:af79a2e4-874a-11e2-ba5c-bb1a97c2eacb:1362676559911</a>'
&gt; 
&gt; I will correctly get 'not found'
&gt; 
&gt; But subsequent list as above would still show that key as being in the bucket.
&gt; I believe most of the time key would disappear but very often they just seem 
&gt; to linger.
&gt; Is it possible that list somehow revives the keys?
&gt; 
&gt; D.
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre>
<p><strong><a href="msg10362/smime.p7s" ><img src="../attachment.png" alt="Attachment:" width=27 height=28></a>
<a href="msg10362/smime.p7s" >smime.p7s</a></strong><br>
<em>Description:</em> S/MIME cryptographic signature</p>
<pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10361.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10362">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#10362">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10373.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10353.html">Delete keys still in Riak db</a></span> <span class="sender italic">Daniel Iwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10355.html">Re: Delete keys still in Riak db</a></span> <span class="sender italic">John Daily</span></li>
<li class="icons-email"><span class="subject"><a href="msg10361.html">Re: Delete keys still in Riak db</a></span> <span class="sender italic">Daniel Iwan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Delete keys still in Riak db</span> <span class="sender italic">Jeremy Raymond</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10373.html">Re: Delete keys still in Riak db</a></span> <span class="sender italic">Daniel Iwan</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Delete keys still in Riak db">
<input type="hidden" name="msgid" value="897DDE58-D8A0-441F-B0EF-441928EDCEF9@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10362.html">
<input type="submit" value=" Jeremy Raymond ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Delete+keys+still+in+Riak+db%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10361.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10373.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">897DDE58-D8A0-441F-B0EF-441928EDCEF9@gmail.com</li>
</ul>
</div>
</body>
</html>
