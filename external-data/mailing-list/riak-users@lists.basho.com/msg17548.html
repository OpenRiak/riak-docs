<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: riak bitcask calculation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17548" id="c">
<link rel="index" href="maillist.html#17548" id="i">
<link rel="prev" href="msg17546.html" id="p">
<link rel="next" href="msg17547.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17548.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+riak+bitcask+calculation%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: riak bitcask calculation</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Travis+Kirstine%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Travis Kirstine</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160718" rel="nofollow">Mon, 18 Jul 2016 09:02:04 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Yes from the free command

[root@riak1 ~]# free -g
              total        used        free      shared  buff/cache   available
Mem:             45           9           0           0          36          35
Swap:            23           0          22</pre><pre>

Or from top

PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
24421 riak      20   0 16.391g 8.492g  41956 S  82.7 18.5  10542:10 beam.smp


I don't think that we are IO bound
dstat

----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw
  0   0  99   0   0   0| 150k  633k|   0     0 |   1B   25B| 702  2030
  0   5  95   0   0   0|   0     0 |  10k 2172B|   0     0 |1125   765
  2   6  92   0   0   0|   0     0 | 213k  135k|   0     0 |2817  7502
  2   5  92   0   0   0|   0     0 | 159k   88k|   0     0 |2758  9834
  2   5  93   0   0   0|   0  4884k| 278k   70k|   0     0 |2923  7453
  0   5  95   0   0   0|4096B   10M|  21k 1066B|   0     0 |3121   781
  4   7  89   0   0   0|   0    10M| 258k  160k|   0     0 |  13k   16k
  0   5  95   0   0   0|   0  4096B| 200k   65k|   0     0 |1413  1589
  1   5  92   1   0   0|   0    26k| 287k  206k|   0     0 |2124  4990
  1   4  95   0   0   0|   0  2048B|  67k   78k|   0     0 |1667  4504
  1   4  95   0   0   0|   0  1560k| 102k  105k|   0     0 |1639  4146
  3   8  88   1   0   0|   0    86M| 453k  335k|   0     0 |6097    16k
  4  14  81   0   0   0|   0    15k| 635k  564k|   0     0 |5383    14k
  0   4  96   0   0   0|   0     0 |  29k 1697B|   0     0 |1121   769
  4   7  89   0   0   0|   0     0 | 339k  376k|   0     0 |8017    15k
  5  16  79   0   0   0|   0    11M| 847k  824k|   0     0 |  13k   30k
  2  12  86   1   0   0|4096B   10M| 301k  272k|   0     0 |4639    11k
  3  10  87   0   0   0|   0    10M| 508k  610k|   0     0 |8260    17k
  2   9  87   2   0   0|   0    13k| 523k  354k|   0     0 |3432    10k
  0   4  96   0   0   0|   0     0 |3434B 1468B|   0     0 |1063   774





-----Original Message-----
From: Luke Bakken [<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>] 
Sent: July-18-16 11:14 AM
To: Travis Kirstine &lt;tkirst...@firstbasesolutions.com&gt;
Cc: riak-users@lists.basho.com; ac...@jdbarnes.com
Subject: Re: riak bitcask calculation

Hi Travis,

Could you go into detail about how you're coming up with 9GiB per node? Is this 
from the output of the &quot;free&quot; command?

Bitcask uses the operating system's buffers for file operations, and will 
happily use as much free ram as it can get to speed up operations. However, the 
OS will use that memory for other programs that need it should that need arise.

If you're using Linux, these settings may improve bitcask performance in your 
cluster:

<a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.1.4/using/performance/#optional-i-o-settings">http://docs.basho.com/riak/kv/2.1.4/using/performance/#optional-i-o-settings</a>

Benchmarking before and after making changes is the recommended way to proceed.

Thanks -

--
Luke Bakken
Engineer
lbak...@basho.com


On Fri, Jul 15, 2016 at 8:48 AM, Travis Kirstine 
&lt;tkirst...@firstbasesolutions.com&gt; wrote:
&gt; I've put ~74 million objects in my riak cluster with a bucket size of 
&gt; 9 bytes and keys size of 21 bytes.  According the riak capacity 
&gt; calculator this should require ~4 GiB of RAM per node.  Right now my 
&gt; servers are showing ~ 9 GiB used per node.  Is this caused by hashing 
&gt; or something else......
&gt;
&gt; # capacity calculator output
&gt;
&gt; To manage your estimated 73.9 million key/bucket pairs where bucket 
&gt; names are ~9 bytes, keys are ~21 bytes, values are ~36 bytes and you 
&gt; are setting aside 16.0 GiB of RAM per-node for in-memory data 
&gt; management within a cluster that is configured to maintain 3 replicas 
&gt; per key (N = 3) then Riak, using the Bitcask storage engine, will require at 
&gt; least:
&gt;
&gt; 5 nodes
&gt; 3.9 GiB of RAM per node (19.7 GiB total across all nodes)
&gt; 11.4 GiB of storage space per node (56.8 GiB total storage space used 
&gt; across all nodes)
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17546.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17548">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17548">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17547.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17542.html">riak bitcask calculation</a></span> <span class="sender italic">Travis Kirstine</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17546.html">Re: riak bitcask calculation</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: riak bitcask calculation</span> <span class="sender italic">Travis Kirstine</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17547.html">Re: riak bitcask calculation</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17549.html">RE: riak bitcask calculation</a></span> <span class="sender italic">Travis Kirstine</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17553.html">Re: riak bitcask calculation</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17554.html">RE: riak bitcask calculation</a></span> <span class="sender italic">Travis Kirstine</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: riak bitcask calculation">
<input type="hidden" name="msgid" value="248a80ef0a0245adafd34a49f541d4f2@MBX12B-IAD3.mex08.mlsrvr.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17548.html">
<input type="submit" value=" Travis Kirstine ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+riak+bitcask+calculation%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17546.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17547.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">248a80ef0a0245adafd34a49f541d4f2@MBX12B-IAD3.mex08.mlsrvr.com</li>
</ul>
</div>
</body>
</html>
