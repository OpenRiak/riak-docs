<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: is there easy way to transfer mongo collections to riak?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06715" id="c">
<link rel="index" href="maillist.html#06715" id="i">
<link rel="prev" href="msg06713.html" id="p">
<link rel="next" href="msg06721.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06715.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+is+there+easy+way+to+transfer+mongo+collections+to+riak%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: is there easy way to transfer mongo collections to riak?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+E.+Vincent%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John E. Vincent</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120223" rel="nofollow">Thu, 23 Feb 2012 12:42:52 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>2012/2/23 Will Moss &lt;wm...@bu.mp&gt;:
&gt; Hey Dominik,
&gt;
&gt; To answer the question in your subject line, no. To quote one of the guys I
&gt; work with, &quot;You're the bitch of data.&quot; That said, I'm extremely happy we did
&gt; it. Riak does what it says it's going to do when it says it will and doesn't
&gt; seem to really ever go down. I can't say the same for Mongo.
&gt;
&gt; We did this for some of the data we have in Mongo (and are planning to move
&gt; the rest in the near future) and it certainly wasn't painless. What we did
&gt; that worked reasonably well was:
&gt; 1. Change all our mongo query patterns so that we were effectively using it
&gt; a key-value store (i.e. no secondary indexes or other complex queries).
&gt; 2. Write code that read an existing record from Mongo and wrote it to Riak.
&gt; The actual schema stayed about the same, but we decided to go with protocol
&gt; buffers in Riak since they are much more efficient at representing data. We
&gt; mapped a single collection to a single bucket in Riak.
&gt; 3. Change all the queries to Riak instead of Mongo.
&gt; 4. Then, when we were ready to actually kick off the migration, we migrated
&gt; uses as the logged in. So, if they had not been migrated, we delayed their
&gt; login slightly while we copied the necessary data out of mongo and into
&gt; Riak.
&gt;
&gt;
&gt; Will</pre><pre>

What Will said is a nice practice in general for migrating between
data storage systems. My general recommendation is:

- Dark launch new code paths that concurrently writes data to both systems
- Optionally dark launch reads against the new subsystem as well but
only log for comparison reasons. No presentation changes.
- Validate data in new subsystem
- When you're happy that things are looking good, you come to a bit of a fork:

- migrate the user wholesale on login
or
- run in an incremental fashion on reading a subset of data (old user
messages are copied into Riak only when accessed).

The later requires a few more iterations and there's a probably a
slight performance hit from talking to multiple datastores. However
the alternative is to take a big maintenance window and risk a big
migration that may or may not work. By going incremental with dark
launches you make it mostly transparent to the user and can work out
any latent bugs.

I've done this personally at a few places. The last time was migrating
blobs from Voldemort into S3 over the period of a month using a
similar approach. We'll probably do something similar at the new gig
when we migrate into Riak from MySQL.

- John
<a  rel="nofollow" href="http://about.me/lusis">http://about.me/lusis</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06713.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06715">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06715">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06721.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06705.html">is there easy way to transfer mongo collections to riak?</a></span> <span class="sender italic">Dominik Magoń</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06713.html">Re: is there easy way to transfer mongo collections t...</a></span> <span class="sender italic">Will Moss</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: is there easy way to transfer mongo collectio...</span> <span class="sender italic">John E. Vincent</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: is there easy way to transfer mongo collections to riak?">
<input type="hidden" name="msgid" value="CAPy8of+b2H07L8Ud7p2UTRXvzQ2tRQVYMy5erRMUDqjhiS8TLw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06715.html">
<input type="submit" value=" John E. Vincent ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+is+there+easy+way+to+transfer+mongo+collections+to+riak%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06713.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06721.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAPy8of+b2H07L8Ud7p2UTRXvzQ2tRQVYMy5erRMUDqjhiS8TLw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
