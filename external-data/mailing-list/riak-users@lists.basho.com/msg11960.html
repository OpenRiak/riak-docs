<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Java client - conflict resolver on both fetch() and store()?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd12.html#11960" id="c">
<link rel="index" href="mail12.html#11960" id="i">
<link rel="prev" href="msg11957.html" id="p">
<link rel="next" href="msg11961.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11960.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+%5C-+conflict+resolver+on+both+fetch%5C%28%5C%29+and+store%5C%28%5C%29%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Java client - conflict resolver on both fetch() and store()?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matt+Painter%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matt Painter</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130811" rel="nofollow">Sun, 11 Aug 2013 01:44:49 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>PS. I presume the advantage of the mutator approach is that it reduces the
likelihood of sibling conflict resolution having to take place? Or, at
least the likelihood of unresolveable conflicts? Would my the resolver and
main POJO be the same using this approach?</pre><pre>

Currently in my POJO, I'm maintaining a Map containing references to things
that have changed (key being the operation, value being identifiers and
data appropriate to the key) and am using this in my resolver for things
which need unravelling.


On 11 August 2013 14:43, Matt Painter &lt;m...@deity.co.nz&gt; wrote:

&gt; Thanks Sean. I understand that the fetch-modify-write is the approach that
&gt; I'm *not* taking in this case, as I am using withoutFetch() and setting a
&gt; @RiakVClock in my POJO.
&gt;
&gt; I just need to weigh up whether the ideal way is sufficiently better to
&gt; rejig bits of my code - but I think that's a different issue :)
&gt;
&gt; M
&gt;
&gt;
&gt; On 11 August 2013 14:32, Sean Cribbs &lt;s...@basho.com&gt; wrote:
&gt;
&gt;&gt; I'm sure Roach will correct me if I'm off-base, but I believe the store
&gt;&gt; operation does a fetch and resolve before writing. I think the ideal way to
&gt;&gt; do that is to create a Mutation&lt;T&gt; (T being your POJO) as well, in which
&gt;&gt; case it's less of a &quot;store&quot; and more of a &quot;fetch-modify-write&quot;. The way to
&gt;&gt; skip the fetch/modify is to use the withoutFetch() option on the operation
&gt;&gt; builder.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sat, Aug 10, 2013 at 6:50 PM, Matt Painter &lt;m...@deity.co.nz&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I've just rolled up my sleeves and have started to make my application
&gt;&gt;&gt; more robust with conflict resolution.
&gt;&gt;&gt;
&gt;&gt;&gt; I am currently using a @RiakVClock in my POJO (I need to think more
&gt;&gt;&gt; about whether the read/modify/write approach is preferable or whether I'd
&gt;&gt;&gt; have to rearchitect things).
&gt;&gt;&gt;
&gt;&gt;&gt; I read in the Riak Handbook the recommendation that conflicts are best
&gt;&gt;&gt; resolved on read -  not write - however the example App.java snipping
&gt;&gt;&gt; on the Storing data in 
&gt;&gt;&gt; Riak&lt;<a  rel="nofollow" href="https://github.com/basho/riak-java-client/wiki/Storing-data-in-riak#appjava">https://github.com/basho/riak-java-client/wiki/Storing-data-in-riak#appjava</a>&gt;
&gt;&gt;&gt;  page
&gt;&gt;&gt; in the Java client's doco uses a resolver on both the store() and
&gt;&gt;&gt; fetch() operations.
&gt;&gt;&gt;
&gt;&gt;&gt; Indeed, if I don't specify my conflict resolver in my store(), things
&gt;&gt;&gt; blow up (in my unit test, mind - I'm still getting my head around the whole
&gt;&gt;&gt; area so my test may be a bit contrived).
&gt;&gt;&gt;
&gt;&gt;&gt; However when I use it in both places, my conflicts are being resolved
&gt;&gt;&gt; twice. Is this anticipated?
&gt;&gt;&gt;
&gt;&gt;&gt; My store is:
&gt;&gt;&gt;
&gt;&gt;&gt; bucket.store(record).returnBody(true).
&gt;&gt;&gt; withoutFetch().withResolver(myConflictResolver);
&gt;&gt;&gt; and my fetch is:
&gt;&gt;&gt;
&gt;&gt;&gt; bucket.fetch(id, Record.class).withResolver(myConflictResolver
&gt;&gt;&gt; ).execute();
&gt;&gt;&gt; The order of operations in my test is:
&gt;&gt;&gt;
&gt;&gt;&gt;    1. Store new record
&gt;&gt;&gt;    2. Fetch the record as firstRecord
&gt;&gt;&gt;    3. Fetch the record as secondRecord
&gt;&gt;&gt;    4. Modify a field on firstRecord and secondRecord
&gt;&gt;&gt;    5. Save firstRecord
&gt;&gt;&gt;    6. Save secondRecord - this invokes my resolver with two siblings
&gt;&gt;&gt;    7. Read record - this also invokes my resolver with the two siblings
&gt;&gt;&gt;
&gt;&gt;&gt; Am I missing something? Or is this what's supposed to happen? I'm not
&gt;&gt;&gt; too worried - the double-handling is hardly that intensive - but I'm keen
&gt;&gt;&gt; to get it right.
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks in advance,
&gt;&gt;&gt; Matt
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Matt Painter
&gt; m...@deity.co.nz
&gt; +64 21 115 9378
&gt;



-- 
Matt Painter
m...@deity.co.nz
+64 21 115 9378
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11957.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd12.html#11960">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail12.html#11960">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11961.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11955.html">Java client - conflict resolver on both fetch() and store()?</a></span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11956.html">Re: Java client - conflict resolver on both fetch() and ...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11957.html">Re: Java client - conflict resolver on both fetch() ...</a></span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Java client - conflict resolver on both fetc...</span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11961.html">Re: Java client - conflict resolver on both ...</a></span> <span class="sender italic">Matt Painter</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11962.html">Re: Java client - conflict resolver on both fetch() ...</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11963.html">Re: Java client - conflict resolver on both fetc...</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11964.html">Re: Java client - conflict resolver on both ...</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11965.html">Re: Java client - conflict resolver on ...</a></span> <span class="sender italic">Guido Medina</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11975.html">Re: Java client - conflict resolver on both ...</a></span> <span class="sender italic">Matt Painter</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11967.html">Re: Java client - conflict resolver on both fetch() and ...</a></span> <span class="sender italic">YN</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11968.html">Re: Java client - conflict resolver on both fetch() ...</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11970.html">Re: Java client - conflict resolver on both fetc...</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11972.html">Java client - without fetch and mutation?</a></span> <span class="sender italic">Guido Medina</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Java client - conflict resolver on both fetch() and store()?">
<input type="hidden" name="msgid" value="CAOe2jMLqAe4tmi1iRAbQDEBupcvBjbSiSBYrRQBpKSh8Muq1NA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11960.html">
<input type="submit" value=" Matt Painter ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+%5C-+conflict+resolver+on+both+fetch%5C%28%5C%29+and+store%5C%28%5C%29%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11957.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11961.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAOe2jMLqAe4tmi1iRAbQDEBupcvBjbSiSBYrRQBpKSh8Muq1NA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
