<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: SolrSpatial Problem</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16174" id="c">
<link rel="index" href="maillist.html#16174" id="i">
<link rel="prev" href="msg16171.html" id="p">
<link rel="next" href="msg16172.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16174.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+SolrSpatial+Problem%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: SolrSpatial Problem</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Dmitri+Zagidulin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dmitri Zagidulin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150602" rel="nofollow">Tue, 02 Jun 2015 08:27:34 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Sinh,

The other issue here, I suspect, is that the default Solr install does not
come with the jar files containing JtsSpatialContextFactory. You will need
to install them yourself. (Fwiw, there was an issue opened recently
requesting that this get included with Riak by default, here:
<a  rel="nofollow" href="https://github.com/basho/yokozuna/issues/495">https://github.com/basho/yokozuna/issues/495</a> ).</pre><pre>

As described in
<a  rel="nofollow" href="https://cwiki.apache.org/confluence/display/solr/Spatial+Search">https://cwiki.apache.org/confluence/display/solr/Spatial+Search</a> (in the
Schema configuration section, under spatialContextFactory),
you want to download the JTS Topo Suite (
<a  rel="nofollow" href="http://sourceforge.net/projects/jts-topo-suite/">http://sourceforge.net/projects/jts-topo-suite/</a> ). Then:

1) Locate the Riak /lib directory (depends on your OS). On Ubuntu, it's
/usr/lib/riak/lib/, on RedHat it's /usr/lib64/riak/, on Mac OS it depends
on how you installed it.

2) Locate the Solr / Yokozuna lib directory, under the riak lib directory.
So, for me, it's &lt;path to riak
lib&gt;/yokozuna-*/priv/solr/solr-webapp/webapp/WEB-INF/lib

You'll want to copy the .jar files from the /lib directory of the JTS Topo
Suite to that solr lib directory, (and likely stop and start riak, which
will restart Solr).

Dmitri


On Mon, Jun 1, 2015 at 1:47 PM, Drew Kerrigan &lt;d...@kerrigan.io&gt; wrote:

&gt; Hello Sinh
&gt;
&gt; Here is a working example of the setup for a &quot;find all records within X
&gt; miles of a lat,lon point&quot;:
&gt;
&gt; <a  rel="nofollow" href="https://gist.github.com/drewkerrigan/c7cabcbc46c10957248e">https://gist.github.com/drewkerrigan/c7cabcbc46c10957248e</a>
&gt;
&gt; Without digging too much into the exact problem you're encountering, I
&gt; think at a high level you should not be attempting to modify the default
&gt; schema (<a  rel="nofollow" href="http://localhost:8098/search/schema/_yz_default">http://localhost:8098/search/schema/_yz_default</a>)
&gt;
&gt; Any custom schemas should be named something other than _yz_default, like
&gt; &quot;my_geo_schema&quot;.
&gt;
&gt; Thanks,
&gt; Drew
&gt;
&gt;
&gt;
&gt; On Mon, Jun 1, 2015 at 3:37 PM sinh nguyen &lt;sin...@gmail.com&gt; wrote:
&gt;
&gt;&gt; My goal is trying to retrieve all locations within a boundary using Solr
&gt;&gt; function IsWithin(Polygon()). I am using 2.1.1 and follow this
&gt;&gt; documentation from solr
&gt;&gt; <a  rel="nofollow" href="https://wiki.apache.org/solr/SolrAdaptersForLuceneSpatial4">https://wiki.apache.org/solr/SolrAdaptersForLuceneSpatial4</a>.
&gt;&gt;
&gt;&gt; First, I downloaded schema from Basho git hub
&gt;&gt;
&gt;&gt; <a  rel="nofollow" href="https://raw.githubusercontent.com/basho/yokozuna/develop/priv/default_schema.xml">https://raw.githubusercontent.com/basho/yokozuna/develop/priv/default_schema.xml</a>
&gt;&gt;
&gt;&gt;
&gt;&gt; Then I added new fieldtype to schema.xml
&gt;&gt;
&gt;&gt; &lt;fieldType name=&quot;location_rpt&quot;   
&gt;&gt; class=&quot;solr.SpatialRecursivePrefixTreeFieldType&quot;
&gt;&gt;            
&gt;&gt; spatialContextFactory=&quot;com.spatial4j.core.context.jts.JtsSpatialContextFactory&quot;
&gt;&gt;                distErrPct=&quot;0.025&quot;
&gt;&gt;                maxDistErr=&quot;0.000009&quot;
&gt;&gt;                units=&quot;degrees&quot;
&gt;&gt;             /&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I added new field to schema.xml
&gt;&gt;
&gt;&gt; &lt;dynamicField name=&quot;*_geotest&quot;  type=&quot;location_rpt&quot;  indexed=&quot;true&quot; 
&gt;&gt; stored=&quot;true&quot;  multiValued=&quot;true&quot; /&gt;
&gt;&gt;
&gt;&gt; &lt;field name=&quot;myloc&quot;  type=&quot;location_rpt&quot;  indexed=&quot;true&quot; stored=&quot;true&quot;  
&gt;&gt; multiValued=&quot;true&quot; /&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I uploaded to server
&gt;&gt;
&gt;&gt; curl -i -XPUT <a  rel="nofollow" href="http://localhost:8098/search/schema/_yz_default">http://localhost:8098/search/schema/_yz_default</a> \
&gt;&gt;   -H 'content-type: application/xml' \
&gt;&gt;   --data-binary @schema.xml
&gt;&gt;
&gt;&gt;
&gt;&gt; I create new object
&gt;&gt;
&gt;&gt; curl -i -H 'content-type: application/json' -X PUT 
&gt;&gt; '<a  rel="nofollow" href="http://localhost:8098/types/geo_type/buckets/stuff/keys/sf">http://localhost:8098/types/geo_type/buckets/stuff/keys/sf</a>' -d 
&gt;&gt; '{&quot;name_tssd&quot;:&quot;San Francisco&quot;, 
&gt;&gt; &quot;loc_geotest&quot;:&quot;37.774929,-122.419416&quot;,&quot;myloc&quot;:&quot;37.774929,-122.419416&quot;}'
&gt;&gt;
&gt;&gt;
&gt;&gt; But Solr only indexes &quot;name_tssd&quot; and neither &quot;loc_geotest&quot; nor &quot;myloc&quot;
&gt;&gt; is indexed.
&gt;&gt;
&gt;&gt; Please help!
&gt;&gt;
&gt;&gt; PS: How do you remove custom schema.xml?
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16171.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16174">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16174">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16172.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16170.html">SolrSpatial Problem</a></span> <span class="sender italic">sinh nguyen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16171.html">Re: SolrSpatial Problem</a></span> <span class="sender italic">Drew Kerrigan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: SolrSpatial Problem</span> <span class="sender italic">Dmitri Zagidulin</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: SolrSpatial Problem">
<input type="hidden" name="msgid" value="CA+TO3kWdHChY6FYwmGdfvRdHzXZr0RfKOzG0w=v3oVkmrA86_A@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16174.html">
<input type="submit" value=" Dmitri Zagidulin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+SolrSpatial+Problem%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16171.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16172.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CA+TO3kWdHChY6FYwmGdfvRdHzXZr0RfKOzG0w=v3oVkmrA86_A@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
