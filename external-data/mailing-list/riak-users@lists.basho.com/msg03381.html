<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Recap for May 18 - 19</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03381" id="c">
<link rel="index" href="maillist.html#03381" id="i">
<link rel="prev" href="msg03374.html" id="p">
<link rel="next" href="msg03382.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03381.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Recap+for+May+18+%5C-+19%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Recap for May 18 - 19</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Anthony+Molinaro%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Anthony Molinaro</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110521" rel="nofollow">Sat, 21 May 2011 09:40:21 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>As I asked this question I thought I would pipe in with my experience (comments 
inline).</pre><pre>

On May 20, 2011, at 3:17 PM, Mark Phillips &lt;m...@basho.com&gt; wrote:

&gt; 4) Q --- Lets say I have several new nodes to add, is the recommended
&gt; procedure to add them one at a time and wait for all transfers to
&gt; finish, or can you actually add several?
&gt; 
&gt; A --- The current recommended procedure is to add one node at a time
&gt; and wait for the partition transfers to finish before proceeding to
&gt; the next node addition.

I found that adding them one at a time would have taken about 4 hours per node 
and as I was doubling the size I felt there would be less shuffling of data if 
I added all at once (as suggested by aphyr on IRC).  This proved to be exactly 
correct as I was able to add 4 new nodes in about 4 hours instead of 16.

&gt; Specifically:
&gt; 
&gt; * Use the &quot;riak-admin join&quot; command to kick off the cluster expansion
&gt; * Run &quot;riak-admin transfers&quot; periodically to keep an eye on the nodes
&gt; awaiting or passing off partitions (this may take a bit to complete);
&gt; an alternate (and less expensive) way to keep an eye on on this is to
&gt; just watch the logs.

Running &quot;riak-admin transfers&quot; hardly ever works I would say it times out 95% 
of the time when attempting to add a new node.  I don't know why this is and I 
hope it is fixed someday but I would recommend never running it.

Unfortunately grepping logs is also tricky as you have to deal with lots of 
false positives if you done something like I did where you had a bunch of nodes 
crash then brought them up, only to realize you need to add capacity, so you 
add nodes.  But now the logs on the first nodes have messages for transfers 
from the restart and the node addition.

&gt; * When &quot;riak-admin ringready&quot; prints &quot;TRUE ...&quot; to let you know that
&gt; all nodes agree on the ring state, you're good to go.

This actually returned true before transfers were complete IIRC so I think this 
may not quite be right.

&gt; (It's worth nothing that making this process smoother and more fluid
&gt; is high on our list of priorities.)

Good to know I look forward to this as I expect to be increasing my cluster up 
to close to 100 nodes by the end of this year.

 -Anthony



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03374.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03381">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03381">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03382.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03374.html">Riak Recap for May 18 - 19</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Recap for May 18 - 19</span> <span class="sender italic">Anthony Molinaro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03382.html">Re: Riak Recap for May 18 - 19</a></span> <span class="sender italic">Greg Nelson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03384.html">Re: Riak Recap for May 18 - 19</a></span> <span class="sender italic">Anthony Molinaro</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Recap for May 18 - 19">
<input type="hidden" name="msgid" value="6786E53D-D24F-4880-9436-0C965C94FE59@alumni.caltech.edu">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03381.html">
<input type="submit" value=" Anthony Molinaro ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Recap+for+May+18+%5C-+19%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03374.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03382.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">6786E53D-D24F-4880-9436-0C965C94FE59@alumni.caltech.edu</li>
</ul>
</div>
</body>
</html>
