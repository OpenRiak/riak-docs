<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Java map-reduce and result keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08535" id="c">
<link rel="index" href="maillist.html#08535" id="i">
<link rel="prev" href="msg08533.html" id="p">
<link rel="next" href="msg08544.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08535.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+map%5C-reduce+and+result+keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Java map-reduce and result keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Russell+Brown%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Russell Brown</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120914" rel="nofollow">Fri, 14 Sep 2012 06:46:48 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
On 14 Sep 2012, at 14:24, Deepak Balasubramanyam wrote:

&gt; Hi,
&gt; 
&gt; I've written a map reduce query on the riak java client like so...
&gt; 
&gt; client.mapReduce(BUCKET).addKeyFilter(keyFilter)
&gt;                     .addLinkPhase(BUCKET, &quot;_&quot;, false)
&gt;                     .addMapPhase(new NamedJSFunction(&quot;Riak.mapValuesJson&quot;), 
&gt; false)
&gt;                     .addReducePhase(phaseFunction).execute();
&gt; Collection&lt;MyType&gt; types = result.getResult(MyType.class);
&gt; 
&gt; This is the class definition for MyType
&gt; 
&gt; public class MyType
&gt; {
&gt;     @RiakKey
&gt;     private String myKey;
&gt;     private String property1;
&gt;     private String property2;
&gt; 
&gt;     /*  Getters / Setters go here */
&gt; }
&gt; 
&gt; When the object mapper deserializes the results into Collection&lt;MyType&gt;, none 
&gt; of the types have the myKey property populated in them. When I debugged the 
&gt; calls made by riak I realized that the result of the /mapred call does not 
&gt; contain any key information in the body. It only contains the value that each 
&gt; key represents. So that explains why the keys are null in the result.</pre><pre>

The Java client doesn't add the value of the @RiakKey field to the value stored 
in riak.

&gt; 
&gt; On the contrary, a link walk in riak returns the Location header for each 
&gt; multipart form entry in the response (Location: /riak/bucket/key). So I guess 
&gt; there is at least some way to tweak a client to parse the location to get the 
&gt; keys, but you lose out on the map-reduce goodness. 
&gt; 
&gt; Is there some way a map-reduce query can be formed to allow the resulting 
&gt; type's RiakKey to be populated ? What are my options ?

A custom Map function may do what you want. Get the Key from the Key Data 
passed to the Map function and add it to the JSON value returned. Jackson 
should then take care of de-serialising it into your values.

Cheers

Russell

&gt; 
&gt; Thanks
&gt; Deepak Bala
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08533.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08535">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08535">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08544.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08533.html">Java map-reduce and result keys</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Java map-reduce and result keys</span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08544.html">Re: Java map-reduce and result keys</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08557.html">Re: Java map-reduce and result keys</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08558.html">Re: Java map-reduce and result key...</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08581.html">Re: Java map-reduce and resul...</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Java map-reduce and result keys">
<input type="hidden" name="msgid" value="BE61FB6E-7D37-4B8C-B639-A689E298EB6C@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08535.html">
<input type="submit" value=" Russell Brown ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+map%5C-reduce+and+result+keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08533.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08544.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BE61FB6E-7D37-4B8C-B639-A689E298EB6C@me.com</li>
</ul>
</div>
</body>
</html>
