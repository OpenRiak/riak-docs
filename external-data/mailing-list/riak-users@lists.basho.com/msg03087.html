<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: This sure looks like a bug...?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03087" id="c">
<link rel="index" href="maillist.html#03087" id="i">
<link rel="prev" href="msg03084.html" id="p">
<link rel="next" href="msg03088.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03087.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+This+sure+looks+like+a+bug...%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: This sure looks like a bug...?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ben+Tilly%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ben Tilly</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110418" rel="nofollow">Mon, 18 Apr 2011 19:46:42 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I'm not missing the point you think I am.  Riak already has the
ability to store more than one value for a key/value pair.  I'd like
an option - possibly named something new, that used this to store a
limited amount of history so that clients could be presented with a
common ancestor when that was required.</pre><pre>

In the case that I gave you, if the common ancestor is:

  {
    &quot;name&quot;: &quot;Jane Doe&quot;,
    &quot;occupation&quot;: &quot;secretary&quot;
  }

then a standard three-way merge would say that she got married and the
correct result should be:

  {
    &quot;name&quot;: &quot;Jane Blow&quot;,
    &quot;husband&quot;: &quot;Joe Blow&quot;,
    &quot;occupation&quot;: &quot;n/a&quot;
  }

while if the common ancestor is:

  {
    &quot;name&quot;: &quot;Jane Blow&quot;,
    &quot;husband&quot;: &quot;Joe Blow&quot;,
    &quot;occupation&quot;: &quot;n/a&quot;
  }

then a standard 3-way merge would say that she dumped the jerk and got
a job resulting in:

  {
    &quot;name&quot;: &quot;Jane Doe&quot;,
    &quot;occupation&quot;: &quot;secretary&quot;
  }

Without the common ancestor you know what changed, but not which
direction the changes are going, and so have no sane way to resolve
the conflict.

Given the non-atomic nature of reads and writes in Riak, it is likely
that neither of the two clients that wrote that data was in any way
aware of the existence of the other write.  This makes your suggestion
of escalating to the user impossible.  And there is no particular
reason to believe that the third user to come along will necessarily
know anything either.

(Besides, I spent enough years maintaining batch systems to be wary of
escalating to users at the drop of a hat.  The &quot;user&quot; may well be a
complete moron on autopilot.)

On Mon, Apr 18, 2011 at 7:01 PM, Sean Cribbs &lt;s...@basho.com&gt; wrote:
&gt; I think you're missing a key point here, and that is that the vector clock 
&gt; doesn't store copies of the *values*, only the individual &quot;touches&quot; of 
&gt; identified clients. I'm not sure what computing the common ancestor is going 
&gt; to give you if you don't have the value.  Vector clocks are essentially 
&gt; opaque to clients.
&gt;
&gt; That said, I think the use-case you gave is one that can clearly bubble up to 
&gt; the user, e.g. &quot;Someone else changed this record while you were editing it. 
&gt; Can you resolve the differences?&quot; (Give the other person's name perhaps, 
&gt; highlight the fields that are different.)
&gt;
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;
&gt; On Apr 18, 2011, at 9:12 PM, Ben Tilly wrote:
&gt;
&gt;&gt; Riak's small_vclock, big_vclock, young_vclock, and old_vclock
&gt;&gt; parameters already give control over pruning behavior.  If there isn't
&gt;&gt; enough history to compute a common ancestor, then return nothing for
&gt;&gt; the common ancestor.
&gt;&gt;
&gt;&gt; The use case here really isn't an SCM.  The use case is when two
&gt;&gt; clients get simultaneous (within, say, 50 ms) requests to write to the
&gt;&gt; same object.  When a third one tries to read the data 5s later, it
&gt;&gt; would be nice to have a way to figure out what to do.  For this use
&gt;&gt; case you can limit the amount of history quite severely without loss.
&gt;&gt;
&gt;&gt; Let's take a practical example of conflicting data structures:
&gt;&gt;
&gt;&gt;  {
&gt;&gt;    &quot;name&quot;: &quot;Jane Doe&quot;,
&gt;&gt;    &quot;occupation&quot;: &quot;n/a&quot;
&gt;&gt;  },
&gt;&gt;  {
&gt;&gt;    &quot;name&quot;: &quot;Jane Blow&quot;,
&gt;&gt;    &quot;husband&quot;: &quot;Joe Blow&quot;,
&gt;&gt;    &quot;occupation&quot;: &quot;secretary&quot;
&gt;&gt;  }
&gt;&gt;
&gt;&gt; What should it be resolved to?  Perhaps Jane just got divorced and
&gt;&gt; went to work as a secretary.  Or she could have gotten married and
&gt;&gt; left her job.  If you give me the common ancestor I can tell which
&gt;&gt; scenario to believe.  Without it I can only guess badly.  I don't want
&gt;&gt; to keep a history here.  I want to resolve the discrepancy the next
&gt;&gt; time I see it (and log it somewhere important if I can't resolve it).
&gt;&gt;
&gt;&gt; On Mon, Apr 18, 2011 at 5:38 PM, Sean Cribbs &lt;s...@basho.com&gt; wrote:
&gt;&gt;&gt; Yes, but vector clocks are for resolution of race-conditions and network 
&gt;&gt;&gt; partitions, not to provide an SCM history.  Imagine how much space would be 
&gt;&gt;&gt; consumed by the history long enough to disambiguate an object that has been 
&gt;&gt;&gt; updated normally 1000 times, followed by one bad client that decides write 
&gt;&gt;&gt; to it without fetching the vector clock first.
&gt;&gt;&gt;
&gt;&gt;&gt; Coda Hale put it well in his talk at the recent Riak Meetup: your data 
&gt;&gt;&gt; needs to be logically monotonic so that writes (and reads) can be retried 
&gt;&gt;&gt; until resolution is reached.
&gt;&gt;&gt;
&gt;&gt;&gt; Also, we've found that assigning the client id to something that is 
&gt;&gt;&gt; relevant to your domain, e.g. real people, will help reduce surprises (and 
&gt;&gt;&gt; degenerate cases like sibling explosion) when it comes to vector-clock 
&gt;&gt;&gt; resolution.
&gt;&gt;&gt;
&gt;&gt;&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;&gt;&gt;
&gt;&gt;&gt; On Apr 18, 2011, at 8:15 PM, Aphyr wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I actually had a question about that page.  Why is it that when there
&gt;&gt;&gt;&gt;&gt; is a conflict we can only get the conflicting versions of the data?
&gt;&gt;&gt;&gt;&gt; If I'm going to try to resolve the conflict intelligently, I really
&gt;&gt;&gt;&gt;&gt; want the common ancestor as well so that I can try to do a 3-way
&gt;&gt;&gt;&gt;&gt; merge.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Good call. If an ancestor were available it would make counting and 
&gt;&gt;&gt;&gt; merging orthogonal changes *much* simpler.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03084.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03087">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03087">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03088.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03076.html">This sure looks like a bug...?</a></span> <span class="sender italic">Bryan O'Sullivan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03077.html">Re: This sure looks like a bug...?</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03078.html">Re: This sure looks like a bug...?</a></span> <span class="sender italic">Bryan O'Sullivan</span></li>
<li class="icons-email"><span class="subject"><a href="msg03079.html">Re: This sure looks like a bug...?</a></span> <span class="sender italic">Ben Tilly</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03080.html">Re: This sure looks like a bug...?</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03081.html">Re: This sure looks like a bug...?</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03083.html">Re: This sure looks like a bug...?</a></span> <span class="sender italic">Ben Tilly</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03084.html">Re: This sure looks like a bug....</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: This sure looks like a ...</span> <span class="sender italic">Ben Tilly</span></li>
<li class="icons-email"><span class="subject"><a href="msg03088.html">Re: This sure looks like a ...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg03089.html">Re: This sure looks like a ...</a></span> <span class="sender italic">Eric Moritz</span></li>
<li class="icons-email"><span class="subject"><a href="msg03092.html">Re: This sure looks like a ...</a></span> <span class="sender italic">Ben Tilly</span></li>
<li class="icons-email"><span class="subject"><a href="msg03091.html">Re: This sure looks like a ...</a></span> <span class="sender italic">Woody Peterson</span></li>
<li class="icons-email"><span class="subject"><a href="msg03093.html">Re: This sure looks like a ...</a></span> <span class="sender italic">Ben Tilly</span></li>
<li class="icons-email"><span class="subject"><a href="msg03095.html">Re: This sure looks like a ...</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: This sure looks like a bug...?">
<input type="hidden" name="msgid" value="BANLkTi=Grh5huwgWiTMKxBAa_TSmfeczww@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03087.html">
<input type="submit" value=" Ben Tilly ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+This+sure+looks+like+a+bug...%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03084.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03088.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BANLkTi=Grh5huwgWiTMKxBAa_TSmfeczww@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
