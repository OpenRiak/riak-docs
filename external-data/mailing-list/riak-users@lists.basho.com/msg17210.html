<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Solr error message</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17210" id="c">
<link rel="index" href="maillist.html#17210" id="i">
<link rel="prev" href="msg17209.html" id="p">
<link rel="next" href="msg17211.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17210.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Solr+error+message%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Solr error message</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jim+Raney%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jim Raney</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160411" rel="nofollow">Mon, 11 Apr 2016 18:22:38 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>

On Apr 11, 2016, at 3:35 PM, Fred Dushin 
&lt;fdus...@basho.com&lt;<a  rel="nofollow" href="mailto:fdus...@basho.com">mailto:fdus...@basho.com</a>&gt;&gt; wrote:</pre><pre>

Hi Jim,

Interesting problem.

That error is occurring here:

<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.2/src/yz_cover.erl#L275">https://github.com/basho/yokozuna/blob/2.1.2/src/yz_cover.erl#L275</a>

because length(Mapping) and length(UniqNodes) are unequal:

<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.2/src/yz_cover.erl#L262">https://github.com/basho/yokozuna/blob/2.1.2/src/yz_cover.erl#L262</a>

This might be because you are getting timeouts trying to query the port on 
remote nodes:

<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.2/src/yz_solr.erl#L324">https://github.com/basho/yokozuna/blob/2.1.2/src/yz_solr.erl#L324</a>

As you can see, there is a hard-wired 1-second timeout on that RPC call, which 
could account for why you are seeing this failure into a load run.

You might try to rebuild a version of this module with an increased timeout, to 
see if that gets you over the hump, or consider making a configurable timeout.

Riak 2.1.3 ships with yokozuna 2.1.2, who's GIT SHA 
3520d11ec21ee08b7c18478fbbe1b61d7e3d8e0f, so you'd want to branch off that 
point of the tree, if you care to experiment.

If you rebuild the module, you can place the generated beam file in the 
lib/basho-patches directory of each of your riak installs, and restart Riak (or 
manually re-load the module on each node via the Riak console, if you need to 
keep your riak nodes up and running)

Let us know what you find or if you need more assistance.

-Fred

On Apr 11, 2016, at 4:11 PM, Jim Raney 
&lt;jim.ra...@physiq.com&lt;<a  rel="nofollow" href="mailto:jim.ra...@physiq.com">mailto:jim.ra...@physiq.com</a>&gt;&gt; wrote:

Failed to determine Solr port for all nodes in search plan

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

Fred,

Thanks for the quick response.  After you basically verified that it was a a 
solr timeout issue I rebuilt the cluster with 14 nodes to see what would 
happen.  The amount of time it took for the query fails (and associated log 
entries) basically doubled as well.

I -could- try increasing the hard coded timeout but I don't think that's the 
route we want to go as it is likely this system will have that much data or 
more being pushed into and long query times won't work.  I imagine there is 
probably some solr tuning we can do - any ideas on what we could look at that 
we could pass through the riak config?

I'm going to try an Oracle 1.8 JDK with it later and see if any GC tuning helps 
in case there are long GC pauses.

--
Jim Raney
jim.ra...@physiq.com&lt;<a  rel="nofollow" href="mailto:jim.ra...@physiq.com">mailto:jim.ra...@physiq.com</a>&gt;

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17209.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17210">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17210">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17211.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17208.html">Solr error message</a></span> <span class="sender italic">Jim Raney</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17209.html">Re: Solr error message</a></span> <span class="sender italic">Fred Dushin</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Solr error message</span> <span class="sender italic">Jim Raney</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Solr error message">
<input type="hidden" name="msgid" value="782E6887-E679-4756-96A0-67812344C497@physiq.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17210.html">
<input type="submit" value=" Jim Raney ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Solr+error+message%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17209.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17211.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">782E6887-E679-4756-96A0-67812344C497@physiq.com</li>
</ul>
</div>
</body>
</html>
