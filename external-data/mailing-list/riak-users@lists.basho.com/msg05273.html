<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: Join a Riak-1.0 node to a Riak-0.14 cluster</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05273" id="c">
<link rel="index" href="maillist.html#05273" id="i">
<link rel="prev" href="msg05133.html" id="p">
<link rel="next" href="msg05275.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05273.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Join+a+Riak%5C-1.0+node+to+a+Riak%5C-0.14+cluster%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: Join a Riak-1.0 node to a Riak-0.14 cluster</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Tomer+Naor%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Tomer Naor</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111024" rel="nofollow">Mon, 24 Oct 2011 10:09:31 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Well, it caused us some problems...

The situation is as follows:
we have a production cluster with five 0.14 nodes and which we want to replace 
with three new Riak 1.0.1 servers.</pre><pre>

This is what we did:

1.       join each of the 1.0 nodes to the 0.14 cluster.

2.       after that all the three 1.0 nodes were part of the ring members and 
handoff was over we did 'admin-riak leave' on one of the 0.14 nodes (eventually 
we'll need to leave them all).

The problem is that it looks like not all the data from the 0.14 node were 
handoff in the leaving process and it seems like we've lost some data.
(Don't know if it's matter but the bitcask of the 0.14 node that we tried to 
'riak-admin leave' was reduced from 120GB to 55GB)

Another problem that we noticed is that the basic get api not always returned a 
consistent response, it sometimes returned the required data and sometimes 
returned 404 status code.

what is the best/right/safe way to do it without losing data and without 
experience significant downtime as a result of the join and leave process.

Thanks,
Tomer.

From: Sean Cribbs [<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>]
Sent: Wednesday, October 12, 2011 14:37
To: Tomer Naor
Cc: riak-users@lists.basho.com
Subject: Re: Join a Riak-1.0 node to a Riak-0.14 cluster

It is possible but requires a slight modification from the directions in 
<a  rel="nofollow" href="http://wiki.basho.com/Rolling-Upgrades.html">http://wiki.basho.com/Rolling-Upgrades.html</a>.  When adding the new 1.0 node, 
make sure these settings are in the 'riak_kv' section of its app.config:




{legacy_keylisting, true},

{mapred_system, legacy},

{vnode_vclocks, false}
This will ensure that it does not try to use functionality that is unavailable 
on the 0.14.2 nodes.

On Wed, Oct 12, 2011 at 6:30 AM, Tomer Naor 
&lt;to...@conduit.com&lt;<a  rel="nofollow" href="mailto:to...@conduit.com">mailto:to...@conduit.com</a>&gt;&gt; wrote:
Hi,

Is it possible to join a Riak-1.0 node (not from rolling upgrade - new server 
with fresh 1.0.0 installation) to a cluster with Riak-0.14 nodes without any 
unexpected problems?

Thanks,
Tomer.

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



--
Sean Cribbs &lt;s...@basho.com&lt;<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>&gt;&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://www.basho.com/">http://www.basho.com/</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05133.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05273">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05273">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05275.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05132.html">Join a Riak-1.0 node to a Riak-0.14 cluster</a></span> <span class="sender italic">Tomer Naor</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05133.html">Re: Join a Riak-1.0 node to a Riak-0.14 cluster</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: Join a Riak-1.0 node to a Riak-0.14 cluster</span> <span class="sender italic">Tomer Naor</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05275.html">Re: Join a Riak-1.0 node to a Riak-0.14 clus...</a></span> <span class="sender italic">Mark Smith</span></li>
<li class="icons-email"><span class="subject"><a href="msg05281.html">Re: Join a Riak-1.0 node to a Riak-0.14 clus...</a></span> <span class="sender italic">Joseph Blomstedt</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05293.html">RE: Join a Riak-1.0 node to a Riak-0.14 ...</a></span> <span class="sender italic">Tomer Naor</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: Join a Riak-1.0 node to a Riak-0.14 cluster">
<input type="hidden" name="msgid" value="6AB151AD074C18409E0CA3CD8D43123063CF825E71@EXVMBX017-12.exch017.msoutlookonline.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05273.html">
<input type="submit" value=" Tomer Naor ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Join+a+Riak%5C-1.0+node+to+a+Riak%5C-0.14+cluster%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05133.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05275.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">6AB151AD074C18409E0CA3CD8D43123063CF825E71@EXVMBX017-12.exch017.msoutlookonline.net</li>
</ul>
</div>
</body>
</html>
