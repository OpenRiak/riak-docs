<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Evolving data model</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08603" id="c">
<link rel="index" href="maillist.html#08603" id="i">
<link rel="prev" href="msg08602.html" id="p">
<link rel="next" href="msg08597.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08603.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Evolving+data+model%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Evolving data model</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Allen+Johnson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Allen Johnson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120919" rel="nofollow">Wed, 19 Sep 2012 16:17:07 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Thanks for all the responses.

Originally I was leaning toward the batch transformation approach thinking
that this would help keep map-reduce jobs as simple as possible since they
wouldn't have to concern themselves with multiple versions of documents.
 Perhaps I'm just so used to schema migrations in RDBMS that this is just
how I think.  The lazy object upgrading technique is appealing.  I have a
small project coming up where I can test that out to see how it goes.</pre><pre>

Thanks again.

On Wed, Sep 19, 2012 at 6:52 PM, Todd Cullen &lt;t...@thoughtleadr.com&gt; wrote:

&gt; ThoughtLeadr uses Bip's approach. Its essential lazy schema migration.
&gt;
&gt;
&gt; On Wed, Sep 19, 2012 at 3:03 PM, Reid Draper &lt;reiddra...@gmail.com&gt; wrote:
&gt;
&gt;&gt; I have also used Bip's method and found it successful. You do need to be
&gt;&gt; careful to make sure
&gt;&gt; all reads of your data go through this upgrade-path, but that is easy
&gt;&gt; once you realize it :).
&gt;&gt;
&gt;&gt;
&gt;&gt; Reid
&gt;&gt;
&gt;&gt; On Sep 19, 2012, at 5:44 PM, Bip Thelin &lt;b...@kivra.com&gt; wrote:
&gt;&gt;
&gt;&gt; We use a technique that works well for our use case:
&gt;&gt; We store everything as JSON and use the erlang-client, for every object
&gt;&gt; we store we add an opaque schema_version tag to the JSON and then in our
&gt;&gt; model encode/decode routine we parse this schema_version and if the version
&gt;&gt; is not the latest according to the model we recurse and upgrade the payload
&gt;&gt; all the way up to the current version and then return the new object to the
&gt;&gt; client and spawn an async process that saves the new object back.
&gt;&gt;
&gt;&gt; So for instance an object is at schema_version 1 when it get's read. The
&gt;&gt; model is now on version 5 there will be five functions, i.e:
&gt;&gt; upgrade_version(2, Payload) -&gt;
&gt;&gt;     do_something();
&gt;&gt; upgrade_version(3, Payload) -&gt;
&gt;&gt;     etc...
&gt;&gt;
&gt;&gt; every function knows how to upgrade itself from it's former version so
&gt;&gt; fast forwarding through version is easy and every object will get upgraded
&gt;&gt; eventually (if the get read).
&gt;&gt;
&gt;&gt; --
&gt;&gt; Bip Thelin
&gt;&gt;
&gt;&gt; KIVRA | Lugnets All√© 1 | 120 33 Stockholm
&gt;&gt; Tel 08-533 335 37 | Mob 0735-18 18 90
&gt;&gt; www.kivra.com
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On 19 sep 2012, at 00:55, Allen Johnson &lt;akjohnso...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt; Hey everyone,
&gt;&gt;
&gt;&gt; I'm beginning to experiment with Riak and I'm trying to better
&gt;&gt; understand how to model my data.  One question I have at the moment is
&gt;&gt; how to evolve my data with a data store such as Riak?  I know that
&gt;&gt; it's schema-less and that I can add new fields as needed but I'm
&gt;&gt; thinking more about the existing documents.
&gt;&gt;
&gt;&gt; For example, say hypothetically, that I have a fairly successful
&gt;&gt; riak-based app.  As the application code continues to evolve over
&gt;&gt; several versions I begin to find a &quot;better&quot; way to model my data.  By
&gt;&gt; this time I have already stored many, many documents.  What is the
&gt;&gt; appropriate path here?  Do I version my documents with metadata and
&gt;&gt; rely on my application code to continue to deal with old-style
&gt;&gt; documents -- or do I perform some sort of bulk transformation on these
&gt;&gt; existing documents?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Allen
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Cheers,
&gt;
&gt; Todd Cullen | Founder &amp; CEO of ThoughtLeadr
&gt; 177 Post Street, #550 SF 94108
&gt; e. t...@thoughtleadr.com p. 415-254-0787
&gt; twitter: @shakakai &lt;<a  rel="nofollow" href="http://www.twitter.com/shakakai">http://www.twitter.com/shakakai</a>&gt; skype: todd.cullen
&gt;
&gt;   Fast Company covers 
&gt; ThoughtLeadr&lt;<a  rel="nofollow" href="http://www.fastcocreate.com/1680828/imgur-blurs-line-between-memes-and-ads-with-lipton-briskscumbag-steve-hybrid">http://www.fastcocreate.com/1680828/imgur-blurs-line-between-memes-and-ads-with-lipton-briskscumbag-steve-hybrid</a>&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08602.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08603">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08603">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08597.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08589.html">Evolving data model</a></span> <span class="sender italic">Allen Johnson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08595.html">Re: Evolving data model</a></span> <span class="sender italic">Pinney Colton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08596.html">Re: Evolving data model</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08598.html">Re: Evolving data model</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08599.html">Re: Evolving data model</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg08600.html">Re: Evolving data model</a></span> <span class="sender italic">Bip Thelin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08601.html">Re: Evolving data model</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08602.html">Re: Evolving data model</a></span> <span class="sender italic">Todd Cullen</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Evolving data model</span> <span class="sender italic">Allen Johnson</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Evolving data model">
<input type="hidden" name="msgid" value="CA+tSA0Crsze=KAPxz7BaD6maWJA6mDF48PsxDo2TbDrQ+4jEoA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08603.html">
<input type="submit" value=" Allen Johnson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Evolving+data+model%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08602.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08597.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CA+tSA0Crsze=KAPxz7BaD6maWJA6mDF48PsxDo2TbDrQ+4jEoA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
