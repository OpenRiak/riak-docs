<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Storing large collections in Riak (or any distributed store)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02248" id="c">
<link rel="index" href="maillist.html#02248" id="i">
<link rel="prev" href="msg02247.html" id="p">
<link rel="next" href="msg02249.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02248.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Storing+large+collections+in+Riak+%5C%28or+any+distributed+store%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Storing large collections in Riak (or any distributed store)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110209" rel="nofollow">Wed, 09 Feb 2011 10:09:15 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>The only way this is functional is if you implement a uniformly random
hash function so that you know which key any given address will hash
to. Separately, churn will eat you up if you constantly need to take
addys out of your keys. Also, as mentioned elsewhere, Riak links won't
work at these numbers.</pre><pre>

Check out more tech slides/blogs on how twitter does this. Basically
double/reverse/reciprocal look up lists with recipient notification.
When @aplusk tweets twitter does like 4million (or however many
followers he has) writes. I recommend @rk's qcon sf 2010 talk on nosql
at twitter.

Best, alexander

On 2011-02-09, Scott Lystig Fritchie &lt;fritc...@snookles.com&gt; wrote:
&gt; Nathan Sobo &lt;ns...@pivotallabs.com&gt; wrote:
&gt;
&gt; ns&gt; Is a key-value store actually inappropriate for this problem?
&gt;
&gt; No.  One way to do it is to use a single KV key to store multiple
&gt; addresses worth of info.  Pick a relatively big number, 50K
&gt; subscribers/key, though it may vary.  Use a key naming scheme so that
&gt; you can pre-calculate all keys for a given list, e.g. bucket =
&gt; list-subscribers, key = name + range index #, or perhaps list name
&gt; + start-of-hash-range + end-of-hash-range.
&gt;
&gt; How do you know the range index # or start &amp; ends of range?  One method
&gt; would be hashing, MD5 or SHA1 or whatever.  If you store all addresses
&gt; for a list with a fixed number of hash hunks, e.g. 100, then each hash
&gt; hunk will have roughly 20K entries for a 2M subscriber list.  To find
&gt; all subscribers, fetch 100 known keys.
&gt;
&gt; If you want to keep addresses in sorted order, it's more work but also
&gt; doable.  A naive plan is to make your hash function F(addr) = first
&gt; letter of 'addr'.  Keys get clumpy that way, but only slightly more
&gt; creativity can get around it.
&gt;
&gt; To find a particular subscriber, hash that subscriber's address and
&gt; fetch 1 key.  You're also getting a lot of uninteresting data with that
&gt; key's value, but if event is uncommon, it's not a problem.  (If that
&gt; event actually is common, consider moving the commonly-queried data
&gt; elsewhere.  Or duplicate that info in another smaller key somewhere
&gt; else.)  Similar logic for list maintenance events (add subscriber,
&gt; delete subscriber).
&gt;
&gt; -Scott
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

-- 
Sent from my mobile device

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02247.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02248">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02248">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02249.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg02237.html">Storing large collections in Riak (or any distribute...</a></span> <span class="sender italic">Nathan Sobo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02242.html">Re: Storing large collections in Riak (or any d...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg02247.html">Re: Storing large collections in Riak (or any d...</a></span> <span class="sender italic">Scott Lystig Fritchie</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Storing large collections in Riak (or a...</span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02249.html">Re: Storing large collections in Riak (...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02250.html">Re: Storing large collections in Ri...</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Storing large collections in Riak (or any distributed store)">
<input type="hidden" name="msgid" value="AANLkTikd08zBmLZJRRLzGOcbUGnKsSdknLfo7NGAoZ0w@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02248.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Storing+large+collections+in+Riak+%5C%28or+any+distributed+store%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02247.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02249.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTikd08zBmLZJRRLzGOcbUGnKsSdknLfo7NGAoZ0w@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
