<!DOCTYPE html>
<html lang="en">
<head>
<title>mysterious Riak problems</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09242" id="c">
<link rel="index" href="maillist.html#09242" id="i">
<link rel="prev" href="msg09227.html" id="p">
<link rel="next" href="msg09244.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09242.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22mysterious+Riak+problems%22&amp;o=newest" rel="nofollow"><span itemprop="name">mysterious Riak problems</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22David+Lowell%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">David Lowell</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121107" rel="nofollow">Wed, 07 Nov 2012 11:34:33 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello Riak Folks,

The last three days, we've been having a string of problems with Riak. An 
otherwise healthy server running our full application stack will suddenly start 
throwing a bunch of errors in the logs. Although the Riak processes stay up, 
most or all requests to Riak fail during these periods.</pre><pre>

The errors in the logs are predominantly describing &quot;riak_kv_vnode worker pool 
crashed&quot; and timeout conditions. This morning, we had this crashy behavior 
start immediately after a clean Riak startup, and making a single call to our 
API, so the logs are quite free of other noise. I've summarized those logs 
below for curious parties, and can attach the full set of logs if needed.

I forgot to check this morning, but during a similar outage on Monday, the Riak 
server was refusing connections to new clients.

Interestingly, after giving Riak a while with no traffic at all today (like 
15-30 minutes), it appears to have recovered without a restart. We've had 
similar recoveries during other &quot;outages&quot; of this type since Sunday evening. 
Facilitating this sort of recovery does seem to require shutting down all 
application KV requests for a while.

We're suspicious of some kind of corruption in the eleveldb on-disk files, 
because in past outages of this type, we've observed that the condition 
persists over reboots. But we don't have much more evidence than that. Is there 
a command we can run that will check over eleveldb files for corruption or 
inconsistency?

Other than that, what can cause &quot;worker pool crashed&quot; events? What do you know 
about the &quot;timeouts&quot; that are in these logs?

For the record, we're running Riak 1.2.0 on Ubuntu 10.04,  eleveldb backend 
with 512 partitions. We're running predominantly in a single-node configuration 
on a bunch of isolated dev boxes at the moment, on our way to spreading out our 
512 vnodes onto 5 hosts in production.

Thanks for your help,

Dave

--
Dave Lowell
d...@connectv.com


2012-11-07 18:11:03.398 [info] &lt;0.7.0&gt; Application lager started on node 
'riak@10.0.3.11'

... normal startup messages ...

2012-11-07 18:11:50.109 [info] &lt;0.10582.0&gt;@riak_core:wait_for_application:419 
Wait complete for application riak_search (0 seconds)
2012-11-07 18:22:18.509 [error] &lt;0.2897.0&gt;@riak_core_vnode:handle_info:510 
105616329260241031198313161739262640092323250176 riak_kv_vnode worker pool 
crashed 
{timeout,{gen_server,call,[&lt;0.2902.0&gt;,{work,&lt;0.2900.0&gt;,{fold,#Fun&lt;riak_kv_eleveldb_backend.3.97398576&gt;,#Fun&lt;riak_kv_vnode.14.47983300&gt;},{fsm,{96247562,{105616329260241031198313161739262640092323250176,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}
2012-11-07 18:22:18.509 [error] &lt;0.2899.0&gt; gen_fsm &lt;0.2899.0&gt; in state ready 
terminated with reason: 
{timeout,{gen_server,call,[&lt;0.2902.0&gt;,{work,&lt;0.2900.0&gt;,{fold,#Fun&lt;riak_kv_eleveldb_backend.3.97398576&gt;,#Fun&lt;riak_kv_vnode.14.47983300&gt;},{fsm,{96247562,{105616329260241031198313161739262640092323250176,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}

... 13 more &quot;riak_kv_vnode worker pool crashed&quot; messages...

2012-11-07 18:22:21.245 [error] &lt;0.2899.0&gt; CRASH REPORT Process &lt;0.2899.0&gt; with 
0 neighbours exited with reason: 
{timeout,{gen_server,call,[&lt;0.2902.0&gt;,{work,&lt;0.2900.0&gt;,{fold,#Fun&lt;riak_kv_eleveldb_backend.3.97398576&gt;,#Fun&lt;riak_kv_vnode.14.47983300&gt;},{fsm,{96247562,{105616329260241031198313161739262640092323250176,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}
 in gen_fsm:terminate/7 line 611
2012-11-07 18:22:21.844 [error] &lt;0.2944.0&gt; gen_fsm &lt;0.2944.0&gt; in state ready 
terminated with reason: 
{timeout,{gen_server,call,[&lt;0.2947.0&gt;,{work,&lt;0.2945.0&gt;,{fold,#Fun&lt;riak_kv_eleveldb_backend.3.97398576&gt;,#Fun&lt;riak_kv_vnode.14.47983300&gt;},{fsm,{96247562,{114179815416476790484662877555959610910619729920,'riak@10.0.3.11'}},&lt;0.15324.0&gt;}}]}}

... 13 more &quot;CRASH REPORT Process &lt;X&gt; with 0 neighbours exited with reason&quot; and 
&quot;gen_fsm &lt;0.2989.0&gt; in state ready terminated with reason&quot; message pairs

2012-11-07 18:23:21.427 [error] &lt;0.15322.0&gt; gen_server &lt;0.15322.0&gt; terminated 
with reason: 
{error,{case_clause,{error,timeout,[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[&lt;&lt;&quot;1352256943.4983411&quot;&gt;&gt;],[],[],[],...]}},...}
2012-11-07 18:23:21.495 [error] &lt;0.15322.0&gt; CRASH REPORT Process &lt;0.15322.0&gt; 
with 0 neighbours exited with reason: 
{error,{case_clause,{error,timeout,[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[&lt;&lt;&quot;1352256943.4983411&quot;&gt;&gt;],[],[],[],...]}},...}
 in gen_server:terminate/6 line 747
2012-11-07 18:23:21.525 [error] &lt;0.10590.0&gt; Supervisor riak_api_pb_sup had 
child undefined started with {riak_api_pb_server,start_link,undefined} at 
&lt;0.15322.0&gt; exit with reason 
{error,{case_clause,{error,timeout,[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[&lt;&lt;&quot;1352256943.4983411&quot;&gt;&gt;],[],[],[],...]}},...}
 in context child_terminated</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09227.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09242">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09242">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09244.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">mysterious Riak problems</span> <span class="sender italic">David Lowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09244.html">Re: mysterious Riak problems</a></span> <span class="sender italic">David Lowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09246.html">Re: mysterious Riak problems</a></span> <span class="sender italic">Mark Phillips</span></li>
<li class="icons-email"><span class="subject"><a href="msg09320.html">Re: mysterious Riak problems</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09323.html">Re: mysterious Riak problems</a></span> <span class="sender italic">David Lowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09324.html">Re: mysterious Riak problems</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09326.html">Re: mysterious Riak problems</a></span> <span class="sender italic">David Lowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09327.html">Re: mysterious Riak proble...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09328.html">Re: mysterious Riak pr...</a></span> <span class="sender italic">David Lowell</span></li>
<li class="icons-email"><span class="subject"><a href="msg09329.html">Re: mysterious Riak pr...</a></span> <span class="sender italic">David Lowell</span></li>
<li class="icons-email"><span class="subject"><a href="msg09331.html">Re: mysterious Riak pr...</a></span> <span class="sender italic">David Lowell</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="mysterious Riak problems">
<input type="hidden" name="msgid" value="5D2EBA90-2673-4D19-9D82-587F8318F3F2@go2ctv.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09242.html">
<input type="submit" value=" David Lowell ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22mysterious+Riak+problems%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09227.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09244.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5D2EBA90-2673-4D19-9D82-587F8318F3F2@go2ctv.com</li>
</ul>
</div>
</body>
</html>
