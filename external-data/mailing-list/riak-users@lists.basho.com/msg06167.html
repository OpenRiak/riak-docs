<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Search Performance: Ranges vs Wildcards</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06167" id="c">
<link rel="index" href="maillist.html#06167" id="i">
<link rel="prev" href="msg06161.html" id="p">
<link rel="next" href="msg06168.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06167.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+Performance%5C%3A+Ranges+vs+Wildcards%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Search Performance: Ranges vs Wildcards</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120107" rel="nofollow">Sat, 07 Jan 2012 17:00:24 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Elias,

I'm assuming you have one composite field that looks like so:</pre><pre>

&lt;guid&gt;_&lt;sha&gt;_&lt;time&gt;

where &lt;time&gt; is ISO8601 basic format down to an hour resolution.

If this is the case then you _cannot_ perform an efficient, nor correct
(without doing extra work in your application), query on the &lt;time&gt; portion
of the field.  To use that field for time range, search would have to
perform a full scan of the compound field and then you would have to
filter/sort on &lt;time&gt;.  This is because &lt;time&gt; is independent of
&lt;guid&gt;_&lt;sha&gt; and can repeat itself.  If you have queries that are strictly
time based then a range query of the time field would be most appropriate.

In general, if you make a compound field &lt;f1&gt;_&lt;f2&gt;, and &lt;f1&gt; and &lt;f2&gt; are
independent of each other (e.g. guid and time) then you can only use a
range query on &lt;f1&gt;.  You could range on &lt;f1&gt;_&lt;f2&gt; but you'll include &lt;f2&gt;
values that are below/above your &lt;f2&gt; range because they are still inside
the &lt;f1&gt; range.  Depending on how large of a range &lt;f1&gt; matched this may
not be an issue and you could filter in your application.  You can also
make use of inline fields which effectively allows Search to do the
filtering for you at the index level.

In your case you have to ask two questions.

1. What is the uniqueness/selectivity/cardinality of each field?

2. How you plan to query the data?

&lt;guid&gt; - Is the least selective.  It has high cardinality for any given
value.  There may be many events for a given user over life of application
(or that's my assumption anyways).  Using this field alone is a bad idea,
but is a good candidate as an inline field.

&lt;sha&gt; - Is more selective because, as you stated, can be rare.  It will
have outliers which makes it's less selective in some cases.  Using this
field alone could prove costly but add an inline &lt;guid&gt; filter and it is
probably efficient most of the time

&lt;time&gt; - This is most selective _on average_ assuming a fairly normal
distribution of events over the course of time.  This shares a similar
trait with &lt;sha&gt; in that you could have hours of the day that are bursty.
 This field alone should be fine most of the time and improves if used with
inline &lt;sha&gt; or &lt;guid&gt;.

&gt;From what I can understand you have two main queries:

a. All events for range &lt;time1&gt; to &lt;time2&gt; - in that case I think a range
on the time field would do just fine.  If you want to further refine based
on sha/guid then add them as inline fields and use a filter or even do it
in your application.

b. All events for large time period (or for life of application) for given
sha/guid combination - In this case since &lt;sha&gt; is more selective you'll
want to query via &lt;sha&gt; but use &lt;time&gt; and &lt;guid&gt; as inline filters.  You
_don't_ want to query by &lt;guid&gt; because it's not selective enough and will
cause Search to perform a large scan.

I hope this makes some sense.  I realize I've completely ignored your range
vs. prefix query question but that's because I don't think that's the real
issue here.

-Ryan


On Fri, Jan 6, 2012 at 8:05 PM, Elias Levy &lt;fearsome.lucid...@gmail.com&gt;wrote:

&gt; I was wondering whether some of the Basho folk may have some wise words
&gt; about when to choose between ranges and wildcards when using Riak Search.
&gt;
&gt; I've noticed in our systems that using wildcards will often give more
&gt; performant results than using ranges, at least for our data and some of the
&gt; indexes we've defined on them.  In some instances, the Solr search API will
&gt; timeout when using a range query, but return results when using a wildcard.
&gt;
&gt;
&gt; These indexes are pseudo-compound indexes.  We've taken three values form
&gt; our data, and concatenated them into a single field for indexing purposes,
&gt; so as increase cardinality of the field.  The first value may be a customer
&gt; guid, the second a sha, which can be fairly rare or very common, and the
&gt; last a timestamp bucketed to either the hour.   We usually use ranges to
&gt; limited the time under analysis, but at some times we want large time
&gt; ranges, possibly all the data for any time for the other values, and in
&gt; those cases ranges seem to underperform a wildcard.
&gt;
&gt; Elias Levy
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06161.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06167">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06167">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06168.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06161.html">Riak Search Performance: Ranges vs Wildcards</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Search Performance: Ranges vs Wildcards</span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06168.html">Re: Riak Search Performance: Ranges vs Wildcards</a></span> <span class="sender italic">Elias Levy</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Search Performance: Ranges vs Wildcards">
<input type="hidden" name="msgid" value="CACZcpemnwHGsMWqDedJOYNBf3xwR=LFWPbfbz=4SnRpOGRd2SA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06167.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+Performance%5C%3A+Ranges+vs+Wildcards%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06161.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06168.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpemnwHGsMWqDedJOYNBf3xwR=LFWPbfbz=4SnRpOGRd2SA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
