<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: "all nodes failed" while using doc sample code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00035" id="c">
<link rel="index" href="maillist.html#00035" id="i">
<link rel="prev" href="msg00034.html" id="p">
<link rel="next" href="msg00053.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00035.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22all+nodes+failed%5C%22+while+using+doc+sample+code%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: "all nodes failed" while using doc sample code</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kevin+Smith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kevin Smith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100414" rel="nofollow">Wed, 14 Apr 2010 02:30:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Unfortunately you've run into some unintuitive behavior Erlang has with 
anonymous functions. When Erlang sends an anonymous function to a remote VM it 
sends a pointer to the function instead of the function itself. This means the 
code which creates the anonymous functions needs to be on the server-side 
codepath so the VM receiving the pointer can resolve it to runnable code. This 
dramatically reduces the utility of anonymous functions in map/reduce jobs, but 
it's a limitation of how Erlang handles these types of functions.</pre><pre>

If you're just experimenting with the map/reduce API AND you have a single Riak 
server (no cluster) then you can get this to work by following these steps:

1) Start riak via 'bin/riak console'
2) Inside the console, obtain a Riak client instance like so: {ok, Client} = 
riak:local_client()
3) Build and execute your map/reduce job inside the riak console

Alternatively, you'll need to define your map/reduce functions in a proper 
Erlang module and distribute it to all the Riak nodes and insure it's on the 
codepath. If you decide to go this route you can use Erlang's hot code loading 
to load updated versions of the functions without needing to reboot the Riak 
nodes.

--Kevin
On Apr 13, 2010, at 11:58 PM, ben six wrote:

&gt; 
&gt; on macos 10.6.3 using riak-0.9.1 following instructions at 
&gt; <a  rel="nofollow" href="https://wiki.basho.com/display/RIAK/Installing+on+Mac+OS+X">https://wiki.basho.com/display/RIAK/Installing+on+Mac+OS+X</a>
&gt; install and test passed without issue.
&gt; then tried the erland mapreduce example at 
&gt; <a  rel="nofollow" href="https://wiki.basho.com/display/RIAK/MapReduce#MapReduce-MapReduceviatheErlangAPI">https://wiki.basho.com/display/RIAK/MapReduce#MapReduce-MapReduceviatheErlangAPI</a>
&gt; 
&gt; ~/FromFtp/riak/riak-0.9.1/erts-5.7.5/bin/erl -name riakcli...@127.0.0.1 
&gt; -setcookie riak -pa `pwd`/lib/riak-0.9.1.ez/riak-0.9.1/ebin
&gt; Erlang R13B04 (erts-5.7.5) [source] [smp:2:2] [rq:2] [async-threads:0] [hipe] 
&gt; [kernel-poll:false]
&gt; 
&gt; Eshell V5.7.5  (abort with ^G)
&gt; (riakcli...@127.0.0.1)1&gt; code:which(riak).
&gt; &quot;~/FromFtp/riak/riak-0.9.1/lib/riak-0.9.1.ez/riak-0.9.1/ebin/riak.beam&quot;
&gt; (riakcli...@127.0.0.1)2&gt; {ok, Client} = riak:client_connect('r...@127.0.0.1').
&gt; {ok,{riak_client,'r...@127.0.0.1',&lt;&lt;6,202,197,138&gt;&gt;}}
&gt; (riakcli...@127.0.0.1)4&gt; Count = fun(G, undefined, none) -&gt;
&gt; (riakcli...@127.0.0.1)4&gt;              [dict:from_list([{I, 1} || I &lt;- 
&gt; riak_object:get_value(G)])]
&gt; (riakcli...@127.0.0.1)4&gt;            end.
&gt; #Fun&lt;erl_eval.18.105910772&gt;
&gt; (riakcli...@127.0.0.1)5&gt; Merge = fun(Gcounts, none) -&gt;
&gt; (riakcli...@127.0.0.1)5&gt;              [lists:foldl(fun(G, Acc) -&gt;
&gt; (riakcli...@127.0.0.1)5&gt;                             dict:merge(fun(_, X, Y) 
&gt; -&gt; X+Y end,
&gt; (riakcli...@127.0.0.1)5&gt;                                        G, Acc)
&gt; (riakcli...@127.0.0.1)5&gt;                           end,
&gt; (riakcli...@127.0.0.1)5&gt;                           dict:new(),
&gt; (riakcli...@127.0.0.1)5&gt;                           Gcounts)]
&gt; (riakcli...@127.0.0.1)5&gt;            end.
&gt; #Fun&lt;erl_eval.12.113037538&gt;
&gt; (riakcli...@127.0.0.1)6&gt; {ok, [R]} = Client:mapred([{&lt;&lt;&quot;groceries&quot;&gt;&gt;, 
&gt; &lt;&lt;&quot;mine&quot;&gt;&gt;},
&gt; (riakcli...@127.0.0.1)6&gt;                               {&lt;&lt;&quot;groceries&quot;&gt;&gt;, 
&gt; &lt;&lt;&quot;yours&quot;&gt;&gt;}],
&gt; (riakcli...@127.0.0.1)6&gt;                              [{map, {qfun, Count}, 
&gt; none, false},
&gt; (riakcli...@127.0.0.1)6&gt;                               {reduce, {qfun, 
&gt; Merge}, none, true}]).
&gt; ** exception error: no match of right hand side value &quot;all nodes failed&quot;
&gt; 
&gt; above happened when starting riak with console or plain ./bin/riak start 
&gt; (riak's erl shell : Erlang R13B04 (erts-5.7.5) [source] [smp:2:2] [rq:2] 
&gt; [async-threads:0] [hipe] [kernel-poll:false])
&gt; 
&gt; also error when using erlang shell (from port : Erlang R13B03 (erts-5.7.4) 
&gt; [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] 
&gt; [kernel-poll:false]) :
&gt; ::erl -name riakcli...@127.0.0.1 -setcookie riak -pa 
&gt; `pwd`/lib/riak-0.9.1.ez/riak-0.9.1/ebin
&gt; Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2] 
&gt; [async-threads:0] [hipe] [kernel-poll:false]
&gt; 
&gt; Eshell V5.7.4  (abort with ^G)
&gt; (riakcli...@127.0.0.1)1&gt; code:which(riak).
&gt; &quot;~/FromFtp/riak/riak-0.9.1/lib/riak-0.9.1.ez/riak-0.9.1/ebin/riak.beam&quot;
&gt; (riakcli...@127.0.0.1)2&gt; {ok, Client} = riak:client_connect('r...@127.0.0.1').
&gt; {ok,{riak_client,'r...@127.0.0.1',&lt;&lt;4,181,78,207&gt;&gt;}}
&gt; (riakcli...@127.0.0.1)4&gt; Count = fun(G, undefined, none) -&gt;
&gt; (riakcli...@127.0.0.1)4&gt;              [dict:from_list([{I, 1} || I &lt;- 
&gt; riak_object:get_value(G)])]
&gt; (riakcli...@127.0.0.1)4&gt;            end.
&gt; #Fun&lt;erl_eval.18.105910772&gt;
&gt; (riakcli...@127.0.0.1)5&gt; Merge = fun(Gcounts, none) -&gt;
&gt; (riakcli...@127.0.0.1)5&gt;              [lists:foldl(fun(G, Acc) -&gt;
&gt; (riakcli...@127.0.0.1)5&gt;                             dict:merge(fun(_, X, Y) 
&gt; -&gt; X+Y end,
&gt; (riakcli...@127.0.0.1)5&gt;                                        G, Acc)
&gt; (riakcli...@127.0.0.1)5&gt;                           end,
&gt; (riakcli...@127.0.0.1)5&gt;                           dict:new(),
&gt; (riakcli...@127.0.0.1)5&gt;                           Gcounts)]
&gt; (riakcli...@127.0.0.1)5&gt;            end.
&gt; #Fun&lt;erl_eval.12.113037538&gt;
&gt; (riakcli...@127.0.0.1)6&gt; {ok, [R]} = Client:mapred([{&lt;&lt;&quot;groceries&quot;&gt;&gt;, 
&gt; &lt;&lt;&quot;mine&quot;&gt;&gt;},
&gt; (riakcli...@127.0.0.1)6&gt;                               {&lt;&lt;&quot;groceries&quot;&gt;&gt;, 
&gt; &lt;&lt;&quot;yours&quot;&gt;&gt;}],
&gt; (riakcli...@127.0.0.1)6&gt;                              [{map, {qfun, Count}, 
&gt; none, false},
&gt; (riakcli...@127.0.0.1)6&gt;                               {reduce, {qfun, 
&gt; Merge}, none, true}]).
&gt; ** exception error: undefined function luke:new_flow/5
&gt;      in function  riak_client:mapred_stream/4
&gt;      in call from riak_client:mapred/4
&gt; 
&gt; i used the default config files so the cookie is also consistant.
&gt; new to this so not sure where to get from there.
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00034.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00035">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00035">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00053.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00034.html">&quot;all nodes failed&quot; while using doc sample code</a></span> <span class="sender italic">ben six</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: &quot;all nodes failed&quot; while using doc sample c...</span> <span class="sender italic">Kevin Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00053.html">Re: &quot;all nodes failed&quot; while using doc samp...</a></span> <span class="sender italic">ben six</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00064.html">Re: &quot;all nodes failed&quot; while using doc ...</a></span> <span class="sender italic">ben six</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: &quot;all nodes failed&quot; while using doc sample code">
<input type="hidden" name="msgid" value="7B2A3C80-C652-414A-A0A1-FF13C8A21CED@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00035.html">
<input type="submit" value=" Kevin Smith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22all+nodes+failed%5C%22+while+using+doc+sample+code%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00034.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00053.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">7B2A3C80-C652-414A-A0A1-FF13C8A21CED@basho.com</li>
</ul>
</div>
</body>
</html>
