<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: How to prevent Riak crashes when out of memory?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07655" id="c">
<link rel="index" href="maillist.html#07655" id="i">
<link rel="prev" href="msg07609.html" id="p">
<link rel="next" href="msg07610.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07655.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+prevent+Riak+crashes+when+out+of+memory%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: How to prevent Riak crashes when out of memory?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mark+Phillips%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mark Phillips</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120610" rel="nofollow">Sun, 10 Jun 2012 14:25:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Steve,

There's a pull request open to fix this:</pre><pre>

<a  rel="nofollow" href="https://github.com/basho/erlang_js/pull/19">https://github.com/basho/erlang_js/pull/19</a>

(h/t to Michael Santos for submitting the fix!)

We are in the process of reviewing the patch. The code for Riak 1.2 is
being finalized as we speak and I'm hopeful that it'll make it in.

Mark

On Mon, Jun 4, 2012 at 4:52 PM, Steve Edwards &lt;st...@edmodo.com&gt; wrote:

&gt; I have a cluster of riak nodes and one of them crashed because of a
&gt; failure to allocate memory.
&gt;
&gt; eheap_alloc: Cannot allocate 2850821240 bytes of memory
&gt;
&gt; I restarted the node and it came up gracefully but all my clients
&gt; reported that it was offline until I restarted every single node in
&gt; the cluster.
&gt; How can I tell what was trying to allocate that memory so that I can
&gt; give it more memory?
&gt; When the node is running, it looks like its only using 8 out of 16G of
&gt; memory.
&gt; Is there a configuration option somewhere that I can modify to
&gt; increase the amount of memory available to the node?
&gt; I've tweaked all the javascript vm settings but even when there are no
&gt; mapreduce calls, memory usage still tops out at 8G.
&gt; I should also mention that I am using riak_search
&gt;
&gt;
&gt; Here are some of the config settings:
&gt;
&gt; ERL_MAX_ETS_TABLES 4800
&gt; {map_js_vm_count, 16 },
&gt; {reduce_js_vm_count, 6 },
&gt; {hook_js_vm_count, 8 },
&gt;
&gt; {js_max_vm_mem, 16},
&gt; js_thread_stack, 16},
&gt; {segment_full_read_size,20},
&gt; {buffer_delayed_write_size,1024 },
&gt; {buffer_rollover_size, 4194304},
&gt; {max_compact_segments, 20}
&gt;
&gt;
&gt; Here is some more detail about the memory error from erl_crash.dump
&gt; =erl_crash_dump:0.1
&gt; Fri Jun  1 19:46:03 2012
&gt; Slogan: eheap_alloc: Cannot allocate 2850821240 bytes of memory (of
&gt; type &quot;heap&quot;).
&gt; System version: Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:4:4]
&gt; [rq:4] [async-threads:64] [kernel-poll:true]
&gt; Compiled: Tue Sep  6 10:22:01 2011
&gt; Taints: crypto,bitcask_nifs
&gt; Atoms: 15614
&gt; =memory
&gt; total: 12474692688
&gt; processes: 6076294256
&gt; processes_used: 6076132696
&gt; system: 6398398432
&gt; atom: 1068865
&gt; atom_used: 1048912
&gt; binary: 402089120
&gt; code: 9947817
&gt; ets: 89367152
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07609.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07655">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07655">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07610.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07609.html">How to prevent Riak crashes when out of memory?</a></span> <span class="sender italic">Steve Edwards</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: How to prevent Riak crashes when out of memory?</span> <span class="sender italic">Mark Phillips</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: How to prevent Riak crashes when out of memory?">
<input type="hidden" name="msgid" value="CAE8zJQFtNLANx9591i2Yfsps9_no=M-7L58zFd30q6Dy604+RA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07655.html">
<input type="submit" value=" Mark Phillips ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+prevent+Riak+crashes+when+out+of+memory%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07609.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07610.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAE8zJQFtNLANx9591i2Yfsps9_no=M-7L58zFd30q6Dy604+RA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
