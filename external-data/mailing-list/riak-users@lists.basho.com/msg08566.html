<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: M/R query with riak-defined keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08566" id="c">
<link rel="index" href="maillist.html#08566" id="i">
<link rel="prev" href="msg08495.html" id="p">
<link rel="next" href="msg08582.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08566.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+M%5C%2FR+query+with+riak%5C-defined+keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: M/R query with riak-defined keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Antoine%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Antoine</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120917" rel="nofollow">Mon, 17 Sep 2012 03:26:10 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi,

</pre><tt>Could anyone provide a basic working example using a map/reduce 
</tt><tt>combining &quot;starts_with&quot; and &quot;tokenize&quot; so that I can see if my syntax is 
</tt><tt>wrong or if something else brings me the famous 
</tt><tt>&quot;{&quot;error&quot;:&quot;map_reduce_error&quot;}&quot;
</tt><pre style="margin: 0em;"></pre><pre>

</pre><tt>still can't figure out how to make it work : 
</tt><tt><a  rel="nofollow" href="https://gist.github.com/3699779">https://gist.github.com/3699779</a> :(
</tt><pre style="margin: 0em;">

Thanks in advance,
A.


On 09/11/2012 07:06 PM, Antoine wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On 09/11/2012 07:47 AM, Mark Phillips wrote:
 &gt; Hey Antoine,
 &gt;
 &gt; Sorry for the delay here. Just for the sake of completeness, can you
 &gt; provide the MapReduce job that's not running?
 &gt;
 &gt; Mark

Hey,

Thanks for your answer ;)

It turns out I've managed to make it work, probably was an error in the
Javascript MapReduce indeed (the thing is that the output isn't very
chatty about what's actually wrong).

I've encountered another problem though.
I've decided to test both possibilities :
-working with user-defined keys and sorting them with key_filters
-working with riak-defined keys and filtering thanks to
map/reduce+javascript.

This time, the riak-defined works, but not the solution with my keys.
My keys are formated like this : &lt;word&gt;_YYYYMMDD_HHMM
I want to get all values where the key starts exactly with the specified
word and where &lt;minDate&gt; &lt;= YYYYMMDD &lt;= maxDate

My problem lies in the combination of the two constraints.
I managed the one with the specified word, and the one with the dates.
But not both simultaneously : I get the following error -&gt;
{&quot;error&quot;:&quot;map_reduce_error&quot;}


Here's the Json I send to /mapred : <a  rel="nofollow" href="https://gist.github.com/3699779">https://gist.github.com/3699779</a>
I've also included in this gist the errors I got in Riak's crash.log.

At the end of the Gist are the two requests that do work. Can't seem to
merge them into one with the [[&quot;and&quot; ...]] tool.

If you have any clue where this crash can come from, feel free to tell
me :)

Have a good day,

Antoine

</pre></blockquote><pre style="margin: 0em;">



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08495.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08566">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08566">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08582.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08456.html">M/R query with riak-defined keys</a></span> <span class="sender italic">Antoine</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08487.html">Re: M/R query with riak-defined keys</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08495.html">Re: M/R query with riak-defined keys</a></span> <span class="sender italic">Antoine</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: M/R query with riak-defined keys</span> <span class="sender italic">Antoine</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08582.html">Re: M/R query with riak-defined keys [SOLVE...</a></span> <span class="sender italic">Antoine</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: M/R query with riak-defined keys">
<input type="hidden" name="msgid" value="5056FAD3.7080100@laposte.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08566.html">
<input type="submit" value=" Antoine ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+M%5C%2FR+query+with+riak%5C-defined+keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08495.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08582.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5056FAD3.7080100@laposte.net</li>
</ul>
</div>
</body>
</html>
