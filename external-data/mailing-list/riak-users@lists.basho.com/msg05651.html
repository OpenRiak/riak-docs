<!DOCTYPE html>
<html lang="en">
<head>
<title>Random but frequent crashes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05651" id="c">
<link rel="index" href="maillist.html#05651" id="i">
<link rel="prev" href="msg05649.html" id="p">
<link rel="next" href="msg05672.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05651.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Random+but+frequent+crashes%22&amp;o=newest" rel="nofollow"><span itemprop="name">Random but frequent crashes</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Michael+Jakl%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Michael Jakl</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111118" rel="nofollow">Fri, 18 Nov 2011 03:37:20 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,
I'm testdriving Riak (1.0.1) using Bitcask and a lot of data
(currently ~25 million documents). I've deployed Riak on three
machines with a n_val of 3 (acutally, I left it at the default).</pre><pre>

Soon after I started an import process, Riak crashed about every 6
million documents (sometimes more frequently) leaving no obvious cause
in the logfiles. I've opened a ticket (Bug 1282 [1]), but maybe it's
better to discuss it here since I'm not having much information on
this. The only node that crashes is the one I'm adding the data to,
the other two nodes didn't crash yet. The importer and the (crashing)
Riak node are on the same machine and I'm currently using the HTTP
Java client (before that, I was using the PBC Java client).

It seems that the crashes occur after a long running gc alert in the
logfiles, yet that may be unrelated (the memory usage on my machine
does not go up).

I'm running Riak on machines with 24GB of RAM, the bucket-name is
about 10 chars long and the keys 20 chars. I expect about 200 million
documents with roughly 20k of data, but currently I've only imported
only 24 million. The first crash happened after 6 million documents.

The nofile limit for Riak is 32000 on Linux Debian 6 with all updates
installed. The capacity planning page tells me that I've enough RAM
(recommendation: 3 nodes with 14GB of RAM). The bitcask directory has
about 180GB of data and contains 344 files.

I've tried switching to eleveldb thinking it might be a memory issue,
but that used up more disk space than I have available. My migration
plan was to install Riak on another machine, setup leveldb and tried
to join the node running bitcask, disk consumption went from 200G to
over a terrabyte during the process.

I've upgraded to Riak 1.0.2, but the changelog does not mention
anything related to that.

What could I do to identify the problem? Are there any debugging
switches I could turn on (I've recently activated the
sasl_error_logger)? I'm thinking of activating the Heartbeat
management in vm.args, but that wouldn't fix the root cause... . I've
just restarted Riak using 1.0.2 and cleaned all logfiles. Up until
now, crashes were frequent enough that I should be able to provide a
set of logfiles on monday, but are there any obvious things I might
have forgotten?

Cheers,
Michael

 1: <a  rel="nofollow" href="https://issues.basho.com/show_bug.cgi?id=1282">https://issues.basho.com/show_bug.cgi?id=1282</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05649.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05651">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05651">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05672.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Random but frequent crashes</span> <span class="sender italic">Michael Jakl</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05672.html">Re: Random but frequent crashes</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05689.html">Re: Random but frequent crashes</a></span> <span class="sender italic">Michael Jakl</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Random but frequent crashes">
<input type="hidden" name="msgid" value="CAO8TpMR4J4wqaQUKns8jMgFrCAnrxZZwewpHRz4uE1acs3pKDw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05651.html">
<input type="submit" value=" Michael Jakl ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Random+but+frequent+crashes%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05649.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05672.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAO8TpMR4J4wqaQUKns8jMgFrCAnrxZZwewpHRz4uE1acs3pKDw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
