<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Handoffs are too slow after netsplit</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#18013" id="c">
<link rel="index" href="maillist.html#18013" id="i">
<link rel="prev" href="msg18012.html" id="p">
<link rel="next" href="msg18031.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18013.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Handoffs+are+too+slow+after+netsplit%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Handoffs are too slow after netsplit</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Douglas+Rohrer%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Douglas Rohrer</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170223" rel="nofollow">Thu, 23 Feb 2017 04:16:17 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Andrey:

It's waiting for 60 seconds, literally...</pre><pre>

See
<a  rel="nofollow" href="https://github.com/basho/riak_core/search?utf8=%E2%9C%93&amp;q=vnode_inactivity_timeout">https://github.com/basho/riak_core/search?utf8=%E2%9C%93&amp;q=vnode_inactivity_timeout</a>
-
handoff is not initiated until a vnode has been inactive for the specified
inactivity period.

For demonstration purposes, if you want to reduce this time, you could set
the riak_core.vnode_inactivity_timeout period lower ,which can be set in
advanced.config. Also note that, depending on the backend you use, it's
possible to have other settings set lower than the vnode inactivity
timeout, you can actually prevent handoff completely - see
<a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.2.0/setup/planning/backend/bitcask/#sync-strategy">http://docs.basho.com/riak/kv/2.2.0/setup/planning/backend/bitcask/#sync-strategy</a>,
for examnple.

Hope this helps.

Doug

On Thu, Feb 23, 2017 at 6:40 AM Andrey Ershov &lt;andrers...@gmail.com&gt; wrote:

Hi, guys!

I'd like to follow up on handoffs behaviour after netsplit. The problem is
that right after network partition is healed, &quot;riak-admin transfers&quot;
command says that there are X partitions waiting transfer from one node to
another, and Y partitions waiting transfer in the opposite direction. What
are they waiting for? Active transfers section is always empty. It takes
about 1 minute for transfer to occur. I've increased transfer_limit to 100
and it does not help.
Also I've tried to attach to Erlang VM and execute
riak_core_vnode_manager:force_handoff() on each node. This command returns
'ok'. But seems that it does not work right after network is healed. After
some time 30-60 s, force_handoff() works as expected, but actually it's the
same latency as in auto handoff case.

So what is it waiting for? Any ideas?

I'm preparing real-time coding demo to be shown on the conference. So it's
too much time to wait for 1 minute for handoff to occur just for a couple
of keys...
-- 
Thanks,
Andrey
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18012.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#18013">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18013">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18031.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg18012.html">Handoffs are too slow after netsplit</a></span> <span class="sender italic">Andrey Ershov</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Handoffs are too slow after netsplit</span> <span class="sender italic">Douglas Rohrer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18031.html">Re: Handoffs are too slow after netsplit</a></span> <span class="sender italic">Charlie Voiselle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18032.html">Re: Handoffs are too slow after netsplit</a></span> <span class="sender italic">Andrey Ershov</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Handoffs are too slow after netsplit">
<input type="hidden" name="msgid" value="CAKO5ScNNC=d5QmoDi-kV4mhr-4D6qPniN==tZic3iwXM7pZErQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18013.html">
<input type="submit" value=" Douglas Rohrer ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Handoffs+are+too+slow+after+netsplit%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18012.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18031.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAKO5ScNNC=d5QmoDi-kV4mhr-4D6qPniN==tZic3iwXM7pZErQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
