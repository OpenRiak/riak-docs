<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Concurrency hazard when updating links</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03890" id="c">
<link rel="index" href="maillist.html#03890" id="i">
<link rel="prev" href="msg03889.html" id="p">
<link rel="next" href="msg03789.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03890.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Concurrency+hazard+when+updating+links%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Concurrency hazard when updating links</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kresten+Krab+Thorup%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kresten Krab Thorup</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110630" rel="nofollow">Thu, 30 Jun 2011 15:38:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I've written this little link index kit that can be used to manage external 
&quot;link objects&quot;</pre><pre>

<a  rel="nofollow" href="https://github.com/krestenkrab/riak_link_index">https://github.com/krestenkrab/riak_link_index</a>

&lt;<a  rel="nofollow" href="https://github.com/krestenkrab/riak_link_index">https://github.com/krestenkrab/riak_link_index</a>&gt;Which uses vectorclocks on 
individual links (they are contained in a riak_link_set) so link updates are 
done with a very similar logic used to handle &quot;normal&quot; write conflicts, but 
within a single riak object.

Going forward, a better option may be to use the new upcoming riak_index 
features (which are proper secondary indexes for riak), but that has not 
appeared in a release yet ... but you can check it out in basho's repo.  I 
don't know the details of riak_index's consistency model though.

Kresten

On Jul 1, 2011, at 12:08 AM, Les Mikesell wrote:

How is this handled on requests where the the server does the link
insertion and walking for you?  That is, you have some existing links
and simultaneously add multiple new items that add themselves to the
same links, then ask the server to return the values from link walking.
 Does the client know that the link updates may have conflicted or does
the server do some kind of resolution during the walk?

 Les Mikesell
   lesmikes...@gmail.com&lt;<a  rel="nofollow" href="mailto:lesmikes...@gmail.com">mailto:lesmikes...@gmail.com</a>&gt;


On 6/22/2011 10:23 AM, Mathias Meyer wrote:
And here's the link I neatly forgot to include:

<a  rel="nofollow" href="http://wiki.basho.com/Vector-Clocks.html">http://wiki.basho.com/Vector-Clocks.html</a>

Mathias Meyer
Developer Advocate, Basho Technologies


On Mittwoch, 22. Juni 2011 at 17:18, Mathias Meyer wrote:

Manuel,

what you're seeing is not specific to links, it's generally how concurrent 
updates to a single object are handled in Riak, links are no exception. If you 
want to handle that properly you need to enable the allow_mult property on the 
bucket in question.

Now, whenever two clients update the same object based on the same origin (i.e. 
vector clock) they'll cause siblings to be created. The next time you fetch the 
object you'll get both siblings and you can then reconcile the difference, e.g. 
merging all links together, checking if they're still valid, etc., and then 
store back the updated value using the vector clock you got when requesting the 
object including the siblings.

We have wiki page [1] dedicated to vector clocks and conflict resolution, 
explaining the process in more detail.

Mathias Meyer
Developer Advocate, Basho Technologies

[1]

On Mittwoch, 22. Juni 2011 at 11:14, Manuel Astudillo wrote:


Hello,


Probably I have some miss understating on whats the best way to update links in 
Riak, but I am wondering if you know about this hazard when updating links:


client A: getLinks(X)
client B: getLinks(X)


clientB:updateLinks(X)
clientA:updateLinks(X)


where the update made by B is cleaned by A, and it seems like there is not even 
any way to get a notification about it or detect it somehow...



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03889.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03890">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03890">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03789.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03774.html">Concurrency hazard when updating links</a></span> <span class="sender italic">Manuel Astudillo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03785.html">Re: Concurrency hazard when updating links</a></span> <span class="sender italic">Mathias Meyer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03786.html">Re: Concurrency hazard when updating links</a></span> <span class="sender italic">Mathias Meyer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03889.html">Re: Concurrency hazard when updating link...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Concurrency hazard when updating ...</span> <span class="sender italic">Kresten Krab Thorup</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Concurrency hazard when updating links">
<input type="hidden" name="msgid" value="DDFDB24A-CC14-4486-9216-A0290C2FDB95@trifork.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03890.html">
<input type="submit" value=" Kresten Krab Thorup ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Concurrency+hazard+when+updating+links%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03889.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03789.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">DDFDB24A-CC14-4486-9216-A0290C2FDB95@trifork.com</li>
</ul>
</div>
</body>
</html>
