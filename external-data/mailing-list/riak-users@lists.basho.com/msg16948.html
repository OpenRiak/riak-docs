<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak-S2 javascript aws-sdk failing on multi-part uploads</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16948" id="c">
<link rel="index" href="maillist.html#16948" id="i">
<link rel="prev" href="msg16946.html" id="p">
<link rel="next" href="msg16949.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16948.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak%5C-S2+javascript+aws%5C-sdk+failing+on+multi%5C-part+uploads%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak-S2 javascript aws-sdk failing on multi-part uploads</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+Fanjoy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John Fanjoy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160113" rel="nofollow">Wed, 13 Jan 2016 13:25:58 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello Everyone,

I have been doing some searching around to see if anyone has come across the 
specific issue I am having and can’t find anything. I have a project that 
provides a file upload interface through a website and puts the uploaded object 
into riak-cs. The front end uses the javascript aws-sdk 2.1.29 (tried .19 as 
well) with a patch I found using the list archives to fix up some url encoding 
issues with uploadIDs. Everything seems to work fine when the image is less 
than 5mb (max part size), however when the object is larger the ManagedUpload 
functionality of the S3 object is failing after the first part. I’ve tested the 
code I’m using against a vanilla AWS bucket and a 400+ mb file was uploaded 
without issue. I tested the same file with riak-cs using the aws-sdk and 
CyberDuck. Cyberduck was able to upload the file without any failure, but it 
has not been successful even once using the javascript library. I have turned 
the riak-cs debug logging on, and I am getting some errors logged, but I’m not 
really sure how useful they are:</pre><pre>

```
2016-01-13 15:34:51.648 [error] &lt;0.1255.0&gt; Webmachine error at path 
&quot;/buckets/three2016com-devopsdevel/objects/DeSMan_Ep1_Create_Website_720p_DRAFT%2520%25281%2529.mov/uploads/kL9dRGLaQCiZBNnPSpu5mw==&quot;
 : 
{error,{error,{badmatch,{error,closed}},[{webmachine_request,recv_unchunked_body,3,[{file,&quot;src/webmachine_request.erl&quot;},{line,490}]},{riak_cs_wm_object_upload_part,accept_streambody,4,[{file,&quot;src/riak_cs_wm_object_upload_part.erl&quot;},{line,308}]},{riak_cs_wm_object_upload_part,accept_body,2,[{file,&quot;src/riak_cs_wm_object_upload_part.erl&quot;},{line,224}]},{riak_cs_wm_common,accept_body,2,[{file,&quot;src/riak_cs_wm_common.erl&quot;},{line,342}]},{webmachine_resource,resource_call,3,[{file,&quot;src/webmachine_re...&quot;},...]},...]}}
 in webmachine_request:recv_unchunked_body/3 line 490
```

This error does not show up when using Cyberduck or performing an upload that 
is &lt;5mb using javascript. I’ve tried riak-cs 1.5 and now risk-s2 2.1.0 with out 
any success. Any help you can offer would be greatly appreciated. If you have 
any questions for me or need additional information let me know and I’ll fill 
in any holes I left.



Thank you in advance,

John Fanjoy

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16946.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16948">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16948">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16949.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Riak-S2 javascript aws-sdk failing on multi-part upload...</span> <span class="sender italic">John Fanjoy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16949.html">Re: Riak-S2 javascript aws-sdk failing on multi-pa...</a></span> <span class="sender italic">John Fanjoy</span></li>
<li class="icons-email"><span class="subject"><a href="msg16950.html">Re: Riak-S2 javascript aws-sdk failing on multi-pa...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16951.html">Re: Riak-S2 javascript aws-sdk failing on mult...</a></span> <span class="sender italic">John Fanjoy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16952.html">Re: Riak-S2 javascript aws-sdk failing on ...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16953.html">Re: Riak-S2 javascript aws-sdk failing...</a></span> <span class="sender italic">John Fanjoy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16954.html">Re: Riak-S2 javascript aws-sdk fa...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16955.html">Re: Riak-S2 javascript aws-sd...</a></span> <span class="sender italic">John Fanjoy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16956.html">Re: Riak-S2 javascript aw...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg16964.html">Re: Riak-S2 javascript aw...</a></span> <span class="sender italic">Shunichi Shinohara</span></li>
<li class="icons-email"><span class="subject"><a href="msg16965.html">Re: Riak-S2 javascript aw...</a></span> <span class="sender italic">John Fanjoy</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak-S2 javascript aws-sdk failing on multi-part uploads">
<input type="hidden" name="msgid" value="A6108C8F-B16D-4288-A563-B22BB71FAC0C@inetu.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16948.html">
<input type="submit" value=" John Fanjoy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak%5C-S2+javascript+aws%5C-sdk+failing+on+multi%5C-part+uploads%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16946.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16949.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">A6108C8F-B16D-4288-A563-B22BB71FAC0C@inetu.net</li>
</ul>
</div>
</body>
</html>
