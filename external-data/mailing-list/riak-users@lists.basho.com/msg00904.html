<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: "Dead" files in bitcask or something</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00904" id="c">
<link rel="index" href="maillist.html#00904" id="i">
<link rel="prev" href="msg00902.html" id="p">
<link rel="next" href="msg00906.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00904.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22Dead%5C%22+files+in+bitcask+or+something%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: "Dead" files in bitcask or something</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100817" rel="nofollow">Tue, 17 Aug 2010 08:55:01 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<tt>Bitcask is a write only log (wol) that eats disk (by keeping all  
</tt><tt>updates) until a compaction phase that reclaims disk at some defined  
</tt><tt>interval.
</tt><pre style="margin: 0em;">

-Alexander</pre><pre>


@siculars on twitter
<a  rel="nofollow" href="http://siculars.posterous.com">http://siculars.posterous.com</a>

Sent from my iPhone

</pre><tt>On Aug 17, 2010, at 11:27, Dmitry Demeshchuk &lt;demeshc...@gmail.com&gt;  
</tt><tt>wrote:
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Greetings.

This problem has already been discussed in IRC a bit.

I use Riak 0.12.1 (have been using 0.12.0 but then updated to the
latest version and got the same problem) with bitcask storage.

All Riak settings are default, i.e., all buckets are
default-configured (allow_mult=false), replication is 3x. Currently
Riak is run at a single machine. This problem is reproduced on
different machines with different Riak clusters brought up.

Though the total database records size doesn't grow, update operations
(I'll describe them in details later) make the total size of the
&quot;data/bitcask&quot; folder. For example, I made a database backup on our
test server and the backup size was 2.5MB. But the size of the
&quot;data/bitcask&quot; folder was 17GB!

Careful investigation showed that the entire database size on the disk
is performed when Riak update operation is performed, even when the
value during update was exactly the same.

The update operation is like this:

RiakObject = RiakClient:get(Bucket, Key, 1),
OldValue = riak_object:get_value(RiakObject),
NewValue = do_something(),
NewRiakObject = riak_object:update_value(RiakObject, NewValue),
RiakClient:put(NewRiakObject, 1).

And it appeared that even if I make NewValue exactly the same as
OldValue, this update operation increases the database size of the
disk. Still, the entire size of this Riak object is the same.

I thought that maybe I could do something wrong with data operating,
and there's some data I miss. But, again, backup file is very small,
much smaller then the disk space occupied by database.

If I do list_buckets or list_keys, these operations work desperately
slow but finally they return the right values, without any garbage.
Values of the Riak objects are okay as well.

When I had a look at data files, it appeared that *.bitcask.data are
the files that keep growing.

That's all I found for now.

Any clues?

--
Best regards,
Dmitry Demeshchuk

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00902.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00904">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00904">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00906.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00902.html">&quot;Dead&quot; files in bitcask or something</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: &quot;Dead&quot; files in bitcask or something</span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00906.html">Re: &quot;Dead&quot; files in bitcask or someth...</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00915.html">Re: &quot;Dead&quot; files in bitcask or so...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00918.html">Re: &quot;Dead&quot; files in bitcask o...</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg00914.html">Re: &quot;Dead&quot; files in bitcask or someth...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: &quot;Dead&quot; files in bitcask or something">
<input type="hidden" name="msgid" value="CC7F80B7-30DD-4D58-AAF2-FF89B9BB421C@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00904.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22Dead%5C%22+files+in+bitcask+or+something%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00902.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00906.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CC7F80B7-30DD-4D58-AAF2-FF89B9BB421C@gmail.com</li>
</ul>
</div>
</body>
</html>
