<!DOCTYPE html>
<html lang="en">
<head>
<title>Looping in MR and multiple input phases</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05563" id="c">
<link rel="index" href="maillist.html#05563" id="i">
<link rel="prev" href="msg05560.html" id="p">
<link rel="next" href="msg05564.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05563.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Looping+in+MR+and+multiple+input+phases%22&amp;o=newest" rel="nofollow"><span itemprop="name">Looping in MR and multiple input phases</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Elias+Levy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Elias Levy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111112" rel="nofollow">Sat, 12 Nov 2011 13:46:36 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I figure the following is not currently possible in Riak, so I'd like to
propose them as potential features.</pre><pre>

We are processing millions of documents with Riak and we need to very
quickly find that ones we want.  One problem we've had is that some of the
terms we want to search on are either very low cardinality (such as
timestamps), or very high cardinality (e.g. they match 50% of documents).
 This is compounded by the very low IO performance of EC2.  We've deal with
this by creating the equivalent of compound indexes by adding fields to our
documents that combine two or more fields we wanted to index and that we
could query together.  We've also performed some quantization of things
like timestamps.  This has allows us bring the cardinality terms to
a reasonable level and spread our the values among terms more evenly.  We
are using Riak search for this, as secondary indexes does not currently
support compound queries.

The downside of this approach is that if we want to answer a question such
as, more recent documents from some point in time, we have to loop over
these terms trying to find one with some data.  That can potentially
involve a lot of round trips between the client and the server.

Ideally we'd like to be able to write a MR job that takes some input, and
if the starting input was not sufficient to produce a result, have it
restart at the beginning of the job with a new set of inputs it
generates programmatically.  This can be somewhat emulated by having
repeating groups chains of map-reduce phases, so if an early group did not
find what it was looking for, the last reduce phase group can output a new
set of bucket-key pairs as input for the next group of map-reduce phases.
 The problem with this is that is not efficient (the first group could have
found what it needed, and the other phases becomes superflous), you may not
know head of time how many of this groups to chain, and most problematic
for us, we may not know what bucket-key pairs to pass to the next group.
 Thus, you need looping, but also a way to specify a new input, not just
with bucket-key pairs, but as search or secondary indexes query.

I suppose the last problem can be solved if we where using Erlang for our
phases, as we could then use the Erlang search client to generate a new set
of keys based on a new search query. Maybe the a search API could be made
available as a new Javascript function that can be used by JS phases.

Elias
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05560.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05563">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05563">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05564.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Looping in MR and multiple input phases">
<input type="hidden" name="msgid" value="CAFDmHdM0HWWtrwKUkt-Aux4qp8FCfc69x4aHNKoaCQLguoeU9g@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05563.html">
<input type="submit" value=" Elias Levy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Looping+in+MR+and+multiple+input+phases%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05560.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05564.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAFDmHdM0HWWtrwKUkt-Aux4qp8FCfc69x4aHNKoaCQLguoeU9g@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
