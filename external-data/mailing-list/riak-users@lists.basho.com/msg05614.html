<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Secondary Indexes - Feedback?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#05614" id="c">
<link rel="index" href="mail2.html#05614" id="i">
<link rel="prev" href="msg05609.html" id="p">
<link rel="next" href="msg05608.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05614.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Secondary+Indexes+%5C-+Feedback%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Secondary Indexes - Feedback?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Nate+Lawson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Nate Lawson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111116" rel="nofollow">Wed, 16 Nov 2011 13:04:27 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Nov 16, 2011, at 11:41 AM, Rusty Klophaus wrote:

&gt;&gt; 2. We need a guaranteed order of inputs from a 2I query. If we select on a 
&gt;&gt; range, each key we get on a given node in the M-R job should be ordered 
&gt;&gt; according to the 2I values. Of course we understand that keys won't be 
&gt;&gt; ordered across nodes (that would require a reduce phase to merge sort) but 
&gt;&gt; it would be good for each node to know that its portion of the covering set 
&gt;&gt; is ordered.
&gt; 
&gt; Can you elaborate on this? Trying to think of a problem where it helps to 
&gt; have the results ordered by node but not necessarily overall, and drawing a 
&gt; blank.</pre><pre>

For each key returned, we check some other data in the value. Assume a 2I for 
&quot;date created&quot; on each key and the ability for each node in the M-R job to get 
an ordered list of keys by date range.

During M-R, each node sees an ordered subset of the total keys, but the subset 
is sparse (meaning keys are not necessarily contiguous by their date on a given 
node). Each node then walks through its keys in date order and retrieves the 
value for each. It does some operations on the value. If the value is found to 
not be a member of the desired relevant set, it would terminate its map phase 
without fetching values for other keys.

Example key subsets per node, showing 2I values in descending order:

Node 1: (8, 2, 1)
Node 2: (8, 7, 6, 5)
Node 3: (9, 2)

&gt;  4. Need any of the nodes to be able to abort a M-R job in the middle with a 
&gt; successful completion status. Combined with the above, you could return 
&gt; partial results (say, top 10 matches) without having to generate all the keys 
&gt; in a given range.
&gt; 
&gt; Pagination is one clear case where this would be useful. Are you facing any 
&gt; other scenarios where this is necessary?
&gt; 
&gt; Also, are you always looking for top X results, where X is known before the 
&gt; query starts? Or does X change depending on the results?

It is like pagination, but X is not known a priori. Fetching and examining the 
value for each key determines if we have reached the end of that subset of the 
data. Once all nodes have reached the end of their sorted subset, the job 
completes with a reduce phase.

We can't yet do this in Riak so we're using something else for this. I think 
features 1-4 would be needed for us to do it in Riak.

-Nate


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05609.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#05614">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#05614">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05608.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05604.html">Secondary Indexes - Feedback?</a></span> <span class="sender italic">Rusty Klophaus</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05607.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Nate Lawson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05609.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Rusty Klophaus</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Secondary Indexes - Feedback?</span> <span class="sender italic">Nate Lawson</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05608.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Gordon Tillman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05610.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Rusty Klophaus</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05630.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Jim Adler</span></li>
<li class="icons-email"><span class="subject"><a href="msg05702.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Matt Ranney</span></li>
<li class="icons-email"><span class="subject"><a href="msg05703.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Fyodor Yarochkin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05813.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Greg Pascale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05843.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Mike Oxford</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05611.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Paul Gross</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05612.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05613.html">Re: Secondary Indexes - Feedback?</a></span> <span class="sender italic">Paul Gross</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Secondary Indexes - Feedback?">
<input type="hidden" name="msgid" value="702F5902-88AB-4D28-87F8-F908BBB8E9E0@root.org">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05614.html">
<input type="submit" value=" Nate Lawson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Secondary+Indexes+%5C-+Feedback%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05609.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05608.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">702F5902-88AB-4D28-87F8-F908BBB8E9E0@root.org</li>
</ul>
</div>
</body>
</html>
