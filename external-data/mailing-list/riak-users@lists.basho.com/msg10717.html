<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Exploring Riak, need to confirm throughput</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10717" id="c">
<link rel="index" href="maillist.html#10717" id="i">
<link rel="prev" href="msg10705.html" id="p">
<link rel="next" href="msg10701.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10717.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Exploring+Riak%2C+need+to+confirm+throughput%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Exploring Riak, need to confirm throughput</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Von%5C-Maszewski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Von-Maszewski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130405" rel="nofollow">Fri, 05 Apr 2013 06:52:19 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>If you are not adverse to building from source, you might like the leveldb 
updates slated for 1.4 Riak.  There is an emphasis on write throughput.  The 
best branch for trial would be mv-level-work2 in github's basho/leveldb 
repository.  I suspect you will find about 50% improvement in data ingest over 
periods of 2 hours or more.</pre><pre>

Matthew


On Apr 4, 2013, at 6:22 PM, Matthew MacClary 
&lt;maccl...@lifetime.oregonstate.edu&gt; wrote:

&gt; PBC is certainly something I have on my list of things to explore. 
&gt; Conceptually I am not sure if the speed gains from this protocol will be 
&gt; apparent with large binary payloads. I thought that main speed gains were 
&gt; from 1) more compact binary representation and 2) lower interpretation 
&gt; overhead. In my situation I already have a largish binary payload that does 
&gt; not need to be parsed. I could be wrong and may find that out as I explore 
&gt; this further.
&gt; 
&gt; -Matt
&gt; 
&gt; 
&gt; On Thu, Apr 4, 2013 at 1:45 PM, Shuhao &lt;shu...@shuhaowu.com&gt; wrote:
&gt; Just as a side note, you might want to retry the test with PBC. While I have 
&gt; only did testings with &lt; 10kb documents, my tests indicates that PBC is twice 
&gt; as fast as HTTP in almost all cases.
&gt; 
&gt; Shuhao
&gt; 
&gt; 
&gt; On 13-04-04 04:14 PM, Matthew MacClary wrote:
&gt; Thanks for the feedback. I made two changes to my test setup and saw better
&gt; throughput:
&gt; 
&gt; 1) Don't write to the same key over and over. Updating a key appears to be
&gt; a lot slower than creating a new key
&gt; 
&gt; 2) I used parallel PUTs
&gt; 
&gt; The throughput I was measuring before was about 26MB/s on localhost. With
&gt; these changes it went to around 200MB/s on a disk that can write at about
&gt; 480MB/s. That is more the type of performance I need for the data store we
&gt; have in mind. I am going to proceed with testing on 8 nodes with RAID0
&gt; drives.
&gt; 
&gt; Here are some details of the testing I did if it will help others. I tried
&gt; the test with 1MB, 10MB, and 20MB binary data. I didn't notice a big signal
&gt; with regard to larger objects slowing things down.
&gt; 
&gt; wget
&gt; <a  rel="nofollow" href="http://downloads.basho.com.s3-website-us-east-1.amazonaws.com/riak/1.2/1.2.1/rhel/5/riak-1.2.1-1.el5.x86_64.rpm">http://downloads.basho.com.s3-website-us-east-1.amazonaws.com/riak/1.2/1.2.1/rhel/5/riak-1.2.1-1.el5.x86_64.rpm</a>
&gt; 
&gt; sudo rpm -Uvh riak-1.2.1-1.el5.x86_64.rpm
&gt; /usr/sbin/riak start
&gt; mkdir data-dir &amp;&amp; cd data-dir
&gt; seq -w 0 100 | parallel dd if=/dev/zero of={}.10meg bs=8k count=1280
&gt; http_proxy=   # donâ€™t contact proxy
&gt; time find . -name \*.10meg | parallel -j8 -n1 wget --post-file {}
&gt; <a  rel="nofollow" href="http://127.0.0.1:8098/riak/test1/{}">http://127.0.0.1:8098/riak/test1/{}</a>
&gt; 
&gt; During these tests I saw beam.smp jumping to 350-550 while watching %CPU
&gt; under top. When I was seeing slower thoughput beam.smp was using much less
&gt; CPU.
&gt; 
&gt; Kind regards,
&gt; 
&gt; -Matt
&gt; 
&gt; On Wed, Apr 3, 2013 at 7:20 AM, Reid Draper &lt;reiddra...@gmail.com&gt; wrote:
&gt; 
&gt; inline:
&gt; 
&gt; 
&gt; On Apr 2, 2013, at 6:48 PM, Matthew MacClary &lt;
&gt; maccl...@lifetime.oregonstate.edu&gt; wrote:
&gt; 
&gt; Hi all, I am new to this list. Thanks for taking the time to read my
&gt; questions! I just want to know if the data throughput I am seeing is
&gt; expected for the bitcask backend or if it is too low.
&gt; 
&gt; I am doing the preliminary feasibility study to decide if we should
&gt; implement a Riak data store. Our application involves rendering chunks of
&gt; data that range in size from about 1MB-9MB or so. This rendering work is
&gt; CPU intensive so it is spread over a bunch of compute nodes which write the
&gt; output into a data store.
&gt; 
&gt; 
&gt; Riak is not intended to store objects of this size, not at the moment
&gt; anyway. Riak CS [1], on the other hand, can store files up to several TB.
&gt; That being said, Riak CS may or may not have other qualities  you desire.
&gt; It's a known issue [2] that the Riak object size limitations should be
&gt; better documented.
&gt; 
&gt; 
&gt; After rendering, a second process consumes that data chunks from the data
&gt; store at a rate of about 480MB/s in a streaming configuration so there is &gt;
&gt; 480MB/s of new data coming in at the same time the data is being read.
&gt; 
&gt; 
&gt; Is this a single-socket, or is there some concurrency here?
&gt; 
&gt; 
&gt; My testing so far involves a one node cluster on a dev box. What I wanted
&gt; to show is that Riak writes were limited by the hard disk throughput. So
&gt; far I haven't seen writes to localhost come anywhere close to the hard disk
&gt; throughput:
&gt; 
&gt; $ MYFILE=/tmp/output.png
&gt; $ dd if=/dev/zero of=$MYFILE bs=8k count=256k
&gt; 262144+0 records in
&gt; 262144+0 records out
&gt; 2147483648 bytes (2.1 GB) copied, 4.48906 seconds, 478 MB/s
&gt; $ rm $MYFILE
&gt; 
&gt; So the hard disk throughput is around 478MB/s for this simple write test.
&gt; 
&gt; The next test I did was to load a 39MB binary file into my one node
&gt; cluster. I used a script to do 12 POSTs with curl and 12 POSTSs with wget.
&gt; 
&gt; curl --tcp-nodelay -XPOST <a  rel="nofollow" href="http://${IP}:${PORT}/riak/test/file3">http://${IP}:${PORT}/riak/test/file3</a> \
&gt;      -H &quot;Content-Type:application/octet-stream&quot; \
&gt;      --data-binary @${UPLOAD_FILE} \
&gt;      --write-out &quot;%{speed_upload}\n&quot;
&gt; 
&gt; wget --post-file ${UPLOAD_FILE} <a  rel="nofollow" href="http://127.0.0.1:8098/riak/test/file1">http://127.0.0.1:8098/riak/test/file1</a>
&gt; 
&gt; What I found was that I could get only about 26MB/s with this command line
&gt; testing. Does this seam about right? Should I see an 18x slow down over the
&gt; write speed of the disk drive?
&gt; 
&gt; 
&gt; Was this running the 24 (12 * 2) uploads in serial or parallel? With a
&gt; single-threaded workload, you're unlikely to get Riak to be able to
&gt; saturate a disk. Furthermore, there are design decisions in Riak at the
&gt; moment that make it less than optimal for single objects of 39MB.
&gt; Single-object high throughput (measured in MB) is more in the wheelhouse of
&gt; Riak CS than Riak on it's own, which is primarily designed for low-latency
&gt; and high-throughput (measured in ops/sec). One of the ways that Riak CS
&gt; achieves this on top of Riak is by introducing concurrency between the
&gt; end-user and Riak.
&gt; 
&gt; 
&gt; Thanks for your comments on my application and test approach!
&gt; 
&gt; 
&gt; Hope this helps,
&gt; Reid
&gt; 
&gt; [1] <a  rel="nofollow" href="http://docs.basho.com/riakcs/latest/">http://docs.basho.com/riakcs/latest/</a>
&gt; [2] <a  rel="nofollow" href="https://github.com/basho/basho_docs/issues/256">https://github.com/basho/basho_docs/issues/256</a>
&gt; 
&gt; 
&gt; 
&gt; -Matt
&gt; 
&gt; -----------------------------------------------
&gt; Dev Environment Details:
&gt; dev box  running RHEL6.2, 12 cores, 48GB, 6Gb/s SAS 15k HD
&gt; Riak 1.2.1 from
&gt; <a  rel="nofollow" href="http://downloads.basho.com.s3-website-us-east-1.amazonaws.com/riak/1.2/1.2.1/rhel/5/riak-1.2.1-1.el5.x86_64.rpm">http://downloads.basho.com.s3-website-us-east-1.amazonaws.com/riak/1.2/1.2.1/rhel/5/riak-1.2.1-1.el5.x86_64.rpm</a>
&gt; n_val=1
&gt; r=1
&gt; w=1
&gt; backend=bitcask
&gt; 
&gt; Deploy Environment Details:
&gt;   Node to node bandwidth &gt; 40Gb/s
&gt;   similar config for node servers
&gt;   n_val=3
&gt;   r=1
&gt;   w=1
&gt;   backend=?
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10705.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10717">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10717">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10701.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10643.html">Exploring Riak, need to confirm throughput</a></span> <span class="sender italic">Matthew MacClary</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10649.html">Re: Exploring Riak, need to confirm throughput</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10697.html">Re: Exploring Riak, need to confirm through...</a></span> <span class="sender italic">Matthew MacClary</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10698.html">Re: Exploring Riak, need to confirm thr...</a></span> <span class="sender italic">Shuhao</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10705.html">Re: Exploring Riak, need to confirm...</a></span> <span class="sender italic">Matthew MacClary</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Exploring Riak, need to co...</span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10701.html">Re: Exploring Riak, need to confirm thr...</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10704.html">Re: Exploring Riak, need to confirm...</a></span> <span class="sender italic">Matthew MacClary</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10719.html">Re: Exploring Riak, need to co...</a></span> <span class="sender italic">Reid Draper</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Exploring Riak, need to confirm throughput">
<input type="hidden" name="msgid" value="ED52FC06-63B3-4F65-A637-2A4C45764950@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10717.html">
<input type="submit" value=" Matthew Von-Maszewski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Exploring+Riak%2C+need+to+confirm+throughput%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10705.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10701.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">ED52FC06-63B3-4F65-A637-2A4C45764950@basho.com</li>
</ul>
</div>
</body>
</html>
