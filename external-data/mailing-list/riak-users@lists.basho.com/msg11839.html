<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: combining Riak (CS) and Spark/shark by speaking over s3 protocol</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd12.html#11839" id="c">
<link rel="index" href="mail12.html#11839" id="i">
<link rel="prev" href="msg11834.html" id="p">
<link rel="next" href="msg11842.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11839.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+combining+Riak+%5C%28CS%5C%29+and+Spark%5C%2Fshark+by+speaking+over+s3+protocol%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: combining Riak (CS) and Spark/shark by speaking over s3 protocol</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Dan+Kerrigan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dan Kerrigan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130731" rel="nofollow">Wed, 31 Jul 2013 05:34:15 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Geert-Jan

Riak CS currently doesn't support the S3 Copy command.  Flume and Hadoop
distcp create a temporary object and then attempts to Copy that object to
it's permanent location.  Rename is a Copy then a Delete since the S3 API
doesn't support Rename.</pre><pre>

Regarding efficiency, Riak CS block sizes are 1MB (100 MB object, 100 Riak
Bitcask stored objects) so you can use the Bitcask calculator at [0] to get
a rough estimate requirements to store your particular dataset. Regarding
the impact to read latency, severe is probably not the right word but there
is an impact.  Besides API support, your decision will, in part, come down
to how large your object sizes are going to be.  The Riak FAQ [1] currently
suggests that Riak Object sizes should be less than 10MB.  Riak CS on the
other hand can handle object sizes up to 5TB.  If you are doing multi-key
retrieves for lots of small objects, Riak looks like the right choice
otherwise, go with Riak CS.  Some basic testing would go a long way to find
the balance in your case.

Respectfully -
Dan Kerrigan

[0] <a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/building/planning/bitcask/">http://docs.basho.com/riak/latest/ops/building/planning/bitcask/</a>
[1]
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/community/faqs/developing/#is-there-a-limit-on-the-file-size-that-can-be-stor">http://docs.basho.com/riak/latest/community/faqs/developing/#is-there-a-limit-on-the-file-size-that-can-be-stor</a>



On Wed, Jul 31, 2013 at 4:43 AM, Geert-Jan Brits &lt;gbr...@gmail.com&gt; wrote:

&gt; Dan,
&gt;
&gt; Not sure if I understand the &quot;renaming objects&quot;-problem in Riak CS. Can
&gt; you elaborate?
&gt;
&gt;  &quot;I believe smaller object sizes would not be nearly as efficient as
&gt; working with plain Riak if only because of the overhead incurred by Riak
&gt; CS&quot;. Does this mean lack of efficiency in disk storage, in-mem or both?
&gt; Moreover I'm having this nagging thought that having to dig through the
&gt; manifest to find the blocks will severely impact read latency for
&gt; (multi-key) lookups as opposed to the normal bitcask / levelDB lookup.  Is
&gt; this correct?
&gt;
&gt; Best,
&gt; Geert-Jan
&gt;
&gt;
&gt; 2013/7/30 Dan Kerrigan &lt;dan.kerri...@gmail.com&gt;
&gt;
&gt;&gt; Geert-Jan -
&gt;&gt;
&gt;&gt; We're currently working on a somewhat similar project to integrate Flume
&gt;&gt; to ingest data into Riak CS for later processing using Hadoop.  The
&gt;&gt; limitations of HDFS/S3, when using the s3:// or s3n:// URIs, seem to
&gt;&gt; revolve around renaming objects (copy/delete) in Riak CS.  If you can avoid
&gt;&gt; that, this link should work fine.
&gt;&gt;
&gt;&gt; Regarding how data is stored in Riak CS, the data block storage is
&gt;&gt; Bitcask with manifest storage being held in LevelDB.  Riak CS is optimized
&gt;&gt; for larger object sizes and I believe smaller object sizes would not be
&gt;&gt; nearly as efficient as working with plain Riak if only because of the
&gt;&gt; overhead incurred by Riak CS. The benefits of Riak generally carry over to
&gt;&gt; Riak CS so there shouldn't be any need to worry about losing raw power.
&gt;&gt;
&gt;&gt; Respectfully -
&gt;&gt; Dan Kerrigan
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Jul 30, 2013 at 2:21 PM, gbrits &lt;gbr...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; This may be totally missing the mark but I've been reading up on ways to
&gt;&gt;&gt; do
&gt;&gt;&gt; fast iterative processing in Storm or Spark/shark, with the ultimate
&gt;&gt;&gt; goal of
&gt;&gt;&gt; results ending up in Riak for fast multi-key retrieval.
&gt;&gt;&gt;
&gt;&gt;&gt; I want this setup to be as lean as possible for obvious reasons so I've
&gt;&gt;&gt; started to look more closely at the possible Riak CS / Spark combo.
&gt;&gt;&gt;
&gt;&gt;&gt; Apparently, please correct if wrong, Riak CS sits on top of Riak and is
&gt;&gt;&gt; S3-api compliant. Underlying the db for the objects is levelDB (which
&gt;&gt;&gt; would
&gt;&gt;&gt; have been my choice anyway, bc of the low in-mem key overhead) Apparently
&gt;&gt;&gt; Bitcask is also used, although it's not clear to me what for exactly.
&gt;&gt;&gt;
&gt;&gt;&gt; At the same time Spark (with Shark on top, which is what Hive is for
&gt;&gt;&gt; Hadoop
&gt;&gt;&gt; if that in any way makes things clearer) can use HDFS or S3 as it's so
&gt;&gt;&gt; called 'deep store'.
&gt;&gt;&gt;
&gt;&gt;&gt; Combining this it seems, Riak CS and Spark/Shark could be a nice pretty
&gt;&gt;&gt; tight combo providing interative and adhoc quering through Shark + all
&gt;&gt;&gt; the
&gt;&gt;&gt; excellent stuff of Riak through the S3 protocol which they both speak .
&gt;&gt;&gt;
&gt;&gt;&gt; Is this correct?
&gt;&gt;&gt; Would I loose any of the raw power of Riak when going with Riak CS?
&gt;&gt;&gt; Anyone
&gt;&gt;&gt; ever tried this combo?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Geert-Jan
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; View this message in context:
&gt;&gt;&gt; <a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/combining-Riak-CS-and-Spark-shark-by-speaking-over-s3-protocol-tp4028621.html">http://riak-users.197444.n3.nabble.com/combining-Riak-CS-and-Spark-shark-by-speaking-over-s3-protocol-tp4028621.html</a>
&gt;&gt;&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11834.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd12.html#11839">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail12.html#11839">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11842.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11817.html">combining Riak (CS) and Spark/shark by speaking over s3 pr...</a></span> <span class="sender italic">gbrits</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11819.html">Re: combining Riak (CS) and Spark/shark by speaking o...</a></span> <span class="sender italic">Dan Kerrigan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11824.html">Re: combining Riak (CS) and Spark/shark by speaki...</a></span> <span class="sender italic">Mark Hamstra</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11835.html">Re: combining Riak (CS) and Spark/shark by sp...</a></span> <span class="sender italic">gbrits</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11834.html">Re: combining Riak (CS) and Spark/shark by speaki...</a></span> <span class="sender italic">Geert-Jan Brits</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: combining Riak (CS) and Spark/shark by sp...</span> <span class="sender italic">Dan Kerrigan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11842.html">Re: combining Riak (CS) and Spark/shark b...</a></span> <span class="sender italic">gbrits</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: combining Riak (CS) and Spark/shark by speaking over s3 protocol">
<input type="hidden" name="msgid" value="CAOhQPzsYFRhSMX5Mnf5zyxSOqqiJz5SKzZ_SNj9pgmSesGYuVw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11839.html">
<input type="submit" value=" Dan Kerrigan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+combining+Riak+%5C%28CS%5C%29+and+Spark%5C%2Fshark+by+speaking+over+s3+protocol%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11834.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11842.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAOhQPzsYFRhSMX5Mnf5zyxSOqqiJz5SKzZ_SNj9pgmSesGYuVw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
