<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Number of buckets...</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16384" id="c">
<link rel="index" href="maillist.html#16384" id="i">
<link rel="prev" href="msg16379.html" id="p">
<link rel="next" href="msg16380.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16384.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Number+of+buckets...%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Number of buckets...</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Dmitri+Zagidulin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dmitri Zagidulin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150807" rel="nofollow">Fri, 07 Aug 2015 09:52:07 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Joe,

For most use cases, there would be no limit to the number of buckets you
can have on a level db cluster. (Aside from obvious limits of, eventually
you'd run out of disk space for all the objects).</pre><pre>

Riak essentially treats the bucket as merely a prefix for the key. (It
basically concatenates the bucket type, the bucket, and the key, and then
hashes /that/ to determine where to place the object on the ring). So,
there isn't a data structure anywhere on disk or in memory that holds a
list of buckets on the cluster, to impose a limit.

The exception to that is when you set non-standard properties on specific
buckets. For example, if you have siblings turned on for all of your
buckets, but you have a 'logs' bucket that will only have immutable data,
it makes sense to set allow_mult=false for just the logs bucket, using the
Set Bucket Properties api call (for example,
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/references/http/set-bucket-props/">http://docs.basho.com/riak/latest/dev/references/http/set-bucket-props/</a> ).

Setting custom properties for a handful of buckets is not a problem. But if
you decide to do that for hundreds of buckets, it becomes an issue. Whereas
before, buckets were just a &quot;stateless&quot; prefix to the key, now the custom
properties do actually live in a data structure on the cluster, and have to
be gossiped around the ring. And as you add more custom buckets, that
gossiped structure becomes larger and larger.

If you do need to set custom properties on hundreds of buckets (such as
specifying a Search index on them, for example), consider using Bucket
Types instead. Bucket Type custom settings and metadata use a different
persistence mechanism than bucket settings, and there's a lot more room for
custom types.  In addition, once you set up a custom bucket type, all of
the buckets /within/ that type get those settings essentially for free. See
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/advanced/bucket-types/">http://docs.basho.com/riak/latest/dev/advanced/bucket-types/</a> for more
discussion.

The other exception that the docs mention (about the file handles etc),
comes into play when you use a custom Multi backend (see
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/advanced/backends/multi/">http://docs.basho.com/riak/latest/ops/advanced/backends/multi/</a> ) for
individual buckets.
You can, for example, say in the config that you want your 'users' bucket
to live in a custom LevelDB backend, separate from the rest of your levelDB
data. And it'll have a separate data directory (which you can house on a
different disk, etc). Which is where the file handle limit comes in. If you
intend to spin up multiple custom backends on your cluster, you want to be
sure the file system can handle opening that many files. The cases where
you'd want to do that are extremely rare, though.

So, to summarize: In most cases, there is no theoretical limit on the
number of buckets you can have.
If you must have custom settings on individual buckets, think tens and not
hundreds or thousands. Better yet, use custom settings on Bucket Types,
instead.

Does that answer your question?

Dmitri

On Fri, Aug 7, 2015 at 10:56 AM, Joe Olson &lt;technol...@nododos.com&gt; wrote:

&gt; From <a  rel="nofollow" href="http://docs.basho.com/riak/latest/theory/concepts/:">http://docs.basho.com/riak/latest/theory/concepts/:</a>
&gt;
&gt; &quot;In general, large numbers of buckets within a Riak cluster is not a
&gt; problem. In practice, there are two potential restrictions on the maximum
&gt; number of buckets a Riak cluster can handle&quot;
&gt;
&gt; Is there any further, more specific documentation on this that I could
&gt; read?
&gt;
&gt; I am interested in understanding the upper limits of the number of buckets
&gt; for say, a 10 node, ring_size = 64 (or 128) LevelDB backed Riak cluster.
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16379.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16384">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16384">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16380.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16379.html">Number of buckets...</a></span> <span class="sender italic">Joe Olson</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Number of buckets...</span> <span class="sender italic">Dmitri Zagidulin</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Number of buckets...">
<input type="hidden" name="msgid" value="CA+TO3kVUHeWYMQncgmf2YGw0DzMX7LeP2R3b-CnOwMvao9QXNw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16384.html">
<input type="submit" value=" Dmitri Zagidulin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Number+of+buckets...%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16379.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16380.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CA+TO3kVUHeWYMQncgmf2YGw0DzMX7LeP2R3b-CnOwMvao9QXNw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
