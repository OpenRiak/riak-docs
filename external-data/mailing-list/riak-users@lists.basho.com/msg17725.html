<!DOCTYPE html>
<html lang="en">
<head>
<title>Hinted handoff failed because of tcp errors</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17725" id="c">
<link rel="index" href="maillist.html#17725" id="i">
<link rel="prev" href="msg17723.html" id="p">
<link rel="next" href="msg17726.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17725.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Hinted+handoff+failed+because+of+tcp+errors%22&amp;o=newest" rel="nofollow"><span itemprop="name">Hinted handoff failed because of tcp errors</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Maclear%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Maclear</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20161101" rel="nofollow">Tue, 01 Nov 2016 00:44:49 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Good Day,

We have a 4 node riak cluster running inside AWS. The riak is riak-kv 2.1.2
with AAE enabled on Ubuntu 14.04.4 LTS</pre><pre>

We are in the process of replacing one node with another using the process
described here:

<a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.1.4/using/cluster-operations/replacing-node/">http://docs.basho.com/riak/kv/2.1.4/using/cluster-operations/replacing-node/</a>

We have successfully replaced two of the nodes so far but we are having a
problem with the third. If we look at /var/log/riak/console.log we see the
start of the hinted handoff, and some time later (sometimes minutes and
sometimes hours) we see:

2016-10-31 06:30:40.090 [error]
&lt;0.19834.2101&gt;@riak_core_handoff_sender:start_fold:272
hinted transfer of riak_kv_vnode from 'r...@aew54.miranetworks.net'
274031556999544297163190906134303066185487351808 to '
r...@aew75.miranetworks.net' 274031556999544297163190906134303066185487351808
failed because of TCP recv timeout
2016-10-31 06:30:40.090 [error]
&lt;0.187.0&gt;@riak_core_handoff_manager:handle_info:303
An outbound handoff of partition riak_kv_vnode
274031556999544297163190906134303066185487351808 was terminated for reason:
{shutdown,timeout}

So the handoff was terminated due to a tcp timeout. The handoff then starts
again.

This has been going on for some times (about two weeks now).

The current member status is as follows:

riak-admin member-status
================================= Membership
==================================
Status     Ring    Pending    Node
-------------------------------------------------------------------------------
leaving     0.0%      --      'r...@aew54.miranetworks.net'
valid      25.0%      --      'r...@aew59.miranetworks.net'
valid      25.0%      --      'r...@aew73.miranetworks.net'
valid      25.0%      --      'r...@aew74.miranetworks.net'
valid      25.0%      --      'r...@aew75.miranetworks.net'
-------------------------------------------------------------------------------
Valid:4 / Leaving:1 / Exiting:0 / Joining:0 / Down:0


Here are some questions:

1. What is the default tcp timeout?
2. Is there any way to increase this timeout?
3. Is there any way to increase the rate of handoff?
4. Are there any other parameters we can tune to try and avoid this?

The output from riak-admin transfers is as follows:

'r...@aew54.miranetworks.net' waiting to handoff 1 partitions

Active Transfers:

transfer type: hinted
vnode type: riak_kv_vnode
partition: 274031556999544297163190906134303066185487351808
started: 2016-11-01 05:30:47 [2.10 hr ago]
last update: 2016-11-01 07:36:51 [3.03 s ago]
total size: 78393086512 bytes
objects transferred: 11440967

                         1513 Objs/s
riak@aew54.miranetworks.n  =======&gt;  riak@aew75.miranetworks.n
et                                   et
        |======                                     |  15%
                          1.53 MB/s


Thanks,
Ryan Maclear
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17723.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17725">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17725">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17726.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Hinted handoff failed because of tcp errors</span> <span class="sender italic">Ryan Maclear</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17726.html">Re: Hinted handoff failed because of tcp errors</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17727.html">Re: Hinted handoff failed because of tcp errors</a></span> <span class="sender italic">Ryan Maclear</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Hinted handoff failed because of tcp errors">
<input type="hidden" name="msgid" value="CAAmv4XBibfrWGCYQb-Vg0rDB5XaDDq7qbRriMMVKEX20uc1rwg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17725.html">
<input type="submit" value=" Ryan Maclear ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Hinted+handoff+failed+because+of+tcp+errors%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17723.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17726.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAAmv4XBibfrWGCYQb-Vg0rDB5XaDDq7qbRriMMVKEX20uc1rwg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
