<!DOCTYPE html>
<html lang="en">
<head>
<title>Merge times.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03947" id="c">
<link rel="index" href="maillist.html#03947" id="i">
<link rel="prev" href="msg03946.html" id="p">
<link rel="next" href="msg03948.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03947.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Merge+times.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Merge times.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Misha+Gorodnitzky%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Misha Gorodnitzky</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110706" rel="nofollow">Wed, 06 Jul 2011 16:21:12 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello fellow Riakers,

What are the factors that affect how long it takes Riak to do a merge?</pre><pre>

In our scenario, doing a merge takes about an hour per node, and that's 
regardless of wether that's a result of Riak deciding to do a merge on it's 
own, us forcing a merge (which we do nightly via cron) or the Riak node has 
been restarted (in which case I believe it also merges the active file). Our 
feeling is that it's the sheer number of keys, and the size of the associated 
data, that's taking so much time[1], as opposed to the size of the journal 
which is being merged.

Sean kindly suggested to us in IRC that reducing the max_file_size setting 
could help because it will keep our data files smaller, meaning that when we 
restart there will hopefully be less data in the active file that just got 
rolled over. But if it's already taking us nearly an hour to merge when we 
don't restart, it sounds to me like a smaller active file won't help. Is that 
right?


--Misha


[1] We know that we have a lot of old cruft hanging around that we can delete, 
we're in the process of changing our Riak config so that we can have a backend 
with expiry_secs set available. Typically our bitcask data dir takes up 
62GB-72GB per node (~2.5GB per part.), although after restarting and the 
subsequent merge we're seeing this drop to ~32GB per node (~1.1GB per part.).


--

Misha Gorodnitzky | Senior Application Developer | Mobile Interactive Group

M: +447760208493   T: +442079215590
A: The Tower Building, 7th Floor, 11 York Road, London, SE1 7NX
W: www.migcan.com   Twitter: @migcan



This message contains confidential information and is intended only for the 
individual named. If you are not the named addressee you should not 
disseminate, distribute or copy this e-mail. Please notify the sender 
immediately by e-mail if you have received this e-mail by mistake and delete 
this e-mail from your system. E-mail transmission cannot be guaranteed to be 
secure or error-free as information could be intercepted, corrupted, lost, 
destroyed, arrive late or incomplete, or contain viruses. Mobile Interactive 
Group therefore does not accept liability for any errors or omissions in the 
contents of this message, which arise as a result of e-mail transmission. If 
verification is required please request a hard-copy version.

The statements and opinions expressed in this message are those of the author 
and do not necessarily reflect those of the author's employer - Mobile 
Interactive Group. Mobile Interactive Group does not take any responsibility 
for the views of the author and reserves the right to monitor, review and 
retain all emails entering its systems, in accordance with local law.

Registered in England and Wales - Company Number 4672067

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03946.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03947">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03947">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03948.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Merge times.">
<input type="hidden" name="msgid" value="5CF20009-D2C7-46BF-A0E1-BA120FA6E612@migcan.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03947.html">
<input type="submit" value=" Misha Gorodnitzky ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Merge+times.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03946.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03948.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5CF20009-D2C7-46BF-A0E1-BA120FA6E612@migcan.com</li>
</ul>
</div>
</body>
</html>
