<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak 1.0.1 w/search nodes crashing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05395" id="c">
<link rel="index" href="maillist.html#05395" id="i">
<link rel="prev" href="msg05348.html" id="p">
<link rel="next" href="msg05397.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05395.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+1.0.1+w%5C%2Fsearch+nodes+crashing%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak 1.0.1 w/search nodes crashing</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kelly+McLaughlin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kelly McLaughlin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111031" rel="nofollow">Mon, 31 Oct 2011 13:47:40 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Gordon,

I'm looking at the info you provided about the problem and I suspect that it is 
related to your use of 90 as the ring creation size. We generally recommend the 
value to be a power of 2, though we do not explicitly enforce that in the code. 
If this is a development cluster the simplest path may be to wipe out all of 
the cluster data and ring information, change the ring_creation_size to 128 
(for example) on each node, reform the cluster and reinsert the data. </pre><pre>

Another path to resolution is to use the riak-admin backup option to backup 
your data, change the ring_creation_size to 128, remove the existing ring data 
(i.e. the data/ring/ subdirectory where your riak data lives). Do this for each 
node in the cluster. Then restore the data on each node with riak-admin restore 
and rejoin the nodes to form a cluster again. Unfortuately, search data is not 
handled by the current backup and restore functionality so you will need to 
remove the search data from data/merge-index and then you will have to reindex 
your documents. Support for backup and restore of search data is coming, but it 
is just not there yet. Hope this helps.

Kelly

On Oct 28, 2011, at 12:46 PM, Gordon Tillman wrote:

&gt; Howdy Gang,
&gt; 
&gt; We have a 3 node Riak 1.0.1 with search enabled and are seeing the following 
&gt; errors in the Riak log file:
&gt; 
&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt; 2011-10-28 11:04:21.900 [error] &lt;0.993.0&gt; gen_fsm &lt;0.993.0&gt; in state 
&gt; initialize terminated with reason: bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2
&gt; 2011-10-28 11:04:21.906 [error] &lt;0.993.0&gt; CRASH REPORT Process &lt;0.993.0&gt; with 
&gt; 0 neighbours crashed with reason: bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2
&gt; 2011-10-28 11:04:21.930 [error] &lt;0.257.0&gt; Supervisor riak_kv_keys_fsm_sup had 
&gt; child undefined started with {riak_core_coverage_fsm,start_link,undefined} at 
&gt; &lt;0.993.0&gt; exit with reason bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2 in context child_terminated
&gt; 
&gt; ==&gt; /var/log/riak/crash.log &lt;==
&gt; 2011-10-28 11:04:21 =ERROR REPORT====
&gt; ** State machine &lt;0.993.0&gt; terminating 
&gt; ** Last event in was timeout
&gt; ** When State == initialize
&gt; **      Data  == 
&gt; {state,undefined,riak_kv_keys_fsm,{state,plain,{raw,60225046,&lt;0.465.0&gt;}},3,riak_kv,all,1,{'riak_kv_listkeys_req_v3',&lt;&lt;&quot;queue&quot;&gt;&gt;,none},60225046,undefined,0,60000,riak_kv_vnode_master}
&gt; ** Reason for termination = 
&gt; ** 
&gt; {badarg,[{erlang,hd,[[]]},{riak_core_ring,index_owner,2},{riak_core_coverage_plan,'-create_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak_core_coverage_fsm,initialize,2},{gen_fsm,handle_msg,7},{proc_lib,init_p_do_apply,3}]}
&gt; 2011-10-28 11:04:21 =CRASH REPORT====
&gt;   crasher:
&gt;     initial call: riak_core_coverage_fsm:init/1
&gt;     pid: &lt;0.993.0&gt;
&gt;     registered_name: []
&gt;     exception exit: 
&gt; {badarg,[{erlang,hd,[[]]},{riak_core_ring,index_owner,2},{riak_core_coverage_plan,'-create_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak_core_coverage_fsm,initialize,2},{gen_fsm,handle_msg,7},{proc_lib,init_p_do_apply,3}]}
&gt;       in function  gen_fsm:terminate/7
&gt;       in call from proc_lib:init_p_do_apply/3
&gt;     ancestors: [riak_kv_keys_fsm_sup,riak_kv_sup,&lt;0.177.0&gt;]
&gt;     messages: []
&gt;     links: [&lt;0.257.0&gt;]
&gt;     dictionary: []
&gt;     trap_exit: false
&gt;     status: running
&gt;     heap_size: 4181
&gt;     stack_size: 24
&gt;     reductions: 86192
&gt;   neighbours:
&gt; 2011-10-28 11:04:21 =SUPERVISOR REPORT====
&gt;      Supervisor: {local,riak_kv_keys_fsm_sup}
&gt;      Context:    child_terminated
&gt;      Reason:     
&gt; {badarg,[{erlang,hd,[[]]},{riak_core_ring,index_owner,2},{riak_core_coverage_plan,'-create_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak_core_coverage_fsm,initialize,2},{gen_fsm,handle_msg,7},{proc_lib,init_p_do_apply,3}]}
&gt;      Offender:   
&gt; [{pid,&lt;0.993.0&gt;},{name,undefined},{mfargs,{riak_core_coverage_fsm,start_link,undefined}},{restart_type,temporary},{shutdown,5000},{child_type,worker}]
&gt; 
&gt; 
&gt; ==&gt; /var/log/riak/erlang.log.3 &lt;==
&gt; 11:04:21.900 [error] gen_fsm &lt;0.993.0&gt; in state initialize terminated with 
&gt; reason: bad argument in call to erlang:hd([]) in riak_core_ring:index_owner/2
&gt; 11:04:21.906 [error] CRASH REPORT Process &lt;0.993.0&gt; with 0 neighbours crashed 
&gt; with reason: bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2 
&gt; 11:04:21.930 [error] Supervisor riak_kv_keys_fsm_sup had child undefined 
&gt; started with {riak_core_coverage_fsm,start_link,undefined} at &lt;0.993.0&gt; exit 
&gt; with reason bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2 in context child_terminated
&gt; 
&gt; ==&gt; /var/log/riak/error.log &lt;==
&gt; 2011-10-28 11:04:21.900 [error] &lt;0.993.0&gt; gen_fsm &lt;0.993.0&gt; in state 
&gt; initialize terminated with reason: bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2
&gt; 2011-10-28 11:04:21.906 [error] &lt;0.993.0&gt; CRASH REPORT Process &lt;0.993.0&gt; with 
&gt; 0 neighbours crashed with reason: bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2
&gt; 2011-10-28 11:04:21.930 [error] &lt;0.257.0&gt; Supervisor riak_kv_keys_fsm_sup had 
&gt; child undefined started with {riak_core_coverage_fsm,start_link,undefined} at 
&gt; &lt;0.993.0&gt; exit with reason bad argument in call to erlang:hd([]) in 
&gt; riak_core_ring:index_owner/2 in context child_terminated
&gt; 
&gt; Would anyone be able to clue me in as to the cause?  I have the log snippet, 
&gt; status, and cluster info all available online.
&gt; 
&gt; LOG:
&gt; <a  rel="nofollow" href="https://gist.github.com/1322665">https://gist.github.com/1322665</a>
&gt; 
&gt; STATUS:
&gt; <a  rel="nofollow" href="https://gist.github.com/1322680">https://gist.github.com/1322680</a>
&gt; 
&gt; CLUSTER INFO:
&gt; 
&gt; This was to big to fit in a gist (1.7MB):
&gt; 
&gt; <a  rel="nofollow" href="https://eval.mezeo.net/v2/files/A725C464-0194-11E1-9D55-0030485F2412/content/inline/cluster_info.txt">https://eval.mezeo.net/v2/files/A725C464-0194-11E1-9D55-0030485F2412/content/inline/cluster_info.txt</a>
&gt; 
&gt; Thanks a bunch!
&gt; 
&gt; --gordon
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05348.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05395">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05395">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05397.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05348.html">Riak 1.0.1 w/search nodes crashing</a></span> <span class="sender italic">Gordon Tillman</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak 1.0.1 w/search nodes crashing</span> <span class="sender italic">Kelly McLaughlin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05397.html">Re: Riak 1.0.1 w/search nodes crashing</a></span> <span class="sender italic">Gordon Tillman</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak 1.0.1 w/search nodes crashing">
<input type="hidden" name="msgid" value="FA6502AA-3AA0-4745-B148-B3AEF3EC80B4@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05395.html">
<input type="submit" value=" Kelly McLaughlin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+1.0.1+w%5C%2Fsearch+nodes+crashing%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05348.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05397.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">FA6502AA-3AA0-4745-B148-B3AEF3EC80B4@basho.com</li>
</ul>
</div>
</body>
</html>
