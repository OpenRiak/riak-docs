<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Faster way to store a lot of small data?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06720" id="c">
<link rel="index" href="maillist.html#06720" id="i">
<link rel="prev" href="msg06719.html" id="p">
<link rel="next" href="msg06722.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06720.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Faster+way+to+store+a+lot+of+small+data%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Faster way to store a lot of small data?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Eric+Fong%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Eric Fong</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120223" rel="nofollow">Thu, 23 Feb 2012 20:02:10 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Russell

I end up deleted all my old data and start from fresh db.
And use your script to put 23622 pngs (861M) into my localhost riak again.
It is much faster but also make the riak stop to response and the riak/data
folder getting larger and larger (5GB now).
Seems something wrong...</pre><pre>

I stopped the script but seems riak is still eating my 100% cpu and disk
space.
My server is something like 6 cpu and 48GB Ram already. *_*

Eric

On Fri, Feb 24, 2012 at 10:08 AM, Eric Fong &lt;eri...@gmail.com&gt; wrote:

&gt; Hi
&gt;
&gt; I have a bash script put.sh:
&gt;
&gt; ----------------------------------------------------------------------------------------------------------
&gt; # upload file
&gt; #
&gt; # Bulk Upload:
&gt; # put.sh local-folder bucket-name prefix-inside-bucket
&gt; #
&gt; file=$1
&gt; bucket=$2
&gt; prefix=$3
&gt;
&gt; if [ -d &quot;$file&quot; ]; then
&gt;   prefixRemove=$file find $file -type f -exec $0 {} $bucket $prefix \;
&gt;   exit 0
&gt; fi
&gt;
&gt; if [ -z &quot;$type&quot; ]; then
&gt; type=`file -i $file | awk '{print $2}'`
&gt; fi
&gt;
&gt; # escape
&gt; bucket=$(echo $bucket | sed 's/~/~~/g' | sed 's/\/\+/~/g' )
&gt;
&gt; key=$file
&gt; key=$(echo $key | sed 's/^\.\/\+//g')
&gt; if [ -n &quot;$prefixRemove&quot; ]; then
&gt;   prefixRemove=$(echo $prefixRemove | sed 's/\(\/\)/\\\1/g')
&gt;   key=$(echo $key | eval &quot;sed 's/$prefixRemove//g'&quot;)
&gt; fi
&gt; key=$(echo $prefix$key | sed 's/~/~~/g' | sed 's/\/\+/~/g')
&gt;
&gt; #-H &quot;x-riak-index-date_int:`date +%s`&quot;
&gt; if [ -z &quot;$test&quot; ]; then
&gt;   curl -s -X PUT -T ${file} -H content-type:${type}
&gt; <a  rel="nofollow" href="http://magic1:8098/buckets/${bucket}/keys/${key}">http://magic1:8098/buckets/${bucket}/keys/${key}</a>
&gt; fi
&gt; echo <a  rel="nofollow" href="http://magic1:8098/buckets/${bucket}/keys/${key}">http://magic1:8098/buckets/${bucket}/keys/${key}</a>
&gt;
&gt; ----------------------------------------------------------------------------------------------------------
&gt;
&gt;
&gt; I think it is similar to what Russell did.
&gt; I think xargs -P is the key!
&gt;
&gt; I have one machine and all bucket setting is default. Then, I think the N
&gt; is 3
&gt;
&gt;
&gt; Actually, I found another problem. Last night, I started to upload a lot
&gt; of small pngs into riak (total size is 900MB and each of them are 10KB).
&gt; This morning, I come back and found that riak eat up 40GB of my harddisk
&gt; and it is 100% full. I try to restart riak few times. Still cannot get the
&gt; whole riak work well again. I am using levelDB. Try to recover the whole
&gt; system first.
&gt;
&gt; Eric
&gt;
&gt;
&gt; On Thu, Feb 23, 2012 at 10:59 PM, Russell Brown &lt;russel...@basho.com&gt;wrote:
&gt;
&gt;&gt;
&gt;&gt; On 23 Feb 2012, at 14:37, Jeremiah Peschka wrote:
&gt;&gt;
&gt;&gt; Out of interest, to those of us who are rusty on their shell scripting,
&gt;&gt; could you share the aforementioned script?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;      find png_test  -name &quot;*.png&quot; -print0 | xargs -0 -P 4 -I file curl -X
&gt;&gt; PUT localhost:8098/riak/file --data-binary @file -H&quot;Content-Type: image/png&quot;
&gt;&gt;
&gt;&gt; I'm a shell scripting n00b so there is probably a much better way. In
&gt;&gt; this case png_test is a directory I created with 1000*10k pngs. So the
&gt;&gt; bucket name is the directory name 'png_test'. Only works for a flat dir, it
&gt;&gt; was just something to check the times that Eric mentioned, please don't
&gt;&gt; think it is like a working script or anything.
&gt;&gt;
&gt;&gt; Cheers
&gt;&gt;
&gt;&gt; Russell
&gt;&gt;
&gt;&gt;
&gt;&gt; ---
&gt;&gt; Jeremiah Peschka
&gt;&gt; Managing Director, Brent Ozar PLF, LLC
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Feb 23, 2012 at 2:02 AM, Russell Brown &lt;russel...@basho.com&gt;wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Eric,
&gt;&gt;&gt;
&gt;&gt;&gt; On 23 Feb 2012, at 08:45, Eric Fong wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; &gt; Hi
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Help. I want to store few thousands of small png (each of them will
&gt;&gt;&gt; just be 10K) into riak.
&gt;&gt;&gt; &gt; But I find that is really slow (1 to 2 second for one png).
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Currently, I use a bash script to find and loop the directory
&gt;&gt;&gt; &gt; And curl PUT the png onto riak.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Do we have a bulk upload or will it be faster if I use erlang or or
&gt;&gt;&gt; driver?
&gt;&gt;&gt; &gt; I need to upload 1000 small png within one minute. Can it be done?
&gt;&gt;&gt;
&gt;&gt;&gt; I imagine it is possible. I just managed to do it in 10seconds on my
&gt;&gt;&gt; laptop, single node with n=3 and r=2 using xargs and curl to put in
&gt;&gt;&gt; parallel.
&gt;&gt;&gt;
&gt;&gt;&gt; How many nodes do you have? What is your n-val?
&gt;&gt;&gt;
&gt;&gt;&gt; cheers
&gt;&gt;&gt;
&gt;&gt;&gt; Russell
&gt;&gt;&gt;
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Currently, I am on riak 1.01 and levelDB backend.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Thanks a lot!
&gt;&gt;&gt; &gt; --
&gt;&gt;&gt; &gt; Best Regards,
&gt;&gt;&gt; &gt; Eric Fong
&gt;&gt;&gt; &gt; _______________________________________________
&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Best Regards,
&gt; Eric Fong
&gt;



-- 
Best Regards,
Eric Fong
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06719.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06720">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06720">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06722.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06704.html">Faster way to store a lot of small data?</a></span> <span class="sender italic">Eric Fong</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06706.html">Re: Faster way to store a lot of small data?</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06709.html">Re: Faster way to store a lot of small data?</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06710.html">Re: Faster way to store a lot of small data?</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06719.html">Re: Faster way to store a lot of small d...</a></span> <span class="sender italic">Eric Fong</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Faster way to store a lot of sm...</span> <span class="sender italic">Eric Fong</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06722.html">Re: Faster way to store a lot o...</a></span> <span class="sender italic">István</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06723.html">Re: Faster way to store a l...</a></span> <span class="sender italic">Eric Fong</span></li>
<li class="icons-email"><span class="subject"><a href="msg06724.html">Re: Faster way to store a l...</a></span> <span class="sender italic">István</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Faster way to store a lot of small data?">
<input type="hidden" name="msgid" value="CAKjn7sJcv=b2hDTxCapxSZYQS7BKN9G1B6u9rYfnsNm8wpXjbA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06720.html">
<input type="submit" value=" Eric Fong ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Faster+way+to+store+a+lot+of+small+data%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06719.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06722.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAKjn7sJcv=b2hDTxCapxSZYQS7BKN9G1B6u9rYfnsNm8wpXjbA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
