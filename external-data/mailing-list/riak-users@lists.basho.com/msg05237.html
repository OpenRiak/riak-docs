<!DOCTYPE html>
<html lang="en">
<head>
<title>Search failure: stream_timeout</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05237" id="c">
<link rel="index" href="maillist.html#05237" id="i">
<link rel="prev" href="msg05236.html" id="p">
<link rel="next" href="msg05238.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05237.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Search+failure%5C%3A+stream_timeout%22&amp;o=newest" rel="nofollow"><span itemprop="name">Search failure: stream_timeout</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Elias+Levy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Elias Levy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111021" rel="nofollow">Fri, 21 Oct 2011 14:23:51 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I am trying to make use of search in a Riak 1.0.0 cluster loaded with some
data using the leveldb backend through the multibackend, with search turned,
and I am having some trouble.</pre><pre>

I am getting the following error:

2011-10-21 20:47:49.268 [error] emulator Error in process &lt;0.32444.102&gt; on
node 'riak@10.214.219.175' with exit value:
{{nocatch,stream_timeout},[{riak_search_op_utils,gather_stream_results,4}]}

The Ruby client dies with a EOFError: end of file reached.

There are also a few of these in the logs:

2011-10-21 20:47:45.624 [info]
&lt;0.88.0&gt;@riak_core_sysmon_handler:handle_event:85 monitor long_gc
&lt;0.32535.102&gt; [{initial_call,{mi_server,range,10erator/2-fun-1-',2}}]
[{timeout,51},{old_heap_block_size,0},{heap_block_size,1346269},{mbuf_size,0},{stack_size,13},{old_heap_size,0},{heap_size,931549}]
2011-10-21 20:47:45.873 [info]
&lt;0.88.0&gt;@riak_core_sysmon_handler:handle_event:85 monitor long_gc
&lt;0.32523.102&gt; [{initial_call,{mi_server,range,10ator,2}}]
[{timeout,54},{old_heap_block_size,0},{heap_block_size,2103540},{mbuf_size,0},{stack_size,19},{old_heap_size,0},{heap_size,903282}]

I tracked down the issue to part of my query where I try to limited the
results by time using a range.  Depending how the query is generated, I may
want a specific range, or records with a timestamp less than some value or
timestamps greater than some value.

I found that if I limited the timestamps to a range that covers a reasonable
number of records the query succeeds.  But if the query is of the
form 'ts:[0 TO 1319228408]', then Riak generates that error and the client
connection it shutdown.  I am guessing that that queries covers too many
records, which is causing the nodes to take longer than expected to respond,
and that some timeout is being reached and Riak kills the query.  Is that
correct?

If so, is there a way to execute a query matching an integer field with a &lt;
or &gt; that may match many records (millions)?

Is there a way to increase whatever timeout is being reached?

Also, while looking at the Solr query syntax I notice that you can use '*'
instead of trying to use a min or max value in the range to emulate &lt; or &gt;,
e.g. 'ts:* TO 1319228408]', but Riak does not support this syntax.

Elias Levy
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05236.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05237">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05237">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05238.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Search failure: stream_timeout</span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05238.html">Re: Search failure: stream_timeout</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05333.html">Re: Search failure: stream_timeout</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05334.html">Re: Search failure: stream_timeout</a></span> <span class="sender italic">Elias Levy</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Search failure: stream_timeout">
<input type="hidden" name="msgid" value="CAFDmHdPVQnCXoSi=d8TkRth5_cnDMQr4tqdZQQosOXw6c6M+oA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05237.html">
<input type="submit" value=" Elias Levy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Search+failure%5C%3A+stream_timeout%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05236.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05238.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAFDmHdPVQnCXoSi=d8TkRth5_cnDMQr4tqdZQQosOXw6c6M+oA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
