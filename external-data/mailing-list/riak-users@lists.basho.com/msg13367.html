<!DOCTYPE html>
<html lang="en">
<head>
<title>Single node causing cluster to be extremely slow (leveldb)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd4.html#13367" id="c">
<link rel="index" href="mail5.html#13367" id="i">
<link rel="prev" href="msg13366.html" id="p">
<link rel="next" href="msg13368.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13367.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Single+node+causing+cluster+to+be+extremely+slow+%5C%28leveldb%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Single node causing cluster to be extremely slow (leveldb)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+McKibben%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean McKibben</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140109" rel="nofollow">Thu, 09 Jan 2014 18:34:29 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>We have a 5 node cluster using elevelDB (1.4.2) and 2i, and this afternoon it 
started responding extremely slowly. CPU on member 4 was extremely high and we 
restarted that process, but it didn’t help. We temporarily shut down member 4 
and cluster speed returned to normal, but as soon as we boot member 4 back up, 
the cluster performance goes to shit.</pre><pre>

We’ve run in to this before but were able to just start with a fresh set of 
data after wiping machines as it was before we migrated to this bare-metal 
cluster. Now it is causing some pretty significant issues and we’re not sure 
what we can do to get it back to normal, many of our queues are filling up and 
we’ll probably have to take node 4 off again just so we can provide a regular 
quality of service.

We’ve turned off AAE on node 4 but it hasn’t helped. We have some transfers 
that need to happen but they are going very slowly.

'riak-admin top’ on node 4 reports this:
 Load:  cpu       610               Memory:  total      503852    binary     
231544
        procs     804                        processes  179850    code        
11588
        runq      134                        atom          533    ets          
4581

Pid                 Name or Initial Func         Time       Reds     Memory     
  MsgQ Current Function
-------------------------------------------------------------------------------------------------------------------------------
&lt;6175.29048.3&gt;      proc_lib:init_p/5             '-'     462231   51356760     
     0 mochijson2:json_bin_is_safe/1
&lt;6175.12281.6&gt;      proc_lib:init_p/5             '-'     307183   64195856     
     1 gen_fsm:loop/7
&lt;6175.1581.5&gt;       proc_lib:init_p/5             '-'     286143   41085600     
     0 mochijson2:json_bin_is_safe/1
&lt;6175.6659.0&gt;       proc_lib:init_p/5             '-'     281845      13752     
     0 sext:decode_binary/3
&lt;6175.6666.0&gt;       proc_lib:init_p/5             '-'     209113      21648     
     0 sext:decode_binary/3
&lt;6175.12219.6&gt;      proc_lib:init_p/5             '-'     168832   16829200     
     0 riak_client:wait_for_query_results/4
&lt;6175.8403.0&gt;       proc_lib:init_p/5             '-'     133333      13880     
     1 eleveldb:iterator_move/2
&lt;6175.8813.0&gt;       proc_lib:init_p/5             '-'     119548       9000     
     1 eleveldb:iterator/3
&lt;6175.8411.0&gt;       proc_lib:init_p/5             '-'     115759      34472     
     0 riak_kv_vnode:'-result_fun_ack/2-fun-0-'
&lt;6175.5679.0&gt;       proc_lib:init_p/5             '-'     109577       8952     
     0 riak_kv_vnode:'-result_fun_ack/2-fun-0-'
Output server crashed: connection_lost

Based on that, is there anything anyone can think to do to try to bring 
performance back in to the land of usability? Does this thing appear to be 
something that may have been resolved in 1.4.6 or 1.4.7?

Only thing we can think of at this point might be to remove or force remove the 
member and join in a new freshly built one, but last time we attempted that (on 
a different cluster) our secondary indexes got irreparably damaged and only 
regained consistency when we copied every individual key to (this) new cluster! 
Not a good experience :( but i’m hopeful that 1.4.6 may have addressed some of 
our issues.

Any help is appreciated.

Thank you,
Sean McKibben


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13366.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd4.html#13367">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail5.html#13367">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13368.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Single node causing cluster to be extremely slow (le...</span> <span class="sender italic">Sean McKibben</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13368.html">Re: Single node causing cluster to be extremely...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg13369.html">Re 2: Single node causing cluster to be extreme...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg13372.html">Re: Single node causing cluster to be extremely...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13374.html">Re: Single node causing cluster to be extre...</a></span> <span class="sender italic">Martin May</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13376.html">Re: Single node causing cluster to be e...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13377.html">Re: Single node causing cluster to ...</a></span> <span class="sender italic">Martin May</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13379.html">Re: Single node causing cluster to be e...</a></span> <span class="sender italic">Sean McKibben</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13373.html">Re: Single node causing cluster to be extremely...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13375.html">Re: Single node causing cluster to be extre...</a></span> <span class="sender italic">Sean McKibben</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Single node causing cluster to be extremely slow (leveldb)">
<input type="hidden" name="msgid" value="A40FE2CF-5EA3-4533-B0AF-E40FB2998BC3@graphex.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13367.html">
<input type="submit" value=" Sean McKibben ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Single+node+causing+cluster+to+be+extremely+slow+%5C%28leveldb%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13366.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13368.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">A40FE2CF-5EA3-4533-B0AF-E40FB2998BC3@graphex.com</li>
</ul>
</div>
</body>
</html>
