<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Massive json schema update</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17467" id="c">
<link rel="index" href="maillist.html#17467" id="i">
<link rel="prev" href="msg17465.html" id="p">
<link rel="next" href="msg17462.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17467.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Massive+json+schema+update%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Massive json schema update</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Damien+Krotkine%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Damien Krotkine</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160613" rel="nofollow">Mon, 13 Jun 2016 02:27:34 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<tt>My advice : use the fetch-update loop that you already know. You won't 
</tt><tt>get better performance or reliability by using a MapReduce.
</tt><pre style="margin: 0em;">

</pre><tt>I understand that your values are indexed in Search. So either use a 
</tt><tt>search query and update them all, or you could also do a list_keys in 
</tt><tt>stream mode, and updated the values.
</tt><pre style="margin: 0em;"></pre><pre>


Guillaume Boddaert wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

Well,

We are talking about ~30 million items, in a single bucket. Those are
standard tweets, I need to alter all of them because of an invalid
structure.
My cluster is not in production, but I am willing to start validating
a procedure that will be used at some point on a production cluster,
that's a pre-release rehearsal.

I can write my own script that read/update every entries in big scan
of the bucket, but It may suffer from network lag, or other external
stuffs. I'd really like to learn how to alter a set of document in the
erlang console for instance, in order to validate that I can patch
data easily in something that would looks more like an SQL command
(Yes, that's not how it works, understand a map-reduce script in a
mongo shell for instance) in the Riak core than a programmatic
fetch/update loop that I already know.

Guillaume

On 08/06/2016 08:49, Damien Krotkine wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

Hi Guillaume,

If I understand correctly you need to change all the values of your
JSON data.

How many keys are we talking about, how big are the data, and in how
many buckets are the keys?

Also, is your cluster in production yet?



</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

Le 7 juin 2016 à 18:43, Guillaume Boddaert
&lt;guilla...@lighthouse-analytics.co&gt; a écrit :

Hi,

I'd like to patch my current riak collection to rename a field
inside a JSON schema, how can I achieve that from command line on
the riak server itself ? Is there some kind of map/reduce mechanism
that allow any json record to be updated then saved to the riak
cluster ?

Guillaume

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17465.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17467">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17467">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17462.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17461.html">Massive json schema update</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17463.html">Re: Massive json schema update</a></span> <span class="sender italic">Damien Krotkine</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17465.html">Re: Massive json schema update</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Massive json schema update</span> <span class="sender italic">Damien Krotkine</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Massive json schema update">
<input type="hidden" name="msgid" value="575E7C20.3060207@booking.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17467.html">
<input type="submit" value=" Damien Krotkine ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Massive+json+schema+update%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17465.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17462.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">575E7C20.3060207@booking.com</li>
</ul>
</div>
</body>
</html>
