<!DOCTYPE html>
<html lang="en">
<head>
<title>Search API question (was: riak-erlang-client issue with Riak EE 1.2)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08396" id="c">
<link rel="index" href="maillist.html#08396" id="i">
<link rel="prev" href="msg08393.html" id="p">
<link rel="next" href="msg08397.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08396.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Search+API+question+%5C%28was%5C%3A+riak%5C-erlang%5C-client+issue+with+Riak+EE+1.2%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Search API question (was: riak-erlang-client issue with Riak EE 1.2)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Julian%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Julian</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120829" rel="nofollow">Wed, 29 Aug 2012 17:53:26 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

I poked and prodded some more, and figured out that 'fl' is a field
filter that is useful to me, basically doing what I was doing with MR
in the prior version. (Would be nice to see an example of this in the
updated docs)</pre><pre>

I noticed a couple things using the search API and have these comments/questions

1. Seems like the server squeezes an &lt;&lt;&quot;id&quot;&gt;&gt; field at the start of
each result object. We already have an embedded &quot;id&quot; field in our json
objects, so I'm getting 2 &lt;&lt;&quot;id&quot;&gt;&gt;'s here. It would be nice if this
were removed from the object fields, but clearly I could see how it's
useful to know the object key in its bucket, so a format like this
might be nicer
{&lt;&lt;&quot;index&quot;&gt;&gt;, &lt;&lt;&quot;key&quot;&gt;&gt;, [{&lt;&lt;&quot;field1&quot;&gt;&gt;, &lt;&lt;&quot;foo&quot;&gt;&gt;}, {&lt;&lt;&quot;field2&quot;&gt;&gt;,
&lt;&lt;&quot;Bar&quot;&gt;&gt;}...]}

2. In my particular query, I'm getting a small number (5 out of 37) of
the fields repeated within each object at the end of the proplist. The
values, fortunately, are identical to the ones earlier in the object.
I wonder if this is related to indexing or something like that?
Unfortunately, I did not configure our Riak search and can't say
definitively whether I have secondary indices on those or not.

Thanks
Julian

On Wed, Aug 29, 2012 at 12:54 PM, Dave Parfitt &lt;diparf...@gmail.com&gt; wrote:
&gt; Hi Julian -
&gt;    The riak-erlang-client docs definitely need to be updated for search, 
&gt; index, and map/reduce.
&gt;
&gt; In the meantime, if you notice on this line:
&gt; <a  rel="nofollow" href="https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L635">https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L635</a>
&gt; you'll see that the type for Options is &quot;search_options()&quot;.
&gt;
&gt; You can find the definition of search_options() here:
&gt; <a  rel="nofollow" href="https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl#L77">https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl#L77</a>
&gt;
&gt; and the definition for search_option() here:
&gt; <a  rel="nofollow" href="https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl#L122">https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl#L122</a>
&gt;
&gt; Cheers -
&gt; Dave
&gt;
&gt;
&gt; On Aug 28, 2012, at 7:20 PM, Julian wrote:
&gt;
&gt;&gt; Sure, I see the source code of search/*, but I'm kind of stuck at
&gt;&gt; figuring out the search_options properties and whether they can help
&gt;&gt; me or not. I've made stabs at 'rows', 'start' and 'sort' and they're
&gt;&gt; more or less the intuitive thing (although I couldn't do a reverse
&gt;&gt; sort order if I had to).
&gt;&gt;
&gt;&gt;
&gt;&gt; I don't see any code in riak_pb that sheds enlightenment; I'm guessing
&gt;&gt; that this #rpbsearchqueryrec record is just shoved into a packet and
&gt;&gt; sent to the server.
&gt;&gt;
&gt;&gt; search_options([{rows, Rows} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{rows=Rows});
&gt;&gt; search_options([{start, Start} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{start=Start});
&gt;&gt; search_options([{sort, Sort} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{sort=Sort});
&gt;&gt; search_options([{filter, Filter} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{filter=Filter});
&gt;&gt; search_options([{df, DF} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{df=DF});
&gt;&gt; search_options([{op, OP} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{op=OP});
&gt;&gt; search_options([{fl, FL} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{fl=FL});
&gt;&gt; search_options([{presort, Presort} | Rest], Req) -&gt;
&gt;&gt;    search_options(Rest, Req#rpbsearchqueryreq{presort=Presort});
&gt;&gt; search_options([{_, _} | _Rest], _Req) -&gt;
&gt;&gt;    erlang:error(badarg).
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Julian
&gt;&gt;
&gt;&gt; On Tue, Aug 28, 2012 at 12:26 PM, Dave Parfitt &lt;diparf...@gmail.com&gt; wrote:
&gt;&gt;&gt; Hello Julian -
&gt;&gt;&gt;
&gt;&gt;&gt; Map-reduce is still available, it's just not what riakc_pb_socket:search/* 
&gt;&gt;&gt; uses under the hood anymore. Both map/reduce and Riak search functionality 
&gt;&gt;&gt; are implemented in the client using Protocol Buffers now.
&gt;&gt;&gt;
&gt;&gt;&gt; The Map/Reduce functions are available here:
&gt;&gt;&gt; <a  rel="nofollow" href="https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L454">https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L454</a>
&gt;&gt;&gt;
&gt;&gt;&gt; and the Search functions are available here:
&gt;&gt;&gt; <a  rel="nofollow" href="https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L618">https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L618</a>
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers -
&gt;&gt;&gt; Dave
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08393.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08396">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08396">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08397.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Search API question (was: riak-erlang-client issue with Riak EE 1.2)">
<input type="hidden" name="msgid" value="CALELmfLwHs9czNs3RHnxbRkHvaQe+v25CmMWJWAyyzbDKLuPvQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08396.html">
<input type="submit" value=" Julian ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Search+API+question+%5C%28was%5C%3A+riak%5C-erlang%5C-client+issue+with+Riak+EE+1.2%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08393.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08397.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CALELmfLwHs9czNs3RHnxbRkHvaQe+v25CmMWJWAyyzbDKLuPvQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
