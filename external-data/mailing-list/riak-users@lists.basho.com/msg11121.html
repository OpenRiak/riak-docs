<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Java client and siblings question</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#11121" id="c">
<link rel="index" href="mail2.html#11121" id="i">
<link rel="prev" href="msg11120.html" id="p">
<link rel="next" href="msg11172.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11121.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+and+siblings+question%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Java client and siblings question</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brian+Roach%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brian Roach</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130520" rel="nofollow">Mon, 20 May 2013 10:36:25 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>If you're going to use the withoutFetch() method it is required that
you use that @RiakVClock annotated field in your class - you need to
store the vclock from when you fetched in that field.</pre><pre>

When you call StoreObject.execute() it is extracted from your object
and passed to the Converter.fromDomain() method. Since you're using
your own Converter, in that method you need to store the vclock in the
IRiakObject you're constructing and returning. The RiakObjectBuilder
has a withVClock method (and of course the DefaultRiakObject
constructor takes it as a parameter).

As for your second question ... yeah, MapReduce doesn't have that.
It's probably something worth thinking about for a future release (and
yeah, I'm pretty much in charge of the Java client right now - I'll
add it to my backlog).

As-is the best suggestion I would have is using the
MapReduceResult.getResultRaw() and then pass that String to your own
code for conversion.

Thanks!
- Roach

(BTW - I apologize for the late reply - your original email was caught
up in our listserv server for some reason and I only received it
today).


On Mon, May 20, 2013 at 10:32 AM, Y N &lt;yug...@yahoo.com&gt; wrote:
&gt; Hi Brian,
&gt;
&gt; Thanks for the response.
&gt;
&gt; I am not using the default JSONConverter, but have my own. The way I am
&gt; currently resolving siblings is as follows:
&gt;
&gt; Create a new object
&gt; Merge fields (using whatever logic)
&gt; Return new object with merged fields
&gt;
&gt; In this case, what should I use for the vclock for the newly created object
&gt; that was resolved? Do I randomly pick from one of the objects being
&gt; resolved, or is there some order or precedence I should use?
&gt;
&gt; On a side note, I am not sure if you are responsible for the Riak Java
&gt; client. If so, I don't see an option to allow me to use my own converter for
&gt; objects obtained via a MapReduce query (through the Java client). Is this
&gt; feature currently available, or is this something that will be added at some
&gt; point?
&gt;
&gt; A .withConverter(blah) would be nice for mapreduce queries as well.
&gt;
&gt; Thanks!
&gt;
&gt;
&gt; ________________________________
&gt; From: Brian Roach &lt;ro...@basho.com&gt;
&gt; To: Y N &lt;yug...@yahoo.com&gt;
&gt; Cc: &quot;riak-users@lists.basho.com&quot; &lt;riak-users@lists.basho.com&gt;
&gt; Sent: Monday, May 20, 2013 7:42 AM
&gt; Subject: Re: Java client and siblings question
&gt;
&gt; Hello!
&gt;
&gt; When you do your fetch (read) and resolve any conflicts, you're going
&gt; to get a vector clock along with each sibling. If you're using the
&gt; default JSONConverter it will be stored in your POJO's @RiakVClock
&gt; annotated field. That's the vector clock you're going to use when you
&gt; do your store (write) later - the modified object you're passing to
&gt; Bucket.store() should contain it.
&gt;
&gt; The withoutFetch() option simply allows you to break this into two
&gt; separate actions. Without it, when you called StoreObject.execute()
&gt; that's exactly what would be happening.
&gt;
&gt; Thanks!
&gt; - Roach
&gt;
&gt; On Sat, Apr 27, 2013 at 5:35 PM, Y N &lt;yug...@yahoo.com&gt; wrote:
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I am currently using the latest java client, and I have a question
&gt;&gt; regarding
&gt;&gt; updating data in a bucket where siblings are allowed (i.e. allowSiblings =
&gt;&gt; true).
&gt;&gt;
&gt;&gt; I finally understand the whole read-resolve-mutate-write cycle, and also
&gt;&gt; doing an update / store using previously fetched data (i.e. not in the
&gt;&gt; same
&gt;&gt; &quot;transaction&quot;).
&gt;&gt;
&gt;&gt; This question is regarding the latter case (updating previously fetched
&gt;&gt; data). My read uses a resolver. My data class has a @RiakVClock field
&gt;&gt; defined.
&gt;&gt;
&gt;&gt; The problem is when I do the store(blah).withoutFetch(). It seems to be
&gt;&gt; generating siblings. I just realized that's probably because my resolver
&gt;&gt; (during the read) is creating a new object and then merging then siblings
&gt;&gt; into the new object, however it's not setting the vclock field.
&gt;&gt;
&gt;&gt; My question is, during the read resolve stage, what should I use for the
&gt;&gt; vlock? Should I just copy it from one of the other siblings, or is there
&gt;&gt; some specific sort order I should use to pick a particular vlock for the
&gt;&gt; new
&gt;&gt; object?
&gt;&gt;
&gt;&gt; Thanks.
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11120.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#11121">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#11121">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11172.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11113.html">Java client and siblings question</a></span> <span class="sender italic">Y N</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11119.html">Re: Java client and siblings question</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11120.html">Re: Java client and siblings question</a></span> <span class="sender italic">Y N</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Java client and siblings question</span> <span class="sender italic">Brian Roach</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11172.html">Java client -  Bug with ifNotModified?</a></span> <span class="sender italic">Y N</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11217.html">Re: Java client -  Bug with ifNotModified?</a></span> <span class="sender italic">Y N</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11459.html">Riak 1.4 - Changing backend through API</a></span> <span class="sender italic">Y N</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11469.html">New Counters - client support</a></span> <span class="sender italic">Y N</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11470.html">Re: New Counters - client suppo...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11472.html">Re: New Counters - client s...</a></span> <span class="sender italic">Y N</span></li>
<li class="icons-email"><span class="subject"><a href="msg11487.html">Re: New Counters - client s...</a></span> <span class="sender italic">Brian Roach</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11473.html">Re: New Counters - client suppo...</a></span> <span class="sender italic">Sam Elliott</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11474.html">Re: New Counters - client s...</a></span> <span class="sender italic">Sam Elliott</span></li>
<li class="icons-email"><span class="subject"><a href="msg11475.html">Re: New Counters - client s...</a></span> <span class="sender italic">Sam Elliott</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Java client and siblings question">
<input type="hidden" name="msgid" value="CAM+FMBvGnP6CFJo-M=QzW+zeF-OSF47FVBTsYk8g6CL=rmJ8pg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11121.html">
<input type="submit" value=" Brian Roach ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+and+siblings+question%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11120.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11172.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAM+FMBvGnP6CFJo-M=QzW+zeF-OSF47FVBTsYk8g6CL=rmJ8pg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
