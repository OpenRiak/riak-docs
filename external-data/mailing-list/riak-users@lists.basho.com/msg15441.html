<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak stalls, leveldb backend</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#15441" id="c">
<link rel="index" href="mail2.html#15441" id="i">
<link rel="prev" href="msg15439.html" id="p">
<link rel="next" href="msg15442.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15441.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+stalls%2C+leveldb+backend%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak stalls, leveldb backend</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Andy+Pellett%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Andy Pellett</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150106" rel="nofollow">Tue, 06 Jan 2015 02:40:50 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi all,

I've been experiencing stalls where riak won't return any data (queries
time out) with my riak cluster. Here are some basic details:</pre><pre>

- 8 nodes
- riak 1.4.10 (upgraded from 1.4.6 -&gt; 1.4.8 -&gt; 1.4.10)
- leveldb backend
- n_val is 2
- allow_mult is false
- ec2 i2.2xlarge boxes (8 cores, 61gb ram, 800gb disk space)
- about 33% disk space utilization per node

The riak cluster will stall for as long as a few minutes at a time, but
will otherwise work as expected for hours. There doesn't seem to be an
obvious pattern as to when the stalls happen.

My first thought was that the stalls may be related to AAE, but I've
disabled that via 'riak attach' and the settings file. Sidenote, I still
see messages like:

2015-01-05 12:24:04.666 [info]
&lt;0.574.0&gt;@riak_kv_entropy_manager:perhaps_log_throttle_change:826 Changing
AAE throttle from 0 -&gt; 10 msec/key, based on maximum vnode mailbox size 209
from 'riak-user@riak-host'

which makes me question whether AAE is actually turned off.

Now I'm leaning towards leveldb compactions being the issue. What can I do
to verify this is the issue, and how can I fix it?

I see log messages about large objects:

2015-01-05 16:11:28.046 [warning]
&lt;0.6398.0&gt;@riak_kv_vnode:encode_and_put_no_sib_check:1830 Writing very
large object (11307735 bytes) to &lt;&lt;&quot;BucketName&quot;&gt;&gt;/&lt;&lt;&quot;keys_1420466400&quot;&gt;&gt;

Could these be causing longer-running compactions, or more frequent
compactions?

Thanks for reading,
Andy
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15439.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#15441">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#15441">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15442.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Riak stalls, leveldb backend</span> <span class="sender italic">Andy Pellett</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15442.html">Re: Riak stalls, leveldb backend</a></span> <span class="sender italic">Sorin Manole</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15445.html">Re: Riak stalls, leveldb backend</a></span> <span class="sender italic">Drew Pirrone-Brusse</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15688.html">Re: Riak stalls, leveldb backend</a></span> <span class="sender italic">Andy Pellett</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15689.html">Re: Riak stalls, leveldb backend</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15755.html">Re: Riak stalls, leveldb backend</a></span> <span class="sender italic">Andy Pellett</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg15444.html">Re: Riak stalls, leveldb backend</a></span> <span class="sender italic">Michael Lewis</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak stalls, leveldb backend">
<input type="hidden" name="msgid" value="CAPVkXBmfCDvhJsvBuDRZHkQa30p-JHDGH3BhYPJCNi4D4Kp4EQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15441.html">
<input type="submit" value=" Andy Pellett ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+stalls%2C+leveldb+backend%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15439.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15442.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAPVkXBmfCDvhJsvBuDRZHkQa30p-JHDGH3BhYPJCNi4D4Kp4EQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
