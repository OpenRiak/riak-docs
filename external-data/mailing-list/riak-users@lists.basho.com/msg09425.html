<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Ordering and Offset problem while performing riak search queries	against 1.2.1 stable</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#09425" id="c">
<link rel="index" href="mail5.html#09425" id="i">
<link rel="prev" href="msg09420.html" id="p">
<link rel="next" href="msg09421.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09425.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ordering+and+Offset+problem+while+performing+riak+search+queries%09against+1.2.1+stable%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Ordering and Offset problem while performing riak search queries	against 1.2.1 stable</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Abhinav+Singh%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Abhinav Singh</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121205" rel="nofollow">Wed, 05 Dec 2012 03:05:02 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Thanks Sean for the hint over &quot;pre-sort&quot; feature. Didn't knew about this 
feature and looks like it is missing from riak search docs too.
Looks like we have some sanity restored by changing the way we generate our doc 
ids such that &quot;presort=key&quot; makes sense for us.</pre><pre>

Regards,
--
Abhinav Singh
<a  rel="nofollow" href="http://abhinavsingh.com/">http://abhinavsingh.com/</a>

On 04-Dec-2012, at 8:22 PM, Sean Cribbs &lt;s...@basho.com&gt; wrote:

&gt; Abhinav,
&gt; 
&gt; What you are running into is a limitation of Riak Search. For some 
&gt; perhaps-forgotten reason, sorting is done *after* limiting, which ends up 
&gt; returning unexpected results in some cases. However, you can presort the 
&gt; results by key using the &quot;presort&quot; query parameter, assuming that ordering 
&gt; makes sense.
&gt; 
&gt; This limitation of Riak Search, and many others, is addressed by Ryan 
&gt; Zezeski's Yokozuna. You can watch him talk about it here: 
&gt; <a  rel="nofollow" href="http://vimeo.com/54266574">http://vimeo.com/54266574</a>
&gt; 
&gt; 
&gt; On Tue, Dec 4, 2012 at 7:58 AM, Abhinav Singh &lt;abhinavsi...@ymail.com&gt; wrote:
&gt; Hello Everyone,
&gt; 
&gt; I have been developing an application using riak search.
&gt; I have `riak-1.2.1rc2` installed on my local dev box and most of the things 
&gt; works as expected on my local dev,
&gt; except for offset problem while using `start=N&amp;rows=M` in riak search 
&gt; queries, as shown below:
&gt; 
&gt; NOTE: This problem persists when I move the application to our production 
&gt; environment setup which uses riak-1.2.1 stable release.
&gt; 
&gt; 1) /select?start=0&amp;rows=28&amp;sort=ts_num 
&gt; asc&amp;wt=json&amp;q=to:71ad5c26855312ad414caa60c841d48e9a92af1e
&gt; 
&gt; Returns me docs with id in following order (I have added ts_num field info 
&gt; for ordering reference):
&gt; 
&gt; &quot;5998c1fe483ff4e5289542ea7a9b7eabb8265fbc&quot;          1354624548
&gt; &quot;011a4a8c3caccaa61e6d7568dcac5c2b994b3b42&quot;      1354626378
&gt; &quot;ffc9b15ea3756b31ea56298e87c4083a1f49080f&quot;          1354626493
&gt; &quot;5eed8e6f9a3a804b3c3ae05d32f0bc2b09bdd44f&quot;         1354626724
&gt; &quot;657c38f5832a6f421465093edf93e1b5597891a1&quot;         1354626724
&gt; …
&gt; …
&gt; 
&gt; 2) /select?start=1&amp;rows=28&amp;sort=ts_num 
&gt; asc&amp;wt=json&amp;q=to:71ad5c26855312ad414caa60c841d48e9a92af1e
&gt; 
&gt; &quot;5998c1fe483ff4e5289542ea7a9b7eabb8265fbc&quot;           1354624548       &lt;--- I 
&gt; wasn't really expecting this doc id to be returned, infact doc id 
&gt; &quot;011a4a8c3caccaa61e6d7568dcac5c2b994b3b42&quot; from above result set is gone 
&gt; missing
&gt; &quot;ffc9b15ea3756b31ea56298e87c4083a1f49080f&quot;           1354626493
&gt; &quot;5eed8e6f9a3a804b3c3ae05d32f0bc2b09bdd44f&quot;          1354626724
&gt; &quot;657c38f5832a6f421465093edf93e1b5597891a1&quot;          1354626724
&gt; &quot;aace68ad8eb490e2a7053482c403b18b18567190&quot;      1354626724
&gt; …
&gt; …
&gt; 
&gt; 3) /select?start=0&amp;rows=5&amp;sort=ts_num 
&gt; asc&amp;wt=json&amp;q=to:71ad5c26855312ad414caa60c841d48e9a92af1e
&gt; 
&gt; &quot;011a4a8c3caccaa61e6d7568dcac5c2b994b3b42&quot;     1354626378        &lt;---- 
&gt; starting with doc id &quot;011a4a8c3caccaa61e6d7568dcac5c2b994b3b42&quot;, while I was 
&gt; expecting &quot;5998c1fe483ff4e5289542ea7a9b7eabb8265fbc&quot; as the first item
&gt; &quot;02c790e1e15e82166c91eee37ec1dfd8a1f0b588&quot;      1354626755        &lt;---- doc 
&gt; ids from here on are picked from entirely unexpected offset
&gt; &quot;0739a91ec35495be32e55deb7fe859b4ea7734e9&quot;    1354626755
&gt; &quot;101dc3d3cf005802b8c89efb05e11556535c5ff6&quot;         1354626755
&gt; &quot;2224778981d100fb30709e0127fe1a7640ef68ae&quot;      1354626755
&gt; 
&gt; 4) /select?start=1&amp;rows=5&amp;sort=ts_num 
&gt; asc&amp;wt=json&amp;q=to:71ad5c26855312ad414caa60c841d48e9a92af1e
&gt; 
&gt; &quot;02c790e1e15e82166c91eee37ec1dfd8a1f0b588&quot;       1354626755      &lt;---- 
&gt; ordering of results look fine but I was expecting them to start from 
&gt; &quot;011a4a8c3caccaa61e6d7568dcac5c2b994b3b42&quot; i.e. results are returned from an 
&gt; unexpected offset
&gt; &quot;0739a91ec35495be32e55deb7fe859b4ea7734e9&quot;     1354626755
&gt; &quot;101dc3d3cf005802b8c89efb05e11556535c5ff6&quot;          1354626755
&gt; &quot;2224778981d100fb30709e0127fe1a7640ef68ae&quot;       1354626755
&gt; &quot;346bf1800c904c811a8ac5eca195462a5829cbd8&quot;      1354626755
&gt; 
&gt; Is there a problem with my understanding of riak search? or is this a known 
&gt; bug?
&gt; Feedback and help is greatly appreciated.
&gt; Thanks in advance.
&gt; 
&gt; --
&gt; Abhinav
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt; 

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09420.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#09425">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail5.html#09425">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09421.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09419.html">Ordering and Offset problem while performing riak search que...</a></span> <span class="sender italic">Abhinav Singh</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09420.html">Re: Ordering and Offset problem while performing riak s...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Ordering and Offset problem while performing ri...</span> <span class="sender italic">Abhinav Singh</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Ordering and Offset problem while performing riak search queries	against 1.2.1 stable">
<input type="hidden" name="msgid" value="1F317F27-56B9-4812-AFF8-6493D251B3CD@ymail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09425.html">
<input type="submit" value=" Abhinav Singh ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ordering+and+Offset+problem+while+performing+riak+search+queries%09against+1.2.1+stable%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09420.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09421.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">1F317F27-56B9-4812-AFF8-6493D251B3CD@ymail.com</li>
</ul>
</div>
</body>
</html>
