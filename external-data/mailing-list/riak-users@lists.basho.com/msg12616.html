<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Unit testing, Riak buckets</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd8.html#12616" id="c">
<link rel="index" href="mail8.html#12616" id="i">
<link rel="prev" href="msg12615.html" id="p">
<link rel="next" href="msg12626.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12616.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Unit+testing%2C+Riak+buckets%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Unit testing, Riak buckets</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131013" rel="nofollow">Sun, 13 Oct 2013 20:22:44 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre><a  rel="nofollow" href="https://github.com/basho/riak_test/blob/master/src/rtdev.erl#L76">https://github.com/basho/riak_test/blob/master/src/rtdev.erl#L76</a> is the
main function that does the resetting of the git repository (and stops
nodes, etc).</pre><pre>

<a  rel="nofollow" href="https://github.com/basho/riak_test/blob/master/bin/rtdev-setup-releases.shcreates">https://github.com/basho/riak_test/blob/master/bin/rtdev-setup-releases.shcreates</a>
the necessary directory structure and git repo for rtdev.erl from a
bunch of prebuilt Riak devrels.

<a  rel="nofollow" href="https://github.com/basho/riak_test/blob/master/bin/rtdev-current.sh">https://github.com/basho/riak_test/blob/master/bin/rtdev-current.sh</a> adds
the &quot;current&quot; release to the existing directory structure/repo.

It also bears mentioning that the tests in the official Python client
create random bucket and key names, which seems to work pretty well, but it
can become troublesome when you have too many buckets and you go to list
them or change their properties.


On Sun, Oct 13, 2013 at 9:19 PM, Jeremiah Peschka &lt;
jeremiah.pesc...@gmail.com&gt; wrote:

&gt; Go on.
&gt;
&gt; ---
&gt; sent from a tiny portion of the hive mind...
&gt; in this case, a phone
&gt; On Oct 13, 2013 9:19 PM, &quot;Sean Cribbs&quot; &lt;s...@basho.com&gt; wrote:
&gt;
&gt;&gt; Not sure it's the greatest way (sometimes slow), but our integration
&gt;&gt; testing tool riak_test uses git to store a clean &quot;devrel&quot; and resets/cleans
&gt;&gt; the git repository at the beginning of each test. If you're curious, I can
&gt;&gt; point you to the relevant sections of code that do this.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sun, Oct 13, 2013 at 8:34 PM, Jeremiah Peschka &lt;
&gt;&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; For CorrugatedIron's integration tests, we frequently use a GUID as part
&gt;&gt;&gt; of the bucket name and then destroy the bucket after tests finish. Since
&gt;&gt;&gt; I'm frequently moving between different Riak builds, I destroy my data
&gt;&gt;&gt; directories at the filesystem level on a regular basis.
&gt;&gt;&gt;
&gt;&gt;&gt; Your idea of using cron jobs to delete yesterday's buckets doesn't sound
&gt;&gt;&gt; like a bad idea.
&gt;&gt;&gt;
&gt;&gt;&gt; Yes, listing buckets is bad in production. No, this isn't production.
&gt;&gt;&gt; Therefore: LIST ALL THE THINGS!
&gt;&gt;&gt;
&gt;&gt;&gt; ---
&gt;&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt;&gt;&gt; MCITP: SQL Server 2008, MVP
&gt;&gt;&gt; Cloudera Certified Developer for Apache Hadoop
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Sun, Oct 13, 2013 at 8:27 PM, Toby Corkindale &lt;
&gt;&gt;&gt; toby.corkind...@strategicdata.com.au&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt; I'd like to hear how other people are approaching the problem of
&gt;&gt;&gt;&gt; cleaning Riak buckets up at the end of unit tests for their apps.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The problem I have is that multiple tests may be run at once (by
&gt;&gt;&gt;&gt; different developers or different Jenkins' jobs or even just a parallelised
&gt;&gt;&gt;&gt; test suite) so I can't really run a blanket delete-all at the end of the
&gt;&gt;&gt;&gt; test suite, unless I use a randomly-named bucket each time. Yet if I do
&gt;&gt;&gt;&gt; that, I'm concerned the test suite may crash out prior to the end
&gt;&gt;&gt;&gt; sometimes, and then never delete that randomly-named bucket.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If secondary indexes aren't required, then the easy solution is to use
&gt;&gt;&gt;&gt; a randomly-named Bitcask bucket which has a backend configured for a fairly
&gt;&gt;&gt;&gt; short TTL.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Otherwise, I have wondered about creating buckets with a certain
&gt;&gt;&gt;&gt; format, perhaps &quot;test-XXXXXX-YYYY-MM-DD&quot;, (x=random) and then a nightly
&gt;&gt;&gt;&gt; cron script can run to find all buckets timestamped from the previous day
&gt;&gt;&gt;&gt; or earlier, and remove them. I gather listing all buckets is an expensive
&gt;&gt;&gt;&gt; operation though, although it'll only be running on a testing Riak cluster.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; So I wondered how other developers are approaching this issue?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;&gt; Toby
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; ______________________________**_________________
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com">http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com</a>&lt;<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;&gt;
&gt;


-- 
Sean Cribbs &lt;s...@basho.com&gt;
Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12615.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd8.html#12616">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail8.html#12616">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12626.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12612.html">Unit testing, Riak buckets</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12613.html">Re: Unit testing, Riak buckets</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12614.html">Re: Unit testing, Riak buckets</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12615.html">Re: Unit testing, Riak buckets</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Unit testing, Riak buckets</span> <span class="sender italic">Sean Cribbs</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12626.html">Re: Unit testing, Riak buckets</a></span> <span class="sender italic">Daniil Churikov</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Unit testing, Riak buckets">
<input type="hidden" name="msgid" value="CAHsw=e3VCjtK53MZVPU9dHbmgzUpjn0tw0LwjNbYc6ipn-b3Rg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12616.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Unit+testing%2C+Riak+buckets%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12615.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12626.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAHsw=e3VCjtK53MZVPU9dHbmgzUpjn0tw0LwjNbYc6ipn-b3Rg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
