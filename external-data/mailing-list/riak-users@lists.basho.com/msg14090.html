<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: reversing node removal?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14090" id="c">
<link rel="index" href="maillist.html#14090" id="i">
<link rel="prev" href="msg14074.html" id="p">
<link rel="next" href="msg14091.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14090.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+reversing+node+removal%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: reversing node removal?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Allen+Landsidel%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Allen Landsidel</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140415" rel="nofollow">Tue, 15 Apr 2014 09:30:12 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Luke,

</pre><tt>I already do use nagios for that, but the disk space was fine before I 
</tt><tt>told one of the nodes to leave the cluster.  That's my problem -- there 
</tt><tt>was not enough free space in the cluster for it to move all that nodes 
</tt><tt>data.  It accepted the leave and then ran me out of disk space on all 
</tt><tt>the other nodes, with no way to abort or recover.
</tt><pre style="margin: 0em;"></pre><pre>

</pre><tt>My only option was to add more space to the other nodes (as you said, 
</tt><tt>adding new nodes will not work until the leave is done), which is easy 
</tt><tt>enough in a virtualized environment but requires downtime.  In a bare 
</tt><tt>metal environment, it could be catastrophic to the cluster.
</tt><pre style="margin: 0em;">

On 4/15/2014 12:19, Luke Bakken wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Allen,

Cluster leave does not check for disk space and in general, Riak is not
aware of how much space it has available to itself (most db systems
don't monitor disk space I think). I'll send a note to product
management about this. We recommend using a monitoring solution (like
collectd + graphite) to keep an eye on available disk space.


--
Luke Bakken
CSE
lbak...@basho.com &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;


On Mon, Apr 14, 2014 at 10:12 AM, Allen Landsidel
&lt;landsidel.al...@gmail.com &lt;<a  rel="nofollow" href="mailto:landsidel.al...@gmail.com">mailto:landsidel.al...@gmail.com</a>&gt;&gt; wrote:

    Luke,

    As I said in the private email, I ended up doing just that.  The
    cluster is virtualized (I am aware of the potential performance
    issues) so I just shut it all down, grew the drive allocated to
    riak's data dir, and brought them back up.  The extra space (or
    something?) caused them to start going heavily into swap, killing
    performance, so I shut down again and gave them more memory.

    For now though the cluster remains off.  While it was on, our SAN
    performance was getting murdered.  I'm having problems with one of
    the arrays and I'm dealing with that right now; when it's fixed, I
    can go back to figuring out how to fix the issue with the riak
    cluster.  I don't know right now if it was riak or the array issues
    that killed the SAN performance.

    I do have a few more questions though.

    1. Is the cluster leave supposed to check that the remaining nodes
    in the cluster have enough space to move all the data to?  If not,
    that's something that would be nice to have in a future version.

    2. Can I tell it through the config files which filesystem(s) to
    check for available space?  Being FreeBSD, I have the normal mounts
    (/, /usr, /var, /tmp) as well as one dedicated to riak data.  If
    it's just checking the space on the server as a whole, it will get a
    false sense of how much space is available for it.


    On 4/14/2014 12:28, Luke Bakken wrote:

        Hi Allen,

        There's no way to abort a cluster operation that is in progress. In
        addition, data won't transfer to the node you added until the
        previous
        cluster transition completes.

        Is it possible to add disk space to your three running nodes?
        --
        Luke Bakken
        CSE
        lbak...@basho.com &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;


        On Fri, Apr 11, 2014 at 4:48 AM, Allen Landsidel
        &lt;landsidel.al...@gmail.com &lt;<a  rel="nofollow" href="mailto:landsidel.al...@gmail.com">mailto:landsidel.al...@gmail.com</a>&gt;&gt;
        wrote:

            I have a 5-node cluster (riak 1.4.0, freebsd9) that is being
            used in
            production and miscalculated the disk space being used by
            the cluster as a
            whole.  Yesterday I told the cluster to remove two nodes,
            leaving just
            three, but I need four active to cover the usage.

            One node left successfully before I became aware of the
            problem, and disk
            filled up completely on the other three.  I added the one
            that left back to
            the cluster, but data is not being moved to it.

            Is there any way to 'abort' the cluster leave issued to the
            node that is
            still trying to leave, or some other way to straighten this
            out without
            losing (much) data?

            _________________________________________________
            riak-users mailing list
            riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
            
<a  rel="nofollow" href="http://lists.basho.com/__mailman/listinfo/riak-users___lists.basho.com">http://lists.basho.com/__mailman/listinfo/riak-users___lists.basho.com</a>
            &lt;<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>&gt;


</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14074.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14090">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14090">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14091.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14060.html">reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14073.html">Re: reversing node removal?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14074.html">Re: reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: reversing node removal?</span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14091.html">Re: reversing node removal?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14092.html">Re: reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14093.html">Re: reversing node removal?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14094.html">Re: reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: reversing node removal?">
<input type="hidden" name="msgid" value="534D5E2E.4000802@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14090.html">
<input type="submit" value=" Allen Landsidel ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+reversing+node+removal%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14074.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14091.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">534D5E2E.4000802@gmail.com</li>
</ul>
</div>
</body>
</html>
