<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Precommit hook function - no error log - how to debug?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17381" id="c">
<link rel="index" href="maillist.html#17381" id="i">
<link rel="prev" href="msg17376.html" id="p">
<link rel="next" href="msg17382.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17381.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Precommit+hook+function+%5C-+no+error+log+%5C-+how+to+debug%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Precommit hook function - no error log - how to debug?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sanket+Agrawal%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sanket Agrawal</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160517" rel="nofollow">Tue, 17 May 2016 10:54:18 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>All, the issue is fixed now - the problem is that Riak precommit and
postcommit hooks seem to work only in root user mode. On AWS, switching
from ec2-user to root user fixed the precommit trigger issue.
That does raise the question of whether Riak should really be using root
user account. For example, Postgresql runs fine as non-root user.</pre><pre>

On Mon, May 16, 2016 at 1:42 PM, Sanket Agrawal &lt;sanket.agra...@gmail.com&gt;
wrote:

&gt; Luke, just tested and confirmed that precommit hooks are still not
&gt; triggered for normal buckets. Objects get written but precommit hooks don't
&gt; trigger. Manually simulating a trigger by executing the function on riak
&gt; console works fine.
&gt;
&gt; Since sasl log is not being written despite being turned on, isn't that a
&gt; sign that something is wrong with precommit/postcommit setup? This is what
&gt; Douglar Rohrer said earlier in the thread:
&gt;
&gt;&gt; Huh - I get a huge amount of logging when I turn on sasl using
&gt;&gt; advanced.config - specifically, I have:
&gt;&gt; {sasl,[{sasl_error_logger,{file, &quot;/tmp/sasl-1.log&quot;}}]}
&gt;&gt; in my advanced.config, and for just a startup/shutdown cycle I get
&gt;&gt; a 191555 byte file.
&gt;
&gt;
&gt; On Mon, May 16, 2016 at 11:29 AM, Luke Bakken &lt;lbak...@basho.com&gt; wrote:
&gt;
&gt;&gt; Sanket,
&gt;&gt;
&gt;&gt; I can't speak to the output of cluster-info with regard to the precomit
&gt;&gt; hook.
&gt;&gt;
&gt;&gt; If you save an object to the &quot;test_kv&quot; bucket, does
&gt;&gt; rtriggers:pre_all() get called?
&gt;&gt;
&gt;&gt; I have confirmed that precommit hooks are *NOT* triggered for buckets
&gt;&gt; where &quot;write_once&quot; is true, and filed the following docs issue:
&gt;&gt; <a  rel="nofollow" href="https://github.com/basho/basho_docs/issues/2076">https://github.com/basho/basho_docs/issues/2076</a>
&gt;&gt;
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer
&gt;&gt; lbak...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, May 16, 2016 at 8:20 AM, Sanket Agrawal
&gt;&gt; &lt;sanket.agra...@gmail.com&gt; wrote:
&gt;&gt; &gt; Shouldn't precommit body show up in cluster-info first before we try to
&gt;&gt; test
&gt;&gt; &gt; it with an object? I just set the precommit hook for test_kv bucket type
&gt;&gt; &gt; which has no custom property set. Curl on props shows precommit, but
&gt;&gt; &gt; cluster-info doesn't (took another dump after 5 minutes of precommit
&gt;&gt; hook
&gt;&gt; &gt; creation). No sasl logging is triggered either though the debug mode is
&gt;&gt; on.
&gt;&gt; &gt;
&gt;&gt; &gt; Curl output for test_kv props:
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; $ curl localhost:8098/types/test_kv/props
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; {&quot;props&quot;:{&quot;active&quot;:true,&quot;allow_mult&quot;:true,&quot;basic_quorum&quot;:false,&quot;big_vclock&quot;:50,&quot;chash_keyfun&quot;:{&quot;mod&quot;:&quot;riak_core_util&quot;,&quot;fun&quot;:&quot;chash_std_keyfun&quot;},&quot;claimant&quot;:&quot;
&gt;&gt; riak1@127.0.0.1
&gt;&gt; &quot;,&quot;dvv_enabled&quot;:true,&quot;dw&quot;:&quot;quorum&quot;,&quot;last_write_wins&quot;:false,&quot;linkfun&quot;:{&quot;mod&quot;:&quot;riak_kv_wm_link_walker&quot;,&quot;fun&quot;:&quot;mapreduce_linkfun&quot;},&quot;n_val&quot;:3,&quot;notfound_ok&quot;:true,&quot;old_vclock&quot;:86400,&quot;postcommit&quot;:[],&quot;pr&quot;:0,&quot;precommit&quot;:[{&quot;mod&quot;:&quot;rtriggers&quot;,&quot;fun&quot;:&quot;pre_all&quot;}],&quot;pw&quot;:0,&quot;r&quot;:&quot;quorum&quot;,&quot;rw&quot;:&quot;quorum&quot;,&quot;small_vclock&quot;:50,&quot;w&quot;:&quot;quorum&quot;,&quot;young_vclock&quot;:20}}
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Cluster-info dump after setting the props - precommit body is still
&gt;&gt; empty in
&gt;&gt; &gt; the cluster-info for test_kv bucket type:
&gt;&gt; &gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; grep -A15 test_kv cluster_info.txt |grep precommit
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;&gt;         {precommit,[]},
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On Mon, May 16, 2016 at 10:48 AM, Luke Bakken &lt;lbak...@basho.com&gt;
&gt;&gt; wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Hi Sanket,
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Thanks for providing that information, this is the first time that the
&gt;&gt; &gt;&gt; &quot;write_once&quot; bucket type property was mentioned.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; If you set the precommit hook on a different bucket type where there
&gt;&gt; &gt;&gt; are *no other* custom bucket type properties set, does the precommit
&gt;&gt; &gt;&gt; hook run successfully?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; --
&gt;&gt; &gt;&gt; Luke Bakken
&gt;&gt; &gt;&gt; Engineer
&gt;&gt; &gt;&gt; lbak...@basho.com
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; On Mon, May 16, 2016 at 7:17 AM, Sanket Agrawal
&gt;&gt; &gt;&gt; &lt;sanket.agra...@gmail.com&gt; wrote:
&gt;&gt; &gt;&gt; &gt; Hi Luke,
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; More on the precommit hook debugging I just did - I might have a
&gt;&gt; handle
&gt;&gt; &gt;&gt; &gt; on
&gt;&gt; &gt;&gt; &gt; what the problem is. I took a cluster-info dump for all the nodes in
&gt;&gt; the
&gt;&gt; &gt;&gt; &gt; cluster. In the dump, precommit is set to [] for all the buckets in
&gt;&gt; the
&gt;&gt; &gt;&gt; &gt; cluster. The reason for that seems to be that the bucket type with
&gt;&gt; &gt;&gt; &gt; &quot;write-once&quot; property where precommit hook is set, is not in the
&gt;&gt; cluster
&gt;&gt; &gt;&gt; &gt; somehow!
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; The bucket type name is &quot;test_kv_wo&quot;. Let us grep for it in
&gt;&gt; &gt;&gt; &gt; cluster_info.txt
&gt;&gt; &gt;&gt; &gt; - it doesn't show up at all (another bucket type &quot;test_kv&quot; shows up
&gt;&gt; &gt;&gt; &gt; instead):
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; $ grep test_kv cluster_info.txt | sort -u
&gt;&gt; &gt;&gt; &gt;&gt;     [[{bucket,&amp;lt;&amp;lt;&quot;test_kv&quot;&gt;&gt;}|
&gt;&gt; &gt;&gt; &gt;&gt;         {name,&amp;lt;&amp;lt;&quot;test_kv&quot;&gt;&gt;},
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; Now, let us verify we can get the props for the bucket type fine from
&gt;&gt; &gt;&gt; &gt; curl:
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt; $ curl localhost:8098/types/test_kv_wo/buckets/uuid_log/props:
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; &gt;&gt;
&gt;&gt; {&quot;props&quot;:{&quot;name&quot;:&quot;uuid_log&quot;,&quot;active&quot;:true,&quot;allow_mult&quot;:true,&quot;basic_quorum&quot;:false,&quot;big_vclock&quot;:50,&quot;chash_keyfun&quot;:{&quot;mod&quot;:&quot;riak_core_util&quot;,&quot;fun&quot;:&quot;chash_std_keyfun&quot;},&quot;claimant&quot;:&quot;
&gt;&gt; riak1@127.0.0.1
&gt;&gt; &quot;,&quot;dvv_enabled&quot;:true,&quot;dw&quot;:&quot;quorum&quot;,&quot;last_write_wins&quot;:false,&quot;linkfun&quot;:{&quot;mod&quot;:&quot;riak_kv_wm_link_walker&quot;,&quot;fun&quot;:&quot;mapreduce_linkfun&quot;},&quot;n_val&quot;:3,&quot;name&quot;:&quot;uuid_log&quot;,&quot;notfound_ok&quot;:true,&quot;old_vclock&quot;:86400,&quot;postcommit&quot;:[],&quot;pr&quot;:0,&quot;precommit&quot;:[{&quot;mod&quot;:&quot;rtriggers&quot;,&quot;fun&quot;:&quot;pre_uuid&quot;}],&quot;pw&quot;:0,&quot;r&quot;:&quot;quorum&quot;,&quot;rw&quot;:&quot;quorum&quot;,&quot;small_vclock&quot;:50,&quot;w&quot;:&quot;quorum&quot;,&quot;write_once&quot;:true,&quot;young_vclock&quot;:20}}
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt;
&gt;&gt; &gt;&gt; &gt; So, the problem might be missing bucket types in the cluster since
&gt;&gt; they
&gt;&gt; &gt;&gt; &gt; don't show up in cluster-info at all? The same thing happens with LWW
&gt;&gt; &gt;&gt; &gt; bucket
&gt;&gt; &gt;&gt; &gt; type that I created, test_kv_lww. It doesn't show up either. CRDT
&gt;&gt; bucket
&gt;&gt; &gt;&gt; &gt; types show up fine.
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt;
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17376.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17381">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17381">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17382.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17330.html">Re: Precommit hook function - no error log...</a></span> <span class="sender italic">Sanket Agrawal</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17333.html">Re: Precommit hook function - no erro...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17334.html">Re: Precommit hook function - no erro...</a></span> <span class="sender italic">Sanket Agrawal</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg17340.html">Re: Precommit hook function - no error log - how to debug?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17339.html">Re: Precommit hook function - no error log - how to de...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17342.html">Re: Precommit hook function - no error log - how t...</a></span> <span class="sender italic">Sanket Agrawal</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17369.html">Re: Precommit hook function - no error log - h...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17373.html">Re: Precommit hook function - no error log...</a></span> <span class="sender italic">Sanket Agrawal</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17374.html">Re: Precommit hook function - no erro...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17376.html">Re: Precommit hook function - no erro...</a></span> <span class="sender italic">Sanket Agrawal</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Precommit hook function - no erro...</span> <span class="sender italic">Sanket Agrawal</span></li>
<li class="icons-email"><span class="subject"><a href="msg17382.html">Re: Precommit hook function - no erro...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17383.html">Re: Precommit hook function - no erro...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17384.html">Re: Precommit hook function - no erro...</a></span> <span class="sender italic">Sanket Agrawal</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Precommit hook function - no error log - how to debug?">
<input type="hidden" name="msgid" value="CALyR41pJEaBjevRFWkUKwEk5dePJh3Vpy8NEAu9w7ON1vhmQLw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17381.html">
<input type="submit" value=" Sanket Agrawal ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Precommit+hook+function+%5C-+no+error+log+%5C-+how+to+debug%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17376.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17382.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CALyR41pJEaBjevRFWkUKwEk5dePJh3Vpy8NEAu9w7ON1vhmQLw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
