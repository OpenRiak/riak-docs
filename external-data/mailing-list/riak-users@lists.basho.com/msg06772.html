<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Issues with MapReduce in Riak 1.1.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06772" id="c">
<link rel="index" href="maillist.html#06772" id="i">
<link rel="prev" href="msg06735.html" id="p">
<link rel="next" href="msg06736.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06772.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Issues+with+MapReduce+in+Riak+1.1.0%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Issues with MapReduce in Riak 1.1.0</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Meredith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Meredith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120227" rel="nofollow">Mon, 27 Feb 2012 19:53:08 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Yes, a mixed cluster of 1.0.x and 1.1.0 would be affected for the first and
third issues. If you aren't using javascript MapReduce you won't be
affected by the second issue on either.</pre><pre>

For all interested parties, we've made progress on the first two issues
(mixed clusters and javascript leak) and have reviewed/merged fixes onto
the 1.1 branch ready for a 1.1.1 release.  We are still reviewing fixes for
the third issue (keylisting continues after cancel) and hope to have it
wrapped up soon so we can provide a point release.

Jon.

On Fri, Feb 24, 2012 at 6:03 PM, Michael Clemmons
&lt;glassresis...@gmail.com&gt;wrote:

&gt; I think I know the answer to this but would using a mix of 1.0.X and 1.1.0
&gt; together cause the same MapReduce issue?
&gt;
&gt; On Fri, Feb 24, 2012 at 4:56 PM, Jon Meredith &lt;jmered...@basho.com&gt; wrote:
&gt;
&gt;&gt; Issues have been reported by users and customers with the MapReduce
&gt;&gt; subsystem in Riak 1.1.0.
&gt;&gt;
&gt;&gt;   1) MapReduce fails in clusters that contain both 1.1.0 and older nodes
&gt;&gt;   2) Javascript MapReduce jobs leak Javascript VMs under some failure
&gt;&gt; conditions.
&gt;&gt;   3) Keylisting continues after bucket MapReduce is cancelled/timeout
&gt;&gt;
&gt;&gt; We are actively investigating these issues to be resolved in an
&gt;&gt; upcoming point release. We will update the individual issue
&gt;&gt; trackers as we make progress.
&gt;&gt;
&gt;&gt; = Issue: MapReduce fails in clusters that contain both 1.1.0 and older
&gt;&gt; nodes =
&gt;&gt;
&gt;&gt; Description:
&gt;&gt;
&gt;&gt;   The 1.1.0 release has enhancements to the way requests are
&gt;&gt;   routed between nodes. It includes a legacy mode for use while
&gt;&gt;   clusters are being upgraded, using the original routing used in
&gt;&gt;   the 1.0 series and before. Code required to support legacy
&gt;&gt;   routing for MapReduce requests was omitted.
&gt;&gt;
&gt;&gt; What version of Riak is affected?
&gt;&gt;
&gt;&gt;   Open Source and Enterprise versions of Riak 1.1.0 are affected.
&gt;&gt;
&gt;&gt; Are all users affected?
&gt;&gt;
&gt;&gt;   This issue only arises during a rolling upgrade. Users will be
&gt;&gt;   unable to issue MapReduce jobs while there remains 1.0.x or
&gt;&gt;   0.14.x nodes in the cluster.
&gt;&gt;
&gt;&gt;   Users that are not using MapReduce, or who have clusters
&gt;&gt;   containing only 1.1.0 nodes are unaffected.
&gt;&gt;
&gt;&gt; Can I safely upgrade to 1.1.0 if I am not using MapReduce?
&gt;&gt;
&gt;&gt;   Yes
&gt;&gt;
&gt;&gt; Issue Tracker:
&gt;&gt;
&gt;&gt;   <a  rel="nofollow" href="https://github.com/basho/riak_core/issues/144">https://github.com/basho/riak_core/issues/144</a>
&gt;&gt;
&gt;&gt; = Issue: Javascript MapReduce jobs leak Javascript VMs under some failure
&gt;&gt; conditions =
&gt;&gt;
&gt;&gt; Description:
&gt;&gt;
&gt;&gt;   Javascript MapReduce uses a pool of Javascript virtual machines
&gt;&gt;   inside Riak. There are some edge cases where MapReduce jobs are
&gt;&gt;   cancelled (due to timeouts/dropped connections) where the VMs
&gt;&gt;   are not returned to the pool.  Eventually all Javascript VMs in
&gt;&gt;   the pool can become exhausted so that no further Javascript
&gt;&gt;   MapReduce jobs can run until the node is restarted.
&gt;&gt;
&gt;&gt; What version of Riak is affected?
&gt;&gt;
&gt;&gt;   Open Source and Enterprise versions of Riak 1.0.x and 1.1.0 are
&gt;&gt;   affected.
&gt;&gt;
&gt;&gt; Are all users affected?
&gt;&gt;
&gt;&gt;   Only users using Javascript MapReduce are affected.
&gt;&gt;
&gt;&gt; Can I safely upgrade to 1.1.0 if I am not using Javascript MapReduce?
&gt;&gt;
&gt;&gt;   Yes.
&gt;&gt;
&gt;&gt; Issue Tracker:
&gt;&gt;
&gt;&gt;   <a  rel="nofollow" href="https://github.com/basho/riak_kv/issues/287">https://github.com/basho/riak_kv/issues/287</a>
&gt;&gt;
&gt;&gt; = Issue: Keylisting continues after bucket MapReduce is cancelled/timeout
&gt;&gt; =
&gt;&gt;
&gt;&gt; Description:
&gt;&gt;
&gt;&gt;   If MapReduce against a bucket is cancelled (timeout or dropped
&gt;&gt;   client connection) the listkeys feeding the objects from the
&gt;&gt;   bucket continues to run and generates a large number of error
&gt;&gt;   messages:
&gt;&gt;
&gt;&gt;   &quot;Pipe worker startup failed:fitting was gone before startup&quot;
&gt;&gt;
&gt;&gt;   Additionally, these running listkey jobs continue to tie up
&gt;&gt;   resources that would otherwise be capable of running other
&gt;&gt;   MapReduce queries. If enough listkey jobs end up in this state,
&gt;&gt;   subsequent MapReduce queries will be unable to complete and
&gt;&gt;   will timeout. In the worst case, all MapReduce queries
&gt;&gt;   submitted will timeout until the running listkeys eventually
&gt;&gt;   terminate and the cluster recovers.
&gt;&gt;
&gt;&gt; What version of Riak is affected?
&gt;&gt;
&gt;&gt;   Riak 1.0.x and 1.1.0 are both affected.  The listkeys
&gt;&gt;   back-pressure mechanism added in 1.1.0 has increased the
&gt;&gt;   recovery time from the issue.
&gt;&gt;
&gt;&gt; Are all users affected?
&gt;&gt;
&gt;&gt;   This affects users that are seeing frequent timeouts with
&gt;&gt;   bucket MapReduce.
&gt;&gt;
&gt;&gt; Can I safely upgrade to 1.1.0 if I am not using MapReduce?
&gt;&gt;
&gt;&gt;   Yes.
&gt;&gt;
&gt;&gt; Issue Tracker
&gt;&gt;
&gt;&gt;   <a  rel="nofollow" href="https://github.com/basho/riak_kv/issues/293">https://github.com/basho/riak_kv/issues/293</a>
&gt;&gt;
&gt;&gt; --
&gt;&gt; Jon Meredith
&gt;&gt; Platform Engineering Manager
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; jmered...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; -Michael
&gt;
&gt;


-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06735.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06772">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06772">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06736.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06734.html">Issues with MapReduce in Riak 1.1.0</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06735.html">Re: Issues with MapReduce in Riak 1.1.0</a></span> <span class="sender italic">Michael Clemmons</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Issues with MapReduce in Riak 1.1.0</span> <span class="sender italic">Jon Meredith</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Issues with MapReduce in Riak 1.1.0">
<input type="hidden" name="msgid" value="CAGgQeSvPzrrwNM9r9QZRUmufpxbcTPfV8n7cAb2hfOdfR=0OjQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06772.html">
<input type="submit" value=" Jon Meredith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Issues+with+MapReduce+in+Riak+1.1.0%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06735.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06736.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGgQeSvPzrrwNM9r9QZRUmufpxbcTPfV8n7cAb2hfOdfR=0OjQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
