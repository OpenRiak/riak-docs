<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Write to riak cluster with one slow node can be very slow.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd15.html#11341" id="c">
<link rel="index" href="mail15.html#11341" id="i">
<link rel="prev" href="msg11340.html" id="p">
<link rel="next" href="msg11342.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11341.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Write+to+riak+cluster+with+one+slow+node+can+be+very+slow.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Write to riak cluster with one slow node can be very slow.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130626" rel="nofollow">Wed, 26 Jun 2013 06:41:55 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sadly, this is not unexpected on EC2, especially if your storage is on EBS.
In a BoF session at the Surge Conference last year, Brendan Gregg measured
about 1.5sec of I/O silence to EBS on an OmniOS instance running Riak that
was under load (using DTrace of course). Granted, this is just one case,
but I think the symptoms you see are indicative of a similar problem.
Others have told me they have seen large iowait/delay even on ephemeral
storage.</pre><pre>

Now, to Riak's part. That &quot;local put coordination&quot; stuff (sometimes called
vnode_vclocks), while increasing latency in some cases, also improves
convergence and reduces the appearance of spurious siblings. It also
removes the need for clients to specify an identifier, instead using the
vnode's identifier in the vector clock. Which vnode does the coordination
is somewhat randomized, so 1 out of N times you send a put request, you
could get that slow node.

I hope that helps understand the why's... not sure I know how I would fix
your problem in general, other than the typical &quot;get bigger instances&quot;
solution.


On Wed, Jun 26, 2013 at 7:47 AM, Andreas Hasselberg &lt;
andreas.hasselb...@gmail.com&gt; wrote:

&gt; Hi,
&gt;
&gt; We are having problems with the io on one of our amazon instances being
&gt; very slow for short periods of time. When this happens we get some put
&gt; timeouts even though all the other amazon instances seems to be fine. I
&gt; have done some investigations here:
&gt; <a  rel="nofollow" href="https://gist.github.com/anha0825/5866757">https://gist.github.com/anha0825/5866757</a>. Could anyone confirm this or
&gt; point me in a better direction?
&gt;
&gt; Thanks!
&gt; Andreas
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;


-- 
Sean Cribbs &lt;s...@basho.com&gt;
Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11340.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd15.html#11341">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail15.html#11341">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11342.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11340.html">Write to riak cluster with one slow node can be very sl...</a></span> <span class="sender italic">Andreas Hasselberg</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Write to riak cluster with one slow node can b...</span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Write to riak cluster with one slow node can be very slow.">
<input type="hidden" name="msgid" value="CAHsw=e0erOTxhMMs34MGAQzOAOv=Y+cO4cY_Thkn8E4ST8g5Sw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11341.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Write+to+riak+cluster+with+one+slow+node+can+be+very+slow.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11340.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11342.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAHsw=e0erOTxhMMs34MGAQzOAOv=Y+cO4cY_Thkn8E4ST8g5Sw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
