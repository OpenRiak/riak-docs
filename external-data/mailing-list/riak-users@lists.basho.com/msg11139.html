<!DOCTYPE html>
<html lang="en">
<head>
<title>Upgrade Riak 1.2.1 to 1.3.1.  Install from source.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#11139" id="c">
<link rel="index" href="maillist.html#11139" id="i">
<link rel="prev" href="msg11136.html" id="p">
<link rel="next" href="msg11142.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11139.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Upgrade+Riak+1.2.1+to+1.3.1.++Install+from+source.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Upgrade Riak 1.2.1 to 1.3.1.  Install from source.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22ageemoore%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">ageemoore</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130521" rel="nofollow">Tue, 21 May 2013 12:41:00 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

I'm currently running 1.2.1 in production and I'm looking to upgrade to
1.3.1.  I install from source and everything runs nicely out of /&lt;install
dir&gt;/riak/.  I happen to use /db/riak/...</pre><pre>

# ls /db/riak/
bin  data  erts-5.9.1  etc  lib  log  releases
#

I came across these two pages when trying to figure out my upgrade plan:

<a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/Rolling-Upgrades/#RHEL-CentOS">http://docs.basho.com/riak/latest/cookbooks/Rolling-Upgrades/#RHEL-CentOS</a>
<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Reformatting-2i-in-Riak-1-3-1-td4027781.html">http://riak-users.197444.n3.nabble.com/Reformatting-2i-in-Riak-1-3-1-td4027781.html</a>

It all seems pretty straight forward, but the docs.basho.com page does not
mention the &quot;riak-admin reformat-indexes&quot; command as mentioned on the other
page.  I want to know if it is necessary for most typical upgrades?  I'm not
sure if it's something you do only when you are using secondary indexes or
what?  If it doesn't hurt to run regardless, then I have no problem doing
so.

Assuming I make a backup of /data (which contains the following: bitcask 
kv_vnode  mr_queue  ring  ssl_distribution.args_file), here's what I think
my plan will be (the various commands to run) on each of the hosts during
the rolling upgrade:

/db/riak/bin/riak stop
&lt;&lt;install new code and preserve /data&gt;&gt;
/db/riak/bin/riak start
/db/riak/bin/riak-admin status
/db/riak/bin/riak-admin wait-for-service riak_kv riak@`hostname`
/db/riak/bin/riak-admin transfers
/db/riak/bin/riak-admin reformat-indexes   &lt;--- maybe?

Does that seem about right?

Thanks!




--
View this message in context: 
<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Upgrade-Riak-1-2-1-to-1-3-1-Install-from-source-tp4027935.html">http://riak-users.197444.n3.nabble.com/Upgrade-Riak-1-2-1-to-1-3-1-Install-from-source-tp4027935.html</a>
Sent from the Riak Users mailing list archive at Nabble.com.

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11136.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#11139">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#11139">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11142.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Upgrade Riak 1.2.1 to 1.3.1.  Install from source.</span> <span class="sender italic">ageemoore</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11142.html">Re: Upgrade Riak 1.2.1 to 1.3.1. Install from source.</a></span> <span class="sender italic">Jordan West</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Upgrade Riak 1.2.1 to 1.3.1.  Install from source.">
<input type="hidden" name="msgid" value="1369165173295-4027935.post@n3.nabble.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11139.html">
<input type="submit" value=" ageemoore ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Upgrade+Riak+1.2.1+to+1.3.1.++Install+from+source.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11136.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11142.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">1369165173295-4027935.post@n3.nabble.com</li>
</ul>
</div>
</body>
</html>
