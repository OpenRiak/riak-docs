<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Crash Log: yz_anti_entropy</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17867" id="c">
<link rel="index" href="maillist.html#17867" id="i">
<link rel="prev" href="msg17866.html" id="p">
<link rel="next" href="msg17868.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17867.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Crash+Log%5C%3A+yz_anti_entropy%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Crash Log: yz_anti_entropy</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Magnus+Kessler%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Magnus Kessler</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170119" rel="nofollow">Thu, 19 Jan 2017 01:34:26 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On 18 January 2017 at 20:36, Junk, Damion A &lt;jun...@purdue.edu&gt; wrote:</pre><pre>

&gt; Hi All -
&gt;
&gt; I'm seeing some strange behavior on a dev server. Right now the riak kv
&gt; 2.2.0 server has 9GB free Ram, and no keys/values stored in Riak at all.
&gt; (I've been trying to figure out what's going on with the server, so I
&gt; completely wiped /var/lib/riak and re-installed from packagecould). Ulimit
&gt; -n is set appropriately as well.
&gt;
&gt; If I make the following changes to /etc/riak/riak.conf I get crash error
&gt; messages:
&gt;
&gt; storage_backend = leveldb
&gt; search = on
&gt;
&gt; Turning search on with bitcask results in no such crash/error messages.
&gt; When switching between bitcask/leveldb on this test instance, i'm wiping
&gt; the /var/lib/riak directory each time.
&gt;
&gt; Not much is turning up in google, and there is definitely plenty of memory
&gt; available for allocation.
&gt;
&gt;
&gt; Just wondering if anyone else has seen this.
&gt;
&gt;
&gt; Thanks!
&gt;
&gt;
&gt; The error messages:
&gt;
&gt; (crash.log)
&gt;
&gt; 2017-01-18 15:27:23 =CRASH REPORT====
&gt;   crasher:
&gt;     initial call: yz_index_hashtree:init/1
&gt;     pid: &lt;0.2356.0&gt;
&gt;     registered_name: []
&gt;     exception exit: {{{badmatch,{error,{db_open,&quot;IO error: lock
&gt; /var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
&gt; Cannot allocate memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,
&gt; 3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{
&gt; lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_
&gt; hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{
&gt; line,340}]},{yz_index_hashtree,init,1,[{file,&quot;src/
&gt; yz_index_hashtree.erl&quot;},{line,191}]},{gen_server,init_it,6,[
&gt; {file,&quot;gen_server.erl&quot;},{line,304}]},{proc_lib,init_p_do_
&gt; apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]},[{gen_server,
&gt; init_it,6,[{file,&quot;gen_server.erl&quot;},{line,328}]},{proc_lib,
&gt; init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
&gt;     ancestors: [yz_index_hashtree_sup,yz_general_sup,yz_sup,&lt;0.711.0&gt;]
&gt;     messages: []
&gt;     links: [&lt;0.2206.0&gt;]
&gt;     dictionary: []
&gt;     trap_exit: true
&gt;     status: running
&gt;     heap_size: 1598
&gt;     stack_size: 27
&gt;     reductions: 689
&gt;   neighbours:
&gt; 2017-01-18 15:27:24 =SUPERVISOR REPORT====
&gt;      Supervisor: {local,yz_index_hashtree_sup}
&gt;      Context:    child_terminated
&gt;      Reason:     {{badmatch,{error,{db_open,&quot;IO error: lock
&gt; /var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
&gt; Cannot allocate memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,
&gt; 3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{
&gt; lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_
&gt; hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{
&gt; line,340}]},{yz_index_hashtree,init,1,[{file,&quot;src/
&gt; yz_index_hashtree.erl&quot;},{line,191}]},{gen_server,init_it,6,[
&gt; {file,&quot;gen_server.erl&quot;},{line,304}]},{proc_lib,init_p_do_
&gt; apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
&gt;      Offender:   [{pid,&lt;0.2356.0&gt;},{name,ignored},{mfargs,{yz_index_
&gt; hashtree,start_link,undefined}},{restart_type,temporary},{
&gt; shutdown,5000},{child_type,worker}]
&gt;
&gt;
&gt;
&gt; (console.log)
&gt;
&gt; 2017-01-18 15:35:39.100 [error] &lt;0.3049.0&gt; CRASH REPORT Process &lt;0.3049.0&gt;
&gt; with 0 neighbours exited with reason: no match of right hand value
&gt; {error,{db_open,&quot;IO error: lock /var/lib/riak/yz_anti_entropy/
&gt; 639406966332270026714112114313373821099470487552/LOCK: Cannot allocate
&gt; memory&quot;}} in hashtree:new_segment_store/2 line 725 in gen_server:init_it/6
&gt; line 328
&gt; 2017-01-18 15:35:39.101 [error] &lt;0.2206.0&gt; Supervisor
&gt; yz_index_hashtree_sup had child ignored started with
&gt; {yz_index_hashtree,start_link,undefined} at &lt;0.3049.0&gt; exit with reason
&gt; no match of right hand value {error,{db_open,&quot;IO error: lock
&gt; /var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
&gt; Cannot allocate memory&quot;}} in hashtree:new_segment_store/2 line 725 in
&gt; context child_terminated
&gt; 2017-01-18 15:35:39.101 [info] 
&gt; &lt;0.3050.0&gt;@riak_core_throttle:enable_throttle:119
&gt; Enabling throttle for yokozuna/aae_throttle.
&gt; 2017-01-18 15:35:39.101 [error] &lt;0.3030.0&gt; gen_server yz_entropy_mgr
&gt; terminated with reason: no match of right hand value
&gt; {error,{{badmatch,{error,{db_open,&quot;IO error: lock
&gt; /var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
&gt; Cannot allocate memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,
&gt; 3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{
&gt; lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_
&gt; hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},...]}}
&gt; in yz_entropy_mgr:'-reload_hashtrees/3-fun-0-'/2 line 371
&gt; 2017-01-18 15:35:39.101 [error] &lt;0.3030.0&gt; CRASH REPORT Process
&gt; yz_entropy_mgr with 0 neighbours exited with reason: no match of right hand
&gt; value {error,{{badmatch,{error,{db_open,&quot;IO error: lock
&gt; /var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
&gt; Cannot allocate memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,
&gt; 3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{
&gt; lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_
&gt; hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},...]}}
&gt; in yz_entropy_mgr:'-reload_hashtrees/3-fun-0-'/2 line 371 in
&gt; gen_server:terminate/6 line 744
&gt; 2017-01-18 15:35:39.102 [error] &lt;0.2010.0&gt; Supervisor yz_general_sup had
&gt; child yz_entropy_mgr started with yz_entropy_mgr:start_link() at &lt;0.3030.0&gt;
&gt; exit with reason no match of right hand value 
&gt; {error,{{badmatch,{error,{db_open,&quot;IO
&gt; error: lock 
&gt; /var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
&gt; Cannot allocate memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/
&gt; hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,
&gt; 3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{
&gt; lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_
&gt; hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},...]}}
&gt; in yz_entropy_mgr:'-reload_hashtrees/3-fun-0-'/2 line 371 in context
&gt; child_terminated
&gt;

Hi Damion,

Let me first state that AAE always uses leveldb, regardless of the storage
backend chosen for Riak KV data. Could you please state how much physical
memory your Riak nodes have, and what you have configured for
&quot;leveldb.maximum_memory.percent&quot; in &quot;riak.conf&quot;? Have you changed the
settings for &quot;search.solr.jvm_options&quot;, in particular the memory allocated
to Solr?

As a general rule, leveldb should have at least 350MB of memory available
per partition, and performance has been shown to increase with up to 2GB
(2.5 GB when also using Search and AAE) per partition. Please check that
you have enough memory available in your system.

Kind Regards,

Magnus

-- 
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincoln’s Inn Fields London WC2A 3BP Reg 07970431
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17866.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17867">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17867">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17868.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17866.html">Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Crash Log: yz_anti_entropy</span> <span class="sender italic">Magnus Kessler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17868.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17869.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17870.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17871.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Crash Log: yz_anti_entropy">
<input type="hidden" name="msgid" value="CAL3YJWagBv3DJcpn2QXdAPu_Tqaq7hiKM2OgUyKCrfmQqsUv_Q@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17867.html">
<input type="submit" value=" Magnus Kessler ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Crash+Log%5C%3A+yz_anti_entropy%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17866.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17868.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAL3YJWagBv3DJcpn2QXdAPu_Tqaq7hiKM2OgUyKCrfmQqsUv_Q@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
