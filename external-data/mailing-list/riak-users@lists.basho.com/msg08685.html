<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: preflist_exhausted</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08685" id="c">
<link rel="index" href="maillist.html#08685" id="i">
<link rel="prev" href="msg08588.html" id="p">
<link rel="next" href="msg08584.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08685.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+preflist_exhausted%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: preflist_exhausted</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Darrel+Grant%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Darrel Grant</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120924" rel="nofollow">Mon, 24 Sep 2012 13:15:17 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>It turned out this was caused by my using the wrong port in my code.

I had two ways of initiating the connection to riak in my python code. One
using the HTTP interface, and one using the protocol buffers interface, and
the port being used for protocol buffers was incorrectly hitting the system
riak instance, rather than the nodes setup by following the riak fast track.</pre><pre>

I should have noticed when the data I created from the http interface calls
wasn't there when I changed switched over to pcb. So new to riak, it seemed
as if changing the interface affected the returned data, even though that
didn't make a lot of sense. It was just hitting a different cluster. It
seems like the system riak, which has its config in /etc/riak/app.config,
doesn't really need to run at all for development.


On Tue, Sep 18, 2012 at 2:40 PM, Darrel Grant &lt;darrel...@gmail.com&gt; wrote:

&gt; More info, in case it helps someone help me figure out what has gone
&gt; wrong. I suspect I have something misconfigured, or not configured, that is
&gt; affecting the mapreduce js vms.
&gt;
&gt; I followed the instructions on this thread:
&gt; <a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/preflist-exhausted-with-map-reduce-and-riak-js-td3821516.html">http://riak-users.197444.n3.nabble.com/preflist-exhausted-with-map-reduce-and-riak-js-td3821516.html</a>
&gt;
&gt; In that thread, the guys problem turned out to be a missing
&gt; mapred_builtins.js file. I found mine /usr/lib/riak/lib/riak_kv-1.2.0/priv
&gt; so I don't think my problem is the same.
&gt;
&gt; About using the riak console to find out how many map reduce vms are
&gt; available:
&gt;
&gt; (riak@127.0.0.1)5&gt; rpc:multicall(supervisor, count_children,
&gt; [riak_pipe_builder_sup]).
&gt; {[[{specs,1},{active,0},{supervisors,0},{workers,0}]],[]}
&gt; (riak@127.0.0.1)6&gt; rpc:multicall(supervisor, count_children,
&gt; [riak_pipe_fitting_sup]).
&gt; {[[{specs,1},{active,0},{supervisors,0},{workers,0}]],[]}
&gt; (riak@127.0.0.1)7&gt;
&gt; rpc:multicall(riak_kv_js_manager,pool_size,[riak_kv_js_map]).
&gt; {&quot;\b&quot;,[]}
&gt; (riak@127.0.0.1)9&gt;
&gt; rpc:multicall(riak_kv_js_manager,pool_size,[riak_kv_js_reduce]).
&gt; {[6],[]}
&gt;
&gt;
&gt; May be worth noting that those commands product the same weird output
&gt; whether my app.config settings are:
&gt;             {map_js_vm_count, 32 },
&gt;             {reduce_js_vm_count, 32 },
&gt;             {hook_js_vm_count, 16 },
&gt;
&gt; Or the outlandishly high:
&gt;             {map_js_vm_count, 4096 },
&gt;             {reduce_js_vm_count, 4096 },
&gt;             {hook_js_vm_count, 256 },
&gt;
&gt;
&gt; and look nothing like the Mathew Tobvin's output:
&gt; 3&gt;rpc:multicall(riak_kv_js_manager,pool_size,[riak_kv_js_map]).
&gt; {[0,0,0],[]}
&gt; 4&gt;rpc:multicall(riak_kv_js_manager,pool_size,[riak_kv_js_reduce]).
&gt; {[0,0,0],[]}
&gt;
&gt; Also, the output of those commands is the same after running a mapreduce
&gt; job. Once in a while, usually after a fresh riak restart and a bit of time
&gt; has passed since the last preflist_exhausted error, one of my mapreduce
&gt; jobs will actually complete successfully. At a mere 10000 keys in one
&gt; bucket and exactly 1 user, I do not understand at all what is wrong in my
&gt; installation. Does anyone have any suggestions?
&gt;
&gt; Darrel
&gt;
&gt;
&gt;
&gt; On Tue, Sep 18, 2012 at 9:27 AM, Darrel Grant &lt;darrel...@gmail.com&gt; wrote:
&gt;
&gt;&gt; I have about 10000 items in a bucket, and am getting this error a lot.
&gt;&gt;
&gt;&gt; My app.config settings are already quite a lot higher than any values
&gt;&gt; I've come across while googling this issue:
&gt;&gt;             {map_js_vm_count, 4096 },
&gt;&gt;             {reduce_js_vm_count, 4096 },
&gt;&gt;             {hook_js_vm_count, 256 },
&gt;&gt;             {js_max_vm_mem, 256},
&gt;&gt;
&gt;&gt; And just steadily increasing them doesn't seem good, because this bucket
&gt;&gt; could easily have millions of keys in it in a bit of time.
&gt;&gt;
&gt;&gt; Interestingly, if I stop and start riak, I can get the results I expect
&gt;&gt; from the mapreduce, but if I then run it again, I get the
&gt;&gt; preflist_exhausted error. Is there some setting I am missing, which frees
&gt;&gt; up workers after a run, or perhaps causes them to be re-used in some way?
&gt;&gt;
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08588.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08685">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08685">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08584.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08583.html">preflist_exhausted</a></span> <span class="sender italic">Darrel Grant</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08588.html">Re: preflist_exhausted</a></span> <span class="sender italic">Darrel Grant</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: preflist_exhausted</span> <span class="sender italic">Darrel Grant</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: preflist_exhausted">
<input type="hidden" name="msgid" value="CAGbOqHbZU9v4jq=REaVJdjftuXbPrhDUJwPGxJ+nn6WgE92WYg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08685.html">
<input type="submit" value=" Darrel Grant ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+preflist_exhausted%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08588.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08584.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGbOqHbZU9v4jq=REaVJdjftuXbPrhDUJwPGxJ+nn6WgE92WYg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
