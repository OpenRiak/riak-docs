<!DOCTYPE html>
<html lang="en">
<head>
<title>Upgrading 0.14.2 cluster to 1.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08252" id="c">
<link rel="index" href="maillist.html#08252" id="i">
<link rel="prev" href="msg08249.html" id="p">
<link rel="next" href="msg08275.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08252.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Upgrading+0.14.2+cluster+to+1.2%22&amp;o=newest" rel="nofollow"><span itemprop="name">Upgrading 0.14.2 cluster to 1.2</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Joseph+Blomstedt%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Joseph Blomstedt</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120809" rel="nofollow">Thu, 09 Aug 2012 17:24:31 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>(Note: Just realized I didn't send this to the riak-users mailing
list. Re-sending so everyone sees my reply)</pre><pre>

Yes, this makes sense unfortunately. 'riak-admin transfers' isn't
going to work for you in a mixed 0.14.2 and 1.2 cluster.

Between 0.14.2 and 1.0, the entire cluster system was revamped. One
consequence of this change was that 'riak-admin transfers' would only
work on the 1.0+ nodes in the cluster, not any of the 0.14.2 nodes. At
the time, this wasn't a major issue because you could just use the
command on the right nodes and get the information you needed until
all nodes were eventually upgraded.

For Riak 1.2, 'riak-admin transfers' has been changed again. This
time, in a mixed cluster 'riak-admin transfers' only works on the
older nodes, not the Riak 1.2 nodes. For example, in a mixed 1.1 and
1.2 cluster, you can only use riak-admin transfers on the 1.1 nodes
until all have been upgraded.

Unfortunately, the combination doesn't work out well for you in this
case. Riak 0.14.2 transfers fails if there are any 1.0+ nodes in the
cluster, and Riak 1.2 transfers fails if there are any &lt;1.2 nodes in
the cluster.  Both are true, and therefore neither versions of Riak
can properly give you transfer information.

Of course, the lack of being able to monitor transfers doesn't mean
things aren't actually working. Running 'riak-admin member_status' and
'riak-admin ring_status' on the newer nodes should provide enough
detail about what's going on to see if your cluster is moving along.

Regards,
Joe


On Thu, Aug 9, 2012 at 1:25 PM, Sebastian Cohnen
&lt;sebastian.coh...@gmail.com&gt; wrote:
&gt; I forgot to mention, that I also ran 
&gt; &quot;riak_core_node_watcher:service_up(riak_pipe, self()).&quot; on the 0.14.2 node 
&gt; (got that from here: <a  rel="nofollow" href="http://wiki.basho.com/Rolling-Upgrades.html">http://wiki.basho.com/Rolling-Upgrades.html</a>)
&gt;
&gt; On 09.08.2012, at 22:16, Sebastian Cohnen &lt;sebastian.coh...@gmail.com&gt; wrote:
&gt;
&gt;&gt; Hey all,
&gt;&gt;
&gt;&gt; looks like I'm already stuck :-/
&gt;&gt;
&gt;&gt; I'm trying to test the upgrade on a stage cluster (with 2 nodes). What I did 
&gt;&gt; so far:
&gt;&gt; * downloaded 1.2
&gt;&gt; * stopped riak
&gt;&gt; * backup /var/lib/riak/ring and /etc/riak
&gt;&gt; * installed 1.2
&gt;&gt; * changed app.config and vm.args (just node name, ring creation size, config 
&gt;&gt; for our multi-backends)
&gt;&gt; * started riak again
&gt;&gt;
&gt;&gt; riak-admin status looked fine, ring membership is fine, both nodes answer 
&gt;&gt; requests. As hinted by Jon, I attached to riak console and run 
&gt;&gt; riak_core_capability:all(). As far as I can tell, everything looks okay here 
&gt;&gt; too.
&gt;&gt;
&gt;&gt; What is not working is: riak-admin transfers. It is not working on both 
&gt;&gt; nodes. For the state situation this is not a big deal, for production this 
&gt;&gt; would be a potential problem.
&gt;&gt;
&gt;&gt; I've pasted the output of &quot;riak_core_capability:all().&quot; and command output 
&gt;&gt; of riak-admin transfers here: <a  rel="nofollow" href="https://gist.github.com/3307714">https://gist.github.com/3307714</a>
&gt;&gt;
&gt;&gt; Is there anything I can do about that?
&gt;&gt;
&gt;&gt;
&gt;&gt; Best
&gt;&gt;
&gt;&gt; Sebastian
&gt;&gt;
&gt;&gt;
&gt;&gt; PS: What's interesting is that I think that I saw a similar behavior while 
&gt;&gt; trying to upgrade to 1.1.4 a few days ago. I have to double check that 
&gt;&gt; though.
&gt;&gt;
&gt;&gt; On 09.08.2012, at 14:08, Sebastian Cohnen &lt;sebastian.coh...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; I'm actually thinking about taking the risk. We only have a small 3-node 
&gt;&gt;&gt; cluster with ~50GB of data with relatively little traffic (and we don't 
&gt;&gt;&gt; have any 2i, nor do we use search or MR).
&gt;&gt;&gt;
&gt;&gt;&gt; I'll backup the data files, the ring state and everything else I find and 
&gt;&gt;&gt; give it a try. If anything strange happens, we roll back and do the 
&gt;&gt;&gt; additional 1.1.4 step.
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for the information and  help so far!
&gt;&gt;&gt;
&gt;&gt;&gt; On 08.08.2012, at 19:57, Jon Meredith &lt;jmered...@basho.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Only test coverage.  We didn't run direct testing to 0.14.2 - we also 
&gt;&gt;&gt;&gt; deliberately made the decision not to remove some older code that would 
&gt;&gt;&gt;&gt; have broken 0.14 upgrades until the next major release.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It all depends on your risk tolerance - we didn't make any file format 
&gt;&gt;&gt;&gt; changes to bitcask so your data should be safe.  If you wanted to try it, 
&gt;&gt;&gt;&gt; I would take a backup of the ring directory in case you had to downgrade 
&gt;&gt;&gt;&gt; the node again for any reason.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On the newly upgraded node you could run riak_core_capability:all(). on 
&gt;&gt;&gt;&gt; the riak console, that would double-check that the settings matched the 
&gt;&gt;&gt;&gt; required rolling upgrade settings, and make sure you do a diff of your 
&gt;&gt;&gt;&gt; app.config/vm.args against the new package to check there aren't any 
&gt;&gt;&gt;&gt; settings missing.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Jon.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Wed, Aug 8, 2012 at 11:39 AM, Sebastian Cohnen 
&gt;&gt;&gt;&gt; &lt;sebastian.coh...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt; I'm curious, are there any special reasons for your recommendation?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On 08.08.2012, at 19:38, Jon Meredith &lt;jmered...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I would recommend going 0.14.2 -&gt; 1.1.4 -&gt; 1.2, making sure you follow 
&gt;&gt;&gt;&gt;&gt; the pre-1.0 upgrade instructions on 
&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://wiki.basho.com/Rolling-Upgrades.html">http://wiki.basho.com/Rolling-Upgrades.html</a>
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Once you do the upgrade from 1.2, the capabilities system will kick in 
&gt;&gt;&gt;&gt;&gt; and the old legacy settings mentioned in the rolling upgrade will no 
&gt;&gt;&gt;&gt;&gt; longer be used (if you need to you can override them with the new 
&gt;&gt;&gt;&gt;&gt; capability override mechanism).
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Jon.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Wed, Aug 8, 2012 at 10:23 AM, Nathan Wilken &lt;wil...@asu.edu&gt; wrote:
&gt;&gt;&gt;&gt;&gt; Is an intermediate upgrade recommended?  0.14.2 --&gt; 1.0/1.1 --&gt; 1.2?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; From: riak-users-boun...@lists.basho.com 
&gt;&gt;&gt;&gt;&gt; [riak-users-boun...@lists.basho.com] on behalf of Sean Cribbs 
&gt;&gt;&gt;&gt;&gt; [s...@basho.com]
&gt;&gt;&gt;&gt;&gt; Sent: Wednesday, August 08, 2012 6:35 AM
&gt;&gt;&gt;&gt;&gt; To: Sebastian Cohnen
&gt;&gt;&gt;&gt;&gt; Cc: riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; Subject: Re: Upgrading 0.14.2 cluster to 1.2
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Sebastian,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; While it might work, we did not specifically test upgrades from 0.14.2, 
&gt;&gt;&gt;&gt;&gt; only 1.0 and 1.1.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Wed, Aug 8, 2012 at 7:08 AM, Sebastian Cohnen 
&gt;&gt;&gt;&gt;&gt; &lt;sebastian.coh...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt; Hey list,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; is it a good idea to upgrade a small (3 node) cluster straight to 1.2 
&gt;&gt;&gt;&gt;&gt; from 0.14.2. Especially with riak's 1.2 capabilities negotiation, it 
&gt;&gt;&gt;&gt;&gt; feels like the upgrade process should be much simpler now? We don't do 
&gt;&gt;&gt;&gt;&gt; any M/R jobs currently and we are only using bitcask right now.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Best
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Sebastian
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt;&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt; Jon Meredith
&gt;&gt;&gt;&gt;&gt; Platform Engineering Manager
&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt; jmered...@basho.com
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Jon Meredith
&gt;&gt;&gt;&gt; Platform Engineering Manager
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; jmered...@basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



--
Joseph Blomstedt &lt;j...@basho.com&gt;
Senior Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://www.basho.com/">http://www.basho.com/</a>


-- 
Joseph Blomstedt &lt;j...@basho.com&gt;
Senior Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://www.basho.com/">http://www.basho.com/</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08249.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08252">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08252">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08275.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08215.html">Upgrading 0.14.2 cluster to 1.2</a></span> <span class="sender italic">Sebastian Cohnen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08216.html">Re: Upgrading 0.14.2 cluster to 1.2</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08218.html">RE: Upgrading 0.14.2 cluster to 1.2</a></span> <span class="sender italic">Nathan Wilken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08221.html">Re: Upgrading 0.14.2 cluster to 1.2</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08222.html">Re: Upgrading 0.14.2 cluster to 1.2</a></span> <span class="sender italic">Sebastian Cohnen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08224.html">Re: Upgrading 0.14.2 cluster to 1.2</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08238.html">Re: Upgrading 0.14.2 cluster to...</a></span> <span class="sender italic">Sebastian Cohnen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08248.html">Re: Upgrading 0.14.2 cluste...</a></span> <span class="sender italic">Sebastian Cohnen</span></li>
<li class="icons-email"><span class="subject"><a href="msg08249.html">Re: Upgrading 0.14.2 cluste...</a></span> <span class="sender italic">Sebastian Cohnen</span></li>
<li class="icons-email tSliceCur"><span class="subject">Upgrading 0.14.2 cluster to...</span> <span class="sender italic">Joseph Blomstedt</span></li>
<li class="icons-email"><span class="subject"><a href="msg08275.html">Re: Upgrading 0.14.2 cluste...</a></span> <span class="sender italic">Sebastian Cohnen</span></li>
<li class="icons-email"><span class="subject"><a href="msg08279.html">Re: Upgrading 0.14.2 cluste...</a></span> <span class="sender italic">Joseph Blomstedt</span></li>
<li class="icons-email"><span class="subject"><a href="msg08282.html">Re: Upgrading 0.14.2 cluste...</a></span> <span class="sender italic">Sebastian Cohnen</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Upgrading 0.14.2 cluster to 1.2">
<input type="hidden" name="msgid" value="CANvk2KSd5AEArNK-7Mziq-UXrkpOfFf=0HhK5UxC9zbGZZ=vFw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08252.html">
<input type="submit" value=" Joseph Blomstedt ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Upgrading+0.14.2+cluster+to+1.2%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08249.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08275.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANvk2KSd5AEArNK-7Mziq-UXrkpOfFf=0HhK5UxC9zbGZZ=vFw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
