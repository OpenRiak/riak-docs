<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak and Amazon EC2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00653" id="c">
<link rel="index" href="maillist.html#00653" id="i">
<link rel="prev" href="msg00651.html" id="p">
<link rel="next" href="msg00655.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00653.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+and+Amazon+EC2%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak and Amazon EC2</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Tilder%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Tilder</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100625" rel="nofollow">Fri, 25 Jun 2010 09:25:20 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi, Dmitry.  There are some gaps in the information you included here that
might help clarify what's going on so I'm going to just rattle off some
questions for clarification.</pre><pre>

Is your test driver only making requests of a single EC2 instance?  Or are
you querying all 7 nodes directly in so sort of load distribution?   If you
aren't querying all 7 nodes directly, then you will likely see performance
on par with a cluster with only a single &quot;physical&quot; node.

Are you certain that the 7 nodes are communicating with each other?  The
output of the &quot;riak-admin status&quot; command should list the nodes in the
&quot;ring_members&quot; field.

Are the &quot;documents&quot; a separate key with Riak's built in links to the
&quot;entities&quot; or are they keys with a data blob that refer to the entities?[1]
 If the latter, have you read
<a  rel="nofollow" href="http://blog.basho.com/2010/02/24/link-walking-by-example/">http://blog.basho.com/2010/02/24/link-walking-by-example/</a> ?

It's also important for me to note that EC2 instances do not necessarily
have the same characteristics of actual physical hardware when it comes to
preventing resource contention.  Since EC2 instances are virtualized, you
have no idea what other load the physical host of a given instance may be
under.  As a result it is possible to have a Riak instance running on the
same hardware as another IO and CPU intensive instance without your
knowledge, impeding each other to a certain degree.  We've had a number of
users complain of performance problems with Riak clusters running on EC2 at
various times.  From my personal and anecdotal experience, EC2 seems to be
pretty heavily oversubscribed much of the time which leads to intermittent
performance issues for all kinds of applications.

All of that is just a long winded way of saying: don't expect shared
virtualized resources to provide the same performance as dedicated physical
hardware.  But you should still see at least somewhat better performance
that you're seeing now if your testing harness is testing properly.

--Ryan

1. I'm not certain if you're saying that the documents are stored in a
separate bucket from the entities in the same Riak cluster or a separate
Riak cluster entirely.

On Fri, Jun 25, 2010 at 12:02 AM, Dmitry Demeshchuk &lt;demeshc...@gmail.com&gt;wrote:

&gt; Greetings.
&gt;
&gt; I tried running Riak with bitcask backend on 7 Amazon EC2 standard
&gt; large instances (7.5 GB RAM, 4 EC2 CPU units) and performed some
&gt; tests.
&gt; For comparison, I built up the following Riak clusters:
&gt;
&gt; 7 physical nodes ring
&gt; 1 physical node ring (on one of the 7 instances, but I ran the tests
&gt; separately so the rings won't mess with each other)
&gt; 1 physical node ring on an extra large instance (15 GB RAM, 8EC2 CPU units)
&gt;
&gt; and ran a couple of tests with putting and getting data using Riak
&gt; native Erlang API (not PBC).
&gt;
&gt; I had 2 buckets, the first one having small (averagely about 1KB)
&gt; values, but a lot of them (about several millions) called &quot;entities&quot;,
&gt; and the second one having lists of keys from the first database,
&gt; called &quot;documents&quot;. So, every document consists of a lot of entities
&gt; (I used 100 and 1000 for my tests). So, the approximate size of every
&gt; document was either 100KB or 1MB.
&gt;
&gt; So, I performed tests of putting documents and entities to database
&gt; and then obtaining them. I tried to perform reads and writes using 10
&gt; and 100 concurrent Erlang processes (well, 100 was generally too much
&gt; as I ran out of CPU), first from only one machine and then from 2 and
&gt; 3 machines at the same time (for the 7-nodes ring). Of course, the
&gt; entities were obtained using map-reduce.
&gt;
&gt; The first weird thing was that even with 10 concurrent reads and
&gt; writes the performance didn't differ for all three clusters. Okay, 1
&gt; large and 1 extra large nodes don't differ so much but the 7 nodes
&gt; should have given me some performance, shouldn't they?
&gt;
&gt; The second thing was that the average read time for one document with
&gt; 1000 entities was about 5 seconds, and again, the number of machines
&gt; in the cluster didn't affect the result. I guess I just stumbled upon
&gt; the performance of the instance that sent all the map-reduce requests
&gt; and then collected the replies because when I ran tests on the other 2
&gt; instances, all three had the same performance.
&gt;
&gt; The other strange thing was that during data writes most of the time
&gt; nodes were not io-loaded. If it was a one-stream write, it would be
&gt; obvious. But it were 10 and then 20 and 30 simultaneous writing
&gt; processes!
&gt;
&gt;
&gt; Unfortunately I cannot provide the detailed results now, they are
&gt; pretty messed up. I'm going to use basho_bench to make good graphs and
&gt; tables of these tests.
&gt;
&gt; Any advises for the future tests or any explanations for such strange
&gt; performance?
&gt;
&gt; Thank you in advance and sorry for a little messed up e-mail.
&gt;
&gt; --
&gt; Best regards,
&gt; Dmitry Demeshchuk
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00651.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00653">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00653">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00655.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00651.html">Riak and Amazon EC2</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak and Amazon EC2</span> <span class="sender italic">Ryan Tilder</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00655.html">Re: Riak and Amazon EC2</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00657.html">Re: Riak and Amazon EC2</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00659.html">Re: Riak and Amazon EC2</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak and Amazon EC2">
<input type="hidden" name="msgid" value="AANLkTinet2fUYdQ5bIqJiSfOVUx_lNVbMp6zLWMpH6VO@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00653.html">
<input type="submit" value=" Ryan Tilder ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+and+Amazon+EC2%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00651.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00655.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTinet2fUYdQ5bIqJiSfOVUx_lNVbMp6zLWMpH6VO@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
