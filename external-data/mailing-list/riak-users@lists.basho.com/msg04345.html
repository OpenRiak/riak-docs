<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: High volume data series storage and queries</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04345" id="c">
<link rel="index" href="maillist.html#04345" id="i">
<link rel="prev" href="msg04321.html" id="p">
<link rel="next" href="msg04348.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04345.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+volume+data+series+storage+and+queries%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: High volume data series storage and queries</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Paul+O%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Paul O</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110811" rel="nofollow">Thu, 11 Aug 2011 07:49:24 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Ciprian, first of all thanks a lot for the detailed explanations
and references. A lot of food for thought here and I'm not sure I grok
it all just yet. I'll inline my comments.</pre><pre>

On Wed, Aug 10, 2011 at 9:14 AM, Ciprian Dorin Craciun
&lt;ciprian.crac...@gmail.com&gt; wrote:
[...]
&gt;    So the first problem I see with any solution would be the 1
&gt; billion records. I would try to find an alternative solution for
&gt; &quot;historical-data&quot;, like dumping it in flat files, and just keeping in
&gt; the database recent data. By recent I don't have a specific timeframe
&gt; in mind, but whatever you determine it works in your particular case.

Well this is kind of the crux of the problem, in the end. Regardless
of how I store the older data, I still need a predictable query time
for it. So if I dump it in flat files, for instance bundles as
described in my initial solution that I pre-index then I'm by
definition back to the starting point. And if that (1 index check + 3
bundles read + quick range chop off) is quick enough, then everything
else is caching for more recent info. I'm not saying that to discount
the solution, just saying that I can't ignore the historical-data
(actually I might have to degrade historical data performance in the
end, I'm just saying that if the degraded solution is good enough, it
could serve for recent info, too.)


&gt;    Now about the solution: I'm not proposing any batching or
&gt; partitioning based on either timestamp or source; neither as
&gt; individual files on the file system or stored inside the database as
&gt; opaque values.
&gt;
&gt;    Instead I suggest to just put every data point in the same &quot;table&quot;
&gt; or &quot;database&quot; as described below:
&gt;    * the first requirement for the embedded database is to support
&gt; lexicographically sorted keys and cursors which can be pointed to
&gt; start from a particular (or greater) key;
&gt;    * the key of the record would be the binary representation of the
&gt; source id padded with 0's to an exact length, concatenated with the
&gt; timestamp which follows the same rules;
&gt;
&gt;    Now about your concerns about executing range queries without
&gt; considering the whole data is already solved by the database which
&gt; doesn't need to look at the whole data but only search for the first
&gt; data point matching your query. Actually behind scenes it does
&gt; something similar -- but even better -- than what you're proposing
&gt; with the MaxN records opaque value.
&gt;
&gt;    Furthermore, to back my claims I've put on Github the old code
&gt; which I've used to benchmark different databases -- Riak or other
&gt; key-value stores are not included except BerkeleyDB, but I've included
&gt; others like Hypertable which could be a good choice -- at the
&gt; following address (you can easily extend the &quot;framework&quot; to include
&gt; new backends):
&gt;        <a  rel="nofollow" href="https://github.com/cipriancraciun/sds-benchmark">https://github.com/cipriancraciun/sds-benchmark</a>
&gt;
&gt;    Also there is a &quot;so-called&quot; report I've put up at that time in the
&gt; same place at -- the second link is the content of the wkipage and
&gt; there are also images which GitHub doesn't display in the page:
&gt;        <a  rel="nofollow" href="https://github.com/cipriancraciun/sds-benchmark/tree/master/results">https://github.com/cipriancraciun/sds-benchmark/tree/master/results</a>
&gt;        
&gt; <a  rel="nofollow" href="https://github.com/cipriancraciun/sds-benchmark/blob/master/results/results.mediawiki">https://github.com/cipriancraciun/sds-benchmark/blob/master/results/results.mediawiki</a>
&gt;
&gt;    For the record we've tested up to 100m records on some
&gt; data-stores, but on some other (like PostgreSQL and MySQL we've
&gt; stopped at 10 million as the insertion rate dropped tremendously).
&gt;
&gt;    My conclusion from this experiment was: any database which is
&gt; backed by a tree-like data structure (almost all use B trees or
&gt; derivate) will get to a grinding halt in insert speed if the
&gt; clustering keys (clientid + timpstamp in this case) don't exhibit any
&gt; kind of locality (as is your case). See the quote from my report:
&gt; ~~~~
&gt; * this section applies to Postgres and SQLite, as MonetDB behaved Ok;
&gt; * it seems that the initial insert speed is good for the first couple
&gt; million records;
&gt; * as the data accumulates and new inserts are done, the indices start
&gt; to be rewritten, and consume the entire disk bandwidth; (the initial
&gt; good speed is due the fact that the indices fit into the RAM memory;)
&gt; * if the inserts are done without any indices defined, the insert
&gt; speed is incredible (600k in the case of Postgres), but the scan speed
&gt; is under 100;
&gt; * maybe, it is possible, that this behavior is specific to any
&gt; database which uses trees (like BerkeleyDB?);
&gt; ~~~~
&gt;
&gt;    Hope this helps you,

This is very good information and thanks a lot for this, I was not
expecting such in depth benchmarks and am wondering why yours didn't
turn up in my Google searches.

However, I'm still a bit in the dark regarding some aspects of storing
everything in one big database. Are these records stored in an &quot;append
only&quot; fashion? If they are, then how can the range query be done
without considering potentially a huge number of records? If they are
not &quot;append only&quot; then the DB might have to shuffle data around which
would degrade performance or store an index.

Anyway, I'll read some more on this, it's probably just my ignorance
regarding how those databases work, but if the DBs can be append-only
then I need one DB per data source and even then I have to contend
with data insertions in the past (a requirement which I hope I made
explicit in previous emails.) And if I have to use multiple DBs are
these solutions able to juggle multiple DBs, open/close them quickly,
etc.?

I hope I'm not too off-list-topic with this and hope at least some
other people find the discussion useful.

Regards,

Paul

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04321.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04345">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04345">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04348.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04318.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04310.html">Re: High volume data series st...</a></span> <span class="sender italic">Paul O</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04260.html">Re: High volume data series storage and queries</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04266.html">Re: High volume data series storage and queries</a></span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04304.html">Re: High volume data series storage and que...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04313.html">Re: High volume data series storage and...</a></span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04314.html">Re: High volume data series storage...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04317.html">Re: High volume data series st...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04320.html">Re: High volume data serie...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li class="icons-email"><span class="subject"><a href="msg04321.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: High volume data series st...</span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04348.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: High volume data series storage and queries">
<input type="hidden" name="msgid" value="CAA9t2LoU5UR+GOQmU-+Mbo3zFW=Zg6yU-3B+u=rYxL5xUR195Q@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04345.html">
<input type="submit" value=" Paul O ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+volume+data+series+storage+and+queries%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04321.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04348.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAA9t2LoU5UR+GOQmU-+Mbo3zFW=Zg6yU-3B+u=rYxL5xUR195Q@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
