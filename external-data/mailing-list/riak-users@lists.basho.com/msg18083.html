<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Object not found after successful PUT on S3 API</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#18083" id="c">
<link rel="index" href="maillist.html#18083" id="i">
<link rel="prev" href="msg18082.html" id="p">
<link rel="next" href="msg18084.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18083.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Object+not+found+after+successful+PUT+on+S3+API%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Object not found after successful PUT on S3 API</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170310" rel="nofollow">Fri, 10 Mar 2017 09:09:34 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Daniel,

Riak CS uses multi by default. By default the manifests are stored in leveldb 
and the blobs/chunks are stored in bitcask. If you're looking to force 
everything to level you should remove multi and use level as the backend 
setting. As Luke noted elsewhere, this configuration hasn't been fully tested 
and is not supported. </pre><pre>

Off the top of my head, take a look at the email Martin (?) sent about his 
modified level backend a few weeks ago for reasons why using level for data 
chunks may not be the best idea at this time. 

Thanks,
Alexander 

@siculars
<a  rel="nofollow" href="http://siculars.posthaven.com">http://siculars.posthaven.com</a>

Sent from my iRotaryPhone

&gt; On Mar 10, 2017, at 10:50, Daniel Miller &lt;dmil...@dimagi.com&gt; wrote:
&gt; 
&gt; Hi Luke,
&gt; 
&gt; Again, thanks for your help. We are currently preparing to move all objects 
&gt; into a new cluster using the S3 API. One question on configuration: currently 
&gt; I have &quot;storage_backend = leveldb&quot; in my riak.conf. I assume that on the new 
&gt; cluster, in addition to using the advanced.config you provided, I also need 
&gt; to set &quot;storage_backend = multi&quot; in riak.conf â€“ is that correct?
&gt; 
&gt; Referring back to the subject of this thread for a bit, I'm assuming your 
&gt; current theory for why the (most recent) object went missing is because we 
&gt; have a bad backend configuration. Note that that object went missing weeks 
&gt; after it was originally written into riak, and it was successfully retrieved 
&gt; many times before it went missing. Is there a way I can query riak to verify 
&gt; your theory that the manifest was overwritten? Russel Brown suggested: &quot;I 
&gt; wonder if you can get the manifest and then see if any/all of the chunks are 
&gt; present?&quot; Would that help to answer the question about why the object went 
&gt; missing? Can you provide any hints on how to do that?
&gt; 
&gt; While bad configuration may be the cause of this most recent object going 
&gt; missing, it does not explain the original two objects that went missing 
&gt; immediately after they were PUT. Those original incidents happened when our 
&gt; cluster was still using bitcask/mutli backend, so should not have been 
&gt; affected by bad configuration.
&gt; 
&gt; ~ Daniel
&gt; 
&gt;&gt; On Tue, Mar 7, 2017 at 3:58 PM, Luke Bakken &lt;lbak...@basho.com&gt; wrote:
&gt;&gt; Hi Daniel,
&gt;&gt; 
&gt;&gt; Thanks for providing all of that information.
&gt;&gt; 
&gt;&gt; You are missing important configuration for riak_kv that can only be 
&gt;&gt; provided in an /etc/riak/advanced.config file. Please see the following 
&gt;&gt; document, especially the section to which I link here:
&gt;&gt; 
&gt;&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/cs/2.1.1/cookbooks/configuration/riak-for-cs/#setting-up-the-proper-riak-backend">http://docs.basho.com/riak/cs/2.1.1/cookbooks/configuration/riak-for-cs/#setting-up-the-proper-riak-backend</a>
&gt;&gt; 
&gt;&gt; [
&gt;&gt;     {riak_kv, [
&gt;&gt;         % NOTE: double-check this path for your environment:
&gt;&gt;         {add_paths, [&quot;/usr/lib/riak-cs/lib/riak_cs-2.1.1/ebin&quot;]},
&gt;&gt;         {storage_backend, riak_cs_kv_multi_backend},
&gt;&gt;         {multi_backend_prefix_list, [{&lt;&lt;&quot;0b:&quot;&gt;&gt;, be_blocks}]},
&gt;&gt;         {multi_backend_default, be_default},
&gt;&gt;         {multi_backend, [
&gt;&gt;             {be_default, riak_kv_eleveldb_backend, [
&gt;&gt;                 {data_root, &quot;/opt/data/ecryptfs/riak&quot;}
&gt;&gt;             ]},
&gt;&gt;             {be_blocks, riak_kv_eleveldb_backend, [
&gt;&gt;                 {data_root, &quot;/opt/data/ecryptfs/riak_blocks&quot;}
&gt;&gt;             ]}
&gt;&gt;         ]}
&gt;&gt;     ]}
&gt;&gt; ].
&gt;&gt; 
&gt;&gt; Your configuration will look like the above. The contents of this file are 
&gt;&gt; merged with the contents of /etc/riak/riak.conf to produce the configuration 
&gt;&gt; that Riak uses.
&gt;&gt; 
&gt;&gt; Notice that I chose riak_kv_eleveldb_backend twice because of the discussion 
&gt;&gt; you had previously about RAM usage and bitcask 
&gt;&gt; (<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2016-November/018801.html">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2016-November/018801.html</a>)
&gt;&gt; 
&gt;&gt; In your current configuration, you are not using the expected prefix for the 
&gt;&gt; block data. My guess is that on very rare occasions your data happens to 
&gt;&gt; overwrite the manifest for a file. You may also have corrupted files at this 
&gt;&gt; point without noticing it at all.
&gt;&gt; 
&gt;&gt; IMPORTANT: you can't switch from your current configuration to this new one 
&gt;&gt; without re-saving all of your data.
&gt;&gt; 
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer
&gt;&gt; lbak...@basho.com
&gt;&gt; 
&gt;&gt; --
&gt;&gt; Luke Bakken
&gt;&gt; Engineer
&gt;&gt; lbak...@basho.com
&gt;&gt; 
&gt;&gt;&gt; On Tue, Mar 7, 2017 at 6:47 AM, Daniel Miller &lt;dmil...@dimagi.com&gt; wrote:
&gt;&gt;&gt; Responses inline.
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Mon, Mar 6, 2017 at 3:04 PM, Luke Bakken &lt;lbak...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt; Hi Daniel,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Two questions:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; * Do you happen to have an /etc/riak/app.config file present?
&gt;&gt;&gt; 
&gt;&gt;&gt; No. 
&gt;&gt;&gt; 
&gt;&gt;&gt; Not sure if relevant, but I did notice that /etc/riak-cs/advanced.config 
&gt;&gt;&gt; does exist, which contradicts with what I said earlier. This is surprising 
&gt;&gt;&gt; to me because I did not create this file. Maybe it was created by the riak 
&gt;&gt;&gt; installer? Anyway, the content is:
&gt;&gt;&gt; 
&gt;&gt;&gt; $ cat /etc/riak-cs/advanced.config
&gt;&gt;&gt; [
&gt;&gt;&gt;  {riak_cs,
&gt;&gt;&gt;   [
&gt;&gt;&gt;   ]}
&gt;&gt;&gt; ].
&gt;&gt;&gt;  
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; * On one of your Riak nodes, could you please execute the following 
&gt;&gt;&gt;&gt; commands:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; riak attach
&gt;&gt;&gt;&gt; rp(application:get_all_env(riak_kv)).
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Copy the output of the previous command and attach as a separate file
&gt;&gt;&gt;&gt; to your response. Please note that the period is significant. Use
&gt;&gt;&gt;&gt; CTRL-C CTRL-C to exit the &quot;riak attach&quot; session.
&gt;&gt;&gt; 
&gt;&gt;&gt; Attached.
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18082.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#18083">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18083">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18084.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18063.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Russell Brown</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg18065.html">Re: Object not found after successful PUT on S3 API</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18066.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Daniel Miller</span></li>
<li class="icons-email"><span class="subject"><a href="msg18067.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg18068.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Daniel Miller</span></li>
<li class="icons-email"><span class="subject"><a href="msg18069.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Daniel Miller</span></li>
<li class="icons-email"><span class="subject"><a href="msg18070.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg18077.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Daniel Miller</span></li>
<li class="icons-email"><span class="subject"><a href="msg18078.html">Fwd: Object not found after successful PUT on S...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg18082.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Daniel Miller</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Object not found after successful PUT on S3...</span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg18084.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg18085.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg18182.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Daniel Miller</span></li>
<li class="icons-email"><span class="subject"><a href="msg18183.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg18184.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Magnus Kessler</span></li>
<li class="icons-email"><span class="subject"><a href="msg18193.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg18195.html">Re: Object not found after successful PUT on S3...</a></span> <span class="sender italic">Daniel Miller</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Object not found after successful PUT on S3 API">
<input type="hidden" name="msgid" value="5B13274B-AC25-4339-B20E-1C148FE75C21@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18083.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Object+not+found+after+successful+PUT+on+S3+API%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18082.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18084.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5B13274B-AC25-4339-B20E-1C148FE75C21@basho.com</li>
</ul>
</div>
</body>
</html>
