<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: About the node show down when occur riak_searc error of	too_many_resut</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10057" id="c">
<link rel="index" href="maillist.html#10057" id="i">
<link rel="prev" href="msg09873.html" id="p">
<link rel="next" href="msg09867.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10057.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+About+the+node+show+down+when+occur+riak_searc+error+of%09too_many_resut%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: About the node show down when occur riak_searc error of	too_many_resut</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130208" rel="nofollow">Fri, 08 Feb 2013 15:37:17 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Jason,

Riak Search has a limit of 100k results at which point it halts processing
by throwing an exception.  It does this to protect itself from having to
build an indeterminately sized list and then sort it.  You can raise this
limit but you might start seeing large process heaps using lots of CPU for
GC or sorting.</pre><pre>

I'm having a bit of trouble understanding your second point.  Are you
saying that the node goes down after this error?  The only reason I see
that happening is if you run this query (or others that also match large
results) many times in succession causing max restart events (I'm referring
to Erlang/OTP supervisor/worker restarts) to occur eventually reaching up
to the root supervisor and thus exiting.

-Z


On Tue, Jan 22, 2013 at 5:16 AM, 郎咸武 &lt;langxian...@gmail.com&gt; wrote:

&gt; Hi all
&gt;
&gt; The default value of 100,000 can be custom tuned with the
&gt; max_search_results setting in the etc/app.config file.
&gt;
&gt; I using the default value. There are 1,000,000 K/V. I only
&gt; invoke riakc_pb_socket:search(Pid, Bucket, &quot;name:u1*&quot;)[1] when  the node
&gt; shutdown[2].
&gt; The error is an obvious out of the default value.
&gt; But the node is showdown. This is really out of my expectation.
&gt;
&gt; Is this a bug?
&gt; Who can give me  some advice?
&gt;
&gt; Cheers ,Jason
&gt;
&gt;
&gt; The enviroment:
&gt; Erlang R14B04 (erts-5.8.5)
&gt; FreeBSD meda082 9.0-RELEASE FreeBSD 9.0-RELEASE #0: Tue Jan  3 07:46:30
&gt; UTC 2012
&gt; riak1.2
&gt; riakclint 1.3
&gt;
&gt; [1]{error,&lt;&lt;&quot;Error processing incoming message: throw:{too_many_results,\n
&gt;                                          {scope&quot;...&gt;&gt;}
&gt;
&gt; [2]
&gt; (riak@127.0.0.1)1&gt; 17:03:55.626 [error] gen_server &lt;0.2736.0&gt; terminated
&gt; with reason:
&gt; {throw,{too_many_results,{scope,#Ref&lt;0.0.0.8359&gt;,&quot;test_riak_json
&gt;
&gt; &quot;,&quot;value&quot;,{scope,#Ref&lt;0.0.0.8358&gt;,undefined,&quot;name&quot;,{range_sized,#Ref&lt;0.0.0.8362&gt;,{inclusive,&lt;&lt;&quot;u1&quot;&gt;&gt;},{inclusive,&lt;&lt;&quot;u1\377&quot;&gt;&gt;},all,undefined}}}},[{ria
&gt;
&gt; k_search_client,'-search/7-fun-0-',4},{riak_search_client,fold_results,5},{riak_search_client,search,8},{riak_search_client,search_doc,8},{riak_search
&gt;
&gt; _utils,run_query,7},{riak_search_pb_query,run_query,7},{riak_search_pb_query,process,2},{riak_api_pb_server,process_message,4}]}^M^M
&gt; 17:03:55.643 [error] CRASH REPORT Process &lt;0.2736.0&gt; with 1 neighbours
&gt; exited with reason:
&gt; {throw,{too_many_results,{scope,#Ref&lt;0.0.0.8359&gt;,&quot;test_riak
&gt;
&gt; _json&quot;,&quot;value&quot;,{scope,#Ref&lt;0.0.0.8358&gt;,undefined,&quot;name&quot;,{range_sized,#Ref&lt;0.0.0.8362&gt;,{inclusive,&lt;&lt;&quot;u1&quot;&gt;&gt;},{inclusive,&lt;&lt;&quot;u1\377&quot;&gt;&gt;},all,undefined}}}},
&gt;
&gt; [{riak_search_client,'-search/7-fun-0-',4},{riak_search_client,fold_results,5},{riak_search_client,search,8},{riak_search_client,search_doc,8},{riak_s
&gt; earch_utils,run_query,7},{riak_search_pb_query,run_query,7},{riak_search_pb_query,process,2},{riak_api_pb_server,process_message,4}]}
&gt; in gen_server:te
&gt; rminate/6^M^M
&gt;
&gt;
&gt;
&gt; --
&gt; 只为成功找方法，不为失败找理由
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09873.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10057">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10057">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09867.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09866.html">About the node show down when occur riak_searc error of too_m...</a></span> <span class="sender italic">郎咸武</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09873.html">Re: About the node show down when occur riak_searc error...</a></span> <span class="sender italic">郎咸武</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: About the node show down when occur riak_searc error...</span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: About the node show down when occur riak_searc error of	too_many_resut">
<input type="hidden" name="msgid" value="CACZcpen_Ed6PCA_73cQ9RzsnP1+d_G9i6xrTiHPNOi5x+So7ow@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10057.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+About+the+node+show+down+when+occur+riak_searc+error+of%09too_many_resut%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09873.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09867.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpen_Ed6PCA_73cQ9RzsnP1+d_G9i6xrTiHPNOi5x+So7ow@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
