<!DOCTYPE html>
<html lang="en">
<head>
<title>Rebalancing pain and 100 percentile stat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06214" id="c">
<link rel="index" href="maillist.html#06214" id="i">
<link rel="prev" href="msg06213.html" id="p">
<link rel="next" href="msg06216.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06214.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Rebalancing+pain+and+100+percentile+stat%22&amp;o=newest" rel="nofollow"><span itemprop="name">Rebalancing pain and 100 percentile stat</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Elias+Levy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Elias Levy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120110" rel="nofollow">Tue, 10 Jan 2012 10:17:49 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Good day,

Yesterday we went through the exercise of doubling the size of our initial
3 node cluster.  The rebalancing took four hours or so.  Each node now has
between 7 and 8 GB of data stored in the Leveldb backend with an n_val of
3.</pre><pre>

During rebalancing the cluster became nearly useless. The CPUs where
largely pegged, and IO was hit hard, as could be expected.  Op throughput
dropped to the floor and services depending on Riak become unresponsive, as
they waited on Riak ops and then failed with timeouts.  This was in EC2
m1.large instances with ephemeral drives.

A few questions.

Is this expected behavior?  Granted, these are EC2 boxes and Leveldb
depends heavily on disk, but I can't imagine folks using Riak on production
his this type of performance hit resulting from rebalancing.

Are client ops prioritized higher than the rebalancing work?  If not, why
not?

I recall there was some mention that by using Riak EDS it was possible to
fill in a new node slowly, and then have it join the cluster when its
nearly in sync, thus limiting the stampede effect that regular rebalancing
seems to bring on.  Is that the case?  If so, is there any documentation on
this?


I am also starting to suspect the timing statistics that Riak reports.
 We've been charting them, and comparing them before and after the doubling
of the cluster size shows some odd results.  Nearly all stats in the older
nodes (mean, median, 95 percentile, 99 percentile, 100 percentile) are
about the same before and after the addition of new nodes.  This is the
case even though there are now double as many nodes to handle requests, and
each node has about half as much data as before.  The only one that did
change was the puts 100 percentile.  It increased during the rebalancing,
and then stayed at its higher value.  How is this possible?

In fact, I find the 100 percentile stat a bit incredible.  One of the boxes
is showing a 8,012 seconds 100 percentile stat (yes, I did divide by one
million to convert from microseconds).

Or are the time stats not rolling stats?  Are they computed since the start
of the node, meaning that the 100 percentile will never go down, only up?

Elias
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06213.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06214">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06214">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06216.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Rebalancing pain and 100 percentile stat</span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06216.html">Re: Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">Joseph Blomstedt</span></li>
<li class="icons-email"><span class="subject"><a href="msg06218.html">Re: Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06220.html">Re: Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06221.html">Re: Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">Ian Plosker</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Rebalancing pain and 100 percentile stat">
<input type="hidden" name="msgid" value="CAFDmHdN3ho3yN2BoyjL-xLQst-13jfcAxbbw9cDpazhpDoBNOQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06214.html">
<input type="submit" value=" Elias Levy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Rebalancing+pain+and+100+percentile+stat%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06213.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06216.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAFDmHdN3ho3yN2BoyjL-xLQst-13jfcAxbbw9cDpazhpDoBNOQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
