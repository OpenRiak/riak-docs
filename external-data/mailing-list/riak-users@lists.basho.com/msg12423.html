<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: allow_mult vs. 2i</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd9.html#12423" id="c">
<link rel="index" href="mail9.html#12423" id="i">
<link rel="prev" href="msg12420.html" id="p">
<link rel="next" href="msg12428.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12423.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+allow_mult+vs.+2i%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: allow_mult vs. 2i</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremiah+Peschka%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremiah Peschka</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130927" rel="nofollow">Fri, 27 Sep 2013 06:24:15 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I think that CRDT support in Riak will meet your needs. It pushes garbage
collection down to Riak itself so you don't have to worry about it.</pre><pre>

The downside is that it is only in Riak 2.0 and not all clients support it
yet or their support is immature. The current support in the .net client is
very low level, for example.
On Sep 26, 2013 4:08 PM, &quot;Brady Wetherington&quot; &lt;br...@bespincorp.com&gt; wrote:

&gt; Oh, I get what the siblings/allow_mult business is for, just wondering if
&gt; I can use it off-label a little, and eventually do 'conflict resolution'
&gt; which would make the results be much more reasonable.
&gt;
&gt; But it sounds like I shouldn't do that. That's totally fine.
&gt;
&gt; Since I'm doing a write-once, update-never environment - I don't see how
&gt; allow_mult would help me otherwise? A new write will always be to a new
&gt; key. There will never be an update. So if that's the case - no need for
&gt; allow_mult. Does that sound right?
&gt;
&gt; -B.
&gt;
&gt;
&gt; On Wed, Sep 25, 2013 at 6:30 PM, Jeremiah Peschka &lt;
&gt; jeremiah.pesc...@gmail.com&gt; wrote:
&gt;
&gt;&gt; inline.
&gt;&gt;
&gt;&gt; ---
&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt;&gt; MCITP: SQL Server 2008, MVP
&gt;&gt; Cloudera Certified Developer for Apache Hadoop
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Sep 25, 2013 at 2:47 PM, Brady Wetherington &lt;br...@bespincorp.com
&gt;&gt; &gt; wrote:
&gt;&gt;
&gt;&gt;&gt; I've built it a solid proof-of-concept system on leveldb, and use some
&gt;&gt;&gt; 2i indexes in order to search for certain things - usually just for counts
&gt;&gt;&gt; of things.
&gt;&gt;&gt;
&gt;&gt;&gt; I have two questions so far:
&gt;&gt;&gt;
&gt;&gt;&gt; First off, why is Bitcask the default? Is it just because it is faster?
&gt;&gt;&gt; Or is it considered more 'stable' or something?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; Long ago, when bitcask was elected as the default, LevelDB was not a
&gt;&gt; thing.
&gt;&gt;
&gt;&gt; Databases strive for stability and the principle of least surprise.
&gt;&gt; Changing anything can potentially introduce performance regressions,
&gt;&gt; stability problems, and any host of other undesirable and reputation
&gt;&gt; destroying things.
&gt;&gt;
&gt;&gt; Changing the storage back end is high up on the list of things I'd never
&gt;&gt; want to do in a database. Why do you think MySQL still defaults to MyISAM?
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Next, I've learned about the allow_mult feature you can set on buckets.
&gt;&gt;&gt; I wonder if I should use this for my most heavily-used primary-purpose
&gt;&gt;&gt; queries? Is there a limit to how many 'siblings' you can have for an entry?
&gt;&gt;&gt; Is it inadvisable to do what I'm talking about? Would fetching all of the
&gt;&gt;&gt; siblings end up being a disastrous nightmare or something?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; The upper limit will depend on the size of your objects. You don't want
&gt;&gt; to have object sizes (including siblings) much beyond 6MB. You'll have a
&gt;&gt; lot of network congestion. You certainly *could* have bigger object +
&gt;&gt; sibling collections, but you'd want to beef up the network backend to
&gt;&gt; something like 10GbE, 40GbE, or InfiniBand to deal with the increased
&gt;&gt; gossip.
&gt;&gt;
&gt;&gt; Fetching all of your siblings is bad if you never resolve siblings since
&gt;&gt; you'll have a lot of data.
&gt;&gt;
&gt;&gt; Allow_mult is typically turned on for production clusters. This is set
&gt;&gt; off by default to help new users get a handle on Riak quickly without
&gt;&gt; having to worry about siblings. Once you get the hang of how Riak behaves,
&gt;&gt; turning on siblings is usually a good thing.
&gt;&gt;
&gt;&gt; Depending on resolution, it's probably best to read your data, resolve
&gt;&gt; siblings, and send that garbage collected object back to Riak - even if
&gt;&gt; you're performing a &quot;read only&quot; query. The new Riak DT features eliminate
&gt;&gt; some of the worry about siblings by pushing the responsibility back down to
&gt;&gt; Riak. Those features are only available if you're building from source, but
&gt;&gt; hopefully Riak 2.0 will be out soon.
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; I *assume* - and I could be wrong - that a 2i query would be slower than
&gt;&gt;&gt; a fetch-of-siblings for a particular key - is that wrong?
&gt;&gt;&gt;
&gt;&gt;&gt; If I switch from using 2i indexes to using allow_mult and siblings, we'd
&gt;&gt;&gt; be talking a few hundred thousand to low millions for a sibling-count.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; I do not think 'siblings' means what you think it means.
&gt;&gt;
&gt;&gt; A sibling would occur if two clients, A and B, read v1 of an object and
&gt;&gt; then issue writes.
&gt;&gt;
&gt;&gt; Client A updates object and sets preferences to ['cat pictures', 'ham
&gt;&gt; sandwiches']
&gt;&gt; Client B updates object and sets preferences to ['knitting with bacon']
&gt;&gt;
&gt;&gt; With allow_mult enabled you'd have two versions of the object. These are
&gt;&gt; siblings.
&gt;&gt;
&gt;&gt; If you're thinking of some kind of index created by your application, you
&gt;&gt; could look at 2i vs using siblings to build a secondary index:
&gt;&gt; <a  rel="nofollow" href="http://basho.com/index-for-fun-and-for-profit/">http://basho.com/index-for-fun-and-for-profit/</a> Even when you're creating
&gt;&gt; your own secondary index, you still want to perform garbage collection on
&gt;&gt; the data you're storing in Riak.
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt;  Thanks for making an excellent product! Can't wait to get this bad boy
&gt;&gt;&gt; into production and really see what it can do!
&gt;&gt;&gt;
&gt;&gt;&gt; -B.
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12420.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd9.html#12423">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail9.html#12423">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12428.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12398.html">allow_mult vs. 2i</a></span> <span class="sender italic">Brady Wetherington</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12399.html">Re: allow_mult vs. 2i</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12420.html">Re: allow_mult vs. 2i</a></span> <span class="sender italic">Brady Wetherington</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: allow_mult vs. 2i</span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg12428.html">Re: allow_mult vs. 2i</a></span> <span class="sender italic">Runar Jordahl</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12429.html">Re: allow_mult vs. 2i</a></span> <span class="sender italic">Brady Wetherington</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: allow_mult vs. 2i">
<input type="hidden" name="msgid" value="CACJEN2pNz7QDRx7op13fyEWjeTkxcwnuXO+75NkKYtAwWFN5YQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12423.html">
<input type="submit" value=" Jeremiah Peschka ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+allow_mult+vs.+2i%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12420.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12428.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACJEN2pNz7QDRx7op13fyEWjeTkxcwnuXO+75NkKYtAwWFN5YQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
