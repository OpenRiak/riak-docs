<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: map performance notes and question</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02021" id="c">
<link rel="index" href="maillist.html#02021" id="i">
<link rel="prev" href="msg02020.html" id="p">
<link rel="next" href="msg02022.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02021.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+map+performance+notes+and+question%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: map performance notes and question</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110118" rel="nofollow">Tue, 18 Jan 2011 10:50:54 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>To your second point re. returning a large string via a js m/r, yes,
this has to do with passing the string from the erlang environment to
the javascript environment. That is why it is always recommended that
as your needs escalate you should seriously look into going native
erlang in your m/r's.</pre><pre>

Best, Alexander

On Tue, Jan 18, 2011 at 18:39, Brendan &lt;bren...@tucows.com&gt; wrote:
&gt; hi. i'm a new riak user. i scanned the list archives and didn't notice
&gt; either of these things discussed - i apologize in advance if they
&gt; already have been.
&gt;
&gt; i noticed something that is perhaps of use to people. when using the
&gt; data of an object in a map phase to generate a list of [bucket,object]
&gt; pairs for a second map phase i've seen the suggestion to use a json
&gt; array as the data and Riak.mapValues to generate the list. i've been
&gt; playing with this (and some more complex json objects beyond a simple
&gt; array) and i've come to the conclusion that using a comma separated list
&gt; as the data instead of a json array is far more efficient on large
&gt; datasets.
&gt;
&gt; JSON.parse (and the eval()) it calls is relatively slow, but a
&gt; split(',') operation is very quick. on a 100,000 element dataset on my
&gt; test machine the split averages about 25ms to convert the csv data into
&gt; a javascript array object, but using JSON.parse to convert the json data
&gt; into a javascript array object averages around 750ms. for smaller
&gt; datasets there isn't much of a difference, but for large ones the
&gt; difference can become quite significant. hopefully this observation is
&gt; of use to someone besides me. :)
&gt;
&gt; i also have a question regarding map performance with large objects. if
&gt; i create an object with one of these large 100,000 element datasets in
&gt; it (whether a csv or json array doesn't matter) then stop and start
&gt; riak, i can retrieve the object (get, via rest api) in about 0.2
&gt; seconds. subsequent requests take about 0.06 seconds, i assume because
&gt; riak had to load the data from disk the first time and had it cached the
&gt; second. at any rate, riak is very quick in both cases.
&gt;
&gt; if, however, i then do a simple map operation of
&gt; &quot;function(v){return[1]}&quot; where the map doesn't actually do any work at
&gt; all on just that single object, then the time to process the request
&gt; balloons to 2.1 seconds. given that riak can return the data via GET in
&gt; 0.06 seconds, 2.1 seconds simply to load the object into a map phase
&gt; seems excessive. is this a penalty for passing the data into the
&gt; javascript engine, and thus something i could avoid by doing the map
&gt; operation natively in erlang (my erlang skills are pretty weak, but if
&gt; this works around the issue it'll be a good driver to force me to
&gt; improve them)? or is it simply a penalty of the map phase, with no way
&gt; around it?
&gt;
&gt; (everything above is based on tests with riak-0.14-0)
&gt;
&gt; thanks
&gt; -brendan
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02020.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02021">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02021">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02022.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg02020.html">map performance notes and question</a></span> <span class="sender italic">Brendan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: map performance notes and question</span> <span class="sender italic">Alexander Sicular</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: map performance notes and question">
<input type="hidden" name="msgid" value="AANLkTikFOrhXqcnbu4TkA3bOD_2JEPdp_uP=22yTOCiK@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02021.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+map+performance+notes+and+question%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02020.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02022.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTikFOrhXqcnbu4TkA3bOD_2JEPdp_uP=22yTOCiK@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
