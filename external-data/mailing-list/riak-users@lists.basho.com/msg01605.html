<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riak / riaksearch fails and returns with "badarg,	universaltime_to_localtime" on any mapreduce function</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01605" id="c">
<link rel="index" href="maillist.html#01605" id="i">
<link rel="prev" href="msg01600.html" id="p">
<link rel="next" href="msg01590.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01605.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak+%5C%2F+riaksearch+fails+and+returns+with+%5C%22badarg%2C%09universaltime_to_localtime%5C%22+on+any+mapreduce+function%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riak / riaksearch fails and returns with "badarg,	universaltime_to_localtime" on any mapreduce function</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22A.+Sebastian+Dietzel%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">A. Sebastian Dietzel</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101123" rel="nofollow">Tue, 23 Nov 2010 02:42:54 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Dan,

</pre><tt>the error I've been trying to fix for the past week wasn't riak's fault 
</tt><tt>it's a bug in Erlang R13B04.
</tt><tt>Sean helped me yesterday via IRC to get riak-search working on R14B 
</tt><tt>which fixed it for me.
</tt><pre style="margin: 0em;"></pre><pre>

You can read more about that erlang bug on the erlang-bugs mailing list:
<a  rel="nofollow" href="http://www.erlang.org/pipermail/erlang-bugs/2008-November/001077.html">http://www.erlang.org/pipermail/erlang-bugs/2008-November/001077.html</a>

Thanks guys.


Dan Reverri wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>It looks like Riak is hitting this error when trying to jsonify the 
</tt><tt>metadata, specifically the &quot;X-Riak-Last-Modified&quot; header. The 
</tt><tt>timestamp in the header works out to be &quot;Sun, 21 Nov 2010 07:28:05 
</tt><tt>GMT&quot;. Your system seems to be translating it to a date before 1970.
</tt><pre style="margin: 0em;">

</pre><tt>Can you run the following Erlang code while attached to a running Riak 
</tt><tt>node?
</tt><pre style="margin: 0em;">
calendar:now_to_local_time({1290,324485,31243}).


It should output something like:

{{2010,11,20},{23,28,5}}


Thanks,
Dan




Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com &lt;<a  rel="nofollow" href="mailto:d...@basho.com">mailto:d...@basho.com</a>&gt;


</pre><tt>On Sun, Nov 21, 2010 at 2:10 AM, A. Sebastian Dietzel 
</tt><tt>&lt;sebast...@dubizzle.com &lt;<a  rel="nofollow" href="mailto:sebast...@dubizzle.com">mailto:sebast...@dubizzle.com</a>&gt;&gt; wrote:
</tt><pre style="margin: 0em;">

    Hi,

    I've trouble getting the mapreduce functions to work in riak and
    riaksearch.
    It fails with some sort of timestamp error, unfortunately I'm not
    good enough in
    Erlang to fix it, but I've attached the error logs and
    riaksearch-admin status output - hope that helps.

    So far, I've tried it on my local dev machine (osx -
    riak/riaksearch source installation, tarball and github master
    branch),
    on centos 5.3 (github master) and on ubuntu,
    the .deb packaged version on ubuntu works and doesn't fail in my
    test cases.

    The attached test is written in python based on the test cases in
    the library
    and utilizes the http client from the python library for riak.
    But that shouldn't matter, it also fails via the pbc-python client
    (I've attached logs for that as well),
    as well as in ruby (using the official client) and via curl too.
    I didn't attach any logs for ruby or curl, as they're similar to
    the http based python client.

    Since no one else is having these issues, I presume I'm doing
    something wrong
    but I don't know what exactly.

    I'm running riak/riaksearch from the console like this:
    ulimit -n 1024
    $PATH_TO_RIAKS_SRC/rel/bin/riaksearch start

    or for regular riak:
    $PATH_TO_RIAK_SRC/rel/bin/riak start

    This works and starts riak / riaksearch, but as soon as I start
    doing anything mapreduce with the servers they fail with:

    ...
    
{badarg,[{erlang,universaltime_to_localtime,[{{1969,12,31},{23,59,59}}]},{calendar,local_time_to_universal_time_dst,1}
    ...

    I'm using Erlang R13B04.

    Please let me know if I can provide anything else to help solving
    this issue.

    Thank you in advance,
    Sebastian
</pre><tt>    -- 
</tt><tt>    A. Sebastian Dietzel (el mariachi)
</tt><pre style="margin: 0em;">
    sebast...@dubizzle.com &lt;<a  rel="nofollow" href="mailto:sebast...@dubizzle.com">mailto:sebast...@dubizzle.com</a>&gt;


    _______________________________________________
    riak-users mailing list
    riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
    <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


</pre></blockquote><pre style="margin: 0em;">

--
A. Sebastian Dietzel (el mariachi)
sebast...@dubizzle.com

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01600.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01605">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01605">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01590.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01589.html">Re: riak / riaksearch fails and returns with &quot;ba...</a></span> <span class="sender italic">Michal Zajda</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01600.html">Re: riak / riaksearch fails and returns with &qu...</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: riak / riaksearch fails and returns with...</span> <span class="sender italic">A. Sebastian Dietzel</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riak / riaksearch fails and returns with &quot;badarg,	universaltime_to_localtime&quot; on any mapreduce function">
<input type="hidden" name="msgid" value="4CEB9A97.4020700@dubizzle.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01605.html">
<input type="submit" value=" A. Sebastian Dietzel ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak+%5C%2F+riaksearch+fails+and+returns+with+%5C%22badarg%2C%09universaltime_to_localtime%5C%22+on+any+mapreduce+function%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01600.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01590.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4CEB9A97.4020700@dubizzle.com</li>
</ul>
</div>
</body>
</html>
