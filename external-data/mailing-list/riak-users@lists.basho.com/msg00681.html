<!DOCTYPE html>
<html lang="en">
<head>
<title>bitcask and innostore overheads</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd3.html#00681" id="c">
<link rel="index" href="mail3.html#00681" id="i">
<link rel="prev" href="msg00679.html" id="p">
<link rel="next" href="msg00683.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00681.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22bitcask+and+innostore+overheads%22&amp;o=newest" rel="nofollow"><span itemprop="name">bitcask and innostore overheads</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremy+Hinegardner%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremy Hinegardner</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100706" rel="nofollow">Tue, 06 Jul 2010 12:37:04 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi all,

I am doing some sizing estimates for a possible transition to riak of
our document store.  I've mentioned it before on this list before and
in #riak and this is a snippet of a conversation I had with @seancribbs:</pre><pre>

    <a  rel="nofollow" href="https://gist.github.com/c3838e5c421d6ab21c93">https://gist.github.com/c3838e5c421d6ab21c93</a>

I have also reviewed the bitcask-intro.pdf and <a  rel="nofollow" href="http://gist.github.com/438065">http://gist.github.com/438065</a>

Quick and dirty info, I am looking to store billions of documents, starting
with 2 billion initially, and a linear growth of around 10 million per day.

The key is a 64bit number as a string (generaly about 20 bytes) and the value is
a text/xml document of an average size of 1.5KiB.  This size long tails out to
maybe 5 MiB.  

Our system is write once. A key/value pair should never be overwritten once it
is initially inserted, and it is accessed fairly often for about a day, and then
a long tail drop off.  The pair must be available for retrieval at any time.

== Bitcask ==

I went into the source of bitcask to confirm the 32 bytes per key minimum
memory requirements mentioned in <a  rel="nofollow" href="http://gist.github.com/438065">http://gist.github.com/438065</a> and turned
up:

    <a  rel="nofollow" href="http://github.com/basho/bitcask/blob/master/c_src/bitcask_nifs.c#L37">http://github.com/basho/bitcask/blob/master/c_src/bitcask_nifs.c#L37</a>
    
If my calculations are correct, the actual memory overhead, per key using 
bitcask is 72+N bytes on a 64bit system:

    UT_hash_handle -&gt;  50 bytes, (6 pointers and 2 chars)
    file_id        -&gt;   4 bytes,
    total_sz       -&gt;   4 bytes,
    offset         -&gt;   8 bytes,
    tstamp         -&gt;   4 bytes,
    key_sz         -&gt;   2 bytes,
    key            -&gt;   N bytes - how big is this?  is this the riak key, 
                                  or a hash of the riak key?

This adds up to 72 bytes + the size of the key, per key/value in bitcask.

If I assume that the key is 20 bytes, then we are talking 92 bytes of memory
overhead per document. That means I can store, ~11 million documents per GiB of
free memory (1024^3 / 92),  Or, if I have 32GiB of free ram on a machine
to dedicate to riak w/bitcask (the rest would be used for diskcache) I
can store ~373 Million documents.

Are my calculations correct?

It also does not look like bitcask pads values on disk, so there is no wasted
disk space.  Is this correct?

== Innostore ==

For Innostore I'm not so worried about the memory overhead as insertion overhead
and wasted disk space.

Since InnoDB stores data in key order and our keys are esssentially random 64bit
numbers as strings, are we going to have a significant overhead in our
insertions?  

Using innostore, will there be any key/value padding on the data which
would cause an overhead per row of disk usage?

Also, we currently compress the data on on disk, and I would interested in 
hearing how the compression of disk pages with innostore works.

thanks,

-jeremy

-- 
========================================================================
 Jeremy Hinegardner                              jer...@hinegardner.org 


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00679.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd3.html#00681">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail3.html#00681">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00683.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">bitcask and innostore overheads</span> <span class="sender italic">Jeremy Hinegardner</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00683.html">Re: bitcask and innostore overheads</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01187.html">Re: bitcask and innostore overheads</a></span> <span class="sender italic">Colin Surprenant</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="bitcask and innostore overheads">
<input type="hidden" name="msgid" value="20100706193658.GA29363@hinegardner.org">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00681.html">
<input type="submit" value=" Jeremy Hinegardner ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22bitcask+and+innostore+overheads%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00679.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00683.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20100706193658.GA29363@hinegardner.org</li>
</ul>
</div>
</body>
</html>
