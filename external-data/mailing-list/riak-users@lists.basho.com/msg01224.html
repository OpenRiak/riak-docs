<!DOCTYPE html>
<html lang="en">
<head>
<title>cool riak schema for storing log-like data</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01224" id="c">
<link rel="index" href="maillist.html#01224" id="i">
<link rel="prev" href="msg01217.html" id="p">
<link rel="next" href="msg01228.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01224.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22cool+riak+schema+for+storing+log%5C-like+data%22&amp;o=newest" rel="nofollow"><span itemprop="name">cool riak schema for storing log-like data</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Michal+Zajda%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Michal Zajda</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101007" rel="nofollow">Thu, 07 Oct 2010 12:49:09 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi, I come up with this idea of riak schema and wanted to know if you see
some bad sides of that.</pre><pre>

So, I have those devices, which generate logs (these are documents with
stats). Each log is tagged with timestamp.

If we store it like that, in a bucket some-device-name, retrieving data is
pretty hard. I know that mapred bucket is faster and faster but it's not
there, yet.
User needs data from Time1 to Time2. Potentially we can keep Timestamps as
ints and just execute reads on every integer in this interval - but its not
good if it is long interval and we could have e.g. only 2 logs inside.

So the idea is to keep something like index per bucket. Logs would be
sequenced and PUT in device-name-bucket with key = counter. Counter gets
incremented with every message.
In the meantime, there is a parallel process (on timer?) measuring time.
Every minute (or any other frequency = highest resolution of the User's
query) it asks about current counter value and saves it under current
time-stamp in index_bucket. When User comes and asks: &quot;Give me logs from
device1 from Time1 to Time2&quot; we go to index_bucket retrieve Time1.value =
counter1 and Time2.value = counter2. And that's it! We now have exact
interval of keys to query on device-name-bucket. It may be 2 messages when
i.e. counter1=113 and counter2 = 115 or a million messages, but we won't
have any mis-hits in read. It looks pretty efficient.
Sequencing writes may be troubling (why to maintain some queues), so we can
have many buckets for a device each with its own index and counter.

Time1 or Time2 can be human readable so it also helps.

Do you like it? Or you maybe have some different approaches to this kind if
problem? Maybe I miss something?

cheers
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01217.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01224">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01224">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01228.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="cool riak schema for storing log-like data">
<input type="hidden" name="msgid" value="AANLkTikQAA+dwDxsbnu0gqoFVUe-R+Qq-4Yw_RAurC0f@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01224.html">
<input type="submit" value=" Michal Zajda ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22cool+riak+schema+for+storing+log%5C-like+data%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01217.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01228.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTikQAA+dwDxsbnu0gqoFVUe-R+Qq-4Yw_RAurC0f@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
