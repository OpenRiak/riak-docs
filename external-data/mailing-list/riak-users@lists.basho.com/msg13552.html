<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Custom hashing (partitioning) functions</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd4.html#13552" id="c">
<link rel="index" href="mail4.html#13552" id="i">
<link rel="prev" href="msg13425.html" id="p">
<link rel="next" href="msg13418.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13552.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Custom+hashing+%5C%28partitioning%5C%29+functions%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Custom hashing (partitioning) functions</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sargun+Dhillon%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sargun Dhillon</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140130" rel="nofollow">Thu, 30 Jan 2014 17:24:20 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Cool, I went ahead and created an issue a little while ago:
<a  rel="nofollow" href="https://github.com/basho/riak_kv/issues/811">https://github.com/basho/riak_kv/issues/811</a></pre><pre>

It's not so much of a blocker for us, because the product team working
with custom partitioners and Riak. It's just something that people
might want to keep an eye out in the future when using MR, or
riak_pipe directly.

As as side-note, is there information around querying Riak directly
with Riak_pipe; I imagine it has some of the same downsides as
mapreduce. We're primarily using it as a method to avoid the
read-modify-write overheads on writing to Riak, and multi-key,
partition-specific reads (utilizing targeted 2i, because we know the
coverage as we know the partition key).

Has anyone else here done this in production?

On Tue, Jan 21, 2014 at 7:25 AM, Sean Cribbs &lt;s...@basho.com&gt; wrote:
&gt; Sargun,
&gt;
&gt; That might indeed be a bug. Would you file it on the issue tracker?
&gt; <a  rel="nofollow" href="https://github.com/basho/riak_kv/issues">https://github.com/basho/riak_kv/issues</a>
&gt;
&gt;
&gt; On Mon, Jan 20, 2014 at 3:08 PM, Sargun Dhillon &lt;sar...@sargun.me&gt; wrote:
&gt;&gt;
&gt;&gt; So, I don't know how many people are aware of if, but Riak supports
&gt;&gt; custom hashing (partitioning) functions. It's exposed as a bucket
&gt;&gt; property (chash_keyfun), in which you can deploy your own code to hash
&gt;&gt; keys to ensure data locality to specific vnodes. This can come in
&gt;&gt; handy when doing custom mapreduce jobs, riak_pipe, or riak_core
&gt;&gt; applications.
&gt;&gt;
&gt;&gt; After playing around with this feature set quite a bit recently, it
&gt;&gt; seems like there are some places that don't entirely respect this.
&gt;&gt; Specifically, the place where I'm looking at right now is
&gt;&gt; riak_kv_pipe_get, when try_preflist gets called (if try_partition
&gt;&gt; falls through), it falls back to riak_core_util:chash_key (L188), as
&gt;&gt; opposed to looking at the riak_pipe chashfun, or the bucket chashfun.
&gt;&gt; What's the approach that most people have taken here with custom hash
&gt;&gt; functions?
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13425.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd4.html#13552">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail4.html#13552">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13418.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13417.html">Custom hashing (partitioning) functions</a></span> <span class="sender italic">Sargun Dhillon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13425.html">Re: Custom hashing (partitioning) functions</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Custom hashing (partitioning) functions</span> <span class="sender italic">Sargun Dhillon</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Custom hashing (partitioning) functions">
<input type="hidden" name="msgid" value="CAMp4zn_jyPRNMOiVVYCy8Z1C5OTQSFYfKARZxJKXyF6sxBDbnQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13552.html">
<input type="submit" value=" Sargun Dhillon ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Custom+hashing+%5C%28partitioning%5C%29+functions%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13425.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13418.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAMp4zn_jyPRNMOiVVYCy8Z1C5OTQSFYfKARZxJKXyF6sxBDbnQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
