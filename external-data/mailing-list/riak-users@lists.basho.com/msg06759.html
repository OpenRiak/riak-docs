<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Adding a fourth node makes cluster slower in basho bench</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06759" id="c">
<link rel="index" href="maillist.html#06759" id="i">
<link rel="prev" href="msg06721.html" id="p">
<link rel="next" href="msg06725.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06759.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Adding+a+fourth+node+makes+cluster+slower+in+basho+bench%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Adding a fourth node makes cluster slower in basho bench</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120227" rel="nofollow">Mon, 27 Feb 2012 12:32:36 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>John-Paul,

Do you mind posting your config files to go with each run?  Some questions
that come to mind:</pre><pre>

1. Did you start fresh for each run? (i.e. no data)

2. After adding the 4th node did you add it's IP to the bench config?

3. Do you have any iostat numbers to go with these runs? (both for good and
bad would be useful)

4. Do you see any differences in the Riak logs between the good/bad runs?
 E.g. maybe errors or merge activity?

-Ryan

On Thu, Feb 23, 2012 at 4:56 PM, John-Paul Bader
&lt;john-paul.ba...@wooga.net&gt;wrote:

&gt; Hey,
&gt;
&gt;
&gt; so I'm currently benchmarking riak on a bare metal cluster (2xquadcore
&gt; xeon 2.2GHz, 24GB RAM, 120GB SSD, gigabit ethernet between nodes)
&gt;
&gt; I wrote some custom benchmarks in basho bench which connected to all three
&gt; nodes and I filled up the cluster consisting of 3 nodes with about 68GB of
&gt; Data (50mio objects in one bucket and 35mio objects in another). Storage
&gt; backend is leveldb and caching is tuned according to the wiki guide.
&gt;
&gt; Now with those three nodes i could get up to a constant 30k ops/s - see
&gt; <a  rel="nofollow" href="http://smyck.org/fast.png">http://smyck.org/fast.png</a> for example.
&gt;
&gt; I ran basho bench with a concurrency of 80 workers from another node next
&gt; to the three riak nodes. Empirical tests proved that my benchmarks peaked
&gt; at 80 workers in terms of ops/s. Above that it just wasn't getting faster
&gt; and latency increased.
&gt;
&gt; Then I wanted to add another node to see the cluster scale up in
&gt; throughput. What I saw with the same settings except for adding th 4th node
&gt; to the basho bench config was this:
&gt;
&gt; <a  rel="nofollow" href="http://smyck.org/slow.png">http://smyck.org/slow.png</a>
&gt;
&gt; So while it kicked off a lot faster, the performance decreased quickly. I
&gt; even increased the leveldb cache further but the result was the same. Then
&gt; I reduced the concurrency to 70 and I got a constant 35k ops/s again. See
&gt; <a  rel="nofollow" href="http://smyck.org/35concurrent.**png">http://smyck.org/35concurrent.**png</a> &lt;<a  rel="nofollow" href="http://smyck.org/35concurrent.png">http://smyck.org/35concurrent.png</a>&gt;
&gt;
&gt; Now I did kind of a binary search for the sweet spot and it turned out i
&gt; could set the concurrency setting up to 74 - everything above 74 showed the
&gt; behavior from <a  rel="nofollow" href="http://smyck.org/slow.png">http://smyck.org/slow.png</a>
&gt;
&gt; Now - any ideas on that? Is running basho bench from one node the problem?
&gt; The machine running basho bench is at around 45% cpu load. Should it be
&gt; running like tsung - from multiple nodes?
&gt;
&gt; Any ideas? As I'm fairly new to riak it is also quite likely that I missed
&gt; something - so I'd be happy if you'd point me to common mistakes in
&gt; scenarios like these.
&gt;
&gt;
&gt; ~ John
&gt;
&gt; --
&gt; John-Paul Bader | Software Development
&gt;
&gt; www.wooga.com
&gt; wooga GmbH | Saarbruecker Str. 38 | D-10405 Berlin
&gt; Sitz der Gesellschaft: Berlin; HRB 117846 B
&gt; Registergericht Berlin-Charlottenburg
&gt; Geschaeftsfuehrung: Jens Begemann, Philipp Moeser
&gt;
&gt; ______________________________**_________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com">http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com</a>&lt;<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06721.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06759">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06759">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06725.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06721.html">Adding a fourth node makes cluster slower in basho bench</a></span> <span class="sender italic">John-Paul Bader</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Adding a fourth node makes cluster slower in bash...</span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Adding a fourth node makes cluster slower in basho bench">
<input type="hidden" name="msgid" value="CACZcpeknetWFr9YasESXoq5WMmxoP-mK2N-9d6ioedUR=1ierg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06759.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Adding+a+fourth+node+makes+cluster+slower+in+basho+bench%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06721.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06725.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpeknetWFr9YasESXoq5WMmxoP-mK2N-9d6ioedUR=1ierg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
