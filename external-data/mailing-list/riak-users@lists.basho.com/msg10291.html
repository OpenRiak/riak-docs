<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Wiping data directory break vnodes with read_block_error</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10291" id="c">
<link rel="index" href="maillist.html#10291" id="i">
<link rel="prev" href="msg10300.html" id="p">
<link rel="next" href="msg10304.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10291.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Wiping+data+directory+break+vnodes+with+read_block_error%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Wiping data directory break vnodes with read_block_error</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brian+Shumate%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brian Shumate</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130228" rel="nofollow">Thu, 28 Feb 2013 10:02:17 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello Jonas,

I think the issue is that you actually wiped out too much by removing
the entire /var/lib/riak directory.</pre><pre>

Typically when resetting the data directories on a Riak node, you'd remove
the contents of only those backend directories which correspond to the ones
defined in your app.config.

For example, if you are using the Bitcask backend, you'd want to only do
something like:

riak stop
sudo rm -rf /var/lib/riak/bitcask/*
riak start

This removes all Bitcask data but preserves the node's ring state.

If you wanted to reset _both_ the Bitcask data and the ring state you'd do:

riak stop
sudo rm -rf /var/lib/riak/bitcask/*
sudo rm -rf /var/lib/riak/ring/*
riak start

This would essentially reset the node back to a new state while retaining
any configuration changes you already specified in app.config or vm.args.

I hope this helps.

Regards,

Brian Shumate

On Feb 28, 2013, at 2:55 AM, Jonas Lindmark wrote:

&gt; Hi,
&gt; 
&gt; I'm looking for a way to manually wipe the data off of a single-node riak 
&gt; installation. I'm using riak (1.3.0 2013-02-19) Debian x86_64 with the 
&gt; riak_kv_eleveldb_backend.
&gt; 
&gt; What I'm currently doing is:
&gt; 
&gt;       • riak stop
&gt;       • rm -rf /var/lib/riak
&gt;       • mkdir riak
&gt;       • chown riak:riak riak
&gt;       • start riak
&gt; Riak starts ok but a riak-admin vnode-status gives me:
&gt; 
&gt; Backend: riak_kv_eleveldb_backend
&gt; Status: 
&gt; [{stats,&lt;&lt;&quot;                               Compactions\nLevel  Files Size(MB) 
&gt; Time(sec) Read(MB) 
&gt; Write(MB)\n--------------------------------------------------\n&quot;&gt;&gt;},
&gt;  {read_block_error,&lt;&lt;&quot;0&quot;&gt;&gt;}]
&gt; 
&gt; For each vnode.
&gt; 
&gt; It seems to me that there is something more I need to wipe for this to work 
&gt; but I can't find which files that would be.
&gt; 
&gt; /Jonas
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10300.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10291">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10291">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10304.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10281.html">Wiping data directory break vnodes with read_block_error</a></span> <span class="sender italic">Jonas Lindmark</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10282.html">Re: Wiping data directory break vnodes with read_block...</a></span> <span class="sender italic">Jonas Lindmark</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10300.html">Re: Wiping data directory break vnodes with read_b...</a></span> <span class="sender italic">Brian Shumate</span></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Wiping data directory break vnodes with read_block...</span> <span class="sender italic">Brian Shumate</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10304.html">Re: Wiping data directory break vnodes with read_b...</a></span> <span class="sender italic">Jonas Lindmark</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10328.html">Re: Wiping data directory break vnodes with re...</a></span> <span class="sender italic">Jonas Lindmark</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Wiping data directory break vnodes with read_block_error">
<input type="hidden" name="msgid" value="A229B904-2DCE-44D2-B7A0-8E6E451ACE70@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10291.html">
<input type="submit" value=" Brian Shumate ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Wiping+data+directory+break+vnodes+with+read_block_error%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10300.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10304.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">A229B904-2DCE-44D2-B7A0-8E6E451ACE70@basho.com</li>
</ul>
</div>
</body>
</html>
