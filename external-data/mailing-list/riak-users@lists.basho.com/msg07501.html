<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Client Resources,	Deleting a Key Doesn't Remove it from bucket.keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07501" id="c">
<link rel="index" href="maillist.html#07501" id="i">
<link rel="prev" href="msg07491.html" id="p">
<link rel="next" href="msg07504.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07501.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Client+Resources%2C%09Deleting+a+Key+Doesn%27t+Remove+it+from+bucket.keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Client Resources,	Deleting a Key Doesn't Remove it from bucket.keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kelly+McLaughlin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kelly McLaughlin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120522" rel="nofollow">Tue, 22 May 2012 08:58:38 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Steve. There is no caching of key lists in riak. What you are seeing is 
likely the fact that listing of keys or index queries can pick up deleted keys 
due to the fact that riak keeps tombstone markers around for deleted objects 
for some period. For a really good explanation of riak's delete behavior check 
out this writeup by Jon Meredith: 
<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/006048.html">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/006048.html</a>.
 You can set delete_mode to immediate as described in that post and you will 
most likely not see any deleted keys when you do an index query or key list. 
The tradeoff is that you may get the unexpected behavior when doing concurrent 
updates to the same set of keys that the delete_mode changes were designed to 
address as Jon also indicates in that post.  We are considering different 
options on this front, but at this time no actual changes have been made to 
address this. </pre><pre>

Kelly

On May 20, 2012, at 10:13 AM, Steve Warren wrote:

&gt; The last message I saw on this (from a year ago) says the caching of key 
&gt; lists will be removed. I just ran into it while running a $key index range 
&gt; search. I then ran a ?key=stream search on the bucket and the same stale key 
&gt; list appeared (I had created a bunch of data and then deleted it as a test). 
&gt; Did the caching removal not happen? I'm running 1.1.2
&gt; 
&gt; The query:
&gt; 
&gt; curl 'localhost:8098/buckets/testbucket/index/$key/0/g'
&gt; 
&gt; As others have noted, this behavior is quite disconcerting and I don't want 
&gt; to pepper the application with otherwise unnecessary checks for stale keys 
&gt; even on 2i range queries. Or is that unavoidable?
&gt; 
&gt; Regards
&gt; Steve
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07491.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07501">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07501">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07504.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07491.html">Riak Client Resources,	Deleting a Key Doesn't Remove it f...</a></span> <span class="sender italic">Steve Warren</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Client Resources,	Deleting a Key Doesn't Re...</span> <span class="sender italic">Kelly McLaughlin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07504.html">Re: Riak Client Resources,	Deleting a Key Doesn'...</a></span> <span class="sender italic">Steve Warren</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07518.html">Re: Riak Client Resources,	Deleting a Key Do...</a></span> <span class="sender italic">Steve Warren</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07519.html">Re: Riak Client Resources,	Deleting a Ke...</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07521.html">Re: Riak Client Resources,	Deleting...</a></span> <span class="sender italic">Steve Warren</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07529.html">Re: Riak Client Resources,	Dele...</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07530.html">Re: Riak Client Resources,	...</a></span> <span class="sender italic">Steve Warren</span></li>
<li class="icons-email"><span class="subject"><a href="msg07531.html">Re: Riak Client Resources,	...</a></span> <span class="sender italic">Reid Draper</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07520.html">Re: Riak Client Resources,  Deleting a K...</a></span> <span class="sender italic">Kyle Kingsbury</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07522.html">Re: Riak Client Resources,	Deleting...</a></span> <span class="sender italic">Steve Warren</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07523.html">Re: Riak Client Resources,	Dele...</a></span> <span class="sender italic">Reid Draper</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Client Resources,	Deleting a Key Doesn't Remove it from bucket.keys">
<input type="hidden" name="msgid" value="8C90310F-5558-4ADA-9896-DBFB3EFC9DAD@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07501.html">
<input type="submit" value=" Kelly McLaughlin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Client+Resources%2C%09Deleting+a+Key+Doesn%27t+Remove+it+from+bucket.keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07491.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07504.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">8C90310F-5558-4ADA-9896-DBFB3EFC9DAD@basho.com</li>
</ul>
</div>
</body>
</html>
