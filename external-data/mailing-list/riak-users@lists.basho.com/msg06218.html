<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Rebalancing pain and 100 percentile stat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06218" id="c">
<link rel="index" href="maillist.html#06218" id="i">
<link rel="prev" href="msg06216.html" id="p">
<link rel="next" href="msg06220.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06218.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Rebalancing+pain+and+100+percentile+stat%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Rebalancing pain and 100 percentile stat</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22David+Smith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">David Smith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120110" rel="nofollow">Tue, 10 Jan 2012 11:27:52 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Tue, Jan 10, 2012 at 11:17 AM, Elias Levy
&lt;fearsome.lucid...@gmail.com&gt; wrote:</pre><pre>

&gt; Is this expected behavior?  Granted, these are EC2 boxes and Leveldb depends
&gt; heavily on disk, but I can't imagine folks using Riak on production his this
&gt; type of performance hit resulting from rebalancing.

tl;dr - yes, adding nodes can create a lot of load on the system.
We've done a lot of work in this area recently.

Rebalancing can be quite expensive with the default claim algorithm
that ships in all releases to date. In the 1.0.3 release (dropping
this week, I hope), we will be switching to a new default claim
algorithm that will dramatically decrease the amount of
rebalancing/shuffling that will be required. With this change in
place, we've seen production clusters grow from 11 to 30+ nodes with
minimal impacts.

One of the other areas where we've seen systems get overloaded when
adding nodes is that there is too much concurrent handoff. We've
addressed this (also in 1.0.3) by tuning down the default setting for
(outbound) handoff_concurrency (was 4, now 1). In addition, the 1.1
release (mid-late Feb) will ship with ability to limit inbound
handoff_concurrency (you can try this now on HEAD).

It's also worth noting that adding a 4th node to a 3 node cluster is
going to be way more expensive/impactful than adding a 5th node. In a
3-node cluster, with N=3, every node is involved in every request --
add handoff on top of that and latency will get crazy.

&gt; I recall there was some mention that by using Riak EDS it was possible to
&gt; fill in a new node slowly, and then have it join the cluster when its nearly
&gt; in sync, thus limiting the stampede effect that regular rebalancing seems to
&gt; bring on.  Is that the case?  If so, is there any documentation on this?

No, all the handoff/rebalancing stuff is part of our core product and,
as such, is completely Open Source. handoff_concurrency + better claim
algo is the way to manage this stampede.

&gt; Or are the time stats not rolling stats?  Are they computed since the start
&gt; of the node, meaning that the 100 percentile will never go down, only up?

Yes, they should be rolling stats on a 1 minute interval. We've
observed normal behaviour in the production systems we've seen, but
I'll ask someone to double check that they are working correctly.
Thanks for reporting this.

D.

-- 
Dave Smith
Director, Engineering
Basho Technologies, Inc.
diz...@basho.com

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06216.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06218">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06218">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06220.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06214.html">Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06216.html">Re: Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">Joseph Blomstedt</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Rebalancing pain and 100 percentile stat</span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06220.html">Re: Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06221.html">Re: Rebalancing pain and 100 percentile stat</a></span> <span class="sender italic">Ian Plosker</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Rebalancing pain and 100 percentile stat">
<input type="hidden" name="msgid" value="CAKiC6f=YmyUbO1k7qZ6KMA+wdawgM5BNTesPrBMXmPFb1s3qDQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06218.html">
<input type="submit" value=" David Smith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Rebalancing+pain+and+100+percentile+stat%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06216.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06220.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAKiC6f=YmyUbO1k7qZ6KMA+wdawgM5BNTesPrBMXmPFb1s3qDQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
