<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Millions of buckets?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#03325" id="c">
<link rel="index" href="mail5.html#03325" id="i">
<link rel="prev" href="msg03307.html" id="p">
<link rel="next" href="msg04278.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03325.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Millions+of+buckets%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Millions of buckets?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Kennedy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Kennedy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110512" rel="nofollow">Thu, 12 May 2011 21:32:50 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Wed, May 11, 2011 at 12:25 PM, Jared Morrow &lt;ja...@basho.com&gt; wrote:
&gt; It seems like what you are needing is a lot what the Yammer guys needed for
&gt; their streamie application.   They have a video
&gt; here: <a  rel="nofollow" href="http://vimeo.com/21598799">http://vimeo.com/21598799</a> about how they modeled their data.   It
&gt; might be pretty helpful for your application.   If not, no harm done, you
&gt; still get to watch a video from some pretty smart people!</pre><pre>

There are some differences between what Alexey is describing and what
we built at Yammer. The key difference is per-item read/unread state.
That being said, I don't think it's a deal breaker. And I don't think
you need search.

At Yammer we have a notion of streams (notifications is one of our
streams). Each stream has a list of stream items. For instance, &quot;Bob
liked your message&quot; or &quot;Jenny replied to your message&quot; or &quot;Charlie
mentioned you in a thread&quot;. Each stream item has a uniquely generated,
monotonically increasing ID. That's great, that gives us something to
sort and dedupe on. We store the stream items for a user in a single
key/value. Each stream type has it's own bucket. To get to my
notifications, I would fetch /riak/notifications/ryan. To keep things
simple (and bounded) we only store the most recent 1,000 or so stream
items for each user. Older notifications age out of the system as
newer ones replace them. That's fine…for nearly all of our users 1,000
notifications would represent a significant amount of calendar time.
More than they could be expected to page back through.

In addition, we support the notion of a cursor. A cursor is simply a
pointer into a stream. We use the cursor to indicate the last seen
stream item. We have a single bucket for cursors. To get my default
cursor, I would fetch /riak/cursors/ryan-default. The value of that
key is the ID of an item in my notifications stream. This is where
your requirements and ours diverge a bit: we don't have per-item
seen/unseen state.

That being said, you could take the basics of our design and add
per-item seen/unseen state. Ditch our cursors and add a &quot;seen&quot; field
to each stream item. The one problem you're going to have is the
eventual consistency model, especially if you want to support the
ability for users to once again mark something as unseen/unread. In
that case, if you ever encounter sibling values, you may not be able
to reliably merge them. If in one sibling value you see a notification
as read and another as unread, you can't tell which was the last
action taken by the user. Not allowing users to mark something as
unread once again should simplify that problem (if either sibling
value is read, then the notification is read since you can't go back).
Alternatively, consider using a cursor like we are. The write is much
smaller and you don't have to read first to perform the update.

Hopefully that sheds a little more light on what we're doing at
Yammer. As Jared pointed out, the video from our talk is online. @coda
even cracks a few good jokes.

Good luck!

Ryan Kennedy
Infrastructure Engineer @ Yammer

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03307.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#03325">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail5.html#03325">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04278.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03304.html">Millions of buckets?</a></span> <span class="sender italic">alexeypro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03305.html">Re: Millions of buckets?</a></span> <span class="sender italic">alexeypro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03306.html">Re: Millions of buckets?</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03308.html">Re: Millions of buckets?</a></span> <span class="sender italic">Alexey Prohorenko</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg03307.html">Re: Millions of buckets?</a></span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Millions of buckets?</span> <span class="sender italic">Ryan Kennedy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04278.html">Re: Millions of buckets?</a></span> <span class="sender italic">pablochacin</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Millions of buckets?">
<input type="hidden" name="msgid" value="BANLkTinKfUmmEk04Q1ZGiL0ZHZk67sWFcg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03325.html">
<input type="submit" value=" Ryan Kennedy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Millions+of+buckets%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03307.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04278.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BANLkTinKfUmmEk04Q1ZGiL0ZHZk67sWFcg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
