<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: if_not_modified</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09221" id="c">
<link rel="index" href="maillist.html#09221" id="i">
<link rel="prev" href="msg09217.html" id="p">
<link rel="next" href="msg09248.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09221.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+if_not_modified%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: if_not_modified</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Elias+Levy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Elias Levy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121106" rel="nofollow">Tue, 06 Nov 2012 21:57:23 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sent from my iPhone

On Nov 6, 2012, at 7:34 PM, Reid Draper &lt;reiddra...@gmail.com&gt; wrote:</pre><pre>

&gt; Elias,
&gt;
&gt; There's quite a few questions in here, but hopefully I'll answer the meat of 
&gt; what you're
&gt; trying to find out. Using `if_not_modified` is _not_ equivalent to a 
&gt; distributed atomic
&gt; compare-and-swap (CAS). As you've correctly identified, concurrent writers
&gt; on different coordinators can all succeed in writing different values, while
&gt; still meeting the prerequisite for `if_not_modified`.

Aye. I figured as much from previous discussion, but what the docs are
not clear on is what other guarantees if-not-modified makes aside from
concurrent writes. The docs fail to mention what R and PR, if any, are
used to determine the current vclock for the if-not-modified check.
When expect some guarantees, even if weak, or the feature would not
exist. These to be made explicit.

It's also not clear from the docs what Riak considers the latest value
to return if allow_mult is false and so is last_write_wins, when you
have a conflict.

&gt;
&gt; Reid
&gt;
&gt; On Nov 6, 2012, at 2:06 PM, Elias Levy &lt;fearsome.lucid...@gmail.com&gt; wrote:
&gt;
&gt;&gt; The description of if_not_modified is lacking in the documentation.  What 
&gt;&gt; guarantees if_not_modified provides  is a question that has been asked in 
&gt;&gt; the list a few times, but for which no satisfactory answer has been given.  
&gt;&gt; Its something I've been wanted answered as well, so I did a bit of digging 
&gt;&gt; into the code.
&gt;&gt;
&gt;&gt; I gather from reading the code that whatever node receives the INM request 
&gt;&gt; perform an internal get to retrieve the object to get its vclock to compare 
&gt;&gt; to the incoming object.  The get appears to use the R value that is the 
&gt;&gt; default for the bucket.  The default value of R for a bucket is &quot;quorum&quot;, 
&gt;&gt; unless changed, although the default for PR is 0.  Thus, INM can strongly 
&gt;&gt; guarantee no stale writes, but only if no primary replica nodes have failed 
&gt;&gt; or have become partitioned.  That also assumes that you are using at least 
&gt;&gt; an W of &quot;quorum&quot;, and ideally a PR of the same.
&gt;&gt;
&gt;&gt; Correct me if I am wrong, but there appears no way to set the R and PR 
&gt;&gt; values to be used by the internal get during a INM put request, except for 
&gt;&gt; changing the bucket default R and PR values.
&gt;&gt;
&gt;&gt; The INM only guarantees no stale writes, and only does so when R, PR, W, and 
&gt;&gt; WR are such to to guarantee strong consistency.  It does not guard against 
&gt;&gt; concurrent writes.  Multiple writers can succeed even when using INM if they 
&gt;&gt; write at the same time.
&gt;&gt;
&gt;&gt; If you have allow_mult set to true in the bucket, that means the client must 
&gt;&gt; handle sibling resolution.  If allow_mult is set to false and 
&gt;&gt; last_write_wins is set to true, concurrent writes will succeed, but the 
&gt;&gt; value with the latest timestamp will win.  If last_write_wins is set to 
&gt;&gt; false while allow_multi is also false, Riak will keep siblings internally, 
&gt;&gt; but use vector clocks to only return a single value.
&gt;&gt;
&gt;&gt; Its unclear from the documentation what it does in the case of conflicts to 
&gt;&gt; resolve the siblings into the single value.  The docs say you'll receive the 
&gt;&gt; &quot;latest&quot; value, but does not say how latest is determined in the case of a 
&gt;&gt; conflict.
&gt;&gt;
&gt;&gt; Elias Levy
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09217.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09221">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09221">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09248.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09206.html">if_not_modified</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09217.html">Re: if_not_modified</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: if_not_modified</span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09248.html">Re: if_not_modified</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09249.html">Re: if_not_modified</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09250.html">Re: if_not_modified</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09279.html">Re: if_not_modified</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: if_not_modified">
<input type="hidden" name="msgid" value="-5682879041315286206@unknownmsgid">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09221.html">
<input type="submit" value=" Elias Levy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+if_not_modified%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09217.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09248.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">-5682879041315286206@unknownmsgid</li>
</ul>
</div>
</body>
</html>
