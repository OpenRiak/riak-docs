<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Random Block Not Found Issues with Riak/Riak CS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14503" id="c">
<link rel="index" href="maillist.html#14503" id="i">
<link rel="prev" href="msg14500.html" id="p">
<link rel="next" href="msg14505.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14503.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Random+Block+Not+Found+Issues+with+Riak%5C%2FRiak+CS%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Random Block Not Found Issues with Riak/Riak CS</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kelly+McLaughlin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kelly McLaughlin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140717" rel="nofollow">Thu, 17 Jul 2014 09:27:12 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Dave,

Can you tell me what versions of Riak and Riak CS you have installed? Do you 
have AAE enabled or disabled? It’s tough to come up with an explanation without 
more information, but I would try setting n_val_1_get_requests to false and see 
if you continue to experience the problem. My guess is that will resolve the 
issue, but let me know what happens. </pre><pre>

Kelly

On July 17, 2014 at 1:00:19 AM, Dave Finster (davefins...@icloud.com) wrote:

Hi Everyone

Spent a bit of time trying to debug this one and not sure were to from here. 
The use case that appears to cause this breakage is a web page that links to 8 
x 10MB images and it attempts to fetch them simultaneously.  

Occasionally, one or two of the images will just fail to load, while other 
times they all work file. I’ve tracked it down to the crash below. It isn’t 
always the same image. To make the problem more repeatable, I forced our load 
balancer into only using a single Riak-CS node, so it will be getting hit with 
all the requests. We are using HAProxy out the front and are running SmartOS 
64-bit images across the board.

arekinath helped me look into it and one thought was that I was hit by the AAE 
bug prior to 1.4.8, but even clearing the AAE made no difference. The n-val on 
the buckets is 3 and its a 4-node cluster. All 4 nodes have both a Riak and a 
Riak-CS node on it. I also have pb_backlog turned up to 256, 
n_val_1_get_requests set to true and fold_objects_for_list_keys set to true. 
‘ring-status’ shows that the whole ring is reachable.  

Any idea on how to diagnose this one further?

2014-07-17 06:38:54 =CRASH REPORT====
crasher:
initial call: mochiweb_acceptor:init/3
pid: &lt;0.26119.1&gt;
registered_name: []
exception exit: 
{{normal,{gen_fsm,sync_send_event,[&lt;0.27617.1&gt;,get_next_chunk,infinity]}},[{gen_fsm,sync_send_event,3,[{file,&quot;gen_fsm.erl&quot;},{line,214}]},{riak_cs_wm_utils,streaming_get,4,[{file,&quot;src/riak_cs_wm_utils.erl&quot;},{line,272}]},{webmachine_decision_core,'-make_encoder_stream/3-fun-0-',3,[{file,&quot;src/webmachine_decision_core.erl&quot;},{line,667}]},{webmachine_request,send_stream_body_no_chunk,2,[{file,&quot;src/webmachine_request.erl&quot;},{line,334}]},{webmachine_request,send_response,3,[{file,&quot;src/webmachine_request.erl&quot;},{line,398}]},{webmachine_request,call,2,[{file,&quot;src/webmachine_request.erl&quot;},{line,251}]},{webmachine_decision_core,wrcall,1,[{file,&quot;src/webmachine_decision_core.erl&quot;},{line,42}]},{webmachine_decision_core,finish_response,3,[{file,&quot;src/webmachine_decision_core.erl&quot;},{line,92}]}]}
ancestors: [object_web_mochiweb,riak_cs_sup,&lt;0.143.0&gt;]
messages: []
links: [&lt;0.298.0&gt;,#Port&lt;0.12015&gt;]
dictionary: 
[{reqstate,{wm_reqstate,#Port&lt;0.12015&gt;,[{'content-encoding',&quot;identity&quot;},{'content-type',&quot;application/octet-stream&quot;},{resource_module,riak_cs_wm_object}],undefined,&quot;10.4.242.1&quot;,{wm_reqdata,'GET',http,{1,1},&quot;10.4.242.1&quot;,undefined,[],&quot;/buckets/&lt;the
 bucket 
name&gt;/objects/bf15f98c-eaa1-4ff9-83ff-24c1e7e1380f%2F847c340cfe2f44028d6fd5606f696796%2FAttachment-1.png&quot;,&quot;/buckets/&lt;the
 bucket 
name&gt;/objects/bf15f98c-eaa1-4ff9-83ff-24c1e7e1380f%2F847c340cfe2f44028d6fd5606f696796%2FAttachment-1.png?Signature=U0By3mIwaRIVBHNcYhSt6r5QgPk%3D&amp;Expires=1405580057&amp;AWSAccessKeyId=DGTXHHWIEDF4XUBSBYVI&quot;,[{bucket,&quot;&lt;the
 bucket 
name&gt;&quot;},{object,&quot;bf15f98c-eaa1-4ff9-83ff-24c1e7e1380f%2F847c340cfe2f44028d6fd5606f696796%2FAttachment-1.png&quot;}],[],&quot;../../../..&quot;,{200,undefined},1073741824,67108864,[{&quot;_ga&quot;,&quot;GA1.3.643660316.1404789703&quot;}],[{&quot;Signature&quot;,&quot;U0By3mIwaRIVBHNcYhSt6r5QgPk=&quot;},{&quot;Expires&quot;,&quot;1405580057&quot;},{&quot;AWSAccessKeyId&quot;,&quot;DGTXHHWIEDF4XUBSBYVI&quot;}],{9,{&quot;cookie&quot;,{'Cookie',&quot;_ga=GA1.3.643660316.1404789703&quot;},{&quot;accept-language&quot;,{'Accept-Language',&quot;en-US,en;q=0.8&quot;},{&quot;accept-encoding&quot;,{'Accept-Encoding',&quot;gzip,deflate,sdch&quot;},{&quot;accept&quot;,{'Accept',&quot;image/webp,*/*;q=0.8&quot;},nil,nil},nil},{&quot;connection&quot;,{'Connection',&quot;keep-alive&quot;},nil,nil}},{&quot;referer&quot;,{'Referer’,”&lt;the
 referrer&gt;&quot;},{&quot;host&quot;,{'Host’,”&lt;our riak-cs host 
name&gt;&quot;},nil,nil},{&quot;user-agent&quot;,{'User-Agent',&quot;Mozilla/5.0 (Macintosh; Intel Mac 
OS X 10_10_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 
Safari/537.36&quot;},nil,{&quot;x-rcs-rewrite-path&quot;,{&quot;x-rcs-rewrite-path&quot;,&quot;/&lt;the bucket 
name&gt;/bf15f98c-eaa1-4ff9-83ff-24c1e7e1380f/847c340cfe2f44028d6fd5606f696796/Attachment-1.png?AWSAccessKeyId=DGTXHHWIEDF4XUBSBYVI&amp;Expires=1405580057&amp;Signature=U0By3mIwaRIVBHNcYhSt6r5QgPk%3D&quot;},nil,nil}}}}},not_fetched_yet,false,{3,{&quot;content-type&quot;,{&quot;Content-Type&quot;,&quot;application/octet-stream&quot;},nil,{&quot;etag&quot;,{&quot;ETag&quot;,&quot;\&quot;a3a32cf5d8f502d7e8d35fd8412a6878\&quot;&quot;},nil,
trap_exit: false
status: running
heap_size: 28657
stack_size: 24
reductions: 80773
neighbours:

Thanks,
Dave Finster
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14500.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14503">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14503">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14505.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14500.html">Random Block Not Found Issues with Riak/Riak CS</a></span> <span class="sender italic">Dave Finster</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Random Block Not Found Issues with Riak/Riak CS</span> <span class="sender italic">Kelly McLaughlin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14505.html">Re: Random Block Not Found Issues with Riak/Riak...</a></span> <span class="sender italic">Dave Finster</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14531.html">Re: Random Block Not Found Issues with Riak/...</a></span> <span class="sender italic">Charles Bijon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14532.html">Re: Random Block Not Found Issues with R...</a></span> <span class="sender italic">Dave Finster</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14533.html">Re: Random Block Not Found Issues w...</a></span> <span class="sender italic">Charles Bijon</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Random Block Not Found Issues with Riak/Riak CS">
<input type="hidden" name="msgid" value="etPan.53c7f7ad.6b8b4567.aa@kelly.local">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14503.html">
<input type="submit" value=" Kelly McLaughlin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Random+Block+Not+Found+Issues+with+Riak%5C%2FRiak+CS%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14500.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14505.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">etPan.53c7f7ad.6b8b4567.aa@kelly.local</li>
</ul>
</div>
</body>
</html>
