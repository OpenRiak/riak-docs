<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: safely resolving conflicts on read</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05423" id="c">
<link rel="index" href="maillist.html#05423" id="i">
<link rel="prev" href="msg05422.html" id="p">
<link rel="next" href="msg05417.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05423.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+safely+resolving+conflicts+on+read%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: safely resolving conflicts on read</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Aphyr%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Aphyr</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111102" rel="nofollow">Wed, 02 Nov 2011 10:46:35 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 11/02/2011 10:40 AM, Justin Karneges wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Thanks everyone for these replies (and also Aphyr, off-list).  It has helped me
confirm my suspicions and sounds like I'm on the right track.</pre><pre>

For one of my keys, I am doing sort of a manual &quot;last write wins&quot; by having
the reader sort siblings by timestamp, then by vtag, to deterministically
select the same sibling every time.  The reason for keeping the other siblings
around is they may contain the only references to other keys created along
with them.  A separate cleanup process can then be sure to delete the referred
keys before removing the siblings.  And of course the algorithm used to
determine the winning sibling is shared by both the read function and the
cleanup function.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>We do something similar. A feed, for example, stores a list of keys 
</tt><tt>pointing to feed items. In memory, I store &quot;pending insertion&quot; and 
</tt><tt>&quot;pending deletion&quot; lists on a feed. At save time, a model callback saves 
</tt><tt>the items pending insertion, and deletes any pending deletion.
</tt><pre style="margin: 0em;">

</pre><tt>The conflict resolution operator for a feed takes the union of all feed 
</tt><tt>item keys, sorts them (to keep the most recent X) and truncates the 
</tt><tt>list--storing all the truncated items in the pending-deletion list. This 
</tt><tt>isn't perfect, but has acceptable probabilistic bounds for our use case.
</tt><pre style="margin: 0em;">

--Kyle

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05422.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05423">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05423">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05417.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05413.html">safely resolving conflicts on read</a></span> <span class="sender italic">Justin Karneges</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05416.html">SV: safely resolving conflicts on read</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05419.html">Re: safely resolving conflicts on read</a></span> <span class="sender italic">Bob Ippolito</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05422.html">Re: safely resolving conflicts on read</a></span> <span class="sender italic">Justin Karneges</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: safely resolving conflicts on rea...</span> <span class="sender italic">Aphyr</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: safely resolving conflicts on read">
<input type="hidden" name="msgid" value="4EB181F5.3000109@aphyr.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05423.html">
<input type="submit" value=" Aphyr ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+safely+resolving+conflicts+on+read%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05422.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05417.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4EB181F5.3000109@aphyr.com</li>
</ul>
</div>
</body>
</html>
