<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak packaging for RPM-based distros</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09772" id="c">
<link rel="index" href="maillist.html#09772" id="i">
<link rel="prev" href="msg09771.html" id="p">
<link rel="next" href="msg09773.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09772.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+packaging+for+RPM%5C-based+distros%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak packaging for RPM-based distros</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jared+Morrow%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jared Morrow</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130109" rel="nofollow">Wed, 09 Jan 2013 11:02:28 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Aleksey,

First off, thanks for the email and suggestions.  Also thanks for working
on RPM's for OpenSUSE and providing your repo.  I'll try to hit each topic
in the rough order you mentioned them.</pre><pre>

Let me comment first on our packaging of Erlang with Riak.  I agree, this
is not typically how distributions work.  In our case, making a distributed
database that people depend on to be stable and performant also requires us
to control the Erlang VM we use.  In a particular case, we've been fighting
Erlang scheduler issues in regards to our use of NIF's that has changed
behavior between versions of Erlang.  Because of this issue, we haven't
moved forward on using new versions past R15B02 of erlang.  Because we are
responsible for any problems with Riak, I do not see anytime in the future
we will give up control of the Erlang we use at the expense of a slightly
larger rpm / deb / tgz size.  That was just one example, another is the use
of HiPE or no HiPE where we've found segfaults when using HiPE on SunOS or
*BSD due to fixed memory buffer sizes.  So, this is a lot to say that I
agree with you it seems like we are doing the wrong thing by including
Erlang with Riak, but I'm also saying that what we are doing is the right
thing in regards to stability, performance, and the customer experience as
a whole.

Regarding packaging components as separate RPM's.  This is another thing
that distributions have tried to get us to do, make a riak_core, riak_kv,
erlang_js, etc., etc. rpm.  Again, I see no benefit at all to people who
use riak.  This is a benefit solely to fit into packaging guidelines made
by distributions.  When testing such a complicated system such as Riak,
breaking it up into 30 pieces would simply make testing harder and the
product less stable.  Unless you are writing a riak_core app, who would
just *just* want a riak_core RPM anyway?  Yes it might help a few people
here and there, but for those people the source *is* available and it isn't
worth sacrificing the experience of the other 99% of users.  Right now if
someone has a problem, I can say, &quot;tell me what ./riak version says&quot; and
know exactly what is running.  If they have 30 RPM's installed that makes
that much much more difficult.  So again, theoretically I agree we seem to
be doing it wrong, but I'd argue distributions have that completely
backwards prioritizing the ability to customize every install at the
expense of a cohesive and stable system.

- honor filesystem hierarchy of underlying OS.


This one I'd like to hear more about.  I've made some changes along the way
for systems I didn't know as much about at first pass (mainly SunOS
flavors), but I know for a fact we haven't got everything right.  If you
have some examples of where we are doing it wrong in regards to our
install, please let me know or file a bug at
<a  rel="nofollow" href="https://github.com/basho/riak">https://github.com/basho/riak</a>  This is especially true for any new
guidelines that have come out
recently that we have missed.

So again, my answer is probably not what you hoped for, but I do appreciate
the criticism.  Please keep it coming and argue with me if you think we're
still doing it wrong after my justifications above.

Thanks,
Jared

On Wed, Jan 9, 2013 at 5:53 AM, Aleksey Morarash &lt;tuxo...@gmail.com&gt; wrote:

&gt; Hi All!
&gt;
&gt; Someone can possibly perceive the states below as a heresy, so, first of
&gt; all, I want to declare: I have no intention to start new holywar here, I
&gt; just propose a solution.
&gt;
&gt; I have noticed that packages available at
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/downloads/">http://docs.basho.com/riak/latest/downloads/</a> includes a kind of so-called
&gt; Erlang &quot;release&quot;. This release includes all Riak-related Erlang
&gt; applications and Erlang VM in one package.
&gt;
&gt; Using such package produces several problems:
&gt; - Erlang VM upgrade. Erlang VM, used by Riak installed, can be upgraded
&gt; only with Riak code;
&gt; - integration with 3d party Erlang code. I mean filesystem hierarchy usage
&gt; - this &quot;release&quot; uses its own location for Erlang applications;
&gt; - and again: integration with 3d party Erlang code on Erlang VM level - to
&gt; include custom functionality I must patch existing &quot;release&quot;.
&gt;
&gt; I know that such a &quot;release&quot; is generated by rebar, which used to build
&gt; almost all Riak-related Erlang applications and libraries.
&gt;
&gt; My proposal is to make Riak packaging more system-friendly:
&gt; - use Erlang OTP, provided by target distribution;
&gt; - package each Riak-related Erlang application in separate RPM/DEB etc;
&gt; - honor filesystem hierarchy of underlying OS.
&gt;
&gt; This includes (for each distro):
&gt; - create a bundle of package specs;
&gt; - create a package repo, based on packages built.
&gt;
&gt; I have already packaged most of Riak-related Erlang applications and
&gt; libraries for OpenSUSE 11.4. RPM package repository with packages generated
&gt; we already use in production. To package some applications I had replace
&gt; usual &quot;rebar compile&quot; recipes, because there is no way to disable recursive
&gt; dependency fetch from remote GIT repositories. All these packages was
&gt; successfully built in chrooted clean environment which ensures RPM
&gt; repository consistency.
&gt;
&gt; All these RPM specs are available at forked
&gt; <a  rel="nofollow" href="https://github.com/strikead/riak">https://github.com/strikead/riak</a> repo:
&gt; <a  rel="nofollow" href="https://github.com/strikead/riak/tree/master/pkg.d/opensuse/specs">https://github.com/strikead/riak/tree/master/pkg.d/opensuse/specs</a>
&gt;
&gt; P.S. Sorry, there is no possibility to public use of our RPM repo at all :(
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09771.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09772">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09772">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09773.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09771.html">Riak packaging for RPM-based distros</a></span> <span class="sender italic">Aleksey Morarash</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak packaging for RPM-based distros</span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09773.html">Re: Riak packaging for RPM-based distros</a></span> <span class="sender italic">Andrew Thompson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09779.html">Re: Riak packaging for RPM-based distros</a></span> <span class="sender italic">Tom Lanyon</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg09775.html">Re: Riak packaging for RPM-based distros</a></span> <span class="sender italic">Aleksey Morarash</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09776.html">Re: Riak packaging for RPM-based distros</a></span> <span class="sender italic">Jared Morrow</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak packaging for RPM-based distros">
<input type="hidden" name="msgid" value="CACUSOveBOa26ZuDvHopL0W+-Oh9XFZpeGXbUn5PZLMQ0qBU5zA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09772.html">
<input type="submit" value=" Jared Morrow ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+packaging+for+RPM%5C-based+distros%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09771.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09773.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACUSOveBOa26ZuDvHopL0W+-Oh9XFZpeGXbUn5PZLMQ0qBU5zA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
