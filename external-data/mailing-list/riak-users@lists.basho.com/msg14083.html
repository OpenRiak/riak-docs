<!DOCTYPE html>
<html lang="en">
<head>
<title>Performance slows down with write heavy use</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14083" id="c">
<link rel="index" href="maillist.html#14083" id="i">
<link rel="prev" href="msg14078.html" id="p">
<link rel="next" href="msg14084.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14083.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Performance+slows+down+with+write+heavy+use%22&amp;o=newest" rel="nofollow"><span itemprop="name">Performance slows down with write heavy use</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+MacClary%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew MacClary</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140414" rel="nofollow">Mon, 14 Apr 2014 14:35:27 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I have a persistent issue I am trying to diagnose. In our use of Riak we
have multiple data creators writing into a 7 node cluster. The value size
is a bit large at around 2MB. The behavior I am seeing is that if I delete
all data out of bitcask, then test performance I get fast writes. As I keep
doing the same work of writing to the cluster, then the Riak write times
will start tailing off and getting really bad.</pre><pre>

Initial write times seen by my application: 0.5 seconds for 100MB worth of
values (~200MB/s)
Subsequent write times: 11 seconds for 100MB worth of values (~9MB/s)

This slow down can happen over roughly 20-40 minutes of writing or about
200GB worth of key/value pairs written.

I can reset the cluster to get fast performance again by stopping Riak and
deleting the bitcask directories, then starting Riak again. This step is
not feasible for production, but during testing at least the write speed
goes up by 20x.

Watching iostat I see that every few seconds the disk io jumps to ~11%. It
doesn't seem that highly loaded from my cursory look. Watching top I see
that beam.smp runs at around 100 for CPU% or less when heavily loaded. I am
not sure how to tell what it is doing though :-)

Thanks for any suggestions!!

-Matt



================
System Description


avg value size = 2MB
Riak version = 1.4.1
n_val = 2
client threads total = 105
backend = bitcask
ring_creation_size = 128
node count = 7
node OS = RHEL 6.2
server RAM = 128GB
RAID = RAID0 across 8 SAS drives
FS = ext4
FS options = /dev/mapper/vg0-lv0 / ext4
rw,noatime,barrier=0,stripe=512,data=ordered 0 0
bitcask size on one server = 133GB
AAE = off
interface = protobuf
client library = riak java client
file-max = 65536
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14078.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14083">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14083">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14084.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Performance slows down with write heavy use</span> <span class="sender italic">Matthew MacClary</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14084.html">Re: Performance slows down with write heavy use</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14085.html">Fwd: Performance slows down with write heav...</a></span> <span class="sender italic">Jie Lu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14086.html">Re: Performance slows down with write h...</a></span> <span class="sender italic">Istv√°n</span></li>
<li class="icons-email"><span class="subject"><a href="msg14087.html">Re: Performance slows down with write h...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14088.html">Re: Performance slows down with wri...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg14095.html">Re: Performance slows down with write heavy...</a></span> <span class="sender italic">Matthew MacClary</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Performance slows down with write heavy use">
<input type="hidden" name="msgid" value="CAFYg45yK9p+hz5JVzm+DTrqiPABMLv1xqdAVK7dBWzrn11-nDg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14083.html">
<input type="submit" value=" Matthew MacClary ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Performance+slows+down+with+write+heavy+use%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14078.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14084.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAFYg45yK9p+hz5JVzm+DTrqiPABMLv1xqdAVK7dBWzrn11-nDg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
