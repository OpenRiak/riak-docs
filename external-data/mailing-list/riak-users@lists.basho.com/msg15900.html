<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Advice on making a Riak middleware easy to configure</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15900" id="c">
<link rel="index" href="maillist.html#15900" id="i">
<link rel="prev" href="msg15853.html" id="p">
<link rel="next" href="msg15901.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15900.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Advice+on+making+a+Riak+middleware+easy+to+configure%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Advice on making a Riak middleware easy to configure</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Brender%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Brender</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150316" rel="nofollow">Mon, 16 Mar 2015 08:42:00 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Marc,
Our side conversation starts to help, but I'm sure there's more to discuss
here. I believe you want to know: what configuration assumptions about Riak
can be made before connecting into apiman vs what functionality does apiman
have to support?</pre><pre>

If you're looking to start simple, I'd think beginning from an assumption
of interfacing with the load balancer in front of a Riak cluster to be a
good move.

Perhaps other members note the definition of a &quot;typical&quot; configuration to
help.

Best,
Matt

----


Hi Matt,

It would seem that I fell on the wrong side of the divide between
providing enough context and making my query clear!

In short, apiman consists of two main parts: runtime (gateway) and
design-time (manager). The manager pushes configuration to the gateway
which then enforces policies on transiting traffic - that might be
something like rate-limiting, authentication, or metrics collection on
HTTP traffic.

The gateway is horizontally scalable, so it requires a data store to
facilitate shared state functionality (e.g. rate-limit applies across
the whole cluster of gateways). We have pluggability at the data-store
level - so, by implementing a few interfaces we can use a given
data-store in an abstracted manner (i.e. zero knowledge about the
underlying specifics when a policy uses a shared state component).

Users can choose whichever data-store suits their needs; simply select
it and provide relevant configuration information to the plug-in (via a
config file, or whatever).

The issue I have is simply: what configuration options should we provide
for our plug-in so it can connect to a typical Riak set-up(s) (given I
have zero knowledge of their set-up and Riak user's conventions).

For instance in the config file, do I:

- Accept a list of Riak nodes and try to *construct* a cluster for them;
or is it safe to assume they've done this in advance?

- Try to define buckets &amp; associated data-types, or should I assume this
is done in advance?

- Just assume everyone uses Riak behind a load-balancer, and I just need
to accept a single URI?

Some of these scenarios run into idempotence issues, so it may be that
it's unsafe or poor for performance to allow those.

I'm happy to support multiple configurations, just I'm not sure which
ones are typical, given there are a large number of possible permutations.

I hope I've been a bit clearer this time; please let me know if I haven't!

Appreciate your assistance.

Regards,
Marc
·êß

*Matt Brender | Developer Advocacy Lead*
Basho Technologies
t: @mjbrender &lt;<a  rel="nofollow" href="https://twitter.com/mjbrender">https://twitter.com/mjbrender</a>&gt;
c: +1 617.817.3195

On Sat, Mar 7, 2015 at 10:35 AM, Marc Savy &lt;ms...@redhat.com&gt; wrote:

&gt; Hi All,
&gt;
&gt; I'm involved in a FOSS API management project (apiman), and I've been
&gt; thinking about providing a Riak implementation of its gateway components
&gt; in the community (where we already have ElasticSearch and Infinispan).
&gt; These components provide the distributed storage for tasks like
&gt; rate-limiting counters, IP white-listing, black-listing, etc and are
&gt; applied by a horizontally scalable, async gateway (to vastly
&gt; oversimplify!).
&gt;
&gt; I'm in need of advice principally in regards to configuration and
&gt; set-up. Namely, what assumptions can I safely make about a Riak user's
&gt; set-up, and which settings I should expose in the component's
&gt; configuration. Note that many gateways can exist, and hence any set-up
&gt; ideally needs to already in advance, or be idempotent in case multiple
&gt; nodes attempt to do it at once (or otherwise for it to be
&gt; lockable/exclusionary).
&gt;
&gt; To be more concrete, should I, for example, expect the user to have
&gt; already set up and joined together their Riak cluster a priori, with
&gt; everything behind a load-balancer: just give me a single URI to connect
&gt; to). Or, should I expect a list of FQDNs/IPs and attempt to join them
&gt; together into a cluster on the user's behalf - or will there be
&gt; idempotence issues if I do that multiple times?
&gt;
&gt; As far as I can tell, there is no node discovery/sharing
&gt; implementation[1], so I take it there's no way, for instance, to hit a
&gt; single node (which has already been joined with other nodes), and
&gt; thereby automatically gain knowledge of all cluster members?
&gt;
&gt; A couple of other configuration issues: Given the introduction of Riak
&gt; Data Types on buckets, whom should I expect to set up the data types[2]?
&gt; Should I create them automatically if they don't exist? Same for the
&gt; bucket itself.
&gt;
&gt; I'm very interested to know to present a convenient set of options that
&gt; will allow a typical development and deployment environment to be
&gt; supported.
&gt;
&gt; Regards,
&gt; Marc
&gt;
&gt; [0] With the usual consistency limitations
&gt; [1] <a  rel="nofollow" href="https://github.com/basho/riak/issues/356">https://github.com/basho/riak/issues/356</a>
&gt; [2] <a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/using/data-types/#">http://docs.basho.com/riak/latest/dev/using/data-types/#</a>
&gt; Setting-Up-Buckets-to-Use-Riak-Data-Types
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15853.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15900">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15900">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15901.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg15853.html">Advice on making a Riak middleware easy to configure</a></span> <span class="sender italic">Marc Savy</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Advice on making a Riak middleware easy to confi...</span> <span class="sender italic">Matthew Brender</span></li>
<li class="icons-email"><span class="subject"><a href="msg15901.html">Re: Advice on making a Riak middleware easy to confi...</a></span> <span class="sender italic">Dmitri Zagidulin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15903.html">Re: Advice on making a Riak middleware easy to c...</a></span> <span class="sender italic">Marc Savy</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Advice on making a Riak middleware easy to configure">
<input type="hidden" name="msgid" value="CAKrbaM236YJpnzRHmUN=FXKi+ATNL4NB+Xq=xuF_oG5x4SYZ3g@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15900.html">
<input type="submit" value=" Matthew Brender ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Advice+on+making+a+Riak+middleware+easy+to+configure%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15853.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15901.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAKrbaM236YJpnzRHmUN=FXKi+ATNL4NB+Xq=xuF_oG5x4SYZ3g@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
