<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riak-users Digest, Vol 78, Issue 13</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16978" id="c">
<link rel="index" href="maillist.html#16978" id="i">
<link rel="prev" href="msg16973.html" id="p">
<link rel="next" href="msg16981.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16978.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-users+Digest%2C+Vol+78%2C+Issue+13%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riak-users Digest, Vol 78, Issue 13</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ivaylo+Panitchkov%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ivaylo Panitchkov</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160118" rel="nofollow">Mon, 18 Jan 2016 06:50:28 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>&gt;
&gt; Message: 1
&gt; Date: Fri, 15 Jan 2016 18:24:08 +0100
&gt; From: Eugene Shubin &lt;ev.sh...@gmail.com&gt;
&gt; To: riak-users@lists.basho.com
&gt; Subject: Re: Map after reduce
&gt; Message-ID:
&gt;         &lt;CAD6t9YkEP6tGjr5YDHY=
&gt; rmu_oktkwr52+kdcqhtjcgmdbbd...@mail.gmail.com&gt;
&gt; Content-Type: text/plain; charset=&quot;utf-8&quot;
&gt;
&gt; Did somebody successfully used trick described here
&gt; &lt;<a  rel="nofollow" href="http://cartesianfaith.com/2011/07/27/mapreduce-tips-and-tricks-in-riak/">http://cartesianfaith.com/2011/07/27/mapreduce-tips-and-tricks-in-riak/</a>&gt;
&gt; to
&gt; pass reduce results to map phase?
&gt; For me it does not work and looks strange in general.
&gt;
&gt; 2016-01-13 13:55 GMT+01:00 Eugene Shubin &lt;ev.sh...@gmail.com&gt;:
&gt;
&gt; &gt; Is it possible to put a map phase in chain of map-reduce job after reduce
&gt; &gt; phase?
&gt; &gt;
&gt; &gt; Any example, would be highly appreciated.
&gt; &gt;
&gt; &gt; Best regards,
&gt; &gt; Eugene Shubin
&gt; &gt;
&gt; -------------- next part --------------
&gt; An HTML attachment was scrubbed...
&gt; URL: &lt;
&gt; <a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/attachments/20160115/55a949bf/attachment-0001.html">http://lists.basho.com/pipermail/riak-users_lists.basho.com/attachments/20160115/55a949bf/attachment-0001.html</a>
&gt; &gt;
&gt;
&gt; ------------------------------
&gt;</pre><pre>

Hi Eugene,

Passing reduce phase's results to a map phase is mostly useful when you
want to prepare your data for the actual processing.
Here is a piece of my code (node.js) that pulls keys and loads Riak objects
in blocks:

riak.mapreduce
.add(config.sourceBucket)
.reduce({&quot;keep&quot; : false, &quot;language&quot; : &quot;erlang&quot;, &quot;module&quot; :
&quot;riak_kv_mapreduce&quot;, &quot;function&quot; : &quot;reduce_identity&quot;})
.reduce({&quot;keep&quot; : false, &quot;language&quot; : &quot;javascript&quot;, &quot;source&quot; :
&quot;function(value, arg) { return value.slice(0, arg.n); }&quot;, &quot;arg&quot; : {&quot;n&quot;
: config.objectsPerBatch, &quot;reduce_phase_batch_size&quot; :
config.objectsPerBatch, &quot;do_prereduce&quot; : true}})
.map({&quot;keep&quot; : true, &quot;language&quot; : &quot;javascript&quot;, &quot;source&quot; :
&quot;function(o) { return ('true' !=
o.values[0].metadata['X-Riak-Deleted'])?[{key: o.key, data:
JSON.parse(o.values[0].data)}]:[]; }&quot;})
.run(function(err, objects)
{

 console.log(&quot;HEY!&quot;);
});








-- 


*Ivaylo Panitchkov*Software developer | Programming
+1 514 504 4297
ipanitch...@hibernum.com

Facebook &lt;<a  rel="nofollow" href="https://www.facebook.com/hibernumcreations/">https://www.facebook.com/hibernumcreations/</a>&gt; | Twitter
&lt;<a  rel="nofollow" href="https://twitter.com/Hibernum_">https://twitter.com/Hibernum_</a>&gt; | LinkedIn
&lt;<a  rel="nofollow" href="https://www.linkedin.com/company/1156110?trk=tyah&amp;trkInfo=clickedVertical%3Acompany%2CclickedEntityId%3A1156110%2Cidx%3A3-1-4%2CtarId%3A1447872522932%2Ctas%3Ahibernum">https://www.linkedin.com/company/1156110?trk=tyah&amp;trkInfo=clickedVertical%3Acompany%2CclickedEntityId%3A1156110%2Cidx%3A3-1-4%2CtarId%3A1447872522932%2Ctas%3Ahibernum</a>&gt;

&lt;<a  rel="nofollow" href="http://www.hibernum.com">http://www.hibernum.com</a>&gt;

*Ce courriel est confidentiel et peut aussi être protégé par la loi. Si
vous avez reçu ce courriel par erreur, veuillez nous en aviser
immédiatement en y répondant, puis supprimer ce message de votre système.
Veuillez ne pas le copier, l’utiliser pour quelque raison que ce soit ni
divulguer son contenu à quiconque. // **This email is confidential and may
also be legally privileged. If you have received this email in error,
please notify us immediately by reply email and then delete this message
from your system. Please do not copy it or use it for any purpose or
disclose its content.*
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16973.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16978">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16978">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16981.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riak-users Digest, Vol 78, Issue 13">
<input type="hidden" name="msgid" value="CAPvQezzjE4giwQoaG1UTxgPeQwOxS1u12c7UHdyNZvjp_fCsLQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16978.html">
<input type="submit" value=" Ivaylo Panitchkov ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-users+Digest%2C+Vol+78%2C+Issue+13%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16973.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16981.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAPvQezzjE4giwQoaG1UTxgPeQwOxS1u12c7UHdyNZvjp_fCsLQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
