<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: MapReduce request causes Erlang VM to close</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08536" id="c">
<link rel="index" href="maillist.html#08536" id="i">
<link rel="prev" href="msg08534.html" id="p">
<link rel="next" href="msg08528.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08536.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+MapReduce+request+causes+Erlang+VM+to+close%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: MapReduce request causes Erlang VM to close</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Staffan+Einarsson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Staffan Einarsson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120914" rel="nofollow">Fri, 14 Sep 2012 06:56:12 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Ian,

I use the prebuilt package of Riak 1.2.0 for Ubuntu Precise.</pre><pre>

I think I've got some more information now. The problem seems to show up
when using the ejsLog() function from a MapReduce JS phase function. It has
already been reported once here: <a  rel="nofollow" href="https://github.com/basho/riak/issues/209">https://github.com/basho/riak/issues/209</a>

I have not made a thorough investigation yet, because the ejsLog() function
is not crucial for me/us, and we have bigger fish to fry. But I know that
it used to work before so either something was introduced in the 1.2.0
release that broke it, or it is caused by package dependencies or the
virtualisation platform.

Thanks,

-- Staffan Einarsson
Engineering

Skype: staffan.einarsson
Phone: +46 70 426 07 46
<a  rel="nofollow" href="http://muchdifferent.com">http://muchdifferent.com</a>



On Fri, Sep 14, 2012 at 3:41 PM, Ian Plosker &lt;i...@basho.com&gt; wrote:

&gt;  Staffan,
&gt;
&gt; Are you using a Basho provided package or did you build from source?
&gt;
&gt; -ian
&gt;
&gt; On Thursday, 13 September 2012 at 15:42, Staffan Einarsson wrote:
&gt;
&gt; Ian:
&gt;
&gt; Actually, yes there is:  <a  rel="nofollow" href="http://pastebin.com/N3zh9fc7">http://pastebin.com/N3zh9fc7</a>
&gt;
&gt; It seems at the end that something fails in the JavaScript driver. Thanks,
&gt; now I have something to investigate.
&gt;
&gt; Michael:
&gt;
&gt; The same error message is also in the kern.log file. Thanks!
&gt;
&gt; -- Staffan Einarsson
&gt; Engineering
&gt;
&gt; Skype: staffan.einarsson
&gt; Phone: +46 70 426 07 46
&gt; <a  rel="nofollow" href="http://muchdifferent.com">http://muchdifferent.com</a>
&gt;
&gt;
&gt;
&gt; On Thu, Sep 13, 2012 at 4:31 PM, Michael Radford &lt;m...@blorf.com&gt; wrote:
&gt;
&gt; I recently had a development instance of Riak get killed by the kernel
&gt; OOM killer, and (on Ubuntu 12.04) it seems like the only place where
&gt; this was logged was /var/log/kern.log.
&gt;
&gt; Mike
&gt;
&gt; On Thu, Sep 13, 2012 at 6:31 AM, Ian Plosker &lt;i...@basho.com&gt; wrote:
&gt; &gt; Staffan,
&gt; &gt;
&gt; &gt; Is there anything in the kernel ring buffer?  You can check it using the
&gt; &gt; dmesg command.
&gt; &gt;
&gt; &gt; -Ian
&gt; &gt;
&gt; &gt; On Sep 13, 2012, at 13:10, Staffan Einarsson
&gt; &gt; &lt;staffan.einars...@muchdifferent.com&gt; wrote:
&gt; &gt;
&gt; &gt; Hi Kersten,
&gt; &gt;
&gt; &gt; That is exactly my problem. Normally I have something to go on from the
&gt; &gt; error and crash log files, but in this case they are both empty. There is
&gt; &gt; neither any crash dump file. The console.log file contains the same
&gt; &gt; information as the erlang.log.1 file I pasted, minus a few lines.
&gt; &gt;
&gt; &gt; I'm not sure what would cause an Erlang VM to fail so abruptly without
&gt; &gt; saying anything. Is the name clash mentioned at the top of the pasted
&gt; file
&gt; &gt; something that could cause this?
&gt; &gt;
&gt; &gt; Kindly,
&gt; &gt;
&gt; &gt; -- Staffan Einarsson
&gt; &gt; Engineering
&gt; &gt;
&gt; &gt; Skype: staffan.einarsson
&gt; &gt; Phone: +46 70 426 07 46
&gt; &gt; <a  rel="nofollow" href="http://muchdifferent.com">http://muchdifferent.com</a>
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Thu, Sep 13, 2012 at 11:39 AM, Kresten Krab Thorup &lt;k...@trifork.com&gt;
&gt; &gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; What you send does not seem to indicate any errors other than the
&gt; &quot;erlang
&gt; &gt;&gt; has closed&quot; message.  Isn't there something else you can share with us?
&gt;  a
&gt; &gt;&gt; crash log or something?
&gt; &gt;&gt;
&gt; &gt;&gt; Kresten
&gt; &gt;&gt;
&gt; &gt;&gt; On Sep 13, 2012, at 11:32 AM, Staffan Einarsson
&gt; &gt;&gt; &lt;staffan.einars...@muchdifferent.com&lt;mailto:
&gt; staffan.einars...@muchdifferent.com&gt;&gt;
&gt; &gt;&gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi guys,
&gt; &gt;&gt;
&gt; &gt;&gt; I'm having a problem with the Erlang VM going down for a Riak node that
&gt; &gt;&gt; receives a MapReduce request.
&gt; &gt;&gt;
&gt; &gt;&gt; My setup is this:
&gt; &gt;&gt;
&gt; &gt;&gt; I run three Riak 1.2.0 nodes, each on an Ubuntu Server 12.04 guest OS on
&gt; &gt;&gt; VirtualBox 4.1.20. The host OS is Windows. I send requests through our
&gt; own
&gt; &gt;&gt; Riak client library, (uGameDB for the Unity game engine), which uses
&gt; the PB
&gt; &gt;&gt; interface. When my test script sends a MapReduce request to one of the
&gt; &gt;&gt; nodes, the node fails instantly.
&gt; &gt;&gt;
&gt; &gt;&gt; The error.log and crash.log files are empty. The erlang.log.1 file says:
&gt; &gt;&gt; <a  rel="nofollow" href="http://pastebin.com/1LHqYCaB">http://pastebin.com/1LHqYCaB</a>
&gt; &gt;&gt;
&gt; &gt;&gt; I have tested this with different versions of our client library,
&gt; &gt;&gt; specifically with versions that have previously been confirmed to work,
&gt; to
&gt; &gt;&gt; rule out any error on the client side. I have also tried with different
&gt; &gt;&gt; numbers of nodes, and it is only the node that receives the MapReduce
&gt; &gt;&gt; request that fails.
&gt; &gt;&gt;
&gt; &gt;&gt; Any help is greatly appreciated!
&gt; &gt;&gt;
&gt; &gt;&gt; Kindly,
&gt; &gt;&gt;
&gt; &gt;&gt; -- Staffan Einarsson
&gt; &gt;&gt; Engineering
&gt; &gt;&gt;
&gt; &gt;&gt; Skype: staffan.einarsson
&gt; &gt;&gt; Phone: +46 70 426 07 46
&gt; &gt;&gt; <a  rel="nofollow" href="http://muchdifferent.com">http://muchdifferent.com</a>&lt;<a  rel="nofollow" href="http://muchdifferent.com/">http://muchdifferent.com/</a>&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; _______________________________________________
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; Mobile: + 45 2343 4626 | Skype: krestenkrabthorup | Twitter: @drkrab
&gt; &gt;&gt; Trifork A/S  |  Margrethepladsen 4  | DK- 8000 Aarhus C |  Phone : +45
&gt; &gt;&gt; 8732 8787  |  www.trifork.com&lt;<a  rel="nofollow" href="http://www.trifork.com">http://www.trifork.com</a>&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08534.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08536">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08536">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08528.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08520.html">Re: MapReduce request causes Erlang VM to close</a></span> <span class="sender italic">Kresten Krab Thorup</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08522.html">Re: MapReduce request causes Erlang VM to close</a></span> <span class="sender italic">Staffan Einarsson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08524.html">Re: MapReduce request causes Erlang VM to clo...</a></span> <span class="sender italic">Ian Plosker</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08525.html">Re: MapReduce request causes Erlang VM to...</a></span> <span class="sender italic">Michael Radford</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08526.html">Re: MapReduce request causes Erlang V...</a></span> <span class="sender italic">Staffan Einarsson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08534.html">Re: MapReduce request causes Erl...</a></span> <span class="sender italic">Ian Plosker</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: MapReduce request causes...</span> <span class="sender italic">Staffan Einarsson</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: MapReduce request causes Erlang VM to close">
<input type="hidden" name="msgid" value="CACyrMQ=AvGdaNwTYsp2S6Tcmg_FSBTLTSzgYmcxrNqgstVocwg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08536.html">
<input type="submit" value=" Staffan Einarsson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+MapReduce+request+causes+Erlang+VM+to+close%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08534.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08528.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACyrMQ=AvGdaNwTYsp2S6Tcmg_FSBTLTSzgYmcxrNqgstVocwg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
