<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Search index partitioning in Riak-KV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#18226" id="c">
<link rel="index" href="maillist.html#18226" id="i">
<link rel="prev" href="msg18225.html" id="p">
<link rel="next" href="msg18231.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18226.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Search+index+partitioning+in+Riak%5C-KV%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Search index partitioning in Riak-KV</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Fred+Dushin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Fred Dushin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170519" rel="nofollow">Fri, 19 May 2017 06:36:32 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>There is a Solr instance per Riak node, and each Solr instance contains a Solr 
core for the Riak index created.  Every replica of a Riak k/v pair has a 
corresponding document in the Solr instance on the same node as the vnode that 
stores the replica (in fact for each sibling, if your objects admit siblings).  
Each document in Solr contains not only the bucket and key as indexed fields, 
but also the Riak partition (well, the partition ordinal, actually).  All of 
these fields are indexed, IIRC.</pre><pre>

When a query executed through Riak, a coverage plan is used to generate a 
filter query (based on the node and partition in the cover set) that is used 
with shard parameters on the local Solr instance in which the query was 
executed.  So technically every query is using (legacy) Solr distributed query; 
it's just that all the shard parameters and Solr deployment topology is hidden 
from the user and done internally by Riak.  It's really quite elegant and 
clever (IMO), but it can run into scaling issues, as Solr/Lucene is quite a bit 
more demanding than Riak, in some real-world use-cases.

I made an attempt to explain how a lot of how this works at 
<a  rel="nofollow" href="https://www.youtube.com/watch?v=e1yVJqRuLSg">https://www.youtube.com/watch?v=e1yVJqRuLSg</a> 
&lt;<a  rel="nofollow" href="https://www.youtube.com/watch?v=e1yVJqRuLSg">https://www.youtube.com/watch?v=e1yVJqRuLSg</a>&gt;

There are far better presentations on the topic by Ryan Zezeski and other 
pioneers who did the initial implementation.

-Fred

&gt; On May 19, 2017, at 7:10 AM, Denis &lt;dg.65...@gmail.com&gt; wrote:
&gt; 
&gt; Hello
&gt; 
&gt; I'm trying to understand how Solr indexes are interact with Riak KV store. 
&gt; Let me explain a bit... The Riak uses sharding per vnode. Each physical node 
&gt; contains several vnodes and data stored there are indexed by Solr. As far as 
&gt; i understood, Solr is not clustered solution, i.e. Solr instance running on 
&gt; #1 node doesn't know anything about index on instance #2 and so on. 
&gt; Then when search request comes in, how Riak/Solr decides at which instance 
&gt; they need to lookup for index? In other words, is this index is 
&gt; document-based partition or term-based partition?
&gt; Thank you.
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18225.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#18226">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18226">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18231.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg18225.html">Search index partitioning in Riak-KV</a></span> <span class="sender italic">Denis</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Search index partitioning in Riak-KV</span> <span class="sender italic">Fred Dushin</span></li>
<li class="icons-email"><span class="subject"><a href="msg18231.html">Re: Search index partitioning in Riak-KV</a></span> <span class="sender italic">Denis</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Search index partitioning in Riak-KV">
<input type="hidden" name="msgid" value="9507F1B1-9B19-4C2B-948E-CD55A1F748C7@dushin.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18226.html">
<input type="submit" value=" Fred Dushin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Search+index+partitioning+in+Riak%5C-KV%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18225.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18231.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">9507F1B1-9B19-4C2B-948E-CD55A1F748C7@dushin.net</li>
</ul>
</div>
</body>
</html>
