<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Very slow acquisition time (99 percentile) while fast median times</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17275" id="c">
<link rel="index" href="maillist.html#17275" id="i">
<link rel="prev" href="msg17274.html" id="p">
<link rel="next" href="msg17276.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17275.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Very+slow+acquisition+time+%5C%2899+percentile%5C%29+while+fast+median+times%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Very slow acquisition time (99 percentile) while fast median times</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Guillaume+Boddaert%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Guillaume Boddaert</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160502" rel="nofollow">Mon, 02 May 2016 08:46:02 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Here we go for a complete round of my hosts, all are objsize : 0</pre><pre>

</pre><tt>Here is a sample answer (headers only, that are followed by the full set 
</tt><tt>of JSON content) from the RIAK5 host
</tt><pre style="margin: 0em;">

HTTP/1.1 200 OK
X-Riak-Vclock: a85hYGBgzGDKBVI8xTxKnGbpn7QYuPafyWBKZMxjZXjyYfYFviwA
Vary: Accept-Encoding
Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho)
Link: &lt;/buckets/twitter&gt;; rel=&quot;up&quot;
Last-Modified: Mon, 02 May 2016 15:40:20 GMT
ETag: &quot;2l2QODpewyBZQFqDnyEy3F&quot;
Date: Mon, 02 May 2016 15:40:20 GMT
Content-Type: application/json
Content-Length: 10722

Below the riak-admin status output.


admin@riak1:~$ sudo riak-admin status | grep -e 'objsize' | grep 'put'
consistent_put_objsize_100 : 0
consistent_put_objsize_95 : 0
consistent_put_objsize_99 : 0
consistent_put_objsize_mean : 0
consistent_put_objsize_median : 0
write_once_put_objsize_100 : 0
write_once_put_objsize_95 : 0
write_once_put_objsize_99 : 0
write_once_put_objsize_mean : 0
write_once_put_objsize_median : 0

admin@riak2:~$ sudo riak-admin status | grep -e 'objsize' | grep 'put'
consistent_put_objsize_100 : 0
consistent_put_objsize_95 : 0
consistent_put_objsize_99 : 0
consistent_put_objsize_mean : 0
consistent_put_objsize_median : 0
write_once_put_objsize_100 : 0
write_once_put_objsize_95 : 0
write_once_put_objsize_99 : 0
write_once_put_objsize_mean : 0
write_once_put_objsize_median : 0

admin@riak3:~$ sudo riak-admin status | grep -e 'objsize' | grep 'put'
consistent_put_objsize_100 : 0
consistent_put_objsize_95 : 0
consistent_put_objsize_99 : 0
consistent_put_objsize_mean : 0
consistent_put_objsize_median : 0
write_once_put_objsize_100 : 0
write_once_put_objsize_95 : 0
write_once_put_objsize_99 : 0
write_once_put_objsize_mean : 0
write_once_put_objsize_median : 0

admin@riak4:~$ sudo riak-admin status | grep -e 'objsize' | grep 'put'

consistent_put_objsize_100 : 0
consistent_put_objsize_95 : 0
consistent_put_objsize_99 : 0
consistent_put_objsize_mean : 0
consistent_put_objsize_median : 0
write_once_put_objsize_100 : 0
write_once_put_objsize_95 : 0
write_once_put_objsize_99 : 0
write_once_put_objsize_mean : 0
write_once_put_objsize_median : 0

admin@riak5:~$ sudo riak-admin status | grep -e 'objsize' | grep 'put'

consistent_put_objsize_100 : 0
consistent_put_objsize_95 : 0
consistent_put_objsize_99 : 0
consistent_put_objsize_mean : 0
consistent_put_objsize_median : 0
write_once_put_objsize_100 : 0
write_once_put_objsize_95 : 0
write_once_put_objsize_99 : 0
write_once_put_objsize_mean : 0
write_once_put_objsize_median : 0

On 02/05/2016 17:32, Luke Bakken wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Could you please check the objsize stats on every Riak node? If they
are all zero then ... ????
--
Luke Bakken
Engineer
lbak...@basho.com


On Mon, May 2, 2016 at 8:26 AM, Guillaume Boddaert
&lt;guilla...@lighthouse-analytics.co&gt; wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
My clients are working through an haproxy box configured on round-robin.

I've switched from PBC to HTTP to provide you this:

May  2 15:24:12 intrabalancer haproxy[29677]: my_daemon_box:53456
[02/May/2016:15:24:12.390] riak_rest riak_rest_backend/riak2 6/0/1/54/61 503
222 - - ---- 5/4/2/1/0 0/0 &quot;PUT
/types/activity_fr/buckets/twitter/keys/727126697699594240?dw=1&amp;timeout=50&amp;returnbody=true
HTTP/1.1&quot;
May  2 15:24:12 intrabalancer haproxy[29677]: my_daemon_box:53455
[02/May/2016:15:24:12.339] riak_rest riak_rest_backend/riak3 57/0/0/54/111
503 222 - - ---- 5/4/1/1/0 0/0 &quot;PUT
/types/activity_fr/buckets/twitter/keys/727126698291023872?dw=1&amp;timeout=50&amp;returnbody=true
HTTP/1.1&quot;
May  2 15:24:12 intrabalancer haproxy[29677]: my_daemon_box:53454
[02/May/2016:15:24:12.285] riak_rest riak_rest_backend/riak5 63/0/0/106/169
503 222 - - ---- 5/4/0/1/0 0/0 &quot;PUT
/types/activity_fr/buckets/twitter/keys/727126698249064449?dw=1&amp;timeout=50&amp;returnbody=true
HTTP/1.1&quot;
May  2 15:24:12 intrabalancer haproxy[29677]: my_daemon_box:53455
[02/May/2016:15:24:12.451] riak_rest riak_rest_backend/riak5 13/0/1/58/72
503 222 - - ---- 5/4/3/1/0 0/0 &quot;PUT
/types/activity_fr/buckets/twitter/keys/727126696256802816?dw=1&amp;timeout=50&amp;returnbody=true
HTTP/1.1&quot;
May  2 15:24:12 intrabalancer haproxy[29677]: my_daemon_box:53456
[02/May/2016:15:24:12.451] riak_rest riak_rest_backend/riak4 10/0/1/62/73
503 222 - - ---- 5/4/2/1/0 0/0 &quot;PUT
/types/activity_fr/buckets/twitter/keys/727126698425212929?dw=1&amp;timeout=50&amp;returnbody=true
HTTP/1.1&quot;
May  2 15:24:12 intrabalancer haproxy[29677]: my_daemon_box:53453
[02/May/2016:15:24:12.397] riak_rest riak_rest_backend/riak1 66/0/0/63/129
503 222 - - ---- 5/4/1/1/0 0/0 &quot;PUT
/types/activity_fr/buckets/twitter/keys/727126698215485440?dw=1&amp;timeout=50&amp;returnbody=true
HTTP/1.1&quot;

Yet objsize is still 0 on puts:
admin@riak1:~$ sudo riak-admin status | grep -e 'objsize'
consistent_get_objsize_100 : 0
consistent_get_objsize_95 : 0
consistent_get_objsize_99 : 0
consistent_get_objsize_mean : 0
consistent_get_objsize_median : 0
consistent_put_objsize_100 : 0
consistent_put_objsize_95 : 0
consistent_put_objsize_99 : 0
consistent_put_objsize_mean : 0
consistent_put_objsize_median : 0
node_get_fsm_counter_objsize_100 : 0
node_get_fsm_counter_objsize_95 : 0
node_get_fsm_counter_objsize_99 : 0
node_get_fsm_counter_objsize_mean : 0
node_get_fsm_counter_objsize_median : 0
node_get_fsm_map_objsize_100 : 0
node_get_fsm_map_objsize_95 : 0
node_get_fsm_map_objsize_99 : 0
node_get_fsm_map_objsize_mean : 0
node_get_fsm_map_objsize_median : 0
node_get_fsm_objsize_100 : 10916
node_get_fsm_objsize_95 : 7393
node_get_fsm_objsize_99 : 8845
node_get_fsm_objsize_mean : 4098
node_get_fsm_objsize_median : 3891
node_get_fsm_set_objsize_100 : 0
node_get_fsm_set_objsize_95 : 0
node_get_fsm_set_objsize_99 : 0
node_get_fsm_set_objsize_mean : 0
node_get_fsm_set_objsize_median : 0
write_once_put_objsize_100 : 0
write_once_put_objsize_95 : 0
write_once_put_objsize_99 : 0
write_once_put_objsize_mean : 0
write_once_put_objsize_median : 0



G.


On 02/05/2016 17:21, Luke Bakken wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Which Riak client are you using? Do you have it configured to connect
to all nodes in your cluster or just one?
--
Luke Bakken
Engineer
lbak...@basho.com


On Mon, May 2, 2016 at 7:40 AM, Guillaume Boddaert
&lt;guilla...@lighthouse-analytics.co&gt; wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Luke,

Well objsize  seems to be 0, that's very troubling.
I can assure you that i am writing 75 items per second at the moment and
that I can pull data from the cluster.


admin@riak3:~$ sudo riak-admin status | grep -e 'objsize'

consistent_get_objsize_100 : 0
consistent_get_objsize_95 : 0
consistent_get_objsize_99 : 0
consistent_get_objsize_mean : 0
consistent_get_objsize_median : 0
consistent_put_objsize_100 : 0
consistent_put_objsize_95 : 0
consistent_put_objsize_99 : 0
consistent_put_objsize_mean : 0
consistent_put_objsize_median : 0
node_get_fsm_counter_objsize_100 : 0
node_get_fsm_counter_objsize_95 : 0
node_get_fsm_counter_objsize_99 : 0
node_get_fsm_counter_objsize_mean : 0
node_get_fsm_counter_objsize_median : 0
node_get_fsm_map_objsize_100 : 0
node_get_fsm_map_objsize_95 : 0
node_get_fsm_map_objsize_99 : 0
node_get_fsm_map_objsize_mean : 0
node_get_fsm_map_objsize_median : 0
node_get_fsm_objsize_100 : 0
node_get_fsm_objsize_95 : 0
node_get_fsm_objsize_99 : 0
node_get_fsm_objsize_mean : 0
node_get_fsm_objsize_median : 0
node_get_fsm_set_objsize_100 : 0
node_get_fsm_set_objsize_95 : 0
node_get_fsm_set_objsize_99 : 0
node_get_fsm_set_objsize_mean : 0
node_get_fsm_set_objsize_median : 0
write_once_put_objsize_100 : 0
write_once_put_objsize_95 : 0
write_once_put_objsize_99 : 0
write_once_put_objsize_mean : 0
write_once_put_objsize_median : 0




On 02/05/2016 16:13, Luke Bakken wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Guillaume -

What are the &quot;objsize&quot; stats for your cluster?
--
Luke Bakken
Engineer
lbak...@basho.com


On Mon, May 2, 2016 at 4:45 AM, Guillaume Boddaert
&lt;guilla...@lighthouse-analytics.co&gt; wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi,

I'm trying to setup a production environment with Riak as backend.
Unfortunately I have very slow write times that bottleneck my whole
system.

Here is a sample of one of my node (riak-admin status | grep -e
'^node_put_fsm_time'):
node_put_fsm_time_100 : 3305516
node_put_fsm_time_95 : 230589
node_put_fsm_time_99 : 1694593
node_put_fsm_time_mean : 79864
node_put_fsm_time_median : 14973

As you can see, I have really good times for most of my writes, yet the
mean
time is not so good because a few writes are taking long (Up to 3
seconds)
How can I get rid of those slow insert ? Is that intended/normal ?

My setup is the following:
5 hosts (2CPU, %Cpu(s): 47,1 us,  1,3 sy,  0,0 ni, 51,3 id,  0,0 wa,
0,0
hi,  0,2 si,  0,0 st) , ring_size: 128, aae disabled.
Writes are w=1 dw=0
each host has 32go of ram, that is almost used for system caching only.
My data are stored on an openstack volume that support up to 3000IOPS.

Here is an iostat sample for 1 minute:
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             38.00    0.00    1.81    0.03    0.08   60.07

Device:            tps    kB_read/s    kB_wrtn/s    kB_read kB_wrtn
vda               0.37         0.00         2.27          0 136
vdb               9.60         0.00       294.53          0 17672

Thanks,

Guilaume BODDAERT

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">

</pre></blockquote></blockquote><pre style="margin: 0em;">


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17274.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17275">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17275">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17276.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17267.html">Very slow acquisition time (99 percentile) while fas...</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17268.html">Re: Very slow acquisition time (99 percentile) ...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17271.html">Re: Very slow acquisition time (99 percenti...</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17272.html">Re: Very slow acquisition time (99 perc...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17273.html">Re: Very slow acquisition time (99 ...</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17274.html">Re: Very slow acquisition time...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Very slow acquisition ...</span> <span class="sender italic">Guillaume Boddaert</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17276.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17281.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li class="icons-email"><span class="subject"><a href="msg17282.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17283.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg17284.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Fred Dushin</span></li>
<li class="icons-email"><span class="subject"><a href="msg17285.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg17286.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li class="icons-email"><span class="subject"><a href="msg17287.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg17420.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li class="icons-email"><span class="subject"><a href="msg17421.html">Re: Very slow acquisit...</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Very slow acquisition time (99 percentile) while fast median times">
<input type="hidden" name="msgid" value="5727759E.1000808@lighthouse-analytics.co">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17275.html">
<input type="submit" value=" Guillaume Boddaert ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Very+slow+acquisition+time+%5C%2899+percentile%5C%29+while+fast+median+times%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17274.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17276.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5727759E.1000808@lighthouse-analytics.co</li>
</ul>
</div>
</body>
</html>
