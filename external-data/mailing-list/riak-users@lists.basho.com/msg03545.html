<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Interesting sawtooth increasing CPU usage on lightly-used Riak	cluster on EC2 micro instances. Is this expected?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03545" id="c">
<link rel="index" href="maillist.html#03545" id="i">
<link rel="prev" href="msg03495.html" id="p">
<link rel="next" href="msg03497.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03545.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Interesting+sawtooth+increasing+CPU+usage+on+lightly%5C-used+Riak%09cluster+on+EC2+micro+instances.+Is+this+expected%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Interesting sawtooth increasing CPU usage on lightly-used Riak	cluster on EC2 micro instances. Is this expected?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mark+Phillips%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mark Phillips</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110603" rel="nofollow">Fri, 03 Jun 2011 14:11:37 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Eamonn,

Without having the chance to think too hard about this, here is what
might be going on:</pre><pre>

There was an issue with 0.14.0 related to the &quot;/stats&quot; resource
leading to increased CPU usage over time.[1] This is fixed in the
latest release of version.

Couple that with the fact that you're running EC2 Micros on unbuntu
10.04, and that might just explain the increased CPU usage.

Your best bet is to probably upgrade to 0.14.2 (if you haven't
already) and see if that doesn't mollify or even eliminate the issue.

Hope that helps.

Mark

1 - <a  rel="nofollow" href="https://issues.basho.com/show_bug.cgi?id=971">https://issues.basho.com/show_bug.cgi?id=971</a>


On Mon, May 30, 2011 at 10:52 AM, Eamonn &lt;eamonn.obrien-str...@hp.com&gt; wrote:
&gt; I have a cluster of six Riak nodes that has been operating for a few months
&gt; on Amazon EC2.   Because this is a development deployment with very light
&gt; usage currently, I have used cheap &quot;micro&quot; instances.
&gt;
&gt; I am using  riak_0.14.0-1_amd64.deb with no changes to the default
&gt; app.config except to modify the IP addresses.
&gt;
&gt; If you look at the graph of CPU usage for these instances over the last two
&gt; weeks
&gt;  <a  rel="nofollow" href="http://eamonn.org/riak/riak-cluster-cpu.png">http://eamonn.org/riak/riak-cluster-cpu.png</a>
&gt; you see an interesting pattern.
&gt;
&gt; Each node gradually increases its CPU over about two days and then suddenly
&gt; drops down slightly, forming a saw-tooth pattern.  From an initial low
&gt; average CPU several months ago, the CPU usage has now slowly risen.   It now
&gt; seems to have reached an equilibrium, with three of the nodes at 50% and
&gt; three at 60%.
&gt;
&gt; Most of this usage happens when the cluster is not being used externally.
&gt;  The little spikes you see on the graph are probably the actual external
&gt; access via the REST API.
&gt;
&gt; I assume this activity is caused by the continuous &quot;gossip&quot; between the
&gt; nodes.  Perhaps the different equilibrium CPU percentages are related to
&gt; which share of the data items each node has.  Is the sawtooth pattern
&gt; showing some kind of garbage collection?
&gt;
&gt; The Riak cluster does seem to work correctly with reasonable latency, at
&gt; least under low load.  (I have not yet done load-testing).
&gt;
&gt; Is this pattern expected?   Is it a sign of some problem with my
&gt; configuration?  Any suggestions for how to tune the cluster to run better on
&gt; EC2 micro instances?  Any suggestions of what metrics to use to decide when
&gt; to dynamically scale the cluster by spinning up nodes or spinning them down?
&gt;
&gt; Thanks,
&gt; __
&gt; Eamonn O'Brien-Strain
&gt; HP Labs
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03495.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03545">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03545">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03497.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03495.html">Interesting sawtooth increasing CPU usage on lightly-used Ri...</a></span> <span class="sender italic">Eamonn</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Interesting sawtooth increasing CPU usage on lightl...</span> <span class="sender italic">Mark Phillips</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Interesting sawtooth increasing CPU usage on lightly-used Riak	cluster on EC2 micro instances. Is this expected?">
<input type="hidden" name="msgid" value="BANLkTinj2yS+65KppuU5ZqYbpYnLB5EDkQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03545.html">
<input type="submit" value=" Mark Phillips ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Interesting+sawtooth+increasing+CPU+usage+on+lightly%5C-used+Riak%09cluster+on+EC2+micro+instances.+Is+this+expected%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03495.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03497.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BANLkTinj2yS+65KppuU5ZqYbpYnLB5EDkQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
