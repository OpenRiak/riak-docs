<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: How do I improve Level DB performance?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07429" id="c">
<link rel="index" href="maillist.html#07429" id="i">
<link rel="prev" href="msg07428.html" id="p">
<link rel="next" href="msg07431.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07429.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+do+I+improve+Level+DB+performance%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: How do I improve Level DB performance?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Tim+Haines%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Tim Haines</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120510" rel="nofollow">Thu, 10 May 2012 15:19:59 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi David,

I think I saw your name as one of the creators of the benchmarking tool -
thanks - compared to the efforts required to benchmark other systems, it's
been great.</pre><pre>


On Thu, May 10, 2012 at 3:01 PM, David Smith &lt;diz...@basho.com&gt; wrote:

&gt; On Thu, May 10, 2012 at 2:33 PM, Tim Haines &lt;tmhai...@gmail.com&gt; wrote:
&gt;
&gt; &gt; I've set up a new cluster, and have been doing pre-deployment benchmarks
&gt; on
&gt; &gt; it. The benchmark I was running slowly sunk from 1000 TPS to 250 TPS over
&gt; &gt; the course of the single 8 hour benchmark doing 1 read+1 update using 1k
&gt; &gt; values.  I'm wondering if anyone might have suggestions on how I can
&gt; improve
&gt; &gt; this.
&gt;
&gt; Generally, this suggests that you are becoming seek-time bound. The
&gt; test config, as specified, will generate a pretty huge number of
&gt; not_founds which are (currently) crazy expensive w/ LevelDB,
&gt; particularly as the dataset grows.
&gt;
&gt; Assuming you start with an empty database, a sample of this test will
&gt; generate operations like so:
&gt;
&gt; Key 1000 - get -&gt; not_found
&gt; Key 1001 - update -&gt; not_found + write
&gt; Key 1002 - get -&gt; not_found
&gt; etc..
&gt;
&gt; I.e. the leveldb cache never gets a chance to be useful, because
&gt; you're always writing new values and the cost of writing each new
&gt; value goes up, since you have to thrash the cache to determine if
&gt; you're ever seen the key that doesn't exist. :)
&gt;
&gt; The root problem here is going to be the key_generator --
&gt; partitioned_sequential_int will just run through all the ints in order
&gt; and never revisit a key.
&gt;
&gt;
Okay, I understand what you're saying here.  There's no cache hits.  I
thought about the tests I ran after the 8 hour benchmark, and although I
started the same test for a shorter duration again, it's likely that the
objects still weren't in the cache even though the data may have existed
because I'd already iterated over so many objects.

I'm assuming the benchmarking tool will use the same bucket for each run,
and the keys will grow in sequence.   So if I run through the benchmark
writing out 100,000 keys, and then rerun the benchmark with 3 reads per one
update, I should see results where the read is successfully being filled by
the cache right?

I'll try this out.  Even though this is occurring would you have expected
to see the performance drop from 500 to 250 over the course of the
benchmark?


&gt;
&gt; &gt;         {write_buffer_size, 16777216},
&gt; &gt;         {max_open_files, 100},
&gt; &gt;         {block_size, 262144},
&gt; &gt;         {cache_size, 168430088}
&gt;
&gt; I strongly recommend not changing write_buffer_size; it can have
&gt; unexpected latency side-effects when LevelDB compaction occurs.
&gt; Smaller == more predictable.
&gt;
&gt;
Thanks for this - I will revert it back.  One thing I haven't been able to
locate is what settings can be changed when the node has data in it.  Is
this documented anywhere?


Does that help?
&gt;
&gt;
You've improved my understanding and given me something else to try.  Thank
you!

Tim.



&gt; D.
&gt;
&gt; --
&gt; Dave Smith
&gt; VP, Engineering
&gt; Basho Technologies, Inc.
&gt; diz...@basho.com
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07428.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07429">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07429">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07431.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07425.html">How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07428.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: How do I improve Level DB performance?</span> <span class="sender italic">Tim Haines</span></li>
<li class="icons-email"><span class="subject"><a href="msg07431.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07434.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07436.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07437.html">Re: How do I improve Level DB performan...</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07438.html">Re: How do I improve Level DB perfo...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07439.html">Re: How do I improve Level DB p...</a></span> <span class="sender italic">Tim Haines</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07433.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07435.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Ryan Zezeski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07446.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07447.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Jared Morrow</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: How do I improve Level DB performance?">
<input type="hidden" name="msgid" value="CAO=-cOXqA5PztAzYZUrqFqFiCDHX7njTGgk1phzQDbmJA7hJdg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07429.html">
<input type="submit" value=" Tim Haines ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+do+I+improve+Level+DB+performance%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07428.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07431.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAO=-cOXqA5PztAzYZUrqFqFiCDHX7njTGgk1phzQDbmJA7hJdg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
