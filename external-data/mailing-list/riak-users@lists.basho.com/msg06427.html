<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: v1.0.3 search merge index preventing partition handoff?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06427" id="c">
<link rel="index" href="maillist.html#06427" id="i">
<link rel="prev" href="msg06414.html" id="p">
<link rel="next" href="msg06434.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06427.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+v1.0.3+search+merge+index+preventing+partition+handoff%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: v1.0.3 search merge index preventing partition handoff?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Fisher%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Fisher</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120126" rel="nofollow">Thu, 26 Jan 2012 05:53:38 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Kresten,

Thanks for the help!  I successfully joined my additional node to the
cluster and *hopefully* the rest go smoothly now.</pre><pre>

I took your advice and stopped the node, moved the bad merge index out of
the 'merge_index' directory and then restarted the node.  After watching the
log, and viewing the ring_status and member_status values (awesome additions
by the way the riak-admin utility!), it was clear this was what was blocking
the transfer of the partitions.

I had to do this to a few more that were also stuck:
2 on node1
1 on node2
2 on node3

After doing the last one on node3 the ownership handoff was complete.

I did run into one more issue that seems sorta related but looked a little
different... after the ownership handoff was complete, there were 7 pending
partitions 'riak-admin transfers' that needed to complete.  

I found it interesting that it was actually from the joining node back to
the other nodes (so from my new node5, back to the original nodes).  

After watching the console log again I could see that there was some more
crashing and right before the crash the message:


I saw  
<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Failed-to-compact-in-RiakSearch-tp2816484p2821431.html">http://riak-users.197444.n3.nabble.com/Failed-to-compact-in-RiakSearch-tp2816484p2821431.html</a>
Rusty's post a while back  that shed a bit of light, but in the end I went
with the same solution as before.  Not sure if it was the best, or correct
but like before: stop riak and move that directory out of the merge_index
folder and then start riak back up.

I had to do this four more times when it would get stuck, but finally the
'riak-admin transfer' showed no more pending/active transfers.

The only thing I'm seeing now in the logs printed over and over on all the
nodes is:

But maybe that is normal?

I would still be interested in your question about knowing if there is a
better way to recover from this?  

Also since I'm sure my search indices are now in bad shape, if there is a
way to rebuild all the indices besides using the python driver to read/write
each key again?  Possibly the 'search-cmd' or maybe something from the
erlang console?

Also if anyone would like the logs to help in future development let me
know.

--
View this message in context: 
<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/v1-0-3-search-merge-index-preventing-partition-handoff-tp3688803p3690487.html">http://riak-users.197444.n3.nabble.com/v1-0-3-search-merge-index-preventing-partition-handoff-tp3688803p3690487.html</a>
Sent from the Riak Users mailing list archive at Nabble.com.

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06414.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06427">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06427">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06434.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06413.html">v1.0.3 search merge index preventing partition handoff...</a></span> <span class="sender italic">Fisher, Ryan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06414.html">Re: v1.0.3 search merge index preventing partitio...</a></span> <span class="sender italic">Kresten Krab Thorup</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: v1.0.3 search merge index preventing part...</span> <span class="sender italic">Ryan Fisher</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06434.html">Re: v1.0.3 search merge index preventing ...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06442.html">Re: v1.0.3 search merge index prevent...</a></span> <span class="sender italic">Ryan Fisher</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06473.html">Re: v1.0.3 search merge index pr...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06484.html">Re: v1.0.3 search merge inde...</a></span> <span class="sender italic">Ryan Fisher</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06496.html">Re: v1.0.3 search merge ...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: v1.0.3 search merge index preventing partition handoff?">
<input type="hidden" name="msgid" value="1327586009538-3690487.post@n3.nabble.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06427.html">
<input type="submit" value=" Ryan Fisher ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+v1.0.3+search+merge+index+preventing+partition+handoff%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06414.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06434.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">1327586009538-3690487.post@n3.nabble.com</li>
</ul>
</div>
</body>
</html>
