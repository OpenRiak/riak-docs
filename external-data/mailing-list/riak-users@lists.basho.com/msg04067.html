<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Connection Pool with Erlang PB Client Necessary?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#04067" id="c">
<link rel="index" href="mail2.html#04067" id="i">
<link rel="prev" href="msg04059.html" id="p">
<link rel="next" href="msg04068.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04067.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Connection+Pool+with+Erlang+PB+Client+Necessary%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Connection Pool with Erlang PB Client Necessary?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Bryan+O%27Sullivan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Bryan O'Sullivan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110726" rel="nofollow">Tue, 26 Jul 2011 09:39:53 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Mon, Jul 25, 2011 at 4:03 PM, Andrew Berman &lt;rexx...@gmail.com&gt; wrote:</pre><pre>

&gt; I know that this subject has been brought up before, but I'm still
&gt; wondering what the value of a connection pool is with Riak.


It's a big deal:

   - It amortises TCP and PBC connection setup overhead over a number of
   requests, thereby reducing average query latency.
   - It greatly reduces the likelihood that very busy clients and servers
   will run out of limited resources that are effectively invisible, e.g.
   closed TCP connections stuck in TIME_WAIT.

Each of the above is a pretty big deal. Of course, connection pooling isn't
free.

   - If you have many clients talking to a server sporadically, you may end
   up with large numbers of open-and-idle connections on a server, which will
   both consume resources and increase latency for all other clients. This is
   usually only a problem with a very large number (many thousands) of clients
   per server, and it usually only arises with poorly written and tuned
   connection pooling libraries. But ...
   - ... Most connection pooling libraries are poorly written and tuned, so
   they'll behave pathologically just when you need them not to.
   - Since you don't set up a connection per request, the requests where you
   *do* need to set up a connection are going to be more expensive than those
   where you don't, so you'll see jitter in your latency profile. About 99.9%
   of users will never, ever care about this.

Since Erlang processes are so small and fast to
&gt; create, is there really any overhead in having the gen_server create a
&gt; new connection (with the same client id) each time it needs to access
&gt; Riak?
&gt;

Of course. The overhead of Erlang processes has nothing to do with the cost
of setting up a connection.

Also, you really don't want to be using the same client ID repeatedly across
different connections. That's an awesome way to cause bugs with vclock
resolution that end up being very very hard to diagnose.
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04059.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#04067">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#04067">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04068.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg04059.html">Connection Pool with Erlang PB Client Necessary?</a></span> <span class="sender italic">Andrew Berman</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Connection Pool with Erlang PB Client Necessary?</span> <span class="sender italic">Bryan O'Sullivan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04068.html">Re: Connection Pool with Erlang PB Client Necess...</a></span> <span class="sender italic">Andrew Berman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04069.html">Re: Connection Pool with Erlang PB Client Ne...</a></span> <span class="sender italic">Bryan O'Sullivan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04071.html">Re: Connection Pool with Erlang PB Clien...</a></span> <span class="sender italic">Justin Sheehy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04072.html">Re: Connection Pool with Erlang PB ...</a></span> <span class="sender italic">Andrew Berman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04073.html">Re: Connection Pool with Erlang...</a></span> <span class="sender italic">Justin Sheehy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04074.html">Re: Connection Pool with Er...</a></span> <span class="sender italic">Andrew Berman</span></li>
<li class="icons-email"><span class="subject"><a href="msg04372.html">Re: Connection Pool with Er...</a></span> <span class="sender italic">Andrew Berman</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04070.html">Re: Connection Pool with Erlang PB Client Ne...</a></span> <span class="sender italic">Bob Ippolito</span></li>
<li class="icons-email"><span class="subject"><a href="msg04120.html">Re: Connection Pool with Erlang PB Client Ne...</a></span> <span class="sender italic">Joel Meyer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04125.html">Re: Connection Pool with Erlang PB Clien...</a></span> <span class="sender italic">Andrew Berman</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Connection Pool with Erlang PB Client Necessary?">
<input type="hidden" name="msgid" value="CAMLuKs0M0wmn+c2r822LsPKuRv4YdXj_2V_h1HXBj5fxq_B=3w@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04067.html">
<input type="submit" value=" Bryan O'Sullivan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Connection+Pool+with+Erlang+PB+Client+Necessary%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04059.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04068.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAMLuKs0M0wmn+c2r822LsPKuRv4YdXj_2V_h1HXBj5fxq_B=3w@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
