<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: Using Hadoop distcp to load data into Riak-CS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd14.html#11450" id="c">
<link rel="index" href="mail14.html#11450" id="i">
<link rel="prev" href="msg11423.html" id="p">
<link rel="next" href="msg11456.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11450.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Using+Hadoop+distcp+to+load+data+into+Riak%5C-CS%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: Using Hadoop distcp to load data into Riak-CS</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sajner%2C+Daniel+G%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sajner, Daniel G</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130710" rel="nofollow">Wed, 10 Jul 2013 05:23:26 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi.

Sorry about the &quot;fake sender&quot; in the subject of the original message.  Our mail 
security system is funny like that...</pre><pre>

Anyhow, we discovered that distcp puts a temp file name in place and then tries 
to do a PUT (copy) that copy the file to the permanent name.  From the 
documentation that doesn't appear to be supported by Riak. 
<a  rel="nofollow" href="http://docs.basho.com/riakcs/latest/references/apis/storage/RiakCS-PUT-Object-Copy/">http://docs.basho.com/riakcs/latest/references/apis/storage/RiakCS-PUT-Object-Copy/</a>

I still would like to hear if anyone else has had success with distcp.  Maybe 
there is another version out there that works differently.

Thanks,
Dan


From: riak-users [<a  rel="nofollow" href="mailto:riak-users-boun...@lists.basho.com">mailto:riak-users-boun...@lists.basho.com</a>] On Behalf Of 
Sajner, Daniel G
Sent: Tuesday, July 09, 2013 7:56 AM
To: 'riak-users@lists.basho.com'
Subject: [PMX:FAKE_SENDER] Using Hadoop distcp to load data into Riak-CS

Hi.

I'm trying to load data from a Hadoop cluster using distcp.  Distcp supports 
the S3 API, but I'm running into issues.
Has anyone tested/had success with this process?  Any help is appreciated!  
Details below...

Thanks,
Dan


Here's my setup:
Hadoop cluster with a small text file in hdfs.
Jets3t.properties file configured to use a proxy host.
Proxy host running Varnish basically to serve as a load balancer at this point. 
 All caching is currently disabled.
Riak-CS/Riak running on a 6 server cluster.

Here's the scenario:
I'm running this command...


Ø  hadoop distcp -libjars ./jets3t-config.jar 
hdfs://hadoop.node.address/user/dan/test.txt 
s3n://riak-user-key:riak-secret@testing/

I see many requests and responses in the varnishlog so I know communication is 
succeeding.  The distcp process throws an exception and I see empty files and 
directories left on my Riak system.

The exception looks like this:

13/07/08 15:52:42 INFO tools.DistCp: sourcePathsCount=1
13/07/08 15:52:42 INFO tools.DistCp: filesToCopyCount=1
13/07/08 15:52:42 INFO tools.DistCp: bytesToCopyCount=93.0
13/07/08 15:52:42 INFO mapred.JobClient: Running job: job_201307031542_0023
13/07/08 15:52:43 INFO mapred.JobClient:  map 0% reduce 0%
13/07/08 15:52:50 INFO mapred.JobClient: Job complete: job_201307031542_0023
13/07/08 15:52:50 INFO mapred.JobClient: Counters: 6
13/07/08 15:52:50 INFO mapred.JobClient:   Job Counters
13/07/08 15:52:50 INFO mapred.JobClient:     SLOTS_MILLIS_MAPS=6980
13/07/08 15:52:50 INFO mapred.JobClient:     Total time spent by all reduces 
waiting after reserving slots (ms)=0
13/07/08 15:52:50 INFO mapred.JobClient:     Total time spent by all maps 
waiting after reserving slots (ms)=0
13/07/08 15:52:50 INFO mapred.JobClient:     Launched map tasks=1
13/07/08 15:52:50 INFO mapred.JobClient:     SLOTS_MILLIS_REDUCES=0
13/07/08 15:52:50 INFO mapred.JobClient:     Failed map tasks=1
13/07/08 15:52:50 INFO mapred.JobClient: Job Failed: NA
With failures, global counters are inaccurate; consider running with -i
Copy failed: java.io.IOException: Job failed!
        at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:1246)
        at org.apache.hadoop.tools.DistCp.copy(DistCp.java:667)
        at org.apache.hadoop.tools.DistCp.run(DistCp.java:881)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:79)
        at org.apache.hadoop.tools.DistCp.main(DistCp.java:908)


And Riak is left like this:

Ø  s3cmd ls s3://testing
                       DIR   s3://testing/_distcp_logs_7bhq3z/
                       DIR   s3://testing/_distcp_logs_j9re3f/
2013-07-09 03:54         0   s3://testing/_distcp_logs_7bhq3z_$folder$
2013-07-09 00:03         0   s3://testing/_distcp_logs_j9re3f_$folder$
2013-07-08 19:52         0   s3://testing/test.txt


Confidentiality Notice: This electronic message transmission, including any 
attachment(s), may contain confidential, proprietary, or privileged information 
from Chemical Abstracts Service (&quot;CAS&quot;), a division of the American Chemical 
Society (&quot;ACS&quot;). If you have received this transmission in error, be advised 
that any disclosure, copying, distribution, or use of the contents of this 
information is strictly prohibited. Please destroy all copies of the message 
and contact the sender immediately by either replying to this message or 
calling 614-447-3600.

Confidentiality Notice: This electronic message transmission, including any 
attachment(s), may contain confidential, proprietary, or privileged information 
from Chemical Abstracts Service (&quot;CAS&quot;), a division of the American Chemical 
Society (&quot;ACS&quot;). If you have received this transmission in error, be advised 
that any disclosure, copying, distribution, or use of the contents of this 
information is strictly prohibited. Please destroy all copies of the message 
and contact the sender immediately by either replying to this message or 
calling 614-447-3600.

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11423.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd14.html#11450">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail14.html#11450">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11456.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11423.html">Using Hadoop distcp to load data into Riak-CS</a></span> <span class="sender italic">Sajner, Daniel G</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: Using Hadoop distcp to load data into Riak-CS</span> <span class="sender italic">Sajner, Daniel G</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11456.html">Re: Using Hadoop distcp to load data into Riak-C...</a></span> <span class="sender italic">Kelly McLaughlin</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: Using Hadoop distcp to load data into Riak-CS">
<input type="hidden" name="msgid" value="54624_1373458847_r6ACKlPe059306_1A0AA1F24E212D4DB44DC3D3D57342020BFC45B3@NTMAIL06.intra.cas.org">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11450.html">
<input type="submit" value=" Sajner, Daniel G ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Using+Hadoop+distcp+to+load+data+into+Riak%5C-CS%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11423.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11456.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">54624_1373458847_r6ACKlPe059306_1A0AA1F24E212D4DB44DC3D3D57342020BFC45B3@NTMAIL06.intra.cas.org</li>
</ul>
</div>
</body>
</html>
