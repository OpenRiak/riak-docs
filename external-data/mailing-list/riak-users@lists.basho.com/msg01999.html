<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: newbie questions: sorted keys, ADT primitives,	and link manipulation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01999" id="c">
<link rel="index" href="maillist.html#01999" id="i">
<link rel="prev" href="msg01992.html" id="p">
<link rel="next" href="msg01993.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01999.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+newbie+questions%5C%3A+sorted+keys%2C+ADT+primitives%2C%09and+link+manipulation%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: newbie questions: sorted keys, ADT primitives,	and link manipulation</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremiah+Peschka%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremiah Peschka</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110116" rel="nofollow">Sun, 16 Jan 2011 06:49:34 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Alex Sicular posted about this on his blog the other day:
<a  rel="nofollow" href="http://siculars.posterous.com/paginating-with-riak">http://siculars.posterous.com/paginating-with-riak</a> Basically, he uses a
combination of Riak and Redis to manage pagination.</pre><pre>

If you're absolutely opposed to using multiple data stores, Eric's approach
should work. Otherwise, I'd offload sorting and that sort of thing to Redis
and use Riak as your data store. In memory caching is a good thing :)

Jeremiah Peschka
Microsoft SQL Server MVP
MCITP: Database Developer, DBA


On Sat, Jan 15, 2011 at 7:23 PM, Gary William Flake &lt;g...@flake.org&gt; wrote:

&gt; I am building a backend for a web service and Riak looks to be a strong fit
&gt; for my needs at this point.  However, there is one really simple requirement
&gt; that I can't figure out how to implement on Riak with any sort of
&gt; efficiency.  To simplify the question, suppose that I want a twitter-like
&gt; service that has billions of smallish documents that enter into the backend
&gt; over a period of time.  Typical read pattern will be:
&gt;
&gt; 1. List the last N documents
&gt; 2. Given a document, see the N that came before this one.
&gt; 3. From a random point, see the N documents before this one.
&gt;
&gt; Hence, what I really want is to be able to access the documents in sorted
&gt; order by timestamp.  I know that I can do all of this with a map/reduce job,
&gt; but this solution literally requires the backend to scan each and every
&gt; document which seems less than ideal.
&gt;
&gt; Is there a generally accepted &quot;right&quot; way to do this on Riak?  Or is there
&gt; no known way to do this gracefully, and I need to be prepared to roll my own
&gt; secondary indices?  Or, can this be handled with a Riak Search range query?
&gt;
&gt; ###
&gt;
&gt; The second topic is concerned with finding an elegant way to address the
&gt; first question.  One way to solve the problem above is to use a bucket as a
&gt; poor man's list.  At the application layer, when I insert a new document, I
&gt; could create a new k:v pair in my &quot;list&quot; bucket with the key being an
&gt; integer corresponding to this document's position in the corpus, and the
&gt; value being the actual key in the document bucket.  With this scheme, I
&gt; could satisfy the scenario above with the following observations:
&gt;
&gt; 1. Once I have the list key for a document, I could find the N before it in
&gt; O(N) time which is an improvement over the map/reduce solution which is
&gt; O(size of corpus) / O(cluster size).
&gt;
&gt; 2. This solution assumes atomicity that doesn't exist in practice (e.g.,
&gt; the operations &quot;new id &lt;- number of docs&quot;, and &quot;add a new doc with key new
&gt; id&quot; have to complete as an atomic operation if multiple clients are
&gt; attempting an insert).
&gt;
&gt; 3. This solution also wants a multiget styled function to map index values
&gt; to true document keys, and then to get the resulting document.
&gt;
&gt; I know what you are thinking: just use a serialized JSON array as the value
&gt; of the list that you want, then just get it, deserialize it, mutate it, then
&gt; update its value.  But this is horrific because each insertion takes
&gt; O(corpus size) time.
&gt;
&gt; Bottom line: life sucks no matter which route we take.
&gt;
&gt; What I think is needed are redis styled objects that support O(1) atomic
&gt; operations.  For example, if I simply had a k:v pair where the value was a
&gt; list which supported insert/delete front/rear, then we are golden.
&gt;
&gt; ###
&gt;
&gt; This brings me to my third question / observation.  In scanning over the
&gt; archives of this list, I see that others have requested this feature before,
&gt; but I haven't seen any mention of the feature being considered.  (Please,
&gt; please!  I hope I am wrong).
&gt;
&gt; So, I want to offer what I think is the minimal feature request that
&gt; supports the scenarios that I am trying to achieve.  Basically, I want to
&gt; build off of links, allowing them to generalize into container types.  My
&gt; assumptions:
&gt;
&gt; 1. Links have a natural order in that they alway come out in the same order
&gt; that they are created (at least that's what the python client API states,
&gt; but I can't confirm it in the Riak docs).
&gt;
&gt; 2. Links seem to support mutation operations, meaning that I can add a link
&gt; and remove a link in O(1) time (and not in time proportional to the number
&gt; of links on the record).
&gt;
&gt; If both of these are true, then all that is needed is to add simple O(1)
&gt; mutation operations allowing one to treat a records links as a special
&gt; container that references to other records.  Insert/delete front/rear will
&gt; give you stacks and queues.  A small addition to the API would support sets.
&gt;
&gt; ###
&gt;
&gt; That's all for now.  I hope someone can chime in with something to add on
&gt; top.  My real hope is that I've misunderstood the capabilities of Riak and
&gt; that what I want to do can be done today.  But if that's not the case, I am
&gt; curious if others have the same needs and if they know how to work around
&gt; them.
&gt;
&gt; Thanks,
&gt; -- GWF
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01992.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01999">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01999">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01993.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01990.html">newbie questions: sorted keys, ADT primitives, and link...</a></span> <span class="sender italic">Gary William Flake</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01991.html">Re: newbie questions: sorted keys, ADT primitives,...</a></span> <span class="sender italic">Eric Moritz</span></li>
<li class="icons-email"><span class="subject"><a href="msg01992.html">Re: newbie questions: sorted keys, ADT primitives,...</a></span> <span class="sender italic">Eric Moritz</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: newbie questions: sorted keys, ADT primitives,...</span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: newbie questions: sorted keys, ADT primitives,	and link manipulation">
<input type="hidden" name="msgid" value="AANLkTikunLTWhfOJ+5wrH_Y7yLRg3KmVshpE2GTNNCU6@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01999.html">
<input type="submit" value=" Jeremiah Peschka ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+newbie+questions%5C%3A+sorted+keys%2C+ADT+primitives%2C%09and+link+manipulation%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01992.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01993.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTikunLTWhfOJ+5wrH_Y7yLRg3KmVshpE2GTNNCU6@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
