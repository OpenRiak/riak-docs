<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Has the result failure scenarios documented in wiki changed in 1.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05095" id="c">
<link rel="index" href="maillist.html#05095" id="i">
<link rel="prev" href="msg05059.html" id="p">
<link rel="next" href="msg05060.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05095.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Has+the+result+failure+scenarios+documented+in+wiki+changed+in+1.0%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Has the result failure scenarios documented in wiki changed in 1.0</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111007" rel="nofollow">Fri, 07 Oct 2011 07:06:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Eric,

Since your colleague is running an older version he is probably bumping up
against basic_quorum [1].  Basic quorum is a mechanism to prevent latency
growth in the case where nodes are going down.  In the land before 1.0 Riak
considered a not_found to count towards a failure.  Basic quorum says &quot;if
the majority of the replicas report failure, i.e. not_found, then consider
the data not to be there and return not_found back to the client.&quot;  If you
didn't have this check then clients using R=1 on a cluster with failing
nodes will have nonintuitive latency spikes because with N=3 &amp; R=1 you maybe
have to wait for all 3 replicas to reply before you can return to the
client.  This essentially turns a R=1 into a R=3 request without the
client's knowledge.</pre><pre>

In 1.0, Riak defaults to `basic_quorum=false` and `notfound_ok=true`.  This
means that notfound responses will count as successful reads.  This keeps
the semantics of R because if the first R responses are notfound then
notfound will be returned to the client.

In your case, depending on how many nodes you are taking down and what keys
you are reading you could still get a notfound response for N=3 and R=2.  It
also depends on which replicas respond first.  E.g. given the case where
N=3/R=2 and you kill 2 nodes that where the first two entries in a key K's
preflist.  Only if those two partitions (which are now fallbacks) return
first will you get a notfound for key K.  If the 3rd partition is
interleaved anywhere in the first two responses you'll get your object back.
 Also, read repair will then kick in and the 2nd time around all replicas
should have the object.

In general we tried to make 1.0 more predictable in the face of node
failures.  I hope this makes sense.  It's easier to explain with a
whiteboard.

-Ryan

[1]:
<a  rel="nofollow" href="http://wiki.basho.com/Eventual-Consistency.html#Edge-Case%3A-Reading-With-R%3D1-When-Two-Primaries-Fail">http://wiki.basho.com/Eventual-Consistency.html#Edge-Case%3A-Reading-With-R%3D1-When-Two-Primaries-Fail</a>
(I think our explanation here is a little confusing and even wrong in
some
places)

On Wed, Oct 5, 2011 at 6:37 PM, Eric Moritz &lt;e...@themoritzfamily.com&gt;wrote:

&gt; I was reading through this documentation after a colleague mentioned
&gt; getting not_found while stopping and starting nodes to mimic failures.
&gt;  His experience corresponds with the behaviors described on this wiki
&gt; page:
&gt;
&gt; <a  rel="nofollow" href="http://wiki.basho.com/Eventual-Consistency.html#Failure-Scenarios">http://wiki.basho.com/Eventual-Consistency.html#Failure-Scenarios</a>
&gt;
&gt; However, when I try to mimic the same failures in 1.0, I get successes
&gt; when trying to read and write after taking a node down.  I noticed the
&gt; notfound_ok parameter exists now in the HTTP documentation which I
&gt; assume has something to do with this.  Has the fail-over code been
&gt; improved to hide the not_found responses in the face of failure?
&gt;
&gt; Thanks,
&gt; Eric Moritz.
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05059.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05095">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05095">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05060.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05059.html">Has the result failure scenarios documented in wiki changed i...</a></span> <span class="sender italic">Eric Moritz</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Has the result failure scenarios documented in wiki ...</span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Has the result failure scenarios documented in wiki changed in 1.0">
<input type="hidden" name="msgid" value="CACZcpe=6aPJyFGVg5Yvu_V7FfcKEEB99SCdFM8ykgG79kOPP3w@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05095.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Has+the+result+failure+scenarios+documented+in+wiki+changed+in+1.0%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05059.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05060.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpe=6aPJyFGVg5Yvu_V7FfcKEEB99SCdFM8ykgG79kOPP3w@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
