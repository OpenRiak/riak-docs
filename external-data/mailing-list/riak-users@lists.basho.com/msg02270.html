<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Schema Architecture, Map Reduce & Key Lists</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02270" id="c">
<link rel="index" href="maillist.html#02270" id="i">
<link rel="prev" href="msg02278.html" id="p">
<link rel="next" href="msg02275.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02270.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Schema+Architecture%2C+Map+Reduce+%5C%26+Key+Lists%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Schema Architecture, Map Reduce & Key Lists</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Bryan+Fink%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Bryan Fink</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110210" rel="nofollow">Thu, 10 Feb 2011 11:54:46 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Thu, Feb 10, 2011 at 12:35 PM, Mat Ellis &lt;m...@tecnh.com&gt; wrote:
&gt; We are converting a mysql based schema to Riak using Ripple. We're tracking
&gt; a lot of clicks, and each click belongs to a cascade of other objects:
&gt; click -&gt; placement -&gt; campaign -&gt; customer
&gt; i.e. we do a lot of operations on these clicks grouped by placement or sets
&gt; of placements.
… snip …
&gt; On a related noob-note, what would be the best way of creating a set of the
&gt; clicks for a given placement? Map Reduce or Riak Search or some other
&gt; method?</pre><pre>

Hi, Mat.  I have an alternative strategy I think you could try if
you're up for stepping outside of the Ripple interface.  Your incoming
clicks reminded me of other stream data I've processed before, so the
basic idea is to store clicks as a stream, and then process that
stream later.  The tools I'd use to do this are Luwak[1] and
luwak_mr[2].

First, store all clicks, as they arrive, in one Luwak file (or maybe
one Luwak file per host accepting clicks, depending on your service's
arrangement).  Luwak has a streaming interface that's available
natively in distributed Erlang, or over HTTP by exploiting the
&quot;chunked&quot; encoding type.  Roll over to a new file on whatever
convenient trigger you like (time period, timeout, manual
intervention, etc.).

Next, use map/reduce to process the stream.  The luwak_mr utility will
allow you to specify a Luwak file by name, and it will handle toss
each of the chunks of that file to various cluster nodes for
processing.  The first stage of your map/reduce query just needs to be
able to handle any single chunk of the file.

I've posted a few examples about how to use the luwak_mr
utility.[3][4][5]  They deal with analyzing events in baseball games
(another sort of stream of events).

Pros:
 - No need to list keys.
 - The time to process a day's data should be proportional to the
number of clicks on that day (i.e. proportional to the size of the
file).

Caveats:
 - Luwak works best with write-once data.  Modifying a block of a
Luwak file after it has been written causes the block to be copied,
and the old version of the block is not deleted.  (Even if some of
your data is modification-heavy, this might work for the non-modified
parts … like the key list for a day's clicks?)
 - I don't have good numbers for Luwak's speed/efficiency.
 - I've only recently started experimenting with Luwak in this
map/reducing manner, so I'm not sure if there are other pitfalls.

[1] <a  rel="nofollow" href="http://wiki.basho.com/Luwak.html">http://wiki.basho.com/Luwak.html</a>
[2] <a  rel="nofollow" href="http://contrib.basho.com/luwak_mr.html">http://contrib.basho.com/luwak_mr.html</a>
[3] <a  rel="nofollow" href="http://blog.beerriot.com/2011/01/16/mapreducing-luwak/">http://blog.beerriot.com/2011/01/16/mapreducing-luwak/</a>
[4] 
<a  rel="nofollow" href="http://blog.basho.com/2011/01/20/baseball-batting-average%2c-using-riak-map/reduce/">http://blog.basho.com/2011/01/20/baseball-batting-average%2c-using-riak-map/reduce/</a>
[5] <a  rel="nofollow" href="http://blog.basho.com/2011/01/26/fixing-the-count/">http://blog.basho.com/2011/01/26/fixing-the-count/</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02278.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02270">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02270">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02275.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg02266.html">Schema Architecture, Map Reduce &amp; Key Lists</a></span> <span class="sender italic">Mat Ellis</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02268.html">Re: Schema Architecture, Map Reduce &amp; Key Lists</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02269.html">Re: Schema Architecture, Map Reduce &amp; Key L...</a></span> <span class="sender italic">Mat Ellis</span></li>
<li class="icons-email"><span class="subject"><a href="msg02278.html">Re: Schema Architecture, Map Reduce &amp; Key L...</a></span> <span class="sender italic">Nico Meyer</span></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Schema Architecture, Map Reduce &amp; Key Lists</span> <span class="sender italic">Bryan Fink</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02275.html">Re: Schema Architecture, Map Reduce &amp; Key L...</a></span> <span class="sender italic">Mat Ellis</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02276.html">Re: Schema Architecture, Map Reduce &amp; K...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02277.html">Re: Schema Architecture, Map Reduce &am...</a></span> <span class="sender italic">Mat Ellis</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02282.html">has_many :through</a></span> <span class="sender italic">Mat Ellis</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02283.html">Re: has_many :through</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02284.html">Re: has_many :through</a></span> <span class="sender italic">Mat Ellis</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Schema Architecture, Map Reduce &amp; Key Lists">
<input type="hidden" name="msgid" value="AANLkTim+3hCPKs4D0odGW1amz-FSq4pM_x7ar_fHB66P@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02270.html">
<input type="submit" value=" Bryan Fink ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Schema+Architecture%2C+Map+Reduce+%5C%26+Key+Lists%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02278.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02275.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTim+3hCPKs4D0odGW1amz-FSq4pM_x7ar_fHB66P@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
