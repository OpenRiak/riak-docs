<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: safely resolving conflicts on read</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05422" id="c">
<link rel="index" href="maillist.html#05422" id="i">
<link rel="prev" href="msg05419.html" id="p">
<link rel="next" href="msg05423.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05422.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+safely+resolving+conflicts+on+read%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: safely resolving conflicts on read</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Justin+Karneges%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Justin Karneges</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111102" rel="nofollow">Wed, 02 Nov 2011 10:40:54 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Thanks everyone for these replies (and also Aphyr, off-list).  It has helped me 
confirm my suspicions and sounds like I'm on the right track.</pre><pre>

For one of my keys, I am doing sort of a manual &quot;last write wins&quot; by having 
the reader sort siblings by timestamp, then by vtag, to deterministically 
select the same sibling every time.  The reason for keeping the other siblings 
around is they may contain the only references to other keys created along 
with them.  A separate cleanup process can then be sure to delete the referred 
keys before removing the siblings.  And of course the algorithm used to 
determine the winning sibling is shared by both the read function and the 
cleanup function.

On Wednesday, November 02, 2011 07:52:03 AM Bob Ippolito wrote:
&gt; An approach similar to #1 is implemented in statebox
&gt; <a  rel="nofollow" href="http://github.com/mochi/statebox">http://github.com/mochi/statebox</a> - basically the trick is to store an
&gt; operation queue along with the data, and to put some constraints on how
&gt; operations must work so that they can be repeated for conflict resolution.
&gt; 
&gt; On Wednesday, November 2, 2011, Erik Søe Sørensen &lt;e...@trifork.com&gt; wrote:
&gt; &gt; What you'd usually do is somewhere between 2) and 3) - namely, accept
&gt; 
&gt; that siblings might occur (although rarely). Also, you'd have a resolution
&gt; function with the property (besides being deterministic) that
&gt; reconciliating two identical siblings would yield the same - i.e., f(X,X) =
&gt; X.
&gt; 
&gt; &gt; ________________________________________
&gt; &gt; Fra: riak-users-boun...@lists.basho.com [
&gt; 
&gt; riak-users-boun...@lists.basho.com] P&amp;#229; vegne af Justin Karneges [
&gt; jus...@affinix.com]
&gt; 
&gt; &gt; Sendt: 1. november 2011 21:34
&gt; &gt; Til: riak-users@lists.basho.com
&gt; &gt; Emne: safely resolving conflicts on read
&gt; &gt; 
&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt; <a  rel="nofollow" href="http://wiki.basho.com/Vector-Clocks.html">http://wiki.basho.com/Vector-Clocks.html</a> contains this text:
&gt; &gt; 
&gt; &gt; &quot;It should be noted that if you are trying to resolve conflicts
&gt; 
&gt; automatically,
&gt; 
&gt; &gt; you can end up in a condition with which two clients are simultaneously
&gt; &gt; resolving and creating new conflicts.&quot;
&gt; &gt; 
&gt; &gt; If conflict resolution is moved to the reader, I'm curious what
&gt; &gt; strategies people use to avoid this kind of feet stomping.
&gt; &gt; 
&gt; &gt; Some ideas that have come to mind:
&gt; &gt; 
&gt; &gt; 1) Have a deterministic way of deriving a correct/unified/winner value
&gt; 
&gt; from
&gt; 
&gt; &gt; multiple siblings, such that any reading client would always arrive at
&gt; &gt; the same answer.  Simply use this derived answer as the value read, but
&gt; &gt; don't attempt to write a corrected value into Riak.  The value could
&gt; &gt; eventually
&gt; 
&gt; be
&gt; 
&gt; &gt; corrected at the time of a necessary write as opposed to a read reaction.
&gt; &gt; 
&gt; &gt; 2) Determine a correct value per #1 above, but then attempt to write this
&gt; &gt; value back into Riak in such a way that if multiple nodes were to write
&gt; 
&gt; the
&gt; 
&gt; &gt; same value simultaneously then they don't create siblings.  I'm not sure
&gt; 
&gt; if
&gt; 
&gt; &gt; this is possible in Riak?
&gt; &gt; 
&gt; &gt; 3) Determine a correct value per #1 above, and allow exactly one node to
&gt; 
&gt; ever
&gt; 
&gt; &gt; immediately write corrected values after a read.  Something like &quot;if
&gt; 
&gt; hash(key)
&gt; 
&gt; &gt; % node_count == current_node then do_correction&quot;.  Since value correction
&gt; 
&gt; is
&gt; 
&gt; &gt; not vital to availability, there's no harm if the owning node is down.  I
&gt; 
&gt; just
&gt; 
&gt; &gt; figure this would allow for self-healing over time.
&gt; &gt; 
&gt; &gt; Maybe there are other ways.  What do people really do?
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; Justin
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05419.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05422">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05422">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05423.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05413.html">safely resolving conflicts on read</a></span> <span class="sender italic">Justin Karneges</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05416.html">SV: safely resolving conflicts on read</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05419.html">Re: safely resolving conflicts on read</a></span> <span class="sender italic">Bob Ippolito</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: safely resolving conflicts on read</span> <span class="sender italic">Justin Karneges</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05423.html">Re: safely resolving conflicts on rea...</a></span> <span class="sender italic">Aphyr</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: safely resolving conflicts on read">
<input type="hidden" name="msgid" value="201111021040.44678.justin@affinix.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05422.html">
<input type="submit" value=" Justin Karneges ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+safely+resolving+conflicts+on+read%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05419.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05423.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">201111021040.44678.justin@affinix.com</li>
</ul>
</div>
</body>
</html>
