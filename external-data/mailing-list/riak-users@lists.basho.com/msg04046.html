<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: When is Vclock generated?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04046" id="c">
<link rel="index" href="maillist.html#04046" id="i">
<link rel="prev" href="msg04041.html" id="p">
<link rel="next" href="msg04047.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04046.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+When+is+Vclock+generated%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: When is Vclock generated?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Andrew+Berman%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Andrew Berman</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110722" rel="nofollow">Fri, 22 Jul 2011 13:09:29 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sean,

Thanks for the reply.  I am fetching before write, however, what I
want is the ability to fetch the vclock and use it as a version on the
object itself throughout my application, much how Hibernate uses a
version property.  This way I am able to tell if an object is
persistent or not based on whether it has a version or if it is
undefined.  So basically I created a version property on my record
which, in turn, gets stored in Riak but this version will never match
the actual vclock when looking at the data itself, since the version
is only ever updated to the previous vclock and not the one after the
object has been updated.  Does that make more sense?  The version I
store in Riak is pretty worthless so it's not a big deal if it doesn't
match since I update it to the current one when I load the object, but
it would certainly make things easier on me if I could always have the
version match the current vclock, so then I wouldn't have to update
the version on fetches.</pre><pre>

--Andrew

On Fri, Jul 22, 2011 at 6:06 AM, Sean Cribbs &lt;s...@basho.com&gt; wrote:
&gt; Andrew,
&gt; Are you trying to store the vclock as part of the value? I'm
&gt; misunderstanding something.
&gt; Well-behaved clients should always fetch before writing, so your client
&gt; should have the most reasonably-fresh version of the object when you write.
&gt;  There's really no way to guarantee that some other actor won't write a new
&gt; version between the time that you fetch the object and store it back, or
&gt; even in the time between your client issuing the write and it actually being
&gt; written to disk.  Vector clocks and sibling values exist in part to help
&gt; disambiguate those race conditions.  If you're submitting the write without
&gt; the vclock, your write could very well be ignored, so please fetch before
&gt; storing.
&gt;
&gt; On Thu, Jul 21, 2011 at 6:13 PM, Andrew Berman &lt;rexx...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt; I'm looking to store the vclock on my object to be used for
&gt;&gt; versioning.   Currently, when I get the object from Riak I fill in the
&gt;&gt; version with the vclock from Riak (which I use to determine if the
&gt;&gt; object is persistent and for passing back to Riak when putting) and
&gt;&gt; then when the object is saved it saves the version as the previous
&gt;&gt; vclock value.  I'm wondering when the vclock is actually generated.
&gt;&gt; Can I write a pre-commit hook that fills in the version so it has the
&gt;&gt; most updated value or is there no way for me to do it.  It's not a
&gt;&gt; huge deal because the version value in the db is immediately updated
&gt;&gt; upon loading the data from Riak, but I just feel like it would make
&gt;&gt; things more consistent if I could have the version matching the
&gt;&gt; updated vclock.
&gt;&gt;
&gt;&gt; Thanks for any help!
&gt;&gt;
&gt;&gt; Andrew
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://www.basho.com/">http://www.basho.com/</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04041.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04046">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04046">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04047.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg04040.html">When is Vclock generated?</a></span> <span class="sender italic">Andrew Berman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04041.html">Re: When is Vclock generated?</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: When is Vclock generated?</span> <span class="sender italic">Andrew Berman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04047.html">Re: When is Vclock generated?</a></span> <span class="sender italic">siculars</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: When is Vclock generated?">
<input type="hidden" name="msgid" value="CAEVpa77+9cPpdMXHRW_8PoKTws9YiPmNKCT9xPZmWchayTBKoA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04046.html">
<input type="submit" value=" Andrew Berman ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+When+is+Vclock+generated%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04041.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04047.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAEVpa77+9cPpdMXHRW_8PoKTws9YiPmNKCT9xPZmWchayTBKoA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
