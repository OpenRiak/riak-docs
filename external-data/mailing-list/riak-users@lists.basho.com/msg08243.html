<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: How to profile a cluster of Riak nodes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08243" id="c">
<link rel="index" href="maillist.html#08243" id="i">
<link rel="prev" href="msg08242.html" id="p">
<link rel="next" href="msg08245.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08243.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+profile+a+cluster+of+Riak+nodes%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: How to profile a cluster of Riak nodes</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Greg+Burd%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Greg Burd</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120809" rel="nofollow">Thu, 09 Aug 2012 10:02:10 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Amir,

I'll add one more major consideration to Ryan's excellent list, check your 
network for TCP Incast.  Every cluster at reasonable scale will have to manage 
this issue carefully, 20 nodes is more than enough to create this kind of 
problem (I see it with as few as 9).  Here's more information: 
<a  rel="nofollow" href="http://www.snookles.com/slf-blog/2012/01/05/tcp-incast-what-is-it/">http://www.snookles.com/slf-blog/2012/01/05/tcp-incast-what-is-it/</a></pre><pre>

Please also let us know how you've tuned your TCP stack on the cluster nodes, 
what your networking topology is (equipment/models/configuration, connections, 
etc.) and any other network traffic you might be putting on that same 
interface.  We commonly separate inbound client connections on HTTP and TCP via 
Protobufs from internal distributed Erlang and handoff traffic.  That can be 
key in reducing the number of TCP retransmits and slow starts.

In a distributed database, the network is part of the thing being stressed and 
measured and so it should be given as much attention in your paper and in your 
preparation as anything else.

best of luck,

-greg


On Aug 9, 2012, at 12:12 PM, Ryan Zezeski &lt;rzeze...@basho.com&gt; wrote:

&gt; Amir,
&gt; 
&gt; Are you using one node to run basho bench?  If so, have you tried running 
&gt; multiple basho bench instances on separate nodes (or tried other benchmark 
&gt; tools)?  There could be many reasons for your plateau but I would first rule 
&gt; out that your not maxing out the basho bench instance or the node it is 
&gt; running on.
&gt; 
&gt; It also would help to know the hardware, any modifications to your 
&gt; app.config, and the basho bench config you are running.
&gt; 
&gt; As for profiling tools, everyone has there favorite but some that come to 
&gt; mind:
&gt; 
&gt; 1. boundary - We've had much success internally at Basho using Boundary to 
&gt; view network traffic.
&gt; 
&gt; 2. iostat - Run it continuously at 1s intervals and watch for spikes.
&gt; 
&gt; 3. vmstat - Look for paging.
&gt; 
&gt; Finally, we've noticed that a lot of users run horrible OS settings such as 
&gt; non-zero swappines and other such things which make a database server 
&gt; unhappy.  See this link: <a  rel="nofollow" href="http://wiki.basho.com/LevelDB.html#Tuning-LevelDB">http://wiki.basho.com/LevelDB.html#Tuning-LevelDB</a>
&gt; 
&gt; -Z
&gt; 
&gt; On Thu, Aug 9, 2012 at 10:32 AM, amir ghaffari &lt;ami.ghaff...@gmail.com&gt; wrote:
&gt; Hi there,
&gt; 
&gt; I have done a scalability benchmark for Riak DBMS and we couldn't scale up 
&gt; the throughput beyond 20 Riak nodes. The benchmarking with Basho_Bench has 
&gt; been run on a 31 node cluster and each node has its own hard disk but the 
&gt; maximum throughput is on 20 nodes.
&gt; 
&gt; I’d like to understand why Riak didn’t scale e.g. is it the connection, or 
&gt; other network traffic. I’d like to use some profiling tools to get more 
&gt; information. Please can you advise us a helpful profiling tool to use?
&gt; 
&gt; Thanks in advance,
&gt; 
&gt; Amir
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08242.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08243">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08243">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08245.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08240.html">How to profile a cluster of Riak nodes</a></span> <span class="sender italic">amir ghaffari</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08241.html">Re: How to profile a cluster of Riak nodes</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg08242.html">Re: How to profile a cluster of Riak nodes</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: How to profile a cluster of Riak nodes</span> <span class="sender italic">Greg Burd</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: How to profile a cluster of Riak nodes">
<input type="hidden" name="msgid" value="2C2F2641-C231-4D29-A7DF-661F37AF4D01@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08243.html">
<input type="submit" value=" Greg Burd ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+profile+a+cluster+of+Riak+nodes%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08242.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08245.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">2C2F2641-C231-4D29-A7DF-661F37AF4D01@basho.com</li>
</ul>
</div>
</body>
</html>
