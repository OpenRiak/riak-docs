<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: missing writes / inconsistent number of keys read after a bulk	write</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06199" id="c">
<link rel="index" href="maillist.html#06199" id="i">
<link rel="prev" href="msg06189.html" id="p">
<link rel="next" href="msg06204.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06199.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+missing+writes+%5C%2F+inconsistent+number+of+keys+read+after+a+bulk%09write%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: missing writes / inconsistent number of keys read after a bulk	write</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120109" rel="nofollow">Mon, 09 Jan 2012 21:24:53 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Not sure how your binding does it but MyBucket.keys() should be calling the 
list keys feature of riak via the streaming mode which chunks the key reply 
instead of buffering and sending one entire list of keys. </pre><pre>


@siculars on twitter
<a  rel="nofollow" href="http://siculars.posterous.com">http://siculars.posterous.com</a>

Sent from my iRotaryPhone

On Jan 9, 2012, at 17:39, Karthik K &lt;oss....@gmail.com&gt; wrote:

&gt; (Changing subject to reflect the problem better and reposting ). 
&gt; 
&gt; Any idea , based on the configuration inline as to what explains the 
&gt; inconsistency number of keys read after a bulk write ( say 1M of payload 1000 
&gt; bytes ). 
&gt;  
&gt; Any appropriate write flush setting , that is missed on the client / server 
&gt; side ?  
&gt; 
&gt; 
&gt; --
&gt;   Karthik. 
&gt; 
&gt; 
&gt; On Fri, Jan 6, 2012 at 5:54 PM, Karthik K &lt;oss....@gmail.com&gt; wrote:
&gt; Further, 
&gt;  ulimit -n   is 10K on the box. 
&gt; 
&gt; 
&gt; #  tail -100 /var//log/riak/erlang.log.1 
&gt; 
&gt; ....
&gt; 17:26:26.960 [info] alarm_handler: {set,{system_memory_high_watermark,[]}}
&gt; /usr/lib/riak/lib/os_mon-2.2.6/priv/bin/memsup: Erlang has closed. 
&gt; Erlang has closed
&gt; 17:26:34.443 [info] alarm_handler: {clear,system_memory_high_watermark}
&gt; 
&gt; 
&gt; So - is there a commit / flush setting that is missed when it comes to high 
&gt; volume writes ? 
&gt; 
&gt; 
&gt; On Fri, Jan 6, 2012 at 5:37 PM, Karthik K &lt;oss....@gmail.com&gt; wrote:
&gt; I am using Riak with LevelDB as the storage engine. 
&gt; 
&gt; app.config:
&gt; 
&gt;           {storage_backend, riak_kv_eleveldb_backend},
&gt; 
&gt;  
&gt;  {eleveldb, [
&gt;              {data_root, &quot;/var/lib/riak/leveldb&quot;},
&gt;              {write_buffer_size, 4194304}, %% 4MB in bytes
&gt;             {max_open_files, 50}, %% Maximum number of files open at once per 
&gt; partition
&gt;             {block_size, 65536}, %% 4K blocks
&gt;             {cache_size, 33554432}, %% 32 MB default cache size per-partition
&gt;             {verify_checksums, true} %% make sure data is what we expected it 
&gt; to be
&gt;             ]},
&gt; 
&gt; 
&gt; 
&gt; 
&gt; I want to insert a million keys into the store ( into a given bucket ) . 
&gt; 
&gt; pseudo-code: 
&gt;             riakClient = RiakFactory.pbcClient(); 
&gt;             myBucket = riakClient.createBucket(&quot;myBucket&quot;).nVal(1).execute();
&gt;             for (int i = 1; i &lt;= 1000000; ++i) {
&gt;                 final String key = String.valueOf(i);
&gt;                 myBucket.store(key, new String(payload)).returnBody(false);
&gt;             }
&gt; 
&gt; 
&gt; after this operation, when I do: 
&gt; 
&gt;    int count = 0;
&gt;    for (String key : myBucket.keys() ) {
&gt;          ++count; 
&gt;    }
&gt;    return count; 
&gt; 
&gt; This returns a total of 14K keys, while I was expecting close to 1 million or 
&gt; so. 
&gt; 
&gt; I am using riak-java-client (pbc).   
&gt; 
&gt; Which setting / missing client code can explain the discrepancy ?  Thanks. 
&gt;  
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06189.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06199">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06199">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06204.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06189.html">Re: missing writes / inconsistent number of keys read af...</a></span> <span class="sender italic">Karthik K</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: missing writes / inconsistent number of keys re...</span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg06204.html">Re: missing writes / inconsistent number of keys re...</a></span> <span class="sender italic">Ian Plosker</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: missing writes / inconsistent number of keys read after a bulk	write">
<input type="hidden" name="msgid" value="CD64EFAF-4DED-44B1-A724-D68BA1BDAFA3@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06199.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+missing+writes+%5C%2F+inconsistent+number+of+keys+read+after+a+bulk%09write%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06189.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06204.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CD64EFAF-4DED-44B1-A724-D68BA1BDAFA3@gmail.com</li>
</ul>
</div>
</body>
</html>
