<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Logging chat messages</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09019" id="c">
<link rel="index" href="maillist.html#09019" id="i">
<link rel="prev" href="msg09018.html" id="p">
<link rel="next" href="msg09032.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09019.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Logging+chat+messages%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Logging chat messages</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Guido+Medina%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Guido Medina</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121023" rel="nofollow">Tue, 23 Oct 2012 04:01:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<tt>I haven't been able to store millis, that is a Riak restriction with 
</tt><tt>Integers and Longs. If someone from Basho team could clarify this or 
</tt><tt>give any more ideas, it would be great, I ran out of them...
</tt><pre style="margin: 0em;">

Guido.</pre><pre>

On 23/10/12 11:47, Shashwat Srivastava wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><tt>On Tue, Oct 23, 2012 at 3:35 PM, Guido Medina 
</tt><tt>&lt;guido.med...@temetra.com &lt;<a  rel="nofollow" href="mailto:guido.med...@temetra.com">mailto:guido.med...@temetra.com</a>&gt;&gt; wrote:
</tt><pre style="margin: 0em;">

      I know you want to follow a criteria for sorting messages, you
    could stamp each message up to the second precision (storing
    milliseconds would be a problem) and index them by day (YYYYMMDD),
    so that way you can find by day using 2i search, and sort by time,
    so the ID won't be needed for sorting, that way your design will
    be more loose, no need for synchronization of any type.

      Now if you really need a sequence, if you feel compelled to use
    a sequence, just use a dummy database sequence, any PostgreSQL or
    MySQL service can do that for you, but if you want your app to be
    loosely couple and just exploit the Riak cluster as much as
    possible, UUID will be your winning ticket for message ID. If you
    are unsure UUID will be unique, add another criteria and prefix
    the UUID with something like sender, etc.

    Guido.


Thank you so much!

</pre><tt>Sounds reasonable and feasible :) One question, why storing 
</tt><tt>milliseconds would be a problem?
</tt><pre style="margin: 0em;">

</pre><tt>The only reason to use an incremental id is to be able to build 
</tt><tt>pagination easily i.e. last 50 msgs, next 50, and so on. I guess I can 
</tt><tt>do it without using id, with the help of datestamp and timestamp.
</tt><pre style="margin: 0em;">

Thanks,
Shashwat


    On 23/10/12 10:56, Joshua Muzaaya wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
    <a  rel="nofollow" href="http://couchbase.com">http://couchbase.com</a> CouchBase server has this as a configuration
    and works exactly how riak would. However, using a different
    storage for incremental ids will present challenges. Have you
    carefully considered Couchbase , CouchDB or Big Couch ?

    &lt;<a  rel="nofollow" href="http://www.linkedin.com/pub/muzaaya-joshua/39/2ba/202">http://www.linkedin.com/pub/muzaaya-joshua/39/2ba/202</a>&gt;
    Designed with WiseStamp -
    
&lt;<a  rel="nofollow" href="http://r1.wisestamp.com/r/landing?u=cf16262215eb8784&amp;v=3.11.21&amp;t=1350986076607&amp;promo=10&amp;dest=http%3A%2F%2Fwww.wisestamp.com%2Femail-install%3Futm_source%3Dextension%26utm_medium%3Demail%26utm_campaign%3Dpromo_10">http://r1.wisestamp.com/r/landing?u=cf16262215eb8784&amp;v=3.11.21&amp;t=1350986076607&amp;promo=10&amp;dest=http%3A%2F%2Fwww.wisestamp.com%2Femail-install%3Futm_source%3Dextension%26utm_medium%3Demail%26utm_campaign%3Dpromo_10</a>&gt;Get
    yours
    
&lt;<a  rel="nofollow" href="http://r1.wisestamp.com/r/landing?u=cf16262215eb8784&amp;v=3.11.21&amp;t=1350986076607&amp;promo=10&amp;dest=http%3A%2F%2Fwww.wisestamp.com%2Femail-install%3Futm_source%3Dextension%26utm_medium%3Demail%26utm_campaign%3Dpromo_10">http://r1.wisestamp.com/r/landing?u=cf16262215eb8784&amp;v=3.11.21&amp;t=1350986076607&amp;promo=10&amp;dest=http%3A%2F%2Fwww.wisestamp.com%2Femail-install%3Futm_source%3Dextension%26utm_medium%3Demail%26utm_campaign%3Dpromo_10</a>&gt;



    On Tue, Oct 23, 2012 at 7:32 AM, Rapsey &lt;rap...@gmail.com
    &lt;<a  rel="nofollow" href="mailto:rap...@gmail.com">mailto:rap...@gmail.com</a>&gt;&gt; wrote:

        There is also another trick you can use. Pick a number.
        Assign every app server you have a number between 1 and N.
        The number assigned to the server is your starting ID, then
        increment by N every time you generate an ID from that
        server. The only limitation is that you have to know in
        advance how big N can get (it has to be larger than the
        number of your app servers).


        Sergej


        On Tue, Oct 23, 2012 at 6:00 AM, Shashwat Srivastava
        &lt;dark...@gmail.com &lt;<a  rel="nofollow" href="mailto:dark...@gmail.com">mailto:dark...@gmail.com</a>&gt;&gt; wrote:

            Thank you Guido. Yes, a secondary index based on date
            would be immensely helpful for me to navigate via date. I
            will do this. An incremental message id would be helpful
            for me to get last 50 messages and so forth. I will use
            another db for this. Thanks for all your help.

            Shashwat


            On Mon, Oct 22, 2012 at 2:46 PM, Guido Medina
            &lt;guido.med...@temetra.com
            &lt;<a  rel="nofollow" href="mailto:guido.med...@temetra.com">mailto:guido.med...@temetra.com</a>&gt;&gt; wrote:

                Don't overkill it with technology, you could use Riak
                with a simple 2i index (integer index YYYYMMDD for
                the message date so you can search day by day
                backward), and for the message sequence or identifier
                you could either user ANY SQL database sequence or a
                UUID generator.

                HTH,

                Guido.


                On 22/10/12 10:04, Rapsey wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

                On Mon, Oct 22, 2012 at 10:29 AM, Shashwat
                Srivastava &lt;dark...@gmail.com
                &lt;<a  rel="nofollow" href="mailto:dark...@gmail.com">mailto:dark...@gmail.com</a>&gt;&gt; wrote:


                    Now, each bucket would have conversation between
                    two users or of a room of a site. The
                    conversation rate for (some) rooms is very high,
                    some 20,000 - 30,000 messages per hour. We
                    have observed that users usually don't access
                    conversations past one week. So, if a bucket has
                    conversation of 3 years, then mostly users would
                    access the recent conversation upto a week or
                    month. Can riak handle this easily? Also, would
                    riak use RAM wisely in this scenario? Would it
                    only keep keys and indexes, corresponding to
                    recent messages per bucket, in RAM?


                Leveldb backend should.

                    Finally, what is the best approach for creating
                    keys in a bucket? Earlier, I was planning to use
                    timestamp (in milliseconds). But in a room there
                    can be multiple messages at the same time. As I
                    understand I cannot have a unique incremental
                    message id per bucket (as riak has write
                    capability in all nodes in a cluster so
                    consistency is not guareented). Please correct
                    me if I am wrong. One other way could be to let
                    riak generate key and I use timestamp as a
                    secondary index. But this seems to be a bad
                    design. Also, what would be the best way
                    to achieve pagination for this use case?


                You could use redis for incremental id's.


                Sergej


                _______________________________________________
                riak-users mailing list
                riak-users@lists.basho.com  &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
                
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">


                _______________________________________________
                riak-users mailing list
                riak-users@lists.basho.com
                &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
                
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>





            _______________________________________________
            riak-users mailing list
            riak-users@lists.basho.com
            &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
            <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



        _______________________________________________
        riak-users mailing list
        riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
        <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>




</pre><tt>    -- 
</tt><tt>    *Muzaaya Joshua
</tt><pre style="margin: 0em;">
    Systems Engineer
    +256774115170 &lt;tel:%2B256774115170&gt;*
    *&quot;Through it all, i have learned to trust in Jesus. To depend
    upon His Word&quot;
    *





    _______________________________________________
    riak-users mailing list
    riak-users@lists.basho.com  &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
    <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">


    _______________________________________________
    riak-users mailing list
    riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
    <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



</pre></blockquote><pre style="margin: 0em;">

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09018.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09019">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09019">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09032.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08991.html">Logging chat messages</a></span> <span class="sender italic">Shashwat Srivastava</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08992.html">Re: Logging chat messages</a></span> <span class="sender italic">Rapsey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08993.html">Re: Logging chat messages</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09010.html">Re: Logging chat messages</a></span> <span class="sender italic">Shashwat Srivastava</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09011.html">Re: Logging chat messages</a></span> <span class="sender italic">Rapsey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09013.html">Re: Logging chat messages</a></span> <span class="sender italic">Joshua Muzaaya</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09014.html">Re: Logging chat messages</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09018.html">Re: Logging chat message...</a></span> <span class="sender italic">Shashwat Srivastava</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Logging chat message...</span> <span class="sender italic">Guido Medina</span></li>
<li class="icons-email"><span class="subject"><a href="msg09032.html">Re: Logging chat message...</a></span> <span class="sender italic">Shashwat Srivastava</span></li>
<li class="icons-email"><span class="subject"><a href="msg09020.html">Re: Logging chat message...</a></span> <span class="sender italic">Joshua Muzaaya</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg09016.html">Re: Logging chat messages</a></span> <span class="sender italic">Shashwat Srivastava</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg09015.html">Re: Logging chat messages</a></span> <span class="sender italic">Shashwat Srivastava</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg09009.html">Re: Logging chat messages</a></span> <span class="sender italic">Shashwat Srivastava</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Logging chat messages">
<input type="hidden" name="msgid" value="50867909.9060201@temetra.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09019.html">
<input type="submit" value=" Guido Medina ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Logging+chat+messages%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09018.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09032.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">50867909.9060201@temetra.com</li>
</ul>
</div>
</body>
</html>
