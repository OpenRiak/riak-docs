<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Python Client Protocol Buffers Error</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05380" id="c">
<link rel="index" href="maillist.html#05380" id="i">
<link rel="prev" href="msg05372.html" id="p">
<link rel="next" href="msg05383.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05380.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Python+Client+Protocol+Buffers+Error%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Python Client Protocol Buffers Error</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jim+Adler%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jim Adler</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111030" rel="nofollow">Sun, 30 Oct 2011 10:22:25 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Attached is the app.config and here's the code snippet:

import riak</pre><pre>

client = riak.RiakClient(host='xxx.xxx.xxx.xxx', port=8087,
transport_class=riak.RiakPbcTransport)

query = riak.RiakMapReduce(client).add('nodes')

query.add_key_filters(riak.key_filter.tokenize('-', 2) +
riak.key_filter.starts_with('jim'))

query.map('''

    function(v) {

        return [[v.key]];

    }''')

for result in query.run(timeout=6000000):

    print '%s' % (result)


Thanks!

Jim

From:  Reid Draper &lt;reiddra...@gmail.com&gt;
Date:  Sat, 29 Oct 2011 16:13:03 -0400
To:  Jim Adler &lt;jim.ad...@comcast.net&gt;
Cc:  &quot;riak-users@lists.basho.com&quot; &lt;riak-users@lists.basho.com&gt;
Subject:  Re: Python Client Protocol Buffers Error

Do you have some code that you can send to reproduce the issue? Would you
mind sending your app.config as well?

On Sat, Oct 29, 2011 at 3:58 PM, Jim Adler &lt;jim.ad...@comcast.net&gt; wrote:
&gt; Ried, 
&gt; 
&gt; Riak 1.0.1 from package, Ubuntu 11.04
&gt; 
&gt; Jim
&gt; 
&gt; From:  Reid Draper &lt;reiddra...@gmail.com&gt;
&gt; Date:  Sat, 29 Oct 2011 13:47:02 -0400
&gt; To:  Jim Adler &lt;jim.ad...@comcast.net&gt;
&gt; Cc:  &quot;riak-users@lists.basho.com&quot; &lt;riak-users@lists.basho.com&gt;
&gt; Subject:  Re: Python Client Protocol Buffers Error
&gt; 
&gt; Jim,
&gt; 
&gt; What version of Riak are you using? Are you using a package or did you build
&gt; from source? If you built from source, what version of Erlang are you using?
&gt; 
&gt; Reid
&gt; 
&gt; On Sat, Oct 29, 2011 at 1:38 PM, Jim Adler &lt;jim.ad...@comcast.net&gt; wrote:
&gt;&gt; I'm consistently seeing a key filter query fail with protocol buffers that
&gt;&gt; works fine with http.  I've seen similar problems reported
&gt;&gt; (<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-April/004">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-April/004</a>
&gt;&gt; 002.html 
&gt;&gt; &lt;<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-April/00400">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-April/00400</a>
&gt;&gt; 2.html&gt; ,
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/00">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/00</a>
&gt;&gt; 6056.html 
&gt;&gt; &lt;<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/006">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/006</a>
&gt;&gt; 056.html&gt; ,
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-January/00">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-January/00</a>
&gt;&gt; 3015.html 
&gt;&gt; &lt;<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-January/003">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-January/003</a>
&gt;&gt; 015.html&gt; ). I am using the latest python client 1.3.0 which should have
&gt;&gt; fixed some of the earlier reported problems.
&gt;&gt; 
&gt;&gt; Any ideas?
&gt;&gt; 
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; Here's the stack trace:
&gt;&gt; 
&gt;&gt; 2011-10-29 10:32:03 ERROR __main__,545 'Socket returned short packet
&gt;&gt; length \x00\x00\x00 - expected 4' Traceback (most recent call last):
&gt;&gt;   File
&gt;&gt; &quot;/Users/jadler/projects/dg/usr/jadler/projects/score/twitter/twitter_crawl.
&gt;&gt; py&quot;, line 270, in main for result in query.run(timeout=6000000):
&gt;&gt;   File
&gt;&gt; &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/mapreduce.py&quot;, line 211, in run result = t.mapred(self._inputs,
&gt;&gt; query, timeout)
&gt;&gt;   File
&gt;&gt; &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/transports/pbc.py&quot;, line 311, in mapred msg_code, resp =
&gt;&gt; self.recv_msg()
&gt;&gt;   File
&gt;&gt; &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/transports/pbc.py&quot;, line 365, in recv_msg self.recv_pkt()
&gt;&gt;   File
&gt;&gt; &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packa
&gt;&gt; ges/riak/transports/pbc.py&quot;, line 410, in recv_pkt format(nmsglen))
&gt;&gt; RiakError: 'Socket returned short packet length \x00\x00\x00 - expected 4'
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 



</pre>
<p><strong><a href="msg05380/app.config" ><img src="../attachment.png" alt="Attachment:" width=27 height=28></a>
<a href="msg05380/app.config" >app.config</a></strong><br>
<em>Description:</em> Binary data</p>
<pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05372.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05380">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05380">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05383.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05370.html">Re: atomically updating multiple keys</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05373.html">Re: atomically updating multiple keys</a></span> <span class="sender italic">Justin Karneges</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05377.html">Re: atomically updating multiple k...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg05378.html">Re: atomically updating multiple k...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li class="icons-email"><span class="subject"><a href="msg05379.html">Re: atomically updating multiple k...</a></span> <span class="sender italic">Aphyr</span></li>
<li class="icons-email"><span class="subject"><a href="msg05381.html">Re: atomically updating multiple k...</a></span> <span class="sender italic">Justin Karneges</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05367.html">Python Client Protocol Buffers Error</a></span> <span class="sender italic">Jim Adler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05369.html">Re: Python Client Protocol Buffers Error</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05371.html">Re: Python Client Protocol Buffers Error</a></span> <span class="sender italic">Jim Adler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05372.html">Re: Python Client Protocol Buffers Erro...</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Python Client Protocol Buffers...</span> <span class="sender italic">Jim Adler</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05383.html">Re: atomically updating multiple keys</a></span> <span class="sender italic">Paul R</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Python Client Protocol Buffers Error">
<input type="hidden" name="msgid" value="CAD2D3FD.20F39%jim.adler@comcast.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05380.html">
<input type="submit" value=" Jim Adler ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Python+Client+Protocol+Buffers+Error%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05372.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05383.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAD2D3FD.20F39%jim.adler@comcast.net</li>
</ul>
</div>
</body>
</html>
