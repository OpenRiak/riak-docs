<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Do not expose Riak to the Internet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05213" id="c">
<link rel="index" href="maillist.html#05213" id="i">
<link rel="prev" href="msg05207.html" id="p">
<link rel="next" href="msg05215.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05213.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Do+not+expose+Riak+to+the+Internet%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Do not expose Riak to the Internet</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Aphyr%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Aphyr</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111020" rel="nofollow">Thu, 20 Oct 2011 10:27:34 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 10/20/2011 08:42 AM, Jonathan Langevin wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Don't the other KVs implement M/R as well? If so, how is it they
don't have a similar exploit? Is this issue due specifically to
Basho's usage of Erlang for processing M/R?</pre><pre>

Is it possible to circumvent this type of exploit by running Erlang
&amp; Riak as unprivileged users?

Seems sandboxing may be needed for all nodes to ensure server
integrity. If someone made it into a node somehow (regardless of
public availability), it's still quite a concern that they could then
exploit Riak to gain root access.
</pre></blockquote><pre style="margin: 0em;">

I've actually been looking into this. MongoDB, for instance, exposes a
delightful javascript shell with a version of Spidermonkey (and, it
appears, V8 and Java! Even *more* surface area!) which could be
susceptible to arbitrary-code-execution attacks. There are some
interestingly named functions in their JS context, like &quot;nativeHelper&quot;,
and a few undocumented server control functions, but without any real
comments in their source tree I'm finding it hard to follow.

I *do* know that multitenant mongo is vulnerable to trivial
denial-of-service vulnerabilities, thanks to a global write lock and
gleefully executing javascript everywhere. While we're talking DoS, it's
worth mentioning that if you can convince a sufficiently large riak
cluster to list-keys, it *will* go down.*

As for privileges; Basho's debian packages set up Riak as an
unprivileged user, and I presume most sysadmins are doing something
similar. In most cases, having full access to db data files is scary
enough to warrant caution. It doesn't stop there, however.

After exploiting the javascript VM one could inject an executable onto
the system; some small payload designed to get an interactive shell or
execute code from a remote server. There are many ways to escalate
privileges under linux--some direct (e.g.
<a  rel="nofollow" href="http://www.exploit-db.com/exploits/15704/">http://www.exploit-db.com/exploits/15704/</a>), some relying on other
services. From there, install a rootkit and proceed to neighboring boxes.

There are some easy ways to mitigate the damage caused by taking control
of the riak process; running riak in a chroot jail, for instance, and
aggressively tracking security patches for your operating system. You
can also disable erlang mapreduce and restrict the functions exported to
the javascript context... but these are deterrents, not failsafes.**

The answer is not to ban mapreduce (or distributed code execution of any
kind). The answer is to avoid running code from people in dark alleys on
a system you care about.*** :)

--Kyle

* <a  rel="nofollow" href="http://twitter.com/#!/aphyr/status/124275497042591746/photo/1/large">http://twitter.com/#!/aphyr/status/124275497042591746/photo/1/large</a>

** e.g. <a  rel="nofollow" href="http://www.cvedetails.com/cve/CVE-2011-2998/">http://www.cvedetails.com/cve/CVE-2011-2998/</a>. They won't show
you the bugzilla page unless you're on the sec team, so you *know* it's
juicy. :)

*** The best mapreduce system I can think of would be one with provable
execution consequences. Perhaps something like GHC (the haskell
compiler) could verify that one's mapreduce phases are purely
functional--or control which side-effect functions were exposed in
various contexts. Combine that with a memory/cpu/time budget for each
function.

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05207.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05213">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05213">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05215.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05195.html">Do not expose Riak to the Internet</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05196.html">Re: Do not expose Riak to the Internet</a></span> <span class="sender italic">Paul Fisher</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05197.html">Re: Do not expose Riak to the Internet</a></span> <span class="sender italic">Nate Lawson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05199.html">Re: Do not expose Riak to the Internet</a></span> <span class="sender italic">Aphyr</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05198.html">Re: Do not expose Riak to the Internet</a></span> <span class="sender italic">Eric Redmond</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05207.html">Re: Do not expose Riak to the Internet</a></span> <span class="sender italic">Jonathan Langevin</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Do not expose Riak to the Internet</span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05215.html">Re: Do not expose Riak to the Inte...</a></span> <span class="sender italic">Andy Skelton</span></li>
<li class="icons-email"><span class="subject"><a href="msg05217.html">Re: Do not expose Riak to the Inte...</a></span> <span class="sender italic">David Smith</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Do not expose Riak to the Internet">
<input type="hidden" name="msgid" value="4EA05A00.8010405@aphyr.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05213.html">
<input type="submit" value=" Aphyr ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Do+not+expose+Riak+to+the+Internet%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05207.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05215.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4EA05A00.8010405@aphyr.com</li>
</ul>
</div>
</body>
</html>
