<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Java client - conflict resolver on both fetch() and store()?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd12.html#11970" id="c">
<link rel="index" href="mail12.html#11970" id="i">
<link rel="prev" href="msg11968.html" id="p">
<link rel="next" href="msg11972.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11970.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+%5C-+conflict+resolver+on+both+fetch%5C%28%5C%29+and+store%5C%28%5C%29%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Java client - conflict resolver on both fetch() and store()?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brian+Roach%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brian Roach</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130811" rel="nofollow">Sun, 11 Aug 2013 14:07:47 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I think this has somewhat hijacked the original poster's question, but ...

doNotFetch() was never meant to be used with a Mutation or
returnBody(). It was an option added due to the aforementioned
specific feature requests.</pre><pre>

The reason it exists is for this workflow and this workflow alone:

1) Fetch something from Riak, resolving any conflicts.
2) Do something with that data and change (mutate) the value / metadata
3) Store the changes back to Riak without specifying a Mutation or
ConflictResolver and avoiding the fetch.

It is assumed that any siblings created are dealt with in a subsequent
fetch using this workflow.

The most basic example:

IRiakObject ro = bucket.fetch(&quot;foo&quot;).execute();
ro.setValue(&quot;Some new value&quot;);
bucket.store(ro).withoutFetch().execute();

The DeafultBucket.store() in that case sets up the StoreObject to use
the PassThroughConverter and the ClobberMutation that simply returns
the passed in IRiakObject.

The Javadoc for doNotFetch() is very specific about what happens with
the Mutation:

* 1) &lt;code&gt;null&lt;/code&gt; will be passed to the {@link Mutation} object (if
*    you are using the default {@link ClobberMutation} this is fine).

That said, using a Mutation other than ClobberMutation with
doNotFetch() really makes little sense. The option was added for
people who have already fetched and mutated their data.

- Roach

On Sun, Aug 11, 2013 at 1:54 PM, Guido Medina &lt;guido.med...@temetra.com&gt; wrote:
&gt; I hate it too but my point still stands, if DO NOT FETCH, what's the target
&gt; object the mutation should work with? Isn't it the passed object instead?
&gt;
&gt; Anyway, I sent a pull request which hopefully applies a better semantics:
&gt; <a  rel="nofollow" href="https://github.com/basho/riak-java-client/pull/271">https://github.com/basho/riak-java-client/pull/271</a>
&gt;
&gt; Thanks,
&gt;
&gt; Guido.
&gt;
&gt;
&gt; On 11/08/13 20:45, YN wrote:
&gt;
&gt; Guido,
&gt;
&gt; In this case it appears that fetching is enabled i.e. if (!doNotFetch) i.e.
&gt; if NOT doNotFetch... so basically doNotFetch = false (fetching is true /
&gt; enabled).
&gt;
&gt; I hate the double negative cases since it's easy to get confused / miss the
&gt; logic that was intended.
&gt; YN shared this with you.
&gt; Re: Java client - conflict resolver on both fetch() and store()?
&gt; Via gmane.comp.db.riak.user
&gt;
&gt; Brian,
&gt;
&gt; In StoreObject's execute() method, this condition, is it a bug or intended?
&gt;
&gt;          ...
&gt;          ...
&gt;          if (!doNotFetch) {
&gt;              resolved = fetchObject.execute();
&gt;              vclock = fetchObject.getVClock();
&gt;          }
&gt;          ...
&gt;          ...
&gt;
&gt; My reasoning is: if do not fetch then shouldn't the resolved object be
&gt; the one passed? I'm doing some tests and if I do store a mutation
&gt; returning the body without fetching, I get a new mutated object and not
&gt; the one I passed + mutation. So I'm wondering if that was the original
&gt; intention.
&gt;
&gt; Thanks,
&gt;
&gt; Guido.
&gt;
&gt; On 11/08/13 18:49, Guido Medina wrote:
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users&lt; at &gt;lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt; Sent from InoReader
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11968.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd12.html#11970">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail12.html#11970">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11972.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11957.html">Re: Java client - conflict resolver on both fetch() and ...</a></span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11960.html">Re: Java client - conflict resolver on both fetch() ...</a></span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11961.html">Re: Java client - conflict resolver on both fetc...</a></span> <span class="sender italic">Matt Painter</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11962.html">Re: Java client - conflict resolver on both fetch() and ...</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11963.html">Re: Java client - conflict resolver on both fetch() ...</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11964.html">Re: Java client - conflict resolver on both fetc...</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11965.html">Re: Java client - conflict resolver on both ...</a></span> <span class="sender italic">Guido Medina</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11975.html">Re: Java client - conflict resolver on both fetc...</a></span> <span class="sender italic">Matt Painter</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11967.html">Re: Java client - conflict resolver on both fetch() and store...</a></span> <span class="sender italic">YN</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11968.html">Re: Java client - conflict resolver on both fetch() and ...</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Java client - conflict resolver on both fetch() ...</span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11972.html">Java client - without fetch and mutation?</a></span> <span class="sender italic">Guido Medina</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Java client - conflict resolver on both fetch() and store()?">
<input type="hidden" name="msgid" value="CAM+FMBvmk0NK3VG8JxA+tna4=3xQ+pE_0AS82Uz2oWRzkmbz-A@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11970.html">
<input type="submit" value=" Brian Roach ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+%5C-+conflict+resolver+on+both+fetch%5C%28%5C%29+and+store%5C%28%5C%29%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11968.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11972.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAM+FMBvmk0NK3VG8JxA+tna4=3xQ+pE_0AS82Uz2oWRzkmbz-A@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
