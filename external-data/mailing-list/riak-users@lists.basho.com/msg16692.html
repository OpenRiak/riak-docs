<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: counter crdt in riak</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd8.html#16692" id="c">
<link rel="index" href="mail8.html#16692" id="i">
<link rel="prev" href="msg16689.html" id="p">
<link rel="next" href="msg16685.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16692.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+counter+crdt+in+riak%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: counter crdt in riak</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22David+Byron%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">David Byron</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20151021" rel="nofollow">Wed, 21 Oct 2015 09:46:21 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Whoops...didn't mean to drop the mailing list off the recipient list.</pre><pre>

Pull request here: <a  rel="nofollow" href="https://github.com/basho/basho_docs/pull/1865">https://github.com/basho/basho_docs/pull/1865</a>.

-DB

On 10/21/15 7:52 AM, David Byron wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">


On 10/20/15 11:56 PM, Russell Brown wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

On 21 Oct 2015, at 04:56, David Byron &lt;dby...@dbyron.com&gt; wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Apologies if this is basic question, or one that's already been
answered.  I've done a fair amount of digging (e.g.
<a  rel="nofollow" href="http://thread.gmane.org/gmane.comp.db.riak.user/12808/focus=12816">http://thread.gmane.org/gmane.comp.db.riak.user/12808/focus=12816</a>),
but I'm still confused about the documentation regarding conflict
resolution for riak's crdt counter.  Specifically this:
<a  rel="nofollow" href="https://github.com/basho/basho_docs/blame/riak/2.1.1/source/languages/en/riak/theory/concepts/crdts.md#L238">https://github.com/basho/basho_docs/blame/riak/2.1.1/source/languages/en/riak/theory/concepts/crdts.md#L238</a>
(using the blame view to get a line number reference in markdown),
which says:

&quot;Counters | Each actor keeps an independent count for increments and
decrements; upon merge, the pairwise maximum of the counts for each
actor will win (e.g. if one count for an actor holds 172 and the
other holds 173, 173 will win upon merge)&quot;

This makes it sound to me like an increment from one of the actors
gets dropped.  Fingers crossed this isn't actually what happens.
</pre></blockquote><pre style="margin: 0em;">

How so? I guess the implicit information missing from the statement is
that each actor is unique, and acts serially. “An independent count
for increments and decrements” means two integers, one for increments,
one for decrements.
</pre></blockquote><pre style="margin: 0em;">

The notion of something winning (and therefore also something losing) is
I think the thing that confuses me.  The way I think of it, everybody
wins.  It's almost like there aren't any conflicts to resolve.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I think this is saying the same thing that the cdrt paper (section
3.1.2 State-based increment-only Counter (G-Counter) of
<a  rel="nofollow" href="https://hal.inria.fr/file/index/docid/555588/filename/techreport.pdf">https://hal.inria.fr/file/index/docid/555588/filename/techreport.pdf</a>)
says -- that increments that happen during a partition eventually
resolve correctly.  I could use a more step-by-step illustration
though -- pairwise maximum of the counts for each actor is a little
dense.
</pre></blockquote><pre style="margin: 0em;">

Imagine the counter as a vector of triples, {ActorName, Increment
Count, Decrement Count}
Imagine 2 nodes A, C as replicas. A increments it’s counter by 1 so
the data looks like [{A, 1, 0}]
C decrements it’s counter, so it’s data is [{C, 0, 1}]
A sends it’s counter to C so C performs a Merge. It looks at each
entry in the vector, and for each entry takes the maximum Increment
and maximum Decrement and keeps them. If an Actor is not present in
some vector, it’s counters are considered zero. That is the “pairwise
maximum.” For any pair of vectors, take the maximum integers for any
pair of entries (i.e. {A, 1, 0} compared to {A, 0, 0} = {A, max(1, 0),
max(0, 0})
So now C has [{A, 1, 0}, {C, 0, 1}]
Now C does an increment [{A, 1, 0}, {C, 1, 1}] and sends it’s counter
to A
A increments it’s counter by 1 [{A, 2, 0}] then decrements it by 1
[{A, 2, 1}]
C sends it’s counter to A and the merge results in [{A, 2, 1}, {C, 1, 1}]

Any actor will _always_ have the maximum values for their own entries.
</pre></blockquote><pre style="margin: 0em;">

Thanks for the detailed explanation.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Apologies for ugly formatting, but an example like this would make
more sense to me.

- actor a increments counter
  a {a: 1}                   b {}

- actor b increments counter
  a {a: 1}                   b {b: 1}

- a merges b's info
  a {a: 1, b: 1}             b {b: 1}

- b merges a's info
  a:{a: 1, b: 1}             b {a: 1, b: 1}

so eventually this all resolves such that a and b both increment the
counter by 2, right?  Is this how riak's crdt counter works?  If so
I'll breathe a sigh of relief and make a pull request against the
docs if you like.
</pre></blockquote><pre style="margin: 0em;">

Yes that’s how they work, but there are two integers per actor, one
for increments and one for decrements. Please do make your pull request.
</pre></blockquote><pre style="margin: 0em;">

Will do.

-DB
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16689.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd8.html#16692">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail8.html#16692">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16685.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16684.html">counter crdt in riak</a></span> <span class="sender italic">David Byron</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16689.html">Re: counter crdt in riak</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: counter crdt in riak</span> <span class="sender italic">David Byron</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg16685.html">Re: counter crdt in riak</a></span> <span class="sender italic">xiaclo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16688.html">Re: counter crdt in riak</a></span> <span class="sender italic">David Byron</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: counter crdt in riak">
<input type="hidden" name="msgid" value="5627C0D8.6090700@dbyron.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16692.html">
<input type="submit" value=" David Byron ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+counter+crdt+in+riak%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16689.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16685.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5627C0D8.6090700@dbyron.com</li>
</ul>
</div>
</body>
</html>
