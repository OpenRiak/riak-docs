<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak database fails after a short period</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd15.html#11419" id="c">
<link rel="index" href="mail14.html#11419" id="i">
<link rel="prev" href="msg11349.html" id="p">
<link rel="next" href="msg11354.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11419.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+database+fails+after+a+short+period%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak database fails after a short period</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mark+Phillips%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mark Phillips</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130708" rel="nofollow">Mon, 08 Jul 2013 13:31:37 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Kirill,

Based on a *very* quick read of this email, I think the issue here is
that your VM is too small. Riak needs a certain amount of memory to
run and 1GB of RAM probably isn't going to cut it. If it's possible,
grab three new VMs with at least 8GB of RAM and spread your cluster
over those machines.</pre><pre>

Hope that helps.

Mark

On Thu, Jun 27, 2013 at 12:35 PM, Kirill K. &lt;kirill.mai...@gmail.com&gt; wrote:
&gt; Hi,
&gt;
&gt; I created a simple erlang application which periodically collects required
&gt; data and puts it in a riak database.
&gt;
&gt; As I start my application it runs smoothly.. but after a period of time it
&gt; stucks as PUT requests to riak database becomes too slow.. It is logs from
&gt; my app:
&gt;
&gt; 2013-06-26 12:44:09.090 [info] &lt;0.60.0&gt; data processed in [16476 ms]
&gt; 2013-06-26 12:45:51.472 [info] &lt;0.60.0&gt; data processed in [18793 ms]
&gt; ...
&gt; 2013-06-26 12:57:28.138 [info] &lt;0.60.0&gt; data processed in [15135 ms]
&gt; 2013-06-26 13:07:01.484 [info] &lt;0.60.0&gt; data processed in [488420 ms]
&gt; 2013-06-26 14:03:11.561 [info] &lt;0.60.0&gt; data processed in [3370075 ms]
&gt;
&gt; In riak crash logs I can see a lot of messages like
&gt;
&gt; 2013-06-26 17:06:20 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak_kv_index_hashtree:init/1
&gt; pid: &lt;0.13660.7&gt;
&gt; registered_name: []
&gt; exception exit: {{{badmatch,{error,{db_open,&quot;IO error: ./data/anti_entropy/
&gt;     433883298582611803841718934712646521460354973696/MANIFEST-000004:
&gt;     Cannot allocate memory&quot;}}}, [{hashtree,new_segment_store,2,
&gt;     [{file,&quot;src/hashtree.erl&quot;},{line,499}]},
&gt;     {hashtree,new,2,[{file,&quot;src/hashtree.erl&quot;},{line,215}]},
&gt;     {riak_kv_index_hashtree,do_new_tree,2,
&gt;     [{file,&quot;src/riak_kv_index_hashtree.erl&quot;},
&gt;     {line,426}]},{lists,foldl,3,[{file,&quot;lists.erl&quot;},
&gt;     {line,1197}]},{riak_kv_index_hashtree,
&gt;     init_trees,2,[{file,&quot;src/riak_kv_index_hashtree.erl&quot;},
&gt;     {line,368}]},{riak_kv_index_hashtree,init,1,
&gt;     [{file,&quot;src/riak_kv_index_hashtree.erl&quot;},
&gt;
&gt; {line,225}]},{gen_server,init_it,6,[{file,&quot;gen_server.erl&quot;},{line,304}]},
&gt;     {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]},
&gt;     [{gen_server,init_it,6,[{file,&quot;gen_server.erl&quot;},{line,328}]},
&gt;     {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}
&gt; ancestors: [&lt;0.955.0&gt;,riak_core_vnode_sup,riak_core_sup,&lt;0.129.0&gt;]
&gt; messages: []
&gt; links: []
&gt; dictionary: []
&gt; trap_exit: false
&gt; status: running
&gt; heap_size: 1597
&gt; stack_size: 24
&gt; reductions: 593
&gt; neighbours:
&gt;
&gt; I can see the same behavior on Amazon AWS and local virtual machine. my VM's
&gt; are quite small 512-1024 mb.. AWS is Micro, so it has the same amount of
&gt; memory.
&gt;
&gt; There are no cluster currently. Just single node with riak and my app
&gt; running on it.
&gt;
&gt; I've checked riak documentation and basic things they recommend to do is to
&gt; increase ulimit and to update sysctl. So, my server ulimit shows: ulimit -n
&gt; 65536 AND sysctl updated as recommended.
&gt;
&gt; I've tried bitcask and eleveldb, but result is the same.
&gt;
&gt; Currently, I can't figure out what is broken and why riak Cannot allocate
&gt; memory..
&gt;
&gt; Thanks.
&gt;
&gt;
&gt; Kirill
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11349.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd15.html#11419">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail14.html#11419">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11354.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11349.html">Riak database fails after a short period</a></span> <span class="sender italic">Kirill K.</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak database fails after a short period</span> <span class="sender italic">Mark Phillips</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak database fails after a short period">
<input type="hidden" name="msgid" value="CAE8zJQFH4Q0hpA519HUMiyqVuO3yRzAjwcDxOg7n+D2eL9C5Bw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11419.html">
<input type="submit" value=" Mark Phillips ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+database+fails+after+a+short+period%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11349.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11354.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAE8zJQFH4Q0hpA519HUMiyqVuO3yRzAjwcDxOg7n+D2eL9C5Bw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
