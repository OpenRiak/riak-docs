<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Socket closed during write?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09784" id="c">
<link rel="index" href="maillist.html#09784" id="i">
<link rel="prev" href="msg09781.html" id="p">
<link rel="next" href="msg09789.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09784.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Socket+closed+during+write%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Socket closed during write?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brad+Heller%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brad Heller</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130110" rel="nofollow">Thu, 10 Jan 2013 01:29:11 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I'm using regular ol' ruby-riak client to write to the bucket. It's all pretty 
much out of the box. There is an ELB in front of the ring with SSL on the ELB 
and on passed through to the ring, if that's significant.</pre><pre>

Nothing special that I can identify. I can attempt to instrument our code 
further...

On Jan 9, 2013, at 10:05 PM, Evan Vigil-McClanahan &lt;emcclana...@basho.com&gt; 
wrote:

&gt; The last time I saw this particular error it was someone on a 64bit
&gt; client setting the content length value incorrectly via libcurl.
&gt; Requests would work on 64 bit nodes but fail on 32 bit nodes,
&gt; presumably because the HTTP client was handing the socket a garbage
&gt; value to read, thereby killing it.
&gt; 
&gt; Timeouts will generally return a different error.  You might be
&gt; looking at some TCP or HTTP issue.  How are you connecting?  Is there
&gt; anything special about the requests that are failing?
&gt; 
&gt; On Wed, Jan 9, 2013 at 7:29 PM, Brad Heller &lt;b...@cloudability.com&gt; wrote:
&gt;&gt; Hey all,
&gt;&gt; 
&gt;&gt; I've got a mysterious error with Riak. Certain writes seem to result in an
&gt;&gt; interesting error being raised by the coordinating node (rem, I'm assuming
&gt;&gt; it's the coordinating node):
&gt;&gt; 
&gt;&gt; webmachine error: path=&quot;/buckets/my_bucket/keys&quot;
&gt;&gt; {error,{error,{badmatch,{error,closed}},
&gt;&gt; [{webmachine_request,recv_unchunked_body,4,[{file,&quot;src/webmachine_request.erl&quot;},{line,418}]},
&gt;&gt; {webmachine_request,do_recv_body,2,[{file,&quot;src/webmachine_request.erl&quot;},{line,377}]},
&gt;&gt; {webmachine_request,call,2,[{file,&quot;src/webmachine_request.erl&quot;},{line,149}]},
&gt;&gt; {wrq,req_body,1,[{file,&quot;src/wrq.erl&quot;},{line,112}]},
&gt;&gt; {riak_kv_wm_object,accept_doc_body,2,[{file,&quot;src/riak_kv_wm_object.erl&quot;},{line,595}]},
&gt;&gt; {webmachine_resource,resource_call,3,[{file,&quot;src/webmachine_resource.erl&quot;},{line,169}]},
&gt;&gt; {webmachine_resource,do,3,[{file,&quot;src/webmachine_resource.erl&quot;},{line,128}]},
&gt;&gt; {webmachine_decision_core,resource_call,1,[{file,&quot;src/webmachine_decision_core.erl&quot;},{line,48}]}]}
&gt;&gt; 
&gt;&gt; Web machine returns a 500 error when this happens. I saw online that this
&gt;&gt; could be the result of a socket being closed out from under the connection
&gt;&gt; [1]. Any idea how I can get to the bottom of this? Due to the nature of the
&gt;&gt; reproduction steps, I don't have access to the payload causing the crash
&gt;&gt; 'till it's actually *in* Riak. Someone in #riak on IRC suggested that this
&gt;&gt; could be the result of write timeouts. Ideas?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Brad Heller
&gt;&gt; 
&gt;&gt; 1:
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/006078.html">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/006078.html</a>
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; 


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09781.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09784">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09784">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09789.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09780.html">Socket closed during write?</a></span> <span class="sender italic">Brad Heller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09781.html">Re: Socket closed during write?</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Socket closed during write?</span> <span class="sender italic">Brad Heller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09789.html">Re: Socket closed during write?</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09790.html">Re: Socket closed during write?</a></span> <span class="sender italic">Brad Heller</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Socket closed during write?">
<input type="hidden" name="msgid" value="2D76650B-CCC1-4834-9DA5-81F08F18F142@cloudability.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09784.html">
<input type="submit" value=" Brad Heller ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Socket+closed+during+write%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09781.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09789.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">2D76650B-CCC1-4834-9DA5-81F08F18F142@cloudability.com</li>
</ul>
</div>
</body>
</html>
