<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: Fastest way to count number of items in Secondary Index query</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06421" id="c">
<link rel="index" href="maillist.html#06421" id="i">
<link rel="prev" href="msg06420.html" id="p">
<link rel="next" href="msg06429.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06421.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Fastest+way+to+count+number+of+items+in+Secondary+Index+query%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: Fastest way to count number of items in Secondary Index query</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremy+Raymond%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremy Raymond</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120125" rel="nofollow">Wed, 25 Jan 2012 17:12:59 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Iâ€™m using the Erlang PB interface in my application. The Erlang client gets the 
keys via this Input/Query in riakc_pb_socket:get_index/4 at 
<a  rel="nofollow" href="https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L677">https://github.com/basho/riak-erlang-client/blob/master/src/riakc_pb_socket.erl#L677</a></pre><pre>

 

    Input = {index, Bucket, Index, Key},

    IdentityQuery = [{reduce,

                      {modfun, riak_kv_mapreduce, reduce_identity},

                      [{reduce_phase_only_1, true}],

                      true}],

 

My queries can return hundreds of thousands of keys. Transferring all the keys 
to the client and then doing a length/1 on them is slower than feeding the 
index query directly into riak_kv_mapreduce:reduce_count_inputs/2 and returning 
only the sum. I thought there might be a shortcut to avoid mapred altogether. 
Does the http interface access to some internals not available to a PB client 
that avoids this mapreduce OR is the HTTP interface doing the same thing as the 
Erlang client and just doing an index query fed into reduce_identity?

 

--

Jeremy

 

From: Ian Plosker [<a  rel="nofollow" href="mailto:i...@basho.com">mailto:i...@basho.com</a>] 
Sent: Wednesday, January 25, 2012 5:55 PM
To: Jeremy Raymond
Cc: riak-users@lists.basho.com
Subject: Re: Fastest way to count number of items in Secondary Index query

 

Jeremy, 

 

Requests to 2i's HTTP interface will return keys rather the objects themselves. 
You may find better performance counting the returned keys rather than 
employing a M/R job.

 

-- 

Ian Plosker &lt;i...@basho.com&gt;

Developer Advocate

Basho Technologies

 

On Monday, January 23, 2012 at 2:27 PM, Jeremy Raymond wrote:

What is the fastest way to count the number of items in a secondary

index range query? I'm currently feeding an index input directly into

the riak_kv_mapreduce:reduce_count_inputs/2. Anything faster than

doing this? Anyway to query an index without loading the objects

themselves?

 

--

Jeremy

 

_______________________________________________

riak-users mailing list

riak-users@lists.basho.com

<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

 

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06420.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06421">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06421">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06429.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06374.html">Fastest way to count number of items in Secondary Index que...</a></span> <span class="sender italic">Jeremy Raymond</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06420.html">Re: Fastest way to count number of items in Secondary ...</a></span> <span class="sender italic">Ian Plosker</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: Fastest way to count number of items in Second...</span> <span class="sender italic">Jeremy Raymond</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06429.html">Re: Fastest way to count number of items in Secondary ...</a></span> <span class="sender italic">Elias Levy</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: Fastest way to count number of items in Secondary Index query">
<input type="hidden" name="msgid" value="092f01ccdbc7$9c5edfe0$d51c9fa0$@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06421.html">
<input type="submit" value=" Jeremy Raymond ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Fastest+way+to+count+number+of+items+in+Secondary+Index+query%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06420.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06429.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">092f01ccdbc7$9c5edfe0$d51c9fa0$@gmail.com</li>
</ul>
</div>
</body>
</html>
