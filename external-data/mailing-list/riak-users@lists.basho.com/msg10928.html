<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: "expected_binaries" error in search</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10928" id="c">
<link rel="index" href="maillist.html#10928" id="i">
<link rel="prev" href="msg10901.html" id="p">
<link rel="next" href="msg10929.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10928.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22expected_binaries%5C%22+error+in+search%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: "expected_binaries" error in search</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Rob+Speer%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Rob Speer</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130417" rel="nofollow">Wed, 17 Apr 2013 13:53:08 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I reproduced this at the command line. Here I'm storing two documents, with
IDs 'doc8' and 'doc9', into a search-enabled bucket named 'test-search'.</pre><pre>

# This command works, even though 'lsh' is empty. I believe this is because
I've never put a field named 'lsh' in this bucket, 'test-search'.
curl -v -XPUT -H &quot;Content-Type: application/json&quot; -d '{&quot;terms&quot;: &quot;empty|en
string|en test|en&quot;, &quot;lsh&quot;: &quot;&quot;, &quot;segments&quot;: &quot;d do doc docs&quot;}' '
<a  rel="nofollow" href="http://riak.lumi:8098/riak/test-search/doc8?returnbody=true">http://riak.lumi:8098/riak/test-search/doc8?returnbody=true</a>'

# However, if I use the empty string for a field that has ever been indexed
before, *then* I get a crash.
curl -v -XPUT -H &quot;Content-Type: application/json&quot; -d '{&quot;terms&quot;: &quot;&quot;,
&quot;segments&quot;: &quot;d do doc docs&quot;}' '
<a  rel="nofollow" href="http://riak.lumi:8098/riak/test-search/doc9?returnbody=true">http://riak.lumi:8098/riak/test-search/doc9?returnbody=true</a>'


As requested, I typed that redbug command into the Erlang console, and at
the moment of the crash I get some output. The output baffles me, though.
The included ID is in the style of ID we use for actual documents, which
are stored in totally different buckets, and which I didn't refer to at all
in my testing.

16:42:24 &lt;{mochiweb_acceptor,init,3}&gt; {riak_solr_xml_xform,xform,
                                       [&lt;&lt;&quot;&lt;?xml version=\&quot;1.0\&quot;
?&gt;&lt;delete&gt;&lt;id&gt;uuid-10f1a788ead64125bd7251ffc5308882&lt;/id&gt;&lt;/delete&gt;&quot;&gt;&gt;]}

16:42:24 &lt;{mochiweb_acceptor,init,3}&gt; {riak_solr_xml_xform,xform,1} -&gt; {ok,

delete,

[{&lt;&lt;&quot;id&quot;&gt;&gt;,

&lt;&lt;&quot;uuid-10f1a788ead64125bd7251ffc5308882&quot;&gt;&gt;}]}




On Tue, Apr 16, 2013 at 2:55 PM, Ryan Zezeski &lt;rzeze...@basho.com&gt; wrote:

&gt; Rob,
&gt;
&gt; I don't know what the exact data is. The thing is that it doesn't seem to
&gt;&gt; cause an error on the client side; it just shows up in the server logs to
&gt;&gt; be noticed later.
&gt;&gt;
&gt;
&gt; A non-2XX response will be returned.  Verify that the response is 200.  If
&gt; it isn't log an error in your app with the exact data passed.
&gt;
&gt;
&gt;&gt; I have a suspicion, though. Is it possible that when I set one of the
&gt;&gt; search fields to the empty string, some protocol along the way turns that
&gt;&gt; into the empty list, which then fails the type-check?
&gt;&gt;
&gt;
&gt; This is my initial suspicion as well.  If you can figure out the data
&gt; causing the issue then run that redbug line while inserting the data.  From
&gt; the output of that I should be able to figure out what is happening.
&gt;
&gt; -Z
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10901.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10928">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10928">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10929.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10804.html">&quot;expected_binaries&quot; error in search</a></span> <span class="sender italic">Rob Speer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10814.html">Re: &quot;expected_binaries&quot; error in search</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10854.html">Re: &quot;expected_binaries&quot; error in search</a></span> <span class="sender italic">Rob Speer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10901.html">Re: &quot;expected_binaries&quot; error in searc...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: &quot;expected_binaries&quot; error in s...</span> <span class="sender italic">Rob Speer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10929.html">Re: &quot;expected_binaries&quot; error...</a></span> <span class="sender italic">Rob Speer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10930.html">Re: &quot;expected_binaries&quot; e...</a></span> <span class="sender italic">Rob Speer</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10949.html">Re: &quot;expected_binaries&quot; error...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: &quot;expected_binaries&quot; error in search">
<input type="hidden" name="msgid" value="CABCiWCvm9RvO3ugmyOpezVtczScgmtzBvFyG+_c5uOV207v3nQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10928.html">
<input type="submit" value=" Rob Speer ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22expected_binaries%5C%22+error+in+search%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10901.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10929.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CABCiWCvm9RvO3ugmyOpezVtczScgmtzBvFyG+_c5uOV207v3nQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
