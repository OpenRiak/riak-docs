<!DOCTYPE html>
<html lang="en">
<head>
<title>Fwd: Riak Cannot allocate bytes of memory (of type "heap")</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16987" id="c">
<link rel="index" href="maillist.html#16987" id="i">
<link rel="prev" href="msg16986.html" id="p">
<link rel="next" href="msg16988.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16987.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Fwd%5C%3A+Riak+Cannot+allocate+bytes+of+memory+%5C%28of+type+%5C%22heap%5C%22%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Fwd: Riak Cannot allocate bytes of memory (of type "heap")</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Luke+Bakken%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Luke Bakken</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160125" rel="nofollow">Mon, 25 Jan 2016 11:54:07 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Byron -

I strongly suggest you monitor the number of siblings and object sizes
for your Riak objects. These sorts of allocation errors can often
caused by a very large object within your cluster.</pre><pre>

This page gives information about which statistics to monitor:
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/running/stats-and-monitoring/">http://docs.basho.com/riak/latest/ops/running/stats-and-monitoring/</a>

&gt; Are m3.large instances an issue for Riak?

It all depends on your use. Since you are running into these
allocation errors there is something up with how Riak is being used or
there just may not be enough resources available.

&gt; Can you let me know what we might expect if we disable Active Anti-Entropy - 
&gt; will that make our solr queries return stale data?

Not necessarily. I will point this email thread to others who can
speak better to this.

Thanks -

--
Luke Bakken
Engineer
lbak...@basho.com

On Mon, Jan 25, 2016 at 11:34 AM, Sakoulas, Byron
&lt;byronsakou...@catholichealth.net&gt; wrote:
&gt; Luke - thanks for replying.
&gt;
&gt; Are m3.large instances an issue for Riak? we were originally told those would 
&gt; be fine by Dimitri at basho.
&gt; We raised the solr RAM to GB after having issues with solr running out of 
&gt; memory.
&gt;
&gt; Can you let me know what we might expect if we disable Active Anti-Entropy - 
&gt; will that make our solr queries return stale data?
&gt;
&gt; On 1/25/16, 12:17 PM, &quot;Luke Bakken&quot; &lt;lbak...@basho.com&gt; wrote:
&gt;
&gt;&gt;Hello Byron -
&gt;&gt;
&gt;&gt;m3.large instances only support 7.5 GiB of RAM. You can see that Riak
&gt;&gt;crashed while attempting to allocate 2.12 GiB of RAM for leveldb.
&gt;&gt;
&gt;&gt;I suggest decreasing jvm (Solr) RAM back to the 1GiB setting that
&gt;&gt;ships with Riak. You can also experiment with disabling Active
&gt;&gt;Anti-Entropy to reduce memory usage. Hopefully someone with more
&gt;&gt;experience with Riak Search (Yokozuna) interaction with Active
&gt;&gt;Anti-Entropy will chime in on this thread.
&gt;&gt;
&gt;&gt;Or, increase the amount of RAM available to these VMs.
&gt;&gt;
&gt;&gt;Thanks
&gt;&gt;
&gt;&gt;--
&gt;&gt;Luke Bakken
&gt;&gt;Engineer
&gt;&gt;lbak...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt;On Mon, Jan 25, 2016 at 10:10 AM, Sakoulas, Byron
&gt;&gt;&lt;byronsakou...@catholichealth.net&gt; wrote:
&gt;&gt;&gt; We are running an 8 node cluster of riak at AWS, and our nodes are 
&gt;&gt;&gt; consistently crashing with the error - Cannot allocate x bytes of memory 
&gt;&gt;&gt; (of type &quot;heap‚Äù).
&gt;&gt;&gt;
&gt;&gt;&gt; Here are some of the specs for our env:
&gt;&gt;&gt;
&gt;&gt;&gt; 8 nodes - running on M3 Larges
&gt;&gt;&gt; Level DB with 50% allocated
&gt;&gt;&gt; Solr with 2Gig
&gt;&gt;&gt; We use only Immutable and CRDT data
&gt;&gt;&gt; We have a Custom search schema
&gt;&gt;&gt; System config matches basho recommendations
&gt;&gt;&gt; CentOs 7
&gt;&gt;&gt; Riak 2.0.2
&gt;&gt;&gt; Riak java client 2.0.0

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16986.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16987">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16987">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16988.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16986.html">Re: Riak Cannot allocate bytes of memory (of type &quot;heap&q...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Fwd: Riak Cannot allocate bytes of memory (of type &quot;...</span> <span class="sender italic">Luke Bakken</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Fwd: Riak Cannot allocate bytes of memory (of type &quot;heap&quot;)">
<input type="hidden" name="msgid" value="CAJJ0J9N=ooZeBZJ0tJfLpqjwHgEmCQ+0sARhg9FsnkznH34=3Q@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16987.html">
<input type="submit" value=" Luke Bakken ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Fwd%5C%3A+Riak+Cannot+allocate+bytes+of+memory+%5C%28of+type+%5C%22heap%5C%22%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16986.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16988.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAJJ0J9N=ooZeBZJ0tJfLpqjwHgEmCQ+0sARhg9FsnkznH34=3Q@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
