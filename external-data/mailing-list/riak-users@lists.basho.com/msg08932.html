<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: Is it possible to include node load into the consistency hashing	function in riak-core?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08932" id="c">
<link rel="index" href="maillist.html#08932" id="i">
<link rel="prev" href="msg08917.html" id="p">
<link rel="next" href="msg08847.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08932.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Is+it+possible+to+include+node+load+into+the+consistency+hashing%09function+in+riak%5C-core%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: Is it possible to include node load into the consistency hashing	function in riak-core?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Zhemzhitsky+Sergey%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Zhemzhitsky Sergey</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121016" rel="nofollow">Tue, 16 Oct 2012 05:37:36 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello Bryan,

Thanks a lot for the ideas! 
In case of any results, I will necessarily share them.</pre><pre>


Best Regards,
Sergey


-----Original Message-----
From: Bryan Fink [<a  rel="nofollow" href="mailto:br...@basho.com">mailto:br...@basho.com</a>] 
Sent: Monday, October 15, 2012 7:05 PM
To: Zhemzhitsky Sergey
Cc: riak-users
Subject: Re: Is it possible to include node load into the consistency hashing 
function in riak-core?

On Tue, Oct 9, 2012 at 11:59 AM, Zhemzhitsky Sergey 
&lt;sergey_zhemzhit...@sberbank-cib.ru&gt; wrote:
&gt; What Iâ€™d like to achieve is to have the preferred list be sorted based 
&gt; on the current load (maybe erlang:statistics(run_queue)) of the nodes.
&gt;
&gt; Is it possible to change the hashing function somehow so that the 
&gt; vnode on the node with the minimal load is returned as the first one?

Hi, Sergey. It would not be possible to change the hashing function to take 
load into account. That function must *always* produce the same hash for each 
key - that's the &quot;consistent&quot; part of consistent hashing. If it didn't do that, 
then a request for a key might go to a completely different vnode every time.

After the hash is computed and the preflist is generated, it would be possible 
to re-sort the first N vnodes in the preference list, as you describe. However, 
except for edge cases where the network is overloaded, I don't think it will 
buy you much. Riak KV sends all of those first N requests as fast as it can, 
and then starts waiting for responses from them. So, getting a response to the 
least-loaded vnode a few microseconds sooner is unlikely to change performance.

Although, that overloaded-network case could prove interesting and valuable, 
and regular benchmarking could just prove me wrong. Also, Pipe could almost 
certainly benefit from such a behavior, since its operations usually target one 
vnode at a time instead of N. That is to say, please share your results if you 
do try this!

Hope that helps,
Bryan

_______________________________________________________
CONFIDENTIALITY NOTICE: This email and any files attached to it may be conf 
idential. If you are not the intended recipient you are notified that using, 
copying, distributing or taking any action in reliance on the contents of this 
information is strictly prohibited. If you have received this email in error 
please notify the sender and delete this email. 
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08917.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08932">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08932">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08847.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08846.html">Is it possible to include node load into the consistenc...</a></span> <span class="sender italic">Zhemzhitsky Sergey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08917.html">Re: Is it possible to include node load into the c...</a></span> <span class="sender italic">Bryan Fink</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: Is it possible to include node load into t...</span> <span class="sender italic">Zhemzhitsky Sergey</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: Is it possible to include node load into the consistency hashing	function in riak-core?">
<input type="hidden" name="msgid" value="06139A918ACCA041BF46A0F36940C7FA4FE93BBA@exch-mbx2.msk.trd.ru">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08932.html">
<input type="submit" value=" Zhemzhitsky Sergey ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Is+it+possible+to+include+node+load+into+the+consistency+hashing%09function+in+riak%5C-core%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08917.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08847.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">06139A918ACCA041BF46A0F36940C7FA4FE93BBA@exch-mbx2.msk.trd.ru</li>
</ul>
</div>
</body>
</html>
