<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Search - searching across all fields</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09577" id="c">
<link rel="index" href="maillist.html#09577" id="i">
<link rel="prev" href="msg09520.html" id="p">
<link rel="next" href="msg09594.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09577.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+%5C-+searching+across+all+fields%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Search - searching across all fields</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121214" rel="nofollow">Fri, 14 Dec 2012 09:14:01 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Matt, comments inline
</pre><pre>

On Tue, Dec 11, 2012 at 3:35 AM, Matt Painter &lt;m...@deity.co.nz&gt; wrote:
&gt;
&gt;
&gt; Apart from a single default value, is it possible for Riak Search to
&gt; search for a keyword across all fields in a document without having to
&gt; specify the field up front as a prefix in one's search term?
&gt;

A field must be specified to search, but a default field may be specified
in the schema [1].  This field will be searched if one is not specified.
 But there is no way to do a search against all fields.  It is always over
one field.


&gt; I'm guessing that one solution could be a post-commit hook which
&gt; recursively iterates over all fields and squashes them into a secondary
&gt; default value field - but since I know even less about Erlang and am just
&gt; starting out with Riak, I thought it prudent to see if there was a more
&gt; straightforward solution...
&gt;

Your use case immediately makes me think of Solr copy fields.  You index
everything under their individual fields but all values get copied into a
catch-all field so that all content may be searched easily.  However, with
this you lose the ability to know which field it came from.  Riak Search
doesn't have copy field functionality.  You'd have to concatenate all the
data into a field on your application side.  The new search solution I've
been working on, Yokozuna, uses Solr underneath and therefore does support
copy fields [2].

You could create a pre-commit hook to do this field-squashing but I think
you would be better off doing it in your application.  To do it via a hook
you'd have to make sure it runs before the search hook (I can't remember if
you can force specific order of pre-commit hooks).  It would also have an
effect on your write latencies as more pre-processing would have to be
done.  Finally, you would have to write Erlang.


&gt; The use case is this:
&gt;
&gt; We are providing an object + metadata store for users to deposit files and
&gt; any number of related fragments of structured JSON metadata. We are not
&gt; enforcing any metadata schema - and therefore can't know up-front any field
&gt; names - but would like the ability for a dumb keyword search from a website
&gt; to return references to the records they have deposited in
&gt; Riak. Essentially, providing a Google-like interface.
&gt;
&gt; (As a side question, Is Riak Search mature enough for these type of very
&gt; generic searches? I know that it's &quot;inspired by&quot; Lucene and &quot;Lucene-like&quot;,
&gt; but I don't know how many of Lucene's goodies are present - or is it just a
&gt; case of invoking analysers provided by Lucene for things like stemming, and
&gt; all will be pretty much equivalent for most situations?)
&gt;

There are no &quot;goodies present&quot; _at all_.  Riak Search is an in-house
implementation, completely written in Erlang.  It's only connection to
Lucene/Solr is a superficial interface that looks very much like
Lucene/Solr.  E.g. you mention stemming, there is no stemming support in
Riak Search and would be a non-trivial addition.  This is one of the big
reasons Yokozuna is being written [2].  The world of search is vast and
complicated, best to start with proven solution and build from that.

Riak Search generally starts causing pain when you have searches that match
tens of thousands of documents.  The runtime is proportional to the size of
the result set.  In fact, Riak Search has a hard-coded upper limit to fail
queries that match 100K or more documents (although it does the work to get
100K results and then drops it all on the floor so you still use
resources/times).  For example, if a lot of your files were pictures and
were tagged with something like {&quot;type&quot;:&quot;picture&quot;} then a search for
&quot;picture&quot; is probably going to cause issues.  Things really start to hurt
when you do conjunction queries with multiple large result sets, e.g.
&quot;funny AND picture&quot;.  Once again, this is not the case with Yokozuna, which
in my benchmarking thus far has shown flat latencies regardless of result
set size.

-Z

[1]:
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/Riak-Search---Schema/#Defining-a-Schema">http://docs.basho.com/riak/latest/cookbooks/Riak-Search---Schema/#Defining-a-Schema</a>

[2]: <a  rel="nofollow" href="https://github.com/rzezeski/yokozuna">https://github.com/rzezeski/yokozuna</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09520.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09577">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09577">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09594.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09520.html">Riak Search - searching across all fields</a></span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Search - searching across all fields</span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09594.html">Re: Riak Search - searching across all fields</a></span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09611.html">Re: Riak Search - searching across all fiel...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09612.html">Re: Riak Search - searching across all ...</a></span> <span class="sender italic">Mark Phillips</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg09622.html">Re: Riak Search - searching across all fiel...</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Search - searching across all fields">
<input type="hidden" name="msgid" value="CACZcpemFg3vRgaGxpo3o_4WnhY+DL86mrWKY2Z0HunAB=PnkHA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09577.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+%5C-+searching+across+all+fields%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09520.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09594.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpemFg3vRgaGxpo3o_4WnhY+DL86mrWKY2Z0HunAB=PnkHA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
