<!DOCTYPE html>
<html lang="en">
<head>
<title>riak_core question when a node dies</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07067" id="c">
<link rel="index" href="maillist.html#07067" id="i">
<link rel="prev" href="msg07064.html" id="p">
<link rel="next" href="msg07068.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07067.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22riak_core+question+when+a+node+dies%22&amp;o=newest" rel="nofollow"><span itemprop="name">riak_core question when a node dies</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Brisbin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Brisbin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120328" rel="nofollow">Wed, 28 Mar 2012 09:49:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I'm testing the example code that dispatches a web request from misultin into a 
riak_core ring of vnodes. It works fantastic when all nodes are up! :) </pre><pre>

Doing &quot;ab -k -c 200 -n 10000 <a  rel="nofollow" href="http://localhost:3000/&quot">http://localhost:3000/&quot</a>; yields a none-to-shabby 
performance (dispatching at random into all available vnodes on two separate 
riak_core processes): 

Concurrency Level: 200 
Time taken for tests: 1.446 seconds 
Complete requests: 10000 
Failed requests: 0 
Write errors: 0 
Keep-Alive requests: 10000 
Total transferred: 1600480 bytes 
HTML transferred: 120036 bytes 
Requests per second: 6914.04 [#/sec] (mean) 
Time per request: 28.927 [ms] (mean) 
Time per request: 0.145 [ms] (mean, across all concurrent requests) 
Transfer rate: 1080.64 [Kbytes/sec] received 

Connection Times (ms) 
min mean[+/-sd] median max 
Connect: 0 0 1.0 0 12 
Processing: 4 28 9.8 27 78 
Waiting: 4 28 9.8 27 78 
Total: 4 28 10.1 27 83 

Percentage of the requests served within a certain time (ms) 
50% 27 
66% 31 
75% 34 
80% 36 
90% 41 
95% 47 
98% 53 
99% 58 
100% 83 (longest request) 

If I were really zealous, I'd set up haproxy to load balance between these two 
misultin servers and get double failover. 

I'm trying to catch the situation of going into the console of one of my nodes 
and hitting &quot;CTL-C&quot; to kill that process. I'm not sure what the best way is to 
handle this. Check before I dispatch to make sure the node is up? Keep a watch 
of some other kind that, when it sees that node go down and if it's trying to 
dispatch to that node, it tries to find another one? 

Essentially, I'm trying to prevent misultin from completely bailing on the 
request because the sync_spawn_command blows up trying to do a gen_server:call 
to a non-existent node. I'd like to retry to dispatch to a different node if 
one happens to have crashed while I'm serving requests (I don't want to loose a 
request, essentially). 


Thanks! 

Jon Brisbin 
<a  rel="nofollow" href="http://about.me/jonbrisbin">http://about.me/jonbrisbin</a> 


</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07064.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07067">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07067">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07068.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">riak_core question when a node dies</span> <span class="sender italic">Jon Brisbin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07068.html">Re: riak_core question when a node dies</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07069.html">Re: riak_core question when a node dies</a></span> <span class="sender italic">Jon Brisbin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07075.html">Re: riak_core question when a node dies</a></span> <span class="sender italic">Samuel Elliott</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="riak_core question when a node dies">
<input type="hidden" name="msgid" value="13158830.352.1332953362705.JavaMail.jbrisbin@jbrisbin.local">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07067.html">
<input type="submit" value=" Jon Brisbin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22riak_core+question+when+a+node+dies%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07064.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07068.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">13158830.352.1332953362705.JavaMail.jbrisbin@jbrisbin.local</li>
</ul>
</div>
</body>
</html>
