<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Issues with search (2.0)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14641" id="c">
<link rel="index" href="maillist.html#14641" id="i">
<link rel="prev" href="msg14638.html" id="p">
<link rel="next" href="msg14642.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14641.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Issues+with+search+%5C%282.0%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Issues with search (2.0)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jordan+West%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jordan West</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140811" rel="nofollow">Mon, 11 Aug 2014 07:49:36 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Chaim,

Some comments inline:</pre><pre>

On Mon, Aug 11, 2014 at 4:14 AM, Chaim Solomon &lt;ch...@itcentralstation.com&gt;
wrote:

&gt; Hi,
&gt;
&gt; I've been running into an issue with the yz search acting up.
&gt;
&gt; I've been getting a lot of these:
&gt;
&gt; 2014-08-11 06:45:22.005 [error] &lt;0.913.0&gt;@yz_kv:index:206 failed to index
&gt; object {&lt;&lt;&quot;bucketname&quot;&gt;&gt;,&lt;&lt;&quot;123&quot;&gt;&gt;} with error {&quot;Failed to index
&gt; docs&quot;,{error,req_timedout}} because [{yz_solr,index,3,[{file,&quot;s
&gt;
&gt; rc/yz_solr.erl&quot;},{line,192}]},{yz_kv,index,7,[{file,&quot;src/yz_kv.erl&quot;},{line,258}]},{yz_kv,index,3,[{file,
&gt;
&gt; &quot;src/yz_kv.erl&quot;},{line,193}]},{riak_kv_vnode,actual_put,6,[{file,&quot;src/riak_kv_vnode.erl&quot;},{line,1416}]},
&gt;
&gt; {riak_kv_vnode,perform_put,3,[{file,&quot;src/riak_kv_vnode.erl&quot;},{line,1404}]},{riak_kv_vnode,do_put,7,[{fil
&gt;
&gt; e,&quot;src/riak_kv_vnode.erl&quot;},{line,1199}]},{riak_kv_vnode,handle_command,3,[{file,&quot;src/riak_kv_vnode.erl&quot;}
&gt;
&gt; ,{line,485}]},{riak_core_vnode,vnode_command,3,[{file,&quot;src/riak_core_vnode.erl&quot;},{line,345}]}]
&gt;
&gt; and the Java process uses a lot of CPU and eventually runs out of memory
&gt; or something like that and gets stuck. Killing the process gets the cluster
&gt; back up and running.
&gt;
&gt; I am guessing that it may be data corruption on the yz data on one node.
&gt;
&gt; Clearing away the yz data on that node and restarting riak makes the
&gt; system work again - and I guess AAE will rebuild the index.
&gt;
&gt;
This sounds very similar to the issue last week. I would certainly like to
rule out any sort of data corruption (are you thinking your disks are
corrupting the data or are you assuming Solr is?).

However, it is also possible, like the last issue, that the node/cluster
simply does not have enough memory. When you delete the data Solr no longer
has anything to cache in-memory thus using significantly less. As
discussed, the recommended minimum


&gt; But I'm wondering why a crashing Java on one node practically takes down
&gt; the search on the cluster. Shouldn't Riak be more resilient than that?
&gt;

The hard part here is, at least initially, the Java process doesn't crash,
it just starts to timeout. In distributed systems a slow-node is often
worse than a down node. Riak, prior to 1.4 had something called &quot;health
check&quot; that would mark a node down in this situation. Unfortunately in some
workloads, and I believe given your cluster's limited resources it would
happen here, this often results in excessive work being offloaded to
another node, which also does not have sufficient resources and around we
go until the entire cluster falls over. A capacity problem, typically, can
only be solved by adding more capacity.


&gt;
&gt; Is there a explicit reindex command for the full text search subsystem?
&gt;
&gt; Could Riak keep an eye on the java process and restart it if it crashes or
&gt; runs away?
&gt;
&gt;
Riak does manage the JVM process (starting/stopping/restarting) .I agree
that if we could include run-away process, like in your case, that would be
even better. I would have to think a bit more about how this would work (to
prevent the same problems mentioned above with the old-style health check)

Jordan



&gt; Chaim Solomon
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14638.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14641">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14641">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14642.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14638.html">Issues with search (2.0)</a></span> <span class="sender italic">Chaim Solomon</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Issues with search (2.0)</span> <span class="sender italic">Jordan West</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14642.html">Re: Issues with search (2.0)</a></span> <span class="sender italic">Chaim Solomon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14643.html">Re: Issues with search (2.0)</a></span> <span class="sender italic">Eric Redmond</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14645.html">Re: Issues with search (2.0)</a></span> <span class="sender italic">Chaim Solomon</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Issues with search (2.0)">
<input type="hidden" name="msgid" value="CANvRNdeLLwLeQ0aejZ3dQu5931K8-thX2pNDA-tVxfjT=iETog@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14641.html">
<input type="submit" value=" Jordan West ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Issues+with+search+%5C%282.0%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14638.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14642.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANvRNdeLLwLeQ0aejZ3dQu5931K8-thX2pNDA-tVxfjT=iETog@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
