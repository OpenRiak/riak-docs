<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Search Map Reduce error</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd6.html#13053" id="c">
<link rel="index" href="mail6.html#13053" id="i">
<link rel="prev" href="msg13034.html" id="p">
<link rel="next" href="msg13087.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13053.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+Map+Reduce+error%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Search Map Reduce error</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Roger+Diller%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Roger Diller</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131121" rel="nofollow">Thu, 21 Nov 2013 11:09:30 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Ok, I'm not exactly sure what will be most helpful to you, but I am
attaching an example of a Key/Value.</pre><pre>

What you see in the file, we would have thousands of those. Probably would
get to at least a million or so KV's like that.

The bucket is search enabled, so all those JSON fields are going to be
indexed.

However, we are primarily search filtering on the systemId, indexId, &amp;
fullText fields in the value.

We currently have a 6 node cluster with each server having approx 16 cores
&amp; in most cases at least 10 GB (20 GB free on most servers probably) free
memory with all the process running (including Riak). Computing power
should not be an issue period!

Let me know what use that would be useful to provide.



On Wed, Nov 20, 2013 at 12:46 PM, Todd Tyree &lt;t...@basho.com&gt; wrote:

&gt; Hi Roger,
&gt;
&gt; Sorry, meant to reply to the mailing list, but accidentally replied
&gt; directly to you.
&gt;
&gt; Before I can say whether or not secondary indexes are suitable, I need to
&gt; know more about your data, access patterns and query patterns.
&gt;
&gt; Can you share this information with me here?  What kind of data is being
&gt; searched and how frequently is it updated?
&gt;
&gt; Best,
&gt; Todd
&gt;
&gt;
&gt; On Wed, Nov 20, 2013 at 5:05 PM, Roger Diller &lt;
&gt; ro...@flexrentalsolutions.com&gt; wrote:
&gt;
&gt;&gt; Do you have any other suggestions on how we can find data in real time
&gt;&gt; from a bucket (without moving to 2.0)? What about secondary indexes?
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Nov 20, 2013 at 11:59 AM, Todd Tyree &lt;t...@basho.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Roger,
&gt;&gt;&gt;
&gt;&gt;&gt; You are essentially correct in that map reduce was never designed as a
&gt;&gt;&gt; realtime query tool.
&gt;&gt;&gt;
&gt;&gt;&gt; However, we do have a solution in a technology preview release stage
&gt;&gt;&gt; that may solve this problem for you: Yokozuna [0].  It is a tight
&gt;&gt;&gt; integration of Riak and Solr and brings the best of both technologies
&gt;&gt;&gt; together.
&gt;&gt;&gt;
&gt;&gt;&gt; It is currently scheduled for release as part of Riak 2.0, but you can
&gt;&gt;&gt; clone the repo and build it now if you would like.  Just be aware it is
&gt;&gt;&gt; still undergoing development and the API may be subject to change before
&gt;&gt;&gt; the final release.
&gt;&gt;&gt;
&gt;&gt;&gt; [0] <a  rel="nofollow" href="https://github.com/basho/yokozuna">https://github.com/basho/yokozuna</a>
&gt;&gt;&gt;
&gt;&gt;&gt; Best,
&gt;&gt;&gt; Todd
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt; On Wed, Nov 20, 2013 at 4:45 PM, Roger Diller &lt;
&gt; ro...@flexrentalsolutions.com&gt; wrote:
&gt;
&gt;&gt; I could dig up all our nitty gritty Riak details but I don't think that
&gt;&gt; will help really.
&gt;&gt;
&gt;&gt; The point I think is this: Using search map reduce is not a viable way to
&gt;&gt; do real time search queries. Especially ones that may have 2000+ plus
&gt;&gt; results each. Couple that with search requests coming in every few seconds
&gt;&gt; from 300+ customer app instances and you literally bring Riak to it's
&gt;&gt; knees.
&gt;&gt;
&gt;&gt; Not that Riak is the problem really, it's just we are using it in a way
&gt;&gt; it was not designed for. In essence, we are using Riak as a search engine
&gt;&gt; for our application data. Correct me if I'm wrong but Riak is more for
&gt;&gt; storing large amounts of KV data, but not really for finding that data in a
&gt;&gt; search sense.
&gt;&gt;
&gt;&gt; Am I missing something here? Is there a viable way for doing real time
&gt;&gt; search queries on a bucket with 1 million keys?
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Nov 18, 2013 at 5:29 PM, Alexander Sicular &lt;sicul...@gmail.com&gt;wrote:
&gt;&gt;
&gt;&gt;&gt; More info please...
&gt;&gt;&gt;
&gt;&gt;&gt; Version
&gt;&gt;&gt; Current config
&gt;&gt;&gt; Hardware
&gt;&gt;&gt; Data size
&gt;&gt;&gt; Search Schema
&gt;&gt;&gt; Etc.
&gt;&gt;&gt;
&gt;&gt;&gt; But I would probably say that your search is returning too many keys to
&gt;&gt;&gt; your mr. More inline.
&gt;&gt;&gt;
&gt;&gt;&gt; @siculars
&gt;&gt;&gt; <a  rel="nofollow" href="http://siculars.posthaven.com">http://siculars.posthaven.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt; Sent from my iRotaryPhone
&gt;&gt;&gt;
&gt;&gt;&gt; On Nov 18, 2013, at 13:59, Roger Diller &lt;ro...@flexrentalsolutions.com&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Using the Riak Java client, I am executing a search map reduce like this:
&gt;&gt;&gt;
&gt;&gt;&gt; MapReduceResult result = riakClient.mapReduce(SEARCH_BUCKET,
&gt;&gt;&gt; search).execute();
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; ^is this part a typo. Cause otherwise it looks like you do a s&gt;mr, set
&gt;&gt;&gt; the search and then another s&gt;mr.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; String search = &quot;systemId:&quot; + systemName + &quot; AND indexId:&quot; + indexId;
&gt;&gt;&gt;
&gt;&gt;&gt; MapReduceResult result = riakClient.mapReduce(SEARCH_BUCKET,
&gt;&gt;&gt; search).execute();
&gt;&gt;&gt;
&gt;&gt;&gt; This worked fine when the bucket contained a few thousand keys. Now that
&gt;&gt;&gt; we have far more data stored in the bucket (at least 250K keys), it's
&gt;&gt;&gt; throwing this generic error:
&gt;&gt;&gt;
&gt;&gt;&gt; com.basho.riak.client.RiakException: java.io.IOException:
&gt;&gt;&gt; {&quot;error&quot;:&quot;map_reduce_error&quot;}
&gt;&gt;&gt;
&gt;&gt;&gt; We've also noticed that storing new key/values in the bucket has slowed
&gt;&gt;&gt; WAY down.
&gt;&gt;&gt;
&gt;&gt;&gt; Any idea what's going on?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Your data set is incorrectly sized to your production config.
&gt;&gt;&gt;
&gt;&gt;&gt; Are there limitations to Search Map Reduce?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Certainly
&gt;&gt;&gt;
&gt;&gt;&gt; Are there configuration options that need changed?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Possibly
&gt;&gt;&gt;
&gt;&gt;&gt; Any help would be greatly appreciated.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Roger Diller
&gt;&gt;&gt; Flex Rental Solutions, LLC
&gt;&gt;&gt; Email: ro...@flexrentalsolutions.com
&gt;&gt;&gt; Skype: rogerdiller
&gt;&gt;&gt; Time Zone: Eastern Time
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Roger Diller
&gt;&gt; Flex Rental Solutions, LLC
&gt;&gt; Email: ro...@flexrentalsolutions.com
&gt;&gt; Skype: rogerdiller
&gt;&gt; Time Zone: Eastern Time
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; *Todd Tyree*
&gt; Client Services Engineer Basho &lt;<a  rel="nofollow" href="http://www.basho.com/">http://www.basho.com/</a>&gt;
&gt;
&gt; mobile: +44(0)7861 220 182
&gt; web: www.basho.com
&gt; github: tatyree &lt;<a  rel="nofollow" href="http://github.com/tatyree">http://github.com/tatyree</a>&gt;
&gt;



-- 
Roger Diller
Flex Rental Solutions, LLC
Email: ro...@flexrentalsolutions.com
Skype: rogerdiller
Time Zone: Eastern Time
</pre><pre>Key: 
qamaster:23e51460-519b-11df-81b5-1231390c71d1:04741560-0754-11e2-bed8-00e08175e43e

Value:

'{&quot;systemId&quot;:&quot;qamaster&quot;,&quot;indexId&quot;:&quot;23e51460-519b-11df-81b5-1231390c71d1&quot;,&quot;documentId&quot;:&quot;04741560-0754-11e2-bed8-00e08175e43e&quot;,&quot;deleted&quot;:&quot;false&quot;,&quot;closed&quot;:&quot;false&quot;,&quot;fieldMap&quot;:{&quot;element.parentElement.name&quot;:{&quot;fieldId&quot;:&quot;element.parentElement.name&quot;,&quot;fieldValue&quot;:&quot;Subrental
 
1&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;elementName&quot;:{&quot;fieldId&quot;:&quot;elementName&quot;,&quot;fieldValue&quot;:&quot;Subrental
 
1&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;element.resolvedStartDate.SHORT_DATE&quot;:{&quot;fieldId&quot;:&quot;element.resolvedStartDate.SHORT_DATE&quot;,&quot;fieldValue&quot;:&quot;7/16/2012&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;element.name&quot;:{&quot;fieldId&quot;:&quot;element.name&quot;,&quot;fieldValue&quot;:&quot;Subrental
 
1&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;element.client.company&quot;:{&quot;fieldId&quot;:&quot;element.client.company&quot;,&quot;fieldValue&quot;:&quot;&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;parentCaption&quot;:{&quot;fieldId&quot;:&quot;parentCaption&quot;,&quot;fieldValue&quot;:&quot;Subrental
 1 
(ABWR0)&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;locationId&quot;:{&quot;fieldId&quot;:&quot;locationId&quot;,&quot;fieldValue&quot;:&quot;9cd7a7c6-1648-102d-9c2d-00e081c0bae2&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;element.status.name&quot;:{&quot;fieldId&quot;:&quot;element.status.name&quot;,&quot;fieldValue&quot;:&quot;Shelved&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;plannedStartDate&quot;:{&quot;fieldId&quot;:&quot;plannedStartDate&quot;,&quot;fieldValue&quot;:1342483260000,&quot;fieldType&quot;:&quot;DATE&quot;},&quot;pickupLocationId&quot;:{&quot;fieldId&quot;:&quot;pickupLocationId&quot;,&quot;fieldValue&quot;:&quot;9cd7a7c6-1648-102d-9c2d-00e081c0bae2&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;deleted&quot;:{&quot;fieldId&quot;:&quot;deleted&quot;,&quot;fieldValue&quot;:&quot;false&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;definitionName&quot;:{&quot;fieldId&quot;:&quot;definitionName&quot;,&quot;fieldValue&quot;:&quot;Manifest&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;element.resolvedEndDate.SHORT_DATE&quot;:{&quot;fieldId&quot;:&quot;element.resolvedEndDate.SHORT_DATE&quot;,&quot;fieldValue&quot;:&quot;7/17/2012&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;pickupLocation&quot;:{&quot;fieldId&quot;:&quot;pickupLocation&quot;,&quot;fieldValue&quot;:&quot;Flex
 - 
Utah&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;element.client.associatedUser.name&quot;:{&quot;fieldId&quot;:&quot;element.client.associatedUser.name&quot;,&quot;fieldValue&quot;:&quot;&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;personResponsibleId&quot;:{&quot;fieldId&quot;:&quot;personResponsibleId&quot;,&quot;fieldValue&quot;:&quot;67c4e24a-c7c5-11e0-be4c-1231390c71d1&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;plannedEndDate&quot;:{&quot;fieldId&quot;:&quot;plannedEndDate&quot;,&quot;fieldValue&quot;:1342546200000,&quot;fieldType&quot;:&quot;DATE&quot;},&quot;locationString&quot;:{&quot;fieldId&quot;:&quot;locationString&quot;,&quot;fieldValue&quot;:&quot;Flex
 - 
Utah&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;closed&quot;:{&quot;fieldId&quot;:&quot;closed&quot;,&quot;fieldValue&quot;:&quot;false&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;element.documentNumber&quot;:{&quot;fieldId&quot;:&quot;element.documentNumber&quot;,&quot;fieldValue&quot;:&quot;ABWR0&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;displayCaption&quot;:{&quot;fieldId&quot;:&quot;displayCaption&quot;,&quot;fieldValue&quot;:&quot;Subrental
 1 
(ABWR0)&quot;,&quot;fieldType&quot;:&quot;STRING&quot;},&quot;definitionId&quot;:{&quot;fieldId&quot;:&quot;definitionId&quot;,&quot;fieldValue&quot;:&quot;23e51460-519b-11df-81b5-1231390c71d1&quot;,&quot;fieldType&quot;:&quot;STRING&quot;}},&quot;fullText&quot;:&quot;subrental
 1 subrental 1 7/16/2012 subrental 1  subrental 1 (abwr0) 
9cd7a7c6-1648-102d-9c2d-00e081c0bae2 shelved 
9cd7a7c6-1648-102d-9c2d-00e081c0bae2 false manifest 7/17/2012 flex - utah  
67c4e24a-c7c5-11e0-be4c-1231390c71d1 flex - utah false abwr0 subrental 1 
(abwr0) 23e51460-519b-11df-81b5-1231390c71d1 &quot;}'
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13034.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd6.html#13053">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail6.html#13053">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13087.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13004.html">Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13009.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13031.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13034.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Todd Tyree</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Search Map Reduce error</span> <span class="sender italic">Roger Diller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13087.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13035.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Ryan Zezeski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13006.html">Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Search Map Reduce error">
<input type="hidden" name="msgid" value="CAG7gc5DPRNRpQVWOK=YEuFerDtPWohFnkLcPaAYWTVeSN0R8GQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13053.html">
<input type="submit" value=" Roger Diller ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+Map+Reduce+error%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13034.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13087.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAG7gc5DPRNRpQVWOK=YEuFerDtPWohFnkLcPaAYWTVeSN0R8GQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
