<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Is Riak a good solution for this problem?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06592" id="c">
<link rel="index" href="maillist.html#06592" id="i">
<link rel="prev" href="msg06591.html" id="p">
<link rel="next" href="msg06593.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06592.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Is+Riak+a+good+solution+for+this+problem%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Is Riak a good solution for this problem?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jacques%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jacques</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120213" rel="nofollow">Mon, 13 Feb 2012 12:45:23 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>This seems like the bread and butter of most Hadoop/MapReduce
implementations.  If you needs some data more near realtime, you could add
HBase on top.  If you need ad hoc querying, use Hive or Pig.  If you want
to do clustering and more advanced analyses, use Mahout.</pre><pre>

We love Riak and use it extensively but wouldn't suggest using it for the
use case you're describing.

Jacques

On Sun, Feb 12, 2012 at 3:27 AM, Marco Monteiro &lt;ma...@textovirtual.com&gt;wrote:

&gt; Hello!
&gt;
&gt; I'm considering Riak for the statistics of a site that is approaching  a
&gt; billion page views per month.
&gt; The plan is to log a little information about each the page view and then
&gt; to query that data.
&gt;
&gt; I'm very new to Riak.  I've gone over the documentation on the wiki, and I
&gt; know about map-reduce,
&gt; secondary indexes and Riak search. I've installed Riak on a single node
&gt; and made a test with the
&gt; default configuration. The results were a little bellow what I expected.
&gt; For the test is used the following
&gt; requirement.
&gt;
&gt; We want the page view count by day for registered and unregistered users.
&gt; We are storing session
&gt; documents. Each document has a session identifier as it's key and a list
&gt; of page views as the value
&gt; (and a few additional properties we can ignore). This document structure
&gt; comes from CouchDB,
&gt; where I organised things like this to be able to more easily query the
&gt; database. I've done a basic
&gt; javascript map-reduce query for this. I just map over each session (every
&gt; k/v in a bucket) returning
&gt; the length of the page views array for either the registered or
&gt; unregistered field (the other is zero), and
&gt; the day of the request. In the reduce I collect them by hashing the day
&gt; and summing the two number
&gt; of page views. Then I have a second reduce to sort the list by day.
&gt;
&gt; This is very slow on a single machine setup with default Riak
&gt; configuration. 1.000 sessions takes
&gt; 6 seconds. 10.000 sessions takes more that 2 minutes (timeout). We want to
&gt; handle 10.000.000
&gt; sessions, at least. Is there a way, maybe with secondary indexes, to make
&gt; this go faster using only Riak?
&gt; Or must I use some kind of persistent cache to store this info as time
&gt; goes by? Or can I make Riak
&gt; run 100 times faster by tweaking the config? I don't want to have 1000
&gt; machines for making this work.
&gt;
&gt; Also, will updating the session documents be a problem for Riak? Would it
&gt; be better to store each
&gt; page hit under a new key, to not update the the session document. Because
&gt; of the &quot;multilevel&quot; map
&gt; reduce this ca work on Riak, where it didn't work on CouchDB, because its
&gt; view system limitation.
&gt; Unfortunately, with the update of documents the CouchDB database was
&gt; growing way too fast for it
&gt; to be a feasible solution.
&gt;
&gt;
&gt; Any advice to make Riak work for this problem is greatly appreciated.
&gt;
&gt; Thanks,
&gt; Marco
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06591.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06592">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06592">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06593.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06584.html">Is Riak a good solution for this problem?</a></span> <span class="sender italic">Marco Monteiro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06588.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06589.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06591.html">Re: Is Riak a good solution for this proble...</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Is Riak a good solution for this problem?</span> <span class="sender italic">Jacques</span></li>
<li class="icons-email"><span class="subject"><a href="msg06593.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Jeffrey Massung</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06659.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Marco Monteiro</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06587.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Steve Song</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Is Riak a good solution for this problem?">
<input type="hidden" name="msgid" value="CAO83RbWq6ZEdqpcaRtz-3JtCpPmMMC3rDtBMkfwi8-xQmYtOOg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06592.html">
<input type="submit" value=" Jacques ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Is+Riak+a+good+solution+for+this+problem%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06591.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06593.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAO83RbWq6ZEdqpcaRtz-3JtCpPmMMC3rDtBMkfwi8-xQmYtOOg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
