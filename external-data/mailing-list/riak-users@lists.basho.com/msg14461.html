<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Cluster rebalancing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14461" id="c">
<link rel="index" href="maillist.html#14461" id="i">
<link rel="prev" href="msg14456.html" id="p">
<link rel="next" href="msg14462.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14461.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Cluster+rebalancing%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Cluster rebalancing</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Chaim+Solomon%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Chaim Solomon</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140705" rel="nofollow">Sat, 05 Jul 2014 22:15:07 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I don't think I was quite clear in what I asked for.

I am not asking for the ability to influence the hashing algorithm. That
would be a mess.
But I would like to be able to have more influence on the distribution of
vnodes on the nodes - and that is something that RIAK already does.</pre><pre>

So a command to bump a vnode off a particular node or reduce the number of
vnodes on a node or set the target percentage on a node would be nice. It
seems like the current algorithm already does something similar - but I
didn't see how one can influence that.

The other issue was that I would suggest taking the disk space into
consideration.
If you have nodes that have different storage then balancing the data
equally between nodes may not be the best option.
It may be better to take the available disk space into consideration and
move vnodes to nodes that have free space if a node runs low on space.

One simple use case would be expanding a cluster with newer nodes (that
have more storage) and being able to utilise that storage.

Another would be to be able to distribute larger partitions more evenly -
in particular if the size per partition is not evenly distributed.

Chaim Solomon



On Thu, Jul 3, 2014 at 8:51 PM, Tom Santero &lt;tsant...@gmail.com&gt; wrote:

&gt; responses inline
&gt;
&gt;
&gt; On Thu, Jul 3, 2014 at 2:45 AM, Chaim Solomon &lt;ch...@itcentralstation.com&gt;
&gt; wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I'm running a 2.0.0b cluster (small) and have been running out of space
&gt;&gt; on one node.
&gt;&gt; I had expected that adding a node would lead to freeing up of space on
&gt;&gt; other nodes - but it's not working too fast.
&gt;&gt;
&gt;
&gt; Keep in mind that the speed of transfers is bound by the bandwidth
&gt; available on the network as well as the speed at which you can actually
&gt; read the data off disk. Once the transfers complete you should see the disk
&gt; freed.
&gt;
&gt;
&gt;&gt;
&gt;&gt; I would suggest to add to RIAK a way to have the distribution algorithm
&gt;&gt; take free space into consideration and to move data to empty nodes fast.
&gt;&gt; Another issue is that adding the node moved most nodes from 25% to 18.8% -
&gt;&gt; but one stayed on 25% in the planner.
&gt;&gt;
&gt;
&gt; The algorithm Riak uses to determine vnode placement is non-deterministic;
&gt; if you don't like any given staged vnode distribution I might suggest you
&gt; run riak-admin cluster clear to undo any staged changed and attempt to add
&gt; the node again, until you're content with the new plan.
&gt;
&gt;
&gt;&gt;
&gt;&gt; And I would also suggest adding some way to force a rebalancing of the
&gt;&gt; cluster to force nodes to take up more load if they don't have enough or
&gt;&gt; hand off load to others.
&gt;&gt;
&gt;
&gt; The hashing algorithm used by Riak to determine object placement in the
&gt; ring is uniform--over time and with a greater number of total keys you'll
&gt; start to see a smoother distribution across all partitions.
&gt;
&gt; On the fly rebalancing would be incredibly expensive, especially for users
&gt; who have lots of nodes and petabytes of data stored in Riak. Ad-hoc
&gt; partition handoff would most likely be brittle and error-prone, given the
&gt; unreliability of the network.
&gt;
&gt; In my humble opinion the engineers at Basho work harder than most other
&gt; distributed systems developers, considering all the edge cases where
&gt; systems can fail unexpectedly; I say this not to boost their egos, but
&gt; rather to point out that their approach has the effect of making Riak more
&gt; robust and resilient than most other distributed datastores. But such
&gt; resiliency isn't free, and for these guarantees every user must pay the
&gt; price. Riak might not be the fastest database, and it may even underutilize
&gt; that really expensive hardware you might throw at it...but i'll be damned
&gt; if it doesn't lie to me, lose my data or pretend that failures like network
&gt; partitions don't happen.
&gt;
&gt;
&gt;&gt;
&gt;&gt; Chaim Solomon
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14456.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14461">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14461">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14462.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14455.html">Cluster rebalancing</a></span> <span class="sender italic">Chaim Solomon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14456.html">Re: Cluster rebalancing</a></span> <span class="sender italic">Tom Santero</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Cluster rebalancing</span> <span class="sender italic">Chaim Solomon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14462.html">Re: Cluster rebalancing</a></span> <span class="sender italic">Thomas Santero</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14467.html">Re: Cluster rebalancing</a></span> <span class="sender italic">John Daily</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Cluster rebalancing">
<input type="hidden" name="msgid" value="CAL8+D4UNvpjQGyPkkg0v2FMqL8O1gd6Ysj3001BDsKRL4x_bDg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14461.html">
<input type="submit" value=" Chaim Solomon ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Cluster+rebalancing%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14456.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14462.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAL8+D4UNvpjQGyPkkg0v2FMqL8O1gd6Ysj3001BDsKRL4x_bDg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
