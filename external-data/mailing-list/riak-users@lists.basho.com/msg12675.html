<!DOCTYPE html>
<html lang="en">
<head>
<title>Getting a list of events using secondary index</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd8.html#12675" id="c">
<link rel="index" href="mail8.html#12675" id="i">
<link rel="prev" href="msg12668.html" id="p">
<link rel="next" href="msg12676.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12675.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Getting+a+list+of+events+using+secondary+index%22&amp;o=newest" rel="nofollow"><span itemprop="name">Getting a list of events using secondary index</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alex+Robson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alex Robson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131017" rel="nofollow">Thu, 17 Oct 2013 12:56:44 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Working on an event-sourcing aproach and would really appreciate some
advice.</pre><pre>

1. Every event is tagged with a secondary index (&quot;aggregate_id&quot;)
2. Every event's id is k-ordered (using a Flake compatible id generator)
3. Every aggregate has last_event_id

I would like the ability to select all event ids, for a given an
aggregate_id that occurred after the last_event_id for a given aggregate.

At the moment, I am using the secondary index only to get all event ids for
a particular aggregate. I then filter the id list so that I only have the
ids that occurred after last_event_id. I then issue a multi-key get and
retrieve the events I want.

Latency is fairly important in this case and so I wanted to see if there
were a better way (or if what I'm doing is just an awful misuse of Riak). I
got the impression from reading docs that map/reduce is not ideal for
real-time operations and intended more for batch stuff that runs out of
band. This series of operations would occur for every read of the aggregate.

Thanks for your help and thanks for Riak :)

Alex
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12668.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd8.html#12675">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail8.html#12675">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12676.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Getting a list of events using secondary index</span> <span class="sender italic">Alex Robson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12676.html">Re: Getting a list of events using secondary index</a></span> <span class="sender italic">Brady Wetherington</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Getting a list of events using secondary index">
<input type="hidden" name="msgid" value="CABWF3X2ai2xdyiMzZRvZ=nytGEXVDr7=L8VZ9vtYrWmaw0-npg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12675.html">
<input type="submit" value=" Alex Robson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Getting+a+list+of+events+using+secondary+index%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12668.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12676.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CABWF3X2ai2xdyiMzZRvZ=nytGEXVDr7=L8VZ9vtYrWmaw0-npg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
