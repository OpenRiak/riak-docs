<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Updating Counters on Riak 2.0 pre whatever</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd8.html#12735" id="c">
<link rel="index" href="mail8.html#12735" id="i">
<link rel="prev" href="msg12732.html" id="p">
<link rel="next" href="msg12736.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12735.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Updating+Counters+on+Riak+2.0+pre+whatever%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Updating Counters on Riak 2.0 pre whatever</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Russell+Brown%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Russell Brown</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131022" rel="nofollow">Tue, 22 Oct 2013 13:16:23 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
On 22 Oct 2013, at 20:24, Jeremiah Peschka &lt;jeremiah.pesc...@gmail.com&gt; wrote:</pre><pre>

&gt; Hah! No worries at all. Thanks for the clarification. I'll rebuild.
&gt; 
&gt; I wasn't sure if I needed to try to figure out (from a client perspective) if 
&gt; I needed to use the CRDT syntax for 2.0 and newer and RpbCounterUpdateReq for 
&gt; 1.4.x and earlier. Good to know that I can blindly proceed.

Ok, this is a good question. And something we've been working on.
 
1.4 had counters, 2.0 has counters. Are they the same? Yes and no.
 
In 2.0 we add bucket types. We decided that CRDTs in 2.0 should take advantage 
of bucket types. The reason being that there is no sensible way to merge across 
types (how do you merge a Map with a Set? (we thought of a few ways, but non 
were intuitive)) It comes down to the reason for CRDTs: no conflicts, no 
siblings. If we allow different types in the same bucket then you can create 
the same key with two different types, which means siblings types: just as 
complex as siblings.
 
So, we restrict you to one CRDT type per bucket. But in 1.4 we didn't have this 
restriction. And we need to support 1.4 style counters.
 
If you use the 1.4 API or store counters in the default (untyped) bucket using 
the 2.0 API then you're interoperable between versions.
 
Sorry if it seems confusing. The point is that as a client developer you can 
access 1.4 counters through the 2.0 API by using the default bucket type OR 
continue support for the 1.4 API (or bolth.) Whichever you prefer.
 
I realise this might be an information overload, so feel free to ask questions 
about anything I wasn't clear enough about.

Cheers

Russell

&gt; 
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt; 
&gt; 
&gt; On Tue, Oct 22, 2013 at 2:07 PM, Russell Brown &lt;russell.br...@mac.com&gt; wrote:
&gt; Yes! Sorry!
&gt; 
&gt; We broke backwards compatibility during development. We merged the patch 
&gt; today[1]. The develop branch works right now. It will get into the next pre 
&gt; (or whatever the next tag is called.)
&gt; 
&gt; Apologies again, it was easier for me to do the new work without thinking 
&gt; about backwards compatibility, then re-add old counters when the 2.0 stuff 
&gt; was done.
&gt; 
&gt; Let me know if you have any more issues going forward, please.
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; [1] <a  rel="nofollow" href="https://github.com/basho/riak_kv/pull/697">https://github.com/basho/riak_kv/pull/697</a>
&gt; On 22 Oct 2013, at 19:56, Jeremiah Peschka &lt;jeremiah.pesc...@gmail.com&gt; wrote:
&gt; 
&gt; &gt; I'm attempting to create a counter on Riak 2.0 built from the develop on 
&gt; &gt; Sunday. When I send a counter increment message using RpbCounterUpdateReq, 
&gt; &gt; I get the following back from Riak:
&gt; &gt;
&gt; &gt; Riak returned an error. Code '0'. Message: Error processing incoming 
&gt; &gt; message: error:undef:[{riak_kv_counter,supported,
&gt; &gt;                                                  [],[]},
&gt; &gt;                                                 {riak_kv_pb_counter,process,
&gt; &gt;                                                  2,
&gt; &gt;                                                  [{file,
&gt; &gt;                                                    
&gt; &gt; &quot;src/riak_kv_pb_counter.erl&quot;},
&gt; &gt;                                                   {line,114}]},
&gt; &gt;                                                 {riak_api_pb_server,
&gt; &gt;                                                  process_message,4,
&gt; &gt;                                                  [{file,
&gt; &gt;                                                    
&gt; &gt; &quot;src/riak_api_pb_server.erl&quot;},
&gt; &gt;                                                   {line,386}]},
&gt; &gt;                                                 {riak_api_pb_server,
&gt; &gt;                                                  connected,2,
&gt; &gt;                                                  [{file,
&gt; &gt;                                                    
&gt; &gt; &quot;src/riak_api_pb_server.erl&quot;},
&gt; &gt;                                                   {line,228}]},
&gt; &gt;                                                 {riak_api_pb_server,
&gt; &gt;                                                  decode_buffer,2,
&gt; &gt;                                                  [{file,
&gt; &gt;                                                    
&gt; &gt; &quot;src/riak_api_pb_server.erl&quot;},
&gt; &gt;                                                   {line,362}]},
&gt; &gt;                                                 {gen_fsm,handle_msg,7,
&gt; &gt;                                                  [{file,&quot;gen_fsm.erl&quot;},
&gt; &gt;                                                   {line,505}]},
&gt; &gt;                                                 {proc_lib,init_p_do_apply,3,
&gt; &gt;                                                  [{file,&quot;proc_lib.erl&quot;},
&gt; &gt;                                                   {line,239}]}]
&gt; &gt; ---
&gt; &gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; &gt; MCITP: SQL Server 2008, MVP
&gt; &gt; Cloudera Certified Developer for Apache Hadoop
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12732.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd8.html#12735">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail8.html#12735">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12736.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12729.html">Updating Counters on Riak 2.0 pre whatever</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12730.html">Re: Updating Counters on Riak 2.0 pre whatever</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12732.html">Re: Updating Counters on Riak 2.0 pre whatever</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Updating Counters on Riak 2.0 pre whatev...</span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12736.html">Re: Updating Counters on Riak 2.0 pre wh...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12731.html">Re: Updating Counters on Riak 2.0 pre whatever</a></span> <span class="sender italic">darren</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12733.html">Re: Updating Counters on Riak 2.0 pre whatever</a></span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12734.html">Re: Updating Counters on Riak 2.0 pre whatev...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Updating Counters on Riak 2.0 pre whatever">
<input type="hidden" name="msgid" value="44A621A9-A377-44B3-9668-0377E295D0B4@mac.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12735.html">
<input type="submit" value=" Russell Brown ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Updating+Counters+on+Riak+2.0+pre+whatever%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12732.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12736.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">44A621A9-A377-44B3-9668-0377E295D0B4@mac.com</li>
</ul>
</div>
</body>
</html>
