<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak-CS , S3cmd and A single Node outage on a 3 node cluster</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd11.html#12111" id="c">
<link rel="index" href="mail11.html#12111" id="i">
<link rel="prev" href="msg12103.html" id="p">
<link rel="next" href="msg12120.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12111.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak%5C-CS+%2C+S3cmd+and+A+single+Node+outage+on+a+3+node+cluster%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak-CS , S3cmd and A single Node outage on a 3 node cluster</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Meredith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Meredith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130821" rel="nofollow">Wed, 21 Aug 2013 15:57:03 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>You'll get insufficient vnodes messages when not enough riak nodes are up
and running.  The 'riak start' command returns before the node is servicing
requests.  In your log you'll see something similar to this</pre><pre>

 2013-08-19 15:33:59.337 [info] &lt;0.7.0&gt; Application riak_kv started on node
'c1n1@127.0.0.1'

Is there a chance you ran your test soon after a restart?  If you have a
large amount of data written into bitcask, it can take several minutes for
everything to start up.

Jon



On Tue, Aug 20, 2013 at 6:09 PM, Idan Shinberg &lt;idan.shinb...@idomoo.com&gt;wrote:

&gt; One small update -
&gt;
&gt; I've tried  GET operations
&gt;
&gt; yet they seldom fail ( again , I'm guessing on fails that have blocks on
&gt; the missing mode )
&gt;
&gt; for example
&gt;
&gt; *s3cmd --force get s3://riak.test/test/21*
&gt; *s3://riak.test/test/21 -&gt; ./21  [1 of 1]*
&gt; * 3145728 of 9437184    33% in    0s    24.33 MB/s  failed*
&gt; *WARNING: Retrying failed request: /test/21 (string indices must be
&gt; integers, not str)*
&gt; *WARNING: Waiting 3 sec...*
&gt; *s3://riak.test/test/21 -&gt; ./21  [1 of 1]*
&gt; * 3145728 of 9437184    33% in    0s     0.00 B/s  failed*
&gt; *WARNING: Retrying failed request: /test/21 (string indices must be
&gt; integers, not str)*
&gt; *WARNING: Waiting 6 sec...*
&gt;
&gt; logs the following message :
&gt;
&gt; *2013-08-21 00:02:35.768 [error]
&gt; &lt;0.741.0&gt;@riak_cs_get_fsm:waiting_chunks:311 riak_cs_get_fsm: Cannot get S3
&gt; &lt;&lt;&quot;riak.test&quot;&gt;&gt; &lt;&lt;&quot;test/21&quot;&gt;&gt; block#
&gt; {&lt;&lt;212,253,202,96,63,227,78,187,153,104,106,213,103,21,228,199&gt;&gt;,3}:
&gt; {error,notfound}*
&gt; *2013-08-21 00:02:35.768 [error] &lt;0.299.0&gt; CRASH REPORT Process &lt;0.299.0&gt;
&gt; with 0 neighbours exited with reason:
&gt; {normal,{gen_fsm,sync_send_event,[&lt;0.741.0&gt;,get_next_chunk,infinity]}} in
&gt; gen_fsm:sync_send_event/3 line 214*
&gt;
&gt; Could it be that Riak is not replicating data coming from Riak-CS ?
&gt;
&gt;
&gt; Regards,
&gt;
&gt; Idan Shinberg
&gt;
&gt;
&gt; System Architect
&gt;
&gt; Idomoo Ltd.
&gt;
&gt;
&gt;
&gt; Mob +972.54.562.2072
&gt;
&gt; email idan.shinb...@idomoo.com
&gt;
&gt; web www.idomoo.com
&gt;
&gt; [image: Description: cid:FC66336E-E750-4C2D-B6E3-985D5A06B5BE@idomoo.co.il]
&gt;
&gt;
&gt; On Wed, Aug 21, 2013 at 2:47 AM, Idan Shinberg 
&gt; &lt;idan.shinb...@idomoo.com&gt;wrote:
&gt;
&gt;&gt; Hi there riak users
&gt;&gt;
&gt;&gt; I've been running some tests on riak-cs on a 3 node riak cluster ( 3
&gt;&gt; servers , each host riak and riak-cs pointing at the local riak . One of
&gt;&gt; the instance is also hosting the stanchion )
&gt;&gt; Software versions :
&gt;&gt;  - Riak is 1.4.1
&gt;&gt;  - Riak-CS is 1.4.0
&gt;&gt;  - s3cmd is 1.5.0 alpha 3
&gt;&gt;
&gt;&gt; n_val was either set to be 2 or 3  ( tried both )for  default bucket  ,
&gt;&gt; yet whenever I kill  a single riak node ( simulate a server outage )
&gt;&gt; I come across the following error when try to use s3cmd get path:
&gt;&gt; *
&gt;&gt; *
&gt;&gt; *s3cmd ls s3://riak.test/test/1*
&gt;&gt; *
&gt;&gt; *
&gt;&gt; *WARNING: Retrying failed request: /?prefix=test/1&amp;delimiter=/ ()*
&gt;&gt; *WARNING: Waiting 3 sec...*
&gt;&gt; *WARNING: Retrying failed request: /?prefix=test/1&amp;delimiter=/ ()*
&gt;&gt; *WARNING: Waiting 6 sec...*
&gt;&gt; *
&gt;&gt; *
&gt;&gt; Looking into Riak-CS error logs  , I find these errors
&gt;&gt; *
&gt;&gt; *
&gt;&gt; *
&gt;&gt; 2013-08-20 23:39:40.240 [error] &lt;0.14674.0&gt; gen_fsm &lt;0.14674.0&gt; in state
&gt;&gt; waiting_object_list terminated with reason:
&gt;&gt; &lt;&lt;&quot;{error,insufficient_vnodes_available}&quot;&gt;&gt;
&gt;&gt; 2013-08-20 23:39:40.240 [error] &lt;0.14674.0&gt; CRASH REPORT Process
&gt;&gt; &lt;0.14674.0&gt; with 1 neighbours exited with reason:
&gt;&gt; &lt;&lt;&quot;{error,insufficient_vnodes_available}&quot;&gt;&gt; in gen_fsm:terminate/7 line 611
&gt;&gt;
&gt;&gt; This of course implies of missing v_nodes found on the single dead riak
&gt;&gt; node... :/
&gt;&gt;
&gt;&gt; *
&gt;&gt; Writing to riak using s3cmd keeps working flawlessly . And of course
&gt;&gt; after I revive the dead node
&gt;&gt; misplaced data is re-distributed ( ring of vnodes are redistributed to
&gt;&gt; reflect requested distribution ).
&gt;&gt;
&gt;&gt; I might be missing something here , but ain't the whole point of
&gt;&gt; replication is to avoid such issues with a single node failure ? ( assuming
&gt;&gt; n_val is greater the 1 )
&gt;&gt; Isn't a 3 Node Cluster with n_val =&gt;2 supposed to withstand a single node
&gt;&gt; failure ?
&gt;&gt; Have I missed something in configuring Riak-CS ?
&gt;&gt;
&gt;&gt; Any help will be appreciated , this is really the final missing piece of
&gt;&gt; our RiAK puzzle :)
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt;
&gt;&gt; Idan Shinberg
&gt;&gt;
&gt;&gt;
&gt;&gt; System Architect
&gt;&gt;
&gt;&gt; Idomoo Ltd.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Mob +972.54.562.2072
&gt;&gt;
&gt;&gt; email idan.shinb...@idomoo.com
&gt;&gt;
&gt;&gt; web www.idomoo.com
&gt;&gt;
&gt;&gt; [image: Description:
&gt;&gt; cid:FC66336E-E750-4C2D-B6E3-985D5A06B5BE@idomoo.co.il]
&gt;&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;


-- 
Jon Meredith
VP, Engineering
Basho Technologies, Inc.
jmered...@basho.com
</pre><p><tt>&lt;&lt;image001.jpg&gt;&gt;</tt></p><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12103.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd11.html#12111">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail11.html#12111">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12120.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12103.html">Riak-CS , S3cmd and A single Node outage on a 3 node cl...</a></span> <span class="sender italic">Idan Shinberg</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak-CS , S3cmd and A single Node outage on a ...</span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12120.html">Re: Riak-CS , S3cmd and A single Node outage o...</a></span> <span class="sender italic">Kelly McLaughlin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12124.html">Re: Riak-CS , S3cmd and A single Node outa...</a></span> <span class="sender italic">Brady Wetherington</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak-CS , S3cmd and A single Node outage on a 3 node cluster">
<input type="hidden" name="msgid" value="CAGgQeSt71=8pNL74-m_7SE=StxVvMF3EudrEB4Si16Vxgov7cw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12111.html">
<input type="submit" value=" Jon Meredith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak%5C-CS+%2C+S3cmd+and+A+single+Node+outage+on+a+3+node+cluster%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12103.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12120.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGgQeSt71=8pNL74-m_7SE=StxVvMF3EudrEB4Si16Vxgov7cw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
