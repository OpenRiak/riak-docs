<!DOCTYPE html>
<html lang="en">
<head>
<title>Adding a new machine to a three node cluster cause partition handoff	problems</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06206" id="c">
<link rel="index" href="maillist.html#06206" id="i">
<link rel="prev" href="msg06201.html" id="p">
<link rel="next" href="msg06211.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06206.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Adding+a+new+machine+to+a+three+node+cluster+cause+partition+handoff%09problems%22&amp;o=newest" rel="nofollow"><span itemprop="name">Adding a new machine to a three node cluster cause partition handoff	problems</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ivaylo+Panitchkov%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ivaylo Panitchkov</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120110" rel="nofollow">Tue, 10 Jan 2012 08:13:19 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">

Hello All,</pre><pre>

</pre><tt>We have a cluster of three machines (Debian 6.0, 4GB RAM, 
</tt><tt>riak_1.0.2-1_amd64.deb, n_val: 3) that serves an application for a 
</tt><tt>while. As we go to production soon added a fourth machine to the cluster 
</tt><tt>(exactly the same as the first three) yesterday. The partition handoff 
</tt><tt>began in the late afternoon and I had an impression that the transition 
</tt><tt>will not take too long as there are only few hundred IMPORTANT records 
</tt><tt>in the storage for the moment. Today in the morning checked the 
</tt><tt>situation again and realized the partition handoff still runs (or get 
</tt><tt>stuck). The Ownership Handoff is still the same since yesterday (at 
</tt><tt>least 19 hours till now). Any suggestions to fix the problem are welcome :-)
</tt><pre style="margin: 0em;">

REMARK: Replaced the IP addresses for security sake


# riak-admin ringready
Attempting to restart script through sudo -u riak
</pre><tt>TRUE All nodes agree on the ring 
</tt><tt>['r...@yyy.yyy.yyy.yyy','r...@xxx.xxx.xxx.xxx','r...@aaa.aaa.aaa.aaa','r...@bbb.bbb.bbb.bbb']
</tt><pre style="margin: 0em;">


# riak-admin transfers
Attempting to restart script through sudo -u riak
'r...@bbb.bbb.bbb.bbb' waiting to handoff 2 partitions
'r...@aaa.aaa.aaa.aaa' waiting to handoff 2 partitions
'r...@yyy.yyy.yyy.yyy' waiting to handoff 2 partitions


# riak-admin ring_status
Attempting to restart script through sudo -u riak
</pre><tt>================================== Claimant 
</tt><tt>===================================
</tt><pre style="margin: 0em;">
Claimant: 'r...@xxx.xxx.xxx.xxx'
Status: up
Ring Ready: true

</pre><tt>============================== Ownership Handoff 
</tt><tt>==============================
</tt><pre style="margin: 0em;">
Owner: r...@xxx.xxx.xxx.xxx
Next Owner: r...@yyy.yyy.yyy.yyy

Index: 548063113999088594326381812268606132370974703616
Waiting on: [riak_kv_vnode]
Complete: [riak_pipe_vnode]

Index: 1370157784997721485815954530671515330927436759040
Waiting on: [riak_kv_vnode]
Complete: [riak_pipe_vnode]

-------------------------------------------------------------------------------

</pre><tt>============================== Unreachable Nodes 
</tt><tt>==============================
</tt><pre style="margin: 0em;">
All nodes are up and reachable


# riak-admin member_status
Attempting to restart script through sudo -u riak
</pre><tt>================================= Membership 
</tt><tt>==================================
</tt><pre style="margin: 0em;">
Status Ring Pending Node
-------------------------------------------------------------------------------
valid 21.9% 25.0% 'r...@yyy.yyy.yyy.yyy'
valid 28.1% 25.0% 'r...@xxx.xxx.xxx.xxx'
valid 25.0% 25.0% 'r...@aaa.aaa.aaa.aaa'
valid 25.0% 25.0% 'r...@bbb.bbb.bbb.bbb'
-------------------------------------------------------------------------------
Valid:4 / Leaving:0 / Exiting:0 / Joining:0 / Down:0


--
Ivaylo Panitchkov
Software developer
Hibernum Creations Inc.

Ce courriel est confidentiel et peut aussi être protégé par la loi.Si vous avez 
reçu ce courriel par erreur, veuillez nous en aviser immédiatement en y 
répondant, puis supprimer ce message de votre système. Veuillez ne pas le 
copier, l’utiliser pour quelque raison que ce soit ni divulguer son contenu à 
quiconque.
This email is confidential and may also be legally privileged. If you have 
received this email in error, please notify us immediately by reply email and 
then delete this message from your system. Please do not copy it or use it for 
any purpose or disclose its content.


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06201.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06206">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06206">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06211.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Adding a new machine to a three node cluster cause parti...</span> <span class="sender italic">Ivaylo Panitchkov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06211.html">Re: Adding a new machine to a three node cluster ca...</a></span> <span class="sender italic">Joseph Blomstedt</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Adding a new machine to a three node cluster cause partition handoff	problems">
<input type="hidden" name="msgid" value="4F0C6398.4010907@hibernum.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06206.html">
<input type="submit" value=" Ivaylo Panitchkov ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Adding+a+new+machine+to+a+three+node+cluster+cause+partition+handoff%09problems%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06201.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06211.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4F0C6398.4010907@hibernum.com</li>
</ul>
</div>
</body>
</html>
