<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Strange spike</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07586" id="c">
<link rel="index" href="maillist.html#07586" id="i">
<link rel="prev" href="msg07585.html" id="p">
<link rel="next" href="msg07587.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07586.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strange+spike%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Strange spike</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Seth+Benton%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Seth Benton</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120531" rel="nofollow">Thu, 31 May 2012 11:24:22 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey,

Apologies if this is the wrong place for this, but I just updated the
eLevelDB wiki page to mention randomization of the write buffer length (via
setting write_buffer_size_min and write_buffer_size_max).  Before there was
no mention of these config parameters.  Perhaps people were just using
levelDB's 4MB default buffer size, causing all the vnodes to compact at the
same time?  Or are there default write_buffer_size_min and
write_buffer_size_max
parameters under the hood?</pre><pre>

<a  rel="nofollow" href="http://wiki.basho.com/LevelDB.html">http://wiki.basho.com/LevelDB.html</a>

P.S.  Mathew V is getting back to me shortly on changes to this page due to
changes in 1.2.

Seth
(Tech Writer)


On Thu, May 31, 2012 at 9:26 AM, Nam Nguyen &lt;n...@tinyco.com&gt; wrote:

&gt; Hi Sean,
&gt;
&gt; You are right. At first I thought it was localized to that one particular
&gt; node. Now others are also exhibiting the same symptom.
&gt;
&gt; I am putting in another node.
&gt;
&gt; Cheers,
&gt; Nam
&gt;
&gt;
&gt; On May 30, 2012, at 11:23 PM, Sean Cribbs wrote:
&gt;
&gt; Nam,
&gt;
&gt; The LevelDB storage backend has a known issue where compaction can stall a
&gt; heavily-loaded node for a long time (we've seen 60 seconds or more in
&gt; production clusters). We're very sorry about this, but an improvement will
&gt; be available in the next release. In the meantime, DO NOT make the node
&gt; leave the cluster - this will only make things worse! It might be worth
&gt; adding another node to the cluster, but I suggest you wait until the node
&gt; finishes compaction.
&gt;
&gt; On Wed, May 30, 2012 at 10:43 PM, Nam Nguyen &lt;n...@tinyco.com&gt; wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; My 5-node cluster exhibits a strange spike on one particular node.
&gt;&gt;
&gt;&gt; Overall, the mean get time is about 1ms. This node occasionally shoots up
&gt;&gt; to 40ms.
&gt;&gt;
&gt;&gt; During those times, %iowait is still the same as it is before the spike.
&gt;&gt; No error. Console log shows many lines like the below, which I don't think
&gt;&gt; relevant to the spike.
&gt;&gt;
&gt;&gt; 2012-05-30 21:29:50.591 [info]
&gt;&gt; &lt;0.72.0&gt;@riak_core_sysmon_handler:handle_event:85 monitor long_gc &lt;0.938.0&gt;
&gt;&gt; [{initial_call,{riak_core_vnode,init,1}},{almost_current_function,{gen_fsm,loop,7}},{message_queue_len,0}]
&gt;&gt; [{timeout,185},{old_heap_block_size,0},{heap_block_size,2584},{mbuf_size,0},{stack_size,55},{old_heap_size,0},{heap_size,804}]
&gt;&gt;
&gt;&gt; The cluster is set up uniformly. Ubuntu 64bit, m2.2xlarge instance. Riak
&gt;&gt; 1.1.2 with LevelDB backend.
&gt;&gt;
&gt;&gt; What would be the best course of actions for me?
&gt;&gt;
&gt;&gt; I plan to:
&gt;&gt;
&gt;&gt; - riak-admin leave on that node
&gt;&gt; - set up new instance
&gt;&gt; - riak-admin reip the new instance
&gt;&gt; - riak-admin join it to the cluster
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt; Nam
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07585.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07586">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07586">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07587.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07579.html">Strange spike</a></span> <span class="sender italic">Nam Nguyen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07581.html">Re: Strange spike</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07585.html">Re: Strange spike</a></span> <span class="sender italic">Nam Nguyen</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Strange spike</span> <span class="sender italic">Seth Benton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07587.html">Re: Strange spike</a></span> <span class="sender italic">Nam Nguyen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07590.html">Java Client: Connection pool recovery.</a></span> <span class="sender italic">Guido Medina</span></li>
<li class="icons-email"><span class="subject"><a href="msg07594.html">Re: Strange spike</a></span> <span class="sender italic">Nam Nguyen</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Strange spike">
<input type="hidden" name="msgid" value="CAHb+m-FwURgH0OUABgggXNjDXBdrUNmLsZ+_XSz7d6es_VfnLg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07586.html">
<input type="submit" value=" Seth Benton ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strange+spike%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07585.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07587.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAHb+m-FwURgH0OUABgggXNjDXBdrUNmLsZ+_XSz7d6es_VfnLg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
