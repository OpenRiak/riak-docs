<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: How you are dealing with spikes?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15342" id="c">
<link rel="index" href="maillist.html#15342" id="i">
<link rel="prev" href="msg15341.html" id="p">
<link rel="next" href="msg15398.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15342.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+you+are+dealing+with+spikes%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: How you are dealing with spikes?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Bryan+Hunt%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Bryan Hunt</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20141209" rel="nofollow">Tue, 09 Dec 2014 09:56:21 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey Alexander,
The times are missing from the leftmost graph (requests). We also don't
recommend mapreduce and 2i for user initiated requests. You would have much
more stable response times if you  precalculated that stuff (just as when
using a relational database). mapreduce and 2i are coverage queries,
meaning that typically they will hit 1/3 of your nodes.</pre><pre>

Bryan
On 9 Dec 2014 16:55, &quot;Alexander Popov&quot; &lt;mogada...@gmail.com&gt; wrote:

&gt; Stats when  recent spike  happens for 15 minutes around it
&gt;  get  (826)
&gt;  save  (341)
&gt;  listByIndex  (1161)
&gt;  mapReduce  (621)  //Input is IDs list
&gt;  SOLR  (4294)
&gt;
&gt; 6 Solr requests was longer than 9sec ( all returns 0 rows )
&gt; 4 Solr requests was longer within 4-5s ( both returns 0 rows )
&gt; 11 listByIndex requests was longer than within 4-5s ( both returns 0 rows )
&gt; all another requests was less than 300ms
&gt;
&gt;
&gt; Sometimes more load do not make such spikes
&gt; Some graphs from  maintanance tasks:
&gt; 1. <a  rel="nofollow" href="http://i.imgur.com/xAE6B06.png">http://i.imgur.com/xAE6B06.png</a>
&gt;     3 simple tasks, first 2  of them reads  all keys, decide to do
&gt; nothing and continue so just read happens, third task resave all data
&gt; in bucket.
&gt;     since  rate is pretty good, some peaks happens
&gt;
&gt; 2. More complex task
&gt; <a  rel="nofollow" href="http://i.imgur.com/7nwHb3Q.png">http://i.imgur.com/7nwHb3Q.png</a>,  it have  more serious computing, and
&gt; updating typed bucked( map ), but no peaks to 9s
&gt;
&gt;
&gt;
&gt; sysctl -a | fgrep vm.dirty_:
&gt;
&gt; vm.dirty_background_bytes = 0
&gt; vm.dirty_background_ratio = 10
&gt; vm.dirty_bytes = 0
&gt; vm.dirty_expire_centisecs = 3000
&gt; vm.dirty_ratio = 20
&gt; vm.dirty_writeback_centisecs = 500
&gt;
&gt; On Tue, Dec 9, 2014 at 5:46 PM, Luke Bakken &lt;lbak...@basho.com&gt; wrote:
&gt; &gt; Hi Alexander,
&gt; &gt;
&gt; &gt; Can you comment on the read vs. write load of this cluster/
&gt; &gt;
&gt; &gt; Could you please run the following command and reply with the output?
&gt; &gt;
&gt; &gt; sysctl -a | fgrep vm.dirty_
&gt; &gt;
&gt; &gt; We've seen cases where dirty pages get written in a synchronous manner
&gt; &gt; all at once, causing latency spikes due to I/O blocking.
&gt; &gt; --
&gt; &gt; Luke Bakken
&gt; &gt; Engineer / CSE
&gt; &gt; lbak...@basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; On Tue, Dec 9, 2014 at 4:58 AM, Alexander Popov &lt;mogada...@gmail.com&gt;
&gt; wrote:
&gt; &gt;&gt; I have Riak 2.0.1 cluster with 5 nodes ( ec2 m3-large ) with elnm in
&gt; front
&gt; &gt;&gt; sometimes I got spikes  up to 10 seconds
&gt; &gt;&gt;
&gt; &gt;&gt; I can't say that I have  huge load at this time,  max 200 requests per
&gt; &gt;&gt; second for all 5 nodes.
&gt; &gt;&gt;
&gt; &gt;&gt; Most expensive queries is
&gt; &gt;&gt; * list by secondary index ( usually returns from 0 to 100 records  )
&gt; &gt;&gt; * and solr queries( max 10 records )
&gt; &gt;&gt;
&gt; &gt;&gt; save operations  is slowdown sometimes but not so much ( up to 1 sec )
&gt; &gt;&gt;
&gt; &gt;&gt; It's slowdown not for specific requests, same one work pretty fast
&gt; later.
&gt; &gt;&gt;
&gt; &gt;&gt; Does it any possibilities to profile|log somehow to determine reason
&gt; &gt;&gt; why this happen?
&gt; &gt;&gt;
&gt; &gt;&gt; _______________________________________________
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15341.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15342">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15342">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15398.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg15336.html">How you are dealing with spikes?</a></span> <span class="sender italic">Alexander Popov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15338.html">Re: How you are dealing with spikes?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15341.html">Re: How you are dealing with spikes?</a></span> <span class="sender italic">Alexander Popov</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: How you are dealing with spikes?</span> <span class="sender italic">Bryan Hunt</span></li>
<li class="icons-email"><span class="subject"><a href="msg15398.html">Re: How you are dealing with spikes?</a></span> <span class="sender italic">Alexander Popov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15434.html">Re: How you are dealing with spikes?</a></span> <span class="sender italic">Alexander Popov</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: How you are dealing with spikes?">
<input type="hidden" name="msgid" value="CAN81Tr_AKCRZN=g1-BD=UNS-uoCcA0cEbQPnoRGRFOMW56222g@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15342.html">
<input type="submit" value=" Bryan Hunt ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+you+are+dealing+with+spikes%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15341.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15398.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAN81Tr_AKCRZN=g1-BD=UNS-uoCcA0cEbQPnoRGRFOMW56222g@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
