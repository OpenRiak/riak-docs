<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Truncated bit-cask files</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17975" id="c">
<link rel="index" href="maillist.html#17975" id="i">
<link rel="prev" href="msg17974.html" id="p">
<link rel="next" href="msg17978.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17975.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Truncated+bit%5C-cask+files%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Truncated bit-cask files</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Magnus+Kessler%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Magnus Kessler</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170214" rel="nofollow">Tue, 14 Feb 2017 01:50:27 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On 13 February 2017 at 19:56, Arun Rajagopalan &lt;arun.v.rajagopa...@gmail.com
&gt; wrote:</pre><pre>

&gt; Hello Riak Users
&gt;
&gt; We have situations where we dont or cant gracefully stop riak. When that
&gt; happens we occasionally get a truncated last-record in bitcask files
&gt;
&gt; If I delete those bitcask dir and the anti_entropy directory, Riak
&gt; rebuilds those bitcask files correctly
&gt;
&gt; Is there a way to rectify those borken bitcask files ?
&gt;
&gt; Thanks
&gt; Arun
&gt;
&gt;
&gt;
Hi Arun,

There should be no need to remove truncated bitcask files. Any objects up
to the point of truncation should still be available to Riak. However, it
may take longer for the affected partition to start up, as the
corresponding hint file will not match the data file, and Riak will scan
the latter to populate the key set it keeps in memory.

By removing anti_entropy files you are forcing the AAE trees to be rebuilt.
Once this has completed, AAE will fill back any objects missing due to the
truncated bitcask files. You can also force a full partition repair by
following the instructions from the documentation [0].

Can you let me know why you cannot shut down the node gracefully? Unclean
shutdowns should be a last resort and not part of normal operating
procedures.

Kind Regards,

Magnus


[0]:
<a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.2.0/using/repair-recovery/repairs/#repairing-partitions">http://docs.basho.com/riak/kv/2.2.0/using/repair-recovery/repairs/#repairing-partitions</a>
.

-- 
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17974.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17975">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17975">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17978.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17974.html">Truncated bit-cask files</a></span> <span class="sender italic">Arun Rajagopalan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Truncated bit-cask files</span> <span class="sender italic">Magnus Kessler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17978.html">Re: Truncated bit-cask files</a></span> <span class="sender italic">Arun Rajagopalan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17979.html">Re: Truncated bit-cask files</a></span> <span class="sender italic">Magnus Kessler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17980.html">Re: Truncated bit-cask files</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17982.html">Re: Truncated bit-cask files</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17983.html">Re: Truncated bit-cask fil...</a></span> <span class="sender italic">Arun Rajagopalan</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Truncated bit-cask files">
<input type="hidden" name="msgid" value="CAL3YJWafjdMYeSKJhqRMdiTrjFp4JOFqyPrh+bCPbcO5x2RTeA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17975.html">
<input type="submit" value=" Magnus Kessler ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Truncated+bit%5C-cask+files%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17974.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17978.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAL3YJWafjdMYeSKJhqRMdiTrjFp4JOFqyPrh+bCPbcO5x2RTeA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
