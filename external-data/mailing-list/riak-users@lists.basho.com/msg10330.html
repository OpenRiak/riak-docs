<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Protection from listing buckets and other rogue queries</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#10330" id="c">
<link rel="index" href="mail2.html#10330" id="i">
<link rel="prev" href="msg10319.html" id="p">
<link rel="next" href="msg10331.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10330.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Protection+from+listing+buckets+and+other+rogue+queries%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Protection from listing buckets and other rogue queries</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+Daily%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John Daily</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130306" rel="nofollow">Wed, 06 Mar 2013 09:28:49 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I've been asking our engineers for help with this, and here's what I've found...</pre><pre>

In theory, you could use the standard OTP mechanism[1] via the console to stop 
and restart the riak_kv application to stop a (non-MapReduce) query, but that 
has not worked across all versions of Riak. The rolling cluster restart seems 
to be your best bet.


Regarding the HTTP API...

I do not recommend doing this without careful testing, because it doesn't 
appear to be something we or our customers have done, but you should be able to 
comment out the http listener configuration item under riak_core in app.config 
on each node and then restart. In my very, very limited testing, I did have one 
node that seemed to die quietly after making the change, but I've not been able 
to reproduce it and the logs didn't have anything useful.

The administrative console appears to work properly despite the change; the 
only functionality you should lose would be link walking.


It is possible to disable the Webmachine routes that expose bucket and key 
lists, but there's no built-in way to make that configuration change persist 
across restarts, so I haven't looked into the mechanism for that.


[1] application:stop(riak_kv), followed by application:start(riak_kv)

-John Daily
Technical Evangelist
jda...@basho.com



On Mar 5, 2013, at 10:01 AM, Chris Read &lt;chris.r...@gmail.com&gt; wrote:

&gt; Greetings all...
&gt; 
&gt; We have had a situation where someone ran a List Buckets query on the HTTP 
&gt; interface on a large cluster. This caused the whole system to become 
&gt; unresponsive and the only way we could think of to stop the load on the 
&gt; system was to restart the whole cluster. 
&gt; 
&gt; I've spent the morning trawling through the documentation, and can't find 
&gt; answers to the following:
&gt; 
&gt; - Is it possible, and if so how does one go about terminating a query like 
&gt; this? I can see things like Pid in riak-admin top, what can I do with it?
&gt; - Can we run useful things over HTTP like the /admin console but have the 
&gt; rest of the HTTP API disabled?
&gt; 
&gt; Thanks,
&gt; 
&gt; Chris
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10319.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#10330">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#10330">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10331.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10319.html">Protection from listing buckets and other rogue queries</a></span> <span class="sender italic">Chris Read</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Protection from listing buckets and other rogue q...</span> <span class="sender italic">John Daily</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10331.html">Re: Protection from listing buckets and other rog...</a></span> <span class="sender italic">John E. Vincent</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10335.html">Re: Protection from listing buckets and other...</a></span> <span class="sender italic">Chris Read</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Protection from listing buckets and other rogue queries">
<input type="hidden" name="msgid" value="BFFA553F-8916-48C8-B4EC-EDD17150D403@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10330.html">
<input type="submit" value=" John Daily ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Protection+from+listing+buckets+and+other+rogue+queries%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10319.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10331.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BFFA553F-8916-48C8-B4EC-EDD17150D403@basho.com</li>
</ul>
</div>
</body>
</html>
