<!DOCTYPE html>
<html lang="en">
<head>
<title>Basho Product Alert: Socket reuse issue with Riak Golang client 1.5.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17098" id="c">
<link rel="index" href="maillist.html#17098" id="i">
<link rel="prev" href="msg17093.html" id="p">
<link rel="next" href="msg17099.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17098.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Basho+Product+Alert%5C%3A+Socket+reuse+issue+with+Riak+Golang+client+1.5.1%22&amp;o=newest" rel="nofollow"><span itemprop="name">Basho Product Alert: Socket reuse issue with Riak Golang client 1.5.1</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Seema+Jethani%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Seema Jethani</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160303" rel="nofollow">Thu, 03 Mar 2016 10:30:40 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Overview

When using the Riak golang client 1.5.1, if the socket read timeout is
exceeded during execution of a Riak request, data may be contaminated
between subsequent requests that use the same socket. The product advisory
has been posted here:
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/community/product-advisories/">http://docs.basho.com/riak/latest/community/product-advisories/</a></pre><pre>

Description

When using the Riak golang client 1.5.1, if the socket read timeout is
exceeded during execution of a Riak request, instead of closing it, the
connection will be returned to the connection pool for use by a different
request. The server still sends a response on that socket and it will be
available the next time the socket is read. If the socket is provided by
the connection pool, the next request will read data from Riak intended for
the original request.

If the next request is of a different type than the first that timed out,
you will see an error similar to the following raised by the golang
client: expected
response code X, got: Y. If the next request is of the same type as the
first one that timed out, the original possibly unrelated response, will be
returned by the client library without logging any message.

Affected Users

This issue will affect you only if both of the following are true:

   - You are using the golang 1.5.1 client, AND
   - The client request timeout is being hit.

Impact

Results from client requests may be returned against the wrong call. For
example, results from a previous search request may be returned instead of
the correct ones.

If it occurs in a GET/PUT cycles this may result in the incorrect GET
response being used in a PUT request, leaving the object permanently
modified.

Mitigation Strategy

Downgrade to 1.5.0 or upgrade to the 1.6.0 Golang client which can be found
here: <a  rel="nofollow" href="https://github.com/basho/riak-go-client/releases">https://github.com/basho/riak-go-client/releases</a>

If you cannot upgrade, set RequestTimeout in NodeOptions to be a very large
value (5 minutes, for instance) to reduce the likelihood of the socket
being reused.

-- 
Seema Jethani
Director of Product Management, Basho &lt;<a  rel="nofollow" href="http://basho.com">http://basho.com</a>&gt;
4083455739 | @seemaj &lt;<a  rel="nofollow" href="http://twitter.com/seemaj">http://twitter.com/seemaj</a>&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17093.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17098">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17098">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17099.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Basho Product Alert: Socket reuse issue with Riak Golang client 1.5.1">
<input type="hidden" name="msgid" value="CAJSrNH1B92S-G9Q0ebgcMtaFXt2FjmHuX8AYPTA0rc=mdRgMEQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17098.html">
<input type="submit" value=" Seema Jethani ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Basho+Product+Alert%5C%3A+Socket+reuse+issue+with+Riak+Golang+client+1.5.1%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17093.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17099.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAJSrNH1B92S-G9Q0ebgcMtaFXt2FjmHuX8AYPTA0rc=mdRgMEQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
