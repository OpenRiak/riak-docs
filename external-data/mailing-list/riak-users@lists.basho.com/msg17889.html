<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak: leveldb vs multi backend disk usage</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17889" id="c">
<link rel="index" href="maillist.html#17889" id="i">
<link rel="prev" href="msg17888.html" id="p">
<link rel="next" href="msg17890.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17889.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak%5C%3A+leveldb+vs+multi+backend+disk+usage%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak: leveldb vs multi backend disk usage</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Daniel+Miller%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Daniel Miller</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170126" rel="nofollow">Thu, 26 Jan 2017 13:31:28 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Riak Users,

I am in the process of migrating a few Riak CS clusters from mutli to
leveldb backend. I am aware this is not an officially supported
configuration, but I feel it will be better for my (very limited) hardware
constraints, especially RAM, and I am not too concerned about the lower
performance of leveldb vs bitcask.</pre><pre>

First a note on riak configuration (riak.conf): I have changed the
storage_backend from the default value of &quot;multi&quot; to &quot;leveldb&quot; and I have
removed the advanced.conf file from the config dir. According to the
documentation, it seems this is the recommended way to configure Riak to
use the leveldb backend. The rest of the configuration is using defaults
recommended for Riak CS. I could not find any specific documentation on how
to configure Riak CS with leveldb backend, although this is not surprising
since it is not officially supported.

Cluster migration process:
- setup new nodes with the new leveldb backend configuration
- for each new node (in serial):
  - join the node to the cluster (riak-admin cluster join)
  - replace an old node (riak-admin cluster replace)
  - wait for replace to complete and ring ready
  - proceed to next node

The most significant thing I have noticed after migrating a cluster is that
the new leveldb-backend nodes are using significantly less disk space than
the old multi-backend nodes. For example, disk usage is down from 55% to
13% (same size disks on old and new nodes). Is this dramatic difference
expected? I can formulate explanations in my head, but they're based more
on loose assumptions than known behaviors. For example: leveldb uses
compression, bitcask does not, and we have a highly compressible data set
(mostly XML documents). If CS is storing a copy of each document in each
backend in the multi configuration, then it stands to reason that the disk
usage could drop significantly since the data is highly compressible.

I have spot-checked various documents and all data that I've checked is
present on the fully migrated cluster. There are no errors in the logs. I
can see the vnode handoffs triggered by node replacements in the logs and
there are no errors or warnings there, in both the old as well as the new
nodes' logs. The data dir on the old node is nearly empty once a node
replacement has completed, which means all data is being deleted from the
old node during the replacement.

Cluster size is 5 nodes. N-value is the default (3). These have not changed
during the migration.

Thanks in advance for any information you can provide.

Daniel Miller
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17888.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17889">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17889">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17890.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Riak: leveldb vs multi backend disk usage</span> <span class="sender italic">Daniel Miller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17890.html">Re: Riak: leveldb vs multi backend disk usage</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak: leveldb vs multi backend disk usage">
<input type="hidden" name="msgid" value="CADigEi6jVA=x3A6gz4xfYsoVLCK10ZZF_S-5fv5ADT-ug9DAtw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17889.html">
<input type="submit" value=" Daniel Miller ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak%5C%3A+leveldb+vs+multi+backend+disk+usage%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17888.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17890.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CADigEi6jVA=x3A6gz4xfYsoVLCK10ZZF_S-5fv5ADT-ug9DAtw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
