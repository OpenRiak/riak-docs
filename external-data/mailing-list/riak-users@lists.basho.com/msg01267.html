<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Some questions about Riak Search and Riak itself</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01267" id="c">
<link rel="index" href="maillist.html#01267" id="i">
<link rel="prev" href="msg01262.html" id="p">
<link rel="next" href="msg01279.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01267.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Some+questions+about+Riak+Search+and+Riak+itself%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Some questions about Riak Search and Riak itself</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Dmitry+Demeshchuk%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dmitry Demeshchuk</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101013" rel="nofollow">Wed, 13 Oct 2010 06:27:24 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi, Fink. Thank you for your reply. Here are some inline comments.

On Tue, Oct 12, 2010 at 9:42 PM, Bryan Fink &lt;br...@basho.com&gt; wrote:
&gt; On Tue, Oct 12, 2010 at 3:16 AM, Dmitry Demeshchuk &lt;demeshc...@gmail.com&gt; 
&gt; wrote:
&gt;&gt; 1. I tried to put some Erlang terms into Riak bucket that is being
&gt;&gt; indexed by Riak Search. I hoped that key-value lists like this
&gt; ...snip...
&gt;&gt; Is there a way to send Erlang proplists into Riak and process them
&gt;&gt; using Riak Search?
&gt;
&gt; Hi, Dmitry.  We've filed a bug for doing exactly this:
&gt;
&gt; <a  rel="nofollow" href="https://issues.basho.com/show_bug.cgi?id=788">https://issues.basho.com/show_bug.cgi?id=788</a>
&gt;
&gt; In the meantime, you could also write your own extractor.  See the
&gt; &quot;Other Data Encodings&quot; section of using_search.org:
&gt;
&gt; <a  rel="nofollow" href="http://bitbucket.org/basho/riak_search/src/d1f10b876cae/doc/using_search.org#cl-985">http://bitbucket.org/basho/riak_search/src/d1f10b876cae/doc/using_search.org#cl-985</a>
&gt;
&gt; Or on the wiki:
&gt;
&gt; <a  rel="nofollow" href="http://wiki.basho.com/display/RIAK/Riak+Search+-+Indexing+and+Querying+Riak+KV+Data#RiakSearch-IndexingandQueryingRiakKVData-OtherDataEncodings">http://wiki.basho.com/display/RIAK/Riak+Search+-+Indexing+and+Querying+Riak+KV+Data#RiakSearch-IndexingandQueryingRiakKVData-OtherDataEncodings</a>
&gt;
&gt;&gt; 2. Is there a way to query Erlang buckets indexes using any other APIs
&gt;&gt; than REST API? The only way to query the bucket I found was
&gt;&gt;
&gt;&gt; /solr/some_bucket/select
&gt;&gt;
&gt;&gt; and my attempts of using Riak Search shell and Erlang API just failed.
&gt;
&gt; If you could posts details about the ways in which your attempts
&gt; failed (error messages, etc.), we might be able to help you
&gt; troubleshoot them.
&gt;
&gt; The other main way of querying Search indexes is using the map/reduce
&gt; Search input.  The &quot;Querying via HTTP/Curl&quot; section has an example of
&gt; how to hook this up:
&gt;
&gt; <a  rel="nofollow" href="http://bitbucket.org/basho/riak_search/src/d1f10b876cae/doc/using_search.org#cl-783">http://bitbucket.org/basho/riak_search/src/d1f10b876cae/doc/using_search.org#cl-783</a>
&gt;
&gt; <a  rel="nofollow" href="http://wiki.basho.com/display/RIAK/Riak+Search+-+Querying#RiakSearch-Querying-QueryingviaHTTP%2FCurl">http://wiki.basho.com/display/RIAK/Riak+Search+-+Querying#RiakSearch-Querying-QueryingviaHTTP%2FCurl</a>
&gt;
&gt; And it's also possible to specify the same map/reduce input using any
&gt; of the Erlang clients (native, protocol buffer, or http).  Though
&gt; there is a small bug with the non-streaming native Erlang client at
&gt; the moment (<a  rel="nofollow" href="https://issues.basho.com/show_bug.cgi?id=803">https://issues.basho.com/show_bug.cgi?id=803</a>).  For an
&gt; example of using that syntax, have a look at the Wriaki project:
&gt;
&gt; <a  rel="nofollow" href="http://bitbucket.org/basho/wriaki/src/d2334be214ce/apps/wriaki/src/wiki_resource.erl#cl-267">http://bitbucket.org/basho/wriaki/src/d2334be214ce/apps/wriaki/src/wiki_resource.erl#cl-267</a></pre><pre>

I worked it out. Both shell and command-line search work good. Seems
like I've been doing something wrong before.

&gt;
&gt;&gt; 3. Is there a way to write custom analyzers in non-java languages? I
&gt;&gt; saw the same question and found an answer that analyzer automatically
&gt;&gt; tries to start JVM for its needs. The problem is that we don't have
&gt;&gt; good Java and JVM developers so it would be better to use some other
&gt;&gt; solutions (like OCaml or even C, for example). Also, I'm kinda
&gt;&gt; suspicious about Java analyzers performance.
&gt;
&gt; At the moment, the only non-Java language supported for custom
&gt; analyzers is Erlang.  You can specify an Erlang analyzer by adding an
&gt; &quot;analyzer_factory&quot; entry to your schema, of the form:
&gt;
&gt;   {analyzer_factory, {erlang, my_modlue, my_function}}
&gt;
&gt; Other formats for the analyzer_factory setting are:
&gt;
&gt;   {erlang, my_module, my_function, Arguments}
&gt;   {java, FullyQualifiedClassNameAsString}
&gt;   {java, FullyQualifiedClassNameAsString, Arguments}
&gt;   FullyQualifiedClassNameAsString
&gt;
&gt; The last format is demonstrated in the &quot;Defining a Schema&quot; section of the 
&gt; docs:
&gt;
&gt; <a  rel="nofollow" href="http://bitbucket.org/basho/riak_search/src/d1f10b876cae/doc/using_search.org#cl-193">http://bitbucket.org/basho/riak_search/src/d1f10b876cae/doc/using_search.org#cl-193</a>
&gt;
&gt; <a  rel="nofollow" href="http://wiki.basho.com/display/RIAK/Riak+Search+-+Schema#RiakSearch-Schema-DefiningaSchema">http://wiki.basho.com/display/RIAK/Riak+Search+-+Schema#RiakSearch-Schema-DefiningaSchema</a>
&gt;
&gt; Unfortunately, we haven't written much documentation about what an
&gt; analyzer is expected to do, but hopefully between the comments in
&gt; qilr_analyzer, and the default Erlang analyzer,
&gt; text_analyzers:default_analyzer_factory/2, you'll be able to work out
&gt; some of what you need.
&gt;
&gt; <a  rel="nofollow" href="http://bitbucket.org/basho/riak_search/src/d1f10b876cae/apps/qilr/src/qilr_analyzer.erl#cl-53">http://bitbucket.org/basho/riak_search/src/d1f10b876cae/apps/qilr/src/qilr_analyzer.erl#cl-53</a>
&gt;
&gt; <a  rel="nofollow" href="http://bitbucket.org/basho/riak_search/src/d1f10b876cae/apps/qilr/src/text_analyzers.erl">http://bitbucket.org/basho/riak_search/src/d1f10b876cae/apps/qilr/src/text_analyzers.erl</a>
&gt;
&gt;&gt; 4. Do you have any tips and advice about working with Unicode in Riak Search?
&gt;
&gt; Encode everything in UTF-8.  There may still be a few bugs we need to
&gt; work out, but our intended goal is to have everything in that
&gt; department &quot;just work&quot; once you're using UTF-8 everywhere.

I'm not sure if I do everything right but here's the step-by step
description of my actions:

1.  curl -v -d &quot;{\&quot;title\&quot;:\&quot;Статья 1\&quot;, \&quot;tags\&quot;:\&quot;псто, лытдыбр\&quot;,
\&quot;body\&quot;:\&quot;Я что-то здесь написал\&quot;}&quot; -H &quot;Content-Type:
application/json&quot; <a  rel="nofollow" href="http://127.0.0.1:8098/riak/posts">http://127.0.0.1:8098/riak/posts</a>

(Note, there are cyrillic symbols)

2. curl -X POST -H &quot;content-type: application/json&quot;
<a  rel="nofollow" href="http://localhost:8098/mapred">http://localhost:8098/mapred</a> -d '{&quot;inputs&quot;:&quot;posts&quot;,
&quot;query&quot;:[{&quot;map&quot;:{&quot;language&quot;:&quot;javascript&quot;,&quot;source&quot;:&quot;Riak.mapValues&quot;,
&quot;keep&quot;:true}}]}'

The result is:

[&quot;{\&quot;title\&quot;:\&quot;\u0421\u0442\u0430\u0442\u044c\u044f 1\&quot;,
\&quot;tags\&quot;:\&quot;\u043f\u0441\u0442\u043e,
\u043b\u044b\u0442\u0434\u044b\u0431\u0440\&quot;, \&quot;body\&quot;:\&quot;\u042f
\u0447\u0442\u043e-\u0442\u043e \u0437\u0434\u0435\u0441\u044c
\u043d\u0430\u043f\u0438\u0441\u0430\u043b\&quot;}&quot;]

So, the cyrillic strings were encoded properly by Riak itself (not
sure if it's on the mochiweb level or somewhere else).

3. curl -X POST -H &quot;content-type: application/json&quot;
<a  rel="nofollow" href="http://localhost:8098/mapred">http://localhost:8098/mapred</a> -d '{&quot;inputs&quot;:{&quot;module&quot;:&quot;riak_search&quot;,
&quot;function&quot;:&quot;mapred_search&quot;, &quot;arg&quot;: [&quot;posts&quot;, &quot;title:Статья*&quot;]},
&quot;query&quot;:[{&quot;map&quot;:{&quot;language&quot;:&quot;javascript&quot;,&quot;source&quot;:&quot;Riak.mapValues&quot;,
&quot;keep&quot;:true}}]}'

This is a map-reduce Riak Search request. It's expected to return the
previously posted document. However, it returns an empty list.

4. Tried both shell and command-line search - the same result.

5. If I try to reproduce the same using latin characters, everything
just works fine. The JSON data may be partially cyrillic - in that
case search works on the latin fields only.


Am I doing something wrong? Should I encode characters somehow before
I send them into RiakSearch?


Thanks.


&gt;
&gt; -Bryan
&gt;



-- 
Best regards,
Dmitry Demeshchuk

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01262.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01267">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01267">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01279.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01259.html">Some questions about Riak Search and Riak itself</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01262.html">Re: Some questions about Riak Search and Riak itsel...</a></span> <span class="sender italic">Bryan Fink</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Some questions about Riak Search and Riak i...</span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01279.html">Re: Some questions about Riak Search and Ri...</a></span> <span class="sender italic">Bryan Fink</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01282.html">Re: Some questions about Riak Search an...</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li class="icons-email"><span class="subject"><a href="msg01291.html">Re: Some questions about Riak Search an...</a></span> <span class="sender italic">Bryan Fink</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Some questions about Riak Search and Riak itself">
<input type="hidden" name="msgid" value="AANLkTimP5x_bWx=7gCYwE6hScBsKTKwNmHmEKtV13E4h@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01267.html">
<input type="submit" value=" Dmitry Demeshchuk ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Some+questions+about+Riak+Search+and+Riak+itself%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01262.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01279.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTimP5x_bWx=7gCYwE6hScBsKTKwNmHmEKtV13E4h@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
