<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Secondary Indices and Storing Binary Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03212" id="c">
<link rel="index" href="maillist.html#03212" id="i">
<link rel="prev" href="msg03207.html" id="p">
<link rel="next" href="msg03209.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03212.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Secondary+Indices+and+Storing+Binary+Data%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Secondary Indices and Storing Binary Data</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Rusty+Klophaus%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Rusty Klophaus</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110503" rel="nofollow">Tue, 03 May 2011 12:48:47 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Runar,

Our current prototype of Secondary Indices works like this:</pre><pre>

- You tell the system how to index an object by &quot;tagging&quot; it with
field/value pairs. The tags are passed to Riak via object metadata,
currently sent via HTTP headers. I believe this answers your main question.

- Those who would rather have implicit indexing can set up a pre-commit hook
to extract field/value pairs and tag the object on the fly at write time.
This would also be the recommended way to handle corner cases like
field/value pairs that can't fit in an HTTP header.

- We're initially targeting a SQL-ish type language for querying, with
support for exact match and range queries.

We're still in the process of designing how to expose the functionality, so
other parts of the interface are in flux. As one of my favorite quotes goes:
&quot;API design is like sex: make one mistake and support it for the rest of
your life.&quot; (@joshbloch)

Best,
Rusty


On Tue, May 3, 2011 at 9:28 AM, Eric Moritz &lt;e...@themoritzfamily.com&gt;wrote:

&gt; If what Alexander is saying is true, what you would need to do is
&gt; create your own commit hook that would look for a custom HTTP header:
&gt;
&gt; X-RIAK-INDEX: {&quot;field1&quot;: &quot;value1&quot;, &quot;field2&quot;: &quot;value2&quot;}
&gt;
&gt; That hook would use that header to index on instead of the Riak
&gt; Object's value.  There are limitations to this approach such as a size
&gt; limit on HTTP headers and the header value would have to be on one
&gt; line.  I think that given that secondary indexes are usually small
&gt; simple values, the size limitation probably won't come up.  In
&gt; addition, producing JSON on a single line is easy because new lines in
&gt; string values are automatically escaped.
&gt;
&gt; The worse (or best) part about this is you would have to write the
&gt; commit hook in Erlang if the current search hook is any indicator of
&gt; what the secondary indexes hook will look like.
&gt;
&gt; Eric Moritz.
&gt;
&gt; On Tue, May 3, 2011 at 11:18 AM, Alexander Sicular &lt;sicul...@gmail.com&gt;
&gt; wrote:
&gt; &gt; I think all that is yet to be determined, from a public standpoint (I
&gt; &gt; don't know any more than anyone not working at Basho). If secondary
&gt; &gt; indexes are implemented (interface wise) in a similar fashion as Riak
&gt; &gt; Search then I would imagine that the index would be enabled as a hook
&gt; &gt; at write time. Either a hook at write time (which I would imagine will
&gt; &gt; be the method employed) or some other mechanism, Riak would need to be
&gt; &gt; able to understand the value you are writing to disk to be able to
&gt; &gt; index it properly. Meaning that whichever way you are encoding your
&gt; &gt; object, Riak would need to be able to decode it in the two languages
&gt; &gt; that it speaks - javascript or erlang.
&gt; &gt;
&gt; &gt; Cheers,
&gt; &gt; Alexander
&gt; &gt;
&gt; &gt; On Tue, May 3, 2011 at 08:55, Runar Jordahl &lt;runar.jord...@gmail.com&gt;
&gt; wrote:
&gt; &gt;&gt; I am working on a solution where an object graph (for example a full
&gt; &gt;&gt; insurace contract) is serialized to binary data and stored as a single
&gt; &gt;&gt; Riak object. Upon saving the binary data to Riak, I will extract the
&gt; &gt;&gt; fields needed for indexing and (hopefully) use the upcoming “secondary
&gt; &gt;&gt; indices” ( <a  rel="nofollow" href="http://www.oscon.com/oscon2011/public/schedule/detail/19806">http://www.oscon.com/oscon2011/public/schedule/detail/19806</a>
&gt; &gt;&gt; ) to index the object based on the extracted data.
&gt; &gt;&gt;
&gt; &gt;&gt; How will this work with the upcoming secondary indices feature? Will I
&gt; &gt;&gt; need to store all data (index data and binary data) as a single JSON
&gt; &gt;&gt; object, using base-encoding for the binary part? Or, will I be able to
&gt; &gt;&gt; use custom headers for the indices, storing only raw binary data as
&gt; &gt;&gt; the main content?
&gt; &gt;&gt;
&gt; &gt;&gt; Kind regards
&gt; &gt;&gt; Runar
&gt; &gt;&gt;
&gt; &gt;&gt; _______________________________________________
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03207.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03212">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03212">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03209.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03200.html">Secondary Indices and Storing Binary Data</a></span> <span class="sender italic">Runar Jordahl</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03204.html">Re: Secondary Indices and Storing Binary Data</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03207.html">Re: Secondary Indices and Storing Binary Data</a></span> <span class="sender italic">Eric Moritz</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Secondary Indices and Storing Binary Da...</span> <span class="sender italic">Rusty Klophaus</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Secondary Indices and Storing Binary Data">
<input type="hidden" name="msgid" value="BANLkTik06PZg62QJz_Fybr6sSE29UhJ6bg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03212.html">
<input type="submit" value=" Rusty Klophaus ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Secondary+Indices+and+Storing+Binary+Data%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03207.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03209.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BANLkTik06PZg62QJz_Fybr6sSE29UhJ6bg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
