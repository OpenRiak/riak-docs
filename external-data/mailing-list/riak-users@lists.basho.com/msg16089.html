<!DOCTYPE html>
<html lang="en">
<head>
<title>Product Advisory - Riak 2.1.0: Default Configuration For Handoff May	Cause Data Loss</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16089" id="c">
<link rel="index" href="maillist.html#16089" id="i">
<link rel="prev" href="msg16088.html" id="p">
<link rel="next" href="msg16090.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16089.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Product+Advisory+%5C-+Riak+2.1.0%5C%3A+Default+Configuration+For+Handoff+May%09Cause+Data+Loss%22&amp;o=newest" rel="nofollow"><span itemprop="name">Product Advisory - Riak 2.1.0: Default Configuration For Handoff May	Cause Data Loss</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Tyler+Hannan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Tyler Hannan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150501" rel="nofollow">Fri, 01 May 2015 11:37:55 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>-Description-

In Riak 2.1.0, the default configuration for handoff.ip causes vnodes
marked for transfer during handoff to be removed without transferring
data to their new destination nodes. A mandatory change to
configuration (riak.conf) will resolve this issue. While not all users
are impacted by this issue, we recommend that all 2.1.0 users upgrade
to 2.1.1 which will be released shortly.</pre><pre>

NOTE: This is known to occur for ownership handoff. Investigation as
to whether hinted handoff is affected is ongoing and this advisory
will be updated when more information is available.

-Affected Users-

All users of 2.1.0 using riak.conf to configure their clusters are
potentially impacted. Users that are using app.config and vm.args to
configure their clusters are unaffected but should upgrade to 2.1.1
upon release.

To verify whether you are affected, the below command must be run on
each node in your cluster:
     riak config effective | grep handoff.ip

Affected nodes will have a handoff ip of 127.0.0.1
     handoff.ip = 127.0.0.1

-Impact-

This bug impacts vnodes that are in process of handoff. Handoff data
will be looped back to the source node during ownership handoff rather
than being transferred to the destination node. Once ownership handoff
is completed the data is removed from the source node. In the event of
significant ownership handoff, which can happen during cluster
expansion or contraction, all replicas of an object may be lost. Data
loss occurs if all replicas of an object are lost as a result of this
configuration issue. Replica loss can be triggered by cluster
membership changes or other Riak cluster activity that triggers
handoff behavior. Data loss is mitigated as long as at least one
replica still exists and the below steps are followed.

-Mitigation-

You can immediately mitigate the issue by setting transfer limit to
zero across the cluster by issuing the following on any node:

     riak-admin transfer-limit 0

Then configure handoff.ip in riak.conf to an external IP address or
0.0.0.0 on all nodes.

Perform a rolling restart of Riak across your cluster to activate the
new setting.

After correcting the configuration and restarting the nodes, you
should run Riak KV repair on each cluster member as documented at
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/running/recovery/repairing-partitions/">http://docs.basho.com/riak/latest/ops/running/recovery/repairing-partitions/</a>
to recreate any missing replicas from available replicas elsewhere in
the cluster.  It is recommended to perform the Riak KV repair in a
round-robin fashion on each node of your cluster (node0, node1, node2,
etc). Repeat this round-robin repair “n_val - 1” times. For example:
the default configuration for n_val is 3, which means you would run
Riak KV repair twice across the entire cluster.

NOTE: It is important to ensure that you execute in a round-robin
fashion: node0, node1, node2 and then repeat.

A forthcoming 2.1.1 release will provide an updated default configuration.

Questions?

Please open a ticket with Basho if you have any questions about the above issue.

Cheers,

Tyler Hannan  |  Director of Technical Marketing
Basho Technologies
t: @tylerhannan
c: 720-280-9216

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16088.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16089">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16089">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16090.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Product Advisory - Riak 2.1.0: Default Configuration For Hand...</span> <span class="sender italic">Tyler Hannan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16090.html">Re: Product Advisory - Riak 2.1.0: Default Configuration...</a></span> <span class="sender italic">Tyler Hannan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16118.html">Re: Product Advisory - Riak 2.1.0: Default Configura...</a></span> <span class="sender italic">Tyler Hannan</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Product Advisory - Riak 2.1.0: Default Configuration For Handoff May	Cause Data Loss">
<input type="hidden" name="msgid" value="CAGWeSyA3L770VAHBKF_aML0XW_AADh9BEDGkszLkhNHPM_c6yA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16089.html">
<input type="submit" value=" Tyler Hannan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Product+Advisory+%5C-+Riak+2.1.0%5C%3A+Default+Configuration+For+Handoff+May%09Cause+Data+Loss%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16088.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16090.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGWeSyA3L770VAHBKF_aML0XW_AADh9BEDGkszLkhNHPM_c6yA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
