<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Query data with Riak TS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17745" id="c">
<link rel="index" href="maillist.html#17745" id="i">
<link rel="prev" href="msg17744.html" id="p">
<link rel="next" href="msg17794.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17745.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Query+data+with+Riak+TS%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Query data with Riak TS</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Andrei+Zavada%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Andrei Zavada</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20161114" rel="nofollow">Mon, 14 Nov 2016 08:07:09 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Mon, Nov 14, 2016 at 5:44 PM, Jan Paulus &lt;pau...@next-kraftwerke.de&gt;
wrote:</pre><pre>

&gt; Hello Andrei,
&gt;
&gt;
&gt;
&gt; thanks for the answer. It is good news that 1.5 will get the ODER BY and
&gt; LIMIT functionality.
&gt;
&gt; Unfortunately the current AVG implementation is not exactly what we are
&gt; looking for. The current implementation will sum up all points in the time
&gt; range and will it divide by the number of points. Currently Riak TS return
&gt; 4.5 for my example. We are looking for an average which takes into account
&gt; how long a value was persistent.
&gt;
&gt; ​
This​ seems to be a peculiar requirement that Riak TS cannot accommodate
(sorry for not reading your explanation carefully enough).  Indeed, the AVG
function operates on numeric values as isolated scalars, and has no
knowledge of how long each value has persisted.


&gt;
&gt; Kind Regards,
&gt;
&gt; Jan Paulus
&gt;
&gt;
&gt;
&gt; *Von:* Andrei Zavada [<a  rel="nofollow" href="mailto:azav...@contractor.basho.com">mailto:azav...@contractor.basho.com</a>]
&gt; *Gesendet:* Montag, 14. November 2016 16:19
&gt; *An:* Jan Paulus
&gt; *Cc:* riak-users@lists.basho.com
&gt; *Betreff:* Re: Query data with Riak TS
&gt;
&gt;
&gt;
&gt; Hello Jan,
&gt;
&gt;
&gt;
&gt; R​eplying to your questions inline:​​
&gt;
&gt; ​
&gt;
&gt;  Hi,
&gt;
&gt; we are testing Riak TS for our Application right now. I have a couple of
&gt; question how to query the data. We are measuring electric power which comes
&gt; in in odd time intervals.
&gt;
&gt;
&gt;
&gt; 1. Is it possible to query the value which has been received bevor at a
&gt; given time? In other words: Get the current / last value of a series.
&gt;
&gt;
&gt;
&gt; In Riak TS 1.4 (the latest release), you still have to specify the exact
&gt; range ​in the WHERE clause.  Because of that, if you are only interested
&gt; in a single record that was added last before a certain time, you have to
&gt; do some guesswork to arrive at the suitable boundaries.  Depending on the
&gt; rate of data ingress, the selection returned may contain one, a few, too
&gt; many, or no results at all.  One workaround is to issue a sequence of
&gt; SELECTs, starting from a small range, with the lower boundary of the range
&gt; progressively moved back until you have the last record included (and
&gt; hopefully not many previous records which you are going to discard anyway).
&gt;
&gt;
&gt;
&gt; In 1.5, we will support ORDER BY and LIMIT clauses which will allow a much
&gt; simpler solution, e.g.:
&gt;
&gt;
&gt;
&gt;  SELECT value FROM table
&gt;  WHERE time &gt; 0 AND time &lt; $now
&gt;  ORDER BY value DESC LIMIT 1
&gt;
&gt;
&gt;
&gt; 2. Is it possible to query the average in respect to time?
&gt; For instance you have such a measurement reading:
&gt; time    | value
&gt; -----------------
&gt; 09:31   |  4
&gt; 10:02   |  6
&gt; 10:05   |  3
&gt; And you want to query the average from 10:00 to 10:10. I would expect a
&gt; value of 4.1
&gt; 4 * 20% + 6 * 30% + 3 * 50% = 4.1
&gt;
&gt;
&gt;
&gt; ​It is definitely possible:​
&gt;
&gt;
&gt;
&gt;  ﻿⁠⁠⁠⁠SELECT AVG(val
&gt;
&gt; ​ue​
&gt;
&gt; ) FROM
&gt;
&gt; ​table
&gt;
&gt; ​
&gt;
&gt;  WHERE time &gt;
&gt;
&gt; ​=​
&gt;
&gt; ​'​2016-11-22
&gt;
&gt; 10
&gt;
&gt; ​:00'​
&gt;
&gt; AND time &lt;
&gt;
&gt; ​'2016-11-22 ​
&gt;
&gt; ​10:10'​
&gt;
&gt;
&gt;
&gt; ​Note that you can specify timestamp values in ISO8601 format:
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/ts/1.4.0/using/timerepresentations">http://docs.basho.com/riak/ts/1.4.0/using/timerepresentations</a>
&gt;
&gt;
&gt;
&gt; ​
&gt;
&gt; 3. Is it possible to query 15 minutes average values for the last day? I
&gt; would expect 96 values with the average as described in question 2.
&gt;
&gt;
&gt;
&gt; No, you will have to issue 96 separate queries, each similar to the one in
&gt; (2) but with a different 15-min range.​
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; Thanks a lot.
&gt; Jan Paulus
&gt;
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17744.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17745">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17745">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17794.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17742.html">Query data with Riak TS</a></span> <span class="sender italic">Jan Paulus</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17743.html">Re: Query data with Riak TS</a></span> <span class="sender italic">Andrei Zavada</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17744.html">AW: Query data with Riak TS</a></span> <span class="sender italic">Jan Paulus</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Query data with Riak TS</span> <span class="sender italic">Andrei Zavada</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17794.html">Re: Query data with Riak TS</a></span> <span class="sender italic">Stephen Etheridge</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Query data with Riak TS">
<input type="hidden" name="msgid" value="CANkxB92yyTZ2jOhYdDYzXR21kLn5Tv0hwkfsMrG_6HowogDh-A@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17745.html">
<input type="submit" value=" Andrei Zavada ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Query+data+with+Riak+TS%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17744.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17794.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANkxB92yyTZ2jOhYdDYzXR21kLn5Tv0hwkfsMrG_6HowogDh-A@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
