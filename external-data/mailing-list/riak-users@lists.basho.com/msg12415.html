<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Deleting data from LevelDB backend</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd9.html#12415" id="c">
<link rel="index" href="mail9.html#12415" id="i">
<link rel="prev" href="msg12410.html" id="p">
<link rel="next" href="msg12418.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12415.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Deleting+data+from+LevelDB+backend%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Deleting data from LevelDB backend</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Von%5C-Maszewski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Von-Maszewski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130926" rel="nofollow">Thu, 26 Sep 2013 06:08:05 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Simon,

I queried Basho's Client Services group.  They use the following as the 
guideline for leveldb vnode (database) repair:</pre><pre>

   <a  rel="nofollow" href="https://gist.github.com/gburd/b88aee6da7fee81dc036">https://gist.github.com/gburd/b88aee6da7fee81dc036</a>

This repair sequence is different than the one you are quoting.


You do not need to manually delete the MANIFEST file.  The repair sequence will 
do that anyway.

Matthew


On Sep 26, 2013, at 7:04 AM, Simon Effenberg &lt;seffenb...@team.mobile.de&gt; wrote:

&gt; Are we talking about
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/1.3.1/cookbooks/Repairing-KV-Indexes/">http://docs.basho.com/riak/1.3.1/cookbooks/Repairing-KV-Indexes/</a> ?
&gt; 
&gt; and if yes.. is this also doing a repair if data is missing? So after
&gt; executing the &quot;repair&quot; on one node.. will it have afterwards:
&gt; 
&gt; * all keys it should have (like if AAE is fixing stuff through Read
&gt;  Repair)
&gt; * all 2i indices it should have (like the documentation suggest)
&gt; 
&gt; So does it mean a &quot;compaction&quot; is triggered by doing:
&gt; 
&gt; * remove big sst files
&gt; * trigger this REPAIR type &quot;Repairing-KV-Indexes&quot;?
&gt; 
&gt; will this automatically fix the MANIFESTS file?
&gt; 
&gt; Cheers
&gt; Simon
&gt; 
&gt; 
&gt; On Thu, 26 Sep 2013 12:53:40 +0200
&gt; Simon Effenberg &lt;seffenb...@team.mobile.de&gt; wrote:
&gt; 
&gt;&gt; Thanks Matthew,
&gt;&gt; 
&gt;&gt; but one thing I didn't get. If I delete a sst file.. should I delete
&gt;&gt; (by hand) the MANIFEST file to trigger a repair or is it done
&gt;&gt; automatically within Riak if it detects that a sst file which is
&gt;&gt; referenced in the MANIFEST is missing?
&gt;&gt; 
&gt;&gt; Cheers
&gt;&gt; Simon
&gt;&gt; 
&gt;&gt; On Wed, 25 Sep 2013 09:58:51 -0400
&gt;&gt; Matthew Von-Maszewski &lt;matth...@basho.com&gt; wrote:
&gt;&gt; 
&gt;&gt;&gt; Simon,
&gt;&gt;&gt; 
&gt;&gt;&gt; I want to point out again that I do not like my answer … but currently lack 
&gt;&gt;&gt; a better one.  The manual delete of .sst files should be treated as a last 
&gt;&gt;&gt; resort.  Only do it if you really, really cannot wait for normal 
&gt;&gt;&gt; compactions to purge the old data.
&gt;&gt;&gt; 
&gt;&gt;&gt; To your question:
&gt;&gt;&gt; 
&gt;&gt;&gt; leveldb keeps a list of .sst table files in its MANIFEST file.  If the .sst 
&gt;&gt;&gt; table files are deleted manually, the MANIFEST is no longer accurate.  An 
&gt;&gt;&gt; inaccurate MANIFEST file leads to leveldb internal errors and sometimes 
&gt;&gt;&gt; infinite loops.
&gt;&gt;&gt; 
&gt;&gt;&gt; The repair process erases the current MANIFEST file and builds a new one 
&gt;&gt;&gt; based upon the files actually found on disk.
&gt;&gt;&gt; 
&gt;&gt;&gt; WARNING:  repair takes a really, really long time in Riak 1.2.0 … it gets 
&gt;&gt;&gt; better in 1.2.1 … and improves to something quite reasonable by 1.3 and 1.4.
&gt;&gt;&gt; 
&gt;&gt;&gt; A discussion about repair can be found here:
&gt;&gt;&gt; 
&gt;&gt;&gt; <a  rel="nofollow" href="https://github.com/basho/leveldb/wiki/repair-notes">https://github.com/basho/leveldb/wiki/repair-notes</a>
&gt;&gt;&gt; 
&gt;&gt;&gt; Matthew
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On Sep 25, 2013, at 9:38 AM, Simon Effenberg &lt;seffenb...@team.mobile.de&gt; 
&gt;&gt;&gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Wed, 25 Sep 2013 09:15:33 -0400
&gt;&gt;&gt;&gt; Matthew Von-Maszewski &lt;matth...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; - run Riak repair on the vnode so that leveldb can create a MANIFEST that 
&gt;&gt;&gt;&gt;&gt; matches the files remaining.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; what do you mean with this? Wait for AAE? Request each key to trigger
&gt;&gt;&gt;&gt; read repair or do I miss something?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; We are in a similar situation.. only sst_4 exists in our situation but
&gt;&gt;&gt;&gt; we also delete old stuff regularly..
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Cheers
&gt;&gt;&gt;&gt; Simon 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; Simon Effenberg | Site Ops Engineer | mobile.international GmbH
&gt;&gt; Fon:     + 49-(0)30-8109 - 7173
&gt;&gt; Fax:     + 49-(0)30-8109 - 7131
&gt;&gt; 
&gt;&gt; Mail:     seffenb...@team.mobile.de
&gt;&gt; Web:    www.mobile.de
&gt;&gt; 
&gt;&gt; Marktplatz 1 | 14532 Europarc Dreilinden | Germany
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Geschäftsführer: Malte Krüger
&gt;&gt; HRB Nr.: 18517 P, Amtsgericht Potsdam
&gt;&gt; Sitz der Gesellschaft: Kleinmachnow 
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; -- 
&gt; Simon Effenberg | Site Ops Engineer | mobile.international GmbH
&gt; Fon:     + 49-(0)30-8109 - 7173
&gt; Fax:     + 49-(0)30-8109 - 7131
&gt; 
&gt; Mail:     seffenb...@team.mobile.de
&gt; Web:    www.mobile.de
&gt; 
&gt; Marktplatz 1 | 14532 Europarc Dreilinden | Germany
&gt; 
&gt; 
&gt; Geschäftsführer: Malte Krüger
&gt; HRB Nr.: 18517 P, Amtsgericht Potsdam
&gt; Sitz der Gesellschaft: Kleinmachnow 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12410.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd9.html#12415">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail9.html#12415">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12418.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12374.html">Deleting data from LevelDB backend</a></span> <span class="sender italic">Timo Gatsonides</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12376.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12377.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12379.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12409.html">Re: Deleting data from LevelDB back...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12410.html">Re: Deleting data from LevelDB...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Deleting data from Lev...</span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12418.html">Re: Deleting data from...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email"><span class="subject"><a href="msg12419.html">Re: Deleting data from...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12390.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Timo Gatsonides</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12391.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12393.html">Re: Deleting data from LevelDB back...</a></span> <span class="sender italic">Timo Gatsonides</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12443.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Alex Rice</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Deleting data from LevelDB backend">
<input type="hidden" name="msgid" value="EB0F0929-EDD3-44A2-95B7-FABA1FDDE0CF@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12415.html">
<input type="submit" value=" Matthew Von-Maszewski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Deleting+data+from+LevelDB+backend%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12410.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12418.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">EB0F0929-EDD3-44A2-95B7-FABA1FDDE0CF@basho.com</li>
</ul>
</div>
</body>
</html>
