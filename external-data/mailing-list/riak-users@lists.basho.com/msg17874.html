<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak CS race condition at start-up (was: Riak-CS issues when Riak	endpoint fails-over to new server)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17874" id="c">
<link rel="index" href="maillist.html#17874" id="i">
<link rel="prev" href="msg17873.html" id="p">
<link rel="next" href="msg17819.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17874.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+CS+race+condition+at+start%5C-up+%5C%28was%5C%3A+Riak%5C-CS+issues+when+Riak%09endpoint+fails%5C-over+to+new+server%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak CS race condition at start-up (was: Riak-CS issues when Riak	endpoint fails-over to new server)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Toby+Corkindale%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Toby Corkindale</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170122" rel="nofollow">Sun, 22 Jan 2017 19:29:40 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Thanks Luke.

We're using the official Basho Ubuntu packages for Ubuntu 14.04 LTS.
These don't seem to perform that step; they just start Riak CS
simultaneously with Riak KV.</pre><pre>

I'm surprised if we're the only people who hit this. Don't people hit these
issues in your other production deployments, or are they running on another
platforms that have more finessed start-up scripts?

Toby


On Sat, 21 Jan 2017 at 03:19 Luke Bakken &lt;lbak...@basho.com&gt; wrote:

&gt; Hi Toby,
&gt;
&gt; The process you use to run &quot;riak-cs start&quot; could use the &quot;riak-admin
&gt; wait-for-service riak_kv&quot; command to ensure Riak is ready first:
&gt;
&gt;
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.2.0/using/admin/riak-admin/#wait-for-service">http://docs.basho.com/riak/kv/2.2.0/using/admin/riak-admin/#wait-for-service</a>
&gt;
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt;
&gt;
&gt; On Thu, Jan 19, 2017 at 5:38 PM, Toby Corkindale &lt;t...@dryft.net&gt; wrote:
&gt; &gt; Hi guys,
&gt; &gt; I've switched our configuration around, so that Riak CS now talks to
&gt; &gt; 127.0.0.1:8087 instead of the haproxy version.
&gt; &gt;
&gt; &gt; We have immediately re-encountered the problems that caused us to move to
&gt; &gt; haproxy.
&gt; &gt; On start-up, riak takes slightly longer than riak-cs to get ready, and so
&gt; &gt; riak-cs logs the following then exits.
&gt; &gt; Restarting riak-cs again (so now 15 seconds after Riak started) results
&gt; in a
&gt; &gt; successful start-up, but obviously this is really annoying for our ops
&gt; guys
&gt; &gt; to have to remember to do after restarting riak or rebooting a machine.
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17873.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17874">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17874">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17819.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17818.html">Riak-CS issues when Riak endpoint fails-over to new server</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17827.html">Re: Riak-CS issues when Riak endpoint fails-over to n...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17828.html">Re: Riak-CS issues when Riak endpoint fails-over ...</a></span> <span class="sender italic">Magnus Kessler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17829.html">Re: Riak-CS issues when Riak endpoint fails-o...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17830.html">Re: Riak-CS issues when Riak endpoint fai...</a></span> <span class="sender italic">Shaun McVey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17834.html">Re: Riak-CS issues when Riak endpoin...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17872.html">Riak CS race condition at start-...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17873.html">Re: Riak CS race condition a...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak CS race condition a...</span> <span class="sender italic">Toby Corkindale</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak CS race condition at start-up (was: Riak-CS issues when Riak	endpoint fails-over to new server)">
<input type="hidden" name="msgid" value="CABEgq94DhLgpZEzNZMoMCPqXbOE6WkL5+Lcv5jbECkuo7QAQBA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17874.html">
<input type="submit" value=" Toby Corkindale ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+CS+race+condition+at+start%5C-up+%5C%28was%5C%3A+Riak%5C-CS+issues+when+Riak%09endpoint+fails%5C-over+to+new+server%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17873.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17819.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CABEgq94DhLgpZEzNZMoMCPqXbOE6WkL5+Lcv5jbECkuo7QAQBA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
