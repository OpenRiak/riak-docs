<!DOCTYPE html>
<html lang="en">
<head>
<title>Limit compaction I/O</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd6.html#13132" id="c">
<link rel="index" href="mail6.html#13132" id="i">
<link rel="prev" href="msg13127.html" id="p">
<link rel="next" href="msg13133.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13132.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Limit+compaction+I%5C%2FO%22&amp;o=newest" rel="nofollow"><span itemprop="name">Limit compaction I/O</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Timo+Gatsonides%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Timo Gatsonides</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131201" rel="nofollow">Sun, 01 Dec 2013 23:37:02 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
I have upgraded two nodes in my cluster from 1.3.2 to 1.4.2. After the upgrade 
it appears both started a compaction, as mentioned here: 
<a  rel="nofollow" href="https://github.com/basho/riak/blob/1.4/RELEASE-NOTES.md#leveldb-13-to-14-conversion">https://github.com/basho/riak/blob/1.4/RELEASE-NOTES.md#leveldb-13-to-14-conversion</a>.
 In my case I think this may have also triggered compactions at level 5 
(finally) - see this earlier thread about stale data not getting removed: 
<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2013-September/013392.html">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2013-September/013392.html</a>.
 Which is good as the 2TB drive dedicated for this data was almost filled 
completely. After the compaction finished, some 12-16 hours later, about 200Gb 
of data was removed.</pre><pre>

Two questions remain:
1) can someone please confirm that indeed the upgrade from 1.3 to 1.4 triggered 
the compactions, all the way to the level 5 compactions?
2) is there some way to limit the I/O for the compactions?

The problem was that during the compaction the node was really slow to respond 
(I took it out of the HAProxy config), the CPU load was no problem, around 30% 
on a single core only, however the iowait was high. Using iostat I noticed the 
disk continuously reading AND writing around 30Mb/s (normal, spinning disk, 
SATA).

Kind regards,
Timo



</pre>
<p><strong><a href="msg13132/smime.p7s" ><img src="../attachment.png" alt="Attachment:" width=27 height=28></a>
<a href="msg13132/smime.p7s" >smime.p7s</a></strong><br>
<em>Description:</em> S/MIME cryptographic signature</p>
<pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13127.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd6.html#13132">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail6.html#13132">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13133.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Limit compaction I/O</span> <span class="sender italic">Timo Gatsonides</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13133.html">Re: Limit compaction I/O</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Limit compaction I/O">
<input type="hidden" name="msgid" value="2F5A1972-EBDC-40BF-BBAA-C62DC310F4B7@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13132.html">
<input type="submit" value=" Timo Gatsonides ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Limit+compaction+I%5C%2FO%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13127.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13133.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">2F5A1972-EBDC-40BF-BBAA-C62DC310F4B7@me.com</li>
</ul>
</div>
</body>
</html>
