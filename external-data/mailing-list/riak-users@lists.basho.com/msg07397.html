<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Questions about Riak Enterprise</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07397" id="c">
<link rel="index" href="maillist.html#07397" id="i">
<link rel="prev" href="msg07395.html" id="p">
<link rel="next" href="msg07405.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07397.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Questions+about+Riak+Enterprise%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Questions about Riak Enterprise</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mark+Rose%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mark Rose</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120508" rel="nofollow">Tue, 08 May 2012 07:59:26 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Mon, May 7, 2012 at 9:25 PM, Andrew Thompson &lt;and...@hijacked.us&gt; wrote:
&gt;
&gt; Hi Mark, I'm the riak EDS 'maintainer'. Sorry I didn't reply earlier, I
&gt; was travelling all week.
&gt;</pre><pre>

Hi Andrew, glad to hear from you!

&gt; I understand that the open source version of Riak's replication is
&gt; designed
&gt; &gt; for single data center usage only, but I'm unsure about how Riak
&gt; Entreprise
&gt; &gt; handles replication. Specifically, I'm curious about locality and high
&gt; &gt; availability.
&gt; &gt;
&gt; &gt; Our setup is already running in multiple availability zones on EC2. We're
&gt; &gt; running Galera across the zones to provide both redundancy and a local
&gt; copy
&gt; &gt; of the data to avoid the network latency of going to another zone.
&gt; However,
&gt; &gt; Galera, as nice as it is, doesn't scale writes. We're going to be using
&gt; &gt; Riak to store a lot of information going forward, and may eventually move
&gt; &gt; our existing data to it as well.
&gt; &gt;
&gt; &gt; The only thing holding us back from going to multiple regions on Amazon
&gt; is
&gt; &gt; our datastore.
&gt; &gt;
&gt; &gt; How well does Riak handle layered topologies, such as EC2?
&gt; &gt;
&gt; &gt; Is it possible to configure Riak Enterprise to store two copies of the
&gt; data
&gt; &gt; in each EC2 region, ensuring that the two copies are in different zones
&gt; &gt; when there are more than one Riak servers in a zone?
&gt;
&gt; Current EDS replication is pretty simple, it will just try to
&gt; (eventually) ensure that data on one cluster is mirrored on another. It
&gt; won't forward reads and riak doesn't have anything like 'rack
&gt; awareness', at least not yet.
&gt;

Approximately how fast is &quot;eventually&quot;? Is it based on the network
bandwidth/latency between the clusters or is there additional latency?
Basically, would I expect more or less than a second if the two clusters
were 250 ms away?

Also, how does EDS work with regards to writes to the same key in both
clusters? Does it use a second level of vector clocks or is the vector
clock shared? I imagine last-one-wins wouldn't work in such a setup. Is it
standard practice to send all the writes to a single cluster?


&gt; &gt; When a query is run, is it run in one region only? Would Riak prefer
&gt; copies
&gt; &gt; of the data in the local zone?
&gt;
&gt; Riak only queries the local cluster, yes.
&gt;
&gt; &gt; For what it's worth, our current datastore load is roughly half and half
&gt; &gt; writes and reads. We heavily cache reads with memcache (99%). We may drop
&gt; &gt; memcache if reads on Riak prove fast enough (thus avoiding the issues of
&gt; &gt; invalidating remote caches).
&gt;
&gt; Given the current limitations, you'd probably be best off with N
&gt; clusters in different regions and/or zones. Don't try to span a single
&gt; cluster across a zone, or even worse, a region. Then hook them together
&gt; with replication.
&gt;

Does the approximately 1 ms of latency between av zones affect Riak's
performance that much?

We were planning to run across av zones for fault tolerance, just beefing
up single nodes for the moment until rack awareness is available. So the
recommended solution is to use EDS to accomplish this?


&gt; There's also some fun with NAT on EC2, but it can be made to work.
&gt;

We currently using &quot;role based&quot; host names. On boot, the Riak machine sets
a CNAME to its public DNS name.

riak1.us-east-1a.example.net -&gt; ec2-203-0-113-239.compute-1.amazonaws.com
riak1.us-east-1b.example.net -&gt; ec2-198-51-100-13.compute-1.amazonaws.com
riak1.us-east-1c.example.net -&gt; ec2-192-0-2-144.compute-1.amazonaws.com

and the cluster members would be r...@riak1.us-east-1a.example.net,
r...@riak1.us-east-1a.example.net, and r...@riak1.us-east-1c.example.net.

The names resolve to either the private or public IP of the machine
depending on whether the machine is in the same region or not. We haven't
tried running across regions yet... so I gather this might confuse
Riak/Erlang?


&gt; Let me know if that helps,
&gt;
&gt; Andrew
&gt;

It helps tremendously!

-Mark
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07395.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07397">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07397">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07405.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07366.html">Questions about Riak Enterprise</a></span> <span class="sender italic">Mark Rose</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07395.html">Re: Questions about Riak Enterprise</a></span> <span class="sender italic">Andrew Thompson</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Questions about Riak Enterprise</span> <span class="sender italic">Mark Rose</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07405.html">Re: Questions about Riak Enterprise</a></span> <span class="sender italic">Andrew Thompson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07406.html">Re: Questions about Riak Enterprise</a></span> <span class="sender italic">Mark Rose</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07421.html">Re: Questions about Riak Enterprise</a></span> <span class="sender italic">Ahmed Bashir</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07442.html">Re: Questions about Riak Enterprise</a></span> <span class="sender italic">Andrew Thompson</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07407.html">Re: Questions about Riak Enterprise</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07443.html">Re: Questions about Riak Enterprise</a></span> <span class="sender italic">Andrew Thompson</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Questions about Riak Enterprise">
<input type="hidden" name="msgid" value="CACiSN6Wzz8MK3gfnLXJJjQobhZfQDt8vk3STv-cryTNjqkZs7Q@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07397.html">
<input type="submit" value=" Mark Rose ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Questions+about+Riak+Enterprise%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07395.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07405.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACiSN6Wzz8MK3gfnLXJJjQobhZfQDt8vk3STv-cryTNjqkZs7Q@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
