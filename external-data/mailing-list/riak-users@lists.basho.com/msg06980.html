<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Ruby eventmachine async client</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06980" id="c">
<link rel="index" href="maillist.html#06980" id="i">
<link rel="prev" href="msg06979.html" id="p">
<link rel="next" href="msg06981.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06980.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ruby+eventmachine+async+client%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Ruby eventmachine async client</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mathias+Meyer%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mathias Meyer</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120316" rel="nofollow">Fri, 16 Mar 2012 03:52:31 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey Sean,

for a while I hacked on an EM-based Riak client but didn't find the time to 
investigate it further.</pre><pre>

So you can do several things with riak-ruby-client an EM:

1) Just use the client with EM.defer, putting it into other threads. That 
arguably voids the purpose of using EM, but at least defers the blocking I/O 
work to a pool of threads where it can be handled without blocking the reactor.
2) Write a backend for riak-ruby-client that utilizes em-synchrony and em-http 
to turn things into a more procedural workflow. That should be simple enough 
based on the net/http backend [1]. Be aware of the limitations of using fibers 
though, their stacks only fit 4K so keep your stacks small :)
3) You could also just use em-http-request, but that way you'd give up a lot of 
functionality that's already in riak-ruby-client.

I'd recommend looking at #2, it looks like an easy path and should make for a 
great addition to the riak-ruby-client too. In my ideal world, there'd be a 
backend based on Faraday [2], so that the Ruby client wouldn't even have to 
worry about the underlying implementation, but you need to punch Sean Cribbs 
(very nicely) about that. Or you could just use Faraday instead of em-synchrony 
all along, since Faraday has a backend for em-http/synchrony already.

Hope this helps.

Cheers, Mathias
<a  rel="nofollow" href="http://riakhandbook.com">http://riakhandbook.com</a>

[1]: 
<a  rel="nofollow" href="https://github.com/basho/riak-ruby-client/blob/master/lib/riak/client/net_http_backend.rb">https://github.com/basho/riak-ruby-client/blob/master/lib/riak/client/net_http_backend.rb</a>
[2]: <a  rel="nofollow" href="https://github.com/technoweenie/faraday">https://github.com/technoweenie/faraday</a>





On Friday, 16. March 2012 at 05:39, Sean McKibben wrote:

&gt; Given Mathias Meyer's talk at Scotland Ruby Conference about eventmachine 
&gt; programming (while wearing a Riak t-shirt!), I was hoping to see a little bit 
&gt; more in terms of eventmachine clients and Riak.
&gt; 
&gt; Has anyone used EventMachine and/or em-synchrony with Riak and could give me 
&gt; some advice? I'm using ruby-riak-client at this point and going the route of 
&gt; trying to wrap my workflow in fibers so riak client plays nice with it.
&gt; 
&gt; Am I better off just using a HTTP client like EM::HttpRequest or 
&gt; EM::Synchrony::Multi, or is there some good way to use ruby-riak-client or 
&gt; ripple with eventmachine that requires less manual intervention?
&gt; 
&gt; Sorry if this has been covered somewhere else but I haven't had much luck 
&gt; finding anyone else using EM with Riak.
&gt; 
&gt; Thanks,
&gt; Sean McKibben
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>




_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06979.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06980">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06980">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06981.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06979.html">Ruby eventmachine async client</a></span> <span class="sender italic">Sean McKibben</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Ruby eventmachine async client</span> <span class="sender italic">Mathias Meyer</span></li>
<li class="icons-email"><span class="subject"><a href="msg06981.html">Re: Ruby eventmachine async client</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06987.html">Re: Ruby eventmachine async client</a></span> <span class="sender italic">graphex</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06988.html">Re: Ruby eventmachine async client</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06992.html">Re: Ruby eventmachine async client</a></span> <span class="sender italic">graphex</span></li>
<li class="icons-email"><span class="subject"><a href="msg07005.html">Re: Ruby eventmachine async client</a></span> <span class="sender italic">graphex</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Ruby eventmachine async client">
<input type="hidden" name="msgid" value="F08155EB1C384C19B5F2BBA4A6C624C4@paperplanes.de">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06980.html">
<input type="submit" value=" Mathias Meyer ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ruby+eventmachine+async+client%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06979.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06981.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">F08155EB1C384C19B5F2BBA4A6C624C4@paperplanes.de</li>
</ul>
</div>
</body>
</html>
