<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Bucket creation.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10014" id="c">
<link rel="index" href="maillist.html#10014" id="i">
<link rel="prev" href="msg10013.html" id="p">
<link rel="next" href="msg10017.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10014.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bucket+creation.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Bucket creation.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremiah+Peschka%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremiah Peschka</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130206" rel="nofollow">Wed, 06 Feb 2013 06:47:05 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Kevin - in this specific case, Riak itself will accept a slash in the key
name. It will not, however, accept a slash through the HTTP interface. See
<a  rel="nofollow" href="http://riak.markmail.org/search/?q=slash#query:slash+page:1+mid:5j5jb4maepr3epc3+state:resultsThe">http://riak.markmail.org/search/?q=slash#query:slash+page:1+mid:5j5jb4maepr3epc3+state:resultsThe</a>
short version is that there's no sane way we can safely check strings
for validity since all bucket and key names are valid, but they're
different values of valid depending on the API you're using at the time.</pre><pre>

As best as I can tell, there's no restriction on the riak KV side about how
a bucket or key is named. As far as Erlang is concerned it's just a bunch
of bytes masquerading as a string. If you do anything goofy and want that
goofy/unexpected name to work everywhere you need to properly escape your
bucket name. This is similar to how SQL Server requires square brackets
around reserved keywords or database objects with special characters in
their name (e.g. CREATE TABLE [i like data] ( id INT ); ). As long as names
are correctly escaped, you won't run into any problems.

Continuing the same analogy, CorrugatedIron is a lot like ADO.NET. If I
create a SqlCommand with CommandText of &quot;OMGWTFBBQ&quot;, The SqlCommand object
doesn't care trying to do or that what I passed in probably isn't valid
T-SQL, it only knows that I've given it a command that needs to be sent to
a SQL Server.

OJ and I have debated how much smarts CorrugatedIron should have. Our
ultimate decision is that it should have just enough smarts to get the job
done and not a speck more. It's a relatively low level client (along the
lines of ADO.NET), but we do what we can to hide a lot of the nastiness
and idiosyncrasies of Riak from the user in places where it might get
confusing. One of the things we hide is the dual nature of Riak's API.
Almost all operations are supported via ProtocolBuffers (which doesn't care
about names) but a few are only supported through HTTP.

I hope this helps clear up some of your questions.

---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop


On Wed, Feb 6, 2013 at 5:32 AM, OJ Reeves &lt;o...@buffered.io&gt; wrote:

&gt; I am not aware of the rules in bucket naming, I don't even know if there
&gt; are any or if they're documented anywhere. All I can say is that I wouldn't
&gt; personally use a forward-slash because it's an obvious conflict with other
&gt; areas of the system.
&gt;
&gt; OJ
&gt;
&gt; On Wed, Feb 6, 2013 at 10:44 PM, Kevin Burton &lt;rkevinbur...@charter.net&gt;wrote:
&gt;
&gt;&gt; The set properties method returns without error on the &quot;illegally named&quot;
&gt;&gt; bucket as do all of the put operations. It is just the get properties
&gt;&gt; operation that returns an error. If the bucket is indeed improperly named
&gt;&gt; then the bug is in the  operations that allow the bucket name. Right?
&gt;&gt;
&gt;&gt; On Feb 5, 2013, at 10:44 PM, Alexander Moore &lt;moore.a...@gmail.com&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt; I think the problem you are having here is that you are using an invalid
&gt;&gt; bucket name.
&gt;&gt;
&gt;&gt; &quot;buyseasons/products&quot; would actually refer to a bucket/key pair.  Riak
&gt;&gt; doesn't have nested buckets.
&gt;&gt;
&gt;&gt; If you change your bucket name to &quot;buyseasons-products&quot; or
&gt;&gt; &quot;buyseasons%20products&quot; it should work.
&gt;&gt;
&gt;&gt; As for the weird/misleading exception, I'll report it to CorrugatedIron.
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Alex Moore
&gt;&gt;
&gt;&gt;
&gt;&gt; I still have a question. Based on your input I modified the code slightly
&gt;&gt;&gt; as follows:
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt;             RiakBucketProperties bucketProperties = new
&gt;&gt;&gt; RiakBucketProperties();****
&gt;&gt;&gt;
&gt;&gt;&gt;             bucketProperties.SetNVal(4);****
&gt;&gt;&gt;
&gt;&gt;&gt;             bucketProperties.SetSearch(true);****
&gt;&gt;&gt;
&gt;&gt;&gt;             bucketProperties.SetAllowMultiple(true);****
&gt;&gt;&gt;
&gt;&gt;&gt;             bucketProperties.SetWVal(&quot;all&quot;);****
&gt;&gt;&gt;
&gt;&gt;&gt;             bucketProperties.SetRVal(&quot;quorum&quot;);****
&gt;&gt;&gt;
&gt;&gt;&gt;             if (!client.SetBucketProperties(&quot;buyseasons/products&quot;,
&gt;&gt;&gt; bucketProperties).IsSuccess)****
&gt;&gt;&gt;
&gt;&gt;&gt;             {****
&gt;&gt;&gt;
&gt;&gt;&gt;                 Console.WriteLine(&quot;Setting bucket properties failed&quot;);**
&gt;&gt;&gt; **
&gt;&gt;&gt;
&gt;&gt;&gt;             }****
&gt;&gt;&gt;
&gt;&gt;&gt;             RiakResult&lt;RiakBucketProperties&gt; riakBuckpropertiesResult =
&gt;&gt;&gt; client.GetBucketProperties(&quot;buyseasons/products&quot;, true);****
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt; But I get a NullReferenceException****
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt;   at CorrugatedIron.Models.RiakBucketProperties.ReadQuorum(JObject
&gt;&gt;&gt; props, String key, Action`1 setter)****
&gt;&gt;&gt;
&gt;&gt;&gt;    at CorrugatedIron.Models.RiakBucketProperties..ctor(RiakRestResponse
&gt;&gt;&gt; response)****
&gt;&gt;&gt;
&gt;&gt;&gt;    at CorrugatedIron.RiakClient.GetBucketProperties(String bucket,
&gt;&gt;&gt; Boolean extended)****
&gt;&gt;&gt;
&gt;&gt;&gt; . . . . .****
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt; So the bucket should have been created when I set the properties. But
&gt;&gt;&gt; then I tried to read the properties back and I get the exception.****
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt; *From:* Alexander Sicular [<a  rel="nofollow" href="mailto:sicul...@gmail.com">mailto:sicul...@gmail.com</a>]
&gt;&gt;&gt; *Sent:* Tuesday, February 05, 2013 5:17 PM
&gt;&gt;&gt; *To:* Kevin Burton
&gt;&gt;&gt; *Cc:* riak-users
&gt;&gt;&gt; *Subject:* Re: Bucket creation.****
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt; &quot;buckets&quot; are a virtual concept. you dont need to &quot;create&quot; them. just
&gt;&gt;&gt; write a key to any bucket. also by modifying the default bucket parameters,
&gt;&gt;&gt; by adding the search hook on a bucket, let's say, you are also &quot;creating&quot;
&gt;&gt;&gt; the bucket.****
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt; -alexander****
&gt;&gt;&gt;
&gt;&gt;&gt; ** **
&gt;&gt;&gt;
&gt;&gt;&gt; On Tue, Feb 5, 2013 at 6:09 PM, Kevin Burton &lt;rkevinbur...@charter.net&gt;
&gt;&gt;&gt; wrote:****
&gt;&gt;&gt;
&gt;&gt;&gt;  ****
&gt;&gt;&gt;
&gt;&gt;&gt; I have filed to find code that would create a bucket. It must be in the
&gt;&gt;&gt; past I have just put objects into a bucket and Riak must construct the
&gt;&gt;&gt; bucket if it does not exist. Now I would like to create the bucket and set
&gt;&gt;&gt; some properties on that bucket. But I donâ€™t know how to create the bucket.
&gt;&gt;&gt; ****
&gt;&gt;&gt;
&gt;&gt;&gt;  ****
&gt;&gt;&gt;
&gt;&gt;&gt; So I have code like:****
&gt;&gt;&gt;
&gt;&gt;&gt;  ****
&gt;&gt;&gt;
&gt;&gt;&gt;                             BuildProduct(source, destination);****
&gt;&gt;&gt;
&gt;&gt;&gt;                             RiakObject value = new RiakObject(&quot;products&quot;,
&gt;&gt;&gt; keySku, JsonConvert.SerializeObject(destination))****
&gt;&gt;&gt;
&gt;&gt;&gt;                                 {****
&gt;&gt;&gt;
&gt;&gt;&gt;                                     ContentType = &quot;application/json&quot;****
&gt;&gt;&gt;
&gt;&gt;&gt;                                 };****
&gt;&gt;&gt;
&gt;&gt;&gt;  ****
&gt;&gt;&gt;
&gt;&gt;&gt;                             RiakResult&lt;RiakObject&gt; response =
&gt;&gt;&gt; client.Put(value, new RiakPutOptions { W = 2 });****
&gt;&gt;&gt;
&gt;&gt;&gt;  ****
&gt;&gt;&gt;
&gt;&gt;&gt; But I would like to create the bucket and set properties on the bucket
&gt;&gt;&gt; before I put things into the bucket. Like:****
&gt;&gt;&gt;
&gt;&gt;&gt;  ****
&gt;&gt;&gt;
&gt;&gt;&gt;             RiakResult&lt;RiakBucketProperties&gt; riakBuckpropertiesResult =
&gt;&gt;&gt; client.GetBucketProperties(&quot;products&quot;, true);****
&gt;&gt;&gt;
&gt;&gt;&gt;             if (riakBuckpropertiesResult.IsSuccess)****
&gt;&gt;&gt;
&gt;&gt;&gt;             {****
&gt;&gt;&gt;
&gt;&gt;&gt;                 riakBuckpropertiesResult.Value
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt;
&gt; OJ Reeves
&gt; +61 431 952 586
&gt; <a  rel="nofollow" href="http://buffered.io/">http://buffered.io/</a>
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10013.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10014">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10014">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10017.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10003.html">Bucket creation.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10004.html">Re: Bucket creation.</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10005.html">RE: Bucket creation.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10006.html">Re: Bucket creation.</a></span> <span class="sender italic">Alexander Moore</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10009.html">Re: Bucket creation.</a></span> <span class="sender italic">OJ Reeves</span></li>
<li class="icons-email"><span class="subject"><a href="msg10011.html">Re: Bucket creation.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10013.html">Re: Bucket creation.</a></span> <span class="sender italic">OJ Reeves</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Bucket creation.</span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10017.html">Re: Bucket creation.</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Bucket creation.">
<input type="hidden" name="msgid" value="CACJEN2ouAA1bsjuwnYo95QThAWjrcXjCYHB37fB+3b2CJCRcFQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10014.html">
<input type="submit" value=" Jeremiah Peschka ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bucket+creation.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10013.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10017.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACJEN2ouAA1bsjuwnYo95QThAWjrcXjCYHB37fB+3b2CJCRcFQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
