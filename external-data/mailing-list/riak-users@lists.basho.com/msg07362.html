<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Geospatial advice?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07362" id="c">
<link rel="index" href="maillist.html#07362" id="i">
<link rel="prev" href="msg07364.html" id="p">
<link rel="next" href="msg07363.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07362.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Geospatial+advice%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Geospatial advice?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mark+Rose%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mark Rose</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120501" rel="nofollow">Tue, 01 May 2012 11:09:47 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Well, I'd be indexing items over the entire globe. I'd be be looking at
resolutions from an entire world view down to city block. I'm thinking of
using geohashes as an index to restrict the result set, then further
filtering and sorting by mapreducing the remaining items. So I only need
enough granularity to reduce the number of items to a reasonable amount. At
the world view level, I'd filter out most results using mapreduce, but the
local-level queries would be far more common so an index would be highly
advantageous. The geometry I'd want to query would be a window that
arbitrarily overlaps one or more geohash regions. Basically, think plotting
items in say, Google Maps.</pre><pre>

Can you use a secondary index inside mapreduce? I haven't seen any examples
of it. I have only seen a secondary index being used to feed a mapreduce. I
am new to Riak.

I imagine my number of points would be at most 100 items per square km, but
typically less than 1 per square km. A 1 km resolution would be sufficient.
A 32 bit geohash would cover that fine. Vast regions of the Earth would
contain no points at all.

-Mark

On Tue, May 1, 2012 at 1:16 PM, Sean Cribbs &lt;s...@basho.com&gt; wrote:

&gt; In contrast to Alexander's assessment, I'd say &quot;it depends&quot;. I have built
&gt; some geospatial indexes on top of Riak using a geohashing scheme based on
&gt; the Hilbert space-filling curve. However, I had to choose specific levels
&gt; of &quot;zoom&quot; and precompute them. Now that we have secondary indexes, you
&gt; could perhaps bypass the precomputation step. In general, if you know the
&gt; geometry of the space you want to query, you can fairly trivially compute
&gt; the names of the geohashes you need to look up and then either fetch
&gt; individual keys for those (if you precompute them), or use MapReduce to
&gt; fetch a range of them. It's not automatic, for sure, but the greatest
&gt; complexity will be in deciding which granularities of index to support.
&gt;
&gt; On Tue, May 1, 2012 at 12:44 PM, Alexander Sicular &lt;sicul...@gmail.com&gt;wrote:
&gt;
&gt;&gt; My advice is to not use Riak. Check mongo or Postgres.
&gt;&gt;
&gt;&gt;
&gt;&gt; @siculars on twitter
&gt;&gt; <a  rel="nofollow" href="http://siculars.posterous.com">http://siculars.posterous.com</a>
&gt;&gt;
&gt;&gt; Sent from my iRotaryPhone
&gt;&gt;
&gt;&gt; On May 1, 2012, at 9:18, Mark Rose &lt;markr...@markrose.ca&gt; wrote:
&gt;&gt;
&gt;&gt; &gt; Hello everyone!
&gt;&gt; &gt;
&gt;&gt; &gt; I'm going to be implementing Riak as a storage engine for geographic
&gt;&gt; data. Research has lead me to using geohashing as a useful way to filter
&gt;&gt; out results outside of a region of interest. However, I've run into some
&gt;&gt; stumbling blocks and I'm looking for advice on the best way to proceed.
&gt;&gt; &gt;
&gt;&gt; &gt; Querying efficiently by geohash involves querying several regions
&gt;&gt; around a point. From what I can tell, Riak offers no way to query a
&gt;&gt; secondary index with multiple ranges. Having to query a several ranges,
&gt;&gt; merge them in the application layer, then pass them off to mapreduce seems
&gt;&gt; rather silly (and could mean passing GBs of data). Alternatively, I could
&gt;&gt; start straight with mapreduce, but key filtering seems to work only with
&gt;&gt; the primary key, which would force me into using the geohashed location as
&gt;&gt; the primary key (which would lead to collisions if two things existed at
&gt;&gt; the same point). I'd also like to avoid using the primary key as the
&gt;&gt; geohash as if the item moves I'd have to change all the references to it.
&gt;&gt; Lastly, I could do a less efficient mapreduce over a less precise geohash,
&gt;&gt; but this doesn't solve the issue of the equator (anything near the equator
&gt;&gt; would require mapreducing the entire dataset).
&gt;&gt; &gt;
&gt;&gt; &gt; Is there any way to query multiple ranges with a secondary index and
&gt;&gt; pass that off to mapreduce? Or should I just stick with the less efficient
&gt;&gt; mapreduce, and when near the equator, run two queries and later merge them?
&gt;&gt; Or am I going about this the wrong way?
&gt;&gt; &gt;
&gt;&gt; &gt; In any case, the final stage of my queries will involve mapreduce as
&gt;&gt; I'll need to further filter the items found in a region.
&gt;&gt; &gt;
&gt;&gt; &gt; Thank you,
&gt;&gt; &gt; Mark
&gt;&gt; &gt; _______________________________________________
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07364.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07362">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07362">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07363.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07354.html">Geospatial advice?</a></span> <span class="sender italic">Mark Rose</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07359.html">Re: Geospatial advice?</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07360.html">Re: Geospatial advice?</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07361.html">Re: Geospatial advice?</a></span> <span class="sender italic">Will Moss</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07364.html">Re: Geospatial advice?</a></span> <span class="sender italic">Mark Rose</span></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Geospatial advice?</span> <span class="sender italic">Mark Rose</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07363.html">Re: Geospatial advice?</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07365.html">Re: Geospatial advice?</a></span> <span class="sender italic">Mark Rose</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07367.html">Re: Geospatial advice?</a></span> <span class="sender italic">Kyle Kingsbury</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07368.html">Re: Geospatial advice?</a></span> <span class="sender italic">Mark Rose</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Geospatial advice?">
<input type="hidden" name="msgid" value="CACiSN6X6EJyyCspBzZ=jBV4XDZ6y0CXsOhgQTCA7_Gz_zPNhAQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07362.html">
<input type="submit" value=" Mark Rose ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Geospatial+advice%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07364.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07363.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACiSN6X6EJyyCspBzZ=jBV4XDZ6y0CXsOhgQTCA7_Gz_zPNhAQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
