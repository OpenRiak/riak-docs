<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Put failure: too many siblings</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd4.html#17487" id="c">
<link rel="index" href="mail4.html#17487" id="i">
<link rel="prev" href="msg17485.html" id="p">
<link rel="next" href="msg17488.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17487.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Put+failure%5C%3A+too+many+siblings%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Put failure: too many siblings</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Russell+Brown%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Russell Brown</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160616" rel="nofollow">Thu, 16 Jun 2016 23:46:54 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>What version of riak_kv is behind this riak_cs install, please? Is it really 
2.1.3 as stated below? This looks and sounds like sibling explosion, which is 
fixed in riak 2.0 and above. Are you sure that you are using the DVV enabled 
setting for riak_cs bucket properties? Can you post your bucket properties 
please?</pre><pre>

On 16 Jun 2016, at 23:54, Vladyslav Zakhozhai &lt;v.zakhoz...@smartweb.com.ua&gt; 
wrote:

&gt; Hello.
&gt; 
&gt; I see very interesting and confusing thing.
&gt; 
&gt; From my previous letter you can see that siblings count on manifest objects 
&gt; is about 100 (actualy it is in range 100-300). Unfortunately my problem is 
&gt; that almost all PUT requests are failing with 500 Internal Server error.
&gt; 
&gt; I've tried today set max_siblings riak option to 500. And there were 
&gt; successfull PUT requests but not for long. Now I see in riak logs error with 
&gt; &quot;max siblings&quot;, but actual count of them is 500+ (earlier it was 100-300 as 
&gt; I've mentioned).
&gt; 
&gt; Period of time between max_siblings=500 and errors in log is about 30 
&gt; minutes. And I want to point your attention that I've forbid PUT method on 
&gt; haproxy - frontend for riak cs.
&gt; 
&gt; 
&gt; 
&gt; On Mon, Jun 6, 2016 at 1:17 AM Vladyslav Zakhozhai 
&gt; &lt;v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt; Hi, Luke.
&gt; 
&gt; Thank you for your answer. I did not understand you completely about 
&gt; transfer-limit. How does it relate to my problem. Transfer limit - is a limit 
&gt; of concurrent data transfer from different nodes. Am I wright? You mean that 
&gt; riak can handoff one partition from several nodes concurrently?
&gt; 
&gt; Now I have transfer-limit 1 on all riak nodes.
&gt; 
&gt; But I am not sure that my cluster will be converged ever. All nodes 
&gt; experiences low memory and are killed by OOM Killer periodically. I try to 
&gt; add new nodes to the cluster but due problem with OOM killer this process is 
&gt; very-very slow.
&gt; 
&gt; In the official docs I've read:
&gt; 
&gt; &quot;Sibling explosion occurs when an object rapidly collects siblings that are 
&gt; not reconciled. This can lead to a variety of problems, including degraded 
&gt; performance, especially if many objects in a cluster suffer from siblings 
&gt; explosion. At the extreme, having an enormous object in a node can cause 
&gt; reads of that object to crash the entire node. Other issues include undue 
&gt; latency and out-of-memory errors.&quot;
&gt; 
&gt; I mentioned that new nodes in the cluster do not experience such problems (I 
&gt; mean out of RAM).
&gt; 
&gt; Regarding to siblings maybe your are right, this is manifest object. I can 
&gt; recognize key name but not bucket name. But more than 100 siblings on many 
&gt; keys is really confused me. Each time I try to PUT some object to Riak via 
&gt; Riak CS S3 interface I got errors with siblings.
&gt; 
&gt; On Fri, Jun 3, 2016 at 6:43 PM Luke Bakken &lt;lbak...@basho.com&gt; wrote:
&gt; Hi Vladyslav,
&gt; 
&gt; If you recognize the full name of the object raising the sibling
&gt; warning, it is most likely a manifest object. Sometimes, during hinted
&gt; handoff, you can see these messages. They should resolve after handoff
&gt; completes.
&gt; 
&gt; Please see the documentation for the transfer-limit command as well:
&gt; 
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.1.4/using/admin/riak-admin/#transfer-limit">http://docs.basho.com/riak/kv/2.1.4/using/admin/riak-admin/#transfer-limit</a>
&gt; 
&gt; --
&gt; Luke Bakken
&gt; Engineer
&gt; lbak...@basho.com
&gt; 
&gt; 
&gt; On Fri, Jun 3, 2016 at 2:55 AM, Vladyslav Zakhozhai
&gt; &lt;v.zakhoz...@smartweb.com.ua&gt; wrote:
&gt; &gt; Hi.
&gt; &gt;
&gt; &gt; I have a trouble with PUT to Riak CS cluster. During this process I
&gt; &gt; periodically see the following message in Riak error.log:
&gt; &gt;
&gt; &gt; 2016-06-03 11:15:55.201 [error]
&gt; &gt; &lt;0.15536.142&gt;@riak_kv_vnode:encode_and_put:2253 Put failure: too many
&gt; &gt; siblings for object OBJECT_NAME (101)
&gt; &gt;
&gt; &gt; and also
&gt; &gt;
&gt; &gt; 2016-06-03 12:41:50.678 [error]
&gt; &gt; &lt;0.20448.515&gt;@riak_api_pb_server:handle_info:331 Unrecognized message
&gt; &gt; {7345880,{error,{too_many_siblings,101}}}
&gt; &gt;
&gt; &gt; Here OBJECT_NAME - is the name of object in Riak which has too many
&gt; &gt; siblings.
&gt; &gt;
&gt; &gt; I definitely sure that this objects are static. Nobody deletes is, nobody
&gt; &gt; rewrites it. I have no idea why more than 100 siblings of this object
&gt; &gt; occurs.
&gt; &gt;
&gt; &gt; The following effect of this issue occurs:
&gt; &gt;
&gt; &gt; Great amount of keys are loaded to RAM. I almost out of RAM (Do each sibling
&gt; &gt; has it own key or key duplicate?).
&gt; &gt; Nodes are slow - adding new nodes are too slow
&gt; &gt; Presence of &quot;too many siblings&quot; affects ownership handoffs
&gt; &gt;
&gt; &gt; So I have several questions:
&gt; &gt;
&gt; &gt; Do hinted or ownership handoffs can affect siblings count (I mean can
&gt; &gt; siblings be created during ownership of hinted handoffs)
&gt; &gt; Is there any workaround of this issue. Do I need remove siblings manually or
&gt; &gt; it removes during merges, read repairs and so on
&gt; &gt;
&gt; &gt;
&gt; &gt; My configuration:
&gt; &gt;
&gt; &gt; riak from basho's packages - 2.1.3-1
&gt; &gt; riak cs from basho's packages - 2.1.0-1
&gt; &gt; 24 riak/riak-cs nodes
&gt; &gt; 32 GB RAM per node
&gt; &gt; AAE is disabled
&gt; &gt;
&gt; &gt;
&gt; &gt; I appreciate you help.
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17485.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd4.html#17487">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail4.html#17487">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17488.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17449.html">Put failure: too many siblings</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17451.html">Re: Put failure: too many siblings</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17453.html">Re: Put failure: too many siblings</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17485.html">Re: Put failure: too many siblings</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Put failure: too many siblings</span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17488.html">Re: Put failure: too many siblin...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18232.html">Re: Put failure: too many si...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18233.html">Re: Put failure: too man...</a></span> <span class="sender italic">Russell Brown</span></li>
<li class="icons-email"><span class="subject"><a href="msg18234.html">Re: Put failure: too man...</a></span> <span class="sender italic">Russell Brown</span></li>
<li class="icons-email"><span class="subject"><a href="msg18235.html">Re: Put failure: too man...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li class="icons-email"><span class="subject"><a href="msg18240.html">Re: Put failure: too man...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li class="icons-email"><span class="subject"><a href="msg18241.html">Re: Put failure: too man...</a></span> <span class="sender italic">Magnus Kessler</span></li>
<li class="icons-email"><span class="subject"><a href="msg18243.html">Re: Put failure: too man...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li class="icons-email"><span class="subject"><a href="msg18253.html">Re: Put failure: too man...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
<li class="icons-email"><span class="subject"><a href="msg18256.html">Re: Put failure: too man...</a></span> <span class="sender italic">Vladyslav Zakhozhai</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Put failure: too many siblings">
<input type="hidden" name="msgid" value="79C11C24-5160-4A9D-961A-08FB86A22688@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17487.html">
<input type="submit" value=" Russell Brown ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Put+failure%5C%3A+too+many+siblings%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17485.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17488.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">79C11C24-5160-4A9D-961A-08FB86A22688@me.com</li>
</ul>
</div>
</body>
</html>
