<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak crashed and crashed again when recovering</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00257" id="c">
<link rel="index" href="maillist.html#00257" id="i">
<link rel="prev" href="msg00256.html" id="p">
<link rel="next" href="msg00262.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00257.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+crashed+and+crashed+again+when+recovering%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak crashed and crashed again when recovering</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100505" rel="nofollow">Wed, 05 May 2010 05:05:45 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Germain,

It looks like you're filling up the dets tables -- which have a 2GB limit per 
file, although Riak uses multiple files, one per vnode.  Have you tried the 
innostore backend?  Also if you continue to use dets, try increasing the number 
of partitions, which will make more, smaller files.</pre><pre>

Sean Cribbs &lt;s...@basho.com&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On May 5, 2010, at 7:55 AM, Germain Maurice wrote:

&gt; I got other informations when I launched &quot;riak console&quot; on the both nodes, as 
&gt; you can see here.
&gt; I hope this will be useful for you and then for me :)
&gt; 
&gt; 10.0.0.40:$ riak console
&gt; [...]
&gt; =INFO REPORT==== 5-May-2010::13:04:48 ===
&gt; Starting handoff of partition 
&gt; 479555224749202520035584085735030365824602865664 to 'r...@10.0.0.41'
&gt; dets: file 
&gt; &quot;/reiser/riak/dets/639406966332270026714112114313373821099470487552&quot; not 
&gt; properly closed, repairing ...
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:05:48 ===
&gt; Dropping partition 479555224749202520035584085735030365824602865664
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:08:47 ===
&gt;    alarm_handler: {set,{system_memory_high_watermark,[]}}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; &quot;dets:open_file failed&quot;
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:19:32 ===
&gt; ** Generic server riak_kv_vnode_master terminating
&gt; ** Last message in was {'$gen_cast',
&gt;                           {start_vnode,
&gt;                               
&gt; 639406966332270026714112114313373821099470487552}}
&gt; ** When Server state == {state,12307,[]}
&gt; ** Reason for termination ==
&gt; ** {{badmatch,
&gt;        {error,
&gt;            {{badmatch,
&gt;                 {error,
&gt;                     {no_more_space_on_file,
&gt;                         
&gt; &quot;/reiser/riak/dets/639406966332270026714112114313373821099470487552.TMP&quot;}}},
&gt;             [{riak_kv_vnode,init,1},
&gt;              {gen_fsm,init_it,6},
&gt;              {proc_lib,init_p_do_apply,3}]}}},
&gt;    [{riak_kv_vnode_master,get_vnode,2},
&gt;     {riak_kv_vnode_master,handle_cast,2},
&gt;     {gen_server,handle_msg,5},
&gt;     {proc_lib,init_p_do_apply,3}]}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.117.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.115.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.119.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.112.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.114.0&gt;)
&gt; Erlang has closed
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt;    alarm_handler: {clear,system_memory_high_watermark}
&gt; /usr/lib/riak/lib/os_mon-2.2.5/priv/bin/memsup: Erlang has closed.
&gt; 
&gt; 
&gt; 
&gt; ==========================================================
&gt; 
&gt; 10.0.0.41:$ riak console
&gt; [...]
&gt; =INFO REPORT==== 5-May-2010::13:03:41 ===
&gt; Spidermonkey VM host starting (&lt;0.120.0&gt;)
&gt; Eshell V5.7.5  (abort with ^G)
&gt; (r...@10.0.0.41)1&gt; dets: file 
&gt; &quot;/reiser/riak/dets/616571003248974668617179538802181898917346541568&quot; not 
&gt; properly closed, repairing ...
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:04:48 ===
&gt; Receiving handoff data for partition 
&gt; 479555224749202520035584085735030365824602865664
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:05:48 ===
&gt; ** Generic server &lt;0.189.0&gt; terminating
&gt; ** Last message in was {tcp,#Port&lt;0.2936&gt;,
&gt;                            [0|&lt;&lt;84,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0&gt;&gt;]}
&gt; ** When Server state == {state,#Port&lt;0.2936&gt;,undefined,undefined,0}
&gt; ** Reason for termination ==
&gt; ** {timeout,{gen_server2,call,
&gt;                         [riak_kv_vnode_master,
&gt;                          
&gt; {get_vnode,479555224749202520035584085735030365824602865664},
&gt;                          60000]}}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:06:41 ===
&gt;    alarm_handler: {set,{system_memory_high_watermark,[]}}
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:07:41 ===
&gt; webmachine error: 
&gt; path=&quot;/riak/blog_content_temp/1714432724f7f975610be47146fec6c7e74bf4bbccdbeea5208ac6e3540e6f4b&quot;
&gt; [{webmachine_decision_core,'-decision/1-lc$^1/1-1-',
&gt;     [{error,
&gt;          {error,
&gt;              {case_clause,{error,timeout}},
&gt;              [{riak_kv_wm_raw,content_types_provided,2},
&gt;               {webmachine_resource,resource_call,3},
&gt;               {webmachine_resource,do,3},
&gt;               {webmachine_decision_core,resource_call,1},
&gt;               {webmachine_decision_core,decision,1},
&gt;               {webmachine_decision_core,handle_request,2},
&gt;               {webmachine_mochiweb,loop,1},
&gt;               {mochiweb_http,headers,5}]}}]},
&gt; {webmachine_decision_core,decision,1},
&gt; {webmachine_decision_core,handle_request,2},
&gt; {webmachine_mochiweb,loop,1},
&gt; {mochiweb_http,headers,5},
&gt; {proc_lib,init_p_do_apply,3}]
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; &quot;dets:open_file failed&quot;
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:16:54 ===
&gt; ** Generic server riak_kv_vnode_master terminating
&gt; ** Last message in was {'$gen_cast',
&gt;                           {start_vnode,
&gt;                               
&gt; 616571003248974668617179538802181898917346541568}}
&gt; ** When Server state == {state,12307,[]}
&gt; ** Reason for termination ==
&gt; ** {{badmatch,
&gt;        {error,
&gt;            {{badmatch,
&gt;                 {error,
&gt;                     {no_more_space_on_file,
&gt;                         
&gt; &quot;/reiser/riak/dets/616571003248974668617179538802181898917346541568.TMP&quot;}}},
&gt;             [{riak_kv_vnode,init,1},
&gt;              {gen_fsm,init_it,6},
&gt;              {proc_lib,init_p_do_apply,3}]}}},
&gt;    [{riak_kv_vnode_master,get_vnode,2},
&gt;     {riak_kv_vnode_master,handle_cast,2},
&gt;     {gen_server,handle_msg,5},
&gt;     {proc_lib,init_p_do_apply,3}]}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.113.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.115.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.114.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.117.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.119.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.118.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.116.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.120.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt;    alarm_handler: {clear,system_memory_high_watermark}
&gt; /usr/lib/riak/lib/os_mon-2.2.5/priv/bin/memsup: Erlang has closed.
&gt;                                                                   Erlang has 
&gt; closed
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Le 05/05/10 11:35, Germain Maurice a écrit :
&gt;&gt; Hi all,
&gt;&gt; I am testing Riak for my document base and i got a problem when i was 
&gt;&gt; migrating documents from my previous
&gt;&gt; system to Riak.
&gt;&gt; I have two nodes and one bucket for the beginning.
&gt;&gt; There are more than 480 000 documents in the bucket and the documents are 
&gt;&gt; html pages.
&gt;&gt; 
&gt;&gt; In the following you'll find all the files and informations after a node was 
&gt;&gt; restarted.
&gt;&gt; After a while, riak crashed again for the two nodes I restarted ... :(
&gt;&gt; 
&gt;&gt; [...]
&gt; 
&gt; 
&gt; -- 
&gt; Germain Maurice
&gt; Administrateur Système/Réseau
&gt; Tel : +33.(0)1.42.43.54.33
&gt; 
&gt; <a  rel="nofollow" href="http://www.linkfluence.net">http://www.linkfluence.net</a>
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00256.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00257">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00257">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00262.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00255.html">Riak crashed and crashed again when recovering</a></span> <span class="sender italic">Germain Maurice</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00256.html">Re: Riak crashed and crashed again when recovering</a></span> <span class="sender italic">Germain Maurice</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak crashed and crashed again when recoverin...</span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00262.html">Re: Riak crashed and crashed again when recov...</a></span> <span class="sender italic">Garrett Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00263.html">Re: Riak crashed and crashed again when r...</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak crashed and crashed again when recovering">
<input type="hidden" name="msgid" value="36D0DCA5-4194-4FB5-91D7-3CD71D6A58BF@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00257.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+crashed+and+crashed+again+when+recovering%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00256.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00262.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">36D0DCA5-4194-4FB5-91D7-3CD71D6A58BF@basho.com</li>
</ul>
</div>
</body>
</html>
