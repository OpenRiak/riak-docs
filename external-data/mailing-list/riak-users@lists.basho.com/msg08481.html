<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Strategies for testing against Riak</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08481" id="c">
<link rel="index" href="maillist.html#08481" id="i">
<link rel="prev" href="msg08469.html" id="p">
<link rel="next" href="msg08483.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08481.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strategies+for+testing+against+Riak%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Strategies for testing against Riak</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brad+Heller%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brad Heller</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120908" rel="nofollow">Sat, 08 Sep 2012 15:42:27 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey Sean,

Thanks for the suggestion. I've spent a few hours trying to get this up and 
running and I'm having a bit of a hard time. Is there any documentation around 
Riak::TestServer?</pre><pre>

What are the configuration values for :source and :root supposed to be exactly? 
As I understand it, :root should be something like /path/to/riak/bin and source 
should be something like /path/to/riak. Is that correct? Also, how does Riak:: 
TestServer#create behave exactly?

In our dev environments we have a Riak configuration that includes config files 
and binaries that our dev's can just git clone so they can get started quickly. 
It is very similar to what the following docs outline only with three nodes 
instead of one: <a  rel="nofollow" href="https://wiki.basho.com/Building-a-Development-Environment.html">https://wiki.basho.com/Building-a-Development-Environment.html</a>

What I'd really like to set up is a way for Riak::TestServer to use the same 
binaries as our dev riak config, but a different configuration (app.config, 
vm.args, etc.). Is this possible? Alternatively, we could stick a copy of the 
Riak binaries directly in the repo that is using Ripple to make it a bit more 
standalone.

What is the configuration you were anticipating when you wrote the 
Riak::TestServer class?

Thanks,
Brad Heller

On Sep 7, 2012, at 5:02 AM, Sean Cribbs &lt;s...@basho.com&gt; wrote:

&gt; If it's only for your test suite, use a local memory-only node via the
&gt; Ripple::TestServer. If you configure it correctly (there's a bundled
&gt; Rails generator that helps), it will delete all the contents of Riak
&gt; in one fell-swoop after or before each test/example.
&gt; 
&gt; On Fri, Sep 7, 2012 at 2:49 AM, Brad Heller &lt;b...@cloudability.com&gt; wrote:
&gt;&gt; Hey all,
&gt;&gt; 
&gt;&gt; So we're rolling out Riak more and more and so far, so good. In fact we're
&gt;&gt; starting to accumulate a pretty sizable test suite of our data access layer.
&gt;&gt; To support this we've written some code that helps clean out buckets between
&gt;&gt; test runs. We're using Ruby (ripple + ruby-risk-client, obviously) so we
&gt;&gt; just monkey patch the bucket object and detect if it was used or not.
&gt;&gt; 
&gt;&gt; If it was used during a test, we iterate over all the keys and delete each
&gt;&gt; one. We're cognizant of the risks in doing this for large clusters, but in
&gt;&gt; our test enviro the number of documents per test is pretty small and the
&gt;&gt; operations themselves are quite fast.
&gt;&gt; 
&gt;&gt; The problem we're having, though, is that when we run the full suite (or a
&gt;&gt; large subset of the suite) all at once the churn in Riak seems to be so
&gt;&gt; quick that sometimes Riak isn't quite in the state that we expect it to be
&gt;&gt; in when the test runs! For instance, we have a test that checks that the
&gt;&gt; right number of linked documents are created when a given object is saved.
&gt;&gt; If we run the test by itself everything works fine--the expectation that 10
&gt;&gt; documents are created indeed checks out. If we run this test as part of a
&gt;&gt; large suite of tests, the expectation fails and sometimes 11 documents or 12
&gt;&gt; documents appear (we check by counting the keys in the linked bucket).
&gt;&gt; 
&gt;&gt; I would think that this has something to do with Riak's eventually
&gt;&gt; consistent delete operation, but wanted to tap in to the brain trust: Is
&gt;&gt; there any tuning we can do in test to prevent this?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Brad Heller | Engineering Lead | Cloudability.com | 541-231-1514 | Skype:
&gt;&gt; brad.heller | @bradhe | @cloudability
&gt;&gt; 
&gt;&gt; We're hiring! <a  rel="nofollow" href="http://cloudability.com/jobs">http://cloudability.com/jobs</a>
&gt;&gt; 
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08469.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08481">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08481">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08483.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08465.html">Strategies for testing against Riak</a></span> <span class="sender italic">Brad Heller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08466.html">Re: Strategies for testing against Riak</a></span> <span class="sender italic">Guido Medina</span></li>
<li class="icons-email"><span class="subject"><a href="msg08467.html">Re: Strategies for testing against Riak</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08469.html">Re: Strategies for testing against Riak</a></span> <span class="sender italic">Pinney Colton</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Strategies for testing against Riak</span> <span class="sender italic">Brad Heller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08483.html">Re: Strategies for testing against Riak</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08553.html">Re: Strategies for testing against Riak</a></span> <span class="sender italic">Brad Heller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08554.html">Re: Strategies for testing against Ria...</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Strategies for testing against Riak">
<input type="hidden" name="msgid" value="C6A3595A-F061-4BA8-A472-A348A6100B72@cloudability.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08481.html">
<input type="submit" value=" Brad Heller ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strategies+for+testing+against+Riak%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08469.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08483.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">C6A3595A-F061-4BA8-A472-A348A6100B72@cloudability.com</li>
</ul>
</div>
</body>
</html>
