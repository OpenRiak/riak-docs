<!DOCTYPE html>
<html lang="en">
<head>
<title>Crash Log: yz_anti_entropy</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#17866" id="c">
<link rel="index" href="mail2.html#17866" id="i">
<link rel="prev" href="msg17864.html" id="p">
<link rel="next" href="msg17867.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17866.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Crash+Log%5C%3A+yz_anti_entropy%22&amp;o=newest" rel="nofollow"><span itemprop="name">Crash Log: yz_anti_entropy</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Junk%2C+Damion+A%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Junk, Damion A</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170118" rel="nofollow">Wed, 18 Jan 2017 12:37:59 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi All -

I'm seeing some strange behavior on a dev server. Right now the riak kv 2.2.0 
server has 9GB free Ram, and no keys/values stored in Riak at all. (I've been 
trying to figure out what's going on with the server, so I completely wiped 
/var/lib/riak and re-installed from packagecould). Ulimit -n is set 
appropriately as well.</pre><pre>

If I make the following changes to /etc/riak/riak.conf I get crash error 
messages:

storage_backend = leveldb
search = on

Turning search on with bitcask results in no such crash/error messages. When 
switching between bitcask/leveldb on this test instance, i'm wiping the 
/var/lib/riak directory each time. 

Not much is turning up in google, and there is definitely plenty of memory 
available for allocation. 


Just wondering if anyone else has seen this. 


Thanks!


The error messages:

(crash.log)

2017-01-18 15:27:23 =CRASH REPORT====
  crasher:
    initial call: yz_index_hashtree:init/1
    pid: &lt;0.2356.0&gt;
    registered_name: []
    exception exit: {{{badmatch,{error,{db_open,&quot;IO error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate 
memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},{yz_index_hashtree,init,1,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,191}]},{gen_server,init_it,6,[{file,&quot;gen_server.erl&quot;},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]},[{gen_server,init_it,6,[{file,&quot;gen_server.erl&quot;},{line,328}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
    ancestors: [yz_index_hashtree_sup,yz_general_sup,yz_sup,&lt;0.711.0&gt;]
    messages: []
    links: [&lt;0.2206.0&gt;]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 1598
    stack_size: 27
    reductions: 689
  neighbours:
2017-01-18 15:27:24 =SUPERVISOR REPORT====
     Supervisor: {local,yz_index_hashtree_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,{db_open,&quot;IO error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate 
memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},{yz_index_hashtree,init,1,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,191}]},{gen_server,init_it,6,[{file,&quot;gen_server.erl&quot;},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
     Offender:   
[{pid,&lt;0.2356.0&gt;},{name,ignored},{mfargs,{yz_index_hashtree,start_link,undefined}},{restart_type,temporary},{shutdown,5000},{child_type,worker}]



(console.log)

2017-01-18 15:35:39.100 [error] &lt;0.3049.0&gt; CRASH REPORT Process &lt;0.3049.0&gt; with 
0 neighbours exited with reason: no match of right hand value 
{error,{db_open,&quot;IO error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate memory&quot;}} in hashtree:new_segment_store/2 line 725 in 
gen_server:init_it/6 line 328
2017-01-18 15:35:39.101 [error] &lt;0.2206.0&gt; Supervisor yz_index_hashtree_sup had 
child ignored started with {yz_index_hashtree,start_link,undefined} at 
&lt;0.3049.0&gt; exit with reason no match of right hand value {error,{db_open,&quot;IO 
error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate memory&quot;}} in hashtree:new_segment_store/2 line 725 in context 
child_terminated
2017-01-18 15:35:39.101 [info] 
&lt;0.3050.0&gt;@riak_core_throttle:enable_throttle:119 Enabling throttle for 
yokozuna/aae_throttle.
2017-01-18 15:35:39.101 [error] &lt;0.3030.0&gt; gen_server yz_entropy_mgr terminated 
with reason: no match of right hand value {error,{{badmatch,{error,{db_open,&quot;IO 
error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate 
memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},...]}}
 in yz_entropy_mgr:'-reload_hashtrees/3-fun-0-'/2 line 371
2017-01-18 15:35:39.101 [error] &lt;0.3030.0&gt; CRASH REPORT Process yz_entropy_mgr 
with 0 neighbours exited with reason: no match of right hand value 
{error,{{badmatch,{error,{db_open,&quot;IO error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate 
memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},...]}}
 in yz_entropy_mgr:'-reload_hashtrees/3-fun-0-'/2 line 371 in 
gen_server:terminate/6 line 744
2017-01-18 15:35:39.102 [error] &lt;0.2010.0&gt; Supervisor yz_general_sup had child 
yz_entropy_mgr started with yz_entropy_mgr:start_link() at &lt;0.3030.0&gt; exit with 
reason no match of right hand value {error,{{badmatch,{error,{db_open,&quot;IO 
error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate 
memory&quot;}}},[{hashtree,new_segment_store,2,[{file,&quot;src/hashtree.erl&quot;},{line,725}]},{hashtree,new,2,[{file,&quot;src/hashtree.erl&quot;},{line,246}]},{yz_index_hashtree,do_new_tree,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,377}]},{lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},{yz_index_hashtree,init_trees,3,[{file,&quot;src/yz_index_hashtree.erl&quot;},{line,340}]},...]}}
 in yz_entropy_mgr:'-reload_hashtrees/3-fun-0-'/2 line 371 in context 
child_terminated
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17864.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#17866">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#17866">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17867.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Crash Log: yz_anti_entropy</span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17867.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Magnus Kessler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17868.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17869.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17870.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17871.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Crash Log: yz_anti_entropy">
<input type="hidden" name="msgid" value="25F97729-61F7-4E4C-8C30-590CB670F63D@purdue.edu">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17866.html">
<input type="submit" value=" Junk, Damion A ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Crash+Log%5C%3A+yz_anti_entropy%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17864.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17867.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">25F97729-61F7-4E4C-8C30-590CB670F63D@purdue.edu</li>
</ul>
</div>
</body>
</html>
