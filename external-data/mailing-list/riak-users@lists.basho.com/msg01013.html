<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: PBC API questions</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01013" id="c">
<link rel="index" href="maillist.html#01013" id="i">
<link rel="prev" href="msg00953.html" id="p">
<link rel="next" href="msg00954.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01013.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+PBC+API+questions%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: PBC API questions</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Meredith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Meredith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100903" rel="nofollow">Fri, 03 Sep 2010 14:12:37 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
 Hi Mingfai,

Don't worry, you didn't come off ranting :)</pre><pre>

1. The symbolic names are mapped to high values  of r/w
    one = 0xfffffffe
    quorum = 0xfffffffd
    all = 0xfffffffc
    default = 0xfffffffb

</pre><tt>2. The PBC API does not currently support any of the conditional updates 
</tt><tt>the REST API  provides. I've filed a bug 
</tt><tt><a  rel="nofollow" href="https://issues.basho.com/show_bug.cgi?id=690">https://issues.basho.com/show_bug.cgi?id=690</a> to track the issue.
</tt><pre style="margin: 0em;">

</pre><tt>3. yes - it is referring to allow_mult. If you cant to know about 
</tt><tt>conflicts on write you can set allow_mult=true on your bucket and use 
</tt><tt>the return_body option on the put.  If you get back multiple values then 
</tt><tt>there was a conflict.
</tt><pre style="margin: 0em;">

</pre><tt>4. We don't have any enhancements to the interface planned for the 
</tt><tt>moment.  Improved API access to the cluster is desirable, but what to 
</tt><tt>expose and how to do it needs  thought.  Exposing admin operations 
</tt><tt>without any authentication seems dangerous.
</tt><pre style="margin: 0em;">

Good luck with your client.  Mail the list if you get stuck.

Jon Meredith
-- Basho


On 8/26/10 12:32 AM, Mingfai wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
hi,

</pre><tt>I'm new to Riak and learning it rapidly. Other than Riak, I also tried 
</tt><tt>MongoDB, CouchDB, and Voldemort (and also Cassandra ) briefly. Riak is 
</tt><tt>quite suitable for my needs. Thanks for releasing it as an open source 
</tt><tt>project.
</tt><pre style="margin: 0em;">

</pre><tt>I got a number of questions but let me ask those about the PBC API 
</tt><tt>first only. Just some backgrounds: I am implementing my own Java 
</tt><tt>ProtoBuf client. I do it for several reasons: Kresten claims his Java 
</tt><tt>PB client performs ~10X better than the Java REST client, PB is 
</tt><tt>preferred to HTTP/REST &quot;officially&quot; for Erlang development, and I want 
</tt><tt>to take a different approach to use PB by using Java NIO/Netty instead 
</tt><tt>of making direct socket connection.
</tt><pre style="margin: 0em;">

My questions are as follows:

   1. For put and delete operations, the 'w' and 'dw' parameters are
      defined as integer, but in the documentation, it says &quot;possible
      values include 'default', 'one', 'quorum', 'all', or any integer
      &lt;= N&quot;. so what value represents 'default', 'quorum', and 'all'?
      does 0 means default? how about -1?

   2. REST API allows &quot;If-None-Match, If-Match, If-Modified-Since, and
      If-Unmodified-Since&quot; checking. PBC API does not have equivalent,
      right? I read that for Erlang, PB is the preferred client. But
      it doesn't provide all features that REST API provide?

      It seems to me the REST and BPC APIs are not very consistent
      atm. for example, REST API doesn't provide a way to list buckets
      (Issue 78); other than those &quot;If-None-Match ..&quot; criterias, the
      document also mentioned a number of missing features in BPC API
      and suggested us to use REST API for those cases.

   3. I want to clarify the expected response for a &quot;Store a new or
      existing object with a key&quot; cases
          * From the doc, &quot;Riak can allow the last update to
            automatically &quot;win&quot; or Riak can return both versions of
            the object to the client.&quot;, I suppose it refer to the
            &quot;allow_multi&quot; bucket parameter. I watched the Wriaki video
            and roughly know how allow_multi=true works in keeping
            versions.
          * for a bucket with allow_multi=false, when an update is
            executed:
                o if vclock is not provided, Riak won't know I try to
                  update an existing object so any update shall always
                  be successful.

                o if supplied vclock doesn't match the the vlock value
                  of the current object, would it return
                  error(RpbErrorResp)? or just &quot;allow the last update
                  to automatically win&quot;? or would it return the
                  sibling like allow_multi=true?

                  The following sequence is for illustrating the
                  scenario of the above question:
                  1) client A (or whoever) put a new k1,v1, with vclock c1
                  2) client A and B both read the entry with c1
                  3) client A updates the entry to k1,v2, supplied c1,
                  the vclock is updated to c2
                  4) client B tries to update k1, supplied v3 and c1.
                  Because the vclock is updated to c2 in step 3, i
                  expect it to return an error, or at least there
                  should an easy way for to know about conflict.

   4. I wonder what interface will be added to the PBC API in your
      roadmap. there is essential no administrative interface (except
      set bucket properties) or any SPI. Take Voldemort as an example,
      they provides an AdminClient interface
      
(<a  rel="nofollow" href="http://project-voldemort.com/javadoc/client/index.html?voldemort/client/protocol/admin/AdminClient.html">http://project-voldemort.com/javadoc/client/index.html?voldemort/client/protocol/admin/AdminClient.html</a>)
      and they also have API to get the node list for a key.
      (DefaultStoreClient.getResponsibleNodes() ) Riak doesn't provide
      these kind of interface.In Erlang console, I could get the
      virtual node list in the ring with
      riak_core_ring_manager:get_my_ring(), could this kind of
      information be exposed as an admin client interface?

      There are two related issues from my search:
      <a  rel="nofollow" href="https://issues.basho.com/show_bug.cgi?id=271">https://issues.basho.com/show_bug.cgi?id=271</a>
      <a  rel="nofollow" href="https://issues.basho.com/show_bug.cgi?id=421">https://issues.basho.com/show_bug.cgi?id=421</a>

      For Issue 421, does HTTP APIs refers to the the admin interface
      that I mentioned above?

      Riak provides a map reduce framework/feature, but I don't really
      prefer to write complex mapreduce job in javascript or to learn
      Erlang. If there are SPI for resolving the physical node for
      keys, I may use an external map reduce framework like GridGain
      (or Hadoop) and run map-reduce process the process data in Riak
      with local data affinity.

</pre><tt>Please don't get me wrong as I like Riak very much so far. I am 
</tt><tt>writing to clarify things rather than ranting, ;-) as I'm new and 
</tt><tt>probably may understand the things incorrectly . thank you very much.
</tt><pre style="margin: 0em;">

regards,
mingfai


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00953.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01013">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01013">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00954.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00953.html">PBC API questions</a></span> <span class="sender italic">Mingfai</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: PBC API questions</span> <span class="sender italic">Jon Meredith</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: PBC API questions">
<input type="hidden" name="msgid" value="4C8164BA.5050409@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01013.html">
<input type="submit" value=" Jon Meredith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+PBC+API+questions%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00953.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00954.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4C8164BA.5050409@basho.com</li>
</ul>
</div>
</body>
</html>
