<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Unexpected performance results with riak</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03341" id="c">
<link rel="index" href="maillist.html#03341" id="i">
<link rel="prev" href="msg03340.html" id="p">
<link rel="next" href="msg03343.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03341.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Unexpected+performance+results+with+riak%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Unexpected performance results with riak</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110515" rel="nofollow">Sun, 15 May 2011 10:53:48 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On May 15, 2011, at 10:55 AM, Max wrote:
&gt; 
&gt; Is this to be expected? The objects were not that large in bytesize
&gt; and 2000 objects in one bucket isnt that much, either.
&gt; </pre><pre>

Consider that the JSON-encoding of a list of these 2000 objects has to happen 
on server-side as well, that's going to be big in RAM before you even try to 
encode it.  Instead, use chunked=true in your request, which will return 
results to you as they are completed and returned to the coordinating node (in 
multipart/mixed format).

&gt; - Insert
&gt; 
&gt; Batch inserting of around 60.000 objects in the same size as above
&gt; took rather long and actually didnt really work.
&gt; 
&gt; My script which inserted the objects in riak died at around 40.000 or
&gt; so and said it couldnt connect to the riak node anymore. In the riak
&gt; logs I found an error message which indicated that the node ran out of
&gt; memory and died.

512MB is pretty small for any database that will have a significant working 
set. Give it some more RAM.

&gt; 
&gt; - Question
&gt; 
&gt; This is really my first shot at riak, so there is definately the
&gt; chance that I screwed something up.
&gt; 

I don't think you've screwed anything up, you just didn't have context for why 
things work the way they do.

&gt;    Are there any settings I could tweak?
&gt;    Are the hardware settings too constrained?
&gt;    Maybe the PHP client library I used for interacting with riak is
&gt; the limiting factor here?

Again, give Riak more RAM and 3 or more nodes and you'll get better 
performance.  We (purposefully) don't optimize for the 1-node use-case.  While 
Riak's default storage doesn't keep any data in RAM, you'll need memory for the 
node itself, for the storage engine's key-tables, and for copies of any data 
that is in-flight. For reference, a fresh, quiescent node takes only 25MB on my 
machine.

&gt;     Running all nodes on the same physical machine is rather stupid,
&gt; but if this is a problem - how can i better test the performance of
&gt; riak?

If you're trying to test performance (beyond a micro-benchmark), by all means 
use multiple machines.  Ideally, use ones similar enough to your deployment 
environment that you'll have a good idea how things will behave in production.

&gt;     Is map reduce really that slow? I read about the performance hit
&gt; that map reduce has on the riak mailing list, but if Map Reduce is
&gt; slow, how are you supposed to perform &quot;queries&quot; for data needed nearly
&gt; in realtime? I know that riak is not as fast as redis.
&gt; 

Riak and Redis are apples-and-oranges (but go well together). Redis is fast for 
certain operations because it has data structures specifically designed for 
fast, single-server execution of those operations.  On the other hand, Riak is 
designed primarily for fault-tolerance in the case of network and hardware 
failure, it just happens that MapReduce fits nicely on top of that kind of 
system (and is generic, rather than specifically tuned). Yes, Riak's MapReduce 
is designed for low-latency queries, but it's also designed for &quot;targeted&quot; 
queries where you don't slurp the entire contents of a bucket from disk.  
Structure your data so that you can know -- or deterministically guess -- what 
keys should be involved in your query. Then you won't be trying to fetch and 
filter all of the data all the time.

Sean Cribbs &lt;s...@basho.com&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03340.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03341">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03341">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03343.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03340.html">Unexpected performance results with riak</a></span> <span class="sender italic">Max</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Unexpected performance results with riak</span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Unexpected performance results with riak">
<input type="hidden" name="msgid" value="2EBD5741-53E0-4894-931D-7F2BB294ECB6@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03341.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Unexpected+performance+results+with+riak%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03340.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03343.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">2EBD5741-53E0-4894-931D-7F2BB294ECB6@basho.com</li>
</ul>
</div>
</body>
</html>
