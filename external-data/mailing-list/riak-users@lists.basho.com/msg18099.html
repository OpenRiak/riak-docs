<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak + leveled - volume testing with 2i</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#18099" id="c">
<link rel="index" href="maillist.html#18099" id="i">
<link rel="prev" href="msg18097.html" id="p">
<link rel="next" href="msg18100.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18099.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+%5C%2B+leveled+%5C-+volume+testing+with+2i%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak + leveled - volume testing with 2i</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Martin+Sumner%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Martin Sumner</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170324" rel="nofollow">Fri, 24 Mar 2017 09:20:05 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I've now completed the first phase of testing Riak/leveled with 2i query
load on top of standard GET/PUT Key/Value pressure.</pre><pre>

In the previous tests without 2i Riak/leveldb was throttled by write
pressure, which was exaggerated by enabling sync_on_write, using
traditional HDDs or using larger objects.  To provide an interesting
comparison with secondary indexes I've tested this so far only with SDDs,
with no sync_on_write and with midsize objects (8KB).

The test results follow previous trends with Riak + leveldb performing well
until disk busyness becomes a commonly recurring factor - and at this point
the throughput achievable becomes increasingly volatile.  By comparison
riak + leveled is constantly constrained by available CPU, and performs at
a more consistent rate with reduced tail latency throughout the test.
However riak + leveled cannot perform as fast riak + leveldb over short
intervals when riak + leveldb is not subject to resource pressure.

A six hour test with 100 GETs to 20 updates to 2 secondary index range
queries was used, with half the updates carrying four new index entries
each.  Over the course of the test throughput was roughly equivalent - with
Riak/leveled achieving 4.48% more throughput (which is close to the margin
of error in cloud-based testing).  However in the last hour of the test the
throughput advantage for Riak/leveled had increased to 22.36%, and this
appears to be a consistent sustainable advantage.

As ever, multiple caveats apply.  I've attempted a more complete write-up
of the 2i test results here:

<a  rel="nofollow" href="https://github.com/martinsumner/leveled/blob/master/docs/VOLUME.md#riak-cluster-test---phase-4">https://github.com/martinsumner/leveled/blob/master/docs/VOLUME.md#riak-cluster-test---phase-4</a>

There were a number of optimisations made to leveled as part of this round
of testing, mainly to try and improve the efficiency of the layout of the
SST files within the Ledger (key and metadata store).

In the short term there is some additional refactoring I'm going to attempt
to reduce the overhead of starting a 2i query within leveled.  I will then
look to demonstrate potential improvements in hashtree rebuild times and
overheads in Riak/leveled when compared to Riak/leveldb.  I also believe
the improvements made as part of the 2i testing round should also reap
benefits in the previous comparisons - so I will revisit those tests too
and get up-to-date results.

In the medium term I intend to use leveled as a starting point for
investigating new Riak features, and also new configurations (e.g.
cloud-optimised, single backend for RiakCS) which may benefit from the
flexibility gained from separation of Key and Value stores.

Many thanks to Russell Brown for his help and guidance over the past
month.  Also a big thanks to Mark Shaw and Angus McAllister from Amazon for
their continued support running the tests.

Cheers

Martin
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18097.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#18099">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18099">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18100.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak + leveled - volume testing with 2i">
<input type="hidden" name="msgid" value="CANzjUxCqDK5JETUctdp_tqu4ir_W9ZetK8HZvvsTafMezUgndA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18099.html">
<input type="submit" value=" Martin Sumner ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+%5C%2B+leveled+%5C-+volume+testing+with+2i%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18097.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18100.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANzjUxCqDK5JETUctdp_tqu4ir_W9ZetK8HZvvsTafMezUgndA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
