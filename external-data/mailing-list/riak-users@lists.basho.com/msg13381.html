<!DOCTYPE html>
<html lang="en">
<head>
<title>Proper data filtration and pagination</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd4.html#13381" id="c">
<link rel="index" href="mail4.html#13381" id="i">
<link rel="prev" href="msg13380.html" id="p">
<link rel="next" href="msg13383.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13381.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Proper+data+filtration+and+pagination%22&amp;o=newest" rel="nofollow"><span itemprop="name">Proper data filtration and pagination</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Anton+Yakushin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Anton Yakushin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140113" rel="nofollow">Mon, 13 Jan 2014 05:52:06 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

Could anyone advice on how to properly organize data structure so
it could be efficiently filtered and results paginated?</pre><pre>

A structure example from our current system.
We have products stored in the following JSON:
{
    &quot;name&quot;: &lt;string&gt;
    &quot;category&quot;: {
        &quot;key&quot; : &lt;string&gt;,
        &quot;name&quot;: &lt;string&gt;
    },
    &quot;sub_categories&quot;: [
        {
            &quot;key&quot; : &lt;string&gt;,
            &quot;name&quot;: &lt;string&gt;
        }
    ],
    ... lots of other attributes: strings, arrays, objects.
}

What we need is be able to fetch filtered by their attributes
products with paginated results.

What we have tried:
1. Implemented filtration using key filters. So currently product
keys look like: &quot;&lt;unique_id&gt;-c:&lt;category_key&gt;-sc:&lt;subcategory_key&gt;...&quot;
Disadvantages were that the keys could possibly change and they
had quite a large length. Also it was hard to add a new attribute to a key.

2. MapReduce was used to filter by all attributes that were not in
product keys. Also results from key filters were passed through
MapReduce to decrease amount of requests.

3. SecondaryIndexes were used for some attributes. But it's very
inconvenient that one can't filter by several indexes at a time.

4. At the first moment seemed that Riak Search could solve all these
problems, but it transforms product objects into a flat structure
making them hardly usable. Case with Search + MapReduce was too slow
and didn't allow to paginate data.

5. Pagination with MapReduce was too slow and put exceptional load
on our servers.

So the issue which holds our system from growing and feature
increasing is how should the data be re-organized to make them easily and
efficiently
filtered with pagination?

Would highly appreciate any suggestions. It's really a big issue now
so we even think about switching to another database (e.g. MongoDB) if
we would not find a suitable solution in Riak.

Best regards,
Anton
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13380.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd4.html#13381">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail4.html#13381">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13383.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Proper data filtration and pagination</span> <span class="sender italic">Anton Yakushin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13383.html">Re: Proper data filtration and pagination</a></span> <span class="sender italic">Eric Redmond</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13387.html">Re: Proper data filtration and pagination</a></span> <span class="sender italic">Anton Yakushin</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Proper data filtration and pagination">
<input type="hidden" name="msgid" value="CAKViXmTiMekqBkjE6aVvuY_ZzhQuJYrX=fw2nhH+StzbL0Zr1A@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13381.html">
<input type="submit" value=" Anton Yakushin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Proper+data+filtration+and+pagination%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13380.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13383.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAKViXmTiMekqBkjE6aVvuY_ZzhQuJYrX=fw2nhH+StzbL0Zr1A@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
