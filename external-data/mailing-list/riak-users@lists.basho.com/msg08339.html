<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Node cannot join</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08339" id="c">
<link rel="index" href="maillist.html#08339" id="i">
<link rel="prev" href="msg08338.html" id="p">
<link rel="next" href="msg08340.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08339.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Node+cannot+join%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Node cannot join</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Shane+McEwan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Shane McEwan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120821" rel="nofollow">Tue, 21 Aug 2012 07:17:40 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Speaking of joining clusters . . .

</pre><tt>I'm in the middle of writing a CFEngine promise to automatically install 
</tt><tt>Riak, configure it and join a cluster.
</tt><pre style="margin: 0em;"></pre><pre>

</pre><tt>Is it best to have all nodes issue a 'riak-admin cluster join' command 
</tt><tt>before a single node issues the final 'riak-admin cluster commit' 
</tt><tt>command? (Potentially hard to do with CFEngine) Or is it OK to have each 
</tt><tt>node issue its own 'join' and 'commit' commands? (Reasonably easy)
</tt><pre style="margin: 0em;">

</pre><tt>Or is it a bad idea to build the cluster automatically and I should 
</tt><tt>really be doing it manually?
</tt><pre style="margin: 0em;">

</pre><tt>Secondly, is there a riak-admin command or status value that 
</tt><tt>definitively says &quot;This node is part of a cluster&quot; (even if all other 
</tt><tt>nodes in the cluster are down) so that CFEngine knows not to re-issue 
</tt><tt>the cluster join command a second time?
</tt><pre style="margin: 0em;">

Thanks!

On 21/08/12 14:36, Ryan Zezeski wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Daniel,

Cluster operations (invoked by `riak-admin cluster`) are now
multi-phase.  Instead of calling an operation and it taking effect
immediately you need to stage your changes, view your changes, and then
commit them.  E.g.

riak-admin cluster join blah

riak-admin cluster plan

riak-admin cluster commit

There is an `-f` option to keep the old behavior but we recommend
against this.  Staged clustering was put in place to keep users from
hurting their clusters and to make multiple changes more efficient.

-Z

On Tue, Aug 21, 2012 at 9:28 AM, Daniel Iwan &lt;iwan.dan...@gmail.com
&lt;<a  rel="nofollow" href="mailto:iwan.dan...@gmail.com">mailto:iwan.dan...@gmail.com</a>&gt;&gt; wrote:

    Hi

    In my setup everything worked fine until I upgraded to riak 1.2
    (although this may be a coincidence)
    Nodes are installed from scratch with changes only to db backend (I'm
    using eLevelDB)
    and names.
    For some reason node cannot join to another.
    What am I doing wrong?

    I'm using Ubuntu 10.04 but I've seen the same behaviour on Ubuntu 12.04
    I may miss openssl dependency. I don't know if that matters


    user@node2:~$ riak-admin cluster join riak@10.173.240.1
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.1">mailto:riak@10.173.240.1</a>&gt;
    Attempting to restart script through sudo -H -u riak
    Success: staged join request for 'riak@10.173.240.2
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.2">mailto:riak@10.173.240.2</a>&gt;' to 'riak@10.173.240.1
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.1">mailto:riak@10.173.240.1</a>&gt;'


    user@node1:~$ riak-admin member-status
    Attempting to restart script through sudo -H -u riak
    ================================= Membership
    ==================================
    Status     Ring    Pending    Node
    
-------------------------------------------------------------------------------
    joining     0.0%      --      'riak@10.173.240.2
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.2">mailto:riak@10.173.240.2</a>&gt;'
    valid     100.0%      --      'riak@10.173.240.1
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.1">mailto:riak@10.173.240.1</a>&gt;'
    
-------------------------------------------------------------------------------

    Valid:1 / Leaving:0 / Exiting:0 / Joining:1 / Down:0
    user@node1:~$
    user@node1:~$ riak-admin transfers

    Attempting to restart script through sudo -H -u riak
    No transfers active

    Active Transfers:

    user@node1:~$

    riak-admin status
    Attempting to restart script through sudo -H -u riak
    1-minute stats for 'riak@10.173.240.1 &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.1">mailto:riak@10.173.240.1</a>&gt;'
    -------------------------------------------
    vnode_gets : 0
    vnode_gets_total : 0
    vnode_puts : 0
    vnode_puts_total : 0
    vnode_index_reads : 0
    vnode_index_reads_total : 0
    vnode_index_writes : 0
    vnode_index_writes_total : 0
    vnode_index_writes_postings : 0
    vnode_index_writes_postings_total : 0
    vnode_index_deletes : 0
    vnode_index_deletes_total : 0
    vnode_index_deletes_postings : 0
    vnode_index_deletes_postings_total : 0
    node_gets : 0
    node_gets_total : 0
    node_get_fsm_siblings_mean : 0
    node_get_fsm_siblings_median : 0
    node_get_fsm_siblings_95 : 0
    node_get_fsm_siblings_99 : 0
    node_get_fsm_siblings_100 : 0
    node_get_fsm_objsize_mean : 0
    node_get_fsm_objsize_median : 0
    node_get_fsm_objsize_95 : 0
    node_get_fsm_objsize_99 : 0
    node_get_fsm_objsize_100 : 0
    node_get_fsm_time_mean : 0
    node_get_fsm_time_median : 0
    node_get_fsm_time_95 : 0
    node_get_fsm_time_99 : 0
    node_get_fsm_time_100 : 0
    node_puts : 0
    node_puts_total : 0
    node_put_fsm_time_mean : 0
    node_put_fsm_time_median : 0
    node_put_fsm_time_95 : 0
    node_put_fsm_time_99 : 0
    node_put_fsm_time_100 : 0
    read_repairs : 0
    read_repairs_total : 0
    coord_redirs_total : 0
    executing_mappers : 0
    precommit_fail : 0
    postcommit_fail : 0
    pbc_active : 0
    pbc_connects : 0
    pbc_connects_total : 0
    cpu_nprocs : 340
    cpu_avg1 : 182
    cpu_avg5 : 136
    cpu_avg15 : 92
    mem_total : 4154609664
    mem_allocated : 1475477504
    disk : [{&quot;/&quot;,54417668,2},
             {&quot;/dev&quot;,2024188,1},
             {&quot;/dev/shm&quot;,2028616,0},
             {&quot;/var/run&quot;,2028616,1},
             {&quot;/var/lock&quot;,2028616,0},
             {&quot;/lib/init/rw&quot;,2028616,0},
             {&quot;/var/lib/ureadahead/debugfs&quot;,54417668,2},
             {&quot;/media/ARRAY1&quot;,10739982336,1},
             {&quot;/boot&quot;,186663,22}]
    nodename : 'riak@10.173.240.1 &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.1">mailto:riak@10.173.240.1</a>&gt;'
    connected_nodes : ['riak@10.173.240.2 &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.2">mailto:riak@10.173.240.2</a>&gt;']
    sys_driver_version : &lt;&lt;&quot;2.0&quot;&gt;&gt;
    sys_global_heaps_size : 0
    sys_heap_type : private
    sys_logical_processors : 4
    sys_otp_release : &lt;&lt;&quot;R15B01&quot;&gt;&gt;
    sys_process_count : 1392
    sys_smp_support : true
    sys_system_version : &lt;&lt;&quot;Erlang R15B01 (erts-5.9.1) [source] [64-bit]
    [smp:4:4] [async-threads:64] [kernel-poll:true]&quot;&gt;&gt;
    sys_system_architecture : &lt;&lt;&quot;x86_64-unknown-linux-gnu&quot;&gt;&gt;
    sys_threads_enabled : true
    sys_thread_pool_size : 64
    sys_wordsize : 8
    ring_members : ['riak@10.173.240.1
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.1">mailto:riak@10.173.240.1</a>&gt;','riak@10.173.240.2
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.2">mailto:riak@10.173.240.2</a>&gt;']
    ring_num_partitions : 64
    ring_ownership : &lt;&lt;&quot;[{'riak@10.173.240.1
    &lt;<a  rel="nofollow" href="mailto:riak@10.173.240.1">mailto:riak@10.173.240.1</a>&gt;',64}]&quot;&gt;&gt;
    ring_creation_size : 64
    storage_backend : riak_kv_eleveldb_backend
    erlydtl_version : &lt;&lt;&quot;0.7.0&quot;&gt;&gt;
    riak_control_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    cluster_info_version : &lt;&lt;&quot;1.2.2&quot;&gt;&gt;
    riak_api_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    riak_search_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    merge_index_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    riak_kv_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    riak_pipe_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    riak_core_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    lager_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    syntax_tools_version : &lt;&lt;&quot;1.6.8&quot;&gt;&gt;
    compiler_version : &lt;&lt;&quot;4.8.1&quot;&gt;&gt;
    bitcask_version : &lt;&lt;&quot;1.5.1&quot;&gt;&gt;
    basho_stats_version : &lt;&lt;&quot;1.0.2&quot;&gt;&gt;
    luke_version : &lt;&lt;&quot;0.2.5&quot;&gt;&gt;
    webmachine_version : &lt;&lt;&quot;1.9.2&quot;&gt;&gt;
    mochiweb_version : &lt;&lt;&quot;1.5.1&quot;&gt;&gt;
    inets_version : &lt;&lt;&quot;5.9&quot;&gt;&gt;
    erlang_js_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
    runtime_tools_version : &lt;&lt;&quot;1.8.8&quot;&gt;&gt;
    os_mon_version : &lt;&lt;&quot;2.2.9&quot;&gt;&gt;
    riak_sysmon_version : &lt;&lt;&quot;1.1.2&quot;&gt;&gt;
    ssl_version : &lt;&lt;&quot;5.0.1&quot;&gt;&gt;
    public_key_version : &lt;&lt;&quot;0.15&quot;&gt;&gt;
    crypto_version : &lt;&lt;&quot;2.1&quot;&gt;&gt;
    sasl_version : &lt;&lt;&quot;2.2.1&quot;&gt;&gt;
    stdlib_version : &lt;&lt;&quot;1.18.1&quot;&gt;&gt;
    kernel_version : &lt;&lt;&quot;2.15.1&quot;&gt;&gt;
    memory_total : 26853928
    memory_processes : 6744452
    memory_processes_used : 6744438
    memory_system : 20109476
    memory_atom : 429569
    memory_atom_used : 406875
    memory_binary : 58504
    memory_code : 9277444
    memory_ets : 774080


    D.

    _______________________________________________
    riak-users mailing list
    riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
    <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>




_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08338.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08339">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08339">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08340.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08337.html">Node cannot join</a></span> <span class="sender italic">Daniel Iwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08338.html">Re: Node cannot join</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Node cannot join</span> <span class="sender italic">Shane McEwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08340.html">Re: Node cannot join</a></span> <span class="sender italic">John E. Vincent</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg08342.html">Re: Node cannot join</a></span> <span class="sender italic">Daniel Iwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08343.html">Re: Node cannot join</a></span> <span class="sender italic">Andrew Thompson</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Node cannot join">
<input type="hidden" name="msgid" value="5033987E.2000407@mcewan.id.au">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08339.html">
<input type="submit" value=" Shane McEwan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Node+cannot+join%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08338.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08340.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5033987E.2000407@mcewan.id.au</li>
</ul>
</div>
</body>
</html>
