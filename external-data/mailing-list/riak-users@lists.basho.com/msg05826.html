<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Question: {error,{error,insufficient_vnodes_available}}</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05826" id="c">
<link rel="index" href="maillist.html#05826" id="i">
<link rel="prev" href="msg05791.html" id="p">
<link rel="next" href="msg05754.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05826.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Question%5C%3A+%5C%7Berror%2C%5C%7Berror%2Cinsufficient_vnodes_available%5C%7D%5C%7D%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Question: {error,{error,insufficient_vnodes_available}}</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Chung%5C-Hung+%5C%28Walter%5C%29+Tsai%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Chung-Hung (Walter) Tsai</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111130" rel="nofollow">Wed, 30 Nov 2011 19:18:23 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Dan,

Thanks for your reply.
Indeed, I saw the &quot;insufficient_vnodes_available&quot; error message with
only one node on the machine.
What we did was just install the official 1.0.2's deb version and
modifying vm.args and app.config.</pre><pre>

The only changes in our setting are:
A. app.config:
- (http ip ..
- {pb_ib ..
- storage_backend points to storage_backend, riak_kv_eleveldb_backend

B. vm.args
-name
-setcookie

And the db ran smoothly for many days, then crashed for the 1st time.
It got recovered after we adjusted the ulimit.
Then it crashed again with the error message as above.

We don't have the other vnodes up-and-running in the machine at this
moment, though I was thinking it might be a solution and trying.
I tried to add an additional node and join the original node, but
fails. Then I leave it as it is.
Odd is, the DB comes back.

Here is our riak-admin info:

1. We don't have MapReduce procedures in it.

2. &quot;#riak-admin status&quot; shows:

Attempting to restart script through sudo -u riak
1-minute stats for 'riak@my-ip-address'
-------------------------------------------
vnode gets : 138
vnode_puts : 78
vnode_index_reads : 0
vnode_index_writes : 0
vnode_index_writes_postings : 0
vnode_index_deletes : 0
vnode_index_deletes_postings : 0
read_repairs : 1
vnode_gets_total : 490203
vnode_puts_total : 199436
vnode_index_reads_total : 0
vnode_index_writes_total : 0
vnode_index_writes_postings_total : 0
vnode_index_deletes_total : 0
vnode_index_deletes_postings_total : 0
node_gets : 42
node_gets_total : 163369
node_get_fsm_time_mean : 409
node_get_fsm_time_median : 397
node_get_fsm_time_95 : 674
node_get_fsm_time_99 : 734
node_get_fsm_time_100 : 748
node_puts : 24
node_puts_total : 66478
node_put_fsm_time_mean : 968
node_put_fsm_time_median : 1000
node_put_fsm_time_95 : 1599
node_put_fsm_time_99 : 1719
node_put_fsm_time_100 : 1735
node_get_fsm_siblings_mean : 1
node_get_fsm_siblings_median : 1
node_get_fsm_siblings_95 : 1
node_get_fsm_siblings_99 : 1
node_get_fsm_siblings_100 : 1
node_get_fsm_objsize_mean : 3609
node_get_fsm_objsize_median : 1280
node_get_fsm_objsize_95 : 29952
node_get_fsm_objsize_99 : 31385
node_get_fsm_objsize_100 : 31422
read_repairs_total : 1
coord_redirs_total : 0
cpu_nprocs : 441
cpu_avg1 : 51
cpu_avg5 : 33
cpu_avg15 : 54
mem_total : 8383463424
mem_allocated : 8280829952
disk : [{&quot;/&quot;,724427316,3},
        {&quot;/dev&quot;,4088508,1},
        {&quot;/dev/shm&quot;,4093488,0},
        {&quot;/var/run&quot;,4093488,1},
        {&quot;/var/lock&quot;,4093488,0},
        {&quot;/lib/init/rw&quot;,4093488,0},
        {&quot;/var/lib/ureadahead/debugfs&quot;,724427316,3},
        {&quot;/boot&quot;,256665,20}]
nodename : 'riak@my-ip-address'
connected_nodes : []
sys_driver_version : &lt;&lt;&quot;1.5&quot;&gt;&gt;
sys_global_heaps_size : 0
sys_heap_type : private
sys_logical_processors : 8
sys_otp_release : &lt;&lt;&quot;R14B03&quot;&gt;&gt;
sys_process_count : 1225
sys_smp_support : true
sys_system_version : &lt;&lt;&quot;Erlang R14B03 (erts-5.8.4) [source] [64-bit]
[smp:8:8] [rq:8] [async-threads:64] [kernel-poll:true]&quot;&gt;&gt;
sys_system_architecture : &lt;&lt;&quot;x86_64-unknown-linux-gnu&quot;&gt;&gt;
sys_threads_enabled : true
sys_thread_pool_size : 64
sys_wordsize : 8
ring_members : ['riak@my-ip-address']
ring_num_partitions : 64
ring_ownership : &lt;&lt;&quot;[{'riak@my-ip-address',64}]&quot;&gt;&gt;
ring_creation_size : 64
storage_backend : riak_kv_eleveldb_backend
ssl_version : &lt;&lt;&quot;4.1.5&quot;&gt;&gt;
public_key_version : &lt;&lt;&quot;0.12&quot;&gt;&gt;
runtime_tools_version : &lt;&lt;&quot;1.8.5&quot;&gt;&gt;
basho_stats_version : &lt;&lt;&quot;1.0.1&quot;&gt;&gt;
riak_search_version : &lt;&lt;&quot;1.0.2&quot;&gt;&gt;
merge_index_version : &lt;&lt;&quot;1.0.1&quot;&gt;&gt;
luwak_version : &lt;&lt;&quot;1.1.2&quot;&gt;&gt;
skerl_version : &lt;&lt;&quot;1.1.0&quot;&gt;&gt;
riak_kv_version : &lt;&lt;&quot;1.0.2&quot;&gt;&gt;
bitcask_version : &lt;&lt;&quot;1.3.0&quot;&gt;&gt;
luke_version : &lt;&lt;&quot;0.2.4&quot;&gt;&gt;
erlang_js_version : &lt;&lt;&quot;1.0.0&quot;&gt;&gt;
mochiweb_version : &lt;&lt;&quot;1.5.1&quot;&gt;&gt;
inets_version : &lt;&lt;&quot;5.6&quot;&gt;&gt;
riak_pipe_version : &lt;&lt;&quot;1.0.2&quot;&gt;&gt;
riak_core_version : &lt;&lt;&quot;1.0.2&quot;&gt;&gt;
riak_sysmon_version : &lt;&lt;&quot;1.0.0&quot;&gt;&gt;
webmachine_version : &lt;&lt;&quot;1.9.0&quot;&gt;&gt;
crypto_version : &lt;&lt;&quot;2.0.3&quot;&gt;&gt;
os_mon_version : &lt;&lt;&quot;2.2.6&quot;&gt;&gt;
cluster_info_version : &lt;&lt;&quot;1.2.0&quot;&gt;&gt;
sasl_version : &lt;&lt;&quot;2.1.9.4&quot;&gt;&gt;
lager_version : &lt;&lt;&quot;0.9.4&quot;&gt;&gt;
basho_metrics_version : &lt;&lt;&quot;1.0.0&quot;&gt;&gt;
stdlib_version : &lt;&lt;&quot;1.17.4&quot;&gt;&gt;
kernel_version : &lt;&lt;&quot;2.14.4&quot;&gt;&gt;
executing_mappers : 0
memory_total : 1088568880
memory_processes : 1041629696
memory_processes_used : 1041593360
memory_system : 46939184
memory_atom : 1031585
memory_atom_used : 999738
memory_binary : 2593768
memory_code : 9301939
memory_ets : 656408


3. &quot;# riak-admin ring_status&quot; shows:

Attempting to restart script through sudo -u riak
================================== Claimant ===================================
Claimant:  'riak@my-ip-address'
Status:     up
Ring Ready: true

============================== Ownership Handoff ==============================
No pending changes.

============================== Unreachable Nodes ==============================
All nodes are up and reachable


4. &quot;# riak-admin member_status&quot; shows

Attempting to restart script through sudo -u riak
================================= Membership ==================================
Status     Ring    Pending    Node
-------------------------------------------------------------------------------
valid     100.0%      --      'riak@my-ip-address'
-------------------------------------------------------------------------------
Valid:1 / Leaving:0 / Exiting:0 / Joining:0 / Down:0


Thanks,
Walter

2011/11/30 Dan Reverri &lt;d...@basho.com&gt;:
&gt; Hi Walter,
&gt; It is not recommended to run more than 1 node per machine. Also, creating a
&gt; new node by copying/pasting an existing node is not a good idea.
&gt; Were you seeing &quot;insufficient vnodes&quot; before you tried adding nodes?
&gt; Was the node under any load? MapReduce, ListKeys, etc.
&gt; What does &quot;riak-admin status&quot; return on the original node?
&gt; What does &quot;riak-admin ring_status&quot; return on the original node?
&gt; What does &quot;riak-admin &quot;member_status&quot; return on the original node?
&gt; I am concerned that the addition of copied nodes may be creating additional
&gt; issues. I would recommend getting the cluster back to a steady state with a
&gt; single node. Once this is complete we can review the issues and determine
&gt; what the problem might be.
&gt; Thanks,
&gt; Dan
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Mon, Nov 28, 2011 at 3:06 PM, Chung-Hung (Walter) Tsai
&gt; &lt;waltert...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt; Hi Dan,
&gt;&gt;
&gt;&gt; Yes, I use non-default name parameter and reip it.
&gt;&gt;
&gt;&gt; Please find my setting and setup info as below:
&gt;&gt;
&gt;&gt; Version: 1.0.2, .deb
&gt;&gt; Linux: Unbuntu 10.4, 64bits
&gt;&gt; Vnode: I didn't specify the other 2 nodes specifically, just used
&gt;&gt; default setting and did riak start.
&gt;&gt; The DB has a bumping due to insufficient file descriptor and got
&gt;&gt; resolved after I set ulimit and sysctl for system-wide parameters.
&gt;&gt; It ran ok for several days but since yesterday, it gave us the error
&gt;&gt; message regarding insufficient vnodes errors.
&gt;&gt;
&gt;&gt; I'm trying to setup 2 additional nodes by copying and modding
&gt;&gt; necessary files (e.g. /usr/sbin/riak to /usr/sbin/riakN) manually now.
&gt;&gt; But they each become a single cluster with just a single member in it
&gt;&gt; and doesn't allow other vnodes to join.
&gt;&gt; When I launch &quot;riak-admin&quot;, it shows something like &quot; ... 100% ...
&gt;&gt; riak@MY-IP-ADDRESS&quot;
&gt;&gt;
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Walter
&gt;&gt;
&gt;&gt; 2011/11/29 Dan Reverri &lt;d...@basho.com&gt;:
&gt;&gt; &gt; Hi Walter,
&gt;&gt; &gt; Have you made any changes to your configuration recently such as
&gt;&gt; &gt; changing
&gt;&gt; &gt; the &quot;-name&quot; parameter in vm.args?
&gt;&gt; &gt; Thanks,
&gt;&gt; &gt; Dan
&gt;&gt; &gt; Daniel Reverri
&gt;&gt; &gt; Developer Advocate
&gt;&gt; &gt; Basho Technologies, Inc.
&gt;&gt; &gt; d...@basho.com
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On Mon, Nov 28, 2011 at 1:04 AM, Chung-Hung (Walter) Tsai
&gt;&gt; &gt; &lt;waltert...@gmail.com&gt; wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Hello everyone,
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; We just saw many errors like this:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; 2011-11-27 23:02:01.129 [error] &lt;0.700.0&gt; webmachine error:
&gt;&gt; &gt;&gt; path=&quot;/buckets/.. (SKIPPED).....ui&quot;
&gt;&gt; &gt;&gt; {error,{error,insufficient_vnodes_available}}
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; The DB went well for several days, but now our riak cannot be
&gt;&gt; &gt;&gt; connected from our code since the errors appear.
&gt;&gt; &gt;&gt; Does anyone know how to resolve the issue?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Thanks,
&gt;&gt; &gt;&gt; Walter
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; _______________________________________________
&gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05791.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05826">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05826">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05754.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05748.html">Question: {error,{error,insufficient_vnodes_avail...</a></span> <span class="sender italic">Chung-Hung (Walter) Tsai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05753.html">Re: Question: {error,{error,insufficient_vno...</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05765.html">Re: Question: {error,{error,insufficient...</a></span> <span class="sender italic">Chung-Hung (Walter) Tsai</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05791.html">Re: Question: {error,{error,insuffic...</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Question: {error,{error,insu...</span> <span class="sender italic">Chung-Hung (Walter) Tsai</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Question: {error,{error,insufficient_vnodes_available}}">
<input type="hidden" name="msgid" value="CAN6G-izdkh6sb4tM-yQqD8akN6DePz8568XCHXKBy5XarVGNEg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05826.html">
<input type="submit" value=" Chung-Hung (Walter) Tsai ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Question%5C%3A+%5C%7Berror%2C%5C%7Berror%2Cinsufficient_vnodes_available%5C%7D%5C%7D%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05791.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05754.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAN6G-izdkh6sb4tM-yQqD8akN6DePz8568XCHXKBy5XarVGNEg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
