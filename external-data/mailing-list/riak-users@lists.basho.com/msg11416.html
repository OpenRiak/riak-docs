<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Urgent help with a down node.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd14.html#11416" id="c">
<link rel="index" href="mail14.html#11416" id="i">
<link rel="prev" href="msg11414.html" id="p">
<link rel="next" href="msg11417.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11416.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Urgent+help+with+a+down+node.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Urgent help with a down node.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+Caprice%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John Caprice</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130708" rel="nofollow">Mon, 08 Jul 2013 08:26:08 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey Bryan,

This indicates a problem with the Bitcask data file.  That data file,
according to the second error report, was truncated.  You more than likely
did not experience any data loss as this would affect only a single
replica, and only those contained in that data file.  To be safe, you can
repair the partition by attaching to Riak and running:</pre><pre>

riak_kv:repair(22835963083295358096932575511191922182123945984).

after which you can detach from Riak with ctrl-d and monitor the status of
the repair in riak-admin transfers.  This command will read-repair any lost
replicas due to the data file truncation.

Thanks,

John Caprice


On Mon, Jul 8, 2013 at 8:11 AM, Bryan Hughes &lt;br...@go-factory.net&gt; wrote:

&gt;  Andrew,
&gt;
&gt; Thanks for the tip on how to use Google.  :)   But that was not my
&gt; original question.  I wanted to understand in more detail from the Basho
&gt; folks what
&gt;
&gt; 2013-07-07 12:51:42 =ERROR REPORT====
&gt; Hintfile
&gt; './data/bitcask/22835963083295358096932575511191922182123945984/3.bitcask.hint'
&gt; contains pointer 16555635 566 that is greater than total data size 16556032
&gt;
&gt; and
&gt;
&gt;
&gt; 2013-07-07 12:54:43 =ERROR REPORT====
&gt; Bad datafile entry, discarding(383/566 bytes)
&gt;
&gt; meant to my system.  For example, did I lose data and if so, how do I know
&gt; what data was lost?  More importantly is if this is data lost, how did it
&gt; happen.  I ran fsck on all the disks and checked the health of the system -
&gt; which is all good.
&gt;
&gt; The later information was included for completeness.
&gt;
&gt; Bryan
&gt;
&gt;
&gt; On 7/8/13 12:49 AM, Andrew Berman wrote:
&gt;
&gt; Bryan,
&gt;
&gt;  What version of Erlang?  You should check this out:
&gt; <a  rel="nofollow" href="https://github.com/basho/riak_kv/issues/411">https://github.com/basho/riak_kv/issues/411</a>
&gt;
&gt;  BTW - Google is your friend, which is how I found the above issue :)
&gt;
&gt;  --Andrew
&gt;
&gt;
&gt; On Sun, Jul 7, 2013 at 3:01 PM, Bryan Hughes &lt;br...@go-factory.net&gt; wrote:
&gt;
&gt;&gt;  Hi Mark,
&gt;&gt;
&gt;&gt; DOH - sorry for the lack of detail.  Didnt have enough coffee this
&gt;&gt; morning.
&gt;&gt;
&gt;&gt; OS:     CentOS release 6.3 (Final)
&gt;&gt; Riak:   Riak 1.2.1
&gt;&gt;
&gt;&gt; Hadnt had a chance to upgrade to 1.3 yet.
&gt;&gt;
&gt;&gt; Got the node back up - but not entirely sure why which is a little
&gt;&gt; concerning.  Been verifying the data, and everything looks intact.  When I
&gt;&gt; try to run riak-admin status, I get the following (note I am not entirely
&gt;&gt; sure this was the case when we first set the node up):
&gt;&gt;
&gt;&gt; $ riak-admin status
&gt;&gt; Status failed, see log for details
&gt;&gt;
&gt;&gt; The logs shows:
&gt;&gt;
&gt;&gt; 2013-07-07 14:55:03.858 [error] &lt;0.12982.0&gt;@riak_kv_console:status:173
&gt;&gt; Status failed error:function_clause
&gt;&gt; 2013-07-07 14:55:03.858 [error] emulator Error in process &lt;0.12983.0&gt; on
&gt;&gt; node 'riak@127.0.0.1' with exit value:
&gt;&gt; {badarg,[{erlang,system_info,[global_heaps_size],[]},{riak_kv_stat,system_stats,0,[{file,&quot;src/riak_kv_stat.erl&quot;},{line,421}]},{riak_kv_stat,produce_stats,0,[{file,&quot;src/riak_kv_stat.erl&quot;},{line,320}]},{timer,tc,3,[{file,&quot;timer...
&gt;&gt;
&gt;&gt;
&gt;&gt; This is on a dev cluster with an out-of-the box configuration using
&gt;&gt; bitcask.
&gt;&gt;
&gt;&gt; Thanks!
&gt;&gt;
&gt;&gt; Bryan
&gt;&gt;
&gt;&gt;
&gt;&gt; On 7/7/13 2:51 PM, Mark Phillips wrote:
&gt;&gt;
&gt;&gt; Hi Bryan,
&gt;&gt;
&gt;&gt;  I remember seeing something similar on the list a while ago. I'll dig
&gt;&gt; through the archives (Riak.markmail.org) if I have a few minutes later
&gt;&gt; tonight.
&gt;&gt;
&gt;&gt;  In the mean time, what version of Riak is this? And what OS?
&gt;&gt;
&gt;&gt;  Mark
&gt;&gt;
&gt;&gt; On Sunday, July 7, 2013, Bryan Hughes wrote:
&gt;&gt;
&gt;&gt;&gt;  Anyone familiar with this error message?
&gt;&gt;&gt;
&gt;&gt;&gt; 2013-07-07 12:51:42 =ERROR REPORT====
&gt;&gt;&gt; Hintfile
&gt;&gt;&gt; './data/bitcask/22835963083295358096932575511191922182123945984/3.bitcask.hint'
&gt;&gt;&gt; contains pointer 16555635 566 that is greater than total data size 16556032
&gt;&gt;&gt; 2013-07-07 12:51:45 =ERROR REPORT====
&gt;&gt;&gt; Hintfile
&gt;&gt;&gt; './data/bitcask/114179815416476790484662877555959610910619729920/3.bitcask.hint'
&gt;&gt;&gt; contains pointer 17817310 567 &lt;17817310%20567&gt; that is greater than
&gt;&gt;&gt; total data size 17817600
&gt;&gt;&gt; 2013-07-07 12:51:46 =ERROR REPORT====
&gt;&gt;&gt; Hintfile
&gt;&gt;&gt; './data/bitcask/159851741583067506678528028578343455274867621888/3.bitcask.hint'
&gt;&gt;&gt; contains pointer 7573448 567 &lt;7573448%20567&gt; that is greater than total
&gt;&gt;&gt; data size 7573504
&gt;&gt;&gt; 2013-07-07 12:51:46 =ERROR REPORT====
&gt;&gt;&gt; Bad datafile entry 1:
&gt;&gt;&gt; {ok,&lt;&lt;131,104,2,109,0,0,0,9,65,80,73,67,79,85,78,84,83,109,0,0,0,33,55,56,54,57,52,49,56,49,94,103,111,115,101,114,118,105,99,101,95,99&gt;&gt;}
&gt;&gt;&gt; 2013-07-07 12:51:56 =ERROR REPORT====
&gt;&gt;&gt; Hintfile
&gt;&gt;&gt; './data/bitcask/730750818665451459101842416358141509827966271488/3.bitcask.hint'
&gt;&gt;&gt; contains pointer 13229833 581 that is greater than total data size 13230080
&gt;&gt;&gt; 2013-07-07 12:52:05 =ERROR REPORT====
&gt;&gt;&gt; Hintfile
&gt;&gt;&gt; './data/bitcask/1187470080331358621040493926581979953470445191168/3.bitcask.hint'
&gt;&gt;&gt; contains pointer 23465420 578 that is greater than total data size 23465984
&gt;&gt;&gt; 2013-07-07 12:52:06 =ERROR REPORT====
&gt;&gt;&gt; Hintfile
&gt;&gt;&gt; './data/bitcask/1210306043414653979137426502093171875652569137152/3.bitcask.hint'
&gt;&gt;&gt; contains pointer 27733824 578 that is greater than total data size 27734016
&gt;&gt;&gt; 2013-07-07 12:52:07 =ERROR REPORT====
&gt;&gt;&gt; Hintfile
&gt;&gt;&gt; './data/bitcask/1233142006497949337234359077604363797834693083136/3.bitcask.hint'
&gt;&gt;&gt; contains pointer 15014008 578 &lt;15014008%20578&gt; that is greater than
&gt;&gt;&gt; total data size 15014586
&gt;&gt;&gt; 2013-07-07 12:54:43 =ERROR REPORT====
&gt;&gt;&gt; Bad datafile entry, discarding(383/566 bytes)
&gt;&gt;&gt; 2013-07-07 12:54:45 =ERROR REPORT====
&gt;&gt;&gt; Bad datafile entry, discarding(276/567 bytes)
&gt;&gt;&gt; 2013-07-07 12:54:46 =ERROR REPORT====
&gt;&gt;&gt; Bad datafile entry, discarding(42/567 bytes)
&gt;&gt;&gt; 2013-07-07 12:54:57 =ERROR REPORT====
&gt;&gt;&gt; Bad datafile entry, discarding(233/581 bytes)
&gt;&gt;&gt; 2013-07-07 12:55:06 =ERROR REPORT====
&gt;&gt;&gt; Bad datafile entry, discarding(550/578 bytes)
&gt;&gt;&gt; 2013-07-07 12:55:07 =ERROR REPORT====
&gt;&gt;&gt; Bad datafile entry, discarding(178/578 bytes)
&gt;&gt;&gt; 2013-07-07 12:56:00 =ERROR REPORT====
&gt;&gt;&gt; Error in process &lt;0.1536.0&gt; on node 'riak@127.0.0.1' with exit value:
&gt;&gt;&gt; {badarg,[{erlang,system_info,[global_heaps_size],[]},{riak_kv_stat,system_stats,0,[{file,&quot;src/riak_kv_stat.erl&quot;},{line,421}]},{riak_kv_stat,produce_stats,0,[{file,&quot;src/riak_kv_stat.erl&quot;},{line,320}]},{timer,tc,3,[{file,&quot;timer...
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt;
&gt;&gt;&gt; Bryan Hughes
&gt;&gt;&gt; *Go Factory*
&gt;&gt;&gt; <a  rel="nofollow" href="http://www.go-factory.net">http://www.go-factory.net</a>
&gt;&gt;&gt;
&gt;&gt;&gt; *&quot;Internet Class, Enterprise Grade&quot;*
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;  --
&gt;&gt;
&gt;&gt; Bryan Hughes
&gt;&gt; CTO and Founder / *Go Factory*
&gt;&gt; (415) 515-7916 &lt;%28415%29%20515-7916&gt;
&gt;&gt;
&gt;&gt; <a  rel="nofollow" href="http://www.go-factory.net">http://www.go-factory.net</a>
&gt;&gt;
&gt;&gt; *&quot;Internet Class, Enterprise Grade&quot;*
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11414.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd14.html#11416">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail14.html#11416">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11417.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11407.html">Urgent help with a down node.</a></span> <span class="sender italic">Bryan Hughes</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11408.html">Re: Urgent help with a down node.</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11409.html">Re: Urgent help with a down node.</a></span> <span class="sender italic">Bryan Hughes</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11411.html">Re: Urgent help with a down node.</a></span> <span class="sender italic">Andrew Berman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11412.html">Re: Urgent help with a down node.</a></span> <span class="sender italic">Todd Tyree</span></li>
<li class="icons-email"><span class="subject"><a href="msg11414.html">Re: Urgent help with a down node.</a></span> <span class="sender italic">Bryan Hughes</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Urgent help with a down node.</span> <span class="sender italic">John Caprice</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11417.html">Re: Urgent help with a down node.</a></span> <span class="sender italic">Bryan Hughes</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11418.html">Re: Urgent help with a down no...</a></span> <span class="sender italic">John Caprice</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Urgent help with a down node.">
<input type="hidden" name="msgid" value="CAE_p9ZySwNt5FwzTmEwMovN9Ph2EQW=baXAnVi_nvQjXQGWTmQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11416.html">
<input type="submit" value=" John Caprice ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Urgent+help+with+a+down+node.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11414.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11417.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAE_p9ZySwNt5FwzTmEwMovN9Ph2EQW=baXAnVi_nvQjXQGWTmQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
