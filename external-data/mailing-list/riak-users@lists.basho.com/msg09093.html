<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Issue with clustering Riak nodes on CentOS servers.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09093" id="c">
<link rel="index" href="maillist.html#09093" id="i">
<link rel="prev" href="msg09091.html" id="p">
<link rel="next" href="msg09094.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09093.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Issue+with+clustering+Riak+nodes+on+CentOS+servers.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Issue with clustering Riak nodes on CentOS servers.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Bryan+Hughes%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Bryan Hughes</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121030" rel="nofollow">Tue, 30 Oct 2012 15:36:21 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi James,

</pre><tt>We have a 5 node cluster running in production with no problems on 
</tt><tt>CentOS.  We have each node isolated on a private lan.  Our application 
</tt><tt>server has two interfaces, one to the outside world with a very 
</tt><tt>restricted firewall, and the second connected to the private lan with 
</tt><tt>the 5 nodes.
</tt><pre style="margin: 0em;"></pre><pre>

Assuming you set the node names accordingly and followed:

<a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/Basic-Cluster-Setup/">http://docs.basho.com/riak/latest/cookbooks/Basic-Cluster-Setup/</a>

One thing to check would your firewall, which is by default on with CentOS.

&gt;sudo service iptables status

</pre><tt>If you have your 4 nodes on a private lan, or perhaps well protected 
</tt><tt>behind a firewall as an internal deployment, then it is relatively 
</tt><tt>straight forward.  You can just turn off your firewall on the 4 machines.
</tt><pre style="margin: 0em;">

</pre><tt>If your machines are not on a isolated private lan and are exposed to 
</tt><tt>the internet, or just need to be protected behind a firewall, you will 
</tt><tt>need to do the following.
</tt><pre style="margin: 0em;">

<a  rel="nofollow" href="http://docs.basho.com/riak/1.2.0/cookbooks/Network-Security-and-Firewall-Configurations/">http://docs.basho.com/riak/1.2.0/cookbooks/Network-Security-and-Firewall-Configurations/</a>

</pre><tt>First, in your app.config, you will need to add the following at the top 
</tt><tt>level (same as riak.core).  You can pick whatever min and max range you 
</tt><tt>want - here I arbitrarily chosen 4 ports:
</tt><pre style="margin: 0em;">

{ kernel, [
            {inet_dist_listen_min, 7010},
            {inet_dist_listen_max, 7014}
          ]},

</pre><tt>Next, on each or our riak nodes, you will need to edit your iptables.  I 
</tt><tt>tend to edit them manually using sudo.
</tt><pre style="margin: 0em;">

</pre><tt>&gt; sudo vi /etc/sysconfig/iptables (and add the following to 
</tt><tt>RH-Firewall-1-INPUT just above the icmp-host-prohibited)
</tt><pre style="margin: 0em;">

</pre><tt>-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 4369 
</tt><tt>-j ACCEPT
</tt><tt>-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 8087 
</tt><tt>-j ACCEPT
</tt><tt>-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 8099 
</tt><tt>-j ACCEPT
</tt><tt>-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 
</tt><tt>7010:7014 -j ACCEPT
</tt><pre style="margin: 0em;">

&gt; sudo service iptables restart

</pre><tt>After doing this on all the nodes, they should all be visible to each 
</tt><tt>other.  If you wanted to lock down your firewall even further, you can 
</tt><tt>specify a range of IP addresses.
</tt><pre style="margin: 0em;">

</pre><tt>Finally, on the machine that your erlang application or Riak client, you 
</tt><tt>will need to do the following:
</tt><pre style="margin: 0em;">

</pre><tt>sudo vi /etc/sysconf/iptable (and add the following to 
</tt><tt>RH-Firewall-1-INPUT just above the icmp-host-prohibited)
</tt><pre style="margin: 0em;">

</pre><tt>-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 8098 
</tt><tt>-j ACCEPT
</tt><tt>-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 8087 
</tt><tt>-j ACCEPT
</tt><pre style="margin: 0em;">

&gt; sudo service iptables restart


Hope this helps...
Bryan


On 10/30/12 11:39 AM, SWEENEY, JAMES wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hello,  I am attempting to create a 4 node riak installation on 4 separate 
CentOS servers.   Installation of Riak went well.  We have run simple tests 
like riak ping, sudo curl \-v <a  rel="nofollow" href="http://127.0.0.1:8098/riak/test">http://127.0.0.1:8098/riak/test</a>, ect,  and 
everything seems fine with the riak servers,  they all start up with no errors. 
 We used the default ports in the app.config files.   Ie:  epmd listener: 
TCP:4369
handoff_port listener: TCP:8099
web_port: TCP:8098
pb_port: TCP:8087

We have updated all ip addresses in the config files as instructed on the riak 
site.  Also, we have verified by telnet that the ports are all open and that I 
can telnet between the riak servers.    Still after all of that,  when I try to 
do a cluster command I get the following response:


[root@essd-riak-test-server ~]# riak-admin cluster join riak@10.1.78.9
Attempting to restart script through sudo -H -u riak
Node riak@10.1.78.9 is not reachable!
[root@essd-riak-test-server ~]#

I have been stuck on this issue for quite a while and tried everything I found 
on the riak web site to resolve this.  Any help you could offer would greatly 
be appreciated.   Thanks in advance.

Sincerely,

James Sweeney




_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

--

Bryan Hughes
CTO and Founder / *Go Factory*
(415) 515-7916
<a  rel="nofollow" href="http://www.go-factory.net">http://www.go-factory.net</a>

/&quot;Art is never finished, only abandoned. - Leonardo da Vinci&quot;/


</pre></blockquote><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09091.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09093">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09093">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09094.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09085.html">Issue with clustering Riak nodes on CentOS servers.</a></span> <span class="sender italic">SWEENEY, JAMES</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09086.html">Re: Issue with clustering Riak nodes on CentOS serv...</a></span> <span class="sender italic">Callixte Cauchois</span></li>
<li class="icons-email"><span class="subject"><a href="msg09091.html">Re: Issue with clustering Riak nodes on CentOS serv...</a></span> <span class="sender italic">Tin Le</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Issue with clustering Riak nodes on CentOS serv...</span> <span class="sender italic">Bryan Hughes</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09094.html">Re: Issue with clustering Riak nodes on CentOS ...</a></span> <span class="sender italic">Bryan Hughes</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Issue with clustering Riak nodes on CentOS servers.">
<input type="hidden" name="msgid" value="5090563C.7050008@go-factory.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09093.html">
<input type="submit" value=" Bryan Hughes ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Issue+with+clustering+Riak+nodes+on+CentOS+servers.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09091.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09094.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5090563C.7050008@go-factory.net</li>
</ul>
</div>
</body>
</html>
