<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Atomicity of if_not_modified?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09730" id="c">
<link rel="index" href="maillist.html#09730" id="i">
<link rel="prev" href="msg09770.html" id="p">
<link rel="next" href="msg09735.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09730.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Atomicity+of+if_not_modified%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Atomicity of if_not_modified?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Pavan+Venkatesh%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Pavan Venkatesh</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130103" rel="nofollow">Thu, 03 Jan 2013 12:36:01 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,
If its through http, &quot;ifnotmodified&quot; will only store if there has been no
modification since the provided timestamp (conditional store).
With your example of N=3, R=2 and W=2, if two clients are updating at the
same time to the same object, then it actually depends on the &quot;allow_mult&quot;
and &quot;last_write_wins&quot; variable.</pre><pre>

Case 1-- If allow_mult is true and last_write_wins is false, then siblings
are created and replicated among the nodes. It has to be resolved on the
client side. Client will have to issue a &quot;put&quot; request later along with the
vector clock and with the relevant value in order to resolve the sibling
scenario.

Case 2 If  allow_mult is false and last write_wins is true, then the client
with the latest time stamp wins. Siblings might occur here, but is not
exposed to the client.

Case 3 If allow_mult is false and last write_wins is false, then resolve
differences using vector clock(this happens internally). The latest one is
returned if siblings still exists.

Case 4 If allow_mult is true and last write_wins is true, then the client
with the latest time stamp wins.

More Details on &quot;IfnotModified&quot; below-
ifNotModified
public StoreObject 
&lt;<a  rel="nofollow" href="http://www.jarvana.com/jarvana/view/com/basho/riak/riak-client/1.0rc1/riak-">http://www.jarvana.com/jarvana/view/com/basho/riak/riak-client/1.0rc1/riak-</a>
client-1.0rc1-javadoc.jar%21/com/basho/riak/client/operations/StoreObject.ht
ml&gt; &lt;T 
&lt;<a  rel="nofollow" href="http://www.jarvana.com/jarvana/view/com/basho/riak/riak-client/1.0rc1/riak-">http://www.jarvana.com/jarvana/view/com/basho/riak/riak-client/1.0rc1/riak-</a>
client-1.0rc1-javadoc.jar%21/com/basho/riak/client/operations/StoreObject.ht
ml&gt; &gt; ifNotModified(boolean ifNotModified)
Default is false (i.e. NOT a conditional store).

 NOTE: This has different meanings depending on the underlying transport.
 

 In the case of the PB interface it means: Only store if the vclock provided
with the store is the same as the one in Riak for this object (i.e. the
object has not been modified since you last got it), of course, since this
StoreObject does a fetch before a store the window for concurrent
modification is minimized, but this is an extra guard, still.
 

 For the HTTP API it means: Only store if there has been no modification
since the provided timestamp.
 

 To make this transparent the StoreOperation will pull the last modified
date from the object returned in the pre-store fetch, and use that as
supplementary data to the HTTP Store request.

Parameters:ifNotModified - true if you want a conditional store, false
otherwise, defaults to false. Returns:This

Pavan


From:  qaspar &lt;snoope...@gmail.com&gt;
Date:  Thursday, January 3, 2013 8:46 AM
To:  &lt;riak-users@lists.basho.com&gt;
Subject:  Re: Atomicity of if_not_modified?


Hi,

Can someone confirm this? If it's true, what exactly is the purpose of
offering the if_not_modified flag?

Kaspar

On Dec 28, 2012 1:51 PM, &quot;Daniil Churikov [via Riak Users]&quot; &lt;[hidden email]
&lt;/user/SendEmail.jtp?type=node&amp;node=4026465&amp;i=0&gt; &gt; wrote:
&gt; Riak doesn't have atomic updates. This if_not_modified does not gives you any
&gt; guaranties. Best way to handle with simultaneously updates is try to engineer
&gt; scheme so that only one client makes concurrent updates and in case of
&gt; conflict any sibling will be good for you. Another option is try to use
&gt; convergent data types [0][1]
&gt; [0] <a  rel="nofollow" href="https://github.com/basho/riak_dt">https://github.com/basho/riak_dt</a>
&gt; [1] <a  rel="nofollow" href="https://github.com/mochi/statebox_riak">https://github.com/mochi/statebox_riak</a>
&gt; 
&gt; 
&gt; If you reply to this email, your message will be added to the discussion
&gt; below:
&gt; <a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Atomicity-of-if-not-modified-tp4026430p">http://riak-users.197444.n3.nabble.com/Atomicity-of-if-not-modified-tp4026430p</a>
&gt; 4026431.html 
&gt; To unsubscribe from Atomicity of if_not_modified?, click here.
&gt; NAML 
&gt; &lt;<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/template/NamlServlet.jtp?macro=macro_v">http://riak-users.197444.n3.nabble.com/template/NamlServlet.jtp?macro=macro_v</a>
&gt; iewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicN
&gt; amespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.Nod
&gt; eNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails
&gt; %21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml&gt;


View this message in context: Re: Atomicity of if_not_modified?
&lt;<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Atomicity-of-if-not-modified-tp40264">http://riak-users.197444.n3.nabble.com/Atomicity-of-if-not-modified-tp40264</a>
30p4026465.html&gt; 
Sent from the Riak Users mailing list archive
&lt;<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/">http://riak-users.197444.n3.nabble.com/</a>&gt;  at Nabble.com.
_______________________________________________ riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09770.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09730">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09730">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09735.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09690.html">Atomicity of if_not_modified?</a></span> <span class="sender italic">qaspar</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09691.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">Daniil Churikov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09725.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">qaspar</span></li>
<li class="icons-email"><span class="subject"><a href="msg09740.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">Kaspar Thommen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09741.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">Justin Sheehy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09742.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">qaspar</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09744.html">Re: Atomicity of if_not_modified...</a></span> <span class="sender italic">Kresten Krab Thorup</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09767.html">Re: Atomicity of if_not_modi...</a></span> <span class="sender italic">qaspar</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09770.html">Re: Atomicity of if_not_...</a></span> <span class="sender italic">Les Mikesell</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Atomicity of if_not_modified?</span> <span class="sender italic">Pavan Venkatesh</span></li>
<li class="icons-email"><span class="subject"><a href="msg09735.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09733.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">Les Mikesell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09734.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">Justin Sheehy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09738.html">Re: Atomicity of if_not_modified?</a></span> <span class="sender italic">qaspar</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Atomicity of if_not_modified?">
<input type="hidden" name="msgid" value="CD0B2BA3.1CB2%pvenkatesh@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09730.html">
<input type="submit" value=" Pavan Venkatesh ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Atomicity+of+if_not_modified%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09770.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09735.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CD0B2BA3.1CB2%pvenkatesh@basho.com</li>
</ul>
</div>
</body>
</html>
