<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak and host names</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#09754" id="c">
<link rel="index" href="mail2.html#09754" id="i">
<link rel="prev" href="msg10056.html" id="p">
<link rel="next" href="msg09718.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09754.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+and+host+names%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak and host names</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Michael+Johnson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Michael Johnson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130107" rel="nofollow">Mon, 07 Jan 2013 16:40:06 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I'm not sure how much this will help, but I will throw my two cents into
the hat.  Given that I don't know the details of your requirements, and I
am fairly new to riak and aws, please take everything with a grain of salt.</pre><pre>

On Tue, Jan 1, 2013 at 11:43 AM, Deepak Balasubramanyam &lt;
deepak.b...@gmail.com&gt; wrote:

&gt; I took the AWS EC2 riak image for a spin today. I have a query regarding
&gt; riak nodes and how they behave when the machine reboots.
&gt;
&gt; When an EC2 instance reboots, the internal ip / internal DNS / external
&gt; DNS change. This renders the app.config and -name argument on vm.args
&gt; incorrect. I was exploring solutions to deal with this problem.
&gt;
&gt; *1. Preventive measures*
&gt;
&gt; Someone on this thread dated May 
&gt; 2011&lt;<a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/EC2-and-node-names-td2892047.html">http://riak-users.197444.n3.nabble.com/EC2-and-node-names-td2892047.html</a>&gt;
&gt;  suggested
&gt; using host file entries that point to the local internal IP address. That
&gt; does not seem to work. Riak fails with the following error when I add a new
&gt; entry to /etc/hosts and configure vm.args with -name riak@riaknode1
&gt;
&gt; If you add something that looks like a legitimate FQDN (like
riaknode1.mydomaind.com) into /etc/hosts and utilize that instead of just
riaknode1, that should work just fine.

The caveat is that all nodes you your cluster need to have entries in
/etc/hosts for all the other nodes.  This is where you may have some
management headaches.

It seems silly to me that erlang requires you to use a different command
line option depending on what the host name looks like, but then there are
many things that elrang does that seem silly to me.  There my be a good
technical explanation, but I can't come up with one.

Hostname riaknode1 is illegal
&gt;
&gt; I confirmed that riaknode1 pings correctly before starting riak. I guess
&gt; erlang tries to match the hostname of the system resulting in this failure
&gt; ? Can anyone throw some light on this ?
&gt;
&gt; *2. Use -sname*
&gt;
&gt; Is starting the erlang VM with the sname flag an option if it will help
&gt; prevent the 'illegal hostname' error ?
&gt; Disclaimer: My knowledge of erlang is close to zilch, so sorry if that
&gt; option sounded like something you could dismiss easily :)
&gt;
&gt; As far as erlang is concerned, you absolutely could do this and it should
work fine for riak.  But the caveate is that you likely will have to rework
the riak init scripts or simply write your own.  RabbitMQ is another erlang
application I have used and it's init script requires that you use the
short name with no dots in it and passes that to erlang with -sname.  That
bugs me a bit as I perfer to use the FQDN, but the amount of work to manage
and maintain my own init scripts was just not work it for something that is
seemingly just asthetics.

*3. Use cluster replace
&gt; *
&gt;
&gt;
a. I understand that the IPs in app.config and vm.args can be replaced with
&gt; the correct IP on a restart and using a subsequent 'cluster replace'
&gt; command will do. Will executing the 'cluster plan' and 'cluster commit'
&gt; commands now produce network chatter ?
&gt;

Rather than micro managing the ips in app.config, I've opted to just have
riak listing on any IP by specifying 0.0.0.0 and then restrict access using
IP tables to deny access base on the interface name which is generally
consistent across all nodes.  This means the configs are much more generic
and easy to maintain for me.  This might be a suitable option for you as
well.

&gt;
&gt; b . What happens if 2 nodes go down and one was joined with the other.
&gt; They both have 2 different IP addresses on restart. How will 'cluster
&gt; replace' work now ?
&gt;

I've not played around with cluster replace much, but given riak likes to
do everything by hostname (which it then resolved to an IP), it shouldn't
matter if the ip changes as long was the node names don't change and those
names resolve to the correct IP addresses.  But then that means each time a
node comes up, you have to update DNS or /etc/hosts as appropriate which
will be a pain.

&gt;
&gt; Do let me know your thoughts.
&gt;

Ultimately, I wouldn't want to be building a riak cluster where the IP
address of the nodes could/would change any time the node was rebooted.
 Surely there is a way to make sure the private IP of the nodes say the
same across reboots?  That will make your life a lot easier.


&gt; Thanks
&gt; -Deepak
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10056.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#09754">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#09754">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09718.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09749.html">Re: Riak and host names</a></span> <span class="sender italic">Matt Black</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09751.html">Re: Riak and host names</a></span> <span class="sender italic">Charlie Voiselle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09752.html">Re: Riak and host names</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09782.html">Re: Riak and host names</a></span> <span class="sender italic">Matt Black</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09785.html">Re: Riak and host names</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09803.html">Re: Riak and host names</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li class="icons-email"><span class="subject"><a href="msg10043.html">Re: Riak and host names</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li class="icons-email"><span class="subject"><a href="msg10050.html">Re: Riak and host names</a></span> <span class="sender italic">Mark Phillips</span></li>
<li class="icons-email"><span class="subject"><a href="msg10052.html">Re: Riak and host names</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li class="icons-email"><span class="subject"><a href="msg10056.html">Re: Riak and host names</a></span> <span class="sender italic">Eric Redmond</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak and host names</span> <span class="sender italic">Michael Johnson</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak and host names">
<input type="hidden" name="msgid" value="CAHjDDKNKEUimEGoLQTQCQ31RF9ZDv+FuLT-8s8GqN3DV9gm9vA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09754.html">
<input type="submit" value=" Michael Johnson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+and+host+names%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10056.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09718.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAHjDDKNKEUimEGoLQTQCQ31RF9ZDv+FuLT-8s8GqN3DV9gm9vA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
