<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riak-erlang-client serverside clarification</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06824" id="c">
<link rel="index" href="maillist.html#06824" id="i">
<link rel="prev" href="msg06814.html" id="p">
<link rel="next" href="msg06794.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06824.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-erlang%5C-client+serverside+clarification%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riak-erlang-client serverside clarification</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Senthilkumar+Peelikkampatti%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Senthilkumar Peelikkampatti</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120301" rel="nofollow">Thu, 01 Mar 2012 11:29:20 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sean,
      Thanks for the response. I considered below option before coming to
this forum but my question is only riak put needs conversion from binary to
term and other places in my application, app consumes pure erlang term
including MR. It is going to be huge benefit for my app to stay consuming
term directly out of riak.
I understand the issue with PB server as it needs to cater to various
different client but Content-Type meta data would make this conversion
seamless. If riak has no plan to introduce conversion layer (though it is
not big deal as already relevant information available in hand for riak pb)
into riak in funture,</pre><pre>

   1.  is it good to introduce precommit hook to convert object?  Or
   2. does Riak support &quot;overlay&quot; (similar to MR funtions) to drop
   converter module into riak?
   3. Is it good to touch PB layer to modify as per my need? -- this seems
   very invasive as I need to propagate this changes to every environment and
   every dev systems


Thanks,
Senthil

On Thu, Mar 1, 2012 at 10:53 AM, Sean Cribbs &lt;s...@basho.com&gt; wrote:

&gt; Hi Senthilkumar,
&gt;
&gt; Because the PB client is connecting to a language-agnostic interface, it
&gt; makes sense that it will only store binary data as the value.  In general,
&gt; it's better not to rely on the fact that your value is Erlang terms, but to
&gt; assume Riak will treat the value opaquely, as a binary.  Calling
&gt; binary_to_term in your MapReduce (of course, making a guard or check for
&gt; existing values that are terms) should not be too onerous. e.g.
&gt;
&gt; ensure_terms(Bin) when is_binary(Bin) -&gt;
&gt;   binary_to_term(Bin);
&gt; ensure_terms(T) -&gt; T.
&gt;
&gt; Then as the first part of each map function you could do
&gt;
&gt; Value = ensure_terms(riak_object:get_value(Obj)),
&gt;
&gt; I hope that helps!
&gt;
&gt; On Wed, Feb 29, 2012 at 11:23 PM, Senthilkumar Peelikkampatti &lt;
&gt; senthilkumar.peelikkampa...@gmail.com&gt; wrote:
&gt;
&gt;&gt; I am using currently erlang native client and it is working beautifully
&gt;&gt; so far. I wanted to move it to pb client due to
&gt;&gt; 1. it is kind of pain to update relevant binaries
&gt;&gt; 2. bidirectional network connection with riak  nodes and my application
&gt;&gt; nodes and associated load etc to the system
&gt;&gt; 3. dependency of config like erl riak cookie etc
&gt;&gt;
&gt;&gt; But In my preliminary study, found that,
&gt;&gt;
&gt;&gt; a) PB client always sends value as binary
&gt;&gt; b) PB server always stores the value as such no matter what kind of
&gt;&gt; content type set ex. &quot;application/x-erlang-term&quot;
&gt;&gt;
&gt;&gt; And item (b) is problem for me because my entire app has may MR queries
&gt;&gt; and other object retrieval which directly consumes erlang terms. So I need
&gt;&gt; to go everywhere (though, It is just one DB module and another module with
&gt;&gt; many M-R functions) to change the binary to term or should I tweek
&gt;&gt; riakc_pb:erlify_rpbcontent to convert binary to term and store it -- may be
&gt;&gt; based on Content-Type?  This sounds ugly but I just need to change it only
&gt;&gt; once without affecting my entire code base. If I do so, wherever I get the
&gt;&gt; object from Riak, I no need to convert it, it saves unnecessary decoding
&gt;&gt; also.
&gt;&gt;
&gt;&gt; PB binaries stored in riak also affect the riak:local client retrieval
&gt;&gt; where we can get the object and see it in plain without doing
&gt;&gt; binary_to_term.
&gt;&gt;
&gt;&gt;
&gt;&gt; My app is webmachine erlang web app.
&gt;&gt;
&gt;&gt; Thoughts?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; --Senthilkumar Peelikkampatti.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;
&gt;


-- 
Regards,
Senthilkumar Peelikkampatti,
<a  rel="nofollow" href="http://pmsenthilkumar.blogspot.com/">http://pmsenthilkumar.blogspot.com/</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06814.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06824">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06824">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06794.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06793.html">riak-erlang-client serverside clarification</a></span> <span class="sender italic">Senthilkumar Peelikkampatti</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06814.html">Re: riak-erlang-client serverside clarifi...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: riak-erlang-client serverside cla...</span> <span class="sender italic">Senthilkumar Peelikkampatti</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riak-erlang-client serverside clarification">
<input type="hidden" name="msgid" value="CACt_nUxXFvgenpkAMRarDu5YSGmUASoAq_oT10bjUg69z-jWUA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06824.html">
<input type="submit" value=" Senthilkumar Peelikkampatti ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-erlang%5C-client+serverside+clarification%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06814.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06794.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACt_nUxXFvgenpkAMRarDu5YSGmUASoAq_oT10bjUg69z-jWUA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
