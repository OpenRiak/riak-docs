<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak errors after node left the cluster</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15122" id="c">
<link rel="index" href="maillist.html#15122" id="i">
<link rel="prev" href="msg15121.html" id="p">
<link rel="next" href="msg15123.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15122.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+errors+after+node+left+the+cluster%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak errors after node left the cluster</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sargun+Dhillon%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sargun Dhillon</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20141106" rel="nofollow">Thu, 06 Nov 2014 17:07:25 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>So, from my understanding, one of your servers was being replaced, so
you did a leave from the cluster, and it failed to commit, and then
another node failed, resulting in 3/4ish or 3/5ish of the ring being
up?
Did you down the failed node, or remove it from the cluster? What's
the current status of your ring?</pre><pre>

Can you run:
riak-admin status (on each node)
riak-admin diag
riak-admin member-status
riak-admin ring-status
riak-admin vnode-status
riak-admin transfers
riak-admin transfer-limit

Can you put this all in a github gist: gist.github.com?
Also, are you running AAE?

You might want to temporarily turn off AAE, and transfers as you debug
the cluster, just to figure out what's going on with the cluster at
the moment.

On Thu, Nov 6, 2014 at 1:05 PM, Oleksiy Krivoshey &lt;oleks...@gmail.com&gt; wrote:
&gt; Just got a new problem with Riak. Recently a hard drive has failed on one of
&gt; Riak nodes so I had to shut it down. I'm running 4 nodes now and each 10
&gt; minutes all of them start to fail with 'Error: {error,mailbox_overload}'
&gt; until restarted. Can anyone from Basho please suggest a solution/ fix for
&gt; this? My whole cluster is unusable with just 1 node failed.
&gt;
&gt; On 5 November 2014 00:11, Oleksiy Krivoshey &lt;oleks...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt; There were also errors during initial handoff, here is a full console.log
&gt;&gt; for that day: <a  rel="nofollow" href="https://www.dropbox.com/s/o7zop181pvpxoa5/console.log?dl=0">https://www.dropbox.com/s/o7zop181pvpxoa5/console.log?dl=0</a>
&gt;&gt;
&gt;&gt; I actually replaced two nodes that day. First one went smoothly as it
&gt;&gt; should. The second one resulted in the situation above. I replaced the first
&gt;&gt; one and then the second after few hours.
&gt;&gt;
&gt;&gt; On 4 November 2014 20:44, Oleksiy Krivoshey &lt;oleks...@gmail.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; I'm running a 5 node cluster (Riak 2.0.0) and I had to replace hardware
&gt;&gt;&gt; on one of the servers. So I did a 'cluster leave', waited till the node
&gt;&gt;&gt; exited, checked the ring status and members status, all was ok, with no
&gt;&gt;&gt; pending changes. Then later after about 5 minutes every client connection to
&gt;&gt;&gt; any of the 4 remaining nodes started to fail with
&gt;&gt;&gt;
&gt;&gt;&gt; [Error: {error,mailbox_overload}
&gt;&gt;&gt;
&gt;&gt;&gt; I have restarted one node after another and the error has gone. However I
&gt;&gt;&gt; was still experiencing connectivity issues (timeouts) and riak error log is
&gt;&gt;&gt; full of various errors even after I joined the 5th node back.
&gt;&gt;&gt;
&gt;&gt;&gt; Error are like:
&gt;&gt;&gt;
&gt;&gt;&gt; Failed to merge
&gt;&gt;&gt; {[&quot;/var/lib/riak/bitcask_expire_1d/685078892498860742907977265335757665463718379520/1.bitcask.data&quot;]
&gt;&gt;&gt;
&gt;&gt;&gt; gen_fsm &lt;0.818.0&gt; in state active terminated with reason: bad record
&gt;&gt;&gt; state in riak_kv_vnode:set_vnode_forwarding/2 line 991
&gt;&gt;&gt;
&gt;&gt;&gt; @riak_pipe_vnode:new_worker:826 Pipe worker startup failed:
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; msg,7,[{file,&quot;gen_fsm.erl&quot;},{line,505}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]
&gt;&gt;&gt; 2014-11-04 16:07:57.124 [error]
&gt;&gt;&gt; &lt;0.11128.0&gt;@riak_core_handoff_sender:start_fold:279 hinted_handoff transfer
&gt;&gt;&gt; of riak_kv_vnode from 'riak@10.0.1.1'
&gt;&gt;&gt; 353957427791078050502454920423474793822921162752 to 'riak@
&gt;&gt;&gt; 10.0.1.5' 353957427791078050502454920423474793822921162752 failed because
&gt;&gt;&gt; of error:undef
&gt;&gt;&gt; [{riak_core_format,human_size_fmt,[&quot;~.2f&quot;,588],[]},{riak_core_handoff_sender,start_fold,5,[{file,&quot;src/riak_core_han
&gt;&gt;&gt; doff_sender.erl&quot;},{line,246}]}]
&gt;&gt;&gt;
&gt;&gt;&gt; The full error log file is available here:
&gt;&gt;&gt; <a  rel="nofollow" href="https://www.dropbox.com/s/3b8x3nqyego7lw3/error.log?dl=0">https://www.dropbox.com/s/3b8x3nqyego7lw3/error.log?dl=0</a>
&gt;&gt;&gt;
&gt;&gt;&gt; There was no significant load on Riak so I would like to understand what
&gt;&gt;&gt; caused so many errors?
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Oleksiy
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Oleksiy Krivoshey
&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Oleksiy Krivoshey
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15121.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15122">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15122">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15123.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg15116.html">Riak errors after node left the cluster</a></span> <span class="sender italic">Oleksiy Krivoshey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15117.html">Re: Riak errors after node left the cluster</a></span> <span class="sender italic">Oleksiy Krivoshey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15121.html">Re: Riak errors after node left the cluster</a></span> <span class="sender italic">Oleksiy Krivoshey</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak errors after node left the clu...</span> <span class="sender italic">Sargun Dhillon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15123.html">Re: Riak errors after node left the...</a></span> <span class="sender italic">Scott Lystig Fritchie</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15125.html">Re: Riak errors after node lef...</a></span> <span class="sender italic">Oleksiy Krivoshey</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak errors after node left the cluster">
<input type="hidden" name="msgid" value="CAMp4zn9OqHi2QpA6+v0b68emd+nLTeN7iTZBO4FL5HBxDfQWKA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15122.html">
<input type="submit" value=" Sargun Dhillon ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+errors+after+node+left+the+cluster%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15121.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15123.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAMp4zn9OqHi2QpA6+v0b68emd+nLTeN7iTZBO4FL5HBxDfQWKA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
