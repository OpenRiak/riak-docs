<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: How to make Riak work faster (writing)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09199" id="c">
<link rel="index" href="maillist.html#09199" id="i">
<link rel="prev" href="msg09198.html" id="p">
<link rel="next" href="msg09204.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09199.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+make+Riak+work+faster+%5C%28writing%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: How to make Riak work faster (writing)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Uruka+Dark%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Uruka Dark</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121105" rel="nofollow">Mon, 05 Nov 2012 09:10:33 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sorry, I forgot to add your results, using bitcask:
<a  rel="nofollow" href="https://dl.dropbox.com/u/183971/summary.png">https://dl.dropbox.com/u/183971/summary.png</a></pre><pre>

On Mon, Nov 5, 2012 at 1:17 PM, Uruka Dark &lt;urukad...@gmail.com&gt; wrote:

&gt; Just an update.
&gt;
&gt; I ran the benchmark again, but now, using Memory backend:
&gt; <a  rel="nofollow" href="https://dl.dropbox.com/u/308392/memory_summary.png">https://dl.dropbox.com/u/308392/memory_summary.png</a>
&gt;
&gt; This was the result using Bitcask backend:
&gt; <a  rel="nofollow" href="https://dl.dropbox.com/u/308392/bitcask_summary.png">https://dl.dropbox.com/u/308392/bitcask_summary.png</a>
&gt;
&gt; The difference is not that big in my environment. I was expecting much
&gt; better results, but I don't know if it was supposed to happen.
&gt; Anyway, your results are still much better, even when I'm using memory
&gt; only backend (50% of yours).
&gt;
&gt; Maybe it can help to understand what is happening.
&gt;
&gt; On Sat, Nov 3, 2012 at 7:31 PM, Uruka Dark &lt;urukad...@gmail.com&gt; wrote:
&gt;
&gt;&gt; Jared,
&gt;&gt;
&gt;&gt; Again, thank you very much.
&gt;&gt; You helped me a lot.
&gt;&gt;
&gt;&gt; I perfectly understand your point. I'm just starting to know Riak and I
&gt;&gt; want to go much deeper. But, before I keep going, I want make sure that I'm
&gt;&gt; starting with the right foot :)
&gt;&gt; I double/triple-checked and I still have no additional clues about what
&gt;&gt; is happening.
&gt;&gt;
&gt;&gt; You've reached much better results than mine using your default settings,
&gt;&gt; and, given my numbers, I'm still missing something. I would like at least
&gt;&gt; to get closer to your results. If you think that I'll not make any better
&gt;&gt; than this with my default settings, please, let me know.
&gt;&gt;
&gt;&gt; Anyway, this is my app.config:
&gt;&gt;
&gt;&gt; %% -*- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil -*-
&gt;&gt; %% ex: ft=erlang ts=4 sw=4 et
&gt;&gt; [
&gt;&gt;  %% Riak Client APIs config
&gt;&gt;  {riak_api, [
&gt;&gt;             %% pb_backlog is the maximum length to which the queue of
&gt;&gt; pending
&gt;&gt;             %% connections may grow. If set, it must be an integer &gt;= 0.
&gt;&gt;             %% By default the value is 5. If you anticipate a huge number
&gt;&gt; of
&gt;&gt;             %% connections being initialised *simultaneously*, set this
&gt;&gt; number
&gt;&gt;             %% higher.
&gt;&gt;             %% {pb_backlog, 64},
&gt;&gt;
&gt;&gt;             %% pb_ip is the IP address that the Riak Protocol Buffers
&gt;&gt; interface
&gt;&gt;             %% will bind to.  If this is undefined, the interface will
&gt;&gt; not run.
&gt;&gt;             {pb_ip,   &quot;10.1.1.221&quot; },
&gt;&gt;
&gt;&gt;             %% pb_port is the TCP port that the Riak Protocol Buffers
&gt;&gt; interface
&gt;&gt;             %% will bind to
&gt;&gt;             {pb_port, 8087 }
&gt;&gt;             ]},
&gt;&gt;
&gt;&gt;  %% Riak Core config
&gt;&gt;  {riak_core, [
&gt;&gt;               %% Default location of ringstate
&gt;&gt;               {ring_state_dir, &quot;/var/lib/riak/ring&quot;},
&gt;&gt;
&gt;&gt;               %% Default ring creation size.  Make sure it is a power of
&gt;&gt; 2,
&gt;&gt;               %% e.g. 16, 32, 64, 128, 256, 512 etc
&gt;&gt;               %{ring_creation_size, 64},
&gt;&gt;
&gt;&gt;               %% http is a list of IP addresses and TCP ports that the
&gt;&gt; Riak
&gt;&gt;               %% HTTP interface will bind.
&gt;&gt;               {http, [ {&quot;10.1.1.221&quot;, 8098 } ]},
&gt;&gt;
&gt;&gt;               %% https is a list of IP addresses and TCP ports that the
&gt;&gt; Riak
&gt;&gt;               %% HTTPS interface will bind.
&gt;&gt;               {https, [{ &quot;10.1.1.221&quot;, 8069 }]},
&gt;&gt;
&gt;&gt;               %% Default cert and key locations for https can be
&gt;&gt; overridden
&gt;&gt;               %% with the ssl config variable, for example:
&gt;&gt;               {ssl, [
&gt;&gt;                      {certfile, &quot;/etc/riak/server.crt&quot;},
&gt;&gt;                      {keyfile, &quot;/etc/riak/server.key&quot;}
&gt;&gt;                     ]},
&gt;&gt;
&gt;&gt;               %% riak_handoff_port is the TCP port that Riak uses for
&gt;&gt;               %% intra-cluster data handoff.
&gt;&gt;               {handoff_port, 8099 },
&gt;&gt;
&gt;&gt;               %% To encrypt riak_core intra-cluster data handoff traffic,
&gt;&gt;               %% uncomment the following line and edit its path to an
&gt;&gt;               %% appropriate certfile and keyfile.  (This example uses a
&gt;&gt;               %% single file with both items concatenated together.)
&gt;&gt;               %{handoff_ssl_options, [{certfile, &quot;/tmp/erlserver.pem&quot;}]},
&gt;&gt;
&gt;&gt;               %% DTrace support
&gt;&gt;               %% Do not enable 'dtrace_support' unless your Erlang/OTP
&gt;&gt;               %% runtime is compiled to support DTrace.  DTrace is
&gt;&gt;               %% available in R15B01 (supported by the Erlang/OTP
&gt;&gt;               %% official source package) and in R14B04 via a custom
&gt;&gt;               %% source repository &amp; branch.
&gt;&gt;               {dtrace_support, false},
&gt;&gt;
&gt;&gt;               %% Platform-specific installation paths (substituted by
&gt;&gt; rebar)
&gt;&gt;               {platform_bin_dir, &quot;/usr/sbin&quot;},
&gt;&gt;               {platform_data_dir, &quot;/var/lib/riak&quot;},
&gt;&gt;               {platform_etc_dir, &quot;/etc/riak&quot;},
&gt;&gt;               {platform_lib_dir, &quot;/usr/lib/riak/lib&quot;},
&gt;&gt;               {platform_log_dir, &quot;/var/log/riak&quot;}
&gt;&gt;              ]},
&gt;&gt;
&gt;&gt;  %% Riak KV config
&gt;&gt;  {riak_kv, [
&gt;&gt;             %% Storage_backend specifies the Erlang module defining the
&gt;&gt; storage
&gt;&gt;             %% mechanism that will be used on this node.
&gt;&gt;             %{storage_backend, riak_kv_memory_backend},
&gt;&gt;             {storage_backend, riak_kv_bitcask_backend},
&gt;&gt;             %{storage_backend, riak_kv_eleveldb_backend},
&gt;&gt;
&gt;&gt;             %% raw_name is the first part of all URLS used by the Riak
&gt;&gt; raw HTTP
&gt;&gt;             %% interface.  See riak_web.erl and raw_http_resource.erl for
&gt;&gt;             %% details.
&gt;&gt;             %{raw_name, &quot;riak&quot;},
&gt;&gt;
&gt;&gt;             %% mapred_name is URL used to submit map/reduce requests to
&gt;&gt; Riak.
&gt;&gt;             {mapred_name, &quot;mapred&quot;},
&gt;&gt;
&gt;&gt;             %% mapred_system indicates which version of the MapReduce
&gt;&gt;             %% system should be used: 'pipe' means riak_pipe will
&gt;&gt;             %% power MapReduce queries, while 'legacy' means that luke
&gt;&gt;             %% will be used
&gt;&gt;             {mapred_system, pipe},
&gt;&gt;
&gt;&gt;             %% mapred_2i_pipe indicates whether secondary-index
&gt;&gt;             %% MapReduce inputs are queued in parallel via their own
&gt;&gt;             %% pipe ('true'), or serially via a helper process
&gt;&gt;             %% ('false' or undefined).  Set to 'false' or leave
&gt;&gt;             %% undefined during a rolling upgrade from 1.0.
&gt;&gt;             {mapred_2i_pipe, true},
&gt;&gt;
&gt;&gt;             %% directory used to store a transient queue for pending
&gt;&gt;             %% map tasks
&gt;&gt;             %% Only valid when mapred_system == legacy
&gt;&gt;             %% {mapred_queue_dir, &quot;/var/lib/riak/mr_queue&quot; },
&gt;&gt;
&gt;&gt;             %% Each of the following entries control how many Javascript
&gt;&gt;             %% virtual machines are available for executing map, reduce,
&gt;&gt;             %% pre- and post-commit hook functions.
&gt;&gt;             {map_js_vm_count, 8 },
&gt;&gt;             {reduce_js_vm_count, 6 },
&gt;&gt;             {hook_js_vm_count, 2 },
&gt;&gt;
&gt;&gt;             %% Number of items the mapper will fetch in one request.
&gt;&gt;             %% Larger values can impact read/write performance for
&gt;&gt;             %% non-MapReduce requests.
&gt;&gt;             %% Only valid when mapred_system == legacy
&gt;&gt;             %% {mapper_batch_size, 5},
&gt;&gt;
&gt;&gt;             %% js_max_vm_mem is the maximum amount of memory, in
&gt;&gt; megabytes,
&gt;&gt;             %% allocated to the Javascript VMs. If unset, the default is
&gt;&gt;             %% 8MB.
&gt;&gt;             {js_max_vm_mem, 8},
&gt;&gt;
&gt;&gt;             %% js_thread_stack is the maximum amount of thread stack, in
&gt;&gt; megabyes,
&gt;&gt;             %% allocate to the Javascript VMs. If unset, the default is
&gt;&gt; 16MB.
&gt;&gt;             %% NOTE: This is not the same as the C thread stack.
&gt;&gt;             {js_thread_stack, 16},
&gt;&gt;
&gt;&gt;             %% Number of objects held in the MapReduce cache. These will
&gt;&gt; be
&gt;&gt;             %% ejected when the cache runs out of room or the bucket/key
&gt;&gt;             %% pair for that entry changes
&gt;&gt;             %% Only valid when mapred_system == legacy
&gt;&gt;             %% {map_cache_size, 10000},
&gt;&gt;
&gt;&gt;             %% js_source_dir should point to a directory containing
&gt;&gt; Javascript
&gt;&gt;             %% source files which will be loaded by Riak when it
&gt;&gt; initializes
&gt;&gt;             %% Javascript VMs.
&gt;&gt;             %{js_source_dir, &quot;/tmp/js_source&quot;},
&gt;&gt;
&gt;&gt;             %% http_url_encoding determines how Riak treats URL encoded
&gt;&gt;             %% buckets, keys, and links over the REST API. When set to
&gt;&gt; 'on'
&gt;&gt;             %% Riak always decodes encoded values sent as URLs and
&gt;&gt; Headers.
&gt;&gt;             %% Otherwise, Riak defaults to compatibility mode where links
&gt;&gt;             %% are decoded, but buckets and keys are not. The
&gt;&gt; compatibility
&gt;&gt;             %% mode will be removed in a future release.
&gt;&gt;             {http_url_encoding, on},
&gt;&gt;
&gt;&gt;             %% Switch to vnode-based vclocks rather than client ids.  This
&gt;&gt;             %% significantly reduces the number of vclock entries.
&gt;&gt;             %% Only set true if *all* nodes in the cluster are upgraded
&gt;&gt; to 1.0
&gt;&gt;             {vnode_vclocks, true},
&gt;&gt;
&gt;&gt;              %% This option enables compatability of bucket and key
&gt;&gt; listing
&gt;&gt;             %% with 0.14 and earlier versions. Once a rolling upgrade to
&gt;&gt;             %% a version &gt; 0.14 is completed for a cluster, this should be
&gt;&gt;             %% set to false for improved performance for bucket and key
&gt;&gt;             %% listing operations.
&gt;&gt;             {legacy_keylisting, false},
&gt;&gt;
&gt;&gt;             %% This option toggles compatibility of keylisting with 1.0
&gt;&gt;             %% and earlier versions.  Once a rolling upgrade to a version
&gt;&gt;             %% &gt; 1.0 is completed for a cluster, this should be set to
&gt;&gt;             %% true for better control of memory usage during key listing
&gt;&gt;             %% operations
&gt;&gt;             {listkeys_backpressure, true}
&gt;&gt;            ]},
&gt;&gt;
&gt;&gt;  %% Riak Search Config
&gt;&gt;  {riak_search, [
&gt;&gt;                 %% To enable Search functionality set this 'true'.
&gt;&gt;                 {enabled, false}
&gt;&gt;                ]},
&gt;&gt;
&gt;&gt;  %% Merge Index Config
&gt;&gt;  {merge_index, [
&gt;&gt;                 %% The root dir to store search merge_index data
&gt;&gt;                 {data_root, &quot;/var/lib/riak/merge_index&quot;},
&gt;&gt;
&gt;&gt;                 %% Size, in bytes, of the in-memory buffer.  When this
&gt;&gt;                 %% threshold has been reached the data is transformed
&gt;&gt;                 %% into a segment file which resides on disk.
&gt;&gt;                 {buffer_rollover_size, 1048576},
&gt;&gt;
&gt;&gt;                 %% Overtime the segment files need to be compacted.
&gt;&gt;                 %% This is the maximum number of segments that will be
&gt;&gt;                 %% compacted at once.  A lower value will lead to
&gt;&gt;                 %% quicker but more frequent compactions.
&gt;&gt;                 {max_compact_segments, 20}
&gt;&gt;                ]},
&gt;&gt;
&gt;&gt;  %% Bitcask Config
&gt;&gt;  {bitcask, [
&gt;&gt;              {data_root, &quot;/var/lib/riak/bitcask&quot;}
&gt;&gt;            ]},
&gt;&gt;
&gt;&gt;  %% eLevelDB Config
&gt;&gt;  {eleveldb, [
&gt;&gt;              {data_root, &quot;/var/lib/riak/leveldb&quot;},
&gt;&gt;      {write_buffer_size_min, 31457280}, %% 30 MB in bytes
&gt;&gt;              {write_buffer_size_max, 62914560} %% 60 MB in bytes
&gt;&gt;             ]},
&gt;&gt;
&gt;&gt;  %% Lager Config
&gt;&gt;  {lager, [
&gt;&gt;             %% What handlers to install with what arguments
&gt;&gt;             %% The defaults for the logfiles are to rotate the files when
&gt;&gt;             %% they reach 10Mb or at midnight, whichever comes first, and
&gt;&gt; keep
&gt;&gt;             %% the last 5 rotations. See the lager README for a
&gt;&gt; description of
&gt;&gt;             %% the time rotation format:
&gt;&gt;             %% <a  rel="nofollow" href="https://github.com/basho/lager/blob/master/README.org">https://github.com/basho/lager/blob/master/README.org</a>
&gt;&gt;             %%
&gt;&gt;             %% If you wish to disable rotation, you can either set the
&gt;&gt; size to 0
&gt;&gt;             %% and the rotation time to &quot;&quot;, or instead specify a 2-tuple
&gt;&gt; that only
&gt;&gt;             %% consists of {Logfile, Level}.
&gt;&gt;             {handlers, [
&gt;&gt;                 {lager_console_backend, info},
&gt;&gt;                 {lager_file_backend, [
&gt;&gt;                     {&quot;/var/log/riak/error.log&quot;, error, 10485760, &quot;$D0&quot;,
&gt;&gt; 5},
&gt;&gt;                     {&quot;/var/log/riak/console.log&quot;, info, 10485760, &quot;$D0&quot;,
&gt;&gt; 5}
&gt;&gt;                 ]}
&gt;&gt;             ]},
&gt;&gt;
&gt;&gt;             %% Whether to write a crash log, and where.
&gt;&gt;             %% Commented/omitted/undefined means no crash logger.
&gt;&gt;             {crash_log, &quot;/var/log/riak/crash.log&quot;},
&gt;&gt;
&gt;&gt;             %% Maximum size in bytes of events in the crash log -
&gt;&gt; defaults to 65536
&gt;&gt;             {crash_log_msg_size, 65536},
&gt;&gt;
&gt;&gt;             %% Maximum size of the crash log in bytes, before its
&gt;&gt; rotated, set
&gt;&gt;             %% to 0 to disable rotation - default is 0
&gt;&gt;              {crash_log_size, 10485760},
&gt;&gt;
&gt;&gt;             %% What time to rotate the crash log - default is no time
&gt;&gt;             %% rotation. See the lager README for a description of this
&gt;&gt; format:
&gt;&gt;             %% <a  rel="nofollow" href="https://github.com/basho/lager/blob/master/README.org">https://github.com/basho/lager/blob/master/README.org</a>
&gt;&gt;             {crash_log_date, &quot;$D0&quot;},
&gt;&gt;
&gt;&gt;             %% Number of rotated crash logs to keep, 0 means keep only the
&gt;&gt;             %% current one - default is 0
&gt;&gt;             {crash_log_count, 5},
&gt;&gt;
&gt;&gt;             %% Whether to redirect error_logger messages into lager -
&gt;&gt; defaults to true
&gt;&gt;             {error_logger_redirect, true}
&gt;&gt;         ]},
&gt;&gt;
&gt;&gt;  %% riak_sysmon config
&gt;&gt;  {riak_sysmon, [
&gt;&gt;          %% To disable forwarding events of a particular type, use a
&gt;&gt;          %% limit of 0.
&gt;&gt;          {process_limit, 30},
&gt;&gt;          {port_limit, 2},
&gt;&gt;
&gt;&gt;          %% Finding reasonable limits for a given workload is a matter
&gt;&gt;          %% of experimentation.
&gt;&gt;          {gc_ms_limit, 100},
&gt;&gt;          {heap_word_limit, 40111000},
&gt;&gt;
&gt;&gt;          %% Configure the following items to 'false' to disable logging
&gt;&gt;          %% of that event type.
&gt;&gt;          {busy_port, true},
&gt;&gt;          {busy_dist_port, true}
&gt;&gt;         ]},
&gt;&gt;
&gt;&gt;  %% SASL config
&gt;&gt;  {sasl, [
&gt;&gt;          {sasl_error_logger, false}
&gt;&gt;         ]},
&gt;&gt;
&gt;&gt;  %% riak_control config
&gt;&gt;  {riak_control, [
&gt;&gt;                 %% Set to false to disable the admin panel.
&gt;&gt;                 {enabled, true},
&gt;&gt;
&gt;&gt;                 %% Authentication style used for access to the admin
&gt;&gt;                 %% panel. Valid styles are 'userlist' &lt;TODO&gt;.
&gt;&gt;                 {auth, none},
&gt;&gt;
&gt;&gt;                 %% If auth is set to 'userlist' then this is the
&gt;&gt;                 %% list of usernames and passwords for access to the
&gt;&gt;                 %% admin panel.
&gt;&gt;                 {userlist, [{&quot;user&quot;, &quot;pass&quot;}
&gt;&gt;                            ]},
&gt;&gt;
&gt;&gt;                 %% The admin panel is broken up into multiple
&gt;&gt;                 %% components, each of which is enabled or disabled
&gt;&gt;                 %% by one of these settings.
&gt;&gt;                  {admin, true}
&gt;&gt;                 ]}
&gt;&gt; ].
&gt;&gt;
&gt;&gt; ------
&gt;&gt; I have two machines with those settings: 10.1.1.221 and 10.1.1.222. They
&gt;&gt; are working together.
&gt;&gt;  Do you see any problem on that?
&gt;&gt;
&gt;&gt; Again, if you think I can't go any further with those default settings
&gt;&gt; (without tuning FS, etc), please, let me know.
&gt;&gt;
&gt;&gt; Thank you.
&gt;&gt;
&gt;&gt; On Sat, Nov 3, 2012 at 4:43 PM, Jared Morrow &lt;ja...@basho.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Uruka,
&gt;&gt;&gt;
&gt;&gt;&gt; Now that you got some somewhat reasonable numbers, it is probably time
&gt;&gt;&gt; to discuss what you are trying to get out of Riak.  We typically recommend
&gt;&gt;&gt; 4 or 5 nodes minimum for a Riak install because that is the point where the
&gt;&gt;&gt; distribution becomes a performance benefit rather than a hindrance.  I know
&gt;&gt;&gt; you were just load testing, but I'd recommend considering a test with 4 or
&gt;&gt;&gt; 5 nodes, with default N values.  During the test, remove a node (power it
&gt;&gt;&gt; off, or 'riak stop' it).  Or like someone else mentioned start with a 3 or
&gt;&gt;&gt; 4 node cluster and add a node to see how the performance goes up and no
&gt;&gt;&gt; further operations work is needed to rebalance the data around the cluster.
&gt;&gt;&gt;  This is really where Riak shines over some alternative databases, the ease
&gt;&gt;&gt; of scaling and dealing with failures.  SIngle node performance although fun
&gt;&gt;&gt; to try and tune to get the most out of it, isn't as interesting on a long
&gt;&gt;&gt; timeline when trying to scale the system.  Obviously single node
&gt;&gt;&gt; performance is still important, dont' get me wrong.  Riak isn't always the
&gt;&gt;&gt; best choice, but when it comes with staying available and performance while
&gt;&gt;&gt; systems are failing no other system has a better real-world story than Riak.
&gt;&gt;&gt;
&gt;&gt;&gt; If you still want to get your single node performance up, we have
&gt;&gt;&gt; several pages on our docs page based around tuning.  A good place to start
&gt;&gt;&gt; is the file system tuning page
&gt;&gt;&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/File-System-Tuning/">http://docs.basho.com/riak/latest/cookbooks/File-System-Tuning/</a> .
&gt;&gt;&gt;  Reading that and other pages in the Operations section might be helpful in
&gt;&gt;&gt; squeezing out those last bits of speed.
&gt;&gt;&gt;
&gt;&gt;&gt; I am glad to see your initial 60 writes/sec has gone up to 800
&gt;&gt;&gt; writes/sec, but we definitely can do better once you start utilizing our
&gt;&gt;&gt; strengths.
&gt;&gt;&gt;
&gt;&gt;&gt; Hope my rambling helped,
&gt;&gt;&gt; -Jared
&gt;&gt;&gt;
&gt;&gt;&gt; On Sat, Nov 3, 2012 at 4:55 AM, Uruka Dark &lt;urukad...@gmail.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Jared,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thank you for you time and reply.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I got impressed by your numbers and I started to double check my
&gt;&gt;&gt;&gt; settings. I found a big problem here, my third machine (the one out of the
&gt;&gt;&gt;&gt; cluster, making the load), was not talking to Riak in gigabit speed, it was
&gt;&gt;&gt;&gt; 100 Mbs. I changed the network cable and it's working fine now.
&gt;&gt;&gt;&gt; I ran my python script again and I already could see better results:
&gt;&gt;&gt;&gt; 252 ops/sec (before the fix it was 175 ops/sec).
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I also ran your benchmark .config, and these are my numbers:
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="https://dl.dropbox.com/u/308392/summary.png">https://dl.dropbox.com/u/308392/summary.png</a>
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; As you can see, even so, I'm still far from your results.. not even
&gt;&gt;&gt;&gt; close, and now I'm using Bitcask.
&gt;&gt;&gt;&gt; Anyway, my current position is much better than at the beggining. I'll
&gt;&gt;&gt;&gt; double-check all over again, cause now I have a confirmation that there is
&gt;&gt;&gt;&gt; something wrong.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If you have any suggestion, please, let me know.
&gt;&gt;&gt;&gt; Once again, thank you.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Sat, Nov 3, 2012 at 3:08 AM, Jared Morrow &lt;ja...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I forgot to mention that 2000 ops/sec was on bitcask, not memory.  I
&gt;&gt;&gt;&gt;&gt; didn't bother with the memory backend.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; -Jared
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Sat, Nov 3, 2012 at 12:05 AM, Jared Morrow &lt;ja...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Uruka,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; So looking at your results something is really wrong with your setup.
&gt;&gt;&gt;&gt;&gt;&gt;  I was surprised by your numbers, so I made two VM's each with only 1gb 
&gt;&gt;&gt;&gt;&gt;&gt; of
&gt;&gt;&gt;&gt;&gt;&gt; RAM on two different boxes also on a 1gb switch.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I ran a put of 100,000 keys at 10kb in size.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I didn't do any tuning at all on the VM's and these were quick Ubuntu
&gt;&gt;&gt;&gt;&gt;&gt; 10.04 VM's with 2 virtual CPU's and 1 gig of ram.  I also didn't change 
&gt;&gt;&gt;&gt;&gt;&gt; any
&gt;&gt;&gt;&gt;&gt;&gt; settings in Riak, except for the IP address and listening ports.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Here is the summary of the results showing around 2000 ops/sec
&gt;&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="https://dl.dropbox.com/u/183971/summary.png">https://dl.dropbox.com/u/183971/summary.png</a>
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; So my main thought is that you weren't actually using N=1 for your
&gt;&gt;&gt;&gt;&gt;&gt; puts and you were using the default N value of 3, meaning you were 
&gt;&gt;&gt;&gt;&gt;&gt; writing
&gt;&gt;&gt;&gt;&gt;&gt; each key/value 3 times, and with 2 nodes this is doing a lot of writes to
&gt;&gt;&gt;&gt;&gt;&gt; the same disk multiple times.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; To be sure you have N=1, you can use 'riak attach' on each node and
&gt;&gt;&gt;&gt;&gt;&gt; enter the following command:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; riak_core_bucket:set_bucket(&lt;&lt;&quot;pop1&quot;&gt;&gt;,[{n_val,1}]).
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; If you bucket name is &quot;pop1&quot; as in my case.  That name is completely
&gt;&gt;&gt;&gt;&gt;&gt; arbitrary.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Sorry I'm late to this thread, I had to find some time to setup the
&gt;&gt;&gt;&gt;&gt;&gt; test.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; For reference I used <a  rel="nofollow" href="https://github.com/basho/basho_bench">https://github.com/basho/basho_bench</a> for the
&gt;&gt;&gt;&gt;&gt;&gt; benchmark.  With the following .config file
&gt;&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="https://gist.github.com/e630b63f4a025a0fb634">https://gist.github.com/e630b63f4a025a0fb634</a>
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hope this helps,
&gt;&gt;&gt;&gt;&gt;&gt; Jared
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09198.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09199">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09199">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09204.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09169.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09170.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Brian Akins</span></li>
<li class="icons-email"><span class="subject"><a href="msg09174.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li class="icons-email"><span class="subject"><a href="msg09177.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09178.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09179.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09180.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09183.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09186.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09198.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: How to make Riak work faster (writing)</span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09204.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09207.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09209.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Jared Morrow</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: How to make Riak work faster (writing)">
<input type="hidden" name="msgid" value="CA+vXBu=AWL1c1uyp0e-Odbb2+3fvRTecUGABZLOMh_Xq_L2Ykw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09199.html">
<input type="submit" value=" Uruka Dark ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+make+Riak+work+faster+%5C%28writing%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09198.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09204.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CA+vXBu=AWL1c1uyp0e-Odbb2+3fvRTecUGABZLOMh_Xq_L2Ykw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
