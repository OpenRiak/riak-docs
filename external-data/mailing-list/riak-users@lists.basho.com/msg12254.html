<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: use Siblings to implement a message queue?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd10.html#12254" id="c">
<link rel="index" href="mail10.html#12254" id="i">
<link rel="prev" href="msg12253.html" id="p">
<link rel="next" href="msg12244.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12254.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+use+Siblings+to+implement+a+message+queue%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: use Siblings to implement a message queue?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Guido+Medina%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Guido Medina</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130912" rel="nofollow">Thu, 12 Sep 2013 19:53:30 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Alex,

</pre><tt>I get what you mean, I would say; if you think your project will succeed 
</tt><tt>don't think small, RabbitMQ and Riak can be pretty easy to understand 
</tt><tt>and manage once you play with them, don't be scare to try, high demand 
</tt><tt>systems usually have several subsystems to get their tasks done quickly 
</tt><tt>like:
</tt><pre style="margin: 0em;"></pre><pre>

1. Distributed data.
2. Distributed queues.
3. Text indexing/search.

</pre><tt>With Riak+Yokozuna you cover 1 and 3 which is a pretty good combination, 
</tt><tt>as a side note, maybe, just maybe, if you &quot;divide and conquer&quot; you may 
</tt><tt>be able to remove the &quot;Set&quot; concept and just work with CRDT or siblings, 
</tt><tt>let me explain briefly:
</tt><pre style="margin: 0em;">

</pre><tt>CRDT would warranty your distributed CAS operations per your designed 
</tt><tt>key, instead of treating the keys as a Set, treat them independently and 
</tt><tt>each CRDT key to manage its own states, that way you get the atomicity 
</tt><tt>you want without worrying about locking or distributed concurrency in a 
</tt><tt>collection of items since each key is unique and each would control its 
</tt><tt>own state, or let each key have siblings and conflict resolution, as 
</tt><tt>long as you don't create too many siblings per key in a very small 
</tt><tt>amount of time.
</tt><pre style="margin: 0em;">

</pre><tt>The the only show stopper for CRDT is if you need to do operations in 
</tt><tt>more than one atomically, then you will have to use siblings, even for 
</tt><tt>siblings, your key approach would be to try to operate atomically in the 
</tt><tt>minimum amount of states as possible so that you can avoid using Sets or 
</tt><tt>Queues.
</tt><pre style="margin: 0em;">

</pre><tt>I hope I have expressed my thoughts well since explaining all this can 
</tt><tt>get complicated really quick, or become a really long talk.
</tt><pre style="margin: 0em;">

Hope that helps,

Guido.

On 12/09/13 17:45, Alex Rice wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hey all, thanks for the feedback, this is interesting!

re: Those CRDT white papers look pretty complicated, I will definitely
will leave that to you hardcore mathematicians and computer scientists
:)
re: Riak 2.0, I see there are git branches for 2.0 related stuff in
Riak and in corrugatediron, I am guessing it's still too rough around
the edges for a newbie like me to be messing around with?
re: RabbitMQ I had heard of it but am hesitant to add another
daemon/system dependency. But I am  definitely considering your
advice, Guido!

Also for this particular project (a multiplayer game) I may be able to
get away with Sets, don't actually really need proper Queues. Actually
I'm not sure. Just thinking out loud here.

For a Set implementation in Riak, I am thinking of modeling it after
this blog post, I cannot find which at the moment, which described how
to implement a lock-free Set in Redis. Redis is not distributed, but I
think the data structure is still relevant:

* To get around the eventual-consistency issue, a prerequisite would
be to always use R=1 and W=all. This will optimize it for reads
because there will be a process polling Riak to remove messages out of
the Set.
*  In the Redis implementation, they used the atomic APPEND operation
to append entries into the set, as a list but with notation to add or
remove, prefixed with + or -. e.g.
  +itemA
  +itemB
  -itemA
  +itemC
  =&gt; yields { itemB, itemC }
* Obviously Riak doesn't have atomic appends, however setting a bucket
to allow_mult = true, and always Put-ing with null vector clock, then
the Siblings feature should be equivalent. Instead of a value being
appended to, the Siblings would be populated with +itemA, +itemB,
-itemA, +itemC, etc.
* Any process reading the Set is also be responsible for collating and
Put-ing the condensed set back, after it reaches some size limit or I
think they called it 'fragmentation'.  This condense and re-Put
operation would be the tricky part, and would need to use vector clock
and ensure there are 0 siblings when finished. But it should be
possible? It seems like this is an uber-simplified form of a CRDT data
structure?

Thanks,
Alex













On Thu, Sep 12, 2013 at 2:12 AM, Guido Medina &lt;guido.med...@temetra.com&gt; wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Alex,

RabbitMQ which is a good high performer, developed in Erlang and scales just
as Riak.

The old saying, the right tool for the right job, I like how fast Riak is
fetching/storing key values on a distributed environment, I don't like Riak
for queues, is it because it wasn't designed for that? CRDT like CAS
operations on structures (to mention some for Java) like LinkedBlockingQueue
and ConcurrentLinkedQueue should be painful enough to develop in a CRDT
environment, cause now you would be talking of guarding states of few within
the same structure; say AtomicReference of several variables to warranty a
non-blocking CAS operation, in this case heap and tail of the queue (Not so
true for LinkedBlockingQueue)

And performance of several CRDT for high performance queue I don't actually
think is going to be good.

If I were to use Riak for my big data environment and would like to match
Riak on a distributed queueing system then I would use like I said,
RabbitMQ.

Guido.


On 12/09/13 00:29, Alex Rice wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi I'm very new to Riak. The allow_mult = true /  Siblings feature is
very interesting. Could it be used to implement a high performance
collection like a Queue or Set, in a lock free manner? The Riak docs
make it sound like allow_mult is mainly for confict resolution and
degenerate cases, rather than a feature which a data structure could
be designed around.  Does anyone have any links to share, or thoughts
about this broader issue?
Thanks much!
Alex

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12253.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd10.html#12254">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail10.html#12254">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12244.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12240.html">use Siblings to implement a message queue?</a></span> <span class="sender italic">Alex Rice</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12241.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12242.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Tom Santero</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12243.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li class="icons-email"><span class="subject"><a href="msg12248.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12250.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Alex Rice</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12253.html">Re: use Siblings to implement a message que...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: use Siblings to implement a message que...</span> <span class="sender italic">Guido Medina</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: use Siblings to implement a message queue?">
<input type="hidden" name="msgid" value="52321115.3060807@temetra.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12254.html">
<input type="submit" value=" Guido Medina ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+use+Siblings+to+implement+a+message+queue%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12253.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12244.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">52321115.3060807@temetra.com</li>
</ul>
</div>
</body>
</html>
