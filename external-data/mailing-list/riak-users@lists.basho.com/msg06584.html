<!DOCTYPE html>
<html lang="en">
<head>
<title>Is Riak a good solution for this problem?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06584" id="c">
<link rel="index" href="maillist.html#06584" id="i">
<link rel="prev" href="msg06583.html" id="p">
<link rel="next" href="msg06588.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06584.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Is+Riak+a+good+solution+for+this+problem%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Is Riak a good solution for this problem?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Marco+Monteiro%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Marco Monteiro</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120212" rel="nofollow">Sun, 12 Feb 2012 03:27:51 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello!

I'm considering Riak for the statistics of a site that is approaching  a
billion page views per month.
The plan is to log a little information about each the page view and then
to query that data.</pre><pre>

I'm very new to Riak.  I've gone over the documentation on the wiki, and I
know about map-reduce,
secondary indexes and Riak search. I've installed Riak on a single node and
made a test with the
default configuration. The results were a little bellow what I expected.
For the test is used the following
requirement.

We want the page view count by day for registered and unregistered users.
We are storing session
documents. Each document has a session identifier as it's key and a list of
page views as the value
(and a few additional properties we can ignore). This document structure
comes from CouchDB,
where I organised things like this to be able to more easily query the
database. I've done a basic
javascript map-reduce query for this. I just map over each session (every
k/v in a bucket) returning
the length of the page views array for either the registered or
unregistered field (the other is zero), and
the day of the request. In the reduce I collect them by hashing the day and
summing the two number
of page views. Then I have a second reduce to sort the list by day.

This is very slow on a single machine setup with default Riak
configuration. 1.000 sessions takes
6 seconds. 10.000 sessions takes more that 2 minutes (timeout). We want to
handle 10.000.000
sessions, at least. Is there a way, maybe with secondary indexes, to make
this go faster using only Riak?
Or must I use some kind of persistent cache to store this info as time goes
by? Or can I make Riak
run 100 times faster by tweaking the config? I don't want to have 1000
machines for making this work.

Also, will updating the session documents be a problem for Riak? Would it
be better to store each
page hit under a new key, to not update the the session document. Because
of the &quot;multilevel&quot; map
reduce this ca work on Riak, where it didn't work on CouchDB, because its
view system limitation.
Unfortunately, with the update of documents the CouchDB database was
growing way too fast for it
to be a feasible solution.


Any advice to make Riak work for this problem is greatly appreciated.

Thanks,
Marco
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06583.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06584">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06584">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06588.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Is Riak a good solution for this problem?</span> <span class="sender italic">Marco Monteiro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06588.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06589.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06591.html">Re: Is Riak a good solution for this proble...</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06592.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Jacques</span></li>
<li class="icons-email"><span class="subject"><a href="msg06593.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Jeffrey Massung</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06659.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Marco Monteiro</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06587.html">Re: Is Riak a good solution for this problem?</a></span> <span class="sender italic">Steve Song</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Is Riak a good solution for this problem?">
<input type="hidden" name="msgid" value="CADgE0XhCR5ANChZ8kMFP-59ftS1W+M0hwEXazX=9fdSr5yJr4g@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06584.html">
<input type="submit" value=" Marco Monteiro ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Is+Riak+a+good+solution+for+this+problem%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06583.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06588.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CADgE0XhCR5ANChZ8kMFP-59ftS1W+M0hwEXazX=9fdSr5yJr4g@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
