<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Most efficient way to determine if 1000 specific keys exist?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07387" id="c">
<link rel="index" href="maillist.html#07387" id="i">
<link rel="prev" href="msg07376.html" id="p">
<link rel="next" href="msg07388.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07387.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Most+efficient+way+to+determine+if+1000+specific+keys+exist%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Most efficient way to determine if 1000 specific keys exist?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Markus+Silpala%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Markus Silpala</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120505" rel="nofollow">Sat, 05 May 2012 10:33:04 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey Tim,

Riak does not maintain a key index in the sense that I think you're looking 
for, and scanning across all keys in a bucket is consequently a fairly 
expensive operation (see List Keys for more info on that). A map-reduce query 
which takes the entire bucket as input also begins with a key-scan op under the 
covers. Since you already know the set of keys you're looking for, you probably 
do a direct fetch of each key. This will likely perform a lot better and put 
less load on the system.</pre><pre>

To avoid reading the objects, you might consider doing a GET for each key, and 
use the &quot;If-Modified-Since&quot; header to avoid loading the the actual object data. 
I haven't tried this, but if you provide the current time as argument to 
If-Modified-Since, then every object present should report as &quot;Not Modified&quot; 
and return a 304 without actually reading the object data. Thus, for objects 
not present you'll get a 404 and for objects present you'll get a 304.

Mind you, I have not actually tried this, and I'm sure there are edge cases 
where you may get a 200 and the full object returned. Test, measure, and verify 
before committing.

For details, check out the Fetch Object page: 
<a  rel="nofollow" href="http://wiki.basho.com/HTTP-Fetch-Object.html">http://wiki.basho.com/HTTP-Fetch-Object.html</a>

Both of the links above assume you're using the HTTP API. The PB API doesn't 
seem to have the same option, so this may or may not work for your case.

Good luck with it!

-Markus Silpala


On May 2, 2012, at 1:47 PM, Tim Haines wrote:

&gt; Hey guys,
&gt; 
&gt; Still a relative newbie here.
&gt; 
&gt; I was hoping to be able to setup a MapReduce job that I could feed 1000 keys 
&gt; to, and have it tell me of the 1000, which keys exist in the bucket.  I was 
&gt; hoping this could use the key index (such a thing exists right?) without 
&gt; having to read the objects.
&gt; 
&gt; The methods I've tried for doing this fail when the first non-existing key is 
&gt; found though.
&gt; 
&gt; Is there a way to do this?
&gt; 
&gt; Or alternatively, is there a way to check for the presence of one key at a 
&gt; time without riak having to read the object?
&gt; 
&gt; Cheers,
&gt; 
&gt; Tim.
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07376.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07387">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07387">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07388.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07375.html">Most efficient way to determine if 1000 specific keys ex...</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07376.html">Re: Most efficient way to determine if 1000 specifi...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Most efficient way to determine if 1000 specifi...</span> <span class="sender italic">Markus Silpala</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07388.html">Re: Most efficient way to determine if 1000 spe...</a></span> <span class="sender italic">Kelly McLaughlin</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07389.html">Re: Most efficient way to determine if 1000 specifi...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li class="icons-email"><span class="subject"><a href="msg07408.html">Re: Most efficient way to determine if 1000 specifi...</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07409.html">Re: Most efficient way to determine if 1000 spe...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07410.html">Re: Most efficient way to determine if 1000...</a></span> <span class="sender italic">Shuhao Wu</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Most efficient way to determine if 1000 specific keys exist?">
<input type="hidden" name="msgid" value="4F3801CF-1BBE-4D66-AFF1-BD73F1E4C16A@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07387.html">
<input type="submit" value=" Markus Silpala ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Most+efficient+way+to+determine+if+1000+specific+keys+exist%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07376.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07388.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4F3801CF-1BBE-4D66-AFF1-BD73F1E4C16A@gmail.com</li>
</ul>
</div>
</body>
</html>
