<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: Need help with Riak-KV (2.1.4) certificate based authentication	using Java client</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17601" id="c">
<link rel="index" href="maillist.html#17601" id="i">
<link rel="prev" href="msg17598.html" id="p">
<link rel="next" href="msg17602.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17601.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Need+help+with+Riak%5C-KV+%5C%282.1.4%5C%29+certificate+based+authentication%09using+Java+client%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: Need help with Riak-KV (2.1.4) certificate based authentication	using Java client</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Nguyen%2C+Kyle%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Nguyen, Kyle</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160829" rel="nofollow">Mon, 29 Aug 2016 14:09:07 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Thanks a lot, Luke! I finally got the mutual certificate based authentication 
working by setting check_clr = off since I don't see any documentation on how 
to set this up and we might not need this feature. Another thing that I added 
to make it work is to add the correct entry for cidr. I was using 127.0.0.1/32 
instead of 10.0.2.2/32 which is the Ubuntu ip that my laptop localhost is 
sending the request to.</pre><pre>

+--------------------+------------+-----------+----------+
|       users        |    cidr    |  source   | options  |
+--------------------+------------+-----------+----------+
|        kyle        |10.0.2.2/32 |certificate|    []

TLS also works without using the DNS-resolvable hostname with protocol buffer. 
Hence, I thought you must have referred to HTTPS.

-Kyle-

-----Original Message-----
From: Luke Bakken [<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>]
Sent: Monday, August 29, 2016 7:59 AM
To: Nguyen, Kyle
Cc: Riak Users
Subject: Re: Need help with Riak-KV (2.1.4) certificate based authentication 
using Java client

Kyle -

What is the output of these commands?

riak-admin security print-users
riak-admin security print-sources

<a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.1.4/using/security/basics/#user-management">http://docs.basho.com/riak/kv/2.1.4/using/security/basics/#user-management</a>

Please note that setting up certificate authentication *requires* that you have 
set up SSL / TLS in Riak as well.

<a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.1.4/using/security/basics/#enabling-ssl">http://docs.basho.com/riak/kv/2.1.4/using/security/basics/#enabling-ssl</a>

The SSL certificates used by Riak *must* have their &quot;CN=&quot; section match the 
server's DNS-resolvable host name. This is an SSL/TLS requirement, not specific 
to Riak. Then, when you connect via the Java client, you must use the DNS name 
and not IP address. The client must have the appropriate public key information 
to validate the server cert as well (from Get a Cert).

--
Luke Bakken
Engineer
lbak...@basho.com

On Fri, Aug 26, 2016 at 3:34 PM, Nguyen, Kyle &lt;kyle.ngu...@philips.com&gt; wrote:
&gt; Update – Handshake was successfully after I opted out mutual
&gt; authentication option, client no longer sends its certificate to riak.
&gt; However, getting the following error after TLS is established:
&gt;
&gt;
&gt;
&gt; *** Finished
&gt;
&gt; verify_data:  { 149, 140, 49, 23, 238, 152, 45, 212, 158, 44, 189, 155
&gt; }
&gt;
&gt; ***
&gt;
&gt; %% Cached client session: [Session-12,
&gt; TLS_RSA_WITH_AES_128_CBC_SHA256]
&gt;
&gt; nioEventLoopGroup-2-4, WRITE: TLSv1.2 Application Data, length = 21
&gt;
&gt; nioEventLoopGroup-2-4, called closeOutbound()
&gt;
&gt; …..
&gt;
&gt; Caused by: com.basho.riak.client.core.NoNodesAvailableException
&gt;
&gt;         at
&gt; com.basho.riak.client.core.RiakCluster.retryOperation(RiakCluster.java
&gt; :469)
&gt;
&gt;         at
&gt; com.basho.riak.client.core.RiakCluster.access$1000(RiakCluster.java:48
&gt; )
&gt;
&gt;         at
&gt; com.basho.riak.client.core.RiakCluster$RetryTask.run(RiakCluster.java:
&gt; 554)
&gt;
&gt;         at
&gt; java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511
&gt; )
&gt;
&gt;         at java.util.concurrent.FutureTask.run(FutureTask.java:266)
&gt;
&gt;         at
&gt; java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.a
&gt; ccess$201(ScheduledThreadPoolExecutor.java:180)
&gt;
&gt;         at
&gt; java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.r
&gt; un(ScheduledThreadPoolExecutor.java:293)
&gt;
&gt;         at
&gt; java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.j
&gt; ava:1142)
&gt;
&gt;         at
&gt; java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.
&gt; java:617)
&gt;
&gt;         ... 1 more

________________________________
The information contained in this message may be confidential and legally 
protected under applicable law. The message is intended solely for the 
addressee(s). If you are not the intended recipient, you are hereby notified 
that any use, forwarding, dissemination, or reproduction of this message is 
strictly prohibited and may be unlawful. If you are not the intended recipient, 
please contact the sender by return e-mail and destroy all copies of the 
original message.
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17598.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17601">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17601">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17602.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17589.html">Need help with Riak-KV (2.1.4) certificate based authentic...</a></span> <span class="sender italic">Nguyen, Kyle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17590.html">Re: Need help with Riak-KV (2.1.4) certificate based ...</a></span> <span class="sender italic">Jonathan Joseph</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17594.html">RE: Need help with Riak-KV (2.1.4) certificate ba...</a></span> <span class="sender italic">Nguyen, Kyle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17598.html">Re: Need help with Riak-KV (2.1.4) certificat...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: Need help with Riak-KV (2.1.4) certif...</span> <span class="sender italic">Nguyen, Kyle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17602.html">Re: Need help with Riak-KV (2.1.4) c...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17603.html">RE: Need help with Riak-KV (2.1....</a></span> <span class="sender italic">Nguyen, Kyle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17604.html">Re: Need help with Riak-KV (...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17605.html">RE: Need help with Riak-KV (...</a></span> <span class="sender italic">Nguyen, Kyle</span></li>
<li class="icons-email"><span class="subject"><a href="msg17606.html">Re: Need help with Riak-KV (...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17607.html">RE: Need help with Riak-KV (...</a></span> <span class="sender italic">Nguyen, Kyle</span></li>
<li class="icons-email"><span class="subject"><a href="msg17608.html">Re: Need help with Riak-KV (...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li class="icons-email"><span class="subject"><a href="msg17617.html">RE: Need help with Riak-KV (...</a></span> <span class="sender italic">Nguyen, Kyle</span></li>
<li class="icons-email"><span class="subject"><a href="msg17618.html">Re: Need help with Riak-KV (...</a></span> <span class="sender italic">Luke Bakken</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: Need help with Riak-KV (2.1.4) certificate based authentication	using Java client">
<input type="hidden" name="msgid" value="62cd8e7f19274c9a81fd37917afaa03d@DB5PR9003MB0245.MGDPHG.emi.philips.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17601.html">
<input type="submit" value=" Nguyen, Kyle ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Need+help+with+Riak%5C-KV+%5C%282.1.4%5C%29+certificate+based+authentication%09using+Java+client%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17598.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17602.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">62cd8e7f19274c9a81fd37917afaa03d@DB5PR9003MB0245.MGDPHG.emi.philips.com</li>
</ul>
</div>
</body>
</html>
