<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Lowlevel Access to RiakCS objects?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#13950" id="c">
<link rel="index" href="mail2.html#13950" id="i">
<link rel="prev" href="msg13946.html" id="p">
<link rel="next" href="msg13952.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13950.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Lowlevel+Access+to+RiakCS+objects%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Lowlevel Access to RiakCS objects?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brian+Akins%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brian Akins</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140328" rel="nofollow">Fri, 28 Mar 2014 15:36:24 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I know of at least one case that uses riak cs for live HLS video at scale, 
which is somewhat similar to your use case, so this is not uncharted territory. 
While technically it's possible you can design and implement something more 
efficient than CS, that may be effort better spent in other areas of you 
application. JMO.</pre><pre>

Sent from my iPhone

&gt; On Mar 28, 2014, at 10:53 AM, Martin Alpers &lt;martin-alp...@web.de&gt; wrote:
&gt; 
&gt; Thanks for your answer, Tom.
&gt; 
&gt; I wanted to avoid the overhead of one segemting layers whose objects are 
&gt; segmented by yet another layer, but come to think of it, since Riak can store 
&gt; chunks up to 1MB in size, why not use Riak directly?
&gt; And I wanted to avoid additional complexity of additional code which 
&gt; basically mimics RiakCS.
&gt; 
&gt; But I see nothing to prevent me from doing all that segmentation stuff. 
&gt; Having slept a night over it, I think it is the way to go.
&gt; 
&gt; So thanks for the feedback, and for taking your time to read my question in 
&gt; the first place.
&gt; 
&gt; Best regards,
&gt; Martin
&gt; 
&gt;&gt; Hi Martin,
&gt;&gt; 
&gt;&gt; The short answer is no, Riak CS does not expose lower level access to the
&gt;&gt; blocks that are replicated to Riak.
&gt;&gt; 
&gt;&gt; That said, I'm curious, is anything preventing you from segmenting your
&gt;&gt; videos and writing a playlist + the segements to Riak CS? This would allow
&gt;&gt; you to seed varnish, while at the same time reducing the cost of a cache
&gt;&gt; miss to something reasonable for users.
&gt;&gt; 
&gt;&gt; Regards,
&gt;&gt; Tom
&gt;&gt; 
&gt;&gt;&gt; On Thu, Mar 27, 2014 at 3:05 PM, Martin Alpers &lt;martin-alp...@web.de&gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Hi all,
&gt;&gt;&gt; 
&gt;&gt;&gt; is there a canonical way to access RiakCS objects on a lower level? If I
&gt;&gt;&gt; remember correctly, RiakCS basically distributes larger objects into chunks
&gt;&gt;&gt; of one megabye each, and mapreduces them together on retrieval.
&gt;&gt;&gt; I would like to read those chunks for caching purposes.
&gt;&gt;&gt; 
&gt;&gt;&gt; For those interested in why I would wnat that:
&gt;&gt;&gt; A Riak/RiakCS cluster is the heart of our yet-to-be-implemented video
&gt;&gt;&gt; delivery cluster. A video management system will enable registered user to
&gt;&gt;&gt; upload their videos and the public can watch them.
&gt;&gt;&gt; In order to reduce intra-cluster traffic, we intent to cache the videos,
&gt;&gt;&gt; preferably in RAM.
&gt;&gt;&gt; We do not have any numbers on how often users would skip parts of the
&gt;&gt;&gt; video and generate range requests. If that case is really common, we would
&gt;&gt;&gt; prefer to serve them from cache as well, at least with Varnish and Squid,
&gt;&gt;&gt; some users would experience unacceptably long delays.
&gt;&gt;&gt; We looked out for a cache that could pipe through any request on an URL on
&gt;&gt;&gt; which caching is in progress and serve from cache afterwards.
&gt;&gt;&gt; 
&gt;&gt;&gt; The problem with both Varnish and Squid (and I suppose most caches,
&gt;&gt;&gt; because this behaviour seems reasonable in most cases) boils down to
&gt;&gt;&gt; treating a caching in progress as a cache hit.
&gt;&gt;&gt; My colleague started to write his own caching proxy in NodeJS, but using
&gt;&gt;&gt; asynchronous callbacks to check if a file exists, and to create it if it
&gt;&gt;&gt; does not, strikes me as somewhat couragous for production.
&gt;&gt;&gt; 
&gt;&gt;&gt; Now while we cannot risk to let some users wait for hundreds of megabytes
&gt;&gt;&gt; to be cached before delivery begins, and while we want at least to be
&gt;&gt;&gt; prepared to face many more range requests than the average &quot;wget was
&gt;&gt;&gt; interrupted&quot; case, it occurred to me thata few megabytes are not an issue
&gt;&gt;&gt; at multi-fast-ethernet speed.
&gt;&gt;&gt; So if we can split our files into objects small enough, we could code a
&gt;&gt;&gt; proxy that translates a range request into one or more normal requests for
&gt;&gt;&gt; those chunks, cuts off a certain offset of the first chunk if the range of
&gt;&gt;&gt; the orignal request began somewhere off the boundary, and reconcatenates
&gt;&gt;&gt; those chunks in correct order for delivery.
&gt;&gt;&gt; So the cache would never have to be bypassed, and the whole headache of
&gt;&gt;&gt; telling a complete hit from one &quot;in progress&quot; would be gone.
&gt;&gt;&gt; 
&gt;&gt;&gt; Since RiakCS has already split our files into small pieces, and somehow
&gt;&gt;&gt; tracks them, so could we possibly piggyback on that?
&gt;&gt;&gt; 
&gt;&gt;&gt; And by the way, I just came across the memory backend. I assume it is
&gt;&gt;&gt; distributed like the persistent ones, so it will not help me redice
&gt;&gt;&gt; internal traffic, right?
&gt;&gt;&gt; 
&gt;&gt;&gt; Any input is highly appreciated.
&gt;&gt;&gt; 
&gt;&gt;&gt; Best Regards
&gt;&gt;&gt; Martin
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Greetings, Martin Alpers
&gt;&gt;&gt; 
&gt;&gt;&gt; martin-alp...@web.de; Public Key ID: 10216CFB
&gt;&gt;&gt; Tel: +49 431/90885691; Mobile: +49 176/66185173
&gt;&gt;&gt; JID: martin.alp...@jabber.org
&gt;&gt;&gt; FYI: <a  rel="nofollow" href="http://apps.opendatacity.de/stasi-vs-nsa/">http://apps.opendatacity.de/stasi-vs-nsa/</a>
&gt;&gt;&gt; 
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; -- 
&gt; Greetings, Martin Alpers
&gt; 
&gt; martin-alp...@web.de; Public Key ID: 10216CFB
&gt; Tel: +49 431/90885691; Mobile: +49 176/66185173
&gt; JID: martin.alp...@jabber.org
&gt; FYI: <a  rel="nofollow" href="http://apps.opendatacity.de/stasi-vs-nsa/">http://apps.opendatacity.de/stasi-vs-nsa/</a>
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13946.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#13950">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#13950">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13952.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13940.html">Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Martin Alpers</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13943.html">Re: Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Tom Santero</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13946.html">Re: Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Martin Alpers</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Lowlevel Access to RiakCS objects?</span> <span class="sender italic">Brian Akins</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13952.html">Re: Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Martin Alpers</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Lowlevel Access to RiakCS objects?">
<input type="hidden" name="msgid" value="9190E783-5DD9-422A-AE36-A231A775632B@akins.org">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13950.html">
<input type="submit" value=" Brian Akins ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Lowlevel+Access+to+RiakCS+objects%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13946.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13952.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">9190E783-5DD9-422A-AE36-A231A775632B@akins.org</li>
</ul>
</div>
</body>
</html>
