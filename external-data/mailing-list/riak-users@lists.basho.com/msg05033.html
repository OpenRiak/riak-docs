<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: The power of the siblings....</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#05033" id="c">
<link rel="index" href="maillist.html#05033" id="i">
<link rel="prev" href="msg05027.html" id="p">
<link rel="next" href="msg05034.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05033.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+The+power+of+the+siblings....%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: The power of the siblings....</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mike+Oxford%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mike Oxford</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111004" rel="nofollow">Tue, 04 Oct 2011 12:43:06 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Good info; thanks for taking the time to respond!
I can use now/0 and shard on the mod to spread them out in a
sub-second spread.</pre><pre>

The only thing stopping me from doing so was that I'm lazy and
didn't want to have to write the correlation aspect over that many
buckets if I didn't have to.  Enough other things to do.  :)

Rock on.

-mox

On Tue, Oct 4, 2011 at 6:18 AM, Ryan Zezeski &lt;rzeze...@basho.com&gt; wrote:
&gt;
&gt;
&gt; On Tue, Oct 4, 2011 at 12:07 AM, Mike Oxford &lt;moxf...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt; SSDs are an option, sure.  I have one in my laptop; we have a bunch
&gt;&gt; of X25s on the way already for the servers.  Yes, they're good.  But
&gt;&gt; IOPS is not the core issue since the whole thing can sit in RAM
&gt;&gt; which is faster yet.  Disk-flush &quot;later&quot; isn't time critical.  Getting the
&gt;&gt; data into the buckets is.
&gt;
&gt; If you're writing to bitcask, which I assumed, then IOPS is very much an
&gt; issue.  If using bitcask and the I/O throughput is not there you are going
&gt; to have major bakcups on the vnode mailbox.  If there are any selective
&gt; receives in the vnode implementation things will really get nasty.
&gt; Are you saying you're using an in-memory backend for these keys?
&gt;
&gt;&gt;
&gt;&gt; 5k per second per key, over multiple concurrent writers (3-6 initially,
&gt;&gt; possibly more later.) Pre-cache+flush doesn't work because you
&gt;&gt; lose the interleave from the multiple writers.  NTP's resolution is only
&gt;&gt; &quot;so good.&quot; :)
&gt;
&gt; So for each key you have 3-6 concurrent writers averaging around 5kw/s.  How
&gt; many keys do you have like this?
&gt;
&gt;&gt;
&gt;&gt; The buckets can by cycled/sharded based on time, so slicing it into
&gt;&gt; &quot;5 second buckets of children&quot; is possible but this is just a
&gt;&gt; specialization
&gt;&gt; of the sharding ideology.
&gt;
&gt; I assume you mean that every 5s you would change the bucket name to avoid
&gt; overloading the same key space?  Yea, that would probably help but I still
&gt; think you'll have trouble with 5kw/s on a single key if using a durable
&gt; backend.
&gt;
&gt;&gt;
&gt;&gt; Point being: If it's basically used as an append-only-bucket (throw it
&gt;&gt; all in, sort it out later) how painful, underneath, is the child
&gt;&gt; resolution vs
&gt;&gt; the traditional &quot;get it, write it&quot; and then dealing with children ANYWAY
&gt;&gt; when you do get collisions (which, at 5kps, you ARE going to end up with.
&gt;
&gt; Yea, I agree either way you'll end up with children.  I would imagine you'd
&gt; have faster writes without the get/modify/put cycle but I've also never seen
&gt; anyone explode siblings that high on purpose so for all I know it will be
&gt; worse.  I'd be curious to see how Riak handles large sibling counts like
&gt; that but my gut says it won't do so well.
&gt;&gt;
&gt;&gt; This was touched on that it uses lists underneath.  Given high-end modern
&gt;&gt; hardware, (6 core CPUs, SSDs, etc.) ballpark, where would you guess the
&gt;&gt; red-line is?  10k children? 25k? 100k?  I won't hold anyone to it, but if
&gt;&gt; you say &quot;hell no, children are really expensive&quot; then I'll abort the idea
&gt;&gt; right here compared to &quot;they're pretty efficient underneath, it might be
&gt;&gt; doable.&quot;
&gt;
&gt; I think it's a bad idea, no matter what the practical limit is.  Siblings,
&gt; when possible, are to be avoided.  They only exist because when you write a
&gt; distributed application like Riak there are certain scenarios where they
&gt; can't be avoided.  You can certainly try to use them as you describe, but I
&gt; can tell you the code was not written with that in mind.  Like I said, I'd
&gt; be curious to see the results.
&gt;&gt;
&gt;&gt; I'm familiar with all the HA/clustering &quot;normal stuff&quot; but I'm curious
&gt;&gt; about Riak in particular because while Riak isn't built to be fast,
&gt;&gt; I'm curious about how much load you can push a ring through before
&gt;&gt; the underlying architecture stresses.
&gt;
&gt; In most cases we expect Riak to be I/O bound.  If you're not stressing I/O
&gt; then my first instinct would be to raise the ring size so that each node has
&gt; more partitions.  There is no hard and fast rule about how many partitions a
&gt; node should have but is dependent on the type of disk you have.  Obviously,
&gt; SSDs and the like will handle more.  We even have some people that run SSDs
&gt; RAID 0.
&gt; Also, since ring size is something that you can't change once a cluster has
&gt; been created you need to do some form of capacity planning ahead of time to
&gt; guess what will be the best node/partition ratio.  In 1.0 we did some work
&gt; to make better use of I/O without relying on the ring size (such as async
&gt; folding and whatnot) but I'm not sure on all the details and I'm hoping one
&gt; of my colleagues can help me out if I'm missing something.
&gt;&gt;
&gt;&gt; I know Yammer was putting some load on theirs; something around 4k
&gt;&gt; per sec over a few boxes but not to a single key.
&gt;
&gt; The key part of that sentence: _not to a single key_.  Writing to a single
&gt; key is serialized and therefore it can only move as fast as the vnodes that
&gt; map to it.
&gt;
&gt;&gt;
&gt;&gt; The big &quot;problem&quot; is that you have to have &quot;knowledge of the buckets&quot;
&gt;&gt; to later correlate them. Listing buckets is expensive.  I don't want to
&gt;&gt; hard-code bucket names into the application space if I can help it.
&gt;&gt; Writing &quot;list of buckets&quot; to another key simply moves the bottleneck
&gt;&gt; from one key to another.  Shifting buckets based on time works, but
&gt;&gt; it's obnoxious to have to correlate at 10 second intervals ....
&gt;&gt; 8640 buckets worth of obnoxious.  Every day.  Much easier to sort a
&gt;&gt; large dataset all at once from a single bucket.
&gt;
&gt; I'm not sure if you realize this but &quot;bucket&quot; is really just a namespace in
&gt; the key.  Said another way &lt;REAL KEY&gt;=&lt;BUCKET&gt;/&lt;KEY&gt;.  The &lt;REAL KEY&gt; is
&gt; what's hashed and determines the ring position.  There are no special
&gt; provisions for a bucket for the most part (one exception I can think of is
&gt; custom properties which get stored in the gossiped ring).  So while 8640
&gt; buckets seems wrong it really shouldn't make much of a difference to Riak.
&gt;  However, for places where we do treat buckets specially the code may not be
&gt; optimized for a large number of buckets.  Once again, something to try and
&gt; measure.
&gt;
&gt;&gt;
&gt;&gt; Assuming an entry size of 300 bytes that works out to around
&gt;&gt; ~130G per day, which will fit in RAM for the boxes.  Correlation can be
&gt;&gt; done on separate boxes later.  GigE cards bonded, etc.
&gt;&gt;
&gt;&gt; Removing the hardware limitations, where are the guesses on where
&gt;&gt; Riak itself will curl up in a corner, sob and not come out?
&gt;&gt;
&gt;&gt; If you had to do it, what suggestions would you all propose?
&gt;&gt; (Yes, I know I could just memcache with backup writes to
&gt;&gt; secondary/tertiary copies and flush later ... I'm interested in Riak.  :)
&gt;
&gt; I think, in general, writing to a single key 5k times a second will be
&gt; problematic.  Riak simply was not designed to modify a single key in a tight
&gt; loop. I'd love to be proven wrong.  I would either find a way to distribute
&gt; these writes across the key space better or batch them locally at the
&gt; application layer and send them in chunks that can be reconstructed later.
&gt; -Ryan

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05027.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#05033">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05033">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05034.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg04789.html">The power of the siblings....</a></span> <span class="sender italic">Mike Oxford</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04993.html">Re: The power of the siblings....</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04994.html">Re: The power of the siblings....</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg05013.html">Re: The power of the siblings....</a></span> <span class="sender italic">Mike Oxford</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05027.html">Re: The power of the siblings....</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: The power of the siblings....</span> <span class="sender italic">Mike Oxford</span></li>
<li class="icons-email"><span class="subject"><a href="msg05034.html">Re: The power of the siblings....</a></span> <span class="sender italic">Andy Skelton</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: The power of the siblings....">
<input type="hidden" name="msgid" value="CADB2Lbir70N57ct=Fc5qK=d2LWhVXaSn5hOLtnDPp4UkQJVCnQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05033.html">
<input type="submit" value=" Mike Oxford ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+The+power+of+the+siblings....%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05027.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05034.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CADB2Lbir70N57ct=Fc5qK=d2LWhVXaSn5hOLtnDPp4UkQJVCnQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
