<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: How do I improve Level DB performance?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07428" id="c">
<link rel="index" href="maillist.html#07428" id="i">
<link rel="prev" href="msg07425.html" id="p">
<link rel="next" href="msg07429.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07428.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+do+I+improve+Level+DB+performance%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: How do I improve Level DB performance?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22David+Smith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">David Smith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120510" rel="nofollow">Thu, 10 May 2012 15:01:52 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Thu, May 10, 2012 at 2:33 PM, Tim Haines &lt;tmhai...@gmail.com&gt; wrote:</pre><pre>

&gt; I've set up a new cluster, and have been doing pre-deployment benchmarks on
&gt; it. The benchmark I was running slowly sunk from 1000 TPS to 250 TPS over
&gt; the course of the single 8 hour benchmark doing 1 read+1 update using 1k
&gt; values.  I'm wondering if anyone might have suggestions on how I can improve
&gt; this.

Generally, this suggests that you are becoming seek-time bound. The
test config, as specified, will generate a pretty huge number of
not_founds which are (currently) crazy expensive w/ LevelDB,
particularly as the dataset grows.

Assuming you start with an empty database, a sample of this test will
generate operations like so:

Key 1000 - get -&gt; not_found
Key 1001 - update -&gt; not_found + write
Key 1002 - get -&gt; not_found
etc..

I.e. the leveldb cache never gets a chance to be useful, because
you're always writing new values and the cost of writing each new
value goes up, since you have to thrash the cache to determine if
you're ever seen the key that doesn't exist. :)

The root problem here is going to be the key_generator --
partitioned_sequential_int will just run through all the ints in order
and never revisit a key.


&gt;         {write_buffer_size, 16777216},
&gt;         {max_open_files, 100},
&gt;         {block_size, 262144},
&gt;         {cache_size, 168430088}

I strongly recommend not changing write_buffer_size; it can have
unexpected latency side-effects when LevelDB compaction occurs.
Smaller == more predictable.

Does that help?

D.

-- 
Dave Smith
VP, Engineering
Basho Technologies, Inc.
diz...@basho.com

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07425.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07428">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07428">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07429.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07425.html">How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: How do I improve Level DB performance?</span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07429.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li class="icons-email"><span class="subject"><a href="msg07431.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07434.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07436.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07437.html">Re: How do I improve Level DB performan...</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07438.html">Re: How do I improve Level DB perfo...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07439.html">Re: How do I improve Level DB p...</a></span> <span class="sender italic">Tim Haines</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07433.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Tim Haines</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07435.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Ryan Zezeski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07446.html">Re: How do I improve Level DB performance?</a></span> <span class="sender italic">Elias Levy</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: How do I improve Level DB performance?">
<input type="hidden" name="msgid" value="CAKiC6f=6Fm6ZwV-H-1Z7pU390GOrioy4ADv01xXkFKTnmRAMXg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07428.html">
<input type="submit" value=" David Smith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+do+I+improve+Level+DB+performance%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07425.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07429.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAKiC6f=6Fm6ZwV-H-1Z7pU390GOrioy4ADv01xXkFKTnmRAMXg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
