<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Overload Behavior</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07452" id="c">
<link rel="index" href="maillist.html#07452" id="i">
<link rel="prev" href="msg07451.html" id="p">
<link rel="next" href="msg07453.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07452.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Overload+Behavior%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Overload Behavior</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+O%27Connor%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean O'Connor</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120514" rel="nofollow">Mon, 14 May 2012 19:27:19 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I've spent a while trying to write a script to replicate this problem but so 
far I've been unsuccessful.  I'll try to keep an eye out to see if I can spot 
patterns for when this happens but otherwise I'll probably need to drop this 
problem for a little while.  </pre><pre>

If anybody has ideas on additional things I can try to check to isolate the 
cause of these 400 errors I'd be happy to give it a try.  Just in case it 
sparks ideas for possible causes below is a bit more information about our test 
suite/environment: 
Heavy use of leveldb storage backend and secondary index queries.
Both javascript and erlang map reduce functions are used.
The error has been observed with Riak 1.1.2 running on both OS X 10.7.3 
installed via homebrew and on ubuntu 11.04 installed via the package based chef 
cookbook.
The OS X system has a single riak instance running, the linux based system is a 
3 node cluster running on 3 EC2 instances.
The app.config being used can be found at 
<a  rel="nofollow" href="https://gist.github.com/83b59b51b94b38e451b0">https://gist.github.com/83b59b51b94b38e451b0</a>

Thanks again for the quick response!


-- 
Sean O'Connor
Co-Founder/CTO

FocusLab (<a  rel="nofollow" href="http://www.focuslab.io">http://www.focuslab.io</a>)
(845)669-0883


On Monday, May 14, 2012 at 7:56 PM, Sean O'Connor wrote:

&gt; Interesting.  I am running Riak 1.1.2 and I am making the requests via 
&gt; version 1.4.0 of the python client using the HTTP transport class. I'll see 
&gt; if I can create a simple script that replicates the problem and post it to 
&gt; the list sometime later tonight or tomorrow.
&gt; 
&gt; -- 
&gt; Sean O'Connor
&gt; Co-Founder/CTO
&gt; 
&gt; FocusLab (<a  rel="nofollow" href="http://www.focuslab.io">http://www.focuslab.io</a>)
&gt; (845)669-0883
&gt; 
&gt; 
&gt; On Monday, May 14, 2012 at 7:48 PM, Sean Cribbs wrote:
&gt; 
&gt; &gt; Hi Sean,
&gt; &gt; 
&gt; &gt; Are you running your test suite against 1.1.x? We have seen 400 errors in 
&gt; &gt; the past where the client in a keep-alive connection emitted additional 
&gt; &gt; CRLFs or other whitespace beyond the ones required for the request. The 
&gt; &gt; next time a request was made, the 400 error was already on the wire because 
&gt; &gt; the HTTP parser failed to recognize the (non-existent) request in the 
&gt; &gt; additional whitespace. This error should be fixed already in 1.1.x. 
&gt; &gt; 
&gt; &gt; On Mon, May 14, 2012 at 5:45 PM, Sean O'Connor &lt;s...@focuslab.io 
&gt; &gt; (<a  rel="nofollow" href="mailto:s...@focuslab.io">mailto:s...@focuslab.io</a>)&gt; wrote:
&gt; &gt; &gt; Hello, 
&gt; &gt; &gt; 
&gt; &gt; &gt; I've been seeing some strange behavior from Riak and any help or feedback 
&gt; &gt; &gt; would be very welcome.
&gt; &gt; &gt; 
&gt; &gt; &gt; In particular, we've been seeing pseudo-radom 400 errors from Riak when 
&gt; &gt; &gt; we run our test suite.  Our test suite hits riak pretty hard to test 
&gt; &gt; &gt; various queries and situations in our app and the errors seem to happen a 
&gt; &gt; &gt; few seconds after the CPUs on the testing machine get saturated. I say 
&gt; &gt; &gt; psuodo-random as the errors tends to happen in a particularly riak heavy 
&gt; &gt; &gt; portion of our test suite but the specific call to riak that errors is 
&gt; &gt; &gt; often different (reads, writes, map/reduce jobs, 2i queries).  The thing 
&gt; &gt; &gt; that is really baffling about these errors is there doesn't seem to be 
&gt; &gt; &gt; any information attached other than the 400 message and nothing shows up 
&gt; &gt; &gt; in any of the riak logs. 
&gt; &gt; &gt; 
&gt; &gt; &gt; If we introduce a 2 second delay between tests in our test suite, the 
&gt; &gt; &gt; problem goes away but obviously slows down our test suite quite a bit.  
&gt; &gt; &gt; Aside from that, I am concerned about this potentially happening in our 
&gt; &gt; &gt; production cluster. 
&gt; &gt; &gt; 
&gt; &gt; &gt; Is this more or less the expected behavior of Riak when it gets 
&gt; &gt; &gt; overwhelmed or does it sound like there is something that should be 
&gt; &gt; &gt; investigated further here?  I suspect that I can create a script to 
&gt; &gt; &gt; replicate the problem but if this is somewhat expected then I won't waste 
&gt; &gt; &gt; the time writing it. 
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks! 
&gt; &gt; &gt; 
&gt; &gt; &gt; -- 
&gt; &gt; &gt; Sean O'Connor
&gt; &gt; &gt; Co-Founder/CTO
&gt; &gt; &gt; 
&gt; &gt; &gt; FocusLab (<a  rel="nofollow" href="http://www.focuslab.io">http://www.focuslab.io</a>)
&gt; &gt; &gt; (845)669-0883 (tel:%28845%29669-0883) 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt; &gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; Sean Cribbs &lt;s...@basho.com (<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>)&gt;
&gt; &gt; Software Engineer
&gt; &gt; Basho Technologies, Inc.
&gt; &gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt; &gt; 
&gt; 

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07451.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07452">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07452">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07453.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07449.html">Riak Overload Behavior</a></span> <span class="sender italic">Sean O'Connor</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07450.html">Re: Riak Overload Behavior</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07451.html">Re: Riak Overload Behavior</a></span> <span class="sender italic">Sean O'Connor</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Overload Behavior</span> <span class="sender italic">Sean O'Connor</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Overload Behavior">
<input type="hidden" name="msgid" value="294D9FCD0CD6433EBD1CF0F8925C1D26@focuslab.io">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07452.html">
<input type="submit" value=" Sean O'Connor ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Overload+Behavior%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07451.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07453.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">294D9FCD0CD6433EBD1CF0F8925C1D26@focuslab.io</li>
</ul>
</div>
</body>
</html>
