<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: TCP recv timeout and handoffs almost all the time</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd13.html#11622" id="c">
<link rel="index" href="mail13.html#11622" id="i">
<link rel="prev" href="msg11620.html" id="p">
<link rel="next" href="msg11624.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11622.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+TCP+recv+timeout+and+handoffs+almost+all+the+time%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: TCP recv timeout and handoffs almost all the time</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Christian+Dahlqvist%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Christian Dahlqvist</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130719" rel="nofollow">Fri, 19 Jul 2013 00:51:28 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Simon,

If you have objects that can be a s big as 15MB, it is probably wise to 
increase the size of +zdbbl in order to avoid filling up buffers when these 
large objects need to be transferred between nodes. What an appropriate level 
is depends a lot on the size distribution of your data and your access 
patterns, so I would recommend benchmarking to find a suitable value.</pre><pre>

Erlang also has a default process limit of 32768 (at least in R15B01), which 
may be what you are hitting. You can override this to 256k by adding the 
following line to the vm.args file:

    +P 262144

Best regards,

Christian



On 19 Jul 2013, at 08:24, Simon Effenberg &lt;seffenb...@team.mobile.de&gt; wrote:

&gt; The +zdbbl parameter helped a lot but the hinted handoffs didn't
&gt; disappear completely. I have no more busy dist port errors in the
&gt; _console.log_ (why aren't they in the error.log? it looks for me like a
&gt; serious problem you have.. at least our cluster was behaving not that
&gt; nice).
&gt; 
&gt; I'll try to increase the buffer size to a higher value because my
&gt; suggestion is that also the objects send from one to another are also
&gt; stored therein and we have sometimes objects which are up to 15MB.
&gt; 
&gt; But I saw now also some crashes in the last 6 hours on only two machines
&gt; complaining about too many processes
&gt; 
&gt; ----------------
&gt; console.log
&gt; 2013-07-19 02:04:21.962 UTC [error] &lt;0.12813.29&gt; CRASH REPORT Process 
&gt; &lt;0.12813.29&gt; with 15 neighbours exited with reason: {system_limit
&gt; 
&gt; crash.log
&gt; 2013-07-19 02:04:21 UTC =ERROR REPORT====
&gt; Too many processes
&gt; ----------------
&gt; 
&gt; the process has a process limit of 95142. So I will increase it now but I 
&gt; never saw any information about such problems on the linux tuning page. Am I 
&gt; missing something?
&gt; 
&gt; Cheers
&gt; Simon
&gt; 
&gt; 
&gt; On Thu, 18 Jul 2013 19:34:18 +0100
&gt; Guido Medina &lt;guido.med...@temetra.com&gt; wrote:
&gt; 
&gt;&gt; If what you are describing is happening for 1.4, type riak-admin diag 
&gt;&gt; and see the new recommended kernel parameters, also, on vm.args 
&gt;&gt; uncomment the +zdbbl 32768 parameter, since what you are describing is 
&gt;&gt; similar to what happened to us when we upgraded to 1.4.
&gt;&gt; 
&gt;&gt; HTH,
&gt;&gt; 
&gt;&gt; Guido.
&gt;&gt; 
&gt;&gt; On 18/07/13 19:21, Simon Effenberg wrote:
&gt;&gt;&gt; Hi @list,
&gt;&gt;&gt; 
&gt;&gt;&gt; I see sometimes logs talking about &quot;hinted_handoff transfer of .. failed 
&gt;&gt;&gt; because of TCP recv timeout&quot;.
&gt;&gt;&gt; Also riak-admin transfers shows me many handoffs (is it possible to give 
&gt;&gt;&gt; some insights about &quot;how many&quot; handoffs happened through &quot;riak-admin 
&gt;&gt;&gt; status&quot;?).
&gt;&gt;&gt; 
&gt;&gt;&gt; - Is it a normal behavior to have up to 30 handoffs from/to different nodes?
&gt;&gt;&gt; - How can I get down to the problem with the TCP recv timeout? I'm not sure 
&gt;&gt;&gt; if this is a network problem or if the other node is too slow. The load is 
&gt;&gt;&gt; ok on the machines (some IOwait but not 100%). Maybe interfering with AAE?
&gt;&gt;&gt; 
&gt;&gt;&gt; Here the log information about the TCP recv timeout. But that is not that 
&gt;&gt;&gt; often but handoffs happens really often:
&gt;&gt;&gt; 
&gt;&gt;&gt; 2013-07-18 16:22:05.654 UTC [error] 
&gt;&gt;&gt; &lt;0.28933.14&gt;@riak_core_handoff_sender:start_fold:216 hinted_handoff 
&gt;&gt;&gt; transfer of riak_kv_vnode from 'riak@10.46.109.207' 
&gt;&gt;&gt; 1118962191081472546749696200048404186924073353216 to 'riak@10.46.109.205' 
&gt;&gt;&gt; 1118962191081472546749696200048404186924073353216 failed because of TCP 
&gt;&gt;&gt; recv timeout
&gt;&gt;&gt; 2013-07-18 16:22:05.673 UTC [error] 
&gt;&gt;&gt; &lt;0.202.0&gt;@riak_core_handoff_manager:handle_info:282 An outbound handoff of 
&gt;&gt;&gt; partition riak_kv_vnode 1118962191081472546749696200048404186924073353216 
&gt;&gt;&gt; was terminated for reason: {shutdown,timeout}
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks in advance
&gt;&gt;&gt; Simon
&gt;&gt;&gt; 
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; 
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; -- 
&gt; Simon Effenberg | Site Ops Engineer | mobile.international GmbH
&gt; Fon:     + 49-(0)30-8109 - 7173
&gt; Fax:     + 49-(0)30-8109 - 7131
&gt; 
&gt; Mail:     seffenb...@team.mobile.de
&gt; Web:    www.mobile.de
&gt; 
&gt; Marktplatz 1 | 14532 Europarc Dreilinden | Germany
&gt; 
&gt; 
&gt; Geschäftsführer: Malte Krüger
&gt; HRB Nr.: 18517 P, Amtsgericht Potsdam
&gt; Sitz der Gesellschaft: Kleinmachnow 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11620.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd13.html#11622">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail13.html#11622">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11624.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11603.html">TCP recv timeout and handoffs almost all the time</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11605.html">Re: TCP recv timeout and handoffs almost all the ...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11607.html">Re: TCP recv timeout and handoffs almost all ...</a></span> <span class="sender italic">Simon Effenberg</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11606.html">Re: TCP recv timeout and handoffs almost all the ...</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11609.html">Re: TCP recv timeout and handoffs almost all ...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11610.html">Re: TCP recv timeout and handoffs almost ...</a></span> <span class="sender italic">Guido Medina</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11619.html">Re: TCP recv timeout and handoffs almost all ...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11620.html">Re: TCP recv timeout and handoffs almost ...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: TCP recv timeout and handoffs almost ...</span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11624.html">Re: TCP recv timeout and handoffs alm...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11627.html">Re: TCP recv timeout and handoff...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11633.html">Re: TCP recv timeout and han...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11628.html">Re: TCP recv timeout and...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email"><span class="subject"><a href="msg11654.html">Re: TCP recv timeout and...</a></span> <span class="sender italic">Simon Effenberg</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: TCP recv timeout and handoffs almost all the time">
<input type="hidden" name="msgid" value="76FC9A57-1136-4FF4-AECC-E06657DB1D6F@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11622.html">
<input type="submit" value=" Christian Dahlqvist ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+TCP+recv+timeout+and+handoffs+almost+all+the+time%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11620.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11624.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">76FC9A57-1136-4FF4-AECC-E06657DB1D6F@basho.com</li>
</ul>
</div>
</body>
</html>
