<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Receiving ulimit warning despite setting it</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#11092" id="c">
<link rel="index" href="maillist.html#11092" id="i">
<link rel="prev" href="msg11091.html" id="p">
<link rel="next" href="msg11093.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11092.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Receiving+ulimit+warning+despite+setting+it%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Receiving ulimit warning despite setting it</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+E.+Vincent%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John E. Vincent</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130516" rel="nofollow">Thu, 16 May 2013 07:11:35 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>As an opposing viewpoint, I'd argue that it's NOT the requirement of Riak
to go automatically changing things outside of its domain. Ulimits and
tunables in the same class are not things that should be blindly tweaked by
an incoming package. These are things the system administrator needs to be
aware of and scope for the system in use.</pre><pre>

I appreciate the idea and desire that Riak work out of the box but I'd
argue it already does. What DOESN'T work is an untuned Riak at load. And it
shouldn't. There are some things that need to be an informed decision. Is
the default ulimit in most distros too low? Absolutely but it's in the
domain of the OS/Distro provider and not a third-party package to tweak
possible dangerous knobs.

The only sane default here is to use what the distro sets and provide
information for users on how to change it.



On Thu, May 16, 2013 at 9:48 AM, Jared Morrow &lt;ja...@basho.com&gt; wrote:

&gt; Toby,
&gt;
&gt; It seems to me like it would be nice if Riak &quot;just worked&quot; when you
&gt;&gt; installed it, instead of requiring each and every user to have to track
&gt;&gt; something down in the docs and then configure it in their chef/puppet
&gt;&gt; manifests. Don't you agree that is a desirable feature of good software?
&gt;&gt; (ie. Sensible defaults)
&gt;&gt;
&gt;
&gt; That's a good point, and like I said above, I was willing to accept that I
&gt; was the only one with those views.
&gt;
&gt; I filed an issue for my backlog
&gt; <a  rel="nofollow" href="https://github.com/basho/node_package/issues/55">https://github.com/basho/node_package/issues/55</a> to take a look at that.
&gt;  It is probably too late for our next major release to get in, but I do
&gt; indeed want to make this easier on everyone, so thanks for the feedback.
&gt;
&gt; -Jared
&gt;
&gt;
&gt; On Wed, May 15, 2013 at 11:44 PM, Toby Corkindale &lt;
&gt; toby.corkind...@strategicdata.com.au&gt; wrote:
&gt;
&gt;&gt; On 16/05/13 15:38, Jared Morrow wrote:
&gt;&gt;
&gt;&gt;&gt; I've considered packaging separate files for configuring the limit
&gt;&gt;&gt; for people, but the user in me always felt like that was something
&gt;&gt;&gt; the sysadmin should have a say in. I rather dislike packages that
&gt;&gt;&gt; make system changes without my knowledge or consent.  Maybe that is
&gt;&gt;&gt; just me?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; It's not making a system change though -- it's only adjusting things for
&gt;&gt; the riak/riakcs user.
&gt;&gt;
&gt;&gt; Can you think of any situation where a user would WANT to stick to the
&gt;&gt; default 1024 file-handle limit and yet be running Riak?
&gt;&gt;
&gt;&gt; Now think of how often that situation occurs, compared to the number of
&gt;&gt; times where the user DOES want the &quot;good&quot; number setup, and would just like
&gt;&gt; to install Riak and then get on with their work?
&gt;&gt;
&gt;&gt; It seems to me like it would be nice if Riak &quot;just worked&quot; when you
&gt;&gt; installed it, instead of requiring each and every user to have to track
&gt;&gt; something down in the docs and then configure it in their chef/puppet
&gt;&gt; manifests. Don't you agree that is a desirable feature of good software?
&gt;&gt; (ie. Sensible defaults)
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt; Toby
&gt;&gt;
&gt;&gt;
&gt;&gt;  On May 15, 2013, at 10:54 PM, Toby Corkindale
&gt;&gt;&gt; &lt;toby.corkindale@**strategicdata.com.au&lt;toby.corkind...@strategicdata.com.au&gt;&gt;
&gt;&gt;&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;  On 16/05/13 14:39, Toby Corkindale wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On 16/05/13 14:24, Jared Morrow wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Well the riak-cs / riak / stanchion scripts all drop privileges
&gt;&gt;&gt;&gt;&gt;&gt; using sudo.  On RHEL/Centos this sudo exec carries the settings
&gt;&gt;&gt;&gt;&gt;&gt; from the calling user (in the case of init.d, root) so things
&gt;&gt;&gt;&gt;&gt;&gt; are fine there.  On Ubuntu/Debian that does not always work.
&gt;&gt;&gt;&gt;&gt;&gt; So if you set the ulimit for the root user, it might not
&gt;&gt;&gt;&gt;&gt;&gt; propagate through to the riak-cs / riak / stanchion users.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; So to change that, you should try to change it in
&gt;&gt;&gt;&gt;&gt;&gt; /etc/security/limits.conf.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; My understanding is that only sessions opened through PAM will
&gt;&gt;&gt;&gt;&gt; be effected by the limits.d/* config files. ie. Not daemon
&gt;&gt;&gt;&gt;&gt; processes. (I've checked this anyway with the following
&gt;&gt;&gt;&gt;&gt; /etc/security/limits.d/riakcs.**conf: riak-cs        hard    nofile
&gt;&gt;&gt;&gt;&gt; 32002 riak-cs        soft    nofile        32001 )
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; As noted previously, this problem was not occurring on the
&gt;&gt;&gt;&gt;&gt; current Ubuntu LTS nodes; just the Debian Squeeze ones. Which
&gt;&gt;&gt;&gt;&gt; makes it particularly odd.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks for your help so far; I'll continue to investigate and
&gt;&gt;&gt;&gt;&gt; report back if I find a solution.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I realised that the Riak CS user was called &quot;riakcs&quot; and not
&gt;&gt;&gt;&gt; &quot;riak-cs&quot;. Once I changed that in the limits.d/riakcs.conf file,
&gt;&gt;&gt;&gt; riakcs started working without the file warning.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I also added in a line for the regular &quot;riak&quot; user while I was
&gt;&gt;&gt;&gt; there.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; May I suggest you add this to the debian/ubuntu packages by
&gt;&gt;&gt;&gt; default? (ie. a file in /etc/security/limits.d/ )
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers, Toby
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; ______________________________**_________________ riak-users mailing
&gt;&gt;&gt;&gt; list riak-users@lists.basho.com
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com">http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com</a>&lt;<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11091.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#11092">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#11092">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11093.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11082.html">Re: Receiving ulimit warning despite setting it</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11083.html">Re: Receiving ulimit warning despite setting it</a></span> <span class="sender italic">Toby Corkindale</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11084.html">Re: Receiving ulimit warning despite setting it</a></span> <span class="sender italic">Richard K Miller</span></li>
<li class="icons-email"><span class="subject"><a href="msg11085.html">Re: Receiving ulimit warning despite setting it</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11086.html">Re: Receiving ulimit warning despite setting it</a></span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11087.html">Re: Receiving ulimit warning despite setting it</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11088.html">Re: Receiving ulimit warning despite setting...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11089.html">Re: Receiving ulimit warning despite set...</a></span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11090.html">Re: Receiving ulimit warning despit...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11091.html">Re: Receiving ulimit warning de...</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Receiving ulimit warning de...</span> <span class="sender italic">John E. Vincent</span></li>
<li class="icons-email"><span class="subject"><a href="msg11093.html">Re: Receiving ulimit warning de...</a></span> <span class="sender italic">Hector Castro</span></li>
<li class="icons-email"><span class="subject"><a href="msg11094.html">Re: Receiving ulimit warning de...</a></span> <span class="sender italic">John E. Vincent</span></li>
<li class="icons-email"><span class="subject"><a href="msg11095.html">Re: Receiving ulimit warning de...</a></span> <span class="sender italic">Jared Morrow</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Receiving ulimit warning despite setting it">
<input type="hidden" name="msgid" value="CAPy8ofJGK-C3xbEFRjC=DAe2wOnZ7-guZaHUmyP2S7YyOm_5aQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11092.html">
<input type="submit" value=" John E. Vincent ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Receiving+ulimit+warning+despite+setting+it%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11091.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11093.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAPy8ofJGK-C3xbEFRjC=DAe2wOnZ7-guZaHUmyP2S7YyOm_5aQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
