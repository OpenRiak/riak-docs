<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: last_write_wins</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd4.html#13539" id="c">
<link rel="index" href="mail4.html#13539" id="i">
<link rel="prev" href="msg13538.html" id="p">
<link rel="next" href="msg13540.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13539.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+last_write_wins%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: last_write_wins</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Russell+Brown%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Russell Brown</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140130" rel="nofollow">Thu, 30 Jan 2014 04:50:39 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
On 30 Jan 2014, at 10:58, Guido Medina &lt;guido.med...@temetra.com&gt; wrote:</pre><pre>

&gt; Hi,
&gt; 
&gt; Now I'm curious too, according to 
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/advanced/configs/configuration-files/">http://docs.basho.com/riak/latest/ops/advanced/configs/configuration-files/</a> 
&gt; the default value for Erlang property last_write_wins is false, now, if 95% 
&gt; of the buckets/keys have no siblings (or conflict resolution), does that mean 
&gt; that for such buckets last_write_wins is set to true, I'm wondering what's 
&gt; the effect (if any) if allow_multi on a bucket is false.
&gt; 
&gt; In other words; I could assume that:
&gt; If allow_multi is true then last_write_wins will be ignored 'cause vclock is 
&gt; needed for conflict resolution?
&gt; if allow_multi is false then last_write_wins is true?
They’re independant settings, but allow_mult=true + lww=true makes no sense (in 
reality, in the code, I’m pretty sure the lww=true will be applied.)

allow_mult=false+lww=false means at each vnode there is a read-before-write, 
and casually dominated values are dropped, while siblings values are made, but 
before we write to disk (or return to the user on get) we pick the sibling with 
the highest timestamp. This means that you get _one_ of the causally concurrent 
values, the one with the largest timestamp.

allow_mult=false+lww=false means that at the coordinating vnode we just 
increment whatever vclock the put has (probably none, right?) and write it to 
disk (no read of the local value first) and down stream at the replicas, the 
same thing, just store it. I need to check, but on a get, if there are 
siblings, just pick the highest timestamp.

I really think, for riak, 90% of the time, allow_mult=true is your best choice. 
John Daily did a truly exhaustive set of blog posts on this 
<a  rel="nofollow" href="http://basho.com/understanding-riaks-configurable-behaviors-part-1/">http://basho.com/understanding-riaks-configurable-behaviors-part-1/</a> I highly 
recommend it. If you data is always overwrite maybe LWW makes sense for you. If 
it is write once, read ever after LWW is perfect.

Cheers

Russell
&gt; Correct me if I'm wrong,
&gt; Again, we have a very similar scenarios, where we create/modify keys and we 
&gt; are certain we have the latest version so for us last_write_wins...
&gt; Regards,
&gt; 
&gt; Guido.
&gt; 
&gt; On 30/01/14 10:46, Russell Brown wrote:
&gt;&gt; 
&gt;&gt; On 30 Jan 2014, at 10:37, Edgar Veiga &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt; 
&gt;&gt;&gt; Also,
&gt;&gt;&gt; 
&gt;&gt;&gt; Using last_write_wins = true, do I need to always send the vclock while on 
&gt;&gt;&gt; a PUT request? In the official documention it says that riak will look only 
&gt;&gt;&gt; at the timestamp of the requests.
&gt;&gt; 
&gt;&gt; Ok, from what you’ve said it sounds like you are always wanting to replace 
&gt;&gt; what is at a key with the new information you are putting. If that is the 
&gt;&gt; case, then you have the perfect use case for LWW=true. And indeed, you do 
&gt;&gt; not need to pass a vclock with your put request. And it sounds like there is 
&gt;&gt; no need for you to fetch-before-put since that is only to get context 
&gt;&gt; /resolve siblings. Curious about your use case if you can share more.
&gt;&gt; 
&gt;&gt; Cheers
&gt;&gt; 
&gt;&gt; Russell
&gt;&gt; 
&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; Best regards,
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On 29 January 2014 10:29, Edgar Veiga &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt;&gt; Hi Russel,
&gt;&gt;&gt; 
&gt;&gt;&gt; No, it doesn't depend. It's always a new value.
&gt;&gt;&gt; 
&gt;&gt;&gt; Best regards
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; On 29 January 2014 10:10, Russell Brown &lt;russell.br...@me.com&gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; On 29 Jan 2014, at 09:57, Edgar Veiga &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; tl;dr
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; If I guarantee that the same key is only written with a 5 second interval, 
&gt;&gt;&gt;&gt; is last_write_wins=true profitable?
&gt;&gt;&gt; 
&gt;&gt;&gt; It depends. Does the value you write depend in anyway on the value you 
&gt;&gt;&gt; read, or is it always that you are just getting a totally new value that 
&gt;&gt;&gt; replaces what is in Riak (regardless what is in Riak)?
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On 27 January 2014 23:25, Edgar Veiga &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt; Hi there everyone!
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I would like to know, if my current application is a good use case to set 
&gt;&gt;&gt;&gt; last_write_wins to true.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Basically I have a cluster of node.js workers reading and writing to riak. 
&gt;&gt;&gt;&gt; Each node.js worker is responsible for a set of keys, so I can guarantee 
&gt;&gt;&gt;&gt; some kind of non distributed cache... 
&gt;&gt;&gt;&gt; The real deal here is that the writing operation is not run evertime an 
&gt;&gt;&gt;&gt; object is changed but each 5 seconds in a &quot;batch insertion/update&quot; style. 
&gt;&gt;&gt;&gt; This brings the guarantee that the same object cannot be write to riak at 
&gt;&gt;&gt;&gt; the same time, not event at the same seconds, there's always a 5 second 
&gt;&gt;&gt;&gt; window between each insertion/update.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; That said, is it profitable to me if I set last_write_wins to true? I've 
&gt;&gt;&gt;&gt; been facing some massive writting delays under high loads and it would be 
&gt;&gt;&gt;&gt; nice if I have some kind of way to tune riak.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Thanks a lot and keep up the good work!
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13538.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd4.html#13539">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail4.html#13539">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13540.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13503.html">last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13522.html">Re: last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13523.html">Re: last_write_wins</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13524.html">Re: last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13536.html">Re: last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13537.html">Re: last_write_wins</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13538.html">Re: last_write_wins</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: last_write_wins</span> <span class="sender italic">Russell Brown</span></li>
<li class="icons-email"><span class="subject"><a href="msg13540.html">Re: last_write_wins</a></span> <span class="sender italic">Guido Medina</span></li>
<li class="icons-email"><span class="subject"><a href="msg13553.html">Re: last_write_wins</a></span> <span class="sender italic">John Daily</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13541.html">Re: last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13544.html">Re: last_write_wins</a></span> <span class="sender italic">Jason Campbell</span></li>
<li class="icons-email"><span class="subject"><a href="msg13545.html">Re: last_write_wins</a></span> <span class="sender italic">Eric Redmond</span></li>
<li class="icons-email"><span class="subject"><a href="msg13546.html">Re: last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg13547.html">Re: last_write_wins</a></span> <span class="sender italic">Eric Redmond</span></li>
<li class="icons-email"><span class="subject"><a href="msg13548.html">Re: last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg13549.html">Re: last_write_wins</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg13550.html">Re: last_write_wins</a></span> <span class="sender italic">Jason Campbell</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: last_write_wins">
<input type="hidden" name="msgid" value="63C39CC5-8A52-44E9-8B4D-0F5564833075@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13539.html">
<input type="submit" value=" Russell Brown ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+last_write_wins%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13538.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13540.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">63C39CC5-8A52-44E9-8B4D-0F5564833075@me.com</li>
</ul>
</div>
</body>
</html>
