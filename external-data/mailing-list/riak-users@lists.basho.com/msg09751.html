<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak and host names</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#09751" id="c">
<link rel="index" href="mail2.html#09751" id="i">
<link rel="prev" href="msg09749.html" id="p">
<link rel="next" href="msg09752.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09751.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+and+host+names%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak and host names</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Charlie+Voiselle%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Charlie Voiselle</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130107" rel="nofollow">Mon, 07 Jan 2013 15:03:11 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Matt:

You would need to use (or implement your own) DNS service that you could 
programmatically access--Route 53 has an API that you could use to create DNS 
entries that point to the internal addresses of your nodes.   In very carefully 
re-reading the thread Deepak mentions, one problem that will occur is that each 
node needs to be able to resolve the other nodes by name also.  The only way 
for this to occur reasonably, would be to register the internal addresses with 
a single point that they share.  Some examples of free services that you might 
use for this are DynDns[1], DNSDynamic[2], or DNS-O-Matic[3].   I have also 
seen some projects floating around the web that might enable you to create a 
self-hosted dynamic DNS like opendyn[4] and GnuDIP[5]; however, I have had no 
occasion to use something like this in my own environment.   Some additional 
discussion about creating your own Dynamic DNS server is also at 
<a  rel="nofollow" href="http://unix.stackexchange.com/questions/29049/how-to-create-a-custom-dynamic-dns-solution">http://unix.stackexchange.com/questions/29049/how-to-create-a-custom-dynamic-dns-solution</a></pre><pre>

Hope this helps!
Charlie

[1] <a  rel="nofollow" href="http://www.dyn.com">http://www.dyn.com</a>
[2] <a  rel="nofollow" href="http://www.dnsdynamic.org">http://www.dnsdynamic.org</a>
[3] <a  rel="nofollow" href="http://www.dnsomatic.com">http://www.dnsomatic.com</a>
[4] <a  rel="nofollow" href="http://code.google.com/p/opendyn/">http://code.google.com/p/opendyn/</a>
[5] <a  rel="nofollow" href="http://gnudip2.sourceforge.net/">http://gnudip2.sourceforge.net/</a>

On Jan 7, 2013, at 5:00 PM, Matt Black &lt;matt.bl...@jbadigital.com&gt; wrote:

&gt; Thanks for this Charlie.
&gt; 
&gt; I'm running a production Riak cluster on AWS which runs constantly, and I've 
&gt; been wondering how I might be able to easliy stop and start AWS nodes for a 
&gt; testing and benchmarking cluster (to save on cost).
&gt; 
&gt; By using the 'riaknode1.priv' hostname method you describe, would I be able 
&gt; to stop and then restart a whole cluster of nodes at once? (As described by 
&gt; Deepak, AWS assigns new IPs when a VM starts).
&gt; 
&gt; Thanks
&gt; Matt
&gt; 
&gt; 
&gt; On 8 January 2013 01:31, Charlie Voiselle &lt;cvoise...@basho.com&gt; wrote:
&gt; Deepak:
&gt; 
&gt; When you name a node in app.config with -name it has to have a '.' in it,  
&gt; like r...@hostname.net  As you have surmised, you can get around that if you 
&gt; use the -sname argument instead. 
&gt; 
&gt; They have to be done consistently.  In your example, had you used the -sname 
&gt; argument, `riak@riaknode1` would work.  Making a host entry `riaknode1.priv` 
&gt; that points to the local address would work with the -name argument.
&gt; 
&gt; The inportant thing about -name and -sname is that they can't mix within a 
&gt; cluster.
&gt; 
&gt; Cluster replace is designed to replace a node with a new one and transfer all 
&gt; the partitions. You can cheat and use it to rename a node though.  
&gt; 
&gt; The process to do this would look like the following:
&gt; 
&gt; Stop the node to rename with `riak stop`
&gt; Mark it 'down' from another node in the cluster using `riak-admin down «old 
&gt; nodename».
&gt; Rename the node in vm.args.
&gt; Delete the ring directory.
&gt; Start the node with `riak start`.  
&gt; It will come up as a single instance which you can verify with `riak-admin 
&gt; member-status`.
&gt; Join the node to the cluster with `riak-admin cluster join «cluster nodename» 
&gt; `
&gt; Set it to replace the old instance of itself with `riak-admin cluster replace 
&gt; «old nodename» «new nodename»
&gt; Plan the changes with `riak-admin cluster plan`
&gt; Commit the changes with `riak-admin cluster commit`
&gt; 
&gt; As you can see, this is a very large effort, so best to use hostnames that 
&gt; aren't moving around.  Apologies for you getting this twice, Deepak. I failed 
&gt; to reply to the list as well.
&gt; 
&gt; Hope this makes sense...
&gt; Charlie
&gt; 
&gt; On Jan 1, 2013, at 2:43 PM, Deepak Balasubramanyam &lt;deepak.b...@gmail.com&gt; 
&gt; wrote:
&gt; 
&gt;&gt; I took the AWS EC2 riak image for a spin today. I have a query regarding 
&gt;&gt; riak nodes and how they behave when the machine reboots.
&gt;&gt; 
&gt;&gt; When an EC2 instance reboots, the internal ip / internal DNS / external DNS 
&gt;&gt; change. This renders the app.config and -name argument on vm.args incorrect. 
&gt;&gt; I was exploring solutions to deal with this problem. 
&gt;&gt; 
&gt;&gt; 1. Preventive measures
&gt;&gt; 
&gt;&gt; Someone on this thread dated May 2011 suggested using host file entries that 
&gt;&gt; point to the local internal IP address. That does not seem to work. Riak 
&gt;&gt; fails with the following error when I add a new entry to /etc/hosts and 
&gt;&gt; configure vm.args with -name riak@riaknode1
&gt;&gt; 
&gt;&gt; Hostname riaknode1 is illegal
&gt;&gt; 
&gt;&gt; I confirmed that riaknode1 pings correctly before starting riak. I guess 
&gt;&gt; erlang tries to match the hostname of the system resulting in this failure ? 
&gt;&gt; Can anyone throw some light on this ?
&gt;&gt; 
&gt;&gt; 2. Use -sname
&gt;&gt; 
&gt;&gt; Is starting the erlang VM with the sname flag an option if it will help 
&gt;&gt; prevent the 'illegal hostname' error ? 
&gt;&gt; Disclaimer: My knowledge of erlang is close to zilch, so sorry if that 
&gt;&gt; option sounded like something you could dismiss easily :)
&gt;&gt; 
&gt;&gt; 3. Use cluster replace
&gt;&gt; 
&gt;&gt; a. I understand that the IPs in app.config and vm.args can be replaced with 
&gt;&gt; the correct IP on a restart and using a subsequent 'cluster replace' command 
&gt;&gt; will do. Will executing the 'cluster plan' and 'cluster commit' commands now 
&gt;&gt; produce network chatter ? 
&gt;&gt; 
&gt;&gt; b . What happens if 2 nodes go down and one was joined with the other. They 
&gt;&gt; both have 2 different IP addresses on restart. How will 'cluster replace' 
&gt;&gt; work now ?
&gt;&gt; 
&gt;&gt; Do let me know your thoughts.
&gt;&gt; 
&gt;&gt; Thanks
&gt;&gt; -Deepak
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09749.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#09751">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#09751">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09752.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09717.html">Riak and host names</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09737.html">Re: Riak and host names</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li class="icons-email"><span class="subject"><a href="msg09743.html">Re: Riak and host names</a></span> <span class="sender italic">Charlie Voiselle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09749.html">Re: Riak and host names</a></span> <span class="sender italic">Matt Black</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak and host names</span> <span class="sender italic">Charlie Voiselle</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09752.html">Re: Riak and host names</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09782.html">Re: Riak and host names</a></span> <span class="sender italic">Matt Black</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09785.html">Re: Riak and host names</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09803.html">Re: Riak and host nam...</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li class="icons-email"><span class="subject"><a href="msg10043.html">Re: Riak and host nam...</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li class="icons-email"><span class="subject"><a href="msg10050.html">Re: Riak and host nam...</a></span> <span class="sender italic">Mark Phillips</span></li>
<li class="icons-email"><span class="subject"><a href="msg10052.html">Re: Riak and host nam...</a></span> <span class="sender italic">Deepak Balasubramanyam</span></li>
<li class="icons-email"><span class="subject"><a href="msg10056.html">Re: Riak and host nam...</a></span> <span class="sender italic">Eric Redmond</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg09754.html">Re: Riak and host names</a></span> <span class="sender italic">Michael Johnson</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak and host names">
<input type="hidden" name="msgid" value="9FEA4D24-51CE-4BC9-A2BE-C5A4BB64C968@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09751.html">
<input type="submit" value=" Charlie Voiselle ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+and+host+names%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09749.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09752.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">9FEA4D24-51CE-4BC9-A2BE-C5A4BB64C968@basho.com</li>
</ul>
</div>
</body>
</html>
