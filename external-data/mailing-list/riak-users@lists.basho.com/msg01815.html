<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Recap for Dec. 13 - 14</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01815" id="c">
<link rel="index" href="maillist.html#01815" id="i">
<link rel="prev" href="msg01814.html" id="p">
<link rel="next" href="msg01803.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01815.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Recap+for+Dec.+13+%5C-+14%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Recap for Dec. 13 - 14</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremiah+Peschka%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremiah Peschka</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101217" rel="nofollow">Fri, 17 Dec 2010 04:27:50 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Daniel -

You should be using some kind of load balancer to point clients at the Riak
cluster since all nodes can handle communication.</pre><pre>

There's information in the wiki about how the keys are hashed:
<a  rel="nofollow" href="http://wiki.basho.com/pages/viewpage.action?pageId=1245320">http://wiki.basho.com/pages/viewpage.action?pageId=1245320</a> and there is also
info about how routing an object to a set of partitions works:
<a  rel="nofollow" href="http://wiki.basho.com/display/RIAK/Replication#Replication-Routinganobjecttoasetofpartitions">http://wiki.basho.com/display/RIAK/Replication#Replication-Routinganobjecttoasetofpartitions</a>

Key hashing is done through SHA1, so I'd assume that you would be able to
figure out which node is responsible for that chunk o' keyspace.

Jeremiah Peschka
Microsoft SQL Server MVP
MCITP: Database Developer, DBA


On Fri, Dec 17, 2010 at 3:54 AM, Daniel Woo &lt;daniel.y....@gmail.com&gt; wrote:

&gt; Thanks for your patience :-)
&gt;
&gt; So, when the client makes a call, it can just be round-robin since all
&gt; nodes can gossip? But it should be better to guess where the partition is
&gt; before making the call, right? Where can I find the documentation about how
&gt; the partition distributions are shared between nodes and how client decides
&gt; which node to ask?
&gt;
&gt; Regards,
&gt; Daniel
&gt;
&gt;
&gt; On Fri, Dec 17, 2010 at 12:24 PM, Dan Reverri &lt;d...@basho.com&gt; wrote:
&gt;
&gt;&gt; Yes.
&gt;&gt;
&gt;&gt; Daniel Reverri
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Dec 16, 2010 at 7:56 PM, Daniel Woo &lt;daniel.y....@gmail.com&gt;wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Daniel,
&gt;&gt;&gt;
&gt;&gt;&gt; So, the hashing algorithm is still consistent, but partitions (vnodes)
&gt;&gt;&gt; are re-distributed to nodes when new nodes are added, and the nodes gossip
&gt;&gt;&gt; and share the knowledge of the partition distribution, right? So the client
&gt;&gt;&gt; can query any of the nodes, if the node doesn't know where the partition
&gt;&gt;&gt; located it will query or gossip with adjacent nodes, right?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Daniel
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Dec 17, 2010 at 10:42 AM, Dan Reverri &lt;d...@basho.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi Daniel,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Clients do not specify the partition when making a request. A client can
&gt;&gt;&gt;&gt; request any key from any node in the cluster and Riak will return the
&gt;&gt;&gt;&gt; associated value.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; Dan
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Daniel Reverri
&gt;&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; d...@basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Dec 16, 2010 at 6:01 PM, Daniel Woo &lt;daniel.y....@gmail.com&gt;wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi Mark,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks for your explanation, so in this case the partitions would be
&gt;&gt;&gt;&gt;&gt; re-distributed
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; *from*
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Node1: p1 ~ p16
&gt;&gt;&gt;&gt;&gt; Node2: p17 ~ p32
&gt;&gt;&gt;&gt;&gt; Node3: p33 ~ p48
&gt;&gt;&gt;&gt;&gt; Node4: p49 ~ p64
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; *to *
&gt;&gt;&gt;&gt;&gt; Node1: p1 ~ p13 (remove 3 partitions)
&gt;&gt;&gt;&gt;&gt; Node2: p17 ~ p29 (remove 3 partitions)
&gt;&gt;&gt;&gt;&gt; Node3: p33 ~ p45 (remove 3 partitions)
&gt;&gt;&gt;&gt;&gt; Node4: p49 ~ p61 (remove 3 partitions)
&gt;&gt;&gt;&gt;&gt; Node5: p14, 15, 16, 30, 31, 32, 46, 47, 48, 62, 63, 64 (aprox 1/5
&gt;&gt;&gt;&gt;&gt; partitions will be transferred to this new node)
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Since there is no centralized node in Riak, how do we know the
&gt;&gt;&gt;&gt;&gt; partition 32 is moved to node 5 from the client caller? Cassandra seems
&gt;&gt;&gt;&gt;&gt; break half of the adjacent node's data into the new node, that will be 
&gt;&gt;&gt;&gt;&gt; easy
&gt;&gt;&gt;&gt;&gt; for the client to search for the datum just around the node-circle
&gt;&gt;&gt;&gt;&gt; clockwise, although it causes unbalanced data distribution and you have to
&gt;&gt;&gt;&gt;&gt; move them by command lines. Riak seems to have this solved by moving
&gt;&gt;&gt;&gt;&gt; partitions into new nodes equally, that's very interesting, how do you 
&gt;&gt;&gt;&gt;&gt; guys
&gt;&gt;&gt;&gt;&gt; make it? If the client caller queries for partition 32 which was 
&gt;&gt;&gt;&gt;&gt; originally
&gt;&gt;&gt;&gt;&gt; on node 2, how do the client know it's on a new node now?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt;&gt; Daniel
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Fri, Dec 17, 2010 at 6:56 AM, Mark Phillips &lt;m...@basho.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hey Daniel,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; [snip]
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; &gt; So, I guess Riak would have to re-hash the whole partitions into all
&gt;&gt;&gt;&gt;&gt;&gt; the 5
&gt;&gt;&gt;&gt;&gt;&gt; &gt; nodes, right? Is this done lazily when the node finds the requested
&gt;&gt;&gt;&gt;&gt;&gt; data is
&gt;&gt;&gt;&gt;&gt;&gt; &gt; missing?
&gt;&gt;&gt;&gt;&gt;&gt; &gt; Or is there a way to handle this with consistent re-hashing so we
&gt;&gt;&gt;&gt;&gt;&gt; can avoid
&gt;&gt;&gt;&gt;&gt;&gt; &gt; moving data around when new nodes added?
&gt;&gt;&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Riak won't rehash all the partitions in the ring when new nodes are
&gt;&gt;&gt;&gt;&gt;&gt; added. When you go from 4 -&gt; 5 nodes, for example, approx. 1/5 of the
&gt;&gt;&gt;&gt;&gt;&gt; existing partitions are transferred to the new node. The other 4/5s of
&gt;&gt;&gt;&gt;&gt;&gt; the partitions will remain unchanged. As far as moving data around
&gt;&gt;&gt;&gt;&gt;&gt; when new nodes are added, this is impossible to avoid. Data needs to
&gt;&gt;&gt;&gt;&gt;&gt; be handed off to be spread around the ring.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hope that helps.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Mark
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt; Thanks &amp; Regards,
&gt;&gt;&gt;&gt;&gt; Daniel
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Thanks &amp; Regards,
&gt;&gt;&gt; Daniel
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Thanks &amp; Regards,
&gt; Daniel
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01814.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01815">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01815">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01803.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01801.html">Riak Recap for Dec. 13 - 14</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01804.html">Re: Riak Recap for Dec. 13 - 14</a></span> <span class="sender italic">Daniel Woo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01808.html">Re: Riak Recap for Dec. 13 - 14</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01809.html">Re: Riak Recap for Dec. 13 - 14</a></span> <span class="sender italic">Daniel Woo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01810.html">Re: Riak Recap for Dec. 13 - 14</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01811.html">Re: Riak Recap for Dec. 13 - 14</a></span> <span class="sender italic">Daniel Woo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01813.html">Re: Riak Recap for Dec. 13 - 14</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01814.html">Re: Riak Recap for Dec. 13 ...</a></span> <span class="sender italic">Daniel Woo</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Recap for Dec. 13 ...</span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Recap for Dec. 13 - 14">
<input type="hidden" name="msgid" value="AANLkTikHWZf2os-oPK0UFqxGCPODUnV7jkqn-3M8+mQ6@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01815.html">
<input type="submit" value=" Jeremiah Peschka ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Recap+for+Dec.+13+%5C-+14%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01814.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01803.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTikHWZf2os-oPK0UFqxGCPODUnV7jkqn-3M8+mQ6@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
