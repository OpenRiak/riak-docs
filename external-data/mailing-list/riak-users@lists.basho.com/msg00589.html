<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: [ANN] Riak Release 0.11.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00589" id="c">
<link rel="index" href="maillist.html#00589" id="i">
<link rel="prev" href="msg00587.html" id="p">
<link rel="next" href="msg00551.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00589.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%5BANN%5C%5D+Riak+Release+0.11.0%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: [ANN] Riak Release 0.11.0</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alan+McConnell%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alan McConnell</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100614" rel="nofollow">Mon, 14 Jun 2010 17:32:41 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Justin,
Thanks a ton for the quick response, that makes perfect sense.  It also
explains why I've only seen this behavior in our test environment.  It may
make sense to note this info in the &quot;Replication&quot; node of the wiki, perhaps
in the &quot;What does N=3 really mean?&quot; section (there's an example of a 2-node
cluster with N=3 in there).  I think our case of &quot;Let's quickly test this
thing out on more than 1 box with default config&quot; is probably common and
this behavior could lead some to believe that Riak isn't replicating
properly.</pre><pre>

Thanks again.

-Alan

On Mon, Jun 14, 2010 at 12:54 PM, Justin Sheehy &lt;jus...@basho.com&gt; wrote:

&gt; Hi, Alan.
&gt;
&gt; Your replicas do in fact exist on both nodes.  However, I understand
&gt; that the situation you are observing is confusing.  I will attempt to
&gt; explain.
&gt;
&gt; Quite some time ago, something surprising was noticed by some of our
&gt; users during their pre-production testing.  Some intentional failure
&gt; scenarios (with busted nodes, etc) would fail much more slowly when
&gt; R=1 than when R=2.  This was due to the fact that to satisfy a R=1
&gt; request with a non-object response (timeout or notfound), we would
&gt; wait for all N nodes to reply.  With R=2, we could send this response
&gt; as soon as N-1 nodes reply.  In some situations this is a dramatic
&gt; difference in time.
&gt;
&gt; To remove this perceived problem we implemented what we refer to as
&gt; &quot;basic quorum&quot;.  If a simple majority of vnodes have produced
&gt; non-successful internal replies, we return a non-success value such as
&gt; a notfound.  This means that if there is only one copy of the object
&gt; out there, and the node holding it is slowest to respond, the client
&gt; will not see that object in their response but will instead get the
&gt; notfound instead of waiting for the last node to respond or time out.
&gt;
&gt; (note that read-repair will still occur in any case)
&gt;
&gt; This could be avoided if we considered &quot;not found&quot; to be a success
&gt; condition, but then in the above situation you would see not founds
&gt; even with R=2.  That would simply be defined as another kind of
&gt; &quot;successful&quot; response.  Either way, it is a tradeoff of different
&gt; kinds of surprise.
&gt;
&gt; I hope that this explanation helps with your understanding.
&gt;
&gt; On another note, it's not useful to run Riak with a number of physical
&gt; hosts less than your N value unless you're planning on expanding it
&gt; soon.  So: testing with 2 hosts and N=3 means that you are testing
&gt; against a very much not-recommended configuration.  I suggest either
&gt; using more hosts or else changing your default bucket N value to 2.
&gt;
&gt; -Justin
&gt;
&gt;
&gt; On Mon, Jun 14, 2010 at 1:59 PM, Alan McConnell &lt;ala...@swingvine.com&gt;
&gt; wrote:
&gt; &gt; Hey Dan,
&gt; &gt; I have a 2-node cluster with default bucket settings (N=3, etc.), and if
&gt; I
&gt; &gt; take one of the boxes down (and perform reads with R=1) I get tons of
&gt; &quot;key
&gt; &gt; not found&quot; errors for keys I know exist in the cluster.  Seems like for
&gt; many
&gt; &gt; keys, all 3 replicas live on one host.  From what you've written here
&gt; &gt; though, it seems like that should not happen.  Do you know of any way my
&gt; &gt; cluster could have gotten into this state?
&gt; &gt; I did run a restore on this cluster using a riak-admin backup from a
&gt; &gt; different, single-node cluster.  I wonder if that caused an uneven
&gt; &gt; distribution.
&gt; &gt; Any help would be appreciated.  As it stands now our 2-node cluster has
&gt; &gt; serious read problems if either node goes down.
&gt; &gt; -Alan
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00587.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00589">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00589">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00551.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00543.html">[ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00544.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Jason J. W. Williams</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00545.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00546.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Jason J. W. Williams</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00581.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00583.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Jason J. W. Williams</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00584.html">Re: [ANN] Riak Release 0.11...</a></span> <span class="sender italic">Dan Reverri</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg00585.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Alan McConnell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00587.html">Re: [ANN] Riak Release 0.11...</a></span> <span class="sender italic">Justin Sheehy</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: [ANN] Riak Release ...</span> <span class="sender italic">Alan McConnell</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg00551.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Germain Maurice</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00552.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Justin Sheehy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00565.html">Re: [ANN] Riak Release 0.11.0</a></span> <span class="sender italic">Jason J. W. Williams</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00566.html">Re: [ANN] Riak Release 0.11...</a></span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00569.html">Re: [ANN] Riak Release ...</a></span> <span class="sender italic">Jason J. W. Williams</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: [ANN] Riak Release 0.11.0">
<input type="hidden" name="msgid" value="AANLkTinTV04s-a1tA3bsn7Lypw2e8-5ujz1-tvfh5Rab@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00589.html">
<input type="submit" value=" Alan McConnell ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%5BANN%5C%5D+Riak+Release+0.11.0%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00587.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00551.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTinTV04s-a1tA3bsn7Lypw2e8-5ujz1-tvfh5Rab@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
