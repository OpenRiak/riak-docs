<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: High cpu usage on store() , small number of keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04270" id="c">
<link rel="index" href="maillist.html#04270" id="i">
<link rel="prev" href="msg04192.html" id="p">
<link rel="next" href="msg04382.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04270.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+cpu+usage+on+store%5C%28%5C%29+%2C+small+number+of+keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: High cpu usage on store() , small number of keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110808" rel="nofollow">Mon, 08 Aug 2011 19:29:59 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Tony,

Is it a constant 200% usage?  On both nodes in the cluster?  My first
thought, since your working with a small key-space, would be conflict
resolution or vclock explosion but you're spacing the writes out by 6s which
seems like more than enough time.  Are all 10 writes happening at the same
time concurrently?</pre><pre>

I would set your N=2 since you only have two machines, or add a 3rd node.

Perhaps there is some weird behavior in the cache backend, but I would be
surprised if that was it.

-Ryan

On Wed, Aug 3, 2011 at 11:31 AM, Tony Bussieres &lt;t.bussie...@gmail.com&gt;wrote:

&gt; I'm starting to play with Riak,  so far I am very impressed with the
&gt; product.
&gt;
&gt; I want to use Riak as an highly available distributed cache.
&gt;
&gt; I've compiled Erlang R1304 from source (--with-ssl, --enable-smp-support,
&gt; --enable-kernel-poll)
&gt; I've compiled riak-0.14.2 from source
&gt; I use 2 nodes, they are running on two RHEL5 box . (2.6.18.8.el5 #1 SMP).
&gt; They are clustered.
&gt; I use HAProxy to load balance the request on the two nodes.
&gt;
&gt; I have a test bench that  plays with  80 keys in one bucket (I use
&gt; riak_kv_cache_backend)
&gt; I use the java client (riak-client 0.14.1 fetched using a maven repo)
&gt;
&gt;
&gt; I have 10 clients that does something like this :
&gt; while(true) {
&gt;    Fetch a key from the bucket
&gt;    Sleep between 100 and 400ms
&gt; }
&gt;
&gt; I have also 10 servers that updates data in the keys every 6 seconds  (80
&gt; keys)
&gt; conceptually they do something like this :
&gt; while (true) {
&gt;    Fetch a key from the bucket
&gt;    Update the data
&gt;    Store the key in the bucket
&gt;    Sleep 6000ms
&gt; }
&gt;
&gt; The number of clients have a little impact on the CPU usage of the nodes.
&gt; However when I start 10 servers, the CPU usage goes very high (I saw one of
&gt; the node going up to 200%)
&gt;
&gt; Is there something I should check or do  to lower the CPU usage on the
&gt; nodes when I write keys to Riak?
&gt;
&gt; Thanks a lot!
&gt;
&gt; -tony
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04192.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04270">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04270">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04382.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg04192.html">High cpu usage on store() , small number of keys</a></span> <span class="sender italic">Tony Bussieres</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: High cpu usage on store() , small number of keys</span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04382.html">Re: High cpu usage on store() , small number of ke...</a></span> <span class="sender italic">Tony Bussieres</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: High cpu usage on store() , small number of keys">
<input type="hidden" name="msgid" value="CACZcpekqF3ex7AXoCo7shLnr4BV9YxT-u5oVJivoVH=wM30JPQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04270.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+cpu+usage+on+store%5C%28%5C%29+%2C+small+number+of+keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04192.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04382.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpekqF3ex7AXoCo7shLnr4BV9YxT-u5oVJivoVH=wM30JPQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
