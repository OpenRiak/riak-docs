<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: one-to-very-many link associations</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00113" id="c">
<link rel="index" href="maillist.html#00113" id="i">
<link rel="prev" href="msg00111.html" id="p">
<link rel="next" href="msg00115.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00113.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+one%5C-to%5C-very%5C-many+link+associations%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: one-to-very-many link associations</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100422" rel="nofollow">Thu, 22 Apr 2010 06:02:06 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Orlin,

One thing that you imply is that you would always be using the Link header to 
represent links.  Another way to cope with large numbers of links is to 
encapsulate them in the object itself, rather than in the headers.  This 
removes the header-length/count limitation, but would require you to have a map 
function that understands the internals of the object.  Also, you would need to 
deal with the larger size of the object, which could potentially slow down your 
request.</pre><pre>

In Ripple, I intend to support secondary link-storing objects through 
associations.  You would associate the secondary object by key (i.e. it would 
have the same key as the owner), and then that secondary object would have a 
link association to the targets.  Then the origin/owner object would have the 
transitive association via a simple method delegation.  As I told the Raleigh 
Ruby group on Tuesday, &quot;I want to provide just enough tools to shoot yourself 
in the foot.&quot;  Having a convention is helpful, but won't substitute for 
thoughtful evaluation of your data model.

One of the &quot;other options&quot; that I didn't mention was a graph database.  If your 
model seems to beg lots and lots of links, you might be better off looking at 
something that fits the traversal model better, like Neo4J, AllegroGraph, etc.  
You could still use Riak for storing the primary objects, but keep your tightly 
interrelated stuff in the graph DB.  Remember, nosql is about choice and using 
the best tool for the job!

Sean Cribbs &lt;s...@basho.com&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On Apr 22, 2010, at 4:23 AM, Orlin Bozhinov wrote:

&gt; Riak Users, 
&gt; 
&gt; Thinking about a data modeling pattern that will allow one to not worry about 
&gt; how many links can be had with one-to-many (or many-to-many) scenarios.  This 
&gt; question has come up before in various places.  One answer I like is Sean's 
&gt; from this thread <a  rel="nofollow" href="http://riak.markmail.org/thread/6e7ypt5ndjzjk7mr">http://riak.markmail.org/thread/6e7ypt5ndjzjk7mr</a> saying: 
&gt; &quot;... at the point where you have that many links it becomes necessary to 
&gt; consider other options, including intermediary objects or alternative ways of 
&gt; representing the relationship&quot;.  I wonder if an _intermediary way_ could be 
&gt; baked into Ripple (or your client library of choice).  This is for the cases 
&gt; when one-to-many can become one-to-very-many.  
&gt; 
&gt; To make it more interesting, let's say we want to add metadata to the 
&gt; relationship as described in the pre-last paragraph of 
&gt; <a  rel="nofollow" href="http://blog.basho.com/2010/03/25/schema-design-in-riak---relationships/">http://blog.basho.com/2010/03/25/schema-design-in-riak---relationships/</a>.  
&gt; Here is what I have in mind: {from}-&gt;{from_association}-&gt;{association}-&gt;{to} 
&gt; -- the {curlied} are bucket / objects and -&gt; are links.  For example if 
&gt; {from} = &quot;user&quot;; and {association} = &quot;interest&quot;; and {to} = {whatever} there 
&gt; is interest in - e.g. &quot;event&quot;, &quot;place&quot;, &quot;story&quot;, another &quot;user&quot; or even 
&gt; self-interest :)  But I'm getting ahead of myself.  Let's use a recent 
&gt; example from Basho's blog where a &quot;user&quot; links {to} = &quot;task&quot;.  So we get: 
&gt; user -has--&gt; user_interest -meta--&gt; interest -in--&gt; task.  
&gt; 
&gt; The &quot;interest&quot; association could imply &quot;ownership&quot; but maybe the application 
&gt; allows its &quot;users&quot; to express interest another's &quot;task&quot;.  Maybe it's a 
&gt; collaborative effort...  Reverse-linking from the many interests / tasks to 
&gt; their respective owners is easy because it's just a single link for task 
&gt; -of--&gt; user or interest -of--&gt; user.  In the interests bucket I want to put 
&gt; all kinds of useful metadata.  There I would embed (via Composition as Ripple 
&gt; calls it) not only all the &quot;tags&quot;, but also &quot;notes&quot;, &quot;star&quot;, etc.  Think 
&gt; delicious bookmarks or google reader items and so on.  It seems like a common 
&gt; pattern.  Something that may fit the use case of @botanicus too.  One could 
&gt; represent all possible links (various associations) between two objects as 
&gt; metadata contained in a given &quot;interest&quot;.  Ownership can be a type of 
&gt; interest for the sake of link-walking.  
&gt; 
&gt; There are three things happening here:  
&gt; 1. the &quot;very many&quot; (links through intermediary objects)
&gt; 2. optional metadata (yet another intermediary object) - multiple 
&gt; associations between any two objects can be expressed through extra metadata 
&gt; rather than extra links
&gt; 3. reusing the &quot;very-many&quot; and / or metadata intermediaries -linking--&gt; to 
&gt; objects in different buckets
&gt; 
&gt; The real issue (that #1 solves) is not having an easy ability to do &quot;very 
&gt; many&quot; links originating from the same object.  The #2 metadata object vs a 
&gt; few extra links for tags / notes (which are insignificant compared to the 
&gt; many interests a user can have) - makes it easier (in my eyes) to put in 
&gt; Redis for filtering...  Of-course interests (#2) could be specialized 
&gt; (different metadata models) with regards to what they are about (#3).  On 
&gt; delicious that's just bookmarks.  I've got close to 6,000 of them.  Does that 
&gt; approach &quot;very many&quot; in terms of Riak?  If &quot;very many&quot; were easier to do 
&gt; (with client-library models or otherwise Riak itself) #2 &amp; #3 would be 
&gt; indifferent about which intermediary leads to them (an extra link-walk step) 
&gt; as they are already possible anyway.  How could we step (automagically) 
&gt; through an intermediary object (the user_interest &quot;very many&quot; enabler bucket) 
&gt; - having a specific target object in mind?  
&gt; 
&gt; I think it may already be possible with current link-walking.  Then it's all 
&gt; a matter of managing the intermediary bucket / objects.  Not exactly sure how 
&gt; the max links are calculated.  According to one formula from the mailing list 
&gt; I may get 1000 headers (limit in mochiweb) * 200 links (&quot;around 40 chars per 
&gt; link&quot;) = 200,000 links max?  That seems like &quot;very many&quot;, but there was also 
&gt; something about performance burden...  If we took those 200 with just a 
&gt; single header, pointing to 200 intermediary objects, each pointing to another 
&gt; 200 target objects we would get 40,000 links.  That's quite a few.  Of-course 
&gt; that number could easily get much much bigger (square the default limit).  
&gt; What decides how many links per intermediary object is ideal?  Is it a 
&gt; setting that Basho could recommend a default for?  Could Ripple automate 
&gt; that?  Some link creation logic is needed and if Riak doesn't support it, the 
&gt; client libraries that do &quot;associations&quot; are a good candidate for the task.  
&gt; Also with link deletion - we'll need to either keep track of link count per 
&gt; intermediary or run map-reduce jobs to clean-up once in a while...  
&gt; 
&gt; In either case, link creation should be as simple as knowing which 
&gt; intermediary object is the last one and whether we should add the next new 
&gt; link through it or through a new intermediary (when a certain link count 
&gt; _setting_ is reached).  If this could be automated then it wouldn't matter 
&gt; how many the links are.  Otherwise Riak would have to be monitored and if 
&gt; certain links begin to get &quot;very many&quot; then a model migration is run to make 
&gt; the transition from few straight links to very many.  If client libraries 
&gt; could work with both kinds of links then this transition would mean tweaking 
&gt; the model association (and link walking remaining the same).  But when using 
&gt; Riak's raw interface there would be a difference, which means a switch from 
&gt; one-to-many to one-to-very-many will usually take some thinking / effort.  
&gt; Any time I'm in doubt, it seems safer to side with the very-many (just in 
&gt; case).  What is the cost of an extra step of link-walking as compared to 
&gt; changing application code?  
&gt; 
&gt; As another example, if one were to build GitHub with Riak, how would you 
&gt; model the watching &amp; following associations?  Many users would use few, but 
&gt; some would use many, which in a few cases get to be very many, which means 
&gt; everybody will watch and follow in very-many style.  If the app ui allows it, 
&gt; one has to assume it will happen...  Here is the following / watching example 
&gt; for very many - different words for having interest in something:
&gt; 
&gt; * separate very-many:
&gt; user -does--&gt; user_following -what--&gt; user
&gt; user -does--&gt; user_watching -what--&gt; repo (-of--&gt; user)
&gt; * combined very-many:
&gt; user -has--&gt; user_interest -for--&gt; {whatever}
&gt; * combined very-many + metadata:
&gt; user -has--&gt; user_interest -meta--&gt; interest -for--&gt; {whatever}
&gt; * and if metadata was different, perhaps:
&gt; user -has--&gt; user_interest -meta--&gt; interest_user -what--&gt; user
&gt; user -has--&gt; user_interest -meta--&gt; interest_repo -what--&gt; repo
&gt; 
&gt; Whatever the pattern, it would be nice to have the best practices defined and 
&gt; implemented for reuse (via association-proficient client libs - a la Ripple). 
&gt;  After all, Riak users like big data, which is another way of saying very 
&gt; many items of stuff -- and why not very many hands / links too :)
&gt; 
&gt; Orlin
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00111.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00113">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00113">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00115.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00111.html">one-to-very-many link associations</a></span> <span class="sender italic">Orlin Bozhinov</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: one-to-very-many link associations</span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00115.html">Re: one-to-very-many link associations</a></span> <span class="sender italic">Eric Gaumer</span></li>
<li class="icons-email"><span class="subject"><a href="msg00132.html">Re: one-to-very-many link associations</a></span> <span class="sender italic">Orlin Bozhinov</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg00114.html">Re: one-to-very-many link associations</a></span> <span class="sender italic">Eric Gaumer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00134.html">Re: one-to-very-many link associations</a></span> <span class="sender italic">Orlin Bozhinov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00136.html">Re: one-to-very-many link associations</a></span> <span class="sender italic">Eric Gaumer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00139.html">Re: one-to-very-many link associations</a></span> <span class="sender italic">Orlin Bozhinov</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: one-to-very-many link associations">
<input type="hidden" name="msgid" value="799DB7C5-CB18-4800-9C1D-E824AA87C9F5@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00113.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+one%5C-to%5C-very%5C-many+link+associations%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00111.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00115.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">799DB7C5-CB18-4800-9C1D-E824AA87C9F5@basho.com</li>
</ul>
</div>
</body>
</html>
