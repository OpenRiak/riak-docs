<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Crash Log: yz_anti_entropy</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17870" id="c">
<link rel="index" href="maillist.html#17870" id="i">
<link rel="prev" href="msg17869.html" id="p">
<link rel="next" href="msg17871.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17870.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Crash+Log%5C%3A+yz_anti_entropy%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Crash Log: yz_anti_entropy</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Junk%2C+Damion+A%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Junk, Damion A</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170119" rel="nofollow">Thu, 19 Jan 2017 06:16:34 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Matthew -

That did it!</pre><pre>

Actually, I tried with both settings, and also with just the ring_size change.

Setting ring_size to 8 got rid of crashing.  I'll have to do a bit more reading 
on this setting I suppose. I have a much more memory-constrained virtual 
machine running on my local desktop running with just the default install 
settings and no crashing.

Thanks!

Damion

On Jan 19, 2017, at 7:57 AM, Matthew Von-Maszewski 
&lt;matth...@basho.com&lt;<a  rel="nofollow" href="mailto:matth...@basho.com">mailto:matth...@basho.com</a>&gt;&gt; wrote:

Damion,

Add the following settings within riak.conf:

leveldb.limited_developer_mem = on
ring_size = 8

Erase all data / vnodes and start over.

Matthew


On Jan 19, 2017, at 8:51 AM, Junk, Damion A 
&lt;jun...@purdue.edu&lt;<a  rel="nofollow" href="mailto:jun...@purdue.edu">mailto:jun...@purdue.edu</a>&gt;&gt; wrote:

Hi Magnus -

I've tried a wide range of parameters for leveldb.maximum_memory_percent 
ranging from 5 to 70. I also tried the leveldb.maximum_memory setting in bytes, 
ranging from 500MB to 4GB. I get the same results in the crash/console log no 
matter what the settings. But the log messages seem to indicate an issue with 
yokozuna, and not leveldb itself from what I can tell.

I set the max (-Xmx) to 2G for SOLR as well.

From the log messages, it looks like it's not actually the KV leveldb system 
that's crashing, but the yokozuna system. I'm not sure how to control or set 
memory here:

{badmatch,{error,{db_open,&quot;IO error: lock 
/var/lib/riak/yz_anti_entropy/639406966332270026714112114313373821099470487552/LOCK:
 Cannot allocate memory&quot;}

This is a development node, running as a single (nojn-clustered) riak node. It 
has 14G memory, and at the time of trying changes with Riak, 9GB were free.


To Recap:

There are no keys/values in the database at all.
The only default settings I changed were:

storage_backend = leveldb
search = on

and when that didn't work, I started changing:

search.solr.jvm_options = -d64 -Xms1g -Xmx2g -XX:+UseStringCache 
-XX:+UseCompressedOops
leveldb.maximum_memory_percent = 5 .. 70

and then when nothing seemed to change:

leveldb.maximum_memory =  1000000 ... 4000000000


Thanks for any assistance!


Damion


On Jan 19, 2017, at 3:33 AM, Magnus Kessler 
&lt;mkess...@basho.com&lt;<a  rel="nofollow" href="mailto:mkess...@basho.com">mailto:mkess...@basho.com</a>&gt;&gt; wrote:

Hi Damion,

Let me first state that AAE always uses leveldb, regardless of the storage 
backend chosen for Riak KV data. Could you please state how much physical 
memory your Riak nodes have, and what you have configured for 
&quot;leveldb.maximum_memory.percent&quot; in &quot;riak.conf&quot;? Have you changed the settings 
for &quot;search.solr.jvm_options&quot;, in particular the memory allocated to Solr?

As a general rule, leveldb should have at least 350MB of memory available per 
partition, and performance has been shown to increase with up to 2GB (2.5 GB 
when also using Search and AAE) per partition. Please check that you have 
enough memory available in your system.

Kind Regards,

Magnus

--
Magnus Kessler
Client Services Engineer
Basho Technologies Limited

Registered Office - 8 Lincolnâ€™s Inn Fields London WC2A 3BP Reg 07970431

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17869.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17870">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17870">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17871.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17866.html">Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17867.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Magnus Kessler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17868.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17869.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Crash Log: yz_anti_entropy</span> <span class="sender italic">Junk, Damion A</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17871.html">Re: Crash Log: yz_anti_entropy</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Crash Log: yz_anti_entropy">
<input type="hidden" name="msgid" value="B72066D6-7D0C-4841-B10F-9763AF5A1915@purdue.edu">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17870.html">
<input type="submit" value=" Junk, Damion A ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Crash+Log%5C%3A+yz_anti_entropy%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17869.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17871.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">B72066D6-7D0C-4841-B10F-9763AF5A1915@purdue.edu</li>
</ul>
</div>
</body>
</html>
