<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak search, post schema change reindexation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17597" id="c">
<link rel="index" href="maillist.html#17597" id="i">
<link rel="prev" href="msg17596.html" id="p">
<link rel="next" href="msg17600.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17597.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+search%2C+post+schema+change+reindexation%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak search, post schema change reindexation</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Fred+Dushin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Fred Dushin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160829" rel="nofollow">Mon, 29 Aug 2016 05:42:36 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Guillame,

A few questions.</pre><pre>

What version of Riak?

Does the reindexing need to occur across the entire cluster, or just on one 
node?

What are the expectations about query-ability while re-indexing is going on?

If you can afford to take a node out of commission for query, then one approach 
would be to delete your YZ data and YZ AAE trees, and let AAE sync your 30 
million documents from Riak.  You can increase AAE tree rebuild and exchange 
concurrency to make that occur more quickly than it does by default, but that 
will put a fairly significant load on that node.  Moreover, because you have 
deleted indexed data on one node, you will get inconsistent search results from 
Yokozuna, as the node being reindexed will still show up as part of a coverage 
plan.  Depending on the version of Riak, however, you may be able to manually 
remove that node from coverage plans through the Riak console while re-indexing 
is going on.  The node is still available for Riak get/put operations 
(including indexing new entries into Solr), but it will be excluded from any 
cover set when a query plan is generated.  I can't guarantee that this would 
take less than 5 days, however.

-Fred

&gt; On Aug 29, 2016, at 3:56 AM, Guillaume Boddaert 
&gt; &lt;guilla...@lighthouse-analytics.co&gt; wrote:
&gt; 
&gt; Hi,
&gt; 
&gt; I recently needed to alter my Riak Search schema for a bucket type that 
&gt; contains ~30 millions rows. As a result, my index was wiped since we are 
&gt; waiting for a Riak Search 2.2 feature that will sync Riak storage with Solr 
&gt; index on such an occasion.
&gt; 
&gt; I adapted a since script suggested by Evren Esat Ã–zkan there 
&gt; (<a  rel="nofollow" href="https://github.com/basho/yokozuna/issues/130#issuecomment-196189344">https://github.com/basho/yokozuna/issues/130#issuecomment-196189344</a> 
&gt; &lt;<a  rel="nofollow" href="https://github.com/basho/yokozuna/issues/130#issuecomment-196189344">https://github.com/basho/yokozuna/issues/130#issuecomment-196189344</a>&gt;). It is 
&gt; a simple python script that will stream keys and trigger a store action for 
&gt; any items. Unfortunately it failed past 178k items due to time out on the key 
&gt; stream. I calculated that this kind of reindexation mechanism would take up 
&gt; to 5 days without a crash to succeed. 
&gt; 
&gt; I was wondering if there would be a pure Erlang mean to achieve a complete 
&gt; forced rewrite of every single element in my bucket type rather that an error 
&gt; prone and very long python process.
&gt; 
&gt; How would you guys reindex a 30 million item bucket type in a fast and 
&gt; reliable way ?
&gt; 
&gt; Thanks, Guillaume
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17596.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17597">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17597">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17600.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17596.html">Riak search, post schema change reindexation</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak search, post schema change reindexation</span> <span class="sender italic">Fred Dushin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17600.html">Re: Riak search, post schema change reindexati...</a></span> <span class="sender italic">Guillaume Boddaert</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak search, post schema change reindexation">
<input type="hidden" name="msgid" value="4361F711-290D-4BB0-B7B6-44398F7C510F@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17597.html">
<input type="submit" value=" Fred Dushin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+search%2C+post+schema+change+reindexation%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17596.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17600.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4361F711-290D-4BB0-B7B6-44398F7C510F@basho.com</li>
</ul>
</div>
</body>
</html>
