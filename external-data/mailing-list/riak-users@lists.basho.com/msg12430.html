<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Invalid hintfiles</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd10.html#12430" id="c">
<link rel="index" href="mail9.html#12430" id="i">
<link rel="prev" href="msg12316.html" id="p">
<link rel="next" href="msg12317.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12430.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Invalid+hintfiles%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Invalid hintfiles</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Toby+Corkindale%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Toby Corkindale</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130929" rel="nofollow">Sun, 29 Sep 2013 18:14:10 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 19/09/13 12:02, Seth Thomas wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Toby,</pre><pre>

Although I haven't traced a root cause just yet I've had several reports
in IRC of odd behavior when using nginx as a load balancer for Riak CS.
In almost every case, removing nginx from the equation and switching to
haproxy or pointing directly at the nodes in the application has
resolved issues. It's anecdotal until I can actually determine a root
cause but it's worth testing out if you're experiencing trouble.
</pre></blockquote><pre style="margin: 0em;">

Thanks for mentioning that Seth.
</pre><tt>I posted some stuff to the list some months ago about config tweaks I 
</tt><tt>had to make to get nginx to play nicely with Riak. Out of the box it 
</tt><tt>definitely didn't work quite right.
</tt><pre style="margin: 0em;">

</pre><tt>In this instance, I had been able to reproduce the problems when going 
</tt><tt>directly to the nodes from applications.. but it's interesting to hear 
</tt><tt>that nginx potentially has issues beyond those we've experienced, so 
</tt><tt>I'll look at getting haproxy used at some point. I've used haproxy in 
</tt><tt>smaller test clusters and it's certainly felt like a better fit.
</tt><pre style="margin: 0em;">

Cheers,
Toby

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On September 18, 2013 at 8:48:27 PM, Toby Corkindale
(toby.corkind...@strategicdata.com.au) wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On 19/09/13 11:17, Luke Bakken wrote:
&gt; Hi Toby,
&gt;
&gt; Invalid hint files won't cause Riak to fail requests - there must have
&gt; been something else happening. Hint files are used by Riak to speed
&gt; start time when loading a large key set.
&gt;
&gt; You mentioned a &quot;load-balancer pool&quot; - are you using something like
&gt; HAProxy to load-balance requests to your Riak CS cluster?
&gt;
&gt; The &quot;error: disconnected&quot; message is a good clue. If you can provide
&gt; log files that may point to the cause.

Hi Luke,
I'm still seeing quite a few failed requests. I've been chasing the
hintfiles but I guess that was a red herring.

We're using nginx to load balance requests to Riak CS.
I tried going directly to each node in turn, and it didn't show that any
one node was reliably failing every request.

Hitting one server just now came up with OK/403/403/OK/OK.
Trying another was OK/OK/OK/OK/403 though.

Here's some logs from riak-cs:

</pre></blockquote></blockquote><pre style="margin: 0em;">


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12316.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd10.html#12430">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail9.html#12430">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12317.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12310.html">Riak CS 1.4.1 bug? InvalidAccessKeyId reported for deletio...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12311.html">Re: Riak CS 1.4.1 bug? InvalidAccessKeyId reported fo...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12313.html">Invalid hintfiles (was: Riak CS 1.4.1 bug? Invali...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12314.html">Re: Invalid hintfiles (was: Riak CS 1.4.1 bug...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12315.html">Re: Invalid hintfiles</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12316.html">Re: Invalid hintfiles</a></span> <span class="sender italic">Seth Thomas</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Invalid hintfiles</span> <span class="sender italic">Toby Corkindale</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12317.html">Re: Invalid hintfiles</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12318.html">Re: Invalid hintfiles</a></span> <span class="sender italic">Andrew Stone</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12320.html">Re: Invalid hintfiles</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12321.html">Re: Invalid hintfiles</a></span> <span class="sender italic">Andrew Stone</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Invalid hintfiles">
<input type="hidden" name="msgid" value="5248CFFD.8010705@strategicdata.com.au">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12430.html">
<input type="submit" value=" Toby Corkindale ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Invalid+hintfiles%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12316.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12317.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5248CFFD.8010705@strategicdata.com.au</li>
</ul>
</div>
</body>
</html>
