<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak in Docker - Error folding keys - incomplete_hint</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd8.html#16698" id="c">
<link rel="index" href="mail8.html#16698" id="i">
<link rel="prev" href="msg16697.html" id="p">
<link rel="next" href="msg16699.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16698.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+in+Docker+%5C-+Error+folding+keys+%5C-+incomplete_hint%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak in Docker - Error folding keys - incomplete_hint</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Toby+Corkindale%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Toby Corkindale</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20151022" rel="nofollow">Thu, 22 Oct 2015 16:55:25 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Hector,
You can see the Dockerfile here:
<a  rel="nofollow" href="https://gist.github.com/TJC/cb3184705bc0eacde885">https://gist.github.com/TJC/cb3184705bc0eacde885</a></pre><pre>

It's a work in progress, but also, not that involved.

Ubuntu 14.04 is used as both the docker host, and the docker container.
It's on the btrfs storage driver. (I've had too many issues with the other
two)
The Riak data directory is a volume, and is mounted to an external,
persistent location. (Which is also btrfs)

I suspect there's an issue around Riak shutting down uncleanly when the
docker container is stopped.
I have already had to add this to the start-up each time:
find /var/lib/riak -name &quot;bitcask.*.lock&quot; -delete

So it's clear that Riak is getting killed rather than shutting down
cleanly; but even so, I'd hope that Riak would cope with that, rather than
getting into a permanent state of throwing errors.

Toby


On Fri, 23 Oct 2015 at 00:01 Hector Castro &lt;hectcas...@gmail.com&gt; wrote:

&gt; Can't say I've paid enough attention to the logs in my single-machine
&gt; Riak within Docker setups to confirm.
&gt;
&gt; Do you have the container image definitions somewhere public? That may
&gt; help someone reproduce the issue. Also, did you ensure that the Riak
&gt; data directory is setup as a Docker volume?
&gt;
&gt; Other things that come to mind:
&gt;
&gt; - What OS is the Docker host running?
&gt; - What storage driver are you using for Docker?
&gt; - What file system is the Docker data directory using?
&gt;
&gt; --
&gt; Hector
&gt;
&gt;
&gt; On Thu, Oct 22, 2015 at 2:27 AM, Toby Corkindale &lt;t...@dryft.net&gt; wrote:
&gt; &gt; Anyone?
&gt; &gt;
&gt; &gt; I note that after 24 hours (on a very lightly loaded test cluster) I'm
&gt; still
&gt; &gt; seeing these scroll by a lot - 600 an hour per node.
&gt; &gt; Really curious to know if this is expected behaviour or if this is
&gt; resulting
&gt; &gt; from some kind of node corruption.
&gt; &gt;
&gt; &gt; Cheers
&gt; &gt; Toby
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, 21 Oct 2015 at 12:23 Toby Corkindale &lt;t...@dryft.net&gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi,
&gt; &gt;&gt; I've been working on getting Riak to run inside Docker containers - in a
&gt; &gt;&gt; multi-machine cluster. (Previous work I've seen has only run Riak as a
&gt; &gt;&gt; cluster all on the same machine.)
&gt; &gt;&gt; I thought I had it cracked, although I tripped up on the existing issue
&gt; &gt;&gt; with Riak and lockfiles[1]. But the nodes have been generating an awful
&gt; lot
&gt; &gt;&gt; of errors like the below, and I wondered if anyone here can give me an
&gt; &gt;&gt; explanation? (And, is it a problem?)
&gt; &gt;&gt;
&gt; &gt;&gt; 2015-10-21 01:19:23.567 [error] &lt;0.24495.0&gt; Error folding keys for
&gt; &gt;&gt; &quot;/var/lib/riak/bitcask.1h/2283596
&gt; &gt;&gt; 30832953580969325755111919221821239459840/2.bitcask.data&quot;:
&gt; &gt;&gt; {incomplete_hint,4}
&gt; &gt;&gt;
&gt; &gt;&gt; 1: Related issues to the lockfiles --
&gt; &gt;&gt; I note that many are closed, but the problem still exists, and is
&gt; &gt;&gt; particularly triggered by using Docker and stopping/killing Riak more
&gt; &gt;&gt; violently than it likes.
&gt; &gt;&gt; <a  rel="nofollow" href="https://github.com/basho/bitcask/issues/163">https://github.com/basho/bitcask/issues/163</a> (closed)
&gt; &gt;&gt; <a  rel="nofollow" href="https://github.com/basho/riak/issues/535">https://github.com/basho/riak/issues/535</a> (open)
&gt; &gt;&gt; <a  rel="nofollow" href="https://github.com/basho/bitcask/issues/167">https://github.com/basho/bitcask/issues/167</a> (closed)
&gt; &gt;&gt; <a  rel="nofollow" href="https://github.com/basho/bitcask/issues/99">https://github.com/basho/bitcask/issues/99</a> (closed)
&gt; &gt;
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16697.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd8.html#16698">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail8.html#16698">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16699.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16682.html">Riak in Docker - Error folding keys - incomplete_hint</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16696.html">Re: Riak in Docker - Error folding keys - incomplete_...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16697.html">Re: Riak in Docker - Error folding keys - incompl...</a></span> <span class="sender italic">Hector Castro</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak in Docker - Error folding keys - inc...</span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16699.html">Re: Riak in Docker - Error folding keys -...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18109.html">Re: Error folding keys - incomplete_...</a></span> <span class="sender italic">Toby Corkindale</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak in Docker - Error folding keys - incomplete_hint">
<input type="hidden" name="msgid" value="CABEgq95aa9S-JrTOpKpxbispuP28P4TBB=TV4d6QGO_uCZPShA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16698.html">
<input type="submit" value=" Toby Corkindale ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+in+Docker+%5C-+Error+folding+keys+%5C-+incomplete_hint%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16697.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16699.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CABEgq95aa9S-JrTOpKpxbispuP28P4TBB=TV4d6QGO_uCZPShA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
