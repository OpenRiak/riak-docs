<!DOCTYPE html>
<html lang="en">
<head>
<title>Help with handling Riak disk failure</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#18441" id="c">
<link rel="index" href="maillist.html#18441" id="i">
<link rel="prev" href="msg18440.html" id="p">
<link rel="next" href="msg18442.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18441.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Help+with+handling+Riak+disk+failure%22&amp;o=newest" rel="nofollow"><span itemprop="name">Help with handling Riak disk failure</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Leo%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Leo</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170919" rel="nofollow">Tue, 19 Sep 2017 10:32:46 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Dear Riak users and experts,

I really appreciate any help with my questions below.</pre><pre>

I have a 3 node Riak cluster with each having approx. 1 TB disk usage.
All of a sudden, one node's hard disk failed unrecoverably. So, I
added a new node using the following steps:

1) riak-admin cluster join 2) down the failed node 3) riak-admin
force-replace failed-node new-node 4) riak-admin cluster plan 5)
riak-admin cluster commit.

This almost fixed the problem except that after lots of data transfers
and handoffs, now not all three nodes have 1 TB disk usage. Only two
of them have 1 TB disk usage. The other one is almost empty (few 10s
of GBs). This means there are no longer 3 copies on disk anymore. My
data is completely random (no two keys have same data associated with
them. So, compression of data cannot be the reason for less data on
disk),

I also tried using the &quot;riak-admin cluster replace failednode newnode&quot;
command so that the leaving node handsoff data to the joining node.
This however is not helpful if the leaving node has a failed hard
disk. I want the remaining live vnodes to help the new node recreate
the lost data using their replica copies.

I have three questions:

1) What commands should I run to forcefully make sure there are three
replicas on disk overall without waiting for read-repair or
anti-entropy to make three copies ? Bandwidth usage or CPU usage is
not a huge concern for me.

2) Also, I will be very grateful if someone lists the commands that I
can run using &quot;riak attach&quot; so that I can clear the AAE trees and
forcefully make sure all data has 3 copies.

3) I will be very thankful if someone helps me with the commands that
I should run to ensure that all data has 3 replicas on disk after the
disk failure (instead of just looking at the disk space usage in all
the nodes as hints)?

Thanks,
Leo

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18440.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#18441">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18441">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18442.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Help with handling Riak disk failure</span> <span class="sender italic">Leo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18442.html">Re: Help with handling Riak disk failure</a></span> <span class="sender italic">Bryan Hunt</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18443.html">Re: Help with handling Riak disk failure</a></span> <span class="sender italic">Leo</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18444.html">Re: Help with handling Riak disk failure</a></span> <span class="sender italic">Bryan Hunt</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18445.html">Re: Help with handling Riak disk failure</a></span> <span class="sender italic">Leo</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Help with handling Riak disk failure">
<input type="hidden" name="msgid" value="CAKxKembccjmoos=9iebHz1-ywaG1fTHsuojLx-yioXa5FaM=EQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18441.html">
<input type="submit" value=" Leo ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Help+with+handling+Riak+disk+failure%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18440.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18442.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAKxKembccjmoos=9iebHz1-ywaG1fTHsuojLx-yioXa5FaM=EQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
