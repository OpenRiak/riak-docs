<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Upgrade from 1.3.1 to 1.4.2 => high IO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#13188" id="c">
<link rel="index" href="mail5.html#13188" id="i">
<link rel="prev" href="msg13185.html" id="p">
<link rel="next" href="msg13186.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13188.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Upgrade+from+1.3.1+to+1.4.2+%3D%3E+high+IO%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Upgrade from 1.3.1 to 1.4.2 => high IO</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Von%5C-Maszewski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Von-Maszewski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131210" rel="nofollow">Tue, 10 Dec 2013 07:44:16 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>The sad truth is that you are not the first to see this problem.  And yes, it 
has to do with your 950GB per node dataset.  And no, nothing to do but sit 
through it at this time.</pre><pre>

While I did extensive testing around upgrade times before shipping 1.4, 
apparently there are data configurations I did not anticipate.  You are likely 
seeing a cascade where a shift of one file from level-1 to level-2 is causing a 
shift of another file from level-2 to level-3, which causes a level-3 file to 
shift to level-4, etc â€¦ then the next file shifts from level-1.

The bright side of this pain is that you will end up with better write 
throughput once all the compaction ends.

Riak 2.0's leveldb has code to prevent/reduce compaction cascades, but that is 
not going to help you today.

Matthew

On Dec 10, 2013, at 10:26 AM, Simon Effenberg &lt;seffenb...@team.mobile.de&gt; wrote:

&gt; Hi @list,
&gt; 
&gt; I'm trying to upgrade our Riak cluster from 1.3.1 to 1.4.2 .. after
&gt; upgrading the first node (out of 12) this node seems to do many merges.
&gt; the sst_* directories changes in size &quot;rapidly&quot; and the node is having
&gt; a disk utilization of 100% all the time.
&gt; 
&gt; I know that there is something like that:
&gt; 
&gt; &quot;The first execution of 1.4.0 leveldb using a 1.3.x or 1.2.x dataset
&gt; will initiate an automatic conversion that could pause the startup of
&gt; each node by 3 to 7 minutes. The leveldb data in &quot;level #1&quot; is being
&gt; adjusted such that &quot;level #1&quot; can operate as an overlapped data level
&gt; instead of as a sorted data level. The conversion is simply the
&gt; reduction of the number of files in &quot;level #1&quot; to being less than eight
&gt; via normal compaction of data from &quot;level #1&quot; into &quot;level #2&quot;. This is
&gt; a one time conversion.&quot;
&gt; 
&gt; but it looks much more invasive than explained here or doesn't have to
&gt; do anything with the (probably seen) merges.
&gt; 
&gt; Is this &quot;normal&quot; behavior or could I do anything about it?
&gt; 
&gt; At the moment I'm stucked with the upgrade procedure because this high
&gt; IO load would probably lead to high response times.
&gt; 
&gt; Also we have a lot of data (per node ~950 GB).
&gt; 
&gt; Cheers
&gt; Simon
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13185.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#13188">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail5.html#13188">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13186.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13185.html">Upgrade from 1.3.1 to 1.4.2 =&gt; high IO</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Upgrade from 1.3.1 to 1.4.2 =&gt; high IO</span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13186.html">Re: Upgrade from 1.3.1 to 1.4.2 =&gt; high ...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13189.html">Re: Upgrade from 1.3.1 to 1.4.2 =&gt; h...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13190.html">Re: Upgrade from 1.3.1 to 1.4.2 =&g...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13202.html">Re: Upgrade from 1.3.1 to 1.4....</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13203.html">Re: Upgrade from 1.3.1 to ...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13204.html">Re: Upgrade from 1.3.1...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email"><span class="subject"><a href="msg13205.html">Re: Upgrade from 1.3.1...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg13206.html">Re: Upgrade from 1.3.1...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email"><span class="subject"><a href="msg13207.html">Re: Upgrade from 1.3.1...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email"><span class="subject"><a href="msg13208.html">Re: Upgrade from 1.3.1...</a></span> <span class="sender italic">Simon Effenberg</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Upgrade from 1.3.1 to 1.4.2 =&gt; high IO">
<input type="hidden" name="msgid" value="06FAA484-B308-4ED0-8087-971B25A53ED6@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13188.html">
<input type="submit" value=" Matthew Von-Maszewski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Upgrade+from+1.3.1+to+1.4.2+%3D%3E+high+IO%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13185.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13186.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">06FAA484-B308-4ED0-8087-971B25A53ED6@basho.com</li>
</ul>
</div>
</body>
</html>
