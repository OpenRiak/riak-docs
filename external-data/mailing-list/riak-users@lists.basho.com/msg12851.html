<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Java client blocked at shutdown?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd7.html#12851" id="c">
<link rel="index" href="mail7.html#12851" id="i">
<link rel="prev" href="msg12850.html" id="p">
<link rel="next" href="msg12857.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12851.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+blocked+at+shutdown%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Java client blocked at shutdown?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Guido+Medina%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Guido Medina</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131105" rel="nofollow">Tue, 05 Nov 2013 06:07:51 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<tt>You may be right, we are still investigating other 2 threads, was worth 
</tt><tt>to add this one to the list just in case, daemon threads by contract 
</tt><tt>should go down with no issues when JDK is going down.
</tt><pre style="margin: 0em;">

Guido.</pre><pre>

On 05/11/13 13:59, Konstantin Kalin wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><tt>Strange. If you call shutdown of Riak client it shouldn't stop Tomcat 
</tt><tt>shutdown anymore. This is that I learn from source code. I called the 
</tt><tt>method in Servlet listener and never had issues after that. Before I 
</tt><tt>had similar behavior like you have.
</tt><pre style="margin: 0em;">

Thank you,
Konstantin.

</pre><tt>On Nov 5, 2013 5:31 AM, &quot;Guido Medina&quot; &lt;guido.med...@temetra.com 
</tt><tt>&lt;<a  rel="nofollow" href="mailto:guido.med...@temetra.com">mailto:guido.med...@temetra.com</a>&gt;&gt; wrote:
</tt><pre style="margin: 0em;">

    That's done already, I'm looking at the source now, not sure of
    the following timer needs to be cancelled when Riak client
    shutdown method is called:


    public abstract class RiakStreamClient&lt;T&gt; implements Iterable&lt;T&gt; {

        static Timer TIMER = new Timer(&quot;riak-stream-timeout-thread&quot;,
    true);
        ...
        ...
    }

    Guido.

    On 05/11/13 13:29, Konstantin Kalin wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
    You need to call shutdown method of Riak client when you are
    stopping your application.

    Thank you,
    Konstantin.

    On Nov 5, 2013, at 5:06, Guido Medina &lt;guido.med...@temetra.com
    &lt;<a  rel="nofollow" href="mailto:guido.med...@temetra.com">mailto:guido.med...@temetra.com</a>&gt;&gt; wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
    Sorry, I meant &quot;stopping Tomcat from shutting down properly&quot;...I
    must have been thinking of some FPS night game.

    On 05/11/13 13:04, Guido Medina wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
    Hi,

    We are tracing some threads at our webapp which are stopping
    Tomcat from shooting down properly, one of them seems to be
    related with Riak Java client, here is the repeating stack
    trace once all services have been stopped properly:

    *Thread Name:* riak-stream-timeout-thread
    *State:* in Object.wait()
    *Java Stack trace:*
    at java.lang.Object.wait(Native Method)
    - waiting on [0x00000004bb4001a0] (a java.util.TaskQueue)
    at java.lang.Object.wait(Object.java:503)
    at java.util.TimerThread.mainLoop(Timer.java:526)
    - locked [0x00000004bb4001a0] (a java.util.TaskQueue)
    at java.util.TimerThread.run(Timer.java:505)


    Thanks for the help,

    Guido.
</pre></blockquote><pre style="margin: 0em;">

    _______________________________________________
    riak-users mailing list
    riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
    <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12850.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd7.html#12851">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail7.html#12851">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12857.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12843.html">Java client blocked at shutdown?</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12844.html">Re: Java client blocked at shutdown?</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12846.html">Re: Java client blocked at shutdown?</a></span> <span class="sender italic">Konstantin Kalin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12847.html">Re: Java client blocked at shutdown?</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12848.html">Re: Java client blocked at shutdown?</a></span> <span class="sender italic">Guido Medina</span></li>
<li class="icons-email"><span class="subject"><a href="msg12850.html">Re: Java client blocked at shutdown?</a></span> <span class="sender italic">Konstantin Kalin</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Java client blocked at shutdown...</span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12857.html">Re: Java client blocked at shut...</a></span> <span class="sender italic">Brian Roach</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Java client blocked at shutdown?">
<input type="hidden" name="msgid" value="5278FB3D.3040806@temetra.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12851.html">
<input type="submit" value=" Guido Medina ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Java+client+blocked+at+shutdown%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12850.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12857.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5278FB3D.3040806@temetra.com</li>
</ul>
</div>
</body>
</html>
