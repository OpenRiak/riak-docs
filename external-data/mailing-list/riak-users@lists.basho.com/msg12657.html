<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Read Before Writes on Distributed Counters</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd8.html#12657" id="c">
<link rel="index" href="mail8.html#12657" id="i">
<link rel="prev" href="msg12656.html" id="p">
<link rel="next" href="msg12658.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12657.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Read+Before+Writes+on+Distributed+Counters%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Read Before Writes on Distributed Counters</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Weston+Jossey%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Weston Jossey</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131017" rel="nofollow">Thu, 17 Oct 2013 07:37:59 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Great everyone, thank you.

@Russell:  I specifically work with either Go (
<a  rel="nofollow" href="https://github.com/tpjg/goriakpbc">https://github.com/tpjg/goriakpbc</a>) or Ruby (basho client).  I haven't
tested the ruby client, but I'd assume it will perform the write without
the read (based on my reading of the code).  The Go library, on the other
hand, currently always performs a read prior to the write.  It's an easy
patch that I've already applied locally for benchmarking, I just didn't
want to submit the PR till I was sure this was the correct behavior.</pre><pre>

Somewhat off topic, but I dont' want to open up another thread if it's
unnecessary.  This questions arose because I've been doing extensive
benchmarking around distributed counters.  Are there pre-existing
benchmarks out there that I can measure myself against?  I haven't stumbled
across many at this point, probably because of how new it is.

Cheers,
Wes


On Thu, Oct 17, 2013 at 10:21 AM, Russell Brown &lt;russell.br...@mac.com&gt;wrote:

&gt; Hi Wes,
&gt;
&gt; The client application does not need to perform a read before a write, the
&gt; riak server must read from disk before updating the counter. Or at least it
&gt; must with our current implementation.
&gt;
&gt; What PRs did you have in mind? I'm curious.
&gt;
&gt; Oh, it looks like Sam beat me to itâ€¦to elaborate on his &quot;not idempotent&quot;
&gt; line, that means when riak tells you &quot;error&quot; for some counter increment, it
&gt; may only be a partial failure, and re-running the operation may lead to
&gt; over counting.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt; On 17 Oct 2013, at 16:03, Weston Jossey &lt;weston.jos...@gmail.com&gt; wrote:
&gt;
&gt; &gt; In the context of using distributed counters (introduced in 1.4), is it
&gt; strictly necessary to perform a read prior to issue a write for a given
&gt; key?  A la, if I want to blindly increment a value by 1, regardless of what
&gt; its current value is, is it sufficient to issue the write without
&gt; previously having read the object?
&gt; &gt;
&gt; &gt; I ask because looking at some of the implementations for counters in the
&gt; open source community, it's common to perform a read before a write, which
&gt; impacts performance ceilings on clusters with high volume reads / writes.
&gt;  I want to verify before issuing some PRs that this is in fact safe
&gt; behavior.
&gt; &gt;
&gt; &gt; Thank you!
&gt; &gt; -Wes Jossey
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12656.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd8.html#12657">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail8.html#12657">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12658.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12654.html">Re: Read Before Writes on Distributed Counters</a></span> <span class="sender italic">Sam Elliott</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12660.html">Re: Read Before Writes on Distributed Counters</a></span> <span class="sender italic">Daniil Churikov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12661.html">Re: Read Before Writes on Distributed Counters</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12663.html">Re: Read Before Writes on Distributed Counte...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12664.html">Re: Read Before Writes on Distributed Co...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12672.html">Re: Read Before Writes on Distributed Counte...</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12673.html">Re: Read Before Writes on Distributed Co...</a></span> <span class="sender italic">wjossey</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12662.html">Re: Read Before Writes on Distributed Counters</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg12665.html">Re: Read Before Writes on Distributed Counters</a></span> <span class="sender italic">Russell Brown</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12656.html">Re: Read Before Writes on Distributed Counters</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Read Before Writes on Distributed Counters</span> <span class="sender italic">Weston Jossey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12658.html">Re: Read Before Writes on Distributed Counters</a></span> <span class="sender italic">Russell Brown</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Read Before Writes on Distributed Counters">
<input type="hidden" name="msgid" value="CAJPTeOYHBwe6S39KHqJyoWvSqvkx-8=o8CFWUWvCHnROQBQBkQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12657.html">
<input type="submit" value=" Weston Jossey ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Read+Before+Writes+on+Distributed+Counters%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12656.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12658.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAJPTeOYHBwe6S39KHqJyoWvSqvkx-8=o8CFWUWvCHnROQBQBkQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
