<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: external http calls from map functions?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00058" id="c">
<link rel="index" href="maillist.html#00058" id="i">
<link rel="prev" href="msg00056.html" id="p">
<link rel="next" href="msg00059.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00058.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+external+http+calls+from+map+functions%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: external http calls from map functions?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Eric+Gaumer%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Eric Gaumer</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100416" rel="nofollow">Fri, 16 Apr 2010 06:46:51 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Check out:

<a  rel="nofollow" href="http://github.com/kungfooguru/erlastic_search">http://github.com/kungfooguru/erlastic_search</a></pre><pre>

Which is an Erlang ElasticSearch client. You may also want to look at the
pre/post commit hooks in Riak because they offer a nice integration point
(as opposed to building the index all at once).

Keep in mind that regardless, HTTP has a high overhead when it comes to
message passing semantics. We've achieved indexing speeds of about 10K
docs/sec (over HTTP) but we *always* using batching. I don't think ES has a
batch submission endpoint. In this case SOLR may be a better fit because
your map phase can build/submit batches and reduce the number of HTTP calls
(batching will no doubt provide better performance than mere parallelism of
single document submissions).

Of course you'll have to partition the data yourself which can be quite a
pain when you want to grow/shrink the Solr cluster (i.e., no elasticity).
Adding a batch API to ES shouldn't be too difficult. You might want to hit
Shay up and see what he says.

Of course you could sit tight and wait for Riak Search.

-Eric


On Fri, Apr 16, 2010 at 9:06 AM, Kevin Smith &lt;ksm...@basho.com&gt; wrote:

&gt; The only restrictions on map/reduce functions are a) they must return lists
&gt; and b) the entire job must execute before the timeout period elapses (60
&gt; seconds is the default).  Javascript functions have the additional
&gt; restriction of not being able to call back into Erlang code due to the
&gt; current state of Erlang/Javascript integration.
&gt;
&gt; The easiest way to do this would be to write your function in Erlang and
&gt; use either httpc (packaged with Erlang) or ibrowse (
&gt; <a  rel="nofollow" href="http://github.com/cmullaparthi/ibrowse">http://github.com/cmullaparthi/ibrowse</a>) to make the HTTP calls. If you're
&gt; comfortable with Erlang &amp; OTP I'd recommend making a separate OTP
&gt; application to handle the HTTP calls and provide an API for your map/reduce
&gt; functions to use This design moves the HTTP calls out of the query flow and
&gt; prevents a hanging HTTP call from timing out a query.
&gt;
&gt; --Kevin
&gt; On Apr 15, 2010, at 11:20 PM, Colin Surprenant wrote:
&gt;
&gt; &gt; I'll rephrase my question:
&gt; &gt;
&gt; &gt; Is it possible to call external http services from a map function in
&gt; &gt; JavaScript and/or Erlang? Any comments/pointers appreciated.
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt; Colin
&gt; &gt;
&gt; &gt; On Thu, Apr 15, 2010 at 12:44 PM, Colin Surprenant &lt;colin....@gmail.com&gt;
&gt; wrote:
&gt; &gt;&gt; Hi,
&gt; &gt;&gt;
&gt; &gt;&gt; I am trying to figure what the fastest way would be to send a
&gt; &gt;&gt; mapreduce result set for indexing into a searchengine system like
&gt; &gt;&gt; elasticsearch.
&gt; &gt;&gt;
&gt; &gt;&gt; Of course, the trivial way to do it would be to simply gather the
&gt; &gt;&gt; result set and push it back into the indexer using their http/rest
&gt; &gt;&gt; api.
&gt; &gt;&gt;
&gt; &gt;&gt; Now, elasticsearch is distributed by nature and will allow parallel
&gt; &gt;&gt; queries for document insertion for indexing. One way to leverage this
&gt; &gt;&gt; would be to actually directly push a document from within a map
&gt; &gt;&gt; function into the indexer using their rest api. This would completely
&gt; &gt;&gt; distribute the index creation process and leverage the parallelism of
&gt; &gt;&gt; elasticsearch.
&gt; &gt;&gt;
&gt; &gt;&gt; Would this be possible?
&gt; &gt;&gt;
&gt; &gt;&gt; Is this something I could do using the JavaScript mapreduce? and/or
&gt; Erlang?
&gt; &gt;&gt;
&gt; &gt;&gt; Thanks,
&gt; &gt;&gt; Colin
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00056.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00058">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00058">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00059.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00051.html">external http calls from map functions?</a></span> <span class="sender italic">Colin Surprenant</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00054.html">Re: external http calls from map functions?</a></span> <span class="sender italic">Colin Surprenant</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00056.html">Re: external http calls from map functions?</a></span> <span class="sender italic">Kevin Smith</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: external http calls from map functions?</span> <span class="sender italic">Eric Gaumer</span></li>
<li class="icons-email"><span class="subject"><a href="msg00059.html">Re: external http calls from map functions?</a></span> <span class="sender italic">Colin Surprenant</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00062.html">Re: external http calls from map functio...</a></span> <span class="sender italic">Eric Gaumer</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: external http calls from map functions?">
<input type="hidden" name="msgid" value="z2l79238eb51004160646t7f2bd83fua51f0e26cf9b4789@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00058.html">
<input type="submit" value=" Eric Gaumer ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+external+http+calls+from+map+functions%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00056.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00059.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">z2l79238eb51004160646t7f2bd83fua51f0e26cf9b4789@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
