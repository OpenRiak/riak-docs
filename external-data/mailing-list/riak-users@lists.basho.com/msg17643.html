<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: RIAK TS installed nodes not connecting</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17643" id="c">
<link rel="index" href="maillist.html#17643" id="i">
<link rel="prev" href="msg17644.html" id="p">
<link rel="next" href="#" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17643.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+RIAK+TS+installed+nodes+not+connecting%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: RIAK TS installed nodes not connecting</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Agtmaal%2C+Joris+van%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Agtmaal, Joris van</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160914" rel="nofollow">Wed, 14 Sep 2016 02:14:46 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Stephen

I’m using emr-4.7.1 (Spark 1.6.1)  EMR cluster to run pyspark through zeppelin. 
I’ve downloaded the spark-riak-connector Jar file (Version: 1.6.0 ( 16d483 | 
zip | jar ) / Date: 2016-09-07 / License: Apache-2.0 / Scala version: 2.10) 
from <a  rel="nofollow" href="https://spark-packages.org/package/basho/spark-riak-connector">https://spark-packages.org/package/basho/spark-riak-connector</a> onto the EMR 
master node.</pre><pre>

My complete zeppelin script is as follows:

%dep
z.reset()
z.load(&quot;/home/hadoop/spark-riak-connector_2.10-1.6.0.jar&quot;)

%pyspark
import riak, datetime, time, random

host='172.31.00.00’
pb_port = '8087'
hostAndPort = &quot;:&quot;.join([host, pb_port])
client = riak.RiakClient(host=host, pb_port=pb_port)
table=client.table(&quot;test&quot;)

%pyspark
site = 'AA'
species = 'fff'
start_date = int(time.time())
events = []
for i in range(9):
    measurementDate = start_date + i
    value = random.uniform(-20, 110)
    events.append([site, species, measurementDate, value])

end_date = measurementDate

for e in events:
    print e


testRDD = sc.parallelize(events)
df = testRDD.toDF(['site', 'species','measurementDate','value'])
df.show()

               %pyspark
df.write \
    .format('org.apache.spark.sql.riak') \
    .option('spark.riak.connection.host', '172.31.41.86:8087') \
    .mode('Append') \
    .save('test')

If i run pyspark from the masternode directly with –jars 
&quot;/home/hadoop/spark-riak-connector_2.10-1.6.0.jar&quot; it gives me the same error 
message as above.
If i run pyspark from the masternode directly without the --jar file argument 
it will give the error as below (same in zeppelin), so it seems the package is 
found.

py4j.protocol.Py4JJavaError: An error occurred while calling o61.save.
: java.lang.ClassNotFoundException: Failed to find data source: 
org.apache.spark.sql.riak. Please find packages at <a  rel="nofollow" href="http://spark-packages.org">http://spark-packages.org</a>
        at 
org.apache.spark.sql.execution.datasources.ResolvedDataSource$.lookupDataSource(ResolvedDataSource.scala:77)
        at 
org.apache.spark.sql.execution.datasources.ResolvedDataSource$.apply(ResolvedDataSource.scala:219)
...

Thanks for the help!

Kind Regards,
Joris van Agtmaal
+(0) 6 25 39 39 06

From: Stephen Etheridge [<a  rel="nofollow" href="mailto:setheri...@basho.com">mailto:setheri...@basho.com</a>]
Sent: 13 September 2016 14:45
To: Agtmaal, Joris van &lt;joris.vanagtm...@wartsila.com&gt;
Cc: riak-users@lists.basho.com; Manu Marchal &lt;emarc...@basho.com&gt;
Subject: Re: RIAK TS installed nodes not connecting

Hi Joris,

I have looked at the tutorial you have been following but I confess I am 
confused.  In the example you are following I do not see where the spark and 
sql contexts are created.  I use PySpark through the Jupyter notebook and I 
have to specify a path to the connector on invoking the jupyter notebook. Is it 
possible for you to share all your code (and how you are invoking zeppelin) 
with me so I can trace everything through?

regards
Stephen

On Mon, Sep 12, 2016 at 3:27 PM, Agtmaal, Joris van 
&lt;joris.vanagtm...@wartsila.com&lt;<a  rel="nofollow" href="mailto:joris.vanagtm...@wartsila.com">mailto:joris.vanagtm...@wartsila.com</a>&gt;&gt; wrote:
Hi

I’m new to Riak and followed the installation instructions to get it working on 
an AWS cluster (3 nodes).

So far ive been able to use Riak in pyspark (zeppelin) to create/read/write 
tables, but i would like to use the dataframes directly from spark, using the 
Spark-Riak Connector.
When following the example found here: 
<a  rel="nofollow" href="http://docs.basho.com/riak/ts/1.4.0/add-ons/spark-riak-connector/quick-start/#python">http://docs.basho.com/riak/ts/1.4.0/add-ons/spark-riak-connector/quick-start/#python</a>
But i run into trouble on this last part:

host= my_ip_adress_of_riak_node
pb_port = '8087'
hostAndPort = &quot;:&quot;.join([host, pb_port])
client = riak.RiakClient(host=host, pb_port=pb_port)

df.write \
    .format('org.apache.spark.sql.riak') \
    .option('spark.riak.connection.host', hostAndPort) \
    .mode('Append') \
    .save('test')

Important to note that i’m using a local download of the Jar file that is 
loaded into the pyspark interpreter in zeppeling through:
%dep
z.reset()
z.load(&quot;/home/hadoop/spark-riak-connector_2.10-1.6.0.jar&quot;)

Here is the error message i get back:
Py4JJavaError: An error occurred while calling o569.save. : 
java.lang.NoClassDefFoundError: com/basho/riak/client/core/util/HostAndPort at 
com.basho.riak.spark.rdd.connector.RiakConnectorConf$.apply(RiakConnectorConf.scala:76)
 at 
com.basho.riak.spark.rdd.connector.RiakConnectorConf$.apply(RiakConnectorConf.scala:89)
 at org.apache.spark.sql.riak.RiakRelation$.apply(RiakRelation.scala:115) at 
org.apache.spark.sql.riak.DefaultSource.createRelation(DefaultSource.scala:51) 
at 
org.apache.spark.sql.execution.datasources.ResolvedDataSource$.apply(ResolvedDataSource.scala:222)
 at org.apache.spark.sql.DataFrameWriter.save(DataFrameWriter.scala:148) at 
org.apache.spark.sql.DataFrameWriter.save(DataFrameWriter.scala:139) at 
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at 
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) 
at 
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 at java.lang.reflect.Method.invoke(Method.java:606) at 
py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:231) at 
py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:381) at 
py4j.Gateway.invoke(Gateway.java:259) at 
py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:133) at 
py4j.commands.CallCommand.execute(CallCommand.java:79) at 
py4j.GatewayConnection.run(GatewayConnection.java:209) at 
java.lang.Thread.run(Thread.java:745) (&lt;class 'py4j.protocol.Py4JJavaError'&gt;, 
Py4JJavaError(u'An error occurred while calling o569.save.\n', JavaObject 
id=o570), &lt;traceback object at 0x7f7021bb0200&gt;)

Hope somebody can help out.
thanks, joris

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



--
{ &quot;name&quot; : &quot;Stephen Etheridge&quot;,
   &quot;title&quot; : &quot;Solution Architect, EMEA&quot;,
   &quot;Organisation&quot; : &quot;Basho Technologies, Inc&quot;,
   &quot;Telephone&quot; : &quot;07814 406662&quot;,
   &quot;email&quot; : &quot;<a  rel="nofollow" href="mailto:setheri...@basho.com">mailto:setheri...@basho.com</a>&lt;<a  rel="nofollow" href="mailto:setheri...@basho.com">mailto:setheri...@basho.com</a>&gt;&quot;,
   &quot;github&quot; : &quot;<a  rel="nofollow" href="http://github.com/datalemming&quot">http://github.com/datalemming&quot</a>;,
   &quot;twitter&quot; : &quot;@datalemming&quot;}

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17644.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17643">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17643">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright buttondisabled" accesskey="n" href="#">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17638.html">RIAK TS installed nodes not connecting</a></span> <span class="sender italic">Agtmaal, Joris van</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17640.html">Re: RIAK TS installed nodes not connecting</a></span> <span class="sender italic">Stephen Etheridge</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17641.html">Re: RIAK TS installed nodes not connecting</a></span> <span class="sender italic">Alex Moore</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17644.html">RE: RIAK TS installed nodes not connecting</a></span> <span class="sender italic">Agtmaal, Joris van</span></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">RE: RIAK TS installed nodes not connecting</span> <span class="sender italic">Agtmaal, Joris van</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: RIAK TS installed nodes not connecting">
<input type="hidden" name="msgid" value="VI1PR0401MB172520F618E5FA87A34A3332FBFE0@VI1PR0401MB1725.eurprd04.prod.outlook.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17643.html">
<input type="submit" value=" Agtmaal, Joris van ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+RIAK+TS+installed+nodes+not+connecting%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17644.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="#" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">VI1PR0401MB172520F618E5FA87A34A3332FBFE0@VI1PR0401MB1725.eurprd04.prod.outlook.com</li>
</ul>
</div>
</body>
</html>
