<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: Pending transfers when joining 1.0.3 node to 1.0.0 cluster</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06311" id="c">
<link rel="index" href="mail2.html#06311" id="i">
<link rel="prev" href="msg06310.html" id="p">
<link rel="next" href="msg06312.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06311.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Pending+transfers+when+joining+1.0.3+node+to+1.0.0+cluster%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: Pending transfers when joining 1.0.3 node to 1.0.0 cluster</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Fredrik+Lindstr%C3%B6m%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Fredrik Lindström</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120118" rel="nofollow">Wed, 18 Jan 2012 14:08:29 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Thanks for the response Aphyr.

I'm seeing Waiting on: [riak_search_vnode,riak_kv_vnode,riak_pipe_vnode] 
instead of [] so I'm thinking it's a different scenario.
It might be worth mentioning that the data directory on the new node does 
contain relevant subdirectories but the disk footprint is so small I doubt any 
data has been transferred.</pre><pre>

/F
________________________________
From: Aphyr [ap...@aphyr.com]
Sent: Wednesday, January 18, 2012 10:46 PM
To: Fredrik Lindström
Cc: riak-users@lists.basho.com
Subject: Re: Pending transfers when joining 1.0.3 node to 1.0.0 cluster

<a  rel="nofollow" href="https://github.com/basho/riak/blob/riak-1.0.2/RELEASE-NOTES.org">https://github.com/basho/riak/blob/riak-1.0.2/RELEASE-NOTES.org</a>

If partition transfer is blocked awaiting [] (as opposed to [kv_vnode] or 
whatever), There's a snippet in there that might be helpful.

--Kyle

On Jan 18, 2012, at 1:43 PM, Fredrik Lindström wrote:

After some digging I found a suggestion from Joseph Blomstedt in an earlier 
mail thread
<a  rel="nofollow" href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2012-January/007116.html">http://lists.basho.com/pipermail/riak-users_lists.basho.com/2012-January/007116.html</a>

in the riak console:
riak_core_ring_manager:force_update().
riak_core_vnode_manager:force_handoffs().

The symptoms would appear to be the same although the cluster referenced in the 
mail thread does not appear to have search enabled,
as far as I can tell from the log snippets. The mail thread doesn't really 
specify which node to run the commands on so I tried both the new node and the 
current claimant of the cluster.

Sadly the suggested steps did not produce any kind of ownership handoff.

Any helpful ideas would be much appreciated :)

/F


________________________________
From: 
riak-users-boun...@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users-boun...@lists.basho.com">mailto:riak-users-boun...@lists.basho.com</a>&gt; 
[riak-users-boun...@lists.basho.com] on behalf of Fredrik Lindström 
[fredrik.lindst...@qbranch.se]
Sent: Wednesday, January 18, 2012 4:00 PM
To: riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
Subject: Pending transfers when joining 1.0.3 node to 1.0.0 cluster

Hi everyone,
when we try to join a 1.0.3 node to an existing 1.0.0 (3 node) cluster the 
ownership transfer doesn't appear to take place. I'm guessing that we're making 
some stupid little mistake but we can't figure it out at the moment. Anyone run 
into something similar?

Riak Search is enabled on the original nodes in the cluster as well as the new 
node.
Ring size is set to 128

The various logfiles do not appear to contain any errors or warnings

Output from riak-admin member_status
================================= Membership ==================================
Status     Ring    Pending    Node
-------------------------------------------------------------------------------
valid      33.6%     25.0%    
'qbkp...@qbkpx01.ad.qnet.local&lt;mailto:'qbkp...@qbkpx01.ad.qnet.local&gt;'
valid      33.6%     25.0%    
'qbkp...@qbkpx02.ad.qnet.local&lt;mailto:'qbkp...@qbkpx02.ad.qnet.local&gt;'
valid      32.8%     25.0%    
'qbkp...@qbkpx03.ad.qnet.local&lt;mailto:'qbkp...@qbkpx03.ad.qnet.local&gt;'
valid       0.0%     25.0%    
't...@qbkpxadmin01.ad.qnet.local&lt;mailto:'t...@qbkpxadmin01.ad.qnet.local&gt;'
-------------------------------------------------------------------------------

Output from riak-admin ring_status
See attached file

Output from riak-admin transfers
't...@qbkpxadmin01.ad.qnet.local&lt;mailto:'t...@qbkpxadmin01.ad.qnet.local&gt;' 
waiting to handoff 10 partitions
'qbkp...@qbkpx03.ad.qnet.local&lt;mailto:'qbkp...@qbkpx03.ad.qnet.local&gt;' waiting 
to handoff 62 partitions
'qbkp...@qbkpx01.ad.qnet.local&lt;mailto:'qbkp...@qbkpx01.ad.qnet.local&gt;' waiting 
to handoff 63 partitions


/F


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06310.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06311">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#06311">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06312.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06305.html">Pending transfers when joining 1.0.3 node to 1.0.0 clus...</a></span> <span class="sender italic">Fredrik Lindström</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06309.html">RE: Pending transfers when joining 1.0.3 node to 1...</a></span> <span class="sender italic">Fredrik Lindström</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06310.html">Re: Pending transfers when joining 1.0.3 node ...</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: Pending transfers when joining 1.0.3 n...</span> <span class="sender italic">Fredrik Lindström</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06312.html">Re: Pending transfers when joining 1.0...</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06313.html">RE: Pending transfers when joinin...</a></span> <span class="sender italic">Fredrik Lindström</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06314.html">Re: Pending transfers when jo...</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06315.html">Re: Pending transfers whe...</a></span> <span class="sender italic">Joseph Blomstedt</span></li>
<li class="icons-email"><span class="subject"><a href="msg06318.html">RE: Pending transfers whe...</a></span> <span class="sender italic">Fredrik Lindström</span></li>
<li class="icons-email"><span class="subject"><a href="msg06519.html">RE: Pending transfers whe...</a></span> <span class="sender italic">Fredrik Lindström</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: Pending transfers when joining 1.0.3 node to 1.0.0 cluster">
<input type="hidden" name="msgid" value="E59E28245D943A47A424FC2C44978220011DC00608@qbmail01.ad.qbranch.se">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06311.html">
<input type="submit" value=" Fredrik Lindström ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Pending+transfers+when+joining+1.0.3+node+to+1.0.0+cluster%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06310.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06312.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">E59E28245D943A47A424FC2C44978220011DC00608@qbmail01.ad.qbranch.se</li>
</ul>
</div>
</body>
</html>
