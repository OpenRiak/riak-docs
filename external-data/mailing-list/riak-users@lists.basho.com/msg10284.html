<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: MapReduce scalability</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10284" id="c">
<link rel="index" href="maillist.html#10284" id="i">
<link rel="prev" href="msg10283.html" id="p">
<link rel="next" href="msg10285.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10284.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+MapReduce+scalability%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: MapReduce scalability</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Bernard+Fouch%C3%A9%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Bernard Fouché</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130228" rel="nofollow">Thu, 28 Feb 2013 05:55:01 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Christian,

</pre><tt>At 
</tt><tt><a  rel="nofollow" href="http://docs.basho.com/riak/1.3.0/references/appendices/MapReduce-Implementation/">http://docs.basho.com/riak/1.3.0/references/appendices/MapReduce-Implementation/</a> 
</tt><tt>, one can read &quot;...any Riak node can also coordinate a MapReduce query 
</tt><tt>by sending a map-step evaluation request directly to the node 
</tt><tt>responsible for maintaining the input data. Map-step results are sent 
</tt><tt>back to the coordinating node, where reduce-step processing can produce 
</tt><tt>a unified result.&quot;.
</tt><pre style="margin: 0em;"></pre><pre>

</pre><tt>What you wrote means that the above description is purely theoretical 
</tt><tt>since if there is any problem to get access to data in a node, then the 
</tt><tt>MR fails. We have also seen that deleting a key while doing a MR just 
</tt><tt>makes the MR to run forever so it makes me think that your description 
</tt><tt>is accurate and for the documentation to be correct it seems that one 
</tt><tt>must first be sure that all input data reading will never trigger any 
</tt><tt>kind of error processing, otherwise the MR job will fail (or be stuck). 
</tt><tt>Please correct me if I've misunderstood!
</tt><pre style="margin: 0em;">

</pre><tt>Now if I want to split processing of a list of keys in the cluster, is 
</tt><tt>there a way to know what node is supposed to have at least one copy of a 
</tt><tt>K/V ?
</tt><pre style="margin: 0em;">

</pre><tt>If so, we can setup our own kind of MR, by sending subset of keys to 
</tt><tt>nodes known to have at least one version of the K/V pair. Hence if R==2, 
</tt><tt>there will be one local read in the node receiving the subset and only 
</tt><tt>one more read in another node that holds a copy. Then this distributed 
</tt><tt>processing can handle read-repair, aggregate data and send the result to 
</tt><tt>the coordinating node.
</tt><pre style="margin: 0em;">

Best Regards,

        Bernard

Le 28/02/2013 10:32, Christian Dahlqvist a écrit :
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Boris,

</pre><tt>Apart from not scaling quite as well as straight K/V access, emulating 
</tt><tt>multiGET through MapReduce also has another significant drawback. 
</tt><tt>MapReduce has no concept of quorum reads, and only work on a single 
</tt><tt>copy of the data, which can be thought of basically as a read with R=1 
</tt><tt>that does not trigger read-repair. It is therefore possible that it 
</tt><tt>can give inconsistent or incorrect results if all replicas do not have 
</tt><tt>the same data. It is worth noting that MapReduce was designed as a way 
</tt><tt>to efficiently spread compute work across the cluster, and 
</tt><tt>re-appropriating it for use with data collection is not its designed 
</tt><tt>purpose.
</tt><pre style="margin: 0em;">

</pre><tt>The recommended way to implement efficient multiget is to perform 
</tt><tt>normal GET operations in parallel. If you are retrieving 20 objects, 
</tt><tt>you don't necessarily need to do all 20 GETs in parallel, but could 
</tt><tt>set it up to use perhaps 3 or 4 connections. If you then pair this 
</tt><tt>with a connection pool that can grow and shrink in size (perhaps 
</tt><tt>between a minimum and a maximum value) as load requires, you should be 
</tt><tt>able to retrieve the objects in a reasonable time without overloading 
</tt><tt>the cluster.
</tt><pre style="margin: 0em;">

Best regards,

Christian


</pre><tt>On 27 Feb 2013, at 02:18, Boris Okner &lt;boris.ok...@gmail.com 
</tt><tt>&lt;<a  rel="nofollow" href="mailto:boris.ok...@gmail.com">mailto:boris.ok...@gmail.com</a>&gt;&gt; wrote:
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Thanks Christian,

</pre><tt>The problem I'm trying to solve is to find the way to retrieve values 
</tt><tt>for limited number of keys with the best possible latency (or maybe 
</tt><tt>with decent latency which is balanced with decent throughput). Let's 
</tt><tt>say we have keys stored in some cache
</tt><tt>on top of Riak, and want to retrieve values, 20 at the time, to be 
</tt><tt>able to implement pagination. Another alternative to mapreduce would 
</tt><tt>to send multiple asynchronous gets, but then we'd have to worry about 
</tt><tt>connection pool being exhausted if there's too many such &quot;page&quot; 
</tt><tt>requests. So what would be the proper way to deal with the situation 
</tt><tt>when we need to emulate multiple key retrieval?
</tt><pre style="margin: 0em;">

</pre><tt>On Tue, Feb 26, 2013 at 1:57 AM, Christian Dahlqvist 
</tt><tt>&lt;christ...@basho.com &lt;<a  rel="nofollow" href="mailto:christ...@basho.com">mailto:christ...@basho.com</a>&gt;&gt; wrote:
</tt><pre style="margin: 0em;">

    Hi Boris,

    MapReduce is a very flexible and powerful way of querying Riak
    and allows processing to be performed locally where the data
    resides, which allows for efficient processing of larger data
    sets. A result of this is that every mapreduce job requires a
    covering set of vnodes (all vnodes that hold the data required
    for processing) to participate, meaning that it puts considerable
    more load on the system compared to straight K/V access and
    therefore does not scale quite as well. It is primarily designed
    for batch type processing over reasonably large amounts of data
    and scales well with increased data volumes as new nodes are
    added. We do however usually not recommended using it as an
    interface for realtime queries where low and predictable
    latencies are required and the concurrency level, and therefore
    load level on the cluster, can not be controlled.

    I am not sure I understand what you mean by the performance
    degrading with the number of nodes, unless you are strictly
    measuring latency rather than throughput. As the number of nodes
    increase, it gets more and more likely that multiple physical
    nodes will be involved in the job, which will add to the amount
    of communication and coordination required between the nodes,
    thereby increasing latency. Could you please explain in more
    detail what you are trying to achieve?

    Best regards,

    Christian


    On 25 Feb 2013, at 16:41, Boris Okner &lt;boris.ok...@gmail.com
    &lt;<a  rel="nofollow" href="mailto:boris.ok...@gmail.com">mailto:boris.ok...@gmail.com</a>&gt;&gt; wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
    Hello,

    I'm experimenting with 2 Riak 1.3.0 nodes (both are &quot;bare
    metal&quot;), and it looks like mapreduce performs better when one of
    the nodes is down. The mapreduce requests are running on 20-key
    blocks. So am I doing something wrong, or is it an expected
    behaviour, i.e. mapreduce degrades with the the number of nodes
    increased? If the former, could
    you give me some pointers on how to set up it to get advantage
    of multiple nodes?

    Thanks in advance for your help,
    Boris
    _______________________________________________
    riak-users mailing list
    riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
    <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com &lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10283.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10284">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10284">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10285.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10237.html">MapReduce scalability</a></span> <span class="sender italic">Boris Okner</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10241.html">Re: MapReduce scalability</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10266.html">Re: MapReduce scalability</a></span> <span class="sender italic">Boris Okner</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10283.html">Re: MapReduce scalability</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: MapReduce scalability</span> <span class="sender italic">Bernard Fouché</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10285.html">Re: MapReduce scalability</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10289.html">Re: MapReduce scalability</a></span> <span class="sender italic">Rune Skou Larsen</span></li>
<li class="icons-email"><span class="subject"><a href="msg10292.html">Re: MapReduce scalability</a></span> <span class="sender italic">Bernard Fouché</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10290.html">Re: MapReduce scalability</a></span> <span class="sender italic">Elias Levy</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: MapReduce scalability">
<input type="hidden" name="msgid" value="512F615A.80901@kuantic.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10284.html">
<input type="submit" value=" Bernard Fouché ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+MapReduce+scalability%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10283.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10285.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">512F615A.80901@kuantic.com</li>
</ul>
</div>
</body>
</html>
