<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Keys that won't disappear from indexes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd7.html#13153" id="c">
<link rel="index" href="mail6.html#13153" id="i">
<link rel="prev" href="msg12871.html" id="p">
<link rel="next" href="msg12827.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13153.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Keys+that+won%27t+disappear+from+indexes%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Keys that won't disappear from indexes</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+McKibben%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean McKibben</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131204" rel="nofollow">Wed, 04 Dec 2013 21:06:25 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>This same thing is happening to me, where both $bucket index and my own custom 
indexes are returning keys that have been deleted and I can’t remove them.
I am hoping there is a way to fix this as it is causing significant problems 
for us in production. It seems to be happening with some frequency, and every 
once in a while an index will just go bad completely and either return subsets 
of what it should return (even with a healthy cluster), or keys that have been 
deleted.</pre><pre>

I had a case yesterday where $bucket was returning 6 keys that my custom 
all-inclusive index wasn’t returning. They all produced 404s when I tried to 
retrieve a value. I was hoping read repair would repair the index when a 404 
occurred, or at least AAE might pick it up, but as it stands now, is there any 
way corrupted indexes like this can ever get back to normal?

Sean


On Nov 4, 2013, at 9:44 AM, Evan Vigil-McClanahan &lt;emcclana...@basho.com&gt; wrote:

&gt; Hi Toby.
&gt; 
&gt; It's possible, since they're stored separately, that the objects were
&gt; deleted but the indices were left in place because of some error (e.g.
&gt; the operation failed for some reason between the object removal and
&gt; the index removal).  One of the things on the feature list for the
&gt; next release is AAE of index values, which should take care of this
&gt; case.  This is really rare, but not unknown.  It'd be interesting to
&gt; know how you ended up with so many.
&gt; 
&gt; In the mean time, the only way I can think of to get rid of them
&gt; (other than deleting them from the console, which would require taking
&gt; nodes down and a lot of manual effort), would be to write another
&gt; value that would have the same index, then delete it, which should
&gt; normally succeed.
&gt; 
&gt; I'll ask around to see if there is anything that might work better.
&gt; 
&gt; On Sun, Nov 3, 2013 at 7:40 PM, Toby Corkindale
&gt; &lt;toby.corkind...@strategicdata.com.au&gt; wrote:
&gt;&gt; On 01/11/13 14:04, Toby Corkindale wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Hi,
&gt;&gt;&gt; I have around 5000 keys which just won't die.
&gt;&gt;&gt; No matter how many times I delete them, they still show up in the 2i
&gt;&gt;&gt; $bucket=_ index.
&gt;&gt;&gt; 
&gt;&gt;&gt; Actually attempting to retrieve the keys results in a not-found - even
&gt;&gt;&gt; 
&gt;&gt;&gt; if I've requested that tombstones be returned.
&gt;&gt;&gt; 
&gt;&gt;&gt; I'm interested to know what is going on here?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Anyone?
&gt;&gt; 
&gt;&gt; Should I report this as a bug against 1.4.2?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12871.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd7.html#13153">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail6.html#13153">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12827.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12818.html">Keys that won't disappear from indexes</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12831.html">Re: Keys that won't disappear from indexes</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12834.html">Re: Keys that won't disappear from indexes</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12862.html">Re: Keys that won't disappear from inde...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12863.html">Re: Keys that won't disappear from ...</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12864.html">Re: Keys that won't disappear ...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12866.html">Re: Keys that won't disapp...</a></span> <span class="sender italic">Brian Roach</span></li>
<li class="icons-email"><span class="subject"><a href="msg12867.html">Re: Keys that won't disapp...</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12871.html">Re: Keys that won't di...</a></span> <span class="sender italic">Toby Corkindale</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Keys that won't disappear from inde...</span> <span class="sender italic">Sean McKibben</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Keys that won't disappear from indexes">
<input type="hidden" name="msgid" value="8184259F-8C22-4C8B-BA6A-F774D5AADDD2@graphex.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13153.html">
<input type="submit" value=" Sean McKibben ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Keys+that+won%27t+disappear+from+indexes%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12871.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12827.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">8184259F-8C22-4C8B-BA6A-F774D5AADDD2@graphex.com</li>
</ul>
</div>
</body>
</html>
