<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak crashing with {lucene_parse,"syntax error before: "AND""}</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05524" id="c">
<link rel="index" href="maillist.html#05524" id="i">
<link rel="prev" href="msg05457.html" id="p">
<link rel="next" href="msg05525.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05524.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+crashing+with+%5C%7Blucene_parse%2C%5C%22syntax+error+before%5C%3A+%5C%22AND%5C%22%5C%22%5C%7D%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak crashing with {lucene_parse,"syntax error before: "AND""}</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Spike+Gronim%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Spike Gronim</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111109" rel="nofollow">Wed, 09 Nov 2011 14:55:10 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
One of my Riak servers died again. I think the previously linked crash report 
was not what made it die. Now no erlang OS processes are running on the machine 
at all. This cluster is entirely idle except I am running search queries on it. 
The other 3 servers are up and happy. Here are some log messages:</pre><pre>

<a  rel="nofollow" href="https://gist.github.com/e92f8d32538a0057890b">https://gist.github.com/e92f8d32538a0057890b</a>

On Nov 7, 2011, at 11:35 AM, Ryan Zezeski wrote:

Hi Spike,

After decoding your msg it looks like your query is simply 'AND'.  The parser 
barfs at this as it expects terms on both sides of the AND and this causes the 
the listener for that particular connection to go down.  No other connections 
should be affected.  Since the query is parsed on the server there's not a 
whole lot you can do if a malformed query is sent.  If these are generated/user 
input queries then perhaps you could create a black list (in your application) 
for common bad queries that come in.  Also, if your client supports connection 
pooling that would help too.

-Ryan

On Mon, Nov 7, 2011 at 1:04 PM, Spike Gronim 
&lt;sp...@wavii.com&lt;<a  rel="nofollow" href="mailto:sp...@wavii.com">mailto:sp...@wavii.com</a>&gt;&gt; wrote:
Hello,

My Riak servers are misbehaving when users enter invalid queries. The 
gen_server erlang process for the PB transport dies but the overall OS level 
process is still alive. I am exclusively using PB to access Riak, so everything 
grinds to a halt. I plan to work around this by writing a Riak nanny that 
verifies that somebody is listening on the PB port every 60s, but I think that 
this is actually a bug in Riak. I have tried to find other references to this 
bug in the mailing list archive and bugzilla but haven't found any. If this is 
really a bug I will write up a more detailed repro in bugzilla. Thanks.


Crash report: <a  rel="nofollow" href="https://gist.github.com/82eaaa8fa8a994999872">https://gist.github.com/82eaaa8fa8a994999872</a>

Spike Gronim
sp...@wavii.com&lt;<a  rel="nofollow" href="mailto:sp...@wavii.com">mailto:sp...@wavii.com</a>&gt;




_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



Spike Gronim
sp...@wavii.com&lt;<a  rel="nofollow" href="mailto:sp...@wavii.com">mailto:sp...@wavii.com</a>&gt;



</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05457.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05524">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05524">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05525.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05453.html">Riak crashing with {lucene_parse,&quot;syntax error be...</a></span> <span class="sender italic">Spike Gronim</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05457.html">Re: Riak crashing with {lucene_parse,&quot;syntax...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak crashing with {lucene_parse,&quot;sy...</span> <span class="sender italic">Spike Gronim</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05525.html">SV: Riak crashing with {lucene_parse,&quot;syntax...</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak crashing with {lucene_parse,&quot;syntax error before: &quot;AND&quot;&quot;}">
<input type="hidden" name="msgid" value="D9286804-EF55-418A-9C34-F3272266FB6B@wavii.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05524.html">
<input type="submit" value=" Spike Gronim ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+crashing+with+%5C%7Blucene_parse%2C%5C%22syntax+error+before%5C%3A+%5C%22AND%5C%22%5C%22%5C%7D%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05457.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05525.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">D9286804-EF55-418A-9C34-F3272266FB6B@wavii.com</li>
</ul>
</div>
</body>
</html>
