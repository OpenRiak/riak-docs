<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Search Map Reduce error</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd6.html#13035" id="c">
<link rel="index" href="mail6.html#13035" id="i">
<link rel="prev" href="msg13087.html" id="p">
<link rel="next" href="msg13006.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13035.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+Map+Reduce+error%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Search Map Reduce error</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131120" rel="nofollow">Wed, 20 Nov 2013 10:04:08 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Roger,

Riak Search has a hardcoded max result set size of 100K items. It enforces
this to prevent blowing out memory and causing other issues. Riak Search
definitely has some issues when it comes to handling a use case like yours.</pre><pre>

That said, our new Search solution in 2.0 (code named Yokozuna) should do a
lot better. Not only does it not have the hardcoded 100K limit but it
should also execute the queries faster. In some cases by 1-3 orders of
magnitude (10-1000x). At that point you're more likely to be slowed down by
the map-reduce. You might even be able to remove that stage by using stored
fields, but I'd need to know more about your use case.

I agree that current Riak (pre 2.0) is not a general search solution. Riak
Search can work very well but it requires some hand holding and careful
vigilance of how you index and query the data. I feel that the new Search
(Yokozuna) fixes this in many ways. In general, it has more robust search
support and lower, more consistent latency. Yokozuna would also have no
issues dealing with 1 million objects. My micro benchmark that I run is
1-10 million objects. Granted, they are small plain-text objects, but I'm
fairly confident it would work with your 1 million objects.

I realize that Riak 2.0, and thus the new search functionality, is not out
yet. We have an early release, Riak 2.0.0pre5 [1], that you can try. I also
do monthly releases of the new search functionality [2]. So if you want to
kick the tires I can point you in the right direction.

-Z

[1]: <a  rel="nofollow" href="http://docs.basho.com/riak/2.0.0pre5/downloads/">http://docs.basho.com/riak/2.0.0pre5/downloads/</a>

[2]: <a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/develop/docs/INSTALL.md">https://github.com/basho/yokozuna/blob/develop/docs/INSTALL.md</a>


On Wed, Nov 20, 2013 at 11:45 AM, Roger Diller &lt;
ro...@flexrentalsolutions.com&gt; wrote:

&gt; I could dig up all our nitty gritty Riak details but I don't think that
&gt; will help really.
&gt;
&gt; The point I think is this: Using search map reduce is not a viable way to
&gt; do real time search queries. Especially ones that may have 2000+ plus
&gt; results each. Couple that with search requests coming in every few seconds
&gt; from 300+ customer app instances and you literally bring Riak to it's
&gt; knees.
&gt;
&gt; Not that Riak is the problem really, it's just we are using it in a way it
&gt; was not designed for. In essence, we are using Riak as a search engine for
&gt; our application data. Correct me if I'm wrong but Riak is more for storing
&gt; large amounts of KV data, but not really for finding that data in a search
&gt; sense.
&gt;
&gt; Am I missing something here? Is there a viable way for doing real time
&gt; search queries on a bucket with 1 million keys?
&gt;
&gt;
&gt; On Mon, Nov 18, 2013 at 5:29 PM, Alexander Sicular &lt;sicul...@gmail.com&gt;wrote:
&gt;
&gt;&gt; More info please...
&gt;&gt;
&gt;&gt; Version
&gt;&gt; Current config
&gt;&gt; Hardware
&gt;&gt; Data size
&gt;&gt; Search Schema
&gt;&gt; Etc.
&gt;&gt;
&gt;&gt; But I would probably say that your search is returning too many keys to
&gt;&gt; your mr. More inline.
&gt;&gt;
&gt;&gt; @siculars
&gt;&gt; <a  rel="nofollow" href="http://siculars.posthaven.com">http://siculars.posthaven.com</a>
&gt;&gt;
&gt;&gt; Sent from my iRotaryPhone
&gt;&gt;
&gt;&gt; On Nov 18, 2013, at 13:59, Roger Diller &lt;ro...@flexrentalsolutions.com&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt; Using the Riak Java client, I am executing a search map reduce like this:
&gt;&gt;
&gt;&gt; MapReduceResult result = riakClient.mapReduce(SEARCH_BUCKET,
&gt;&gt; search).execute();
&gt;&gt;
&gt;&gt;
&gt;&gt; ^is this part a typo. Cause otherwise it looks like you do a s&gt;mr, set
&gt;&gt; the search and then another s&gt;mr.
&gt;&gt;
&gt;&gt;
&gt;&gt; String search = &quot;systemId:&quot; + systemName + &quot; AND indexId:&quot; + indexId;
&gt;&gt;
&gt;&gt; MapReduceResult result = riakClient.mapReduce(SEARCH_BUCKET,
&gt;&gt; search).execute();
&gt;&gt;
&gt;&gt; This worked fine when the bucket contained a few thousand keys. Now that
&gt;&gt; we have far more data stored in the bucket (at least 250K keys), it's
&gt;&gt; throwing this generic error:
&gt;&gt;
&gt;&gt; com.basho.riak.client.RiakException: java.io.IOException:
&gt;&gt; {&quot;error&quot;:&quot;map_reduce_error&quot;}
&gt;&gt;
&gt;&gt; We've also noticed that storing new key/values in the bucket has slowed
&gt;&gt; WAY down.
&gt;&gt;
&gt;&gt; Any idea what's going on?
&gt;&gt;
&gt;&gt;
&gt;&gt; Your data set is incorrectly sized to your production config.
&gt;&gt;
&gt;&gt; Are there limitations to Search Map Reduce?
&gt;&gt;
&gt;&gt;
&gt;&gt; Certainly
&gt;&gt;
&gt;&gt; Are there configuration options that need changed?
&gt;&gt;
&gt;&gt;
&gt;&gt; Possibly
&gt;&gt;
&gt;&gt; Any help would be greatly appreciated.
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Roger Diller
&gt;&gt; Flex Rental Solutions, LLC
&gt;&gt; Email: ro...@flexrentalsolutions.com
&gt;&gt; Skype: rogerdiller
&gt;&gt; Time Zone: Eastern Time
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Roger Diller
&gt; Flex Rental Solutions, LLC
&gt; Email: ro...@flexrentalsolutions.com
&gt; Skype: rogerdiller
&gt; Time Zone: Eastern Time
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13087.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd6.html#13035">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail6.html#13035">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13006.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13004.html">Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13009.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13031.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13034.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Todd Tyree</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13053.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13087.html">Re: Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Search Map Reduce error</span> <span class="sender italic">Ryan Zezeski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13006.html">Riak Search Map Reduce error</a></span> <span class="sender italic">Roger Diller</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Search Map Reduce error">
<input type="hidden" name="msgid" value="CACZcpe=L4ZkBDMPc58oyGxNqSiFd4dEeWyvdDuBMYHY7V4x+Yg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13035.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+Map+Reduce+error%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13087.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13006.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpe=L4ZkBDMPc58oyGxNqSiFd4dEeWyvdDuBMYHY7V4x+Yg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
