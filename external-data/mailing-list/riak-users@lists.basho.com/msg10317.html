<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak vnodes not available</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd9.html#10317" id="c">
<link rel="index" href="mail9.html#10317" id="i">
<link rel="prev" href="msg10313.html" id="p">
<link rel="next" href="msg10318.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10317.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+vnodes+not+available%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak vnodes not available</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Daniel+Iwan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Daniel Iwan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130305" rel="nofollow">Tue, 05 Mar 2013 03:37:32 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi

In our test setup (3 nodes) we've changed number of vnodes from default 64
to 512.</pre><pre>

We've noticed increased riak start up time (by 7 seconds) and failures in
our test framework due to that. Our test framework wipes Riak cluster and
recreates it, and then our application starts.

Application (each server) loads some keys on start via local riak node
using 127.0.0.1 interface ,
Most queries are on buckets with default N=3 and quorum 2.

Since we've changed to 512 vnodes, we get:

Unable to retrieve the riak object! com.google.protobuf.ByteString@1a292c9d,
com.google.protobuf.ByteString@3e62f0b1
com.basho.riak.pbc.RiakError: {insufficient_vnodes,0,need,2}
    at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:125)
    at com.basho.riak.pbc.RiakClient.processFetchReply(RiakClient.java:282)
    at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:275)

This is true both for Riak 1.2.1 and 1.3
So obviously nodes are not ready (or in the middle of vnode transfer?).

This happens not only during cluster set up but also after reboot.
What is the correct approach to make sure nodes are ready and Riak service
is fully up and running and can take request?
SInce our app depends on Riak we need to somehow make sure Riak is ready
before our services start.


Daniel
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10313.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd9.html#10317">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail9.html#10317">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10318.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Riak vnodes not available</span> <span class="sender italic">Daniel Iwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10318.html">Re: Riak vnodes not available</a></span> <span class="sender italic">Shane McEwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10321.html">Re: Riak vnodes not available</a></span> <span class="sender italic">Hector Castro</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10322.html">Re: Riak vnodes not available</a></span> <span class="sender italic">Daniel Iwan</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak vnodes not available">
<input type="hidden" name="msgid" value="CANOWVA0XUhQrJjfr0UXt+8L0Yok2mYRYqnLPyHANeLwSAeGdqg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10317.html">
<input type="submit" value=" Daniel Iwan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+vnodes+not+available%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10313.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10318.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANOWVA0XUhQrJjfr0UXt+8L0Yok2mYRYqnLPyHANeLwSAeGdqg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
