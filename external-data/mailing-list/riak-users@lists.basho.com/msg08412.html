<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Bad MapReduce job brings the Riak to a screeching halt?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08412" id="c">
<link rel="index" href="maillist.html#08412" id="i">
<link rel="prev" href="msg08405.html" id="p">
<link rel="next" href="msg08413.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08412.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bad+MapReduce+job+brings+the+Riak+to+a+screeching+halt%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Bad MapReduce job brings the Riak to a screeching halt?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kelly+McLaughlin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kelly McLaughlin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120830" rel="nofollow">Thu, 30 Aug 2012 15:16:28 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
On Aug 29, 2012, at 9:07 PM, Brad Heller &lt;b...@cloudability.com&gt; wrote:
&gt; 
&gt; So my question is: Why did this completely kill Riak? This makes me pretty 
&gt; nervous--a bug in our app has the potential to bring down the ring! Is there 
&gt; anything we can do to protect against this?
&gt; </pre><pre>

Riak 1.2 had a lot of changes to leveldb and one of those was a change to using 
flock() instead of fcntl(SET_FL) to try and make the locking a bit saner. 
Previously, using fcntl, multiple processes in the erlang VM could get a lock 
to the same leveldb instance and this could obviously lead to some conflicts. 
However, a result of the change to using flock is that when the vnode crashes 
the resources can still be locked by the previous process and this results in 
this message:

        2012-08-29 19:45:41.785 [error] &lt;0.23924.70&gt;@riak_kv_vnode:init:265 
Failed to start riak_kv_multi_backend Reason: 
[{riak_kv_eleveldb_backend,{db_open,&quot;IO error: lock 
../../tmp/riak/instance1/leveldb/0/LOCK: Resource temporarily unavailable&quot;}}]

Currently we do not attempt to wait or retry the vnode restart and this can 
cause the node to crash. I can understand you being a little nervous, but we 
are aware of this and are taking steps on two fronts to address it. First, as 
Bryan mentioned previously, we're looking at fixing these error conditions that 
cause the vnode to crash that really should not do so. Second, we're looking at 
a way to add some retry logic when the vnode does crash and the resources are 
locked. Thanks for the report!

Kelly
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08405.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08412">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08412">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08413.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08397.html">Bad MapReduce job brings the Riak to a screeching halt?</a></span> <span class="sender italic">Brad Heller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08398.html">Re: Bad MapReduce job brings the Riak to a screechi...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08400.html">Re: Bad MapReduce job brings the Riak to a scre...</a></span> <span class="sender italic">Brad Heller</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08401.html">Re: Bad MapReduce job brings the Riak to a ...</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg08405.html">Re: Bad MapReduce job brings the Riak to a screechi...</a></span> <span class="sender italic">Bryan Fink</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Bad MapReduce job brings the Riak to a screechi...</span> <span class="sender italic">Kelly McLaughlin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08413.html">Re: Bad MapReduce job brings the Riak to a scre...</a></span> <span class="sender italic">Brad Heller</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Bad MapReduce job brings the Riak to a screeching halt?">
<input type="hidden" name="msgid" value="7A6469E6-B946-4A27-B652-A2DDD848E43E@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08412.html">
<input type="submit" value=" Kelly McLaughlin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bad+MapReduce+job+brings+the+Riak+to+a+screeching+halt%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08405.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08413.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">7A6469E6-B946-4A27-B652-A2DDD848E43E@basho.com</li>
</ul>
</div>
</body>
</html>
