<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: empty sibling after a DELETE then PUT</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05057" id="c">
<link rel="index" href="maillist.html#05057" id="i">
<link rel="prev" href="msg05056.html" id="p">
<link rel="next" href="msg05058.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05057.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+empty+sibling+after+a+DELETE+then+PUT%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: empty sibling after a DELETE then PUT</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Meredith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Meredith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111005" rel="nofollow">Wed, 05 Oct 2011 15:22:16 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Eric,

What you are seeing is probably a result of some changes we've made to
deletes.  After you issue the DELETE, Riak creates a tombstone object first
and then removes it.  1.0 now adds a delay of 3s by default.  If you do a
get during that time you should see an X-Riak-Vclock line for the 404
message after the delete.</pre><pre>

If you use that vclock with the put then the tombstone will be removed.  The
feature wasn't well publicized so has not made it into the clients yet.
 There should be more info to follow on deletes soon.  If you really want
the old behavior, add {delete_mode, immediate} to the riak_kv section of
your app.config

Jon Meredith
Basho Technologies.

On Wed, Oct 5, 2011 at 1:13 PM, Eric Moritz &lt;e...@themoritzfamily.com&gt;wrote:

&gt; If I enabled allow_multi on a bucket and do I DELETE followed by a PUT
&gt; I am getting a 300 response with one sibling having the body of the
&gt; PUT and a second sibling with an empty body.  If that the expected
&gt; behavior?
&gt;
&gt; I wrote a script that would start with a reconciled value.  Get the
&gt; VClock of the current value.  Then do every permutation of  a PUT with
&gt; (Pv) and without (P) the VClock and a DELETE with (Dv) and without (D)
&gt; the vClock and I see the following result:
&gt;
&gt; Pv      Dv      404
&gt; Dv      Pv      300
&gt; Pv      D        404
&gt; D       Pv       300
&gt;
&gt; Is it expected that a delete creates a blank sibling like that and
&gt; therefore we should treat empty body's as deleted?
&gt;
&gt; Thanks,
&gt; Eric Moritz.
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05056.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05057">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05057">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05058.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05056.html">empty sibling after a DELETE then PUT</a></span> <span class="sender italic">Eric Moritz</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: empty sibling after a DELETE then PUT</span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05058.html">Re: empty sibling after a DELETE then PUT</a></span> <span class="sender italic">Eric Moritz</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05065.html">Re: empty sibling after a DELETE then PUT</a></span> <span class="sender italic">Roland Karlsson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05076.html">Re: empty sibling after a DELETE then PUT</a></span> <span class="sender italic">Eric Moritz</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05080.html">Re: empty sibling after a DELETE the...</a></span> <span class="sender italic">Dan Reverri</span></li>
<li class="icons-email"><span class="subject"><a href="msg05081.html">Re: empty sibling after a DELETE the...</a></span> <span class="sender italic">Jon Meredith</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: empty sibling after a DELETE then PUT">
<input type="hidden" name="msgid" value="CAGgQeSsq9eH=_9YR6bf3wXJF=V5XUy1M0M-ce0ixe9nsb1z3VQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05057.html">
<input type="submit" value=" Jon Meredith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+empty+sibling+after+a+DELETE+then+PUT%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05056.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05058.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGgQeSsq9eH=_9YR6bf3wXJF=V5XUy1M0M-ce0ixe9nsb1z3VQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
