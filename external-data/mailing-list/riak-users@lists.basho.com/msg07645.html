<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak.mapValuesJson is returning a string</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd4.html#07645" id="c">
<link rel="index" href="mail2.html#07645" id="i">
<link rel="prev" href="msg07461.html" id="p">
<link rel="next" href="msg07332.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07645.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak.mapValuesJson+is+returning+a+string%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak.mapValuesJson is returning a string</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brad+Corson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brad Corson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120608" rel="nofollow">Fri, 08 Jun 2012 05:50:51 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Brian,

Thanks for the response, and sorry I couldn't get back to you before this.
I had to change focus to a couple of other projects before I could come
back to my Riak project.</pre><pre>

We've solved our problem. Basically, we had to wrap the Riak.mapValuesJson
so that the pertinent part of the map looks like this:

var dats = JSON.parse(Riak.mapValuesJson(value)[0])

I was under the assumption that Riak.mapValuesJson turned the data into a
JSON object, but that wasn't the case for us. Wrapping in a JSON.parse
gives us a JSON object, just like we had originally stored, and lets us use
dot access on the hash.

Thanks again for your response, it helped me to recognize where we went
wrong. We were getting back what LOOKED like expected results, just in a
string format instead of JSON.

Thanks,
Brad



On Wed, May 16, 2012 at 8:48 AM, Brian Shumate &lt;bshum...@basho.com&gt; wrote:

&gt; Hello,
&gt;
&gt; I am running a Riak 1.1.2 rel build from source on OS X 10.7 with Erlang
&gt; R14B04, and just tried a case like yours, but I cannot reproduce your issue:
&gt;
&gt; curl -v -d '{&quot;name&quot;: &quot;Brian&quot;}' -H &quot;Content-Type: application/json&quot;
&gt; <a  rel="nofollow" href="http://127.0.0.1:8098/riak/test/120000">http://127.0.0.1:8098/riak/test/120000</a>
&gt;
&gt;    * About to connect() to 127.0.0.1 port 8098 (#0)
&gt;    *   Trying 127.0.0.1... connected
&gt;    * Connected to 127.0.0.1 (127.0.0.1) port 8098 (#0)
&gt;    &gt; POST /riak/test/120000 HTTP/1.1
&gt;    &gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4
&gt; OpenSSL/0.9.8r zlib/1.2.5
&gt;    &gt; Host: 127.0.0.1:8098
&gt;    &gt; Accept: */*
&gt;    &gt; Content-Type: application/json
&gt;    &gt; Content-Length: 28
&gt;    &gt;
&gt;    &lt; HTTP/1.1 204 No Content
&gt;    &lt; Vary: Accept-Encoding
&gt;    &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt;    &lt; Date: Sun, 13 May 2012 19:50:49 GMT
&gt;    &lt; Content-Type: application/json
&gt;    &lt; Content-Length: 0
&gt;    &lt;
&gt;    * Connection #0 to host 127.0.0.1 left intact
&gt;    * Closing connection #0
&gt;
&gt; curl -i localhost:8098/riak/test/120000
&gt;
&gt;    HTTP/1.1 200 OK
&gt;    X-Riak-Vclock: a85hYGBgzGDKBVIcypz/fvpv4P+QwZTImMfKMLNH5SRfFgA=
&gt;    Vary: Accept-Encoding
&gt;    Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt;    Link: &lt;/riak/test&gt;; rel=&quot;up&quot;
&gt;    Last-Modified: Sun, 13 May 2012 19:50:49 GMT
&gt;    ETag: &quot;hsUPQi54y1EKeXVazb3fl&quot;
&gt;    Date: Sun, 13 May 2012 19:50:56 GMT
&gt;    Content-Type: application/json
&gt;    Content-Length: 28
&gt;
&gt;    {&quot;name&quot;: &quot;Brian&quot;}%
&gt;
&gt; curl -v -d '{&quot;inputs&quot;:[[&quot;test&quot;, &quot;120000&quot;]],
&gt; &quot;query&quot;:[{&quot;map&quot;:{&quot;language&quot;:&quot;javascript&quot;, &quot;source&quot;:&quot;function(value,
&gt; keyData, arg) { var dats = Riak.mapValuesJson(value)[0]; return [typeof
&gt; dats];}&quot;}}]}' -H &quot;Content-Type: application/json&quot;
&gt; <a  rel="nofollow" href="http://127.0.0.1:8098/mapred">http://127.0.0.1:8098/mapred</a>
&gt;
&gt;    * About to connect() to 127.0.0.1 port 8098 (#0)
&gt;    *   Trying 127.0.0.1... connected
&gt;    * Connected to 127.0.0.1 (127.0.0.1) port 8098 (#0)
&gt;    &gt; POST /mapred HTTP/1.1
&gt;    &gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4
&gt; OpenSSL/0.9.8r zlib/1.2.5
&gt;    &gt; Host: 127.0.0.1:8098
&gt;    &gt; Accept: */*
&gt;    &gt; Content-Type: application/json
&gt;    &gt; Content-Length: 184
&gt;    &gt;
&gt;    &lt; HTTP/1.1 200 OK
&gt;    &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt;    &lt; Date: Sun, 13 May 2012 19:52:28 GMT
&gt;    &lt; Content-Type: application/json
&gt;    &lt; Content-Length: 10
&gt;    &lt;
&gt;    * Connection #0 to host 127.0.0.1 left intact
&gt;    * Closing connection #0
&gt;    [&quot;object&quot;]%
&gt;
&gt; As you can see above, I get the expected results.
&gt;
&gt; What version of Riak are you using? What does the full (with -v) output of
&gt; storing an object in your case look like?
&gt;
&gt; Regards,
&gt;
&gt; Brian
&gt;
&gt; On May 16, 2012, at 8:40 AM, kodeblok wrote:
&gt;
&gt; &gt; Does anyone have any thoughts on this? I'm unable to perform MapReduce
&gt; &gt; queries.
&gt; &gt;
&gt; &gt; Thanks
&gt; &gt;
&gt; &gt; --
&gt; &gt; View this message in context:
&gt; <a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Riak-mapValuesJson-is-returning-a-string-tp3942213p3996979.html">http://riak-users.197444.n3.nabble.com/Riak-mapValuesJson-is-returning-a-string-tp3942213p3996979.html</a>
&gt; &gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07461.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd4.html#07645">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#07645">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07332.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07331.html">Riak.mapValuesJson is returning a string</a></span> <span class="sender italic">kodeblok</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07460.html">Re: Riak.mapValuesJson is returning a string</a></span> <span class="sender italic">kodeblok</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07461.html">Re: Riak.mapValuesJson is returning a string</a></span> <span class="sender italic">Brian Shumate</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak.mapValuesJson is returning a string</span> <span class="sender italic">Brad Corson</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak.mapValuesJson is returning a string">
<input type="hidden" name="msgid" value="CALOq5ji1fKXTBYF4EAor8t-14LES+Jejk-nwv18m7ok5rCo-bw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07645.html">
<input type="submit" value=" Brad Corson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak.mapValuesJson+is+returning+a+string%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07461.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07332.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CALOq5ji1fKXTBYF4EAor8t-14LES+Jejk-nwv18m7ok5rCo-bw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
