<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riak-python-client2, a rewrite of the official client</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06985" id="c">
<link rel="index" href="maillist.html#06985" id="i">
<link rel="prev" href="msg06982.html" id="p">
<link rel="next" href="msg06970.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06985.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-python%5C-client2%2C+a+rewrite+of+the+official+client%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riak-python-client2, a rewrite of the official client</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Shuhao+Wu%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Shuhao Wu</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120316" rel="nofollow">Fri, 16 Mar 2012 11:53:42 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey Greg,

Let me just clarify for the connection manager. I don't know what's going
on there, so I'm not trying to write the code there. The current code is
temporary as I want to test out the concept of moving transports to an
independent layer. I'm not sure how connection manager should work. So I
didn't bother with correctly porting it over. (Which is why the get_http_cm
exists)</pre><pre>

Secondly, the project right now is more or less an experiment. It's for me
to see what's possible without the constraint of the current API and to
generate these  discussions we are having.
I don't have a plan of what will happen with it. I did envision pushing the
code back. Right now I'm just trying out different things.

Judging from what I have right now, a lot of these changes could be
reintergrated. I still haven't explored things like map reduce yet, so I
want to continue to explore

Shuhao
Sent from my phone.
On Mar 16, 2012 2:07 PM, &quot;Greg Stein&quot; &lt;gst...@gmail.com&gt; wrote:

&gt; On Thu, Mar 15, 2012 at 11:13, Shuhao Wu &lt;ad...@thekks.net&gt; wrote:
&gt; &gt;...
&gt; &gt; Erlang. In my client, a chunk of the code actually comes from the
&gt; original
&gt; &gt; client as they work with a few adaptations.
&gt;
&gt; Yes, I noticed that you retain transports/connection.py, but why did
&gt; you strip out all the comments?! That is definitely not a good path
&gt; towards a long-term maintainable codebase. I put a lot of commentary
&gt; into connection.py because there are explicit race conditions in
&gt; there. The documentation was necessary to clarify where the races
&gt; exist, what is being done about it, and why the code works properly.
&gt; With your stripped-down version, all of that information is LOST.
&gt; Future maintainers will not understand the issues and break it, or
&gt; they will think there are issues that don't really exist. I could just
&gt; see somebody saying &quot;holy crap! in the presence of threads, this won't
&gt; work&quot; and go and introduce a Queue in there. Totally senseless and
&gt; overkill.
&gt;
&gt; But because you stripped the code... no benefit, and probably harm.
&gt;
&gt; I'll take the somewhat-messy Basho client, over your version where you
&gt; explicitly remove useful knowledge.
&gt;
&gt; I would also note that you have ALREADY introduced bugs. Even in the
&gt; very simplest case. Consider the following:
&gt;
&gt;  client = riak2.client.Client('server1')
&gt;  bucket = client.bucket('test')
&gt;  ob = bucket.get('key')
&gt;  data = ob.get_data()
&gt;
&gt;  client = riak2.client.Client('server2')
&gt;  bucket = client.bucket('migrate')
&gt;  bucket.new('key', data)
&gt;
&gt; Pretty simple, hm? Migrate some data from one server to another.
&gt;
&gt; It doesn't work.
&gt;
&gt; Your get_http_cm() class method is a broken idea. It is effectively a
&gt; global variable. Because the Client('server2') call does not provide a
&gt; connection manager, it &quot;reuses&quot; the one created for the 'server1'
&gt; connection.
&gt;
&gt; &gt;...
&gt;
&gt; How long and how much energy are you willing to expend? Of your own
&gt; time, and of others who may want to use your code?
&gt;
&gt; Also, consider that you've turned something like bucket.get_r() into
&gt; just bucket.r. Sure, that looks good, but examine the current bucket
&gt; code: if the bucket doesn't provide a value, then it defers to the
&gt; client. These are not just simple attributes. What you really want is
&gt; to use Python's properties. That'll make them *look* like attributes,
&gt; but you can execute the fallback code. And you could do that on the
&gt; *existing* client, and benefit everybody, without introducing a bunch
&gt; of bugs by trying to do it yourself.
&gt;
&gt; You could then use riak.util.deprecated() to mark .get_r() as
&gt; deprecated. In a future revision, then you could clear them out. The
&gt; client that everybody uses would then benefit.
&gt;
&gt;
&gt; From a community/social dynamic, you're forking the project and going
&gt; your own away. That doesn't help the broader community. A few people
&gt; might use your client, but most will stick to Basho's client. It may
&gt; feel nice and fun for you, but applying your efforts to the official
&gt; client *will* help everybody. And after a round of deprecation, then
&gt; you can clear out all of the stuff you find messy. But spending some
&gt; time to do this right, and to *work with* the existing community will
&gt; produce a much larger benefit to all.
&gt;
&gt; -g
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06982.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06985">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06985">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06970.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06936.html">riak-python-client2, a rewrite of the official client</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06938.html">Re: riak-python-client2, a rewrite of the officia...</a></span> <span class="sender italic">Jim Adler</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06961.html">Re: riak-python-client2, a rewrite of the off...</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06964.html">Re: riak-python-client2, a rewrite of the...</a></span> <span class="sender italic">Russell Brown</span></li>
<li class="icons-email"><span class="subject"><a href="msg06966.html">Re: riak-python-client2, a rewrite of the...</a></span> <span class="sender italic">Andrey V. Martyanov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06967.html">Re: riak-python-client2, a rewrite of...</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06968.html">Re: riak-python-client2, a rewri...</a></span> <span class="sender italic">Andrey V. Martyanov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06969.html">Re: riak-python-client2, a r...</a></span> <span class="sender italic">Shuhao Wu</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06982.html">Re: riak-python-client2, a rewri...</a></span> <span class="sender italic">Greg Stein</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: riak-python-client2, a r...</span> <span class="sender italic">Shuhao Wu</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06970.html">Re: riak-python-client2, a rewrite of the officia...</a></span> <span class="sender italic">Armon Dadgar</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06971.html">Re: riak-python-client2, a rewrite of the off...</a></span> <span class="sender italic">Shuhao Wu</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06974.html">Re: riak-python-client2, a rewrite of the...</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06983.html">Re: riak-python-client2, a rewrite of the off...</a></span> <span class="sender italic">Greg Stein</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riak-python-client2, a rewrite of the official client">
<input type="hidden" name="msgid" value="CAP1J66deQyFJiXDt2kyAuuKQ712H0Vcjwi-orNOBVM=P8drK6w@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06985.html">
<input type="submit" value=" Shuhao Wu ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak%5C-python%5C-client2%2C+a+rewrite+of+the+official+client%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06982.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06970.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAP1J66deQyFJiXDt2kyAuuKQ712H0Vcjwi-orNOBVM=P8drK6w@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
