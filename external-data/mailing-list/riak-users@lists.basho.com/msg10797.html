<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: A story about unexpected changes in riak-erlang-client	dependencies</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10797" id="c">
<link rel="index" href="maillist.html#10797" id="i">
<link rel="prev" href="msg10795.html" id="p">
<link rel="next" href="msg10798.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10797.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+A+story+about+unexpected+changes+in+riak%5C-erlang%5C-client%09dependencies%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: A story about unexpected changes in riak-erlang-client	dependencies</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Reid+Draper%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Reid Draper</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130409" rel="nofollow">Tue, 09 Apr 2013 08:17:01 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Yuri,

You're certainly not the only one dealing with this. Sorry about that. It's bit 
us here at Basho a few times too. As you saw, we're moving toward not having 
master dependencies, at least for tagged versions of repos. Especially for 
projects that are likely to be dependencies in other projects (ie. our client 
libraries, lager, etc.). That being said, it will take us some time to get 
there. You should also be aware of another 'fun' issue with rebar: if multiple 
dependencies require the same dep, the version that rebar first encounters will 
be the one that gets used. You'll find it helpful to use `./rebar list-deps` to 
see exactly what's being used in your project. I agree that this is something 
the Erlang community could improve, but in the short-term we're going to be 
more diligent about using recursively using tags for all tagged repos.</pre><pre>

Reid


On Apr 9, 2013, at 10:49 AM, Yuri Lukyanov &lt;sn...@aboutecho.com&gt; wrote:

&gt; Hi,
&gt; 
&gt; To begin with, I almost fucked up production servers with these
&gt; changes in riak_pb:
&gt; <a  rel="nofollow" href="https://github.com/basho/riak_pb/commit/2505ff1fa3975b93150d7445b6f7b91940ecb970">https://github.com/basho/riak_pb/commit/2505ff1fa3975b93150d7445b6f7b91940ecb970</a>
&gt; 
&gt; Well, this issue boils down to commonly known rebar-related problem. I
&gt; was even hesitating which mailing list I should've sent this massage
&gt; to, riak-users@ or rebar@.
&gt; The thing is that rebar does not allow you to fix dependencies on a
&gt; certain version.
&gt; 
&gt; When you do this in your rebar.config:
&gt; 
&gt; {deps, [
&gt;    {riakc, &quot;1.3.1&quot;, {git,
&gt; &quot;<a  rel="nofollow" href="https://github.com/basho/riak-erlang-client.git&quot">https://github.com/basho/riak-erlang-client.git&quot</a>;, &quot;c377347bb0&quot;}},
&gt; ]}.
&gt; 
&gt; you actually do _nothing_ to prevent you from unexpected changes to come.
&gt; 
&gt; Any dependency may have its own dependencies and so does riakc. And
&gt; guess what we see in riakc rebar.config in the commit &quot;c377347bb0&quot;?
&gt; 
&gt; Right:
&gt; {deps, [
&gt;        {riak_pb, &quot;.*&quot;, {git, &quot;git://github.com/basho/riak_pb&quot;, &quot;master&quot;}}
&gt; ]}.
&gt; 
&gt; Welcome master.
&gt; 
&gt; And here is the welcoming message on your production servers when you
&gt; do hot code reloading:
&gt; 
&gt;  crasher:
&gt;    initial call: riakc_pb_socket:init/1
&gt;    pid: &lt;0.3364.6566&gt;
&gt;    registered_name: []
&gt;    exception exit:
&gt; {{{badrecord,rpbgetreq},[{riak_kv_pb,iolist,2,[{file,&quot;src/riak_kv_pb.erl&quot;},{line,48}]},{riak_kv_pb,encode,2,[{file,&quot;src/r
&gt; iak_kv_pb.erl&quot;},{line,40}]},{riak_pb_codec,encode,1,[{file,&quot;src/riak_pb_codec.erl&quot;},{line,77}]},{riakc_pb_socket,send_request,2,[{file,&quot;src/r
&gt; iakc_pb_socket.erl&quot;},{line,1280}]},{riakc_pb_socket,handle_call,3,[{file,&quot;src/riakc_pb_socket.erl&quot;},{line,759}]},{gen_server,handle_msg,5,[{f
&gt; ile,&quot;gen_server.erl&quot;},{line,588}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]},[{gen_server,terminate,6,[{file,&quot;gen_ser
&gt; ver.erl&quot;},{line,747}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}
&gt; 
&gt; 
&gt; I see that now the situation is better and the last master version of
&gt; the riakc rebar.config looks like this:
&gt; 
&gt; {deps, [
&gt;        {riak_pb, &quot;1.4.0.2&quot;, {git, &quot;git://github.com/basho/riak_pb&quot;,
&gt; {tag, &quot;1.4.0.2&quot;}}}
&gt; ]}.
&gt; 
&gt; That helps. But only a bit.
&gt; Let's look at the riak_pb rebar.config...
&gt; <a  rel="nofollow" href="https://github.com/basho/riak_pb/blob/master/rebar.config">https://github.com/basho/riak_pb/blob/master/rebar.config</a>
&gt; 
&gt; And voil√†:
&gt; {deps, [
&gt;        {protobuffs, &quot;0.8.*&quot;, {git,
&gt; &quot;git://github.com/basho/erlang_protobuffs.git&quot;, &quot;master&quot;}}
&gt; ]}.
&gt; 
&gt; New interesting things to come in the future. Just wait for it.
&gt; 
&gt; 
&gt; And if we go through any erlang project on github using rebar we will
&gt; see a lot of the same stuff. No one seems to worry about this much.
&gt; 
&gt; The question is why? Is this me only who facing those issues? It
&gt; doesn't look this. I see messages appearing again and again in rebar
&gt; mailing list and in rebar issues list on github about the same matter.
&gt; People invent hacks and patches to somehow improve the situation.
&gt; For example, the following rebar plugin recursively locks all deps by
&gt; creating a separate rebar.config:
&gt; <a  rel="nofollow" href="https://github.com/seth/rebar_lock_deps_plugin">https://github.com/seth/rebar_lock_deps_plugin</a>
&gt; (and my fork of this: <a  rel="nofollow" href="https://github.com/lukyanov/rebar-lock-deps">https://github.com/lukyanov/rebar-lock-deps</a>)
&gt; 
&gt; But all of those attempts are just partial solutions. The real
&gt; solution would be to have a single centered dependencies repository,
&gt; like ruby has, for instance. While we, as Erlang community, still do
&gt; not have one, why don't we start _never_ using masters in our
&gt; rebar.config's and make this a habit?
&gt; 
&gt; I strongly urge Basho to be a good example of this, as you guys always do.
&gt; 
&gt; Thanks.
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10795.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10797">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10797">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10798.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10795.html">A story about unexpected changes in riak-erlang-client d...</a></span> <span class="sender italic">Yuri Lukyanov</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: A story about unexpected changes in riak-erlang...</span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10798.html">Re: A story about unexpected changes in riak-er...</a></span> <span class="sender italic">Yuri Lukyanov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10800.html">Re: A story about unexpected changes in ria...</a></span> <span class="sender italic">Jared Morrow</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10807.html">Re: A story about unexpected changes in riak-erlang...</a></span> <span class="sender italic">Daniil Churikov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10808.html">Re: A story about unexpected changes in riak-er...</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: A story about unexpected changes in riak-erlang-client	dependencies">
<input type="hidden" name="msgid" value="98540AF0-5ADE-4374-B4E5-1E453DDB3EF4@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10797.html">
<input type="submit" value=" Reid Draper ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+A+story+about+unexpected+changes+in+riak%5C-erlang%5C-client%09dependencies%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10795.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10798.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">98540AF0-5ADE-4374-B4E5-1E453DDB3EF4@gmail.com</li>
</ul>
</div>
</body>
</html>
