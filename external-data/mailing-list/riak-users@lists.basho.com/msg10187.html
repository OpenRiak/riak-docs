<!DOCTYPE html>
<html lang="en">
<head>
<title>Understanding read_repairs</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10187" id="c">
<link rel="index" href="maillist.html#10187" id="i">
<link rel="prev" href="msg10178.html" id="p">
<link rel="next" href="msg10199.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10187.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Understanding+read_repairs%22&amp;o=newest" rel="nofollow"><span itemprop="name">Understanding read_repairs</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Belai+Beshah%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Belai Beshah</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130221" rel="nofollow">Thu, 21 Feb 2013 17:17:33 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>

Hi All,</pre><pre>


We are evaluating Riak to see if it can be used to cache large blobs of data. 
Here is our test cluster setup:


 *   six Ubuntu LTS 12.04 dedicated nodes with 8 core 2.6 Ghz CPU, 32 GB RAM, 
3.6T disk

 *

{pb_backlog, 64},

 *

{ring_creation_size, 256},

 *

{default_bucket_props, [{n_val, 2}, {allow_mult,false},{last_write_wins,true}]},

 *

using bitcask as the backend


Everything else default except the above. There is an HAProxy load balancer 
infront of the nodes that the clients talk too configured according to the 
basho wiki. Due to the nature of the application we are integrating we do about 
1200/s writes of approximately 40-50KB each and read them back almost 
immediately. We noticed a lot of read repairs and since that was one of the 
things that could indicate performance problem we go worried. So we wrote a 
simple java client application that simulates our use case. The test program is 
dead simple:

 *   generate keys using random UUID and value using Apache commons 
RandomStringUtils

 *   create a thread pool of 5 and store key/value using “bucket.store()”

 *   read the values back using “bucket.fetch()” multiple times

I could provide the spike code if needed. What we noticed is that we get a lot 
of read repairs all over the place. We even made it use a single thread to 
read/write, played with the write/read quorum and even put a delay of 5 minutes 
between the writes before the reads start to give the cluster time to be 
eventually consistent. Nothing helps, we always see a lot of read repairs, 
sometime as many as the number of inserts. The good thing is that in all of 
these tests we have not seen any read failures. Performance is also not bad, a 
few maxs here and there we don't like but 90% looks good. Even when we killed a 
node, the reads are still successful.


We are wondering what the expected ratio of read repairs is and what is a 
reasonable time for the cluster not to restore to read_repair to fulfill a read 
request or is there something we are missing in our setup.


Thanks

Belai
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10178.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10187">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10187">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10199.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Understanding read_repairs</span> <span class="sender italic">Belai Beshah</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10199.html">Re: Understanding read_repairs</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10210.html">RE: Understanding read_repairs</a></span> <span class="sender italic">Belai Beshah</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10211.html">Re: Understanding read_repairs</a></span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10212.html">Re: Understanding read_repairs</a></span> <span class="sender italic">Andrew Thompson</span></li>
<li class="icons-email"><span class="subject"><a href="msg10238.html">RE: Understanding read_repairs</a></span> <span class="sender italic">Belai Beshah</span></li>
<li class="icons-email"><span class="subject"><a href="msg10277.html">RE: Understanding read_repairs</a></span> <span class="sender italic">Belai Beshah</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10279.html">Re: Understanding read_repairs</a></span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10280.html">RE: Understanding read_repai...</a></span> <span class="sender italic">Belai Beshah</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10298.html">Re: Understanding read_r...</a></span> <span class="sender italic">Kresten Krab Thorup</span></li>
<li class="icons-email"><span class="subject"><a href="msg10301.html">RE: Understanding read_r...</a></span> <span class="sender italic">Belai Beshah</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Understanding read_repairs">
<input type="hidden" name="msgid" value="A7917235D372C143AA6012D8F81B901D05A06803D6@EX53.exchserver.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10187.html">
<input type="submit" value=" Belai Beshah ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Understanding+read_repairs%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10178.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10199.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">A7917235D372C143AA6012D8F81B901D05A06803D6@EX53.exchserver.com</li>
</ul>
</div>
</body>
</html>
