<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: loading erlang terms</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01379" id="c">
<link rel="index" href="maillist.html#01379" id="i">
<link rel="prev" href="msg01378.html" id="p">
<link rel="next" href="msg01380.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01379.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+loading+erlang+terms%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: loading erlang terms</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Charles+Blair%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Charles Blair</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101026" rel="nofollow">Tue, 26 Oct 2010 08:12:38 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Mon, Oct 25, 2010 at 07:34:13PM -0700, Dan Reverri wrote:
&gt; I don't understand your use case; can you expand on what you are doing?</pre><pre>

Perhaps this in the category of &quot;too much information,&quot; but since you asked, I 
had written an OAI-PMH provider in erlang. My backing store is a dets file, 
which I load into memory and read into an ets table when the server starts up. 
The memory-resident database consists of keys associated with values which are 
erlang terms. I use these terms for filtering queries conforming to the OAI-PMH 
protocol specification. The way I create the dets file is to begin with a file 
of plain text. Suppose I had one term in it (I'll typically have hundreds or 
thousands), it might look like this:

{oai_dc,&quot;AEP-WYS97&quot;,                                                            
           
        {{2004,10,28},{17,21,25}},
        [&quot;aep&quot;],                                                                
           
        &quot;/storage/aep2003/metadata/oai_dc/oai_dc-AEP-WYS97.xml&quot;}.

In erlang itself, if I've called the file AEP-WYS97, I can do something like 
this:

1&gt; {_, Term} = file:consult(&quot;AEP-WYS97&quot;).
{ok,[{oai_dc,&quot;AEP-WYS97&quot;,
             {{2004,10,28},{17,21,25}},
             [&quot;aep&quot;],
             &quot;/storage/aep2003/metadata/oai_dc/oai_dc-AEP-WYS97.xml&quot;}]}

2&gt; Term.
[{oai_dc,&quot;AEP-WYS97&quot;,
         {{2004,10,28},{17,21,25}},
         [&quot;aep&quot;],
         &quot;/storage/aep2003/metadata/oai_dc/oai_dc-AEP-WYS97.xml&quot;}]

3&gt; element(2, hd(Term)).
&quot;AEP-WYS97&quot;

Now, if I replace dets/ets with riak, I can do two things (I think). The first 
would be to write an erlang function that does something like the above. But 
the second (which is where my question comes into play) is, if I can load 
arbitrary data types into riak, then is there a way I can specify that what I'm 
loading are erlang terms. If I don't do that, and load strings, I run into this 
sort of nastiness:

(r...@127.0.0.1)295&gt; {ok, Tk} = C:get(&lt;&lt;&quot;oai_dc&quot;&gt;&gt;, &lt;&lt;&quot;dsalhensley-m025&quot;&gt;&gt;).

(r...@127.0.0.1)296&gt; V = riak_object:get_value(Tk).                         
&lt;&lt;&quot;{oai_dc,dsalhensley-m025,        {{2004,11,9},{15,38,27}},        
[dsal,dsal:hensley],        /storage/dsal/hensley/&quot;...&gt;&gt;

(r...@127.0.0.1)300&gt; A = binary_to_list(V).
&quot;{oai_dc,dsalhensley-m025,        {{2004,11,9},{15,38,27}},        
[dsal,dsal:hensley],        
/storage/dsal/hensley/metadata/oai_dc/oai_dc-dsalhensley-m025.xml}&quot;

(r...@127.0.0.1)301&gt; {ok, Tokens, _} = erl_scan:string(A).
{ok,[{'{',1},
     {atom,1,oai_dc},
     {',',1},
     {atom,1,dsalhensley},
     {'-',1},
     {atom,1,m025},
     {',',1},
     {'{',1},
     {'{',1},
     {integer,1,2004},
     {',',1},
     {integer,1,11},
     {',',1},
     {integer,1,9},
     {'}',1},
     {',',1},
     {'{',1},
     {integer,1,15},
     {',',1},
     {integer,1,38},
     {',',1},
     {integer,1,27},
     {'}',1},
     {'}',1},
     {',',1},
     {'[',...},
     {...}|...],
    1}

So far, so good. However:

(r...@127.0.0.1)302&gt; erl_parse:parse_term(Tokens).                          
{error,{1,erl_parse,[&quot;syntax error before: &quot;,&quot;'/'&quot;]}}

This happens because I have unescaped quotation marks in the input. If I had 
intended my input to be strings, then that's something I should have taken care 
of beforehand, but if I intend the input to be terms, then I shouldn't have to.

I'm prepared to use option 1, above, or else convert my terms into strings, and 
parse strings, but string handling in erlang is not particularly efficient, so 
before I go either of those routes, I'm curious whether I can tell riak, this 
is an erlang term, have it be stored as such, so when I go to use it, my code 
doesn't have to do any further transformation that isn't related to the job at 
hand (filtering).

I'm relatively new to riak (less than a week), so perhaps there is a better 
approach entirely.

Thanks.





_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01378.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01379">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01379">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01380.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01377.html">loading erlang terms</a></span> <span class="sender italic">Charles Blair</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01378.html">Re: loading erlang terms</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: loading erlang terms</span> <span class="sender italic">Charles Blair</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01380.html">Re: loading erlang terms</a></span> <span class="sender italic">Seth Falcon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01381.html">Re: loading erlang terms</a></span> <span class="sender italic">Charles Blair</span></li>
<li class="icons-email"><span class="subject"><a href="msg01382.html">Re: loading erlang terms</a></span> <span class="sender italic">Charles Blair</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01386.html">Re: loading erlang terms</a></span> <span class="sender italic">Seth Falcon</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg01388.html">Re: loading erlang terms</a></span> <span class="sender italic">Charles Blair</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01394.html">Re: loading erlang terms</a></span> <span class="sender italic">Scott Lystig Fritchie</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01396.html">Re: loading erlang terms</a></span> <span class="sender italic">Charles Blair</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01525.html">Re: loading erlang terms</a></span> <span class="sender italic">Scott Lystig Fritchie</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: loading erlang terms">
<input type="hidden" name="msgid" value="20101026151119.GM1058@an.lib.uchicago.edu">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01379.html">
<input type="submit" value=" Charles Blair ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+loading+erlang+terms%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01378.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01380.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20101026151119.GM1058@an.lib.uchicago.edu</li>
</ul>
</div>
</body>
</html>
