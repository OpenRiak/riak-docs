<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: documents disappear from riak search index</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#06260" id="c">
<link rel="index" href="mail2.html#06260" id="i">
<link rel="prev" href="msg06209.html" id="p">
<link rel="next" href="msg06272.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06260.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+documents+disappear+from+riak+search+index%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: documents disappear from riak search index</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22francisco+treacy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">francisco treacy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120112" rel="nofollow">Thu, 12 Jan 2012 10:04:07 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Ryan,

I had an incident when removing a replica back in November. But then I
managed to fix the state of the cluster. Then in December I passed the
script to re-save all docs so it worked (i.e. documents matched), and
now in January we were still noticing discrepancies.</pre><pre>

I noticed the problem only twice, perhaps it did happen more often.
Avg load is way under control, no spikes, no faulty disks. The cluster
hasn't changed at all since November.

Francisco

2012/1/10 Ryan Zezeski &lt;rzeze...@basho.com&gt;:
&gt; Typically, something like this would be caused by replicas being lost as
&gt; Search currently has no anti-entropy.  I imagine you would have mentioned
&gt; replica loss if that was the case, though.  You've seen this problem at
&gt; least twice, correct?  Were there other occurrences?  If so how many and
&gt; about how often do you notice them?  Did any other system events happen that
&gt; might be correlated such as spike in load, faulty disks, node
&gt; join/leave/remove, node down/up, etc.
&gt;
&gt; On Tue, Jan 10, 2012 at 11:31 AM, francisco treacy
&gt; &lt;francisco.tre...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt; 2012/1/10 Ryan Zezeski &lt;rzeze...@basho.com&gt;:
&gt;&gt; &gt; When you say &quot;doesn't show up on the search query results *anymore*&quot;
&gt;&gt; &gt; does
&gt;&gt; &gt; that imply that at one time they did?
&gt;&gt;
&gt;&gt; Absolutely. As a matter of fact that's what some of my users were
&gt;&gt; asking: &quot;why can't I see X anymore?&quot;.
&gt;&gt;
&gt;&gt; &gt;  I'm trying to understand if the index
&gt;&gt; &gt; entries appear to have been lost or if it was never successfully written
&gt;&gt; &gt; in
&gt;&gt; &gt; the first place.
&gt;&gt;
&gt;&gt; They are definitely written to the index in the first place. I recall
&gt;&gt; noticing a similar situation early December, where I compared item
&gt;&gt; counts from a full-bucket map/reduce vs. a search map/reduce and they
&gt;&gt; didn't match.
&gt;&gt;
&gt;&gt; Went about it by re-saving all items in the bucket as I said before.
&gt;&gt; Did a check just after, and numbers matched.
&gt;&gt;
&gt;&gt; And this morning I was back to the inequality after a user complaint,
&gt;&gt; so passed the re-save script once again. Obviously this is not
&gt;&gt; sustainable.
&gt;&gt;
&gt;&gt; The curious thing is that those documents are not even regularly
&gt;&gt; updated or deleted.
&gt;&gt;
&gt;&gt; &gt; Any errors you see in the logs may be relevant.  Feel free to include
&gt;&gt; &gt; snippets of anything you find.
&gt;&gt;
&gt;&gt; I went through all sasl-error.log from all 3 nodes and couldn't find
&gt;&gt; anything related to search. Where else could I look? Do you have any
&gt;&gt; idea what could be causing this behaviour?
&gt;&gt;
&gt;&gt; Francisco
&gt;&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On Tue, Jan 10, 2012 at 4:16 AM, francisco treacy
&gt;&gt; &gt; &lt;francisco.tre...@gmail.com&gt; wrote:
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Hi all,
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; I am running (still) 0.14.2 in production, and using Riak Search to
&gt;&gt; &gt;&gt; index certain buckets. Those buckets have the Riak Search pre-commit
&gt;&gt; &gt;&gt; hook enabled.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Once in a while I get complaints of missing documents from my clients,
&gt;&gt; &gt;&gt; and it just happened.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; I checked and the document:
&gt;&gt; &gt;&gt;  - is correctly stored in Riak
&gt;&gt; &gt;&gt;  - doesn't show up on the search query results *anymore*
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; My workaround before was to go through every key in the bucket and
&gt;&gt; &gt;&gt; save it again, as to trigger the search hook. Of course, this is less
&gt;&gt; &gt;&gt; than ideal.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Should I be looking for something specific in the logs? What could be
&gt;&gt; &gt;&gt; going on here?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Thanks,
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Francisco
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; _______________________________________________
&gt;&gt; &gt;&gt; riak-users mailing list
&gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt;&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06209.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#06260">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#06260">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06272.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06201.html">documents disappear from riak search index</a></span> <span class="sender italic">francisco treacy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06202.html">Re: documents disappear from riak search index</a></span> <span class="sender italic">francisco treacy</span></li>
<li class="icons-email"><span class="subject"><a href="msg06205.html">Re: documents disappear from riak search index</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06208.html">Re: documents disappear from riak search index</a></span> <span class="sender italic">francisco treacy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06209.html">Re: documents disappear from riak search ind...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: documents disappear from riak search...</span> <span class="sender italic">francisco treacy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06272.html">Re: documents disappear from riak s...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06283.html">Re: documents disappear from ri...</a></span> <span class="sender italic">francisco treacy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06286.html">Re: documents disappear fro...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li class="icons-email"><span class="subject"><a href="msg06468.html">Re: documents disappear fro...</a></span> <span class="sender italic">francisco treacy</span></li>
<li class="icons-email"><span class="subject"><a href="msg06472.html">Re: documents disappear fro...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: documents disappear from riak search index">
<input type="hidden" name="msgid" value="CAGfs40vgPU=SOiXRO1AdgchisfhUCh6+OR1xp0cebPUBPF+eOg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06260.html">
<input type="submit" value=" francisco treacy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+documents+disappear+from+riak+search+index%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06209.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06272.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGfs40vgPU=SOiXRO1AdgchisfhUCh6+OR1xp0cebPUBPF+eOg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
