<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: RIAK 1.4.6 - Mass key deletion</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#14514" id="c">
<link rel="index" href="maillist.html#14514" id="i">
<link rel="prev" href="msg14513.html" id="p">
<link rel="next" href="msg13683.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14514.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+RIAK+1.4.6+%5C-+Mass+key+deletion%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: RIAK 1.4.6 - Mass key deletion</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Von%5C-Maszewski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Von-Maszewski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140720" rel="nofollow">Sun, 20 Jul 2014 08:32:16 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Simon,

The aggressive delete code is only in the 2.0 release.  There are currently no 
plans to backport that feature to 1.4.</pre><pre>

A couple of generic performance improvements for compactions are now in the 
1.4.10 release.  These improvements relate to general compactions.  They do not 
speed the removal of deleted items.

Matthew


On Jul 20, 2014, at 9:24 AM, Simon Effenberg &lt;seffenb...@team.mobile.de&gt; wrote:

&gt; Hi Matthew,
&gt; 
&gt; so is there a awy to improve the compaction rate in Riak &lt; 2.0 or do I
&gt; have to upgrade to 2.0 to get this?
&gt; 
&gt; Cheers
&gt; Simon
&gt; 
&gt; On Sun, Apr 06, 2014 at 06:30:30PM -0400, Matthew Von-Maszewski wrote:
&gt;&gt;   Edgar,
&gt;&gt;   This is indirectly related to you key deletion discussion.  I made changes
&gt;&gt;   recently to the aggressive delete code.  The second section of the
&gt;&gt;   following (updated) web page discusses the adjustments:
&gt;&gt;       <a  rel="nofollow" href="https://github.com/basho/leveldb/wiki/Mv-aggressive-delete">https://github.com/basho/leveldb/wiki/Mv-aggressive-delete</a>
&gt;&gt;   Matthew
&gt;&gt;   On Apr 6, 2014, at 4:29 PM, Edgar Veiga &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt; 
&gt;&gt;     Matthew, thanks again for the response!
&gt;&gt;     That said, I'll wait again for the 2.0 (and maybe buy some bigger disks
&gt;&gt;     :)
&gt;&gt;     Best regards
&gt;&gt; 
&gt;&gt;     On 6 April 2014 15:02, Matthew Von-Maszewski &lt;matth...@basho.com&gt; wrote:
&gt;&gt; 
&gt;&gt;       Edgar,
&gt;&gt;       In Riak 1.4, there is no advantage to using empty values versus
&gt;&gt;       deleting.
&gt;&gt;       leveldb is a &quot;write once&quot; data store.  New data for a given key never
&gt;&gt;       physically overwrites old data for the same key.  New data &quot;hides&quot; the
&gt;&gt;       old data by being in a lower level, and therefore picked first.
&gt;&gt;       leveldb's compaction operation will remove older key/value pairs only
&gt;&gt;       when the newer key/value is pair is part of a compaction involving
&gt;&gt;       both new and old.  The new and the old key/value pairs must have
&gt;&gt;       migrated to adjacent levels through normal compaction operations
&gt;&gt;       before leveldb will see them in the same compaction.  The migration
&gt;&gt;       could take days, weeks, or even months depending upon the size of your
&gt;&gt;       entire dataset and the rate of incoming write operations.
&gt;&gt;       leveldb's &quot;delete&quot; object is exactly the same as your empty JSON
&gt;&gt;       object.  The delete object simply has one more flag set that allows it
&gt;&gt;       to also be removed if and only if there is no chance for an identical
&gt;&gt;       key to exist on a higher level.
&gt;&gt;       I apologize that I cannot give you a more useful answer.  2.0 is on
&gt;&gt;       the horizon.
&gt;&gt;       Matthew
&gt;&gt;       On Apr 6, 2014, at 7:04 AM, Edgar Veiga &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt; 
&gt;&gt;         Hi again!
&gt;&gt;         Sorry to reopen this discussion, but I have another question
&gt;&gt;         regarding the former post.
&gt;&gt;         What if, instead of doing a mass deletion (We've already seen that
&gt;&gt;         it will be non profitable, regarding disk space) I update all the
&gt;&gt;         values with an empty JSON object &quot;{}&quot; ? Do you see any problem with
&gt;&gt;         this? I no longer need those millions of values that are living in
&gt;&gt;         the cluster... 
&gt;&gt;         When the version 2.0 of riak runs stable I'll do the update and only
&gt;&gt;         then delete those keys!
&gt;&gt;         Best regards
&gt;&gt; 
&gt;&gt;         On 18 February 2014 16:32, Edgar Veiga &lt;edgarmve...@gmail.com&gt;
&gt;&gt;         wrote:
&gt;&gt; 
&gt;&gt;           Ok, thanks a lot Matthew.
&gt;&gt; 
&gt;&gt;           On 18 February 2014 16:18, Matthew Von-Maszewski
&gt;&gt;           &lt;matth...@basho.com&gt; wrote:
&gt;&gt; 
&gt;&gt;             Riak 2.0 is coming.  Hold your mass delete until then.  The
&gt;&gt;             &quot;bug&quot; is within Google's original leveldb architecture.  Riak
&gt;&gt;             2.0 sneaks around to get the disk space freed.
&gt;&gt;             Matthew
&gt;&gt;             On Feb 18, 2014, at 11:10 AM, Edgar Veiga
&gt;&gt;             &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt; 
&gt;&gt;               The only/main purpose is to free disk space..
&gt;&gt;               I was a little bit concerned regarding this operation, but now
&gt;&gt;               with your feedback I'm tending to don't do nothing, I can't
&gt;&gt;               risk the growing of space... 
&gt;&gt;               Regarding the overhead I think that with a tight throttling
&gt;&gt;               system I could control and avoid overloading the cluster.
&gt;&gt;               Mixed feelings :S
&gt;&gt; 
&gt;&gt;               On 18 February 2014 15:45, Matthew Von-Maszewski
&gt;&gt;               &lt;matth...@basho.com&gt; wrote:
&gt;&gt; 
&gt;&gt;                 Edgar,
&gt;&gt;                 The first &quot;concern&quot; I have is that leveldb's delete does not
&gt;&gt;                 free disk space.  Others have executed mass delete
&gt;&gt;                 operations only to discover they are now using more disk
&gt;&gt;                 space instead of less.  Here is a discussion of the problem:
&gt;&gt;                 <a  rel="nofollow" href="https://github.com/basho/leveldb/wiki/mv-aggressive-delete">https://github.com/basho/leveldb/wiki/mv-aggressive-delete</a>
&gt;&gt;                 The link also describes Riak's database operation overhead.
&gt;&gt;                  This is a second &quot;concern&quot;.  You will need to carefully
&gt;&gt;                 throttle your delete rate or the overhead will likely impact
&gt;&gt;                 your production throughput.
&gt;&gt;                 We have new code to help quicken the actual purge of deleted
&gt;&gt;                 data in Riak 2.0.  But that release is not quite ready for
&gt;&gt;                 production usage.
&gt;&gt;                 What do you hope to achieve by the mass delete?
&gt;&gt;                 Matthew
&gt;&gt;                 On Feb 18, 2014, at 10:29 AM, Edgar Veiga
&gt;&gt;                 &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt; 
&gt;&gt;                   Sorry, forgot that info!
&gt;&gt;                   It's leveldb.
&gt;&gt;                   Best regards
&gt;&gt; 
&gt;&gt;                   On 18 February 2014 15:27, Matthew Von-Maszewski
&gt;&gt;                   &lt;matth...@basho.com&gt; wrote:
&gt;&gt; 
&gt;&gt;                     Which Riak backend are you using:  bitcask, leveldb,
&gt;&gt;                     multi?
&gt;&gt; 
&gt;&gt;                     Matthew
&gt;&gt; 
&gt;&gt;                     On Feb 18, 2014, at 10:17 AM, Edgar Veiga
&gt;&gt;                     &lt;edgarmve...@gmail.com&gt; wrote:
&gt;&gt; 
&gt;&gt;&gt; Hi all!
&gt;&gt;&gt; 
&gt;&gt;&gt; I have a fairly trivial question regarding mass
&gt;&gt;                     deletion on a riak cluster, but firstly let me give you
&gt;&gt;                     just some context. My cluster is running with riak 1.4.6
&gt;&gt;                     on 6 machines with a ring of 256 nodes and 1Tb ssd
&gt;&gt;                     disks.
&gt;&gt;&gt; 
&gt;&gt;&gt; I need to execute a massive object deletion on a
&gt;&gt;                     bucket, I'm talking of ~1 billion keys (The object
&gt;&gt;                     average size is ~1Kb). I will not retrive the keys from
&gt;&gt;                     riak because a I have a file with all of them. I'll just
&gt;&gt;                     start a script that reads them from the file and
&gt;&gt;                     triggers an HTTP DELETE for each one.
&gt;&gt;&gt; The cluster will continue running on production with a
&gt;&gt;                     quite high load serving all other applications, while
&gt;&gt;                     running this deletion.
&gt;&gt;&gt; 
&gt;&gt;&gt; My question is simple, do I need to have any kind of
&gt;&gt;                     extra concerns regarding this action? Do you advise me
&gt;&gt;                     on taking special attention to any kind of metrics
&gt;&gt;                     regarding riak or event the servers where it's running?
&gt;&gt;&gt; 
&gt;&gt;&gt; Best regards!
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; 
&gt;&gt;                     
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; -- 
&gt; Simon Effenberg | Site Op | mobile.international GmbH
&gt; 
&gt; Phone:    + 49. 30. 8109. 7173
&gt; M-Phone:  + 49. 151. 5266. 1558
&gt; Mail:     seffenb...@team.mobile.de
&gt; Web:      www.mobile.de
&gt; 
&gt; Marktplatz 1 | 14532 Europarc Dreilinden | Germany
&gt; 
&gt; ______________________________________________________
&gt; Geschäftsführer: Malte Krüger
&gt; HRB Nr.: 18517 P, Amtsgericht Potsdam
&gt; Sitz der Gesellschaft: Kleinmachnow
&gt; ______________________________________________________
&gt; 


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14513.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#14514">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14514">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13683.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14028.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg14027.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg14032.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg14033.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg14034.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg14035.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg14045.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg14046.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg14048.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg14513.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: RIAK 1.4.6 - Mass key deletion</span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13683.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13691.html">Re: RIAK 1.4.6 - Mass key deletion</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: RIAK 1.4.6 - Mass key deletion">
<input type="hidden" name="msgid" value="CAFEDA51-56FC-448E-A124-F6E2E4A61F94@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14514.html">
<input type="submit" value=" Matthew Von-Maszewski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+RIAK+1.4.6+%5C-+Mass+key+deletion%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14513.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13683.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAFEDA51-56FC-448E-A124-F6E2E4A61F94@basho.com</li>
</ul>
</div>
</body>
</html>
