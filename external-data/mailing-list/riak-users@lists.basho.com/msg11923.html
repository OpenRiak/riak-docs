<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: RiakNode class in Python client 2.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd12.html#11923" id="c">
<link rel="index" href="mail12.html#11923" id="i">
<link rel="prev" href="msg11922.html" id="p">
<link rel="next" href="msg11919.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11923.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+RiakNode+class+in+Python+client+2.0%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: RiakNode class in Python client 2.0</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130806" rel="nofollow">Tue, 06 Aug 2013 19:08:03 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Oh, sorry I misunderstood. I thought celery workers were threads within the
same Python interpreter. By all means have one client per Python process,
but see if you can keep it around between tasks. If the throughput on your
task queue is high enough, you should be able to make use of the benefit of
persistent connections and load-balancing.</pre><pre>


On Tue, Aug 6, 2013 at 8:10 PM, Matt Black &lt;matt.bl...@jbadigital.com&gt;wrote:

&gt; Hi Sean,
&gt;
&gt; I would indeed like to take advantage of the pooling features of the new
&gt; client. Shared objects across Celery workers isn't something I'd ever
&gt; really looked at before - but it seems the only real way to share across
&gt; workers (ie, processes) is to use memcache or similar. Which makes sense.
&gt;
&gt; Cheers
&gt; Matt
&gt;
&gt;
&gt;
&gt; On 6 August 2013 23:04, Sean Cribbs &lt;s...@basho.com&gt; wrote:
&gt;
&gt;&gt; Hi Matt,
&gt;&gt;
&gt;&gt; You are correct about the Decaying class, it is a wrapper for an
&gt;&gt; exponentially-decaying error rate. The idea is, you configure your client
&gt;&gt; to connect to multiple Riak nodes, and if one goes down or is restarted,
&gt;&gt; the possibility of its selection for new connections can be automatically
&gt;&gt; reduced by detecting network errors. Of course, this is moot when you are
&gt;&gt; connecting to the cluster via a load-balancer; at that point the
&gt;&gt; error-tracking logic can't help you.
&gt;&gt;
&gt;&gt; If you are creating and throwing away RiakClient objects frequently,
&gt;&gt; neither the error-tracking nor the connection pool will help you much.
&gt;&gt; However, I urge you to consider keeping a single client around, in some
&gt;&gt; globally accessible place (module constant? config object?). Your
&gt;&gt; concurrent workers will get to take advantage of existing connections, and
&gt;&gt; your socket/file-handle usage will be less.
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Aug 6, 2013 at 1:07 AM, Matt Black &lt;matt.bl...@jbadigital.com&gt;wrote:
&gt;&gt;
&gt;&gt;&gt; I've been looking through the changes to the RiakClient class - and have
&gt;&gt;&gt; a question about the nodes list and RiakNode/Decaying class.
&gt;&gt;&gt;
&gt;&gt;&gt; It seems that the Decaying class is used internally to track error_rates
&gt;&gt;&gt; (request failure_rate?) of nodes in the available pool.
&gt;&gt;&gt;
&gt;&gt;&gt; In the application I maintain, we're accessing Riak in many concurrent
&gt;&gt;&gt; celery workers - so my assumption would be that this internal error_rate
&gt;&gt;&gt; tracking wouldn't do much good. Have I got this right? Is the client's
&gt;&gt;&gt; internal &quot;nodes&quot; list only really useful in a long running application?
&gt;&gt;&gt; (ie, when I'm not instantiating RiakClient fresh for each query).
&gt;&gt;&gt;
&gt;&gt;&gt; We currently have a &quot;pool&quot; of Riak nodes in some configuration, from
&gt;&gt;&gt; which a random IP is chosen for each request.
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;&gt;
&gt;
&gt;


-- 
Sean Cribbs &lt;s...@basho.com&gt;
Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11922.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd12.html#11923">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail12.html#11923">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11919.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11908.html">RiakNode class in Python client 2.0</a></span> <span class="sender italic">Matt Black</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11912.html">Re: RiakNode class in Python client 2.0</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11922.html">Re: RiakNode class in Python client 2.0</a></span> <span class="sender italic">Matt Black</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: RiakNode class in Python client 2.0</span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: RiakNode class in Python client 2.0">
<input type="hidden" name="msgid" value="CAHsw=e2uZA1Oizshqry0JG77xD13KH6edW-mO5takTkabqsbZQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11923.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+RiakNode+class+in+Python+client+2.0%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11922.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11919.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAHsw=e2uZA1Oizshqry0JG77xD13KH6edW-mO5takTkabqsbZQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
