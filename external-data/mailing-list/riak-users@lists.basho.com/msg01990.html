<!DOCTYPE html>
<html lang="en">
<head>
<title>newbie questions: sorted keys, ADT primitives, and link manipulation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd3.html#01990" id="c">
<link rel="index" href="mail3.html#01990" id="i">
<link rel="prev" href="msg01986.html" id="p">
<link rel="next" href="msg01991.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01990.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22newbie+questions%5C%3A+sorted+keys%2C+ADT+primitives%2C+and+link+manipulation%22&amp;o=newest" rel="nofollow"><span itemprop="name">newbie questions: sorted keys, ADT primitives, and link manipulation</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Gary+William+Flake%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Gary William Flake</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110115" rel="nofollow">Sat, 15 Jan 2011 16:23:23 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I am building a backend for a web service and Riak looks to be a strong fit
for my needs at this point.  However, there is one really simple requirement
that I can't figure out how to implement on Riak with any sort of
efficiency.  To simplify the question, suppose that I want a twitter-like
service that has billions of smallish documents that enter into the backend
over a period of time.  Typical read pattern will be:</pre><pre>

1. List the last N documents
2. Given a document, see the N that came before this one.
3. From a random point, see the N documents before this one.

Hence, what I really want is to be able to access the documents in sorted
order by timestamp.  I know that I can do all of this with a map/reduce job,
but this solution literally requires the backend to scan each and every
document which seems less than ideal.

Is there a generally accepted &quot;right&quot; way to do this on Riak?  Or is there
no known way to do this gracefully, and I need to be prepared to roll my own
secondary indices?  Or, can this be handled with a Riak Search range query?

###

The second topic is concerned with finding an elegant way to address the
first question.  One way to solve the problem above is to use a bucket as a
poor man's list.  At the application layer, when I insert a new document, I
could create a new k:v pair in my &quot;list&quot; bucket with the key being an
integer corresponding to this document's position in the corpus, and the
value being the actual key in the document bucket.  With this scheme, I
could satisfy the scenario above with the following observations:

1. Once I have the list key for a document, I could find the N before it in
O(N) time which is an improvement over the map/reduce solution which is
O(size of corpus) / O(cluster size).

2. This solution assumes atomicity that doesn't exist in practice (e.g., the
operations &quot;new id &lt;- number of docs&quot;, and &quot;add a new doc with key new id&quot;
have to complete as an atomic operation if multiple clients are attempting
an insert).

3. This solution also wants a multiget styled function to map index values
to true document keys, and then to get the resulting document.

I know what you are thinking: just use a serialized JSON array as the value
of the list that you want, then just get it, deserialize it, mutate it, then
update its value.  But this is horrific because each insertion takes
O(corpus size) time.

Bottom line: life sucks no matter which route we take.

What I think is needed are redis styled objects that support O(1) atomic
operations.  For example, if I simply had a k:v pair where the value was a
list which supported insert/delete front/rear, then we are golden.

###

This brings me to my third question / observation.  In scanning over the
archives of this list, I see that others have requested this feature before,
but I haven't seen any mention of the feature being considered.  (Please,
please!  I hope I am wrong).

So, I want to offer what I think is the minimal feature request that
supports the scenarios that I am trying to achieve.  Basically, I want to
build off of links, allowing them to generalize into container types.  My
assumptions:

1. Links have a natural order in that they alway come out in the same order
that they are created (at least that's what the python client API states,
but I can't confirm it in the Riak docs).

2. Links seem to support mutation operations, meaning that I can add a link
and remove a link in O(1) time (and not in time proportional to the number
of links on the record).

If both of these are true, then all that is needed is to add simple O(1)
mutation operations allowing one to treat a records links as a special
container that references to other records.  Insert/delete front/rear will
give you stacks and queues.  A small addition to the API would support sets.

###

That's all for now.  I hope someone can chime in with something to add on
top.  My real hope is that I've misunderstood the capabilities of Riak and
that what I want to do can be done today.  But if that's not the case, I am
curious if others have the same needs and if they know how to work around
them.

Thanks,
-- GWF
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01986.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd3.html#01990">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail3.html#01990">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01991.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">newbie questions: sorted keys, ADT primitives, and link...</span> <span class="sender italic">Gary William Flake</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01991.html">Re: newbie questions: sorted keys, ADT primitives,...</a></span> <span class="sender italic">Eric Moritz</span></li>
<li class="icons-email"><span class="subject"><a href="msg01992.html">Re: newbie questions: sorted keys, ADT primitives,...</a></span> <span class="sender italic">Eric Moritz</span></li>
<li class="icons-email"><span class="subject"><a href="msg01999.html">Re: newbie questions: sorted keys, ADT primitives,...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="newbie questions: sorted keys, ADT primitives, and link manipulation">
<input type="hidden" name="msgid" value="AANLkTik1MRGHssT0qChZew0QJEK+UNkAyUBKC_tfVDZE@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01990.html">
<input type="submit" value=" Gary William Flake ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22newbie+questions%5C%3A+sorted+keys%2C+ADT+primitives%2C+and+link+manipulation%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01986.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01991.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTik1MRGHssT0qChZew0QJEK+UNkAyUBKC_tfVDZE@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
