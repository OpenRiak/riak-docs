<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak Map / Reduce / Map capacity limit reached at 20000 keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07494" id="c">
<link rel="index" href="maillist.html#07494" id="i">
<link rel="prev" href="msg07491.html" id="p">
<link rel="next" href="msg07496.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07494.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+Map+%5C%2F+Reduce+%5C%2F+Map+capacity+limit+reached+at+20000+keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak Map / Reduce / Map capacity limit reached at 20000 keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22claudef%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">claudef</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120521" rel="nofollow">Mon, 21 May 2012 10:03:37 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Dear colleagues, 

 During my pilot testing I've got an error message during a text pattern 
search operation coded as a Riak Client &quot;map&quot; logic. This error appeared 
at a volume of approximately 20.000 keys, each with an 1 KB free text data 
block associated. The Map function was coded in JavaScript. Here the 
source: </pre><pre>

query.map(&quot;&quot;&quot;function(v) { var str = '&quot;&quot;&quot;+search_string+&quot;&quot;&quot;'; var data = 
JSON.parse(v.values[0].data); if (v.values[0].data.toString().search(str) 
!= -1) { return [[v.key, data]]; } return []; }&quot;&quot;&quot;)
query.reduce(&quot;function(v) { var counteri = 0;  for(var i in v) {counteri 
+= 1;} return [['counter_found', counteri]]; } &quot;)

The error shown is the following : [preflist_exhausted]

zbra:/opt/python/myprojects/riak # python pilot3.py
starts at : 2012-05-21 07:35:49.070470
How many keys in the bucket: 19760
Riak client exception: Error running MapReduce operation. Status: 500 : 
{&quot;phase&quot;:0,&quot;error&quot;:&quot;[preflist_exhausted]&quot;,&quot;input&quot;:&quot;{ok,{r_object,&lt;&lt;\&quot;ramtest\&quot;&gt;&gt;,&lt;&lt;\&quot;XDHt25887344\&quot;&gt;&gt;,[{r_content,{dict,6,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[&lt;&lt;\&quot;Links\&quot;&gt;&gt;]],[],[],[],[],[],[],[],[[&lt;&lt;\&quot;content-type\&quot;&gt;&gt;,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110],[&lt;&lt;\&quot;X-Riak-VTag\&quot;&gt;&gt;,53,86,72,48,120,77,53,99,114,86,111,77,77,54,109,114,79,70,54,52,49,109]],[[&lt;&lt;\&quot;index\&quot;&gt;&gt;]],[],[[&lt;&lt;\&quot;X-Riak-Last-Modified\&quot;&gt;&gt;|{1337,595548,374416}]],[],[[&lt;&lt;\&quot;X-Riak-Meta\&quot;&gt;&gt;]]}}},&lt;&lt;\&quot;{\&quot;is_valid\&quot;:
 
true, \&quot;cEDO\&quot;: 
\&quot;GQZumfdWBCfX...\&quot;&gt;&gt;}],...},...}&quot;,&quot;type&quot;:&quot;forward_preflist&quot;,&quot;stack&quot;:&quot;[]&quot;}

Any suggestions how to improve the pattern scan capability in the in the 
RiakClient  map function, or how enhance the JavaScript code for better 
capacity? 
Are there any servers setup tuning options to adjust? 

Thanks in advance for your support. 

Regards, 
Claude

Claude Falbriard 
Certified IT Specialist L2 - Middleware
AMS Hortol√¢ndia / SP - Brazil
phone:    +55 19 9837 0789
cell:         +55 13 8117 3316
e-mail:    clau...@br.ibm.com
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07491.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07494">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07494">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07496.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Riak Map / Reduce / Map capacity limit reached at 20000 key...</span> <span class="sender italic">claudef</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07496.html">Re: Riak Map / Reduce / Map capacity limit reached at ...</a></span> <span class="sender italic">Matthew Tovbin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07502.html">Re: Riak Map / Reduce / Map capacity limit reached...</a></span> <span class="sender italic">claudef</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07510.html">Re: Riak Map / Reduce / Map capacity limit rea...</a></span> <span class="sender italic">Matthew Tovbin</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak Map / Reduce / Map capacity limit reached at 20000 keys">
<input type="hidden" name="msgid" value="OF397CEBED.29781EBF-ON83257A05.005C3253-03257A05.005DB288@br.ibm.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07494.html">
<input type="submit" value=" claudef ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+Map+%5C%2F+Reduce+%5C%2F+Map+capacity+limit+reached+at+20000+keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07491.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07496.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">OF397CEBED.29781EBF-ON83257A05.005C3253-03257A05.005DB288@br.ibm.com</li>
</ul>
</div>
</body>
</html>
