<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Bucket planning</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00084" id="c">
<link rel="index" href="maillist.html#00084" id="i">
<link rel="prev" href="msg00083.html" id="p">
<link rel="next" href="msg00085.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00084.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bucket+planning%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Bucket planning</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100420" rel="nofollow">Tue, 20 Apr 2010 01:05:14 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<tt>Unfortunately, there is no offset, limit, sorted set or pagination  
</tt><tt>built in to riak. You kinda need to maintain your own index for any of  
</tt><tt>that and/or rely on m/r in a less than real-time sort of way. I would  
</tt><tt>take your day keys and make them smaller... Like hours or even  
</tt><tt>minutes. The number of keys in your bucket is only a concern if you  
</tt><tt>are not maintaining your own key index somewhere else. If you are not  
</tt><tt>you are forced to hit the bucket list keys function which is one of  
</tt><tt>the most costly things you can do in riak. Again, specifics will  
</tt><tt>determine what is best. Also, I would drop the &quot;_&quot; from the key for  
</tt><tt>brevity ;)
</tt><pre style="margin: 0em;">

</pre><tt>Riak gets you insane persisted storage and access to raw data  
</tt><tt>primitives in a super friendly http wrapper (+erlang,+pbuffs), but  
</tt><tt>doesn't do some of that more abstracted stuff. Thats an exercise for  
</tt><tt>the user.
</tt><pre style="margin: 0em;"></pre><pre>

Take a good look at pairing with redis for sorted sets.

I believe only the post hook is erlang only.

-Alexander

@siculars on twitter
<a  rel="nofollow" href="http://siculars.posterous.com">http://siculars.posterous.com</a>

Sent from my iPhone

On Apr 20, 2010, at 2:17, Brandon Smith &lt;bran...@16cards.com&gt; wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I think I understand your suggestion regarding an additional index in
other buckets.

To use your &quot;keys per time slice&quot; example, if I wanted to get all of
last month's phone call records, I will have already built up a
bucket-key pair that contains a list of keys...

GET /riak/callreport/2010_03

[[&quot;call&quot;,&quot;1234567890&quot;],[&quot;call&quot;,&quot;1234567891&quot;],[&quot;call&quot;,&quot;1234567892&quot;]]


With this list, I could then use it as input for a Map/Reduce job. I
can see how these types of inverted indices can be built up through
the commit hooks (although at present, it seems providing and Erlang
function is the only option, right???).

Frankly, if I've got it right, it seems that this pattern is ripe for
being baked into Riak by way of some form of declarative means... or
through some pre-built commit functions.

Nevertheless, there are one conceptual leap that I am failing to grasp
about Riak...

1) How do I do the equivalent of a LIMIT/OFFSET in Riak?

I will be storing a very large number of bucket-key pairs of which I
need to retrieve a subset and always ordered chronologically. I
presume that if such an inverted index as shown above is maintained in
an array that chronological order can be preserved implicitly without
having to any type of forced ordering function.

However, how can I page through the results of a dataset? If even the
inverted index is sufficiently large (I estimate a constant of 57,600
events a day just for the initial event type Riak will be taking on...
other types of events not initially introduced will increase as the
number of customers in our multi-tenant system increase) is there a
pattern for paging through data in Riak?

Brandon

</pre><tt>On Tue, Apr 20, 2010 at 12:04 AM, Alexander Sicular &lt;sicul...@gmail.com 
</tt><tt>&gt; wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>I would go with A. An advantage of your data is that it is  
</tt><tt>immutable. Since
</tt><tt>it never changes you can do extensive m/r pre computations and have  
</tt><tt>them run
</tt><pre style="margin: 0em;">
continuously on some frequency. I would also probably spend some time
</pre><tt>thinking about the new pre/post hook features to potentially build  
</tt><tt>some
</tt><tt>additional index in other buckets. Like in particular keys per time  
</tt><tt>slice.
</tt><pre style="margin: 0em;">

Do let us know how you proceed!

-Alexander


@siculars on twitter
<a  rel="nofollow" href="http://siculars.posterous.com">http://siculars.posterous.com</a>

Sent from my iPhone

On Apr 19, 2010, at 21:36, Brandon Smith &lt;bran...@16cards.com&gt; wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I am looking to use Riak as a data store for events in our system.
Namely, I have a handful of event types now and anticipate much more
later.

Consider the following &quot;event&quot;:

{
 &quot;type&quot; : &quot;bws.stats&quot;,
 &quot;host&quot; : &quot;10.1.55.101&quot;,
 &quot;description&quot; : &quot;human friendly description&quot;,
 &quot;details&quot; : &quot;string or Object&quot;,
 &quot;timestamp&quot; : 1234567890,
 &quot;status&quot; : &quot;SUCCESS|FAIL&quot;
}

</pre><tt>A JavaScript client will retrieve events and display them on a  
</tt><tt>webpage
</tt><pre style="margin: 0em;">
and filter the data based on:

1) show just one event type
2) show all events for a given host
3) show all events for last Wednesday
4) show all events that had a status of SUCCESS
</pre><tt>5) show the 10 events before a specific FAIL that matches the same  
</tt><tt>host
</tt><pre style="margin: 0em;">
and type

There are other ways that we plan to query the data, but I think you
get the idea.

</pre><tt>The event data payload is flexible if the above is not optimal for  
</tt><tt>Riak.
</tt><pre style="margin: 0em;">

Thoughts on how to best implement in Riak?

I've considered several approaches...

A) Store all events in one bucket and build out extensive,
</pre><tt>parameterized map/reduce functionality in order to return  
</tt><tt>specialized
</tt><pre style="margin: 0em;">
data sets as described above
</pre><tt>B) Store all events in separate buckets (based on type?)... but  
</tt><tt>where
</tt><pre style="margin: 0em;">
does that leave me when needing to pivot on other fields
C) Have as many buckets as I want to build data sets and duplicate
data across the buckets... i.e. a &quot;type&quot; bucket, &quot;host&quot; bucket, and
</pre><tt>&quot;status&quot; bucket... except this starts to get a bit painful in  
</tt><tt>order to
</tt><pre style="margin: 0em;">
populate buckets that I didn't anticipate
D) Store all events in one bucket and have categorical buckets whose
</pre><tt>entries are NOT duplicate, but rather link to the main &quot;event&quot;  
</tt><tt>bucket
</tt><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00083.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00084">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00084">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00085.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00080.html">Bucket planning</a></span> <span class="sender italic">Brandon Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00082.html">Re: Bucket planning</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00083.html">Re: Bucket planning</a></span> <span class="sender italic">Brandon Smith</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Bucket planning</span> <span class="sender italic">Alexander Sicular</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg00085.html">Re: Bucket planning</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Bucket planning">
<input type="hidden" name="msgid" value="94C961B1-8591-419A-AE0F-92BB6CA9F897@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00084.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bucket+planning%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00083.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00085.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">94C961B1-8591-419A-AE0F-92BB6CA9F897@gmail.com</li>
</ul>
</div>
</body>
</html>
