<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Sorting</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00868" id="c">
<link rel="index" href="maillist.html#00868" id="i">
<link rel="prev" href="msg00866.html" id="p">
<link rel="next" href="msg00869.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00868.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Sorting%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Sorting</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100810" rel="nofollow">Tue, 10 Aug 2010 06:00:37 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Since you won't likely be creating many blog posts at the same time, I'd 
suggest to store them as a single list in one key, or a tail-linked list with a 
single pointer to the head of the list. Either way, your access pattern is very 
simple.</pre><pre>

With the single list in one key, your first map function could look something 
like this (assuming you stored it as JSON):

function(object, keyData, arg){
  // Use arg to give the number of posts you want to return
  var list = Riak.mapValuesJson(object)[0];
  return list.slice(0,arg).map(function(v, i){ return [&quot;posts&quot;, v, i]; });
}

Assuming you just have the keys in the list and not the bucket as well (and new 
keys for posts get pushed onto the front of the array), this function will 
return a list of keys that can be used in a subsequent map phase to get the 
posts. Note we also pass keyData (the index in the original list) to the next 
phase.  That phase would look like this:

function(object, keyData, arg){
  // Assuming the post is in JSON format
  var data = Riak.mapValuesJson(object)[0];
  return [[keyData, data]];
}

Then finally, we'd have a reduce phase that sorts the list based on that 
original index.

function(values, arg){
  return values.sort(function(a,b){ return a[0] - b[0]; });
}

If we were to take the other design, I'd use a link-walking query to capture 
the results. Assuming the pointer to the head of your blog was at &quot;blog/myblog&quot;:

<a  rel="nofollow" href="http://localhost:8098/riak/blog/myblog/posts,_,1/_,next,1/_,next,1/_,next,1/_,next,1">http://localhost:8098/riak/blog/myblog/posts,_,1/_,next,1/_,next,1/_,next,1/_,next,1</a>

...would return 5 posts. Because link-walking queries always return phases in 
the order requested, your results would come back in the order of the blog.

Sean Cribbs &lt;s...@basho.com&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On Aug 10, 2010, at 6:59 AM, Nickolay Platonov wrote:

&gt; Hello,
&gt; 
&gt; I've examined couple of articles about schema design for Riak, but none of 
&gt; them
&gt; cover the sorting topic. 
&gt; 
&gt; I have the following use case - a bucket holds a series of blog posts and I 
&gt; need
&gt; to retrieve the 5 most recent ones. In relational world I would just sort on 
&gt; the 
&gt; &quot;created&quot; field, in the nosql world I'll use map/reduce.
&gt; 
&gt; So, using a naive map/reduce function I will map the document's creation date 
&gt; and then
&gt; sort by it. But this will scan the whole bucket and probably will be a very 
&gt; expensive operation.
&gt; 
&gt; What will be a recommended solution for Riak?
&gt; 
&gt; Thanks, Nickolay
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00866.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00868">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00868">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00869.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00866.html">Sorting</a></span> <span class="sender italic">Nickolay Platonov</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Sorting</span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Sorting">
<input type="hidden" name="msgid" value="B5F511AB-6957-4673-BDCF-A1EDFDD48EAE@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00868.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Sorting%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00866.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00869.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">B5F511AB-6957-4673-BDCF-A1EDFDD48EAE@basho.com</li>
</ul>
</div>
</body>
</html>
