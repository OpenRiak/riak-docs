<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: speeding up riaksearch precommit indexing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03743" id="c">
<link rel="index" href="maillist.html#03743" id="i">
<link rel="prev" href="msg03699.html" id="p">
<link rel="next" href="msg03745.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03743.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+speeding+up+riaksearch+precommit+indexing%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: speeding up riaksearch precommit indexing</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+D.+Rowell%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John D. Rowell</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110617" rel="nofollow">Fri, 17 Jun 2011 21:49:54 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Why not decouple the twitter stream processing from the indexing? More than
likely you have a single process consuming the spritzer stream, so you can
put the fetched results in a queue (hornetq, beanstalk, or even a simple
Redis queue) and then have workers pull from the queue and insert into Riak.
You could run one worker per node and thus insert in parallel into all
nodes. If you need free CPU (e.g. for searches), just throttle the workers
to some sane level. If you see the queue getting bigger, add another Riak
node (and thus another local worker).</pre><pre>

-jd

2011/6/13 Steve Webb &lt;sw...@gnip.com&gt;

&gt; Ok, I've changed my two VMs to each have:
&gt;
&gt; 3 CPUs, 1GB ram, 120GB disk
&gt;
&gt; I'm ingesting the twitter spritzer stream (about 10-20 tweets per second,
&gt; approx 2k of data per tweet).  One bucket is storing the non-indexed tweets
&gt; in full.  Another bucket is storing the indexed tweet string, id, date and
&gt; username.  A maximum of 20 clients can be hitting the 'cluster' at any one
&gt; time.
&gt;
&gt; I'm using n_val=2 so there is replication going on behind the scenes.
&gt;
&gt; I'm using a hardware load-balancer to distribute the work amongst the two
&gt; nodes and now I'm seeing about 75% CPU usage as opposed to 100% on one node
&gt; and 50% on the replicating-only node.
&gt;
&gt; I've monitored the VM over the last few days and it seems to be mostly
&gt; CPU-bound.  The disk I/O is low.  The Network I/O is low.
&gt;
&gt; Q: Can I change the pre-commit to a post-commit trigger or something
&gt; perhaps or will that make any difference at all?  I'm ok if the tweet stuff
&gt; doesn't get indexed immediately and there's a slight lag in indexing if it
&gt; saves on CPU.
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03699.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03743">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03743">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03745.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03600.html">speeding up riaksearch precommit indexing</a></span> <span class="sender italic">Steve Webb</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03618.html">Re: speeding up riaksearch precommit indexing</a></span> <span class="sender italic">Rusty Klophaus</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03662.html">Re: speeding up riaksearch precommit indexing</a></span> <span class="sender italic">Steve Webb</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03699.html">Re: speeding up riaksearch precommit indexing</a></span> <span class="sender italic">Rusty Klophaus</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: speeding up riaksearch precommit indexing</span> <span class="sender italic">John D. Rowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03745.html">Re: speeding up riaksearch precommit index...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03746.html">Re: speeding up riaksearch precommit ...</a></span> <span class="sender italic">John D. Rowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03767.html">Re: speeding up riaksearch precom...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03768.html">Re: speeding up riaksearch pr...</a></span> <span class="sender italic">Sylvain Niles</span></li>
<li class="icons-email"><span class="subject"><a href="msg03770.html">Re: speeding up riaksearch pr...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li class="icons-email"><span class="subject"><a href="msg03772.html">Re: speeding up riaksearch pr...</a></span> <span class="sender italic">Mathias Meyer</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: speeding up riaksearch precommit indexing">
<input type="hidden" name="msgid" value="BANLkTikg6Aw2B=NQM4bhcFvyb82r8689Uw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03743.html">
<input type="submit" value=" John D. Rowell ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+speeding+up+riaksearch+precommit+indexing%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03699.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03745.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BANLkTikg6Aw2B=NQM4bhcFvyb82r8689Uw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
