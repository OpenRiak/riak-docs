<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: CRDT-map usage in erlang mapreduce via HTTP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15443" id="c">
<link rel="index" href="maillist.html#15443" id="i">
<link rel="prev" href="msg15439.html" id="p">
<link rel="next" href="msg15441.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15443.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+CRDT%5C-map+usage+in+erlang+mapreduce+via+HTTP%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: CRDT-map usage in erlang mapreduce via HTTP</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Russell+Brown%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Russell Brown</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150106" rel="nofollow">Tue, 06 Jan 2015 03:19:15 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Cezary,
The keys in a map are pairs, {FieldName, FieldType}, and when map reducing they 
haven’t been through the API layer to make the module names friendly, so rather 
than {my_name, set} you have {may_name, riak_dt_orswot}.</pre><pre>

For example

    M = riak_kv_crdt:map_value(V).

    [{{&lt;&lt;&quot;m1&quot;&gt;&gt;,riak_dt_map},
      [{{x,riak_dt_orswot},[x]},
       {{y,riak_dt_orswot},[y]}]},
     {{&lt;&lt;&quot;s1&quot;&gt;&gt;,riak_dt_orswot},[s]}].

is a map with two fields, a map and a set. The map field is called {&lt;&lt;“m1”&gt;&gt;, 
riak_dt_map}. So to access it:

   prop lists:get_value({&lt;&lt;“m1”&gt;&gt;, riak_dt_orswot}, M).
    [{{x,riak_dt_orswot},[x]},
     {{y,riak_dt_orswot},[y]}]

And likewise to access the set values.

It would be helpful, I agree, if we added something like Bob Ippolito’s KVC[1] 
for Map reduce access to Map values. Please raise an issue against riak[2] as a 
feature request if you would like this for a future version.


riak_dt[3] (the library whose data types riak uses) is a purely functional 
library with no dependencies, so it is easy to play around on the console to 
help you write your map reduce functions before deploying them.

Hope that helps

Russell

[1] KVC -  <a  rel="nofollow" href="https://github.com/etrepum/kvc">https://github.com/etrepum/kvc</a>
[2] Riak - <a  rel="nofollow" href="https://github.com/basho/riak/issues">https://github.com/basho/riak/issues</a>
[3] riak dt - <a  rel="nofollow" href="https://github.com/basho/riak_kv/tree/2.0">https://github.com/basho/riak_kv/tree/2.0</a>

On 4 Jan 2015, at 21:12, Cezary Kosko &lt;koskoceza...@gmail.com&gt; wrote:

&gt; Hi,
&gt; I wanted to ask how you use a map data type in mapreduce. Calling 
&gt; riak_kv_crdt:map_value/1 seems to be but the start, I can't seem to be able 
&gt; to extract particular values - proplists:get_value/2 returns undefined for 
&gt; virtually every possible input, so right now I've localized the keys' index 
&gt; in proplists:get_keys/1's output and am calling 
&gt; proplists:get_value(lists:nth(_whatever_index_, 
&gt; proplists:get_keys(MapValue)), MapValue), but that's as bad as it gets.
&gt; 
&gt; Kind regards,
&gt; Cezary
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15439.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15443">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15443">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15441.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg15439.html">CRDT-map usage in erlang mapreduce via HTTP</a></span> <span class="sender italic">Cezary Kosko</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: CRDT-map usage in erlang mapreduce via HTTP</span> <span class="sender italic">Russell Brown</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: CRDT-map usage in erlang mapreduce via HTTP">
<input type="hidden" name="msgid" value="01A829F0-E58B-4420-BDF2-1A831B399875@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15443.html">
<input type="submit" value=" Russell Brown ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+CRDT%5C-map+usage+in+erlang+mapreduce+via+HTTP%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15439.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15441.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">01A829F0-E58B-4420-BDF2-1A831B399875@me.com</li>
</ul>
</div>
</body>
</html>
