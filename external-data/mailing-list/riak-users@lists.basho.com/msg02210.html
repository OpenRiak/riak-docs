<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Cluster Setup on EC2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02210" id="c">
<link rel="index" href="maillist.html#02210" id="i">
<link rel="prev" href="msg02209.html" id="p">
<link rel="next" href="msg02175.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02210.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Cluster+Setup+on+EC2%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Cluster Setup on EC2</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Paco+NATHAN%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Paco NATHAN</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110206" rel="nofollow">Sun, 06 Feb 2011 17:36:01 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I got my Riak cluster on EC2 set up last week, using a security group
based on what Sean described.</pre><pre>

The lingering parts for me were:

   1. had to stop Riak, then kill &quot;epmd&quot;, then start again

   2. initially I'd tried to use Elastic IP addr (to minimize config
if we move nodes) and that got stuck in my config causing nodes not
recognize each other -- until I used &quot;reip&quot; to change the ring name,
etc.

Otherwise, worked fine. FWIW, we're testing on m1.xlarge with Ubuntu


On Sun, Feb 6, 2011 at 16:20, Eamonn &lt;eobr...@gmail.com&gt; wrote:
&gt; After a lot if unsuccessful fiddling around with ports I gave up and just
&gt; opened up all ports between the Riak nodes.
&gt;
&gt; I suggest you set up a security group called &quot;Riak&quot; with settings something
&gt; like the following:
&gt;
&gt;  Protocol | From Port | To Port | Source (IP or group)
&gt;  ---------+-----------+---------+---------------------
&gt;  tcp      | 1         | 65535   | Riak group
&gt;  udp      | 1         | 65535   | Riak group
&gt;  tcp      | 8098      | 8098    | WebServer group
&gt;
&gt; Although all the ports are open on the Riak nodes, it is still pretty secure
&gt; because they are only open to nodes in the same security group, i.e. other
&gt; Riak nodes.
&gt;
&gt; The only port open outside the Riak cluster is the default HTTP port, which
&gt; is only open to nodes in the &quot;WebServer&quot; security group.  Change &quot;WebServer&quot;
&gt;  to be the security group of whatever nodes are using Riak.  If you have
&gt; changed the default or are using protocol buffers instead of HTTP you will
&gt; have to change the port number.
&gt;
&gt; You may also want to add the SSH port to so that you can login, but I
&gt; suggest using a cloud-init script to do all the Riak installation and
&gt; initialization at node creation time, so in normal production use will not
&gt; need to SSH into the nodes.
&gt;
&gt; __
&gt; Eamonn
&gt;
&gt;
&gt;
&gt; On 2/4/11 9:00 AM, riak-users-requ...@lists.basho.com wrote:
&gt;&gt;
&gt;&gt; Date: Wed, 02 Feb 2011 21:33:20 +0530 From: Abhishek Kona
&gt;&gt; &lt;abhish...@flipkart.com&gt; To: Sean Cribbs &lt;s...@basho.com&gt; Cc:
&gt;&gt; &quot;riak-users@lists.basho.com&quot; &lt;riak-users@lists.basho.com&gt; Subject: Re: Riak
&gt;&gt; Cluster Setup on EC2 Message-ID: &lt;4d498048.3060...@flipkart.com&gt;
&gt;&gt; Content-Type: text/plain; charset=ISO-8859-1; format=flowed On 02/02/11 8:38
&gt;&gt; PM, Sean Cribbs wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; &gt;  Abhishek,
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;  First, make sure all of your nodes are in the same security group.
&gt;&gt;
&gt;&gt; Yes, both the machines are on the same security group ( which has only
&gt;&gt; the ports 8098, 8099, 8087).
&gt;&gt;&gt;
&gt;&gt;&gt; &gt;      Second, check that your OS doesn't have an additional firewall
&gt;&gt;&gt; &gt; installed (iptables, for example).
&gt;&gt;
&gt;&gt; I can telnet into the Riak ports from each of the machines, so firewall
&gt;&gt; does not seem to be the issue.
&gt;&gt;&gt;
&gt;&gt;&gt; &gt;     Third, you might consider doing what the Chef recipe for Riak does
&gt;&gt;&gt; &gt; and limit the ports that Erlang uses for distributed communication.  
&gt;&gt;&gt; &gt; Adding
&gt;&gt;&gt; &gt; a section to app.config like the below will limit the port range:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;  {kernel, [
&gt;&gt;&gt; &gt;      {inet_dist_listen_min, 6000},
&gt;&gt;&gt; &gt;      {inet_dist_listen_max, 7999}
&gt;&gt;&gt; &gt;  ]}
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;  You'll need to stop Riak, kill the &quot;epmd&quot; process, and then start Riak
&gt;&gt;&gt; &gt; up again for this change to take effect.  Make sure those ports are also
&gt;&gt;&gt; &gt; open in your security group and any software firewall you have.
&gt;&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; Tried with these changes as well, but still get the same message.
&gt;&gt; Anything else, I can try?.
&gt;&gt; Thanks for the help.
&gt;&gt;&gt;
&gt;&gt;&gt; &gt;  Sean Cribbs&lt;s...@basho.com&gt;
&gt;&gt;&gt; &gt;  Developer Advocate
&gt;&gt;&gt; &gt;  Basho Technologies, Inc.
&gt;&gt;&gt; &gt;  <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt;  On Feb 2, 2011, at 8:47 AM, Abhishek Kona wrote:
&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  Hi folks
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  I am trying to set up a Riak cluster on EC2.
&gt;&gt;&gt;&gt; &gt;&gt;  Each time I issue a command :
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  $ sudo riak-admin joinriak@10.130.149.253
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  It fails :
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  Attempting to restart script through sudo -u riak
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  Noderiak@10.130.149.253  is not reachable!
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  Netstat on both the machines says the ports are running fine.
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  netstat -na | egrep '(8087|8098|8099)'
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  tcp        0      0 0.0.0.0:8098            0.0.0.0:*
&gt;&gt;&gt;&gt; &gt;&gt; LISTEN
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  tcp        0      0 0.0.0.0:8099            0.0.0.0:*
&gt;&gt;&gt;&gt; &gt;&gt; LISTEN
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  tcp        0      0 0.0.0.0:8087            0.0.0.0:*
&gt;&gt;&gt;&gt; &gt;&gt; LISTEN
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  I can telnet to all the ports from each of the machine.
&gt;&gt;&gt;&gt; &gt;&gt;  I have been pulling my hair for long but of no avail.
&gt;&gt;&gt;&gt; &gt;&gt;  Can any one look and tell me what I am doing wrong.
&gt;&gt;&gt;&gt; &gt;&gt;  Are there any debug logs where I can look at what is going wrong?
&gt;&gt;&gt;&gt; &gt;&gt;  Is there any EC2 specific trick (like using public hostnames).
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  I am attaching my app.cfg file for reference.
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  Thanks
&gt;&gt;&gt;&gt; &gt;&gt;  -Abhishek Kona
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt;&gt;  &lt;app.cfg&gt;_______________________________________________
&gt;&gt;&gt;&gt; &gt;&gt;  riak-users mailing list
&gt;&gt;&gt;&gt; &gt;&gt;  riak-users@lists.basho.com
&gt;&gt;&gt;&gt; &gt;&gt;  <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02209.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02210">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02210">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02175.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02171.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Abhishek Kona</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02172.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Dan Reverri</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02173.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Abhishek Kona</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02174.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02176.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Abhishek Kona</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02178.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">John D. Rowell</span></li>
<li class="icons-email"><span class="subject"><a href="msg02211.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Abhishek Kona</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02177.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Ryan Maclear</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02191.html">Re: Riak Cluster Setup on EC2</a></span> <span class="sender italic">Abhishek Kona</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02209.html">Riak Cluster Setup on EC2</a></span> <span class="sender italic">Eamonn</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Cluster Setup on EC2</span> <span class="sender italic">Paco NATHAN</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Cluster Setup on EC2">
<input type="hidden" name="msgid" value="AANLkTikT1ityWGJzxW+Btwz=F3j01XgRu_7ikzaer6OH@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02210.html">
<input type="submit" value=" Paco NATHAN ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Cluster+Setup+on+EC2%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02209.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02175.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTikT1ityWGJzxW+Btwz=F3j01XgRu_7ikzaer6OH@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
