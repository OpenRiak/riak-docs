<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: keys=stream</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00346" id="c">
<link rel="index" href="maillist.html#00346" id="i">
<link rel="prev" href="msg00345.html" id="p">
<link rel="next" href="msg00347.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00346.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+keys%3Dstream%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: keys=stream</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Andrew+Harvey%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Andrew Harvey</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100512" rel="nofollow">Wed, 12 May 2010 20:29:06 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I believe it's a curb bug.

curl --raw gives me expected output, but the chunks yielded by the 
@client.http.get are not the same chunks shown by curl â€“ they're fragmented as 
shown earlier in this thread., that said the chunks returned are pretty huge 
(1.2 MiB), which might explain why curb is cutting them up.</pre><pre>

Andrew


On 13/05/2010, at 1:17 PM, Sean Cribbs wrote:

If the problem is with net/http then we need to fix that backend, not apply 
hacks to the generic portions.  You can verify that Riak will return valid JSON 
objects in each chunk by adding --raw to the curl command.  Here's what I get 
after loading the Fast Track stock data: <a  rel="nofollow" href="http://gist.github.com/399450">http://gist.github.com/399450</a>

Sean Cribbs &lt;s...@basho.com&lt;<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>&gt;&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On May 12, 2010, at 10:55 PM, Adam Hunter wrote:

This is a confirmed bug and will be fixed soon.  You can check out 
<a  rel="nofollow" href="http://github.com/adamhunter/ripple/blob/associations/lib/riak/bucket.rb">http://github.com/adamhunter/ripple/blob/associations/lib/riak/bucket.rb</a> : 65 
for a temporary hack.

Thanks,

Adam

On May 12, 2010, at 10:17 PM, Andrew Harvey wrote:


I've just run into this one as well.

Not sure if it's a curb thing or what, but it's making me a sad panda. We have 
500k+ keys in our bucket, and I'm being returned chunks of invalid json so 
nothing is being yielded to my block. Needless to say, the task I'm doing here 
I'd prefer to do in a MapReduce, but unfortunately I need to get everything out 
into ruby-land for the moment.

Andrew


On 04/05/2010, at 11:46 PM, Sean Cribbs wrote:

This looks like a bug. I'll add an issue to the github tracker.

Sean Cribbs &lt;s...@basho.com&lt;<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>&gt;&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On May 4, 2010, at 9:29 AM, Adam Hunter wrote:

Just curb, I couldn't get net/http to work when doing chunked (something about 
read_body being called twice).


On May 4, 2010, at 9:28 AM, Sean Cribbs wrote:

Are you using curb or net/http?

Sean Cribbs &lt;s...@basho.com&lt;<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>&gt;&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On May 4, 2010, at 9:26 AM, Adam Hunter wrote:

The problem I was running into was some of the chunks were only part of the 
json object.  Decoded it would be something like this:

chunk 1: {'keys':[1,2,3,4
chunk 2: 5,6,7,8,9]}

I was running this on a bucket with about 11k keys.  Using ripple I could only 
get about 150 keys back this way because all the other chunks were not valid 
json.  I hacked around this for now by checking to see if the chunk ends in ]}, 
otherwise I accumulate chunks until I have a full json object.

Thanks,

Adam


On May 4, 2010, at 9:22 AM, Sean Cribbs wrote:

This behavior is unchanged since its implementation in 0.8 or 0.9.  To better 
demonstrate what that statement means, here's the joined output of a streamed 
keys response:

{&quot;props&quot;:{&quot;name&quot;:&quot;foo&quot;,&quot;n_val&quot;:3,&quot;allow_mult&quot;:false,&quot;precommit&quot;:[],&quot;postcommit&quot;:[],&quot;chash_keyfun&quot;:{&quot;mod&quot;:&quot;riak_core_util&quot;,&quot;fun&quot;:&quot;chash_std_keyfun&quot;},&quot;linkfun&quot;:{&quot;mod&quot;:&quot;riak_kv_wm_link_walker&quot;,&quot;fun&quot;:&quot;mapreduce_linkfun&quot;},&quot;old_vclock&quot;:86400,&quot;young_vclock&quot;:20,&quot;big_vclock&quot;:50,&quot;small_vclock&quot;:10}}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}{&quot;keys&quot;:[]}

If your client library supports per-chunk processing, each of those {&quot;keys&quot;:[]} 
objects will be an encoded chunk.  The Ruby client and most of the other 
clients support this.

Sean Cribbs &lt;s...@basho.com&lt;<a  rel="nofollow" href="mailto:s...@basho.com">mailto:s...@basho.com</a>&gt;&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On May 3, 2010, at 9:28 PM, Adam Hunter wrote:

Hi All,

I apologize if this has been covered already.

In the wiki it says &quot;If keys=stream, the response will be transferred using 
chunked-encoding, where each chunk is a JSON object&quot; (on 
<a  rel="nofollow" href="http://wiki.basho.com/display/RIAK/REST+API">http://wiki.basho.com/display/RIAK/REST+API</a>)

This doesn't seem to be the case, sometimes a json object is broken into 
several chunks.  Is this behavior correct?

Thanks,

Adam
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>








Click here&lt;<a  rel="nofollow" href="https://www.mailcontrol.com/sr/wQw0zmjPoHdJTZGyOCrrhg==">https://www.mailcontrol.com/sr/wQw0zmjPoHdJTZGyOCrrhg==</a>&gt; to report 
this email as spam.

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



Andrew Harvey / Developer
lexer

m/
t/      +61 2 9019 6379
w/      <a  rel="nofollow" href="http://lexer.com.au">http://lexer.com.au</a>&lt;<a  rel="nofollow" href="http://lexer.com.au/">http://lexer.com.au/</a>&gt;

Help put an end to whaling. Visit 
www.givewhalesavoice.com.au&lt;<a  rel="nofollow" href="http://www.givewhalesavoice.com.au/">http://www.givewhalesavoice.com.au/</a>&gt;

________________________________



Please consider the environment before printing this email
This email transmission is confidential and intended solely for the person or 
organisation to whom it is addressed. If you are not the intended recipient, 
you must not copy, distribute or disseminate the information, or take any 
action in relation to it and please delete this e-mail. Any views expressed in 
this message are those of the individual sender, except where the send 
specifically states them to be the views of any organisation or employer. If 
you have received this message in error, do not open any attachment but please 
notify the sender (above). This message has been checked for all known viruses 
powered by McAfee.

For further information visit <a  rel="nofollow" href="http://www.mcafee.com/us/threat_center/default.asp">http://www.mcafee.com/us/threat_center/default.asp</a>
Please rely on your own virus check as no responsibility is taken by the sender 
for any damage rising out of any virus infection this communication may contain.



This message has been scanned for malware by Websense. 
www.websense.com&lt;<a  rel="nofollow" href="http://www.websense.com/">http://www.websense.com/</a>&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



Andrew Harvey / Developer
lexer

m/
t/      +61 2 9019 6379
w/      <a  rel="nofollow" href="http://lexer.com.au">http://lexer.com.au</a>

Help put an end to whaling. Visit 
www.givewhalesavoice.com.au&lt;<a  rel="nofollow" href="http://www.givewhalesavoice.com.au/">http://www.givewhalesavoice.com.au/</a>&gt;

________________________________



Please consider the environment before printing this email
This email transmission is confidential and intended solely for the person or 
organisation to whom it is addressed. If you are not the intended recipient, 
you must not copy, distribute or disseminate the information, or take any 
action in relation to it and please delete this e-mail. Any views expressed in 
this message are those of the individual sender, except where the send 
specifically states them to be the views of any organisation or employer. If 
you have received this message in error, do not open any attachment but please 
notify the sender (above). This message has been checked for all known viruses 
powered by McAfee.

For further information visit <a  rel="nofollow" href="http://www.mcafee.com/us/threat_center/default.asp">http://www.mcafee.com/us/threat_center/default.asp</a>
Please rely on your own virus check as no responsibility is taken by the sender 
for any damage rising out of any virus infection this communication may contain.
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00345.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00346">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00346">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00347.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00231.html">keys=stream</a></span> <span class="sender italic">Adam Hunter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00236.html">Re: keys=stream</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00237.html">Re: keys=stream</a></span> <span class="sender italic">Adam Hunter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00238.html">Re: keys=stream</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00239.html">Re: keys=stream</a></span> <span class="sender italic">Adam Hunter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00241.html">Re: keys=stream</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00342.html">Re: keys=stream</a></span> <span class="sender italic">Andrew Harvey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00343.html">Re: keys=stream</a></span> <span class="sender italic">Adam Hunter</span></li>
<li class="icons-email"><span class="subject"><a href="msg00344.html">Re: keys=stream</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg00345.html">Re: keys=stream</a></span> <span class="sender italic">Adam Hunter</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: keys=stream</span> <span class="sender italic">Andrew Harvey</span></li>
<li class="icons-email"><span class="subject"><a href="msg00347.html">Re: keys=stream</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg00348.html">Re: keys=stream</a></span> <span class="sender italic">Andrew Harvey</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: keys=stream">
<input type="hidden" name="msgid" value="73A8D871-BE43-47B0-A0E0-2C884B80DF7F@lexer.com.au">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00346.html">
<input type="submit" value=" Andrew Harvey ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+keys%3Dstream%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00345.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00347.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">73A8D871-BE43-47B0-A0E0-2C884B80DF7F@lexer.com.au</li>
</ul>
</div>
</body>
</html>
