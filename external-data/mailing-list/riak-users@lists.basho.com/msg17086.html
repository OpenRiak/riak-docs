<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Ok, I am stumped. Losing data or riak stop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17086" id="c">
<link rel="index" href="maillist.html#17086" id="i">
<link rel="prev" href="msg17083.html" id="p">
<link rel="next" href="msg17088.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17086.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ok%2C+I+am+stumped.+Losing+data+or+riak+stop%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Ok, I am stumped. Losing data or riak stop</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Joe+Olson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Joe Olson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160226" rel="nofollow">Fri, 26 Feb 2016 08:24:32 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>

Negative. </pre><pre>

I have ring size set to 8, leveldb split across two sets of drives (&quot;fast&quot; and 
&quot;slow&quot;, but meaningless on the test Vagrant box...just two separate 
directories). I checked all of the ../leveldb/* directories. All LOG files are 
identical, and no errors in any of them. 

I will try to build another Vagrant machine with the default riak.conf and see 
if I can get this to repeat. It is almost as if the KV pairs are not persisting 
to disk at all. 



From: &quot;Matthew Von-Maszewski&quot; &lt;matth...@basho.com&gt; 
To: &quot;Joe Olson&quot; &lt;technol...@nododos.com&gt; 
Cc: &quot;riak-users&quot; &lt;riak-users@lists.basho.com&gt;, &quot;cmancini&quot; &lt;cmanc...@basho.com&gt; 
Sent: Friday, February 26, 2016 10:12:15 AM 
Subject: Re: Ok, I am stumped. Losing data or riak stop 

Joe, 

Are there any error messages in the leveldb LOG and/or LOG.old files? These 
files are located within each vnode's directory, likely 
/var/lib/riak/data/leveldb/*/LOG* on your machine. 

The LOG files are not to be confused with 000xxx.log files. The lower case 
*.log files are the recovery files that should contain the keys you are 
missing. If they are not loading properly, the LOG files should have clues. 

Matthew 




On Feb 26, 2016, at 11:04 AM, Christopher Mancini &lt; cmanc...@basho.com &gt; wrote: 

Hey Joe, 

I will do my best to help, but I am not the most experienced with Riak 
operations. Your best bet to get to a solution as fast as possible is to 
include the full users group, which I have added to the recipients of this 
message. 

1. Are the Riak data directories within Vagrant shared directories between the 
host and guest? I have had issues with OS file system caching before when 
working with web server files. 

2. What version of Ubuntu are you using? 

3. How did you install Riak on Ubuntu? 

4. Have you tried restoring the original distribution riak.conf file and seen 
if the issue persists? This would help you determine if the issue is your 
config or something with your environment. 

Chris 

On Fri, Feb 26, 2016 at 10:55 AM Joe Olson &lt; technol...@nododos.com &gt; wrote: 

BQ_BEGIN


Chris - 

I cannot figure out what is going on. Here is my test case. Configuration file 
attached. I am running a single node of Riak on a vagrant box with a level DB 
back end. I don't even have to bring the box down, merely stopping and 
restarting riak '(riak stop' and 'riak start' or 'risk restart) causes all the 
keys to be lost. The riak node is set up on a Vagrant box. But again....I do 
not have to bring the machine up or down to get this error. 

I've also deleted the ring info in /var/lib/riak/ring, and deleted all the 
leveldb files. In this case, the bucket type is just n_val = 1, and the ring 
size is the minimum of 8. 

Is it possible Riak is not flushing RAM to disk after write? The keys only 
reside in RAM? 

My test procedure: 

====On a remote machine===== 

riak01@ubuntu:/etc$ curl -i http:// 
&lt;ip&gt;:8098/types/n1/buckets/test/keys?keys=true 
HTTP/1.1 200 OK 
Vary: Accept-Encoding 
Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho) 
Date: Fri, 26 Feb 2016 13:14:59 GMT 
Content-Type: application/json 
Content-Length: 17 

{&quot;keys&quot;:[&quot;test&quot;]} 

riak01@ubuntu:/etc$ 



====On the single Riak node itself==== 

[vagrant@i- 2016022519 -9bb5c84f riak]$ sudo riak stop 
ok 
[vagrant@i- 2016022519 -9bb5c84f riak]$ sudo riak start 
[vagrant@i- 2016022519 -9bb5c84f riak]$ sudo riak ping 
pong 



====Back to the remote machine==== 

riak01@ubuntu:/etc$ curl -i http:// 
&lt;ip&gt;:8098/types/n1/buckets/test/keys?keys=true 
HTTP/1.1 200 OK 
Vary: Accept-Encoding 
Server: MochiWeb/1.1 WebMachine/1.10.8 (that head fake, tho) 
Date: Fri, 26 Feb 2016 13:16:34 GMT 
Content-Type: application/json 
Content-Length: 11 

{&quot;keys&quot;:[]} 

riak01@ubuntu:/etc$ 






-- 
Sincerely, 

Christopher Mancini 
----------------------------- 

employee = { 
purpose: solve problems with code, 
phone: 7164625591, 
email: cmanc...@basho.com , 
github: <a  rel="nofollow" href="http://www.github.com/christophermancini">http://www.github.com/christophermancini</a> 
} 
_______________________________________________ 
riak-users mailing list 
riak-users@lists.basho.com 
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a> 

BQ_END



</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17083.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17086">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17086">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17088.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg17082.html">Re: Ok, I am stumped. Losing data or riak stop</a></span> <span class="sender italic">Christopher Mancini</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17083.html">Re: Ok, I am stumped. Losing data or riak stop</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Ok, I am stumped. Losing data or riak s...</span> <span class="sender italic">Joe Olson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg17088.html">Re: Ok, I am stumped. Losing data or ri...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg17089.html">Re: Ok, I am stumped. Losing data or ri...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li class="icons-email"><span class="subject"><a href="msg17091.html">Re: Ok, I am stumped. Losing data or ri...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Ok, I am stumped. Losing data or riak stop">
<input type="hidden" name="msgid" value="1286146455.26852.1456503574031.JavaMail.zimbra@nododos.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17086.html">
<input type="submit" value=" Joe Olson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Ok%2C+I+am+stumped.+Losing+data+or+riak+stop%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17083.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17088.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">1286146455.26852.1456503574031.JavaMail.zimbra@nododos.com</li>
</ul>
</div>
</body>
</html>
