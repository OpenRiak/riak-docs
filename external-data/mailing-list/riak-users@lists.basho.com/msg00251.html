<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: node data migration</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00251" id="c">
<link rel="index" href="maillist.html#00251" id="i">
<link rel="prev" href="msg00254.html" id="p">
<link rel="next" href="msg00246.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00251.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+node+data+migration%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: node data migration</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Grant+Schofield%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Grant Schofield</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100504" rel="nofollow">Tue, 04 May 2010 14:06:38 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>There would be 2 ways to such an upgrade. 

You could backup the node and shut it down cleanly. Other nodes in the cluster 
will take over for the shutdown node as long as your R, N , and W values were 
able to cope with the change. If you make a copy of your data directory, 
including the ring and data store directory, you could put them back in place 
and start the node as normal after the upgrade. This is predicated on you not 
changing the node name (IP), but if you did want to change it you could use the 
reip feature.  This is probably the easiest way to do the upgrade, but if your 
cluster is small I would recommend the second method</pre><pre>

The second way would be to tell the node to leave the cluster. This will 
transfer all of the data out of the node to several different nodes which will 
take its place in the ring.  Currently this can only be done via a bin/riak 
attach command. Run the following:
    {ok, C} = riak:local_client(),
    Res = C:remove_from_cluster(node()),
    io:format(&quot;~p\n&quot;, [Res]).

Once the node leaves the cluster and hands off all of its partitions you should 
see the data directory get smaller and empty out completely once all of the 
data has handed off to other nodes.   Once you do the upgrade you can setup a 
new Riak node on the host, start it, and join the cluster just like you would 
any other new node.

Thanks,
Grant Schofield
Developer Advocate
Basho Technologies


On May 4, 2010, at 3:02 PM, Matthew Pflueger wrote:

&gt; Scenario:  I need to upgrade the OS of my nodes in my cluster which
&gt; will result in a reboot of each node.  What would be the process to
&gt; nicely migrate data away from each node?
&gt; 
&gt; If my understanding is correct, performing a nice shutdown of a riak
&gt; node via `riak stop` will migrate the data away from the node.  Am I
&gt; correct?  If so, approximately how long would it take to do the
&gt; migration if say each node represents 1 gig of data?  Does that whole
&gt; gig get migrated away or only the data that is not replicated?
&gt; 
&gt; 
&gt; --Matthew
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00254.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00251">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00251">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00246.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00245.html">Re: node data migration</a></span> <span class="sender italic">Matthew Pflueger</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00248.html">Re: node data migration</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg00250.html">Re: node data migration</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00253.html">Re: node data migration</a></span> <span class="sender italic">Matthew Pflueger</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00254.html">Re: node data migration</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: node data migration</span> <span class="sender italic">Grant Schofield</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: node data migration">
<input type="hidden" name="msgid" value="F1411814-8DA8-46A6-A139-3C2EB08A1A58@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00251.html">
<input type="submit" value=" Grant Schofield ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+node+data+migration%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00254.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00246.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">F1411814-8DA8-46A6-A139-3C2EB08A1A58@basho.com</li>
</ul>
</div>
</body>
</html>
