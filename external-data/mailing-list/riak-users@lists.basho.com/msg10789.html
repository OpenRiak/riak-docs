<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Post commit hooks are a single process, so they are executed in	the same order as the commits ?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10789" id="c">
<link rel="index" href="maillist.html#10789" id="i">
<link rel="prev" href="msg10785.html" id="p">
<link rel="next" href="msg10790.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10789.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Post+commit+hooks+are+a+single+process%2C+so+they+are+executed+in%09the+same+order+as+the+commits+%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Post commit hooks are a single process, so they are executed in	the same order as the commits ?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Simon+Majou%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Simon Majou</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130409" rel="nofollow">Tue, 09 Apr 2013 03:37:47 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Ryan,

Yes I know about Riak Enterprise, but I am thinking about a more
&quot;fine-grained&quot; multi-cluster, by setting a X-Meta-primary-cluster property
on each value.</pre><pre>

In that scenario, the object would be written always on the primary
cluster, and read on both clusters.
In case of failure all the writes would be done on the active cluster, with
the primary-cluster updated to the new primary.

&gt;From your explanation on the post commit hook I understand that I will need
a message queue between the cluster, in order to free the hook as fast as
possible, and to not lose any updates in case of crash of one cluster.


Simon


On Tue, Apr 9, 2013 at 3:55 AM, Ryan Zezeski &lt;rzeze...@basho.com&gt; wrote:

&gt; Simon,
&gt;
&gt;
&gt; On Mon, Apr 8, 2013 at 7:14 PM, Simon Majou &lt;si...@majou.org&gt; wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I want to sync a bucket of a first cluster with the bucket of a second
&gt;&gt; cluster. To do that I think using the post commit hook.
&gt;&gt;
&gt;
&gt; If you didn't know, this is exactly what Riak Enterprise was built to do.
&gt;  I.e. handle multi-cluster replication.  However, if you want to give it a
&gt; go on your own a post-commit hook is one way to get the job done.  You'll
&gt; want to think through failure scenarios where the receiving cluster is down
&gt; and how to deal with msgs that are dropped between clusters.  The
&gt; post-commit hook runs on a process called the &quot;coordinator&quot;, there is a
&gt; coordinator for every incoming request.  So you won't block the vnodes,
&gt; which is important, but the client/user request will block until your
&gt; post-commit returns.
&gt;
&gt;
&gt;&gt;
&gt;&gt; Is there any risk that the sequence of PUTs to be mixed in such a
&gt;&gt; scenario ?
&gt;&gt;
&gt;
&gt; Do you mean the sequence seen on cluster A vs. cluster B?  Are you asking
&gt; if the object could appear to be on B before A even though the PUT was sent
&gt; to A?  The answer is, it depends.  With a healthy system it's probably
&gt; unlikely but it will depend on your DW values and state of each cluster.
&gt;  E.g. if cluster A nodes get slow disk I/O then perhaps the replication to
&gt; cluster B could beat writes on A.  If we start introducing node and network
&gt; failures, or changing W/DW values then things can get more complicated.
&gt;  You could have success on cluster A, fire replica to cluster B, all
&gt; primary nodes for that object on cluster A die, now cluster B will have a
&gt; key for which cluster A says not_found (well, not totally true, depends on
&gt; your PR value).
&gt;
&gt; -Z
&gt;
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10785.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10789">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10789">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10790.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10773.html">Post commit hooks are a single process, so they are executed ...</a></span> <span class="sender italic">Simon Majou</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10785.html">Re: Post commit hooks are a single process, so they are ...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Post commit hooks are a single process, so they ...</span> <span class="sender italic">Simon Majou</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10790.html">Re: Post commit hooks are a single process, so t...</a></span> <span class="sender italic">Guido Medina</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Post commit hooks are a single process, so they are executed in	the same order as the commits ?">
<input type="hidden" name="msgid" value="CAEoZr1nCXu=OVsy-gQbucVwyNQi8f0673KMgEFBcx7KFfKu+fg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10789.html">
<input type="submit" value=" Simon Majou ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Post+commit+hooks+are+a+single+process%2C+so+they+are+executed+in%09the+same+order+as+the+commits+%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10785.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10790.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAEoZr1nCXu=OVsy-gQbucVwyNQi8f0673KMgEFBcx7KFfKu+fg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
