<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Proposal for chunked storage (related to Lowlevel Access 	to	RiakCS objects)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#13993" id="c">
<link rel="index" href="maillist.html#13993" id="i">
<link rel="prev" href="msg13987.html" id="p">
<link rel="next" href="msg13994.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13993.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Proposal+for+chunked+storage+%5C%28related+to+Lowlevel+Access+%09to%09RiakCS+objects%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Proposal for chunked storage (related to Lowlevel Access 	to	RiakCS objects)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Timo+Gatsonides%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Timo Gatsonides</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140404" rel="nofollow">Fri, 04 Apr 2014 06:01:16 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>&gt; 
&gt; Since this is related to my earlier question: sorry to have let you wait, 
&gt; Timo.
&gt; 
&gt; Kelly, the reason I brought up my original question was because my use case 
&gt; involves delivering videos under load.
&gt; Suppose there is a cluster of 50 nodes with a replication value of three. Now 
&gt; if a random node is queried for a file of say, 500MB. Then I would expect 
&gt; 30MB to be local, and 470MB (or 94%) to be retrieved from the cluster, 
&gt; assuming local data is used if available.
&gt; If this happens over and over again, you want caching. Trouble with video: 
&gt; users might skip parts, and those requests are nasty to most caches. If they 
&gt; are few, it is Ok to just not cache them, but otherwise, we might need a 
&gt; solution.
&gt; One approach is to have a proxy &quot;translate&quot; a range request into a series of 
&gt; Riak queries, each of which is small enough to be cached in &quot;no time&quot;, but 
&gt; not so small as to allow the overhead outgrowing the real data.</pre><pre>

Just a side note: writing such a proxy would be trivial in Go using the 
goriakpbc driver. I’m including a typical Go http handler below (uses a 
hardcoded “file.mp4” key, of course in reality you’d analyze the http.Request 
first - also all error checking is removed for clarity). This handler would 
support such range queries and would get only the chunks of data that are 
needed from Riak. You can choose the chunk/segment size when creating the file.

func handler(w http.ResponseWriter, r *http.Request) {
        f, err := riak.OpenFile(&quot;files&quot;, &quot;file.mp4&quot;)
        if err != nil {
                fmt.Printf(&quot;Error getting file from Riak - %v\n&quot;, err)
                return
        }
        http.ServeContent(w, r, &quot;file.mp4&quot;, time.Now(), f)
}

func main() {
        // Copy a local MP4 file into Riak
        riak.ConnectClient(&quot;127.0.0.1:8087&quot;)
        src, _ := os.Open(&quot;file.mp4&quot;)
        dst, _ := riak.CreateFile(&quot;files&quot;, &quot;file.mp4&quot;, &quot;video/mp4&quot;, 102400)
        _, _ := io.Copy(dst, src)

        http.HandleFunc(&quot;/&quot;, handler)
        http.ListenAndServe(&quot;:8888&quot;, nil)
}

&gt; 
&gt; You are right that RiakCS does a fine job in what it does, but typical caches 
&gt; can only query it sequentially, which precludes caching of range requests on 
&gt; any object of relevant size.
&gt; 
&gt; Timo, of course you are somewhat reinventing the wheel, half the work you 
&gt; have to do is similar to how RiakCS stores files. However, since the other 
&gt; half cannot &quot;just use&quot; S3, I fail to see the alternative, apart from 
&gt; cancelling the project.

I realize I am somewhat re-inventing the wheel. However I do not need an “S3 
interface”, don’t have a need for accounting / different users, we are only 
using the Riak datastore internally. I don’t know Riak CS in detail but seems 
like setting up more components then plain Riak + possible a single point of 
failure with the Stanchion instance.

&gt; That said, I am not an expert in these matters, but your basic approach to 
&gt; big files looks sound to me.
&gt; I am curious about the use case of growing files. 
&gt; My first thought was that if I wanted to store logs in a database, I would 
&gt; prefer to store e.g. single lines as values, or rows in a relational database.

I’m storing log files in Riak because I really like the operational aspects of 
Riak. Setting up (replicated) relational databases and keep them humming along 
is much more complex IMHO. I’m storing the log files on a daily (or hourly) 
basis instead of each line as a separate value to make the key easy to compute. 
Scanning a Riak database over a range of keys is typically not recommended, and 
now I simply know / can calculate my key which would be “device-yyyymmdd.log” 
or something like that.

Regards,
Timo

</pre>
<p><strong><a href="msg13993/smime.p7s" ><img src="../attachment.png" alt="Attachment:" width=27 height=28></a>
<a href="msg13993/smime.p7s" >smime.p7s</a></strong><br>
<em>Description:</em> S/MIME cryptographic signature</p>
<pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13987.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#13993">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#13993">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13994.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Re: Proposal for chunked storage (related to Lowlevel Acce...</span> <span class="sender italic">Timo Gatsonides</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13994.html">Re: Proposal for chunked storage (related to Lowlevel...</a></span> <span class="sender italic">Brian Akins</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Proposal for chunked storage (related to Lowlevel Access 	to	RiakCS objects)">
<input type="hidden" name="msgid" value="379C411A-9199-4755-AEB4-C5C24814278E@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13993.html">
<input type="submit" value=" Timo Gatsonides ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Proposal+for+chunked+storage+%5C%28related+to+Lowlevel+Access+%09to%09RiakCS+objects%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13987.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13994.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">379C411A-9199-4755-AEB4-C5C24814278E@me.com</li>
</ul>
</div>
</body>
</html>
