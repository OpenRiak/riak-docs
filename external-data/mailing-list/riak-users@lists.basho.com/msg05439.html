<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Durable writes and parallel reads</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05439" id="c">
<link rel="index" href="maillist.html#05439" id="i">
<link rel="prev" href="msg05408.html" id="p">
<link rel="next" href="msg05441.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05439.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Durable+writes+and+parallel+reads%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Durable writes and parallel reads</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Meredith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Meredith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111103" rel="nofollow">Thu, 03 Nov 2011 16:21:38 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Erik,

Apologies it's taken so long to get back to you.</pre><pre>

Durable writes:
  You're interpreting it correctly.  DW means that the storage backend has
accepted the write.  As the backends are pluggable and configurable so that
affects what durable means.  For bitcask you can control the sync strategy
and there are similar controls for innodb.  For the memory backend there is
no durable write.  With hindsight it would have been better to have used
something like accepted write (AW) and write (W) rather than W/DW, but
we're fairly stuck with it now.  Combining writes/acceptance is a very
interesting idea going forward, but doesn't fit well with the sync nature
of the backend API we have currently.

Parallel reads:
  With 1.0.0 we've introduced a thread pool to increase the concurrency
vnodes can use for listing keys.  I'd like to improve on read concurrency.
 The current architecture ensures that a key is only updated by a single
thread which makes writing backend drivers simpler.  We either need to add
support to the k/v vnode to ensure the property is true when being updated
in parallel or change the backend drivers to be tolerant of it.

The performance numbers are interesting.  How many vnodes were you
simulating?

Jon.

On Mon, Oct 31, 2011 at 10:38 AM, Erik Søe Sørensen &lt;e...@trifork.com&gt; wrote:

&gt; The following is a couple of questions (and suggestions) regarding the
&gt; technical sides of Riak performance and reliability.
&gt;
&gt; The questions have been prompted by reading Riak source code and by
&gt; discussions within our company.
&gt;
&gt; I suppose the common thread here is &quot;latency hiding&quot;...
&gt;
&gt; Durable Writes.
&gt; ---------------
&gt; The default for bitcask's 'sync_strategy' setting is not to flush to disk
&gt; explicitly at all.
&gt;
&gt; This means that a 'Durable Write' isn't actually durable; the difference
&gt; between 'W' and 'DW' replies is whether the write has made it past Riak, to
&gt; the OS - but not through the OS and down to disk.
&gt;
&gt; Is this correct?
&gt;
&gt; What I'd have expected, as a reaonably-performing alternative, is that
&gt; Riak would flush periodically - say, after at most W_flush writes or
&gt; MS_flush milliseconds, and send 'dw' replies for all of the relevant
&gt; requests (those written since last flush) at once after the flush has been
&gt; completed.
&gt; This would combine 'real' DW semantics with reasonable performance (and is
&gt; how I have handled a similar problem; my conceptions about what is right
&gt; and proper may of course be influenced by my own coding history...).
&gt;
&gt; (For kicks, MS_flush might even be dynamically determined by how long the
&gt; flush operations tend to take; the typical value of a flush duration,
&gt; multiplied by a small constant, would probably be a fitting value.)
&gt;
&gt;
&gt; Parallel Reads.
&gt; ---------------
&gt; Within a vnode, bitcask read operations happen in serial.
&gt; Is there any reason for reads not happening in parallel?
&gt;
&gt; For map/reduce operations, in particular, I imagine this might make a
&gt; difference, by giving the OS the opportunity to schedule disk accesses so
&gt; as to reduce seek time.
&gt;
&gt; (Unless of course Riak itself reorders the keys before reading, but I
&gt; don't believe this is the case - especially since the order would depend on
&gt; the backend: for bitcask, by time; for innostore, by key order, for
&gt; instance.)
&gt;
&gt; Of course, if each host has multiple vnodes, there will be some
&gt; parallellity even with serialized  reads within each bitcask.
&gt;
&gt; Regards,
&gt; Erik Søe Sørensen
&gt;
&gt;
&gt; ______________________________**_________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com">http://lists.basho.com/**mailman/listinfo/riak-users_**lists.basho.com</a>&lt;<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>&gt;
&gt;



-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05408.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05439">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05439">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05441.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05388.html">Durable writes and parallel reads</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05408.html">Re: Durable writes and parallel reads</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Durable writes and parallel reads</span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05441.html">Re: Durable writes and parallel reads</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Durable writes and parallel reads">
<input type="hidden" name="msgid" value="CAGgQeSvpQ=5_Bi7Yvk2YTrbLofMX1UpGLFris+Xkg2n5OTWoCA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05439.html">
<input type="submit" value=" Jon Meredith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Durable+writes+and+parallel+reads%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05408.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05441.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGgQeSvpQ=5_Bi7Yvk2YTrbLofMX1UpGLFris+Xkg2n5OTWoCA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
