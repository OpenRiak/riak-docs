<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: tuning riak for 100s of concurrent connections</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02477" id="c">
<link rel="index" href="maillist.html#02477" id="i">
<link rel="prev" href="msg02485.html" id="p">
<link rel="next" href="msg02483.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02477.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+tuning+riak+for+100s+of+concurrent+connections%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: tuning riak for 100s of concurrent connections</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110225" rel="nofollow">Fri, 25 Feb 2011 12:02:47 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I just did some similar testing on a single Riak node running on my mac pro 
dual-quad core w 16gb ram. I concur that smaller values are bounded by. Was 
running ab -c [1/10/100] -n[1000/10000/100000] from my imac (separate machine). 
I have found when dealing with such extremely small latencies your environment 
becomes magnified. </pre><pre>

The fact that Wilson is running into lag/timing issues on EC2 is frankly not 
surprising and notoriously difficult to debug and, imho, not even worth the 
time barring simple client, server  or network stack tweaks. Entirely not 
related to Riak or EC2 but I love pointing to this article, 
<a  rel="nofollow" href="http://ejohn.org/blog/accuracy-of-javascript-time/">http://ejohn.org/blog/accuracy-of-javascript-time/</a>. Sure, every millisecond 
counts but when they are that important you kind of have to go with physical 
hardware. Multi tenant virtual environments like EC2 should frankly be bared 
from any performance related discussions as a matter of course.

-Alexander Sicular

@siculars

On Feb 25, 2011, at 2:43 PM, Nico Meyer wrote:

&gt; Just out of curiosity I did some tests myself on one of our production
&gt; machines. We normally only use the ProtocolBuffers interface and a
&gt; thrift interface that we wrote ourselves.
&gt; 
&gt; If I fetch a small key (~250 bytes), the riak server becomes CPU bound
&gt; with about 20 concurrent requests, at which point the latency naturally
&gt; becomes larger. At this point one riak server is handling over 6000
&gt; requests/s. This is on an 8 core system (Dual Intel Xeon E5506
&gt; @2.13GHz), and all cores are at nearly 100%. No tuning was done on
&gt; either riak or the OS.
&gt; 
&gt; Also 99% of the requests still took less then 20ms, while with 10
&gt; concurrent requests its more like 2ms.
&gt; 
&gt; 
&gt; Am Freitag, den 25.02.2011, 13:54 -0500 schrieb Wilson MacGyver:
&gt;&gt; SO_REUSEADDR is also something you set at the socket API as I recall.
&gt;&gt; So I don't think it's something you can just set on the TCP/IP itself
&gt;&gt; as a global setting.
&gt;&gt; 
&gt;&gt; On Fri, Feb 25, 2011 at 1:41 PM, Les Mikesell &lt;lesmikes...@gmail.com&gt; wrote:
&gt;&gt;&gt; Those settings shouldn't make a big difference in how the number of
&gt;&gt;&gt; connections scale up, though.  There is a theoretical maximum rate limit for
&gt;&gt;&gt; creating new connections as each socket is supposed to sit in TIME_WAIT for
&gt;&gt;&gt; a packet round-trip time to ensure that nothing outstanding will collide
&gt;&gt;&gt; with that socket number when it is reused for the same IP address.  Maybe
&gt;&gt;&gt; your test is hitting that limit.  Can you set SO_REUSEADDR?
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02485.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02477">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02477">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02483.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02469.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg02470.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
<li class="icons-email"><span class="subject"><a href="msg02478.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Joseph Blomstedt</span></li>
<li class="icons-email"><span class="subject"><a href="msg02480.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Bryan O'Sullivan</span></li>
<li class="icons-email"><span class="subject"><a href="msg02481.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
<li class="icons-email"><span class="subject"><a href="msg02471.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li class="icons-email"><span class="subject"><a href="msg02472.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
<li class="icons-email"><span class="subject"><a href="msg02473.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Nico Meyer</span></li>
<li class="icons-email"><span class="subject"><a href="msg02475.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
<li class="icons-email"><span class="subject"><a href="msg02485.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Nico Meyer</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: tuning riak for 100s of concurrent connecti...</span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg02483.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li class="icons-email"><span class="subject"><a href="msg02474.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
<li class="icons-email"><span class="subject"><a href="msg02476.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg02479.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
<li class="icons-email"><span class="subject"><a href="msg02484.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg02467.html">Re: tuning riak for 100s of concurrent connecti...</a></span> <span class="sender italic">Wilson MacGyver</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02458.html">Re: tuning riak for 100s of concurrent connections</a></span> <span class="sender italic">Wilson MacGyver</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: tuning riak for 100s of concurrent connections">
<input type="hidden" name="msgid" value="FA7F609A-610E-4FBE-B03C-859C16AF0E51@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02477.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+tuning+riak+for+100s+of+concurrent+connections%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02485.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02483.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">FA7F609A-610E-4FBE-B03C-859C16AF0E51@gmail.com</li>
</ul>
</div>
</body>
</html>
