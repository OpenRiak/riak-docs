<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Deleting data from LevelDB backend</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd9.html#12379" id="c">
<link rel="index" href="mail10.html#12379" id="i">
<link rel="prev" href="msg12377.html" id="p">
<link rel="next" href="msg12409.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12379.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Deleting+data+from+LevelDB+backend%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Deleting data from LevelDB backend</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Von%5C-Maszewski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Von-Maszewski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130925" rel="nofollow">Wed, 25 Sep 2013 07:01:30 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Simon,

I want to point out again that I do not like my answer … but currently lack a 
better one.  The manual delete of .sst files should be treated as a last 
resort.  Only do it if you really, really cannot wait for normal compactions to 
purge the old data.</pre><pre>

To your question:

leveldb keeps a list of .sst table files in its MANIFEST file.  If the .sst 
table files are deleted manually, the MANIFEST is no longer accurate.  An 
inaccurate MANIFEST file leads to leveldb internal errors and sometimes 
infinite loops.

The repair process erases the current MANIFEST file and builds a new one based 
upon the files actually found on disk.

WARNING:  repair takes a really, really long time in Riak 1.2.0 … it gets 
better in 1.2.1 … and improves to something quite reasonable by 1.3 and 1.4.

A discussion about repair can be found here:

<a  rel="nofollow" href="https://github.com/basho/leveldb/wiki/repair-notes">https://github.com/basho/leveldb/wiki/repair-notes</a>

Matthew


On Sep 25, 2013, at 9:38 AM, Simon Effenberg &lt;seffenb...@team.mobile.de&gt; wrote:

&gt; On Wed, 25 Sep 2013 09:15:33 -0400
&gt; Matthew Von-Maszewski &lt;matth...@basho.com&gt; wrote:
&gt; 
&gt;&gt; - run Riak repair on the vnode so that leveldb can create a MANIFEST that 
&gt;&gt; matches the files remaining.
&gt; 
&gt; what do you mean with this? Wait for AAE? Request each key to trigger
&gt; read repair or do I miss something?
&gt; 
&gt; We are in a similar situation.. only sst_4 exists in our situation but
&gt; we also delete old stuff regularly..
&gt; 
&gt; Cheers
&gt; Simon 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12377.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd9.html#12379">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail10.html#12379">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12409.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12374.html">Deleting data from LevelDB backend</a></span> <span class="sender italic">Timo Gatsonides</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12376.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12377.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Deleting data from LevelDB backend</span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12409.html">Re: Deleting data from LevelDB back...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12410.html">Re: Deleting data from LevelDB...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12415.html">Re: Deleting data from Lev...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12418.html">Re: Deleting data from...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email"><span class="subject"><a href="msg12419.html">Re: Deleting data from...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12390.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Timo Gatsonides</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12391.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12393.html">Re: Deleting data from LevelDB back...</a></span> <span class="sender italic">Timo Gatsonides</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12443.html">Re: Deleting data from LevelDB backend</a></span> <span class="sender italic">Alex Rice</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Deleting data from LevelDB backend">
<input type="hidden" name="msgid" value="089E5C25-EE05-4A6E-A9C3-FE9E1EB2B882@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12379.html">
<input type="submit" value=" Matthew Von-Maszewski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Deleting+data+from+LevelDB+backend%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12377.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12409.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">089E5C25-EE05-4A6E-A9C3-FE9E1EB2B882@basho.com</li>
</ul>
</div>
</body>
</html>
