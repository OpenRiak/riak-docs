<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Facing java.net broken pipe issue while benchmarking java-PBClient	with YCSB</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04184" id="c">
<link rel="index" href="maillist.html#04184" id="i">
<link rel="prev" href="msg04182.html" id="p">
<link rel="next" href="msg04343.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04184.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Facing+java.net+broken+pipe+issue+while+benchmarking+java%5C-PBClient%09with+YCSB%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Facing java.net broken pipe issue while benchmarking java-PBClient	with YCSB</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Russell+Brown%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Russell Brown</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110802" rel="nofollow">Tue, 02 Aug 2011 13:42:21 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,
A couple of preliminary questions: What version of riak-java-client and what 
version of Riak are you using?</pre><pre>

Also, your cut and paste has come out a little garbled, could you maybe paste 
it into a github gist or a paste bin so I can get a better read of the code, 
please?

Also, do you have the riak log? Is there anything in that for the same call?

Do you get the error consistently or is this as part of a load test/benchmark 
and it occurs under a certain load?

I've never used YCSB so I'll have a look into that, also.

Cheers

Russell

On 2 Aug 2011, at 20:20, vijayakumar wrote:

&gt; I am trying to benchmark riak client with YCSB and I am getting the following
&gt; exception while
&gt; trying to fetch from riak client. Am I missing any tunable parameters in
&gt; server or client settings?
&gt; 
&gt; Code snippet (method implementation for YCSB-DB):
&gt; 
&gt; public int read(String table, String key, Set&lt;String&gt; fields,
&gt; HashMap&amp;lt;String, String&amp;gt; result) {
&gt;       ObjectInputStream ois = null;
&gt;       int status = Error;
&gt;       try {
&gt;               RiakObject[] riakObjects = *riakclient.fetch(table, key,1)*;
&gt;            ois = new ObjectInputStream(new
&gt; ByteArrayInputStream(riakObjects[0].getValue().toByteArray()));
&gt;            HashMap&amp;lt;String, String&amp;gt; values = (HashMap&amp;lt;String,
&gt; String&amp;gt;) ois.readObject();
&gt;            result.putAll(values);
&gt;            status = Ok;
&gt;        } catch (IOException e) {
&gt;               e.printStackTrace(System.out);  
&gt;            return status;
&gt;        } catch (ClassNotFoundException e) {
&gt;               e.printStackTrace(System.out);
&gt;            return status;
&gt;        } finally{
&gt;               if(ois!=null){
&gt;                       try{
&gt;                               ois.close();
&gt;                       }catch(Exception excep){
&gt;                               excep.printStackTrace();
&gt;                       }
&gt;               }
&gt;        }
&gt;        return status;
&gt;    }
&gt; 
&gt; Exception thrown while running YCSB setup:
&gt; 
&gt; java.net.SocketException: Broken pipe
&gt; at java.net.SocketOutputStream.socketWrite0(Native Method)
&gt; at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
&gt; at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
&gt; at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
&gt; at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
&gt; at java.io.DataOutputStream.flush(DataOutputStream.java:106)
&gt; at com.basho.riak.pbc.RiakConnection.send(RiakConnection.java:68)
&gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:221)
&gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:210)
&gt; at com.yahoo.ycsb.db.riak.RiakPBClient.read(RiakPBClient.java:63)
&gt; at com.yahoo.ycsb.DBWrapper.read(DBWrapper.java:87)
&gt; at
&gt; com.apigee.kms.RequestTokenWorkLoad.doTransactionRead(RequestTokenWorkLoad.java:81)
&gt; at
&gt; com.yahoo.ycsb.workloads.CoreWorkload.doTransaction(CoreWorkload.java:372)
&gt; at com.yahoo.ycsb.ClientThread.run(Client.java:235)
&gt; java.io.EOFException
&gt; at java.io.DataInputStream.readFully(DataInputStream.java:180)
&gt; at java.io.DataInputStream.readFully(DataInputStream.java:152)
&gt; at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:89)
&gt; at com.basho.riak.pbc.RiakClient.process_fetch_reply(RiakClient.java:251)
&gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:222)
&gt; at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:210)
&gt; at com.yahoo.ycsb.db.riak.RiakPBClient.read(RiakPBClient.java:63)
&gt; at com.yahoo.ycsb.DBWrapper.read(DBWrapper.java:87)
&gt; at
&gt; com.apigee.kms.RequestTokenWorkLoad.doTransactionRead(RequestTokenWorkLoad.java:81)
&gt; at
&gt; com.yahoo.ycsb.workloads.CoreWorkload.doTransaction(CoreWorkload.java:372)
&gt; at com.yahoo.ycsb.ClientThread.run(Client.java:235)
&gt; 
&gt; --
&gt; View this message in context: 
&gt; <a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Facing-java-net-broken-pipe-issue-while-benchmarking-java-PBClient-with-YCSB-tp3219935p3219935.html">http://riak-users.197444.n3.nabble.com/Facing-java-net-broken-pipe-issue-while-benchmarking-java-PBClient-with-YCSB-tp3219935p3219935.html</a>
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04182.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04184">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04184">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04343.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg04182.html">Facing java.net broken pipe issue while benchmarking java-PB...</a></span> <span class="sender italic">vijayakumar</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Facing java.net broken pipe issue while benchmarkin...</span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04343.html">Re: Facing java.net broken pipe issue while benchma...</a></span> <span class="sender italic">vijayakumar</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Facing java.net broken pipe issue while benchmarking java-PBClient	with YCSB">
<input type="hidden" name="msgid" value="FD693295-B479-4EDD-B0A4-8A19681FC714@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04184.html">
<input type="submit" value=" Russell Brown ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Facing+java.net+broken+pipe+issue+while+benchmarking+java%5C-PBClient%09with+YCSB%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04182.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04343.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">FD693295-B479-4EDD-B0A4-8A19681FC714@me.com</li>
</ul>
</div>
</body>
</html>
