<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: FetchObject timeout method doesn't work</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd6.html#13037" id="c">
<link rel="index" href="mail6.html#13037" id="i">
<link rel="prev" href="msg13029.html" id="p">
<link rel="next" href="msg13045.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13037.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+FetchObject+timeout+method+doesn%27t+work%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: FetchObject timeout method doesn't work</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brian+Roach%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brian Roach</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131120" rel="nofollow">Wed, 20 Nov 2013 10:21:11 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Harish,

ConnectionTimeout and RequestTimeout are actual socket operations on
the client side. Specifically, the first is passed to the actual
connect() call and the second sets the SO_TIMEOUT (SO_RCVTIMEO) socket
option so that the (blocking) read will time out.</pre><pre>

The latter was included because in the past (pre 1.4) Riak did not
have operation timeouts; the only way to abort an operation was to
time out the socket read on the client side and dump the connection
(ugly, and expensive).

I double-checked the client code in the debugger and the client is
indeed passing the timeout all the way down to the protocol buffer and
it's being sent over the wire.

What is happening is that your fetch request is being serviced in Riak
within 1ms. As a point of reference, in order to trigger a Riak-side
timeout when fetching on my machine with that 1ms timeout I had to
store a 5MB object.

Thanks,
- Roach

On Wed, Nov 20, 2013 at 4:20 AM, Harish Sharma &lt;har...@ecaretechlabs.com&gt; wrote:
&gt; FetchObject has a timeout method -
&gt;
&gt; /**
&gt;
&gt;      * Set an operation timeout in milliseconds to be sent to Riak
&gt;
&gt;      *
&gt;
&gt;      * As of 1.4 Riak allows a timeout to be sent for get, put, and delete
&gt; operations.
&gt;
&gt;      * The client will receive a timeout error if the operation is not
&gt; completed
&gt;
&gt;      * within the specified time
&gt;
&gt;      * @param timeout the timeout in milliseconds
&gt;
&gt;      * @return this
&gt;
&gt;      */
&gt;
&gt;
&gt;
&gt;     public FetchObject&lt;T&gt; timeout(int timeout) {
&gt;
&gt;         builder.timeout(timeout);
&gt;
&gt;         return this;
&gt;
&gt;     }
&gt;
&gt;
&gt;
&gt; But it doesn’t work, I am using as following
&gt;
&gt;
&gt;
&gt; FetchObject&lt;IRiakObject&gt; fo= xBucket.fetch(&quot;0.10717155098162867&quot;);
&gt;
&gt;
&gt;
&gt; IRiakObject iRiakObject =fo.timeout(1).execute();
&gt;
&gt;
&gt;
&gt; Other timeouts like ConnectionTimeout and RequestTimeout work perfect but
&gt; timeout on fetch object with execute has no effect in my case it takes 31
&gt; miliseconds to fetch and I have a timeout of 1 ms but I see no error., What
&gt; I am missing here?
&gt;
&gt;
&gt;
&gt; FYI, I am making client as per following –
&gt;
&gt;
&gt;
&gt;        private static IRiakClient setupRiakClusterClient() {
&gt;
&gt;               IRiakClient client = null;
&gt;
&gt;               try {
&gt;
&gt;                      String riakClusteHost2 = &quot;10.200.2.58&quot;;
&gt;
&gt;
&gt;
&gt;                      int riakClusterPort = 8087;
&gt;
&gt;
&gt;
&gt;                      int riakIntialPoolSize = 10;
&gt;
&gt;                      int riakMaxPoolSize = 200;
&gt;
&gt;                      int riakConnectionTimeoutMillis = 10;
&gt;
&gt;                      int riakRequestTimeoutMillis = 2;
&gt;
&gt;
&gt;
&gt;                      PBClusterConfig clusterConfig = new
&gt; PBClusterConfig(riakMaxPoolSize);
&gt;
&gt;                      PBClientConfig pbconfig = new
&gt; PBClientConfig.Builder().withPort(riakClusterPort).withInitialPoolSize(riakIntialPoolSize).withPoolSize(riakMaxPoolSize).withConnectionTimeoutMillis(riakConnectionTimeoutMillis).withRequestTimeoutMillis(riakRequestTimeoutMillis).withIdleConnectionTTLMillis(1).build();
&gt;
&gt;
&gt;
&gt;                      clusterConfig.addHosts(pbconfig, riakClusteHost2);
&gt;
&gt;                      client = RiakFactory.newClient(clusterConfig);
&gt;
&gt;
&gt;
&gt;               } catch (RiakException e) {
&gt;
&gt;                      e.printStackTrace();
&gt;
&gt;                      System.exit(1);
&gt;
&gt;               }
&gt;
&gt;               return client;
&gt;
&gt;        }
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13029.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd6.html#13037">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail6.html#13037">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13045.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13029.html">FetchObject timeout method doesn't work</a></span> <span class="sender italic">Harish Sharma</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: FetchObject timeout method doesn't work</span> <span class="sender italic">Brian Roach</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: FetchObject timeout method doesn't work">
<input type="hidden" name="msgid" value="CAM+FMBvUtFW_8RaRGrrV=RCuMH7Y7pZoVNgnORrf8C=rz0SPgA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13037.html">
<input type="submit" value=" Brian Roach ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+FetchObject+timeout+method+doesn%27t+work%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13029.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13045.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAM+FMBvUtFW_8RaRGrrV=RCuMH7Y7pZoVNgnORrf8C=rz0SPgA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
