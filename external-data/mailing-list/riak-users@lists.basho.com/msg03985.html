<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Two questions about pre/post update hooks</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03985" id="c">
<link rel="index" href="maillist.html#03985" id="i">
<link rel="prev" href="msg03963.html" id="p">
<link rel="next" href="msg03964.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03985.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Two+questions+about+pre%5C%2Fpost+update+hooks%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Two questions about pre/post update hooks</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110711" rel="nofollow">Mon, 11 Jul 2011 18:31:23 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Jeffery,

I'm going to assume by &quot;update&quot; you mean a read, modify, put cycle.  I'm
afraid what you're talking about doing is not directly supported by Riak.
 If you have multiple clients writing this object concurrently then there is
no way for Riak to guarantee that a conflict hasn't occurred.  That is,
there is no notion of locking the object and therefore two writes could
interleave each other and cause sibling values.  This is by design, and is
appropriately handled by setting allow_mult to true and performing conflict
resolution on your values.  If you wanted to serialize writes in this way
then you will have to do it your application.</pre><pre>

Performing the validation in a pre-commit hook should be fine.  It's just
that Riak won't give you any form of isolation/locking among writes.  If
you're able to, perhaps you could share what you're trying to achieve?
 Maybe there is another way around the problem without requiring sequential
writes?

-Ryan

On Fri, Jul 8, 2011 at 1:18 PM, Jeffrey Kesselman &lt;jef...@nphos.com&gt; wrote:

&gt; (1) AIUI a given key/value data pair is &quot;owned&quot; by a given node at one time
&gt; and operations on it happen on that node and are then replicated out.  Is
&gt; this correct?
&gt;
&gt; (2) Is the key/value pair &quot;locked&quot; between pre update and post update?
&gt;
&gt; The motivation for this question is this.
&gt;
&gt; I need to do the following operations on update:
&gt;
&gt; (1) In the pre-update hook, get the existing value (lets call it A)
&gt; (2) Compare some data in the update (lets call it A') with A
&gt; (3) Validate or reject the update based on that comparison
&gt; (4) If validated, write A' out as the new value of A, if not, return a
&gt; validation error.
&gt;
&gt; I need 1-4 to happen in a consistent fashion,  If someone else can come  in
&gt; and update A after (1) but before (4), the scheme wont work.
&gt;
&gt; I *could* do my own locking in (1) and then add an unlock step in (5)
&gt; assuming that all updates will take place on the same node, but I
&gt; dislike injecting locking into a system that has unknown other expectations
&gt; of the operation.
&gt; --
&gt; It's always darkest just before you are eaten by a grue.
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03963.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03985">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03985">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03964.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03963.html">Two questions about pre/post update hooks</a></span> <span class="sender italic">Jeffrey Kesselman</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Two questions about pre/post update hooks</span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Two questions about pre/post update hooks">
<input type="hidden" name="msgid" value="CACZcpem1cPCkZ31EsCbxTOzX6rfSn53Rbo9mpRe6NiYSKb8jLQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03985.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Two+questions+about+pre%5C%2Fpost+update+hooks%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03963.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03964.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpem1cPCkZ31EsCbxTOzX6rfSn53Rbo9mpRe6NiYSKb8jLQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
