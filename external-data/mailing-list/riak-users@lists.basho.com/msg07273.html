<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Adoption - What can we do better?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07273" id="c">
<link rel="index" href="maillist.html#07273" id="i">
<link rel="prev" href="msg07270.html" id="p">
<link rel="next" href="msg07277.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07273.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Adoption+%5C-+What+can+we+do+better%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Adoption - What can we do better?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Zheng+Zhibin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Zheng Zhibin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120420" rel="nofollow">Fri, 20 Apr 2012 22:56:51 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Witeman

在 2012-4-21，上午6:00，Kyle Kingsbury &lt;ap...@aphyr.com&gt; 写道：</pre><pre>

&gt; On 04/20/2012 02:47 PM, Paul Gross wrote:
&gt;&gt; Conceptually, a bucket is a list of documents. So you could handle lists
&gt;&gt; and sets in a similar fashion during a network partition. Each side
&gt;&gt; would see its own list, be able to add and remove. When the network was
&gt;&gt; restored, it could merge the lists (with deletes). There are definitely
&gt;&gt; intricacies to work through, but I think it's possible.
&gt; 
&gt; Any deletes issued during this time would be lost.
&gt; 
&gt; Case 1: Duplicate delivery/deletion on both sides of the partition.
&gt; Case 2: Deletion on one side only, restored by read repair after partition 
&gt; resolved, delivered *again*.
&gt; 
&gt; It gets weirder when you start considering deleted versioned tombstones.
&gt; 
&gt; This is the classic shared-nothing queue conundrum: you can guarantee 
&gt; at-most-once delivery, or at-least-once-delivery, but not both.
&gt; 
&gt; OK, you say: so we apply CRDTs, and use an observed-removed set across a 
&gt; bucket. That's doable, right? Both sides flag a given value as removed, and 
&gt; reconcile cleanly. Well yes, but now you require unbounded space, and 
&gt; surprise, we have a very disappointing proof that garbage-collecting this 
&gt; class of CRDT requires total coordination among participants. Well shit.
&gt; 
&gt; OK, so how about Statebox? We use timestamps to ameliorate the GC problem so 
&gt; long as a given time window. Our hosts are running NTP so it's all cool, ya? 
&gt; Wrong. One of your hosts is not running NTP. Clock desync issues are fucking 
&gt; *ubiquitous*, sadly, and you have to be willing to accept, say, losing all 
&gt; conflicting writes from a client under some clock skew circumstances. Since 
&gt; you're talking about a queue, conflicts are *almost always guaranteed*.
how about use one box for one or some buckets？then in these buckets timestamp 
are meaningful. If we want another backup box for this then just NTP within 
them. Once the main box down, the backup up, since they are always NTP, so the 
time discrepancy between them should be compensated by the period time between 
down and up.
&gt; 
&gt; Seriously, if you or anyone has a good distributed HA queue, please let me 
&gt; know. Better yet, write a paper, found a startup, and become insanely fucking 
&gt; rich. Everyone needs this, but it's a very hard problem. I mean, +1 for Basho 
&gt; solving it and all, but it's not exactly trivial.
&gt; 
&gt;&gt;&gt;&gt; MongoDB also has capped collections which keep a fixed number of
&gt;&gt;&gt;&gt; documents.
&gt;&gt;&gt; 
&gt;&gt;&gt; Strictly speaking, they don't.
&gt;&gt;&gt; 
&gt;&gt; Can you please elaborate?
&gt; 
&gt; Capped collections will delete records when they are out of space. Don't get 
&gt; me started on Mongo's behavior around replicas during partitions.
&gt; 
&gt; --Kyle
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07270.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07273">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07273">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07277.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07253.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Christiano Anderson</span></li>
<li class="icons-email"><span class="subject"><a href="msg07254.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Daniil Churikov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07255.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Jeremy Raymond</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07256.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Matthew Tovbin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07257.html">Re: Riak Adoption - What can we do better...</a></span> <span class="sender italic">Ephraim Mower</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07264.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Paul Gross</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07265.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Zabrane Mickael</span></li>
<li class="icons-email"><span class="subject"><a href="msg07266.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Kyle Kingsbury</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07269.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Paul Gross</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07270.html">Re: Riak Adoption - What can we do better...</a></span> <span class="sender italic">Kyle Kingsbury</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Adoption - What can we do be...</span> <span class="sender italic">Zheng Zhibin</span></li>
<li class="icons-email"><span class="subject"><a href="msg07277.html">Re: Riak Adoption - What can we do be...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07278.html">Re: Riak Adoption - What can we ...</a></span> <span class="sender italic">Aphyr</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07280.html">Re: Riak Adoption - What can...</a></span> <span class="sender italic">Les Mikesell</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg07276.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Anthony Molinaro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07282.html">Re: Riak Adoption - What can we do better?</a></span> <span class="sender italic">Paul Gross</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07283.html">Re: Riak Adoption - What can we do better...</a></span> <span class="sender italic">Gideon de Kok</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07285.html">Re: Riak Adoption - What can we do be...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07286.html">Re: Riak Adoption - What can we ...</a></span> <span class="sender italic">Gideon de Kok</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07287.html">Re: Riak Adoption - What can...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li class="icons-email"><span class="subject"><a href="msg07289.html">Re: Riak Adoption - What can...</a></span> <span class="sender italic">Mark Phillips</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Adoption - What can we do better?">
<input type="hidden" name="msgid" value="A2E14C23-B6AC-4596-B9FB-B03B3C6A0969@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07273.html">
<input type="submit" value=" Zheng Zhibin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Adoption+%5C-+What+can+we+do+better%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07270.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07277.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">A2E14C23-B6AC-4596-B9FB-B03B3C6A0969@gmail.com</li>
</ul>
</div>
</body>
</html>
