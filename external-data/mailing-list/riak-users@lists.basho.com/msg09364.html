<!DOCTYPE html>
<html lang="en">
<head>
<title>AW: Pipe worker startup failed:fitting was gone before startup</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd7.html#09364" id="c">
<link rel="index" href="mail7.html#09364" id="i">
<link rel="prev" href="msg09347.html" id="p">
<link rel="next" href="msg09365.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09364.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22AW%5C%3A+Pipe+worker+startup+failed%5C%3Afitting+was+gone+before+startup%22&amp;o=newest" rel="nofollow"><span itemprop="name">AW: Pipe worker startup failed:fitting was gone before startup</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Cornelius+Schmale%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Cornelius Schmale</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121121" rel="nofollow">Wed, 21 Nov 2012 11:11:06 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Bryan, 

thanks for your excellent answer, it helped a lot for a deeper knowledge of 
riak. </pre><pre>

You are right, I am using the default-one-node development cluster. After 
decreasing the ring size to 8 as mentioned by you, everything works fine.

I will post your answer unter my question at Stackoverflow, if it is ok for you?

Thanks a lot,
Cornelius

--
Cornelius Schmale
FH Wedel Gemeinnützige Schulgesellschaft mbH Feldstraße 143, 22880 Wedel
Tel.: +49 4103 8048-736
E-Mail: s...@fh-wedel.de
Web: <a  rel="nofollow" href="http://www.fh-wedel.de/">http://www.fh-wedel.de/</a>

Sitz der Gesellschaft: Wedel
Registergericht: Amtsgericht Pinneberg HRB 1578
Geschäftsführung: Prof. Dr. Eike Harms


-----Ursprüngliche Nachricht-----
Von: Bryan Fink [<a  rel="nofollow" href="mailto:br...@basho.com">mailto:br...@basho.com</a>] 
Gesendet: Montag, 19. November 2012 16:07
An: Cornelius Schmale
Cc: riak-users@lists.basho.com
Betreff: Re: Pipe worker startup failed:fitting was gone before startup

On Mon, Nov 12, 2012 at 12:04 PM, Cornelius Schmale &lt;s...@fh-wedel.de&gt; wrote:
&gt; I have some problems using riak and mapreduce queries. I’ve described 
&gt; the hole problem at
&gt;
&gt; <a  rel="nofollow" href="http://stackoverflow.com/questions/13345448/riak-fails-at-mapreduce-qu">http://stackoverflow.com/questions/13345448/riak-fails-at-mapreduce-qu</a>
&gt; eries-which-configuration-to-use

Hi, Cornelius. Could you describe a bit, your Riak configuration?
Specifically, how many nodes are in your cluster, and what is the 
ring_creation_size from you app.config?

If, for example, you're using a default setup {ring_creation_size, 64} on a 
one-node development cluster, this behavior is quite likely.
155,000 items is enough to get all 64 vnodes working.

In the first case, before raising map_js_vm_count, those 64 vnodes are fighting 
over just 8 Javascript VMs, and so some are likely to be starved long enough to 
time out, which will cause the &quot;All VMs are busy&quot; log message.

In the second case, after raising map_js_vm_count, it's likely that those 36 
Javascript VMs just aren't able to process all 155,000 items before the query 
timeout arrives. The &quot;fitting was gone before startup&quot; log message is saying 
that pipe running the query shut down while there were still inputs arriving at 
vnodes.

You're not seeing either of these behaviors in the simple case with no map 
function because no interaction with Javascript VMs is required.
In addition, for that case, objects are not even read off of disk, further 
alleviating resource contention.

The two configuration solutions I expect will help the most are lowering 
ring_creation_size, and raising the query timeout. Lowering ring_creation_size 
to 16, or even 8 on a single-node cluster will cause less contention for 
Javascript VMs because there will be less attempted parallelism in the map 
function processing. Raising the query timeout (should be an argument to the 
'run' function, or similar, but I'm not familiar with the riak-js client), will 
give the query more time to finish before shutting down, which may be necessary 
to overcome slow processing.

Rewriting your map function in Erlang should also help, since it will be 
faster, and will not have the same sort of VM contention. But, I understand, 
that's not as easy to using in early-stage development.

HTH,
Bryan



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09347.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd7.html#09364">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail7.html#09364">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09365.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09287.html">Pipe worker startup failed:fitting was gone before start...</a></span> <span class="sender italic">Cornelius Schmale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09347.html">Re: Pipe worker startup failed:fitting was gone bef...</a></span> <span class="sender italic">Bryan Fink</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">AW: Pipe worker startup failed:fitting was gone...</span> <span class="sender italic">Cornelius Schmale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09365.html">Re: AW: Pipe worker startup failed:fitting ...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg09366.html">Re: AW: Pipe worker startup failed:fitting ...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg09367.html">Re: Pipe worker startup failed:fitting was ...</a></span> <span class="sender italic">Bryan Fink</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10630.html">Pipe worker startup failed:fitting was gone before ...</a></span> <span class="sender italic">郎咸武</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="AW: Pipe worker startup failed:fitting was gone before startup">
<input type="hidden" name="msgid" value="001701cdc81b$f01088a0$d03199e0$@de">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09364.html">
<input type="submit" value=" Cornelius Schmale ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22AW%5C%3A+Pipe+worker+startup+failed%5C%3Afitting+was+gone+before+startup%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09347.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09365.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">001701cdc81b$f01088a0$d03199e0$@de</li>
</ul>
</div>
</body>
</html>
