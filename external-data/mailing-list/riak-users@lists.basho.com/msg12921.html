<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Corrupted data using Riak Python Client on Win7 64 bit</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd7.html#12921" id="c">
<link rel="index" href="mail7.html#12921" id="i">
<link rel="prev" href="msg12910.html" id="p">
<link rel="next" href="msg12922.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12921.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Corrupted+data+using+Riak+Python+Client+on+Win7+64+bit%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Corrupted data using Riak Python Client on Win7 64 bit</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22finkle+mcgraw%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">finkle mcgraw</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131109" rel="nofollow">Sat, 09 Nov 2013 01:54:47 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi John and Engel,

Here's a link to a Dropbox folder with a set of file pairs (the source file
and the corrupted version that has taken a round trip via riak):
<a  rel="nofollow" href="https://www.dropbox.com/sh/snfbiqm0jys9u2a/AZPF7_RcBT">https://www.dropbox.com/sh/snfbiqm0jys9u2a/AZPF7_RcBT</a></pre><pre>

John, to answer your questions:

*Windows--&gt;Riak--&gt;Ubuntu VM*
When uploading files from windows to riak, then downloading them to the
Ubuntu VM, inconsistencies appear also, but always for the same subset of
files (if I repeatedly download the same set of files from riak and verify
against the source files). This to me indicates that these files were
corrupted on the upload from windows to riak.

*Ubuntu VM--&gt;Riak--&gt;Windows*
When uploading the source files from Ubuntu VM (and after having verified
that they can be downloaded into the Ubuntu VM again without any problems)
and then downloading them to windows, inconsistencies appear. However,
these inconsistencies are varying from file to file from each download
round. I.e., by downloading a file a few times I eventually get a
non-corrupted version. This to me indicates that the files were correctly
uploaded to riak from the Ubuntu VM, but are corrupted somewhere in the
download flow on the windows machine.

Ergo: Data appears to be corrupted both when going upstream and when going
downstream somewhere inside the stack used by the riak python client on
windows 7 64 bit.

One more observation: I've done some byte for byte comparisons when
uploading/downloading, and the error rate appears to be on the order of 0.4
ppm.

Finkle







2013/11/9 John Daily &lt;jda...@basho.com&gt;

&gt; (And the inverse would also be interesting to know.)
&gt;
&gt; -John
&gt;
&gt; On Nov 8, 2013, at 6:41 PM, John Daily &lt;jda...@basho.com&gt; wrote:
&gt;
&gt; If you upload the files from Windows, and download them to the Ubuntu VM,
&gt; do inconsistencies ever appear?
&gt;
&gt; -John
&gt;
&gt; On Nov 8, 2013, at 4:58 PM, Engel Sanchez &lt;en...@basho.com&gt; wrote:
&gt;
&gt; Hello there,
&gt;
&gt; This looks puzzling. Just from looking at the code we haven't found
&gt; anything suspicious. Would you mind posting a pair of those files that
&gt; failed to match somewhere so we can look at the differences?
&gt;
&gt; Thanks for reporting this.
&gt;
&gt; Engel@Basho
&gt;
&gt;
&gt; On Fri, Nov 8, 2013 at 2:41 PM, finkle mcgraw &lt;finklemcg...@gmail.com&gt;wrote:
&gt;
&gt;&gt; Fellow Riak users,
&gt;&gt;
&gt;&gt; I've noticed that when I upload binary files with sizes of &gt;~1 MB to Riak
&gt;&gt; from my Windows 7 (64 bit) machine, then read the same data back again,
&gt;&gt; often it has a few corrupted bytes, while maintining the correct total data
&gt;&gt; length.
&gt;&gt;
&gt;&gt; Here's the Python script I use to provoke and detect the situation:
&gt;&gt; <a  rel="nofollow" href="https://gist.github.com/anonymous/7376084">https://gist.github.com/anonymous/7376084</a>
&gt;&gt;
&gt;&gt; Notice that I included the typical output when running the script at the
&gt;&gt; bottom of the gist. As you can see, for that particular run, half of the
&gt;&gt; dummy-data files were corrupted. The returned data from Riak has the exact
&gt;&gt; same length as the source, but not the exact same content. I've only done
&gt;&gt; brief analysis of how the corruptions appear within the files that are
&gt;&gt; detected as corrupted, but it looks like it's typically between 1 to 5
&gt;&gt; bytes that are altered, evenly distributed within the file.
&gt;&gt;
&gt;&gt; I get no exceptions or warnings from the Riak Python client. Everything
&gt;&gt; appears to be in order.
&gt;&gt;
&gt;&gt; So far I've tested this on two different windows machines against two
&gt;&gt; different Riak clusters (a five node Amazon cluster with a loadbalancer in
&gt;&gt; front, and a local devcluster running inside an Ubuntu 12.04 Virtual
&gt;&gt; Machine). The problems appear in all four possible combinations.
&gt;&gt;
&gt;&gt; However, if I run the script from within an Ubuntu VM, on one of the said
&gt;&gt; Windows machines, against any of the two Riak clusteres, the problems do
&gt;&gt; NOT appear.
&gt;&gt;
&gt;&gt; Another observation: If I generate 50 sample files, upload them, then
&gt;&gt; repeatedly try to download them over and over again, the script will detect
&gt;&gt; corruptions in different files on each repetition of downloading. E.g., on
&gt;&gt; round one it might say that file 1,5, and 19 were corrupted, but on round
&gt;&gt; two it might say 3, 8 and 19.
&gt;&gt;
&gt;&gt; Here is the riak stats-view from the Amazon cluster we're running (that I
&gt;&gt; tested the script agains):
&gt;&gt; <a  rel="nofollow" href="https://gist.github.com/anonymous/7376379">https://gist.github.com/anonymous/7376379</a>
&gt;&gt;
&gt;&gt; But as I said, the corruptions appear also when working locally between a
&gt;&gt; Win7 machine and a cluster running on a virtual Ubuntu 12.04 machine.
&gt;&gt;
&gt;&gt; Here are my local package versions, running on Python 2.7.5 64 bit on
&gt;&gt; Windows 7 64 bit:
&gt;&gt; protobuf==2.4.1
&gt;&gt; riak==2.0.1
&gt;&gt; riak-pb==1.4.1.1
&gt;&gt;
&gt;&gt; Any ideas? This seems relatively serious, unless it's some kind of brutal
&gt;&gt; oversight on my part.
&gt;&gt;
&gt;&gt; Finkle
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12910.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd7.html#12921">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail7.html#12921">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12922.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12900.html">Corrupted data using Riak Python Client on Win7 64 bit</a></span> <span class="sender italic">finkle mcgraw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12906.html">Re: Corrupted data using Riak Python Client on Wi...</a></span> <span class="sender italic">Engel Sanchez</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12909.html">Re: Corrupted data using Riak Python Client o...</a></span> <span class="sender italic">John Daily</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12910.html">Re: Corrupted data using Riak Python Clie...</a></span> <span class="sender italic">John Daily</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Corrupted data using Riak Python ...</span> <span class="sender italic">finkle mcgraw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12922.html">Re: Corrupted data using Riak Py...</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12925.html">Re: Corrupted data using Ria...</a></span> <span class="sender italic">finkle mcgraw</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Corrupted data using Riak Python Client on Win7 64 bit">
<input type="hidden" name="msgid" value="CAOw9kdYD9B1XG63jbbTdmfs-_9VnWFLCKAtJ8oJHRv6rWTn8sw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12921.html">
<input type="submit" value=" finkle mcgraw ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Corrupted+data+using+Riak+Python+Client+on+Win7+64+bit%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12910.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12922.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAOw9kdYD9B1XG63jbbTdmfs-_9VnWFLCKAtJ8oJHRv6rWTn8sw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
