<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riak cluster suddenly became unresponsive</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10600" id="c">
<link rel="index" href="maillist.html#10600" id="i">
<link rel="prev" href="msg10475.html" id="p">
<link rel="next" href="msg10476.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10600.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak+cluster+suddenly+became+unresponsive%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riak cluster suddenly became unresponsive</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ingo+Rockel%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ingo Rockel</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130327" rel="nofollow">Wed, 27 Mar 2013 03:20:14 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Mark,

</pre><tt>we have updated to riak 1.3 and raised zdbbl to 32MB but still run into 
</tt><tt>the described phenomen. 9 nodes of our 12 nodes suddenly drastically 
</tt><tt>drop their cpu utilisation, 3 nodes still have a normal cpu load, but 
</tt><tt>have some &quot;busy_dist_port&quot; messages in the console.log (a lot less since 
</tt><tt>the zdbbl config change though). The overall response times get 
</tt><tt>terrible. We had this right now, it stayed for some minutes and went 
</tt><tt>away. The three nodes which keep on running with normal utilisation are 
</tt><tt>not always the same.
</tt><pre style="margin: 0em;"></pre><pre>

Any further ideas?

Ingo

Am 19.03.2013 15:04, schrieb Mark Phillips:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Ingo,

Sorry for the delay in getting back to you.

This looks symptomatic of some of the scheduler issues we fixed of 1.3.
A few of the    eleveldb issues in the release notes [1] can provide
precise details. Is upgrading a possibility?

Tweaking your zdbbl in vm.args should alleviate some of the issues with
busy buffers but upgrading is probably your best path here.

Hope that helps. Keep us posted.

Mark

[1] <a  rel="nofollow" href="https://github.com/basho/riak/blob/master/RELEASE-NOTES.md">https://github.com/basho/riak/blob/master/RELEASE-NOTES.md</a>

On Friday, March 15, 2013, Ingo Rockel wrote:

    Hi,

    we have a 12 nodes cluster running riak 1.2.1 which went live a week
    ago. Yesterday, suddenly from one minute to another the
    put_fsm_time_95 and the get_fsm_time_95 raised from something below
    100ms up to several seconds. This went on for about 25 min and than
    went away.

    Checking the riak-logs of the nodes, I find a lot of these:

    2013-03-14 17:48:06.388 [info]
    &lt;0.62.0&gt;@riak_core_sysmon___handler:handle_event:89 Monitor got
    {suppressed,port_events,1}
    2013-03-14 17:48:06.889 [info]
    &lt;0.62.0&gt;@riak_core_sysmon___handler:handle_event:85 monitor
    busy_dist_port &lt;0.7156.1&gt;
    
[{initial_call,{riak_core___vnode,init,1}},{almost___current_function,{erlang,bif___return_trap,1}},{message___queue_len,1}]
    {#Port&lt;0.9083226&gt;,'riak@172.22.3.22'}

    This messages are logged all day, but only once every few minutes
    but in the problematic time frame between 17:45 and 18:17 it gets
    logged several times every second. The node ip differs though, but
    it seems only three nodes were involved.

    Except of these three nodes the cpu utilisation drops by half during
    this on all other nodes. On the three nodes there's only a slight drop.

    We are using leveldb as storage backend. I also checked some of the
    LOG files of leveldb and there are compactions logged, but these are
    logged all the day every few hours.

    In this time our software was quite unresponsive too so I would like
    to know what was causing this and what I might do to stop. Any
    ideas, hints?

    I found this:

    
<a  rel="nofollow" href="https://groups.google.com/__forum/?fromgroups=#!topic/__nosql-databases/GqbaeiKCSYE">https://groups.google.com/__forum/?fromgroups=#!topic/__nosql-databases/GqbaeiKCSYE</a>
    
&lt;<a  rel="nofollow" href="https://groups.google.com/forum/?fromgroups=#!topic/nosql-databases/GqbaeiKCSYE">https://groups.google.com/forum/?fromgroups=#!topic/nosql-databases/GqbaeiKCSYE</a>&gt;

    where Jon Meredith suggests to raise the buffer size to get rid of
    the busy buffers by adding +zdbbl 16384 to the vm.args file. Might
    this help?

    Regards,

             Ingo
    --
    Software Architect

    Blue Lion mobile GmbH
    Tel. +49 (0) 221 788 797 14
    Fax. +49 (0) 221 788 797 19
    Mob. +49 (0) 176 24 87 30 89

    ingo.roc...@bluelionmobile.com
     &gt;&gt;&gt; qeep: Hefferwolf

    www.bluelionmobile.com &lt;<a  rel="nofollow" href="http://www.bluelionmobile.com">http://www.bluelionmobile.com</a>&gt;
    www.qeep.net &lt;<a  rel="nofollow" href="http://www.qeep.net">http://www.qeep.net</a>&gt;

    _________________________________________________
    riak-users mailing list
    riak-users@lists.basho.com
    <a  rel="nofollow" href="http://lists.basho.com/__mailman/listinfo/riak-users___lists.basho.com">http://lists.basho.com/__mailman/listinfo/riak-users___lists.basho.com</a>
    &lt;<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>&gt;

</pre></blockquote><pre style="margin: 0em;">


--
Software Architect

Blue Lion mobile GmbH
Tel. +49 (0) 221 788 797 14
Fax. +49 (0) 221 788 797 19
Mob. +49 (0) 176 24 87 30 89

ingo.roc...@bluelionmobile.com
&gt;&gt;&gt; qeep: Hefferwolf

www.bluelionmobile.com
www.qeep.net

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10475.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10600">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10600">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10476.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10456.html">riak cluster suddenly became unresponsive</a></span> <span class="sender italic">Ingo Rockel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10475.html">Re: riak cluster suddenly became unresponsive</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: riak cluster suddenly became unresponsi...</span> <span class="sender italic">Ingo Rockel</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10476.html">Fwd: Re: riak cluster suddenly became unrespons...</a></span> <span class="sender italic">Ingo Rockel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10477.html">Re: Re: riak cluster suddenly became unresp...</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li class="icons-email"><span class="subject"><a href="msg10478.html">mailing list headers (was Re: riak cluster ...</a></span> <span class="sender italic">Justin Sheehy</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10634.html">Re: riak cluster suddenly became unresponsive</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riak cluster suddenly became unresponsive">
<input type="hidden" name="msgid" value="5152C78F.2060403@bluelionmobile.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10600.html">
<input type="submit" value=" Ingo Rockel ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak+cluster+suddenly+became+unresponsive%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10475.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10476.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">5152C78F.2060403@bluelionmobile.com</li>
</ul>
</div>
</body>
</html>
