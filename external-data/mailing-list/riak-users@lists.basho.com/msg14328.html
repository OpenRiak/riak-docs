<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: AAE problems</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14328" id="c">
<link rel="index" href="maillist.html#14328" id="i">
<link rel="prev" href="msg14323.html" id="p">
<link rel="next" href="msg14324.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14328.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+AAE+problems%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: AAE problems</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140619" rel="nofollow">Thu, 19 Jun 2014 07:11:28 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Tue, Jun 17, 2014 at 12:46 PM, István &lt;lecc...@gmail.com&gt; wrote:
&gt;
&gt;
&gt; The entire dataset is idempotent and immutable, so there is not even a
&gt; slightest chance that we are ending up with different values on
&gt; different nodes for the same key in the same bucket. It seems that
&gt; anti-entropy still finds problems:
&gt;
&gt; /var/log/riak/console.log.4:2014-06-11 06:11:41.756 [info]
&gt; &lt;0.6776.6003&gt;@riak_kv_exchange_fsm:key_exchange:206 Repaired 1 keys
&gt; during active anti-entropy exchange of
&gt; {536645132457440915277915524513010171279912730624,3} between
&gt; {548063113999088594326381812268606132370974703616,'riak@10.1.11.120'}
&gt; and {559481095540736273374848100024202093462036676608,'riak@10.1.11.121'}
&gt;</pre><pre>

AAE exchange uses snapshots of the trees.  The snapshots on each node will
happen concurrently.  If your cluster is servicing writes as these
snapshots are made then there is a chance a snapshot will be made on one
node containing keys X,Y,Z and on the other node which has only seen keys X
&amp; Y.


&gt;
&gt; My question would be:
&gt;
&gt; Is there any reason to let AAE running if we don't mutate the data in
&gt; place?
&gt;

YES.

Immutable data provides nice semantics for your application but does
_nothing_ to save you from the whims of the stack your application runs on.
 Operating systems, file systems, and hardware all have subtle ways to
corrupt your data both on disk and in memory.  Immutable data also doesn't
help in the more practical case where the network decides to drop packets
and a write only makes it to some of the nodes.



&gt; Is there any way knowing what is causing the difference according to
&gt; AAE between two nodes?


There is but it requires attaching to Riak and running some diagnostic
commands _when_ a repair takes place.  I'm not sure it will give you any
insight though.  It will either say: 1) remote missing, 2) local missing or
3) hashes are different.


&gt; I was thinking about how this could potentially
&gt; happen and I am wondering if the Java client pb interface supports R
&gt; and W values, so I could make sure that a write goes in with W=(the
&gt; number of nodes we have).
&gt;

Doubt this will help with the concurrency problem I discussed above but it
will mean your application has a stronger guarantee of how many copies made
it to the nodes.  If you want to make sure they are durable then I would
use DW if Java exposes it [1].

[1]: See the &quot;optional query parameters&quot; for difference between W, DW, and
PW.
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/references/http/store-object/#Request">http://docs.basho.com/riak/latest/dev/references/http/store-object/#Request</a>

-Z
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14323.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14328">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14328">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14324.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14320.html">AAE problems</a></span> <span class="sender italic">István</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14322.html">Re: AAE problems</a></span> <span class="sender italic">Jordan West</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14323.html">Re: AAE problems</a></span> <span class="sender italic">István</span></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: AAE problems</span> <span class="sender italic">Ryan Zezeski</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: AAE problems">
<input type="hidden" name="msgid" value="CACZcpenh_x6tjYO5OhT-q5vKkJ_LEmbMi5gs4VPtgty9K0SuKQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14328.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+AAE+problems%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14323.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14324.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpenh_x6tjYO5OhT-q5vKkJ_LEmbMi5gs4VPtgty9K0SuKQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
