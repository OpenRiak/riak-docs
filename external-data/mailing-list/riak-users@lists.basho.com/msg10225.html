<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: Tuning a Riak cluster.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10225" id="c">
<link rel="index" href="maillist.html#10225" id="i">
<link rel="prev" href="msg10223.html" id="p">
<link rel="next" href="msg10239.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10225.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Tuning+a+Riak+cluster.%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: Tuning a Riak cluster.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kevin+Burton%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kevin Burton</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130223" rel="nofollow">Sat, 23 Feb 2013 05:27:23 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>There are 4 nodes in the cluster. Here is the vm.args for one of them:

 </pre><pre>

## Name of the riak node

-name riak@172.16.33.107

 

## Cookie for distributed erlang.  All nodes in the same cluster

## should use the same cookie or they will not be able to communicate.

-setcookie riak

 

## Heartbeat management; auto-restarts VM if it dies or becomes unresponsive

## (Disabled by default..use with caution!)

##-heart

 

## Enable kernel poll and a few async threads

+K true

+A 64

 

## Treat error_logger warnings as warnings

+W w

 

## Increase number of concurrent ports/sockets

-env ERL_MAX_PORTS 4096

 

## Tweak GC to run more often

-env ERL_FULLSWEEP_AFTER 0

 

## Set the location of crash dumps

-env ERL_CRASH_DUMP /var/log/riak/erl_crash.dump

 

## Raise the ETS table limit

-env ERL_MAX_ETS_TABLES 8192

 

## Begin SSL distribution items, DO NOT DELETE OR EDIT THIS COMMENT

 

## To enable SSL encryption of the Erlang intra-cluster communication,

## un-comment the three lines below and make certain that the paths

## point to correct PEM data files.  See docs TODO for details.

 

## -proto_dist inet_ssl

## -ssl_dist_opt client_certfile &quot;/etc/riak/erlclient.pem&quot;

## -ssl_dist_opt server_certfile &quot;/etc/riak/erlserver.pem&quot;

 

## End SSL distribution items, DO NOT DELETE OR EDIT THIS COMMENT

 

From: Richard Shaw [<a  rel="nofollow" href="mailto:rich...@basho.com">mailto:rich...@basho.com</a>] 
Sent: Saturday, February 23, 2013 2:36 AM
To: Kevin Burton
Cc: riak-users
Subject: Re: Tuning a Riak cluster.

 

 

Hi Kevin,

 

I sympathise with R, i'm going to write an installation guide to go on the
site.

 

In regards to the error, please paste in the contents of you vm.args file
from the target node

 

Thanks

 

Richard

 

On Fri, Feb 22, 2013 at 11:05 PM, &lt;rkevinbur...@charter.net&gt; wrote:

Here is the output from one configuration try:

 

17:00:08.878 [info] Using http target &quot;172.16.33.138&quot;:8098 for worker 2

 

17:00:08.878 [info] Using pb target &quot;172.16.33.138&quot;:8087 for worker 2

 

17:00:08.993 [debug] Supervisor basho_bench_sup started
basho_bench_worker:start_link(basho_bench_worker_2, 2) at pid &lt;0.96.0&gt;

 

17:00:08.999 [info] Using http target &quot;172.16.33.107&quot;:8098 for worker 3

 

17:00:09.001 [info] Using pb target &quot;172.16.33.107&quot;:8087 for worker 3

 

17:00:09.006 [debug] Supervisor basho_bench_sup started
basho_bench_worker:start_link(basho_bench_worker_3, 3) at pid &lt;0.99.0&gt;

 

17:00:09.022 [debug] Supervisor net_sup started erl_epmd:start_link() at pid
&lt;0.104.0&gt;

 

17:00:09.029 [debug] Supervisor net_sup started auth:start_link() at pid
&lt;0.105.0&gt;

 

17:00:09.030 [info] Can't set long node name!

Please check your configuration

 

17:00:09.030 [error] Failed to start net_kernel for
basho_bench_measurement_erlangvm:
{shutdown,{child,undefined,net_sup_dynamic,{erl_distribution,start_link,[[ba
sho_bench,longnames]]},permanent,1000,supervisor,[erl_distribution]}}

 

There is alot more output but this is the tail end of the output.

 

On Fri, Feb 22, 2013 at 4:34 PM, Richard Shaw wrote:

 

 Hi Kevin, 

 

Always good practise to reply to the mailing list so others can benefit from
the content 

 

basho bench is the best place to start, If you have a working cluster or
even a working single node, follow the benchmarking guide[0]  

 

Please let me see some of the specific errors you're having and we can help
resolve them. 

 

Outside of basho bench, I recommend benchmarking the raw performance of your
VM, you can do this using a variety of tools like iostat, iperf or a test
suite like Phoronix test suite, a very comprehensive FOSS tool[1] look at
the `aio` test 

 

I'd also recommend benchmarking each time you make a configuration change to
really understand how effective that change was 

 

[0] <a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/Benchmarking/">http://docs.basho.com/riak/latest/cookbooks/Benchmarking/</a>

[1] <a  rel="nofollow" href="http://www.phoronix-test-suite.com/">http://www.phoronix-test-suite.com/</a>

 

Kind Regards 

 

Richard 

 

On Fri, Feb 22, 2013 at 10:14 PM, Kevin Burton &lt; rkevinbur...@charter.net&gt;
wrote: 

That was my next question. I have tried to get basho_bench to work but so
far have been unsuccessful. If you have a simple &quot;hello world&quot; sample config
I would greatly appreciate it. I have tried a bunch of configs in the
examples directory but get met with one error or another.  

Other than that I have just timed various client driver calls. Mostly random
reads some writes. 

 

On Feb 22, 2013, at 3:48 PM, Richard Shaw &lt; rich...@basho.com&gt; wrote: 

 

Hi Kevin, 

What kind of benchmarking have you done on your VMs and what did you use ? 

 

Kind Regards 

 

Richard 

 

On Fri, Feb 22, 2013 at 9:49 AM, Kevin Burton &lt; rkevinbur...@charter.net&gt;
wrote: 

Ok I suspected as much. This will give me more ammo when requesting more
resources. Thank you. 

Now, back to the original question. Given that the physical hardware is
taken care of. What parameters are most important when tuning a cluster.
Again for arguments sake assume the same 4 node cluster with a read-write
ratio of about 75 percent. 

 

On Feb 21, 2013, at 8:26 PM, Alexander Sicular &lt; sicul...@gmail.com&gt; wrote: 

 

It can't be said enough times but the number one thing you can do to ensure
that you are getting true performance (not to mention redundancy) is to use
different physical hardware for each of your nodes. Under no circumstances
should you have more than one VM (one logical node in a Riak cluster) on the
same physical hardware. Also, use multiple
connections/threads/parallelism/whatever on client side and be sure to hit
all the nodes in the cluster haproxy roundrobin-esque when writing to Riak.
Everything else is in the noise. 

 

-Alexander Sicular 

 

@siculars 

 

On Feb 21, 2013, at 9:04 PM, Kevin Burton &lt; rkevinbur...@charter.net&gt; wrote:


 

  

There each has about 20-30GB of disk space.  They each are a VM so I am not
sure how to specify the CPU. They all seem to be 64 bit Intel processors but
I could tell you the clock speed. The network is 1Gb Ethernet. 

  

From:   Sean Carey [mailto: ca...@basho.com]   

Sent:   Thursday, February 21, 2013 7:59 PM 

To:   Kevin Burton 

Cc:   riak-users@lists.basho.com

Subject:   Re: Tuning a Riak cluster. 

  

Kevin, 

Disk and CPU, and Network? 

  

 

Sean Carey 

@densone 

On Thursday, February 21, 2013 at 20:31, Kevin Burton wrote: 

  

I have a cluster of 4 machines (4 Linux VM machines each allocated about 1
Gb of memory - yea I know it isn't a lot). I would like to get some pointers
on getting the fastest query time possible given these meager resources.
Thank you. 

_______________________________________________ 

riak-users mailing list 

riak-users@lists.basho.com

<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

  

_______________________________________________ 

riak-users mailing list 

riak-users@lists.basho.com

<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

 

_______________________________________________ 

riak-users mailing list 

riak-users@lists.basho.com

<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>





 

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10223.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10225">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10225">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10239.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10196.html">RE: Tuning a Riak cluster.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10197.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10200.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10208.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Tom Santero</span></li>
<li class="icons-email"><span class="subject"><a href="msg10213.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10217.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10218.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg10219.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Kevin Burton</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10221.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">rkevinburton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10223.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: Tuning a Riak cluster.</span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg10239.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10243.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Richard Shaw</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10248.html">RE: Tuning a Riak cluster.</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10295.html">Re: Tuning a Riak cluster.</a></span> <span class="sender italic">Richard Shaw</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: Tuning a Riak cluster.">
<input type="hidden" name="msgid" value="004a01ce11c9$57795070$066bf150$@charter.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10225.html">
<input type="submit" value=" Kevin Burton ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+Tuning+a+Riak+cluster.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10223.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10239.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">004a01ce11c9$57795070$066bf150$@charter.net</li>
</ul>
</div>
</body>
</html>
