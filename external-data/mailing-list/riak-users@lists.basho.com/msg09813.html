<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Missing SST File</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#09813" id="c">
<link rel="index" href="mail5.html#09813" id="i">
<link rel="prev" href="msg09799.html" id="p">
<link rel="next" href="msg09800.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09813.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Missing+SST+File%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Missing SST File</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Shane+McEwan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Shane McEwan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130114" rel="nofollow">Mon, 14 Jan 2013 03:02:11 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<tt>So, I figured out two ways to fix the missing SST file problem. 
</tt><tt>Described here for future generations.
</tt><pre style="margin: 0em;">

Solution 1:</pre><pre>

Shut down Riak on the node with the missing file.
Delete (or move sideways) the LevelDB partition with the missing file.
Start Riak.
</pre><tt>Repair the KV Indexes[1] which forces a partition handoff from the 
</tt><tt>replicas (I don't know if this step is needed or if Riak will notice the 
</tt><tt>empty partition and fix itself automatically).
</tt><pre style="margin: 0em;">

Solution 2:

Shut down Riak on the node with the missing file.
</pre><tt>Follow the instructions[2] to initiate a LevelDB repair. (This seems to 
</tt><tt>rebuild the MANIFEST file based on the SST files.)
</tt><pre style="margin: 0em;">
Start Riak.
</pre><tt>Because the data that was in the non-existent SST file is still missing 
</tt><tt>you'll need to:
</tt><tt>Repair the KV Indexes[1] which forces a partition handoff from the 
</tt><tt>replicas (I don't know if this step is needed or if Riak will fix itself 
</tt><tt>automatically).
</tt><pre style="margin: 0em;">

[1] <a  rel="nofollow" href="http://docs.basho.com/riak/1.2.1/cookbooks/Repairing-KV-Indexes/">http://docs.basho.com/riak/1.2.1/cookbooks/Repairing-KV-Indexes/</a>
[2] <a  rel="nofollow" href="https://gist.github.com/2834473">https://gist.github.com/2834473</a>

Hope this helps!

Shane.

On 11/01/13 13:47, Shane McEwan wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Thanks Matthew.

We're running version 1.2.1.

I was actually following the Repair KV Indexes[1] instructions which
triggered the problem. I was doing the repair mostly out of curiosity to
see what it did. I was thinking of using it as a sanity check for Riak
backups.

I assume there's a different sort of repair I can run?

[1] <a  rel="nofollow" href="http://docs.basho.com/riak/1.2.1/cookbooks/Repairing-KV-Indexes/">http://docs.basho.com/riak/1.2.1/cookbooks/Repairing-KV-Indexes/</a>

On 11/01/13 12:48, Matthew Von-Maszewski wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
What version of Riak?

Likely you need to take the node offline and run repair.

Matthew


On Jan 11, 2013, at 4:50 AM, Shane McEwan &lt;sh...@mcewan.id.au&gt; wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
G'day!

I posted this to the LevelDB mailing list with little success.
Apologies if you've already seen this from there.

We've started getting errors in a LevelDB LOG file about a missing
SST file:

2013/01/10-15:08:12.714525 7fb0767fa700 Compacting 14@0 + 7@1 files
2013/01/10-15:08:25.121147 7fb0767fa700 compacted to: files[ 14 7 50
105 0 0 0 ]
2013/01/10-15:08:25.121488 7fb0767fa700 Delete type=2 #111404
2013/01/10-15:08:25.147976 7fb0767fa700 Compaction error: IO error:
/data/riak/leveldb/902020541790166644828836732692080926193895866368/006558.sst:
No such file or directory

I assume it means we've got an SST file listed in the MANIFEST file
that doesn't exist anymore. The SST in question doesn't exist in any
of the snapshots I have around the time it was likely to have been
created.

I saw mention of a bug fixed in the latest LevelDB[1] that could
cause what we're seeing except that we haven't run out of disk space
so I'm not sure we've hit that. I'm less interested in HOW it
happened since we've moved to different hardware since then.

We haven't noticed any missing data in our database (perhaps Riak
replicas are helping there?) and even if there is something missing
the nature of our data means that we can probably live without it.

My question is, can we remove the offending file's entry out of the
MANIFEST file somehow? Or will it sort itself out? Currently our idle
test database is spinning at 100% CPU trying to compact a file that
doesn't exist.

[1]
<a  rel="nofollow" href="https://groups.google.com/forum/#!msg/leveldb/Kc9JxuIUu5A/9P0N9RL4ar8J">https://groups.google.com/forum/#!msg/leveldb/Kc9JxuIUu5A/9P0N9RL4ar8J</a>

Any advice would be greatly appreciated. Thanks!

Shane.


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09799.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#09813">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail5.html#09813">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09800.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09797.html">Missing SST File</a></span> <span class="sender italic">Shane McEwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09798.html">Re: Missing SST File</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09799.html">Re: Missing SST File</a></span> <span class="sender italic">Shane McEwan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Missing SST File</span> <span class="sender italic">Shane McEwan</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Missing SST File">
<input type="hidden" name="msgid" value="50F3E567.7040700@mcewan.id.au">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09813.html">
<input type="submit" value=" Shane McEwan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Missing+SST+File%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09799.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09800.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">50F3E567.7040700@mcewan.id.au</li>
</ul>
</div>
</body>
</html>
