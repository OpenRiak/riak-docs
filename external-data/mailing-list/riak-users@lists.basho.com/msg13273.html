<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: May allow_mult cause DoS?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#13273" id="c">
<link rel="index" href="mail5.html#13273" id="i">
<link rel="prev" href="msg13270.html" id="p">
<link rel="next" href="msg13277.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13273.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+May+allow_mult+cause+DoS%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: May allow_mult cause DoS?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brian+Roach%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brian Roach</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131217" rel="nofollow">Tue, 17 Dec 2013 13:47:49 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Tue, Dec 17, 2013 at 10:28 AM, Viable Nisei &lt;vsni...@gmail.com&gt; wrote:
&gt; Here you can check our code sample (in java) reproducing this behavior:
&gt; <a  rel="nofollow" href="https://bitbucket.org/vsnisei/riak-allow_mult_wtf">https://bitbucket.org/vsnisei/riak-allow_mult_wtf</a>
&gt; ...
&gt; Anyway, looks like that some DoS/DDoS attack approach utilizing this
&gt; behavior may be proposed. We should only know that some
&gt; service/appliation/website is using Riak with allow_mult buckets then
&gt; provoke concurrent writes into them...</pre><pre>

You're writing to the same key over and over without a vector clock.
This is exactly the behavior you should expect. Every write is
creating a new sibling and that will cause what you're seeing.

Because you chose to use a low-level, internal interface of the Java
client instead of IRiakClient, nothing is done automatically for you.

There's two typical patterns when you have concurrent writers:

1) Everything is done in a fetch/modify/write cycle. You fetch the
existing object (and its vector clock), resolve any siblings, apply
modifications, then write it back with the vector clock. This is the
default behavior of the IRiakClient. Note that you *still* may need to
resolve siblings on a plain fetch depending on the amount of
concurrent writes you have occurring; you haven't eliminated the
sibling window, just narrowed it.

2) All writes are done without vclocks. When doing a fetch, you
resolve the siblings then write back the resolved version with the
vclock. This is generally not a good approach if you expect to do lots
of writes to the same key as your sample code does because of the same
problem; lots of siblings.

I've written a fairly extensive article on using the Java client and
storing data in Riak - you may want to check it out:
<a  rel="nofollow" href="https://github.com/basho/riak-java-client/wiki/Storing-data-in-riak">https://github.com/basho/riak-java-client/wiki/Storing-data-in-riak</a>

Thanks,
- Roach

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13270.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#13273">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail5.html#13273">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13277.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13268.html">May allow_mult cause DoS?</a></span> <span class="sender italic">Viable Nisei</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13270.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Reid Draper</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: May allow_mult cause DoS?</span> <span class="sender italic">Brian Roach</span></li>
<li class="icons-email"><span class="subject"><a href="msg13277.html">RE: May allow_mult cause DoS?</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13280.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Viable Nisei</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13281.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13289.html">Fwd: May allow_mult cause DoS?</a></span> <span class="sender italic">Viable Nisei</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13292.html">SV: May allow_mult cause DoS?</a></span> <span class="sender italic">Rune Skou Larsen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13297.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Viable Nisei</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13298.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Andy Gross</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13302.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Jason Campbell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13307.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13312.html">Re: May allow_mult cause DoS?</a></span> <span class="sender italic">Jason Campbell</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: May allow_mult cause DoS?">
<input type="hidden" name="msgid" value="CAM+FMBupVXA1yg+65U9isX3TgcmEwXWMC245q48rGGEHVZQrDA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13273.html">
<input type="submit" value=" Brian Roach ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+May+allow_mult+cause+DoS%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13270.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13277.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAM+FMBupVXA1yg+65U9isX3TgcmEwXWMC245q48rGGEHVZQrDA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
