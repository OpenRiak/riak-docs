<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Newbie question 3/3</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06197" id="c">
<link rel="index" href="maillist.html#06197" id="i">
<link rel="prev" href="msg06190.html" id="p">
<link rel="next" href="msg06200.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06197.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Newbie+question+3%5C%2F3%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Newbie question 3/3</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+DeTreville%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John DeTreville</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120109" rel="nofollow">Mon, 09 Jan 2012 15:46:20 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Right, I certainly don't want distributed transactions, which I agree would 
destroy availability. (I should add that my system is geographically 
distributed, making everything much worse.)</pre><pre>

Still, that leaves open the question of doing what my application needs without 
transactions. Let's consider two situations involving updates.

The first situation is when I can reduce an update to a single write, such as 
by using Riak's secondary indexes. Unfortunately, I don't have a great 
understanding of the performance of secondary indexes, and I don't have a great 
understanding of their failure modes. Can you offer any guidance?

The second situation is when I really need to do multiple writes, in which case 
I must model (some subset of) transactional semantics at the application level. 
One example is implementing my own redo log, as mentioned earlier. Have other 
users ever had such problems? What are the good ways to solve them? Heck, what 
are the bad ways (just so I'll know what to avoid)?

Cheers,
John

On Jan 9, 2012, at 2:54 PM, Ryan Zezeski wrote:

&gt; John,
&gt; 
&gt; As you already seem to understand, Riak doesn't provide a way to make 
&gt; multiple ops atomic.  Part of the reason is because Riak's main focus thus 
&gt; far has been availability.  Distributed transactions would work, but at the 
&gt; cost of availability.  I think a flaw with the redo log approach is that you 
&gt; need to serialize all operations to A &amp; B through _one_ client to keep from 
&gt; reading an inconsistent state.
&gt; 
&gt; A much simpler option, if you can bend your data, is to combine A and B into 
&gt; one object.
&gt; 
&gt; -Ryan
&gt; 
&gt; On Mon, Jan 9, 2012 at 12:33 AM, John DeTreville &lt;j...@detreville.org&gt; wrote:
&gt; (An earlier post seems not to have gone through. My apologies in the eventual 
&gt; case of a duplicate.)
&gt; 
&gt; I'm thinking of using Riak to replace a large Oracle system, and I'm trying 
&gt; to understand its guarantees. I have a few introductory questions; this is 
&gt; the third of three.
&gt; 
&gt; I would like to do two updates atomically, but of course I cannot. I imagine 
&gt; I could construct my own redo log, and perform a sequence of operations 
&gt; something like:
&gt; 
&gt;   write redo log entry (timestamp, A's update, B's update) to redo log
&gt;   update A
&gt;   update B
&gt;   delete redo log entry from redo log
&gt; 
&gt; Asynchronously, I could read dangling entries from the redo log and repeat 
&gt; them, deleting them upon success. (Let's imagine for simplicity that the 
&gt; updates are idempotent and commutative.) This seems doable, but it's not 
&gt; pretty. Is this the best I can do? Or should I think about the problem 
&gt; differently?
&gt; 
&gt; (BTW, I believe that secondary indexes won't help me.)
&gt; 
&gt; Cheers,
&gt; John
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06190.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06197">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06197">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06200.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06173.html">Newbie question 3/3</a></span> <span class="sender italic">John DeTreville</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06190.html">Re: Newbie question 3/3</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Newbie question 3/3</span> <span class="sender italic">John DeTreville</span></li>
<li class="icons-email"><span class="subject"><a href="msg06200.html">RE: Newbie question 3/3</a></span> <span class="sender italic">Erik Søe Sørensen</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Newbie question 3/3">
<input type="hidden" name="msgid" value="92402ED8-C051-4031-AE0C-E44F9320445D@detreville.org">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06197.html">
<input type="submit" value=" John DeTreville ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Newbie+question+3%5C%2F3%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06190.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06200.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">92402ED8-C051-4031-AE0C-E44F9320445D@detreville.org</li>
</ul>
</div>
</body>
</html>
