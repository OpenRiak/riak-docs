<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Recap for May 18 - 19</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03384" id="c">
<link rel="index" href="maillist.html#03384" id="i">
<link rel="prev" href="msg03382.html" id="p">
<link rel="next" href="msg03375.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03384.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Recap+for+May+18+%5C-+19%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Recap for May 18 - 19</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Anthony+Molinaro%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Anthony Molinaro</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110521" rel="nofollow">Sat, 21 May 2011 23:04:18 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
Comments inline.

On Sat, May 21, 2011 at 06:44:58PM -0700, Greg Nelson wrote:
&gt; You mentioned you're planning on growing to around 100 nodes.
&gt; I'm curious what ring_creation_size you used?</pre><pre>

I started with 1024 and figure I can probably get to around 100 nodes before
erlang distribution protocol becomes an issue.  At that point I envision us
investing some time to modify or augment riak_core to work with a different
distribution mechanism.  One of our developers actually did his master's
research in this area, so may be able to help on that end.  Also, 100 is
mostly an estimate the Cassandra cluster we hope to replace currently has
close to that many nodes in a couple data centers, and we'll be storing
more data than we currently do in Cassandra.

&gt; Also, how much data capacity per node are you planning on?

Still working on that, although I expect it to actually not be that much
(probably a few hundred GB per node), most of the data we keep is small
in terms of keys and values.  Most of our keys will be 16 byte binaries
and most values are in the 16-200 byte range (when building systems of
the scale I need to build every byte counts, I fully expect to have to
replace bitcask at some point with something with less overhead, luckily
we've already done this once, we have a riak_core application with a
custom backend).  While our data size is smallish we tend to query it
a lot, with our current cluster looks like we average about 10K/sec gets
across the day for each of 8 nodes with about 6 billion gets per day,
the puts about only on the order of a few hundred a second, so many fewer.
I would expect that to grow at least 10x over the next year given the current
trajectory of the company.  Also, that only represents one of the buckets
that I currently use.  In the future we'll have quite at least 3 more
with similar amount of accesses.

&gt; I've been spending a lot of time lately working through what happens when
&gt; a node joins. There are a couple of big issues you will want to look out
&gt; for in addition to what you've discovered, which boil down to essentially:
&gt; After a node joins, the data on partitions which change nodes in the new
&gt; ring will be unavailable until the handoffs are complete. Currently this
&gt; comes back as a 404 that's indistinguishable from a &quot;true&quot; 404.

I remember reading the mails about that issue, but I thought it was possible
to get answers if your r value was high enough?  Maybe I'm misremembering, I
will go back and check it out.

&gt; At certain points in the progression of ring states from 1 to 100 nodes,
&gt; a LOT more partitions move around than you'd expect from a consistent
&gt; hashing scheme.
&gt;
&gt; #2 obviously exacerbates #1, and if -- like us -- you plan to have a lot
&gt; of data in the cluster, having most of it move around after a node joins
&gt; is unrealistic.
&gt; 
&gt; I'm still trying to work through exactly what's happening with #2, but
&gt; it seems like once you have more nodes than target_n_val, when adding
&gt; a new node you usually get the consistent hashing property you want:
&gt; that the new node takes some partitions from each of the other nodes,
&gt; and that's it. But every once in a while (and really, not all that
&gt; rarely), shit hits the fan and it decides to re-balance and completely
&gt; change the ring. &gt;95% of partitions will move, in certain cases!

That's sort of unfortunate, and I would assume is some sort of bug, I can't
imagine why you would ever want that behavior.

&gt; I have some erlang console code I've been using with riak_core to
&gt; simulate our cluster, to get a deeper understanding of the rings
&gt; at each phase. I might be able to clean that up and put it into a
&gt; script to share.

Sounds like the sort of thing that might be useful for testing riak_core,
especially if you can manage to get the problem with excess data movement
to be reproduceable with that code.

-Anthony

-- 
------------------------------------------------------------------------
Anthony Molinaro                           &lt;antho...@alumni.caltech.edu&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03382.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03384">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03384">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03375.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03374.html">Riak Recap for May 18 - 19</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03381.html">Re: Riak Recap for May 18 - 19</a></span> <span class="sender italic">Anthony Molinaro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03382.html">Re: Riak Recap for May 18 - 19</a></span> <span class="sender italic">Greg Nelson</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Recap for May 18 - 19</span> <span class="sender italic">Anthony Molinaro</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Recap for May 18 - 19">
<input type="hidden" name="msgid" value="20110522060357.GA61519@alumni.caltech.edu">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03384.html">
<input type="submit" value=" Anthony Molinaro ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Recap+for+May+18+%5C-+19%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03382.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03375.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20110522060357.GA61519@alumni.caltech.edu</li>
</ul>
</div>
</body>
</html>
