<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Erlang Client: get_update_metadata vs get_metadata</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07668" id="c">
<link rel="index" href="maillist.html#07668" id="i">
<link rel="prev" href="msg07667.html" id="p">
<link rel="next" href="msg07672.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07668.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Erlang+Client%5C%3A+get_update_metadata+vs+get_metadata%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Erlang Client: get_update_metadata vs get_metadata</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Michael+Radford%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Michael Radford</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120612" rel="nofollow">Tue, 12 Jun 2012 11:56:36 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>get_metadata returns the metadata that was read from riak. But if
allow_mult is true, and there is more than one sibling, then
get_metadata throws the exception 'siblings'. You have to call
get_metadatas to get a list with metadata for each sibling in that
case.</pre><pre>

get_update_metadata returns the metadata that is to be written for the
object (if you were to call riakc_pb_socket:put at that point). The
update metadata is either a single value set explicitly with
riakc_obj:update_metadata, or if none was set, and there is only one
sibling, then the default is the value of get_metadata.

A related question: if I'm not using any user-specified metadata at
all, but I do have allow_mult turned on, then how do I choose which
metadata to write back to riak after resolving the conflict? Or could
I just call update_metadata with an empty dict in that case?

Right now, I have some conflict resolution code that uses the same
default strategy as mochimedia's statebox_riak library, which
arbitrarily chooses the first metadata. But this seems less than
ideal: everything in the metadata is coming from riak, and some of it
(e.g., last-modified timestamps) must be ignored when doing the
update. So it seems like riak should be able to resolve the &quot;metadata
conflict&quot; on its own: just prune all the metadata keys that aren't
actually written, and then if the resulting pruned metadatas are
identical, then there's no conflict. Or, if there is some reason why
the user should prefer one metadata over another, then the client
library should give the user some way to decide.

Mike

On Tue, Jun 12, 2012 at 11:25 AM, Andrew Berman &lt;rexx...@gmail.com&gt; wrote:
&gt; Can someone explain the difference between the get_update_metadata and
&gt; get_metadata functions in the Erlang PB Client for Riak? Â It's very
&gt; confusing...
&gt;
&gt; Thanks,
&gt;
&gt; Andrew
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07667.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07668">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07668">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07672.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07667.html">Erlang Client: get_update_metadata vs get_metadata</a></span> <span class="sender italic">Andrew Berman</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Erlang Client: get_update_metadata vs get_metadat...</span> <span class="sender italic">Michael Radford</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07672.html">Re: Erlang Client: get_update_metadata vs get_met...</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07673.html">Re: Erlang Client: get_update_metadata vs get...</a></span> <span class="sender italic">Michael Radford</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07676.html">Re: Erlang Client: get_update_metadata vs...</a></span> <span class="sender italic">Andrew Berman</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Erlang Client: get_update_metadata vs get_metadata">
<input type="hidden" name="msgid" value="CAOUfeeF_Lnk_K_nY76_7wcDSQ0j9JshFo9rDy_d7s9R199zyNA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07668.html">
<input type="submit" value=" Michael Radford ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Erlang+Client%5C%3A+get_update_metadata+vs+get_metadata%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07667.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07672.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAOUfeeF_Lnk_K_nY76_7wcDSQ0j9JshFo9rDy_d7s9R199zyNA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
