<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Secondary Index Limits</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14805" id="c">
<link rel="index" href="maillist.html#14805" id="i">
<link rel="prev" href="msg14803.html" id="p">
<link rel="next" href="msg14806.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14805.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Secondary+Index+Limits%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Secondary Index Limits</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140829" rel="nofollow">Fri, 29 Aug 2014 06:45:39 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Bryan,

Index entries are just keys in LevelDB like normal values are. So,
performance is relatively constant at write time but is O(N) at read
(because you are scanning the index). The high-cardinality term will
definitely be expensive to enumerate, but the low-cardinality terms
will be much less so. The index entries in LevelDB look roughly like
this:</pre><pre>

{i, IndexName, IndexTerm} =&gt; PrimaryKey

Since the keys are encoded with sext, we encode the start key of the
range (or the equality query), start an iterator and then seek to that
start key and start reading values. When a key is reached that exceeds
the range or equality query, we stop iterating.

Of course, that is an oversimplification, there are issues with
backpressure from the request coordinator process against the
iterators, streaming merge sort if you want the results back in order
or paginated, etc. Also, all 2I queries are run via coverage, which
ensures that the entire keyspace is &quot;covered&quot; but hits most if not all
nodes in the cluster.

On Thu, Aug 28, 2014 at 9:18 PM, Bryan &lt;br...@go-factory.net&gt; wrote:
&gt; Hi Everyone,
&gt;
&gt; Apologies as this has probably been asked before. Unfortunately I have not
&gt; been able to parse through the list serve to find a reasonable answer and
&gt; the Basho wiki docs seem to be missing this information. I have read up on
&gt; the secondary index docs.
&gt;
&gt; I am interested to better understand how the secondary indexes perform when
&gt; there is a very low distribution of values that are indexed. For example,
&gt; lets say I have a bucket with 1 million objects that I create a secondary
&gt; index on. Now lets say the index is on a value that has an uneven
&gt; distribution where one of the values is not selective while the others are,
&gt; such that 60% of the values fall into a single indexed value, while the
&gt; remaining 40% have a good distribution.
&gt;
&gt; For example, I have a record (i.e. object) where the indexed field is
&gt; ‘foobar_bin'. I have 1 million objects in the bucket that have 100 unique
&gt; ‘foobar’ values distributed over the 1 million objects. One of the values
&gt; repeats for 60% of the records (600K) and the rest have an even distribution
&gt; of about 4%.
&gt;
&gt; How will the secondary indexes perform with this and is this an appropriate
&gt; use of the secondary indexes? Finally, what I have read is not completely
&gt; clear on what happens if the indexed value is updated when the value has
&gt; such a low degree of selectivity?
&gt;
&gt; We have less than 512 partitions and are using the erlang client.
&gt;
&gt; Thanks in advance - any insights will be much appreciated!
&gt;
&gt;
&gt; Cheers,
&gt; Bryan
&gt;
&gt; ----
&gt;
&gt; Bryan Hughes
&gt; Go Factory
&gt; <a  rel="nofollow" href="http://www.go-factory.net">http://www.go-factory.net</a>
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;



-- 
Sean Cribbs &lt;s...@basho.com&gt;
Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14803.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14805">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14805">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14806.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14803.html">Riak Secondary Index Limits</a></span> <span class="sender italic">Bryan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Secondary Index Limits</span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14806.html">Re: Riak Secondary Index Limits</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14815.html">Re: Riak Secondary Index Limits</a></span> <span class="sender italic">Bryan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14816.html">Re: Riak Secondary Index Limits</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Secondary Index Limits">
<input type="hidden" name="msgid" value="CAHsw=e2kRFq5Ya_x+EVKff_DMPitY5G028fcfpamOCWimnD37A@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14805.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Secondary+Index+Limits%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14803.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14806.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAHsw=e2kRFq5Ya_x+EVKff_DMPitY5G028fcfpamOCWimnD37A@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
