<!DOCTYPE html>
<html lang="en">
<head>
<title>Write to object(s) by index</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd7.html#12972" id="c">
<link rel="index" href="mail7.html#12972" id="i">
<link rel="prev" href="msg12967.html" id="p">
<link rel="next" href="msg12974.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12972.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Write+to+object%5C%28s%5C%29+by+index%22&amp;o=newest" rel="nofollow"><span itemprop="name">Write to object(s) by index</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Olav+Frengstad%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Olav Frengstad</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131113" rel="nofollow">Wed, 13 Nov 2013 07:51:53 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey,

I'm trying to come up with an solution to writing child objects where the
parent will be reference by some secondary index.</pre><pre>

The data model contains a list of devices, each with a list of messages
beneath them.

Currently I have a hierarchical scheme where devices are stored under
(devices, &lt;addr&gt;) and messages under (messages/&lt;addr&gt;, &lt;id&gt;). This works
fine fine and i can write incoming messages without retrieving the device
first.

Now I want to add support for replacing devices, that means multiple
devices can have the same address. I was thinking to add &lt;addr&gt; as a
secondary index to the device object, but then i need to do a index query
to get the real device id.

I intend to keep a secondary index containing the device address, and
activation status. The question then, can i somehow reference that index
and rewrite the bucket when storing the object?

There are a few problems that comes to mind:

1) There might be multiple active devices, this is fine multiple writes can
be issued
2) Riak would have to know how to rewrite the bucket name, which should be
client logic.

One way to solve this issue would be to keep the list of &lt;addr&gt; -&gt; &lt;id&gt;
mappings in the connection handler. This could work all changes to devices
can be propagated to the all the API endpoints, there won't be an issue
with API endpoints running out of memory either as it would only amount to
100's of MB's for 10k+ connections.

Another approach would be to to have pre-commit hook rewriting the the
bucket name, that would require a fetch (possibly from other nodes in the
system) so it does not really change anything.

Is there any other approaches i'm missing that could be better? for
instance it seems logical - at least to me - that one could alias an object
by using links; but i'm not aware of such a method.

Cheers,
Olav

-- 
Med Vennlig Hilsen
Olav Frengstad

Systemutvikler // FWT
+47 920 42 090
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12967.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd7.html#12972">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail7.html#12972">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12974.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Write to object(s) by index">
<input type="hidden" name="msgid" value="CAAC-290ArQegv=_1datrDzOYKU4b2QeFDfsjkJiBzrcVOv7CJw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12972.html">
<input type="submit" value=" Olav Frengstad ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Write+to+object%5C%28s%5C%29+by+index%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12967.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12974.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAAC-290ArQegv=_1datrDzOYKU4b2QeFDfsjkJiBzrcVOv7CJw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
