<!DOCTYPE html>
<html lang="en">
<head>
<title>riak exiting when number partitions > 128</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08826" id="c">
<link rel="index" href="maillist.html#08826" id="i">
<link rel="prev" href="msg08823.html" id="p">
<link rel="next" href="msg08827.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08826.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22riak+exiting+when+number+partitions+%3E+128%22&amp;o=newest" rel="nofollow"><span itemprop="name">riak exiting when number partitions > 128</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22David+Lowell%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">David Lowell</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121008" rel="nofollow">Mon, 08 Oct 2012 18:00:48 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I'm starting to want to move past the default Riak configs, for example, by 
running with a larger number of partitions than the default 64. However, today 
when bumping up the &quot;ring_creation_size&quot; config param to 256 or higher Riak 
started failing soon after startup with messages about &quot;Too many open files&quot;. 
For the record, I'm using the ELevelDB back-end.</pre><pre>

I've seen the documentation about the need for ring_creation_size * 
max_open_files file descriptors with levelDB. I've upped the system open files 
limit for the riak user to 100k, so I don't think I'm hitting that system 
limit. So it feels like I'm hitting a limit configured within the application 
somewhere.

It doesn't feel like changing levelDB's 'max_open_files' configuration is the 
issue here, as I'm using the default/minimum value of 20 for that parameter. 
Any other setting would increase open files.

So I could use a pointer here from folks who have been here. I suspect there is 
something very simple required here. 

Thanks folks!

Dave

ps. For the record, my data set is empty on this host, and for completeness I'm 
blowing away the ring state when I fiddle with the ring_creation_size parameter.

--
Dave Lowell
d...@connectv.com


2012-10-09 00:50:17.430 [info] &lt;0.7.0&gt; Application riak_kv started on node 
'riak@10.0.3.81'
2012-10-09 00:50:17.456 [info] &lt;0.7.0&gt; Application merge_index started on node 
'riak@10.0.3.81'
2012-10-09 00:50:17.459 [info] &lt;0.1316.0&gt;@riak_core:wait_for_service:445 
Waiting for service riak_kv to start (0 seconds)
2012-10-09 00:50:17.525 [info] &lt;0.1303.0&gt;@riak_core:wait_for_application:419 
Wait complete for application riak_kv (0 seconds)
2012-10-09 00:50:37.366 [error] &lt;0.5081.0&gt;@riak_kv_vnode:init:265 Failed to 
start riak_kv_eleveldb_backend Reason: {db_open,&quot;IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files&quot;}
2012-10-09 00:50:37.423 [notice] &lt;0.5081.0&gt;@riak:stop:46 &quot;backend module failed 
to start.&quot;
2012-10-09 00:50:37.424 [error] &lt;0.5081.0&gt; CRASH REPORT Process &lt;0.5081.0&gt; with 
0 neighbours exited with reason: {db_open,&quot;IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files&quot;} in gen_fsm:init_it/6 line 371
2012-10-09 00:50:37.429 [info] &lt;0.494.0&gt;@riak_kv_js_vm:terminate:240 
Spidermonkey VM (pool: riak_kv_js_hook) host stopping (&lt;0.494.0&gt;)
2012-10-09 00:50:37.673 [error] &lt;0.138.0&gt; Supervisor riak_core_vnode_sup had 
child undefined started with {riak_core_vnode,start_link,undefined} at 
&lt;0.5081.0&gt; exit with reason {db_open,&quot;IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files&quot;} in context child_terminated
2012-10-09 00:50:37.736 [error] &lt;0.153.0&gt; gen_server riak_core_vnode_manager 
terminated with reason: no match of right hand value {error,{db_open,&quot;IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files&quot;}} in riak_core_vnode_manager:get_vnode/3 line 489
2012-10-09 00:50:37.799 [error] &lt;0.153.0&gt; CRASH REPORT Process 
riak_core_vnode_manager with 0 neighbours exited with reason: no match of right 
hand value {error,{db_open,&quot;IO error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files&quot;}} in riak_core_vnode_manager:get_vnode/3 line 489 in 
gen_server:terminate/6 line 747
2012-10-09 00:50:37.844 [error] &lt;0.136.0&gt; Supervisor riak_core_sup had child 
riak_core_vnode_manager started with riak_core_vnode_manager:start_link() at 
&lt;0.153.0&gt; exit with reason no match of right hand value {error,{db_open,&quot;IO 
error: 
/var/data/ctv/riak/leveldb/1427247692705959881058285969449495136382746624000/LOCK:
 Too many open files&quot;}} in riak_core_vnode_manager:get_vnode/3 line 489 in 
context child_terminated

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08823.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08826">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08826">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08827.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">riak exiting when number partitions &gt; 128</span> <span class="sender italic">David Lowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08827.html">Re: riak exiting when number partitions &gt; 128</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08828.html">Re: riak exiting when number partitions &gt; 12...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08829.html">Re: riak exiting when number partitions &gt...</a></span> <span class="sender italic">David Lowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08830.html">Re: riak exiting when number partitions...</a></span> <span class="sender italic">David Lowell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08831.html">Re: riak exiting when number parti...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="riak exiting when number partitions &gt; 128">
<input type="hidden" name="msgid" value="DC5DDCF0-6026-41CC-9174-40F7603E520A@go2ctv.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08826.html">
<input type="submit" value=" David Lowell ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22riak+exiting+when+number+partitions+%3E+128%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08823.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08827.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">DC5DDCF0-6026-41CC-9174-40F7603E520A@go2ctv.com</li>
</ul>
</div>
</body>
</html>
