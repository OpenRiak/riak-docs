<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: RiakCS poor s3 upload speeds 2MB/s</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd3.html#15135" id="c">
<link rel="index" href="mail3.html#15135" id="i">
<link rel="prev" href="msg15131.html" id="p">
<link rel="next" href="msg15136.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15135.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+RiakCS+poor+s3+upload+speeds+2MB%5C%2Fs%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: RiakCS poor s3 upload speeds 2MB/s</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22David+Meekin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">David Meekin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20141110" rel="nofollow">Mon, 10 Nov 2014 06:50:33 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

We’re using the below versions with RHEL 6.4.</pre><pre>

riak-cs-control-1.0.2-1.el6.x86_64
riak-1.4.10-1.el6.x86_64
riak-cs-1.5.2-1.el6.x86_64
stanchion-1.5.0-1.el6.x86_64

I’m uploading a 3GB ISO from my windows client (s3 browser 4-4-5) not using 
multipart. The windows s3 browser doesn’t seem to work with multipart with 
either Ceph or Riak CS. I’ve read elsewhere relating to ceph that this is to do 
with the way the http line ends are terminated. So I just assumed it’s the same 
with Riak CS.
Using the same 3GB ISO  and linux S3 client (which I believe defaults to 
multipart) installed locally on one of the Riak CS nodes, I achieve slightly 
better speeds of 4-5MB/s.
Prior to setting this up on Physical hardware we setup a 4 node cluster within 
our cloudstack environment and attained the same speeds. It feels like 
something is throttling somewhere.

Thanks for your help

Dave
From: Luke Bakken [<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>]
Sent: 08 November 2014 15:33
To: David Meekin
Cc: riak-users@lists.basho.com
Subject: Re: RiakCS poor s3 upload speeds 2MB/s

Hi David,

Could you please provide a bit more information?

* The version of Riak and Riak CS you are using
* A description of the files you are uploading. What size are they and are you 
using multipart uploads?

Thanks
--
Luke Bakken
Engineer / CSE
lbak...@basho.com&lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;

On Fri, Nov 7, 2014 at 6:41 AM, David Meekin 
&lt;david.mee...@autotrader.co.uk&lt;<a  rel="nofollow" href="mailto:david.mee...@autotrader.co.uk">mailto:david.mee...@autotrader.co.uk</a>&gt;&gt; wrote:
Hi,

I’ve setup a test 4 node RiakCS cluster on HP BL460c hardware and I can’t seem 
to get S3 upload speeds above 2MB/s
I’m connecting direct to RiackCS on one of the nodes so there is no load 
balancing software in place.
I have also installed s3cmd locally onto one of the nodes and the speeds 
locally are the same.
These 4 nodes also run a test CEPH cluster with RadosGW and s3 uploads to CEPH 
achieve 125MB/s
Any help would be appreciated as I’m currently evaluating both CEPH and RiakCS.

Configs below:

%%%RIACK – app.config
%% -*- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil -*-
%% ex: ft=erlang ts=4 sw=4 et
[
%% Riak Client APIs config
{riak_api, [
            {pb_backlog, 256},
            {pb, [ {&quot;172.19.153.180&quot;, 8087 } ]}
            ]},

%% Riak Core config
{riak_core, [

              {default_bucket_props, [{allow_mult, true}]},

              {ring_state_dir, &quot;/var/lib/riak/ring&quot;},

              {http, [ {&quot;172.19.153.180&quot;, 8098 } ]},
              {https, [{ &quot;172.19.153.180&quot;, 8096 }]},
              {ssl, [
                     {certfile, &quot;/etc/riak/cert.pem&quot;},
                     {keyfile, &quot;/etc/riak/key.pem&quot;}
                    ]},

              {handoff_port, 8099 },

              {dtrace_support, false},

              {platform_bin_dir, &quot;/usr/sbin&quot;},
              {platform_data_dir, &quot;/var/lib/riak&quot;},
              {platform_etc_dir, &quot;/etc/riak&quot;},
              {platform_lib_dir, &quot;/usr/lib64/riak/lib&quot;},
              {platform_log_dir, &quot;/var/log/riak&quot;}
             ]},

%% Riak KV config
{riak_kv, [
            {add_paths, [&quot;/usr/lib64/riak-cs/lib/riak_cs-1.5.2/ebin&quot;]},
            {storage_backend, riak_cs_kv_multi_backend},
            {multi_backend_prefix_list, [{&lt;&lt;&quot;0b:&quot;&gt;&gt;, be_blocks}]},
            {multi_backend_default, be_default},
            {multi_backend, [
              {be_default, riak_kv_eleveldb_backend, [
              {max_open_files, 50},
              {data_root, &quot;/var/lib/riak/leveldb&quot;}
            ]},
            {be_blocks, riak_kv_bitcask_backend, [
              {data_root, &quot;/var/lib/riak/bitcask&quot;}
            ]}
            ]},


            {anti_entropy, {on, []}},

            {anti_entropy_build_limit, {1, 3600000}},
            {anti_entropy_expire, 604800000},

            {anti_entropy_concurrency, 2},
            {anti_entropy_tick, 15000},

            {anti_entropy_data_dir, &quot;/var/lib/riak/anti_entropy&quot;},

            {anti_entropy_leveldb_opts, [{write_buffer_size, 4194304},
                                         {max_open_files, 20}]},

            {mapred_name, &quot;mapred&quot;},

            {mapred_2i_pipe, true},

            {map_js_vm_count, 8 },
            {reduce_js_vm_count, 6 },
            {hook_js_vm_count, 2 },

            {js_max_vm_mem, 8},

            {js_thread_stack, 16},

            {http_url_encoding, on},

            {vnode_vclocks, true},

            {listkeys_backpressure, true},

            {fsm_limit, 50000},

            {object_format, v1}
           ]},

%% Riak Search Config
{riak_search, [
                {enabled, false}
               ]},

%% Merge Index Config
{merge_index, [
                {data_root, &quot;/var/lib/riak/merge_index&quot;},

                {buffer_rollover_size, 1048576},

                {max_compact_segments, 20}
               ]},

%% Bitcask Config
{bitcask, [
             {io_mode, erlang},

            {data_root, &quot;/var/lib/riak/bitcask&quot;}
           ]},

%% eLevelDB Config
{eleveldb, [
             {data_root, &quot;/var/lib/riak/leveldb&quot;}
            ]},

%% Lager Config
{lager, [
            {handlers, [
                           {lager_file_backend, [
                               {&quot;/var/log/riak/error.log&quot;, error, 10485760, 
&quot;$D0&quot;, 5},
                               {&quot;/var/log/riak/console.log&quot;, info, 10485760, 
&quot;$D0&quot;, 5}
                           ]}
                       ] },

            {crash_log, &quot;/var/log/riak/crash.log&quot;},

            {crash_log_msg_size, 65536},

            {crash_log_size, 10485760},

            {crash_log_date, &quot;$D0&quot;},

            {crash_log_count, 5},

            {error_logger_redirect, true},

            {error_logger_hwm, 100}
        ]},

%% riak_sysmon config
{riak_sysmon, [
         {process_limit, 30},
         {port_limit, 2},

         {gc_ms_limit, 0},
         {heap_word_limit, 40111000},

         {busy_port, true},
         {busy_dist_port, true}
        ]},

%% SASL config
{sasl, [
         {sasl_error_logger, false}
        ]},

%% riak_control config
{riak_control, [
                {enabled, true},

                {auth, userlist},

                {userlist, [{&quot;admin&quot;, &quot;password&quot;}
                           ]},

                {admin, true}
                ]}
].


%%%RiakCS – app.config
%% -*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -*-
%% ex: ts=4 sw=4 et
[
%% Riak CS configuration
{riak_cs, [
              %% == Basic Configuration ==

              %% Riak CS http/https port and IP address to listen at
              %% for object storage activity
              {cs_ip, &quot;172.19.153.180&quot;},
              {cs_port, 8080 } ,
              {riak_ip, &quot;172.19.153.180&quot;},
              {riak_pb_port, 8087 } ,
              {stanchion_ip, &quot;172.19.153.180&quot;},
              {stanchion_port, 8085 },
              {stanchion_ssl, false },
              {anonymous_user_creation, true},
              {admin_key, &quot;_UJJOXXQEXW3XAWUGSQD&quot;},
              {admin_secret, &quot;8bkzcxZDIKsmjJUhEEJkpcM6g5_X7gSazryBGA==&quot;},

              {cs_root_host, &quot;s3.amazonaws.com&lt;<a  rel="nofollow" href="http://s3.amazonaws.com">http://s3.amazonaws.com</a>&gt;&quot;},
              {connection_pools,
               [
                {request_pool, {128, 0} },
                {bucket_list_pool, {5, 0} }
               ]},
             {rewrite_module, riak_cs_s3_rewrite },
             {auth_module, riak_cs_s3_auth },
              {fold_objects_for_list_keys, true},

              {n_val_1_get_requests, true},
              {cs_version, 10300 },
              {access_log_flush_factor, 1},
              {access_log_flush_size, 1000000},
              {access_archive_period, 3600},
              {access_archiver_max_backlog, 2},
              {storage_schedule, []},
              {storage_archive_period, 86400},
              {usage_request_limit, 744},
              {leeway_seconds, 86400},
              {gc_interval, 900},
              {gc_retry_interval, 21600},
              {gc_paginated_indexes, true},

              {trust_x_forwarded_for, false},
              {dtrace_support, false}

             ]},

{webmachine, [
               {server_name, &quot;Riak CS&quot;},

               {log_handlers, [
                               {webmachine_log_handler, [&quot;/var/log/riak-cs&quot;]},
                               {riak_cs_access_log_handler, []}
                              ]}
              ]},

{lager, [
          {handlers, [
                      {lager_console_backend, info},
                      {lager_file_backend, [{file, 
&quot;/var/log/riak-cs/error.log&quot;},
                                            {level, error},
                                            {size, 10485760},
                                            {date, &quot;$D0&quot;},
                                            {count, 5}]},
                      {lager_file_backend, [{file, 
&quot;/var/log/riak-cs/console.log&quot;},
                                            {level, info},
                                            {size, 10485760},
                                            {date, &quot;$D0&quot;},
                                            {count, 5}]}
                     ]},
          {crash_log, &quot;/var/log/riak-cs/crash.log&quot;},
          {crash_log_msg_size, 65536},

          {crash_log_size, 10485760},

          {crash_log_date, &quot;$D0&quot;},

          {crash_log_count, 5},

          {error_logger_redirect, true}
         ]},

{sasl, [
         {sasl_error_logger, false}
        ]}
].

Thanks,

Dave

Tel: +441616699154&lt;tel:%2B441616699154&gt;   Mob: +44 7525 
405543&lt;tel:%2B44%207525%20405543&gt;

[cid:image001.png@01CFFCC9.E3DD4930]

Tel: +441616699154   Mob: +44 7525 405543

[cid:42ac75.png@d4deaeeb.4b950055]

________________________________________

This e-mail is sent on behalf of Auto Trader Group Limited, Registered Office: 
Auto Trader House, Cutbush Park Industrial Estate, Danehill, Lower Earley, 
Reading, Berkshire, RG6 4UT (Registered in England No. 4768833). This email and 
any files transmitted with it are confidential and may be legally privileged, 
and intended solely for the use of the individual or entity to whom they are 
addressed. If you have received this email in error please notify the sender. 
This email message has been swept for the presence of computer viruses.

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


________________________________________


This e-mail is sent on behalf of Auto Trader Group Limited, Registered Office: 
Auto Trader House, Cutbush Park Industrial Estate, Danehill, Lower Earley, 
Reading, Berkshire, RG6 4UT (Registered in England No. 4768833). This email and 
any files transmitted with it are confidential and may be legally privileged, 
and intended solely for the use of the individual or entity to whom they are 
addressed. If you have received this email in error please notify the sender. 
This email message has been swept for the presence of computer viruses. 

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15131.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd3.html#15135">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail3.html#15135">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15136.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg15130.html">RiakCS poor s3 upload speeds 2MB/s</a></span> <span class="sender italic">David Meekin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15131.html">Re: RiakCS poor s3 upload speeds 2MB/s</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">RE: RiakCS poor s3 upload speeds 2MB/s</span> <span class="sender italic">David Meekin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15136.html">Re: RiakCS poor s3 upload speeds 2MB/s</a></span> <span class="sender italic">Luke Bakken</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg15139.html">Re: RiakCS poor s3 upload speeds 2MB/s</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li class="icons-email"><span class="subject"><a href="msg15230.html">Re: RiakCS poor s3 upload speeds 2MB/s</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15252.html">Re: RiakCS poor s3 upload speeds 2MB/s</a></span> <span class="sender italic">Heinz Nikolaus Gies</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15255.html">Re: RiakCS poor s3 upload speeds 2MB/s</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15256.html">Re: RiakCS poor s3 upload speeds 2MB/...</a></span> <span class="sender italic">Heinz Nikolaus Gies</span></li>
<li class="icons-email"><span class="subject"><a href="msg15535.html">Re: RiakCS poor s3 upload speeds 2MB/...</a></span> <span class="sender italic">Kota Uenishi</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15536.html">Re: RiakCS poor s3 upload speeds...</a></span> <span class="sender italic">Toby Corkindale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15537.html">Re: RiakCS poor s3 upload sp...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15551.html">Re: RiakCS poor s3 uploa...</a></span> <span class="sender italic">Toby Corkindale</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: RiakCS poor s3 upload speeds 2MB/s">
<input type="hidden" name="msgid" value="D13D03AA759DBB4D9112B27B1A9F4C1E014B995FE0F8@TMG-E2K7CCR1.group.tradermedia.co.uk">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15135.html">
<input type="submit" value=" David Meekin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+RiakCS+poor+s3+upload+speeds+2MB%5C%2Fs%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15131.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15136.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">D13D03AA759DBB4D9112B27B1A9F4C1E014B995FE0F8@TMG-E2K7CCR1.group.tradermedia.co.uk</li>
</ul>
</div>
</body>
</html>
