<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Is it inefficient to map over a small bucket when you have 	millions of other buckets?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00714" id="c">
<link rel="index" href="maillist.html#00714" id="i">
<link rel="prev" href="msg00708.html" id="p">
<link rel="next" href="msg00719.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00714.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Is+it+inefficient+to+map+over+a+small+bucket+when+you+have+%09millions+of+other+buckets%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Is it inefficient to map over a small bucket when you have 	millions of other buckets?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alexander+Sicular%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alexander Sicular</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100712" rel="nofollow">Mon, 12 Jul 2010 07:44:09 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I believe the number of buckets are basically unlimited - as long as
you use the default bucket properties (which can be changed by conf
file), re. number of replicas. If you change bucket properties on the
fly that info runs around the cluster in the gossip channel.
Afaik, buckets are simply virtual namespaces. Your data structure
could have a bucket per user listing collections. Map over that then
use the collection value to deriv bucket/key pair to pass into
additional map phases in an m/r chain.</pre><pre>

And no, I seriously doubt that riak traverses the entire key space for
every m/r in the sense that it touches every key in the system
regardless of bucket. That is why riak has an input param required for
each m/r. I would love to hear otherwise.

-Alexander

On 2010-07-11, Daniel Einspanjer &lt;deinspan...@mozilla.com&gt; wrote:
&gt;   I'm thinking about the pros and cons of Riak vs HBase for Mozilla's
&gt; Weave (now Firefox Sync) 2.0 engine.
&gt; <a  rel="nofollow" href="https://wiki.mozilla.org/Labs/Weave/Sync/2.0/API">https://wiki.mozilla.org/Labs/Weave/Sync/2.0/API</a>
&gt;
&gt; The primary use case is that when a user's client performs a sync, it
&gt; needs to retrieve all the new items since the last time it synced for
&gt; each collection (bookmarks, tabs, history, etc.) that the client is
&gt; configured to sync.
&gt;      If a particular client doesn't sync often, it is possible that
&gt; there might be thousands of items to retrieve, this means that using
&gt; links *might* run into issues.
&gt;
&gt; HBase's use of ordered keys pushes for a schema where you'd have the
&gt; modified timestamp in the key.  That would allow for quick and easy
&gt; scanning of just the new items.
&gt;
&gt; Riak however, has a few interesting features such as the on-demand
&gt; creation of new buckets that might make it much more flexible... if
&gt; there is a highly performant mechanism for the client to retrieve new data.
&gt;
&gt; What prompted me to post this message was something I thought I
&gt; remembered seeing regarding mapping over buckets in Riak.  Unfortunately
&gt; I can't find the reference now.
&gt;
&gt; Is it true that in order to map over all the keys in a single bucket,
&gt; the Riak cluster must actually traverse the entire global keyspace of
&gt; all buckets to find the keys that are part of the desired bucket?
&gt;
&gt; In the case where you have tens of millions of users, and you have
&gt; either one bucket per user or (if it were feasible) one bucket per user
&gt; per collection, it seems like it would be impossible to efficiently
&gt; perform a map reduce on one user's bucket.
&gt;
&gt; That seems like such a common scenario, I must have misinterpreted what
&gt; I read.  I'd really appreciate some clarification there and also would
&gt; be very interested in any schema proposals or thoughts you might have
&gt; about this use case.
&gt;
&gt; -Daniel
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

-- 
Sent from my mobile device

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00708.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00714">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00714">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00719.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00708.html">Is it inefficient to map over a small bucket when you ha...</a></span> <span class="sender italic">Daniel Einspanjer</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Is it inefficient to map over a small bucket wh...</span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00719.html">Re: Is it inefficient to map over a small bucke...</a></span> <span class="sender italic">Nicolas Fouch√©</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00789.html">Re: Is it inefficient to map over a small b...</a></span> <span class="sender italic">Justin Sheehy</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Is it inefficient to map over a small bucket when you have 	millions of other buckets?">
<input type="hidden" name="msgid" value="AANLkTikgsQnyPv9ZZDs9aUGGBBm0g1p2atEG_iAW8tpE@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00714.html">
<input type="submit" value=" Alexander Sicular ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Is+it+inefficient+to+map+over+a+small+bucket+when+you+have+%09millions+of+other+buckets%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00708.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00719.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTikgsQnyPv9ZZDs9aUGGBBm0g1p2atEG_iAW8tpE@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
