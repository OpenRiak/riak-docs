<!DOCTYPE html>
<html lang="en">
<head>
<title>Stalled handoffs on a prod cluster after server crash</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#13180" id="c">
<link rel="index" href="mail6.html#13180" id="i">
<link rel="prev" href="msg13173.html" id="p">
<link rel="next" href="msg13187.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13180.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Stalled+handoffs+on+a+prod+cluster+after+server+crash%22&amp;o=newest" rel="nofollow"><span itemprop="name">Stalled handoffs on a prod cluster after server crash</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ivaylo+Panitchkov%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ivaylo Panitchkov</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131209" rel="nofollow">Mon, 09 Dec 2013 06:48:44 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello,

We have a prod cluster of four machines running riak (1.1.4 2012-06-19)
Debian x86_64.
Two days ago one of the servers went down because of a hardware failure.
I force-removed the machine in question to re-balance the cluster before
adding the new machine.
Since then the cluster is operating properly, but I noticed some handoffs
are stalled now.
I had similar situation awhile ago that was solved by simply forcing the
handoffs, but this time the same approach didn't work.
Any ideas, solutions or just hints are greatly appreciated.
Below are cluster statuses. Replaced the IP addresses for security reason.</pre><pre>



~# riak-admin member_status
Attempting to restart script through sudo -u riak
================================= Membership
==================================
Status     Ring    Pending    Node
-------------------------------------------------------------------------------
valid      45.3%     34.4%    'r...@aaa.aaa.aaa.aaa'
valid      26.6%     32.8%    'r...@bbb.bbb.bbb.bbb'
valid      28.1%     32.8%    'r...@ccc.ccc.ccc.ccc'
-------------------------------------------------------------------------------
Valid:3 / Leaving:0 / Exiting:0 / Joining:0 / Down:0



~# riak-admin ring_status
Attempting to restart script through sudo -u riak
================================== Claimant
===================================
Claimant:  'r...@aaa.aaa.aaa.aaa'
Status:     up
Ring Ready: true

============================== Ownership Handoff
==============================
Owner:      r...@aaa.aaa.aaa.aaa
Next Owner: r...@bbb.bbb.bbb.bbb

Index: 22835963083295358096932575511191922182123945984
  Waiting on: [riak_kv_vnode]
  Complete:   [riak_pipe_vnode]

Index: 570899077082383952423314387779798054553098649600
  Waiting on: [riak_kv_vnode]
  Complete:   [riak_pipe_vnode]

Index: 1118962191081472546749696200048404186924073353216
  Waiting on: [riak_kv_vnode]
  Complete:   [riak_pipe_vnode]

Index: 1392993748081016843912887106182707253109560705024
  Waiting on: [riak_kv_vnode]
  Complete:   [riak_pipe_vnode]

-------------------------------------------------------------------------------
Owner:      r...@aaa.aaa.aaa.aaa
Next Owner: r...@ccc.ccc.ccc.ccc

Index: 114179815416476790484662877555959610910619729920
  Waiting on: [riak_kv_vnode]
  Complete:   [riak_pipe_vnode]

Index: 662242929415565384811044689824565743281594433536
  Waiting on: [riak_kv_vnode]
  Complete:   [riak_pipe_vnode]

Index: 1210306043414653979137426502093171875652569137152
  Waiting on: [riak_kv_vnode]
  Complete:   [riak_pipe_vnode]

-------------------------------------------------------------------------------

============================== Unreachable Nodes
==============================
All nodes are up and reachable



Thanks in advance,
Ivaylo



-- 
Ivaylo Panitchkov
Software developer
Hibernum Creations Inc.

Ce courriel est confidentiel et peut aussi être protégé par la loi.Si vous
avez reçu ce courriel par erreur, veuillez nous en aviser immédiatement en
y répondant, puis supprimer ce message de votre système. Veuillez ne pas le
copier, l’utiliser pour quelque raison que ce soit ni divulguer son contenu
à quiconque.
This email is confidential and may also be legally privileged. If you have
received this email in error, please notify us immediately by reply email
and then delete this message from your system. Please do not copy it or use
it for any purpose or disclose its content.
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13173.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#13180">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail6.html#13180">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13187.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Stalled handoffs on a prod cluster after server crash</span> <span class="sender italic">Ivaylo Panitchkov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13187.html">Re: Stalled handoffs on a prod cluster after server...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li class="icons-email"><span class="subject"><a href="msg13196.html">Re: Stalled handoffs on a prod cluster after server...</a></span> <span class="sender italic">Jeppe Toustrup</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13197.html">Re: Stalled handoffs on a prod cluster after se...</a></span> <span class="sender italic">Ivaylo Panitchkov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13198.html">Re: Stalled handoffs on a prod cluster afte...</a></span> <span class="sender italic">Jeppe Toustrup</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13200.html">Re: Stalled handoffs on a prod cluster ...</a></span> <span class="sender italic">Mark Phillips</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Stalled handoffs on a prod cluster after server crash">
<input type="hidden" name="msgid" value="CAPvQezx=gdZyumADu+WRHkvNPvs-3YKTxaSRLVt_XdUj-EOjOQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13180.html">
<input type="submit" value=" Ivaylo Panitchkov ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Stalled+handoffs+on+a+prod+cluster+after+server+crash%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13173.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13187.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAPvQezx=gdZyumADu+WRHkvNPvs-3YKTxaSRLVt_XdUj-EOjOQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
