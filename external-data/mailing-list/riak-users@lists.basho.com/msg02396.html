<!DOCTYPE html>
<html lang="en">
<head>
<title>0.14 and search schema</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02396" id="c">
<link rel="index" href="maillist.html#02396" id="i">
<link rel="prev" href="msg02392.html" id="p">
<link rel="next" href="msg02408.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02396.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%220.14+and+search+schema%22&amp;o=newest" rel="nofollow"><span itemprop="name">0.14 and search schema</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Gary+William+Flake%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Gary William Flake</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110220" rel="nofollow">Sun, 20 Feb 2011 22:56:34 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I've been pulling my hair out over new behaviors with search-schema,
and I am wondering if I've been simply doing it wrong.  Here's the
issue: search-schema seem extremely brittle compared to the rest of
the system in that one misstep requires that you effectively blow away
your whole DB and try again.  Some specific examples:</pre><pre>

1. Defaults don't seem to mean anything now in that if you add a new
field to what you are storing, then riak will throw up on insert
because the field isn't in the schema.

2. But if you add the new field to the schema, then it breaks all of
your old records (e.g., they can't be deleted until you change the
schema back or turn off hooks).

3. The semantics are non-intuitive (at least to me).  I had thought
that {skip, true} would mean &quot;this is data that I want but don't index
over it&quot;.  Instead, it appears to mean &quot;riak will not index it, and if
you do a search, we will not provide this field value in the results
even though it exists&quot;.

4. To make it even more challenging, on ubuntu &quot;search-cmd set-schema
...&quot; ignores the last argument.  It seems to expect the schema to
already exist in /var/lib/riak/scripts and I found that if I
forcefully move and chmod the schema, then I can get it to stick.

5. But, BTW, /var/lib/riak doesn't exist as part of 0.14's deb
package, so you better know to add it yourself.


Anyhow, am I doing something wrong?  Or is how it is supposed to be?
Does anyone have any tricks for working around this brittleness?

Thanks,
-- GWF

PS - here's a trick that may help you.  Define a field called &quot;future&quot;
and make set up the standard analyzer in the search schema.  Then,
when you are tempted to add a new field, don't.  Instead, force your
new &quot;field:val&quot; bits into future instead.  This way, you can get away
with not having to change the schema nor do you need to add a new
field.  I am hoping that this trick will help me keep a riak instance
stable long enough to work through migration issues for when I do need
to change the schema.

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02392.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02396">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02396">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02408.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">0.14 and search schema</span> <span class="sender italic">Gary William Flake</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02408.html">Re: 0.14 and search schema</a></span> <span class="sender italic">Rusty Klophaus</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="0.14 and search schema">
<input type="hidden" name="msgid" value="AANLkTin7=QVj2VBmbgVB_sAu1b514sbmcSZ_VQmaqXvp@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02396.html">
<input type="submit" value=" Gary William Flake ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%220.14+and+search+schema%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02392.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02408.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTin7=QVj2VBmbgVB_sAu1b514sbmcSZ_VQmaqXvp@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
