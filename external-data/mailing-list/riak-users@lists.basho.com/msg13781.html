<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Re: Questions about the Riak Horizontal Scalability</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#13781" id="c">
<link rel="index" href="mail2.html#13781" id="i">
<link rel="prev" href="msg13775.html" id="p">
<link rel="next" href="msg13786.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13781.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Re%5C%3A+Questions+about+the+Riak+Horizontal+Scalability%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Re: Questions about the Riak Horizontal Scalability</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22yanqun....%40mesheven.com%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">yanqun....@mesheven.com</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140309" rel="nofollow">Sun, 09 Mar 2014 23:45:07 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Greate thanks to all of you!
I'm very sorry for a late response!
Is it polite to make a reply to all in one email? (If not, ask for forgiveness)</pre><pre>

To Alexander:
There are 2 physical machines in our cluster, and 5 riak VMs on each machine.
Two physical CPUs in each machine (totally 12 cores), and I assigned 2 cores 
for each riak VM.
All the 12 riak VMs are based on the same shared storage server (by 
FreeNAS+iSCSI), whicn means all riak VMs don't use machines' local disks as 
their storage.
And they are in a 1Gb LAN, each physical machine has 6 NICs, 4 of them are for 
iSCSI(multipath).
So the network bandwidth is probably not the bottleneck, but disk IO probably 
be.

To Sean Cribbs:
Yes, as you said, more &quot;concurrent&quot; means more load for basho benchmark machine.
But during my previous tests, I noticed that cpu utilization of basho benchmark 
machine is about 50%.
But I want to try run basho benchmark tool on two machines as you suggested.
I noticed the command &quot;basho_bench&quot; has an option &quot;-J --join&quot;, I tried but 
faild with error report  &quot;escript: exception throw: 
{no_host,'root@10.11.20.44'} &quot;.
I have configured SSH public-key&amp;no-password login for those two basho 
benchmark machines(they have same environments like  OS,erlang and basho 
benchmark versions). I searched about this, but didn't find how to run basho 
benchmark tool on two separate machines.
Could you tell me how to do or is there any guidance about this?

To Christian Dahlqvist:
Thanks for your tips, and I think we will try &quot;basho_bench_driver_riakc_pb&quot;.
Not only because of this &quot;Horizontal Scalability&quot; problem, but also for better 
performance.
And also, I will change the key generator for subsequent tests.

To Evan Vigil-McClanahan:
Yes, I am using Riak 2.0 for tests.
And &quot;numa zones&quot;, &quot;sbt&quot;? Sorry I know little about this, but I will read more 
about this to check if it can help me.

I will run more tests with the suggestions from all of you!
Thank you again!
And I will let you know if get any progress or result.











From: Sean Cribbs
Date: 2014-03-08 06:54
To: Alexander Sicular
CC: yanqun....@mesheven.com; riak-users
Subject: Re: Questions about the Riak Horizontal Scalability
Note as well that the 'concurrent' setting will *not* typically increase 
throughput beyond a certain point (instead you will simply have many workers 
waiting in the run queue). You are also only driving load from a single machine 
with limits on its CPU and network throughput. Start by trying a more 
reasonable concurrency level, like two (2) times the number of CPU cores in the 
basho_bench machine. Also consider running basho_bench from multiple machines 
at once. Consider the line rate of your network as well; in the past I have 
easily been able to saturate a gigabit network with basho_bench.



On Fri, Mar 7, 2014 at 4:45 PM, Alexander Sicular &lt;sicul...@gmail.com&gt; wrote:

How many physical machines (disks/cores/nics) are in your cluster?


-Alexander


@siculars
<a  rel="nofollow" href="http://siculars.posthaven.com">http://siculars.posthaven.com</a>


Sent from my iRotaryPhone

On Mar 6, 2014, at 22:07, &quot;yanqun....@mesheven.com&quot; &lt;yanqun....@mesheven.com&gt; 
wrote:


Greetings all... 

I am running tests with Riak Cluster.
When this cluster has only one node, the max throughput is about 1500 ops/s(CPU 
becomes the bottleneck).
But after I added 4 more nodes into the cluster,  no matter how I changed the 
configuration file of Basho benchmark tool, 
the number of throughput have never been more than ~3500 ops/s.
CPU utilization on each node is about 60~65% (captured by iostat and sar)

And when I added 5 more nodes(10 nodes totally), it is the same result.
And CPU utilization on each node is about 60%.
I  can't understand why.

During the tests, I tried:
1)Change ring size from 64 to 128
2)Change basho benchmark configuration file, like &quot;mode&quot;,&quot;concurrent&quot; and 
&quot;key_generator&quot;...
3)Modify some system limits on both riak nodes and basho bench servers, such as 
file descriptor  , tcp settings.
4)Monitoring system like cpu, memory and IO, and none of them become the 
bottleneck.
5)Monitoring the basho bench server,  low load.

Any ideas?
Or did I make any mistakes in my configuration file?

Configuration file of Basho benchmark tool:
===================================================================
{mode, max}.
{duration, 15}.
{concurrent,    500}.
{driver, basho_bench_driver_http_raw}.
{http_raw_ips, 
[&quot;10.11.20.46&quot;,&quot;10.11.20.47&quot;,&quot;10.11.20.48&quot;,&quot;10.11.20.49&quot;,&quot;10.11.20.50&quot;,&quot;10.11.20.51&quot;,&quot;10.11.20.52&quot;,&quot;10.11.20.53&quot;]}.
{http_raw_port, 8098}.
{http_raw_path, &quot;/riak/test&quot;}.
{key_generator, {partitioned_sequential_int, 
1000000000000000,8000000000000000}}.  %%we want 16 bytes long key-length 
{value_generator, {fixed_bin, 1024}}. %%1KB
{operations, [{insert,4}, {get,6}]}.
===============================================================================

Here are our server specifications(VMs based on Xenserver):
1)Riak nodes: 2cores + 4GB RAM + 20GB disk
2)Basho benchmark, 4 cores + 4GB RAM, 30GB disk.

Thank you very much !
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>







-- 
Sean Cribbs &lt;s...@basho.com&gt;
Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a></pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13775.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#13781">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#13781">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13786.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13770.html">Questions about the Riak Horizontal Scalability</a></span> <span class="sender italic">yanqun....@mesheven.com</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13771.html">Re: Questions about the Riak Horizontal Scala...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13772.html">Re: Questions about the Riak Horizontal S...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13773.html">Re: Questions about the Riak Horizont...</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13774.html">Re: Questions about the Riak Hori...</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13775.html">Re: Questions about the Riak...</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Re: Questions about the Riak Hori...</span> <span class="sender italic">yanqun....@mesheven.com</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13786.html">Re: Re: Questions about the Riak ...</a></span> <span class="sender italic">Greg Burd</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Re: Questions about the Riak Horizontal Scalability">
<input type="hidden" name="msgid" value="2014031014431508914155@mesheven.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13781.html">
<input type="submit" value=" yanqun....@mesheven.com ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Re%5C%3A+Questions+about+the+Riak+Horizontal+Scalability%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13775.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13786.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">2014031014431508914155@mesheven.com</li>
</ul>
</div>
</body>
</html>
