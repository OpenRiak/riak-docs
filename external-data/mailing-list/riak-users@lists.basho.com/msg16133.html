<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Clarifying withoutFetch() with LevelDB and</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16133" id="c">
<link rel="index" href="maillist.html#16133" id="i">
<link rel="prev" href="msg16132.html" id="p">
<link rel="next" href="msg16136.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16133.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Clarifying+withoutFetch%5C%28%5C%29+with+LevelDB+and%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Clarifying withoutFetch() with LevelDB and</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Alex+Moore%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alex Moore</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150513" rel="nofollow">Wed, 13 May 2015 09:37:02 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey Daniel,

I wanted to know a little bit more about using withoutFetch() option when
&gt; used with levelDB.
&gt; I'm trying to write to a single key as fast as I can with n=3.
&gt; I deliberately create siblings by writing with stale vclock.
&gt; ...
&gt; During the test I see activity on the on disk via iostat and it's between
&gt; 20-30 MB/s on each node.
&gt; Even taking into account multiple copies and overhead of Riak (vclocks etc)
&gt; this seems to be pretty high rate.
&gt; I don't see any read activity which suggest withoutFetch() works as
&gt; expected.
&gt; After 2 mins of tests leveldb on each node is 250MB is size, before test
&gt; (11MB)
&gt; Am I using it incorrectly?</pre><pre>

Is writing in this way to a single key a good idea or will I be bitten by
&gt; something?
&gt; How to explain high number of MB written to disks?


We call this problem a &quot;hot key&quot;.

When you write with a stale vclock, it will generate a new sibling every
time.
For example the first time you store your object it's just &quot;{v1}&quot;, the next
time it will get a sibling: &quot;{v1, v2}&quot;, eventually it's &quot;{v1,...v1000}&quot;
since the siblings are never resolved.  That data is read, updated, old
version tombstoned, and the new data written with every PUT. Based on your
info I would see about 250MB raw data there if LevelDB hasn't compacted the
tombstones away.

RiakObject.withoutFetch() tells your java client to store data without
fetching the most current value first.  During that fetch, it would resolve
siblings before writing the value back.  You may get better throughput by
resolving your siblings (less writes overall), or by rethinking your data
model so you're not always writing to the same key repeatedly.   Is this
just a benchmark or are you modeling something in your application?

Thanks,
Alex


On Wed, May 13, 2015 at 11:03 AM, Daniel Iwan &lt;iwan.dan...@gmail.com&gt; wrote:

&gt; We are using Java client 1.1.4.
&gt; We haven't moved to newer version of Riak as as for the moment we don't
&gt; need
&gt; any new features.
&gt; Also roll out of the new version may be complicated since we have multiple
&gt; clusters.
&gt;
&gt; As with regards to object size its ~250-300 bytes per write. We store
&gt; simple
&gt; JSON structures.
&gt;
&gt; Is there anything in new versions that would limit size of data going to
&gt; the
&gt; disk?
&gt; And more importantly is there a way of determining why levelDB grows so
&gt; big?
&gt;
&gt; I'm using ring size 128 which is probably too high at the moment, but after
&gt; switching to 64 not much has  changed.
&gt; I also disabled 2i indexes that I thought may matter (four 16 bytes fields)
&gt; and that did not made any difference, still 25-38MB/s write to level db per
&gt; node.
&gt;
&gt; D.
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; <a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Clarifying-withoutFetch-with-LevelDB-and-tp4033051p4033053.html">http://riak-users.197444.n3.nabble.com/Clarifying-withoutFetch-with-LevelDB-and-tp4033051p4033053.html</a>
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16132.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16133">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16133">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16136.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16130.html">Clarifying withoutFetch() with LevelDB and</a></span> <span class="sender italic">Daniel Iwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16131.html">Re: Clarifying withoutFetch() with LevelDB and</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16132.html">Re: Clarifying withoutFetch() with LevelDB and</a></span> <span class="sender italic">Daniel Iwan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Clarifying withoutFetch() with LevelDB and</span> <span class="sender italic">Alex Moore</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16136.html">Re: Clarifying withoutFetch() with LevelDB an...</a></span> <span class="sender italic">Daniel Iwan</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Clarifying withoutFetch() with LevelDB and">
<input type="hidden" name="msgid" value="CADjd2TeaXgavWAC3SaC6+=79nu=VPGduoMo2=s00iDuiOEOfRw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16133.html">
<input type="submit" value=" Alex Moore ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Clarifying+withoutFetch%5C%28%5C%29+with+LevelDB+and%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16132.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16136.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CADjd2TeaXgavWAC3SaC6+=79nu=VPGduoMo2=s00iDuiOEOfRw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
