<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: luwak backend and misc.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#04262" id="c">
<link rel="index" href="maillist.html#04262" id="i">
<link rel="prev" href="msg04261.html" id="p">
<link rel="next" href="msg04433.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04262.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+luwak+backend+and+misc.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: luwak backend and misc.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kunal+Nawale%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kunal Nawale</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110808" rel="nofollow">Mon, 08 Aug 2011 13:16:22 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Bryan,
</pre><tt> I will try increasing the file size from 6 GB up and find out where it 
</tt><tt>breaks. I will also capture the logs when it fails.
</tt><pre style="margin: 0em;"></pre><pre>

I have not played with the 'block_size' parameter, will try that too.
The upload client is running on a separate machine.
I am using curl to upload and download.
Thanks for your help.
-kunal



On 08/08/2011 03:51 PM, Bryan Fink wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, Jul 28, 2011 at 12:00 PM, Kunal Nawale&lt;knaw...@verivue.com&gt;  wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi,
  I am evaluating luwak to be used as a redundant file storage server. I am
trying to find out which backend will better suit for my purpose. Each of my
server has sixteen 1TB drives, 4 total servers, 48GB ram each, 1x10Gb
network interface
The file sizes that will be stored range from 1GB-20GB, with an average size
of 3 GB.

Here are some observations/questions I had regarding this.

1) With bitcask backend, I tried uploading a 6 GB file. The upload and
download worked fine for this file. But when I tried to upload a 17 GB file
it took a very long time (more than 20 mins). Tried to download it but did
not succeed, the download always come back with a size of 1,000,000 bytes.
</pre></blockquote><pre style="margin: 0em;">
There are a few things that can cause these troubles.  Have you
checked the logs to see if there were any errors during any of these
operations?

On the upload side, it's possible that 6GB stands on one side of a
boundary, and 17GB on the other.  I'd suggest searching the size space
in a binary fashion: does 11.5GB work?  If there is a boundary, this
is a good way to find it.  It might be worth trying this both in the
case where the Riak cluster is cleaned out after each attempt, and
where it is left running with all data for all attempts.  Does
changing the &quot;block_size&quot; luwak parameter (controled by the
X-Luwak-Block-Size HTTP header when you create the file) change where
the boundary is?

Still on the upload side, where was the upload client running?  That
client may have been applying extra memory pressure to one of your
nodes if it was on the same machine as the cluster.

On the download side, if you haven't modified the block_size of your
luwak files, 1,000,000 indicates that there's exactly one block in the
file.  If this was an existing file of 1MB, then this just means that
your 17GB upload failed before flushing the tree for the new data.
We've also noticed that some clients (like Firefox) have trouble
parsing Luwak's chunked response, due to an error in gzip encoding -
try explicitly setting Accept-Encoding to only identity.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
2) I also tried fs_backend, but it turned out to be quite slow, the
upload of a 6 GB took considerably longer. The download never succeeded
it always returned me a chunk of that file not the whole file.
</pre></blockquote><pre style="margin: 0em;">
The fs_backend was written as proof/testing code.  It is not optimized
for any variety of speed.  Best to stick with Luwak for your use case,
I think.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
3) Are there any performance measurements available about the read/write
bandwidths
</pre></blockquote><pre style="margin: 0em;">
None directly, but you should be able to estimate the write speed:
Luwak creates a Riak object for every N bytes of your file (N is known
as the &quot;block size&quot;).  Luwak will not be able to write these objects
faster than any other Riak client.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
5) Can an object be read simultaneously while it is being written. With a
lag between the read write pointer being in the range of 60 MBytes.
</pre></blockquote><pre style="margin: 0em;">
I questions 4&amp;5 are related, and I think it's easier to answer 5 first.

The simple answer is *new* Luwak files cannot be read while being
written.  This has to do with the fact that the HTTP interface does
not expose a way to flush the file's tree to Riak before finishing the
upload.  The data for the file is being persisted, but the root
pointer is not modified until the end.

This also means that *existing* Luwak file *can* be read while being
modified, but modifications made after the root pointer is found will
be invisible.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
4) Are there any latency numbers available, I am specifically looking at the
time difference between the first byte read and the last byte write for an
object.
</pre></blockquote><pre style="margin: 0em;">
I'm interpreting this question as, &quot;After I finish writing, how long
will it be before I can begin reading what I just wrote?&quot; because of
the tree-flushing behavior I described above.

The answer depends on the backlog to the Luwak writer process (on the
Riak/server side), and the depth of the resulting file tree.  Once the
writer has written the final block to an object, it must then flush
the tree pointing to that object.  Flushing the tree requires writing,
at least, the root node and the &quot;tld&quot; object (where the metadata about
the file is stored).  The block_size and tree_order parameters
(1,000,000 bytes and 250, by default) determine how many other nodes
must be written between the root and the block.  Each node is an
additional Riak object write.

I hope that helps,
Bryan
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04261.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#04262">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04262">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04433.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg04111.html">luwak backend and misc.</a></span> <span class="sender italic">Kunal Nawale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04261.html">Re: luwak backend and misc.</a></span> <span class="sender italic">Bryan Fink</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: luwak backend and misc.</span> <span class="sender italic">Kunal Nawale</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04433.html">Re: luwak backend and misc.</a></span> <span class="sender italic">Drew Whitehouse</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: luwak backend and misc.">
<input type="hidden" name="msgid" value="4E404396.2090501@verivue.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04262.html">
<input type="submit" value=" Kunal Nawale ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+luwak+backend+and+misc.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04261.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04433.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">4E404396.2090501@verivue.com</li>
</ul>
</div>
</body>
</html>
