<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: using 2i with protocol buffers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd13.html#11623" id="c">
<link rel="index" href="mail13.html#11623" id="i">
<link rel="prev" href="msg11618.html" id="p">
<link rel="next" href="msg11625.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11623.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+using+2i+with+protocol+buffers%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: using 2i with protocol buffers</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Christian+Dahlqvist%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Christian Dahlqvist</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130719" rel="nofollow">Fri, 19 Jul 2013 01:25:43 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Joey,

When using secondary indexes the index names must end in either `_int` for 
integer indexes or `_bin` for binary indexes in order for them to be recognised 
by the system [1]. All indexes must be set when you write the objects.</pre><pre>

You must also ensure that the bucket you are writing the objects to are using 
either the memory or leveldb backends as bitcask does not support secondary 
indexes. Can you verify that this is the case? Are there any error messages in 
the logs?

Which exact client version are you using?

[1] 
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/Secondary-Indexes---Configuration/">http://docs.basho.com/riak/latest/cookbooks/Secondary-Indexes---Configuration/</a>

Best regards,

Christian



On 19 Jul 2013, at 07:09, Joey Yandle &lt;dra...@dancingdragon.be&gt; wrote:

&gt; Hi everbody,
&gt; 
&gt; I'm using riak to store large numbers of FX rates, to allow for deep
&gt; backtests of trading strategies.  My code seems to be working, except
&gt; that I don't get any keys back from 2i range requests.
&gt; 
&gt; Here's the code which puts the rate into riak (the rate is itself a
&gt; protocol buffers object):
&gt; 
&gt; std::string s = p-&gt;rate().time();
&gt; std::string rate;
&gt; p-&gt;rate().SerializeToString(&amp;rate);
&gt; 
&gt; mrx::riak::RpbPutReqPtr req(new mrx::riak::RpbPutReq());
&gt; 
&gt; req-&gt;set_bucket(symbol);
&gt; req-&gt;set_key(s);
&gt; 
&gt; mrx::riak::RpbContent* content = req-&gt;mutable_content();
&gt; 
&gt; content-&gt;set_value(rate);
&gt; 
&gt; mrx::riak::RpbPair* index = content-&gt;add_indexes();
&gt; 
&gt; index-&gt;set_key(vm[&quot;riak.index&quot;].as&lt;std::string&gt;());
&gt; index-&gt;set_value(s);
&gt; 
&gt; Here's the code which does the index search:
&gt; 
&gt; mrx::riak::RpbIndexReqPtr req(new mrx::riak::RpbIndexReq());
&gt; 
&gt; req-&gt;set_bucket(symbol);
&gt; req-&gt;set_index(vm[&quot;riak.index&quot;].as&lt;std::string&gt;());
&gt; req-&gt;set_qtype(mrx::riak::RpbIndexReq::range);
&gt; 
&gt; req-&gt;set_range_min(vm[&quot;rates.start&quot;].as&lt;std::string&gt;());
&gt; req-&gt;set_range_max(vm[&quot;rates.end&quot;].as&lt;std::string&gt;());
&gt; 
&gt; I originally used the string &quot;time&quot; as the index key, and there was no
&gt; error when doing the put command.  However, when trying to search with
&gt; this index, I got the following error:
&gt; 
&gt; [{unknown_field_type,&lt;&lt;&quot;time&quot;&gt;&gt;}]
&gt; 
&gt; This error went away when I used &quot;time_bin&quot; as the index.  However,
&gt; regardless of what I use as the index key when doing the put, I never
&gt; get any keys returned during the search.
&gt; 
&gt; Can someone point me to a working example of using protocol buffers to
&gt; do a put and subsequent index search?  The examples online only show the
&gt; latter.
&gt; 
&gt; thanks,
&gt; 
&gt; Joey
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11618.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd13.html#11623">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail13.html#11623">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11625.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11618.html">using 2i with protocol buffers</a></span> <span class="sender italic">Joey Yandle</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: using 2i with protocol buffers</span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11625.html">Re: using 2i with protocol buffers</a></span> <span class="sender italic">Joey Yandle</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: using 2i with protocol buffers">
<input type="hidden" name="msgid" value="30DB0FA9-4906-44CA-9F28-F863764BF349@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11623.html">
<input type="submit" value=" Christian Dahlqvist ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+using+2i+with+protocol+buffers%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11618.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11625.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">30DB0FA9-4906-44CA-9F28-F863764BF349@basho.com</li>
</ul>
</div>
</body>
</html>
