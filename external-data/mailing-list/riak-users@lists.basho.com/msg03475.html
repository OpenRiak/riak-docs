<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Store whole database in memory</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03475" id="c">
<link rel="index" href="maillist.html#03475" id="i">
<link rel="prev" href="msg03474.html" id="p">
<link rel="next" href="msg03480.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03475.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Store+whole+database+in+memory%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Store whole database in memory</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Greg+Nelson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Greg Nelson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110528" rel="nofollow">Sat, 28 May 2011 11:36:23 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Depending on the n_val you have set for that bucket, Riak will store the 
objects n times on n different nodes. There are two other parameters you should 
know about, r and w. When writing, Riak will wait for w of the n nodes to 
finish the write before returning. When reading, Riak will wait for r of the n 
nodes to respond before returning. This is the basics of how Riak does fault 
and partition tolerance, i.e. if one node is down your cluster still functions, 
and the r and w vals define a sort of &quot;majority vote&quot; threshold to handle a 
split-brain problem.</pre><pre>

Anyway, for your purposes you could set w=1 and r=3 for faster writes at the 
expense of potentially slower reads. I've never tried this (or any of the 
backends besides bitcask) so I don't know what you should expect.

As for bulk insert and preserving locality, I don't know of a way to do that 
with Riak except to batch your 1000 keys into a single object, identified by 
one key. As far as Riak is concerned, it's just a 12KB opaque object, which 
your application would need to always write and read all at once.

If you don't batch like that, you should look for a discussion on this mailing 
list from last week regarding capacity planning and very small objects. There's 
a bit of overhead associated with each object that will be significant for 
objects as small as 12 bytes. You could skip over the parts about Bitcask 
overhead...

On Saturday, May 28, 2011 at 9:59 AM, Michael McClain wrote:

&gt; Thank you, Mike and Greg, for the response.
&gt; I've just replied to the list.
&gt; In my use case, I need to be able to write 100,000 keys per second. Where the 
&gt; key is very small (12 bytes). And I always insert 1000 keys at once, in a 
&gt; bulk insert. I would also like to preserve the locality of the keys inserted 
&gt; at once (so that they stay always in the same node). Do you know if that is 
&gt; possible?
&gt; 
&gt; Thank you
&gt; 
&gt; 2011/5/28 Mike Oxford &lt;moxf...@gmail.com (<a  rel="nofollow" href="mailto:moxf...@gmail.com">mailto:moxf...@gmail.com</a>)&gt;
&gt; &gt;  With enough RAM you could just have it keep the whole thing in 
&gt; &gt; disk-cache...
&gt; &gt; 
&gt; &gt; -mox
&gt; &gt; 
&gt; &gt; 
&gt; &gt; On Fri, May 27, 2011 at 11:11 PM, Greg Nelson &lt;gro...@dropcam.com 
&gt; &gt; (<a  rel="nofollow" href="mailto:gro...@dropcam.com">mailto:gro...@dropcam.com</a>)&gt; wrote:
&gt; &gt; &gt; Michael,
&gt; &gt; &gt; 
&gt; &gt; &gt; You might want to check out riak_kv_ets_backend, 
&gt; &gt; &gt; riak_kv_gb_trees_backend, and riak_kv_cache_backend.
&gt; &gt; &gt; 
&gt; &gt; &gt; <a  rel="nofollow" href="http://wiki.basho.com/Configuration-Files.html">http://wiki.basho.com/Configuration-Files.html</a>
&gt; &gt; &gt; 
&gt; &gt; &gt; -Greg
&gt; &gt; &gt; 
&gt; &gt; &gt; On Friday, May 27, 2011 at 10:35 PM, Michael McClain wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Hi,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Is it possible to store the whole database in memory?
&gt; &gt; &gt; &gt; In a similar way as Redis does.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I'm really interested in the distributed map reduce done by riak 
&gt; &gt; &gt; &gt; (&quot;bring processing to the data, instead of data to processors), but I 
&gt; &gt; &gt; &gt; need faster writes/reads that a memory-only database could provide.
&gt; &gt; &gt; &gt; In case you don't support memory-only storage (no disk touched / all 
&gt; &gt; &gt; &gt; keys and data fitting the memory in all nodes) yet, do you plan on 
&gt; &gt; &gt; &gt; implementing it?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Thank you,
&gt; &gt; &gt; &gt; Michael
&gt; &gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt; &gt; &gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt;  riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt; &gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt; &gt; 
&gt; &gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03474.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03475">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03475">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03480.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03469.html">Store whole database in memory</a></span> <span class="sender italic">Michael McClain</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03470.html">Re: Store whole database in memory</a></span> <span class="sender italic">Greg Nelson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03472.html">Re: Store whole database in memory</a></span> <span class="sender italic">Mike Oxford</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03474.html">Re: Store whole database in memory</a></span> <span class="sender italic">Michael McClain</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Store whole database in memory</span> <span class="sender italic">Greg Nelson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03480.html">Re: Store whole database in memory</a></span> <span class="sender italic">Nico Meyer</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg03473.html">Re: Store whole database in memory</a></span> <span class="sender italic">Michael McClain</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Store whole database in memory">
<input type="hidden" name="msgid" value="86774E062CBC49AF9D6ADAE6F86DECE7@dropcam.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03475.html">
<input type="submit" value=" Greg Nelson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Store+whole+database+in+memory%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03474.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03480.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">86774E062CBC49AF9D6ADAE6F86DECE7@dropcam.com</li>
</ul>
</div>
</body>
</html>
