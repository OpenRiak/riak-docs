<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: have a new node take over the role of a downed,	unrecoverable node?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01317" id="c">
<link rel="index" href="maillist.html#01317" id="i">
<link rel="prev" href="msg01316.html" id="p">
<link rel="next" href="msg01318.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01317.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+have+a+new+node+take+over+the+role+of+a+downed%2C%09unrecoverable+node%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: have a new node take over the role of a downed,	unrecoverable node?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Leonid+Riaboshtan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Leonid Riaboshtan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101016" rel="nofollow">Sat, 16 Oct 2010 18:53:03 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>&gt;&gt; However, you'll need to reip on all machines.

Hmm, isn't stuff like that should be treated automaticly by Riak? I mean I
have a cluster where nodes leave, nodes come. And after each come/leave I
need to do something to nodes in entire cluster to entroduce/remove new/old
node and repartion the data?</pre><pre>

And question sounds rather strange to me, what is the node role in system
where all nodes are equal? It's everywhere said that  Riak will
automatically re-balance data as nodes join and leave the cluster. It's not
the case when node becomes unreachable and cluster would repartion data to
keep it solid (like keeping n_val for keys)?

Or something else should watch for nodes states and tell cluster that node
is down?

It's also said that:
The ring state is shared around the cluster by means of a &quot;gossip protocol&quot;.
Whenever a node changes its claim on the ring, it announces its change via
this protocol. It also periodically re-announces what it knows about the
ring, in case any nodes missed previous updates.

Isn't cluster checking on unavailable nodes that way too?

I'm not offending anyone, just trying to make things more clear for myself.

On Sun, Oct 17, 2010 at 4:56 AM, Jesse Newland &lt;je...@railsmachine.com&gt;wrote:

&gt; Thanks Sean!
&gt;
&gt; Regards -
&gt;
&gt; Jesse Newland
&gt; ---
&gt; je...@railsmachine.com
&gt; 404.216.1093
&gt;
&gt; On Oct 16, 2010, at 7:01 PM, Sean Cribbs wrote:
&gt;
&gt; &gt; Sorry, I wasn't completely clear. You can make any node &quot;leave&quot; from the
&gt; console. e.g.
&gt; &gt;
&gt; &gt; riak_core_gossip:remove_from_cluster('r...@some-host.com').
&gt; &gt;
&gt; &gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; &gt; Developer Advocate
&gt; &gt; Basho Technologies, Inc.
&gt; &gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt; &gt;
&gt; &gt; On Oct 16, 2010, at 5:05 PM, Alexander Sicular wrote:
&gt; &gt;
&gt; &gt;&gt; This has come up before. &quot;Leave&quot; is what is currently available and
&gt; &gt;&gt; needs to be run on the node that wants to leave. This, of course,
&gt; &gt;&gt; means the node needs to be available. What you really want is a kick
&gt; &gt;&gt; like &quot;remove&quot; or something that doesn't exist yet, afaik. I think
&gt; &gt;&gt; there is a ticket open.
&gt; &gt;&gt;
&gt; &gt;&gt; -alexander
&gt; &gt;&gt;
&gt; &gt;&gt; On 2010-10-16, Jesse Newland &lt;je...@railsmachine.com&gt; wrote:
&gt; &gt;&gt;&gt; The description of leave on the wiki mentions that it &quot;causes the node
&gt; to
&gt; &gt;&gt;&gt; leave the cluster it participates in&quot; - I assume &quot;the node&quot; refers to
&gt; the
&gt; &gt;&gt;&gt; node this command is run on? How would I &quot;leave&quot; a node that I can't
&gt; run
&gt; &gt;&gt;&gt; this command on anymore?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Regards -
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Jesse Newland
&gt; &gt;&gt;&gt; ---
&gt; &gt;&gt;&gt; je...@railsmachine.com
&gt; &gt;&gt;&gt; 404.216.1093
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; On Oct 16, 2010, at 3:16 PM, Sean Cribbs wrote:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; `leave` is exactly what you want to do then.  Once the old node has
&gt; left
&gt; &gt;&gt;&gt;&gt; (use `ringready` to track its exit), add the new neode.
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; If the EBS volume containing the node's data was not lost, you could
&gt; mount
&gt; &gt;&gt;&gt;&gt; it onto the new node to save some recovery time, and then reip.
&gt;  However,
&gt; &gt;&gt;&gt;&gt; you'll need to reip on all machines.
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; &gt;&gt;&gt;&gt; Developer Advocate
&gt; &gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt; &gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; On Oct 16, 2010, at 2:54 PM, Jesse Newland wrote:
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; I'm running through some disaster scenarios before bringing a riak
&gt; &gt;&gt;&gt;&gt;&gt; cluster into production, and have run into a scenario that I can't
&gt; work
&gt; &gt;&gt;&gt;&gt;&gt; through the proper resolution for just yet:
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; Say an ec2 instance that was a part of a ring went away quickly, and
&gt; data
&gt; &gt;&gt;&gt;&gt;&gt; from it was unrecoverable.
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; How might I go about telling the rest of the ring that a new instance
&gt; &gt;&gt;&gt;&gt;&gt; that I've brought up should take over the vnodes that were on that
&gt; old
&gt; &gt;&gt;&gt;&gt;&gt; instance? This sounds like a job for `riak-admin reip`, but after
&gt; running
&gt; &gt;&gt;&gt;&gt;&gt; `reip downed_node new_node`, `riak-admin ringready` still shows that
&gt; the
&gt; &gt;&gt;&gt;&gt;&gt; old nodes are a part of the ring and down. I guess what I'd like to
&gt; do is
&gt; &gt;&gt;&gt;&gt;&gt; a posthumeous `leave`?
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; Thoughts?
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; Regards -
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; Jesse Newland
&gt; &gt;&gt;&gt;&gt;&gt; ---
&gt; &gt;&gt;&gt;&gt;&gt; je...@railsmachine.com
&gt; &gt;&gt;&gt;&gt;&gt; 404.216.1093
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; _______________________________________________
&gt; &gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt; &gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; --
&gt; &gt;&gt; Sent from my mobile device
&gt; &gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01316.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01317">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01317">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01318.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01311.html">have a new node take over the role of a downed, unrecove...</a></span> <span class="sender italic">Jesse Newland</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01312.html">Re: have a new node take over the role of a downed,...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01313.html">Re: have a new node take over the role of a dow...</a></span> <span class="sender italic">Jesse Newland</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01314.html">Re: have a new node take over the role of a...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01315.html">Re: have a new node take over the role ...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01316.html">Re: have a new node take over the ...</a></span> <span class="sender italic">Jesse Newland</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: have a new node take over ...</span> <span class="sender italic">Leonid Riaboshtan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01318.html">Re: have a new node take o...</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: have a new node take over the role of a downed,	unrecoverable node?">
<input type="hidden" name="msgid" value="AANLkTimVuYEPMSG43hXqH28sp=SmQ6SCBdnV9n4-iztP@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01317.html">
<input type="submit" value=" Leonid Riaboshtan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+have+a+new+node+take+over+the+role+of+a+downed%2C%09unrecoverable+node%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01316.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01318.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTimVuYEPMSG43hXqH28sp=SmQ6SCBdnV9n4-iztP@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
