<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: High volume data series storage and queries</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04266" id="c">
<link rel="index" href="maillist.html#04266" id="i">
<link rel="prev" href="msg04260.html" id="p">
<link rel="next" href="msg04304.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04266.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+volume+data+series+storage+and+queries%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: High volume data series storage and queries</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Paul+O%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Paul O</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110808" rel="nofollow">Mon, 08 Aug 2011 18:17:24 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I sent this earlier to Ciprian without cc-ing the list.
---
Hi Ciprian,

Regarding the write penalty for batches, I plan to have a pre-write cache
(hence the query step will also have to include a step for this
verification, but I'm expecting the pre-cache volume to be small so I'd
consider a RDBMs for it.)</pre><pre>

As I wrote in my clarifications for Jeremiah, I'm expecting lots of data
even per source, that's why I'd like to take advantage of the data kind and
limit the queries to avoid having to go through all values even those of a
single source.

Think about multiple readers and writers at the same time and I thought (but
am not sure) that storing opaque batches would be the most predictable and
would allow the data store to grow relatively linearly (this is where Riak
should help :-)

The strategy you're suggesting would eliminate the need for the intermediary
index, am I understanding this correctly?

Anyway, I still have to think about your suggestions, using Riak-core and
then storing the individual data files in an embedded DB is a neat idea and
might allow more flexibility later (operations across all batches, etc.)

Regards,

Paul

On Mon, Aug 8, 2011 at 3:34 PM, Ciprian Dorin Craciun &lt;
ciprian.crac...@gmail.com&gt; wrote:

&gt; On Mon, Aug 8, 2011 at 21:21, Paul O &lt;pco...@gmail.com&gt; wrote:
&gt; &gt; Hello Riak enthusiasts,
&gt; &gt; I am trying to design a solution for storing time series data coming from
&gt; a
&gt; &gt; very large number of potential high-frequency sources.
&gt; &gt; I thought Riak could be of help, though based on what I read about it I
&gt; &gt; can't use it without some other layer on top of it.
&gt; &gt; The problem is I need to be able to do range queries over this data, by
&gt; the
&gt; &gt; source. Hence, I want to be able to say &quot;give me the N first data points
&gt; for
&gt; &gt; source S between time T1 and time T2.&quot;
&gt; &gt; I need to store this data for a rather long time, and the expected volume
&gt; &gt; should grow more than what a &quot;vanilla&quot; RDBMS would support.
&gt; &gt; Another thing to note is that I can restrict the number of data points to
&gt; be
&gt; &gt; returned by a query, so no query would return more than MaxN data points.
&gt; &gt; I thought about doing this the following way:
&gt; &gt; 1. bundle date time series in batches of MaxN, to ensure that any query
&gt; &gt; would require reading at most two batches. The batches would be store
&gt; inside
&gt; &gt; Riak.
&gt; &gt; 2. Store the start-time, end-time, size and Riak batch ID in a MySQL (or
&gt; &gt; PostgreSQL) DB.
&gt; &gt; My thinking is such a strategy would allow me to persist data in Riak and
&gt; &gt; linearly grow with the data, and the index would be kept in a RDBM for
&gt; fast
&gt; &gt; range queries.
&gt; &gt; Does it sound sensible to use Riak this way? Does this make you
&gt; &gt; laugh/cry/shake your head in disbelief? Am I overlooking something from
&gt; Riak
&gt; &gt; which would make all this much better?
&gt; &gt; Thanks and best regards,
&gt; &gt; Paul
&gt;
&gt;     Hello all!
&gt;
&gt;    (Disclaimer: I'm not a Riak-KV user per-se, but I've built
&gt; something on-top of Riak-Core. Also the solution I'm proposing is not
&gt; just something &quot;on-top&quot; of Riak-KV, but ontop of Riak-Core.)
&gt;    (Context: Some time ago we had a similar problem in a project of
&gt; ours: store time-series of power consumption from a lot of devices.
&gt; The current solution is using Informix, but this is out of scope.)
&gt;
&gt;    First I would say that storing data in batches will have a high
&gt; penalty on writes -- and such an application I guess is write
&gt; intensive. (As I know there is no support for appending to values.
&gt; Or?)
&gt;
&gt;    Now because you have a &quot;very large number of sources&quot; means that
&gt; you could do -- on top of Riak-Core the following:
&gt;    * take the identifier of your data source and hash it -- just like
&gt; Riak-KV does with a key -- and use this as the key for Riak-Core;
&gt;    * build a Vnode module that handles writes and queries, and which
&gt; stores the data in either:
&gt;        * RRDtool -- one data-file per data-source;
&gt;        * or an embedded database allowing sorted data-sets; (we've
&gt; had some very nice experiments with BerkeleyDB;) just use as key the
&gt; concatenation from the source key and the timestamp, and being careful
&gt; to have the resulting key correctly sorted lexicographically (i.e.
&gt; keep the key and timestamp at fixed length (maybe padded) and
&gt; big-endian encoded);
&gt;    * all that remains to be solved is data-replication -- similar to
&gt; how Riak handles it;
&gt;
&gt;    Thinking a little bit about it, you could actually do also this:
&gt;    * Riak-KV uses 160bits for keys, thus you could &quot;partition&quot; this
&gt; key in two parts: &quot;sensor-key&quot; | &quot;timestamp&quot;; for example 96 bits for
&gt; sensor, and 64 bits for timestamp;
&gt;    * implement the riak_kv_backend module ontop of such an embedded
&gt; database as described above (i.e. BerkeleyDB, or LevelDB);
&gt;    * when storing and querying data you'll still need to bypass the
&gt; Riak-KV normal key hashing;
&gt;    * you'll have replication and balancing for free;
&gt;
&gt;    Ciprian.
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04260.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04266">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04266">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04304.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04281.html">Re: High volume data series st...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04282.html">Re: High volume data serie...</a></span> <span class="sender italic">Les Mikesell</span></li>
<li class="icons-email"><span class="subject"><a href="msg04283.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg04284.html">Re: High volume data serie...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg04311.html">Re: High volume data serie...</a></span> <span class="sender italic">Paul O</span></li>
<li class="icons-email"><span class="subject"><a href="msg04315.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg04316.html">Re: High volume data serie...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li class="icons-email"><span class="subject"><a href="msg04318.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04310.html">Re: High volume data series st...</a></span> <span class="sender italic">Paul O</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04260.html">Re: High volume data series storage and queries</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: High volume data series storage and queries</span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04304.html">Re: High volume data series storage and que...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04313.html">Re: High volume data series storage and...</a></span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04314.html">Re: High volume data series storage...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04317.html">Re: High volume data series st...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04320.html">Re: High volume data serie...</a></span> <span class="sender italic">Ciprian Dorin Craciun</span></li>
<li class="icons-email"><span class="subject"><a href="msg04321.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04345.html">Re: High volume data series st...</a></span> <span class="sender italic">Paul O</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04348.html">Re: High volume data serie...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: High volume data series storage and queries">
<input type="hidden" name="msgid" value="CAA9t2LqXdmGGFzxwfk4sqWmTyqCtwVT3Jj-oqzQjOTsix5V+GA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04266.html">
<input type="submit" value=" Paul O ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+High+volume+data+series+storage+and+queries%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04260.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04304.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAA9t2LqXdmGGFzxwfk4sqWmTyqCtwVT3Jj-oqzQjOTsix5V+GA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
