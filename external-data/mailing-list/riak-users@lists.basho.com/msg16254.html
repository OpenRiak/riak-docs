<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Strong consistency only for missing keys?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16254" id="c">
<link rel="index" href="maillist.html#16254" id="i">
<link rel="prev" href="msg16253.html" id="p">
<link rel="next" href="#" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16254.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strong+consistency+only+for+missing+keys%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Strong consistency only for missing keys?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sargun+Dhillon%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sargun Dhillon</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150619" rel="nofollow">Fri, 19 Jun 2015 02:51:13 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I doesn't actually sound like you need strong consistency at all.
Strong consistency can be set at a bucket-type level, and will get you
what you want, but it may be too heavy handed.</pre><pre>

It sounds like the token should be written to Riak and you should be
getting a durable ack from Riak before ever granting the client to the
session. Given this, the &quot;tunable CAP&quot; controls in Riak may help you.

There is more on this here in these blog posts:
<a  rel="nofollow" href="http://basho.com/posts/technical/understanding-riaks-configurable-behaviors-part-1/">http://basho.com/posts/technical/understanding-riaks-configurable-behaviors-part-1/</a>
<a  rel="nofollow" href="http://basho.com/posts/technical/riaks-config-behaviors-part-2/">http://basho.com/posts/technical/riaks-config-behaviors-part-2/</a>
<a  rel="nofollow" href="http://basho.com/posts/technical/riaks-config-behaviors-part-3/">http://basho.com/posts/technical/riaks-config-behaviors-part-3/</a>
<a  rel="nofollow" href="http://basho.com/posts/technical/riaks-config-behaviors-part-4/">http://basho.com/posts/technical/riaks-config-behaviors-part-4/</a>
and this doc:
<a  rel="nofollow" href="http://docs.basho.com/riak/2.0.0/dev/advanced/cap-controls/">http://docs.basho.com/riak/2.0.0/dev/advanced/cap-controls/</a>

You probably want to do:
n=3
pw=quorum
pr=quorum
notfound_ok=false
----

I might argue that this might be too heavy-handed, but I recommend
reading the above posts for a better understanding of the consistency,
and availability guarantees Riak can provide. At the end of the day,
you're trading off (availability, performance) vs. consistency.

On Fri, Jun 19, 2015 at 12:48 AM, Cosmin Marginean &lt;cosmin...@gmail.com&gt; wrote:
&gt; Hi Ilya
&gt;
&gt; Read “quorum” is unusual and a bit against the idea of distributed DB, but I
&gt; believe what you might find useful is enabling strong consistency, which you
&gt; can then chose to apply at a bucket(type) level:
&gt; * <a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/advanced/strong-consistency/">http://docs.basho.com/riak/latest/dev/advanced/strong-consistency/</a>
&gt;
&gt; One of the reasons we chose Riak is precisely the fact that you can silo
&gt; your data into “consistent” and “available” within the same cluster. An
&gt; important thing to remember is that with strong consistency enabled you will
&gt; need a minimum of 3 nodes (yes, for your dev environment too), otherwise
&gt; writes to strong-consistent buckets will fail.
&gt;
&gt; Another relevant note here about strong consistency in Riak (and distributed
&gt; DB in general): is not so much about the performance impact, but more about
&gt; sacrificing availability to achieve this.
&gt; (The C vs A in the CAP theorem, if we are to oversimplify this)
&gt;
&gt; Regards
&gt; Cos
&gt;
&gt; On Friday, 19 June 2015 at 01:12, Ilya Kutukov wrote:
&gt;
&gt; Hi!
&gt;
&gt; I am planning to maintain session storage over Riak KV.
&gt;
&gt; Core case: when user is signing in to the service session token with some
&gt; meta is returning to the client and then saving for further usage. At the
&gt; back-end side this session key is placing to the session storage.
&gt;
&gt; Riak could response false &quot;not found&quot; when user is providing client-side
&gt; token on next request, what following instantly after the session record is
&gt; placed to Riak.
&gt;
&gt; From the end-user POV you log in, than you surprisingly not logged in, then
&gt; you are refreshing/restarting client and everything is back to normal. Bad
&gt; glitchy case.
&gt;
&gt; Riak have typical distributed DB problems when you are reading after write
&gt; instantly. Also there is a high consistency mode with performance
&gt; trade-offs.
&gt;
&gt; Is it possible to configure or modify Riak cluster to act hybrid way:
&gt;
&gt; Normally cluster is working in HA mode. E.g. on secondary index searches,
&gt; updates, deletions of the existing keys.
&gt;
&gt; But when you are directly asking for the key that seems to be missing the
&gt; full quorum is required to claim that there is really no such key on all
&gt; nodes in according partition to say &quot;No&quot;. Any other case is &quot;Yes&quot; after long
&gt; or a short delay.
&gt; In theory, such behaviour will make deletion of keys slower, but situation
&gt; with false &quot;not found&quot; will be better.
&gt;
&gt; Or i'm missing some obvious way to resolve read-after-write problem like
&gt; proxying requests to the session storage through the single instance 3-rd
&gt; party cache?
&gt;
&gt;
&gt; --
&gt; Best regards,
&gt; Ilya Kutukov
&gt;
&gt; +7 962 909 10 35
&gt; post.i...@gmail.com
&gt; skype: blinkedeye
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16253.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16254">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16254">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright buttondisabled" accesskey="n" href="#">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16252.html">Strong consistency only for missing keys?</a></span> <span class="sender italic">Ilya Kutukov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16253.html">Re: Strong consistency only for missing keys?</a></span> <span class="sender italic">Cosmin Marginean</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Strong consistency only for missing keys?</span> <span class="sender italic">Sargun Dhillon</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Strong consistency only for missing keys?">
<input type="hidden" name="msgid" value="CAMp4zn-dX1oUcYVJf1kTNjT3Fk8aCwXx09eBPwk_FnpHGBEjYQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16254.html">
<input type="submit" value=" Sargun Dhillon ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Strong+consistency+only+for+missing+keys%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16253.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="#" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAMp4zn-dX1oUcYVJf1kTNjT3Fk8aCwXx09eBPwk_FnpHGBEjYQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
