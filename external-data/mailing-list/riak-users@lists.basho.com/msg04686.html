<!DOCTYPE html>
<html lang="en">
<head>
<title>Streaming video from Luwak to browsers not working so well</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04686" id="c">
<link rel="index" href="maillist.html#04686" id="i">
<link rel="prev" href="msg04683.html" id="p">
<link rel="next" href="msg04687.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04686.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Streaming+video+from+Luwak+to+browsers+not+working+so+well%22&amp;o=newest" rel="nofollow"><span itemprop="name">Streaming video from Luwak to browsers not working so well</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22John+Axel+Eriksson%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">John Axel Eriksson</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110913" rel="nofollow">Tue, 13 Sep 2011 13:04:16 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>First a little background:

We've been putting videos in luwak without much trouble for quite a while now, 
small and a little bigger (by bigger I mean around 6 or 7 megs).</pre><pre>

To stream these so far, we've basically done this:

Get the web app to download the video over http from luwak and store on local 
disk.
Get nginx, through an x-accel, to actually send it to the client (i.e the 
browser).

For various reasons this isn't really how we want to do it. There is one big 
reason why we do this currently. We need all clients to authenticate through
our rails-app. So we first tried to have rails send an x-accel to nginx which 
would then proxy to luwak. This won't work because nginx doesn't support
http 1.1, chunked encoding and all that jazz to backends at least (it's 2011… 
why I just don't know).

Anyway, for a while now we've thrown node.js into the mix(for other reasons) 
and recently I started working on some code for node.js to recognize
x-sendfile (similar to x-accel). I also made it do the same type of proxying as 
nginx can do - but this time it does http 1.1. Unfortunately I couldn't get it
to work. So I started investigating riak/luwak directly. Could we even stream a 
video out of luwak directly? No we couldn't. So the problem goes all the
way back to riak.

Using Safari it won't stream more than a few seconds and then sound and video 
stops (though the progress bar keeps moving).
Using Chrome and Firefox I could stream perhaps half the video before more or 
less the same thing happened.

I then cloned riak and removed one line in deps/luwak/src/luwak_wm_file.erl, 
specifically line 363 -      {&quot;gzip&quot;, fun(X) -&gt; zlib:gzip(X) end}]. So that the 
list
now only contains [{&quot;identity&quot;, fun(X) -&gt; X end}]. (Those are the 
default_encodings). I will admit I didn't know exactly what I was doing.

Built riak and did some more testing. The results were interesting. Suddenly 
Chrome and Firefox would play the whole file through (a .webm).
Unfortunately Safari still did the same thing, i.e played 4 seconds and then 
stopped video and sound (while still showing progress).

I didn't try IE and quite frankly I'm afraid that one might just blow up my 
computer…

Anyway, I just wanted to ask the list if anyone ever tried the same thing or if 
any of the good people at basho knows more than I do (which I suspect
they do :-).


Thanks,
John
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04683.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04686">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04686">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04687.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Streaming video from Luwak to browsers not working so w...</span> <span class="sender italic">John Axel Eriksson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04687.html">Re: Streaming video from Luwak to browsers not wor...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04689.html">Re: Streaming video from Luwak to browsers not...</a></span> <span class="sender italic">John Axel Eriksson</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Streaming video from Luwak to browsers not working so well">
<input type="hidden" name="msgid" value="179E2390-ADAC-4DAC-8A11-32277A7FDC8A@insane.se">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04686.html">
<input type="submit" value=" John Axel Eriksson ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Streaming+video+from+Luwak+to+browsers+not+working+so+well%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04683.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04687.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">179E2390-ADAC-4DAC-8A11-32277A7FDC8A@insane.se</li>
</ul>
</div>
</body>
</html>
