<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Practical Riak cluster choices in AWS (number of nodes? AZ's?)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd11.html#11974" id="c">
<link rel="index" href="mail12.html#11974" id="i">
<link rel="prev" href="msg11973.html" id="p">
<link rel="next" href="msg11980.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg11974.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Practical+Riak+cluster+choices+in+AWS+%5C%28number+of+nodes%5C%3F+AZ%27s%5C%3F%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Practical Riak cluster choices in AWS (number of nodes? AZ's?)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jared+Morrow%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jared Morrow</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130811" rel="nofollow">Sun, 11 Aug 2013 17:59:16 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>+1 to what Jeremiah said, putting a 4 or 5 node cluster in each US West and
US East using MDC between them would be the optimum solution.  I'm also not
buying consistent latencies between AZ's, but I've also not tested it
personally in a production environment.  We have many riak-users members on
AWS, so hopefully more experienced people will chime in.</pre><pre>

If you haven't seen them already, here's what I have in my &quot;Riak on AWS&quot;
bookmark folder:

<a  rel="nofollow" href="http://media.amazonwebservices.com/AWS_NoSQL_Riak.pdf">http://media.amazonwebservices.com/AWS_NoSQL_Riak.pdf</a>
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/tuning/aws/">http://docs.basho.com/riak/latest/ops/tuning/aws/</a>
<a  rel="nofollow" href="http://basho.com/riak-on-aws-deployment-options/">http://basho.com/riak-on-aws-deployment-options/</a>

-Jared




On Sun, Aug 11, 2013 at 6:11 PM, Jeremiah Peschka &lt;
jeremiah.pesc...@gmail.com&gt; wrote:

&gt; I'd be wary of using EBS backed nodes for Riak - with only a single
&gt; ethernet connection, it wil be very easy to saturate the max of 1000mbps
&gt; available in a single AWS NIC (unless you're using cluster compute
&gt; instances). I'd be more worried about temporarily losing contact with a
&gt; node through network saturation than through AZ failure, truthfully.
&gt;
&gt; The beauty of Riak is that a node can drop and you can replace it with
&gt; minimal fuss. Use that to your advantage and make every node in the cluster
&gt; disposable.
&gt;
&gt; As far as doubling up in one AZ goes - if you're worried about AZ failure,
&gt; you should treat each AZ as a separate data center and design your failure
&gt; scenarios accordingly. Yes, Amazon say you should put one Riak node in each
&gt; AZ; I'm not buying that. With no guarantee around latency, and no control
&gt; around between DCs, you need to be very careful how much of that latency
&gt; you're willing to introduce into your application.
&gt;
&gt; Were I in your position, I'd stand up a 5 node cluster in US-WEST-2 and be
&gt; done with it. I'd consider Riak EE for my HA/DR solution once the business
&gt; decides that off-site HA/DR is something it wants/needs.
&gt;
&gt;
&gt; ---
&gt; Jeremiah Peschka - Founder, Brent Ozar Unlimited
&gt; MCITP: SQL Server 2008, MVP
&gt; Cloudera Certified Developer for Apache Hadoop
&gt;
&gt;
&gt; On Sun, Aug 11, 2013 at 1:52 PM, Brady Wetherington 
&gt; &lt;br...@bespincorp.com&gt;wrote:
&gt;
&gt;&gt; Hi all -
&gt;&gt;
&gt;&gt; I have some questions about how I want my Riak stuff to work - I've
&gt;&gt; already asked these questions of some Basho people and gotten some answers,
&gt;&gt; but thought I would toss it out into the wider world to see what you all
&gt;&gt; have to say, too:
&gt;&gt;
&gt;&gt; First off - I know 5 instances is the &quot;magic number&quot; of instances to
&gt;&gt; have. If I understand the thinking here, it's that at the default
&gt;&gt; redundancy level ('n'?) of 3, it is most likely to start getting me some
&gt;&gt; scaling (e.g., performance &gt; just that of a single node), and yet also have
&gt;&gt; redundancy; whereby I can lose one box and not start to take a performance
&gt;&gt; hit.
&gt;&gt;
&gt;&gt; My question is - I think I can only do 4 in a way that makes sense. I
&gt;&gt; only have 4 AZ's that I can use right now; AWS won't let me boot instances
&gt;&gt; in 1a. My concern is if I try to do 5, I will be &quot;doubling up&quot; in one AZ -
&gt;&gt; and in AWS you're almost as likely to lose an entire AZ as you are a single
&gt;&gt; instance. And so, if I have instances doubled-up in one AZ (let's say
&gt;&gt; us-east-1e), and then I lose 1e, I've now lost two instances. What are the
&gt;&gt; chances that all three of my replicas of some chunk of my data are on those
&gt;&gt; two instances? I know that it's not guaranteed that all replicas are on
&gt;&gt; separate nodes.
&gt;&gt;
&gt;&gt; So is it better for me to ignore the recommendation of 5 nodes, and just
&gt;&gt; do 4? Or to ignore the fact that I might be doubling-up in one AZ? Also,
&gt;&gt; another note. These are designed to be 'durable' nodes, so if one should go
&gt;&gt; down I would expect to bring it back up *with* its data - or, if I
&gt;&gt; couldn't, I would do a force-replace or replace and rebuild it from the
&gt;&gt; other replicas. I'm definitely not doing instance-store. So I don't know if
&gt;&gt; that mitigates my need for a full 5 nodes. I would also consider losing one
&gt;&gt; node to be &quot;degraded&quot; and would probably seek to fix that problem as soon
&gt;&gt; as possible, so I wouldn't expect to be in that situation for long. I would
&gt;&gt; probably tolerate a drop in performance during that time, too. (Not a
&gt;&gt; super-severe one, but 20-30 percent? Sure.)
&gt;&gt;
&gt;&gt; What do you folks think?
&gt;&gt;
&gt;&gt; -B.
&gt;&gt;
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
&gt;&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg11973.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd11.html#11974">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail12.html#11974">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg11980.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg11969.html">Practical Riak cluster choices in AWS (number of nodes?...</a></span> <span class="sender italic">Brady Wetherington</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11973.html">Re: Practical Riak cluster choices in AWS (number ...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Practical Riak cluster choices in AWS (num...</span> <span class="sender italic">Jared Morrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11980.html">Re: Practical Riak cluster choices in AWS ...</a></span> <span class="sender italic">Dave Martorana</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg11981.html">Re: Practical Riak cluster choices in ...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg11982.html">Re: Practical Riak cluster choices in ...</a></span> <span class="sender italic">Hector Castro</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12012.html">Re: Practical Riak cluster choices in AWS (number ...</a></span> <span class="sender italic">John Eikenberry</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12015.html">Re: Practical Riak cluster choices in AWS (num...</a></span> <span class="sender italic">Brady Wetherington</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12017.html">Re: Practical Riak cluster choices in AWS ...</a></span> <span class="sender italic">Matthew Dawson</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg11984.html">Re: Practical Riak cluster choices in AWS (number ...</a></span> <span class="sender italic">Brady Wetherington</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12009.html">Re: Practical Riak cluster choices in AWS (num...</a></span> <span class="sender italic">Dave Martorana</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12010.html">Re: Practical Riak cluster choices in AWS ...</a></span> <span class="sender italic">Brady Wetherington</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Practical Riak cluster choices in AWS (number of nodes? AZ's?)">
<input type="hidden" name="msgid" value="CACUSOveLPu8yfciVYkexM9ZtKHq-kdnowk1AFvpfLCSiP2HGKw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg11974.html">
<input type="submit" value=" Jared Morrow ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Practical+Riak+cluster+choices+in+AWS+%5C%28number+of+nodes%5C%3F+AZ%27s%5C%3F%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg11973.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg11980.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACUSOveLPu8yfciVYkexM9ZtKHq-kdnowk1AFvpfLCSiP2HGKw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
