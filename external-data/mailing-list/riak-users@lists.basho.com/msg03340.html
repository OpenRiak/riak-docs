<!DOCTYPE html>
<html lang="en">
<head>
<title>Unexpected performance results with riak</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03340" id="c">
<link rel="index" href="maillist.html#03340" id="i">
<link rel="prev" href="msg03336.html" id="p">
<link rel="next" href="msg03341.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03340.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Unexpected+performance+results+with+riak%22&amp;o=newest" rel="nofollow"><span itemprop="name">Unexpected performance results with riak</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Max%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Max</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110515" rel="nofollow">Sun, 15 May 2011 08:07:19 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>In the last days I played a bit with riak. The initial setup was
easier then I thought. Now I have a 3 node cluster, all nodes running
on the same vm for the sake of testing.</pre><pre>

I admit, the hardware settings of my virtual machine are very much
downgraded (1 CPU, 512 MB RAM) but still I am a quite surprised by the
slow performance of riak.

- Map Reduce

Playing a bit with map reduce I had around 2000 objects in one bucket,
each about 1k - 2k in size as json. I used this map function:

function(value, keyData, arg) {
    var data = Riak.mapValuesJson(value)[0];

    if (data.displayname.indexOf(&quot;max&quot;) !== -1) return [data];
    return [];
}

And it took over 2 seconds just for performing the http request
returning its result, not counting the time it took in my client code
to deserialze the results from json. Removing 2 of 3 nodes seemed to
slightly improve the performance to just below 2 seconds, but this
still seems really slow to me.

Is this to be expected? The objects were not that large in bytesize
and 2000 objects in one bucket isnt that much, either.

- Insert

Batch inserting of around 60.000 objects in the same size as above
took rather long and actually didnt really work.

My script which inserted the objects in riak died at around 40.000 or
so and said it couldnt connect to the riak node anymore. In the riak
logs I found an error message which indicated that the node ran out of
memory and died.

- Question

This is really my first shot at riak, so there is definately the
chance that I screwed something up.

    Are there any settings I could tweak?
    Are the hardware settings too constrained?
    Maybe the PHP client library I used for interacting with riak is
the limiting factor here?
    Running all nodes on the same physical machine is rather stupid,
but if this is a problem - how can i better test the performance of
riak?
    Is map reduce really that slow? I read about the performance hit
that map reduce has on the riak mailing list, but if Map Reduce is
slow, how are you supposed to perform &quot;queries&quot; for data needed nearly
in realtime? I know that riak is not as fast as redis.

It would really help me a lot if anyone with more experience in riak
could help me out with some of these questions.

I posted this as a question on stackoverflow, but it was suggested to
rather ask on this mailing list, I guess thats true as it is more
likely that I could get an answer here. I am really eager to learn
more about riak and how I can use it correctly to get the best results
out of it.

Thank you very much for any help in advance!

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03336.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03340">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03340">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03341.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Unexpected performance results with riak</span> <span class="sender italic">Max</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg03341.html">Re: Unexpected performance results with riak</a></span> <span class="sender italic">Sean Cribbs</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Unexpected performance results with riak">
<input type="hidden" name="msgid" value="BANLkTi=6UDQxecVCkw8M4LUNJcDK+7C2=A@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03340.html">
<input type="submit" value=" Max ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Unexpected+performance+results+with+riak%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03336.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03341.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">BANLkTi=6UDQxecVCkw8M4LUNJcDK+7C2=A@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
