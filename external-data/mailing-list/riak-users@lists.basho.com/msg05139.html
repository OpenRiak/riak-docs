<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Basho Bench HTTP Inserts Causing Innostore Crashes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05139" id="c">
<link rel="index" href="maillist.html#05139" id="i">
<link rel="prev" href="msg05137.html" id="p">
<link rel="next" href="msg05141.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05139.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Basho+Bench+HTTP+Inserts+Causing+Innostore+Crashes%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Basho Bench HTTP Inserts Causing Innostore Crashes</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Kelly+McLaughlin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Kelly McLaughlin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111012" rel="nofollow">Wed, 12 Oct 2011 10:51:59 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Brian,

I've reproduced your problem. From the initial review, it looks like there is 
an issue with basho_bench and the way it assembles URLs. There also appears to 
be a small problem with Innostore and key creation. We'll be investigating 
these more and opening some bugzilla issues for them soon. I'll send an update 
with links to those issues at that time so you can track the progress on them. 
Thanks for the report!</pre><pre>

Kelly


On Oct 12, 2011, at 9:49 AM, Brian Bickerton wrote:

&gt; Riak version: 1.0.0
&gt; Backend: InnoStore 1.0.3.1
&gt; 4-node cluster
&gt; 
&gt; I've gotten http basho bench to run successfully with the Bitcask and LevelDB 
&gt; backends, but I'm having trouble with Innostore. I get no throughput and all 
&gt; errors. The logs show children crashing due to a &quot;bad argument in call to 
&gt; erlang:size(undefined)&quot;. Basic inserts from curl work and I was able to 
&gt; install rekon, which leads me to believe it's an issue with the bench testing 
&gt; itself. Rate and concurrency don't appear to matter. 
&gt; 
&gt; Error log snip:
&gt; 
&gt; 2011-10-12 15:28:49.060 [error] &lt;0.4751.1&gt; gen_fsm &lt;0.4751.1&gt; in state active 
&gt; terminated with reason: bad argument in call to erlang:size(undefined) in 
&gt; innostore:get/2
&gt; 2011-10-12 15:28:49.061 [error] &lt;0.4751.1&gt; CRASH REPORT Process &lt;0.4751.1&gt; 
&gt; with 0 neighbours crashed with reason: bad argument in call to 
&gt; erlang:size(undefined) in innostore:get/2
&gt; 2011-10-12 15:28:49.061 [error] &lt;0.95.0&gt; Supervisor riak_core_vnode_sup had 
&gt; child undefined started with {riak_core_vnode,start_link,undefined} at 
&gt; &lt;0.4751.1&gt; exit with reason bad argument in call to erlang:size(undefined) in 
&gt; innostore:get/2 in context child_terminated
&gt; 
&gt; Crash Log snip:
&gt; 
&gt; 2011-10-12 15:28:43 =CRASH REPORT====
&gt;   crasher:
&gt;     initial call: riak_core_vnode:init/1
&gt;     pid: &lt;0.4734.1&gt;
&gt;     registered_name: []
&gt;     exception exit: 
&gt; {badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak_kv_innostore_backend,get,3},{riak_kv_vnode,do_get_term,3},{riak_kv_vnode,do_get,4},{riak_core_vnode,vnode_command,3},{gen_fsm,handle_msg,7},{proc_lib,init_p_do_apply,3}]}
&gt;       in function  gen_fsm:terminate/7
&gt;       in call from proc_lib:init_p_do_apply/3
&gt;     ancestors: [riak_core_vnode_sup,riak_core_sup,&lt;0.91.0&gt;]
&gt;     messages: [{'EXIT',&lt;0.4736.1&gt;,shutdown},{'EXIT',#Port&lt;0.14591&gt;,normal}]
&gt;     links: [&lt;0.95.0&gt;]
&gt;     dictionary: 
&gt; [{{innostore,{store,#Port&lt;0.14591&gt;,&lt;&lt;105,0,0,0,0,0,0,0&gt;&gt;,0}},{store,#Port&lt;0.14591&gt;,&lt;&lt;105,0,0,0,0,0,0,0&gt;&gt;,0}}]
&gt;     trap_exit: true
&gt;     status: running
&gt;     heap_size: 610
&gt;     stack_size: 24
&gt;     reductions: 3941
&gt;   neighbours:
&gt; 2011-10-12 15:28:43 =SUPERVISOR REPORT====
&gt;      Supervisor: {local,riak_core_vnode_sup}
&gt;      Context:    child_terminated
&gt;      Reason:     
&gt; {badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak_kv_innostore_backend,get,3},{riak_kv_vnode,do_get_term,3},{riak_kv_vnode,do_get,4},{riak_core_vnode,vnode_command,3},{gen_fsm,handle_msg,7},{proc_lib,init_p_do_apply,3}]}
&gt;      Offender:   
&gt; [{pid,&lt;0.4734.1&gt;},{name,undefined},{mfargs,{riak_core_vnode,start_link,undefined}},{restart_type,temporary},{shutdown,300000},{child_type,worker}]
&gt; 
&gt; Basho Bench config (worked with Bitcask and LevelDB):
&gt; 
&gt; {mode, max}
&gt; {duration, 300}.
&gt; {concurrent, 1000}.
&gt; {driver, basho_bench_driver_http_raw}.
&gt; {code_paths, [&quot;deps/ibrowse&quot;]}.
&gt; {http_raw_ips, [the, four, node, addresses]}.
&gt; {key_generator, {partitioned_sequential_int, 500000000}}.
&gt; {value_generator, {fixed_bin, 15}}.
&gt; {http_raw_port, 8098}.
&gt; {http_raw_path, &quot;/riak/holder&quot;}.
&gt; {operations, [{insert, 1}]}.
&gt; 
&gt; Any help would be greatly appreciated.
&gt; 
&gt; Brian Bickerton
&gt; Web Engineer
&gt; OmniTI Computer Consulting, Inc.
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05137.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05139">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05139">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05141.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05137.html">Basho Bench HTTP Inserts Causing Innostore Crashes</a></span> <span class="sender italic">Brian Bickerton</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Basho Bench HTTP Inserts Causing Innostore Crash...</span> <span class="sender italic">Kelly McLaughlin</span></li>
<li class="icons-email"><span class="subject"><a href="msg05141.html">Re: Basho Bench HTTP Inserts Causing Innostore Crash...</a></span> <span class="sender italic">Kelly McLaughlin</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Basho Bench HTTP Inserts Causing Innostore Crashes">
<input type="hidden" name="msgid" value="EE48123D-3B84-492A-A783-1C20CCF6F0A5@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05139.html">
<input type="submit" value=" Kelly McLaughlin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Basho+Bench+HTTP+Inserts+Causing+Innostore+Crashes%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05137.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05141.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">EE48123D-3B84-492A-A783-1C20CCF6F0A5@basho.com</li>
</ul>
</div>
</body>
</html>
