<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riak java client</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#05601" id="c">
<link rel="index" href="mail2.html#05601" id="i">
<link rel="prev" href="msg05600.html" id="p">
<link rel="next" href="msg05621.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05601.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak+java+client%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riak java client</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Russell+Brown%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Russell Brown</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111116" rel="nofollow">Wed, 16 Nov 2011 09:23:08 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
On 16 Nov 2011, at 16:13, sergey wrote:

&gt; Thanks Russell,
&gt; ok,
&gt; I useDefaultRiakClient ( userName = &quot;user1&quot;, userInfo = 
&gt; &quot;{&quot;email&quot;:&quot;em...@email.com&quot;,&quot;pass&quot;:&quot;123123&quot;}&quot; ):
&gt; riakObject = RiakObjectBuilder.newBuilder(&quot;users&quot;, 
&gt; userName).withContentType(&quot;application/json&quot;).withValue(userInfo).build
&gt; and store:
&gt; client.fetchBucket(&quot;users&quot;).execute.store(riakObject).execute
&gt; in result I have in store:
&gt; Content Type application/json;charset=UTF-8
&gt; but value as: 
&gt; {&quot;value&quot;:&quot;eyJlbWFpbCI6ImVtYWlsQGVtYWlsLmNvbSIsInBhc3MiOiIxMjMxMjMifQ==&quot;,&quot;lastModified&quot;:null,&quot;contentType&quot;:&quot;application/json;charset=utf-8&quot;,&quot;bucket&quot;:&quot;users&quot;,&quot;vtag&quot;:null,&quot;links&quot;:[],&quot;vclock&quot;:null,&quot;valueAsString&quot;:&quot;{\&quot;email\&quot;:\&quot;em...@email.com\&quot;,\&quot;pass\&quot;:\&quot;123123\&quot;}&quot;,&quot;vclockAsString&quot;:null,&quot;meta&quot;:{}}
&gt; 
&gt; how to make value just as {&quot;email&quot;:&quot;em...@email.com&quot;,&quot;pass&quot;:&quot;123123&quot;}?</pre><pre>

OK, long explanation below. You've uncovered a wart.

By default every store and fetch operation requires a Converter&lt;T&gt; to be 
present. And, to make life easy, by default, I provide the JSONConverter&lt;T&gt;, 
that converts the object it is given to JSON. This is a problem if you use the 
raw IRiakObject type since the whole thing gets serialised, rather than just 
the values. The fix, which I have, is to check the type, and if it is 
IRiakObject then don't use the converter. The longer term fix is to have a 
registry of converters mapped to types, but that is not done yet.

The problem really is that the higher level API expects you to store domain 
things, not lower level, Riak things.

I know this seems bad, but I wanted an API that gave a flexibility *and* pushed 
people towards using domain specific classes, since handling conflicts requires 
that. It does mean there is this slightly more verbose hoop to jump through 
when you want to use a plain IRiakObject from the higher level client API.

TL;DR 
Store a domain specific java object with two fields, `email` and `pass` OR 
provide a PassThroughConverter to the StoreOperation OR  if you are dealing 
directly with IRiakObject, use RawClient. I'm working on a silent solution that 
detects the IRiakObject type and does not convert it.

Does it make sense?

Cheers

Russell

&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05600.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#05601">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#05601">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05621.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05597.html">riak java client</a></span> <span class="sender italic">sergey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05598.html">Re: riak java client</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05600.html">Re: riak java client</a></span> <span class="sender italic">sergey</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: riak java client</span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05621.html">Re: riak java client</a></span> <span class="sender italic">sergey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05624.html">Re: riak java client</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05633.html">Re: riak java client</a></span> <span class="sender italic">sergey</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05635.html">Re: riak java client</a></span> <span class="sender italic">Russell Brown</span></li>
<li class="icons-email"><span class="subject"><a href="msg05639.html">Re: riak java client</a></span> <span class="sender italic">sergey</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05637.html">Re: riak java client</a></span> <span class="sender italic">sergey</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg05860.html">Riak Java Client</a></span> <span class="sender italic">Russell Brown</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riak java client">
<input type="hidden" name="msgid" value="C95B5CAA-04E6-420D-BE51-DA4593697922@me.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05601.html">
<input type="submit" value=" Russell Brown ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riak+java+client%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05600.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05621.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">C95B5CAA-04E6-420D-BE51-DA4593697922@me.com</li>
</ul>
</div>
</body>
</html>
