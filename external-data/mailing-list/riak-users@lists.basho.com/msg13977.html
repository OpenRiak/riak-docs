<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Proposal for chunked storage (related to Lowlevel Access to	RiakCS objects)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#13977" id="c">
<link rel="index" href="mail2.html#13977" id="i">
<link rel="prev" href="msg13956.html" id="p">
<link rel="next" href="msg13953.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13977.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Proposal+for+chunked+storage+%5C%28related+to+Lowlevel+Access+to%09RiakCS+objects%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Proposal for chunked storage (related to Lowlevel Access to	RiakCS objects)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Martin+Alpers%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Martin Alpers</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140402" rel="nofollow">Wed, 02 Apr 2014 13:15:39 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Since this is related to my earlier question: sorry to have let you wait, Timo.</pre><pre>

Kelly, the reason I brought up my original question was because my use case 
involves delivering videos under load.
Suppose there is a cluster of 50 nodes with a replication value of three. Now 
if a random node is queried for a file of say, 500MB. Then I would expect 30MB 
to be local, and 470MB (or 94%) to be retrieved from the cluster, assuming 
local data is used if available.
If this happens over and over again, you want caching. Trouble with video: 
users might skip parts, and those requests are nasty to most caches. If they 
are few, it is Ok to just not cache them, but otherwise, we might need a 
solution.
One approach is to have a proxy &quot;translate&quot; a range request into a series of 
Riak queries, each of which is small enough to be cached in &quot;no time&quot;, but not 
so small as to allow the overhead outgrowing the real data.

You are right that RiakCS does a fine job in what it does, but typical caches 
can only query it sequentially, which precludes caching of range requests on 
any object of relevant size.

Timo, of course you are somewhat reinventing the wheel, half the work you have 
to do is similar to how RiakCS stores files. However, since the other half 
cannot &quot;just use&quot; S3, I fail to see the alternative, apart from cancelling the 
project.
That said, I am not an expert in these matters, but your basic approach to big 
files looks sound to me.
I am curious about the use case of growing files. 
My first thought was that if I wanted to store logs in a database, I would 
prefer to store e.g. single lines as values, or rows in a relational database.

Best regards
Martin

On 14/03/31.09:30:1396254608, Kelly McLaughlin wrote:
&gt; Riak CS does store large files directly in Riak in a manner somewhat similar 
&gt; to what you describe and has the advantage that there are S3 libraries for 
&gt; most languages. You might want to look at it a little closer because this 
&gt; does sound like re-inventing of the wheel to me.
&gt; 
&gt; Kelly
&gt; 
&gt; 
&gt; On March 29, 2014 at 5:55:32 AM, Timo Gatsonides (t...@me.com) wrote:
&gt; 
&gt; 
&gt; Related to the recent thread about &quot;Lowlevel Access to RiakCS objects&quot; I plan 
&gt; to implement an extension to a Riak Object (in the Golang driver at 
&gt; <a  rel="nofollow" href="https://github.com/tpjg/goriakpbc">https://github.com/tpjg/goriakpbc</a>) that will cover two use cases:
&gt; 1) storing larger files directly in Riak (not Riak CS)
&gt; 2) store growing files, e.g. log files, efficiently in Riak
&gt; 
&gt; I have some questions for the Riak community. First: am I about to re-invent 
&gt; a wheel and if so can someone please point me to an example implementation?
&gt; 
&gt; If not I would like to know if there is more interest and maybe more use 
&gt; cases so we can develop a standard way to store these objects in Riak, 
&gt; allowing access from multiple programming languages. If there is, please read 
&gt; the proposal below and provide feedback.
&gt; 
&gt; Store the meta-information about a “BigObject” in a regular Riak value. This 
&gt; object will be stored in &lt;bucket&gt; , &lt;key&gt;. The object will have the following 
&gt; meta tags:
&gt; - segment_size - size of each segment in bytes
&gt; - segment_count - the number of segments of the object
&gt; - total_size - optional total size of the entire object (see below).
&gt; 
&gt; The objects data would be stored in segments in &lt;bucket&gt;, &lt;key-%06d&gt;. The 
&gt; Content-Type would be the same for all objects. Depending on the use case 
&gt; total_size could be filled.
&gt; 
&gt; Using the two use cases above as an example:
&gt; 1) storing large files, e.g. video: use a large segment_size, e.g. 1Mb and 
&gt; store the total_size since the file will be static and the meta-information 
&gt; can be written at once
&gt; 2) store growing files, e.g. daily log files: use a smaller segment_size, 
&gt; e.g. 10Kb-100Kb, do not store total_size as otherwise each “Append” operation 
&gt; would require two PUTs. If a segment grows beyond the segment_size update the 
&gt; meta-information K/V, otherwise only PUT the last segment again. In the 
&gt; extension to a client driver a BigObject would store some state information 
&gt; that keeps track of the meta-information K/V and the last segment to make the 
&gt; Append operation somewhat efficient - note though that each append is 
&gt; overwriting the last segment.
&gt; 
&gt; Any input is highly appreciated.
&gt; 
&gt; Kind regards,
&gt; Timo
&gt; 
&gt;  
&gt; 
&gt; _______________________________________________  
&gt; riak-users mailing list  
&gt; riak-users@lists.basho.com  
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>  

&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


-- 
Greetings, Martin Alpers

martin-alp...@web.de; Public Key ID: 10216CFB
Tel: +49 431/90885691; Mobile: +49 176/66185173
JID: martin.alp...@jabber.org
FYI: <a  rel="nofollow" href="http://apps.opendatacity.de/stasi-vs-nsa/">http://apps.opendatacity.de/stasi-vs-nsa/</a>
</pre>
<p><strong><a href="msg13977/signature.asc" ><img src="../attachment.png" alt="Attachment:" width=27 height=28></a>
<a href="msg13977/signature.asc" >signature.asc</a></strong><br>
<em>Description:</em> Digital signature</p>
<pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13956.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#13977">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#13977">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13953.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13951.html">Proposal for chunked storage (related to Lowlevel Access ...</a></span> <span class="sender italic">Timo Gatsonides</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13956.html">Re: Proposal for chunked storage (related to Lowleve...</a></span> <span class="sender italic">Kelly McLaughlin</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Proposal for chunked storage (related to Low...</span> <span class="sender italic">Martin Alpers</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Proposal for chunked storage (related to Lowlevel Access to	RiakCS objects)">
<input type="hidden" name="msgid" value="20140402201413.GA3872@laptop1.westhand.de">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13977.html">
<input type="submit" value=" Martin Alpers ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Proposal+for+chunked+storage+%5C%28related+to+Lowlevel+Access+to%09RiakCS+objects%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13956.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13953.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20140402201413.GA3872@laptop1.westhand.de</li>
</ul>
</div>
</body>
</html>
