<!DOCTYPE html>
<html lang="en">
<head>
<title>Returning after long period to old project to notice riak-cs stopped	working</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd4.html#13565" id="c">
<link rel="index" href="mail4.html#13565" id="i">
<link rel="prev" href="msg13561.html" id="p">
<link rel="next" href="msg13574.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13565.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Returning+after+long+period+to+old+project+to+notice+riak%5C-cs+stopped%09working%22&amp;o=newest" rel="nofollow"><span itemprop="name">Returning after long period to old project to notice riak-cs stopped	working</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22De+Bunge%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">De Bunge</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140202" rel="nofollow">Sun, 02 Feb 2014 09:14:36 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Initially it looked like some access rights issue
so I've updated /etc/riak-cs/app.config
and /etc/stanchion/app.config
with my admin's keys so I could use s3-cmd to figure out why some users
lost access to database.</pre><pre>

but now it fails to start (see below).
riak-cs starts only after machine being rebooted, and fails first time
then I try to manipulate files with boto.

riak-cs console
Node 'riak-cs@127.0.0.1' not responding to pings.
config is OK
Exec: /usr/lib/riak-cs/erts-5.9.1/bin/erlexec -boot
/usr/lib/riak-cs/releases/1.3.1/riak-cs             -embedded -config
/etc/riak-cs/app.config             -pa
/usr/lib/riak-cs/lib/basho-patches             -args_file
/etc/riak-cs/vm.args -- console
Root: /usr/lib/riak-cs
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:4:4]
[async-threads:64] [kernel-poll:true]

opening log file: &quot;/var/log/riak-cs/access.log.2014_01_29_23&quot;
00:45:05.232 [info] Application lager started on node 'riak-cs@127.0.0.1'
00:45:05.233 [info] Application poolboy started on node 'riak-cs@127.0.0.1'
00:45:05.253 [info] Application folsom started on node 'riak-cs@127.0.0.1'
Eshell V5.9.1  (abort with ^G)
(riak-cs@127.0.0.1)1&gt; 00:45:05.330 [error] CRASH REPORT Process
&lt;0.129.0&gt; with 0 neighbours exited with reason: {tcp,econnrefused} in
gen_server:init_it/6 line 320
/usr/lib/riak-cs/lib/os_mon-2.2.9/priv/bin/memsup: Erlang has closed.
                                                                     
Erlang has closed
                                                                                
      
{&quot;Kernel pid
terminated&quot;,application_controller,&quot;{application_start_failure,riak_cs,{shutdown,{riak_cs_app,start,[normal,[]]}}}&quot;}
Kernel pid terminated (application_controller)
({application_start_failure,riak_cs,{shutdown,{riak_cs_app,start,[normal,[]]}}})


Here are my config files:


cat /etc/riak-cs/app.config
%% -*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -*-
%% ex: ts=4 sw=4 et
[
 %% Riak CS configuration
 {riak_cs, [
              %% == Basic Configuration ==

              %% Riak CS http/https port and IP address to listen at
              %% for object storage activity
              {cs_ip, &quot;0.0.0.0&quot;},
              {cs_port, 8080 } ,

              %% Riak node to which Riak CS accesses
              {riak_ip, &quot;127.0.0.1&quot;},
              {riak_pb_port, 8087 } ,

              %% Configuration for access to request
              %% serialization service
              {stanchion_ip, &quot;127.0.0.1&quot;},
              {stanchion_port, 8085 },
              {stanchion_ssl, false },

              %% Enable this to allow the creation of an admin user
              %% when setting up a system. It is recommended to only
              %% enable this temporarily unless your use-case
              %% specifically dictates letting anonymous users to
              %% create accounts.
              {anonymous_user_creation, true},

              %% Admin user credentials. Admin access like
              %% /riak-cs/stats requires this entry to be set
              %% properly. The credentials specified here must match
              %% the admin credentials specified in the stanchion
              %% app.config for the system to function properly.
              {admin_key, &quot;JRG1FHSN-LR27WQGBD1G&quot;},
              {admin_secret, &quot;n7rjS9rdXvMa6ji5BPaiw5NBK9yB2V6J_J2gow==&quot;},

              %% Port and IP address to listen on for system
              %% administration tasks. Uncomment the following lines
              %% to use a separate IP and port for administrative
              %% API calls.
              %% {admin_ip, &quot;0.0.0.0&quot;},
              %% {admin_port, 8887 } ,

              %% If SSL needed, un-comment. Without SSL
              %% section, CS will be accessible via http.
              %% {ssl, [
              %%        {certfile, &quot;./etc/cert.pem&quot;},
              %%        {keyfile, &quot;./etc/key.pem&quot;}
              %%       ]},

              %% Root host name which Riak CS accepts.
              %% Your CS bucket at s3.example.com will be accessible
              %% via URL like <a  rel="nofollow" href="http://bucket.s3.example.com/object/name">http://bucket.s3.example.com/object/name</a>
              {cs_root_host, &quot;s3.amazonaws.com&quot;},

              %% Connection pools
              %% Each pool is specified as a nested
              %% tuple of {Name, {FixedSize, OverflowSize}}
              {connection_pools,
               [
                {request_pool, {128, 0} },
                {bucket_list_pool, {5, 0} }
               ]},

              %% == Rolling upgrade support ==

              %% Riak CS version number. This is used to selectively
              %% enable new features for the current version to better
              %% support rolling upgrades. New installs should not
              %% need to modify this. If peforming a rolling upgrade
              %% then set this value to 0 until all nodes have been
              %% upgraded and then set back to the original value.
              {cs_version, 10300 },

              %% == Usage recording ==

              %% How often to flush the access log; integer factor of
              %% access_archive_period (1 == once per period; 2 ==
              %% twice per period, etc.)
              {access_log_flush_factor, 1},

              %% Additional access log flush trigger - flush after
              %% this many accesses are recorded, even if the flush
              %% interval has not expired; integer number of accesses
              {access_log_flush_size, 1000000},

              %% How large each access archive object is. Should be a
              %% multiple of access_log_flush_interval; integer number
              %% of seconds (3600 == 1 hour)
              {access_archive_period, 3600},

              %% How many access logs are allowed to pile up in the
              %% archiver's queue before it starts skipping to catch
              %% up; integer number of logs
              {access_archiver_max_backlog, 2},

              %% When to automatically start storage calculation
              %% batches; list of &quot;HHMM&quot; UTC times
              %% ([] == do not automatically calculation;
              %%  [&quot;0600&quot;] == automatically calculate at 6am UTC every day;
              %%  [&quot;0600&quot;,&quot;1945&quot;] == automatically calculate at 6am and
              %%                     again at 7:45pm every day)
              {storage_schedule, []},

              %% How large each storage archive object is. Should be
              %% chosen such that each storage_schedule entry falls in
              %% a different period; integer number of seconds
              %% (86400 == 1 day)
              {storage_archive_period, 86400},

              %% How many archive periods a user can request in one
              %% usage read, applied independently to access and
              %% storage; integer number of intervals (744 == 1 month
              %% @ 1 hour intervals)
              {usage_request_limit, 744},

              %% == Garbage Collection ==

              %% The number of seconds to retain the block
              %% for an object after it has been deleted.
              %% This leeway time is set to give the delete
              %% indication time to propogate to all replicas.
              %% 86400 is 24-hours.
              {leeway_seconds, 86400},

              %% How often the garbage collection daemon
              %% waits in-between gc batches.
              %% 900 is 15-minutes.
              {gc_interval, 900},

              %% How long a move to the garbage
              %% collection to do list can remain
              %% failed, before we retry it.
              %% 21600 is 6-hours.
              {gc_retry_interval, 21600},

              %% == DTrace ==

              %% If your Erlang virtual machine supports DTrace (or
              %% user-space SystemTap), set dtrace_support to true.
              {dtrace_support, false}

             ]},

 {webmachine, [
               %% custom server name at http response header &quot;Server:
Riak CS&quot;
               {server_name, &quot;Riak CS&quot;},

               %% The webmachine_log_handler entry can be
               %% commented-out or removed to disable access
               %% logging. Do not remove the
               %% riak_cs_access_log_handler entry.
               {log_handlers, [
                               {webmachine_log_handler,
[&quot;/var/log/riak-cs&quot;]},
                               {riak_cs_access_log_handler, []}
                              ]}
              ]},

 {lager, [
          %% What handlers to install with what arguments
          %% The defaults for the logfiles are to rotate the files when
          %% they reach 10Mb or at midnight, whichever comes first, and keep
          %% the last 5 rotations. See the lager README for a description of
          %% the time rotation format:
          %% <a  rel="nofollow" href="https://github.com/basho/lager/blob/master/README.org">https://github.com/basho/lager/blob/master/README.org</a>
          %%
          %% If you wish to disable rotation, you can either set the
size to 0
          %% and the rotation time to &quot;&quot;, or instead specify a 2-tuple
that only
          %% consists of {Logfile, Level}.
          {handlers, [
                      {lager_console_backend, info},
                      {lager_file_backend, [
                                           
{&quot;/var/log/riak-cs/error.log&quot;, error, 10485760, &quot;$D0&quot;, 5},
                                           
{&quot;/var/log/riak-cs/console.log&quot;, info, 10485760, &quot;$D0&quot;, 5}
                                           ]}
                     ]},

          %% Whether to write a crash log, and where.
          %% Commented/omitted/undefined means no crash logger.
          {crash_log, &quot;/var/log/riak-cs/crash.log&quot;},

          %% Maximum size in bytes of events in the crash log - defaults
to 65536
          {crash_log_msg_size, 65536},

          %% Maximum size of the crash log in bytes, before its rotated, set
          %% to 0 to disable rotation - default is 0
          {crash_log_size, 10485760},

          %% What time to rotate the crash log - default is no time
          %% rotation. See the lager README for a description of this
format:
          %% <a  rel="nofollow" href="https://github.com/basho/lager/blob/master/README.org">https://github.com/basho/lager/blob/master/README.org</a>
          {crash_log_date, &quot;$D0&quot;},

          %% Number of rotated crash logs to keep, 0 means keep only the
          %% current one - default is 0
          {crash_log_count, 5},

          %% Whether to redirect error_logger messages into lager -
defaults to true
          {error_logger_redirect, true}
         ]},

 %% SASL config
 {sasl, [
         {sasl_error_logger, false}
        ]},

 %% riak control
    {riak_cs_control, [
       %% What port to run the application on.
       {port, 8000 },

       %% Instance of Riak CS you wish to talk to.
       {cs_hostname, &quot;0.0.0.0&quot; },
       {cs_port, 80 },
       {cs_protocol, &quot;http&quot; },

       %% Proxy information; necessary if you are using s3.amazonaws.com as
       %% your hostname.
       {cs_proxy_host, &quot;localhost&quot; },
       {cs_proxy_port, 8080 },

       %% Credentials you want the application to run as.
       {cs_admin_key, &quot;JRG1FHSN-LR27WQGBD1G&quot;},
       {cs_admin_secret, &quot;n7rjS9rdXvMa6ji5BPaiw5NBK9yB2V6J_J2gow==&quot;},

       %% Specify the bucket name for administration options.
       {cs_administration_bucket, &quot;riak-cs&quot; }
    ]}
].


cat /etc/stanchion/app.config
%% -*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -*-
%% ex: ts=4 sw=4 et
[
 %% Stanchion config
 {stanchion, [
                   {stanchion_ip, &quot;127.0.0.1&quot;},
                   {stanchion_port, 8085 } ,

                   %%{ssl, [
                   %%       {certfile, &quot;./etc/cert.pem&quot;},
                   %%       {keyfile, &quot;./etc/key.pem&quot;}
                   %%      ]},

                   {auth_bypass, false } ,

                   %% Riak connection details
                   {riak_ip, &quot;127.0.0.1&quot;},
                   {riak_pb_port, 8087 },

                   %% Admin user credentials
                   {admin_key, &quot;JRG1FHSN-LR27WQGBD1G&quot;},
                   {admin_secret,
&quot;n7rjS9rdXvMa6ji5BPaiw5NBK9yB2V6J_J2gow==&quot;}
                  ]},

 {lager, [
          %% What handlers to install with what arguments
          %% The defaults for the logfiles are to rotate the files when
          %% they reach 10Mb or at midnight, whichever comes first, and keep
          %% the last 5 rotations. See the lager README for a description of
          %% the time rotation format:
          %% <a  rel="nofollow" href="https://github.com/basho/lager/blob/master/README.org">https://github.com/basho/lager/blob/master/README.org</a>
          %%
          %% If you wish to disable rotation, you can either set the
size to 0
          %% and the rotation time to &quot;&quot;, or instead specify a 2-tuple
that only
          %% consists of {Logfile, Level}.
          {handlers, [
                      {lager_console_backend, info},
                      {lager_file_backend, [
                                           
{&quot;/var/log/stanchion/error.log&quot;, error, 10485760, &quot;$D0&quot;, 5},
                                           
{&quot;/var/log/stanchion/console.log&quot;, info, 10485760, &quot;$D0&quot;, 5}
                                           ]}
                     ]},

          %% Whether to write a crash log, and where.
          %% Commented/omitted/undefined means no crash logger.
          {crash_log, &quot;/var/log/stanchion/crash.log&quot;},

          %% Maximum size in bytes of events in the crash log - defaults
to 65536
          {crash_log_msg_size, 65536},

          %% Maximum size of the crash log in bytes, before its rotated, set
          %% to 0 to disable rotation - default is 0
          {crash_log_size, 10485760},

          %% What time to rotate the crash log - default is no time
          %% rotation. See the lager README for a description of this
format:
          %% <a  rel="nofollow" href="https://github.com/basho/lager/blob/master/README.org">https://github.com/basho/lager/blob/master/README.org</a>
          {crash_log_date, &quot;$D0&quot;},

          %% Number of rotated crash logs to keep, 0 means keep only the
          %% current one - default is 0
          {crash_log_count, 5},

          %% Whether to redirect error_logger messages into lager -
defaults to true
          {error_logger_redirect, true}
         ]},

 %% SASL config
 {sasl, [
         {sasl_error_logger, false}
        ]}
].


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13561.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd4.html#13565">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail4.html#13565">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13574.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Returning after long period to old project to notice riak-cs stopped	working">
<input type="hidden" name="msgid" value="52E99749.5070007@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13565.html">
<input type="submit" value=" De Bunge ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Returning+after+long+period+to+old+project+to+notice+riak%5C-cs+stopped%09working%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13561.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13574.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">52E99749.5070007@gmail.com</li>
</ul>
</div>
</body>
</html>
