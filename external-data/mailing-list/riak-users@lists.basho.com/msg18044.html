<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Leveled - Another Erlang Key-Value store</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#18044" id="c">
<link rel="index" href="maillist.html#18044" id="i">
<link rel="prev" href="msg18043.html" id="p">
<link rel="next" href="msg18039.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18044.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Leveled+%5C-+Another+Erlang+Key%5C-Value+store%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Leveled - Another Erlang Key-Value store</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Martin+Sumner%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Martin Sumner</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170228" rel="nofollow">Tue, 28 Feb 2017 09:29:52 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>For original testing in isolation I used this:

<a  rel="nofollow" href="https://github.com/martinsumner/leveled/blob/master/test/volume/single_node/src/basho_bench_driver_eleveleddb.erl">https://github.com/martinsumner/leveled/blob/master/test/volume/single_node/src/basho_bench_driver_eleveleddb.erl</a></pre><pre>

But I've focused on testing since within Riak using the standard
basho_bench/examples/riakc_pb.config test

Testing of secondary indexing is one of the next big things for me,
definitely going to do this in March.  From a development perspective doing
clones/snapshots was a lot easier than it presumably is in C++.  I'm unsure
about how performance will compare, as 2i terms do end up clumped together
on disk in leveldb and I know MVM has done a lot of optimisation work in
that area.

Some things that may help leveled are: there's no overlapping files in
level 1; the levels don't increase in depth as rapidly.  However, there are
some issues (<a  rel="nofollow" href="https://github.com/martinsumner/leveled/issues/34">https://github.com/martinsumner/leveled/issues/34</a>) that I may
still need to contend with.

I think there may be some interesting possibilities with Map functions
based on HEAD not GET requests.  So perhaps as a developer I could add a
bitmap index to my object metadata, and roll across those bitmaps
efficiently through a Map function now that I wouldn't need to pull the
whole object off disk to achieve that. So the concept of division between
Metadata and Value may open up efficient query ideas beyond 2i


On 28 February 2017 at 17:14, DeadZen &lt;dead...@deadzen.com&gt; wrote:

&gt; Yup I get it, I like the concept and the fun naming of inkers, pencillers
&gt; and clerks as well. Is there a basho bench configuration? This reminds me a
&gt; bit if fractal trees but with a focus on NoSQL operational semantics, how
&gt; else do you see this adding improvements? It seems index requests could be
&gt; cheaper with this backend configuration.
&gt;
&gt; On Tue, Feb 28, 2017 at 12:07 PM Martin Sumner &lt;
&gt; martin.sum...@adaptip.co.uk&gt; wrote:
&gt;
&gt;&gt; Have a look in <a  rel="nofollow" href="https://github.com/martinsumner/leveled/blob/">https://github.com/martinsumner/leveled/blob/</a>
&gt;&gt; master/docs/FUTURE.md and the &quot;Riak Features Implemented&quot;
&gt;&gt;
&gt;&gt; I'm trying to avoid the need for Riak to Get n times for every request
&gt;&gt; (both a KV GET and a KV PUT), when really it only needs the body once, and
&gt;&gt; the n-1 times it doesn't need the body if the HEAD response confirms that
&gt;&gt; the vector clock is at the expected state.  As values get larger there's a
&gt;&gt; lot of unnecessary disk activity in those GETs.
&gt;&gt;
&gt;&gt; To understand all the Journal/Inker stuff have a look at
&gt;&gt; <a  rel="nofollow" href="https://github.com/martinsumner/leveled/blob/master/docs/DESIGN.md">https://github.com/martinsumner/leveled/blob/master/docs/DESIGN.md</a>
&gt;&gt;
&gt;&gt; The Inker is an actor that controls the Journal - the Journal is a
&gt;&gt; transaction log where all the values are stored permanently, made up of a
&gt;&gt; series of CDB files where everything is ordered by sequence number.  The
&gt;&gt; Keys and Metadata are stored in a merge tree called the Ledger - and the
&gt;&gt; Ledger is controlled by an actor called the Penciller.  So the HEAD request
&gt;&gt; should just need to check in the Ledger via the Penciller.  A GET request
&gt;&gt; must follow that same path, and then once it has the metadata, it has the
&gt;&gt; sequence number and so can use that to fetch the value from the Journal via
&gt;&gt; the Inker.
&gt;&gt;
&gt;&gt; Does this make sense?
&gt;&gt;
&gt;&gt; My apologies, as the naming may not be helpful.  Perhaps one of the
&gt;&gt; drawbacks of working in isolation on this.
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt;
&gt;&gt; Martin
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On 28 February 2017 at 16:51, DeadZen &lt;dead...@deadzen.com&gt; wrote:
&gt;&gt;
&gt;&gt; Cheers indeed!
&gt;&gt; You added HEAD requests so a full GET wouldn't always be required?
&gt;&gt; Did I read that right? *dives into code*
&gt;&gt; %% GET requests first follow the path of a HEAD request, and if an object
&gt;&gt; is
&gt;&gt; %% found, then fetch the value from the Journal via the Inker.
&gt;&gt; ... WHAT?
&gt;&gt;
&gt;&gt; Very nice work, will be more than happy to provide feedback and patches
&gt;&gt; on this.
&gt;&gt;
&gt;&gt; On Tue, Feb 28, 2017 at 9:04 AM, Martin Sumner
&gt;&gt; &lt;martin.sum...@adaptip.co.uk&gt; wrote:
&gt;&gt; &gt;
&gt;&gt; &gt; Over the past few months I've been working on an alternative pure-Erlang
&gt;&gt; &gt; Key/Value store to act as a backend to Riak KV.  This is now open
&gt;&gt; source and
&gt;&gt; &gt; available at
&gt;&gt; &gt;
&gt;&gt; &gt; <a  rel="nofollow" href="https://github.com/martinsumner/leveled">https://github.com/martinsumner/leveled</a>
&gt;&gt; &gt;
&gt;&gt; &gt; The store is a work-in-progress prototype, originally started to better
&gt;&gt; &gt; understand the impact of different trade-offs in LSM-Tree design.  The
&gt;&gt; aim
&gt;&gt; &gt; is to:
&gt;&gt; &gt;
&gt;&gt; &gt; - provide a fully-featured Riak backend (e.g. secondary index, object
&gt;&gt; expiry
&gt;&gt; &gt; support etc)
&gt;&gt; &gt; - provide stable throughput with larger object sizes (&gt; 4KB)
&gt;&gt; &gt; - provide a simpler and more flexible path to making Riak KV changes
&gt;&gt; &gt; end-to-end
&gt;&gt; &gt;
&gt;&gt; &gt; The prime change in the store when compared to HanoiDB or eleveldb is
&gt;&gt; that
&gt;&gt; &gt; storage is split with only Keys &amp; Metadata being placed in the merge
&gt;&gt; tree,
&gt;&gt; &gt; and the full object living to the side in a series of CDB-based
&gt;&gt; journals.
&gt;&gt; &gt; The intention of this is to:
&gt;&gt; &gt;
&gt;&gt; &gt; - reduce write amplification and ease page-cache pollution issues on
&gt;&gt; &gt; scanning events.
&gt;&gt; &gt; - support faster HEAD requests than GET requests, and in parallel an
&gt;&gt; &gt; alternative Riak KV branch has been produced to move from an n-GET
&gt;&gt; model to
&gt;&gt; &gt; a n-HEAD 1-GET model of fetching data for both KV GET and KV PUT
&gt;&gt; operations
&gt;&gt; &gt;
&gt;&gt; &gt; The impact of this has been to improve throughput for larger object
&gt;&gt; sizes
&gt;&gt; &gt; where disk I/O and not CPU is the current limit on throughput.  The
&gt;&gt; &gt; advantage increases the greater the object size, and the tighter the
&gt;&gt; &gt; constraint on disk.
&gt;&gt; &gt;
&gt;&gt; &gt; Please visit the github page, I've tried to write up as much about the
&gt;&gt; &gt; project as I can.  There's the results of various volume tests,
&gt;&gt; information
&gt;&gt; &gt; on the research which prompted the design, an overview of the design
&gt;&gt; itself
&gt;&gt; &gt; and some hints as to what I expect to try next with leveled.
&gt;&gt; &gt;
&gt;&gt; &gt; Any feedback, please mail me, raise an issue on github, or ping me
&gt;&gt; @masleeds
&gt;&gt; &gt;
&gt;&gt; &gt; Cheers
&gt;&gt; &gt;
&gt;&gt; &gt; Martin
&gt;&gt; &gt;
&gt;&gt; &gt; _______________________________________________
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18043.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#18044">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18044">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18039.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg18037.html">Leveled - Another Erlang Key-Value store</a></span> <span class="sender italic">Martin Sumner</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18041.html">Re: Leveled - Another Erlang Key-Value store</a></span> <span class="sender italic">DeadZen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18042.html">Re: Leveled - Another Erlang Key-Value store</a></span> <span class="sender italic">Martin Sumner</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18043.html">Re: Leveled - Another Erlang Key-Value store</a></span> <span class="sender italic">DeadZen</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Leveled - Another Erlang Key-Value stor...</span> <span class="sender italic">Martin Sumner</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Leveled - Another Erlang Key-Value store">
<input type="hidden" name="msgid" value="CANzjUxCs3-+8m1xvDKXihXK11sRqz5DGtKoNUCgabjMgQf4cDg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18044.html">
<input type="submit" value=" Martin Sumner ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Leveled+%5C-+Another+Erlang+Key%5C-Value+store%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18043.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18039.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANzjUxCs3-+8m1xvDKXihXK11sRqz5DGtKoNUCgabjMgQf4cDg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
