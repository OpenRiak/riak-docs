<!DOCTYPE html>
<html lang="en">
<head>
<title>Lowlevel Access to RiakCS objects?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#13940" id="c">
<link rel="index" href="mail2.html#13940" id="i">
<link rel="prev" href="msg13937.html" id="p">
<link rel="next" href="msg13943.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13940.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Lowlevel+Access+to+RiakCS+objects%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Lowlevel Access to RiakCS objects?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Martin+Alpers%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Martin Alpers</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140327" rel="nofollow">Thu, 27 Mar 2014 15:07:15 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi all,

is there a canonical way to access RiakCS objects on a lower level? If I 
remember correctly, RiakCS basically distributes larger objects into chunks of 
one megabye each, and mapreduces them together on retrieval.
I would like to read those chunks for caching purposes.</pre><pre>

For those interested in why I would wnat that:
A Riak/RiakCS cluster is the heart of our yet-to-be-implemented video delivery 
cluster. A video management system will enable registered user to upload their 
videos and the public can watch them.
In order to reduce intra-cluster traffic, we intent to cache the videos, 
preferably in RAM.
We do not have any numbers on how often users would skip parts of the video and 
generate range requests. If that case is really common, we would prefer to 
serve them from cache as well, at least with Varnish and Squid, some users 
would experience unacceptably long delays.
We looked out for a cache that could pipe through any request on an URL on 
which caching is in progress and serve from cache afterwards.

The problem with both Varnish and Squid (and I suppose most caches, because 
this behaviour seems reasonable in most cases) boils down to treating a caching 
in progress as a cache hit.
My colleague started to write his own caching proxy in NodeJS, but using 
asynchronous callbacks to check if a file exists, and to create it if it does 
not, strikes me as somewhat couragous for production.

Now while we cannot risk to let some users wait for hundreds of megabytes to be 
cached before delivery begins, and while we want at least to be prepared to 
face many more range requests than the average &quot;wget was interrupted&quot; case, it 
occurred to me thata few megabytes are not an issue at multi-fast-ethernet 
speed.
So if we can split our files into objects small enough, we could code a proxy 
that translates a range request into one or more normal requests for those 
chunks, cuts off a certain offset of the first chunk if the range of the 
orignal request began somewhere off the boundary, and reconcatenates those 
chunks in correct order for delivery.
So the cache would never have to be bypassed, and the whole headache of telling 
a complete hit from one &quot;in progress&quot; would be gone.

Since RiakCS has already split our files into small pieces, and somehow tracks 
them, so could we possibly piggyback on that?

And by the way, I just came across the memory backend. I assume it is 
distributed like the persistent ones, so it will not help me redice internal 
traffic, right?

Any input is highly appreciated.

Best Regards
Martin

-- 
Greetings, Martin Alpers

martin-alp...@web.de; Public Key ID: 10216CFB
Tel: +49 431/90885691; Mobile: +49 176/66185173
JID: martin.alp...@jabber.org
FYI: <a  rel="nofollow" href="http://apps.opendatacity.de/stasi-vs-nsa/">http://apps.opendatacity.de/stasi-vs-nsa/</a>
</pre>
<p><strong><a href="msg13940/signature.asc" ><img src="../attachment.png" alt="Attachment:" width=27 height=28></a>
<a href="msg13940/signature.asc" >signature.asc</a></strong><br>
<em>Description:</em> Digital signature</p>
<pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13937.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#13940">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail2.html#13940">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13943.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Lowlevel Access to RiakCS objects?</span> <span class="sender italic">Martin Alpers</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13943.html">Re: Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Tom Santero</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13946.html">Re: Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Martin Alpers</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13950.html">Re: Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Brian Akins</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13952.html">Re: Lowlevel Access to RiakCS objects?</a></span> <span class="sender italic">Martin Alpers</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Lowlevel Access to RiakCS objects?">
<input type="hidden" name="msgid" value="20140327220517.GB6136@laptop1.westhand.de">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13940.html">
<input type="submit" value=" Martin Alpers ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Lowlevel+Access+to+RiakCS+objects%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13937.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13943.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20140327220517.GB6136@laptop1.westhand.de</li>
</ul>
</div>
</body>
</html>
