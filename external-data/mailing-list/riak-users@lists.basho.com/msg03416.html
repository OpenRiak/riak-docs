<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Old values on put call</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#03416" id="c">
<link rel="index" href="maillist.html#03416" id="i">
<link rel="prev" href="msg03361.html" id="p">
<link rel="next" href="msg03366.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg03416.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Old+values+on+put+call%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Old values on put call</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Mathias+Meyer%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Mathias Meyer</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110526" rel="nofollow">Thu, 26 May 2011 03:58:09 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Anthony,

currently there's no simple way to achieve what you're after. The API is 
modelled around a GET before you PUT model.</pre><pre>

You can specify the option return_body when putting new data into Riak, like so:

{ok, RObj} = riak_pb_socket:put (.., NewObject, [return_body]),

That returns the freshly written data in the result. It's not exactly what you 
want, but could be used to achieve what you're after by deliberately creating 
siblings, by e.g. leaving out the vector clock. Specifying the return_body flag 
then will return the list of siblings created with this requests.

Be aware that abusing this technique with too many writes and not properly 
reconciling siblings may cause your Riak objects to grow in an unhealthy 
manner, and it's not exactly a recommended way of doing things.

It's an option but certainly not as simple as the one you're after, unless 
you're prepared to deal with the potential conflicts, and e.g. handle siblings 
immediately after you reconciled the differences between two objects in your 
compare() function, see [1] for more details.

Mathias Meyer
Developer Advocate, Basho Technologies

[1] <a  rel="nofollow" href="http://wiki.basho.com/Vector-Clocks.html">http://wiki.basho.com/Vector-Clocks.html</a>

On Mittwoch, 18. Mai 2011 at 23:28, Anthony Molinaro wrote:

&gt; Hi,
&gt; 
&gt;  I'm working on an application where I am storing an erlang external term
&gt; format in riak. The entire structure gets updated at once, but I'd like to
&gt; see what is changing, so I have something like this (in pseudo code).
&gt; 
&gt; NewObject = construct_new(...),
&gt; OldObject = riak_pb_socket:get(...),
&gt; ok = riak_pb_socket:put (.., NewObject),
&gt; compare (OldObject, NewObject),
&gt; 
&gt; The idea being that I am updating the object everytime, but I would like
&gt; to have a general idea what has changed.
&gt; 
&gt; So I was wondering if there are any options for put to return the previous
&gt; value? That would allow me to remove the call to get and simply do something
&gt; like.
&gt; 
&gt; NewObject = construct_new(...),
&gt; OldObject = riak_pb_socket:put (.., NewObject),
&gt; compare (OldObject, NewObject),
&gt; 
&gt; Now I assume what I get back would depend a lot on what the w value is, but
&gt; in most cases, I tend to use the defaults. Also, I would think the old
&gt; values could be returned as a list in some cases where there was disagreement.
&gt; 
&gt; Anyway, would something like this be hard to implement in riak itself
&gt; (it's sort of a specialized use case, but I could see it being useful
&gt; in cases like mine where you always want a put to succeed, but you might
&gt; want to check what changed for tracking reasons, and I do understand that
&gt; you won't be absolutely accurate all the time, but I mostly am looking for
&gt; something scalable and mostly accurate).
&gt; 
&gt; -Anthony
&gt; 
&gt; -- 
&gt; ------------------------------------------------------------------------
&gt; Anthony Molinaro &lt;antho...@alumni.caltech.edu 
&gt; (<a  rel="nofollow" href="mailto:antho...@alumni.caltech.edu">mailto:antho...@alumni.caltech.edu</a>)&gt;
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>)
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg03361.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#03416">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#03416">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg03366.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg03361.html">Old values on put call</a></span> <span class="sender italic">Anthony Molinaro</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Old values on put call</span> <span class="sender italic">Mathias Meyer</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Old values on put call">
<input type="hidden" name="msgid" value="CC0458D297964950AAA83667E3A7F0CE@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg03416.html">
<input type="submit" value=" Mathias Meyer ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Old+values+on+put+call%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg03361.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg03366.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CC0458D297964950AAA83667E3A7F0CE@basho.com</li>
</ul>
</div>
</body>
</html>
