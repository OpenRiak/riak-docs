<!DOCTYPE html>
<html lang="en">
<head>
<title>Is Riak suitable for a short-term scatter/gather sort of data store?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05564" id="c">
<link rel="index" href="maillist.html#05564" id="i">
<link rel="prev" href="msg05563.html" id="p">
<link rel="next" href="msg05566.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05564.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Is+Riak+suitable+for+a+short%5C-term+scatter%5C%2Fgather+sort+of+data+store%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Is Riak suitable for a short-term scatter/gather sort of data store?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Keith+Irwin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Keith Irwin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111112" rel="nofollow">Sat, 12 Nov 2011 14:19:20 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Folks--

(Apologies up front for the length of this.)</pre><pre>

I'm wondering if you can let me know if Riak is a good fit for a simple 
not-quite-key-value scenario described below. MongoDB or (say) Postgresql seem 
a more natural fit conceptually, but I really, really like Riak's distribution 
strategy.

## context

The basic overview is this: 

50K devices push data once a second to web services which need to store that 
data in short-term storage (Riak). Once an hour, a sweeper needs to take an 
hour's worth of data per device (if there is any) and ship it off to long term 
storage, then delete it from short-term storage. Ideally, there'd only ever be 
slightly more than 1 hour's worth of data still in short-term storage for any 
given device. The goal is to write down the data as simply and safely as 
possible, with little or no processing on that data.

Each second's worth of data is:

* A device identifier
* A timestamp (epoch seconds, integer) for the slice of time the data represents
* An opaque blob of binary data (2 to 4k)

Once an hour, I'd like to do something like:

* For each device:
        * Find (and concat) all the data between time1 and time2 (an hour).
        * Move that data to long-term storage (not Riak) as a single blob.
        * Delete that data from Riak.

For an SQL db, this is a really simple problem, conceptually. You can have a 
table with three columns: device-id, timestamp, blob. You can index the first 
two columns and roll up the data easily enough and then delete it via single 
SQL statements (or buffer as needed). The harder part is partitioning, 
replication, etc, etc.

For MongoDB, it's also fairly simple. Just use a document with the same 
device-id, timestamp and binary-array data (as JSON), make sure indexes are 
declared, and query/delete just as in SQL. MongoDB provides sharding, 
replica-sets, recovery, etc. Set up, while less complicated than an RDBMS, 
still seems way more complicated than necessary.

These solutions also provide sorting (which, while nice, isn't a requirement 
for my case).

## question

I've been reading the Riak docs, and I'm just not sure if this simple 
&quot;queryable&quot; case can really fit all that well. I'm not so concerned about 
having to send 50K &quot;deletes&quot; to delete data. I'm more concerned about being 
able to find it. Given what I've written above, I may be blocked conceptually 
by the above index/query mentality such that I'm just not seeing the Riak way 
of doing things.

Anyway, I can &quot;tag&quot; (via the secondary index feature) each blob of data with 
the device-id and the timestamp. I could then do a range query similar to:

    GET /buckets/devices/index/timestamp/start/end

However, this doesn't allow me to group based on device-id. I could create a 
separate bucket for every device, such that I could do:

    GET /buckets/device-id/index/timestamp/start/end

but if I do this, how can I get a list of the device-ids I need so that I can 
create that specific URL? The docs say listing buckets and keys is problematic.

Might be that Riak just isn't a good case for this sort of thing, especially 
given I want to use it for short-term transient data, and that's fine. But I 
wanted to ask you all just to make sure that I'm not missing something 
somewhere.

For instance, might link walking help? How about a map/reduce to find a unique 
list of device-ids within a given time-horizon, and a streaming map job to 
gather the data for export? Does that seem pretty reasonable?

Thanks!

Keith
_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05563.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05564">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05564">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05566.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Is Riak suitable for a short-term scatter/gather sort of da...</span> <span class="sender italic">Keith Irwin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05566.html">Re: Is Riak suitable for a short-term scatter/gather s...</a></span> <span class="sender italic">Gordon Tillman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05567.html">Re: Is Riak suitable for a short-term scatter/gath...</a></span> <span class="sender italic">Keith Irwin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05568.html">Re: Is Riak suitable for a short-term scatter/...</a></span> <span class="sender italic">Gordon Tillman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05570.html">2i Performance on EC2</a></span> <span class="sender italic">Jim Adler</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Is Riak suitable for a short-term scatter/gather sort of data store?">
<input type="hidden" name="msgid" value="38CA5673-DF16-499A-A3D3-7F456679FD68@zentrope.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05564.html">
<input type="submit" value=" Keith Irwin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Is+Riak+suitable+for+a+short%5C-term+scatter%5C%2Fgather+sort+of+data+store%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05563.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05566.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">38CA5673-DF16-499A-A3D3-7F456679FD68@zentrope.com</li>
</ul>
</div>
</body>
</html>
