<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Getting all the Keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02077" id="c">
<link rel="index" href="maillist.html#02077" id="i">
<link rel="prev" href="msg02083.html" id="p">
<link rel="next" href="msg02084.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02077.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Getting+all+the+Keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Getting all the Keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Eric+Moritz%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Eric Moritz</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110123" rel="nofollow">Sun, 23 Jan 2011 10:10:54 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I have a pipe dream of doing a distibuted b-tree with a bucket who's value
is a node in the tree containing a list of keys to another bucket and left
and right links  to children nodes.</pre><pre>

It feels right in my head, though it is probably horribly flawed in some
way. I'm certain more clever data nerds than me have thought of this and
dismissed it for some obvious reason that I'm too green to see.

Eric.
On Jan 22, 2011 2:46 PM, &quot;Gary William Flake&quot; &lt;g...@flake.org&gt; wrote:
&gt; This is a really big pain point for me as well and -- at the risk of
&gt; prematurely being overly critical of Riak's overall design -- I think it
&gt; points to a major flaw of Riak in its current state.
&gt;
&gt; Let me explain....
&gt;
&gt; Riak is bad at enumerating keys. We know that. I am happy to manage a list
&gt; of keys myself. Fine. How do I do that in Riak?
&gt;
&gt; Well, the obvious solution is to have a special object that you maintain
&gt; that is a list of the keys that you need. So, each time you insert a new
&gt; object, you effectively append a new key to the end of a list, that is
&gt; itself a value to a special index key.
&gt;
&gt; But what is an append in Riak? The only way to implement a list append is
&gt; to:
&gt;
&gt; 1. read in the entire value of your list object.
&gt; 2. append to this list at the application layer.
&gt; 3. reinsert the new value back into the list.
&gt;
&gt; This is a horrible solution for at least three reasons. First, inserting N
&gt; new keys and maintaining your own list is now O(N*N) runtime complexity
&gt; because each append has to do I/O proportional to the size of the entire
&gt; list for each append. Second, this operation should be happening entirely
&gt; at the data layer and not between the data and app layer. Third, it
&gt; introduces write contentions in that two clients may try to append at
&gt; approximately the same time, giving you a list that is now inconsistent.
&gt;
&gt; The conclusion for me is that you can't efficiently enumerate keys with
Riak
&gt; even if you roll your own key index with Riak (in anything close to an
ideal
&gt; way).
&gt;
&gt; To overcome this problem, Riak desperately needs to either maintain its
own
&gt; key index efficiently, or it needs to support atomic mutations on values.
&gt;
&gt; For an example of the latter approach, see Redis which I think handles
this
&gt; beautifully.
&gt;
&gt; In the end, you may need to think about redesigning your data model so
that
&gt; there never is a need to enumerate keys. I am trying this and I use a
&gt; combination of:
&gt;
&gt; 1. Standard KV approaches,
&gt; 2. Riak search for being able to enumerate some records in order,
&gt; 3. Transactions logs stored in a special bucket,
&gt; 4. Batched M/R phases on the Transaction logs to avoid write contention,
and
&gt; 5. Batched rebuilding of &quot;views&quot; in a view bucket.
&gt;
&gt; Given that Riak search is loudly proclaimed as being beta, this makes me
&gt; fairly anxious.
&gt;
&gt; I am very close to not needing to enumerate keys the bad way now. However,
&gt; I would have killed for an atomic mutator like Redis.
&gt;
&gt; BTW, I would love for someone from Basho to disabuse me of my conclusions
in
&gt; this note.
&gt;
&gt; -- GWF
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Sat, Jan 22, 2011 at 10:40 AM, Alexander Staubo &lt;li...@purefiction.net
&gt;wrote:
&gt;
&gt;&gt; On Sat, Jan 22, 2011 at 19:34, Alexander Staubo &lt;li...@purefiction.net&gt;
&gt;&gt; wrote:
&gt;&gt; &gt; On Sat, Jan 22, 2011 at 18:23, Thomas Burdick
&gt;&gt; &gt; &lt;tburd...@wrightwoodtech.com&gt; wrote:
&gt;&gt; &gt;&gt; So really whats the solution to just having a list of like 50k keys
that
&gt;&gt; can
&gt;&gt; &gt;&gt; quickly be appended to without taking seconds to then retrieve later
on.
&gt;&gt; Or
&gt;&gt; &gt;&gt; is this just not a valid use case for riak at all? That would suck
cause
&gt;&gt; &gt;&gt; again, I really like the notion of an AP oriented database!
&gt;&gt; &gt;
&gt;&gt; &gt; I have been struggling with the same issue. You may want to look at
&gt;&gt; &gt; Cassandra, which handles sequential key range traversal very well.
&gt;&gt; &gt; Riak also has a problem with buckets sharing the same data storage
&gt;&gt; &gt; (buckets are essentially just a way to namespace keys), so if you have
&gt;&gt; &gt; two buckets and fill up one of them, then enumerating the keys of the
&gt;&gt; &gt; empty bucket will take a long time even though it
&gt;&gt;
&gt;&gt; I accidentally &quot;Send&quot;. Again: I have been struggling with the same
&gt;&gt; issue. You may want to look at Cassandra, which handles sequential key
&gt;&gt; range traversal very well. Riak also has a problem with buckets
&gt;&gt; sharing the same data storage (buckets are essentially just a way to
&gt;&gt; namespace keys), so if you have two buckets and fill up one of them,
&gt;&gt; then enumerating the keys of the empty bucket will take a long time
&gt;&gt; even though it's empty. Cassandra does not have a problem with this,
&gt;&gt; since Cassandra's keyspaces are separate data structures. I like Riak,
&gt;&gt; but it only works well with single-key/linked traversal, not this kind
&gt;&gt; of bucket-wide processing.
&gt;&gt;
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02083.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02077">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02077">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02084.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02066.html">Re: Getting all the Keys</a></span> <span class="sender italic">Thomas Burdick</span></li>
<li class="icons-email"><span class="subject"><a href="msg02070.html">Re: Getting all the Keys</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg02071.html">Re: Getting all the Keys</a></span> <span class="sender italic">Thomas Burdick</span></li>
<li class="icons-email"><span class="subject"><a href="msg02072.html">Re: Getting all the Keys</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg02076.html">Re: Getting all the Keys</a></span> <span class="sender italic">Eric Moritz</span></li>
<li class="icons-email"><span class="subject"><a href="msg02078.html">Re: Getting all the Keys</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg02081.html">Re: Getting all the Keys</a></span> <span class="sender italic">Les Mikesell</span></li>
<li class="icons-email"><span class="subject"><a href="msg02082.html">Re: Getting all the Keys</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg02079.html">Best relational DB to use with ...</a></span> <span class="sender italic">Mojito Sorbet</span></li>
<li class="icons-email"><span class="subject"><a href="msg02083.html">Re: Best relational DB to use w...</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Getting all the Keys</span> <span class="sender italic">Eric Moritz</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02084.html">Re: Getting all the Keys</a></span> <span class="sender italic">Eric Moritz</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02067.html">Re: Getting all the Keys</a></span> <span class="sender italic">Neville Burnell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02068.html">Re: Getting all the Keys</a></span> <span class="sender italic">Ryan Zezeski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02080.html">Re: Getting all the Keys</a></span> <span class="sender italic">Eric Moritz</span></li>
<li class="icons-email"><span class="subject"><a href="msg02086.html">Re: Getting all the Keys</a></span> <span class="sender italic">Eric Moritz</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Getting all the Keys">
<input type="hidden" name="msgid" value="AANLkTi=7-dpioT1sV8u+UG4xMn4_u0G5u2F93rrQ2iaq@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02077.html">
<input type="submit" value=" Eric Moritz ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Getting+all+the+Keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02083.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02084.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTi=7-dpioT1sV8u+UG4xMn4_u0G5u2F93rrQ2iaq@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
