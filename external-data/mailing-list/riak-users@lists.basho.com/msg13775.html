<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Questions about the Riak Horizontal Scalability</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd2.html#13775" id="c">
<link rel="index" href="mail3.html#13775" id="i">
<link rel="prev" href="msg13774.html" id="p">
<link rel="next" href="msg13781.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13775.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Questions+about+the+Riak+Horizontal+Scalability%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Questions about the Riak Horizontal Scalability</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Christian+Dahlqvist%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Christian Dahlqvist</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140308" rel="nofollow">Sat, 08 Mar 2014 07:33:28 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

I noticed another thing in your Basho Bench configuration file. As you have
defined the key generator as a `partitioned_sequential_int`, each key will
be processed at most once during the run. As you have `get` requests
defined in the operations mix, these will, unless you have preloaded the
system, always return a `not_found`.</pre><pre>

The `partitioned_sequential_int` key generator is often used together with
only `insert` operations to pre-load a cluster with data. You could adjust
the key interval to match how many keys you want in the system and use this
to load an initial set of all objects in the cluster.

The `uniform_int` key generator can then be used with the same key interval
to run benchmarks where `get` requests will return data, which may make
your benchmark more realistic.

Best regards,

Christian




On Sat, Mar 8, 2014 at 4:57 AM, Evan Vigil-McClanahan &lt;emcclana...@basho.com
&gt; wrote:

&gt; Other tweaks:
&gt;
&gt; - If you're running on machines with multiple numa zones, +sbt db can help.
&gt; - the 2.0 pre-releases have some changes to the networking code that
&gt; can help increase, if you're willing to try out an early release.
&gt;
&gt; On Fri, Mar 7, 2014 at 3:06 PM, Christian Dahlqvist &lt;christ...@basho.com&gt;
&gt; wrote:
&gt; &gt; As the Protocol Buffer interface generally is faster and more efficient
&gt; than
&gt; &gt; the HTTP interface, I would also recommend using the
&gt; &gt; basho_bench_driver_riakc_pb driver instead of basho_bench_driver_http_raw
&gt; &gt; for your benchmarks.
&gt; &gt;
&gt; &gt; Best regards,
&gt; &gt;
&gt; &gt; Christian
&gt; &gt;
&gt; &gt;
&gt; &gt; On Fri, Mar 7, 2014 at 10:54 PM, Sean Cribbs &lt;s...@basho.com&gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Note as well that the 'concurrent' setting will *not* typically increase
&gt; &gt;&gt; throughput beyond a certain point (instead you will simply have many
&gt; workers
&gt; &gt;&gt; waiting in the run queue). You are also only driving load from a single
&gt; &gt;&gt; machine with limits on its CPU and network throughput. Start by trying a
&gt; &gt;&gt; more reasonable concurrency level, like two (2) times the number of CPU
&gt; &gt;&gt; cores in the basho_bench machine. Also consider running basho_bench from
&gt; &gt;&gt; multiple machines at once. Consider the line rate of your network as
&gt; well;
&gt; &gt;&gt; in the past I have easily been able to saturate a gigabit network with
&gt; &gt;&gt; basho_bench.
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; On Fri, Mar 7, 2014 at 4:45 PM, Alexander Sicular &lt;sicul...@gmail.com&gt;
&gt; &gt;&gt; wrote:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; How many physical machines (disks/cores/nics) are in your cluster?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; -Alexander
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; @siculars
&gt; &gt;&gt;&gt; <a  rel="nofollow" href="http://siculars.posthaven.com">http://siculars.posthaven.com</a>
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Sent from my iRotaryPhone
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; On Mar 6, 2014, at 22:07, &quot;yanqun....@mesheven.com&quot;
&gt; &gt;&gt;&gt; &lt;yanqun....@mesheven.com&gt; wrote:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Greetings all...
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I am running tests with Riak Cluster.
&gt; &gt;&gt;&gt; When this cluster has only one node, the max throughput is about 1500
&gt; &gt;&gt;&gt; ops/s(CPU becomes the bottleneck).
&gt; &gt;&gt;&gt; But after I added 4 more nodes into the cluster,  no matter how I
&gt; changed
&gt; &gt;&gt;&gt; the configuration file of Basho benchmark tool,
&gt; &gt;&gt;&gt; the number of throughput have never been more than ~3500 ops/s.
&gt; &gt;&gt;&gt; CPU utilization on each node is about 60~65% (captured by iostat and
&gt; sar)
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; And when I added 5 more nodes(10 nodes totally), it is the same result.
&gt; &gt;&gt;&gt; And CPU utilization on each node is about 60%.
&gt; &gt;&gt;&gt; I  can't understand why.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; During the tests, I tried:
&gt; &gt;&gt;&gt; 1)Change ring size from 64 to 128
&gt; &gt;&gt;&gt; 2)Change basho benchmark configuration file, like &quot;mode&quot;,&quot;concurrent&quot;
&gt; and
&gt; &gt;&gt;&gt; &quot;key_generator&quot;...
&gt; &gt;&gt;&gt; 3)Modify some system limits on both riak nodes and basho bench servers,
&gt; &gt;&gt;&gt; such as file descriptor  , tcp settings.
&gt; &gt;&gt;&gt; 4)Monitoring system like cpu, memory and IO, and none of them become
&gt; the
&gt; &gt;&gt;&gt; bottleneck.
&gt; &gt;&gt;&gt; 5)Monitoring the basho bench server,  low load.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Any ideas?
&gt; &gt;&gt;&gt; Or did I make any mistakes in my configuration file?
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Configuration file of Basho benchmark tool:
&gt; &gt;&gt;&gt; ===================================================================
&gt; &gt;&gt;&gt; {mode, max}.
&gt; &gt;&gt;&gt; {duration, 15}.
&gt; &gt;&gt;&gt; {concurrent,    500}.
&gt; &gt;&gt;&gt; {driver, basho_bench_driver_http_raw}.
&gt; &gt;&gt;&gt; {http_raw_ips,
&gt; &gt;&gt;&gt;
&gt; [&quot;10.11.20.46&quot;,&quot;10.11.20.47&quot;,&quot;10.11.20.48&quot;,&quot;10.11.20.49&quot;,&quot;10.11.20.50&quot;,&quot;10.11.20.51&quot;,&quot;10.11.20.52&quot;,&quot;10.11.20.53&quot;]}.
&gt; &gt;&gt;&gt; {http_raw_port, 8098}.
&gt; &gt;&gt;&gt; {http_raw_path, &quot;/riak/test&quot;}.
&gt; &gt;&gt;&gt; {key_generator, {partitioned_sequential_int,
&gt; &gt;&gt;&gt; 1000000000000000,8000000000000000}}.  %%we want 16 bytes long
&gt; key-length
&gt; &gt;&gt;&gt; {value_generator, {fixed_bin, 1024}}. %%1KB
&gt; &gt;&gt;&gt; {operations, [{insert,4}, {get,6}]}.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; ===============================================================================
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Here are our server specifications(VMs based on Xenserver):
&gt; &gt;&gt;&gt; 1)Riak nodes: 2cores + 4GB RAM + 20GB disk
&gt; &gt;&gt;&gt; 2)Basho benchmark, 4 cores + 4GB RAM, 30GB disk.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Thank you very much !
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; _______________________________________________
&gt; &gt;&gt;&gt; riak-users mailing list
&gt; &gt;&gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; _______________________________________________
&gt; &gt;&gt;&gt; riak-users mailing list
&gt; &gt;&gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; --
&gt; &gt;&gt; Sean Cribbs &lt;s...@basho.com&gt;
&gt; &gt;&gt; Software Engineer
&gt; &gt;&gt; Basho Technologies, Inc.
&gt; &gt;&gt; <a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>
&gt; &gt;&gt;
&gt; &gt;&gt; _______________________________________________
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13774.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd2.html#13775">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail3.html#13775">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13781.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13770.html">Questions about the Riak Horizontal Scalability</a></span> <span class="sender italic">yanqun....@mesheven.com</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13771.html">Re: Questions about the Riak Horizontal Scala...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13772.html">Re: Questions about the Riak Horizontal S...</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13773.html">Re: Questions about the Riak Horizont...</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13774.html">Re: Questions about the Riak Hori...</a></span> <span class="sender italic">Evan Vigil-McClanahan</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Questions about the Riak...</span> <span class="sender italic">Christian Dahlqvist</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg13781.html">Re: Re: Questions about the Riak Hori...</a></span> <span class="sender italic">yanqun....@mesheven.com</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13786.html">Re: Re: Questions about the Riak ...</a></span> <span class="sender italic">Greg Burd</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Questions about the Riak Horizontal Scalability">
<input type="hidden" name="msgid" value="CAGLZ9HP2cA+2zKO3WjoQzPcVQHDsg=7MH_WxTV7ZgTB_RwLbeA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13775.html">
<input type="submit" value=" Christian Dahlqvist ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Questions+about+the+Riak+Horizontal+Scalability%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13774.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13781.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGLZ9HP2cA+2zKO3WjoQzPcVQHDsg=7MH_WxTV7ZgTB_RwLbeA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
