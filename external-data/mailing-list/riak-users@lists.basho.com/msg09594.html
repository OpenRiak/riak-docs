<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak Search - searching across all fields</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09594" id="c">
<link rel="index" href="maillist.html#09594" id="i">
<link rel="prev" href="msg09577.html" id="p">
<link rel="next" href="msg09611.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09594.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+%5C-+searching+across+all+fields%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak Search - searching across all fields</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matt+Painter%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matt Painter</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121214" rel="nofollow">Fri, 14 Dec 2012 21:43:52 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Thanks so much Ryan - yokozuna sounds most promising. If I were building a
small system (relatively simple, small user base) that will be
production-ready in a few months, do you think that Yokozuna could cut the
mustard? I see that it's officially an experimental prototype, but do you
think it's stable 'enough' in its current state? Sorry if this is an
impossible question to answer with too many variables...</pre><pre>

I must confess that using a forked Riak makes me a touch queasy for
anything other than playpen stuff. Do you think that a combo deal of Riak +
elasticsearch could be a suitable compromise for the time-being?


On 15 December 2012 06:13, Ryan Zezeski &lt;rzeze...@basho.com&gt; wrote:

&gt; Matt, comments inline
&gt;
&gt;
&gt; On Tue, Dec 11, 2012 at 3:35 AM, Matt Painter &lt;m...@deity.co.nz&gt; wrote:
&gt;&gt;
&gt;&gt;
&gt;&gt; Apart from a single default value, is it possible for Riak Search to
&gt;&gt; search for a keyword across all fields in a document without having to
&gt;&gt; specify the field up front as a prefix in one's search term?
&gt;&gt;
&gt;
&gt; A field must be specified to search, but a default field may be specified
&gt; in the schema [1].  This field will be searched if one is not specified.
&gt;  But there is no way to do a search against all fields.  It is always over
&gt; one field.
&gt;
&gt;
&gt;&gt; I'm guessing that one solution could be a post-commit hook which
&gt;&gt; recursively iterates over all fields and squashes them into a secondary
&gt;&gt; default value field - but since I know even less about Erlang and am just
&gt;&gt; starting out with Riak, I thought it prudent to see if there was a more
&gt;&gt; straightforward solution...
&gt;&gt;
&gt;
&gt; Your use case immediately makes me think of Solr copy fields.  You index
&gt; everything under their individual fields but all values get copied into a
&gt; catch-all field so that all content may be searched easily.  However, with
&gt; this you lose the ability to know which field it came from.  Riak Search
&gt; doesn't have copy field functionality.  You'd have to concatenate all the
&gt; data into a field on your application side.  The new search solution I've
&gt; been working on, Yokozuna, uses Solr underneath and therefore does support
&gt; copy fields [2].
&gt;
&gt; You could create a pre-commit hook to do this field-squashing but I think
&gt; you would be better off doing it in your application.  To do it via a hook
&gt; you'd have to make sure it runs before the search hook (I can't remember if
&gt; you can force specific order of pre-commit hooks).  It would also have an
&gt; effect on your write latencies as more pre-processing would have to be
&gt; done.  Finally, you would have to write Erlang.
&gt;
&gt;
&gt;&gt; The use case is this:
&gt;&gt;
&gt;&gt; We are providing an object + metadata store for users to deposit files
&gt;&gt; and any number of related fragments of structured JSON metadata. We are not
&gt;&gt; enforcing any metadata schema - and therefore can't know up-front any field
&gt;&gt; names - but would like the ability for a dumb keyword search from a website
&gt;&gt; to return references to the records they have deposited in
&gt;&gt; Riak. Essentially, providing a Google-like interface.
&gt;&gt;
&gt;&gt; (As a side question, Is Riak Search mature enough for these type of very
&gt;&gt; generic searches? I know that it's &quot;inspired by&quot; Lucene and &quot;Lucene-like&quot;,
&gt;&gt; but I don't know how many of Lucene's goodies are present - or is it just a
&gt;&gt; case of invoking analysers provided by Lucene for things like stemming, and
&gt;&gt; all will be pretty much equivalent for most situations?)
&gt;&gt;
&gt;
&gt; There are no &quot;goodies present&quot; _at all_.  Riak Search is an in-house
&gt; implementation, completely written in Erlang.  It's only connection to
&gt; Lucene/Solr is a superficial interface that looks very much like
&gt; Lucene/Solr.  E.g. you mention stemming, there is no stemming support in
&gt; Riak Search and would be a non-trivial addition.  This is one of the big
&gt; reasons Yokozuna is being written [2].  The world of search is vast and
&gt; complicated, best to start with proven solution and build from that.
&gt;
&gt; Riak Search generally starts causing pain when you have searches that
&gt; match tens of thousands of documents.  The runtime is proportional to the
&gt; size of the result set.  In fact, Riak Search has a hard-coded upper limit
&gt; to fail queries that match 100K or more documents (although it does the
&gt; work to get 100K results and then drops it all on the floor so you still
&gt; use resources/times).  For example, if a lot of your files were pictures
&gt; and were tagged with something like {&quot;type&quot;:&quot;picture&quot;} then a search for
&gt; &quot;picture&quot; is probably going to cause issues.  Things really start to hurt
&gt; when you do conjunction queries with multiple large result sets, e.g.
&gt; &quot;funny AND picture&quot;.  Once again, this is not the case with Yokozuna, which
&gt; in my benchmarking thus far has shown flat latencies regardless of result
&gt; set size.
&gt;
&gt; -Z
&gt;
&gt; [1]:
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/Riak-Search---Schema/#Defining-a-Schema">http://docs.basho.com/riak/latest/cookbooks/Riak-Search---Schema/#Defining-a-Schema</a>
&gt;
&gt; [2]: <a  rel="nofollow" href="https://github.com/rzezeski/yokozuna">https://github.com/rzezeski/yokozuna</a>
&gt;



-- 
Matt Painter
m...@deity.co.nz
+64 21 115 9378
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09577.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09594">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09594">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09611.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09520.html">Riak Search - searching across all fields</a></span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09577.html">Re: Riak Search - searching across all fields</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak Search - searching across all fields</span> <span class="sender italic">Matt Painter</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09611.html">Re: Riak Search - searching across all fiel...</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09612.html">Re: Riak Search - searching across all ...</a></span> <span class="sender italic">Mark Phillips</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg09622.html">Re: Riak Search - searching across all fiel...</a></span> <span class="sender italic">Alexander Sicular</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak Search - searching across all fields">
<input type="hidden" name="msgid" value="CAOe2jMKur0pL_CQ6uB=O+BvFK0Nem3=oOzNX-WAGWURiw4sChw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09594.html">
<input type="submit" value=" Matt Painter ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+Search+%5C-+searching+across+all+fields%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09577.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09611.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAOe2jMKur0pL_CQ6uB=O+BvFK0Nem3=oOzNX-WAGWURiw4sChw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
