<!DOCTYPE html>
<html lang="en">
<head>
<title>Errors, 'preflist_exhausted' & 'worker_limit_reached' when trying to	read data from Riak</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07921" id="c">
<link rel="index" href="maillist.html#07921" id="i">
<link rel="prev" href="msg07918.html" id="p">
<link rel="next" href="msg08074.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07921.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Errors%2C+%27preflist_exhausted%27+%5C%26+%27worker_limit_reached%27+when+trying+to%09read+data+from+Riak%22&amp;o=newest" rel="nofollow"><span itemprop="name">Errors, 'preflist_exhausted' & 'worker_limit_reached' when trying to	read data from Riak</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Balamurugan+V+G%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Balamurugan V G</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120713" rel="nofollow">Fri, 13 Jul 2012 07:49:01 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

I am trying to get started with Riak, so installed the
'riak_1.1.4-1_i386.deb' on a Ubuntu 12.04 LTS 32bit System running in a
Virtual Box VM. I no not have any cluster.</pre><pre>

I have a script which does the following:

1. It creates 50 child processes which run in parallel
2. Each Child process does the following
     a. Creates 1000 entries using the provides REST interface. The entry
is a simple json value with 4 attributes and an integer key. This goes
through fine.

         The Json object is something like {&quot;name&quot;: &quot;Test1&quot;, &quot;title&quot;: &quot;This
is the title for Test1&quot;, &quot;count&quot;: 1, &quot;pid&quot;: 1234}. The pid is the process
ID of the process creating the entry. I later use this to query the entries
created by the process.

     b. Reads the entries created by it. A Javascript Map function which is
stored as an object is used to filter and return only the entries created
by the process


During the reads, I get the following errors in HTTP response:


{&quot;phase&quot;:0,&quot;error&quot;:&quot;[worker_limit_reached]&quot;,&quot;input&quot;:&quot;{&lt;&lt;\&quot;samples\&quot;&gt;&gt;,&lt;&lt;\&quot;11505823\&quot;&gt;&gt;}&quot;,&quot;type&quot;:&quot;result&quot;,&quot;stack&quot;:&quot;[]&quot;}

and

{&quot;phase&quot;:0,&quot;error&quot;:&quot;[preflist_exhausted]&quot;,&quot;input&quot;:&quot;{ok,{r_object,&lt;&lt;\&quot;samples\&quot;&gt;&gt;,&lt;&lt;\&quot;11506270\&quot;&gt;&gt;,[{r_content,{dict,7,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[&lt;&lt;\&quot;Links\&quot;&gt;&gt;]],[],[],[],[],[],[],[],[[&lt;&lt;\&quot;content-type\&quot;&gt;&gt;,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110],[&lt;&lt;\&quot;X-Riak-VTag\&quot;&gt;&gt;,78,109,90,48,101,81,88,51,55,54,85,120,120,115,68,101,71,108,76,77,71]],[[&lt;&lt;\&quot;index\&quot;&gt;&gt;]],[],[[&lt;&lt;\&quot;X-Riak-Last-Modified\&quot;&gt;&gt;|{1342,87419,992551}]],[],[[&lt;&lt;\&quot;charset\&quot;&gt;&gt;,85,84,70,45,56],[&lt;&lt;\&quot;X-Riak-Meta\&quot;&gt;&gt;]]}}},&lt;&lt;\&quot;{
\\n            ...\&quot;&gt;&gt;}],...},...}&quot;,&quot;type&quot;:&quot;forward_preflist&quot;,&quot;stack&quot;:&quot;[]&quot;}

The crash log has these:

2012-07-12 15:24:10 =ERROR REPORT====
Module riak_kv_pipe_get must be purged before loading

2012-07-12 15:24:10 =ERROR REPORT====
Loading of /usr/lib/riak/lib/riak_kv-1.1.4/ebin/riak_kv_pipe_get.beam
failed: not_purged
2012-07-12 15:24:10 =ERROR REPORT====
Module riak_kv_pipe_get must be purged before loading

2012-07-12 15:24:10 =ERROR REPORT====
Loading of /usr/lib/riak/lib/riak_kv-1.1.4/ebin/riak_kv_pipe_get.beam
failed: not_purged
2012-07-12 15:24:10 =ERROR REPORT====
Module riak_kv_pipe_get must be purged before loading

2012-07-12 15:24:10 =ERROR REPORT====
Loading of /usr/lib/riak/lib/riak_kv-1.1.4/ebin/riak_kv_pipe_get.beam
failed: not_purged
2012-07-12 15:24:10 =ERROR REPORT====
Module riak_kv_mrc_map must be purged before loading

2012-07-12 15:24:10 =ERROR REPORT====
Loading of /usr/lib/riak/lib/riak_kv-1.1.4/ebin/riak_kv_mrc_map.beam
failed: not_purged
2012-07-12 15:24:10 =ERROR REPORT====
Module riak_kv_mrc_map must be purged before loading

2012-07-12 15:24:10 =ERROR REPORT====
Loading of /usr/lib/riak/lib/riak_kv-1.1.4/ebin/riak_kv_mrc_map.beam
failed: not_purged
2012-07-12 15:24:10 =ERROR REPORT====
Loading of /usr/lib/riak/lib/riak_kv-1.1.4/ebin/riak_kv_mrc_map.beam
failed: not_purged
2012-07-12 15:24:11 =ERROR REPORT====
Module riak_kv_mrc_map must be purged before loading

2012-07-12 15:24:12 =CRASH REPORT====
  crasher:
    initial call: riak_pipe_vnode_worker:init/1
    pid: &lt;0.2303.0&gt;
    registered_name: []
    exception exit:
{init_failed,error,{case_clause,{error,{insufficient_vnodes,0,need,1}}}}
      in function  gen_fsm:init_it/6
      in call from proc_lib:init_p_do_apply/3
    ancestors:
[&lt;0.340.0&gt;,&lt;0.339.0&gt;,riak_core_vnode_sup,riak_core_sup,&lt;0.93.0&gt;]
    messages: []
    links: [&lt;0.340.0&gt;]
    dictionary:
[{eunit,[{module,riak_pipe_vnode_worker},{partition,1050454301831586472458898473514828420377701515264},{&lt;0.339.0&gt;,&lt;0.339.0&gt;},{details,{fitting_details,{fitting,&lt;0.1136.0&gt;,#Ref&lt;0.0.0.2622&gt;,follow,1},0,riak_kv_mrc_map,{{jsanon,{&lt;&lt;&quot;functions&quot;&gt;&gt;,&lt;&lt;&quot;get_by_pid&quot;&gt;&gt;}},11043},{fitting,&lt;0.799.0&gt;,#Ref&lt;0.0.0.2622&gt;,sink,undefined},[{sink,{fitting,&lt;0.799.0&gt;,#Ref&lt;0.0.0.2622&gt;,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64}}]}]
    trap_exit: false
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 256
  neighbours:
2012-07-12 15:24:12 =SUPERVISOR REPORT====
     Supervisor: {&lt;0.340.0&gt;,riak_pipe_vnode_worker_sup}
     Context:    child_terminated
     Reason:
{init_failed,error,{case_clause,{error,{insufficient_vnodes,0,need,1}}}}
     Offender:
[{pid,&lt;0.2303.0&gt;},{name,undefined},{mfargs,{riak_pipe_vnode_worker,start_link,undefined}},{restart_type,temporary},{shutdown,2000},{child_type,worker}]


I did search the Basho site for the error messages and found that some
configurtion changes in app.config and setting ulimit might help. But that
didnt solve my problem.

My ulimit is set as 'ulimit -n 4096'. I have also done the following
changes to the app.config:

diff /etc/riak/app.config /etc/riak/orig.app.config
65c65
&lt;             %% {pb_backlog, 500},
---
&gt;             %% {pb_backlog, 5},
80d79
&lt;             {riak_pipe, [{worker_limit, 1000}]},
97,99c96,98
&lt;             {map_js_vm_count, 2048 },
&lt;             {reduce_js_vm_count, 2048 },
&lt;             {hook_js_vm_count, 2048 },
---
&gt;             {map_js_vm_count, 8 },
&gt;             {reduce_js_vm_count, 6 },
&gt;             {hook_js_vm_count, 2 },
110c109
&lt;             {js_max_vm_mem, 800},
---
&gt;             {js_max_vm_mem, 8},
115c114
&lt;             {js_thread_stack, 1600},
---
&gt;             {js_thread_stack, 16},


Any pointers for this issue will be helpful.

Regards,
Balu
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07918.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07921">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07921">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08074.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Errors, 'preflist_exhausted' &amp; 'worker_limit_reached' ...</span> <span class="sender italic">Balamurugan V G</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08074.html">Re: Errors, 'preflist_exhausted' &amp; 'worker_limit_...</a></span> <span class="sender italic">Balamurugan V G</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Errors, 'preflist_exhausted' &amp; 'worker_limit_reached' when trying to	read data from Riak">
<input type="hidden" name="msgid" value="CABsschSNAccrD66cw4huHm_tDPbjnJ8czPsV_CkLxPGO7J+Z=g@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07921.html">
<input type="submit" value=" Balamurugan V G ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Errors%2C+%27preflist_exhausted%27+%5C%26+%27worker_limit_reached%27+when+trying+to%09read+data+from+Riak%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07918.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08074.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CABsschSNAccrD66cw4huHm_tDPbjnJ8czPsV_CkLxPGO7J+Z=g@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
