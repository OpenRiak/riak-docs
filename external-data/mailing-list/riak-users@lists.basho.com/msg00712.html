<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Bitcask & Innostore Benchmark @ EC2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00712" id="c">
<link rel="index" href="maillist.html#00712" id="i">
<link rel="prev" href="msg00709.html" id="p">
<link rel="next" href="msg00713.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00712.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bitcask+%5C%26+Innostore+Benchmark+%40+EC2%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Bitcask & Innostore Benchmark @ EC2</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100712" rel="nofollow">Mon, 12 Jul 2010 06:03:16 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>James,

One thing you might try is lowering the concurrency rate. &quot;max&quot; mode at even 
5-10 workers is enough to saturate most networks (the most I've ever run has 
been 15).  Whether that is an accurate representation of your production load 
is another story entirely, and an &quot;exercise for the reader&quot;.</pre><pre>

Sean Cribbs &lt;s...@basho.com&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On Jul 11, 2010, at 11:52 PM, James Sadler wrote:

&gt; Hi All,
&gt; 
&gt; I've been benchmarking Riak using basho_bench on an EC2 m1.large
&gt; instance and also running locally on my iMac inside VirtualBox to
&gt; assess performance of the Bitcask and Innostore backends
&gt; 
&gt; The test configuration looks like this:
&gt; 
&gt; {mode, max}.
&gt; {duration, 10}.
&gt; {concurrent, 50}.
&gt; {driver, basho_bench_driver_http_raw}.
&gt; {code_paths, [&quot;deps/stats&quot;,
&gt;              &quot;deps/ibrowse&quot;]}.
&gt; %% a composite key composed of 4 IDs, each of which is a 16 char hex string,
&gt; %% specific to our data model.
&gt; {key_generator, {random_dynamo_style_string, 35000}}.
&gt; {value_generator, {fixed_bin, 1000}}.
&gt; {operations, [{get, 1}, {update, 2}]}.
&gt; {http_raw_ips, [&quot;127.0.0.1&quot;]}.
&gt; 
&gt; Also, to generate the 'random_dynamo_style_string', I made the
&gt; following changes to the bash_bench source:
&gt; 
&gt; diff --git a/src/basho_bench_keygen.erl b/src/basho_bench_keygen.erl
&gt; index 4849bbe..639e90b 100644
&gt; --- a/src/basho_bench_keygen.erl
&gt; +++ b/src/basho_bench_keygen.erl
&gt; @@ -54,6 +54,13 @@ new({pareto_int, MaxKey}, _Id) -&gt;
&gt; new({pareto_int_bin, MaxKey}, _Id) -&gt;
&gt;     Pareto = pareto(trunc(MaxKey * 0.2), ?PARETO_SHAPE),
&gt;     fun() -&gt; &lt;&lt;(Pareto()):32/native&gt;&gt; end;
&gt; +new({random_dynamo_style_string, MaxKey}, _Id) -&gt;
&gt; +    fun() -&gt; lists:concat([
&gt; +                    get_random_string(16, &quot;0123456789abcdef&quot;), &quot;-&quot;,
&gt; +                    get_random_string(16, &quot;0123456789abcdef&quot;), &quot;-&quot;,
&gt; +                    get_random_string(16, &quot;0123456789abcdef&quot;), &quot;-&quot;,
&gt; +                    get_random_string(16, &quot;0123456789abcdef&quot;)])
&gt; +    end;
&gt; new(Other, _Id) -&gt;
&gt;     ?FAIL_MSG(&quot;Unsupported key generator requested: ~p\n&quot;, [Other]).
&gt; 
&gt; @@ -74,10 +81,17 @@ dimension({pareto_int, _}) -&gt;
&gt;     0.0;
&gt; dimension({pareto_int_bin, _}) -&gt;
&gt;     0.0;
&gt; +dimension({random_dynamo_style_string, MaxKey}) -&gt;
&gt; +    0.0;
&gt; dimension(Other) -&gt;
&gt;     ?FAIL_MSG(&quot;Unsupported key generator dimension requested: ~p\n&quot;, [Other]).
&gt; 
&gt; -
&gt; +get_random_string(Length, AllowedChars) -&gt;
&gt; +    lists:foldl(fun(_, Acc) -&gt;
&gt; +                        [lists:nth(random:uniform(length(AllowedChars)),
&gt; +                                   AllowedChars)]
&gt; +                            ++ Acc
&gt; +                end, [], lists:seq(1, Length)).
&gt; 
&gt; 
&gt; %% ====================================================================
&gt; 
&gt; 
&gt; As of now, I've only been running the benchmark with a 'cluster' of
&gt; one single Riak node, and I have benchmarked with bitcask and
&gt; innostore backends on the latest version of Riak (0.11.0-1344) and
&gt; innostore (1.0.0-88) on Ubuntu Lucid.  I have also been running the
&gt; basho_bench on the same host as the Riak node.
&gt; 
&gt; The benchmarks are showing very high get and update latencies in the
&gt; 95th percentile and beyond when using Innostore as the backend.
&gt; Bitcask performance is much better.
&gt; 
&gt; While running the benchmarks, I had an iostat process reporting IO
&gt; every 1 second.  It clearly showed heavy writes during the benchmark,
&gt; but practically zero reads.  I expect that this was because of the
&gt; disk cache.  What I found very surprising was that the latencies for
&gt; innostore gets during the benchmark were very high, even though the
&gt; disk was not being hit for reads at all.  This was reproducible on
&gt; both EC2 and on a local VM on my iMac.
&gt; 
&gt; Observations:
&gt; 
&gt; ## Innostore backend
&gt; 
&gt; - Latencies for innostore are high across the board. Even for reads,
&gt; __when iostat is reporting that no reads are hitting the disk__.
&gt; 
&gt; - 95th percentile read/write latencies are up to 1500/2000 millis.
&gt; 
&gt; - 99th percentile reads/writes are up to 2000/4000 millis.
&gt; 
&gt; - The difference between update and get latency is small.
&gt; 
&gt; - There are some failed (timeouts) updates/gets in log file produced
&gt; by basho_bench
&gt; 
&gt; - Throughput with innostore backend is 150-200 req/sec
&gt; 
&gt; - Mounting the filesystem with noatime doesn't seem to make much of a
&gt; difference.
&gt; 
&gt; - Getting values from disk cache has huge latency (iostat reporting no
&gt; reads on the device).  This is somewhat bizarre.
&gt; 
&gt; ## Bitcask backend
&gt; 
&gt; - There are zero errors in the log produced by bash_bench (no timeouts
&gt; like with innostore)
&gt; 
&gt; - Throughput is much higher: 620 req/sec
&gt; 
&gt; - The 99.9th percentile latencies are 200ms for writes, and for reads 100ms
&gt; 
&gt; - The 95th percentile latencies are 160ms for writes and 60ms for reads
&gt; 
&gt; - Mean &amp; median latencies are 115ms for writes and 20ms for reads.
&gt; 
&gt; Summary charts from basho_bench are attached.
&gt; 
&gt; 
&gt; NOTE:
&gt; 
&gt; I haven't included benchmark results from my own local VM.  FWIW, I
&gt; observed the approximately same characteristics in the EC2 and local
&gt; benchmarks.
&gt; 
&gt; In summary, it looks like there are significant performance issues
&gt; with Innostore in terms of throughput and latency.  Latency is the
&gt; biggest issue for our ad serving product at Lexer, so it looks like
&gt; we'll be using Bitcask in production.
&gt; 
&gt; Hopefully these results will be useful to others.
&gt; 
&gt; Also, given our large key size of 67 characters, combined with the
&gt; Bitcask's padding and storage layout, how many keys should we be able
&gt; to manager per node per GB?
&gt; 
&gt; Looking forward to any comments.
&gt; 
&gt; Thanks.
&gt; 
&gt; -- 
&gt; James
&gt; &lt;summary_bitcask_ec2.png&gt;&lt;summary_innostore_ec2.png&gt;_______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00709.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00712">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00712">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00713.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Re: Bitcask &amp; Innostore Benchmark @ EC2</span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00713.html">Re: Bitcask &amp; Innostore Benchmark @ EC2</a></span> <span class="sender italic">James Sadler</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Bitcask &amp; Innostore Benchmark @ EC2">
<input type="hidden" name="msgid" value="AA5D0497-4504-46E3-BC99-42622895826D@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00712.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Bitcask+%5C%26+Innostore+Benchmark+%40+EC2%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00709.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00713.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AA5D0497-4504-46E3-BC99-42622895826D@basho.com</li>
</ul>
</div>
</body>
</html>
