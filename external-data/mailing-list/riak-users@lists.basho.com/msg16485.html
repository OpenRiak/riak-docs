<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: What's the maximum seconds to set index on bucket after creating	the index</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#16485" id="c">
<link rel="index" href="maillist.html#16485" id="i">
<link rel="prev" href="msg16484.html" id="p">
<link rel="next" href="msg16486.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg16485.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+What%27s+the+maximum+seconds+to+set+index+on+bucket+after+creating%09the+index%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: What's the maximum seconds to set index on bucket after creating	the index</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Fred+Dushin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Fred Dushin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150902" rel="nofollow">Wed, 02 Sep 2015 05:15:14 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>What is the return value you are getting from 
rick_pb_socket:create_search_index?  If it's ok, then the Solr cores should 
have been created on all nodes.  Otherwise, you should check the logs for 
timeout messages, e.g.,</pre><pre>

<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.1/src/yz_index.erl#L443">https://github.com/basho/yokozuna/blob/2.1.1/src/yz_index.erl#L443</a> 
&lt;<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.1/src/yz_index.erl#L443">https://github.com/basho/yokozuna/blob/2.1.1/src/yz_index.erl#L443</a>&gt;

If you are getting timeouts, instead of sleeping, you should probably query 
your cluster for the search index, along the lines of what is done in one of 
the riak tests, e.g.,

<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.1/riak_test/yz_pb.erl#L100">https://github.com/basho/yokozuna/blob/2.1.1/riak_test/yz_pb.erl#L100</a> 
&lt;<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.1/riak_test/yz_pb.erl#L100">https://github.com/basho/yokozuna/blob/2.1.1/riak_test/yz_pb.erl#L100</a>&gt;

If necessary, you might want to fold over all nodes in your cluster, to ensure 
the index has been propagated to all nodes, and possibly use the wait_for 
patterns used in the tests.

Unfortunately, it looks like the internal timeout used to wait for propagation 
of indexes to all nodes is not configurable -- it defaults to 45 seconds:

<a  rel="nofollow" href="https://github.com/basho/yokozuna/blob/2.1.1/include/yokozuna.hrl#L134">https://github.com/basho/yokozuna/blob/2.1.1/include/yokozuna.hrl#L134</a>

I hope that helps,

-Fred

&gt; On Sep 2, 2015, at 6:27 AM, Hao &lt;jusf...@163.com&gt; wrote:
&gt; 
&gt; Hi,
&gt; 
&gt; What's the maximum seconds to wait after creating an search index and before 
&gt; setting it on the bucket?
&gt; 
&gt; On my local machine, I only need to wait 1 second, sometimes I feel I don't 
&gt; need to wait at all, but on a production server which is basically zero 
&gt; traffic, I have to wait about 10 seconds(definitely over 5s) before I can set 
&gt; the index on a bucket.
&gt; 
&gt; I am using riakc_pb_socket client. At first I thought something wrong with my 
&gt; function to &quot;create&quot; and &quot;set&quot; the index but then when I split the process, 
&gt; it's fine. So seems it's the interval in between that matters.
&gt; 
&gt; I need to know how long is the maximum because I need to restore a lot of 
&gt; buckets and set index on them via a script. I don't care how long it takes 
&gt; but I don't want it to miss any index not being set on the bucket.
&gt; 
&gt; The exact error on the console when I set the index on a bucket is
&gt; 
&gt; &lt;&lt;&quot;Invalid bucket properties: [{search_index,\n 
&gt; &lt;&lt;\&quot;application_test_player_idx does not exist\&quot;&gt;&gt;}]&quot;&gt;&gt;
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Thanks,
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Hao
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg16484.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#16485">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#16485">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg16486.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg16484.html">What's the maximum seconds to set index on bucket after c...</a></span> <span class="sender italic">Hao</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: What's the maximum seconds to set index on bucke...</span> <span class="sender italic">Fred Dushin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16486.html">Re: What's the maximum seconds to set index on b...</a></span> <span class="sender italic">Fred Dushin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16487.html">Re: What's the maximum seconds to set index ...</a></span> <span class="sender italic">Alex Moore</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16488.html">Re: What's the maximum seconds to set in...</a></span> <span class="sender italic">Hao</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg16489.html">Re: What's the maximum seconds to s...</a></span> <span class="sender italic">zlakhani</span></li>
<li class="icons-email"><span class="subject"><a href="msg16490.html">Re: What's the maximum seconds to s...</a></span> <span class="sender italic">Dmitri Zagidulin</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: What's the maximum seconds to set index on bucket after creating	the index">
<input type="hidden" name="msgid" value="8BACD8C2-320D-47DE-B1BC-73CD5043BA0C@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg16485.html">
<input type="submit" value=" Fred Dushin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+What%27s+the+maximum+seconds+to+set+index+on+bucket+after+creating%09the+index%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg16484.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg16486.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">8BACD8C2-320D-47DE-B1BC-73CD5043BA0C@basho.com</li>
</ul>
</div>
</body>
</html>
