<!DOCTYPE html>
<html lang="en">
<head>
<title>Determining when Riak KV CRDT update has been reflected in Solr</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17825" id="c">
<link rel="index" href="maillist.html#17825" id="i">
<link rel="prev" href="msg17820.html" id="p">
<link rel="next" href="msg17831.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17825.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Determining+when+Riak+KV+CRDT+update+has+been+reflected+in+Solr%22&amp;o=newest" rel="nofollow"><span itemprop="name">Determining when Riak KV CRDT update has been reflected in Solr</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Luca+Favatella%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Luca Favatella</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20161230" rel="nofollow">Fri, 30 Dec 2016 11:36:08 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

How can a Riak KV client determine when a certain CRDT update
operation propagated to Solr?</pre><pre>


I am aware that Solr gets updated asynchronously from Riak KV. I
scripted the test and this is noticeable - at the moment in my test I
sleep for 2 seconds after updating before searching (or the search may
not reflect the update). This is ok and expected.

I wonder if there is a way for the client to &quot;wait until&quot; Solr is
up-to-date to a certain CRDT context the client observed. Something
like:
* Client updates CRDT in KV and reads CRDT context C1;
* Client polls Solr passing CRDT bucket-key and context C1.


I am also aware that Riak has an AAE mechanism checking whether Solr
is up to date to a certain snapshot of Riak KV, using hash trees, and
repairing Solr if necessary. I understand that Riak employs an
algorithm for checking discrepancies between KV and Solr that is prone
to false positives - i.e. over-detecting differences hence
over-repairing. I have not looked at the internals.

Such AAE KV-Solr comparison algorithm has to be able to compare leaves
of the tree too, that I understand each being a hash containing zero
or more Riak KV objects. Hence from the bucket-key I shall be able to
derive the hash of the Riak KV object, and use that for checking the
corresponding element in Solr. This may require conversion from CRDT
context to Riak KV object vclock but that would be ok - it would just
include potential siblings in the Riak object (possible in corner
cases even if CRDT I understand).


I am designing a kind of document store, storing documents in Riak KV
as CRDTs and using Solr for search. CRDT updates are infrequent -
either by humans of potentially in batches of CRDT update operations
accumulated while offline. The user, after performing updates, may
perform a search. I am trying to understand if I can provide the user
with the visibility of whether his/her updates are &quot;supposed to have
been reflected&quot; in the search results already (or perform a sort of
remedy to-be-defined).


Thanks and regards
Luca

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17820.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17825">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17825">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17831.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Determining when Riak KV CRDT update has been reflected in Solr">
<input type="hidden" name="msgid" value="CA+-vOLj4SZJJBxRvXWQ2HRsFe30ABQU5UGv8boLO0gp+Z08OEA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17825.html">
<input type="submit" value=" Luca Favatella ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Determining+when+Riak+KV+CRDT+update+has+been+reflected+in+Solr%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17820.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17831.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CA+-vOLj4SZJJBxRvXWQ2HRsFe30ABQU5UGv8boLO0gp+Z08OEA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
