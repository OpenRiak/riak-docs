<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: riakc doesn't save metadata properly?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09057" id="c">
<link rel="index" href="maillist.html#09057" id="i">
<link rel="prev" href="msg09012.html" id="p">
<link rel="next" href="msg09021.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09057.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riakc+doesn%27t+save+metadata+properly%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: riakc doesn't save metadata properly?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22David+Parfitt%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">David Parfitt</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121025" rel="nofollow">Thu, 25 Oct 2012 05:32:47 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hello Christian -

   I believe this is an inconsistency in the HTTP vs PB custom
metadata APIs. We'll be revisiting this code at some point to clean
things up. In the meantime, would you mind filing an issue at [1] so
we don't lose track of this?</pre><pre>

Cheers -
Dave

[1] <a  rel="nofollow" href="https://github.com/basho/riak-erlang-client">https://github.com/basho/riak-erlang-client</a>


On Tue, Oct 23, 2012 at 12:48 AM, Christian Dahlqvist
&lt;christ...@whitenode.com&gt; wrote:
&gt; On 22/10/2012 22:25, David Parfitt wrote:
&gt;
&gt; Hello Metin -
&gt;
&gt; I'm trying to get that into the docs right now. Will italics do? :-)
&gt; <a  rel="nofollow" href="https://github.com/basho/riak-erlang-client/pull/74">https://github.com/basho/riak-erlang-client/pull/74</a>
&gt;
&gt; Cheers -
&gt; Dave
&gt;
&gt; On Mon, Oct 22, 2012 at 5:22 PM, Metin Akat &lt;akat.me...@gmail.com&gt; wrote:
&gt;
&gt; Oh, I see, thanks for this clarification, much appreciated.
&gt; I think this should be written somewhere in bold, as 3 days later, I still
&gt; wasn't able to find anything on google.
&gt;
&gt;
&gt; On Tue, Oct 23, 2012 at 12:08 AM, David Parfitt &lt;dparf...@basho.com&gt; wrote:
&gt;
&gt; Hello Metin -
&gt;
&gt;   Sorry for the delay. At the moment, all metadata needs to be stored
&gt; under the &lt;&lt;&quot;X-Riak-Meta&quot;&gt;&gt; dict key. The following example
&gt; illustrates how this works:
&gt;
&gt; %% To store metadata:
&gt; Object = riakc_obj:new(&lt;&lt;&quot;groceries&quot;&gt;&gt;, &lt;&lt;&quot;mine&quot;&gt;&gt;, &lt;&lt;&quot;eggs &amp; bacon&quot;&gt;&gt;).
&gt; MetaData  = dict:from_list([{&lt;&lt;&quot;X-Riak-Meta&quot;&gt;&gt;, [{&quot;Foo&quot;, &quot;Bar&quot;}]}]),
&gt; Object2 = riakc_obj:update_metadata(Object, MetaData).
&gt; riakc_pb_socket:put(Pid, Object2).
&gt;
&gt; %% To retrieve metadata:
&gt; {ok, O} = riakc_pb_socket:get(Pid, &lt;&lt;&quot;groceries&quot;&gt;&gt;, &lt;&lt;&quot;mine&quot;&gt;&gt;).
&gt; {ok, MD} = dict:find(&lt;&lt;&quot;X-Riak-Meta&quot;&gt;&gt;, riakc_obj:get_metadata(O)).
&gt;
&gt; We're kicking around ways to improve this in the future.
&gt;
&gt; Cheers -
&gt; Dave
&gt;
&gt; On Fri, Oct 19, 2012 at 8:31 AM, Metin Akat &lt;akat.me...@gmail.com&gt; wrote:
&gt;
&gt; I am trying to do something like:
&gt;
&gt;     Meta1 = dict:store(&lt;&lt;&quot;ver&quot;&gt;&gt;, Ver, Meta0),
&gt;     Obj1 = riakc_obj:update_metadata(Obj, Meta1),
&gt;
&gt; and then save the object. But on a subsequent read, the metadata k/v
&gt; pair is
&gt; not there.
&gt;
&gt; Is there anything special that needs to be done for this to work, or is
&gt; this
&gt; illegal way to use Riak?
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
&gt; Hi,
&gt;
&gt; As far as I can see there seems to be an inconsistency between the Erlang
&gt; and HTTP APIs with respect to how metadata is handled.
&gt;
&gt; When I query the record created in the example through the Erlang API
&gt; (attached to console) I, as expected, get the following:
&gt;
&gt;     {ok, RO} = C:get(&lt;&lt;&quot;groceries&quot;&gt;&gt;, &lt;&lt;&quot;mine&quot;&gt;&gt;).
&gt;     {ok, MD} = dict:find(&lt;&lt;&quot;X-Riak-Meta&quot;&gt;&gt;, riak_object:get_metadata(RO)).
&gt;     {ok,[{&quot;Foo&quot;,&quot;Bar&quot;}]}
&gt;
&gt; The metadata parameter is stored in the dictionary exactly as created, which
&gt; is expected.
&gt;
&gt; When I query this record through the HTTP interface the same metadata is
&gt; returned as a header:
&gt;
&gt;     curl -v -X HEAD <a  rel="nofollow" href="http://localhost:8098/riak/groceries/mine">http://localhost:8098/riak/groceries/mine</a>
&gt;     &gt; HEAD /riak/groceries/mine HTTP/1.1
&gt;     &gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4
&gt; OpenSSL/0.9.8r zlib/1.2.5
&gt;     &gt; Host: localhost:8098
&gt;     &gt; Accept: */*
&gt;     &gt;
&gt;     &lt; HTTP/1.1 200 OK
&gt;     &lt; X-Riak-Vclock: a85hYGBgzGDKBVIcypz/fga0yrzJYEpkzGNlEG36dZIvCwA=
&gt;     &lt; Vary: Accept-Encoding
&gt;     &lt; Server: MochiWeb/1.1 WebMachine/1.9.2 (someone had painted it blue)
&gt;     &lt; Link: &lt;/riak/groceries&gt;; rel=&quot;up&quot;
&gt;     &lt; Foo: Bar
&gt;     &lt; ETag: &quot;5hdCr8ayy5j9orqA6nDJfs&quot;
&gt;     &lt; Content-Type: application/octet-stream
&gt;     &lt; Content-Length: 12
&gt;     &lt;
&gt;
&gt; When I tried to create another record with the same metadata as the first
&gt; one through the HTTP interface, I had to prefix the metadata with
&gt; &quot;X-Riak-Meta-&quot; in order for it to be saved on the record. When I did this
&gt; the interface did however not seem to strip the &quot;X-Riak-Meta-&quot; prefix from
&gt; the parameter, and when I query the record through the Erlang API, the
&gt; parameter is stored in the metadata dict as &quot;X-Riak-Meta-Foo&quot; instead of
&gt; just &quot;Foo&quot;.
&gt;
&gt; I was expecting the parameter to be stored as &quot;Foo&quot; internally in Riak and
&gt; represented as &quot;X-Riak-Meta-Foo&quot; when getting or setting through the HTTP
&gt; API, but that does not seem to be the case.
&gt;
&gt; Is this an inconsistency or is there something I am doing wrong or have
&gt; missed here?
&gt;
&gt; Best regards,
&gt;
&gt; Christian
&gt;
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09012.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09057">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09057">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09021.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09005.html">Re: riakc doesn't save metadata properly?</a></span> <span class="sender italic">David Parfitt</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09006.html">Re: riakc doesn't save metadata properly?</a></span> <span class="sender italic">Metin Akat</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09007.html">Re: riakc doesn't save metadata properly?</a></span> <span class="sender italic">David Parfitt</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09008.html">Re: riakc doesn't save metadata properly?</a></span> <span class="sender italic">Metin Akat</span></li>
<li class="icons-email"><span class="subject"><a href="msg09012.html">Re: riakc doesn't save metadata properly?</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: riakc doesn't save metadata prope...</span> <span class="sender italic">David Parfitt</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: riakc doesn't save metadata properly?">
<input type="hidden" name="msgid" value="CAORywPFDyU-xcHzXiz-cEsSQmjbzSLiEEu-3G5t9vdQ_KXou-w@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09057.html">
<input type="submit" value=" David Parfitt ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+riakc+doesn%27t+save+metadata+properly%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09012.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09021.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAORywPFDyU-xcHzXiz-cEsSQmjbzSLiEEu-3G5t9vdQ_KXou-w@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
