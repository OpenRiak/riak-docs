<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: innostore performance tuning</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#04511" id="c">
<link rel="index" href="maillist.html#04511" id="i">
<link rel="prev" href="msg04510.html" id="p">
<link rel="next" href="msg04513.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg04511.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+innostore+performance+tuning%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: innostore performance tuning</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremiah+Peschka%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremiah Peschka</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110830" rel="nofollow">Tue, 30 Aug 2011 09:52:05 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>InnoStore is going to insert the data in key order. When you attempt to insert 
a record that would fit in between two keys (inserting &quot;apple&quot; between 
&quot;aardvark&quot; and &quot;Byzantium&quot;) you're probably going to get a page split, just 
like in an RDBMS. The data needs to be re-shuffled in order to write it in key 
order. Despite using MVCC, InnoDB is an index ordered table. Data is written in 
key order. LevelDB shouldn't have the ordered write issues that InnoStore has. </pre><pre>

The procedure to bulk load your data is going to be the same as bulk loading 
data for any large Data Warehouse - ordered inserts will help you. 

If there's a way to load your data in smaller ordered chunks, that's going to 
help you out too. 

Some other options would be to increase the buffer_pool_size for InnoStore. 
InnoDB will use RAM as a disk cache to avoid disk hits. This would be a &quot;Good 
Thing&quot;. Since you're writing in 8k chunks, roughly, you could also increase the 
page size. This would be something to experiment with, but increasing database 
page size could improve write performance. Odds are if your average record size 
is 8kb, then you're writing multiple pages per record (key + value), which is 
causing even more I/O (two or more page reads per object). Some filesystem 
tuning could be in order. SQL Server, for instance, performs sequential reads 
in 64k chunks. The best practice for disk performance there is to format NTFS 
to use 64k blocks. The throughput between the defaults and 64k reads is amazing.

Also, you may want to look at your storage configuration in the back end. If 
you have that much data, are you using a SAN or DAS? Both of these can help get 
additional write performance, especially if you adjust the storage device to 
cache writes in a battery backed cache. What kind of drive configuration do you 
have? You can get tremendous write performance improvements by moving to 
RAID10. 

---
Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
Microsoft SQL Server MVP

On Aug 30, 2011, at 9:34 AM, David Koblas wrote:

&gt; Yes - but the thought of sorting 800M records which are all about 8k in size 
&gt; is a little daunting...  Something like a 6TB sort...  Plus it doesn't answer 
&gt; the ongoing insert problem, which is 20 keys/sec isn't functional.
&gt; 
&gt; --david
&gt; 
&gt; On 8/30/11 9:27 AM, Kresten Krab Thorup wrote:
&gt;&gt; If you can insert the objects in ascending key order, then innostore will be 
&gt;&gt; much faster than a random insert.
&gt;&gt; 
&gt;&gt; Mobile: + 45 2343 4626 | Skype: krestenkrabthorup | Twitter: @drkrab
&gt;&gt; Trifork A/S   |  Margrethepladsen 4  | DK- 8000 Aarhus C |  Phone : +45 8732 
&gt;&gt; 8787  |  www.trifork.com&lt;<a  rel="nofollow" href="http://www.trifork.com/">http://www.trifork.com/</a>&gt;
&gt;&gt; 
&gt;&gt; Trifork organizes the world class conference on software development: GOTO 
&gt;&gt; Aarhus&lt;<a  rel="nofollow" href="http://www.gotocon.com/">http://www.gotocon.com/</a>&gt;  - check it out!
&gt;&gt; 
&gt;&gt; [cid:part1.09040606.08080401@trifork.com]
&gt;&gt; 
&gt;&gt; On Aug 30, 2011, at 6:14 PM, David Koblas wrote:
&gt;&gt; 
&gt;&gt; I'm currently working on importing a very large dataset (800M) into Riak and 
&gt;&gt; running into some serious performance problems.  Hopefully this is just 
&gt;&gt; configuration issues and nothing deeper...
&gt;&gt; 
&gt;&gt; Hardware -
&gt;&gt;   * 8 proc box
&gt;&gt;   * 32 Gb ram
&gt;&gt;   * 5TB disk - RAID10
&gt;&gt; 
&gt;&gt; Have a cluster of 4 for these boxes all running riak - riak configuration 
&gt;&gt; options that are different from stock:
&gt;&gt; 
&gt;&gt;   * Listening on all IP address &quot;0.0.0.0&quot;
&gt;&gt;   * {storage_backend, riak_kv_innostore_backend},
&gt;&gt;   * innostore section - {buffer_pool_size, 17179869184}, %% 16GB
&gt;&gt;   * innostore section - {flush_method, &quot;O_DIRECT&quot;}
&gt;&gt; 
&gt;&gt; What I see is that the performance of my import script runs at about 
&gt;&gt; 200...300 keys per/second for keys that it's seen recently (e.g. re-runs) 
&gt;&gt; then drops to 20ish keys per/sec for new keys.
&gt;&gt; STATS: 1000 keys handled in 3 seconds 250.75 keys/sec
&gt;&gt; STATS: 1000 keys handled in 3 seconds 258.20 keys/sec
&gt;&gt; STATS: 1000 keys handled in 4 seconds 240.11 keys/sec
&gt;&gt; STATS: 1000 keys handled in 5 seconds 177.63 keys/sec
&gt;&gt; STATS: 1000 keys handled in 4 seconds 246.26 keys/sec
&gt;&gt; STATS: 1000 keys handled in 5 seconds 184.79 keys/sec
&gt;&gt; STATS: 1000 keys handled in 5 seconds 195.95 keys/sec
&gt;&gt; STATS: 1000 keys handled in 47 seconds 21.02 keys/sec
&gt;&gt; STATS: 1000 keys handled in 44 seconds 22.63 keys/sec
&gt;&gt; STATS: 1000 keys handled in 42 seconds 23.64 keys/sec
&gt;&gt; STATS: 1000 keys handled in 43 seconds 22.88 keys/sec
&gt;&gt; STATS: 1000 keys handled in 45 seconds 22.12 keys/sec
&gt;&gt; STATS: 1000 keys handled in 43 seconds 22.83 keys/sec
&gt;&gt; STATS: 1000 keys handled in 43 seconds 23.11 keys/sec
&gt;&gt; Of course with 800M records to import a performance of 20 keys/sec is not 
&gt;&gt; useful, plus as time goes on having an insert rate at that level is going to 
&gt;&gt; be problematic.
&gt;&gt; 
&gt;&gt; Questions -
&gt;&gt;   Is there additional things to change for imports and datasets on this 
&gt;&gt; scale?
&gt;&gt;   Is there a way to get additional debugging to see where the performance 
&gt;&gt; issues are?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; _______________________________________________
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg04510.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#04511">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#04511">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg04513.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg04508.html">innostore performance tuning</a></span> <span class="sender italic">David Koblas</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04509.html">Re: innostore performance tuning</a></span> <span class="sender italic">Kresten Krab Thorup</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04512.html">Re: innostore performance tuning</a></span> <span class="sender italic">Jonathan Langevin</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04510.html">Re: innostore performance tuning</a></span> <span class="sender italic">David Koblas</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: innostore performance tuning</span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04513.html">Re: innostore performance tuning</a></span> <span class="sender italic">Jonathan Langevin</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04514.html">Re: innostore performance tuning</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg04516.html">Re: innostore performance tuning</a></span> <span class="sender italic">Mark Phillips</span></li>
<li class="icons-email"><span class="subject"><a href="msg04517.html">Re: innostore performance tuning</a></span> <span class="sender italic">Scott Lystig Fritchie</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04529.html">Re: innostore performance tuning</a></span> <span class="sender italic">David Koblas</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg04530.html">Re: innostore performance tuning</a></span> <span class="sender italic">David Smith</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: innostore performance tuning">
<input type="hidden" name="msgid" value="0D6B71FE-3509-4CE3-8D9B-C3E709BAF49E@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg04511.html">
<input type="submit" value=" Jeremiah Peschka ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+innostore+performance+tuning%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg04510.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg04513.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">0D6B71FE-3509-4CE3-8D9B-C3E709BAF49E@gmail.com</li>
</ul>
</div>
</body>
</html>
