<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Indexing of intermediate nested fields in Riak search</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05376" id="c">
<link rel="index" href="maillist.html#05376" id="i">
<link rel="prev" href="msg05375.html" id="p">
<link rel="next" href="msg05398.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05376.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Indexing+of+intermediate+nested+fields+in+Riak+search%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Indexing of intermediate nested fields in Riak search</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Elias+Levy%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Elias Levy</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111030" rel="nofollow">Sun, 30 Oct 2011 06:48:09 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>On Sat, Oct 29, 2011 at 9:59 PM, Elias Levy &lt;fearsome.lucid...@gmail.com&gt;wrote:</pre><pre>

&gt; I am wondering if Riak search can index intermediate nested fields.  When
&gt; indexing json data through the KV precommit hook, the underscore is
&gt; understood in the schema as indicating nesting.  Thus, foo_bar will index
&gt; the value &quot;bah&quot; of field &quot;bar&quot; in the json document { &quot;foo&quot; : { &quot;bar&quot; :
&gt; &quot;bah&quot; } }.
&gt;
&gt; What I'd like to know is if it can instead index the key &quot;bar&quot; in the same
&gt; json document.  In my current use case I want to be able to find documents
&gt; with certain values for &quot;bar&quot; for these types of documents.
&gt;
&gt; Can this be done by simply indexing the field &quot;foo&quot;?  Does search know to
&gt; index all keys in &quot;foo&quot; if foo is a hash, or all its values if it is an
&gt; array?
&gt;

My testing on 1.0.0 shows that this appears not to work.  Looking at the
source for the search kv extractor gives the impression that a workaround
would be to instead store { &quot;foo&quot; : [ { &quot;x&quot;: &quot;bar&quot;, &quot;y&quot;: &quot;bah&quot;}, { &quot;x&quot;:
&quot;woo&quot;, &quot;y&quot;: &quot;zoo&quot; }, ... ]} and index &quot;foo_z&quot; to be able to search for
&quot;bar&quot; and &quot;woo&quot;.  I.e. it appears the extractor will index each subdocument
in the array.

At least that is what json_text() function implies with the tests:

{&lt;&lt;&quot;
{\&quot;menu\&quot;: {
  \&quot;id\&quot;: \&quot;file\&quot;,
  \&quot;value\&quot;: \&quot;File\&quot;,
  \&quot;popup\&quot;: {
    \&quot;menuitem\&quot;: [
      {\&quot;value\&quot;: \&quot;New\&quot;, \&quot;onclick\&quot;: \&quot;CreateNewDoc()\&quot;},
      {\&quot;value\&quot;: \&quot;Open\&quot;, \&quot;onclick\&quot;: \&quot;OpenDoc()\&quot;},
      {\&quot;value\&quot;: \&quot;Close\&quot;, \&quot;onclick\&quot;: \&quot;CloseDoc()\&quot;}
    ]
  }
}}&quot;&gt;&gt;,
              [{&lt;&lt;&quot;menu_id&quot;&gt;&gt;, &lt;&lt;&quot;file&quot;&gt;&gt;},
               {&lt;&lt;&quot;menu_value&quot;&gt;&gt;, &lt;&lt;&quot;File&quot;&gt;&gt;},
               {&lt;&lt;&quot;menu_popup_menuitem_value&quot;&gt;&gt;, &lt;&lt;&quot;New&quot;&gt;&gt;},
               {&lt;&lt;&quot;menu_popup_menuitem_onclick&quot;&gt;&gt;, &lt;&lt;&quot;CreateNewDoc()&quot;&gt;&gt;},
               {&lt;&lt;&quot;menu_popup_menuitem_value&quot;&gt;&gt;, &lt;&lt;&quot;Open&quot;&gt;&gt;},
               {&lt;&lt;&quot;menu_popup_menuitem_onclick&quot;&gt;&gt;, &lt;&lt;&quot;OpenDoc()&quot;&gt;&gt;},
               {&lt;&lt;&quot;menu_popup_menuitem_value&quot;&gt;&gt;, &lt;&lt;&quot;Close&quot;&gt;&gt;},
               {&lt;&lt;&quot;menu_popup_menuitem_onclick&quot;&gt;&gt;, &lt;&lt;&quot;CloseDoc()&quot;&gt;&gt;}]},
             %% From <a  rel="nofollow" href="http://www.ibm.com/developerworks/library/x-atom2json.html">http://www.ibm.com/developerworks/library/x-atom2json.html</a>


&gt; The implication of the above code is that you can search for
menu_popup_menuitem_value:New or menu_popup_menuitem_value:Open and find
the doc.  But my testing shows this not to work.  If any of the documents
in the array have the same fields, those fields will not be indexed.

E.g. if I set my schema to index foo_bar and insert {&quot;foo&quot;: [ { &quot;bar&quot; :
&quot;baz&quot; }, {&quot;xxx&quot;:&quot;yyy&quot;} ] }, I can search for foo_bar:baz and receive a
match.  If I instead insert '{&quot;foo&quot;: [ { &quot;bar&quot; : &quot;baz&quot; }, {&quot;bar&quot;:&quot;yyy&quot;} ]
}' and search for foo_bar:baz I receive no match.

Is this expected behavior or a bug?

Elias
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05375.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05376">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05376">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05398.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg05375.html">Indexing of intermediate nested fields in Riak search</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Indexing of intermediate nested fields in Riak sea...</span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05398.html">Re: Indexing of intermediate nested fields in Riak...</a></span> <span class="sender italic">Elias Levy</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05409.html">Re: Indexing of intermediate nested fields in ...</a></span> <span class="sender italic">Rusty Klophaus</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Indexing of intermediate nested fields in Riak search">
<input type="hidden" name="msgid" value="CAFDmHdM8mkZGsKAAcZwfKQ1npAkt38PFKV3hZRjdsApQ_x0nFA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05376.html">
<input type="submit" value=" Elias Levy ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Indexing+of+intermediate+nested+fields+in+Riak+search%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05375.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05398.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAFDmHdM8mkZGsKAAcZwfKQ1npAkt38PFKV3hZRjdsApQ_x0nFA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
