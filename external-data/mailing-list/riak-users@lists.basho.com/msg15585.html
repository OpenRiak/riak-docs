<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Adding nodes to cluster</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15585" id="c">
<link rel="index" href="maillist.html#15585" id="i">
<link rel="prev" href="msg15584.html" id="p">
<link rel="next" href="msg15586.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15585.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Adding+nodes+to+cluster%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Adding nodes to cluster</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Edgar+Veiga%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Edgar Veiga</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150124" rel="nofollow">Sat, 24 Jan 2015 13:31:55 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Sargun,

Regarding 1) - AAE is disabled. We had a problems with it and there's a lot
of threads here in the mailing list regarding this. AAE won't stop using
more and more disk space and the only solution was disabling it! Since then
the cluster has been pretty stable...</pre><pre>

Regarding 6) Can you or anyone in basho confirm that there won't be any
problems using the latest (1.4.12) version of riak in the new nodes and
only upgrading the old ones after this process is completed?

Thanks a lot for the other tips, you've been very helpful!

Best regards,
Edgar

On 24 January 2015 at 21:09, Sargun Dhillon &lt;sar...@sargun.me&gt; wrote:

&gt; Several things:
&gt; 1) If you have data at rest that doesn't change, make sure you have
&gt; AAE, and it's ran before your cluster is manipulated. Given that
&gt; you're running at 85% space, I would be a little worried to turn it
&gt; on, because you might run out of disk space. You can also pretty
&gt; reasonably put the AAE trees on magnetic storage. AAE is nice in the
&gt; sense that you _know_ your cluster is consistent at a point in time.
&gt;
&gt; 2) Make sure you're getting SSDs of roughly the same quality. I've
&gt; seen enterprise SSDs get higher and higher latency as time goes on,
&gt; due to greater data protection features. We don't need any of that.
&gt; Basho_bench is your friend if you have the time.
&gt;
&gt; 3) Do it all in one go. This will enable handoffs more cleanly, and all at
&gt; once.
&gt;
&gt; 4) Do not add the new nodes to the load balancer until handoff is
&gt; done. At least experimentally, latency increases slightly on the
&gt; original cluster, but the target nodes have pretty awful latency.
&gt;
&gt; 5) Start with a handoff_limit of 1. You can easily raise this. If
&gt; things look good, you can increase it. We're not optimizing for the
&gt; total time to handoff, we really should be optimizing for individual
&gt; vnode handoff time.
&gt;
&gt; 6) If you're using Leveldb, upgrade to the most recent version of Riak
&gt; 1.4. There have been some improvements. 1.4.9 made me happier. I think
&gt; it's reasonable for the new nodes to start on 1.4.12, and the old
&gt; nodes to be switched over later.
&gt;
&gt; 7) Watch your network utilization. Keep your disk latency flat. Stop
&gt; it if it spikes. Start from enabling one node with the lowest usage
&gt; and see if it works.
&gt;
&gt;
&gt; These are the things I can think of immediately.
&gt;
&gt; On Sat, Jan 24, 2015 at 12:42 PM, Alexander Sicular &lt;sicul...@gmail.com&gt;
&gt; wrote:
&gt; &gt; I would probably add them all in one go so you have one vnode migration
&gt; plan that gets executed. What is your ring size? How much data are we
&gt; talking about? It's not necessarily the number of keys but rather the total
&gt; amount of data and how quickly that data can move en mass between machines.
&gt; &gt;
&gt; &gt; -Alexander
&gt; &gt;
&gt; &gt;
&gt; &gt; @siculars
&gt; &gt; <a  rel="nofollow" href="http://siculars.posthaven.com">http://siculars.posthaven.com</a>
&gt; &gt;
&gt; &gt; Sent from my iRotaryPhone
&gt; &gt;
&gt; &gt;&gt; On Jan 24, 2015, at 15:37, Ed &lt;edgarmve...@gmail.com&gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi everyone!
&gt; &gt;&gt;
&gt; &gt;&gt; I have a riak cluster, working in production for about one year, with
&gt; the following characteristics:
&gt; &gt;&gt; - Version 1.4.8
&gt; &gt;&gt; - 6 nodes
&gt; &gt;&gt; - leveldb backend
&gt; &gt;&gt; - replication (n) = 3
&gt; &gt;&gt; ~ 3 billion keys
&gt; &gt;&gt;
&gt; &gt;&gt; My ssd's are reaching 85% of capacity and we have decided to buy 6 more
&gt; nodes to expand the cluster.
&gt; &gt;&gt;
&gt; &gt;&gt; Have you got any kind of advice on executing this operation or should I
&gt; just follow the documentation on adding new nodes to a cluster?
&gt; &gt;&gt;
&gt; &gt;&gt; Best regards!
&gt; &gt;&gt; Edgar
&gt; &gt;&gt;
&gt; &gt;&gt; _______________________________________________
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15584.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15585">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15585">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15586.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg15526.html">Re: adding nodes to cluster</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15527.html">Re: adding nodes to cluster</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15528.html">Re: adding nodes to cluster</a></span> <span class="sender italic">Alexander Popov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15561.html">Re: adding nodes to cluster</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15562.html">Re: adding nodes to cluster</a></span> <span class="sender italic">Alexander Popov</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15609.html">Re: adding nodes to cluster</a></span> <span class="sender italic">Russell Brown</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg15581.html">Re: Adding nodes to cluster</a></span> <span class="sender italic">Ed</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15582.html">Re: Adding nodes to cluster</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15583.html">Re: Adding nodes to cluster</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg15584.html">Re: Adding nodes to cluster</a></span> <span class="sender italic">Sargun Dhillon</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Adding nodes to cluster</span> <span class="sender italic">Edgar Veiga</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15586.html">Re: Adding nodes to cluster</a></span> <span class="sender italic">Sargun Dhillon</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15587.html">Re: Adding nodes to cluster</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15653.html">Re: Adding nodes to clust...</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg15668.html">Re: Adding nodes to clust...</a></span> <span class="sender italic">Christopher Meiklejohn</span></li>
<li class="icons-email"><span class="subject"><a href="msg15669.html">Re: Adding nodes to clust...</a></span> <span class="sender italic">Edgar Veiga</span></li>
<li class="icons-email"><span class="subject"><a href="msg15670.html">Re: Adding nodes to clust...</a></span> <span class="sender italic">Christopher Meiklejohn</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Adding nodes to cluster">
<input type="hidden" name="msgid" value="CAM-EGEryENAg1QetzKRExC1o-n_RGW-jRBMcUpuZnE+DAjeseA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15585.html">
<input type="submit" value=" Edgar Veiga ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Adding+nodes+to+cluster%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15584.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15586.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAM-EGEryENAg1QetzKRExC1o-n_RGW-jRBMcUpuZnE+DAjeseA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
