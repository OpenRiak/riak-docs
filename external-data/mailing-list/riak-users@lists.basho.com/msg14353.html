<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: About Protocol Buffers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14353" id="c">
<link rel="index" href="maillist.html#14353" id="i">
<link rel="prev" href="msg14352.html" id="p">
<link rel="next" href="msg14354.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14353.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+About+Protocol+Buffers%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: About Protocol Buffers</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brett+Hazen%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brett Hazen</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140623" rel="nofollow">Mon, 23 Jun 2014 12:58:38 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Alex -

I suspect you may be looking at some older documentation.  AFAIK all HTTP 
functionality is now (Riak 2.0) supported via PBC so you can pick either 
transport or the other for all of your communication.  In the past there was 
some functionality available only via HTTP.  There are now some direct queries 
to the Solr API which are available only via HTTP, but that’s outside of Riak’s 
core [1].</pre><pre>

I’m sure those more in the know will correct me if I’ve misspoken.

Brett

[1] <a  rel="nofollow" href="http://docs.basho.com/riak/2.0.0beta1/dev/advanced/search/">http://docs.basho.com/riak/2.0.0beta1/dev/advanced/search/</a>

On June 23, 2014 at 10:47:45 AM, Alex De la rosa (alex.rosa....@gmail.com) 
wrote:

Hi Luc,

Cool, thanks! I can see how to do it now:

bucket = client.bucket_type('counter_bucket').bucket('counters')

Will be checking it more to see what can I do that is not yet documented.

The Python documentation says at one point: &quot;Some requests are only valid over 
'http', and will always be sent via those transports, regardless of which 
protocol is preferred.&quot;. Can I know which requests are HTTP only? is it for 
something in particular? or they will be made into PBC at some point?

Thanks,
Alex


On Mon, Jun 23, 2014 at 5:29 PM, Luc Perkins &lt;lperk...@basho.com&gt; wrote:
Alex,

It sounds like you're working mostly with the lower-level Python API at the 
moment, but if you want to use the higher-level parts of the client for 
interacting with Riak Data Types (sets, maps, and counters), there is a 
tutorial here:

<a  rel="nofollow" href="https://raw.githubusercontent.com/basho/basho_docs/2.0.0/source/languages/en/riak/dev/using/data-types.md">https://raw.githubusercontent.com/basho/basho_docs/2.0.0/source/languages/en/riak/dev/using/data-types.md</a>

You'll see the Python samples interspersed throughout. I know it's annoying 
because it's just raw Markdown at the moment, but this will be deployed to our 
normal docs site soon.

Hope that helps!

Luc


On Mon, Jun 23, 2014 at 4:54 PM, Alex De la rosa &lt;alex.rosa....@gmail.com&gt; 
wrote:
Hi Sean,

Thanks for your quick reply, is what i suspected, moreover after checking 
riak.proto file in the source. So mainly the contents to store (json or not 
json) is not PB encoded semantically, but is encoded as a &quot;body&quot; field in the 
Message. That's good though.

Another question... is there any estimated date for Riak 2.0 to be released? 
I'm playing with 2.0 beta 1 and the &quot;list&quot; object is a must-have for me (same 
as the &quot;counter&quot; object that can be found in Riak 1.4).

Is crucial for me to decide which technologies to use in my new project; so far 
Riak 2.0 seems a great option, but I can not build under a beta.

Another question now that I talk about &quot;counters&quot;... how do you do it with 
Python's PBC? I can see the functions: RiakClient.get_counter() and 
RiakClient.update_counter()... but... how do you create a new counter? how do 
you specify the special connotations to the bucket?

Thanks,
Alex


On Mon, Jun 23, 2014 at 4:38 PM, Sean Cribbs &lt;s...@basho.com&gt; wrote:
Hi Alex,

By default, the client assumes new objects use JSON as the encoding. The 
protocol buffers are only used on the wire to encode Riak's protocol. If you 
want to use your own protobuffs messages, I suggest two things:

1. Decide on a `content_type` property for each of your data types and be sure 
to assign that to each key as you create it. I've used 'application/pb-person' 
as an example below.
2. Register encoder and decoder functions [1] on the RiakClient object, like so:

client.set_decoder('application/pb-person', Person.ParseFromString)
client.set_encoder('application/pb-person', lambda x: x.SerializeToString())

[1] 
<a  rel="nofollow" href="http://riak-python-client.readthedocs.org/en/latest/client.html#serialization">http://riak-python-client.readthedocs.org/en/latest/client.html#serialization</a>

Cheers,


On Mon, Jun 23, 2014 at 9:19 AM, Alex De la rosa &lt;alex.rosa....@gmail.com&gt; 
wrote:
Hi there,

I just installed RIAK 2.0 beta 1 and was playing with the Python library using 
'pbc' (Protocol Buffers).

test.py
--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
import riak
client = riak.RiakClient(host ='127.0.0.1', http_port = 8098, pb_port = 8087, 
protocol = 'pbc')
bucket = client.bucket('people')

key = bucket.new('alex', data={&quot;username&quot;:&quot;Alex&quot;,&quot;age&quot;:33})
key.store()

print bucket.get('alex').encoded_data
--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------

it works perfectly and it prints {&quot;username&quot;: &quot;Alex&quot;, &quot;age&quot;: 33} as it should 
print.

However, I'm not using a proto file (person.proto) and compiling it into binary 
for Python to use it... something like:

person.proto
--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
message Person {
  required string username = 1;
  required int32 age = 2;
}
--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------

xxx.py
--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------
import person_pb2
person = person_pb2.Person()
person.username = &quot;Alex&quot;
person.age = 33
data = person.SerializeToString()
--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------

Am I using the 'pbc' interface wrong? however, on Riak's examples page is done 
also without the &quot;proto&quot; file... I'm a bit confused at the moment as it changed 
the way I normally would use Protocol Buffers.

Thanks,
Alex

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>




--
Sean Cribbs &lt;s...@basho.com&gt;
Software Engineer
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>



_______________________________________________  
riak-users mailing list  
riak-users@lists.basho.com  
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>  
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14352.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14353">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14353">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14354.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14347.html">About Protocol Buffers</a></span> <span class="sender italic">Alex De la rosa</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14348.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14349.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Alex De la rosa</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14352.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Alex De la rosa</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: About Protocol Buffers</span> <span class="sender italic">Brett Hazen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14354.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Alex De la rosa</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14356.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Alex De la rosa</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14358.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Luc Perkins</span></li>
<li class="icons-email"><span class="subject"><a href="msg14359.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Alex De la rosa</span></li>
<li class="icons-email"><span class="subject"><a href="msg14361.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li class="icons-email"><span class="subject"><a href="msg14362.html">Re: About Protocol Buffers</a></span> <span class="sender italic">Alex De la rosa</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: About Protocol Buffers">
<input type="hidden" name="msgid" value="etPan.53a88695.4e6afb66.fc26@Oculus.local">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14353.html">
<input type="submit" value=" Brett Hazen ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+About+Protocol+Buffers%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14352.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14354.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">etPan.53a88695.4e6afb66.fc26@Oculus.local</li>
</ul>
</div>
</body>
</html>
