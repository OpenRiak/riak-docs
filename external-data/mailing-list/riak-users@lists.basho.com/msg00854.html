<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Complete Riak failure.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#00854" id="c">
<link rel="index" href="maillist.html#00854" id="i">
<link rel="prev" href="msg00853.html" id="p">
<link rel="next" href="msg00855.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg00854.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Complete+Riak+failure.%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Complete Riak failure.</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Dmitry+Demeshchuk%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dmitry Demeshchuk</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100809" rel="nofollow">Mon, 09 Aug 2010 07:07:10 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>The error you get means that too many sockets are opened
simultaneously. I guess there are two main possible reasons:</pre><pre>

1. You are being spammed by someone
2. Your REST requests to Riak are somehow handled slower than new
requests come. So, the number of opened HTTP connections increase over
time and you start getting this message.

Some time ago I got exactly the same problem with YAWS (nothing
related to Riak though) and I decided to migrate to mochiweb and
optimized some of our server-side code to reduce the response delay.
And that helped.

On Mon, Aug 9, 2010 at 5:55 PM, Richard Heycock &lt;r...@roughage.com.au&gt; wrote:
&gt; I've been running riak for about a month and I'm using it as a
&gt; persistent cache. Everything has been fine until tonight that is where
&gt; it appears to have had a catastrophic failure. Basically when I make a
&gt; request using the http interface I get a failure. I cannot be more
&gt; specific than that as there is no response code back; I think it's
&gt; getting a TCP reset ...
&gt;
&gt; ... That was about 10 minutes ago. When I tried to find out if I was
&gt; getting a TCP reset I restarted th program and everything was fine.
&gt;
&gt; Anyway most of the errors look like this:
&gt;
&gt;
&gt; =ERROR REPORT==== 9-Aug-2010::13:23:27 ===
&gt; {mochiweb_socket_server,256,{acceptor_error,{error,accept_failed}}}
&gt;
&gt; =ERROR REPORT==== 9-Aug-2010::13:23:27 ===
&gt;    application: mochiweb
&gt;    &quot;Accept failed error&quot;
&gt;    &quot;{error,emfile}&quot;
&gt;
&gt; And every so often I get:
&gt;
&gt; =ERROR REPORT==== 9-Aug-2010::13:23:56 ===
&gt; ** State machine &lt;0.17333.0&gt; terminating
&gt; ** Last event in was {riak_vnode_req_v1,
&gt;                      182687704666362864775460604089535377456991567872,
&gt;                      {fsm,undefined,&lt;0.17335.0&gt;},
&gt;                      {riak_kv_put_req_v1,
&gt;                       {&lt;&lt;&quot;uris&quot;&gt;&gt;,
&gt;                        &lt;&lt;&quot;5ea5dc023dd73b5f711efde3d50b9e91da4c5027&quot;&gt;&gt;},
&gt;                       {r_object,&lt;&lt;&quot;uris&quot;&gt;&gt;,
&gt;                        &lt;&lt;&quot;5ea5dc023dd73b5f711efde3d50b9e91da4c5027&quot;&gt;&gt;,
&gt;                        [{r_content,
&gt;                          {dict,5,16,16,8,80,48,
&gt;                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
&gt;                           {{[],[],
&gt;                             [[&lt;&lt;&quot;Links&quot;&gt;&gt;]],
&gt;                             [],[],[],[],[],[],[],
&gt;                             [[&lt;&lt;&quot;content-type&quot;&gt;&gt;,97,112,112,108,105,99,97,
&gt;                               116,105,111,110,47,106,115,111,110],
&gt;                              [&lt;&lt;&quot;X-Riak-VTag&quot;&gt;&gt;,49,102,84,99,107,121,67,100,
&gt;                               81,67,83,85,102,67,102,118,68,55,80,50,82,118]],
&gt;                             [],[],
&gt;                             [[&lt;&lt;&quot;X-Riak-Last-Modified&quot;&gt;&gt;|
&gt;                               {1281,360236,222890}]],
&gt;                             [],
&gt;                             [[&lt;&lt;&quot;X-Riak-Meta&quot;&gt;&gt;]]}}},
&gt;                          
&gt; &lt;&lt;&quot;{\&quot;uri\&quot;:\&quot;<a  rel="nofollow" href="http://feedproxy.google.com/~r/time/politics/~3/SGIQlFYkIy8/0,8599,2006898,00.html\&quot;,\&quot;download_date\&quot;:\&quot;20100809132314\&quot;}&quot">http://feedproxy.google.com/~r/time/politics/~3/SGIQlFYkIy8/0,8599,2006898,00.html\&quot;,\&quot;download_date\&quot;:\&quot;20100809132314\&quot;}&quot</a>;&gt;&gt;}],
&gt;                        [{&lt;&lt;2,235,89,160&gt;&gt;,{1,63448579436}}],
&gt;                        {dict,1,16,16,8,80,48,
&gt;                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
&gt;                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
&gt;                           [[clean|true]],
&gt;                           []}}},
&gt;                        undefined},
&gt;                       118194806,63448579436,
&gt;                       [{returnbody,true}]}}
&gt; ** When State == active
&gt; **      Data  == {state,182687704666362864775460604089535377456991567872,
&gt;                        riak_kv_vnode,
&gt;                        
&gt; {state,182687704666362864775460604089535377456991567872,
&gt;                               riak_kv_bitcask_backend,
&gt;                               {#Ref&lt;0.0.0.23192&gt;,
&gt;                                
&gt; &quot;/var/lib/riak/bitcask/182687704666362864775460604089535377456991567872&quot;},
&gt;                               [],false},
&gt;                        undefined,none}
&gt; ** Reason for termination =
&gt; ** {bad_return_value,{error,{write_locked,emfile}}}
&gt;
&gt;
&gt; I've put a full log here:
&gt;
&gt;    <a  rel="nofollow" href="http://stuff.roughage.com.au/riak-failure.log.gz">http://stuff.roughage.com.au/riak-failure.log.gz</a>
&gt;
&gt; It's nearly midnight here and I going to bed but if anyone can shed any
&gt; light on this that'd cool.
&gt;
&gt; rgh
&gt;
&gt; --
&gt; +61 (0) 410 646 369
&gt; [e]:  ...@roughage.com.au
&gt; [im]: r...@jabber.org
&gt;
&gt; You're worried criminals will continue to penetrate into cyberspace, and
&gt; I'm worried complexity, poor design and mismanagement will be there to meet
&gt; them - Marcus Ranum
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;



-- 
Best regards,
Dmitry Demeshchuk

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg00853.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#00854">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#00854">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg00855.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg00853.html">Complete Riak failure.</a></span> <span class="sender italic">Richard Heycock</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Complete Riak failure.</span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00855.html">Re: Complete Riak failure.</a></span> <span class="sender italic">Bob Ippolito</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00856.html">Re: Complete Riak failure.</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg00857.html">Re: Complete Riak failure.</a></span> <span class="sender italic">Bob Ippolito</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg00867.html">Re: Complete Riak failure.</a></span> <span class="sender italic">David Smith</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Complete Riak failure.">
<input type="hidden" name="msgid" value="AANLkTimr=i7LTgxxB7vPTDLGa_TUreJ_iFdOPExKWUdN@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg00854.html">
<input type="submit" value=" Dmitry Demeshchuk ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Complete+Riak+failure.%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg00853.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg00855.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTimr=i7LTgxxB7vPTDLGa_TUreJ_iFdOPExKWUdN@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
