<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Search Crashes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd6.html#13036" id="c">
<link rel="index" href="mail6.html#13036" id="i">
<link rel="prev" href="msg13010.html" id="p">
<link rel="next" href="msg13041.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13036.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Search+Crashes%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Search Crashes</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131120" rel="nofollow">Wed, 20 Nov 2013 10:16:59 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Gabriel,

First, let me verify a few things.</pre><pre>

1. You are on Riak 1.4? Which patch version? 1.4.2?

2. You recently upgraded you client? Did you have any of these failures
before upgrading the client?

3. Have you made any other changes between the time your system was working
and the time it started exhibiting these failures? For example, set
allow_mult=true?

Given that you are having 'badmatch' hook crashes during insert I have the
suspicion that allow_mult was recently changed to true as the Riak Search
hook cannot deal with siblings. What does the following curl show:

curl '<a  rel="nofollow" href="http://host:port/buckets/ctv_tvdata/props">http://host:port/buckets/ctv_tvdata/props</a>'

If that has 'allow_mult: true' then that is your issue.

As for your search operations. I'm not sure why they are failing. If you
want you could tar.gz all the logs for each node and email that to me.

-Z


On Mon, Nov 18, 2013 at 7:00 PM, Gabriel Littman &lt;g...@connectv.com&gt; wrote:

&gt; Hi All,
&gt;
&gt; We've been working with a search enabled bucket in riak for a while now
&gt; and off and on it has been giving us trouble.  In the past it has been
&gt; solved by reindexing all the data by just reading and writing the data back
&gt; into riak.  But even this is failing now on some input data.  Any
&gt; help/insite would be greatly appreciated.
&gt;
&gt; We are on riak 1.4
&gt; We have recently switched to riak python api 2.0
&gt;
&gt; smrtv@fre-prod-svr15:~$ python
&gt; Python 2.7.3 (default, Aug  1 2012, 05:14:39)
&gt; [GCC 4.6.3] on linux2
&gt; Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt; &gt;&gt;&gt; import riak
&gt; &gt;&gt;&gt; r = riak.RiakClient()
&gt; &gt;&gt;&gt; b = r.bucket('ctv_tvdata')
&gt; &gt;&gt;&gt; o = b.get('/data/v2/search_show/TMS.Show.9838380')
&gt; &gt;&gt;&gt; o.data
&gt; {'type': 'show', 'expires': '9999999999', 'subject_name': 'Monsters vs.
&gt; Aliens', 'sub_type': 'Series', 'topic':
&gt; '__ref--/data/v2/topic/TMS.Show.9838380:r1384276501.854346', 'person':
&gt; '__None__', 'searchable_key': 'aliens vs monstersvsaliens monsters',
&gt; 'date': '2013-11-23', 'sport': '__None__', 'genre': 'Children', 'id':
&gt; '/data/v2/search_show/TMS.Show.9838380'}
&gt; &gt;&gt;&gt; o.store()
&gt; Traceback (most recent call last):
&gt;   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/riak_object.py&quot;, line
&gt; 281, in store
&gt;     timeout=timeout)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 127, in wrapper
&gt;     return self._with_retries(pool, thunk)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 69, in _with_retries
&gt;     return fn(transport)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 125, in thunk
&gt;     return fn(self, transport, *args, **kwargs)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/operations.py&quot;,
&gt; line 289, in put
&gt;     timeout=timeout)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/http/transport.py&quot;,
&gt; line 144, in put
&gt;     return self._parse_body(robj, response, [200, 201, 204, 300])
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/http/codec.py&quot;,
&gt; line 64, in _parse_body
&gt;     self.check_http_code(status, expected_statuses)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/http/transport.py&quot;,
&gt; line 446, in check_http_code
&gt;     (expected_statuses, status))
&gt; Exception: Expected status [200, 201, 204, 300], received 500
&gt;
&gt; Using protocol buffs gives an erlang riak_search_kv_hook,precommit,error:
&gt;
&gt; &gt;&gt;&gt; r = riak.RiakClent(protocol='pcb')
&gt; Traceback (most recent call last):
&gt;   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
&gt; AttributeError: 'module' object has no attribute 'RiakClent'
&gt; &gt;&gt;&gt; r = riak.RiakClient(protocol='pcb')
&gt; Traceback (most recent call last):
&gt;   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/__init__.py&quot;,
&gt; line 99, in __init__
&gt;     self.protocol = protocol or 'http'
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/__init__.py&quot;,
&gt; line 118, in _set_protocol
&gt;     repr(self.PROTOCOLS))
&gt; ValueError: protocol option is invalid, must be one of ['http', 'https',
&gt; 'pbc']
&gt; &gt;&gt;&gt; r = riak.RiakClient(protocol='pbc')
&gt; &gt;&gt;&gt; b = r.bucket('ctv_tvdata')
&gt; &gt;&gt;&gt; o = b.get('/data/v2/search_show/TMS.Show.9838380')
&gt; &gt;&gt;&gt; o.store()
&gt; Traceback (most recent call last):
&gt;   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/riak_object.py&quot;, line
&gt; 281, in store
&gt;     timeout=timeout)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 127, in wrapper
&gt;     return self._with_retries(pool, thunk)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 69, in _with_retries
&gt;     return fn(transport)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 125, in thunk
&gt;     return fn(self, transport, *args, **kwargs)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/operations.py&quot;,
&gt; line 289, in put
&gt;     timeout=timeout)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/transport.py&quot;,
&gt; line 194, in put
&gt;     MSG_CODE_PUT_RESP)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/connection.py&quot;,
&gt; line 43, in _request
&gt;     return self._recv_msg(expect)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/connection.py&quot;,
&gt; line 55, in _recv_msg
&gt;     raise RiakError(err.errmsg)
&gt; riak.RiakError: '{precommit_fail,\n    {hook_crashed,\n
&gt;  {riak_search_kv_hook,precommit,error,\n            {badmatch,\n
&gt;      [{{dict,3,16,16,8,80,48,\n
&gt;  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},\n
&gt;  {{[],[],[],[],[],[],[],[],[],[],\n
&gt;  [[&lt;&lt;&quot;X-Riak-VTag&quot;&gt;&gt;,50,90,85,77,113,86,72,111,75,121,\n
&gt;        86,89,72,118,114,103,70,70,114,55,88,52]],\n
&gt;  [[&lt;&lt;&quot;index&quot;&gt;&gt;]],\n                        [],\n
&gt;  [[&lt;&lt;&quot;X-Riak-Last-Modified&quot;&gt;&gt;|{1384,276502,759295}]],\n
&gt;    [],[]}}},\n                  {riak_idx_doc,&lt;&lt;&quot;ctv_tvdata&quot;&gt;&gt;,\n
&gt;            &lt;&lt;&quot;/data/v2/search_show/TMS.Show.9838380&quot;&gt;&gt;,\n
&gt;    [{&lt;&lt;&quot;date&quot;&gt;&gt;,&lt;&lt;&quot;2013-11-23&quot;&gt;&gt;,[{&lt;&lt;&quot;2013-11-23&quot;&gt;&gt;,[0]}]},\n
&gt;         {&lt;&lt;&quot;expires&quot;&gt;&gt;,&lt;&lt;&quot;9999999999&quot;&gt;&gt;,\n
&gt;  [{&lt;&lt;&quot;9999999999&quot;&gt;&gt;,[0]}]},\n
&gt; {&lt;&lt;&quot;genre&quot;&gt;&gt;,&lt;&lt;&quot;Children&quot;&gt;&gt;,[{&lt;&lt;&quot;Children&quot;&gt;&gt;,[0]}]},\n
&gt;   {&lt;&lt;&quot;id&quot;&gt;&gt;,&lt;&lt;&quot;/data/v2/search_show/TMS.Show.9838380&quot;&gt;&gt;,\n
&gt;        [{&lt;&lt;&quot;/data/v2/search_show/TMS.Show.9838380&quot;&gt;&gt;,[0]}]},\n
&gt;           {&lt;&lt;&quot;person&quot;&gt;&gt;,&lt;&lt;&quot;__None__&quot;&gt;&gt;,[{&lt;&lt;&quot;__None__&quot;&gt;&gt;,[0]}]},\n
&gt;             {&lt;&lt;&quot;searchable_key&quot;&gt;&gt;,\n                        &lt;&lt;&quot;aliens vs
&gt; monstersvsaliens monsters&quot;&gt;&gt;,\n
&gt;  [{&lt;&lt;&quot;monsters&quot;&gt;&gt;,[3]},\n                         {&lt;&lt;&quot;vs&quot;&gt;&gt;,[1]},\n
&gt;                 {&lt;&lt;&quot;aliens&quot;&gt;&gt;,[0]},\n
&gt; {&lt;&lt;&quot;monstersvsaliens&quot;&gt;&gt;,[2]}]},\n
&gt; {&lt;&lt;&quot;sport&quot;&gt;&gt;,&lt;&lt;&quot;__None__&quot;&gt;&gt;,[{&lt;&lt;&quot;__None__&quot;&gt;&gt;,[0]}]},\n
&gt;   {&lt;&lt;&quot;sub_type&quot;&gt;&gt;,&lt;&lt;&quot;Series&quot;&gt;&gt;,[{&lt;&lt;&quot;Series&quot;&gt;&gt;,[0]}]},\n
&gt;   {&lt;&lt;&quot;subject_name&quot;&gt;&gt;,&lt;&lt;&quot;Monsters vs. Aliens&quot;&gt;&gt;,\n
&gt;  [{&lt;&lt;&quot;vs.&quot;&gt;&gt;,[1]},\n                         {&lt;&lt;&quot;Monsters&quot;&gt;&gt;,[0]},\n
&gt;                   {&lt;&lt;&quot;Aliens&quot;&gt;&gt;,[2]}]},\n
&gt; {&lt;&lt;&quot;topic&quot;&gt;&gt;,\n
&gt;  &lt;&lt;&quot;__ref--/data/v2/topic/TMS.Show.9838380:r1384276501.854346&quot;&gt;&gt;,\n
&gt;
&gt;  [{&lt;&lt;&quot;__ref--/data/v2/topic/TMS.Show.9838380:r1384276501.854346&quot;&gt;&gt;,\n
&gt;                    [0]}]},\n
&gt; {&lt;&lt;&quot;type&quot;&gt;&gt;,&lt;&lt;&quot;show&quot;&gt;&gt;,[{&lt;&lt;&quot;show&quot;&gt;&gt;,[0]}]}],\n                      [],\n
&gt;                    [{&lt;&lt;&quot;expires&quot;&gt;&gt;,&lt;&lt;&quot;9999999999&quot;&gt;&gt;,[&lt;&lt;&quot;9999999999&quot;&gt;&gt;]},\n
&gt;                       {&lt;&lt;&quot;type&quot;&gt;&gt;,&lt;&lt;&quot;show&quot;&gt;&gt;,[&lt;&lt;&quot;show&quot;&gt;&gt;]}],\n
&gt;          true}},\n                 {{dict,3,16,16,8,80,48,\n
&gt;        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},\n
&gt;      {{[],[],[],[],[],[],[],[],[],[],\n
&gt;  [[&lt;&lt;&quot;X-Riak-VTag&quot;&gt;&gt;,54,99,78,89,53,77,108,102,82,57,\n
&gt;      81,88,69,107,104,72,74,98,81,72,114,66]],\n
&gt;  [[&lt;&lt;&quot;index&quot;&gt;&gt;]],\n                        [],\n
&gt;  [[&lt;&lt;&quot;X-Riak-Last-Modified&quot;&gt;&gt;|{1384,276502,759064}]],\n
&gt;    [],[]}}},\n                  {riak_idx_doc,&lt;&lt;&quot;ctv_tvdata&quot;&gt;&gt;,\n
&gt;            &lt;&lt;&quot;/data/v2/search_show/TMS.Show.9838380&quot;&gt;&gt;,\n
&gt;    [{&lt;&lt;&quot;date&quot;&gt;&gt;,&lt;&lt;&quot;2013-11-23&quot;&gt;&gt;,[{&lt;&lt;&quot;2013-11-23&quot;&gt;&gt;,[0]}]},\n
&gt;         {&lt;&lt;&quot;expires&quot;&gt;&gt;,&lt;&lt;&quot;9999999999&quot;&gt;&gt;,\n
&gt;  [{&lt;&lt;&quot;9999999999&quot;&gt;&gt;,[0]}]},\n
&gt; {&lt;&lt;&quot;genre&quot;&gt;&gt;,&lt;&lt;&quot;Children&quot;&gt;&gt;,[{&lt;&lt;&quot;Children&quot;&gt;&gt;,[0]}]},\n
&gt;   {&lt;&lt;&quot;id&quot;&gt;&gt;,&lt;&lt;&quot;/data/v2/search_show/TMS.Show.9838380&quot;&gt;&gt;,\n
&gt;        [{&lt;&lt;&quot;/data/v2/search_show/TMS.Show.9838380&quot;&gt;&gt;,[0]}]},\n
&gt;           {&lt;&lt;&quot;person&quot;&gt;&gt;,&lt;&lt;&quot;__None__&quot;&gt;&gt;,[{&lt;&lt;&quot;__None__&quot;&gt;&gt;,[0]}]},\n
&gt;             {&lt;&lt;&quot;searchable_key&quot;&gt;&gt;,\n                        &lt;&lt;&quot;aliens vs
&gt; monstersvsaliens monsters&quot;&gt;&gt;,\n
&gt;  [{&lt;&lt;&quot;monsters&quot;&gt;&gt;,[3]},\n                         {&lt;&lt;&quot;vs&quot;&gt;&gt;,[1]},\n
&gt;                 {&lt;&lt;&quot;aliens&quot;&gt;&gt;,[0]},\n
&gt; {&lt;&lt;&quot;monstersvsaliens&quot;&gt;&gt;,[2]}]},\n
&gt; {&lt;&lt;&quot;sport&quot;&gt;&gt;,&lt;&lt;&quot;__None__&quot;&gt;&gt;,[{&lt;&lt;&quot;__None__&quot;&gt;&gt;,[0]}]},\n
&gt;   {&lt;&lt;&quot;sub_type&quot;&gt;&gt;,&lt;&lt;&quot;Series&quot;&gt;&gt;,[{&lt;&lt;&quot;Series&quot;&gt;&gt;,[0]}]},\n
&gt;   {&lt;&lt;&quot;subject_name&quot;&gt;&gt;,&lt;&lt;&quot;Monsters vs. Aliens&quot;&gt;&gt;,\n
&gt;  [{&lt;&lt;&quot;vs.&quot;&gt;&gt;,[1]},\n                         {&lt;&lt;&quot;Monsters&quot;&gt;&gt;,[0]},\n
&gt;                   {&lt;&lt;&quot;Aliens&quot;&gt;&gt;,[2]}]},\n
&gt; {&lt;&lt;&quot;topic&quot;&gt;&gt;,\n
&gt;  &lt;&lt;&quot;__ref--/data/v2/topic/TMS.Show.9838380:r1384276501.846692&quot;&gt;&gt;,\n
&gt;
&gt;  [{&lt;&lt;&quot;__ref--/data/v2/topic/TMS.Show.9838380:r1384276501.846692&quot;&gt;&gt;,\n
&gt;                    [0]}]},\n
&gt; {&lt;&lt;&quot;type&quot;&gt;&gt;,&lt;&lt;&quot;show&quot;&gt;&gt;,[{&lt;&lt;&quot;show&quot;&gt;&gt;,[0]}]}],\n                      [],\n
&gt;                    [{&lt;&lt;&quot;expires&quot;&gt;&gt;,&lt;&lt;&quot;9999999999&quot;&gt;&gt;,[&lt;&lt;&quot;9999999999&quot;&gt;&gt;]},\n
&gt;                       {&lt;&lt;&quot;type&quot;&gt;&gt;,&lt;&lt;&quot;show&quot;&gt;&gt;,[&lt;&lt;&quot;show&quot;&gt;&gt;]}],\n
&gt;          true}}]}}}}'
&gt;
&gt; Any search that would returns a resource that acts this way similarly
&gt; fails:
&gt;
&gt; &gt;&gt;&gt; r.fulltext_search('ctv_tvdata', &quot;searchable_key:monstersvsaliens&quot;)
&gt; XXXXXXXXXXXXXXXXXXXXXXXX q: &quot;searchable_key:monstersvsaliens&quot;
&gt; index: &quot;ctv_tvdata&quot;
&gt;
&gt; Traceback (most recent call last):
&gt;   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 127, in wrapper
&gt;     return self._with_retries(pool, thunk)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 69, in _with_retries
&gt;     return fn(transport)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/transport.py&quot;,
&gt; line 125, in thunk
&gt;     return fn(self, transport, *args, **kwargs)
&gt;   File &quot;/usr/local/lib/python2.7/dist-packages/riak/client/operations.py&quot;,
&gt; line 410, in fulltext_search
&gt;     return transport.search(index, query, **params)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/transport.py&quot;,
&gt; line 443, in search
&gt;     MSG_CODE_SEARCH_QUERY_RESP)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/connection.py&quot;,
&gt; line 43, in _request
&gt;     return self._recv_msg(expect)
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/connection.py&quot;,
&gt; line 50, in _recv_msg
&gt;     self._recv_pkt()
&gt;   File
&gt; &quot;/usr/local/lib/python2.7/dist-packages/riak/transports/pbc/connection.py&quot;,
&gt; line 71, in _recv_pkt
&gt;     % len(nmsglen))
&gt; riak.RiakError: 'Socket returned short packet length 0 - expected 4'
&gt;
&gt;
&gt; I also see errors like this in my crash and error logs:
&gt;
&gt; 2013-11-18 23:49:49.705 [error] emulator Error in process &lt;0.17776.914&gt; on
&gt; node 'riak@10.1.2.95' with exit value:
&gt; {{badmatch,[{{dict,3,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;11
&gt; bytes&gt;&gt;,52,75,67,79,55,114,90,110,69,77,50,53,121,67,112,76,85,83,113,74,115,104]],[[&lt;&lt;5
&gt; bytes&gt;&gt;]],[],[[&lt;&lt;20
&gt; bytes&gt;&gt;|{1384,346717,469237}]],[],[]}}},{riak_idx_doc,&lt;&lt;10 bytes&gt;&gt;,&lt;&lt;36
&gt; bytes&gt;&gt;,[{&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;8 bytes&gt;&gt;,[{&lt;&lt;8 bytes&gt;&gt;,[0]}]},{&lt;&lt;7 bytes&gt;&gt;,&lt;&lt;10
&gt; bytes&gt;&gt;,[{&lt;&lt;10 bytes&gt;&gt;,[0]}]},{&lt;&lt;5 bytes&gt;&gt;,&lt;&lt;6 bytes&gt;&gt;,[{&lt;&lt;6
&gt; bytes&gt;&gt;,[0]}]},{&lt;&lt;2 bytes&gt;&gt;,&lt;&lt;36 bytes&gt;&gt;,[{&lt;&lt;36 bytes&gt;&gt;,[0]}]},{&lt;&lt;6
&gt; bytes&gt;&gt;,&lt;&lt;8 bytes&gt;&gt;,[{&lt;&lt;8 bytes&gt;&gt;,[0]}]},{&lt;&lt;14 bytes&gt;&gt;,&lt;&lt;45 bytes&gt;&gt;,[{&lt;&lt;7
&gt; bytes&gt;&gt;,[0]},{&lt;&lt;5 bytes&gt;&gt;,[1]},{&lt;&lt;9 bytes&gt;&gt;,[2]},{&lt;&lt;21 bytes&gt;&gt;,[3]}]},{&lt;&lt;5
&gt; bytes&gt;&gt;,&lt;&lt;3 bytes&gt;&gt;,[{&lt;&lt;3 bytes&gt;&gt;,[0]}]},{&lt;&lt;8 bytes&gt;&gt;,&lt;&lt;8 bytes&gt;&gt;,[{&lt;&lt;8
&gt; bytes&gt;&gt;,[0]}]},{&lt;&lt;12 bytes&gt;&gt;,&lt;&lt;23 bytes&gt;&gt;,[{&lt;&lt;5 bytes&gt;&gt;,[1]},{&lt;&lt;9
&gt; bytes&gt;&gt;,[2]},{&lt;&lt;7 bytes&gt;&gt;,[...
&gt;
&gt;
&gt; 2013-11-18 23:49:49.834 [error] emulator Error in process &lt;0.18173.914&gt; on
&gt; node 'riak@10.1.2.95' with exit value:
&gt; {{badmatch,[{{dict,3,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;11
&gt; bytes&gt;&gt;,52,75,67,79,55,114,90,110,69,77,50,53,121,67,112,76,85,83,113,74,115,104]],[[&lt;&lt;5
&gt; bytes&gt;&gt;]],[],[[&lt;&lt;20
&gt; bytes&gt;&gt;|{1384,346717,469237}]],[],[]}}},{riak_idx_doc,&lt;&lt;10 bytes&gt;&gt;,&lt;&lt;36
&gt; bytes&gt;&gt;,[{&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;8 bytes&gt;&gt;,[{&lt;&lt;8 bytes&gt;&gt;,[0]}]},{&lt;&lt;7 bytes&gt;&gt;,&lt;&lt;10
&gt; bytes&gt;&gt;,[{&lt;&lt;10 bytes&gt;&gt;,[0]}]},{&lt;&lt;5 bytes&gt;&gt;,&lt;&lt;6 bytes&gt;&gt;,[{&lt;&lt;6
&gt; bytes&gt;&gt;,[0]}]},{&lt;&lt;2 bytes&gt;&gt;,&lt;&lt;36 bytes&gt;&gt;,[{&lt;&lt;36 bytes&gt;&gt;,[0]}]},{&lt;&lt;6
&gt; bytes&gt;&gt;,&lt;&lt;8 bytes&gt;&gt;,[{&lt;&lt;8 bytes&gt;&gt;,[0]}]},{&lt;&lt;14 bytes&gt;&gt;,&lt;&lt;45 bytes&gt;&gt;,[{&lt;&lt;7
&gt; bytes&gt;&gt;,[0]},{&lt;&lt;5 bytes&gt;&gt;,[1]},{&lt;&lt;9 bytes&gt;&gt;,[2]},{&lt;&lt;21 bytes&gt;&gt;,[3]}]},{&lt;&lt;5
&gt; bytes&gt;&gt;,&lt;&lt;3 bytes&gt;&gt;,[{&lt;&lt;3 bytes&gt;&gt;,[0]}]},{&lt;&lt;8 bytes&gt;&gt;,&lt;&lt;8 bytes&gt;&gt;,[{&lt;&lt;8
&gt; bytes&gt;&gt;,[0]}]},{&lt;&lt;12 bytes&gt;&gt;,&lt;&lt;23 bytes&gt;&gt;,[{&lt;&lt;5 bytes&gt;&gt;,[1]},{&lt;&lt;9
&gt; bytes&gt;&gt;,[2]},{&lt;&lt;7 bytes&gt;&gt;,[...
&gt;
&gt;
&gt; My search schema currently looks like this:
&gt;
&gt; %% Custom schema for our index
&gt; %% See: <a  rel="nofollow" href="http://10.1.3.100:8090/display/REST/Search">http://10.1.3.100:8090/display/REST/Search</a> for some background on
&gt; how we index/search
&gt;
&gt; {
&gt;     schema,
&gt;     [
&gt;         {version, &quot;1.1&quot;},
&gt;         {n_val, 3},
&gt;         {default_op, &quot;and&quot;},
&gt;         {default_field, &quot;searchable_key&quot;},
&gt;         {analyzer_factory, {erlang, text_analyzers,
&gt; whitespace_analyzer_factory}}
&gt;     ],
&gt;     [
&gt;         %% main field for searching
&gt;         {field, [
&gt;             {name, &quot;searchable_key&quot;},
&gt;             {type, string}
&gt;         ]},
&gt;
&gt;         %% In order to use filter queries to reduce the result set to
&gt;         %% specific object 'types' or with 'expires' &gt;= now, we need
&gt;         %% to make these fields &quot;inline&quot;.
&gt;
&gt;         {field, [
&gt;             {name, &quot;type&quot;},
&gt;             {type, string},
&gt;             {inline, true}
&gt;         ]},
&gt;
&gt;         {field, [
&gt;             {name, &quot;expires&quot;},
&gt;             {type, string},
&gt;             {inline, true}
&gt;         ]},
&gt;
&gt;         {field, [
&gt;             {name, &quot;likes_count&quot;},
&gt;             {type, string},
&gt;             {padding_size, 10}
&gt;         ]},
&gt;
&gt;         {field, [
&gt;             {name, &quot;timestamp&quot;},
&gt;             {type, string},
&gt;             {inline, true}
&gt;         ]},
&gt;
&gt;         %% Our catch all...
&gt;         {dynamic_field, [
&gt;             {name, &quot;*&quot;},
&gt;             {type, string}
&gt;         ]}
&gt;
&gt;         %% Field names ending in &quot;_text&quot; are indexed as full text&quot;
&gt;         %% DAVE: just keeping this paragraph for reference
&gt;         %{dynamic_field, [
&gt;         %    {name, &quot;*_text&quot;},
&gt;         %    {type, string},
&gt;         %    {analyzer_factory, {erlang, text_analyzers,
&gt; standard_analyzer_factory}}
&gt;         %]},
&gt;
&gt;         %% The original catch all...
&gt;         %% Everything else is a string
&gt;         %{dynamic_field, [
&gt;             %{name, &quot;*&quot;},
&gt;             %{type, string},
&gt;             %{analyzer_factory, {erlang, text_analyzers,
&gt; whitespace_analyzer_factory}}
&gt;         %]}
&gt;     ]
&gt; }.
&gt;
&gt;
&gt; I'm seeing this kind of thing in both my stage and production
&gt; environments.  As far as I can tell my search index is corrupted but I'm
&gt; not sure how it's gotten this way.  Again any help is appreciated.    What
&gt; is the wrong?  How can I fix it?  What could have caused it?
&gt;
&gt; Thanks,
&gt;
&gt; Gabe
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13010.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd6.html#13036">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail6.html#13036">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13041.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13010.html">Search Crashes</a></span> <span class="sender italic">Gabriel Littman</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Search Crashes</span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13041.html">Re: Search Crashes</a></span> <span class="sender italic">Gabriel Littman</span></li>
<li class="icons-email"><span class="subject"><a href="msg13052.html">Re: Search Crashes</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13067.html">Re: Search Crashes</a></span> <span class="sender italic">Gabriel Littman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13068.html">Re: Search Crashes</a></span> <span class="sender italic">Gabriel Littman</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13069.html">Re: Search Crashes</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13070.html">Re: Search Crashes</a></span> <span class="sender italic">Kartik Thakore</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13071.html">Re: Search Crashes</a></span> <span class="sender italic">John Daily</span></li>
<li class="icons-email"><span class="subject"><a href="msg13072.html">Re: Search Crashes</a></span> <span class="sender italic">Kartik Thakore</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Search Crashes">
<input type="hidden" name="msgid" value="CACZcpemtTB9HNVDWge81hUoZ-o6Rm3p8+JSv1TUXKfT8wT1N5w@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13036.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Search+Crashes%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13010.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13041.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpemtTB9HNVDWge81hUoZ-o6Rm3p8+JSv1TUXKfT8wT1N5w@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
