<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: How to make Riak work faster (writing)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09183" id="c">
<link rel="index" href="maillist.html#09183" id="i">
<link rel="prev" href="msg09180.html" id="p">
<link rel="next" href="msg09186.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09183.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+make+Riak+work+faster+%5C%28writing%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: How to make Riak work faster (writing)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jared+Morrow%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jared Morrow</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121103" rel="nofollow">Sat, 03 Nov 2012 12:43:57 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Uruka,

Now that you got some somewhat reasonable numbers, it is probably time to
discuss what you are trying to get out of Riak.  We typically recommend 4
or 5 nodes minimum for a Riak install because that is the point where the
distribution becomes a performance benefit rather than a hindrance.  I know
you were just load testing, but I'd recommend considering a test with 4 or
5 nodes, with default N values.  During the test, remove a node (power it
off, or 'riak stop' it).  Or like someone else mentioned start with a 3 or
4 node cluster and add a node to see how the performance goes up and no
further operations work is needed to rebalance the data around the cluster.
 This is really where Riak shines over some alternative databases, the ease
of scaling and dealing with failures.  SIngle node performance although fun
to try and tune to get the most out of it, isn't as interesting on a long
timeline when trying to scale the system.  Obviously single node
performance is still important, dont' get me wrong.  Riak isn't always the
best choice, but when it comes with staying available and performance while
systems are failing no other system has a better real-world story than Riak.</pre><pre>

If you still want to get your single node performance up, we have several
pages on our docs page based around tuning.  A good place to start is the
file system tuning page
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/cookbooks/File-System-Tuning/">http://docs.basho.com/riak/latest/cookbooks/File-System-Tuning/</a> .  Reading
that and other pages in the Operations section might be helpful in
squeezing out those last bits of speed.

I am glad to see your initial 60 writes/sec has gone up to 800 writes/sec,
but we definitely can do better once you start utilizing our strengths.

Hope my rambling helped,
-Jared

On Sat, Nov 3, 2012 at 4:55 AM, Uruka Dark &lt;urukad...@gmail.com&gt; wrote:

&gt; Jared,
&gt;
&gt; Thank you for you time and reply.
&gt;
&gt; I got impressed by your numbers and I started to double check my settings.
&gt; I found a big problem here, my third machine (the one out of the cluster,
&gt; making the load), was not talking to Riak in gigabit speed, it was 100 Mbs.
&gt; I changed the network cable and it's working fine now.
&gt; I ran my python script again and I already could see better results: 252
&gt; ops/sec (before the fix it was 175 ops/sec).
&gt;
&gt; I also ran your benchmark .config, and these are my numbers:
&gt; <a  rel="nofollow" href="https://dl.dropbox.com/u/308392/summary.png">https://dl.dropbox.com/u/308392/summary.png</a>
&gt;
&gt; As you can see, even so, I'm still far from your results.. not even close,
&gt; and now I'm using Bitcask.
&gt; Anyway, my current position is much better than at the beggining. I'll
&gt; double-check all over again, cause now I have a confirmation that there is
&gt; something wrong.
&gt;
&gt; If you have any suggestion, please, let me know.
&gt; Once again, thank you.
&gt;
&gt; On Sat, Nov 3, 2012 at 3:08 AM, Jared Morrow &lt;ja...@basho.com&gt; wrote:
&gt;
&gt;&gt; I forgot to mention that 2000 ops/sec was on bitcask, not memory.  I
&gt;&gt; didn't bother with the memory backend.
&gt;&gt;
&gt;&gt; -Jared
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sat, Nov 3, 2012 at 12:05 AM, Jared Morrow &lt;ja...@basho.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Uruka,
&gt;&gt;&gt;
&gt;&gt;&gt; So looking at your results something is really wrong with your setup.  I
&gt;&gt;&gt; was surprised by your numbers, so I made two VM's each with only 1gb of RAM
&gt;&gt;&gt; on two different boxes also on a 1gb switch.
&gt;&gt;&gt;
&gt;&gt;&gt; I ran a put of 100,000 keys at 10kb in size.
&gt;&gt;&gt;
&gt;&gt;&gt; I didn't do any tuning at all on the VM's and these were quick Ubuntu
&gt;&gt;&gt; 10.04 VM's with 2 virtual CPU's and 1 gig of ram.  I also didn't change any
&gt;&gt;&gt; settings in Riak, except for the IP address and listening ports.
&gt;&gt;&gt;
&gt;&gt;&gt; Here is the summary of the results showing around 2000 ops/sec
&gt;&gt;&gt; <a  rel="nofollow" href="https://dl.dropbox.com/u/183971/summary.png">https://dl.dropbox.com/u/183971/summary.png</a>
&gt;&gt;&gt;
&gt;&gt;&gt; So my main thought is that you weren't actually using N=1 for your puts
&gt;&gt;&gt; and you were using the default N value of 3, meaning you were writing each
&gt;&gt;&gt; key/value 3 times, and with 2 nodes this is doing a lot of writes to the
&gt;&gt;&gt; same disk multiple times.
&gt;&gt;&gt;
&gt;&gt;&gt; To be sure you have N=1, you can use 'riak attach' on each node and
&gt;&gt;&gt; enter the following command:
&gt;&gt;&gt;
&gt;&gt;&gt; riak_core_bucket:set_bucket(&lt;&lt;&quot;pop1&quot;&gt;&gt;,[{n_val,1}]).
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; If you bucket name is &quot;pop1&quot; as in my case.  That name is completely
&gt;&gt;&gt; arbitrary.
&gt;&gt;&gt;
&gt;&gt;&gt; Sorry I'm late to this thread, I had to find some time to setup the test.
&gt;&gt;&gt;
&gt;&gt;&gt; For reference I used <a  rel="nofollow" href="https://github.com/basho/basho_bench">https://github.com/basho/basho_bench</a> for the
&gt;&gt;&gt; benchmark.  With the following .config file
&gt;&gt;&gt; <a  rel="nofollow" href="https://gist.github.com/e630b63f4a025a0fb634">https://gist.github.com/e630b63f4a025a0fb634</a>
&gt;&gt;&gt;
&gt;&gt;&gt; Hope this helps,
&gt;&gt;&gt; Jared
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09180.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09183">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09183">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09186.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09155.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09165.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09166.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Dmitri Zagidulin</span></li>
<li class="icons-email"><span class="subject"><a href="msg09169.html">Re: How to make Riak work faster (writing)</a></span> <span class="sender italic">Uruka Dark</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09170.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Brian Akins</span></li>
<li class="icons-email"><span class="subject"><a href="msg09174.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li class="icons-email"><span class="subject"><a href="msg09177.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09178.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09179.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09180.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: How to make Riak work faster (writing...</span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09186.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09198.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09199.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09204.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Jared Morrow</span></li>
<li class="icons-email"><span class="subject"><a href="msg09207.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Uruka Dark</span></li>
<li class="icons-email"><span class="subject"><a href="msg09209.html">Re: How to make Riak work faster (writing...</a></span> <span class="sender italic">Jared Morrow</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: How to make Riak work faster (writing)">
<input type="hidden" name="msgid" value="CACUSOvfU1XnRNUftGD11KRzEEUkDFoMTJ9Axawm1TWr=_iLV5Q@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09183.html">
<input type="submit" value=" Jared Morrow ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+How+to+make+Riak+work+faster+%5C%28writing%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09180.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09186.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACUSOvfU1XnRNUftGD11KRzEEUkDFoMTJ9Axawm1TWr=_iLV5Q@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
