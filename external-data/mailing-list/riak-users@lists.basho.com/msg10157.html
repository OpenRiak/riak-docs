<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Riak - low throughput</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10157" id="c">
<link rel="index" href="maillist.html#10157" id="i">
<link rel="prev" href="msg10224.html" id="p">
<link rel="next" href="msg10158.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10157.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+%5C-+low+throughput%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Riak - low throughput</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Dmitri+Zagidulin%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dmitri Zagidulin</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130220" rel="nofollow">Wed, 20 Feb 2013 12:30:50 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>When running throughput tests, I've usually found that the bottleneck is in
the loading/testing script itself. That number (400-600 writes/sec) is
usually the limit that a simple load script (consisting of a while loop
that does PUTs to Riak) reaches.</pre><pre>

Meaning, a single while loop issuing writes and waiting back for responses
can't realistically write much faster than that.

The solution is - you have to bulk up your testing script, and introduce
parallelism. Fire up several loading scripts in parallel. If you have
multiple machines to write to the riak cluster, use those.  Make sure
you're load-balancing your writes to all 3 nodes in the cluster, and not
just hitting one. Use threads or worker pools to issue your writes, if
that's available in your language.

General performance test bottleneck checklist (to get you past that 600
ops/sec):

1. Are you load balancing which nodes you're writing to, or always hitting
the same node/IP? Either use an external balancer like HA proxy, and write
to that, or use the round-robin balancer that's built into some of the Riak
clients (like the Java client).

2. Is your test script single threaded? (Are you doing your writes
linearly, in a while loop?) Spread the work to several different load
scripts working in parallel. Spin up different threads to issue writes, if
your language does multithreading well. If you're in Ruby, consider using
worker pool managers like Celluloid, or something like Sidekiq.

There's other fine-tuning performance knobs having to do with backend
settings, but those two above will get you the biggest gains.



On Wed, Feb 20, 2013 at 3:10 PM, catchme &lt;lhariha...@hotmail.com&gt; wrote:

&gt; I have configured Riak using
&gt; 3 nodes
&gt; n_val=3
&gt; dw=1
&gt; w=1
&gt; r=1
&gt; Using memory backend
&gt;
&gt; The throughput is very low. Results after running the script for 10 mins
&gt; #samples  90% Line  Throughput
&gt; 408679     17           683/sec
&gt;
&gt; I am doing reads and writes to all the nodes.
&gt;
&gt; How do I improve the throughput?
&gt;
&gt; Thanks.
&gt;
&gt;
&gt;
&gt; --
&gt; View this message in context:
&gt; <a  rel="nofollow" href="http://riak-users.197444.n3.nabble.com/Riak-low-throughput-tp4026917.html">http://riak-users.197444.n3.nabble.com/Riak-low-throughput-tp4026917.html</a>
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10224.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10157">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10157">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10158.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10155.html">Riak - low throughput</a></span> <span class="sender italic">catchme</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10156.html">Re: Riak - low throughput</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10165.html">Re: Riak - low throughput</a></span> <span class="sender italic">catchme</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10166.html">Re: Riak - low throughput</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10167.html">Re: Riak - low throughput</a></span> <span class="sender italic">catchme</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg10172.html">Re: Riak - low throughput</a></span> <span class="sender italic">Christian Dahlqvist</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10224.html">Re: Riak - low throughput</a></span> <span class="sender italic">Richard Shaw</span></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Riak - low throughput</span> <span class="sender italic">Dmitri Zagidulin</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Riak - low throughput">
<input type="hidden" name="msgid" value="CA+TO3kXqu9ogCZGHz4wyZ8LOhhMqS+6+C-AS9Z0pugBdM9YgJQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10157.html">
<input type="submit" value=" Dmitri Zagidulin ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Riak+%5C-+low+throughput%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10224.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10158.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CA+TO3kXqu9ogCZGHz4wyZ8LOhhMqS+6+C-AS9Z0pugBdM9YgJQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
