<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak Search: 'Failed to index docs' error when inserting a document	from tutorial</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15149" id="c">
<link rel="index" href="maillist.html#15149" id="i">
<link rel="prev" href="msg15147.html" id="p">
<link rel="next" href="msg15153.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15149.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+Search%5C%3A+%27Failed+to+index+docs%27+error+when+inserting+a+document%09from+tutorial%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak Search: 'Failed to index docs' error when inserting a document	from tutorial</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Stanislav+Nazarenko%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Stanislav Nazarenko</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20141112" rel="nofollow">Wed, 12 Nov 2014 04:47:21 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre> 

Hi All, </pre><pre>

Apologies if you received this message twice - my submission through
Nabble seems to have failed. 

I've been a moderate user of early versions of Riak and now I'm back to
Riak land to try version 2.0 and Riak Search with Solr (after seeing
Eric Redmond presenting in Dublin, this is exciting stuff!). 

I was following the instructions in 'Using Search'
(<a  rel="nofollow" href="http://docs.basho.com/riak/2.0.0/dev/using/search/">http://docs.basho.com/riak/2.0.0/dev/using/search/</a> [1]) but was unable
so far to make Riak Search working. When I try to insert the first
document (&quot;liono&quot;), it gets inserted into Riak successfully, but I'm
getting the following error when it tries to index it: 

**** 
_failed to index object {{&lt;&lt;&quot;animals&quot;&gt;&gt;,&lt;&lt;&quot;cats&quot;&gt;&gt;},&lt;&lt;&quot;liono&quot;&gt;&gt;} with
error {&quot;Failed to index docs&quot;_ ...
**** 

(see full error + stack trace from Solr below) 

ENVIRONMENT:

OS: OS X 10.9.5 
Erlang: R16B02-basho5 
Riak: 2.0.1 

Development nodes set up as per 'Five-Minute Install' tutorial + enabled
search + changed storage backend to LevelDB + enabled Riak Control: 

STEPS TAKEN:

1) Create an index using Python client: 

from riak import RiakClient 
client = RiakClient(host='127.0.0.1', protocol='pbc', pb_port=10017) 
client.create_search_index('famous') 

2) Create new bucket type: 

dev1/bin/riak-admin bucket-type create animals
'{&quot;props&quot;:{&quot;search_index&quot;:&quot;famous&quot;}}' 
dev1/bin/riak-admin bucket-type activate animals 

3) Then, through Python client: 

from riak import RiakClient 
client = RiakClient(host='127.0.0.1', protocol='pbc', pb_port=10017) 
bucket = client.bucket_type('animals').bucket('cats') 
cat = bucket.new('liono', {'name_s': 'Lion-o', 'age_i': 30, 'leader_b':
True}) 
cat.store() 

The last statement exists successfully and returns a Riak object
(&lt;riak.riak_object.RiakObject at 0x106acdd10&gt;) but it produces an error
in Riak and Solr: 

ERROR IN DEV1/LOG/CONSOLE.LOG:

2014-11-11 22:59:25.171 [error] &lt;0.770.0&gt;@yz_kv:index:215 failed to
index object {{&lt;&lt;&quot;animals&quot;&gt;&gt;,&lt;&lt;&quot;cats&quot;&gt;&gt;},&lt;&lt;&quot;liono&quot;&gt;&gt;} with error
{&quot;Failed to index docs&quot;,{ok,&quot;500&quot;,[{&quot;Content-Type&quot;,&quot;application/json;
charset=UTF-8&quot;},{&quot;Transfer-Encoding&quot;,&quot;chunked&quot;}],&quot;{&quot;responseHeader&quot;:{&quot;status&quot;:500,&quot;QTime&quot;:1},&quot;error&quot;:{&quot;msg&quot;:&quot;Expected
key,value separator ':': char=(EOF),position=9
BEFORE=''&quot;,&quot;trace&quot;:&quot;org.noggit.JSONParser$ParseException: Expected
key,value separator ':': char=(EOF),position=9 BEFORE=''\n\tat
org.noggit.JSONParser.err(JSONParser.java:223)\n\tat
org.noggit.JSONParser.nextEvent(JSONParser.java:679)\n\tat
org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.handleDeleteCommand(JsonLoader.java:187)\n\tat
org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.processUpdate(JsonLoader.java:146)\n\tat
org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.load(JsonLoader.java:101)\n\tat
org.apache.solr.handler.loader.JsonLoader.load(JsonLoader.java:65)\n\tat
org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:92)\n\tat
org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n\tat
org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\n\tat
org.apache.solr.core.SolrCore.execute(SolrCore.java:1916)\n\tat
org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:780)\n\tat
org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:427)\n\tat
org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:217)\n\tat
org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\n\tat
org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)\n\tat
org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n\tat
org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557)\n\tat
org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n\tat
org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandl...&quot;}}
because
[{yz_solr,index,3,[{file,&quot;src/yz_solr.erl&quot;},{line,192}]},{yz_kv,index,7,[{file,&quot;src/yz_kv.erl&quot;},{line,267}]},{yz_kv,index,3,[{file,&quot;src/yz_kv.erl&quot;},{line,202}]},{riak_kv_vnode,actual_put,6,[{file,&quot;src/riak_kv_vnode.erl&quot;},{line,1418}]},{riak_kv_vnode,perform_put,3,[{file,&quot;src/riak_kv_vnode.erl&quot;},{line,1406}]},{riak_kv_vnode,do_put,7,[{file,&quot;src/riak_kv_vnode.erl&quot;},{line,1201}]},{riak_kv_vnode,handle_command,3,[{file,&quot;src/riak_kv_vnode.erl&quot;},{line,486}]},{riak_core_vnode,vnode_command,3,[{file,&quot;src/riak_core_vnode.erl&quot;},{line,345}]}]


ERROR IN DEV1/LOG/SOLR.LOG:

2014-11-11 22:59:25,164 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@Server.java:363 REQUEST
/internal_solr/famous/update on BlockingHttpConn 
ection@3b9f051a,g=HttpGenerator{s=0,h=-1,b=-1,c=-1},p=HttpParser{s=2,l=1,c=9},r=1263

2014-11-11 22:59:25,164 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@ContextHandler.java:931 scope
null||/internal_solr/famous/update @ o.e.j 
.w.WebAppContext{/internal_solr,file:/Users/kazarena/riak-2.0.1/dev/dev1/lib/yokozuna-2.0.0-1-g6ac3a63/priv/solr/solr-webapp/webapp/},/Us

ers/kazarena/riak-2.0.1/dev/dev1/lib/yokozuna-2.0.0-1-g6ac3a63/priv/solr/webapps/solr.war

2014-11-11 22:59:25,164 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@ContextHandler.java:1003
context=/internal_solr||/famous/update @ o.e.j. 
w.WebAppContext{/internal_solr,file:/Users/kazarena/riak-2.0.1/dev/dev1/lib/yokozuna-2.0.0-1-g6ac3a63/priv/solr/solr-webapp/webapp/},/Use

rs/kazarena/riak-2.0.1/dev/dev1/lib/yokozuna-2.0.0-1-g6ac3a63/priv/solr/webapps/solr.war

2014-11-11 22:59:25,164 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@SessionHandler.java:187
sessionManager=org.eclipse.jetty.server.session. 
HashSessionManager@75197422 
2014-11-11 22:59:25,165 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@SessionHandler.java:188 session=null 
2014-11-11 22:59:25,165 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@ServletHandler.java:370 servlet
/internal_solr|/famous/update|null -&gt; de 
fault 
2014-11-11 22:59:25,165 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@ServletHandler.java:432
chain=SolrRequestFilter-&gt;default 
2014-11-11 22:59:25,165 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@ServletHandler.java:1416 call filter
SolrRequestFilter 
2014-11-11 22:59:25,165 [DEBUG] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@LogUpdateProcessorFactory.java:178
PRE_UPDATE FINISH {{params(),defaults 
(wt=json)}} 
2014-11-11 22:59:25,166 [INFO] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@LogUpdateProcessorFactory.java:198
[famous] webapp=/internal_solr path=/u 
pdate params={} {} 0 1 
2014-11-11 22:59:25,167 [ERROR] &lt;qtp1972588681-18 -
/internal_solr/famous/update&gt;@SolrException.java:109
org.noggit.JSONParser$ParseException: Expected key,value separator ':':
char=(EOF),position=9 BEFORE='' 
 at org.noggit.JSONParser.err(JSONParser.java:223) 
 at org.noggit.JSONParser.nextEvent(JSONParser.java:679) 
 at
org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.handleDeleteCommand(JsonLoader.java:187)

 at
org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.processUpdate(JsonLoader.java:146)

 at
org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.load(JsonLoader.java:101)

 at org.apache.solr.handler.loader.JsonLoader.load(JsonLoader.java:65) 
 at
org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:92)

 at
org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)

 at
org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)

 at org.apache.solr.core.SolrCore.execute(SolrCore.java:1916) 
 at
org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:780)

 at
org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:427)

 at
org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:217)

 at
org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)

 at
org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)

 at
org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)

 at
org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557)

 at
org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)

 at
org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)

 at
org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)

 at
org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)

 at
org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)

 at
org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)

 at
org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255)

 at
org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)

 at
org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)

 at org.eclipse.jetty.server.Server.handle(Server.java:364) 
 at
org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489)

 at
org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:53)

 at
org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:953)

 at
org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1014)

 at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:861) 
 at
org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240) 
 at
org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:72)

 at
org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:264)

 at
org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)

 at
org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)

 at java.lang.Thread.run(Thread.java:745) 

FROM ETC/DEV1/RISK.CONF:

## Specifies the storage engine used for Riak's key-value data 
## and secondary indexes (if supported). 
## 
## Default: bitcask 
## 
## Acceptable values: 
## - one of: bitcask, leveldb, memory, multi 
storage_backend = leveldb 
... 
## Set to 'off' to disable the admin panel. 
## 
## Default: off 
## 
## Acceptable values: 
## - on or off 
riak_control = on 
... 
## To enable Search set this 'on'. 
## 
## Default: off 
## 
## Acceptable values: 
## - on or off 
search = on 
... 

Any help would be really appreciated. 

Kind Regards, 
Stan Nazarenko 
 

Links:
------
[1] <a  rel="nofollow" href="http://docs.basho.com/riak/2.0.0/dev/using/search/">http://docs.basho.com/riak/2.0.0/dev/using/search/</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15147.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15149">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15149">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15153.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Riak Search: 'Failed to index docs' error when inserti...</span> <span class="sender italic">Stanislav Nazarenko</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15153.html">Re: Riak Search: 'Failed to index docs' error whe...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15156.html">Re: Riak Search: 'Failed to index docs' error...</a></span> <span class="sender italic">Stanislav Nazarenko</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15226.html">Re: Riak Search: 'Failed to index docs' e...</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg15228.html">Re: Riak Search: 'Failed to index doc...</a></span> <span class="sender italic">Stanislav Nazarenko</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak Search: 'Failed to index docs' error when inserting a document	from tutorial">
<input type="hidden" name="msgid" value="6c880d0a3b0bd5362e3e0eda70744414@nihontoclub.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15149.html">
<input type="submit" value=" Stanislav Nazarenko ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+Search%5C%3A+%27Failed+to+index+docs%27+error+when+inserting+a+document%09from+tutorial%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15147.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15153.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">6c880d0a3b0bd5362e3e0eda70744414@nihontoclub.com</li>
</ul>
</div>
</body>
</html>
