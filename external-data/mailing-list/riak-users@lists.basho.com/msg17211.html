<!DOCTYPE html>
<html lang="en">
<head>
<title>Basho Product Alert: LevelDB SEGV in Riak KV 2.1.3</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#17211" id="c">
<link rel="index" href="maillist.html#17211" id="i">
<link rel="prev" href="msg17208.html" id="p">
<link rel="next" href="msg17212.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg17211.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Basho+Product+Alert%5C%3A+LevelDB+SEGV+in+Riak+KV+2.1.3%22&amp;o=newest" rel="nofollow"><span itemprop="name">Basho Product Alert: LevelDB SEGV in Riak KV 2.1.3</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Seema+Jethani%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Seema Jethani</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20160413" rel="nofollow">Wed, 13 Apr 2016 12:08:31 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre> Overview

Riak KV (aka Riak / Riak EE) 2.1.3 has a race condition with opening
LevelDB databases and may crash with a segmentation violation (SIGSEGV).
LevelDB databases are opened on primary or fallback vnode startup and
during AAE expiration The issue is possible but much less likely on the
Riak TS 2.0, Riak KV 2.0 and earlier Riak KV 2.1 series.</pre><pre>

Description

Beginning with Riak KV 2.1.3, a list of opened databases is used by the
GroomingCompactions feature to look for databases with low write activity
that can benefit from being compacted.

The race condition occurs because newly opened databases are added to the
list before their initialization is complete. Scanning for
GroomedCompaction candidates takes place once every minute or whenever one
completes. If the initializing database is accessed during initialization,
it may reference uninitialized memory and crash with a segmentation
violation.

The open database list was originally added to support the FlexCache
feature in Riak 2.0. There is a much smaller chance this race condition
will occur in Riak 2.0, since it requires more than one database to open or
close at the same time.

This issue is corrected by ensuring that the list of open databases is
updated after the initialization of the database is complete. The
correction is shipped within Riak KV 2.0.7, Riak KV 2.1.4, and Riak TS
1.3.0

Affected Users

- Users running Riak KV 2.1.3 with the LevelDB backend, with or without AAE
enabled.

- Users running Riak KV 2.1.3 with other backends (multi, memory, bitcask)
and AAE enabled could also hit this issue.

- Users running Riak KV 2.0.0 and higher with AAE enabled are also
affected, but the likelihood of hitting the race condition is much lower.

- Users running Riak TS 1.0.0 and higher are also affected, but the
likelihood of hitting the race condition is much lower.

Impact

An affected node will reference uninitialized memory and will likely exit
with a segmentation violation. It may be logged by the operating system as
a crash by the beam.smp process.

Mitigation Strategy

Upgrade to a release of Riak KV at 2.0.7‚ÅÑ2.1.4 or later to resolve the
issue, or patch the eleveldb.so shared library.

Riak KV 2.1.4 is the same as Riak KV 2.1.3 with a corrected version of the
eleveldb.so library. Riak KV 2.1.4 is available at our downloads site here:
<a  rel="nofollow" href="http://docs.basho.com/riak/kv/2.1.4/downloads/">http://docs.basho.com/riak/kv/2.1.4/downloads/</a>

Riak KV 2.0.7 is a regular patch release that is in progress and will be
released in the next few weeks.

If you are unable to upgrade/patch, the occurrence can be reduced by
temporarily disabling AAE until the node is upgraded or patched.

Instructions

Installation and upgrade instructions can be found here
<a  rel="nofollow" href="http://docs.basho.com/community/productadvisories/leveldbsegfault/">http://docs.basho.com/community/productadvisories/leveldbsegfault/</a>

-- 
Seema Jethani
Director of Product Management, Basho &lt;<a  rel="nofollow" href="http://basho.com">http://basho.com</a>&gt;
4083455739 | @seemaj &lt;<a  rel="nofollow" href="http://twitter.com/seemaj">http://twitter.com/seemaj</a>&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg17208.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#17211">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#17211">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg17212.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Basho Product Alert: LevelDB SEGV in Riak KV 2.1.3">
<input type="hidden" name="msgid" value="CAJSrNH1jKrBs9Xm3iddvJYm6+TrdOmKfBO_BxN1WSMksqTPmmw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg17211.html">
<input type="submit" value=" Seema Jethani ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Basho+Product+Alert%5C%3A+LevelDB+SEGV+in+Riak+KV+2.1.3%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg17208.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg17212.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAJSrNH1jKrBs9Xm3iddvJYm6+TrdOmKfBO_BxN1WSMksqTPmmw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
