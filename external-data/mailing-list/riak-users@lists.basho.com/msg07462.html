<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: vnodeid uniqueness</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#07462" id="c">
<link rel="index" href="maillist.html#07462" id="i">
<link rel="prev" href="msg07459.html" id="p">
<link rel="next" href="msg07477.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg07462.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+vnodeid+uniqueness%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: vnodeid uniqueness</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Meredith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Meredith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120516" rel="nofollow">Wed, 16 May 2012 07:15:37 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

It's intentional.  Originally the code only used nodeid, but there was a
problem with ownership change so we fixed it by adding the timestamp.</pre><pre>

The issue we found goes like this, if nodeA is originally in the preflistt,
after a few updates you would have a vclock of Vclock1=[{nodea,3}].
Ownership of the partition changes from nodeA to nodeB and there are a few
more updates you have Vclock2=[{nodea,3},{nodeb,2}] which descends from
Vclock1. After the ownership change, nodeA removes it's copy of the object
(as it is stored on nodeB +other nodes).   Now, if the network is
partitioned and used as a fallback, a new vclock would be created
Vclock3=[{nodea,1}], but when that data is handed back it will be lost as
Vclock3 is an ancestor of Vclock2.

The case where multiple vnodes in a preflist are owned by the same node is
interesting, but I think is safe too.  If the put is done on a node that is
in the preflist it will use the first vnode it owns.  If it isn't in the
preflist, it will forward to the first node in the preflist.  Either way,
the updates will happen on the same vnode and will have the vclock
incremented there.

Jon.

On Tue, May 15, 2012 at 11:54 PM, YAMAMOTO Takashi
&lt;y...@mwd.biglobe.ne.jp&gt;wrote:

&gt; hi,
&gt;
&gt; vnodeid is composed from nodeid and timestamp.
&gt; because of the second-precision of the timestamp, many of vnodes in
&gt; a physical node can share the same vnodeid.  is this an intentional
&gt; behaviour or a bug?  i wonder if it doesn't affect the vclock algorithm.
&gt;
&gt; YAMAMOTO Takashi
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;



-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg07459.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#07462">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#07462">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg07477.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg07459.html">vnodeid uniqueness</a></span> <span class="sender italic">YAMAMOTO Takashi</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: vnodeid uniqueness</span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg07477.html">Re: vnodeid uniqueness</a></span> <span class="sender italic">YAMAMOTO Takashi</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: vnodeid uniqueness">
<input type="hidden" name="msgid" value="CAGgQeSuJSd6Y7Bu6BF_AY=NKnNddNrVMo+qt0OV4=ktPgeh+jw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg07462.html">
<input type="submit" value=" Jon Meredith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+vnodeid+uniqueness%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg07459.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg07477.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGgQeSuJSd6Y7Bu6BF_AY=NKnNddNrVMo+qt0OV4=ktPgeh+jw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
