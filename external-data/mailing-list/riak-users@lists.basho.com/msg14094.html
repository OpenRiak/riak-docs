<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: reversing node removal?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14094" id="c">
<link rel="index" href="maillist.html#14094" id="i">
<link rel="prev" href="msg14093.html" id="p">
<link rel="next" href="msg14061.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14094.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+reversing+node+removal%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: reversing node removal?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Allen+Landsidel%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Allen Landsidel</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140415" rel="nofollow">Tue, 15 Apr 2014 10:07:25 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Luke,

</pre><tt>I understand.  I was responding to the capacity planning bit; the 
</tt><tt>cluster had more than enough capacity for day to day operations, but not 
</tt><tt>nearly enough to survive a node retiring.
</tt><pre style="margin: 0em;"></pre><pre>

</pre><tt>I view it a bit differently from SQL Server and other database products 
</tt><tt>since those are single-machine solutions.  The clustering products 
</tt><tt>available for them do warn you if you attempt to retire a node from a 
</tt><tt>cluster and don't have the resources for the other nodes to take over, 
</tt><tt>or prevent it if it's a hard resource limit like disk space.
</tt><pre style="margin: 0em;">

</pre><tt>Since my cluster was virtualized, I'm almost 'out of the woods'.  The 
</tt><tt>retiring node is down to 6% of the cluster data and should be done some 
</tt><tt>time tonight.  After that, hopefully, I can add some smaller nodes to 
</tt><tt>the cluster and retire the three that are now far larger than I'd like 
</tt><tt>them to be, disk-wise.
</tt><pre style="margin: 0em;">

Thanks!


On 4/15/2014 12:59, Luke Bakken wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi Allen -

I hope you don't take my response as an assignment of blame. I created
the docs issue specifically because this case is not clear nor would I
expect Riak users to &quot;just know&quot; that your situation could happen when
they use &quot;cluster leave&quot; to remove Riak nodes from a cluster.

Every software system makes different decisions about protecting users
from potentially disruptive actions and none protect from all possible
failure scenarios. SQL Server does not protect you from inserting so
much data you fill a disk, for instance.

I'll also follow up with the Product team to discuss more insight into
the outcome of various &quot;riak-admin cluster&quot; operations.

--
Luke Bakken
CSE
lbak...@basho.com &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;


On Tue, Apr 15, 2014 at 9:44 AM, Allen Landsidel
&lt;landsidel.al...@gmail.com &lt;<a  rel="nofollow" href="mailto:landsidel.al...@gmail.com">mailto:landsidel.al...@gmail.com</a>&gt;&gt; wrote:

    I realize I made a mistake, it would just be nice if the UI could
    warn me that I was about to do so, especially given the consequences.

    If it was simply showing me how much space each node was using
    (forget a percentage or anything) that would've been enough to avert
    disaster. With four nodes, if they're over 25% capacity (far lower
    than any sensible warning level in a monitoring system), the cluster
    leave is going to fail.  The more nodes you add to the system, the
    lower you'd have to set that warning threshold to alert you that
    you're in a state where you can't safely retire a node.


    On 4/15/2014 12:40, Luke Bakken wrote:

        Hi Allen -

        Failure / node leave situations should be taken into account during
        cluster capacity planning. I've created an issue to more thoroughly
        explain this in our documentation:

        <a  rel="nofollow" href="https://github.com/basho/__basho_docs/issues/1034">https://github.com/basho/__basho_docs/issues/1034</a>
        &lt;<a  rel="nofollow" href="https://github.com/basho/basho_docs/issues/1034">https://github.com/basho/basho_docs/issues/1034</a>&gt;

        --
        Luke Bakken
        CSE
        lbak...@basho.com &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;
        &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a> &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;&gt;



        On Tue, Apr 15, 2014 at 9:28 AM, Allen Landsidel
        &lt;landsidel.al...@gmail.com &lt;<a  rel="nofollow" href="mailto:landsidel.al...@gmail.com">mailto:landsidel.al...@gmail.com</a>&gt;
        &lt;<a  rel="nofollow" href="mailto:landsidel.allen@gmail.__com">mailto:landsidel.allen@gmail.__com</a>
        &lt;<a  rel="nofollow" href="mailto:landsidel.al...@gmail.com">mailto:landsidel.al...@gmail.com</a>&gt;&gt;&gt; wrote:

             Luke,

             I already do use nagios for that, but the disk space was
        fine before
             I told one of the nodes to leave the cluster.  That's my
        problem --
             there was not enough free space in the cluster for it to
        move all
             that nodes data.  It accepted the leave and then ran me out
        of disk
             space on all the other nodes, with no way to abort or recover.

             My only option was to add more space to the other nodes (as you
             said, adding new nodes will not work until the leave is
        done), which
             is easy enough in a virtualized environment but requires
        downtime.
               In a bare metal environment, it could be catastrophic to
        the cluster.


             On 4/15/2014 12:19, Luke Bakken wrote:

                 Hi Allen,

                 Cluster leave does not check for disk space and in
        general, Riak
                 is not
                 aware of how much space it has available to itself
        (most db systems
                 don't monitor disk space I think). I'll send a note to
        product
                 management about this. We recommend using a monitoring
        solution
                 (like
                 collectd + graphite) to keep an eye on available disk
        space.


                 --
                 Luke Bakken
                 CSE
        lbak...@basho.com &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;
        &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a> &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;&gt;
                 &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a> &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;
        &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a> &lt;<a  rel="nofollow" href="mailto:lbak...@basho.com">mailto:lbak...@basho.com</a>&gt;&gt;&gt;


</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14093.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14094">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14094">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14061.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg14060.html">reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14073.html">Re: reversing node removal?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14074.html">Re: reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14090.html">Re: reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14091.html">Re: reversing node removal?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14092.html">Re: reversing node removal?</a></span> <span class="sender italic">Allen Landsidel</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14093.html">Re: reversing node removal?</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: reversing node removal?</span> <span class="sender italic">Allen Landsidel</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: reversing node removal?">
<input type="hidden" name="msgid" value="534D66DD.4040909@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14094.html">
<input type="submit" value=" Allen Landsidel ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+reversing+node+removal%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14093.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14061.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">534D66DD.4040909@gmail.com</li>
</ul>
</div>
</body>
</html>
