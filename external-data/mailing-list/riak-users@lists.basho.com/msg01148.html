<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: concurrent updates / lock-handling</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01148" id="c">
<link rel="index" href="maillist.html#01148" id="i">
<link rel="prev" href="msg01147.html" id="p">
<link rel="next" href="msg01149.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01148.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+concurrent+updates+%5C%2F+lock%5C-handling%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: concurrent updates / lock-handling</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Dilley%2C+John%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dilley, John</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20100927" rel="nofollow">Mon, 27 Sep 2010 21:57:03 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I am new to Riak but did make it to the helpful Riak Meet-up last week in SF
where this was discussed.  The idea here is Riak trades off consistency to
achieve greater availability and partition tolerance.  As result if two
writes to the same key happen both can complete.  Riak can reconcile the
difference later by (1) keeping only the latest version (according to Riak's
notion of time); or (2) asking the application to choose how to handle the
conflicting updates.</pre><pre>

The above assumes the number of write replicas is one, or fewer than half
the number of nodes in the ring.  You can avoid the issue by ensuring the
write is done to a minimum quota of half the nodes.  Although I'm not sure
what response you will get if you try to commit two writes in this scenario.

There's no &quot;lock bucket&quot; operation - if there was you could run into
deadlock or other issues.  In the Riak model you deal with these issues in
the application rather than the infrastructure.

I guess in your example your clients with both get 100, increment to 110,
then your application will have to detect the duplicate writes.  In this
case you would be best off holding the starting value and increments, rather
than just the total.  Or current and previous values?  Anyway Riak is not
made for synchronous, transactional updates to data.

Hope that helps.

Regards,
-jad-
John Dilley
Akamai Technologies


On 9/27/10 6:28 PM, &quot;Jan Zimmek&quot; &lt;jan.zim...@web.de&gt; wrote:

&gt; hello,
&gt; 
&gt; i am currently evaluating riak as data-storage for out upcoming project. the
&gt; wiki provides a lot of informations and is really good - most of my questions
&gt; are answered, but i did not find much information about how riak handles
&gt; concurrent client updates on the same key (i know riak uses vclocks, but i am
&gt; not sure what this means in practise).
&gt; 
&gt; for example:
&gt; 
&gt; -------------------
&gt; 
&gt; having a key &quot;X&quot; with a given value of 100.
&gt; 
&gt; clientA and clientB both load &quot;X&quot; in parallel, increment it by 10 and store it
&gt; back into riak.
&gt; 
&gt; will &quot;X&quot; have a value of 110, 120 or do we get something like a &quot;concurrent
&gt; modification&quot;-error ?
&gt; 
&gt; (in my case i want riak to store the value as 120 or give me same &quot;concurrent
&gt; modification&quot;-error)
&gt; 
&gt; does it matter if clientA and clientB are connected to the same/different
&gt; physical riak-node ?
&gt; 
&gt; -------------------
&gt; 
&gt; does riak support some kind of lock-handling like &quot;lock table(bucket)&quot; /
&gt; &quot;select for update&quot; as in sql or do i have to implement this in my
&gt; application-layer ?
&gt; 
&gt; any help would be really appreciated.
&gt; 
&gt; regards
&gt; jan zimmek
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01147.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01148">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01148">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01149.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01147.html">concurrent updates / lock-handling</a></span> <span class="sender italic">Jan Zimmek</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: concurrent updates / lock-handling</span> <span class="sender italic">Dilley, John</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: concurrent updates / lock-handling">
<input type="hidden" name="msgid" value="C8C6C3A2.528C%jad@akamai.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01148.html">
<input type="submit" value=" Dilley, John ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+concurrent+updates+%5C%2F+lock%5C-handling%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01147.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01149.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">C8C6C3A2.528C%jad@akamai.com</li>
</ul>
</div>
</body>
</html>
