<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: after raising of n_val all keys exists multiple times in	?keys=true</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#10348" id="c">
<link rel="index" href="maillist.html#10348" id="i">
<link rel="prev" href="msg10332.html" id="p">
<link rel="next" href="msg10349.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg10348.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+after+raising+of+n_val+all+keys+exists+multiple+times+in%09%5C%3Fkeys%3Dtrue%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: after raising of n_val all keys exists multiple times in	?keys=true</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Simon+Effenberg%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Simon Effenberg</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130307" rel="nofollow">Thu, 07 Mar 2013 02:32:57 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Mark,

we have 12 Riak nodes running. The exact command for getting keys is:</pre><pre>

curl <a  rel="nofollow" href="http://localhost:8098/buckets/config/keys?keys=true">http://localhost:8098/buckets/config/keys?keys=true</a>

Properties are:

curl -s <a  rel="nofollow" href="http://localhost:8098/riak/config">http://localhost:8098/riak/config</a> | python -mjson.tool
{
    &quot;props&quot;: {
        &quot;allow_mult&quot;: true, 
        &quot;basic_quorum&quot;: false, 
        &quot;big_vclock&quot;: 50, 
        &quot;chash_keyfun&quot;: {
            &quot;fun&quot;: &quot;chash_std_keyfun&quot;, 
            &quot;mod&quot;: &quot;riak_core_util&quot;
        }, 
        &quot;dw&quot;: &quot;quorum&quot;, 
        &quot;last_write_wins&quot;: false, 
        &quot;linkfun&quot;: {
            &quot;fun&quot;: &quot;mapreduce_linkfun&quot;, 
            &quot;mod&quot;: &quot;riak_kv_wm_link_walker&quot;
        }, 
        &quot;n_val&quot;: 3, 
        &quot;name&quot;: &quot;config&quot;, 
        &quot;notfound_ok&quot;: true, 
        &quot;old_vclock&quot;: 86400, 
        &quot;postcommit&quot;: [], 
        &quot;pr&quot;: 0, 
        &quot;precommit&quot;: [], 
        &quot;pw&quot;: 0, 
        &quot;r&quot;: &quot;quorum&quot;, 
        &quot;rw&quot;: &quot;quorum&quot;, 
        &quot;small_vclock&quot;: 50, 
        &quot;w&quot;: &quot;quorum&quot;, 
        &quot;young_vclock&quot;: 20
    }
}

you see that the n_val is now at 3 because of a bug in our tool which uses the 
Java client incorrect. Nevertheless we got multiple keys:

curl -s <a  rel="nofollow" href="http://localhost:8098/buckets/config/keys?keys=true">http://localhost:8098/buckets/config/keys?keys=true</a> | python 
-mjson.tool | sort | uniq -c 
      4         &quot;com.xx.xx.xxx.yyy.yyy.yyy.BlockedAdFilterFactory:blocked-ads&quot;
      ....

We are using a n_val of 12 to get something like a DC awareness. Our software 
creates 4 buckets and one (the config bucket) is really small and another isn't 
that big. But both are important in a case of a split brain (inter DC 
connection went down). The other buckets holding most of the data are either 
distinct or can easily be merged.

We wanted to reproduce this but our problem is, the keys can't be really 
removed. I mean they are removed and you can't 'GET' them anymore and also a 
'DELETE' is complaining about this fact and you can create the key again, fetch 
it again, remove it again but in the 
<a  rel="nofollow" href="http://localhost:8098/buckets/config/keys?keys=true">http://localhost:8098/buckets/config/keys?keys=true</a> they are not disappearing 
(even after a rolling restart of the cluster).

Cheers,
Simon


On Wed, 6 Mar 2013 11:59:55 -0600
Mark Phillips &lt;m...@basho.com&gt; wrote:

&gt; Hey Simon,
&gt; 
&gt; A few questions for starters:
&gt; 
&gt; How many Riak nodes are in your cluster?
&gt; Is your R still the default of 2?
&gt; Out of curiosity, what's the use case for an n_val of 12? I think the
&gt; highest I've ever seen is 5 or 6. :)
&gt; 
&gt; Mark
&gt; 
&gt; On Wed, Mar 6, 2013 at 10:28 AM, Simon Effenberg
&gt; &lt;seffenb...@team.mobile.de&gt; wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; we changed the n_val of a bucket from 3 to 12. If we are now doing this:
&gt; &gt;
&gt; &gt; riak:8098/riak/config?keys=true
&gt; &gt; or
&gt; &gt; riak:8098/buckets/config/keys?keys=true
&gt; &gt;
&gt; &gt; we get some keys multiple times. Getting the content works
&gt; &gt; well but we can't rely on the output (or have to sort/uniq the output).
&gt; &gt;
&gt; &gt; Is this a normal behavior or is it a bug? (Riak 1.3.0 is used with
&gt; &gt; eleveldb as backend).
&gt; &gt;
&gt; &gt; Cheers,
&gt; &gt; Simon
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>


-- 
Simon Effenberg | Site Ops Engineer | mobile.international GmbH
Fon:     + 49-(0)30-8109 - 7173
Fax:     + 49-(0)30-8109 - 7131

Mail:     seffenb...@team.mobile.de
Web:    www.mobile.de

Marktplatz 1 | 14532 Europarc Dreilinden | Germany


Geschäftsführer: Malte Krüger
HRB Nr.: 18517 P, Amtsgericht Potsdam
Sitz der Gesellschaft: Kleinmachnow 

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg10332.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#10348">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#10348">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg10349.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg10329.html">after raising of n_val all keys exists multiple times in ?...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10332.html">Re: after raising of n_val all keys exists multiple t...</a></span> <span class="sender italic">Mark Phillips</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: after raising of n_val all keys exists multip...</span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10349.html">Re: after raising of n_val all keys exists mu...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg10359.html">Re: after raising of n_val all keys exist...</a></span> <span class="sender italic">Simon Effenberg</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: after raising of n_val all keys exists multiple times in	?keys=true">
<input type="hidden" name="msgid" value="20130307113040.859f1cdb274bced5388fa767@team.mobile.de">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg10348.html">
<input type="submit" value=" Simon Effenberg ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+after+raising+of+n_val+all+keys+exists+multiple+times+in%09%5C%3Fkeys%3Dtrue%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg10332.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg10349.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20130307113040.859f1cdb274bced5388fa767@team.mobile.de</li>
</ul>
</div>
</body>
</html>
