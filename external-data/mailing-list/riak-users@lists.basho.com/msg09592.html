<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: "Bad message code" error from Java ProtoBuf client?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09592" id="c">
<link rel="index" href="maillist.html#09592" id="i">
<link rel="prev" href="msg09589.html" id="p">
<link rel="next" href="msg09593.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09592.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22Bad+message+code%5C%22+error+from+Java+ProtoBuf+client%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: "Bad message code" error from Java ProtoBuf client?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Tim+W%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Tim W</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121214" rel="nofollow">Fri, 14 Dec 2012 19:08:21 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Brian!

</pre><tt>In this particular case, the failing call is requesting a single key.  
</tt><tt>And it didn't just happen once -- rather, for quite a while, every 
</tt><tt>single one of these calls (login) would fail in this manner, 
</tt><tt>repeatedly.   Then, the next day... *poof*... working again.
</tt><pre style="margin: 0em;"></pre><pre>

Rather odd...

- Tim

On 12/14/12 3:43 PM, Brian Roach wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Sorry - dyslexia acting up:

That should read that you received a &quot;list keys&quot; response when
expecting a &quot;get&quot; response.

- Roach

On Fri, Dec 14, 2012 at 3:40 PM, Brian Roach &lt;ro...@basho.com&gt; wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Tim -

That error is generated when the original, underlying protocol buffers
Riak client gets the wrong protobuf message from the socket - as in,
not the one it's expecting.

The codes are here:
<a  rel="nofollow" href="http://docs.basho.com/riak/latest/references/apis/protocol-buffers/">http://docs.basho.com/riak/latest/references/apis/protocol-buffers/</a>

The code numbers you list basically say that you got a &quot;get&quot; response
message when expecting a &quot;list keys&quot; response method.

I'm digging into this to see how that would happen (I have an idea)
but by any chance are you listing keys and then not iterating through
the entire set?

Thanks,
Brian Roach

On Fri, Dec 14, 2012 at 2:55 PM, Tim W &lt;timm...@mindspring.com&gt; wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I'm seeing the following message emitted from a query to Riak:

com.basho.riak.client.RiakRetryFailedException: java.io.IOException: bad
message code. Expected: 10 actual: 18
         at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:79)
         at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
         at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
         at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)

I'm also seeing this a bit further down in the log:

Caused by: java.io.IOException: bad message code. Expected: 10 actual: 18
  at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:126)
  at com.basho.riak.pbc.RiakClient.processFetchReply(RiakClient.java:278)
  at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:252)
  at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:241)
  at
com.basho.riak.client.raw.pbc.PBClientAdapter.fetch(PBClientAdapter.java:156)
  at
com.basho.riak.client.operations.FetchObject$1.call(FetchObject.java:102)
         at
com.basho.riak.client.operations.FetchObject$1.call(FetchObject.java:100)
         at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:72)


This crops up periodically, during different operations, and disappears just
as mysteriously.

Any hint as to what this really means?  (For example, is there somewhere I
can look up these error codes?)

For the record, I'm running Riak 1.1.4 with Java client 1.0.5.

Thanks in advance!
- Tim

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09589.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09592">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09592">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09593.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09586.html">&quot;Bad message code&quot; error from Java ProtoBuf client...</a></span> <span class="sender italic">Tim W</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09587.html">Re: &quot;Bad message code&quot; error from Java ProtoB...</a></span> <span class="sender italic">Gideon de Kok</span></li>
<li class="icons-email"><span class="subject"><a href="msg09588.html">Re: &quot;Bad message code&quot; error from Java ProtoB...</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09589.html">Re: &quot;Bad message code&quot; error from Java Pr...</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: &quot;Bad message code&quot; error from Jav...</span> <span class="sender italic">Tim W</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09593.html">Re: &quot;Bad message code&quot; error from...</a></span> <span class="sender italic">Brian Roach</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: &quot;Bad message code&quot; error from Java ProtoBuf client?">
<input type="hidden" name="msgid" value="50CBE99E.6010804@mindspring.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09592.html">
<input type="submit" value=" Tim W ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22Bad+message+code%5C%22+error+from+Java+ProtoBuf+client%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09589.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09593.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">50CBE99E.6010804@mindspring.com</li>
</ul>
</div>
</body>
</html>
