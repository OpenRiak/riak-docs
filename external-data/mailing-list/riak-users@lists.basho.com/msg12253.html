<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: use Siblings to implement a message queue?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd10.html#12253" id="c">
<link rel="index" href="mail10.html#12253" id="i">
<link rel="prev" href="msg12250.html" id="p">
<link rel="next" href="msg12254.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12253.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+use+Siblings+to+implement+a+message+queue%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: use Siblings to implement a message queue?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jeremiah+Peschka%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremiah Peschka</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130912" rel="nofollow">Thu, 12 Sep 2013 19:53:23 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>---
Jeremiah Peschka - Founder, Brent Ozar Unlimited
MCITP: SQL Server 2008, MVP
Cloudera Certified Developer for Apache Hadoop</pre><pre>


On Thu, Sep 12, 2013 at 9:45 AM, Alex Rice &lt;a...@mindlube.com&gt; wrote:

&gt; Hey all, thanks for the feedback, this is interesting!
&gt;
&gt; re: Those CRDT white papers look pretty complicated, I will definitely
&gt; will leave that to you hardcore mathematicians and computer scientists
&gt; :)
&gt; re: Riak 2.0, I see there are git branches for 2.0 related stuff in
&gt; Riak and in corrugatediron, I am guessing it's still too rough around
&gt; the edges for a newbie like me to be messing around with?
&gt;

I can't speak for Riak 2.0, but CorrugatedIron's support doesn't have any
tests supporting it... I hope to get on that next week to see where things
are. The only hold up is time on my end. I believe the riak branch should
be workable for development. There are features in CI that need clean up,
but I'll start pushing out RC builds through nuget for the adventurous.


&gt; re: RabbitMQ I had heard of it but am hesitant to add another
&gt; daemon/system dependency. But I am  definitely considering your
&gt; advice, Guido!
&gt;
&gt; Also for this particular project (a multiplayer game) I may be able to
&gt; get away with Sets, don't actually really need proper Queues. Actually
&gt; I'm not sure. Just thinking out loud here.
&gt;
&gt; For a Set implementation in Riak, I am thinking of modeling it after
&gt; this blog post, I cannot find which at the moment, which described how
&gt; to implement a lock-free Set in Redis. Redis is not distributed, but I
&gt; think the data structure is still relevant:
&gt;
&gt; * To get around the eventual-consistency issue, a prerequisite would
&gt; be to always use R=1 and W=all. This will optimize it for reads
&gt; because there will be a process polling Riak to remove messages out of
&gt; the Set.
&gt; *  In the Redis implementation, they used the atomic APPEND operation
&gt; to append entries into the set, as a list but with notation to add or
&gt; remove, prefixed with + or -. e.g.
&gt;  +itemA
&gt;  +itemB
&gt;  -itemA
&gt;  +itemC
&gt;  =&gt; yields { itemB, itemC }
&gt; * Obviously Riak doesn't have atomic appends, however setting a bucket
&gt; to allow_mult = true, and always Put-ing with null vector clock, then
&gt; the Siblings feature should be equivalent. Instead of a value being
&gt; appended to, the Siblings would be populated with +itemA, +itemB,
&gt; -itemA, +itemC, etc.
&gt;

&gt;From an API perspective, you'll do something similar in Riak 2.0. The
CorrugatedIron operation would allow to atomically put individual items
into a set. I'm hoping to create change tracking data structures for use
with the get/put/delete functionality of Riak's server side CRDTs.


&gt; * Any process reading the Set is also be responsible for collating and
&gt; Put-ing the condensed set back, after it reaches some size limit or I
&gt; think they called it 'fragmentation'.  This condense and re-Put
&gt; operation would be the tricky part, and would need to use vector clock
&gt; and ensure there are 0 siblings when finished. But it should be
&gt; possible? It seems like this is an uber-simplified form of a CRDT data
&gt; structure?
&gt;

If you're implementing the CRDT on the client side, you'll need to figure
out the garbage collection yourself. If you're able to use Riak's data
structures, then you can safely rely on someone else handling the problems
for you.

If it weren't for my day job, I'd have this CRDT support in CI by now ;)


&gt;
&gt; Thanks,
&gt; Alex
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Thu, Sep 12, 2013 at 2:12 AM, Guido Medina &lt;guido.med...@temetra.com&gt;
&gt; wrote:
&gt; &gt; Alex,
&gt; &gt;
&gt; &gt; RabbitMQ which is a good high performer, developed in Erlang and scales
&gt; just
&gt; &gt; as Riak.
&gt; &gt;
&gt; &gt; The old saying, the right tool for the right job, I like how fast Riak is
&gt; &gt; fetching/storing key values on a distributed environment, I don't like
&gt; Riak
&gt; &gt; for queues, is it because it wasn't designed for that? CRDT like CAS
&gt; &gt; operations on structures (to mention some for Java) like
&gt; LinkedBlockingQueue
&gt; &gt; and ConcurrentLinkedQueue should be painful enough to develop in a CRDT
&gt; &gt; environment, cause now you would be talking of guarding states of few
&gt; within
&gt; &gt; the same structure; say AtomicReference of several variables to warranty
&gt; a
&gt; &gt; non-blocking CAS operation, in this case heap and tail of the queue (Not
&gt; so
&gt; &gt; true for LinkedBlockingQueue)
&gt; &gt;
&gt; &gt; And performance of several CRDT for high performance queue I don't
&gt; actually
&gt; &gt; think is going to be good.
&gt; &gt;
&gt; &gt; If I were to use Riak for my big data environment and would like to match
&gt; &gt; Riak on a distributed queueing system then I would use like I said,
&gt; &gt; RabbitMQ.
&gt; &gt;
&gt; &gt; Guido.
&gt; &gt;
&gt; &gt;
&gt; &gt; On 12/09/13 00:29, Alex Rice wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi I'm very new to Riak. The allow_mult = true /  Siblings feature is
&gt; &gt;&gt; very interesting. Could it be used to implement a high performance
&gt; &gt;&gt; collection like a Queue or Set, in a lock free manner? The Riak docs
&gt; &gt;&gt; make it sound like allow_mult is mainly for confict resolution and
&gt; &gt;&gt; degenerate cases, rather than a feature which a data structure could
&gt; &gt;&gt; be designed around.  Does anyone have any links to share, or thoughts
&gt; &gt;&gt; about this broader issue?
&gt; &gt;&gt; Thanks much!
&gt; &gt;&gt; Alex
&gt; &gt;&gt;
&gt; &gt;&gt; _______________________________________________
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12250.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd10.html#12253">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail10.html#12253">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12254.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12240.html">use Siblings to implement a message queue?</a></span> <span class="sender italic">Alex Rice</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12241.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Jeremiah Peschka</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12242.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Tom Santero</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg12243.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Dmitry Demeshchuk</span></li>
<li class="icons-email"><span class="subject"><a href="msg12248.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Guido Medina</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12250.html">Re: use Siblings to implement a message queue?</a></span> <span class="sender italic">Alex Rice</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: use Siblings to implement a message que...</span> <span class="sender italic">Jeremiah Peschka</span></li>
<li class="icons-email"><span class="subject"><a href="msg12254.html">Re: use Siblings to implement a message que...</a></span> <span class="sender italic">Guido Medina</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: use Siblings to implement a message queue?">
<input type="hidden" name="msgid" value="CACJEN2o71gXg68hWbU2ZFV_UxKdqZ6cmQzjGnCOBeU4+b0BFQQ@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12253.html">
<input type="submit" value=" Jeremiah Peschka ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+use+Siblings+to+implement+a+message+queue%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12250.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12254.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACJEN2o71gXg68hWbU2ZFV_UxKdqZ6cmQzjGnCOBeU4+b0BFQQ@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
