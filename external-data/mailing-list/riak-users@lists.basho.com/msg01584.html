<!DOCTYPE html>
<html lang="en">
<head>
<title>java driver : lisKeys() returned also deleted keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01584" id="c">
<link rel="index" href="maillist.html#01584" id="i">
<link rel="prev" href="msg01579.html" id="p">
<link rel="next" href="msg01585.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01584.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22java+driver+%5C%3A+lisKeys%5C%28%5C%29+returned+also+deleted+keys%22&amp;o=newest" rel="nofollow"><span itemprop="name">java driver : lisKeys() returned also deleted keys</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Andrea+Campolonghi%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Andrea Campolonghi</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101120" rel="nofollow">Sat, 20 Nov 2010 10:03:27 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I am having this issues with the java driver :
<a  rel="nofollow" href="https://github.com/krestenkrab/riak-java-pb-client">https://github.com/krestenkrab/riak-java-pb-client</a></pre><pre>

After deleting a key the listKeys method still return it.
The following test case put and delete one simple key and fails when
counting the listKeys item.

Any Suggestion?

   public class RiakCacheTest extends TestCase {

 private RiakClient rc;

private String host = &quot;172.16.194.134&quot;;

private int port = 8087;

private String bucket = &quot;bucket&quot;;

  @Override

protected void setUp() throws Exception {

 rc = new RiakClient(this.host,this.port);

 rc.setClientID(this.getClass().toString());

}

  public void testRemove(){

 String key = &quot;key&quot;;

 String value = &quot;Andrea&quot;;

  RiakObject obj = new RiakObject(this.bucket, key, value);

  try{

 this.rc.store(obj);

 assertTrue(getValue(key).equals(value));

 assertEquals(keys().size(),1);

   this.rc.delete(this.bucket, key);

 assertNull(getValue(key));

 assertEquals(keys().size(),0);

   }catch(IOException e){

 e.printStackTrace();

 }

  }

 private String getValue(String key){

 String fetched = &quot;&quot;;

 try{

 RiakObject[] ros = this.rc.fetch(this.bucket, key);

 for(RiakObject ro : ros){

  return ro.getValue().toStringUtf8();

 }

 }catch(IOException e){

 e.printStackTrace();

 }

 return null;

}


 private List keys() {

 ArrayList&lt;String&gt; result = new ArrayList&lt;String&gt;();

 ByteString bucket = ByteString.copyFromUtf8(this.bucket);

  try{

  KeySource keys = this.rc.listKeys(bucket);

  while(keys.hasNext()){

  String key = keys.next().toStringUtf8();

  result.add(key);

  }

 }catch(IOException e){

 e.printStackTrace();

 }

 return result;

}


}

-- 
Andrea Campolonghi

Cell : +39 347 2298435
acampolon...@gmail.com
and...@andreacfm.com
<a  rel="nofollow" href="http://www.andreacfm.com">http://www.andreacfm.com</a>

Railo Team
and...@getrailo.org
<a  rel="nofollow" href="http://getrailo.org">http://getrailo.org</a>
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01579.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01584">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01584">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01585.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">java driver : lisKeys() returned also deleted keys</span> <span class="sender italic">Andrea Campolonghi</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01585.html">Re: java driver : lisKeys() returned also deleted ...</a></span> <span class="sender italic">Andy Gross</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01586.html">Re: java driver : lisKeys() returned also dele...</a></span> <span class="sender italic">Andrea Campolonghi</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01587.html">Re: java driver : lisKeys() returned also ...</a></span> <span class="sender italic">Andrea Campolonghi</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01588.html">Re: java driver : lisKeys() returned a...</a></span> <span class="sender italic">Jon Brisbin</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="java driver : lisKeys() returned also deleted keys">
<input type="hidden" name="msgid" value="AANLkTin_063J15KBWUn60qCCMArZ6N0bhOEd4x8tSfP0@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01584.html">
<input type="submit" value=" Andrea Campolonghi ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22java+driver+%5C%3A+lisKeys%5C%28%5C%29+returned+also+deleted+keys%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01579.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01585.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTin_063J15KBWUn60qCCMArZ6N0bhOEd4x8tSfP0@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
