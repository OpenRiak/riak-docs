<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Whole cluster times out if one node is gone</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01635" id="c">
<link rel="index" href="maillist.html#01635" id="i">
<link rel="prev" href="msg01634.html" id="p">
<link rel="next" href="msg01646.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01635.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Whole+cluster+times+out+if+one+node+is+gone%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Whole cluster times out if one node is gone</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Sean+Cribbs%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sean Cribbs</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101127" rel="nofollow">Sat, 27 Nov 2010 15:21:42 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>1) Riak detects node outage the same way any Erlang system does - when a 
message fails to deliver, or the heartbeat maintained by epmd fails.  The 
default timeout in epmd is 1 minute, which is probably why you're seeing it 
take 1 minute to be detected.
2) If it takes too long (the vnode is overloaded, perhaps, or is just starting 
up as a hint partition) to retrieve from any node, the request can time out.9
3) You could probably configure epmd to timeout sooner, but then you become 
more vulnerable to temporary partitions. YMMV</pre><pre>

Sean Cribbs &lt;s...@basho.com&gt;
Developer Advocate
Basho Technologies, Inc.
<a  rel="nofollow" href="http://basho.com/">http://basho.com/</a>

On Nov 27, 2010, at 3:21 PM, Jay Adkisson wrote:

&gt; Neville, I'm not sure how you mean.  The network gear is all functional, 
&gt; otherwise I wouldn't be able to interact with the machines at all (they're at 
&gt; our colo).  But as far as I understand, if I hard reboot a box (or, in a 
&gt; real-world scenario, the pdu fails), the switch will happily continue 
&gt; forwarding packets into nothingness, causing HTTP requests to hang 
&gt; indefinitely until they time out.  From what Dan said, I would expect that 
&gt; Riak handles that sort of situation intelligently.  I guess my remaining 
&gt; questions are:
&gt; 
&gt; * How does Riak detect that a node is down, and what could cause that to take 
&gt; a full minute?
&gt; * When N=3, what about a single node failure could cause a read with R=1 to 
&gt; time out?
&gt; * Is there a way to configure the strictness of when nodes are assumed dead?  
&gt; I'm thinking like a &quot;timeout&quot; config option or something.
&gt; 
&gt; Peace,
&gt; --Jay
&gt; 
&gt; On Tue, Nov 23, 2010 at 2:55 PM, Neville Burnell &lt;neville.burn...@gmail.com&gt; 
&gt; wrote:
&gt; Just a thought ... have you verified your switch, cables, nics, etc
&gt; 
&gt; 
&gt; On 24 November 2010 09:33, Jay Adkisson &lt;j4yf...@gmail.com&gt; wrote:
&gt; (many profuse apologies to Dan - hit &quot;reply&quot; instead of &quot;reply all&quot;)
&gt; 
&gt; Alrighty, I've done a little more digging.  When I throttle the writes 
&gt; heavily (2/sec) and set R and W to 1 all around, the cluster works just fine 
&gt; after I restart the node for about 15-20 seconds.  Then the read request 
&gt; hangs for about a minute, until node D disappears from connected_nodes in 
&gt; riak-admin status, at which point it returns the desired value (although 
&gt; sometimes I get a 503):
&gt; 
&gt; --2010-11-23 13:01:28--  http://&lt;node A&gt;:8098/riak/&lt;bucket&gt;/&lt;key&gt;?r=1
&gt; Resolving &lt;node A&gt;... &lt;ip addr&gt;
&gt; Connecting to &lt;node A&gt;|&lt;ip addr&gt;|:8098... connected.
&gt; HTTP request sent, awaiting response... &lt;hang...&gt; 200 OK
&gt; Length: 3684 (3.6K) [image/jpeg]
&gt; Saving to: `&lt;key&gt;?r=1'
&gt; 
&gt; 100%[======================================&gt;] 3,684       --.-K/s   in 0s
&gt; 
&gt; 2010-11-23 13:02:21 (49.5 MB/s) - `&lt;key&gt;?r=1' saved [3684/3684]
&gt; 
&gt; --2010-11-23 13:02:23--  http://&lt;node A&gt;:8098/riak/&lt;bucket&gt;/&lt;key&gt;?r=1
&gt; Resolving &lt;node A&gt;... &lt;ip addr&gt;
&gt; Connecting to &lt;node A&gt;|&lt;ip addr&gt;|:8098... connected.
&gt; HTTP request sent, awaiting response... 200 OK
&gt; Length: 3684 (3.6K) [image/jpeg]
&gt; Saving to: `&lt;key&gt;?r=1'
&gt; 
&gt; 100%[======================================&gt;] 3,684       --.-K/s   in 0s
&gt; 
&gt; 2010-11-23 13:02:23 (220 MB/s) - `&lt;key&gt;?r=1' saved [3684/3684]
&gt; 
&gt; Afterwards, node D comes back up and re-joins the cluster seamlessly.
&gt; 
&gt; Any insights?  
&gt; 
&gt; --Jay
&gt; 
&gt; On Mon, Nov 22, 2010 at 5:59 PM, Jay Adkisson &lt;j4yf...@gmail.com&gt; wrote:
&gt; Hey Dan,
&gt; 
&gt; Thanks for the response!  I tried it again while watching `riak-admin status` 
&gt; - basically, it takes about 30 seconds of node C being down before riak 
&gt; realizes it's gone.  During that time, if I'm writing to the cluster at all 
&gt; (I throttled it to 2 writes per second for testing), both writes and reads 
&gt; hang indefinitely, and sometimes time out.
&gt; 
&gt; I'm using Ripple to do the writes, and wget to test reads, all on node A for 
&gt; now, since I know it'll be up.  I'm using the default R and W options for now.
&gt; 
&gt; Thanks for the help and clarification around ringready.
&gt; 
&gt; --Jay
&gt; 
&gt; 
&gt; On Mon, Nov 22, 2010 at 5:15 PM, Dan Reverri &lt;d...@basho.com&gt; wrote:
&gt; Your HTTP calls should not being timing out. Are you sending requests 
&gt; directly to the Riak node or are you using a load balancer? How much load are 
&gt; you placing on node A? Is it a write only load or are there reads as well? 
&gt; Can you confirm &quot;all&quot; requests time out or is it a large subset of the 
&gt; requests? How large are the objects being written? Are you setting R and W in 
&gt; the request? Are you using a particular client (Ruby, Python, etc.)? Can you 
&gt; provide the output of &quot;riak-admin status&quot; from node A?
&gt; 
&gt; Regarding the ringready command; that is behaving as I would expect 
&gt; considering a node is down.
&gt; 
&gt; Thanks,
&gt; Dan
&gt; 
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt; 
&gt; 
&gt; On Mon, Nov 22, 2010 at 4:55 PM, Jay Adkisson &lt;j4yf...@gmail.com&gt; wrote:
&gt; Hey all,
&gt; 
&gt; Here's what I'm seeing: I have four nodes A, B, C, and D.  I'm loading lots 
&gt; of data into node A, which is being distributed evenly across the nodes.  If 
&gt; I physically reboot node D, all my HTTP calls time out, and `riak-admin 
&gt; ringready` complains that not all nodes are up.  Is this intended behavior?  
&gt; Is there a configuration option I can set so it fails more gracefully?
&gt; 
&gt; --Jay
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01634.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01635">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01635">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01646.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg01601.html">Whole cluster times out if one node is gone</a></span> <span class="sender italic">Jay Adkisson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01602.html">Re: Whole cluster times out if one node is gone</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01603.html">Re: Whole cluster times out if one node is gone</a></span> <span class="sender italic">Jay Adkisson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01613.html">Re: Whole cluster times out if one node is ...</a></span> <span class="sender italic">Jay Adkisson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01614.html">Re: Whole cluster times out if one node...</a></span> <span class="sender italic">Neville Burnell</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01634.html">Re: Whole cluster times out if one...</a></span> <span class="sender italic">Jay Adkisson</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Whole cluster times out if...</span> <span class="sender italic">Sean Cribbs</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg01646.html">Re: Whole cluster times out if one node...</a></span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01652.html">Re: Whole cluster times out if one...</a></span> <span class="sender italic">Jay Adkisson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01653.html">Re: Whole cluster times out if...</a></span> <span class="sender italic">Dan Reverri</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg01655.html">Re: Whole cluster times ou...</a></span> <span class="sender italic">Jay Adkisson</span></li>
<li class="icons-email"><span class="subject"><a href="msg01659.html">Re: Whole cluster times ou...</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email"><span class="subject"><a href="msg01662.html">Re: Whole cluster times ou...</a></span> <span class="sender italic">Dan Reverri</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Whole cluster times out if one node is gone">
<input type="hidden" name="msgid" value="89C22E24-5407-4595-A0B6-8427789E0010@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01635.html">
<input type="submit" value=" Sean Cribbs ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Whole+cluster+times+out+if+one+node+is+gone%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01634.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01646.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">89C22E24-5407-4595-A0B6-8427789E0010@basho.com</li>
</ul>
</div>
</body>
</html>
