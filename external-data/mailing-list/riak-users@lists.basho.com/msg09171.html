<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: amortized stalls in leveldb</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09171" id="c">
<link rel="index" href="maillist.html#09171" id="i">
<link rel="prev" href="msg09168.html" id="p">
<link rel="next" href="msg09175.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09171.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+amortized+stalls+in+leveldb%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: amortized stalls in leveldb</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Von%5C-Maszewski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Von-Maszewski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121102" rel="nofollow">Fri, 02 Nov 2012 12:36:42 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Base path:  ~/riak/deps/eleveldb/c_src/leveldb

Intentional stall:  db/db_impl.cc  function DBImpl::MakeRoomForWrite() â€¦ see 
two &quot;else if&quot; clauses that contain Log() calls with &quot;waiting / waiting 2&quot;.  
These are the two conditions in which the Google code intentionally stalls the 
caller via Wait().  </pre><pre>

Write throttle:  in the first few lines of the same function, you will see the 
variable &quot;throttle&quot; used.  This is the write throttle I implemented.  Its 
implementation includes logic in db/version_set.h, which depends upon inputs 
sent to SetWriteRate() (version_set.h) and from GetBackgroundBacklog() 
(util/env_posix.cc).

This is my second generation throttle.  1.2.0 contained a throttle that was 
added in a rush and was not responsive to the users' environment.  1.2.1 is 
more refined and utilizes direct measurements from actual write throughput.

The write throttle was tested via 12 scenarios with data values ranging in size 
from 800 bytes to 130k and 2 to 64 vnodes.  The most harsh was 130k with 64 
vnodes, the next was 130k with 2 vnodes (this latter case simulates a vnode 
handoff which was failing with the 1.2.0 throttle).  The goal:  equivalent 
overall throughput, no stalls.

What else?

Matthew



On Nov 2, 2012, at 3:13 PM, Dietrich Featherston wrote:

&gt; Hi Matthew,
&gt; 
&gt; Thanks again for your help with this upgrade. You mentioned yesterday that we 
&gt; might be seeing iowait times higher due to amortizing stalls over all writes 
&gt; vice the stop-the-world scenario seen in previous versions. Would you mind 
&gt; pointing me to the codepath where these stalls are forecasted and implemented?
&gt; 
&gt; Thanks,
&gt; D
&gt; 


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09168.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09171">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09171">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09175.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: amortized stalls in leveldb">
<input type="hidden" name="msgid" value="ABE4D1A3-31E9-47D4-9A4D-B5E47A57E44A@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09171.html">
<input type="submit" value=" Matthew Von-Maszewski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+amortized+stalls+in+leveldb%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09168.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09175.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">ABE4D1A3-31E9-47D4-9A4D-B5E47A57E44A@basho.com</li>
</ul>
</div>
</body>
</html>
