<!DOCTYPE html>
<html lang="en">
<head>
<title>RE: missing keys?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08548" id="c">
<link rel="index" href="maillist.html#08548" id="i">
<link rel="prev" href="msg08547.html" id="p">
<link rel="next" href="msg08540.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08548.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+missing+keys%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">RE: missing keys?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Pat+Lynch%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Pat Lynch</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120914" rel="nofollow">Fri, 14 Sep 2012 12:20:51 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Alexander,

Ok, I'll change the dw settings and see what the throughput is like.  Obviously 
setting the 'sync' option will also kill performance after that..  </pre><pre>

I'm hoping to get back to Riak Monday or Tuesday.

thanks again,
Pat.


Subject: Re: missing keys?
From: sicul...@gmail.com
Date: Fri, 14 Sep 2012 15:17:09 -0400
CC: rzeze...@basho.com; riak-users@lists.basho.com
To: plynch1...@hotmail.com

&quot;Lazy writing of the data is not really an option for what we need.&quot;
Then I would say dw should equal n (dw=3 in your case) which would ensure that 
all data is on disk. Try rerunning your tests with that configuration. This 
should negatively affect performance though.

-Alexander Sicular
@siculars


On Sep 14, 2012, at 3:07 PM, Pat Lynch wrote:Hey Alexander,
thanks for the response.  Yup - I'm a Riak newbie for sure :).  I have 
replication set to 3 on the cluster.  So, if dw=2, is it durable or not?  even 
if it's durable across vnodes.  If it is durable across vnodes, then it should 
be queryable? 

One of the big considerations I have to look into is if the client writes to 
the server, and that client gets told that the key has been written, is it 
actually on disk or not?  Eventual consistency is fine, but many of the other 
datastores have a WAL (much like leveldb), so at least if I pull the plug or 
the app dies we know that on restart the key is actually available.  Do any of 
the RIAK settings give me this? (I thought that I was getting this with 
dw=2/r=2/w=2 and replication).  Lazy writing of the data is not really an 
option for what we need.

thanks again,
Pat



Subject: Re: missing keys?
From: sicul...@gmail.com
Date: Fri, 14 Sep 2012 12:51:28 -0400
CC: rzeze...@basho.com; riak-users@lists.basho.com
To: plynch1...@hotmail.com

Hi Pat,
&quot;thanks for that.  Is the default on dw not also quorum though??  so, in my 
case it should be 2 (since I have 2 nodes)??&quot;
Consider the difference in the usage of the word &quot;node.&quot; There is actually a 
large difference between two definitions of the commonly used word, &quot;node.&quot;
1. node: virtual node, as indicated by the ring_creation_size default value, 
which is 64, and can be changed in app.config.
2. node: physical node, which is the number of physical machines in a cluster.
Historically and at the moment, virtual nodes are evenly divided amongst 
physical nodes.
The term &quot;node&quot; has been conflated and continues to be a pain point for 
newcomers to Riak (not that you are a newcomer, but in general).
In all cases, the values r, w, dw and considerations for quorum are entirely 
dependent on the replication value, known as n or n_val,  which in turn 
represents replicas on a per virtual node basis.
Hope that clears some stuff up,
-Alexander Sicular
@siculars
On Sep 14, 2012, at 12:17 PM, Pat Lynch wrote:Hi,
thanks for that.  Is the default on dw not also quorum though??  so, in my case 
it should be 2 (since I have 2 nodes)??

thanks,
Pat.

Date: Fri, 14 Sep 2012 12:11:25 -0400
Subject: Re: missing keys?
From: rzeze...@basho.com
To: plynch1...@hotmail.com
CC: s...@basho.com; riak-users@lists.basho.com

Pat,

On Fri, Sep 14, 2012 at 11:08 AM, Pat Lynch &lt;plynch1...@hotmail.com&gt; wrote:
So, if I write a key to a cluster and then try to query that key, it may not 
find it unless I retry?  Even if r=2 &amp; w=2 ?  I thought that at least 2 systems 
had to have that key (either in memory or disk) for the write to have succeeded 
with those settings?  If I had w=3, would you expect any missed keys ??  (note 
that I didn't try that because I expected performance issues).

It's important to note that `w` is considered complete once the value is queued 
in-memory waiting to be written do disk [1].  A read does not check the queue 
but only on-disk data.  The `dw` flag is what you want to know that the value 
has made it to disk and can be seen by a read.
-Z
[1]: 
<a  rel="nofollow" href="https://github.com/basho/riak_kv/blob/master/src/riak_kv_vnode.erl#L284_______________________________________________">https://github.com/basho/riak_kv/blob/master/src/riak_kv_vnode.erl#L284_______________________________________________</a>
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
                                          </pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08547.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08548">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08548">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08540.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08537.html">missing keys?</a></span> <span class="sender italic">Pat Lynch</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08538.html">Re: missing keys?</a></span> <span class="sender italic">Sean Cribbs</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08539.html">RE: missing keys?</a></span> <span class="sender italic">Pat Lynch</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08542.html">Re: missing keys?</a></span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08543.html">RE: missing keys?</a></span> <span class="sender italic">Pat Lynch</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08545.html">Re: missing keys?</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08546.html">RE: missing keys?</a></span> <span class="sender italic">Pat Lynch</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08547.html">Re: missing keys?</a></span> <span class="sender italic">Alexander Sicular</span></li>
<li class="icons-email tSliceCur"><span class="subject">RE: missing keys?</span> <span class="sender italic">Pat Lynch</span></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg08540.html">Re: missing keys?</a></span> <span class="sender italic">Reid Draper</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08541.html">RE: missing keys?</a></span> <span class="sender italic">Pat Lynch</span></li>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="RE: missing keys?">
<input type="hidden" name="msgid" value="DUB002-W60D1640349D69AEF058547C6900@phx.gbl">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08548.html">
<input type="submit" value=" Pat Lynch ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22RE%5C%3A+missing+keys%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08547.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08540.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">DUB002-W60D1640349D69AEF058547C6900@phx.gbl</li>
</ul>
</div>
</body>
</html>
