<!DOCTYPE html>
<html lang="en">
<head>
<title>Leveled and Anti-Entropy</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#18395" id="c">
<link rel="index" href="maillist.html#18395" id="i">
<link rel="prev" href="msg18389.html" id="p">
<link rel="next" href="msg18396.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg18395.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Leveled+and+Anti%5C-Entropy%22&amp;o=newest" rel="nofollow"><span itemprop="name">Leveled and Anti-Entropy</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Martin+Sumner%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Martin Sumner</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20170721" rel="nofollow">Fri, 21 Jul 2017 07:08:32 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I've added some anti-entropy features to Leveled (the pure-Erlang KV store
designed as a Riak backend).  These features are in-part an experiment in
how to approach both anti-entropy and full-sync multi-data centre
replication in the future.</pre><pre>

There's a long write-up, including some history of AAE in Riak:

<a  rel="nofollow" href="https://github.com/martinsumner/leveled/blob/master/docs/ANTI_ENTROPY.md">https://github.com/martinsumner/leveled/blob/master/docs/ANTI_ENTROPY.md</a>

In summary, Riak's current AAE is based on cryptographically strong Merkle
trees, and this experiment is based on removing that security strength, as
it isn't relevant to the context in which is used.  Instead Leveled now has
Merkle Trees that can be merged and also can be built incrementally (i.e.
be built key by key even when the keys are not in segment order).

Using these new trees (coined TicTac trees to fit into Leveled's terrible
naming convention), we can build AAE trees in folds incrementally and hence
at a lower cost, but also merge trees across independent stores.  In the
future trees can be built from folds using Riak coverage queries, across
either indexes or objects in the store - and compared between different
database clusters even where those clusters are partitioned differently
e.g. different ring-sizes.

The expectation is that there will be more flexibility of choice in what we
can decide to compare at run time - not just are the objects consistent,
are the indexes consistent.  Also split from partition constraints there
will be improved flexibility in what we can decide to compare between -
e.g. make it easier to compare with a different database.

Coupled with this there's a demonstration of using temporary indexes in
Leveled, index entries that auto-expire at a TTL, and we've shown how this
can be used with tree-creating folds to compare recent changes between
stores at a lower cost than comparing the whole database state: with the
added advantage that the long-term footprint of the database is not
extended by maintaining a separate copy of all the keys and hashes.

Concurrently to this, we now have some other work ongoing in the space of
replication and anti-entropy:

- @russelldb is continuing to test and improve his open source real-time
replication solution (rabl) which uses RabbitMQ.  He's hoping to be able to
talk further on progress with this by the end of August.
- I'm working on implementing in riak_core a core_node_worker_pool, which
is intended to compliment the core_vnode_worker_pool but allow for coverage
queries where snapshots are taken on a covering set of vnodes, but folds
are then scheduled to run one-at-a-time on each node.  This can then be
used to regulate the impact of anti-entropy folds.

Our current target is to have a release candidate of open-source
replication (both real-time and full-sync) by the end of September.  This
will initially be focused only on replication between two Riak clusters.

Regards

Martin (@masleeds)

P.S. Hopefully next Friday we should also be able to report back on the
improvements and test enhancements that followed up the work on riak_core
claim.
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg18389.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#18395">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#18395">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg18396.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Leveled and Anti-Entropy</span> <span class="sender italic">Martin Sumner</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18396.html">Re: Leveled and Anti-Entropy</a></span> <span class="sender italic">Heinz N. Gies</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg18397.html">Re: Leveled and Anti-Entropy</a></span> <span class="sender italic">Martin Sumner</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Leveled and Anti-Entropy">
<input type="hidden" name="msgid" value="CANzjUxC2oNt1fV7Lgp8pNRgLP70ezCA73h-29NEgpvaO_7WXSg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg18395.html">
<input type="submit" value=" Martin Sumner ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Leveled+and+Anti%5C-Entropy%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg18389.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg18396.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CANzjUxC2oNt1fV7Lgp8pNRgLP70ezCA73h-29NEgpvaO_7WXSg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
