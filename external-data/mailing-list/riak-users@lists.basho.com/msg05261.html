<!DOCTYPE html>
<html lang="en">
<head>
<title>system freezes for 2 minutes after network partition</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#05261" id="c">
<link rel="index" href="maillist.html#05261" id="i">
<link rel="prev" href="msg05260.html" id="p">
<link rel="next" href="msg05263.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg05261.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22system+freezes+for+2+minutes+after+network+partition%22&amp;o=newest" rel="nofollow"><span itemprop="name">system freezes for 2 minutes after network partition</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22shared+mailinglists%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">shared mailinglists</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20111024" rel="nofollow">Mon, 24 Oct 2011 05:55:06 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,
I am investigating the feasibility of using Riak for an application where
there is a firm requirement for the system to remain available in the face
of node failures and network partitions. Up to now, I have found Riak to be
quite resilient to node failures, but network partitions are causing more
problems.</pre><pre>

My setup involves a cluster of five nodes, each running Riak 1.0 on a
separate Linux box on a common subnet. Let's call the cluster [A,B,C,D,E].
On a sixth box, I run the Java PB Cluster Client 1.0.1. The client fires
fetch and store requests at the cluster using various keys and a gle bucket,
and everything works fine under normal operating conditions. The bucket has
the default properties N=3, W=2, R=2.

During the run, I use iptables to simulate a network partition in which one
node in the cluster is disconnected from the other four (but all five remain
connected to the client). To disconnect from node A, for example, I run:

sudo /sbin/iptables -A INPUT -s &lt;node A&gt; -j REJECT
 sudo /sbin/iptables -A OUTPUT -d &lt;node A&gt; -j REJECT

So at this point we have in effect a majority cluster [A,B,C,D] and a
minority cluster [E}. My expectation was that any request from the client to
the minority cluster will fail because a quorum cannot bbtained for either
read or write requests. On the other hand, I expect requesto the majority
cluster to succeed because there will always be at least two of the three
copies stored within the majority cluster. Therefore I expect very little
impact on the performance of the system, beyond the need to retry 20% of the
requests. Is this a reasonable expectation, or am I missing something
important here ?

What actually happens after the partition is that the whole system freezes
up for some time. For one minute there appears to be no processing done and
nothing is written to the logs. Then after one minute the nodes in the
majority cluster show the following in their logs:

2011-10-24 08:4:10.098 [error] &lt;0.19280.0&gt; ** Node 'riak@&lt;node E&gt;' not
responding **
** Removing (timedout) connection **

The node in the minority cluster has similar log entries, except that it
finds four nodes not responding.

If the network remains partitioned, processing stops for a total of two
minutes before resuming. When the partition is repaired, as expected I see a
lot of handoff activity in the logs and the whole cluster soon becomes
consistent.

The main concern I have is that processing stops altogether for 2 minutes
when the network is partitioned. Can you explain why this is happening, and
whether there is something I can do allow processing to continue ? As far as
I can see, it ought to be possible for the majority partition to continue
processing requests without interruption, and without any errors being
generated.

Thanks in advance for your help.

Malcolm
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg05260.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#05261">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#05261">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg05263.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">system freezes for 2 minutes after network partition</span> <span class="sender italic">shared mailinglists</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05263.html">Re: system freezes for 2 minutes after network pa...</a></span> <span class="sender italic">Soren Hansen</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg05266.html">Re: system freezes for 2 minutes after networ...</a></span> <span class="sender italic">shared mailinglists</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="system freezes for 2 minutes after network partition">
<input type="hidden" name="msgid" value="CACsQ3F1ke4eGRZHt+dJ-xKtUuBsSdsRB++wuxTf1_1vm6fepuw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg05261.html">
<input type="submit" value=" shared mailinglists ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22system+freezes+for+2+minutes+after+network+partition%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg05260.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg05263.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACsQ3F1ke4eGRZHt+dJ-xKtUuBsSdsRB++wuxTf1_1vm6fepuw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
