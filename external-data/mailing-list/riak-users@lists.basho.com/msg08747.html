<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Key expiration</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#08747" id="c">
<link rel="index" href="maillist.html#08747" id="i">
<link rel="prev" href="msg08724.html" id="p">
<link rel="next" href="msg08615.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg08747.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Key+expiration%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Key expiration</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Anthony+Molinaro%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Anthony Molinaro</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120928" rel="nofollow">Fri, 28 Sep 2012 12:47:13 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
On Thu, Sep 27, 2012 at 12:36:27PM +0200, Nico Meyer wrote:
&gt; If the final fix is contained in the most recent version on github,
&gt; then all it effectively does is to add an offset to the expiration
&gt; time (for the purpose of triggering merges, not actual expiration).</pre><pre>

Yeah, I finally got around to looking through the code.  I think this
patch will help in that automatic merges will happen, just not every
3 minutes.  Since the trigger ends up being checking for data points
older than the expiration time + grace period, but the actual merging
will remove those older than the expiration time.  So this essentially
makes the constant merging move from every 3 minutes to every grace
period seconds (with the caveat that other triggers still apply, so
file size and dead bytes).

&gt; The old behaviour can be a problem if you never update or delete any
&gt; keys explicitly, which is mostly the case if one records time
&gt; series. There is/was no background thread that scans for expired
&gt; keys memory, so bitcask does not know how many keys are expired at
&gt; any given moment. Background scanning would indeed be one solution.
&gt; But maybe one that is too expensive CPU wise.
&gt; 
&gt; After sleeping over the problem, I believe indeed the easiest
&gt; solution would be to look at the file creation time, and only
&gt; trigger merges for files that are at least an hour old or so (could
&gt; be configurable). But in your and my case this will most likely just
&gt; degenerate to merging every hour anyway, which is still much better
&gt; than merging every 3 minutes, as is the case now.
&gt; 
&gt; Come to think of it, increasing the interval between merge checks
&gt; (make it configurable!) might just work as well for most people. So
&gt; maybe that's the quickest solution.

I think this is essentially what their solution does, they just call
it grace time, but it basically changes the interval.  We're going
to be trying the patch out next week, I'll let you all know how it
goes.

-Anthony

-- 
------------------------------------------------------------------------
Anthony Molinaro                           &lt;antho...@alumni.caltech.edu&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg08724.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#08747">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#08747">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg08615.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg08613.html">Key expiration</a></span> <span class="sender italic">Mike Oxford</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08616.html">Re: Key expiration</a></span> <span class="sender italic">David Smith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08702.html">Re: Key expiration</a></span> <span class="sender italic">Anthony Molinaro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08712.html">Re: Key expiration</a></span> <span class="sender italic">Nico Meyer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08713.html">Re: Key expiration</a></span> <span class="sender italic">Kresten Krab Thorup</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08716.html">Re: Key expiration</a></span> <span class="sender italic">Anthony Molinaro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08725.html">Re: Key expiration</a></span> <span class="sender italic">Nico Meyer</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg08715.html">Re: Key expiration</a></span> <span class="sender italic">Anthony Molinaro</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg08724.html">Re: Key expiration</a></span> <span class="sender italic">Nico Meyer</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Key expiration</span> <span class="sender italic">Anthony Molinaro</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Key expiration">
<input type="hidden" name="msgid" value="20120928193554.GA48868@alumni.caltech.edu">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg08747.html">
<input type="submit" value=" Anthony Molinaro ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Key+expiration%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg08724.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg08615.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">20120928193554.GA48868@alumni.caltech.edu</li>
</ul>
</div>
</body>
</html>
