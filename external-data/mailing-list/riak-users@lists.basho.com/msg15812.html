<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Using Riak for Data with many Entities and Relationships</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15812" id="c">
<link rel="index" href="maillist.html#15812" id="i">
<link rel="prev" href="msg15801.html" id="p">
<link rel="next" href="msg15802.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15812.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Using+Riak+for+Data+with+many+Entities+and+Relationships%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Using Riak for Data with many Entities and Relationships</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Christopher+Meiklejohn%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Christopher Meiklejohn</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150304" rel="nofollow">Wed, 04 Mar 2015 06:53:52 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>
&gt; On Feb 26, 2015, at 5:41 PM, Matt Brooks &lt;mtbrook...@gmail.com&gt; wrote:
&gt; 
&gt; I am designing a web application that, for the purpose of this conversation, 
&gt; deals with three main entities: 
&gt;       • Users
&gt;       • Groups
&gt;       • Tasks
&gt; Users are members of groups, and tasks belong to groups. 
&gt; 
&gt; Early in the development of the application, Neo4j was used to store the 
&gt; data. Users would have a MEMBER_OF relationship to a group, and tasks would 
&gt; have a BELONGS_TO relationship to a group. Neo4j was nice for access control 
&gt; because I could add permissions to the MEMBER_OF relationship. It was also 
&gt; nice for the simple BELONGS_TO relationship. Neo4j separates entites and 
&gt; relationships nicely. 
&gt; 
&gt; After reading about Riak and reminiscing about my use of MongoDB in the past, 
&gt; I began to think about using Riak to store my data instead of Neo4j. Storing 
&gt; the users, groups, and tasks seems trivial enough. But storing the 
&gt; relationships seems a bit tougher.
&gt; 
&gt;  I am planning on storing the entities in three buckets:
&gt;       • user
&gt;       • group
&gt;       • task
&gt; ...where each of the buckets has the entity's ID as the key and a map of the 
&gt; relevant information as the value. 
&gt; 
&gt; What I am struggling with now is modeling the relationships I so easily 
&gt; modeled in Neo4j, in Riak. I have a few ideas:
&gt;       • Store both user IDs and task IDs in lists inside of the group 
&gt; information. The user ID list would also include permissions for the users. 
&gt;       • Store group IDs in a list inside of the user information and task IDs 
&gt; in a list inside of the group information.
&gt;       • Use a user-group bucket and a group-task bucket. The user-group 
&gt; bucket will have user IDs as the keys and a list of maps as the value. The 
&gt; maps in question would hold a group ID and permission information for the 
&gt; group. The group-task bucket would be similar to the user-group bucket, but 
&gt; instead of a list of maps, it would simply have a list of task IDs.
&gt;       • Use Riak's links for both user membership and tasks belonging to 
&gt; groups. A given user would have member links to groups, and a given group 
&gt; would have task links to tasks. Permissions for a given user ID would be 
&gt; stored in the group somewhere.
&gt; None of the four entirely satisfy me.. 
&gt; 
&gt; Number one makes it really hard and inefficient to ask the DB for the groups 
&gt; that a user is a member of (I would have to go through every single group and 
&gt; check if the user ID is in the member list). The same issue occurs with tasks.
&gt; 
&gt; Number two makes it really easy to go from user to group to tasks, but makes 
&gt; it difficult to go from group back to users. What if I wanted to ask &quot;what 
&gt; users are members of group X?&quot;. 
&gt; 
&gt; Number three works in a way similar to relational databases, and does a good 
&gt; job of separating relationships from entities. This has the same issues 
&gt; mentioned in number two.
&gt; 
&gt; Number four seems to be the one that might be considered idiomatic Riak 
&gt; usage, but we completely separate permissions from the member relationship a 
&gt; user has with a group due to links not supporting complex properties. </pre><pre>

Hi Matt,

My apologies for the delay in my response.

Link walking, as in first-class support for them, is deprecated.  In most 
clients today, link walking is implemented through a MapReduce job which uses 
the object’s metadata to traverse the graph.  Given this relies on MapReduce, 
we don’t recommend using this in production.

I’d probably do something similar to number 2, however, I’d probably try to use 
the Riak Map Data Type, which models a convergent server-side dictionary, to 
model each user. [1, 2]  In this object, you could store a list of group 
identifiers for each user, and use Riak Search to perform the group to users 
query, given the built in search facility can query into the Map object. [3]

There is one gotcha with most of these design patterns: given Riak doesn’t 
provide a causal consistency guarantee, you may run into a scenario where you 
read a user object that contains a reference to a group that you can’t read 
yet.  This can happen for a variety of reasons: contacted a replica which 
didn’t receive the update yet, contacted a fallback replica because of the 
failure or inability to contact a primary, etc.  It’s important to make sure 
your application can resolve these situations at read time.

- Christopher

[1] <a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/using/data-types/">http://docs.basho.com/riak/latest/dev/using/data-types/</a>
[2] <a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/data-modeling/data-types/">http://docs.basho.com/riak/latest/dev/data-modeling/data-types/</a>
[3] <a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/search/search-data-types/">http://docs.basho.com/riak/latest/dev/search/search-data-types/</a>

Christopher Meiklejohn
Senior Software Engineer
Basho Technologies, Inc.
cmeiklej...@basho.com


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15801.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15812">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15812">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15802.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg15801.html">Using Riak for Data with many Entities and Relation...</a></span> <span class="sender italic">Matt Brooks</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Using Riak for Data with many Entities and...</span> <span class="sender italic">Christopher Meiklejohn</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Using Riak for Data with many Entities and Relationships">
<input type="hidden" name="msgid" value="24F23F35-31C7-4FCA-95DE-22C7DA88C7FA@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15812.html">
<input type="submit" value=" Christopher Meiklejohn ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Using+Riak+for+Data+with+many+Entities+and+Relationships%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15801.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15802.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">24F23F35-31C7-4FCA-95DE-22C7DA88C7FA@basho.com</li>
</ul>
</div>
</body>
</html>
