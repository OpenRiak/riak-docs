<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: EC2 and RIAK</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#02838" id="c">
<link rel="index" href="maillist.html#02838" id="i">
<link rel="prev" href="msg02836.html" id="p">
<link rel="next" href="msg02841.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg02838.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+EC2+and+RIAK%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: EC2 and RIAK</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jason+J.+W.+Williams%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jason J. W. Williams</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20110401" rel="nofollow">Fri, 01 Apr 2011 09:30:37 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi David,

If you want both good performance and reliability you might look at somebody 
like SoftLayer who will let you mix and match cloud and dedicated servers to 
meet your needs. Both they and Voxel have cloud servers that beat the pants off 
EC2. </pre><pre>

-J

Sent via iPhone

Is your e-mail Premiere?

On Apr 1, 2011, at 9:51, David Dawson &lt;david.daw...@gmail.com&gt; wrote:

&gt; Mathias and Alexander,
&gt; 
&gt;    Thanks for both of your replies they were very informative and really have 
&gt; helped me to make my mind up, but to summarise:
&gt; 
&gt;    - If you want good predictable performance but you are happy to live with 
&gt; the risk of loosing some of your data ( in the event of a cluster failure 
&gt; where the number of nodes that fail &gt; than your n_val ) then run with the 
&gt; local ephemeral storage in RAID 5  or 10 and take snapshots of the data 
&gt; periodically or run in dual DC mode with replication.
&gt;    - If you want 100%  assurance that your data is available and you are 
&gt; happy with unpredictable performance then use EBS.
&gt;    - If you want 100% assurance that your data is available and also has 
&gt; predictable performance then Amazon EC2 is not the most optimal choice.
&gt; 
&gt;    In our scenario we are doing a equal amount of reads and writes, and will 
&gt; need to guarantee  about 32K ops/sec from a RIAK cluster over a 2 hour period 
&gt; with minimal risks of a outage or drop in performance, hence I am guessing 
&gt; that maybe EC2 is not the right choice for us. We are going to look at Joyent 
&gt; as an alternative, that said has anyone else used other solutions e.g. 
&gt; RackSpace cloud?
&gt; 
&gt; Dave
&gt; 
&gt; 
&gt; On 1 Apr 2011, at 14:21, Mathias Meyer wrote:
&gt; 
&gt;&gt; Hi David,
&gt;&gt; 
&gt;&gt; Alexander already gave you a good rundown on EC2 and Riak, but let me add 
&gt;&gt; some of my own experiences running databases on EC2 in general. 
&gt;&gt; 
&gt;&gt; The short answer is, Riak is certainly successfully used in production on 
&gt;&gt; EC2, so nothing should hold you back from testing a setup on EC2. But 
&gt;&gt; there's a whole bunch of things you should keep in mind.
&gt;&gt; 
&gt;&gt; First, it's probably a good idea to avoid using ephemeral storage as 
&gt;&gt; persistent storage. Even though it rarely happens, instances can crash on 
&gt;&gt; EC2 for any kind of reason, mostly a hardware failure of the underlying host 
&gt;&gt; of course.
&gt;&gt; 
&gt;&gt; Cluster compute instances offer especially high CPU power, but what you 
&gt;&gt; really want is really fast and reliable storage I/O, persisted for eternity 
&gt;&gt; if need be. CC instances are certainly a lot better than any other instance 
&gt;&gt; in that terms of general I/O (see [2] for a comparison), but fall prey to 
&gt;&gt; similar limitations in terms of network storage I/O as other instance types, 
&gt;&gt; see below.
&gt;&gt; 
&gt;&gt; The RAID 0'd ephemeral storage on the cluster compute instances may sound 
&gt;&gt; good in theory in terms of performance, but in practice it takes away data 
&gt;&gt; durability in case of a single disk failure. One disk fails, and the data on 
&gt;&gt; that node is gone. Depending on what kinds of seek your doing, an EBS setup 
&gt;&gt; may even turn out to be faster. See [6] and [4] for a comparison and some 
&gt;&gt; initial and extended measurements, and [7] for another comparison. But 
&gt;&gt; certainly, the cluster compute instance's ephemeral storage can achieve a 
&gt;&gt; good amount of throughput, see [5] for some pretty graphs comparing both 
&gt;&gt; RAID and non-RAID setups.
&gt;&gt; 
&gt;&gt; As Alexander pointed out, multiple instance failures can make this scenario 
&gt;&gt; a real killer, though you end up with the same risks as running on raw iron 
&gt;&gt; servers. Both ephemeral storage and EBS don't make the problem of a proper 
&gt;&gt; backup disappear. You could e.g. run off ephemeral storage, relying on both 
&gt;&gt; Riak's replication and a good backup e.g. to an EBS volume or to S3.
&gt;&gt; 
&gt;&gt; EBS on the other hand is prone to a large variance in network latency, 
&gt;&gt; making performance at any point unpredictable and unreliable. Every 
&gt;&gt; measurement you take is likely to be different an hour later. This may sound 
&gt;&gt; extreme, but it turns out to be a very big issue for databases where there's 
&gt;&gt; lots of disk I/O involved to read and write data, as is the case with Riak's 
&gt;&gt; Bitcask storage.
&gt;&gt; 
&gt;&gt; You can increase the performance and reliability of EBS by using a RAID of 
&gt;&gt; volumes. Preferrably go for a RAID 5 or RAID 10 to add redundancy. There's 
&gt;&gt; mixed opinions on whether that's really necessary on EBS, with Amazon 
&gt;&gt; keeping the data redundant on their end as well, but in general, it's a good 
&gt;&gt; tradeoff between increased performance through striping and increased 
&gt;&gt; redundancy through mirroring. [1] has a good summary of when it's better to 
&gt;&gt; choose RAID 5 vs. 10.
&gt;&gt; 
&gt;&gt; RAID 0 will obviously bring the best performance, it's certainly a valid 
&gt;&gt; setup. We've been running RAID 0 setups with 4 volumes, and got great 
&gt;&gt; improvements over a single volume. You're also likely to achieve more 
&gt;&gt; throughput on bigger instances with a setup like this. The caveat once again 
&gt;&gt; is that one corrupted volume is enough to make a RAID 0 setup unusable.
&gt;&gt; 
&gt;&gt; Another crazy thought is to setup a RAID striping across a bunch of 
&gt;&gt; ephemeral drives and EBS volumes, maximizing throughput on both local and 
&gt;&gt; network storage. But know what you're getting yourself into with this kind 
&gt;&gt; of setup, especially when your write load is a lot heavier then the 
&gt;&gt; available network bandwidth can handle, a scenario where your network 
&gt;&gt; volumes will never be able to catch up with the local storage.
&gt;&gt; 
&gt;&gt; All that said, EBS I/O sure is reasonably fast, but it depends on your 
&gt;&gt; particular use case and performance requirements. It's also worth noting 
&gt;&gt; that the I/O capabilities of EBS increase with the instance size. The bigger 
&gt;&gt; your instance, the more throughput you'll achieve (see [3]). Bigger 
&gt;&gt; instances tend to have better network throughput in general, with cluster 
&gt;&gt; compute instances obviously having some of the highest bandwidth available.
&gt;&gt; 
&gt;&gt; All this turns out to be much less of a problem when data can be held in 
&gt;&gt; memory very easily, e.g. with Innostore, where you can read and write 
&gt;&gt; to/from cache buffers first and then have InnoDB take care of flushing to 
&gt;&gt; disk.
&gt;&gt; 
&gt;&gt; Personally, I don't think you're overcomplicating things in regard to 
&gt;&gt; multiple availability zones, it's a good idea to do that, when highest 
&gt;&gt; availability possible is your goal, as when it's usually just a single 
&gt;&gt; availability zone that's affected by increased latency or network timeouts, 
&gt;&gt; but as Alexander said, you should think about having cross-datacenter 
&gt;&gt; replication in that scenario, as availability zones are data centers located 
&gt;&gt; in different physical locations. Usually they're not that far apart, but far 
&gt;&gt; enough to increase latency considerably. But as always, it depends on your 
&gt;&gt; particular use case.
&gt;&gt; 
&gt;&gt; Now, after all this realtalk, here's the kicker. Riak's way of replicating 
&gt;&gt; data can make both scenarios work. When it's ensured that your data is 
&gt;&gt; replicated on more than one node, it can work in both ways. You could use 
&gt;&gt; both ephemeral storage and be somewhat safe because data will reside on 
&gt;&gt; multiple nodes. The same is true for EBS volumes, as potential variances in 
&gt;&gt; I/O or even minutes of total unavailabilities (as seen on the recent Reddit 
&gt;&gt; outage) can be recovered a lot easier thanks to handoff and read repairs. 
&gt;&gt; You can increase the number of replicas (n_val) to increase your tolerance 
&gt;&gt; of instance failure, just make sure that n_val is less than the number of 
&gt;&gt; nodes in your cluster.
&gt;&gt; 
&gt;&gt; Don't get me wrong, I love EC2 and EBS, being able to spin up servers at any 
&gt;&gt; time and to attache more storage to a running instance is extremely 
&gt;&gt; powerful, when you can handle the downsides. But if very low latency is what 
&gt;&gt; you're looking for, raw iron with lots of memory and SSD as storage device 
&gt;&gt; thrown on top is hard to beat.
&gt;&gt; 
&gt;&gt; When in doubt, start with a RAID 0 setup on EBS with 4 volumes, and compare 
&gt;&gt; it with a RAID 5 in terms of performance. They're known to give a good 
&gt;&gt; enough performance in a lot of cases. If you decide to go with a RAID, be 
&gt;&gt; sure to add LVM on top for simpler snapshotting, which will be quite painful 
&gt;&gt; if not impossible to get consistent snapshots using just EBS snapshots on a 
&gt;&gt; bunch of striped volumes.
&gt;&gt; 
&gt;&gt; Let us know if you have more questions, there's lots of details involved 
&gt;&gt; when you're going under the hood, but this should cover the most important 
&gt;&gt; bases.
&gt;&gt; 
&gt;&gt; Mathias Meyer
&gt;&gt; Developer Advocate, Basho Technologies
&gt;&gt; 
&gt;&gt; [1] 
&gt;&gt; <a  rel="nofollow" href="http://en.wikipedia.org/wiki/RAID#RAID_10_versus_RAID_5_in_Relational_Databases">http://en.wikipedia.org/wiki/RAID#RAID_10_versus_RAID_5_in_Relational_Databases</a>
&gt;&gt; [2] 
&gt;&gt; <a  rel="nofollow" href="http://blog.cloudharmony.com/2010/09/benchmarking-of-ec2s-new-cluster.html">http://blog.cloudharmony.com/2010/09/benchmarking-of-ec2s-new-cluster.html</a>
&gt;&gt; [3] <a  rel="nofollow" href="http://blog.cloudharmony.com/2010/06/disk-io-benchmarking-in-cloud.html">http://blog.cloudharmony.com/2010/06/disk-io-benchmarking-in-cloud.html</a>
&gt;&gt; [4] 
&gt;&gt; <a  rel="nofollow" href="http://blog.bioteam.net/2010/07/boot-ephemeral-ebs-storage-performance-on-amazon-cc1-4xlarge-instance-types/">http://blog.bioteam.net/2010/07/boot-ephemeral-ebs-storage-performance-on-amazon-cc1-4xlarge-instance-types/</a>
&gt;&gt; [5] 
&gt;&gt; <a  rel="nofollow" href="http://blog.bioteam.net/2010/07/local-storage-performance-of-aws-cluster-compute-instances/">http://blog.bioteam.net/2010/07/local-storage-performance-of-aws-cluster-compute-instances/</a>
&gt;&gt; [6] 
&gt;&gt; <a  rel="nofollow" href="http://blog.bioteam.net/2010/07/preliminary-ebs-performance-tests-on-amazon-compute-cluster-cc1-4xlarge-instance-types/">http://blog.bioteam.net/2010/07/preliminary-ebs-performance-tests-on-amazon-compute-cluster-cc1-4xlarge-instance-types/</a>
&gt;&gt; [7] <a  rel="nofollow" href="http://victortrac.com/EC2_Ephemeral_Disks_vs_EBS_Volumes">http://victortrac.com/EC2_Ephemeral_Disks_vs_EBS_Volumes</a>
&gt;&gt; 
&gt;&gt; On Mittwoch, 30. März 2011 at 18:29, David Dawson wrote: 
&gt;&gt;&gt; I am not sure if this has already been discussed, but I am looking at the 
&gt;&gt;&gt; feasibility of running RIAK in a EC2 cloud, as we have a requirement that 
&gt;&gt;&gt; may require us to scale up and down quite considerably on a month by month 
&gt;&gt;&gt; basis. After some initial testing and investigation we have come to the 
&gt;&gt;&gt; conclusion that there are 2 solutions although both have their downsides in 
&gt;&gt;&gt; my opinion:
&gt;&gt;&gt; 
&gt;&gt;&gt; 1. Run multiple cluster compute( cc1.4xlarge ) instances ( 23 GB RAM, 10 
&gt;&gt;&gt; Gigabit ethernet, 2 x 845 GB disks running RAID 0 )
&gt;&gt;&gt; 2. Same as above but using EBS as the storage instead of the local disks.
&gt;&gt;&gt; 
&gt;&gt;&gt; The problems I see are as follows with solution 1: 
&gt;&gt;&gt; 
&gt;&gt;&gt; - A instance failure results in complete loss of data on that machine, as 
&gt;&gt;&gt; the disks are ephemeral storage ( e.g. they only exist whilst the machine 
&gt;&gt;&gt; is up ).
&gt;&gt;&gt; 
&gt;&gt;&gt; The problems I see are as follows with solution 2:
&gt;&gt;&gt; 
&gt;&gt;&gt; - EBS is slower than the local disks and from what I have read is 
&gt;&gt;&gt; susceptible to latency depending on factors out of your control.
&gt;&gt;&gt; - There has been a bit of press lately about availability problems with 
&gt;&gt;&gt; EBS, so we would have to use multiple availability zones although there are 
&gt;&gt;&gt; only 4 in total and it just seems as though I am over complicating things.
&gt;&gt;&gt; 
&gt;&gt;&gt; Has anyone used EC2 and RIAK in production and if so what are their 
&gt;&gt;&gt; experiences?
&gt;&gt;&gt; 
&gt;&gt;&gt; Otherwise has anyone used RackSpace or Joyent? as these are alternatives 
&gt;&gt;&gt; although the Joyent solution seems very expensive, and what are their 
&gt;&gt;&gt; experiences?
&gt;&gt;&gt; 
&gt;&gt;&gt; Dave
&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg02836.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#02838">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#02838">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg02841.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg02799.html">EC2 and RIAK</a></span> <span class="sender italic">David Dawson</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02800.html">Re: EC2 and RIAK</a></span> <span class="sender italic">siculars</span></li>
<li class="icons-email"><span class="subject"><a href="msg02827.html">Re: EC2 and RIAK</a></span> <span class="sender italic">Mathias Meyer</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02836.html">Re: EC2 and RIAK</a></span> <span class="sender italic">David Dawson</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: EC2 and RIAK</span> <span class="sender italic">Jason J. W. Williams</span></li>
<li class="icons-email"><span class="subject"><a href="msg02841.html">Re: EC2 and RIAK</a></span> <span class="sender italic">Mark Steele</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02842.html">Re: EC2 and RIAK</a></span> <span class="sender italic">Eric Moritz</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg02846.html">Re: EC2 and RIAK</a></span> <span class="sender italic">Jeff Pollard</span></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg02848.html">Re: EC2 and RIAK</a></span> <span class="sender italic">Jason J. W. Williams</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: EC2 and RIAK">
<input type="hidden" name="msgid" value="FFA27D95-0F41-45A4-B9E5-F9E5F4EAD852@gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg02838.html">
<input type="submit" value=" Jason J. W. Williams ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+EC2+and+RIAK%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg02836.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg02841.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">FFA27D95-0F41-45A4-B9E5-F9E5F4EAD852@gmail.com</li>
</ul>
</div>
</body>
</html>
