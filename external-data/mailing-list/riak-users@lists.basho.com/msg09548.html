<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Cluster setup</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09548" id="c">
<link rel="index" href="maillist.html#09548" id="i">
<link rel="prev" href="msg09547.html" id="p">
<link rel="next" href="msg09549.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09548.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Cluster+setup%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Cluster setup</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Shane+McEwan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Shane McEwan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121212" rel="nofollow">Wed, 12 Dec 2012 07:42:59 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<tt>There's no need to join the &quot;master&quot; to itself. Just join the other 
</tt><tt>nodes to the master.
</tt><pre style="margin: 0em;">

On 12/12/12 15:33, Kevin Burton wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
My &quot;master&quot; is node1 which in vm.args as the node name of riak@10.79.108.25.
So from the &quot;master&quot; (riak@10.79.108.25) I issue the command 'sudo
riak-admin cluster join riak@10.79.108.15' (essentially joining to itself) I
get:</pre><pre>

[azureuser@bsicentos1 ~]$ sudo riak-admin cluster join riak@10.79.108.25
[sudo] password for azureuser:
Attempting to restart script through sudo -H -u riak
Join failed. Try again in a few moments.

To make sure the &quot;master&quot; is indeed the name I thought

[azureuser@bsicentos1 ~]$ head /etc/riak/vm.args
## Name of the riak node
-name riak@10.79.108.25

It doesn't seem that you can join a node to itself.

-----Original Message-----
From: Shane McEwan [<a  rel="nofollow" href="mailto:sh...@mcewan.id.au">mailto:sh...@mcewan.id.au</a>]
Sent: Wednesday, December 12, 2012 9:26 AM
To: Kevin Burton
Cc: riak-users@lists.basho.com
Subject: Re: Cluster setup

The join command needs to be given a node name and IP of a machine already
in the cluster.

So if you have machines:

riak@10.79.110.52
riak@10.79.108.25
riak@10.79.90.11

Then pick one to be the &quot;master&quot; (e.g. riak@10.79.110.52) and on the other
two machines run:

sudo riak-admin cluster join riak@10.79.110.52

(Notice that you give the name and IP of the &quot;master&quot; node, not the name and
IP of the machine you're running the command on.)

Then back on the master run the &quot;plan&quot; and &quot;commit&quot; commands.

On 12/12/12 15:11, Kevin Burton wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I was just following the docs and they seem to set a different port or
each node but that was probably because the &quot;Quick Start&quot; was on one
</pre></blockquote><pre style="margin: 0em;">
machine.
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Thanks for the clarification.

Now I am running into a different problem. I joined one machine to the
cluster just fine. But joining the third node to the cluster results in:

[azureuser@bsicentos1 ~]$ sudo riak-admin cluster join
riak@10.79.90.11 Attempting to restart script through sudo -H -u riak
Failed: This node is already a member of a cluster

But looking at the plan I don't see that it is &quot;already a member&quot;. How
is it already a member?

[azureuser@bsicentos1 ~]$ sudo riak-admin cluster plan Attempting to
restart script through sudo -H -u riak ===============================
Staged Changes ================================
Action         Nodes(s)
----------------------------------------------------------------------
------
---
join           'riak@10.79.108.25'
----------------------------------------------------------------------
------
---


NOTE: Applying these changes will result in 1 cluster transition

######################################################################
######
###
                           After cluster transition 1/1
######################################################################
######
###

================================= Membership
==================================
Status     Ring    Pending    Node
----------------------------------------------------------------------
------
---
valid       0.0%     50.0%    'riak@10.79.108.25'
valid     100.0%     50.0%    'riak@10.79.110.52'
----------------------------------------------------------------------
------
---
Valid:2 / Leaving:0 / Exiting:0 / Joining:0 / Down:0

WARNING: Not all replicas will be on distinct nodes

Transfers resulting from cluster changes: 32
    32 transfers from 'riak@10.79.110.52' to 'riak@10.79.108.25'

-----Original Message-----
From: Shane McEwan [<a  rel="nofollow" href="mailto:sh...@mcewan.id.au">mailto:sh...@mcewan.id.au</a>]
Sent: Wednesday, December 12, 2012 8:58 AM
To: Kevin Burton
Cc: riak-users@lists.basho.com
Subject: Re: Cluster setup

On 12/12/12 14:32, Kevin Burton wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Good catch! Thank you.  If I have three machines that take up ports
8098,8099, and 8100 what do you suggest the handoff port should be?
When is it used?
</pre></blockquote><pre style="margin: 0em;">

No problem!

Each machine can use the same ports as the other machines. You just
can't use the same ports on the same machine. Setting different port
numbers on different machines just complicates things for no reason.
In theory, your app.config file can (should?) be identical for all
your Riak nodes in a cluster.

So, for instance, if you decided to use ports 8098 for pb_port, 8099
for http and 8100 for handoff_port then you could set those ports the
same on all three of your machines.

The handoff_port is used for each node of the cluster to talk to each
</pre></blockquote><pre style="margin: 0em;">
other.
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

Hope this helps!

Shane.

</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09547.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09548">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09548">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09549.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09526.html">Re: Cluster setup</a></span> <span class="sender italic">Russell Brown</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09527.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09535.html">Re: Cluster setup</a></span> <span class="sender italic">Shane McEwan</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09536.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09538.html">Re: Cluster setup</a></span> <span class="sender italic">Shane McEwan</span></li>
<li class="icons-email"><span class="subject"><a href="msg09539.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09543.html">Re: Cluster setup</a></span> <span class="sender italic">Shane McEwan</span></li>
<li class="icons-email"><span class="subject"><a href="msg09545.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09546.html">Re: Cluster setup</a></span> <span class="sender italic">Shane McEwan</span></li>
<li class="icons-email"><span class="subject"><a href="msg09547.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email tSliceCur"><span class="subject">Re: Cluster setup</span> <span class="sender italic">Shane McEwan</span></li>
<li class="icons-email"><span class="subject"><a href="msg09549.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09550.html">Re: Cluster setup</a></span> <span class="sender italic">Shane McEwan</span></li>
<li class="icons-email"><span class="subject"><a href="msg09551.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09552.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09553.html">Re: Cluster setup</a></span> <span class="sender italic">Shane McEwan</span></li>
<li class="icons-email"><span class="subject"><a href="msg09554.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09555.html">Re: Cluster setup</a></span> <span class="sender italic">Antonio Rohman Fernandez</span></li>
<li class="icons-email"><span class="subject"><a href="msg09556.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
<li class="icons-email"><span class="subject"><a href="msg09557.html">Re: Cluster setup</a></span> <span class="sender italic">Antonio Rohman Fernandez</span></li>
<li class="icons-email"><span class="subject"><a href="msg09558.html">RE: Cluster setup</a></span> <span class="sender italic">Kevin Burton</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Cluster setup">
<input type="hidden" name="msgid" value="50C8A5FE.7050403@mcewan.id.au">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09548.html">
<input type="submit" value=" Shane McEwan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Cluster+setup%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09547.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09549.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">50C8A5FE.7050403@mcewan.id.au</li>
</ul>
</div>
</body>
</html>
