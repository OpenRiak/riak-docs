<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: 2i Index Durability/Resilience</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd9.html#12536" id="c">
<link rel="index" href="mail9.html#12536" id="i">
<link rel="prev" href="msg12535.html" id="p">
<link rel="next" href="msg12542.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg12536.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+2i+Index+Durability%5C%2FResilience%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: 2i Index Durability/Resilience</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Jon+Meredith%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jon Meredith</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131007" rel="nofollow">Mon, 07 Oct 2013 14:49:07 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi Brady,

The 2I indices are written in the same store as the main objects whenever
the main object is updated.  If a primary node is down, the indices will be
written to a fallback node.  When the fallback sees the primary come back
online and stops receiving requests for that partition it will send the
main object back to the primary and that will re-index it.</pre><pre>

The docs could benefit with a little clarification.  Secondary indices do
benefit from read repair, that is if the main object is spotted as being
out of date or missing during a get, it is rewritten with the up to date
information on all nodes.  The anti-entropy mechanism that we are currently
missing is spotting corruption within leveldb itself.  For example if part
of a the leveldb database storing a vnode is corrupted so that the .sst
files containing the index entries were destroyed there is no mechanism to
spot and repair that.  We are intending to add that for the next major
release.

Jon


On Mon, Oct 7, 2013 at 2:39 PM, Brady Wetherington &lt;br...@bespincorp.com&gt;wrote:

&gt; What happens to your 2i indexes if you do a write and one of the nodes
&gt; you're trying to write to is down?
&gt;
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/using/2i/">http://docs.basho.com/riak/latest/dev/using/2i/</a> says:
&gt;
&gt;
&gt;    - When you want or need anti-entropy. Since 2i is just metadata on the
&gt;    KV object and the indexes reside on the same node, 2i piggybacks off of
&gt;    read-repair.
&gt;
&gt; But
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/running/recovery/repairing-indexes/says:">http://docs.basho.com/riak/latest/ops/running/recovery/repairing-indexes/says:</a>
&gt;
&gt; Riak Secondary indexes (2i) currently have no form of anti-entropy (such
&gt; as read-repair). Furthermore, for performance and load balancing reasons,
&gt; 2i reads from 1 random node. This means that when a replica loss has
&gt; occurred, inconsistent results may be returned.
&gt; I am building a solution around 2i - so I just wanted to know if there was
&gt; any way to clarify these points - how resilient are these indexes? Under
&gt; what circumstances will they stop working (or return inconsistent results)?
&gt;
&gt; -B.
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;


-- 
Jon Meredith
VP, Engineering
Basho Technologies, Inc.
jmered...@basho.com
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg12535.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd9.html#12536">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail9.html#12536">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg12542.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg12535.html">2i Index Durability/Resilience</a></span> <span class="sender italic">Brady Wetherington</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: 2i Index Durability/Resilience</span> <span class="sender italic">Jon Meredith</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg12542.html">Re: 2i Index Durability/Resilience</a></span> <span class="sender italic">Rune Skou Larsen</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: 2i Index Durability/Resilience">
<input type="hidden" name="msgid" value="CAGgQeSuOtaKM0djjWo3yQADbObKH38PxCuGjY4NJknOeP=MoHg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg12536.html">
<input type="submit" value=" Jon Meredith ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+2i+Index+Durability%5C%2FResilience%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg12535.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg12542.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAGgQeSuOtaKM0djjWo3yQADbObKH38PxCuGjY4NJknOeP=MoHg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
