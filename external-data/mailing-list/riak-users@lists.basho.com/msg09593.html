<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: "Bad message code" error from Java ProtoBuf client?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09593" id="c">
<link rel="index" href="maillist.html#09593" id="i">
<link rel="prev" href="msg09592.html" id="p">
<link rel="next" href="msg09590.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09593.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22Bad+message+code%5C%22+error+from+Java+ProtoBuf+client%5C%3F%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: "Bad message code" error from Java ProtoBuf client?</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Brian+Roach%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Brian Roach</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20121214" rel="nofollow">Fri, 14 Dec 2012 19:51:11 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Tim,

Right - I understood the call that was failing was a &quot;get&quot; (Sorry - I
sent a second email because when I answered originally I transposed
the messages).</pre><pre>

The underlying reason for it is that somewhere, you're doing a list
keys operation but not iterating through them all. This isn't your
fault; it's a bug. That shouldn't be a problem.

I was able to reproduce the issue and just pushed a branch / created a
pull request:

<a  rel="nofollow" href="https://github.com/basho/riak-java-client/pull/186">https://github.com/basho/riak-java-client/pull/186</a>

It is intermittent because of the specific set of conditions that have
to be met for it to occur. For the time being if you find where you're
not iterating through all the returned keys and do so, the error
should stop occurring.  I've been working through testing some
branches and merging things, I hope to release this new 1.0.7 version
of the client next week.

Thanks,
Brian Roach

On Fri, Dec 14, 2012 at 8:08 PM, Tim W &lt;timm...@mindspring.com&gt; wrote:
&gt; Brian!
&gt;
&gt; In this particular case, the failing call is requesting a single key.  And
&gt; it didn't just happen once -- rather, for quite a while, every single one of
&gt; these calls (login) would fail in this manner, repeatedly.   Then, the next
&gt; day... *poof*... working again.
&gt;
&gt; Rather odd...
&gt;
&gt; - Tim
&gt;
&gt;
&gt; On 12/14/12 3:43 PM, Brian Roach wrote:
&gt;&gt;
&gt;&gt; Sorry - dyslexia acting up:
&gt;&gt;
&gt;&gt; That should read that you received a &quot;list keys&quot; response when
&gt;&gt; expecting a &quot;get&quot; response.
&gt;&gt;
&gt;&gt; - Roach
&gt;&gt;
&gt;&gt; On Fri, Dec 14, 2012 at 3:40 PM, Brian Roach &lt;ro...@basho.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Tim -
&gt;&gt;&gt;
&gt;&gt;&gt; That error is generated when the original, underlying protocol buffers
&gt;&gt;&gt; Riak client gets the wrong protobuf message from the socket - as in,
&gt;&gt;&gt; not the one it's expecting.
&gt;&gt;&gt;
&gt;&gt;&gt; The codes are here:
&gt;&gt;&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/references/apis/protocol-buffers/">http://docs.basho.com/riak/latest/references/apis/protocol-buffers/</a>
&gt;&gt;&gt;
&gt;&gt;&gt; The code numbers you list basically say that you got a &quot;get&quot; response
&gt;&gt;&gt; message when expecting a &quot;list keys&quot; response method.
&gt;&gt;&gt;
&gt;&gt;&gt; I'm digging into this to see how that would happen (I have an idea)
&gt;&gt;&gt; but by any chance are you listing keys and then not iterating through
&gt;&gt;&gt; the entire set?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Brian Roach
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Dec 14, 2012 at 2:55 PM, Tim W &lt;timm...@mindspring.com&gt; wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I'm seeing the following message emitted from a query to Riak:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; com.basho.riak.client.RiakRetryFailedException: java.io.IOException: bad
&gt;&gt;&gt;&gt; message code. Expected: 10 actual: 18
&gt;&gt;&gt;&gt;          at
&gt;&gt;&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:79)
&gt;&gt;&gt;&gt;          at
&gt;&gt;&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
&gt;&gt;&gt;&gt;          at
&gt;&gt;&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
&gt;&gt;&gt;&gt;          at
&gt;&gt;&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I'm also seeing this a bit further down in the log:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Caused by: java.io.IOException: bad message code. Expected: 10 actual:
&gt;&gt;&gt;&gt; 18
&gt;&gt;&gt;&gt;   at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:126)
&gt;&gt;&gt;&gt;   at
&gt;&gt;&gt;&gt; com.basho.riak.pbc.RiakClient.processFetchReply(RiakClient.java:278)
&gt;&gt;&gt;&gt;   at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:252)
&gt;&gt;&gt;&gt;   at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:241)
&gt;&gt;&gt;&gt;   at
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; com.basho.riak.client.raw.pbc.PBClientAdapter.fetch(PBClientAdapter.java:156)
&gt;&gt;&gt;&gt;   at
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; com.basho.riak.client.operations.FetchObject$1.call(FetchObject.java:102)
&gt;&gt;&gt;&gt;          at
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; com.basho.riak.client.operations.FetchObject$1.call(FetchObject.java:100)
&gt;&gt;&gt;&gt;          at
&gt;&gt;&gt;&gt; com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:72)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This crops up periodically, during different operations, and disappears
&gt;&gt;&gt;&gt; just
&gt;&gt;&gt;&gt; as mysteriously.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Any hint as to what this really means?  (For example, is there somewhere
&gt;&gt;&gt;&gt; I
&gt;&gt;&gt;&gt; can look up these error codes?)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; For the record, I'm running Riak 1.1.4 with Java client 1.0.5.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks in advance!
&gt;&gt;&gt;&gt; - Tim
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; _______________________________________________
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
&gt;

_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09592.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09593">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09593">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09590.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg09586.html">&quot;Bad message code&quot; error from Java ProtoBuf client...</a></span> <span class="sender italic">Tim W</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09587.html">Re: &quot;Bad message code&quot; error from Java ProtoB...</a></span> <span class="sender italic">Gideon de Kok</span></li>
<li class="icons-email"><span class="subject"><a href="msg09588.html">Re: &quot;Bad message code&quot; error from Java ProtoB...</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09589.html">Re: &quot;Bad message code&quot; error from Java Pr...</a></span> <span class="sender italic">Brian Roach</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09592.html">Re: &quot;Bad message code&quot; error from Jav...</a></span> <span class="sender italic">Tim W</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: &quot;Bad message code&quot; error from...</span> <span class="sender italic">Brian Roach</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: &quot;Bad message code&quot; error from Java ProtoBuf client?">
<input type="hidden" name="msgid" value="CAM+FMBtCz4EKCJCRL5gCo-_325_rAbc575FFR1Z2MFHDeaoooA@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09593.html">
<input type="submit" value=" Brian Roach ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%22Bad+message+code%5C%22+error+from+Java+ProtoBuf+client%5C%3F%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09592.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09590.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAM+FMBtCz4EKCJCRL5gCo-_325_rAbc575FFR1Z2MFHDeaoooA@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
