<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: [erlang-questions] Riak Search Production Configuration</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#15658" id="c">
<link rel="index" href="maillist.html#15658" id="i">
<link rel="prev" href="msg15656.html" id="p">
<link rel="next" href="msg15660.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg15658.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%5Berlang%5C-questions%5C%5D+Riak+Search+Production+Configuration%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: [erlang-questions] Riak Search Production Configuration</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Shawn+Debnath%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Shawn Debnath</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20150206" rel="nofollow">Fri, 06 Feb 2015 09:05:06 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>I am assuming these are part of a map or some collection for each key. Riak 
flattens the namespace, so if you have a key KEY1 storing a map called Cyc with 
fields name, evironment, build; the flattened fields will look similar to 
Cyc.name,  Cyc.environment, Cyc.build. Your schema definition says fields will 
be strictly “name”, which is almost never the case. You may want to prefix the 
name with a ‘*’, something like:</pre><pre>

&lt;field name=“*name&quot; type=&quot;_yz_str&quot; indexed=&quot;true&quot; stored=&quot;true&quot; 
multiValued=&quot;true&quot; required=&quot;true&quot;/&gt;

This is only for simple non-CRDT types. Depending on how you are storing your 
data, you may need to build an extractor for it. For defined CRDT types, Riak 
adds their own internal suffixes (_set, _counter, _flag). For CRDTs, I would 
recommend using the default schema and grep’ing the data files to see what the 
field names look like (unless someone can recommend a better way) and once you 
have identified the names, build a custom schema for yourself. Otherwise, use 
the default schema again, and your custom field definitions above but add an 
asterisk as the prefix and suffix: &quot;*name*” to see what Riak thinks the full 
name for that field is.


Adding riak-users back on, hopefully someone can recommend something for AAE 
and or correct anything I have said above.


On 2/6/15, 7:41 AM, &quot;Nirav Shah&quot; 
&lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt; wrote:

Hi Shawn,
Here are the schema i am using. If you could share some bit of advice would be 
great... Also, are there any specific AAE settings that is recommended for Prod 
systems ?


Regards,
Nirav



________________________________
From: Shawn Debnath &lt;sh...@debnath.net&lt;<a  rel="nofollow" href="mailto:sh...@debnath.net">mailto:sh...@debnath.net</a>&gt;&gt;
To: Nirav Shah &lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt;; Luc Perkins 
&lt;lperk...@basho.com&lt;<a  rel="nofollow" href="mailto:lperk...@basho.com">mailto:lperk...@basho.com</a>&gt;&gt;
Cc: &quot;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&quot; 
&lt;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&gt;
Sent: Thursday, February 5, 2015 2:14 PM
Subject: Re: Riak Search Production Configuration

The only thing I can think of is that your flattened full name is not being 
matched.  Also looking at Basho’s default schema, it should be “_yz_str” and 
not “yz_str”, and that only works if you actually have it defined as:


  &lt;types&gt;
    &lt;!-- YZ String: Used for non-analyzed fields --&gt;
    &lt;fieldType name=&quot;_yz_str&quot; class=&quot;solr.StrField&quot; sortMissingLast=&quot;true&quot; /&gt;

in your schema file. The data types for solr are all class names as in solr.*.  
I would double check your mappings for name, type, and if they are being 
indexed and stored. If stored is false, you won’t get the data back but you can 
query on it.




On 2/5/15, 2:01 PM, &quot;Nirav Shah&quot; 
&lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt; wrote:

Hi Shawn,
I am using plain old types. Some of the fields we index ends with Id like 
execId, verId, orderId and are defined as long. There are some that has random 
strings which are defined as yz_str. Do you think this fields can cause issues ?

Surprisingly, i am seeing some data and some are not present in the Solr.  I 
can understand if no data is found for some field but the fact being i am 
seeing some data.

Also, Is there any suggestions around AAE configuration for production cluster?


-Nirav

________________________________
From: Shawn Debnath &lt;sh...@debnath.net&lt;<a  rel="nofollow" href="mailto:sh...@debnath.net">mailto:sh...@debnath.net</a>&gt;&gt;
To: Nirav Shah &lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt;; Luc Perkins 
&lt;lperk...@basho.com&lt;<a  rel="nofollow" href="mailto:lperk...@basho.com">mailto:lperk...@basho.com</a>&gt;&gt;
Cc: &quot;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&quot; 
&lt;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&gt;
Sent: Thursday, February 5, 2015 1:49 PM
Subject: Re: Riak Search Production Configuration

Nirav, are you using CRDTs or plain old types with Riak? The definition for 
field names makes a big difference in what gets archived and solr will not 
complain if it couldn’t find matching fields, it just won’t index them. You can 
take a peek at the data dir on the Riak instance to see what, if any, is being 
indexed.




On 2/5/15, 12:18 PM, &quot;Nirav Shah&quot; 
&lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt; wrote:

Hi Luc,
Thanks for the response.

Here are the steps i performed on my application start up. I am using the 
default bucket type in my application

1. Create Custom Schema

         String schema = Source.fromInputStream(inputStream, 
&quot;UTF-8&quot;).mkString(); (inputStream comes from a                 schema file that 
i read)

        YokozunaSchema yokozunaSchema = new YokozunaSchema(&quot;test&quot;, 
schema.toString());
        StoreSchema storeSchema = new 
StoreSchema.Builder(yokozunaSchema).build();
        riakClient.execute(storeSchema);


2.Post creation of Schema

    I created Index for my Object based on the required fields as mentioned in 
the Riak Search docs and other fields     as mapped to my object. I have only 
few fields set to be Indexed and Stored from my object as i only want to     
search on them

        YokozunaIndex yokozunaIndex = new YokozunaIndex(&quot;test_idx&quot;, &quot;test&quot;);
        StoreIndex storeIndex = new StoreIndex.Builder(yokozunaIndex).build();
        riakClient.execute(storeIndex);


3.Set Bucket Properties

    I than associate my bucket to the Index as part of the same application 
start up. Before i attach Index to my     bucket, i verify if it has already 
been attached using a Fetch
        StoreBucketProperties sbp =
                new StoreBucketProperties.Builder(namespace)
                        .withAllowMulti(false)
                        .withLastWriteWins(true)
                        .withSearchIndex(&quot;test_idx&quot;)
                        .build();
        riakClient.execute(sbp);



Regards,
Nirav


________________________________
From: Luc Perkins &lt;lperk...@basho.com&lt;<a  rel="nofollow" href="mailto:lperk...@basho.com">mailto:lperk...@basho.com</a>&gt;&gt;
To: Nirav Shah &lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt;
Cc: Shawn Debnath &lt;sh...@debnath.net&lt;<a  rel="nofollow" href="mailto:sh...@debnath.net">mailto:sh...@debnath.net</a>&gt;&gt;; 
&quot;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&quot; 
&lt;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&gt;
Sent: Thursday, February 5, 2015 11:04 AM
Subject: Re: Riak Search Production Configuration

Nirav,

Could you possibly detail the steps you used to upload the schema, adjust the 
bucket properties, etc.? That would help us identify the issue.

Luc

On Thu, Feb 5, 2015 at 9:42 AM, Nirav Shah 
&lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt; wrote:


Hi Shawn,
Thanks for the response. To give you some background

1. We are using custom schema with default bucket type
2. I have the search set to on:)
3. I have associated BucketProperties/Index to my buckets..
4. What i am seeing is, i am getting data back, but for some reason i am not 
getting the entire set. When i query RIAK i see the data, however when i query 
the solr indexes, its missing that data. At this point, i don't know what can 
cause this  and am looking for people who might have faced similar issues.

My default config is just changing search=on in riak.conf, changed the JVM 
settings in riak.conf for Solr.


Would appreciate any pointers and best practice around settings for Riak Search 
and AAE in production cluster that i should add that folks have running in 
production cluster.



Regards,
Nirav


________________________________
From: Shawn Debnath &lt;sh...@debnath.net&lt;<a  rel="nofollow" href="mailto:sh...@debnath.net">mailto:sh...@debnath.net</a>&gt;&gt;
To: Nirav Shah &lt;niravis...@yahoo.com&lt;<a  rel="nofollow" href="mailto:niravis...@yahoo.com">mailto:niravis...@yahoo.com</a>&gt;&gt;; 
&quot;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&quot; 
&lt;riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;&gt;
Sent: Thursday, February 5, 2015 9:13 AM

Subject: Re: Riak Search Production Configuration

Hi Nirav,

About your last point. Just yesterday I started playing with Search 2.0 (solr) 
and riak. Basho did a good job at integrating the solr platform but docs are 
sometimes misleading. One thing I found out was the using the default schema 
provided by Basho, if you are using CRDTs, your fields are suffixed with 
_register, _counter, _set. This link 
(<a  rel="nofollow" href="http://docs.basho.com/riak/latest/dev/search/search-data-types/">http://docs.basho.com/riak/latest/dev/search/search-data-types/</a>) has a good 
set of examples but best is to experiment. I ended up diving into the data dir 
of solar and grep’ed for parts of my field names to figure out what it actually 
was. When running queries, solr/riak will not let you know that fields are 
incorrect, it just doesn’t have any data for those so it returns no search 
results.

Good luck.

Shawn

PS. Be sure to have search=on in riak.conf :)



On 2/5/15, 7:34 AM, &quot;Nirav Shah&quot; &lt;niravis...@yahoo.com&gt; wrote:

Hi All,
Just wanted to check what kind of configuration settings does everyone use in 
production clustered environment for Riak Search/AAE and if someone can share 
some experience over it? We currently have a 2g memory allocated to Solr and 
are currently just using the default parameters from riak.conf.

What we have seen so far is that there is data in RIAK but somehow, Solr/Riak 
search does not return it. I am trying to find out what can cause this and am i 
missing some kind of configuration settings.



Any response would be appreciated.


Regards,
Nirav



_______________________________________________
riak-users mailing list
riak-users@lists.basho.com&lt;<a  rel="nofollow" href="mailto:riak-users@lists.basho.com">mailto:riak-users@lists.basho.com</a>&gt;
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>








</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg15656.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#15658">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#15658">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg15660.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: [erlang-questions] Riak Search Production Configuration">
<input type="hidden" name="msgid" value="CDCC937D-49DC-4BA2-8699-8ADF4E576528@debnath.net">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg15658.html">
<input type="submit" value=" Shawn Debnath ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+%5C%5Berlang%5C-questions%5C%5D+Riak+Search+Production+Configuration%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg15656.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg15660.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CDCC937D-49DC-4BA2-8699-8ADF4E576528@debnath.net</li>
</ul>
</div>
</body>
</html>
