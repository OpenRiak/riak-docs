<!DOCTYPE html>
<html lang="en">
<head>
<title>Issue with Riak partition allocation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#14876" id="c">
<link rel="index" href="maillist.html#14876" id="i">
<link rel="prev" href="msg14866.html" id="p">
<link rel="next" href="msg14879.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg14876.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Issue+with+Riak+partition+allocation%22&amp;o=newest" rel="nofollow"><span itemprop="name">Issue with Riak partition allocation</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Peter+Bakkum%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Peter Bakkum</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140908" rel="nofollow">Mon, 08 Sep 2014 10:02:31 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hey all,

Looking for some guidance on a problem we're seeing in production right
now. We're not Riak experts so please bear with us.</pre><pre>

We had a member of our 6-node Riak cluster appear to fall out (riak-admin
member status on that node only showed itself). So I ran a riak-admin join
and riak-admin commit to get the node back in the cluster. Node discovery
appears to work now, but for some reason that node is now using a huge
amount of disk space. It appears that the partition balancing process is
creating this condition, and still hasn't completed after ~16 hours. The
cluster is still functional and serving our production traffic, and taking
the entire cluster offline isn't an option for us.

Most of our nodes use about 450GB of space, this node in particular is
using around 1.2TB, which is pushing the limit of its disk.

Questions:
Whats happening here? Is this expected?

Whats the best course of action? Should we clear out this node and attempt
to join the cluster again?

Here are some stats from the node in question. Let me know if anything else
would be helpful.

Thanks for your help.


[root@192.168.72.19 /data/lib/riak] # riak-admin member-status
================================= Membership
==================================
Status     Ring    Pending    Node
-------------------------------------------------------------------------------
valid      20.3%     16.4%    'xxxx_prod_cluster@192.168.72.135'
valid      18.0%     17.2%    'xxxx_prod_cluster@192.168.72.170'
valid      20.3%     17.2%    'xxxx_prod_cluster@192.168.72.176'
valid       7.0%     16.4%    'xxxx_prod_cluster@192.168.72.19'
valid      17.2%     16.4%    'xxxx_prod_cluster@192.168.72.7'
valid      17.2%     16.4%    'xxxx_prod_cluster@192.168.72.74'


[root@192.168.72.19 /data/lib/riak] # riak-admin status
1-minute stats for 'xxxx_prod_cluster@192.168.72.19'
-------------------------------------------
riak_kv_stat_ts : 1410194287
vnode_gets : 1607
vnode_gets_total : 563683
vnode_puts : 39
vnode_puts_total : 5459724
vnode_index_refreshes : 0
vnode_index_refreshes_total : 0
vnode_index_reads : 0
vnode_index_reads_total : 0
vnode_index_writes : 39
vnode_index_writes_total : 5459724
vnode_index_writes_postings : 0
vnode_index_writes_postings_total : 5227558
vnode_index_deletes : 0
vnode_index_deletes_total : 0
vnode_index_deletes_postings : 39
vnode_index_deletes_postings_total : 30613
node_gets : 3602
node_gets_total : 2463956
node_get_fsm_siblings_mean : 1
node_get_fsm_siblings_median : 1
node_get_fsm_siblings_95 : 2
node_get_fsm_siblings_99 : 3
node_get_fsm_siblings_100 : 12
node_get_fsm_objsize_mean : 52047
node_get_fsm_objsize_median : 26936
node_get_fsm_objsize_95 : 167435
node_get_fsm_objsize_99 : 267979
node_get_fsm_objsize_100 : 1313716
node_get_fsm_time_mean : 12223
node_get_fsm_time_median : 6675
node_get_fsm_time_95 : 37390
node_get_fsm_time_99 : 87046
node_get_fsm_time_100 : 345380
node_puts : 39
node_puts_total : 24915
node_put_fsm_time_mean : 4419
node_put_fsm_time_median : 2444
node_put_fsm_time_95 : 12890
node_put_fsm_time_99 : 18775
node_put_fsm_time_100 : 18775
read_repairs : 0
read_repairs_total : 0
coord_redirs_total : 17022
executing_mappers : 0
precommit_fail : 0
postcommit_fail : 0
index_fsm_create : 0
index_fsm_create_error : 0
index_fsm_active : 0
list_fsm_create : 0
list_fsm_create_error : 0
list_fsm_active : 0
pbc_active : 0
pbc_connects : 1
pbc_connects_total : 508
node_get_fsm_active : 1
node_get_fsm_active_60s : 3530
node_get_fsm_in_rate : 55
node_get_fsm_out_rate : 56
node_get_fsm_rejected : 0
node_get_fsm_rejected_60s : 0
node_get_fsm_rejected_total : 0
node_put_fsm_active : 0
node_put_fsm_active_60s : 67
node_put_fsm_in_rate : 1
node_put_fsm_out_rate : 1
node_put_fsm_rejected : 0
node_put_fsm_rejected_60s : 0
node_put_fsm_rejected_total : 0
leveldb_read_block_error : 0
riak_pipe_stat_ts : 1410194286
pipeline_active : 0
pipeline_create_count : 0
pipeline_create_one : 0
pipeline_create_error_count : 0
pipeline_create_error_one : 0
cpu_nprocs : 426
cpu_avg1 : 1352
cpu_avg5 : 1260
cpu_avg15 : 1137
mem_total : 15666507776
mem_allocated : 15479640064
disk : [{&quot;/&quot;,8256952,60},
        {&quot;/dev/shm&quot;,7649660,0},
        {&quot;/tmpfs&quot;,1048576,14},
        {&quot;/tmpfs_mp3&quot;,1048576,0},
        {&quot;/data&quot;,1514123712,81}]
nodename : 'xxxx_prod_cluster@192.168.72.19'
connected_nodes : ['xxxx_prod_cluster@192.168.72.170',
                   'xxxx_prod_cluster@192.168.72.176',
                   'xxxx_prod_cluster@192.168.72.74',
                   'xxxx_prod_cluster@192.168.72.135',
                   'xxxx_prod_cluster@192.168.72.7']
sys_driver_version : &lt;&lt;&quot;2.0&quot;&gt;&gt;
sys_global_heaps_size : 0
sys_heap_type : private
sys_logical_processors : 4
sys_otp_release : &lt;&lt;&quot;R15B01&quot;&gt;&gt;
sys_process_count : 2469
sys_smp_support : true
sys_system_version : &lt;&lt;&quot;Erlang R15B01 (erts-5.9.1) [source] [64-bit]
[smp:4:4] [async-threads:64] [kernel-poll:true]&quot;&gt;&gt;
sys_system_architecture : &lt;&lt;&quot;x86_64-unknown-linux-gnu&quot;&gt;&gt;
sys_threads_enabled : true
sys_thread_pool_size : 64
sys_wordsize : 8
ring_members : ['xxxx_prod_cluster@192.168.72.135',
                'xxxx_prod_cluster@192.168.72.170',
                'xxxx_prod_cluster@192.168.72.176',
                'xxxx_prod_cluster@192.168.72.19',
                'xxxx_prod_cluster@192.168.72.7',
                'xxxx_prod_cluster@192.168.72.74']
ring_num_partitions : 128
ring_ownership : &lt;&lt;&quot;[{'xxxx_prod_cluster@192.168.72.170',23},\n {'
xxxx_prod_cluster@192.168.72.74',22},\n
{'xxxx_prod_cluster@192.168.72.135',26},\n
{'xxxx_prod_cluster@192.168.72.176',26},\n
{'xxxx_prod_cluster@192.168.72.7',22},\n
{'xxxx_prod_cluster@192.168.72.19',9}]&quot;&gt;&gt;
ring_creation_size : 128
storage_backend : riak_kv_eleveldb_backend
erlydtl_version : &lt;&lt;&quot;0.7.0&quot;&gt;&gt;
riak_control_version : &lt;&lt;&quot;1.4.10-0-g73c43c3&quot;&gt;&gt;
cluster_info_version : &lt;&lt;&quot;1.2.4&quot;&gt;&gt;
riak_search_version : &lt;&lt;&quot;1.4.10-0-g6e548e7&quot;&gt;&gt;
merge_index_version : &lt;&lt;&quot;1.3.2-0-gcb38ee7&quot;&gt;&gt;
riak_kv_version : &lt;&lt;&quot;1.4.10-0-g64b6ad8&quot;&gt;&gt;
sidejob_version : &lt;&lt;&quot;0.2.0&quot;&gt;&gt;
riak_api_version : &lt;&lt;&quot;1.4.10-0-gc407ac0&quot;&gt;&gt;
riak_pipe_version : &lt;&lt;&quot;1.4.10-0-g9353526&quot;&gt;&gt;
riak_core_version : &lt;&lt;&quot;1.4.10&quot;&gt;&gt;
bitcask_version : &lt;&lt;&quot;1.6.6-0-g230b6d6&quot;&gt;&gt;
basho_stats_version : &lt;&lt;&quot;1.0.3&quot;&gt;&gt;
webmachine_version : &lt;&lt;&quot;1.10.4-0-gfcff795&quot;&gt;&gt;
mochiweb_version : &lt;&lt;&quot;1.5.1p6&quot;&gt;&gt;
inets_version : &lt;&lt;&quot;5.9&quot;&gt;&gt;
erlang_js_version : &lt;&lt;&quot;1.2.2&quot;&gt;&gt;
runtime_tools_version : &lt;&lt;&quot;1.8.8&quot;&gt;&gt;
os_mon_version : &lt;&lt;&quot;2.2.9&quot;&gt;&gt;
riak_sysmon_version : &lt;&lt;&quot;1.1.3&quot;&gt;&gt;
ssl_version : &lt;&lt;&quot;5.0.1&quot;&gt;&gt;
public_key_version : &lt;&lt;&quot;0.15&quot;&gt;&gt;
crypto_version : &lt;&lt;&quot;2.1&quot;&gt;&gt;
sasl_version : &lt;&lt;&quot;2.2.1&quot;&gt;&gt;
lager_version : &lt;&lt;&quot;2.0.1&quot;&gt;&gt;
goldrush_version : &lt;&lt;&quot;0.1.5&quot;&gt;&gt;
compiler_version : &lt;&lt;&quot;4.8.1&quot;&gt;&gt;
syntax_tools_version : &lt;&lt;&quot;1.6.8&quot;&gt;&gt;
stdlib_version : &lt;&lt;&quot;1.18.1&quot;&gt;&gt;
kernel_version : &lt;&lt;&quot;2.15.1&quot;&gt;&gt;
memory_total : 130705264
memory_processes : 55557705
memory_processes_used : 55341757
memory_system : 75147559
memory_atom : 545377
memory_atom_used : 527226
memory_binary : 12172712
memory_code : 11674242
memory_ets : 11913912
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg14866.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#14876">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#14876">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg14879.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Issue with Riak partition allocation</span> <span class="sender italic">Peter Bakkum</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14879.html">Re: Issue with Riak partition allocation</a></span> <span class="sender italic">Luke Bakken</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg14880.html">Re: Issue with Riak partition allocation</a></span> <span class="sender italic">Peter Bakkum</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Issue with Riak partition allocation">
<input type="hidden" name="msgid" value="CACuG4FGqifta4KduNveX8X2pO1JZ3w2Bjuc4dzE-qZOVAugPQw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg14876.html">
<input type="submit" value=" Peter Bakkum ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Issue+with+Riak+partition+allocation%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg14866.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg14879.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACuG4FGqifta4KduNveX8X2pO1JZ3w2Bjuc4dzE-qZOVAugPQw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
