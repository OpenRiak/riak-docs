<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: restarted node tells me about to handoff partitions (changing	format to v1)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="thrd5.html#13255" id="c">
<link rel="index" href="mail5.html#13255" id="i">
<link rel="prev" href="msg13252.html" id="p">
<link rel="next" href="msg13254.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13255.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+restarted+node+tells+me+about+to+handoff+partitions+%5C%28changing%09format+to+v1%5C%29%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: restarted node tells me about to handoff partitions (changing	format to v1)</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Shane+McEwan%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Shane McEwan</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20131216" rel="nofollow">Mon, 16 Dec 2013 06:09:40 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 16/12/13 09:56, Simon Effenberg wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
after an upgrade from 1.3.1 to 1.4.2 I changed the object format from
v0 to v1 and began a rolling restart. But restarting the first node
shows me some weird outputs:</pre><pre>

'riak@10.46.109.201' waiting to handoff 132 partitions

this is the &quot;restarted&quot; node and the partitions is switching between
121 and 132 .. after some time it decreases to something between 110
and 120.. and after some more time it is now decreasing slowly.

My question is: why/how can it be that the restarted node has stuff to
handover? Shouldn't it be the other way around (there were no handovers
in the &quot;riak-admin transfers&quot; before the restart).
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>I've seen this behaviour before, even in earlier versions. I assume that 
</tt><tt>when a Riak node starts up it needs to check each of its partitions 
</tt><tt>against the copies on the other nodes in order to determine if it needs 
</tt><tt>to send or receive updates. So the message should really say something 
</tt><tt>like: &quot;waiting to check 132 partions.&quot;
</tt><pre style="margin: 0em;">

The corresponding messages in the log are slightly clearer:

</pre><tt>hinted_handoff transfer of riak_kv_vnode from 'riak@10.2.1.1' 
</tt><tt>485264215520026359559817229612828346370133852160 to 'riak@10.2.1.2' 
</tt><tt>485264215520026359559817229612828346370133852160 completed: sent 0 
</tt><tt>objects in 0.04 seconds
</tt><pre style="margin: 0em;">

</pre><tt>The fact that it sent 0 objects tells me that it didn't actually need to 
</tt><tt>repair anything.
</tt><pre style="margin: 0em;">

Shane.


_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13252.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="thrd5.html#13255">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="mail5.html#13255">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13254.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13252.html">restarted node tells me about to handoff partitions (chang...</a></span> <span class="sender italic">Simon Effenberg</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: restarted node tells me about to handoff partitio...</span> <span class="sender italic">Shane McEwan</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: restarted node tells me about to handoff partitions (changing	format to v1)">
<input type="hidden" name="msgid" value="52AF08A8.7060702@mcewan.id.au">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13255.html">
<input type="submit" value=" Shane McEwan ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+restarted+node+tells+me+about+to+handoff+partitions+%5C%28changing%09format+to+v1%5C%29%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13252.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13254.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">52AF08A8.7060702@mcewan.id.au</li>
</ul>
</div>
</body>
</html>
