<!DOCTYPE html>
<html lang="en">
<head>
<title>Riak Merge On Restarts Only</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#09844" id="c">
<link rel="index" href="maillist.html#09844" id="i">
<link rel="prev" href="msg09843.html" id="p">
<link rel="next" href="msg09849.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg09844.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+Merge+On+Restarts+Only%22&amp;o=newest" rel="nofollow"><span itemprop="name">Riak Merge On Restarts Only</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ian+Ha%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ian Ha</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20130118" rel="nofollow">Fri, 18 Jan 2013 14:15:16 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi,

In our production system, we notice that merges are not taking place. We
have noticed, however, that when we restart riak (via a 'riak stop' then a
'riak start'), then the merges are triggered and our disk usage goes way
day (which is what we want). We use bitcask.</pre><pre>

Why does this happen on a restart only and not at other times, even though
we have set our merge_window config setting to 'always'?

I'm assuming our config values are correct as the restart considers the
thresholds met to go ahead with a merge.

Also: Are there any tools out there that I can run on my data directory
that will tell me the size of the dead byte ratios? Would be nice to see
what the dead byte 'state' of my data dir is in so I can tell whether
indeed merge conditions are met.

Our bit cask configs are as follows in app.config:

{bitcask, [
                {data_root, &quot;/var/lib/riak/bitcask&quot;},
                {dead_bytes_merge_trigger, 268435456},
                {dead_bytes_threshold, 134217728},
                {expiry_secs, 3888000},
                {frag_merge_trigger, 40},
                {frag_threshold, 20},
                {merge_window, always},
                {small_file_threshold, 10485760},
                {sync_strategy, none}
        ]},


Thanks!
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg09843.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#09844">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#09844">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg09849.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email tSliceCur"><span class="subject">Riak Merge On Restarts Only</span> <span class="sender italic">Ian Ha</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09849.html">Re: Riak Merge On Restarts Only</a></span> <span class="sender italic">Brian Sparrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09870.html">Re: Riak Merge On Restarts Only</a></span> <span class="sender italic">Ian Ha</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09871.html">Re: Riak Merge On Restarts Only</a></span> <span class="sender italic">Brian Sparrow</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg09872.html">Re: Riak Merge On Restarts Only</a></span> <span class="sender italic">Hector Castro</span></li>
</ul>
</ul>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Riak Merge On Restarts Only">
<input type="hidden" name="msgid" value="CAJmS2zEYcLC0oKoPmz0h1HpNWyV-=33RnHotrVz38dP1qLDnzw@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg09844.html">
<input type="submit" value=" Ian Ha ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Riak+Merge+On+Restarts+Only%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg09843.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg09849.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CAJmS2zEYcLC0oKoPmz0h1HpNWyV-=33RnHotrVz38dP1qLDnzw@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
