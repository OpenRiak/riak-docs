<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: LevelDB parameter planning - max_open_files</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#13997" id="c">
<link rel="index" href="maillist.html#13997" id="i">
<link rel="prev" href="msg13995.html" id="p">
<link rel="next" href="msg13998.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg13997.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+LevelDB+parameter+planning+%5C-+max_open_files%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: LevelDB parameter planning - max_open_files</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Matthew+Von%5C-Maszewski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthew Von-Maszewski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20140404" rel="nofollow">Fri, 04 Apr 2014 08:15:55 -0700</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Oleksiy,

Go to step 6:  &quot;Compare Step 2 and Step 5 â€¦&quot;.   There is a link to an Excel 
spreadsheet at the end of the sentence &quot;The above calculations are automated in 
this memory model spreadsheet.&quot;.   Forget the text and use the spreadsheet 
(memory model spreadsheet).</pre><pre>

Much of that text is still related to memory management of 1.2 and 1.3.  Seems 
it did not get updated to 1.4.  Hmm, that might be my fault.

Answers to your comments/questions below:

1.  Step 3 on the page is just wrong with 1.4:  open_file_memory = 
(max_open_files -10) * 4194304

2.  average_sst_filesize is not relevant with 1.4.  It was used to estimate the 
size of the bloom filter attached to each .sst file.  There is now a fixed 
maximum of 150,001 bytes for the bloom filter, and it is the typical size for 
all files in levels 2 through 6.

3.  The page is attempting to estimate the total memory usage of one vnode.  
The spreadsheet does the same.  Therefore the maximum memory per either model 
is the &quot;working memory per vnode&quot; in Step 5, or the &quot;working per vnode&quot; line in 
the spreadsheet, multiplied by the number of vnodes active on the node (server).


Now let me make a related note / sales pitch.  The upcoming Riak 2.0 eliminates 
all the manual calculations / planning.  You tell Riak what percentage of 
memory is allocated to leveldb.  leveldb then dynamically adjusts each vnode's 
allocation as your dataset changes and/or vnodes are moved to and from the node 
(server).  

Matthew


On Apr 4, 2014, at 5:08 AM, Oleksiy Krivoshey &lt;oleks...@gmail.com&gt; wrote:

&gt; Can someone please suggest how to understand the formula for open_file_memory 
&gt; on this page: 
&gt; <a  rel="nofollow" href="http://docs.basho.com/riak/latest/ops/advanced/backends/leveldb/#Parameter-Planning">http://docs.basho.com/riak/latest/ops/advanced/backends/leveldb/#Parameter-Planning</a>
&gt; 
&gt; 1. It definitely lacks some brackets, the correct formula is:
&gt; 
&gt; OPEN_FILE_MEMORY =  (max_open_files-10) * (184 + (average_sst_filesize/2048) 
&gt; * (8+((key_size+value_size)/2048 +1)*0.6))
&gt; 
&gt; 
&gt; 2. How to estimate average_sst_filesize?
&gt; 
&gt; 
&gt; 3. does the result estimate the memory used by a single open file in any 
&gt; particular vnode? Or by a single vnode with max_open_files open? As 
&gt; max_open_files is a per vnode parameter then how to estimate the maximum 
&gt; memory used by leveldb if all vnodes have all max_open_files open? is it 
&gt; result*ring_size or result*ring_size*max_open_files?
&gt; 
&gt; 
&gt; Thanks!
&gt; 
&gt; -- 
&gt; Oleksiy
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>

</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg13995.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#13997">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#13997">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg13998.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg13995.html">LevelDB parameter planning - max_open_files</a></span> <span class="sender italic">Oleksiy Krivoshey</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: LevelDB parameter planning - max_open_files</span> <span class="sender italic">Matthew Von-Maszewski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg13998.html">Re: LevelDB parameter planning - max_open_f...</a></span> <span class="sender italic">Matthew Von-Maszewski</span></li>
</ul>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: LevelDB parameter planning - max_open_files">
<input type="hidden" name="msgid" value="63FC3CD4-53D9-41A9-8598-54DFC078C5EB@basho.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg13997.html">
<input type="submit" value=" Matthew Von-Maszewski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+LevelDB+parameter+planning+%5C-+max_open_files%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg13995.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg13998.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">63FC3CD4-53D9-41A9-8598-54DFC078C5EB@basho.com</li>
</ul>
</div>
</body>
</html>
