<!DOCTYPE html>
<html lang="en">
<head>
<title>Re: Delta updates using pre-commit hooks</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#06285" id="c">
<link rel="index" href="maillist.html#06285" id="i">
<link rel="prev" href="msg06127.html" id="p">
<link rel="next" href="msg06288.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg06285.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Delta+updates+using+pre%5C-commit+hooks%22&amp;o=newest" rel="nofollow"><span itemprop="name">Re: Delta updates using pre-commit hooks</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Ryan+Zezeski%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ryan Zezeski</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20120114" rel="nofollow">Sat, 14 Jan 2012 10:03:55 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Marek,

You're definitely butting up against the limits of Riak's data model here.
 It sounds like you are looking for something like Redis?  E.g. add element
E to set S.  You could probably use statebox [1] and pull some tricks in
the precommit hook to determine if the incoming client object is the
initial object or a delta but you would still need to perform a read in the
hook to get the box, apply the delta, and then return that object from the
hook.  As you said this happens on the coordinator and there is no easy way
to guarantee this op applies local to the data off the top of my head.  At
least a precommit hook would prevent streaming the object to/from the
client.</pre><pre>

I think what you really want is native support for different data models on
top of Riak.  Internally, we've played around with a CRDT [2] interface on
top of Riak where instead of sending objects you send operations.  This is
analogous to how Redis works (although the underlying implementation is
very different given Riak's distributed nature).  The trick with a new data
model is making sure it scales and making sure we understand its
consistency model.

Riak's pedigree is the key-value model.  I'm sure you could hack something
together on top of Riak's KV model with precommit hooks but you will be
swimming upstream.  That said, we're always looking at new models that
would compliment our existing key-value model.

-Ryan

[1]: <a  rel="nofollow" href="https://github.com/mochi/statebox">https://github.com/mochi/statebox</a>

[2]: <a  rel="nofollow" href="http://hal.archives-ouvertes.fr/inria-00555588/">http://hal.archives-ouvertes.fr/inria-00555588/</a>

On Wed, Jan 4, 2012 at 10:11 AM, Marek Zawirski &lt;marek.zawir...@lip6.fr&gt;wrote:

&gt; Hi,
&gt;
&gt; we are trying use Riak as a storage layer for experimental
&gt; higher-level data types updated by clients, using a set of
&gt; well-defined operations. To this end, each data type instance is
&gt; stored under a single key. One problem with this approach is that
&gt; after client modifies even a small piece of the data structure, it
&gt; needs to write (and transfer) the whole data structure back to Riak.
&gt; We are looking for a way to reduce this overhead by sending just a
&gt; delta operation, preferably without partitioning the data structure to
&gt; several keys.
&gt;
&gt; One approach we thought about is to perform operations on Riak-side
&gt; using pre-commit hooks or similar technique. I.e. reconstruct the new
&gt; value on Riak using original old value + delta send by client. The
&gt; operations (deltas) we are talking about have necessary properties to
&gt; ensure convergence. Still, it seems there a couple technical issues
&gt; involved, we are looking how to solve them:
&gt; 1) pre-commit API seems to only offer access to the object value
&gt; passed by client during write and not the old value; I wonder - am I
&gt; able to read the value from the store in pre-commit hook? In
&gt; particular, the value previously read by the client writing,
&gt; identified by version vector?
&gt; 2) pre-commit hooks are executed on the coordinator node; is there an
&gt; easy way in Riak to apply operations at data nodes instead?
&gt;
&gt; Thanks for any info that can help addressing these issues.
&gt;
&gt; Regards,
&gt; Marek Zawirski
&gt;
&gt; _______________________________________________
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; <a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
&gt;
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg06127.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#06285">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#06285">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg06288.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">
<li class="icons-email"><span class="subject"><a href="msg06127.html">Delta updates using pre-commit hooks</a></span> <span class="sender italic">Marek Zawirski</span></li>
<li><ul>
<li class="icons-email tSliceCur"><span class="subject">Re: Delta updates using pre-commit hooks</span> <span class="sender italic">Ryan Zezeski</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06288.html">Re: Delta updates using pre-commit hooks</a></span> <span class="sender italic">Mark Steele</span></li>
<li><ul>
<li class="icons-email"><span class="subject"><a href="msg06302.html">Re: Delta updates using pre-commit hooks</a></span> <span class="sender italic">Marek Zawirski</span></li>
</ul></li>
</ul></li>
<li class="icons-email"><span class="subject"><a href="msg06327.html">Re: Delta updates using pre-commit hooks</a></span> <span class="sender italic">John DeTreville</span></li>
</ul>
</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Re: Delta updates using pre-commit hooks">
<input type="hidden" name="msgid" value="CACZcpe=AVpe69Z9HA6_rhmZWhWhs2G=k8ubAOO4FRVLaRtdVYg@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg06285.html">
<input type="submit" value=" Ryan Zezeski ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Re%5C%3A+Delta+updates+using+pre%5C-commit+hooks%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg06127.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg06288.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">CACZcpe=AVpe69Z9HA6_rhmZWhWhs2G=k8ubAOO4FRVLaRtdVYg@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
