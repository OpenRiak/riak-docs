---
title: "Re: map-reduce Problem ?"
description: ""
project: community
lastmod: 2010-11-15T09:55:30-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01545"
mailinglist_parent_id: "msg01542"
author_name: "Kevin Smith"
project_section: "mailinglistitem"
sent_date: 2010-11-15T09:55:30-08:00
---


We are giving some thought on how to do that. The main issues wrt to bitcask's 
key listing performance is that bitcask is not bucket aware and lacks the 
notion of secondary indices. Not being bucket aware means bitcask has to 
examine all bucket/key pairs to find the ones related to a given bucket. This 
isn't to say we won't address the problem but merely to point out there's some 
engineering work required to solve the problem correctly.

innostore is moderately bucket-aware right now so I've forked it 
(http://github.com/kevsmith/innostore) and added bucket-aware key listing. 
Based on some very basic testing I'm seeing 2.5x speed up in overall key 
listing performance compared to the official version. I'm hoping the patch, or 
a modified form of it, will make the next release. If you can handle inno being 
a bit slower than bitcask and slightly more difficult to set up and tune then 
this might be an option for you.

I've done some basic vetting of the code but I want to emphasize this is a 
prototype only and hasn't received anything even close to the normal amount of 
testing we put into a release. Please keep this in mind if you decide to use my 
forked repo.

--Kevin
On Nov 15, 2010, at 11:57 AM, Greg Steffensen wrote:

&gt; Along these lines, are there any ideas floating around about how to speed up 
&gt; the listing of keys in a bucket? For the bitcask backend, it seems like an 
&gt; index of keys-by-bucket ought to be the kind of thing that could be stored in 
&gt; the hints files to speed this up without affecting performance for live reads 
&gt; and writes.
&gt; 
&gt; Greg
&gt; 
&gt; On Mon, Nov 15, 2010 at 11:46 AM, Sean Cribbs  wrote:
&gt; This is possible with Riak's MapReduce but you will likely have increasing 
&gt; difficulty as your dataset grows, because of the impact of needing to list 
&gt; keys in a bucket and then eliminate data points you aren't interested in. In 
&gt; the longer term, there will be improvements to MapReduce such that if your 
&gt; keys are meaningful, you will be able to filter them more easily (without 
&gt; examining the data first). You might find Kevin Smith's overview 
&gt; enlightening: http://www.slideshare.net/hemulen/riak-mapred-preso
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On Nov 15, 2010, at 11:34 AM, Prometheus WillSurvive wrote:
&gt; 
&gt;&gt; Hi ,
&gt;&gt; 
&gt;&gt; We have a huge database (around 4 billion record - 30 TB) storing the video 
&gt;&gt; watch infromation ie view count , comment , favorited etc. I want to produce 
&gt;&gt; daily report for all videos view counts. It means I need to look 2 day , 
&gt;&gt; today and yesterday so subtract yesterdey view count from today view count 
&gt;&gt; so I can find the daliy impression. Our Fat DB team doing this a few complex 
&gt;&gt; queries. I would like to ask you is this possible with Riak map-reduce way . 
&gt;&gt; I want to make a demonstration to the team to show this ..
&gt;&gt; 
&gt;&gt; This is the scenario. We have similar data models for other thins. This 
&gt;&gt; could be a start. 
&gt;&gt; 
&gt;&gt; We have 30xHP DL380 x32 Gig Ram Farm to test this scenario. 
&gt;&gt; 
&gt;&gt; Any riak map-reduce experienced member can show some idea on this.. I guess.
&gt;&gt; 
&gt;&gt; Regards
&gt;&gt; 
&gt;&gt; Prometheus
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

