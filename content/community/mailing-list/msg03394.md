---
title: "Re: Issues with capacity planning pages on wiki"
description: ""
project: community
lastmod: 2011-05-23T23:06:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03394"
mailinglist_parent_id: "msg03393"
author_name: "Anthony Molinaro"
project_section: "mailinglistitem"
sent_date: 2011-05-23T23:06:49-07:00
---



On Mon, May 23, 2011 at 10:53:29PM -0700, Anthony Molinaro wrote:
&gt; 
&gt; On Mon, May 23, 2011 at 09:57:25PM -0600, David Smith wrote:
&gt; &gt; On Mon, May 23, 2011 at 9:39 PM, Anthony Molinaro
&gt; &gt; Thus, depending on
&gt; &gt; your merge triggers, more space can be used than is strictly necessary
&gt; &gt; to store the data.
&gt; 
&gt; So the lack of any overhead in the calculation is expected? I mean
&gt; according to http://wiki.basho.com/Cluster-Capacity-Planning.html
&gt; 
&gt; Disk = Estimated Total Objects \\* Average Object Size \\* n\\_val
&gt; 
&gt; Which just seems wrong, doesn't it? I don't quite understand the
&gt; bitcask code well enough yet to see what the actual data it stores is,
&gt; but the whitepaper suggested several things were involved in the on
&gt; disk representation.

Okay, finally found the code for this part, I kept looking in the nif
but that's only the keydir, not the data files. It looks like

 %% Setup io\\_list for writing -- avoid merging binaries if we can help it
 Bytes0 = [&lt;&gt;, &lt;&gt;,
 &lt;&gt;, Key, Value],
 Bytes = [&lt;&lt;(erlang:crc32(Bytes0)):?CRCSIZEFIELD&gt;&gt; | Bytes0],

And looking at the header, it seems that there's 14 bytes of overhead
(4 for CRC, 4 for timestamp, 2 for keysize, 4 for valsize).

So disk calculation should be

( 14 + Key + Value ) \\* Num Entries \\* N\\_Val

So using my numbers from before that gives

( 14 + 36 + 36 ) \\* 183915891 \\* 3 = 47450299878 = 44.1 GB

which actually isn't much closer to 341 GB than the previous calculation :(

So all my questions from the previous email still apply.

-Anthony

-- 
------------------------------------------------------------------------
Anthony Molinaro 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

