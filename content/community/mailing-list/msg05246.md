---
title: "Re: Riak 1.0"
description: ""
project: community
lastmod: 2011-10-22T11:05:20-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05246"
mailinglist_parent_id: "msg05231"
author_name: "Jim Adler"
project_section: "mailinglistitem"
sent_date: 2011-10-22T11:05:20-07:00
---


So, for the benefit of the list, here was my bonehead move: 

My installation script automatically 'riak starts' which, of course, uses the 
default app.config ring\\_creation\\_size of 64 before I get a chance to change it. 
Hello tarpit.

Lesson: don't 'riak start' on a fresh node until you modify app.config 
ring\\_creation\\_size.

Jim

On Oct 22, 2011, at 3:12 AM, Nico Meyer  wrote:

&gt; Hello Jim,
&gt; 
&gt; it sounds like the ring\\_creation\\_size in your app.conf file is inconsistent 
&gt; with the actual ring size on your existing nodes. This would happen, if the 
&gt; ring\\_creation\\_size in the config was changed after the ring as been created. 
&gt; As the name implies, the setting is only used when starting a fresh/empty 
&gt; node for the first time, so changing it afterwards has no real effect, other 
&gt; than showing up in the riak-admin output and severly confusing people ;-).
&gt; 
&gt; So to fix your problem, first of all, since the real ring size is 64, your 
&gt; new node must also have a ring size of 64. So do as Dan suggested, but set 
&gt; the ring\\_creation\\_size to 64 instead of 256.
&gt; At that point joining might already work. I checked the code, and if the new 
&gt; gossip protocol is used, riak checks for equality the actual ring sizes 
&gt; of the two nodes to join. But if the legacy gossip protocol is still used, 
&gt; riak compares the ring\\_creation\\_size config settings of both nodes.
&gt; 
&gt; In any case, you should change the ring\\_creation\\_size on all your nodes 
&gt; to 64 and restart them, if only to make thing consistent again.
&gt; 
&gt; Cheers,
&gt; Nico
&gt; 
&gt; Am 22.10.2011 09:46, schrieb Jim Adler:
&gt;&gt; 
&gt;&gt; For the bitcask backend, ring\\_num\\_partitions=64 and ring\\_creation\\_size=256. 
&gt;&gt; I haven't seen where to set ring\\_num\\_partitions in app.config. I have about 
&gt;&gt; 8 million keys stored in this cluster.
&gt;&gt; 
&gt;&gt; So, how do I bring up a LevelDB node and join to the existing cluster given 
&gt;&gt; this 64/256 partitions/creation\\_size config?
&gt;&gt; 
&gt;&gt; Thanks for the help!
&gt;&gt; 
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; From: Dan Reverri 
&gt;&gt; Date: Fri, 21 Oct 2011 09:41:02 -0700
&gt;&gt; To: Jim Adler 
&gt;&gt; Cc: Ian Plosker , "riak-users@lists.basho.com" 
&gt;&gt; 
&gt;&gt; Subject: Re: Riak 1.0
&gt;&gt; 
&gt;&gt; The "ring\\_creation\\_size" parameter in app.config must be set before the node 
&gt;&gt; has been started and written a ring file. Assuming the LevelDB node is 
&gt;&gt; empty, you can do the following: 
&gt;&gt; 
&gt;&gt; 1. Stop the node
&gt;&gt; 2. Clear out the data directories (data/ring, data/leveldb, data/bitcask, 
&gt;&gt; data/mr\\_queue, data/kv\\_vnode)
&gt;&gt; 3. Verify "ring\\_creation\\_size" is set to 256 in the app.config file
&gt;&gt; 4. Start the node
&gt;&gt; 5. Verify "ring\\_num\\_partitions" in "riak-admin status" is 256
&gt;&gt; 6. Join the node to the cluster
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Dan
&gt;&gt; 
&gt;&gt; Daniel Reverri
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Fri, Oct 21, 2011 at 9:30 AM,  wrote:
&gt;&gt; 64 on the LevelDB vs 256 on the Bitcask. I guess that’s it. Workaround?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; From: Dan Reverri [mailto:d...@basho.com] 
&gt;&gt; Sent: Friday, October 21, 2011 9:27 AM
&gt;&gt; To: Jim Adler
&gt;&gt; Cc: Ian Plosker; riak-users
&gt;&gt; Subject: Re: Riak 1.0
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Hi Jim,
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Can you check "ring\\_num\\_partitions" on each node from "riak-admin status"?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Dan
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Daniel Reverri
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; d...@basho.com
&gt;&gt; 
&gt;&gt; 2011/10/20 Jim Adler 
&gt;&gt; 
&gt;&gt; I tried the Bitcask-to-LevelDB procedure on 1.0.1 to switch my backend from 
&gt;&gt; Bitcask to LevelDB. I have one node on Bitcask with my data and the other 
&gt;&gt; node with a fresh LevelDB backend. When I join the fresh LevelDB node, I get 
&gt;&gt; the following error: Failed: r...@xx.xx.xx.xx has a different 
&gt;&gt; ring\\_creation\\_size
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; riak-admin status | grep creation gives: ring\\_creation\\_size : 256
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Any ideas?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Jim
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; From: riak-users-boun...@lists.basho.com 
&gt;&gt; [mailto:riak-users-boun...@lists.basho.com] On Behalf Of Ian Plosker
&gt;&gt; Sent: Saturday, October 01, 2011 8:15 AM
&gt;&gt; To: 54chen
&gt;&gt; ! Cc: riak-users
&gt;&gt; Subject: Re: Riak 1.0
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; There are instructions on the wiki: 
&gt;&gt; http://wiki.basho.com/Secondary-Indexes.html#Migrating-an-Existing-Cluster-(Method-One)
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Basically, you will have each node leave the cluster, switch the backend, 
&gt;&gt; and then rejoin. The process is something like this:
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 1) Issue `riak-admin leave` and wait for all transfers to complete
&gt;&gt; 
&gt;&gt; 2) `riak stop`
&gt;&gt; 
&gt;&gt; 3) Change the backend to the `riak\\_kv\\_eleveldb\\_backend`
&gt;&gt; 
&gt;&gt; 4) `riak start` and `riak-admin join `
&gt;&gt; 
&gt;&gt; 5) Repeat for each node in the cluster
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Ian Plosker
&gt;&gt; 
&gt;&gt; Developer Advocate
&gt;&gt; 
&gt;&gt; Basho Technologies
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Sep 30, 2011, at 10:41 PM, 54chen wrote:
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Congratulations!
&gt;&gt; 
&gt;&gt; Can you give me an example of how the 0.14.2（bitcas! k） 
&gt;&gt; upgrade to 1.0（ levelDB）?
&gt;&gt; 
&gt;&gt; 2011/10/1 Alexander Sicular 
&gt;&gt; 
&gt;&gt; Awesome!
&gt;&gt; 
&gt;&gt; Already got it in place on my mac and ubuntu dev boxes. Smooth.
&gt;&gt; 
&gt;&gt; -Alexander Sicular
&gt;&gt; 
&gt;&gt; @siculars
&gt;&gt; http://siculars.posterous.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Sep 30, 2011, at 4:31 PM, David Smith wrote:
&gt;&gt; 
&gt;&gt; &gt; Hi All,
&gt;&gt; &gt;
&gt;&gt; &gt; I am very pleased to announce that Riak 1.0 is tagged and officially
&gt;&gt; &gt; ready for downloading.
&gt;&gt; &gt;
&gt;&gt; &gt; Pre-built installations and source tarballs are available at:
&gt;&gt; &gt;
&gt;&gt; &gt; http://downloads.basho.com/riak/CURRENT
&gt;&gt; &gt;
&gt;&gt; &gt; Release notes are here:
&gt;&gt; &gt;
&gt;&gt; &gt; https://github.com/basho/riak/blob/1.0/RELEASE-NOTES.org
&gt;&gt; &gt;
&gt;&gt; &gt; There is also a blog post about the release here:
&gt;&gt; &gt;
&gt;&gt; &gt; http://blog.basho.com/2011/09/30/Riak-1-dot-0-is-Official/
&gt;&gt; &gt;
&gt;&gt; &gt; 1.0 has been two years and 15 releases in the making. Thank you all
&gt;&gt; &gt; for being a part of this project and wonderful community. We couldn't
&gt;&gt; &gt; have done it without you.
&gt;&gt; &gt;
&gt;&gt; &gt; Sincerely,
&gt;&gt; &gt;
&gt;&gt; &gt; D.
&gt;&gt; &gt;
&gt;&gt; &gt; --
&gt;&gt; &gt; Dave Smith
&gt;&gt; &gt; Director, Engineering
&gt;&gt; &gt; Basho Technologies, Inc.
&gt;&gt; &gt; diz...@basho.com
&gt;&gt; &gt;
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users \\_lists.basho.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; -
&gt;&gt; http://www.54chen.com 
&gt;&gt; http://twitter.com/54chen
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt; 

