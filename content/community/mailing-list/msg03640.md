---
title: "Re: Waiting for 'backend' bucket property to take effect"
description: ""
project: community
lastmod: 2011-06-10T06:48:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03640"
mailinglist_parent_id: "msg03638"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-06-10T06:48:10-07:00
---


Greg,

Yes, it is most likely gossip lag causing that. For your test cluster you 
could decrease the gossip\\_interval setting in riak\\_core from its default of 
60000 ms to something smaller.

There has long been talk of moving the bucket properties out of the ring into 
something like a "system bucket" or "catalog", which could be gossiped on 
demand or at a different interval than the ring. I don't recall the exact 
issue number in our Bugzilla, but it's &lt; 100.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Jun 10, 2011, at 2:17 AM, Greg Nelson wrote:

&gt; Hello,
&gt; 
&gt; I have been debugging something I've seen popping up intermittently when 
&gt; running my application's functional tests against Riak (local 5 node devrel 
&gt; cluster). The behavior is basically that sometimes an object which was PUT 
&gt; will seemingly disappear. Any future GETs will 404. Even if waiting seconds 
&gt; or minutes between PUT and GET.
&gt; 
&gt; After staring at this and pulling out some hair I finally figured out what 
&gt; was happening (I think). I noticed it was always the first few objects 
&gt; written that were lost, and only on a certain bucket. My application uses 
&gt; multi-backend with two bitcask backends. That bucket is the only one which 
&gt; uses the non-default backend.
&gt; 
&gt; What's happening is the application first gets the bucket properties and then 
&gt; sets the "backend" prop if it's not set. You can probably guess the rest. 
&gt; (PUTs come into nodes which don't have the property in their ring state yet 
&gt; and store the objects in the default backend)
&gt; 
&gt; I don't think this is necessarily a "bug". It's expected behavior when you 
&gt; think about it, as long as you know how bucket properties are propagated. 
&gt; But even knowing that, this is pretty subtle.
&gt; 
&gt; Is there a good way for a client to know when the property has been gossiped 
&gt; to all the nodes? Seems like the only approach is to wait a bit after 
&gt; setting a property before doing a PUT...
&gt; 
&gt; Also, does this sound right? It's very possible I'm wrong about what's 
&gt; causing this behavior.
&gt; 
&gt; -Greg
