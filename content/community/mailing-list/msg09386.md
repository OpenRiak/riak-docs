---
title: "Re: A bunch of Erlang client questions"
description: ""
project: community
lastmod: 2012-11-27T05:16:26-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09386"
mailinglist_parent_id: "msg09383"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2012-11-27T05:16:26-08:00
---


Hi, Alex. I'm sorry you weren't able to find your answers in our docs.
Some of them assume that you've read all of the other docs as well.
I'll see what I can do to clear things up inline.

On Mon, Nov 26, 2012 at 7:23 PM, Alex RÃ¸nne Petersen
 wrote:
&gt; \\* Is the proper way to replace the object associated with a bucket/key
&gt; pair to simply do a riakc\\_pb\\_socket:put/2 with the same bucket/key
&gt; pair (with a new object)?

This one is answered in the "Modifying Data" section of the README:

https://github.com/basho/riak-erlang-client/blob/master/README.md#modifying-data

In short, the proper way to replace an object is to first fetch the
existing object, then update the value of what you fetched, then use
riakc\\_pb\\_socket:put to write the new value. The reason for doing this
is to comply with Riak's consistency system (the vector clocks) - it
needs to know what value you were starting from in order to overwrite
it correctly.

&gt; \\* What exactly is the purpose of riakc\\_obj:update\\_value/2 (with
&gt; regards to the above question)?

The riakc\\_obj structure stores two different things: the
value+metadata you read, and the value+metadata you want to write. The
update\\_value and update\\_metadata functions set the value+metadata you
want to write. The same can be said about get\\_value/get\\_metadata and
get\\_update\\_value/get\\_update\\_metadata - they each access one part of
the riakc\\_obj structure. Although, as was discussed recently on this
list, get\\_update\\_value will return the result of get\\_value if no
update value has been set.

&gt; \\* How does one associate a secondary index with an object? Is this
&gt; done via riakc\\_obj:update\\_metadata/2?

Yes, you need to set the "index" metadata entry to associate a
secondary index with an object. For example, to set values the
"myidx\\_bin" and "youridx\\_int" indexes:

 Obj = riakc\\_obj:new(Bucket, Key, Value).
 Idx = [{"myidx\\_bin", "hello"},{"youridx\\_int","9876"}].
 MD = dict:store(&lt;&lt;"index"&gt;&gt;, Idx, dict:new()).
 ObjIndexed = riakc\\_obj:update\\_metadata(Obj, MD).
 riakc\\_pb\\_socket:put(Socket, ObjIndexed).

If overwriting a value, you would use the result of
riakc\\_obj:get\\_metadata/1 instead of dict:new/0 for building your new
metadata.

&gt; \\* Is there any particular reason the Erlang client doesn't yet support
&gt; all bucket properties?

Yes, it does not support the bucket properties that the Protocol
Buffers interface to Riak does not support. It's a known problem. You
can follow work on it here:

https://github.com/basho/riak\\_pb/issues/5

In the meantime, the riak-erlang-http-client can be used to set other
bucket properties:

https://github.com/basho/riak-erlang-http-client

&gt; \\* What exactly do the various get and put options do? Specifically,
&gt; if\\_modified, notfound\\_ok, basic\\_quorum, head, and deletedvclock for
&gt; the former

These answers can be found in the docs for the Protocol Buffers get message:

http://docs.basho.com/riak/latest/references/apis/protocol-buffers/PBC-Fetch-Object/

 and return\\_body, return\\_head, if\\_not\\_modified, and
&gt; if\\_none\\_match for the former.

And these answers are in the docs for the Protocol Buffers put message:

http://docs.basho.com/riak/latest/references/apis/protocol-buffers/PBC-Store-Object/

&gt; \\* How will riakc\\_pb\\_socket:get/3 behave when queue\\_if\\_disconnected is
&gt; enabled? Will it fail immediately if the socket is disconnected or
&gt; block until it has reconnected?

With queue\\_if\\_disconnected enabled, riakc\\_pb\\_socket:get/3 will block
until the socket is reconnected.

HTH,
Bryan

