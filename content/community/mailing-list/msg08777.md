---
title: "riak on one node"
description: ""
project: community
lastmod: 2012-10-01T17:03:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08777"
author_name: "Curtis Schofield"
project_section: "mailinglistitem"
sent_date: 2012-10-01T17:03:51-07:00
---


I know this isn't really the typical use case. I wanted to use riak on a
development setup and a small production setup

I am using it to store HTTP requests. I have 4 secondary indexes. When I
start to load up the server with live traffic from
one device - it crashes the server very fast. I am doing multiple large
writes quickly for each request.

I do not believe that this is the best use of memcache - I have switched to
the filesystem for now - I could imagine this
system becoming very large and it would be useful to have a cluster holding
the server traffic.


I HAVE NOT USED n\\_val 1

Could someone explain how this may change things?

{default\\_bucket\\_props, [{n\\_val,1},
 {allow\\_mult,false},
 {last\\_write\\_wins,false},
 {precommit, []},
 {postcommit, []},
 {chash\\_keyfun, {riak\\_core\\_util, chash\\_std\\_keyfun}}
]}

riak-admin status
--
1-minute stats for 'riak@127.0.0.1'
-------------------------------------------
vnode\\_gets : 0
vnode\\_gets\\_total : 0
vnode\\_puts : 0
vnode\\_puts\\_total : 0
vnode\\_index\\_reads : 0
vnode\\_index\\_reads\\_total : 0
vnode\\_index\\_writes : 0
vnode\\_index\\_writes\\_total : 0
vnode\\_index\\_writes\\_postings : 0
vnode\\_index\\_writes\\_postings\\_total : 0
vnode\\_index\\_deletes : 0
vnode\\_index\\_deletes\\_total : 0
vnode\\_index\\_deletes\\_postings : 0
vnode\\_index\\_deletes\\_postings\\_total : 0
node\\_gets : 0
node\\_gets\\_total : 0
node\\_get\\_fsm\\_siblings\\_mean : 0
node\\_get\\_fsm\\_siblings\\_median : 0
node\\_get\\_fsm\\_siblings\\_95 : 0
node\\_get\\_fsm\\_siblings\\_99 : 0
node\\_get\\_fsm\\_siblings\\_100 : 0
node\\_get\\_fsm\\_objsize\\_mean : 0
node\\_get\\_fsm\\_objsize\\_median : 0
node\\_get\\_fsm\\_objsize\\_95 : 0
node\\_get\\_fsm\\_objsize\\_99 : 0
node\\_get\\_fsm\\_objsize\\_100 : 0
node\\_get\\_fsm\\_time\\_mean : 0
node\\_get\\_fsm\\_time\\_median : 0
node\\_get\\_fsm\\_time\\_95 : 0
node\\_get\\_fsm\\_time\\_99 : 0
node\\_get\\_fsm\\_time\\_100 : 0
node\\_puts : 0
node\\_puts\\_total : 0
node\\_put\\_fsm\\_time\\_mean : 0
node\\_put\\_fsm\\_time\\_median : 0
node\\_put\\_fsm\\_time\\_95 : 0
node\\_put\\_fsm\\_time\\_99 : 0
node\\_put\\_fsm\\_time\\_100 : 0
read\\_repairs : 0
read\\_repairs\\_total : 0
coord\\_redirs\\_total : 0
executing\\_mappers : 0
precommit\\_fail : 0
postcommit\\_fail : 0
pbc\\_active : 0
pbc\\_connects : 0
pbc\\_connects\\_total : 0
cpu\\_nprocs : 167
cpu\\_avg1 : 20
cpu\\_avg5 : 8
cpu\\_avg15 : 13
mem\\_total : 2090033152
mem\\_allocated : 2009604096
disk : [{"/",82569904,9},
 {"/dev",1011788,1},
 {"/run",408212,1},
 {"/run/lock",5120,0},
 {"/run/shm",1020524,0}]
nodename : 'riak@127.0.0.1'
connected\\_nodes : []
sys\\_driver\\_version : &lt;&lt;"2.0"&gt;&gt;
sys\\_global\\_heaps\\_size : 0
sys\\_heap\\_type : private
sys\\_logical\\_processors : 4
sys\\_otp\\_release : &lt;&lt;"R15B01"&gt;&gt;
sys\\_process\\_count : 1392
sys\\_smp\\_support : true
sys\\_system\\_version : &lt;&lt;"Erlang R15B01 (erts-5.9.1) [source] [64-bit]
[smp:4:4] [async-threads:64] [kernel-poll:true]"&gt;&gt;
sys\\_system\\_architecture : &lt;&lt;"x86\\_64-unknown-linux-gnu"&gt;&gt;
sys\\_threads\\_enabled : true
sys\\_thread\\_pool\\_size : 64
sys\\_wordsize : 8
ring\\_members : ['riak@127.0.0.1']
ring\\_num\\_partitions : 64
ring\\_ownership : &lt;&lt;"[{'riak@127.0.0.1',64}]"&gt;&gt;
ring\\_creation\\_size : 64
storage\\_backend : riak\\_kv\\_eleveldb\\_backend
erlydtl\\_version : &lt;&lt;"0.7.0"&gt;&gt;
riak\\_control\\_version : &lt;&lt;"1.2.0"&gt;&gt;
cluster\\_info\\_version : &lt;&lt;"1.2.2"&gt;&gt;
riak\\_api\\_version : &lt;&lt;"1.2.0"&gt;&gt;
riak\\_search\\_version : &lt;&lt;"1.2.0"&gt;&gt;
merge\\_index\\_version : &lt;&lt;"1.2.0"&gt;&gt;
riak\\_kv\\_version : &lt;&lt;"1.2.0"&gt;&gt;
riak\\_pipe\\_version : &lt;&lt;"1.2.0"&gt;&gt;
riak\\_core\\_version : &lt;&lt;"1.2.0"&gt;&gt;
lager\\_version : &lt;&lt;"1.2.0"&gt;&gt;
syntax\\_tools\\_version : &lt;&lt;"1.6.8"&gt;&gt;
compiler\\_version : &lt;&lt;"4.8.1"&gt;&gt;
bitcask\\_version : &lt;&lt;"1.5.1"&gt;&gt;
basho\\_stats\\_version : &lt;&lt;"1.0.2"&gt;&gt;
luke\\_version : &lt;&lt;"0.2.5"&gt;&gt;
webmachine\\_version : &lt;&lt;"1.9.2"&gt;&gt;
mochiweb\\_version : &lt;&lt;"1.5.1"&gt;&gt;
inets\\_version : &lt;&lt;"5.9"&gt;&gt;
erlang\\_js\\_version : &lt;&lt;"1.2.0"&gt;&gt;
runtime\\_tools\\_version : &lt;&lt;"1.8.8"&gt;&gt;
os\\_mon\\_version : &lt;&lt;"2.2.9"&gt;&gt;
riak\\_sysmon\\_version : &lt;&lt;"1.1.2"&gt;&gt;
ssl\\_version : &lt;&lt;"5.0.1"&gt;&gt;
public\\_key\\_version : &lt;&lt;"0.15"&gt;&gt;
crypto\\_version : &lt;&lt;"2.1"&gt;&gt;
sasl\\_version : &lt;&lt;"2.2.1"&gt;&gt;
stdlib\\_version : &lt;&lt;"1.18.1"&gt;&gt;
kernel\\_version : &lt;&lt;"2.15.1"&gt;&gt;
memory\\_total : 22136232
memory\\_processes : 6884866
memory\\_processes\\_used : 6884852
memory\\_system : 15251366
memory\\_atom : 429569
memory\\_atom\\_used : 403025
memory\\_binary : 68592
memory\\_code : 9114868
memory\\_ets : 761720

riak ERROR.log
-

{error,{error,{badmatch,{error,timeout}},[{riak\\_kv\\_wm\\_buckets,produce\\_bucket\\_list,2,[{file,"src/riak\\_kv\\_wm\\_buckets.erl"},{line,123}]},{webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_resource.erl"},{line,169}]},{webmachine\\_resource,do,3,[{file,"src/webmachine\\_resource.erl"},{line,128}]},{webmachine\\_decision\\_core,resource\\_call,1,[{file,"src/webmachine\\_decision\\_core.erl"},{line,48}]},{webmachine\\_decision\\_core,decision,1,[{file,"src/webmachine\\_decision\\_core.erl"},{line,532}]},{webmachine\\_decision\\_core,handle\\_request,2,[{file,"src/webmachine\\_decision\\_core.erl"},{line,33}]},{webmachine\\_mochiweb,loop,1,[{file,"src/webmachine\\_mochiweb.erl"},{line,87}]},{mochiweb\\_http,parse\\_headers,5,[{file,"src/mochiweb\\_http.erl"},{line,180}]}]}}

2012-09-26 20:09:07.781 [error] &lt;0.181.0&gt; webmachine error:
path="/buckets/requests/index/request-complete\\_int/1"
{error,{error,insufficient\\_vnodes\\_available}}

2012-09-26 20:17:01.297 [error] &lt;0.1023.0&gt;@riak\\_core\\_vnode:handle\\_info:510
662242929415565384811044689824565743281594433536 riak\\_kv\\_vnode worker pool
crashed
{timeout,{gen\\_fsm,sync\\_send\\_event,[&lt;0.1026.0&gt;,{checkout,false,5000},5000]}}


Riak Crash
-

\\*\\* When State == ready
\\*\\* Data == {state,{[],[]},&lt;0.1536.0&gt;,[],undefined}
\\*\\* Reason for termination =
\\*\\*
{timeout,{gen\\_server,call,[&lt;0.1538.0&gt;,{work,&lt;0.1536.0&gt;,{fold,#Fun,#Fun},{fsm,{65698276,{1347321821914426127719021955160323408745312813056,'
riak@127.0.0.1'}},&lt;0.2014.0&gt;}}]}}
2012-09-26 20:17:05 =CRASH REPORT====
 crasher:
 initial call: riak\\_core\\_vnode\\_worker\\_pool:init/1
 pid: &lt;0.1535.0&gt;
 registered\\_name: []
 exception exit:
{{timeout,{gen\\_server,call,[&lt;0.1538.0&gt;,{work,&lt;0.1536.0&gt;,{fold,#Fun,#Fun},{fsm,{65698276,{1347321821914426127719021955160323408745312813056,'
riak@127.0.0.1
'}},&lt;0.2014.0&gt;}}]}},[{gen\\_fsm,terminate,7,[{file,"gen\\_fsm.erl"},{line,611}]},{proc\\_lib,init\\_p\\_do\\_apply,3,[{file,"proc\\_lib.erl"},{line,227}]}]}
 ancestors: [&lt;0.1530.0&gt;,riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.136.0&gt;]
 messages: [{#Ref&lt;0.0.0.7742&gt;,ok}]
 links: [&lt;0.1530.0&gt;]
 dictionary: []
 trap\\_exit: false
 status: running
 heap\\_size: 610
 stack\\_size: 24
 reductions: 219
 neighbours:


-- 
---
Modern Yoga vs Traditional Yoga
http://swamij.com/traditional-yoga.htm#swamirama
