---
title: "Re: Is this idiotic?"
description: ""
project: community
lastmod: 2011-01-12T05:04:49-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01957"
mailinglist_parent_id: "msg01955"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-01-12T05:04:49-08:00
---


Eric,

That seems a very reasonable way to accomplish your query. If you use Riak 
Search, you could make a query like "author\\_id:bob AND tag:riak" and use that 
to feed your map-reduce query.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Jan 11, 2011, at 7:34 PM, Eric Moritz wrote:

&gt; I'm still getting a feel for schema design in Riak. I need to fetch
&gt; blog entries using a compound index of (author, tag).
&gt; 
&gt; This is what I've come up with.
&gt; 
&gt; I have two buckets:
&gt; 
&gt; /riak/entry/{id}
&gt; /riak/entries\\_by\\_author\\_and\\_tag/{author\\_id}.{tag}
&gt; 
&gt; Assume the keys are url safe.
&gt; 
&gt; Stored in entries\\_by\\_author\\_and\\_tag is a document that is just a JSON
&gt; document that is:
&gt; 
&gt; {
&gt; author\\_id: string,
&gt; tag: string,
&gt; entry\\_keys: {
&gt; entry\\_key: {pub\\_dt: iso8601zulu\\_string},
&gt; ...
&gt; }
&gt; }
&gt; 
&gt; When I need to locate entries by a list of [(author\\_id, tag)] I map
&gt; the entries\\_by\\_author\\_and\\_tag documents to a list of {entry\\_key:"",
&gt; pub\\_dt:""} objects and then sort and limit them in the reduce phase.
&gt; 
&gt; This works, but it feel really dirty to me. Is this just plain dumb?
&gt; It feels dumb.
&gt; 
&gt; At first I figured I would just store the {author\\_id}.{tag} keys as a
&gt; author\\_tag\\_list in the entry and user Riak Search to fetch them but
&gt; because a user could follow hundreds or thousands of author/tag pairs,
&gt; the query string to fetch those entries would get too large. I assume
&gt; that looking up a 1000 entries\\_by\\_author\\_tag documents could be too
&gt; slow, I'll have to test that out.
&gt; 
&gt; Thanks,
&gt; Eric.
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

