---
title: "Re: Some questions about Riak Search and Riak itself"
description: ""
project: community
lastmod: 2010-10-13T19:59:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01282"
mailinglist_parent_id: "msg01279"
author_name: "Dmitry Demeshchuk"
project_section: "mailinglistitem"
sent_date: 2010-10-13T19:59:45-07:00
---


Hi, Bryan.

Thanks, works just perfect!

2010/10/14 Bryan Fink :
&gt; 2010/10/13 Dmitry Demeshchuk :
&gt;&gt; I worked it out. Both shell and command-line search work good. Seems
&gt;&gt; like I've been doing something wrong before.
&gt;
&gt; Excellent - good to hear.
&gt;
&gt;&gt;&gt;&gt; 4. Do you have any tips and advice about working with Unicode in Riak 
&gt;&gt;&gt;&gt; Search?
&gt;&gt;&gt;
&gt;&gt;&gt; Encode everything in UTF-8.  There may still be a few bugs we need to
&gt;&gt;&gt; work out, but our intended goal is to have everything in that
&gt;&gt;&gt; department "just work" once you're using UTF-8 everywhere.
&gt;&gt;
&gt;&gt; I'm not sure if I do everything right but here's the step-by step
&gt;&gt; description of my actions:
&gt;&gt;
&gt;&gt; 1.  curl -v -d "{\\"title\\":\\"Статья 1\\", \\"tags\\":\\"псто, лытдыбр\\",
&gt;&gt; \\"body\\":\\"Я что-то здесь написал\\"}" -H "Content-Type:
&gt;&gt; application/json" http://127.0.0.1:8098/riak/posts
&gt;&gt;
&gt;&gt; (Note, there are cyrillic symbols)
&gt;&gt;
&gt; ...snip...
&gt;&gt;
&gt;&gt; 3. curl -X POST -H "content-type: application/json"
&gt;&gt; http://localhost:8098/mapred -d '{"inputs":{"module":"riak\\_search",
&gt;&gt; "function":"mapred\\_search", "arg": ["posts", "title:Статья\\*"]},
&gt;&gt; "query":[{"map":{"language":"javascript","source":"Riak.mapValues",
&gt;&gt; "keep":true}}]}'
&gt;&gt;
&gt; ...snip...
&gt;&gt;
&gt;&gt; Am I doing something wrong? Should I encode characters somehow before
&gt;&gt; I send them into RiakSearch?
&gt;
&gt; Thanks for the excellent test case - very easy to reproduce.  I
&gt; apologize for my delay in responding, but I wanted to make sure I had
&gt; all of my ducks in a row first.
&gt;
&gt; So, no, you're doing nothing wrong.  The default, Erlang-based
&gt; analyzer is, in fact, just ignoring non-ascii characters.  I've
&gt; created an issue to track the fix to that analyzer here:
&gt;
&gt;   https://issues.basho.com/show\\_bug.cgi?id=814
&gt;
&gt; In the meantime, the easiest way to fix this issue is to use the
&gt; Java-based "DefaultAnalyzerFactory", which handles non-ascii
&gt; characters correctly (in my tests, at least; I look forward to yours).
&gt;  To use this analyzer, edit your schema file, and add the following
&gt; line to the first list in the schema:
&gt;
&gt;   {analyzer\\_factory, "com.basho.search.analysis.DefaultAnalyzerFactory"}
&gt;
&gt; (The example schemas on the wiki and in doc/using\\_search.org
&gt; demonstrate the proper placement of this line).  After editing, use
&gt; the bin/search-cmd script to update the schema:
&gt;
&gt;   $RIAK/bin/seach-cmd set\\_schema posts /path/to/your/schema.def
&gt;
&gt; Riak Search should reindex any documents you have stored using the new
&gt; analyzer.  Try your map/reduce query again, and I think you'll find it
&gt; working.
&gt;
&gt; -Bryan
&gt;

-- 
Best regards,
Dmitry Demeshchuk

