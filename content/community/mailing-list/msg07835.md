---
title: "Re: 50-100 ops/sec on a 5 Node cluster"
description: ""
project: community
lastmod: 2012-06-29T09:55:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07835"
mailinglist_parent_id: "msg07833"
author_name: "Mark Rose"
project_section: "mailinglistitem"
sent_date: 2012-06-29T09:55:11-07:00
---


There are other reasons to avoid using an ELB for this purpose I'd like to
add.

ELB works by resolving a DNS name to an A record, so if the ELB instance
goes down or has trouble, you will have trouble as well. This is also the
source of the scaling up issue as it takes time for the DNS records on the
client machines to expire and for new A records to be returned.

Also, you have to pay per request, plus the bandwidth used. Not to mention
the latency of client-&gt;elb-&gt;server instead of running a proxy on the local
machine.

Instead, I would recommend setting up HAProxy on every client machine, and
configure HAProxy to connect to some or all of your nodes. It will react
much faster to node status, plus you get useful reports and whatnot. It's
also extremely efficient, using little CPU and memory.

-Mark

On Fri, Jun 29, 2012 at 12:28 PM, Sean O'Connor  wrote:

&gt; There are a few things you probably want to look at in regard to how your
&gt; using ELB.
&gt;
&gt; If your using the straight ELB offering (e.g. not part of a virtual
&gt; private cloud), that's probably your problem. This form of ELB was really
&gt; only designed for routing traffic from outside the AWS network to servers
&gt; within EC2. Using it route traffic with the AWS tends to be very
&gt; slow/throttled as your traffic has to go out to the public network and then
&gt; back into the private AWS network.
&gt;
&gt; Recently (i.e. the last two or three weeks) Amazon announced a new version
&gt; of ELB that you can use with virtual private cloud to route traffic between
&gt; VPC networks. I haven't tried it yet but in theory this should avoid many
&gt; of the problems mentioned above.
&gt;
&gt; One last thing to be aware of with ELB is it can often take a while for an
&gt; ELB instance to deal with spikes in capacity (e.g. load tests). Under the
&gt; covers ELB is basically as series of managed EC2 instances running a load
&gt; balancer program. When your capacity exceeds what one instance can handle,
&gt; they'll spin up more instances but that takes time to happen. Accordingly
&gt; when doing load testing with ELB, you often need to "prime" the ELB by
&gt; running test traffic for 10-15 minutes and then start recording your
&gt; benchmark data.
&gt;
&gt; With the possible exception of the new VPC ELB offering, I would strongly
&gt; recommend against using ELB to load balance traffic to your riak cluster.
&gt;
&gt; --
&gt; Sean O'Connor
&gt; CTO/Co-Founder
&gt; (845)669-0883
&gt; http://focuslab.io
&gt;
&gt; On Thursday, June 28, 2012 at 4:03 PM, Ruslan Bukin wrote:
&gt;
&gt; On Tue, Jun 26, 2012 at 04:29:38PM +0530, Yousuf Fauzan wrote:
&gt;
&gt; Hello,
&gt;
&gt; Here is my setup of Riak 1.1.4
&gt;
&gt; - 5 Nodes
&gt; - ami-a29943cb (EC2 AMI)
&gt; - m1.large (7.5GB Ram, 4 EC2 compute instances)
&gt; - EBS storage
&gt; - LevelDB backend
&gt; - Python Client with Protobuf (on a separate machine)
&gt;
&gt; While loading data I am getting around 50 ops/sec.
&gt;
&gt; I tried running basho benchmark on the setup and it showed 100 ops/sec
&gt; throughput.
&gt;
&gt; After talking to people or Riak IRC, I realized that upwards of 1.5K
&gt; ops/sec is what I should be getting.
&gt;
&gt; Could anyone help me in figuring out what I am doing wrong?
&gt;
&gt;
&gt; are your riak nodes located in the same DC?
&gt;
&gt; -Ruslan
&gt;
