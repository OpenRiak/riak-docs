---
title: "Re: running erlang map phases via REST API"
description: ""
project: community
lastmod: 2011-01-24T12:56:48-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02100"
mailinglist_parent_id: "msg02098"
author_name: "Brendan"
project_section: "mailinglistitem"
sent_date: 2011-01-24T12:56:48-08:00
---


having an anonymous fun would seem useful on a larger cluster - you
wouldn't need to distribute a new file/module to all machines in the
cluster (as i think you must do now?).

the docs around calling an erlang map phase are a bit confusing
(http://wiki.basho.com/MapReduce.html):
&gt; Function source can be specified directly in the query by using the
&gt; "source" spec field. Function source can also be loaded from a
&gt; pre-stored riak object by providing "bucket" and "key" fields in the
&gt; spec. Erlang map functions can be specified using the "module" and
&gt; "function" fields in the spec.
it wasn't immediately obvious to me that the erlang functions \\*must\\* be
specified with module+function, especially since an anonymous fun is
used later on as an example in the same document.

the wiki doc also doesn't indicate where to put any custom erlang
map/reduce functions... do they go into riak-0.14.0/deps/riak\\_kv/src/
and then need to be built into the release?

On 11-01-24 12:34 PM, Dan Reverri wrote:
&gt; Hi Brendan,
&gt;
&gt; Anonymous Erlang functions are not currently supported in map reduce
&gt; phases. Is this a feature the community would find valuable?
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com 
&gt;
&gt;
&gt; On Mon, Jan 24, 2011 at 12:14 PM, Brendan  &gt; wrote:
&gt;
&gt; is it possible to pass erlang anonymous funs via the REST API? i
&gt; took a
&gt; javascript query, replaced "language":"javascript" with
&gt; "language":"erlang" and changed the source to an anonymous fun, but i
&gt; end up getting an error from the REST API back.am 
&gt; i doing something
&gt; wrong here, or can erlang functions only be called using the "module"
&gt; and "function" fields?
&gt;
&gt; the anonymous erlang fun was pulled from the Phase Functions-&gt;Map
&gt; Function examples section of the http://wiki.basho.com/MapReduce.html
&gt; wiki page.
&gt;
&gt; [dev.a]brendan@build01:~/riak$ curl -X PUT -d 'stuff'
&gt; http://127.0.0.1:8098/riak/bucket/object
&gt; [dev.a]brendan@build01:~/riak$ curl -X GET
&gt; http://127.0.0.1:8098/riak/bucket/object; echo
&gt; stuff
&gt; [dev.a]brendan@build01:~/riak$ cat erl2
&gt; {
&gt; "inputs": [
&gt; [
&gt; "bucket",
&gt; "object"
&gt; ]
&gt; ],
&gt; "query": [
&gt; {
&gt; "map": {
&gt; "language": "erlang",
&gt; "source":
&gt; "fun(Value,\\_Keydata,\\_Arg)-&gt;[[riak\\_object:get\\_value(Value)]] end."
&gt; }
&gt; }
&gt; ]
&gt; }
&gt; [dev.a]brendan@build01:~/riak$ curl -X POST -H
&gt; "content-type:application/json" http://localhost:8098/mapred
&gt; --data @erl2
&gt; 500 Internal Server
&gt; ErrorInternal Server Error
=====================

The server
&gt; encountered an error while processing this
&gt; request:  

```
{error,badarg,
&gt;           [{erlang,binary_to_list,[undefined]},
&gt;            {riak_kv_mapred_json,bin_to_atom,1},
&gt;            {riak_kv_mapred_json,parse_step,2},
&gt;            {riak_kv_mapred_json,parse_query,2},
&gt;            {riak_kv_mapred_json,parse_request,1},
&gt;            {riak_kv_wm_mapred,verify_body,2},
&gt;            {riak_kv_wm_mapred,malformed_request,2},
&gt;
&gt;     
&gt; {webmachine_resource,resource_call,3}]}
```


---

mochiweb+webmachine
&gt; web server


&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

