---
title: "Re: preflist_exhausted with map-reduce and riak-js"
description: ""
project: community
lastmod: 2012-03-13T06:48:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06945"
mailinglist_parent_id: "msg06944"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2012-03-13T06:48:56-07:00
---


Hi Arne,

Could you try with 1.1.1 please. We've fixed a number of bugs with how
MapReduce handles errors that could explain some of what you are seeing.

Jon

On Tue, Mar 13, 2012 at 12:55 AM, Arne Claassen wrote:

&gt; I'm running 1.1.0 built from source on Centos 6. I set up two nodes on
&gt; localhost following the instructions on the basho site for testing and
&gt; everything was going fine until i needed to fetch all items in a bucket.
&gt;
&gt; For this i was using node.js with riak-js and it's db.getAll call,which
&gt; from the debug logs looks like it uses /mapred
&gt;
&gt; The bucket only has about 1200 items in it, each a json payload of about
&gt; 3KB. Initially, it'd keep getting inconsistent results, sometimes the data
&gt; would come back, sometimes data would be undefined. So i kept running it,
&gt; trying to see if there was a pattern, adding more debugging code, etc. But
&gt; still it would be about a request every couple of seconds. Then it just
&gt; stopped working altogether and now i always get:
&gt;
&gt; { [Error: HTTP error 500:
&gt; {"phase":0,"error":"[preflist\\_exhausted]","input":"{ok,{r\\_object,&lt;&lt;\\"tweets\\_15368536\\"&gt;&gt;,&lt;&lt;\\"178528155714330620\\"&gt;&gt;,[{r\\_content,{dict,6,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[&lt;&lt;\\"Links\\"&gt;&gt;]],[],[],[],[],[],[],[],[[&lt;&lt;\\"content-type\\"&gt;&gt;,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110],[&lt;&lt;\\"X-Riak-VTag\\"&gt;&gt;,49,76,115,54,70,75,74,71,119,65,111,70,88,73,117,84,98,88,79,69,52,116]],[[&lt;&lt;\\"index\\"&gt;&gt;]],[],[[&lt;&lt;\\"X-Riak-Last-Modified\\"&gt;&gt;|{1331,487523,218968}]],[],[[&lt;&lt;\\"X-Riak-Meta\\"&gt;&gt;]]}}},&lt;&lt;\\"{\\"coordinates\\":null,\\"create...\\"&gt;&gt;}],...},...}","type":"forward\\_preflist","stack":"[]"}]
&gt; statusCode: 500 }
&gt;
&gt; in the console. I haven't tried restarting riak, just because i'd rather
&gt; find out what's happening than it going away and coming back later when i
&gt; don't expect it.
&gt;
&gt; Any suggestions on how to troubleshoot this? I can still access items
&gt; individually and i can even list the keys via ?keys=true, it's just he map
&gt; reduce that seems to be busted.
&gt;
&gt; cheers,
&gt; arne


-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
