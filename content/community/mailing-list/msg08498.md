---
title: "Re: MapReduce - sorting via the Java client"
description: ""
project: community
lastmod: 2012-09-11T10:47:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08498"
mailinglist_parent_id: "msg08497"
author_name: "Deepak Balasubramanyam"
project_section: "mailinglistitem"
sent_date: 2012-09-11T10:47:47-07:00
---


Hi Mark,

Sure, I can help whip up a page when I find the time. Do I get access to
edit the wiki or should I email ro...@basho.com ?

Thanks
Deepak Bala

On Tue, Sep 11, 2012 at 10:58 PM, Mark Phillips  wrote:

&gt; Hi Deepak,
&gt;
&gt; In-line
&gt;
&gt; On Tue, Sep 11, 2012 at 10:16 AM, Deepak Balasubramanyam
&gt;  wrote:
&gt; &gt; I was researching the same question and found the answer after some
&gt; &gt; tinkering around. You need a JS source function. You must write the JS
&gt; &gt; source code for the sort algorithm too.
&gt; &gt;
&gt; &gt; JSSourceFunction phaseFunction = new JSSourceFunction(
&gt; &gt; "function(v) {" +
&gt; &gt; "return v.sort(function(a, b) {" +
&gt; &gt; "return a.field - b.field ;" +
&gt; &gt; "}" +
&gt; &gt; ");" +
&gt; &gt; "}");
&gt; &gt; IndexQuery iq = new BinValueQuery(BinIndex.named("indx\\_name"),"bucket",
&gt; &gt; "value"); // get an index
&gt; &gt; MapReduceResult execute = client.mapReduce(iq).addMapPhase(new
&gt; &gt; NamedJSFunction("Riak.mapValuesJson"),
&gt; &gt; false).addReducePhase(phaseFunction).execute();
&gt; &gt; String resultRaw = execute.getResultRaw(); // Raw data
&gt; &gt; Collection result = execute.getResult(YourType .class); //
&gt; &gt; serialized to a domain object
&gt; &gt;
&gt; &gt; The result of this operation will depend on what you return in your
&gt; reduce()
&gt; &gt; function. The result may be a YourType or YourType[] etc. I wanted to
&gt; &gt; mention that since Jackson can complain about serialization issues if you
&gt; &gt; return the wrong values.
&gt; &gt;
&gt; &gt; Anyone know how to get this into a wiki ?
&gt;
&gt;
&gt; This would probably fit better on the Riak-Java-Client wiki.
&gt;
&gt; https://github.com/basho/riak-java-client/wiki/TODO
&gt;
&gt; There's an open TODO for MapReduce examples and I know Brian would
&gt; love some help with it. Care to take a stab at adding that code?
&gt;
&gt; Mark
&gt;
&gt; &gt;
&gt; &gt; Thanks
&gt; &gt; Deepak Bala
&gt; &gt;
&gt; &gt; On Wed, Aug 29, 2012 at 5:09 PM, Oved Machlev 
&gt; &gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi,
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; How can I use the sorting functions over 'real' fields in the stored
&gt; &gt;&gt; objects? How can I set the field on which I want to sort by?
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; It seems that the following refers to the key, in my case it's a UUID,
&gt; and
&gt; &gt;&gt; therefore useless to sort by:
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; MapReduceResult result = riakClient.
&gt; &gt;&gt;
&gt; &gt;&gt; mapReduce("some\\_bucket").
&gt; &gt;&gt;
&gt; &gt;&gt; addMapPhase(new
&gt; &gt;&gt; NamedJSFunction("Riak.mapValuesJson"), false).
&gt; &gt;&gt;
&gt; &gt;&gt; addReducePhase(new
&gt; &gt;&gt; NamedErlangFunction("riak\\_kv\\_mapreduce", "reduce\\_sort"), true).
&gt; &gt;&gt;
&gt; &gt;&gt; execute();
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; thanks,
&gt; &gt;&gt;
&gt; &gt;&gt; Oved.
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt;
