---
title: "How to model this data layout in Riak?"
description: ""
project: community
lastmod: 2010-04-23T10:18:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00146"
mailinglist_parent_id: "msg00144"
author_name: "Mark Jones"
project_section: "mailinglistitem"
sent_date: 2010-04-23T10:18:46-07:00
---


If I wanted to build an e-mail system for millions of users, how would I go 
about doing it in Riak?

Let's say each e-mail has the following characteristics, to, sender, header, 
body, when, attachments. Every user is identified by a userid, and to is not 
necessarily the same thing as userid.

In addition to the above characteristics, the user would be allowed to place 
tags and flags on various e-mails in a user interface.

In Cassandra could model this in two ways, one using super columns, which I've 
been advised against, and another using the order preserving partitioner where 
the key is made up something like: userid:convoid:when. Then I can get a 
range to bring all of those messages up at one time.

The idea of a convoid is similar to gmails conversation grouping of emails.

With distributed key structure of riak, I'm not sure how to pull this off. 
Since the keys are all consistently hashed, the users information never be 
adjacent to each other and pulling up a group of messages will result in lots 
of seeks.

-----Original Message-----
From: riak-users-boun...@lists.basho.com 
[mailto:riak-users-boun...@lists.basho.com] On Behalf Of Matthew Pflueger
Sent: Friday, April 23, 2010 11:19 AM
To: Ryan Tilder
Cc: riak-users@lists.basho.com
Subject: Re: Building rel on Debian 2.6.26

Cloning the riak repo and building worked fine. However, not being
able to build from the tarball is a little disconcerting...
--Matthew

On Fri, Apr 23, 2010 at 12:13, Matthew Pflueger
 wrote:
&gt; Thanks for the tip. Unfortunately, disabling doesn't seem to work...
&gt; I disabled it in my ~/.hgrc and in ebloom's .hg/hgrc to no avail. I
&gt; downloaded riak-0.10.tar.gz and installed so no .hg directory. Any
&gt; other suggestions?
&gt;
&gt; --Matthew
&gt;
&gt;
&gt;
&gt; On Fri, Apr 23, 2010 at 11:56, Ryan Tilder  wrote:
&gt;&gt; Sounds like you have Mercurial's inotify extension enabled. hg showconfig
&gt;&gt; should show it. Workaround for now would be to following the directions in
&gt;&gt; the below link for disabling the extension in the riak repo. In
&gt;&gt; riak/.hg/hgrc:
&gt;&gt; [extensions]
&gt;&gt; inotify = !
&gt;&gt; http://mercurial.selenic.com/wiki/UsingExtensions#Enabling\\_an\\_extension
&gt;&gt;
&gt;&gt; --Ryan
&gt;&gt;
&gt;&gt; On Fri, Apr 23, 2010 at 8:48 AM, Matthew Pflueger
&gt;&gt;  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; I downloaded built Erlang successfully (minus jinterface, odbc, and
&gt;&gt;&gt; wx) then downloaded riak-0.10. I did a make all and everything built
&gt;&gt;&gt; fine but then doing a make rel I get the following:
&gt;&gt;&gt;
&gt;&gt;&gt; ==&gt; rel (generate)
&gt;&gt;&gt; ERROR: Unable to generate spec: read file info
&gt;&gt;&gt; /home/mpflueger/riak/rel/../deps/ebloom/.hg/inotify.sock failed
&gt;&gt;&gt;
&gt;&gt;&gt; Has anybody else run into this? Could this be related to my mercurial
&gt;&gt;&gt; install (I'm using 1.51 downloaded and installed normally using
&gt;&gt;&gt; python2.5).
&gt;&gt;&gt;
&gt;&gt;&gt; --Matthew
&gt;&gt;&gt;

&gt;&gt;
&gt;&gt;
&gt;

