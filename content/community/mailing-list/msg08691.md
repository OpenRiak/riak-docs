---
title: "Re: [MapReduce] in state wait_for_input terminated with reason:	processing_error"
description: ""
project: community
lastmod: 2012-09-25T04:58:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08691"
mailinglist_parent_id: "msg08690"
author_name: "Kresten Krab Thorup"
project_section: "mailinglistitem"
sent_date: 2012-09-25T04:58:18-07:00
---


Deleted objects may show up as objects with the special meta-data property 
X-Riak-Deleted set, and an empty contents. So, in your map function 
trend\\_riak:get\\_map\\_bucket\\_values you need to check

 riak\\_kv\\_util:is\\_x\\_deleted(Obj)

(Which is a utility function that checks for that property), and in that case 
just return the empty list from your map function.

Kresten
Trifork

On Sep 25, 2012, at 1:19 PM, 郎咸武  wrote:

&gt; Hi guys, I need yours help.
&gt; I using mapreduce in my server. I only query from riak, that is ok. But 
&gt; first delete some data,after query is error in the follow.
&gt; 
&gt; My environment:
&gt; Linux jason-lxw 3.2.0-30-generic #48-Ubuntu SMP Fri Aug 24 16:52:48 UTC 2012 
&gt; x86\\_64 x86\\_64 x86\\_64 GNU/Linux
&gt; Erlang R14B04
&gt; riak-1.2
&gt; riak-erlang-1.2
&gt; 
&gt; Thanks in advance.
&gt; Jason
&gt; 
&gt; My server error message:
&gt; =ERROR REPORT==== 25-Sep-2012::18:30:48 ===
&gt; E(&lt;0.411.0&gt;:mod\\_pubsub\\_riak:3168) : In mod\\_pubsub\\_riak:get\\_newsfeed 3168 
&gt; Erro={error,
&gt; 
&gt; {0,
&gt; 
&gt; 
&gt; &lt;&lt;"{\\"phase\\":0,\\"error\\":\\"badarg\\",\\"input\\":\\"{ok,{r\\_object,&lt;&lt;\\\\\\"itrends/ejabberd/pubsub\\_item\\\\\\"&gt;&gt;,&lt;&lt;131,104,2,107,0,13,53,52,52,56,56,48,70,56,66,52,54,53,48,97,5&gt;&gt;,[{r\\_content,{dict,4,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;\\\\\\"X-Riak-VTag\\\\\\"&gt;&gt;,51,100,111,68,108,85,106,107,48,88,110,120,51,79,106,56,71,68,97,87,74,54]],[[&lt;&lt;\\\\\\"index\\\\\\"&gt;&gt;]],[[&lt;&lt;\\\\\\"X-Riak-Deleted\\\\\\"&gt;&gt;,116,114,117,101]],[[&lt;&lt;\\\\\\"X-Riak-Last-Modified\\\\\\"&gt;&gt;|{1348,569048,516672}]],[],[]}}},&lt;&lt;&gt;&gt;}],[{&lt;&lt;35,9,254,249,80,93,197,65&gt;&gt;,{2,63515788248}}],...},...}\\",\\"type\\":\\"error\\",\\"stack\\":\\"[{erlang,binary\\_to\\_term,[&lt;&lt;&gt;&gt;]},{trend\\_riak,get\\_map\\_bucket\\_values,3},{riak\\_kv\\_mrc\\_map,map,3},{riak\\_kv\\_mrc\\_map,process,3},{riak\\_pipe\\_vnode\\_worker,process\\_input,3},{riak\\_pipe\\_vnode\\_worker,wait\\_for\\_input,2},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]\\"}"&gt;&gt;}}
&gt; 
&gt; 
&gt; 
&gt; Riak error in the console:
&gt; 
&gt; undefined}, Nodes=["jason1"], CategoryList=[]
&gt; 16:24:01.346 [error] gen\\_fsm &lt;0.2681.0&gt; in state wait\\_for\\_input terminated 
&gt; with reason: processing\\_error
&gt; 16:24:01.346 [error] Pipe worker startup failed:
&gt; 
&gt; exit:{shutdown,{gen\\_fsm,sync\\_send\\_event,[&lt;0.2654.0&gt;,{get\\_details,#Ref&lt;0.0.0.8144&gt;,456719261665907161938651510223838443642478919680,&lt;0.327.0&gt;}]}}
&gt; 
&gt; [{gen\\_fsm,sync\\_send\\_event,2},{riak\\_pipe\\_fitting,get\\_details,2},{riak\\_pipe\\_vnode,new\\_worker,2},{riak\\_pipe\\_vnode,enqueue\\_internal,3},{riak\\_core\\_vnode,vnode\\_command,3},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]
&gt; 16:24:01.346 [error] Pipe worker startup failed:
&gt; 
&gt; exit:{shutdown,{gen\\_fsm,sync\\_send\\_event,[&lt;0.2654.0&gt;,{get\\_details,#Ref&lt;0.0.0.8144&gt;,799258707915337533392640142891717276374338109440,&lt;0.357.0&gt;}]}}
&gt; 
&gt; [{gen\\_fsm,sync\\_send\\_event,2},{riak\\_pipe\\_fitting,get\\_details,2},{riak\\_pipe\\_vnode,new\\_worker,2},{riak\\_pipe\\_vnode,enqueue\\_internal,3},{riak\\_core\\_vnode,vnode\\_command,3},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]
&gt; 16:24:01.347 [error] Pipe worker startup failed:fitting was gone before 
&gt; startup
&gt; 16:24:01.348 [error] Pipe worker startup failed:fitting was gone before 
&gt; startup
&gt; 16:24:01.389 [error] CRASH REPORT Process &lt;0.2681.0&gt; with 0 neighbours exited 
&gt; with reason: processing\\_error in gen\\_fsm:terminate/7
&gt; 16:24:01.408 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.8144&gt;,{kvget\\_map,0},{trace,[error],{vnode,{fitting\\_died,707914855582156101004909840846949587645842325504}}}}
&gt; 16:24:01.545 [error] Supervisor riak\\_pipe\\_vnode\\_worker\\_sup had child 
&gt; undefined started with {riak\\_pipe\\_vnode\\_worker,start\\_link,undefined} at 
&gt; &lt;0.2681.0&gt; exit with reason processing\\_error in context child\\_terminated
&gt; 16:24:01.567 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.8144&gt;,{kvget\\_map,0},{trace,[error],{vnode,{fitting\\_died,411047335499316445744786359201454599278231027712}}}}
&gt; 16:24:01.622 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.8144&gt;,{kvget\\_map,0},{trace,[error],{vnode,{fitting\\_died,22835963083295358096932575511191922182123945984}}}}
&gt; 16:24:01.645 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.8144&gt;,{kvget\\_map,0},{trace,[error],{vnode,{fitting\\_died,0}}}}
&gt; 16:24:01.667 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.8144&gt;,{kvget\\_map,0},{trace,[error],{vnode,{fitting\\_died,1392993748081016843912887106182707253109560705024}}}}
&gt; 16:24:01.729 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.8144&gt;,listkeys,{trace,[error],{vnode,{fitting\\_died,707914855582156101004909840846949587645842325504}}}}
&gt; 
&gt; 
&gt; 
&gt; get\\_map\\_bucket\\_values {} Record=rRecord, Nodes=["jason1"], CategoryList=[]
&gt; get\\_map\\_bucket\\_values {} Record=r1Record, Nodes=["jason1"], CategoryList=[]
&gt; 18:30:48.630 [error] gen\\_fsm &lt;0.9097.0&gt; in state wait\\_for\\_input terminated 
&gt; with reason: processing\\_error
&gt; 18:30:48.661 [error] CRASH REPORT Process &lt;0.9097.0&gt; with 0 neighbours exited 
&gt; with reason: processing\\_error in gen\\_fsm:terminate/7
&gt; 18:30:48.690 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,22835963083295358096932575511191922182123945984}}}}
&gt; 18:30:48.717 [error] Supervisor riak\\_pipe\\_vnode\\_worker\\_sup had child 
&gt; undefined started with {riak\\_pipe\\_vnode\\_worker,start\\_link,undefined} at 
&gt; &lt;0.9097.0&gt; exit with reason processing\\_error in context child\\_terminated
&gt; 18:30:48.750 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,936274486415109681974235595958868809467081785344}}}}
&gt; 18:30:48.772 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,1392993748081016843912887106182707253109560705024}}}}
&gt; 18:30:48.794 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,1255977969581244695331291653115555720016817029120}}}}
&gt; 18:30:48.817 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,616571003248974668617179538802181898917346541568}}}}
&gt; 18:30:48.828 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,0}}}}
&gt; 18:30:48.839 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,411047335499316445744786359201454599278231027712}}}}
&gt; 18:30:48.850 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,799258707915337533392640142891717276374338109440}}}}
&gt; 18:30:48.872 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,685078892498860742907977265335757665463718379520}}}}
&gt; 18:30:48.986 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,1187470080331358621040493926581979953470445191168}}}}
&gt; 18:30:49.006 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,707914855582156101004909840846949587645842325504}}}}
&gt; 18:30:49.039 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,{xform\\_map,0},{trace,[error],{vnode,{fitting\\_died,662242929415565384811044689824565743281594433536}}}}
&gt; 18:30:49.072 [error] Unrecognized message 
&gt; {pipe\\_log,#Ref&lt;0.0.0.63402&gt;,1,{trace,[error],{vnode,{fitting\\_died,45671926166590716193865151022383844364247891968}}}}
&gt; 
&gt; -- 
&gt; 只为成功找方法，不为失败找理由
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com



Mobile: + 45 2343 4626 | Skype: krestenkrabthorup | Twitter: @drkrab
Trifork A/S | Margrethepladsen 4 | DK- 8000 Aarhus C | Phone : +45 8732 
8787 | www.trifork.com
 



\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

