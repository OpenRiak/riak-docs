---
title: "Re: Curb performance when doing a PUT ( ripple 0.8.1 )"
description: ""
project: community
lastmod: 2010-10-21T05:21:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01345"
mailinglist_parent_id: "msg01338"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-10-21T05:21:17-07:00
---


David,

Sorry for the late reply. When the verbose output from curl is being printed, 
does it pause for a long time between "Expect: 100-continue" and the response?

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Oct 20, 2010, at 12:07 PM, David Dawson wrote:

&gt; Sean, 
&gt; 
&gt; Here is the info you requested
&gt; 
&gt; 1. ruby 1.9.2-p0
&gt; 
&gt; 2. There is nothing between the Ruby app and RIAK
&gt; 
&gt; 3. Here is the output
&gt; 
&gt; ruby-1.9.2-p0 &gt; c.save!
&gt; \\* Re-using existing connection! (#0) with host 127.0.0.1
&gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8098 (#0)
&gt; &gt; PUT /riak/organisations/itv?returnbody=true HTTP/1.1
&gt; Host: 127.0.0.1:8098
&gt; Accept: multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5
&gt; X-Riak-Clientid: Z9ni5A==
&gt; Content-Type: application/json
&gt; X-Riak-Vclock: 
&gt; a85hYGAQzGDKBVIs/xeH22YwJTLlsTK4pBgf44MIszUnsYu+fwqUYARKNKbCJVh07R/kAoWZgcIZaQjh9bWSslDV8zKRjWF0mWONVYJlHvspqER2FsIg7uN3NkDN/4gkvFujQg+q2jMbxZjsK1aYEiy3p4rwQYVrUdQzejitxyrB+p75JlSCNw9hkH+oTQY0fHq6kdUz810Khqqf04dQr3H8SADU/cjC6TcfPYGqPt+HbAzbG35pZIksAA==
&gt; Content-Length: 829
&gt; Expect: 100-continue
&gt; 
&gt; \\* Done waiting for 100-continue
&gt; &lt; HTTP/1.1 100 Continue
&gt; &lt; HTTP/1.1 200 OK
&gt; &lt; X-Riak-Vclock: 
&gt; a85hYGAQzGDKBVIs/xeH22YwJTLlsTK4pBgf44MIszUnsYu+fwqUYARKNKbCJVh07R/kAoWZgcIZacjqGV3mWEPVz8tEqF9fKymLKQxUzzKP/RRUIjsLoZ77+J0NUPM/ZqGoz75iBVXvmY1Qv1ujQg9TGOQeD6f1UIlaJPW3p4rwYQoD1bO+Z74JleDNQ6j3D7XJgIZPTzdCWOP4kQCoM+f0IRvDzHcpGGoMqgTbG35pqMR5hARL+s1HT6Dmi/YDhbMA
&gt; &lt; Vary: Accept-Encoding
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.7.2 (participate in the frantic)
&gt; &lt; Link: ; rel="up"
&gt; &lt; Date: Wed, 20 Oct 2010 16:04:37 GMT
&gt; &lt; Content-Type: application/json
&gt; &lt; Content-Length: 829
&gt; &lt; X-Charles-Received-Continue: HTTP/1.1 100 Continue
&gt; &lt; Connection: Keep-alive
&gt; &lt; 
&gt; \\* Expire cleared
&gt; \\* Connection #0 to host 127.0.0.1 left intact
&gt; /Users/ddawson/git/falcon\\_modules/rel/falcon\\_modules/modules/common/lib/falcon/document\\_extensions.rb:210:
&gt; warning: already initialized constant OrganisationIndex
&gt; \\* Re-using existing connection! (#0) with host 127.0.0.1
&gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8098 (#0)
&gt; &gt; GET /riak/organisations/index HTTP/1.1
&gt; Host: 127.0.0.1:8098
&gt; Accept: multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5
&gt; X-Riak-Clientid: Z9ni5A==
&gt; 
&gt; &lt; HTTP/1.1 200 OK
&gt; &lt; X-Riak-Vclock: 
&gt; a85hYGBgzmDKBVIs/qE2GRlMicx5rAw93cbH+KDCGsePBACFGYHCc/oQwuk3Hz2BCl8ACWcBAA==
&gt; &lt; Vary: Accept-Encoding
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.7.2 (participate in the frantic)
&gt; &lt; Link: ; riaktag="documents", 
&gt; ; rel="up"
&gt; &lt; Last-Modified: Wed, 20 Oct 2010 16:03:28 GMT
&gt; &lt; ETag: 6cT6EKb6ruH0hUfc7J6xW0
&gt; &lt; Date: Wed, 20 Oct 2010 16:04:37 GMT
&gt; &lt; Content-Type: application/json
&gt; &lt; Content-Length: 43
&gt; &lt; Connection: Keep-alive
&gt; &lt; 
&gt; \\* Expire cleared
&gt; \\* Connection #0 to host 127.0.0.1 left intact
&gt; \\* Re-using existing connection! (#0) with host 127.0.0.1
&gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8098 (#0)
&gt; &gt; PUT /riak/organisations/index?returnbody=true HTTP/1.1
&gt; Host: 127.0.0.1:8098
&gt; Accept: multipart/mixed, application/json;q=0.7, \\*/\\*;q=0.5
&gt; X-Riak-Clientid: Z9ni5A==
&gt; Content-Type: application/json
&gt; X-Riak-Vclock: 
&gt; a85hYGBgzmDKBVIs/qE2GRlMicx5rAw93cbH+KDCGsePBACFGYHCc/oQwuk3Hz2BCl8ACWcBAA==
&gt; Link: ; riaktag="documents"
&gt; Content-Length: 43
&gt; Expect: 100-continue
&gt; 
&gt; \\* Done waiting for 100-continue
&gt; &lt; HTTP/1.1 100 Continue
&gt; &lt; HTTP/1.1 200 OK
&gt; &lt; X-Riak-Vclock: 
&gt; a85hYGBgzmDKBVIs/qE2GRlMicx5rAw93cbH+KDCGsePBACFGYHCc/oQwuk3Hz0BCjMBhcX6gcJZAA==
&gt; &lt; Vary: Accept-Encoding
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.7.2 (participate in the frantic)
&gt; &lt; Link: ; riaktag="documents", 
&gt; ; rel="up"
&gt; &lt; Date: Wed, 20 Oct 2010 16:04:38 GMT
&gt; &lt; Content-Type: application/json
&gt; &lt; Content-Length: 43
&gt; &lt; X-Charles-Received-Continue: HTTP/1.1 100 Continue
&gt; &lt; Connection: Keep-alive
&gt; &lt; 
&gt; \\* Expire cleared
&gt; \\* Connection #0 to host 127.0.0.1 left intact
&gt; =&gt; # [application/json]:nil&gt; 
&gt; 
&gt; 
&gt; On 20 Oct 2010, at 16:53, Sean Cribbs wrote:
&gt; 
&gt;&gt; Dave,
&gt;&gt; 
&gt;&gt; A few questions:
&gt;&gt; 1) Which version of Ruby are you using?
&gt;&gt; 2) Do you have anything between your Ruby app and Riak (e.g. a load 
&gt;&gt; balancer, reverse proxy, etc)?
&gt;&gt; 3) Can you enable "verbose" mode on curl and paste the output? Here's how:
&gt;&gt; 
&gt;&gt; client.http.send(:curl).verbose = true
&gt;&gt; 
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt;&gt; On Oct 20, 2010, at 11:45 AM, David Dawson wrote:
&gt;&gt; 
&gt;&gt;&gt; I am currently doing some benchmarking with the current ripple library and 
&gt;&gt;&gt; have noticed that a 'PUT' ( on mac os x ) is taking over 1 sec when using 
&gt;&gt;&gt; the curb library!
&gt;&gt;&gt; 
&gt;&gt;&gt; If I force the riak-client to use net http instead then the same 'PUT' 
&gt;&gt;&gt; takes less than 20 ms
&gt;&gt;&gt; 
&gt;&gt;&gt; For now we are going to disable the curb library, although this is the 
&gt;&gt;&gt; library which is recommended for speed purposes?
&gt;&gt;&gt; 
&gt;&gt;&gt; BTW, we are using RIAK 0.13.0
&gt;&gt;&gt; 
&gt;&gt;&gt; Dave
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt; 

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

