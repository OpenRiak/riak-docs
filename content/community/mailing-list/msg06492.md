---
title: "Re: error: undef done()"
description: ""
project: community
lastmod: 2012-02-01T10:39:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06492"
mailinglist_parent_id: "msg06491"
author_name: "Matthew A. Brown"
project_section: "mailinglistitem"
sent_date: 2012-02-01T10:39:19-08:00
---


Hey Bryan,

That's awesome -- with the Riak 1.1 output figuring out the problem
would've been a snap. Thanks!

Mat

On Wed, Feb 1, 2012 at 13:36, Bryan Fink  wrote:
&gt; On Wed, Feb 1, 2012 at 11:43 AM, Matthew A. Brown  
&gt; wrote:
&gt;&gt; Thanks much for the info. We're running Riak 1.0.3. I think in our
&gt;&gt; case what would've made this easier to track down would have been not
&gt;&gt; having the error output cut off in the log -- since the inputs to the
&gt;&gt; reduce comprised a pretty large set, the output cut off before the
&gt;&gt; call trace, which appears after the dump of the inputs. It was pretty
&gt;&gt; easy to track down once I narrowed down the inputs to a manageable
&gt;&gt; size that still reproduced the error.
&gt;
&gt; Agreed - it's so hard to know how much context is useful, and how much
&gt; is too much.  However, I think you'll find that the upcoming Riak 1.1
&gt; release already does much better in this situation.
&gt;
&gt; I just created a small sample to reproduce what you found, where I
&gt; have a reduce function that calls bryan:does\\_not\\_exist/0, which is
&gt; undefined.  In 1.0.3, as you reported, you see no indication of error
&gt; in the return value, and useless spew on the error console like:
&gt;
&gt;    13:26:43.720 [error] error:undef done():
&gt;       [...so many inputs that the stack trace is omitted...
&gt;
&gt; In the upcoming 1.1 release, using the HTTP interface at /mapred, you
&gt; receive a JSON object like:
&gt;
&gt;    {"phase":0,
&gt;     
&gt; "error":"{undef,[{bryan,does\\_not\\_exist,[]},{riak\\_kv\\_w\\_reduce,reduce,3},{riak\\_kv\\_w\\_reduce,done,1},{riak\\_pipe\\_vnode\\_worker,wait\\_for\\_input,2},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]}"
&gt;     "inputs":...}
&gt;
&gt; As well as a much more informational message on the error console:
&gt;
&gt;    13:27:48.143 [error] gen\\_fsm &lt;0.1484.0&gt; in state wait\\_for\\_input
&gt; terminated with reason: call to undefined function
&gt; bryan:does\\_not\\_exist/0 from riak\\_kv\\_w\\_reduce:reduce/3
&gt;
&gt; Hope this helps,
&gt; Bryan

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

