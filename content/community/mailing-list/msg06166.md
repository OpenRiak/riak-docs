---
title: "Re: riak-erlang-client write, riak-java-client read problem"
description: ""
project: community
lastmod: 2012-01-07T09:29:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06166"
mailinglist_parent_id: "msg06165"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-01-07T09:29:24-08:00
---


Marcel,

 {ok,Pid} = riakc\\_pb\\_socket:start\\_link("127.0.0.1", 8087),
&gt; Tuple = "{\\"id\\",22}",
&gt;

That is not valid JSON, first of all.


&gt; Obj = riakc\\_obj:new("mm","1",Tuple),
&gt;

Make sure that you set the content type here, otherwise it won't be
detected on the Java side. (example below)


&gt; riakc\\_pb\\_socket:put(Pid,Obj),
&gt;
&gt; After then we try to read from risk-java-client:
&gt;
&gt; RiakClient httpClient = new RiakClient("http://10.10.10.61:8098/riak");
&gt; IRiakClient client = RiakFactory.httpClient(httpClient);
&gt; Bucket b = client.fetchBucket("mm").execute();
&gt; IRiakObject fetched = b.fetch("1").execute();
&gt; String decodedString = new String(fetched.getValue());
&gt; System.out.println(decodedString);
&gt;
&gt; I convert the Object to an HexString: 83 6B 00 05 7B 22 6E 22 7D
&gt;
&gt;
Decoding that byte array in Erlang gives:

1&gt; &lt;&lt;16#83,16#6B,0,5,16#7B,16#22,16#6E,16#22,16#7D&gt;&gt;.
&lt;&lt;131,107,0,5,123,34,110,34,125&gt;&gt;
2&gt; binary\\_to\\_term(v(1)).
"{\\"n\\"}"
3&gt;

The default behavior of the Erlang client is to serialize terms to binary
unless the content type is explicit and the value of the object is a
binary. Try this instead:

Value = mochijson2:encode({struct, [{id, 22}]}),
Obj = riakc\\_obj:new(&lt;&lt;"mm"&gt;&gt;,&lt;&lt;"1"&gt;&gt;,Value,"application/json"),
riakc\\_pb\\_socket:put(Pid, Obj)

Then re-read it from the Java side and you should get what you expect.

My question is:
&gt;
&gt; 1. What are the first 4 bytes ?
&gt;

A binary that starts with byte 131 is typically in Erlang
term\\_to\\_binary/binary\\_to\\_term format.


&gt; 2. how can i receive a string with out the 4 bytes ?
&gt;

See above.


&gt; 3. How can i convert the string into a JSON Object ?
&gt;
&gt;
See above, and then use Jackson to decode the value (I believe the Java
client may do this automatically for you).

-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

