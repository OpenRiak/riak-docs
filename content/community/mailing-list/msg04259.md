---
title: "Re: High volume data series storage and queries"
description: ""
project: community
lastmod: 2011-08-08T12:33:29-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04259"
mailinglist_parent_id: "msg04258"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-08-08T12:33:29-07:00
---


It sounds like a potentially interesting use case.

The questions that immediately enter my head are:
\\* How much data do you currently have? 
\\* How much data do you plan to have? 
\\* Do you have a data retention policy? If so, what is it? How do you plan to 
implement it?
\\* What's the anticipated rate of growth per day? Week? Year?
\\* What type of queries will you have? Is it a fixed set of queries? Is it a 
decision support system?
\\* What does your read to write ratio look like?

Your plan to support Riak with a hybrid system isn't that out of whack; it's 
very doable. 

You can certainly do the type of querying you've described through careful 
choice of key names, sorting in memory, and only using the first N data points 
in a given Map Reduce query result. The main reason to not perform range 
queries in Riak is that they'll result in full key space scans across the Riak 
cluster. If you're using bitcask as your backend then it's an in memory scan, 
otherwise you're doing a much more costly scan from disk. And, since key names 
are hashed as they are partitioned across the cluster, you're not going to get 
the benefit of sequential disk scan performance like you might get with a 
traditional database.

The only thing that worries me is the phrase "should grow more than what a 
'vanilla' RDBMS would support". Are you thinking 1TB? 10TB? 50TB? 500TB? I'm 
trying to get a handle on what size and performance characteristics you're 
looking for before diving into how to look at your system vs. saying "Hell if I 
know, does someone else on the list have a good idea?"

---
Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
Microsoft SQL Server MVP

On Aug 8, 2011, at 11:21 AM, Paul O wrote:

&gt; Hello Riak enthusiasts,
&gt; 
&gt; I am trying to design a solution for storing time series data coming from a 
&gt; very large number of potential high-frequency sources.
&gt; 
&gt; I thought Riak could be of help, though based on what I read about it I can't 
&gt; use it without some other layer on top of it.
&gt; 
&gt; The problem is I need to be able to do range queries over this data, by the 
&gt; source. Hence, I want to be able to say "give me the N first data points for 
&gt; source S between time T1 and time T2."
&gt; 
&gt; I need to store this data for a rather long time, and the expected volume 
&gt; should grow more than what a "vanilla" RDBMS would support.
&gt; 
&gt; Another thing to note is that I can restrict the number of data points to be 
&gt; returned by a query, so no query would return more than MaxN data points.
&gt; 
&gt; I thought about doing this the following way:
&gt; 
&gt; 1. bundle date time series in batches of MaxN, to ensure that any query would 
&gt; require reading at most two batches. The batches would be store inside Riak.
&gt; 2. Store the start-time, end-time, size and Riak batch ID in a MySQL (or 
&gt; PostgreSQL) DB.
&gt; 
&gt; My thinking is such a strategy would allow me to persist data in Riak and 
&gt; linearly grow with the data, and the index would be kept in a RDBM for fast 
&gt; range queries.
&gt; 
&gt; Does it sound sensible to use Riak this way? Does this make you 
&gt; laugh/cry/shake your head in disbelief? Am I overlooking something from Riak 
&gt; which would make all this much better?
&gt; 
&gt; Thanks and best regards,
&gt; 
&gt; Paul
