---
title: "Corruption of leveldb database files"
description: ""
project: community
lastmod: 2012-01-16T08:50:21-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06289"
author_name: "Thomas Bakketun"
project_section: "mailinglistitem"
sent_date: 2012-01-16T08:50:21-08:00
---


Hello,

We have found a bug in leveldb that causes corruption of the CURRENT
file of leveldb databases. A bug report has been filed:
http://code.google.com/p/leveldb/issues/detail?id=68

This bug can easily be reproduced by restarting restarting Riak and
force of the computer within 30 to 60 seconds. After reboot at least one
corrupt leveldb database can be expected. When this happens Riak fails
to start and logs this message:

Failed to start riak\\_kv\\_eleveldb\\_backend Reason: {db\\_open,"Corruption:
CURRENT file does not end with newline"}

Switching on the sync flag for leveldb has no effect.

-- 
Thomas Bakketun, Senior software developer
T. +47 21 53 69 40
Copyleft Solutions
www.copyleftsolutions.com
