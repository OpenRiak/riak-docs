---
title: "Re: Nodes not leaving in Riak 0.14.2"
description: ""
project: community
lastmod: 2012-04-04T10:46:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07135"
mailinglist_parent_id: "msg07130"
author_name: "Samuel Elliott"
project_section: "mailinglistitem"
sent_date: 2012-04-04T10:46:48-07:00
---


Hi Anthony,

1) Which version of riak are you running? I think there are more
messages in the mailing list about people who have had nodes get stuck
leaving (it's worth also searching for "handoff" as that's the part of
the vnode lifecycle which is the important one in a node leaving
manoeuvre).

2) I think to play it safe, it's probably best to have the nodes leave
one by one. I don't know exactly how riak keeps track of network
partitions, but I could imagine it seeing 3 nodes dropping off as some
kind of network partition rather than those 3 nodes wanting to leave.

Hopefully this will get the ball rolling with getting your issue fixed.

Sam

On Wed, Apr 4, 2012 at 8:02 AM, Anthony Molinaro
 wrote:
&gt; Ping
&gt;
&gt; On Mon, Apr 02, 2012 at 06:28:00PM -0700, Anthony Molinaro wrote:
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt;   So I found one of my riak clusters misbehaving and found out it was
&gt;&gt; running on some inferior hardware.  After getting some new machines from
&gt;&gt; my ops group.  I went ahead and added several nodes.  Everything went
&gt;&gt; relatively smoothly until I tried to have the old nodes leave the ring.
&gt;&gt;
&gt;&gt; I need to remove 4 nodes, and I assumed since I had been successful
&gt;&gt; adding a few nodes at once, I would also be able to have multiple nodes
&gt;&gt; leave.
&gt;&gt;
&gt;&gt; Unfortunately, that does not appear to be the case.  One node (the first
&gt;&gt; removed) completely left, the others did not.  Then no matter how many
&gt;&gt; times I did a 'riak-admin leave' they would not leave.  I re-added the
&gt;&gt; one that had left successfully to see if a ring change would unstick
&gt;&gt; something.  It does appear to, as even with all the original nodes back
&gt;&gt; the 3 I attempted to have leave are still not leaving.
&gt;&gt;
&gt;&gt; I'm going through now and just doing a rolling restart hoping that
&gt;&gt; might fix things, but I'm thinking I might be stuck.
&gt;&gt;
&gt;&gt; Is there anyway to remove these nodes?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt;
&gt;&gt; -Anthony
&gt;&gt;
&gt;&gt; --
&gt;&gt; ------------------------------------------------------------------------
&gt;&gt; Anthony Molinaro                           
&gt;
&gt; --
&gt; ------------------------------------------------------------------------
&gt; Anthony Molinaro                           
&gt;

-- 
Samuel Elliott
s...@lenary.co.uk
http://lenary.co.uk/
+44 (0)7891 993 664

