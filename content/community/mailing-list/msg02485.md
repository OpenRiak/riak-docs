---
title: "Re: tuning riak for 100s of concurrent connections"
description: ""
project: community
lastmod: 2011-02-26T01:24:47-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02485"
author_name: "Nico Meyer"
project_section: "mailinglistitem"
sent_date: 2011-02-26T01:24:47-08:00
---


HTTP, I basically just did ab -c 10/20/100 -n 50000 http://.../riak/...
from a seperate machine.

Am Freitag, den 25.02.2011, 14:59 -0500 schrieb Wilson MacGyver:
&gt; was this over http GET or protocol buffer?
&gt; 
&gt; idid you per chance run the test using apachebench also?
&gt; 
&gt; On Fri, Feb 25, 2011 at 2:43 PM, Nico Meyer  wrote:
&gt; &gt; Just out of curiosity I did some tests myself on one of our production
&gt; &gt; machines. We normally only use the ProtocolBuffers interface and a
&gt; &gt; thrift interface that we wrote ourselves.
&gt; &gt;
&gt; &gt; If I fetch a small key (~250 bytes), the riak server becomes CPU bound
&gt; &gt; with about 20 concurrent requests, at which point the latency naturally
&gt; &gt; becomes larger. At this point one riak server is handling over 6000
&gt; &gt; requests/s. This is on an 8 core system (Dual Intel Xeon E5506
&gt; &gt; @2.13GHz), and all cores are at nearly 100%. No tuning was done on
&gt; &gt; either riak or the OS.
&gt; &gt;
&gt; &gt; Also 99% of the requests still took less then 20ms, while with 10
&gt; &gt; concurrent requests its more like 2ms.
&gt; &gt;
&gt; &gt;
&gt; &gt; Am Freitag, den 25.02.2011, 13:54 -0500 schrieb Wilson MacGyver:
&gt; &gt;&gt; SO\\_REUSEADDR is also something you set at the socket API as I recall.
&gt; &gt;&gt; So I don't think it's something you can just set on the TCP/IP itself
&gt; &gt;&gt; as a global setting.
&gt; &gt;&gt;
&gt; &gt;&gt; On Fri, Feb 25, 2011 at 1:41 PM, Les Mikesell  
&gt; &gt;&gt; wrote:
&gt; &gt;&gt; &gt; Those settings shouldn't make a big difference in how the number of
&gt; &gt;&gt; &gt; connections scale up, though. There is a theoretical maximum rate limit 
&gt; &gt;&gt; &gt; for
&gt; &gt;&gt; &gt; creating new connections as each socket is supposed to sit in TIME\\_WAIT 
&gt; &gt;&gt; &gt; for
&gt; &gt;&gt; &gt; a packet round-trip time to ensure that nothing outstanding will collide
&gt; &gt;&gt; &gt; with that socket number when it is reused for the same IP address. Maybe
&gt; &gt;&gt; &gt; your test is hitting that limit. Can you set SO\\_REUSEADDR?
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; 
&gt; 
&gt; 

