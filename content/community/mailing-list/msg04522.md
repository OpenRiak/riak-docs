---
title: "Re: Speed of linkwalking"
description: ""
project: community
lastmod: 2011-08-30T12:06:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04522"
mailinglist_parent_id: "msg04521"
author_name: "Mark Steele"
project_section: "mailinglistitem"
sent_date: 2011-08-30T12:06:36-07:00
---


I'm actually testing with an object that has only one link as that's my
use-case.

In testing, 2 separate gets is way faster than using a map-reduce link-walk,
which is disappointing :(

I'm also testing on a one node cluster, and my bucket has a N/R/W=1. I was
thinking that the reduction in network hops would outweigh the map reduce
overhead, but apparently that's not the case.

Simple get (one value) : 0.000741
Multiget linkwalk (get one object, then link walk in php) : 0.001567
Linkwalk (map reduce): 0.041994

The map phase does not significantly change anything as far as performance.

In case it matters, I'm testing against the latest riak code on github.

Cheers,

Mark Steele
Bering Media Inc.

On Tue, Aug 30, 2011 at 3:00 PM, Jonathan Langevin &lt;
jlange...@loomlearning.com&gt; wrote:

&gt; Good catch Kev.
&gt;
&gt; Mark, If you run the same operation with map removed, what is the
&gt; performance at that point?\\*
&gt;
&gt; 
&gt; Jonathan Langevin
&gt; Systems Administrator
&gt; Loom Inc.
&gt; Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
&gt; www.loomlearning.com - Skype: intel352
&gt; \\*
&gt;
&gt;
&gt;
&gt; On Tue, Aug 30, 2011 at 2:45 PM, Kev Burns  wrote:
&gt;
&gt;&gt; Mark,
&gt;&gt;
&gt;&gt; That's not just a link walk, you're also performing a map operation there.
&gt;&gt;
&gt;&gt; $client-&gt;add($bucketname, 'linkkey1')-&gt;
&gt;&gt; link()-&gt;
&gt;&gt; map(array("riak\\_kv\\_mapreduce", "map\\_object\\_value")) -&gt;
&gt;&gt; run();
&gt;&gt;
&gt;&gt;
&gt;&gt; If the expected number of returned objects is small, performing the map
&gt;&gt; phase in PHP may be faster.
&gt;&gt;
&gt;&gt; - Kev
&gt;&gt; c: +001 (650) 521-7791
&gt;&gt;
&gt;&gt;
&gt;&gt; On Tue, Aug 30, 2011 at 7:31 AM, Mark Steele wrote:
&gt;&gt;
&gt;&gt;&gt; Hi folks,
&gt;&gt;&gt;
&gt;&gt;&gt; Just want to know if I'm doing something obviously dumb here.
&gt;&gt;&gt;
&gt;&gt;&gt; First the (PHP) code (Sorry of the API is different from the official
&gt;&gt;&gt; API, we're using a heavily modified version):
&gt;&gt;&gt;
&gt;&gt;&gt; 
&gt;&gt;&gt; $obj1 = $bucket-&gt;newObject('linkkey1', array('link1'));
&gt;&gt;&gt; $obj2 = $bucket-&gt;newObject('linkkey2', 'dataforlinkkey2');
&gt;&gt;&gt; $obj1-&gt;addLink($obj2);
&gt;&gt;&gt; $obj2-&gt;addLink($obj1);
&gt;&gt;&gt; $obj1-&gt;store();
&gt;&gt;&gt; $obj2-&gt;store();
&gt;&gt;&gt;
&gt;&gt;&gt; $start = microtime(true);
&gt;&gt;&gt; $blargh = $bucket-&gt;get('linkkey2');
&gt;&gt;&gt; $end = microtime(true);
&gt;&gt;&gt; printf("Took : %04f\\n",$end - $start);
&gt;&gt;&gt;
&gt;&gt;&gt; $start = microtime(true);
&gt;&gt;&gt; $result =
&gt;&gt;&gt; $client-&gt;add($bucketname, 'linkkey1')-&gt;
&gt;&gt;&gt; link()-&gt;
&gt;&gt;&gt; map(array("riak\\_kv\\_mapreduce", "map\\_object\\_value")) -&gt;
&gt;&gt;&gt; run();
&gt;&gt;&gt; foreach ($result as $data) {
&gt;&gt;&gt; //var\\_dump($data);
&gt;&gt;&gt; }
&gt;&gt;&gt; $end = microtime(true);
&gt;&gt;&gt; printf("Took : %04f\\n",$end - $start);
&gt;&gt;&gt; 
&gt;&gt;&gt;
&gt;&gt;&gt; So here's what I'm seeing:
&gt;&gt;&gt;
&gt;&gt;&gt; The simple key fetch takes 0.000661 seconds to execute, whereas the
&gt;&gt;&gt; link-walk takes 0.042043. Ouch. Quite a bit slower. Any ways to speed
&gt;&gt;&gt; this up?
&gt;&gt;&gt;
&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;
&gt;&gt;&gt; Mark Steele
&gt;&gt;&gt; Bering Media Inc.
&gt;&gt;&gt;
&gt;&gt;&gt;

&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;
