---
title: "Re: riakkit, a python riak object mapper, has hit beta!"
description: ""
project: community
lastmod: 2012-03-01T20:41:13-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06837"
mailinglist_parent_id: "msg06836"
author_name: "Andrey V. Martyanov"
project_section: "mailinglistitem"
sent_date: 2012-03-01T20:41:13-08:00
---


Riakkit in its current implementation has a lot of overhead. But what I
get for this price? Almost nothing. Only field validation make sense.
Simple key-value mapping is about 50-70 lines of code, not a big deal, even
for small project. Riak used mostly in web-based projects. Almost all
modern projects use JSON. The simple workflow is get JSON from the client,
validate, store in the database, query the database, send JSON to the
client. If our mapper doesn't understand the JSON and cannot operate on it
then it's not useful. We can use jsonpickle with a lot more profit. Just
jsonpickle.encode the object and store it in Riak. I'm sorry, this is my
position!

Best regards,
Andrey Martyanov

On Fri, Mar 2, 2012 at 9:01 AM, Andrey V. Martyanov wrote:

&gt; I'm just saying that to efficiently store and get the data user should
&gt; have ability to customize the relationship. Riak has several options to get
&gt; related data: secondary indexes, map-reduce etc. I think that the most
&gt; important task of mapper is to validate the data and to track these
&gt; dependencies. When you have enough meta information about objects storing
&gt; these objects is not a big problem.
&gt;
&gt;
&gt; On Fri, Mar 2, 2012 at 8:39 AM, Shuhao Wu  wrote:
&gt;
&gt;&gt; The thing about riak-python-client is that it's already pretty high
&gt;&gt; level, but not high level enough to be that simple.
&gt;&gt;
&gt;&gt; From what I understand, tracking relationship between models will still
&gt;&gt; involve a certain level of magic. Right now the magic is that when you save
&gt;&gt; any document, all the related document will be saved into the database as
&gt;&gt; well. You're saying that just tracking those relationship change is good
&gt;&gt; enough and saving will be up to the user?
&gt;&gt;
&gt;&gt; Shuhao
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Mar 1, 2012 at 10:20 PM, Andrey V. Martyanov 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; I'm not sure about forking the riak-python-client. The the whole idea of
&gt;&gt;&gt; separation the low-level client library from the high-level mapper and the
&gt;&gt;&gt; like is quite good. Some sort of SQLAlchemy does.
&gt;&gt;&gt;
&gt;&gt;&gt; Best regards,
&gt;&gt;&gt; Andrey Martyanov
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Mar 2, 2012 at 8:15 AM, Shuhao Wu  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Another thing I was considering is forking riak-python-client. Some of
&gt;&gt;&gt;&gt; the stuff in there could use some fixing as well, and maybe just take out
&gt;&gt;&gt;&gt; the core transports and such and plug that right into riakkit and skip the
&gt;&gt;&gt;&gt; notion of RiakObject all together as those API is also somewhat weird.
&gt;&gt;&gt;&gt; (such as add\\_link and remove\\_link)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Shuhao
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Mar 1, 2012 at 10:02 PM, Shuhao Wu  wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hi!
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; First off, the code is \\*LGPL\\* licensed, not GPL. So you're free to
&gt;&gt;&gt;&gt;&gt; put this into any code you want, it's just that when you want to modify
&gt;&gt;&gt;&gt;&gt; riakkit, you have to release your modified version.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I just went over your idea and it would be a valid solution to some of
&gt;&gt;&gt;&gt;&gt; the problems I'm having right now with my own projects with riakkit. When 
&gt;&gt;&gt;&gt;&gt; I
&gt;&gt;&gt;&gt;&gt; initially started writing riakkit, I needed something to do RAD with, 
&gt;&gt;&gt;&gt;&gt; which
&gt;&gt;&gt;&gt;&gt; would make sense to have an all-in-one, very simple to use framework,
&gt;&gt;&gt;&gt;&gt; rather than working with serialization and what not. However, now I'm
&gt;&gt;&gt;&gt;&gt; beginning to see problems in this approach when it comes to scalability as
&gt;&gt;&gt;&gt;&gt; I'm slowing moving out of the RAD phase. I haven't done anything as I have
&gt;&gt;&gt;&gt;&gt; not encountered any major issues yet (though I probably will).
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; So here's what I'm thinking for the next branch ( I still have to
&gt;&gt;&gt;&gt;&gt; maintain the master branch due to some code i've written and need ): I'm
&gt;&gt;&gt;&gt;&gt; going to break riakkit into 2 pieces. The first piece is the underlying
&gt;&gt;&gt;&gt;&gt; piece, which will do what you said, serialize/deserialize objects,
&gt;&gt;&gt;&gt;&gt; validation, track relationships and what not, however, it doesn't load it
&gt;&gt;&gt;&gt;&gt; those references up nor does it try to accomplish everything all in one
&gt;&gt;&gt;&gt;&gt; shot, and a RAD layer that's compatible with the current API that will
&gt;&gt;&gt;&gt;&gt; allow RAD to work with it, but still reserve the flexibility of having 
&gt;&gt;&gt;&gt;&gt; that
&gt;&gt;&gt;&gt;&gt; underlying API that's relatively easy (as oppose to dead simple) to work
&gt;&gt;&gt;&gt;&gt; with and not as messy as what's going on right now.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I do agree that the code is messy.. Most of the time it's me fixing
&gt;&gt;&gt;&gt;&gt; bugs I didn't anticipate as I go along and hacking everything into place..
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; One thing I'm not too clear about is what you mean by "Track
&gt;&gt;&gt;&gt;&gt; dependencies between models". I'm not sure how you think I should go about
&gt;&gt;&gt;&gt;&gt; approaching this (which right now is a pretty big disaster.. though
&gt;&gt;&gt;&gt;&gt; relatively stable)
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Cheers,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Shuhao
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; P.S. I don't want to go into the whole PEP8 discussion and 4 spaces vs
&gt;&gt;&gt;&gt;&gt; whatever.. I just like the 2 spaces and the style guide that Google uses.
&gt;&gt;&gt;&gt;&gt; Is that really a big deal if you're using it as a library?
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Thu, Mar 1, 2012 at 9:35 PM, Andrey V. Martyanov &lt;
&gt;&gt;&gt;&gt;&gt; reald...@gmail.com&gt; wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Hi!
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Two things force me to avoid using Riakkit: the code is GPL licensed
&gt;&gt;&gt;&gt;&gt;&gt; and non pep8 compliant. So, I cannot fork it and make changes. The code
&gt;&gt;&gt;&gt;&gt;&gt; needs clean up, for example, json module is imported in document.py, but
&gt;&gt;&gt;&gt;&gt;&gt; not used. Riakkit has no conflict resolution logic, it's basically 
&gt;&gt;&gt;&gt;&gt;&gt; delegate
&gt;&gt;&gt;&gt;&gt;&gt; the work to underlying python client. If I'd like to implement my save
&gt;&gt;&gt;&gt;&gt;&gt; method I need to copy and rewrite more than 150 lines of code mess. What 
&gt;&gt;&gt;&gt;&gt;&gt; I
&gt;&gt;&gt;&gt;&gt;&gt; think the mapper should do:
&gt;&gt;&gt;&gt;&gt;&gt; 1. Serialize the objects to valid json;
&gt;&gt;&gt;&gt;&gt;&gt; 2. Deserialize the data back to class instances;
&gt;&gt;&gt;&gt;&gt;&gt; 3. Validate the fields data;
&gt;&gt;&gt;&gt;&gt;&gt; 4. Track dependencies between models;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Simple example using Riakkit-like syntax;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; class Post(Document):
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; bucket\\_name = 'posts'
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; title = types.StringProperty(required=True)
&gt;&gt;&gt;&gt;&gt;&gt; content = types.StringProperty(required=True)
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; class Comment(Document):
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; bucket\\_name = 'comments'
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; text = types.StringProperty(required=True)
&gt;&gt;&gt;&gt;&gt;&gt; post = types.IndexReferenceProperty(reference\\_class=Post,
&gt;&gt;&gt;&gt;&gt;&gt; collection\\_name='comments')
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post = Post('title', 'content')
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; comment1 = ('comment1', post=post)
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; comment2 = ('comment2', post=post)
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post.is\\_valid()
&gt;&gt;&gt;&gt;&gt;&gt; True
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt; post.serialize()
&gt;&gt;&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt;&gt;&gt; "key": "post\\_key",
&gt;&gt;&gt;&gt;&gt;&gt; "title": "title",
&gt;&gt;&gt;&gt;&gt;&gt; "content": "content",
&gt;&gt;&gt;&gt;&gt;&gt; "comments": [
&gt;&gt;&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt;&gt;&gt; "key": "comment1\\_key",
&gt;&gt;&gt;&gt;&gt;&gt; "text": "comment1"
&gt;&gt;&gt;&gt;&gt;&gt; },
&gt;&gt;&gt;&gt;&gt;&gt; {
&gt;&gt;&gt;&gt;&gt;&gt; "key": "comment2\\_key",
&gt;&gt;&gt;&gt;&gt;&gt; "text": "comment2"
&gt;&gt;&gt;&gt;&gt;&gt; },
&gt;&gt;&gt;&gt;&gt;&gt; ]
&gt;&gt;&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post.store()
&gt;&gt;&gt;&gt;&gt;&gt; True
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post = Post.get\\_with\\_key('post\\_key')
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post.comments
&gt;&gt;&gt;&gt;&gt;&gt; ['Post comment1', 'Post comment2']
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post\\_json\\_data = get\\_json\\_data\\_from\\_request()
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post = Post.deserialize(post\\_json\\_data)
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post.title
&gt;&gt;&gt;&gt;&gt;&gt; 'title'
&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; post.comments
&gt;&gt;&gt;&gt;&gt;&gt; ['Post comment1', 'Post comment2']
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Something like that.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Best regards,
&gt;&gt;&gt;&gt;&gt;&gt; Andrey Martyanov
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Fri, Mar 2, 2012 at 5:39 AM, Sean Carey  wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Keep up the great work Shuhao!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Mar 1, 2012, at 7:36 PM, Shuhao Wu  wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hey guys,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I started writing riakkit approximately 3 months ago and announced
&gt;&gt;&gt;&gt;&gt;&gt;&gt; it here. In case you missed that, Riakkit is basically an object mapper 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; for
&gt;&gt;&gt;&gt;&gt;&gt;&gt; python and riak, which seemed to be lacking in at the time. Now that 3
&gt;&gt;&gt;&gt;&gt;&gt;&gt; months has passed and I have developed this project into much more than
&gt;&gt;&gt;&gt;&gt;&gt;&gt; what I had envisioned to begin with. It's currently also being used and
&gt;&gt;&gt;&gt;&gt;&gt;&gt; tested in a project of mine (web application) as well and functioning 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; quite
&gt;&gt;&gt;&gt;&gt;&gt;&gt; nicely. I would say that currently this is the only object mapper that 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; can
&gt;&gt;&gt;&gt;&gt;&gt;&gt; compete with their counterparts in other languages for Riak in Python,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; although a lot of work still needs to be done before it could fully 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; compete.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; So today I felt that riakkit is "stable" and "clean" enough to
&gt;&gt;&gt;&gt;&gt;&gt;&gt; deserve the first beta release. So I whipped up a website and it's 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; released
&gt;&gt;&gt;&gt;&gt;&gt;&gt; to pypi. Here's (again), a demo (the full tutorial can be found on the
&gt;&gt;&gt;&gt;&gt;&gt;&gt; links below)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; class User(Document):
&gt;&gt;&gt;&gt;&gt;&gt;&gt; client = riak.RiakClient()
&gt;&gt;&gt;&gt;&gt;&gt;&gt; bucket\\_name = "users"
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; name = StringProperty(required=True)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; user = User(name="foo")
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; user.save()
&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt;&gt;&gt; print user.name
&gt;&gt;&gt;&gt;&gt;&gt;&gt; foo
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; If anyone is interested, you can find the website here:
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://ultimatebuster.github.com/riakkit and the code at
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://github.com/ultimatebuster/riakkit
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Cheers!
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Shuhao
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

