---
title: "Re: Best practice for using erlang modules in riak?"
description: ""
project: community
lastmod: 2011-06-02T13:00:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03534"
mailinglist_parent_id: "msg03460"
author_name: "Sylvain Niles"
project_section: "mailinglistitem"
sent_date: 2011-06-02T13:00:41-07:00
---


So I've had a few helpful emails, but unfortunately I'm about to write
my own erlang HTTP server to call my erlang M/R functions because even
examples from the contrib section of the wiki just don't work.

My last plea for help before we look at writing a replacement for
Riak's REST API:

a. Any documentation that shows how to properly deploy your erlang
code with the riak cluster (I'm currently writing a module, storing it
with riak\\_core, adding it to riak\\_core.app, and it's building fine,
can call it from riak console.)
b. The correct way to call an erlang function from the REST api or via
Ripple, specifically we are using the output of a Javascript Map to an
Erlang Reduce (If this is not supported, please let us know!)


Thanks in advance,
Sylvain Niles


On Fri, May 27, 2011 at 12:16 PM, Sylvain Niles  wrote:
&gt; Still looking for advice on this, additionally I'm looking for the
&gt; correct way to call the erlang modules from Ripple. I've tried calling
&gt; it from a reduce like so:
&gt;
&gt; reduced = 
&gt; Riak::MapReduce.new(Ripple.client).add(a-bucket').map("function(v){return
&gt; [[v.values[0].data], [v.bucket, v.key]];}", :keep =&gt;
&gt; true).reduce(["my\\_module","my\\_function"], :keep =&gt; true).run
&gt;
&gt; and I can see that it never gets called, just returns [].
&gt;
&gt; I can call the module while attached to a Riak console in the cluster
&gt; and it works exactly as expected given the exact output of the
&gt; previous map: [["value"], ["bucket", "key"]]
&gt;
&gt; Any pointers would be greatly appreciated! If there's any open source
&gt; code out there using ripple in this fashion I'd love a pointer!
&gt;
&gt; Thanks,
&gt; -Sylvain
&gt;
&gt; On Tue, May 24, 2011 at 6:55 PM, Sylvain Niles  
&gt; wrote:
&gt;&gt; So I've seen a few well written examples of erlang map or reduce
&gt;&gt; functions in the contrib section of the wiki/github but the missing
&gt;&gt; piece of glue for me is: Where do I compile from? I've done a lot of
&gt;&gt; ejabberd development and generally I just throw it in the src
&gt;&gt; directory, add a config param to the ejabberd.conf to load my new
&gt;&gt; module at startup, make install, and I'm done. Should I be deploying
&gt;&gt; my modules to /deps/riak\\_core/src/?
&gt;&gt;
&gt;&gt; The wiki has this note:
&gt;&gt;
&gt;&gt; Distributing Erlang MapReduce Code
&gt;&gt;
&gt;&gt; Any modules and functions you use in your Erlang MapReduce calls must
&gt;&gt; be available on all nodes in the cluster. You can add them in Erlang
&gt;&gt; applications by specifying the -pz option in vm.args or by adding the
&gt;&gt; path to the add\\_paths setting in app.config.
&gt;&gt;
&gt;&gt; But the vm.args page does not list the valid config format/options for
&gt;&gt; the -pz option. Is the add\\_paths behavior such that a valid beam in
&gt;&gt; that dir will automatically be loaded on startup and all exported
&gt;&gt; functions available? What about live code updates of internally
&gt;&gt; developed modules?
&gt;&gt;
&gt;&gt; Thanks in advance!
&gt;&gt;
&gt;&gt; -Sylvain
&gt;&gt;
&gt;

