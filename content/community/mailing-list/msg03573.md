---
title: "Re: Key-Filters with logical AND operation and with tokenize"
description: ""
project: community
lastmod: 2011-06-06T07:05:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03573"
mailinglist_parent_id: "msg03571"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-06-06T07:05:18-07:00
---


It does work, but the and/or/not examples in the wiki only show the filter 
operation that would be passed in to the filters parameter, not the entire 
contents.

The wiki's
["and", [["ends\\_with", "0603"]], [["starts\\_with", "basho"]]]
should really be
[["and", [["ends\\_with", "0603"]], [["starts\\_with", "basho"]]]]

http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-May/004305.html
 is Mathias's response to my questions on the subject.
--- 
Jeremiah Peschka
Founder, Brent Ozar PLF


On Monday, June 6, 2011 at 6:54 AM, David Mitchell wrote:

&gt; Can someone confirm that the logical AND operation used with tokenize does 
&gt; not work? According to the website (http://wiki.basho.com/Key-Filters.html), 
&gt; it should work, but it does not work for me.
&gt; 
&gt; David
&gt; 
&gt; 
&gt; From: David Mitchell 
&gt; Sent: Thursday, June 02, 2011 6:41 PM
&gt; To: 'riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)'
&gt; Subject: Key-Filters with logical AND operation and with tokenize
&gt; 
&gt; I am trying to use the following Key-Filters with logical AND operation and 
&gt; tokenize, but I am getting errors. Anyone know what might be wrong? Is it 
&gt; possible to use tokenize with the logical AND?
&gt; 
&gt; Erlang: R13B04
&gt; Riak: 0.14.2
&gt; 
&gt; Bucket: zip
&gt; Key: 22305-0-1-3
&gt; 
&gt; The following does not work:
&gt; {
&gt; "inputs" : {
&gt; "bucket" : "zip",
&gt; "key\\_filters" : ["and", [["starts\\_with", "22305-0"]], [["tokenize", "-", 4], 
&gt; ["between", "1", "3"]]]
&gt; },
&gt; "query" : [{
&gt; "map" : {
&gt; "keep" : true,
&gt; "language" : "javascript",
&gt; "arg" : null,
&gt; "source" : "function (v) { return [Riak.mapValuesJson(v)[0]]; }"
&gt; }
&gt; }
&gt; ]
&gt; }
&gt; 
&gt; I get the following error:
&gt; {error,{error,function\\_clause,[{riak\\_client,build\\_exprs,[[&lt;&lt;\\"and\\"&gt;&gt;,[[&lt;&lt;\\"starts\\_with\\"&gt;&gt;,&lt;&lt;\\"22305-0\\"&gt;&gt;]],[[&lt;&lt;\\"tokenize\\"&gt;&gt;,&lt;&lt;\\"-\\"&gt;&gt;,2],[&lt;&lt;\\"between\\"&gt;&gt;,&lt;&lt;\\"1\\"&gt;&gt;,&lt;&lt;\\"3\\"&gt;&gt;]]],[],{riak\\_client,'riak@10.0.60.208
&gt; 
&gt; (mailto:riak@10.0.60.208)',&lt;&lt;3,171,198,76&gt;&gt;}]},{riak\\_client,build\\_filter,2},{riak\\_client,stream\\_list\\_keys,6},{riak\\_client,mapred\\_bucket\\_stream,7},{riak\\_client,mapred\\_bucket,6},{riak\\_kv\\_wm\\_mapred,process\\_post,2},{webmachine\\_resource,resource\\_call,3},{webmachine\\_resource,do,3}]}}
&gt; 
&gt; The following does work:
&gt; {
&gt; "inputs" : {
&gt; "bucket" : "zip",
&gt; "key\\_filters" : [["tokenize", "-", 4], ["between", "1", "5"]]
&gt; },
&gt; "query" : [{
&gt; "map" : {
&gt; "keep" : true,
&gt; "language" : "javascript",
&gt; "arg" : null,
&gt; "source" : "function (v) { return [Riak.mapValuesJson(v)[0]]; }"
&gt; }
&gt; }
&gt; ]
&gt; }
&gt; 
&gt; David
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

