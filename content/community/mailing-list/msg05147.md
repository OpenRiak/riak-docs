---
title: "Re: Riak error: no_candidate_nodes, exhausted_preflist"
description: ""
project: community
lastmod: 2011-10-13T07:32:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05147"
mailinglist_parent_id: "msg05113"
author_name: "Martin Woods"
project_section: "mailinglistitem"
sent_date: 2011-10-13T07:32:45-07:00
---


Hi Kelly

Thanks for the reply. I've trawled through the error logs produced by Riak
but unfortunately I can't see any other useful info in there. It's possible
that the mapreduce functions were timing out, though I didn't see any
evidence of this in the logs. For sure it was under heavy load, and it was a
lonesome Riak node in a cluster of one.

We haven't seen this error since, even though we've subsequently loaded it
heavily.

Migrating to Riak 1.0 is in our sights, so hopefully this will reduce the
likelihood of this occurring even more. If we see it again, we'll let you
know.

Thanks and regards,
Martin.



On 10 October 2011 16:37, Kelly McLaughlin  wrote:

&gt; Martin,
&gt;
&gt; The error you are seeing is caused by the death of some of map phase worker
&gt; processes. It's hard to tell exactly why they would be dying from the
&gt; limited output, but I suspect since you mention that it happens only under
&gt; heavy load that it's hitting the map reduce timeout or perhaps (but more
&gt; unlikely) even exceeding the erlang process limit. Could you check for any
&gt; other error output in the riak log directory that might be relevant? You
&gt; could also just try increasing the timeout used in your mapreduce queries
&gt; and see if that alleviates the problem.
&gt;
&gt; FWIW, I would expect you to have a better time with Riak 1.0 using the
&gt; riak\\_pipe mapreduce. It was designed to be more robust for long running jobs
&gt; and in the case when the Riak cluster is heavily loaded. Cheers.
&gt;
&gt; Kelly
&gt;
&gt;
&gt; On Sep 15, 2011, at 9:49 AM, Martin Woods wrote:
&gt;
&gt; Hi all
&gt;
&gt; When running Riak recently on a development platform (Ubuntu 9.10 Server
&gt; 64-bit with Riak 0.14.2) the Riak error logs reported the following
&gt; termination:
&gt;
&gt;
&gt; \\*\\* Reason for termination =
&gt; \\*\\* {error,
&gt; {phase\\_error,
&gt; {error,
&gt; {no\\_candidate\\_nodes,exhausted\\_preflist,
&gt; [{riak\\_kv\\_mapred\\_planner,claim\\_keys,3},
&gt; {riak\\_kv\\_map\\_phase,handle\\_info,2},
&gt; {luke\\_phase,handle\\_info,3},
&gt; {gen\\_fsm,handle\\_msg,7},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}],
&gt;
&gt;
&gt; At the time we were heavily loading Riak using the riakc client with
&gt; multiple Erlang mapreduce requests, each involving key filters. Could that
&gt; load have caused this error? We can see in the code where this is raised but
&gt; don't know enough about Riak under the hood to work out what the underlying
&gt; cause is.
&gt;
&gt;
&gt; Any help would be much appreciated!
&gt;
&gt;
&gt; Kind regards,
&gt;
&gt; Martin.
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

