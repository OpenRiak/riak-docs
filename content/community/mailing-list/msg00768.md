---
title: "Re: Best way to back-up riak"
description: ""
project: community
lastmod: 2010-07-21T11:01:30-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00768"
mailinglist_parent_id: "msg00716"
author_name: "Alan McConnell"
project_section: "mailinglistitem"
sent_date: 2010-07-21T11:01:30-07:00
---


I'm curious about this as well. Say I have a ten node cluster. Could I
just schedule a midnight copy of each bitcask data directory every night,
then restore to another ten node cluster by dropping one of each data
directories on each new node? How close does the timing needs to be? What
if the data directory snapshots were taken seconds or minutes apart?

-Alan


On Mon, Jul 12, 2010 at 9:56 AM, Jason J. W. Williams &lt;
jasonjwwilli...@gmail.com&gt; wrote:

&gt; Hey Justin,
&gt;
&gt; Since Riak is lockless, what is the best approach to pulling a
&gt; distributed FS snapshot of the bitcask files across nodes? I assume if
&gt; they're not close to each other, you'll have an issue if you have to
&gt; restore a cluster.
&gt;
&gt;
&gt; -J
&gt;
&gt; On Sun, Jul 11, 2010 at 8:14 PM, Justin Sheehy  wrote:
&gt; &gt; Hi, Jan.
&gt; &gt;
&gt; &gt; On Sun, Jul 11, 2010 at 8:53 PM, Jan Vincent 
&gt; wrote:
&gt; &gt;
&gt; &gt;&gt; Given that riak is new in the database field, if ever I use riak in
&gt; production,
&gt; &gt;&gt; what would be the best way to back it up? I know that there's redundancy
&gt; &gt;&gt; on the different nodes and NRW may be modifiable per request, but I'm
&gt; &gt;&gt; wondering if there's a way to snapshot the dataset periodically -- at
&gt; least
&gt; &gt;&gt; until riak becomes provably battle tested.
&gt; &gt;
&gt; &gt; Riak is fairly battle-tested already: we were using its prior version
&gt; &gt; under Basho's own customer-facing applications in 2008, and a number
&gt; &gt; of external customers and users are in production today. That said,
&gt; &gt; even a solid distributed database needs to be backed up as there are
&gt; &gt; many reasons to have backups.
&gt; &gt;
&gt; &gt; The easiest and best way to back up Riak is, if you are using bitcask
&gt; &gt; (the default) as the backend, to simply back up the filesystem of your
&gt; &gt; nodes with whatever backup system you use for the rest of your
&gt; &gt; systems. Bitcask uses append-only files, and once it closes a file it
&gt; &gt; will never change the content of that file again. This makes it very
&gt; &gt; backup-friendly.
&gt; &gt;
&gt; &gt; If you are using a backend with less backup-friendly disk format (such
&gt; &gt; as innostore) then you can use the "riak-admin backup" command at
&gt; &gt; either the per-node or whole-cluster level to produce a
&gt; &gt; backend-independent snapshot that can be loaded back in via
&gt; &gt; "riak-admin restore". This method is much slower, will impose
&gt; &gt; additional load on your cluster when running, and requires that you
&gt; &gt; have a place to put the generated snapshot. However, it will work
&gt; &gt; regardless of backend and is also a simple if heavyweight way to
&gt; &gt; migrate to a cluster with a different configuration.
&gt; &gt;
&gt; &gt; -Justin
&gt; &gt;
&gt; &gt;
&gt;

