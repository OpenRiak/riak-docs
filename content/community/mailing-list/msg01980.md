---
title: "Re: Riak Recap for Jan. 12 - 13."
description: ""
project: community
lastmod: 2011-01-14T16:33:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01980"
mailinglist_parent_id: "msg01979"
author_name: "Neville Burnell"
project_section: "mailinglistitem"
sent_date: 2011-01-14T16:33:42-08:00
---


Dumb Question: could Riak be changed to perform read repair before
responding, to improve consistency of response?

On 15 January 2011 11:12, Sean Cribbs  wrote:

&gt;
&gt;
&gt; Crap, the second after I hit "send" the lightbulb goes on! Why is that?
&gt;
&gt; The quorum \\_was\\_ met (all vnodes just migrated to the one machine) but
&gt; since some of them were fail-overs they didn't have the value yet (or the
&gt; wrong value)? In this case a read repair happened and subsequent gets
&gt; worked.
&gt;
&gt;
&gt; Your understanding is correct. However, when I say "quorum was met" I
&gt; usually mean that "it had R successful replies". Minor semantic quibble.
&gt;
&gt; You are correct in saying that the wiki is misleading -- read repair
&gt; happens when any successful reply reaches the FSM, even if "not found" was
&gt; returned to the client, that is, if quorum was not met. We'll get that
&gt; fixed.
&gt;
&gt; I'm still dark on the second question.
&gt;
&gt;
&gt;&gt; 2) Why doesn't r=1 work?
&gt;&gt;
&gt;&gt; In the IRC session, you claimed that r=1 would not have helped this
&gt;&gt; problem. Just like the OP, this confused me. You then went on to say it
&gt;&gt; was because of some optimization and then mentioned a "basic quorum."
&gt;&gt;
&gt;&gt; I took a few minutes to think about this and the only conclusion I came to
&gt;&gt; is that when r=1 you will treat the first response as the final response,
&gt;&gt; and in this case the notfound response will always come back first? I'm not
&gt;&gt; sure if what I just said makes sense but I would have expected r=1 to work,
&gt;&gt; just like the OP. I'll admit that I still haven't read all the wiki docs
&gt;&gt; yet (but I've read Read Repair 3 times now), so I'd be happy to hear RTFM.
&gt;&gt;
&gt;
&gt; A number of months ago, we ran into some issues with a cluster where "not
&gt; found" responses were not returning in a reasonable amount of time,
&gt; especially when R=1. That is, the requests took MUCH longer than a
&gt; SUCCESSFUL read. We determined that this occurred because one of the
&gt; partitions was too busy to reply, causing the request timeout to expire. So
&gt; we added a special case called "basic quorum" (n\\_val/2 + 1) that is invoked
&gt; only when receiving a "not found" response from a replica. The idea is that
&gt; if a simple majority of the replica partitions report "not found", it's
&gt; probably not there. This way, you don't sit around waiting for the last
&gt; lonely partition to reply when R=1 (and your successful reads are still fast
&gt; because you only wait for one replica). It's a tradeoff of availability:
&gt; returning a potentially incorrect response vs. appearing unavailable (timing
&gt; out). We chose the former.
&gt;
&gt; Hope that helps,
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;

