---
title: "Re: list keys with key filters"
description: ""
project: community
lastmod: 2012-04-23T13:18:28-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07293"
mailinglist_parent_id: "msg07288"
author_name: "Sam Lang"
project_section: "mailinglistitem"
sent_date: 2012-04-23T13:18:28-07:00
---

On Apr 23, 2012, at 8:29 AM, Bryan Fink wrote:

&gt; On Sat, Apr 21, 2012 at 12:39 PM, Sam Lang  wrote:
&gt;&gt; When I use ascii or json objects, I don't get the exception, and the keys 
&gt;&gt; get listed properly. I assume that riak is trying to parse the data of my 
&gt;&gt; binary object and failing because the data isn't utf8 encoded. Is it 
&gt;&gt; possible to do this without writing my own data extractor? Is there a 
&gt;&gt; better way to list a subset of keys?
&gt; 
&gt; Hi, Sam. Your intuition is correct: the bad\\_utf8\\_character\\_code error
&gt; is coming from Riak trying to encode each object to JSON for your
&gt; Javascript map phase to process.
&gt; 
&gt; If all you want is to get the keys back to your client, and you're
&gt; using Riak 1.1 or newer with the latest Python client, then the
&gt; simplest workaround is to call query.run() without any phases at all:
&gt; 
&gt;&gt;&gt;&gt; query = client.add("foo")
&gt;&gt;&gt;&gt; query.add\\_key\\_filter("ends\\_with", "z")
&gt; 
&gt;&gt;&gt;&gt; v = query.run()
&gt;&gt;&gt;&gt; v[0].\\_key
&gt; u'baz'
&gt; 
&gt; Note that you will still end up with an encoding error if your keys
&gt; cannot be encoded as JSON.

That worked, thanks Bryan! Any way to avoid sending the values of the object 
to the client as well?
-sam

&gt; 
&gt; HTH,
&gt; Bryan
&gt; 
&gt; P.S. If you're using an older version of Riak and/or the Python
&gt; client, you may need to use the hack of a single-phase query, of just
&gt; one reduce phase implemented by the Erlang function
&gt; riak\\_kv\\_mapreduce:reduce\\_identity, instead of using the empty query.
