---
title: "Re: Riak Enterprise: can it be used to migrate to a new configuration?"
description: ""
project: community
lastmod: 2012-10-22T08:04:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08998"
mailinglist_parent_id: "msg08987"
author_name: "Dave Brady"
project_section: "mailinglistitem"
sent_date: 2012-10-22T08:04:03-07:00
---


Hi Evan,

Thanks for responding!

We have five nodes now, though that will grow to 15-20. We are currently 
projecting 10 TB of data, so 30 TB with N=3.

I cannot find the exact page on your docs site that had the 512 recommendation 
for five nodes. I certainly may have misinterpreted what was written, on 
whatever page I thought I saw it.

Now to try to figure out how we're going to make this change...

----- Original Message -----
From: "Evan Vigil-McClanahan" 
To: "Rune Skou Larsen" , dbr...@weborama.com
Cc: riak-users@lists.basho.com
Sent: Friday, October 19, 2012 8:16:03 PM
Subject: Re: Riak Enterprise: can it be used to migrate to a new configuration?

Dave,

64 is fine for a 6 node cluster. Rune gives a great rundown of the
downsides of large rings on small numbers of machines in his post.
Usually our recommendation is for ~10 ring partitions per physical
machine, rounded up to the next power of two. Where did you see the
recommendation for 512 from us?

Rune,
Basho's replication won't work in the situation that you've described.
 Are you talking about an in-house replication product? Our full-sync
doesn't work between clusters of different ring sizes.

On Fri, Oct 19, 2012 at 4:50 AM, Rune Skou Larsen  wrote:
&gt; Yes, we have done excatly that. When we migrated from 256 to 128 partitions
&gt; in a live dual-cluster system, we took one cluster down. Wiped the data,
&gt; changed number of partitions, brought it back up and synced all data back
&gt; with a full sync. Then we did the same with the other cluster.
&gt;
&gt; However, I must disagree with the recomendation of 512 partitions for 5
&gt; nodes. You should go for 128 or 256 unless you plan on scaling out to 10+
&gt; nodes pr. cluster.
&gt;
&gt; There are downsides to having many partitions. The price of the higher
&gt; granularity is that the more storage backend processes use more resources
&gt; for housekeeping. If you do multibackend, the ressources used are multiplied
&gt; yet again with the number of backends because each vnode will have a number
&gt; of running backend processes.
&gt;
&gt; Say you go with the 512 partitions and have a multibackend config with 4
&gt; backends, because you need to backup 4 different types of data
&gt; independently. That gives you 2k running backends on each node of which 412
&gt; will be actively in use in normal running scenario and more when you're
&gt; doing handoff. Thats a lot of ressources just to run these, that you might
&gt; otherwise have used for doing business.
&gt;
&gt; When you increase the number of partitions you should consider:
&gt; - Number of open files. Especially when using eleveldb.
&gt; - Late triggering of bitcask compaction. The default is no compaction of any
&gt; file before it hits 2GB. That means up to 2G of dead space per vnode. This
&gt; can however be configured down to a smaller number than the 2 gigs, which is
&gt; crazy high in almost any use case involving delete, expiry or update of
&gt; data.
&gt; - Leveldb cache is pr. vnode, so you need to lower the number, in order to
&gt; not use all memory, which will lead to death by swapping.
&gt; - With a high number of vnodes pr. node, each vnode's leveldb cache will be
&gt; comparatively small leading to (slighty) less effecient cache usage.
&gt;
&gt; Please be in touch if you need onsite or offsite professional assistance
&gt; configuring, testing or running your Riak clusters.
&gt;
&gt; BR Rune Skou Larsen
&gt;
&gt; Trifork
&gt; - We do Riak PS.
&gt;
&gt; --
&gt;
&gt; Best regards / Venlig hilsen
&gt;
&gt; Rune Skou Larsen
&gt; Trifork Public A/S / Team Riak
&gt; Margrethepladsen 4, 8000 Ã…rhus C, Denmark
&gt; Phone: +45 3160 2497 Skype: runeskoularsen twitter: @RuneSkouLarsen
&gt;
&gt;
&gt;
&gt; Den 19-10-2012 12:38, Dave Brady skrev:
&gt;
&gt; Can Riak Enterprise replicate between rings where each ring has a different
&gt; number of partitions?
&gt;
&gt; Our five-node ring was originally configured with 64 partitions, and I saw
&gt; that Basho is recommending 512 for that number of machines.
&gt;
&gt; Any ideas on how to make as-painless-a-migration-as-possible are welcome, of
&gt; course!
&gt;
&gt; --
&gt; Dave Brady
&gt;
&gt;
&gt;
