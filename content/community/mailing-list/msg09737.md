---
title: "Re: Riak and host names"
description: ""
project: community
lastmod: 2013-01-04T12:47:39-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09737"
mailinglist_parent_id: "msg09717"
author_name: "Deepak Balasubramanyam"
project_section: "mailinglistitem"
sent_date: 2013-01-04T12:47:39-08:00
---


Perhaps I should ask the question differently.

Can someone elaborate on what 'cluster replace' does and how the command is
affected by node names that change after riak starts up ?

Thanks
-Deepak

On Wed, Jan 2, 2013 at 1:13 AM, Deepak Balasubramanyam &lt;
deepak.b...@gmail.com&gt; wrote:

&gt; I took the AWS EC2 riak image for a spin today. I have a query regarding
&gt; riak nodes and how they behave when the machine reboots.
&gt;
&gt; When an EC2 instance reboots, the internal ip / internal DNS / external
&gt; DNS change. This renders the app.config and -name argument on vm.args
&gt; incorrect. I was exploring solutions to deal with this problem.
&gt;
&gt; \\*1. Preventive measures\\*
&gt;
&gt; Someone on this thread dated May 
&gt; 2011
&gt; suggested
&gt; using host file entries that point to the local internal IP address. That
&gt; does not seem to work. Riak fails with the following error when I add a new
&gt; entry to /etc/hosts and configure vm.args with -name riak@riaknode1
&gt;
&gt; Hostname riaknode1 is illegal
&gt;
&gt; I confirmed that riaknode1 pings correctly before starting riak. I guess
&gt; erlang tries to match the hostname of the system resulting in this failure
&gt; ? Can anyone throw some light on this ?
&gt;
&gt; \\*2. Use -sname\\*
&gt;
&gt; Is starting the erlang VM with the sname flag an option if it will help
&gt; prevent the 'illegal hostname' error ?
&gt; Disclaimer: My knowledge of erlang is close to zilch, so sorry if that
&gt; option sounded like something you could dismiss easily :)
&gt;
&gt; \\*3. Use cluster replace
&gt; \\*
&gt;
&gt; a. I understand that the IPs in app.config and vm.args can be replaced
&gt; with the correct IP on a restart and using a subsequent 'cluster replace'
&gt; command will do. Will executing the 'cluster plan' and 'cluster commit'
&gt; commands now produce network chatter ?
&gt;
&gt; b . What happens if 2 nodes go down and one was joined with the other.
&gt; They both have 2 different IP addresses on restart. How will 'cluster
&gt; replace' work now ?
&gt;
&gt; Do let me know your thoughts.
&gt;
&gt; Thanks
&gt; -Deepak
&gt;
