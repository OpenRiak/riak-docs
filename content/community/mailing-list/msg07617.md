---
title: "mochijson2 error from curl mapreduce"
description: ""
project: community
lastmod: 2012-06-05T13:29:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07617"
author_name: "John Roy"
project_section: "mailinglistitem"
sent_date: 2012-06-05T13:29:07-07:00
---


I saw something similar from an individual who was using javascript 
(http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-July/004843.html),
 but I don't think I have the same problem in erlang. Any help is greatly 
appreciated.

I'm consistently getting the following error from my curl map reduce calls:

{error,{exit,{json\\_encode,{bad\\_term,â€¦..

output dictionary here, then:

 [{mochijson2,json\\_encode,2},
 {mochijson2,'-json\\_encode\\_array/2-fun-0-',3},
 {lists,foldl,3},
 {mochijson2,json\\_encode\\_array,2},
 {riak\\_kv\\_wm\\_mapred,pipe\\_mapred\\_nonchunked,5},
 {webmachine\\_resource,resource\\_call,3},
 {webmachine\\_resource,do,3},

The term that follows the error appears to the correct result of the map reduce.

I'm just trying the mr locally for testing purposes. I'm using eleveldb 
backend and riak (1.1.2 2012-04-17) OSX x86\\_64.

Here's the curl command:

curl -v -X POST http://127.0.0.1:8098/mapred -H "Content\\_Type: 
application/json" -d @query.js

and the query.js:

{
 "inputs" : {
 "bucket" : "test7",
 "index" : "field1\\_int",
 "start" : 0,
 "end" : 23
 },
 "query" : [
 { "map" : {"language" : "erlang", "module" : "impressions", "function" 
: "emitStats", "keep" : false} },
 { "reduce" : {"language" : "erlang", "module" : "impressions", 
"function" : "reduceStats", "keep" : true} }
 ],
 "timeout" : 600000
}

and finally the associated erlang functions:

emitStats(G, undefined, none)-&gt;
 ObjectJson = riak\\_object:get\\_value(G),
 {struct, DocPropList} = mochijson:decode(ObjectJson),
 I = {proplists:get\\_value("obj\\_name",DocPropList,"None"),
 proplists:get\\_value("type",DocPropList,"None"),
 proplists:get\\_value("obj\\_url",DocPropList,"None"),
 "hourly"},
 [dict:from\\_list([{I,1}])].

reduceStats(Gcounts, none)-&gt;
 [lists:foldr(fun(G, Acc)-&gt;dict:merge(fun(\\_, X, Y) -&gt; X+Y end,G, Acc) end,
 dict:new(),
 Gcounts)].


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

