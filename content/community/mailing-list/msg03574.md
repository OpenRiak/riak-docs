---
title: "RE: Key-Filters with logical AND operation and with tokenize"
description: ""
project: community
lastmod: 2011-06-06T07:22:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03574"
mailinglist_parent_id: "msg03573"
author_name: "David Mitchell"
project_section: "mailinglistitem"
sent_date: 2011-06-06T07:22:15-07:00
---


Jeremiah,

Thank you for your response. As you have suggested, it does work with:
[["and", [["ends\\_with", "0603"]], [["starts\\_with", "basho"]]]]

I have confirmed that the following does work.

{
 "inputs" : {
 "bucket" : "zips",
 "key\\_filters" : [["and", [["starts\\_with", 
22305]], [["tokenize", "-", 4], ["between", "1", "5"]]]]
 },
 "query" : [{
 "map" : {
 "keep" : true,
 "language" : 
"javascript",
 "arg" : null,
 "source" : 
"function (v) { return [Riak.mapValuesJson(v)[0]]; }"
 }
 }
 ]
}
Perhaps the basho wiki should be updated.

David

From: Jeremiah Peschka [mailto:jeremiah.pesc...@gmail.com]
Sent: Monday, June 06, 2011 10:05 AM
To: David Mitchell
Cc: riak-users@lists.basho.com
Subject: Re: Key-Filters with logical AND operation and with tokenize

It does work, but the and/or/not examples in the wiki only show the filter 
operation that would be passed in to the filters parameter, not the entire 
contents.

The wiki's

["and", [["ends\\_with", "0603"]], [["starts\\_with", "basho"]]]

should really be

[["and", [["ends\\_with", "0603"]], [["starts\\_with", "basho"]]]]

http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-May/004305.html
 is Mathias's response to my questions on the subject.
---
Jeremiah Peschka
Founder, Brent Ozar PLF


On Monday, June 6, 2011 at 6:54 AM, David Mitchell wrote:

Can someone confirm that the logical AND operation used with tokenize does not 
work? According to the website (http://wiki.basho.com/Key-Filters.html), it 
should work, but it does not work for me.

David

From: David Mitchell
Sent: Thursday, June 02, 2011 6:41 PM
To: 'riak-users@lists.basho.com'
Subject: Key-Filters with logical AND operation and with tokenize

I am trying to use the following Key-Filters with logical AND operation and 
tokenize, but I am getting errors. Anyone know what might be wrong? Is it 
possible to use tokenize with the logical AND?

Erlang: R13B04

Riak: 0.14.2

Bucket: zip

Key: 22305-0-1-3

The following does not work:

{

 "inputs" : {

 "bucket" : "zip",

 "key\\_filters" : ["and", [["starts\\_with", 
"22305-0"]], [["tokenize", "-", 4], ["between", "1", "3"]]]

 },

 "query" : [{

 "map" : {

 "keep" : true,

 "language" : 
"javascript",

 "arg" : null,

 "source" : 
"function (v) { return [Riak.mapValuesJson(v)[0]]; }"

 }

 }

 ]

}

I get the following error:

{error,{error,function\\_clause,[{riak\\_client,build\\_exprs,[[&lt;&lt;\\"and\\"&gt;&gt;,[[&lt;&lt;\\"starts\\_with\\"&gt;&gt;,&lt;&lt;\\"22305-0\\"&gt;&gt;]],[[&lt;&lt;\\"tokenize\\"&gt;&gt;,&lt;&lt;\\"-\\"&gt;&gt;,2],[&lt;&lt;\\"between\\"&gt;&gt;,&lt;&lt;\\"1\\"&gt;&gt;,&lt;&lt;\\"3\\"&gt;&gt;]]],[],{riak\\_client,'riak@10.0.60.208',&lt;&lt;3,171,198,76&gt;&gt;}]},{riak\\_client,build\\_filter,2},{riak\\_client,stream\\_list\\_keys,6},{riak\\_client,mapred\\_bucket\\_stream,7},{riak\\_client,mapred\\_bucket,6},{riak\\_kv\\_wm\\_mapred,process\\_post,2},{webmachine\\_resource,resource\\_call,3},{webmachine\\_resource,do,3}]}}

The following does work:

{

 "inputs" : {

 "bucket" : "zip",

 "key\\_filters" : [["tokenize", "-", 4], 
["between", "1", "5"]]

 },

 "query" : [{

 "map" : {

 "keep" : true,

 "language" : 
"javascript",

 "arg" : null,

 "source" : 
"function (v) { return [Riak.mapValuesJson(v)[0]]; }"

 }

 }

 ]

}

David
