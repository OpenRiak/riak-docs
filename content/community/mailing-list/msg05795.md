---
title: "Re: Unexpected issue w/ m/r Riak.reduceSlice"
description: ""
project: community
lastmod: 2011-11-29T15:07:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05795"
mailinglist_parent_id: "msg05793"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-11-29T15:07:19-08:00
---


I suppose I should instead stream the list of keys to client, slice keys in
client, then fetch the objects, right?
On Nov 29, 2011 5:21 PM, "Jonathan Langevin" 
wrote:

&gt; When attempting to run m/r queries that execute Riak.reduceSlice to create
&gt; paginated result sets, I've found an unexpected result.
&gt;
&gt; For instance, if I call Riak.reduceSlice with start = 80, end = 85, which
&gt; you would expect to return 5 results (knowing that you have a total of 115
&gt; objects stored in Riak), you might instead get 16 objects returned back.
&gt; This is due to the logic of Riak.reduceSlice, which just returns the
&gt; results-thus-far when it finds that the end value (85) is greater than the
&gt; current length of value (16 objects).
&gt;
&gt; I suppose ultimately this is due to how Riak sends data in chunks between
&gt; phases (at least, that's my understanding)? So it happens to send a small
&gt; chunk of 16 results from the map phase to the reduce phase, and reduce
&gt; returns back the current "value" chunk since 16 results is less than 85
&gt; results...
&gt;
&gt;
&gt; How can I plan for this, so that I can ensure I'm getting the expected #
&gt; results back, and in fair context to the "page" of results that I should be
&gt; viewing?
&gt; And just a note, while I tested with & without sorted results, the final
&gt; code would be with sorted results that are then paginated.
&gt;
&gt;
&gt; Example data payload:
&gt; {
&gt; "inputs":"demo\\_3\\_Course",
&gt; "query":[
&gt; {
&gt; "map":{
&gt; "keep":false,
&gt; "language":"javascript",
&gt; "arg":null,
&gt; "source":"function(value){return [value.key];}"
&gt; }
&gt; },
&gt; {
&gt; "reduce":{
&gt; "keep":true,
&gt; "language":"javascript",
&gt; "arg":[
&gt; 80,
&gt; 85
&gt; ],
&gt; "name":"Riak.reduceSlice"
&gt; }
&gt; }
&gt; ]
&gt; }
&gt; \\*
&gt;
&gt; 
&gt; Jonathan Langevin
&gt; Manager, Information Technology
&gt; Loom Inc.
&gt; Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
&gt; www.loomlearning.com - Skype: intel352
&gt; \\*
&gt;
