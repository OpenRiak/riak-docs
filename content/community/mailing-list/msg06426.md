---
title: "Re: Corruption of leveldb database files"
description: ""
project: community
lastmod: 2012-01-26T04:34:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06426"
mailinglist_parent_id: "msg06425"
author_name: "Kresten Krab Thorup"
project_section: "mailinglistitem"
sent_date: 2012-01-26T04:34:19-08:00
---


FYI, The LevelDB bug we observed when running out of disk space (bug ID #63 in 
leveldb's issue list) is also reported fixed now. 

Kresten

On 26/01/2012, at 13.26, "Thomas Bakketun"  wrote:

&gt; Hello,
&gt; 
&gt; A fix for this bug in leveldb has been released now. I would recommend
&gt; that a service release of Riak with this fix included is done as soon as
&gt; possible.
&gt; 
&gt; 
&gt; On 2012-01-16 17:52, David Smith wrote:
&gt;&gt; Thomas,
&gt;&gt; 
&gt;&gt; Thanks for the heads up -- I saw that bug report on the Level repo this 
&gt;&gt; morning.
&gt;&gt; 
&gt;&gt; D.
&gt;&gt; 
&gt;&gt; On Mon, Jan 16, 2012 at 9:50 AM, Thomas Bakketun
&gt;&gt;  wrote:
&gt;&gt;&gt; Hello,
&gt;&gt;&gt; 
&gt;&gt;&gt; We have found a bug in leveldb that causes corruption of the CURRENT
&gt;&gt;&gt; file of leveldb databases. A bug report has been filed:
&gt;&gt;&gt; http://code.google.com/p/leveldb/issues/detail?id=68
&gt;&gt;&gt; 
&gt;&gt;&gt; This bug can easily be reproduced by restarting restarting Riak and
&gt;&gt;&gt; force of the computer within 30 to 60 seconds. After reboot at least one
&gt;&gt;&gt; corrupt leveldb database can be expected. When this happens Riak fails
&gt;&gt;&gt; to start and logs this message:
&gt;&gt;&gt; 
&gt;&gt;&gt; Failed to start riak\\_kv\\_eleveldb\\_backend Reason: {db\\_open,"Corruption:
&gt;&gt;&gt; CURRENT file does not end with newline"}
&gt;&gt;&gt; 
&gt;&gt;&gt; Switching on the sync flag for leveldb has no effect.
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Thomas Bakketun, Senior software developer
&gt;&gt;&gt; T. +47 21 53 69 40
&gt;&gt;&gt; Copyleft Solutions
&gt;&gt;&gt; www.copyleftsolutions.com
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Thomas Bakketun, Senior software developer
&gt; T. +47 21 53 69 40
&gt; Copyleft Solutions
&gt; www.copyleftsolutions.com
&gt; 
&gt; 

