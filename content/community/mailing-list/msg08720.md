---
title: "Re: Reading with \"r = all\" always succeeds in Riak 1.2 even when one	of the primary nodes is down?"
description: ""
project: community
lastmod: 2012-09-26T15:45:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08720"
mailinglist_parent_id: "msg08718"
author_name: "Mike Oxford"
project_section: "mailinglistitem"
sent_date: 2012-09-26T15:45:11-07:00
---


What is the time between "node down" and "read with R=3" ?
Did you "shut down" the node or kill it by brutally powering the box down
or yanking the network cable?

It possible that Riak noticed the node\\_down and had already done the
recovery. While net\\_ticktime can be as long as 60 seconds by default, it's
possible that you're hitting the case where you kill it and before you
re-run the read it's already noticed and 'fixed itself?'

Also, if you do a shutdown, the erlang VM is probably linked/monitoring and
being notified that the node is shutting down so it's triggering the
rebalance immediately.

Try by pulling the network cable out of that node. "/sbin/ifconfig eth0
down" \\*\\*may\\*\\* give you the same effect.

-mox

On Wed, Sep 26, 2012 at 2:51 PM, Tatsuya Kawano  wrote:

&gt; Hi,
&gt;
&gt; I'm having hard time to verify this behavior on the Riak wiki with my
&gt; Riak 1.2 test environment. Can anybody help me to figure out what is
&gt; happening?
&gt;
&gt;
&gt; http://wiki.basho.com/Eventual-Consistency.html#Failure-Scenarios
&gt;
&gt; &gt; Reading When One Primary Fails
&gt; &gt; ------------------------------
&gt; &gt;
&gt; &gt; 1. Data is written to a key with W=3
&gt; &gt; 2. One node goes down, it happens to be a primary for that key
&gt; &gt; 3. Data is read from that key with R=3
&gt; &gt; 4. Riak returns not\\_found on first request
&gt; &gt; 5. Read repair ensures data is replicated to a secondary node.
&gt; &gt; Read repair will always occur, regardless of the R value.
&gt; &gt; Even with an R of 2, read repair will kick in and ensure that
&gt; &gt; all nodes responsible for this particular data are consistent.
&gt; &gt; 6. Subsequent reads return correct value with R=3, two values
&gt; &gt; coming from primary and one from secondary nodes
&gt;
&gt;
&gt; At the first read (step 4), Riak should return not\\_found, but it
&gt; actually retuns the correct value. I wonder when read repair will kick
&gt; in in Riak 1.2. (even before the first read?)
&gt;
&gt;
&gt; I followed the screencast "Tuning CAP Controls in Riak" on this page.
&gt; http://wiki.basho.com/Tunable-CAP-Controls-in-Riak.html
&gt;
&gt; I used riak\\_core\\_ring:preflist/2 to ensure that I had took down one of
&gt; the correct primary nodes for the key.
&gt;
&gt; Thanks,
&gt; Tatsuya
&gt;
&gt; --
&gt; Tatsuya Kawano (Mr.)
&gt; Tokyo, Japan
&gt;

