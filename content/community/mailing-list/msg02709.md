---
title: "Re: Multiple disks"
description: ""
project: community
lastmod: 2011-03-22T10:30:18-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02709"
mailinglist_parent_id: "msg02706"
author_name: "Joseph Blomstedt"
project_section: "mailinglistitem"
sent_date: 2011-03-22T10:30:18-07:00
---


&gt; Do the redundant writes still go to different physical nodes or just vnodes
&gt; that might be on the same host and fail at the same time?

This is a standard riak question, and you can find a lot of good
discussion if you search the mailing list.

riak predominately operates at the vnode level, there is no explicit
logic (at write time) to ensure writes are sent to independent nodes.
The write/read logic assumes that vnodes are evenly distributed across
the cluster, and riak does it's best to ensure this is true when
balancing the ring. Operationally, you achieve this best by having the
ring size be a power of 2 and having the number of nodes being a
number that evenly divides the ring size.

For example, a 64-partition ring with 4-nodes and N=3 will in general
send writes to 3 independent nodes, even if a single node is
down/split. A 8-node cluster with the same configuration should have
the same behavior (expect allow for more node failures).

-Joe

On Tue, Mar 22, 2011 at 11:15 AM, Les Mikesell  wrote:
&gt; On 3/22/2011 11:54 AM, Joseph Blomstedt wrote:
&gt;&gt;
&gt;&gt; Let's consider a simple scenario under normal riak. The key concept
&gt;&gt; here is to realize that riak's vnodes are completely independent, and
&gt;&gt; that failure and partition ownership changes are handled through
&gt;&gt; handoff alone.
&gt;&gt;
&gt;&gt; Let's say we have an 8-partition ring with 3 riak nodes:
&gt;&gt; n1 owns partitions 1,4,7
&gt;&gt; n2 owns partitions 2,5,8
&gt;&gt; n3 owns partitions 3,6
&gt;&gt; ie: Ring = (0/n1, 1/n2, 2/n3, 3/n1, 4/n2, 5/n3, 6/n1, 7/n2, 8/n3)
&gt;&gt;
&gt;&gt; Each node runs an independent vnode for each partition it owns, and
&gt;&gt; each vnode will setup it's own bitcask:
&gt;
&gt; Do the redundant writes still go to different physical nodes or just vnodes
&gt; that might be on the same host and fail at the same time?
&gt;
&gt; --
&gt;  Les Mikesell
&gt;   lesmikes...@gmail.com
&gt;
