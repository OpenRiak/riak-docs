---
title: "Why is the data lost in luwak"
description: ""
project: community
lastmod: 2011-12-04T23:57:17-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05854"
author_name: "vuleetu"
project_section: "mailinglistitem"
sent_date: 2011-12-04T23:57:17-08:00
---


Hi, all

 I am working on a storage system which receives data from the client
and stores it to luwak. The server also records the file size of that file
which is uploaded successfully to the database, but i found it is not the
same size as the data in luwak even after several days, so that is not a
consistency problem.

 The following is the main process:

 1) check if file exists already
 luwak\\_file:exists()

 2) if it doesn't exist, will use luwak\\_file:create to create one, or
else will use luwak\\_file:get to get that file handle,

 3) use the last offset which is recorded in database, and the create put
stream
 luwak\\_put\\_stream:start(Riak, RiakFile, Offset, ?STREAM\\_PUT\\_TTL)

 4) receive data from client, and write to put stream created above
 gen\\_tcp: recv()
 luwak\\_put\\_stream:send(PutStream, Binary)

 Is there any possibility that data is lost because one of the riak
node's network is not stable? Because i found when i call
luwak\\_put\\_stream:put(), it just send message contain the data to one
process, so i dont know if data is lost or sent successfully. Even if I
call flush, it is still a request message to that process. Is there any
function to tell me if the write was successful or not? What about if that
riak node goes down in the middle of writing data to luwak, what would
happen, will it cause the data to be lost?


Thanks,
Fisher
