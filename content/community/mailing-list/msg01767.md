---
title: "Re: Riak search schema and nested fields"
description: ""
project: community
lastmod: 2010-12-09T15:36:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01767"
mailinglist_parent_id: "msg01765"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2010-12-09T15:36:07-08:00
---


Hi Artem,

This is expected behavior. There are two things at work here:

\\* When you store a JSON document with a hierarchy of data, the system needs
to flatten the object into fields before it can be indexed, and any fields
with the same name are concatenated.

\\* When you query through the Solr interface, the response needs to be a
valid Solr response, which means that the system is limited to returning a
flat structure.

If your goal is to run a query that returns your original documents with the
hierarchy preserved, you might want to look into querying through the Riak
client. Currently, the Python, PHP, and Erlang clients allow you to run a
search from within the client and retrieve a list of bucket/keys (or,
alternatively, to kick off a map/reduce operation). We plan to add support
to the rest of the clients in the future.

Hope that helps!

Best,
Rusty

, and then those fields are indexed. By default, we concatenate levels of
the hierarchy with underscores.

At retrieval time, if you are querying via Solr then we need to respect the
already established Solr interface, which assumes a

On Thu, Dec 9, 2010 at 3:37 PM, Artem Golovinsky
wrote:

&gt; Hi all,
&gt;
&gt; I have question about Riak Search schema again. Schema -
&gt; http://pastebin.com/0Khh29ku
&gt;
&gt; I make query to find object via solr I get following -
&gt; http://pastebin.com/bY0Dg1Wn
&gt;
&gt; Please look at fields:
&gt;
&gt;
&gt; 1. "known\\_entities\\_count": "1 3 1 1",
&gt; 2. "known\\_entities\\_relevance": "0.858842 0.758043 0.452989 0.427038",
&gt; 3. "known\\_entities\\_text": "mobile phone Twitter Britain API",
&gt; 4. "known\\_entities\\_type": "FieldTerminology Company Country Technology"
&gt; ,
&gt;
&gt;
&gt; But when I try to get this object via
&gt; http://localhost:8098/riak/feeds6/017925890e696568f4447b1ad720fa0c, I get
&gt; normal object in format which was stored in Riak -
&gt; http://pastebin.com/Yjh2ZPPK.
&gt;
&gt;
&gt;
&gt; -
&gt; known\\_entities: [
&gt;
&gt; - -
&gt; {
&gt; - relevance: "0.858842"
&gt; - count: "1"
&gt; - type: "FieldTerminology"
&gt; - text: "mobile phone"
&gt; }
&gt; - -
&gt; {
&gt; - relevance: "0.758043"
&gt; - count: "3"
&gt; - type: "Company"
&gt; - text: "Twitter"
&gt; }
&gt; - -
&gt; {
&gt; - relevance: "0.452989"
&gt; - count: "1"
&gt; - type: "Country"
&gt; - text: "Britain"
&gt; }
&gt; - -
&gt; {
&gt; - relevance: "0.427038"
&gt; - count: "1"
&gt; - type: "Technology"
&gt; - text: "API"
&gt; }
&gt;
&gt; ]
&gt;
&gt;
&gt; All section in "known\\_entities" are separated.
&gt;
&gt; How can I get object in this format via solr in Riak Search? Or is it
&gt; feature of Riak Search?
&gt;
&gt; Thanks in advance!
&gt; --
&gt; Best regards,
&gt; Artem Golovinsky
&gt;

