---
title: "Re: Riak Search Unicode / String TypeError (Python client)"
description: ""
project: community
lastmod: 2011-04-04T16:54:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02884"
mailinglist_parent_id: "msg02872"
author_name: "Mike Stoddart"
project_section: "mailinglistitem"
sent_date: 2011-04-04T16:54:13-07:00
---


Using the following python script to load the basketball tweets, I can
do bucket.get(key), which works. client.search(), doesn't work for me,
get\\_data() returns None:

#!/usr/bin/python

import csv
import riak
import simplejson
import sys
import datetime
import time
import uuid

# Connect to Riak.
client = riak.RiakClient(port=8087, transport\\_class=riak.RiakPbcTransport)

def load\\_csv2(bucket\\_name, filename):

 # Choose the bucket to store data in.
 bucket = client.bucket(bucket\\_name)

 c = csv.reader(open(filename))
 old\\_fields = c.next()
 fields = []
 for f in old\\_fields:
 if f == 'Time(PDT)':
 f = 'timestamp'
 nf = f.lower()
 fields.append(nf)
 print fields

 for row in c:
 data = {
 }

 for ii in range(0,len(fields)-1):
 data[fields[ii]] = row[ii]
 
 ts = data['timestamp']
 dt = datetime.datetime.strptime(data['timestamp'], "%b %d, %Y 
%H:%M:%S")
 ut = time.mktime(dt.timetuple())
 data['timestamp'] = int(ut)

 id = str(uuid.uuid1())
 print dt, id
 obj = bucket.new(id, data=data)
 obj.store(return\\_body=False)

 #~ sys.exit(1)

load\\_csv2('twitter', 'game1.csv')
#~ load\\_csv2('games', 'game2.csv')

Anyone using Riak Search with Python?

Thanks
Mike

On Mon, Apr 4, 2011 at 11:17 AM, Mike Stoddart  wrote:
&gt; I wrote a simple Python client to insert data but when I try to
&gt; perform a query, I get:
&gt;
&gt; Traceback (most recent call last):
&gt;  File "./search.py", line 29, in 
&gt;    row = result.get()
&gt;  File "build/bdist.linux-x86\\_64/egg/riak/mapreduce.py", line 302, in get
&gt;  File "build/bdist.linux-x86\\_64/egg/riak/bucket.py", line 245, in get
&gt;  File "build/bdist.linux-x86\\_64/egg/riak/riak\\_object.py", line 290, in reload
&gt;  File "build/bdist.linux-x86\\_64/egg/riak/transports/pbc.py", line 152, in get
&gt;  File "build/bdist.macosx-10.6-universal/egg/google/protobuf/reflection.py",
&gt; line 510, in setter
&gt;  File 
&gt; "build/bdist.macosx-10.6-universal/egg/google/protobuf/internal/type\\_checkers.py",
&gt; line 91, in CheckValue
&gt; TypeError: u'events' has type , but expected one of:
&gt; (,)
&gt;
&gt; My query is:
&gt;
&gt; search\\_query = client.search('events', 'name:Fred')
&gt;
&gt; Is it complaining about the bucket name? I had to manually build protobuf.
&gt;
&gt; Thanks
&gt; Mike
&gt;

