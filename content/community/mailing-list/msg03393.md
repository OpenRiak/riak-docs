---
title: "Re: Issues with capacity planning pages on wiki"
description: ""
project: community
lastmod: 2011-05-23T22:53:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03393"
mailinglist_parent_id: "msg03392"
author_name: "Anthony Molinaro"
project_section: "mailinglistitem"
sent_date: 2011-05-23T22:53:51-07:00
---

On Mon, May 23, 2011 at 09:57:25PM -0600, David Smith wrote:
&gt; On Mon, May 23, 2011 at 9:39 PM, Anthony Molinaro
&gt;  wrote:
&gt; &gt;
&gt; &gt; Bitcask-Capacity-Planning Cluster-Capacity-Planning Reality
&gt; &gt; RAM 34.9 GB 34.9 GB 70 GB
&gt; &gt; Disk 102 GB 18.49 GB 341 GB
&gt; &gt;
&gt; &gt; So it looks to me like the numbers for RAM are about 1/2 of actual and
&gt; &gt; the number for Disk are completely off, they are different depending on
&gt; &gt; which page you look at on the wiki and vastly underestimate reality.
&gt; 
&gt; So RAM would require a little digging to figure out;

Anything I can do there to help? I'd really like to get to the bottom
of the discrepency with these numbers. I assume everything is stored
as binaries, and I'm not seeing some sort of 64-bit doubling (I know
I convert my keys and values to binaries before sending them to riak).

Here's the output of memory/0 on an attached shell

(riak@10.1.1.31)1&gt; memory().
[{total,7281790968},
 {processes,18543872},
 {processes\\_used,18132704},
 {system,7263247096},
 {atom,825105},
 {atom\\_used,815183},
 {binary,603512},
 {code,8306646},
 {ets,536440}]

Which seems like it's all used by system which is I assume the keydirs in
the driver. Also does the number of partitions impact this value at all?
I have 1024 total on 8 nodes the ring currently looks like

ring\\_ownership : &lt;&lt;"[{'riak@10.1.8.10',128},\\n {'riak@10.1.6.30',128},\\n
{'riak@10.1.10.20',129},\\n {'riak@10.1.1.31',129},\\n {'riak@10.1.2.32',128},\\n
{'riak@10.1.7.6',128},\\n {'riak@10.1.11.18',126},\\n {'riak@10.1.9.9',128}]"&gt;&gt;

Which also seems a bit odd, I would expect them all to be 128, but anyway?

&gt; disk is easier to
&gt; explain. The disk calculations do not take into account (as best I can
&gt; tell) the fact that bitcask is an append-only store and requires
&gt; periodic merging/compaction of the on-disk files.

Is there anyway to force a merge/compaction so I can attempt to better
understand my usage. I know with cassandra I had a way to run compactions
with their nodetool, but riak-admin doesn't seem to have any sort of
controls, unless a backup causes merging to occur.

&gt; Thus, depending on
&gt; your merge triggers, more space can be used than is strictly necessary
&gt; to store the data.

So the lack of any overhead in the calculation is expected? I mean
according to http://wiki.basho.com/Cluster-Capacity-Planning.html

Disk = Estimated Total Objects \\* Average Object Size \\* n\\_val

Which just seems wrong, doesn't it? I don't quite understand the
bitcask code well enough yet to see what the actual data it stores is,
but the whitepaper suggested several things were involved in the on
disk representation.

-Anthony

-- 
------------------------------------------------------------------------
Anthony Molinaro 

