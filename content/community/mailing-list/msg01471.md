---
title: "riak hiccups"
description: ""
project: community
lastmod: 2010-11-05T00:33:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01471"
author_name: "Jan Metzner"
project_section: "mailinglistitem"
sent_date: 2010-11-05T00:33:33-07:00
---


Hi Folks,

after importing a lot of data i fired some map reduce javascript
queries with some strange results.
I had a typo in the first query but the error from this query was also
returned for the other queries.
The queries were not made parallel and the error appears also in the log files.
After restarting the riak server everything went to normal.

Any chance how to avaoid there strange behaviour?

Ciao Jan

Here is the sequence from the riak log files:

=ERROR REPORT==== 4-Nov-2010::16:16:20 ===
\\*\\* State machine &lt;0.19673.82&gt; terminating
\\*\\* Last event in was inputs\\_done
\\*\\* When State == executing
\\*\\* Data == {state,3,riak\\_kv\\_reduce\\_phase,
 {state,
 {javascript,
 {reduce,
 {jsanon,
 &lt;&lt;"function(values, arg){ var
pvalues=[]; for(var i = 0; i &lt; values.length; i++){ if(values[i].id){
if(values[i].wallpost){ pvalues[pvalues.length]=values[i]; } else
if(values[i].comments){ var addEve
nt = false; for(var c=0; c &lt; values[i].comments.length; c++){
if(values[i].comments[c].userId == '100000082183525'){addEvent=true;}}
if(addEvent){pvalues[pvalues.length]=values[i];} }} } return
pvalues.sort(function(a,b){ var autc=a.utc;
 if(a.comments){for(var i=0; i&lt; a.comments.length; i++){ var
cutc=a.comments[i].timestamp; autc=cutc &gt; autc?cutc:autc;}} var
butc=b.utc; if(b.comments){for(var i=0; i&lt; b.comments.length; i++){
var cutc=b.comments[i].timestamp; butc=cutc &gt; butc?cutc:butc;}} var
diff=autc-butc; return diff==0 ? 0 : diff &gt; 0 ? -1 : 1; }); }"&gt;&gt;},
 none,true}},
 [],[]},
 true,true,&lt;0.19674.82&gt;,
 [&lt;0.19674.82&gt;],
 undefined,0,&lt;0.19672.82&gt;,66000}
\\*\\* Reason for termination =
\\*\\* {error,[{&lt;&lt;"lineno"&gt;&gt;,1},
 {&lt;&lt;"message"&gt;&gt;,&lt;&lt;"TypeError: iv.values is undefined"&gt;&gt;},
 {&lt;&lt;"source"&gt;&gt;,&lt;&lt;"unknown"&gt;&gt;}]}

=ERROR REPORT==== 4-Nov-2010::16:17:07 ===
\\*\\* State machine &lt;0.20427.82&gt; terminating
\\*\\* Last event in was inputs\\_done
\\*\\* When State == executing
\\*\\* Data == {state,3,riak\\_kv\\_reduce\\_phase,
 {state,
 {javascript,
 {reduce,
 {jsanon,
 &lt;&lt;"function(values, arg){ var
pvalues=[]; for(var i = 0; i &lt; values.length; i++){ if(values[i].id){
if(values[i].wallpost){ pvalues[pvalues.length]=values[i]; } else
if(values[i].comments){ var addEvent = false; for(var c=0; c &lt;
values[i].comments.length; c++){ if(values[i].comments[c].userId ==
'100000082183525'){addEvent=true;}}
if(addEvent){pvalues[pvalues.length]=values[i];} }} } return
pvalues.sort(function(a,b){ var autc=a.utc; if(a.comments){for(var
i=0; i&lt; a.comments.length; i++){ var cutc=a.comments[i].timestamp;
autc=cutc &gt; autc?cutc:autc;}} var butc=b.utc; if(b.comments){for(var
i=0; i&lt; b.comments.length; i++){ var cutc=b.comments[i].timestamp;
butc=cutc &gt; butc?cutc:butc;}} var diff=autc-butc; return diff==0 ? 0 :
diff &gt; 0 ? -1 : 1; }); }"&gt;&gt;},
 none,true}},
 [],[]},
 true,true,&lt;0.20428.82&gt;,
 [&lt;0.20428.82&gt;],
 undefined,0,&lt;0.20426.82&gt;,66000}
\\*\\* Reason for termination =
\\*\\* {error,[{&lt;&lt;"lineno"&gt;&gt;,1},
 {&lt;&lt;"message"&gt;&gt;,&lt;&lt;"TypeError: iv.values is undefined"&gt;&gt;},
 {&lt;&lt;"source"&gt;&gt;,&lt;&lt;"unknown"&gt;&gt;}]}

