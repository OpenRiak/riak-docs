---
title: "Re: riak / riaksearch fails and returns with \"badarg,	universaltime_to_localtime\" on any mapreduce function"
description: ""
project: community
lastmod: 2010-11-22T16:42:04-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01600"
mailinglist_parent_id: "msg01589"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-11-22T16:42:04-08:00
---


It looks like Riak is hitting this error when trying to jsonify the
metadata, specifically the "X-Riak-Last-Modified" header. The timestamp in
the header works out to be "Sun, 21 Nov 2010 07:28:05 GMT". Your system
seems to be translating it to a date before 1970.

Can you run the following Erlang code while attached to a running Riak node?
calendar:now\\_to\\_local\\_time({1290,324485,31243}).

It should output something like:
{{2010,11,20},{23,28,5}}

Thanks,
Dan


Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Sun, Nov 21, 2010 at 2:10 AM, A. Sebastian Dietzel &lt;
sebast...@dubizzle.com&gt; wrote:

&gt; Hi,
&gt;
&gt; I've trouble getting the mapreduce functions to work in riak and
&gt; riaksearch.
&gt; It fails with some sort of timestamp error, unfortunately I'm not good
&gt; enough in
&gt; Erlang to fix it, but I've attached the error logs and riaksearch-admin
&gt; status output - hope that helps.
&gt;
&gt; So far, I've tried it on my local dev machine (osx - riak/riaksearch source
&gt; installation, tarball and github master branch),
&gt; on centos 5.3 (github master) and on ubuntu,
&gt; the .deb packaged version on ubuntu works and doesn't fail in my test
&gt; cases.
&gt;
&gt; The attached test is written in python based on the test cases in the
&gt; library
&gt; and utilizes the http client from the python library for riak.
&gt; But that shouldn't matter, it also fails via the pbc-python client (I've
&gt; attached logs for that as well),
&gt; as well as in ruby (using the official client) and via curl too.
&gt; I didn't attach any logs for ruby or curl, as they're similar to the http
&gt; based python client.
&gt;
&gt; Since no one else is having these issues, I presume I'm doing something
&gt; wrong
&gt; but I don't know what exactly.
&gt;
&gt; I'm running riak/riaksearch from the console like this:
&gt; ulimit -n 1024
&gt; $PATH\\_TO\\_RIAKS\\_SRC/rel/bin/riaksearch start
&gt;
&gt; or for regular riak:
&gt; $PATH\\_TO\\_RIAK\\_SRC/rel/bin/riak start
&gt;
&gt; This works and starts riak / riaksearch, but as soon as I start doing
&gt; anything mapreduce with the servers they fail with:
&gt;
&gt; ...
&gt; {badarg,[{erlang,universaltime\\_to\\_localtime,[{{1969,12,31},{23,59,59}}]},{calendar,local\\_time\\_to\\_universal\\_time\\_dst,1}
&gt; ...
&gt;
&gt; I'm using Erlang R13B04.
&gt;
&gt; Please let me know if I can provide anything else to help solving this
&gt; issue.
&gt;
&gt; Thank you in advance,
&gt; Sebastian
&gt; --
&gt; A. Sebastian Dietzel (el mariachi)
&gt; sebast...@dubizzle.com
&gt;
&gt;

