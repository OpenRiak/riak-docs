---
title: "Re: Riak search query timeout issues with 1.2.1 stable"
description: ""
project: community
lastmod: 2012-12-20T07:54:07-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09650"
mailinglist_parent_id: "msg09645"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-12-20T07:54:07-08:00
---


On Thu, Dec 20, 2012 at 9:51 AM, Abhinav Singh wrote:

&gt;
&gt;
&gt; error.log on riak@172.17.3.82 contains:
&gt; 2012-12-20 16:27:37.877 [error] &lt;0.1821.0&gt;@mi\\_server:handle\\_info:524
&gt; lookup/range failure:
&gt; {{badfun,#Fun},[{mi\\_server,iterate,6},{mi\\_server,lookup,8}]}
&gt; 2012-12-20 16:27:37.878 [error] emulator Error in process &lt;0.4075.0&gt; on
&gt; node 'riak@172.17.3.82' with exit value:
&gt; {{badfun,#Fun},[{mi\\_server,iterate,6},{mi\\_server,lookup,8}]}
&gt;
&gt; 2012-12-20 16:27:37.878 [error] &lt;0.1940.0&gt;@mi\\_server:handle\\_info:524
&gt; lookup/range failure:
&gt; {{badfun,#Fun},[{mi\\_server,iterate,6},{mi\\_server,lookup,8}]}
&gt; 2012-12-20 16:27:37.882 [error] emulator Error in process &lt;0.4077.0&gt; on
&gt; node 'riak@172.17.3.82' with exit value:
&gt; {{badfun,#Fun},[{mi\\_server,iterate,6},{mi\\_server,lookup,8}]}
&gt;

This is a very specific error and is an indication that the lambda created
in riak\\_search\\_client cannot be instantiated after being sent over the
network. As I said, I have only ever seen this with mixed versions.

&gt; We don't really have mixed riak release. But yes we do have a mixed erlang
&gt; releases. Not sure if that makes any difference here.
&gt;
&gt; riak@172.17.3.82
&gt; Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2]
&gt; [async-threads:0] [kernel-poll:false]
&gt;
&gt; riak@172.17.3.63
&gt; Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:0]
&gt; [hipe] [kernel-poll:false]
&gt;

I bet this is it. In order for a lambda to be reconstructed after being
sent over the wire very specific conditions need to be met. My guess is
either the erlang version is checked explicitly or is part of the module
hash, thus causing this failure. Checkout this post by Kresten Krab Thorup.

http://www.javalimit.com/2010/05/passing-funs-to-other-erlang-nodes.html

&gt; ~~~~~~~~~~~~
&gt;
&gt; Unfortunately none of these error happens on our local dev environment.
&gt; On my local dev box, I run a 5 node cluster (ofcourse all nodes on same
&gt; physical machine).
&gt;

Yes, because they are all using the same erlang version.

-Z
