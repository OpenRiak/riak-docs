---
title: "Re: Problems Executing Erlang Map Reduce"
description: ""
project: community
lastmod: 2011-09-15T13:34:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04756"
mailinglist_parent_id: "msg04754"
author_name: "bill robertson"
project_section: "mailinglistitem"
sent_date: 2011-09-15T13:34:48-07:00
---


I finally found it after looking at the fast track tutorial again.

Mistake #1 -&gt; erlang noob

 Conn = riakc\\_pb\\_socket:start("127.0.0.1", 8091)

is wrong, it should be

 {ok, Conn} = ...

And after that I had the port wrong, (8081-3 for the fast track dev db's).

Thanks!


On Thu, Sep 15, 2011 at 2:32 PM, bill robertson
wrote:

&gt; I have a 0.14.2 dev database set up from the riak fast track tutorial.
&gt;
&gt; I created an Erlang application that creates a new route for webmachine
&gt; upon startup.
&gt;
&gt; configure\\_webmachine() -&gt;
&gt; webmachine\\_router:add\\_route(
&gt; {["foo", bar, '\\*'], myapp\\_myresource, []}).
&gt;
&gt; I modified vm.args for all three instances to point to the application by
&gt; adding the following lines.
&gt;
&gt; -pa /home/me/my\\_app/ebin
&gt; -s my\\_app
&gt;
&gt; I am able to reach the /foo URL from all three instances of Riak
&gt; (localhost:8091-93). So I assume that every instance also has access to my
&gt; map-reduce code too.
&gt;
&gt; Also included in the application is a module with a test map-reduce query
&gt; in it. I have a binary encoded Erlang term stored in the database, and I am
&gt; down to simply trying to just retrieve the one entry and return 'something'
&gt; from a map function. (i.e. I've been cutting things out until there is
&gt; nothing left to cut out), and I am receiving errors.
&gt;
&gt; Here is the mapred code.
&gt;
&gt; Conn = riakc\\_pb\\_socket:start("127.0.0.1", 8091),
&gt; A = fun(Value, Key, Arg) -&gt; args(Value, Key, Arg) end,
&gt; Result = riakc\\_pb\\_socket:mapred(Conn, [{&lt;&lt;"bucket"&gt;&gt;, &lt;&lt;"key"&gt;&gt;}],
&gt; [{map, {qfun, A}, none, true}]),
&gt;
&gt; args(\\_Value, \\_Key, \\_Arg) -&gt;
&gt; [args].
&gt;
&gt; This code bombs, and then I get the following back from webmachine in the
&gt; browsers (binary goo elided).
&gt;
&gt; Internal Server Error
&gt; The server encountered an error while processing this request:
&gt;
&gt; {error,
&gt; {exit,
&gt; {{function\\_clause,
&gt; [{gen,call,
&gt; [{ok,&lt;0.268.0&gt;},
&gt; '$gen\\_call',
&gt; {req,
&gt; {rpbmapredreq,
&gt; &lt;&lt;131,108, ...,106&gt;&gt;,
&gt; &lt;&lt;"application/x-erlang-binary"&gt;&gt;},
&gt; 60100,
&gt; {1061003,&lt;0.252.0&gt;}},
&gt; 60000]},
&gt; {gen\\_server,call,3},
&gt; {riakc\\_pb\\_socket,mapred,5},
&gt; {myapp\\_mapred,do\\_mapred,6},
&gt; {myapp\\_myresource,to\\_html,2},
&gt; {webmachine\\_resource,resource\\_call,3},
&gt; {webmachine\\_resource,do,3},
&gt; {webmachine\\_decision\\_core,resource\\_call,1}]},
&gt; {gen\\_server,call,
&gt; [{ok,&lt;0.268.0&gt;},
&gt; {req,
&gt; {rpbmapredreq,
&gt; &lt;&lt;131,108, ...,106&gt;&gt;,
&gt; &lt;&lt;"application/x-erlang-binary"&gt;&gt;},
&gt; 60100,
&gt; {1061003,&lt;0.252.0&gt;}},
&gt; 60000]}},
&gt; [{gen\\_server,call,3},
&gt; {riakc\\_pb\\_socket,mapred,5},
&gt; {myapp\\_mapred,do\\_mapred,6},
&gt; {myapp\\_myresource,to\\_html,2},
&gt; {webmachine\\_resource,resource\\_call,3},
&gt; {webmachine\\_resource,do,3},
&gt; {webmachine\\_decision\\_core,resource\\_call,1},
&gt; {webmachine\\_decision\\_core,decision,1}]}}
&gt;
&gt; sasl-error.log and erlang.log has the same error information as from the
&gt; browser on the node that I made the request to. I checked the logs of one of
&gt; the other nodes and found nothing.
&gt;
&gt; I must be doing something wrong, but I have no idea what.
&gt;
&gt; Any suggestions as to what to do?
&gt;
