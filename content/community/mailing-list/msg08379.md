---
title: "Re: Emulating composite index queries with secondary indexes and key	filters"
description: ""
project: community
lastmod: 2012-08-28T04:51:59-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08379"
mailinglist_parent_id: "msg08378"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2012-08-28T04:51:59-07:00
---


As best as I can recall, you can't key filter on 2i. You can, however,
perform range filtering. You could query where the 2i key is between
20110101T00:00:00Z|a|a and 20110201T00:00:00Z|zzz|zzz

Please forgive any typos. I'm using a phone.

On Tuesday, August 28, 2012, Olav Frengstad wrote:

&gt; Hey,
&gt;
&gt; I'm looking to use riak to store time series. So naturaly i'm in the
&gt; processes of validating all possible methods this query. A object
&gt; has a id, origin, timestamp and type. The query in question is to
&gt; select all object within a time range that originated from "origin"
&gt; and has a certain "type".
&gt;
&gt; The current plan is to store the timestamp as a secondary index and
&gt; then have composite keys responsible for matching origin/type predicate.
&gt;
&gt; A key would look like this: "::".
&gt;
&gt; To query one would just pipe the 2i query to key filter map reduce:
&gt;
&gt; curl -X POST -H "Content-Type: application/json" -d '{"inputs":{
&gt; "bucket" : "seriesx", "index" : "timestamp\\_int", "start" : 123,
&gt; "end" : 456, "key\\_filters" : [["ends\\_with", ":"]]}}'
&gt;
&gt; In regards to this "imaginary" solution i have a few questions:
&gt; 1) is this possible, or does key filter only work on a bucket?
&gt; 2) Would this be a efficient solution, considering the 2i query
&gt; will return 10k+ results? the reduce should cut that in half.
&gt; 3) What other options to i have for querying this? Obviously i can
&gt; use Riak search, but the term based indexing puts me off. Other
&gt; option is building this manually with empty object just linking.
&gt;
&gt; --
&gt; Med Vennlig Hilsen
&gt; Olav Frengstad
&gt;
&gt; Systemutvikler // FWT
&gt; +47 920 42 090
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;


-- 
---
Jeremiah Peschka
Managing Director, Brent Ozar PLF, LLC
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

