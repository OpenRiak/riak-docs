---
title: "Re: Riak.mapValuesJson crashes on \\r\\n"
description: ""
project: community
lastmod: 2011-03-23T14:14:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02718"
mailinglist_parent_id: "msg02717"
author_name: "Michael Ossareh"
project_section: "mailinglistitem"
sent_date: 2011-03-23T14:14:15-07:00
---


Thanks for the super quick response - 3 minutes!

I grabbed Crockford's json2.js and had to disable his check for existing
implementations. I've documented this here:
http://ossareh.posterous.com/how-to-patch-riak-0140-to-avoid-the-newline-p

Cheers,

mike

On Wed, Mar 23, 2011 at 13:34, Aphyr  wrote:

&gt; Newline parsing is broken in JSON2.js shipped with Riak. Drop a more recent
&gt; version of JSON2.js in the directory referred to by js\\_source\\_dir in
&gt; app.config's riak\\_kv section, e.g.
&gt;
&gt; {js\\_source\\_dir, "/etc/riak/js/"}
&gt;
&gt; and reload the node.
&gt;
&gt; --Kyle
&gt;
&gt;
&gt; On 03/23/2011 01:31 PM, Michael Ossareh wrote:
&gt;
&gt;&gt; Greets,
&gt;&gt;
&gt;&gt; https://gist.github.com/883872
&gt;&gt;
&gt;&gt; That stack trace is the product of calling Riak.mapValuesJson in a map
&gt;&gt; phase of a map reduce job. I checked the same parsing against Chrome and
&gt;&gt; Firefox and they both parse the string as I'd expect. The object, as a
&gt;&gt; string, that is being parsed is:
&gt;&gt;
&gt;&gt; "{\\"bar\\":\\"baz\\\\r\\\\nfrob\\"}"
&gt;&gt;
&gt;&gt; The setup is: Riak 0.14.0 on Mac OS X 10.6.6 and CentOS 5.5
&gt;&gt;
&gt;&gt;
&gt;&gt; Any advice / pointers, greatly appreciated. Also, let me know if there
&gt;&gt; is anything else I can do to help.
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt;
&gt;&gt; mike
&gt;&gt;
&gt;&gt;

&gt;
