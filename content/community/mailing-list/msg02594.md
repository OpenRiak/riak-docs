---
title: "annoying javascript problem in Reduce phases"
description: ""
project: community
lastmod: 2011-03-10T02:32:38-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02594"
author_name: "Antonio Rohman Fernandez"
project_section: "mailinglistitem"
sent_date: 2011-03-10T02:32:38-08:00
---




Dear All,
I'm having a pretty annoying Javascript problem and would
like to know if is a bug (most likely) or if somebody has a solution.


This is the sample data i'm playing with:
bucket -&gt;
'testbucket'
key00001:{"name":"antonio","dob":1981,"country":"Spain"}
key00002:{"name":"rohman","dob":1982,"country":"Taiwan"}
key00003:{"name":"fernandez","dob":1983,"country":"US"}
key00004:{"name":"lee","dob":1984,"country":"Japan"}
key00005:{"name":"bruce","dob":1985,"country":"China"}


MAP ONLY:
{"inputs":"testbucket","query":[{"map":{"language":"javascript","source":"function(v,k,a)
{ return [v.values[0].data]; }"}}]}

The Mapping phase ( nothing
special, just gives back the values of all keys in the bucket ) gives
the correct data, an array of all my key's
values:
["{"name":"rohman","dob":1982,"country":"Taiwan"}",
"{"name":"bruce","dob":1985,"country":"China"}",
"{"name":"fernandez","dob":1983,"country":"US"}",
"{"name":"antonio","dob":1981,"country":"Spain"}",
"{"name":"lee","dob":1984,"country":"Japan"}"]


REDUCE (try1:OK):
{"inputs":"testbucket","query":[{"map":{"language":"javascript","source":"function(v,k,a)
{ return [v.values[0].data]; }"}},{"reduce":
{"language":"javascript","source":"function(v,a) { return v; }"}}]}


This kinda useless Reduce phase returns the data as it is, even the
order is reversed... seems
ok:
["{"name":"lee","dob":1984,"country":"Japan"}",
"{"name":"fernandez","dob":1983,"country":"US"}",
"{"name":"rohman","dob":1982,"country":"Taiwan"}",
"{"name":"antonio","dob":1981,"country":"Spain"}",
"{"name":"bruce","dob":1985,"country":"China"}"]

REDUCE
(try2:OK):
{"inputs":"testbucket","query":[{"map":{"language":"javascript","source":"function(v,k,a)
{ return [v.values[0].data]; }"}},{"reduce":
{"language":"javascript","source":"function(v,a) { return [v[1]]; }"}}]}


This Reduce phase just return the 2nd item array[1] of the result...
seems ok too!:
["{"name":"fernandez","dob":1983,"country":"US"}"]


REDUCE (try3:!!!!!):
{"inputs":"testbucket","query":[{"map":{"language":"javascript","source":"function(v,k,a)
{ return [v.values[0].data]; }"}},{"reduce":
{"language":"javascript","source":"function(v,a) { return [v[3]]; }"}}]}


This Reduce phase SHOULD return the 4th item of the array... but
returns NULL!!!!:
[null] 
{"name":"fernandez","dob":1983,"country":"US"}
 [2] =&gt;
{"name":"rohman","dob":1982,"country":"Taiwan"}
 [3] =&gt; Array (
 [0] =&gt;
{"name":"antonio","dob":1981,"country":"Spain"}
 [1] =&gt;
{"name":"bruce","dob":1985,"country":"China"}
 )
)

I don't know what is
going on with the javascript Reduce phase... but is killing me...
return
v --&gt; OK
return [v[0]] --&gt; OK
return [v[1]] --&gt; OK
return [v[2]] --&gt;
OK
return [v[3]] --&gt; ERROR ( and so on )

any ideas? thanks
Rohman

 
[1]

ANTONIO ROHMAN FERNANDEZ
CEO, Founder & Lead
Engineer
roh...@mahalostudio.com [2] 
PROJECTS
MaruBatsu.es
[3]
PupCloud.com [4]
Wedding Album [5]

 

Links:
------
[1]
http://mahalostudio.com
[2] mailto:roh...@mahalostudio.com
[3]
http://marubatsu.es
[4] http://pupcloud.com
[5]
http://wedding.mahalostudio.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

