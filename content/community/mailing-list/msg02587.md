---
title: "Re: missing_field error using riaksearch"
description: ""
project: community
lastmod: 2011-03-09T09:55:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02587"
mailinglist_parent_id: "msg02585"
author_name: "Morten Siebuhr"
project_section: "mailinglistitem"
sent_date: 2011-03-09T09:55:14-08:00
---


Hi,

On Wed, Mar 9, 2011 at 3:50 PM, Rusty Klophaus  wrote:
&gt; Hi Morten,
&gt; The error message is indicating that your document contains an
&gt; "organizations\\_name" field, but that the field doesn't exist in your schema.
&gt; Your options are to either add a field definition for "organizations\\_name"
&gt; to the schema, or add a dynamic field definition to the end of your schema
&gt; that catches any fields that weren't previously matched, and maps them to
&gt; some data type.
&gt; The wiki contains more information on dynamic fields
&gt; (http://wiki.basho.com/Riak-Search---Schema.html) but you can also just copy
&gt; the entries from the default schema.

Thanks for the quick response!

It turned out I'd missed the difference between using:

 {field, [{name, "\\*"}, ...]}

and:

 {dynamic\\_field, [{name, "\\*"}, ...]}

Likewise, I had not quite gotten the fact that all fields must
explicitly be covered in the schema definition, not just the subset
you want to do searches on.

&gt;&gt; Hi all,
&gt;&gt;
&gt;&gt; I'm trying to use Riak + Riaksearch as a datastore for Portable
&gt;&gt; Contacts [1], but I'm running into a spot of trouble making riaksearch
&gt;&gt; actually work;
&gt;&gt;
&gt;&gt; I've set up riaksearch with the following schema document:
&gt;&gt;
&gt;&gt; {
&gt;&gt;        schema,
&gt;&gt;        [
&gt;&gt;                {version, "0.1"}, {default\\_field, "\\_owner"}, {n\\_val, 1}
&gt;&gt;        ],
&gt;&gt;        [
&gt;&gt;                %% Don't parse \\_id and \\_owner, just treat it as single
&gt;&gt; token
&gt;&gt;                {field, [       {name, "id"},
&gt;&gt;                                {required, true},
&gt;&gt;                                {analyzer\\_factory, {erlang, text\\_analyzers,
&gt;&gt; noop\\_analyzer\\_factory}}
&gt;&gt;                        ]},
&gt;&gt;                {field, [       {name, "\\_owner"},
&gt;&gt;                                {required, true},
&gt;&gt;                                {analyzer\\_factory, {erlang, text\\_analyzers,
&gt;&gt; noop\\_analyzer\\_factory}}
&gt;&gt;                        ]},
&gt;&gt;                %% Parse Name fields for full-text indexing
&gt;&gt;                {field, [       {name, "displayName"},
&gt;&gt;                                {aliases, ["nickname", "preferredUsername",
&gt;&gt; "name\\_formatted",
&gt;&gt; "name\\_displayName"]},
&gt;&gt;                                {analyzer\\_factory, {erlang, text\\_analyzers,
&gt;&gt; standard\\_analyzer\\_factory}}
&gt;&gt;                        ]},
&gt;&gt;                {field, [       {name, "emails\\_value"},
&gt;&gt;                                {analyzer\\_factory, {erlang, text\\_analyzers,
&gt;&gt; standard\\_analyzer\\_factory}}
&gt;&gt;                        ]},
&gt;&gt;
&gt;&gt;                %% Add modification dates
&gt;&gt;                {field, [       {name, "published"},
&gt;&gt;                                {aliases, ["updated"]},
&gt;&gt;                                {type, date}
&gt;&gt;                        ]}]}.
&gt;&gt;
&gt;&gt; (Edited slightly for shortness...)
&gt;&gt;
&gt;&gt; I then add it using
&gt;&gt; &gt; sudo sudo search-cmd set\\_schema PortableContacts
&gt;&gt; &gt; `pwd`/pocolib/drivers/riak-search/schema.erl
&gt;&gt;
&gt;&gt; And enable it on the 'PortableContacts' bucket:
&gt;&gt; &gt; sudo search-cmd install PortableContacts
&gt;&gt;
&gt;&gt; (BTW: It is not entirely clear from
&gt;&gt; https://wiki.basho.com/Riak-Search---Schema.html if the schema name
&gt;&gt; must match the bucket it should work for. At least, I'm not entirely
&gt;&gt; sure.)
&gt;&gt;
&gt;&gt; But when I then try to push a contact entry, it coughs up an 500
&gt;&gt; Internal Server Error:
&gt;&gt;
&gt;&gt; curl -v -d '{"organizations": [{"name": "nickels principles", "title":
&gt;&gt; "curvier floppies"}], "displayName": "reverberating agrarian clue",
&gt;&gt; "name": {"givenName": "reverberating", "formatted": "reverberating
&gt;&gt; agrarian clue", "familyName": "agrarian clue"}, "emails": [{"value":
&gt;&gt; "short...@example.com"}], "\\_owner": "m...@one.com", "published":
&gt;&gt; "2010-04-26T13:10:33Z", "id": "48cad5d0-f057-4316-905e-281d1da32a01"}'
&gt;&gt; -H "Content-Type: application/json"
&gt;&gt;
&gt;&gt; http://localhost:8098/riak/PortableContacts/48cad5d0-f057-4316-905e-281d1da32a01
&gt;&gt; \\* About to connect() to localhost port 8098 (#0)
&gt;&gt; \\*   Trying ::1... Connection refused
&gt;&gt; \\*   Trying 127.0.0.1... connected
&gt;&gt; \\* Connected to localhost (127.0.0.1) port 8098 (#0)
&gt;&gt; &gt; POST /riak/PortableContacts/48cad5d0-f057-4316-905e-281d1da32a01
&gt;&gt; &gt; HTTP/1.1
&gt;&gt; &gt; User-Agent: curl/7.19.7 (i486-pc-linux-gnu) libcurl/7.19.7
&gt;&gt; &gt; OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15
&gt;&gt; &gt; Host: localhost:8098
&gt;&gt; &gt; Accept: \\*/\\*
&gt;&gt; &gt; Content-Type: application/json
&gt;&gt; &gt; Content-Length: 396
&gt;&gt; &gt;
&gt;&gt; &lt; HTTP/1.1 500 Internal Server Error
&gt;&gt; &lt; Vary: Accept-Encoding
&gt;&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt;&gt; &lt; Date: Wed, 09 Mar 2011 13:51:50 GMT
&gt;&gt; &lt; Content-Type: text/html
&gt;&gt; &lt; Content-Length: 749
&gt;&gt; &lt;
&gt;&gt; 500 Internal Server
&gt;&gt; ErrorInternal Server Error
=====================

The server
&gt;&gt; encountered an error while processing this
&gt;&gt; request:  

```
{error,{error,badarg,
&gt;&gt;              [{erlang,iolist_to_binary,
&gt;&gt;                       [{error,missing_field,&lt;&lt;"organizations_name"&gt;&gt;}]},
&gt;&gt;               {wrq,append_to_response_body,2},
&gt;&gt;               {riak_kv_wm_raw,accept_doc_body,2},
&gt;&gt;               {webmachine_resource,resource_call,3},
&gt;&gt;               {webmachine_resource,do,3},
&gt;&gt;               {webmachine_decision_core,resource_call,1},
&gt;&gt;               {webmachine_decision_core,decision,1},
&gt;&gt; * Connection #0 to host localhost left intact
&gt;&gt; * Closing connection #0
&gt;&gt;
&gt;&gt; {webmachine_decision_core,handle_request,2}]}}
```


---

mochiweb+webmachine
&gt;&gt; web server


&gt;&gt;
&gt;&gt;
&gt;&gt; Any ideas as to where I'm doing something wrong?
&gt;&gt;
&gt;&gt; I'm using version 0.14.0-1 of both products on Ubuntu 10.4 x86.
&gt;&gt;
&gt;&gt; [1] http://portablecontacts.net/draft-spec.html
&gt;&gt;
&gt;&gt; --
&gt;&gt; Morten Siebuhr
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

