---
title: "Re: riak-1.0.0pre2 segfaults"
description: ""
project: community
lastmod: 2011-09-12T19:19:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04678"
mailinglist_parent_id: "msg04675"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2011-09-12T19:19:33-07:00
---


Henrik,

I'm not familiar with riaktant but it looks like an invalid query is being
passed in. I.e. an empty query. This empty query causes and error in the
query parser and then it appears a segfault in the js driver.

E.g. here I replicate the error at the console:

(riak@127.0.0.1)5&gt; search:search(&lt;&lt;"bucket"&gt;&gt;, &lt;&lt;&gt;&gt;).
\\*\\* exception error: no match of right hand side value
{error,{lucene\\_parse,"syntax error before: "}}
 in function riak\\_search\\_client:parse\\_query/3
 in call from search:search/3

-Ryan

On Mon, Sep 12, 2011 at 4:09 PM, Henrik Johansen  wrote:

&gt; Hello list,
&gt;
&gt; I have been playing with single node riak-1.0.0pre2 cluster & riaktant
&gt; today and somehow I managed to get riak to segfault every time I tried using
&gt; the MapReduce functions in riaktant.
&gt;
&gt; Riak-1.0.0pre2 was installed using the 64-bit Debian package on my
&gt; Ubuntu 11.04 laptop - riaktant was pulled form GitHub.
&gt;
&gt; I have gathered some relevant info below - if I can assist in any way
&gt; please let me know ...
&gt;
&gt; dmesg :
&gt; [10488.941750] beam.smp[1496]: segfault at 7f4d61d73ff8 ip 00007f4d5ea7a83e
&gt; sp 00007f4d61d74000 error 6 in erlang\\_js\\_drv.so[7f4d5ea35000+\\*\\*e6000]
&gt; [10944.335495] beam.smp[4681]: segfault at 7fcda9892ff8 ip 00007fcda386783e
&gt; sp 00007fcda9893000 error 6 in erlang\\_js\\_drv.so[7fcda3822000+\\*\\*e6000]
&gt; [11658.589251] beam.smp[6604]: segfault at 7fee7166eff8 ip 00007fee6dc4983e
&gt; sp 00007fee7166f000 error 6 in erlang\\_js\\_drv.so[7fee6dc04000+\\*\\*e6000]
&gt;
&gt; crash.log :
&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt; Supervisor: {local,riak\\_pipe\\_builder\\_sup}
&gt; Context: child\\_terminated
&gt; Reason:
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; Offender:
&gt; [{pid,&lt;0.1556.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt; builder,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt; shutdown,brutal\\_kill},{child\\_\\*\\*type,worker}]
&gt;
&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt; Supervisor: {local,riak\\_pipe\\_fitting\\_sup}
&gt; Context: child\\_terminated
&gt; Reason:
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; Offender:
&gt; [{pid,&lt;0.1558.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt; fitting,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt; shutdown,2000},{child\\_type,\\*\\*worker}]
&gt;
&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt; Supervisor: {local,riak\\_pipe\\_fitting\\_sup}
&gt; Context: child\\_terminated
&gt; Reason:
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; Offender:
&gt; [{pid,&lt;0.1559.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt; fitting,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt; shutdown,2000},{child\\_type,\\*\\*worker}]
&gt;
&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt; Supervisor: {local,riak\\_pipe\\_fitting\\_sup}
&gt; Context: child\\_terminated
&gt; Reason:
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; Offender:
&gt; [{pid,&lt;0.1557.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt; fitting,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt; shutdown,2000},{child\\_type,\\*\\*worker}]
&gt;
&gt; error.log :
&gt; 2011-09-12 21:49:03.025 [error] &lt;0.132.0&gt; Supervisor riak\\_pipe\\_builder\\_sup
&gt; had child at module undefined at &lt;0.1556.0&gt; exit with reason
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; in context child\\_terminated
&gt; 2011-09-12 21:49:03.028 [error] &lt;0.133.0&gt; Supervisor riak\\_pipe\\_fitting\\_sup
&gt; had child at module undefined at &lt;0.1558.0&gt; exit with reason
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; in context child\\_terminated
&gt; 2011-09-12 21:49:03.031 [error] &lt;0.133.0&gt; Supervisor riak\\_pipe\\_fitting\\_sup
&gt; had child at module undefined at &lt;0.1559.0&gt; exit with reason
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; in context child\\_terminated
&gt; 2011-09-12 21:49:03.033 [error] &lt;0.133.0&gt; Supervisor riak\\_pipe\\_fitting\\_sup
&gt; had child at module undefined at &lt;0.1557.0&gt; exit with reason
&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt; error before:
&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt; 3-fun-0-',3}]}
&gt; in context child\\_terminated
&gt;
&gt; /HenrikJ
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\\*\\*mailman/listinfo/riak-users\\_\\*\\*lists.basho.com
&gt;
