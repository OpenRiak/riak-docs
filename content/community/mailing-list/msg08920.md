---
title: "Re: Riak mapreduce function map_object_value return empty result on	erlang pb client"
description: ""
project: community
lastmod: 2012-10-15T08:55:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08920"
mailinglist_parent_id: "msg08878"
author_name: "Bryan Fink"
project_section: "mailinglistitem"
sent_date: 2012-10-15T08:55:48-07:00
---


On Thu, Oct 11, 2012 at 1:32 AM, Mikhail Kuznetsov
 wrote:
&gt; I use riak erlang client for my project, and update riak and client library
&gt; today from master(client to 1.3.1 and server to 1.2.0). Everything works
&gt; except fetching multiple entities with map-reduce return empty. Instead of
&gt; usual result {ok, [...,{,},...]} I get {ok,[]}.
&gt; Rollback with client and everything works ok. But if I use old client with
&gt; new riak I got a lot of errors in the server logs.

Hi, Mikhail. I'm not surprised by the old-client-with-new-riak errors.
The definitions of some protocol buffers changed in the 1.2.0 Riak
release, iirc.

As for the missing results, though, I've been unable to reproduce the
issue as you reported. Using Riak 1.2.0 and riak-erlang-client 1.3.1:


1&gt; {ok, S} = riakc\\_pb\\_socket:start("127.0.0.1", 8087).
{ok,&lt;0.33.0&gt;}

2&gt; BK = [{&lt;&lt;"mk"&gt;&gt;,&lt;&lt;"1"&gt;&gt;},{&lt;&lt;"mk"&gt;&gt;,&lt;&lt;"2"&gt;&gt;},{&lt;&lt;"mk"&gt;&gt;,&lt;&lt;"3"&gt;&gt;}].
[{&lt;&lt;"mk"&gt;&gt;,&lt;&lt;"1"&gt;&gt;},{&lt;&lt;"mk"&gt;&gt;,&lt;&lt;"2"&gt;&gt;},{&lt;&lt;"mk"&gt;&gt;,&lt;&lt;"3"&gt;&gt;}]

3&gt; [ riakc\\_pb\\_socket:put(S, riakc\\_obj:new(B, K, K)) || {B, K} &lt;- BK ].
[ok,ok,ok]

4&gt; {ok, [{0,Result}]} = riakc\\_pb\\_socket:mapred(S, BK, [{map, {modfun,
riak\\_kv\\_mapreduce, map\\_object\\_value},undefined, true}]).
{ok,[{0,[&lt;&lt;"1"&gt;&gt;,&lt;&lt;"2"&gt;&gt;,&lt;&lt;"3"&gt;&gt;]}]}

Can you see where my example differs from yours?

-Bryan

