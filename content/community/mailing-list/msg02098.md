---
title: "Re: running erlang map phases via REST API"
description: ""
project: community
lastmod: 2011-01-24T12:34:34-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02098"
mailinglist_parent_id: "msg02097"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-01-24T12:34:34-08:00
---


Hi Brendan,

Anonymous Erlang functions are not currently supported in map reduce phases.
Is this a feature the community would find valuable?

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Mon, Jan 24, 2011 at 12:14 PM, Brendan  wrote:

&gt; is it possible to pass erlang anonymous funs via the REST API? i took a
&gt; javascript query, replaced "language":"javascript" with
&gt; "language":"erlang" and changed the source to an anonymous fun, but i
&gt; end up getting an error from the REST API back.am i doing something
&gt; wrong here, or can erlang functions only be called using the "module"
&gt; and "function" fields?
&gt;
&gt; the anonymous erlang fun was pulled from the Phase Functions-&gt;Map
&gt; Function examples section of the http://wiki.basho.com/MapReduce.html
&gt; wiki page.
&gt;
&gt; [dev.a]brendan@build01:~/riak$ curl -X PUT -d 'stuff'
&gt; http://127.0.0.1:8098/riak/bucket/object
&gt; [dev.a]brendan@build01:~/riak$ curl -X GET
&gt; http://127.0.0.1:8098/riak/bucket/object; echo
&gt; stuff
&gt; [dev.a]brendan@build01:~/riak$ cat erl2
&gt; {
&gt; "inputs": [
&gt; [
&gt; "bucket",
&gt; "object"
&gt; ]
&gt; ],
&gt; "query": [
&gt; {
&gt; "map": {
&gt; "language": "erlang",
&gt; "source":
&gt; "fun(Value,\\_Keydata,\\_Arg)-&gt;[[riak\\_object:get\\_value(Value)]] end."
&gt; }
&gt; }
&gt; ]
&gt; }
&gt; [dev.a]brendan@build01:~/riak$ curl -X POST -H
&gt; "content-type:application/json" http://localhost:8098/mapred --data @erl2
&gt; 500 Internal Server
&gt; ErrorInternal Server Error
=====================

The server
&gt; encountered an error while processing this request:  

```
{error,badarg,
&gt;       [{erlang,binary_to_list,[undefined]},
&gt;        {riak_kv_mapred_json,bin_to_atom,1},
&gt;        {riak_kv_mapred_json,parse_step,2},
&gt;        {riak_kv_mapred_json,parse_query,2},
&gt;        {riak_kv_mapred_json,parse_request,1},
&gt;        {riak_kv_wm_mapred,verify_body,2},
&gt;        {riak_kv_wm_mapred,malformed_request,2},
&gt;
&gt;
&gt; {webmachine_resource,resource_call,3}]}
```


---

mochiweb+webmachine
&gt; web server


&gt;
&gt;
&gt;

