---
title: "Re: Riak handling of mismatched n_val within cluster"
description: ""
project: community
lastmod: 2012-12-18T17:20:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09627"
mailinglist_parent_id: "msg09626"
author_name: "David Lowell"
project_section: "mailinglistitem"
sent_date: 2012-12-18T17:20:52-08:00
---


We're not entirely sure of the exact timeline. But here's what we think 
happened. We were building a new cluster, and put a common config on both boxes 
with default n\\_val = 3. We then manually changed that config on both boxes to 
n\\_val=1. We restarted riak on one of the nodes, but forgot to restart on the 
other so it's n\\_val=3 was still in effect. 

That's our best guess.

Dave 

--
Dave Lowell
d...@connectv.com

On Dec 18, 2012, at 3:17 PM, Mark Phillips wrote:

&gt; Hey David,
&gt; 
&gt; So the short answer is that we don't have anything in place that will
&gt; complain wildly if this happens. This, however, should not be the
&gt; case. Before I go file an issue, out of curiosity, how did this
&gt; happen? Did you set the n\\_val differently in the app.config of each
&gt; node before you started them up?
&gt; 
&gt; Mark
&gt; 
&gt; 
&gt; On Fri, Dec 14, 2012 at 8:03 PM, David Lowell  wrote:
&gt;&gt; I know this is really very boneheaded. But we ended up with n\\_val being 3 on
&gt;&gt; one of two riak hosts in a dev cluster, and 1 on the other host. I would
&gt;&gt; have expected Riak to howl loudly about this, but it said nothing. In fact,
&gt;&gt; we discovered the problem while debugging app-level issues that resulted
&gt;&gt; from this configuration.
&gt;&gt; 
&gt;&gt; We found that on the two hosts, the same 2i query returned wildly different
&gt;&gt; results. As we investigated we discovered that on the host with n=1, riak
&gt;&gt; was returning each key 3 times. On the host with n=3, each key was in the 2i
&gt;&gt; results once.
&gt;&gt; 
&gt;&gt; Maybe this makes sense at some low level, but I sure would have preferred
&gt;&gt; something in the logs, or even a riak crash to this behavior.
&gt;&gt; 
&gt;&gt; Once we corrected n\\_val on the errant host, both hosts returned each key 3x.
&gt;&gt; Is it possible for riak to recover from this situation and eventually return
&gt;&gt; the correct 2i results with each key listed only once?
&gt;&gt; 
&gt;&gt; This is a dev cluster, so this isn't critical. But I'd like to understand
&gt;&gt; better whether and how riak can recover from this weird state.
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Dave
&gt;&gt; 
&gt;&gt; --
&gt;&gt; Dave Lowell
&gt;&gt; d...@connectv.com
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 

