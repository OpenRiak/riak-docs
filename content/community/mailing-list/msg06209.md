---
title: "Re: documents disappear from riak search index"
description: ""
project: community
lastmod: 2012-01-10T08:46:21-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06209"
mailinglist_parent_id: "msg06208"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-01-10T08:46:21-08:00
---


Typically, something like this would be caused by replicas being lost as
Search currently has no anti-entropy. I imagine you would have mentioned
replica loss if that was the case, though. You've seen this problem at
least twice, correct? Were there other occurrences? If so how many and
about how often do you notice them? Did any other system events happen
that might be correlated such as spike in load, faulty disks, node
join/leave/remove, node down/up, etc.

On Tue, Jan 10, 2012 at 11:31 AM, francisco treacy &lt;
francisco.tre...@gmail.com&gt; wrote:

&gt; 2012/1/10 Ryan Zezeski :
&gt; &gt; When you say "doesn't show up on the search query results \\*anymore\\*" does
&gt; &gt; that imply that at one time they did?
&gt;
&gt; Absolutely. As a matter of fact that's what some of my users were
&gt; asking: "why can't I see X anymore?".
&gt;
&gt; &gt; I'm trying to understand if the index
&gt; &gt; entries appear to have been lost or if it was never successfully written
&gt; in
&gt; &gt; the first place.
&gt;
&gt; They are definitely written to the index in the first place. I recall
&gt; noticing a similar situation early December, where I compared item
&gt; counts from a full-bucket map/reduce vs. a search map/reduce and they
&gt; didn't match.
&gt;
&gt; Went about it by re-saving all items in the bucket as I said before.
&gt; Did a check just after, and numbers matched.
&gt;
&gt; And this morning I was back to the inequality after a user complaint,
&gt; so passed the re-save script once again. Obviously this is not
&gt; sustainable.
&gt;
&gt; The curious thing is that those documents are not even regularly
&gt; updated or deleted.
&gt;
&gt; &gt; Any errors you see in the logs may be relevant. Feel free to include
&gt; &gt; snippets of anything you find.
&gt;
&gt; I went through all sasl-error.log from all 3 nodes and couldn't find
&gt; anything related to search. Where else could I look? Do you have any
&gt; idea what could be causing this behaviour?
&gt;
&gt; Francisco
&gt;
&gt; &gt;
&gt; &gt; On Tue, Jan 10, 2012 at 4:16 AM, francisco treacy
&gt; &gt;  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi all,
&gt; &gt;&gt;
&gt; &gt;&gt; I am running (still) 0.14.2 in production, and using Riak Search to
&gt; &gt;&gt; index certain buckets. Those buckets have the Riak Search pre-commit
&gt; &gt;&gt; hook enabled.
&gt; &gt;&gt;
&gt; &gt;&gt; Once in a while I get complaints of missing documents from my clients,
&gt; &gt;&gt; and it just happened.
&gt; &gt;&gt;
&gt; &gt;&gt; I checked and the document:
&gt; &gt;&gt; - is correctly stored in Riak
&gt; &gt;&gt; - doesn't show up on the search query results \\*anymore\\*
&gt; &gt;&gt;
&gt; &gt;&gt; My workaround before was to go through every key in the bucket and
&gt; &gt;&gt; save it again, as to trigger the search hook. Of course, this is less
&gt; &gt;&gt; than ideal.
&gt; &gt;&gt;
&gt; &gt;&gt; Should I be looking for something specific in the logs? What could be
&gt; &gt;&gt; going on here?
&gt; &gt;&gt;
&gt; &gt;&gt; Thanks,
&gt; &gt;&gt;
&gt; &gt;&gt; Francisco
&gt; &gt;&gt;
&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

