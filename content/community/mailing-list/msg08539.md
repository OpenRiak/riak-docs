---
title: "RE: missing keys?"
description: ""
project: community
lastmod: 2012-09-14T08:09:01-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08539"
mailinglist_parent_id: "msg08538"
author_name: "Pat Lynch"
project_section: "mailinglistitem"
sent_date: 2012-09-14T08:09:01-07:00
---


Hi Sean,
thanks for the very quick response :) - much appreciated. No, I didn't put any 
retries in the code at all.

So, if I write a key to a cluster and then try to query that key, it may not 
find it unless I retry? Even if r=2 & w=2 ? I thought that at least 2 systems 
had to have that key (either in memory or disk) for the write to have succeeded 
with those settings? If I had w=3, would you expect any missed keys ?? (note 
that I didn't try that because I expected performance issues).

Is it possible that I'd need to retry more than once? I guess the issue I have 
is (when it comes to real world usage) when do I give up checking if a key is 
there - it might genuinely not be there, or just not replicated yet?

I'll be running the tests again after the w/e (probably Monday or Tuesday), so 
hopefully I'll get more information there (and add a retry :))

thanks again,

Pat.


&gt; Date: Fri, 14 Sep 2012 10:50:06 -0400
&gt; Subject: Re: missing keys?
&gt; From: s...@basho.com
&gt; To: plynch1...@hotmail.com
&gt; CC: riak-users@lists.basho.com
&gt; 
&gt; Pat,
&gt; 
&gt; Does your test use retries when it gets "not found" responses? You
&gt; might not encounter that small % of missing keys if you retry at least
&gt; once when they are missing. Because of the eventually consistent
&gt; design of Riak, writes you make might not be readable immediately.
&gt; 
&gt; On Fri, Sep 14, 2012 at 10:17 AM, Pat Lynch  wrote:
&gt; &gt; Hi all,
&gt; &gt; I was just wondering if you could give me some feedback on my usage of RIAK.
&gt; &gt; I'm currently testing a number of datastores and am trying to come up with
&gt; &gt; pros/ cons of each.
&gt; &gt;
&gt; &gt; I have a variety of tests (write speed 1 client, write speed 10 clients,
&gt; &gt; read speed 1 client, read speed 10 clients, read while writing, write while
&gt; &gt; reading etc). The data set is tiny for this phase (10k, 50k, 100k).
&gt; &gt;
&gt; &gt; I have 3 machines in the cluster (each with 12GB RAM, quadcore CPUs, 500GB
&gt; &gt; drives), each cache setup to use 128MB memory (eleveldb). Each key is 64
&gt; &gt; bytes. and each value is 512 bytes.
&gt; &gt;
&gt; &gt;
&gt; &gt; The write speed I'm getting is around 260.0440791 per second (using 1
&gt; &gt; client), scaling to 2281.1662 writes per second (using 10 clients).
&gt; &gt; The read speed I'm getting is around 397.2291042 per second (using 1
&gt; &gt; client), scaling to 3316.089445 reads per second (using 10 clients).
&gt; &gt;
&gt; &gt; One very worrying thing I noticed is that I sometimes miss keys? i.e. I
&gt; &gt; write 100k keys to disk, then read them all back in and check the value
&gt; &gt; matches expected. This would only happen for 1 or 2 keys out of 100k, but
&gt; &gt; (1 or 2 keys is enoughâ€¦)
&gt; &gt;
&gt; &gt; This is using the latest version of RIAK with the python client (python
&gt; &gt; client is running on a 4th machine).
&gt; &gt;
&gt; &gt; Any help would be greatly appreciated.
&gt; &gt;
&gt; &gt; thanks,
&gt; &gt; Pat.
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
 \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

