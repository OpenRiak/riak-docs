---
title: "Re: Load Balancing With Riak Ruby Client"
description: ""
project: community
lastmod: 2011-05-29T10:35:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03483"
mailinglist_parent_id: "msg03464"
author_name: "Scott M. Likens"
project_section: "mailinglistitem"
sent_date: 2011-05-29T10:35:47-07:00
---


Hey,

In my Chef recipes for AppCloud (Engine Yard's PaaS Product) I actually 
configured haproxy to listen on 8098 on the application instances and redirect 
to all the riak nodes in a roundrobin fashion. (Had httpchk for /ping to ensure 
the node is up)

In my own testing with basho\\_bench this seemed to work, I'm unsure of what 
drawbacks there would be because I could not find any other then HTTP was 
slower then PBC.

I did find find that Protobuffers did not roundrobin correctly with haproxy 
using tcp mode... darn :(

So if we're just speaking HTTP could totally use HAProxy or a Hardware Load 
balancer to spread out the load.

Scott
-- 
Scott M. Likens
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)

On Friday, May 27, 2011 at 12:40 PM, Sean Cribbs wrote:

&gt; This is one thing I desperately want to refactor. The Ruby client still 
&gt; contains some things that reflect my earlier, less astute understanding of 
&gt; how a Riak client should behave and doesn't include obvious things like 
&gt; retrying requests (possibly on other nodes), conflict resolution strategies, 
&gt; and mutators.
&gt; 
&gt; In the past, I have recommended that users put a lightweight load-balancer 
&gt; (e.g. haproxy, pound) between their application and Riak, and simply have the 
&gt; app connect to the locally-running instance of the LB. I realize this is not 
&gt; a great solution, but it also avoids a little NIH for now.
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On May 27, 2011, at 3:20 PM, Keith Bennett wrote:
&gt; 
&gt; &gt; Hi, all. If I have several riak servers on a cluster, and want to 
&gt; &gt; distribute load fairly evenly, and am using the Ruby Riak client, what is 
&gt; &gt; the best way to balance load?
&gt; &gt; 
&gt; &gt; With the HTTP interface, I can randomize the choice of host for a request. 
&gt; &gt; How would I do the same with the ruby client? Would I create a Riak::Client 
&gt; &gt; for each host, and then just randomize the selection of those for a given 
&gt; &gt; call? Do the clients contain any state that would make this a bad idea? Or 
&gt; &gt; is there a better way to do this?
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; Keith
&gt; &gt; 
&gt; &gt; 
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; !DSPAM:4ddffdaf202681804284693!

