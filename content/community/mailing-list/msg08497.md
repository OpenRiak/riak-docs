---
title: "Re: MapReduce - sorting via the Java client"
description: ""
project: community
lastmod: 2012-09-11T10:28:28-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08497"
mailinglist_parent_id: "msg08496"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-09-11T10:28:28-07:00
---


Hi Deepak,

In-line

On Tue, Sep 11, 2012 at 10:16 AM, Deepak Balasubramanyam
 wrote:
&gt; I was researching the same question and found the answer after some
&gt; tinkering around. You need a JS source function. You must write the JS
&gt; source code for the sort algorithm too.
&gt;
&gt; JSSourceFunction phaseFunction = new JSSourceFunction(
&gt; "function(v) {" +
&gt; "return v.sort(function(a, b) {" +
&gt; "return a.field - b.field ;" +
&gt; "}" +
&gt; ");" +
&gt; "}");
&gt; IndexQuery iq = new BinValueQuery(BinIndex.named("indx\\_name"),"bucket",
&gt; "value"); // get an index
&gt; MapReduceResult execute = client.mapReduce(iq).addMapPhase(new
&gt; NamedJSFunction("Riak.mapValuesJson"),
&gt; false).addReducePhase(phaseFunction).execute();
&gt; String resultRaw = execute.getResultRaw(); // Raw data
&gt; Collection result = execute.getResult(YourType .class); //
&gt; serialized to a domain object
&gt;
&gt; The result of this operation will depend on what you return in your reduce()
&gt; function. The result may be a YourType or YourType[] etc. I wanted to
&gt; mention that since Jackson can complain about serialization issues if you
&gt; return the wrong values.
&gt;
&gt; Anyone know how to get this into a wiki ?


This would probably fit better on the Riak-Java-Client wiki.

https://github.com/basho/riak-java-client/wiki/TODO

There's an open TODO for MapReduce examples and I know Brian would
love some help with it. Care to take a stab at adding that code?

Mark

&gt;
&gt; Thanks
&gt; Deepak Bala
&gt;
&gt; On Wed, Aug 29, 2012 at 5:09 PM, Oved Machlev 
&gt; wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; How can I use the sorting functions over 'real' fields in the stored
&gt;&gt; objects? How can I set the field on which I want to sort by?
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; It seems that the following refers to the key, in my case it's a UUID, and
&gt;&gt; therefore useless to sort by:
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; MapReduceResult result = riakClient.
&gt;&gt;
&gt;&gt; mapReduce("some\\_bucket").
&gt;&gt;
&gt;&gt; addMapPhase(new
&gt;&gt; NamedJSFunction("Riak.mapValuesJson"), false).
&gt;&gt;
&gt;&gt; addReducePhase(new
&gt;&gt; NamedErlangFunction("riak\\_kv\\_mapreduce", "reduce\\_sort"), true).
&gt;&gt;
&gt;&gt; execute();
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; thanks,
&gt;&gt;
&gt;&gt; Oved.
&gt;&gt;

&gt;
&gt;
