---
title: "Re: riak stats maintenance?"
description: ""
project: community
lastmod: 2010-06-17T22:20:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00615"
mailinglist_parent_id: "msg00613"
author_name: "Grant Schofield"
project_section: "mailinglistitem"
sent_date: 2010-06-17T22:20:11-07:00
---


I would recommend using the ping URL instead of stats for a load 
balancer check.

http://127.0.0.1/ping

There may be something else going on and a looking at your logs for 
errors would be a good idea but a ping is much less intensive than 
running stats.


Grant

On Jun 18, 2010, at 0:41, Gareth Stokes  
wrote:



Hey Dan,

Sounds like i do need to check some things then.

The load balancer does a health check every 30 seconds.
Going through the monitor logs, the cpu was peaking up to about 60% 
which im not too sure if was caused by load or by the riak process 
doing whatever it was doing.


And, I do seem to be running pretty high on memory so ill see if i 
can lower that by configuring the buffer size on the innostore 
backend.


If i see it happening again, ill try and gather more information.

gs

On 18 June 2010 14:15, Dan Reverri  wrote:
Hi Gareth,

I'm not aware of any mechanism that turns the stats url off for any 
reason. How often are you pinging the stats url? Do the timeouts 
correlate with any other event on the system (higher load, cron job, 
etc.)?


Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Thu, Jun 17, 2010 at 8:40 PM, Gareth Stokes  wrote:

hey guys,

so i have a cluster of 4 physical machines with a load balancer 
sitting in front to handle requests going into riak.
i thought it would be a good idea (not anymore) to use the /stats 
url to ping the machines the cluster for their health. this is what 
i've noticed in the logs every few days or so


=ERROR REPORT==== 16-Jun-2010::03:48:37 ===
webmachine error: path="/stats"
{error,{exit,{timeout,{gen\\_server2,call,[riak\\_kv\\_stat,get\\_stats]}},
 [{gen\\_server2,call,2},
 {riak\\_kv\\_wm\\_stats,get\\_stats,0},
 {riak\\_kv\\_wm\\_stats,produce\\_body,2},
 {webmachine\\_resource,resource\\_call,3},
 {webmachine\\_resource,do,3},
 {webmachine\\_decision\\_core,resource\\_call,1},
 {webmachine\\_decision\\_core,decision,1},
 {webmachine\\_decision\\_core,handle\\_request,2}]}}

it lasts anywhere between 5 - 40 minutes.
what im thinking is that a riak machine will enter "maintenance" 
mode every now and then, when it does it turns the /stats url off.


am i correct in thinking this, or should i be worried?

regards,
gareth stokes

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com



\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

