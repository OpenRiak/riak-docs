---
title: "Re: Riak_KV::Riak_PB"
description: ""
project: community
lastmod: 2012-06-29T11:47:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07839"
mailinglist_parent_id: "msg07836"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-06-29T11:47:39-07:00
---


Andrew,

Thanks for the details. It looks like a breakage in the PB service w.r.t.
the internal Search API. I'll look for the source of the issue, but would
you post an issue on the issue tracker in the meantime? Here's the link:
https://github.com/basho/riak\\_search/issues

On Fri, Jun 29, 2012 at 2:22 PM, Andrew Zeneski wrote:

&gt; Sean,
&gt;
&gt; What I am doing is very simple:
&gt;
&gt; 1. I install the precommit hook on my test bucket (bin/search-cmd install
&gt; test)
&gt; 2. I create a JSON object that looks like this {"name": "Andrew Zeneski"}
&gt; and store it in Riak (using my API and the key "1000")
&gt; 3. I create a RpbSearchQueryReq message, set ONLY the index to 'test' and
&gt; the query (q) to "name:Andrew\\*"
&gt; 4. Send the message w/ the message type 27 to PBC port and receive back
&gt; RpbErrorResp with the error code 0 and the message below.
&gt;
&gt; From the command line I get:
&gt; $ bin/search-cmd search-doc test 'name:Andrew\\*'
&gt;
&gt; :: Searching for 'name:Andrew\\*' / '' in test...
&gt;
&gt; ------------------------------
&gt;
&gt; index/id: test/1000
&gt; &lt;&lt;"name"&gt;&gt; =&gt; &lt;&lt;"Andrew Zeneski"&gt;&gt;
&gt;
&gt; ------------------------------
&gt;
&gt; :: Found 1 results.
&gt; :: Maximum score ["0.00000",101,43,48]
&gt;
&gt; I noticed that the max score look exactly like the value in the error
&gt; message.
&gt;
&gt; error.log shows the following for that PBC request:
&gt;
&gt; 2012-06-29 14:03:26.916 [error] &lt;0.17489.5&gt; gen\\_server &lt;0.17489.5&gt;
&gt; terminated with reason:
&gt; {error,badarg,[{erlang,list\\_to\\_float,[["0.00000",101,43,48]]},{riak\\_search\\_utils,to\\_float,1},{riak\\_search\\_pb\\_query,encode\\_results,3},{riak\\_search\\_pb\\_query,process,2},{riak\\_api\\_pb\\_server,process\\_message,4},{riak\\_api\\_pb\\_server,handle\\_info,2},{gen\\_server,handle\\_msg,5},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt;
&gt; 2012-06-29 14:03:26.920 [error] &lt;0.17489.5&gt; CRASH REPORT Process
&gt; &lt;0.17489.5&gt; with 0 neighbours exited with reason:
&gt; {error,badarg,[{erlang,list\\_to\\_float,[["0.00000",101,43,48]]},{riak\\_search\\_utils,to\\_float,1},{riak\\_search\\_pb\\_query,encode\\_results,3},{riak\\_search\\_pb\\_query,process,2},{riak\\_api\\_pb\\_server,process\\_message,4},{riak\\_api\\_pb\\_server,handle\\_info,2},{gen\\_server,handle\\_msg,5},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; in gen\\_server:terminate/6
&gt;
&gt; 2012-06-29 14:03:26.923 [error] &lt;0.62.0&gt; Supervisor riak\\_api\\_pb\\_sup had
&gt; child undefined started with {riak\\_api\\_pb\\_server,start\\_link,undefined} at
&gt; &lt;0.17489.5&gt; exit with reason
&gt; {error,badarg,[{erlang,list\\_to\\_float,[["0.00000",101,43,48]]},{riak\\_search\\_utils,to\\_float,1},{riak\\_search\\_pb\\_query,encode\\_results,3},{riak\\_search\\_pb\\_query,process,2},{riak\\_api\\_pb\\_server,process\\_message,4},{riak\\_api\\_pb\\_server,handle\\_info,2},{gen\\_server,handle\\_msg,5},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; in context child\\_terminated
&gt;
&gt;
&gt; What keeps throwing me off is the fact the response error says "Error
&gt; processing incoming message", yet is contains the value of max score, so it
&gt; seems like its more of a problem processing outgoing message. But I could
&gt; be completely off base.
&gt;
&gt; Andrew
&gt;
&gt; On Jun 29, 2012, at 1:50 PM, Sean Cribbs wrote:
&gt;
&gt; Perhaps, but that might some other bug. Can you describe the request you
&gt; sent?
&gt;
&gt; BTW, here's the PR that should fix the build/dep problem:
&gt; https://github.com/basho/riak\\_core/pull/204
&gt;
&gt; On Fri, Jun 29, 2012 at 12:33 PM, Andrew Zeneski  &gt; wrote:
&gt;
&gt;&gt; Thanks Sean,
&gt;&gt;
&gt;&gt; Would those minor issues explain this error message I get?
&gt;&gt;
&gt;&gt; client\\_test.go:230: 0: Error processing incoming message:
&gt;&gt; error:badarg:[{erlang,list\\_to\\_float,
&gt;&gt;
&gt;&gt; [["0.00000",101,43,48]]},
&gt;&gt;
&gt;&gt; {riak\\_search\\_utils,to\\_float,
&gt;&gt; 1},
&gt;&gt; {riak\\_search\\_pb\\_query,
&gt;&gt; encode\\_results,3},
&gt;&gt; {riak\\_search\\_pb\\_query,
&gt;&gt; process,2},
&gt;&gt; {riak\\_api\\_pb\\_server,
&gt;&gt; process\\_message,4},
&gt;&gt; {riak\\_api\\_pb\\_server,
&gt;&gt; handle\\_info,2},
&gt;&gt;
&gt;&gt; {gen\\_server,handle\\_msg,5},
&gt;&gt;
&gt;&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]
&gt;&gt; FAIL
&gt;&gt;
&gt;&gt;
&gt;&gt; Andrew
&gt;&gt;
&gt;&gt; Andrew,
&gt;&gt;
&gt;&gt; Yes it is, but we have some minor dependency/build issues to resolve. The
&gt;&gt; next pre-release tag should have the appropriate fixes.
&gt;&gt;
&gt;&gt; On Fri, Jun 29, 2012 at 12:17 PM, Andrew Zeneski &lt;
&gt;&gt; and...@andrewzeneski.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; I built the 1.2.0pre3 (and master) and now have secondary index lookups
&gt;&gt;&gt; working in my client api; I am testing search right now but getting errors;
&gt;&gt;&gt; is RpbSearchQueryReq (PBC) implemented in 1.2?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks!
&gt;&gt;&gt;
&gt;&gt;&gt; Andrew
&gt;&gt;&gt;
&gt;&gt;&gt; On Jun 28, 2012, at 4:26 PM, Andrew Zeneski wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks Sean,
&gt;&gt;&gt;
&gt;&gt;&gt; Indeed, sending either of those messages to Riak will result in a
&gt;&gt;&gt; dropped connection.
&gt;&gt;&gt;
&gt;&gt;&gt; I would like to move forward with my client implementation so that it
&gt;&gt;&gt; will be ready when 1.2 is released.
&gt;&gt;&gt;
&gt;&gt;&gt; Can I join in on the QA and maybe get a snapshot? Or should I be looking
&gt;&gt;&gt; for the 1.2 branch on github?
&gt;&gt;&gt;
&gt;&gt;&gt; Andrew
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Jun 28, 2012, at 4:14 PM, Sean Cribbs  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi Andrew,
&gt;&gt;&gt;
&gt;&gt;&gt; Those were added to be part of the 1.2 release, which is in testing/QA
&gt;&gt;&gt; phases now. You can expect the release sometime next month. If you intend
&gt;&gt;&gt; to use the .proto files in your client application, be aware that they may
&gt;&gt;&gt; not be supported on the server yet (in fact, 1.1 and earlier will likely
&gt;&gt;&gt; dump the connection).
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu, Jun 28, 2012 at 4:11 PM, Andrew Zeneski &lt;
&gt;&gt;&gt; and...@andrewzeneski.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I am working on a new protocol buffer based client using the master
&gt;&gt;&gt;&gt; riak\\_pb repository. I would just like to inquire on the state of riak\\_kv
&gt;&gt;&gt;&gt; with the latest pb, specifically is RpbIndexReq and RpbSearchQueryReq
&gt;&gt;&gt;&gt; implemented yet (I know it is not in 1.1.4), if not is there a road map or
&gt;&gt;&gt;&gt; any idea when.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thanks!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Andrew
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;

&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Sean Cribbs 
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt;
&gt;


-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
