---
title: "Re: IndexQuery"
description: ""
project: community
lastmod: 2012-02-22T09:57:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06686"
mailinglist_parent_id: "msg06685"
author_name: "Rajat Mathur"
project_section: "mailinglistitem"
sent_date: 2012-02-22T09:57:45-08:00
---


Thanks \\*Russel\\* for a very clear and detailed explanation.

Also I would like to know if it is possible to query on 2 or more indices
in a single indexQuery ?

On Wed, Feb 22, 2012 at 10:59 PM, Russell Brown  wrote:

&gt; Hi Rajat,
&gt;
&gt; Answers inline below.
&gt;
&gt; On 22 Feb 2012, at 16:44, Rajat Mathur wrote:
&gt;
&gt; I am running following IndexQuery :
&gt;
&gt; `&gt; IntIndex intIndex=IntIndex.named("points");
&gt;
&gt; IndexQuery iQuery = new IntRangeQuery(intIndex,"fkUsers",1100,1300);
&gt;
&gt; MapReduceResult
&gt; resultInt=client.mapReduce(iQuery).addReducePhase(NamedErlangFunction.REDUCE_IDENTITY).execute();
&gt;
&gt; Collection res=resultInt.getResult(ArrayList.class);
&gt;
&gt; Iterator it=res.iterator();
&gt;
&gt; while ((it.hasNext())){
&gt;
&gt; ArrayList arrayList=it.next();
&gt; Bucket bucket=
&gt; client.fetchBucket(arrayList.get(0).toString()).execute();
&gt; for( int i=1;i IRiakObject
&gt; object=bucket.fetch(arrayList.get(i).toString()).execute();
&gt; log("Query Result : " + object.getValueAsString());
&gt; }
&gt;
&gt;` 
&gt;
&gt; I am not able to understand the exact result format \\*getResult\\* method of
&gt; \\*MapReduceResult\\* class is giving. Right now It is giving\\* Buckets \\*along
&gt; with \\*ids\\*
&gt; Is there any better method to parse result or it depends on my query ?
&gt;
&gt;
&gt; Your index query returns a list of Bucket/Key pairs. If you want all the
&gt; data too you can fetch it or have your MapReduce query return it (see
&gt; below.) If you just want the keys you can use the Bucket like this:
&gt;
&gt; List keys =
&gt; bucket.fetchIndex(IntIndex.named("points")).from(1100).to(1300).execute();
&gt;
&gt; Also please suggest other better methods(if any) for performing such
&gt; queries .
&gt;
&gt;
&gt; Your code above is not ideal. If you want the actual object values back
&gt; from an index range query then it might be better for MapReduce to return
&gt; them rather than you sequentially fetching each one.
&gt;
&gt; In which case you could use
&gt;
&gt; MapReduceResult resultInt=client.mapReduce(iQuery)
&gt;
&gt; .addMapPhase(new NamedErlangFunction("riak\\_kv\\_mapreduce", "map\\_object\\_value"))
&gt; .execute();
&gt;
&gt; Then you can get your results as before. If you data payload is JSON then
&gt; getResult(YourDomainClass.class) will use Jackson to automatically
&gt; transform the result. Or you can use getResults(Map.class) to get a
&gt; collection of Map.class instances (again, courtesy of Jackson).
&gt;
&gt; If you want access to the raw JSON returned by the query getResultRaw()
&gt; will get you it as a string.
&gt;
&gt; Whether that is faster than firing up N threads and fetching the data in
&gt; parallel dependsâ€¦
&gt;
&gt; BTW fetching a Bucket actually issues a request, so looping like that and
&gt; fetching bucket after bucket is a bad idea, especially when 2i query can
&gt; only be run on a single bucket, so you are in effect fetching the same
&gt; bucket over and over again.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt;
&gt;
&gt; --
&gt; \\*Rajat Mathur
&gt; B.Tech (IT) Final Year
&gt; IIIT Allahabad
&gt;
&gt; 09945990291
&gt;
&gt; Find me @ Facebook 
&gt; Follow me @ Twitter \\*

-- 
\\*Rajat Mathur
B.Tech (IT) Final Year
IIIT Allahabad

09945990291

Find me @ Facebook 
Follow me @ Twitter \\*
