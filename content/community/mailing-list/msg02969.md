---
title: "Re: Slow inserts"
description: ""
project: community
lastmod: 2011-04-11T14:34:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02969"
mailinglist_parent_id: "msg02963"
author_name: "Kresten Krab Thorup"
project_section: "mailinglistitem"
sent_date: 2011-04-11T14:34:14-07:00
---


Jens,

Just for reference ...in our dev lab ... we quite consistently get ~3000 
puts/second with N=3, W=2 on a 3-node macmini cluster running 0.14.1 w/bitcask 
as the backend. That's small machines with 2.6GHz Dual Core 2, and 8GB ram.

We do use lots of threads in the client, and a load balancer [or you can just 
have the threads connect to the different Riak's]. If all requests funnel 
through one machine it may become loaded, ... and we're using the Java client 
which is able to stream requests without having to open new connections all 
the time .. dunno how the python client is in this regard. We also have a 
proper gigabit managed switch between the macmini's, but I think it is unlikely 
that networking is the limiting factor ... 3000 x 1-kilobyte-per-second /sec 
corresponds to just 3 mega-bit-per-second ... the chatter among the clustered 
machines is roughly N-fold the chatter from the client to the cluster by my 
observations.

Have you tried to run some simple CPU/IO monitor on the 3 machines you're using 
to see if they are CPU or I/O bound? ... If they are not really loaded, you 
may need to add clients/threads. You should not be satisfied until the server 
machines are saturated.

Kresten


On Apr 11, 2011, at 18:00 , Jens Rantil wrote:

&gt; Hi,
&gt; 
&gt; I have set up a 5-node test environment to give Riak a test run. I wrote a 
&gt; Python script (http://pastebin.com/geQ00Ngb) that put 53780 key-values into 
&gt; my cluster. Using round robin, 11 threads inserted these values in ~70 
&gt; seconds. This means an average of ~750 key-values/second. Is this the 
&gt; expected speed of inserts? It seems quite slow. The Mozilla benchmark 
&gt; (http://blog.mozilla.com/data/2010/08/16/benchmarking-riak-for-the-mozilla-test-pilot-project/)
&gt; reached &gt; 1500 ops/second for significantly bigger values than my benchmark.
&gt; 
&gt; Additional information:
&gt; \\* Four of the nodes were not doing anything else.
&gt; \\* n\\_val=3
&gt; \\* For every insert, w=1 and dw=0.
&gt; \\* All nodes are using riak\\_0.14.1-1\\_amd64.deb and I have not changed any of 
&gt; the defaults settings except Erlang -cookie and -name.
&gt; 
&gt; Thanks,
&gt; Jens Rantil
&gt; 

