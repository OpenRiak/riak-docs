---
title: "Re: Strange spike"
description: ""
project: community
lastmod: 2012-05-31T11:24:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07586"
mailinglist_parent_id: "msg07585"
author_name: "Seth Benton"
project_section: "mailinglistitem"
sent_date: 2012-05-31T11:24:22-07:00
---


Hey,

Apologies if this is the wrong place for this, but I just updated the
eLevelDB wiki page to mention randomization of the write buffer length (via
setting write\\_buffer\\_size\\_min and write\\_buffer\\_size\\_max). Before there was
no mention of these config parameters. Perhaps people were just using
levelDB's 4MB default buffer size, causing all the vnodes to compact at the
same time? Or are there default write\\_buffer\\_size\\_min and
write\\_buffer\\_size\\_max
parameters under the hood?

http://wiki.basho.com/LevelDB.html

P.S. Mathew V is getting back to me shortly on changes to this page due to
changes in 1.2.

Seth
(Tech Writer)


On Thu, May 31, 2012 at 9:26 AM, Nam Nguyen  wrote:

&gt; Hi Sean,
&gt;
&gt; You are right. At first I thought it was localized to that one particular
&gt; node. Now others are also exhibiting the same symptom.
&gt;
&gt; I am putting in another node.
&gt;
&gt; Cheers,
&gt; Nam
&gt;
&gt;
&gt; On May 30, 2012, at 11:23 PM, Sean Cribbs wrote:
&gt;
&gt; Nam,
&gt;
&gt; The LevelDB storage backend has a known issue where compaction can stall a
&gt; heavily-loaded node for a long time (we've seen 60 seconds or more in
&gt; production clusters). We're very sorry about this, but an improvement will
&gt; be available in the next release. In the meantime, DO NOT make the node
&gt; leave the cluster - this will only make things worse! It might be worth
&gt; adding another node to the cluster, but I suggest you wait until the node
&gt; finishes compaction.
&gt;
&gt; On Wed, May 30, 2012 at 10:43 PM, Nam Nguyen  wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; My 5-node cluster exhibits a strange spike on one particular node.
&gt;&gt;
&gt;&gt; Overall, the mean get time is about 1ms. This node occasionally shoots up
&gt;&gt; to 40ms.
&gt;&gt;
&gt;&gt; During those times, %iowait is still the same as it is before the spike.
&gt;&gt; No error. Console log shows many lines like the below, which I don't think
&gt;&gt; relevant to the spike.
&gt;&gt;
&gt;&gt; 2012-05-30 21:29:50.591 [info]
&gt;&gt; &lt;0.72.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor long\\_gc &lt;0.938.0&gt;
&gt;&gt; [{initial\\_call,{riak\\_core\\_vnode,init,1}},{almost\\_current\\_function,{gen\\_fsm,loop,7}},{message\\_queue\\_len,0}]
&gt;&gt; [{timeout,185},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,2584},{mbuf\\_size,0},{stack\\_size,55},{old\\_heap\\_size,0},{heap\\_size,804}]
&gt;&gt;
&gt;&gt; The cluster is set up uniformly. Ubuntu 64bit, m2.2xlarge instance. Riak
&gt;&gt; 1.1.2 with LevelDB backend.
&gt;&gt;
&gt;&gt; What would be the best course of actions for me?
&gt;&gt;
&gt;&gt; I plan to:
&gt;&gt;
&gt;&gt; - riak-admin leave on that node
&gt;&gt; - set up new instance
&gt;&gt; - riak-admin reip the new instance
&gt;&gt; - riak-admin join it to the cluster
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt; Nam
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

