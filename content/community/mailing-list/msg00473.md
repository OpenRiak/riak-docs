---
title: "Re: Ripple find_by_"
description: ""
project: community
lastmod: 2010-06-01T05:52:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00473"
mailinglist_parent_id: "msg00472"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-06-01T05:52:38-07:00
---


You're on the right track. It might be best to make a built-in function that 
can handle more than one possibility, for example:

var Ripple = {
 mapByFields: function(value, keyData, fields){
 if(!value.not\\_found){
 var object = Riak.mapValuesJson(value)[0];
 for(field in fields) {
 if(object[field] != fields[field])
 return [];
 }
 return [object];
 }
 }
};

Then instead of passing the source in your query, use map("Ripple.mapByFields", 
:arg =&gt; {"email" =&gt; "j...@somewhere.com"}, :keep =&gt; true). However, this won't 
necessarily give you a User object, but instead a list of JSON objects that 
you'll have to coerce into your document class.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Jun 1, 2010, at 5:26 AM, Samuel MORELLO wrote:

&gt; Hi,
&gt; 
&gt; Using Ripple, I wonder what is the best way to implement a simple
&gt; find\\_by\\_email function.
&gt; Since i don't want to use the email as a key, is there another way
&gt; that using a mapreduce function ?
&gt; 
&gt; Many thanks,
&gt; 
&gt; Samuel (newbie)
&gt; 
&gt; 
&gt; require 'ripple'
&gt; require 'digest/d5'
&gt; 
&gt; class User
&gt; include Ripple::Document
&gt; 
&gt; property :email, String, :presence =&gt; true
&gt; property :hash\\_password, String, :presence =&gt; true
&gt; 
&gt; def self.find\\_by\\_email(email)
&gt; map = "
&gt; function(v) {
&gt; if (v.values) {
&gt; var val = Riak.mapValuesJson(v)[0];
&gt; return (val.email === '#{email}' ) ? v.key : null;
&gt; } else return null;
&gt; }
&gt; "
&gt; Riak::MapReduce.new(bucket.client).add(bucket).map(map,
&gt; :keep =&gt; true).run
&gt; end
&gt; 
&gt; def password=(pwd)
&gt; self.hash\\_password = Digest::MD5.hexdigest(pwd)
&gt; end
&gt; def password
&gt; self.hash\\_password
&gt; end
&gt; 
&gt; end
&gt; 
