---
title: "Re: confused"
description: ""
project: community
lastmod: 2010-09-16T15:17:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01087"
mailinglist_parent_id: "msg01080"
author_name: "Nils Petersohn"
project_section: "mailinglistitem"
sent_date: 2010-09-16T15:17:45-07:00
---


ok, my ring seems ok now.
what i did was to change the rel/vars/dev[1,2,3]\\_vars.config file.
in there i was just replacing the ips...
this reip thing did not really work out ...

here is my riak ring now:
(d...@192.168.0.100)1&gt; riak\\_core\\_ring\\_manager:get\\_my\\_ring().
{ok,{chstate,'d...@192.168.0.100',
 [{'d...@192.168.0.107',{65,63451889794}},
 {'d...@192.168.0.105',{13,63451889512}},
 {'d...@192.168.0.100',{104,63451889512}},
 {'d...@192.168.0.105',{49,63451889512}},
 {'d...@192.168.0.100',{32,63451889009}},
 {'d...@192.168.0.105',{94,63451889253}},
 {'d...@192.168.0.107',{9,63451889769}},
 {'d...@192.168.0.100',{97,63451889494}}],
 {64,
 [{0,'d...@192.168.0.100'},
 {22835963083295358096932575511191922182123945984,
 'd...@192.168.0.105'},
 {45671926166590716193865151022383844364247891968,
 'd...@192.168.0.107'},
 {68507889249886074290797726533575766546371837952,
 'd...@192.168.0.100'},
 {91343852333181432387730302044767688728495783936,
 'd...@192.168.0.105'},
 {114179815416476790484662877555959610910619729920,
 'd...@192.168.0.107'},
 {137015778499772148581595453067151533092743675904,
 'd...@192.168.0.100'},
 {159851741583067506678528028578343455274867621888,
 'd...@192.168.0.105'},
 {182687704666362864775460604089535377456991567872,
 'd...@192.168.0.100'},
 {205523667749658222872393179600727299639115513856,
 'd...@192.168.0.105'},
 {228359630832953580969325755111919221821239459840,
 'd...@192.168.0.107'},
 {251195593916248939066258330623111144003363405824,
 'd...@192.168.0.100'},
 {274031556999544297163190906134303066185487351808,
 'd...@192.168.0.105'},
 {296867520082839655260123481645494988367611297792,
 'd...@192.168.0.107'},
 {319703483166135013357056057156686910549735243776,
 'd...@192.168.0.100'},
 {342539446249430371453988632667878832731859189760,
 'd...@192.168.0.105'},
 {365375409332725729550921208179070754913983135744,
 'd...@192.168.0.100'},
 {388211372416021087647853783690262677096107081728,
 'd...@192.168.0.105'},
 {411047335499316445744786359201454599278231027712,
 'd...@192.168.0.107'},
 {433883298582611803841718934712646521460354973696,...},
 {...}|...]},
 {dict,0,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
 {{[],[],[],[],[],[],[],[],[],[],[],[],...}}}}}
(d...@192.168.0.100)2&gt; 

i am using 0.12.1 on my mac and 0.12 on both vms. i have now a set of 100.000 
entrys like this (just for testing):
{"id":"42164", "actionTime":"2007-05-11 17:08:55", "action":"some action", 
"res":"7024", "user":"5", "client":"2787"}


and my mr job looks like this (just for testing):
{"inputs":"actionbucket",
 "query":[
 {"map":{"language":"javascript", "source":
 "function(values, keyData, arg) {
 
 var value = Riak.mapValuesJson(values)[0];
 if(value.reservation == '4084'){
 return [value];
 }
 return [];
 }","keep":true}}
 ],"timeout": 900000
}


the beam instances are all showing on "top" now, and there is some traffic 
going back and forth. (~200kb / s)

but this job takes like 1:30 min.

i know that this is not really comparable with a mysql query because you can do 
more calculations in the mr job to produce much more special results and the mr 
job has a ~linear "worktime"... but ~1:30 min is still pretty bad .... 

is there any way to do much better ?

best regards
nils

On Sep 16, 2010, at 7:08 PM, Grant Schofield wrote:

&gt; 
&gt; On Sep 15, 2010, at 2:40 PM, Nils Petersohn wrote:
&gt; 
&gt;&gt; hello,
&gt;&gt; 
&gt;&gt; i was setting up 9 riak instances:
&gt;&gt; 
&gt;&gt; three on my mac with the appropriate app config
&gt;&gt; and six with two virtual machines on a different computer.
&gt;&gt; 
&gt;&gt; all 8 joined the d...@192.168.1.20
&gt;&gt; and the join request was sent.
&gt;&gt; 
&gt;&gt; after setting this up:
&gt;&gt; i wanted to put data with the java client on d...@192.168.1.20 than i got a 
&gt;&gt; timeout ?!?
&gt;&gt; 
&gt; 
&gt; I am curious if you started this node and then changed its name in the config 
&gt; file? Errors like this can happen if you don't riak-admin reip the node, also 
&gt; the ring file would be wrong and this could lead to some of the other errors 
&gt; you saw below. One thing you may want to look at is the state of your ring 
&gt; from the Riak console using riak\\_core\\_ring\\_manager:get\\_my\\_ring(). That might 
&gt; show any problems with the ring, feel free to send that along so we can take 
&gt; a look at it.
&gt; 
&gt;&gt; when i put data on one of the other machines than only this machine was 
&gt;&gt; using cpu time and none of the other ...
&gt;&gt; if consistent hashing works like expected, than all the machines should show 
&gt;&gt; up on "top"
&gt;&gt; 
&gt;&gt; when i did a mapreduce job than only this machine was using cpu time and 
&gt;&gt; none of the other ...
&gt;&gt; 
&gt;&gt; i had "top" running on all of them.
&gt;&gt; 
&gt;&gt; -------------------------------------------------------
&gt;&gt; the other problem is:
&gt;&gt; 
&gt;&gt; when i have 1/2 mio. entrys in one bucket with less than 100 chars for each 
&gt;&gt; entry
&gt;&gt; and i do a really simple mapreduce job, than it takes forever (15 minutes 
&gt;&gt; ...)
&gt;&gt; while sql uses .005 secons....
&gt;&gt; 
&gt;&gt; i know that doing a mr on a complete bucket, than it takes very long if i 
&gt;&gt; don't secify keys in the bucket. but how should i know which keys to use ...
&gt; 
&gt; What version of Riak are you using? There has been a fair amount of 
&gt; improvement to the map reduce system as well as list keys. Are the map reduce 
&gt; jobs you are running javascript?
&gt; 
&gt;&gt; ------------------------------------------------------
&gt;&gt; 
&gt;&gt; if i put stuff in one bucket and add a machine with the join request, how 
&gt;&gt; can i rebalance the bucket???? so that the other machine is taking some 
&gt;&gt; values too.
&gt; 
&gt; This happens automatically. When the new node joins the cluster you should 
&gt; see handoff messages in the erlang.log.X log file. Rebalancing is handled 
&gt; by the cluster and shouldn't be done manually.
&gt; 
&gt; Grant Schofield
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; 
&gt; 
&gt;&gt; 
&gt;&gt; ------------------------------------------------------
&gt;&gt; 
&gt;&gt; i don't understand these issues/behaviors (timeout, 15min. etc., 
&gt;&gt; rebalancing), maybe i was setting the one of the three params incorrect ? i 
&gt;&gt; left everything to the default settings.
&gt;&gt; 
&gt;&gt; thx in advance for any hints...
&gt;&gt; 
&gt;&gt; nils
&gt; 

Nils M. Petersohn
xing.com/profile/Nils\\_Petersohn
blog.srvme.de
twitter.com/snackycracky
facebook.com/nils.petersohn
myspace.com/electrash

p...@berlin.de
0049 (0)151 40 511 351
skype: nilz\\_berlin

Ebertystr. 47
10249 Berlin
