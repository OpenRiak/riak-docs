---
title: "Re: Java Client Riak Builders..."
description: ""
project: community
lastmod: 2012-05-29T12:24:00-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07567"
mailinglist_parent_id: "msg07566"
author_name: "Brian Roach"
project_section: "mailinglistitem"
sent_date: 2012-05-29T12:24:00-07:00
---

Actually, it was on purpose. As sort of a "step 1" to getting rid of it, the 
goal was just to get the code out of our repo and use maven to pull it in. As 
you note and as far as I could find, the latest development on github is not 
being published to maven central. 

Long term I want to eliminate it completely and use Jackson for everything. 

Thanks,
- Roach


On May 29, 2012, at 1:07 PM, Guido Medina wrote:

&gt; Also, the coming riak client version removed the embedded json package from 
&gt; it and put an old implementation from the main maven repo, I think that what 
&gt; was meant to do was to put this version: 
&gt; https://github.com/douglascrockford/JSON-java which has lot of performance 
&gt; improvements but no maven repo, the old:
&gt; 
&gt; 
&gt; org.json
&gt; json
&gt; 20090211
&gt; 
&gt; 
&gt; uses lot of StringBuffer instead of StringBuilders and StringWritters 
&gt; introduced later on.
&gt; 
&gt; I'm wondering about the benchmark of one vs the other.
&gt; 
&gt; Regards,
&gt; 
&gt; Guido.
&gt; 
&gt; -----Original Message----- From: Brian Roach
&gt; Sent: Tuesday, May 29, 2012 7:05 PM
&gt; To: Guido Medina
&gt; Cc: riak-users@lists.basho.com
&gt; Subject: Re: Java Client Riak Builders...
&gt; 
&gt; Guido -
&gt; 
&gt; Thanks, looking forward to it.
&gt; 
&gt; Also as an FYI, on Friday I fixed the bug that was causing the requirement of 
&gt; the @JsonIgnore for Riak annotated fields without getters.
&gt; 
&gt; - Brian Roach
&gt; 
&gt; On May 29, 2012, at 11:52 AM, Guido Medina wrote:
&gt; 
&gt;&gt; I will request a "pull request", I fixed it, I enabled @RiakIndex for 
&gt;&gt; collection fields AND methods (String, Integer or Collection of any of 
&gt;&gt; those), on our coding is working, but still I need to test it more before 
&gt;&gt; making it final.
&gt;&gt; 
&gt;&gt; I will share the details tomorrow, I already created a fork from your master 
&gt;&gt; branch.
&gt;&gt; 
&gt;&gt; Now you can have something like:
&gt;&gt; 
&gt;&gt; @RiakIndex
&gt;&gt; @JsonIgnore
&gt;&gt; Collection getNumbers()
&gt;&gt; 
&gt;&gt; Also this works as index and with no getter (as of 1.0.6-SNAPSHOT) will only 
&gt;&gt; be that, an index:
&gt;&gt; 
&gt;&gt; @RiakIndex
&gt;&gt; Collection numbers;
&gt;&gt; That will act as index and be ignored as property which is the intention of 
&gt;&gt; the index, to be a dynamic calculated value(s) and not as property which 
&gt;&gt; requires the caller to call a post-construct.
&gt;&gt; 
&gt;&gt; And of course, all subclasses of a collection apply.
&gt;&gt; 
&gt;&gt; Thanks for the answer,
&gt;&gt; 
&gt;&gt; Guido.
&gt;&gt; 
&gt;&gt; -----Original Message----- From: Brian Roach
&gt;&gt; Sent: Tuesday, May 29, 2012 6:09 PM
&gt;&gt; To: Guido Medina
&gt;&gt; Cc: riak-users@lists.basho.com
&gt;&gt; Subject: Re: Java Client Riak Builders...
&gt;&gt; 
&gt;&gt; Guido -
&gt;&gt; 
&gt;&gt; The real fix is to enhance the client to support a Collection, I'll add an 
&gt;&gt; issue for this in github.
&gt;&gt; 
&gt;&gt; What you would need to do right now is write your own Converter (which would 
&gt;&gt; really just be a modification of our JSONConverter if you're using JSON) 
&gt;&gt; that does this for you.
&gt;&gt; 
&gt;&gt; If you look at the source for JSONConverter you'll see where the indexes are 
&gt;&gt; processed. As it is, the index processing is handled by the 
&gt;&gt; RiakIndexConverter class which is where the limitation of requiring the 
&gt;&gt; annotated field to be a String is coming from (it's actually buried lower 
&gt;&gt; than that in the underlying annotation processing, but that's the starting 
&gt;&gt; point for the problem). The actual RiakIndexes class that encapsulates the 
&gt;&gt; data and exists in the IRiakObject doesn't have this problem.
&gt;&gt; 
&gt;&gt; The catch is that you'll need to do all the reflection ugliness yourself, as 
&gt;&gt; that's the part that's broken (the annotation processing).
&gt;&gt; 
&gt;&gt; Basically, in JSONConverter.fromDomain() you would need to replace
&gt;&gt; RiakIndexes indexes = riakIndexConverter.getIndexes(domainObject);
&gt;&gt; with your own annotation processing. The same would need to be done in 
&gt;&gt; JSONConverter.toDomain() at
&gt;&gt; riakIndexConverter.populateIndexes(â€¦)
&gt;&gt; 
&gt;&gt; Obviously this is not ideal and I'm considering it a bug; I'll put this 
&gt;&gt; toward to top of the list of things I'm working on right now.
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; Brian Roach
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On May 28, 2012, at 8:03 AM, Guido Medina wrote:
&gt;&gt; 
&gt;&gt;&gt; Hi,
&gt;&gt;&gt; 
&gt;&gt;&gt; I'm looking for a work around @RiakIndex annotation to support multiple 
&gt;&gt;&gt; values per index name, since the annotation is limited to one single value 
&gt;&gt;&gt; per annotated property (no collection support), I would like to know if 
&gt;&gt;&gt; there is a way of using the DomainBucketBuilder, mutation & conflict 
&gt;&gt;&gt; resolver and at the same time has access to a method signature like 
&gt;&gt;&gt; addIndex(String or int)...addIndex(String or int)...build() same as you can 
&gt;&gt;&gt; do with RiakObjectBuilder which lacks support for conflict resolution and 
&gt;&gt;&gt; mutation style.
&gt;&gt;&gt; 
&gt;&gt;&gt; Regards,
&gt;&gt;&gt; 
&gt;&gt;&gt; Guido.
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
