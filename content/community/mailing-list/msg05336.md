---
title: "Re: question about a new node join"
description: ""
project: community
lastmod: 2011-10-28T05:16:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05336"
mailinglist_parent_id: "msg05335"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-10-28T05:16:34-07:00
---



On 28 Oct 2011, at 12:55, chuang wrote:

&gt; I read the source in riak-0.4.12.
&gt; 
&gt; When a new node join the cluster,it sends reconcile\\_ring message in 
&gt; riak\\_core\\_gossip,then in riak\\_core\\_claim.erl reconcile the ring in the 
&gt; cluster.
&gt; In all the join-cluster process,the core function is 
&gt; riak\\_core\\_ring:transfer\\_node,but this function only change ring index,seems 
&gt; there is no place to transfer node data.
&gt; 
&gt; Image that node1 has key A, when node 2 join the cluster,after the reconcile 
&gt; process ends,node 1 and 2 just change their ring index that key A should 
&gt; place in node 2 next time,but the old data in key A is still in node 1! If 
&gt; key A never update its data any more,any reader read key A will miss, cause 
&gt; node 2 now has no data of key A.
&gt; 

Have a look at riak\\_core\\_vnode.erl, it does a periodic home check and hands off 
any data to the owning node if ownership changes. I can recommend Ryan 
Zezeski's blog about riak core[1].

[1] https://github.com/rzezeski/try-try-try

&gt; Another question is: merker.erl seems no use? 
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

