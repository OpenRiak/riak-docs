---
title: "Re: riak search and solr/lucene"
description: ""
project: community
lastmod: 2010-11-08T05:11:08-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01488"
mailinglist_parent_id: "msg01469"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2010-11-08T05:11:08-08:00
---


Hi Joseph,

Ah okay, I see what you are saying now. That's a good idea, and a nice
simplification to the code. Thanks for the suggestion!

This is now tracked here: https://issues.basho.com/show\\_bug.cgi?id=870

Best,
Rusty

On Thu, Nov 4, 2010 at 8:02 PM, Joseph Lambert
wrote:

&gt; Disregard that last message. What I meant was, in a Solr query, all the
&gt; results are returned and then it sorts and then takes the chunk that is
&gt; requested by the start and count parameters. Why not instead make the
&gt; results of the search() function the input of a MapReduce job, and if the
&gt; user adds sorting and then start and count parameters, add two reduce jobs,
&gt; one a sort and one a slice. Would that not improve the Solr search results?
&gt; Or do I not understand correctly?
&gt;
&gt;
&gt; - Joe Lambert
&gt;
&gt; joseph.g.lamb...@gmail.com
&gt; +86 13656213284
&gt;
&gt;
&gt; On Fri, Nov 5, 2010 at 7:34 AM, Joseph Lambert  &gt; wrote:
&gt;
&gt;&gt; Rusty,
&gt;&gt;
&gt;&gt; Sorry, I meant Lucene search. Solr can be passed start and count, Lucene
&gt;&gt; search can't be, but they share functions in the Erlang code.
&gt;&gt;
&gt;&gt; - Joe Lambert
&gt;&gt;
&gt;&gt; joseph.g.lamb...@gmail.com
&gt;&gt; +86 13656213284
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Nov 5, 2010 at 2:15 AM, Rusty Klophaus  wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Joseph,
&gt;&gt;&gt;
&gt;&gt;&gt; Answers inline below.
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu, Nov 4, 2010 at 12:49 AM, Joseph Lambert &lt;
&gt;&gt;&gt; joseph.g.lamb...@gmail.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I am using the PHP library for a project and was looking through the
&gt;&gt;&gt;&gt; code to see what differentiates the Solr HTTP interface query versus the
&gt;&gt;&gt;&gt; Lucene search (besides the syntax and the interface, etc) as paging is very
&gt;&gt;&gt;&gt; useful for my code. From the PHP library with lucene I can do a search with
&gt;&gt;&gt;&gt; lucene, then a reduce job to sort, then another reduce to slice the 
&gt;&gt;&gt;&gt; results.
&gt;&gt;&gt;&gt; With Solr, we can just do a cURL with the parameters to do the same thing.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I scanned the Erlang code, and in the end, both call stream\\_search(),
&gt;&gt;&gt;&gt; but the Lucene query will pass the results back to luke for possibly 
&gt;&gt;&gt;&gt; another
&gt;&gt;&gt;&gt; MR phase, and the Solr query simply sorts and truncates the list. So:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 1. Does anyone have a general idea at what point the Solr query will
&gt;&gt;&gt;&gt; start to get really slow as far as number of keys in a bucket and other
&gt;&gt;&gt;&gt; factors? I know this is dependent on many things, just looking for a rough
&gt;&gt;&gt;&gt; idea of when it's a bad idea to use the Solr interface.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; The Solr interface works by running the query to find your list of keys
&gt;&gt;&gt; (limited based on the "start" and "rows" parameters) and then looking up the
&gt;&gt;&gt; keys in Riak KV. So if you execute a Solr request with "rows=100", your
&gt;&gt;&gt; request will take a certain amount of time to execute the query, plus
&gt;&gt;&gt; however long it takes to retrieve 100 objects in your cluster.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 2. Also, I see that Riak will cache the map phase of a map reduce, so
&gt;&gt;&gt;&gt; will it cache the initial search? Or does it use some other mechanism I'm
&gt;&gt;&gt;&gt; not seeing to cache search results?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; The system does not cache Search results, though the operating system's
&gt;&gt;&gt; disk caching does make repeated search results execute more quickly.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 3. Finally, for the Solr query, why not automatically add a sort and/or
&gt;&gt;&gt;&gt; slice phase if the user passes in sort, start or count parameters in the
&gt;&gt;&gt;&gt; Solr query?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Not sure I understand the question here, can you clarify/elaborate? The
&gt;&gt;&gt; system does support sort and slice parameters. (
&gt;&gt;&gt; https://wiki.basho.com/display/RIAK/Riak+Search+-+Querying)
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Please correct me if any of the assumptions I made are wrong, as usually
&gt;&gt;&gt;&gt; when I ask these questions I end up with my foot in my mouth.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; - Joe Lambert
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; joseph.g.lamb...@gmail.com
&gt;&gt;&gt;&gt; +86 13656213284
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
