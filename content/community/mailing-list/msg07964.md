---
title: "Re: ssl support?"
description: ""
project: community
lastmod: 2012-07-16T08:48:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07964"
mailinglist_parent_id: "msg07931"
author_name: "Michael Johnson"
project_section: "mailinglistitem"
sent_date: 2012-07-16T08:48:16-07:00
---


I'll be filing this as a bug as it doesn't seem to be a configuration
problem. Perhaps most people aren't using SSL? While we could potentially
get away with network segregation, I would much prefer having the traffic
encrypted as well.
On Jul 13, 2012 3:08 PM, "Michael Johnson"  wrote:

&gt; I gave compiling from source a try, but it did not make a difference.
&gt;
&gt; It turns out that for some reason, the method I have always used to
&gt; generate self-signed certificates doesn't seem to result in certificates
&gt; that work with riak even though they work for OpenLDAP, nginx, apache, and
&gt; other stuff.
&gt;
&gt; Here is the way I typically create certificates:
&gt;
&gt; openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout
&gt; /etc/riak/ssl.key -out /etc/riak/ssl.crt
&gt;
&gt; I like this because it's a simple one-liner. Basho does point you to
&gt; http://www.akadia.com/services/ssh\\_test\\_certificate.html for directions
&gt; on how to generate a certificate, and if you follow those directions, you
&gt; do indeed get a certificate that works with riak.
&gt;
&gt; If this only affected my self-signed certificates, I would be fine moving
&gt; on at this point. However, I have tried using certificates that a signed
&gt; by real ssl cert signing authorities and they have not been working either.
&gt;
&gt; I fully admit that I'm not an ssl expert, and have no idea what would be
&gt; the critical difference between my methodology for creating self-signed
&gt; certs, the methodology basho points to, and the way the legit cert I
&gt; tried was created/signed. Any insite?
&gt;
&gt; On Fri, Jul 13, 2012 at 2:06 PM, Michael Johnson wrote:
&gt;
&gt;&gt; (reposting with the rest of the thread removed... it was too big and
&gt;&gt; getting moderated)
&gt;&gt;
&gt;&gt; Yup, they are:
&gt;&gt;
&gt;&gt; [root@riak01 riak]# ls -al /etc/riak/ssl.\\*
&gt;&gt; -rw-r--r--. 1 root root 2122 Jul 12 16:49 /etc/riak/ssl.crt
&gt;&gt; -rw-r--r--. 1 root root 3272 Jul 12 16:49 /etc/riak/ssl.key
&gt;&gt;
&gt;&gt; In fact, I straced the beam process to see if that would show anything
&gt;&gt; outside of what was showing up in the logs and noticed one thing that was
&gt;&gt; somewhat interesting. The process check to see if the cert and key files
&gt;&gt; are writeable (which they are not). On the off chance that that was
&gt;&gt; problematic, I changed the owner and group of the cert and key to be 'riak'
&gt;&gt; and the check for write access was succeeding, however it didn't change the
&gt;&gt; end result. Here is a snip from the strace before changing the owner and
&gt;&gt; group:
&gt;&gt;
&gt;&gt; 31520 stat("/etc/riak/ssl.crt", 
&gt;&gt; 31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=2122, ...}) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.crt", R\\_OK) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.crt", W\\_OK) = -1 EACCES (Permission denied)
&gt;&gt; ...
&gt;&gt; 31520 stat("/etc/riak/ssl.key", 
&gt;&gt; 31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=3272, ...}) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.key", R\\_OK) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.key", W\\_OK) = -1 EACCES (Permission denied)
&gt;&gt;
&gt;&gt; And after:
&gt;&gt; 31520 stat("/etc/riak/ssl.crt", 
&gt;&gt; 31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=2122, ...}) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.crt", R\\_OK) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.crt", W\\_OK) = 0
&gt;&gt; ...
&gt;&gt; 31520 stat("/etc/riak/ssl.key", 
&gt;&gt; 31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=3272, ...}) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.key", R\\_OK) = 0
&gt;&gt; 31520 access("/etc/riak/ssl.key", W\\_OK) = 0
&gt;&gt;
&gt;&gt; On Fri, Jul 13, 2012 at 1:34 PM, Dave Parfitt  wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Michael -
&gt;&gt;&gt;
&gt;&gt;&gt; [root@riak01 riak]# openssl verify /etc/riak/ssl.crt
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt; I see you are using root to create/verify these certs - are they
&gt;&gt;&gt; readable by the riak user?
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;
