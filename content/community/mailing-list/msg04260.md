---
title: "Re: High volume data series storage and queries"
description: ""
project: community
lastmod: 2011-08-08T12:34:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04260"
author_name: "Ciprian Dorin Craciun"
project_section: "mailinglistitem"
sent_date: 2011-08-08T12:34:22-07:00
---


On Mon, Aug 8, 2011 at 21:21, Paul O  wrote:
&gt; Hello Riak enthusiasts,
&gt; I am trying to design a solution for storing time series data coming from a
&gt; very large number of potential high-frequency sources.
&gt; I thought Riak could be of help, though based on what I read about it I
&gt; can't use it without some other layer on top of it.
&gt; The problem is I need to be able to do range queries over this data, by the
&gt; source. Hence, I want to be able to say "give me the N first data points for
&gt; source S between time T1 and time T2."
&gt; I need to store this data for a rather long time, and the expected volume
&gt; should grow more than what a "vanilla" RDBMS would support.
&gt; Another thing to note is that I can restrict the number of data points to be
&gt; returned by a query, so no query would return more than MaxN data points.
&gt; I thought about doing this the following way:
&gt; 1. bundle date time series in batches of MaxN, to ensure that any query
&gt; would require reading at most two batches. The batches would be store inside
&gt; Riak.
&gt; 2. Store the start-time, end-time, size and Riak batch ID in a MySQL (or
&gt; PostgreSQL) DB.
&gt; My thinking is such a strategy would allow me to persist data in Riak and
&gt; linearly grow with the data, and the index would be kept in a RDBM for fast
&gt; range queries.
&gt; Does it sound sensible to use Riak this way? Does this make you
&gt; laugh/cry/shake your head in disbelief? Am I overlooking something from Riak
&gt; which would make all this much better?
&gt; Thanks and best regards,
&gt; Paul

 Hello all!

 (Disclaimer: I'm not a Riak-KV user per-se, but I've built
something on-top of Riak-Core. Also the solution I'm proposing is not
just something "on-top" of Riak-KV, but ontop of Riak-Core.)
 (Context: Some time ago we had a similar problem in a project of
ours: store time-series of power consumption from a lot of devices.
The current solution is using Informix, but this is out of scope.)

 First I would say that storing data in batches will have a high
penalty on writes -- and such an application I guess is write
intensive. (As I know there is no support for appending to values.
Or?)

 Now because you have a "very large number of sources" means that
you could do -- on top of Riak-Core the following:
 \\* take the identifier of your data source and hash it -- just like
Riak-KV does with a key -- and use this as the key for Riak-Core;
 \\* build a Vnode module that handles writes and queries, and which
stores the data in either:
 \\* RRDtool -- one data-file per data-source;
 \\* or an embedded database allowing sorted data-sets; (we've
had some very nice experiments with BerkeleyDB;) just use as key the
concatenation from the source key and the timestamp, and being careful
to have the resulting key correctly sorted lexicographically (i.e.
keep the key and timestamp at fixed length (maybe padded) and
big-endian encoded);
 \\* all that remains to be solved is data-replication -- similar to
how Riak handles it;

 Thinking a little bit about it, you could actually do also this:
 \\* Riak-KV uses 160bits for keys, thus you could "partition" this
key in two parts: "sensor-key" | "timestamp"; for example 96 bits for
sensor, and 64 bits for timestamp;
 \\* implement the riak\\_kv\\_backend module ontop of such an embedded
database as described above (i.e. BerkeleyDB, or LevelDB);
 \\* when storing and querying data you'll still need to bypass the
Riak-KV normal key hashing;
 \\* you'll have replication and balancing for free;

 Ciprian.

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

