---
title: "Re: MR Error"
description: ""
project: community
lastmod: 2012-07-27T19:54:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08106"
mailinglist_parent_id: "msg08100"
author_name: "John Roy"
project_section: "mailinglistitem"
sent_date: 2012-07-27T19:54:24-07:00
---


So here's what I can get for the code from mochi\\_web:parse\\_header:

%% @spec parse\\_header(string()) -&gt; {Type, [{K, V}]}
%% @doc Parse a Content-Type like header, return the main Content-Type
%% and a property list of options.
parse\\_header(String) -&gt;
 %% TODO: This is exactly as broken as Python's cgi module.
 %% Should parse properly like mochiweb\\_cookies.
 [Type | Parts] = [string:strip(S) || S &lt;- string:tokens(String, ";")],
 F = fun (S, Acc) -&gt;
 case lists:splitwith(fun (C) -&gt; C =/= $= end, S) of
 {"", \\_} -&gt;
 %% Skip anything with no name
 Acc;
 {\\_, ""} -&gt;
 %% Skip anything with no value
 Acc;
 {Name, [$\\= | Value]} -&gt;
 [{string:to\\_lower(string:strip(Name)),
 unquote\\_header(string:strip(Value))} | Acc]
 end
 end,
 {string:to\\_lower(Type),
 lists:foldr(F, [], Parts)}

You might check your headers. They mention Content-Type above -- check your 
colon/semi-colon punctuation.

Hope that helps.


On Jul 26, 2012, at 10:51 PM, idmartin wrote:

&gt; Error running MapReduce operation. Status: 500 : 500
&gt; Internal Server Error
&gt; Internal Server Error
&gt; The server encountered an error while processing this
&gt; request:  

```
{error,function_clause,
&gt;       [{string,tokens1,[undefined,";",[]]},
&gt;        {mochiweb_util,parse_header,1},
&gt;        {riak_kv_wm_mapred,base_type,1},
&gt;        {riak_kv_wm_mapred,ctype_ok,1},
&gt;        {riak_kv_wm_mapred,known_content_type,2},
&gt;        {webmachine_resource,resource_call,3},
&gt;        {webmachine_resource,do,3},
&gt; 
&gt; {webmachine_decision_core,resource_call,1}]}
```


---

mochiweb+webmachine
&gt; web server


&gt; 
&gt; 
&gt; 
&gt; 
&gt; --
&gt; View this message in context: 
&gt; http://riak-users.197444.n3.nabble.com/MR-Error-tp4024811.html
&gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; 

