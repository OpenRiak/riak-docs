---
title: "Re: PB problems with 1.0.0 (and now 1.1.1)"
description: ""
project: community
lastmod: 2012-04-12T08:32:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07196"
mailinglist_parent_id: "msg07195"
author_name: "Peter Fales"
project_section: "mailinglistitem"
sent_date: 2012-04-12T08:32:25-07:00
---


Thanks for your help.

Obviously, I'm sort of stumbling around here, and I didn't realize
that there was a dependency on protobuffs within erlang. I'm 
running on a CentOS6 system (i.e basically RHEL 6.2) and when I
run 

 code:which(protobuffs).
I get
 non\\_existing


After I ran "yum install erlang-protobuffs", I now get:

 "/usr/lib/erlang/lib/protobuffs-0/ebin/protobuffs.beam"


That sounded promising, but even after "make distclean" and "make rel"
the file "./rel/riak/lib/protobuffs-0/ebin/protobuffs.beam" is still
the smaller size and does not include the symbol next\\_field\\_num

The thing I don't understand is that this file (which was removed
by "make distclean") was re-created with a month-old (March 11) 
timestamp by "make rel". FWIW, deps/protobuffs/ebin/protobuffs.beam
was rebuilt with today's timestamp and includes the symbol. ???

On Thu, Apr 12, 2012 at 10:22:19AM -0400, Ryan Zezeski wrote:
&gt; Peter,
&gt; 
&gt; This seems to be an issue with the release build and your environment. I
&gt; think the `protobuffs-0` means it couldn't discover the PB version number.
&gt; I wonder if you have some other version of protobuffs installed in your
&gt; Erlang VM? E.g. I notice that
&gt; https://github.com/ngerakines/erlang\\_protobuffs/blob/master/src/protobuffs.er
&gt; does not define `next\\_field\\_num`. What is the output if you start up
&gt; a
&gt; fresh erl shell and run `code:which(protobuffs).`?
&gt; 
&gt; -Z
&gt; 
&gt; On Mon, Apr 9, 2012 at 2:26 PM, Peter Fales
&gt; wrote:
&gt; 
&gt; &gt; Following up on this issue from last October which bit me again with
&gt; &gt; 1.1.1. Does anyone know why my deps/protobuffs/ebin/protobuffs.beam
&gt; &gt; includes the function next\\_field\\_num function, but my
&gt; &gt; rel/riak/lib/protobuffs-0/ebin/protobuffs.beam (and
&gt; &gt; dev/dev\\*/riak/lib/protobuffs-0/ebin/protobuffs.beam) are smaller
&gt; &gt; and do not include the next\\_field\\_num function?
&gt; &gt;
&gt; &gt;
&gt; &gt; On Thu, Oct 13, 2011 at 04:18:12PM -0500, Peter Fales wrote:
&gt; &gt; &gt; Thanks for the mail, though I thought I was using the latest client. The
&gt; &gt; &gt; client\\_lib/README file points to
&gt; &gt; https://bitbucket.org/basho/riak-python-client
&gt; &gt; &gt; and from there I ran the suggested command
&gt; &gt; &gt; (hg clone https://bitbucket.org/basho/riak-python-client)
&gt; &gt; &gt; to get the code.
&gt; &gt; &gt;
&gt; &gt; &gt; However, I found at least part of the problem, though I still don't quite
&gt; &gt; &gt; understand the root cause. In my riak-1.0.0 build directory,
&gt; &gt; &gt; ./deps/protobuffs/ebin/protobuffs.beam is 12692 and includes the string
&gt; &gt; &gt; next\\_field\\_num. However,
&gt; &gt; ./rel/riak/lib/protobuffs-0/ebin/protobuffs.beam
&gt; &gt; &gt; is only 7536 and does not include that string. It appears that
&gt; &gt; &gt; the "rel" version is being built without the full protobuf code.
&gt; &gt; &gt;
&gt; &gt; &gt; When I run the server using the larger "deps" version, my test client
&gt; &gt; works.
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Thu, Oct 13, 2011 at 05:08:00PM -0400, Reid Draper wrote:
&gt; &gt; &gt; &gt; It looks like you're using version 1.2.2 of the client. I suggest
&gt; &gt; trying
&gt; &gt; &gt; &gt; 1.3.0 or the master branch from github.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; On Thu, Oct 13, 2011 at 3:37 PM, Peter Fales &lt;
&gt; &gt; peter.fa...@alcatel-lucent.com
&gt; &gt; &gt; &gt; &gt; wrote:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Trying to upgrade from 0.14.1 to 1.0.0...
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; This python program works with 0.14.1:
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; ====================================================================
&gt; &gt; &gt; &gt; &gt; import riak
&gt; &gt; &gt; &gt; &gt; client = riak.RiakClient(port=XXXX, host="YYYY.ZZZZ",
&gt; &gt; &gt; &gt; &gt; transport\\_class=riak.RiakPbcTransport)
&gt; &gt; &gt; &gt; &gt; test\\_bucket = client.bucket('test')
&gt; &gt; &gt; &gt; &gt; x=test\\_bucket.new('0-0-0','hello6')
&gt; &gt; &gt; &gt; &gt; x.store()
&gt; &gt; &gt; &gt; &gt; ====================================================================
&gt; &gt; &gt; &gt; &gt; However, with the server running 1.0.0, I get:
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; ====================================================================
&gt; &gt; &gt; &gt; &gt; Traceback (most recent call last):
&gt; &gt; &gt; &gt; &gt; File "./bench/client.py", line 6, in 
&gt; &gt; &gt; &gt; &gt; x.store()
&gt; &gt; &gt; &gt; &gt; File
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/riak\\_object.py",
&gt; &gt; &gt; &gt; &gt; line 296, in store
&gt; &gt; &gt; &gt; &gt; Result = t.put(self, w, dw, return\\_body)
&gt; &gt; &gt; &gt; &gt; File
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/transports/pbc.py",
&gt; &gt; &gt; &gt; &gt; line 188, in put
&gt; &gt; &gt; &gt; &gt; msg\\_code, resp = self.recv\\_msg()
&gt; &gt; &gt; &gt; &gt; File
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/transports/pbc.py",
&gt; &gt; &gt; &gt; &gt; line 357, in recv\\_msg
&gt; &gt; &gt; &gt; &gt; self.recv\\_pkt()
&gt; &gt; &gt; &gt; &gt; File
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; "/usr/lib/python2.7/site-packages/riak-1.2.2-py2.7.egg/riak/transports/pbc.py",
&gt; &gt; &gt; &gt; &gt; line 401, in recv\\_pkt
&gt; &gt; &gt; &gt; &gt; format(nmsglen))
&gt; &gt; &gt; &gt; &gt; riak.RiakError: 'Socket returned short packet length - expected 4'
&gt; &gt; &gt; &gt; &gt; ====================================================================
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; When this happens, console.logg gets:
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; 2011-10-13 15:52:41.920 [error] &lt;0.17823.0&gt; CRASH REPORT Process
&gt; &gt; &gt; &gt; &gt; &lt;0.17823.0&gt; with 0 neighbours crashed with reason: call to undefined
&gt; &gt; &gt; &gt; &gt; function
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; protobuffs:next\\_field\\_num(&lt;&lt;10,4,116,101,115,116,18,5,48,45,48,45,48,34,28,10,8,34,104,101,108,108,111,54,34,18,16,97,112...&gt;&gt;)
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Both 0.14.1 and 1.0.0 work with the HTTP interface, but I want to use
&gt; &gt; &gt; &gt; &gt; the PB interface.
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; I suspect I'm just missing something simple, but I haven't been
&gt; &gt; puzzling
&gt; &gt; &gt; &gt; &gt; over this for some time and haven't been able to find anything yet!
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; --
&gt; &gt; &gt; &gt; &gt; Peter Fales
&gt; &gt; &gt; &gt; &gt; Alcatel-Lucent
&gt; &gt; &gt; &gt; &gt; Member of Technical Staff
&gt; &gt; &gt; &gt; &gt; 1960 Lucent Lane
&gt; &gt; &gt; &gt; &gt; Room: 9H-505
&gt; &gt; &gt; &gt; &gt; Naperville, IL 60566-7033
&gt; &gt; &gt; &gt; &gt; Email: peter.fa...@alcatel-lucent.com
&gt; &gt; &gt; &gt; &gt; Phone: 630 979 8031
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; &gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; --
&gt; &gt; &gt; Peter Fales
&gt; &gt; &gt; Alcatel-Lucent
&gt; &gt; &gt; Member of Technical Staff
&gt; &gt; &gt; 1960 Lucent Lane
&gt; &gt; &gt; Room: 9H-505
&gt; &gt; &gt; Naperville, IL 60566-7033
&gt; &gt; &gt; Email: peter.fa...@alcatel-lucent.com
&gt; &gt; &gt; Phone: 630 979 8031
&gt; &gt; &gt;
&gt; &gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; &gt; riak-users mailing list
&gt; &gt; &gt; riak-users@lists.basho.com
&gt; &gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; &gt; --
&gt; &gt; Peter Fales
&gt; &gt; Alcatel-Lucent
&gt; &gt; Member of Technical Staff
&gt; &gt; 1960 Lucent Lane
&gt; &gt; Room: 9H-505
&gt; &gt; Naperville, IL 60566-7033
&gt; &gt; Email: peter.fa...@alcatel-lucent.com
&gt; &gt; Phone: 630 979 8031
&gt; &gt;
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;

-- 
Peter Fales
Alcatel-Lucent
Member of Technical Staff
1960 Lucent Lane
Room: 9H-505
Naperville, IL 60566-7033
Email: peter.fa...@alcatel-lucent.com
Phone: 630 979 8031

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

