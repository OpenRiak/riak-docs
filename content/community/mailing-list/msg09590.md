---
title: "Riak handling of mismatched n_val within cluster"
description: ""
project: community
lastmod: 2012-12-14T17:03:10-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09590"
author_name: "David Lowell"
project_section: "mailinglistitem"
sent_date: 2012-12-14T17:03:10-08:00
---


I know this is really very boneheaded. But we ended up with n\\_val being 3 on 
one of two riak hosts in a dev cluster, and 1 on the other host. I would have 
expected Riak to howl loudly about this, but it said nothing. In fact, we 
discovered the problem while debugging app-level issues that resulted from this 
configuration.

We found that on the two hosts, the same 2i query returned wildly different 
results. As we investigated we discovered that on the host with n=1, riak was 
returning each key 3 times. On the host with n=3, each key was in the 2i 
results once. 

Maybe this makes sense at some low level, but I sure would have preferred 
something in the logs, or even a riak crash to this behavior.

Once we corrected n\\_val on the errant host, both hosts returned each key 3x. Is 
it possible for riak to recover from this situation and eventually return the 
correct 2i results with each key listed only once?

This is a dev cluster, so this isn't critical. But I'd like to understand 
better whether and how riak can recover from this weird state.

Thanks,

Dave

--
Dave Lowell
d...@connectv.com

