---
title: "Python client: Error while using Protocol Buffer Interface"
description: ""
project: community
lastmod: 2011-04-07T07:24:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02916"
author_name: "Ishwar"
project_section: "mailinglistitem"
sent_date: 2011-04-07T07:24:22-07:00
---


Hello Riak folks,

We have a 3-node riak cluster on my local box with haproxy load balancer 
running on port 9190 for the riak cluster. I've attached the haproxy conf file 
for your reference.


We use riak-python-client to connect to Riak. While connecting through the HTTP 
interface, the riak client works fine. When I try to connect through the 
Protocol Buffer Interface, it throws exception.

Here's an excerpt from the code:
    def get(self, keys):
        #client = riak.RiakClient()
        client = riak.RiakClient(port=9190, 
transport\\_class=riak.RiakPbcTransport)
        bucket = client.bucket('test1')
        ret = {}
        try:
            for key in keys:        
                post = bucket.get(key)
                ret[key] = post.get\\_data()
            return ret
        except Exception, e:
            print  traceback.format\\_exc()
            return False

and here's the stack trace.
Traceback (most recent call last):
  File "/home/ishwar/workspace/TestRiak/src/HelloWorld.py", line 22, in get
    post = bucket.get(key)
  File 
"/usr/local/lib/python2.6/dist-packages/riak-1.2.1-py2.6.egg/riak/bucket.py", 
line 245, in get
    return obj.reload(r)
  File 
"/usr/local/lib/python2.6/dist-packages/riak-1.2.1-py2.6.egg/riak/riak\\_object.py",
 line 290, in reload
    Result = t.get(self, r, vtag)
  File 
"/usr/local/lib/python2.6/dist-packages/riak-1.2.1-py2.6.egg/riak/transports/pbc.py",
 line 157, in get
    msg\\_code, resp = self.recv\\_msg()
  File 
"/usr/local/lib/python2.6/dist-packages/riak-1.2.1-py2.6.egg/riak/transports/pbc.py",
 line 349, in recv\\_msg
    self.recv\\_pkt()
  File 
"/usr/local/lib/python2.6/dist-packages/riak-1.2.1-py2.6.egg/riak/transports/pbc.py",
 line 401, in recv\\_pkt
    format(len(self.\\_inbuf), self.\\_inbuf\\_len))
RiakError: 'Socket returned short packet 135 - expected 1213486160'

Is this a problem with my haproxy config file or is there something wrong with 
riak settings? I'd be glad to share the output of logs if needed.
--
Thanks for the help.

Ishwar


Just another resurrected Neozoic Archosaur comics.
http://www.flickr.com/photos/mojosaurus/sets/72157600257724083/

local.haproxy.conf
Description: Binary data
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

