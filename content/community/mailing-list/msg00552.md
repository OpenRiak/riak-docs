---
title: "Re: [ANN] Riak Release 0.11.0"
description: ""
project: community
lastmod: 2010-06-11T03:54:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00552"
mailinglist_parent_id: "msg00551"
author_name: "Justin Sheehy"
project_section: "mailinglistitem"
sent_date: 2010-06-11T03:54:15-07:00
---


Hi, Germain.

On Fri, Jun 11, 2010 at 11:07 AM, Germain Maurice
 wrote:

&gt; Because of its append-only nature, stale data are created, so, how does
&gt; Bitcask to remove stale data ?

An excellent question, and one that we haven't yet written enough about.

&gt; With CouchDB the compaction process on our data never succeed, too much
&gt; data.
&gt; I really don't like to have to launch manually this kind of process.

Bitcask's merging (compaction) process is automated and very tunable.
These parameters are the most relevant in your bitcask section of
app.config:

(see the whole thing at http://hg.basho.com/bitcask/src/tip/ebin/bitcask.app)

%% Merge trigger variables. Files exceeding ANY of these
%% values will cause bitcask:needs\\_merge/1 to return true.
%%
{frag\\_merge\\_trigger, 60}, % &gt;= 60% fragmentation
{dead\\_bytes\\_merge\\_trigger, 536870912}, % Dead bytes &gt; 512 MB

%% Merge thresholds. Files exceeding ANY of these values
%% will be included in the list of files marked for merging
%% by bitcask:needs\\_merge/1.
%%
{frag\\_threshold, 40}, % &gt;= 40% fragmentation
{dead\\_bytes\\_threshold, 134217728}, % Dead bytes &gt; 128 MB
{small\\_file\\_threshold, 10485760}, % File is &lt; 10 MB

Every few minutes, the Riak storage backend for a given partition will
send a message to bitcask, requesting that it queue up a possible
merge job. (only one partition will be in the merge process at once
as a result of that queue) The bitcask application will examine that
partition when that request reaches the front of the queue. If any of
the trigger values have been exceeded, then all of the files in that
partition which exceed any threshold values will be run through
compaction.

This allows you a great deal of flexibility in your demands, and also
provides reasonable amortization of the cost since each partition is
processed independently.

-Justin

