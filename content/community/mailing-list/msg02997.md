---
title: "SV: [newbie] riak performance - basics"
description: ""
project: community
lastmod: 2011-04-13T07:16:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02997"
mailinglist_parent_id: "msg02996"
author_name: "Jens Rantil"
project_section: "mailinglistitem"
sent_date: 2011-04-13T07:16:07-07:00
---


Hi M H,

The default Riak configuration has N=3 [1], which means that it is configured 
to run on a 3-node environment. This also means that every PUT you do must 
write 3 values to your local machine! Changing n\\_val for your Riak bucket to 1 
will make more sense for a 1-node environment.

[1] http://wiki.basho.com/Replication.html#Selecting-an-N-value-(n\\_val)

Also, have a look at the previous thread [2] that I posted a couple of days 
ago. In short, the RESTful interface can be quite slow. Maybe have a look at 
Sean Cribbs parameter. Or event better, use the protocol buffer API instead.

[2] 
http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-April/003849.html

Regards,
Jens

-----Ursprungligt meddelande-----
Från: riak-users-boun...@lists.basho.com 
[mailto:riak-users-boun...@lists.basho.com] För M H
Skickat: den 13 april 2011 14:59
Till: riak-users@lists.basho.com
Ämne: [newbie] riak performance - basics

Hi,

I am new to Riak - just compiled it and trying it out. I have some questions 
about performance.

I am running a single riak node with default configuration (only changed the 
IPs) on a core i7 machine (Ubuntu). I run a very simple JMeter test (RESTful 
calls):
 1 .PUT a simple json object into riak (~30 bytes; key is static - so DB has 
only one key)
 2. GET the object

While the test is running riak seems to be using all the CPU it can get - 'top' 
reports ~99.5% CPU usage (beam.smp is using ~780% so all 8 cores).

Here are some results from the JMeter test:
\\* 5 threads:
 1.PUT  avg: 458 ms  Throughput 6.1/sec
 2.GET  avg: 355 ms  Throughput 6.1/sec

\\* 50 threads:
 1.PUT  avg: 5325 ms  Throughput 6.1/sec
 2.GET  avg: 2838 ms  Throughput 6.1/sec

The numbers are pretty disappointing. Is there something wrong with the default 
configuration? Or I am misusing riak in some way? There is only 1 key with 
simple value in the DB....


Here's some numbers from admin stats:

vnode gets : 2118
vnode\\_puts : 1067
read\\_repairs : 1
vnode\\_gets\\_total : 224061
vnode\\_puts\\_total : 89045
node\\_gets : 680
node\\_gets\\_total : 74676
node\\_get\\_fsm\\_time\\_mean : 3047570
node\\_get\\_fsm\\_time\\_median : 2949500
node\\_get\\_fsm\\_time\\_95 : 4888000
node\\_get\\_fsm\\_time\\_99 : 5964050
node\\_get\\_fsm\\_time\\_100 : 6348870
node\\_puts : 339
node\\_puts\\_total : 29543
node\\_put\\_fsm\\_time\\_mean : 2433651
node\\_put\\_fsm\\_time\\_median : 2472125
node\\_put\\_fsm\\_time\\_95 : 4054512
node\\_put\\_fsm\\_time\\_99 : 4504152
node\\_put\\_fsm\\_time\\_100 : 4908213
read\\_repairs\\_total : 180
cpu\\_nprocs : 620
cpu\\_avg1 : 2104
cpu\\_avg5 : 2117
cpu\\_avg15 : 2099
storage\\_backend : riak\\_kv\\_bitcask\\_backend

Any hints?

--
MH

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

