---
title: "Re: Python Client Thread Safe?"
description: ""
project: community
lastmod: 2012-02-27T19:38:08-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06769"
mailinglist_parent_id: "msg06751"
author_name: "Greg Stein"
project_section: "mailinglistitem"
sent_date: 2012-02-27T19:38:08-08:00
---


IIRC, that error was seen when connecting to Riak 0.14.0. What version of
Riak are you connecting to?

I might also suggest using the current, unreleased Python client from the
master branch on GitHub. It has much better support for threads and
persistent connections. Just don't use variant client\\_id values and PB
connections (switch to Riak 1.1 and ignore client\\_id).

One Client can be shared across threads, but not Objects. I don't recall
whether Buckets can be shared.

Cheers,
-g
On Feb 26, 2012 2:39 PM, "Jim Adler"  wrote:

&gt; I'm getting the following error while using protocol buffers
&gt; (RiakPbcTransport) with more than one thread (stack trace below):
&gt;
&gt; Socket returned short packet length 0 - expected 4'
&gt;
&gt; I'm using the 1.3.0 Python client on Mac and Ubuntu 11.04 and have seen
&gt; the same error on both OS's. A single-thread works fine as does the
&gt; RiakHttpTransport.
&gt;
&gt; Anyone have this problem?
&gt;
&gt; Thanks,
&gt; Jim
&gt;
&gt; File
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/bucket.py", line 260,
&gt; in get
&gt; return obj.reload(r)
&gt; File
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/riak\\_object.py", line
&gt; 373, in reload
&gt; Result = t.get(self, r, vtag)
&gt; File
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 195, in get
&gt; msg\\_code, resp = self.send\\_msg(MSG\\_CODE\\_GET\\_REQ, req, None)
&gt; File
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 387, in send\\_msg
&gt; return self.recv\\_msg(conn, expect)
&gt; File
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 413, in recv\\_msg
&gt; self.recv\\_pkt(conn)
&gt; File
&gt; "/usr/local/Cellar/python/2.7.2/Frameworks/Python.framework/Versions/2.7/li
&gt; b/python2.7/site-packages/riak-1.3.0-py2.7.egg/riak/transports/pbc.py",
&gt; line 460, in recv\\_pkt
&gt; len(nmsglen))
&gt; RiakError: 'Socket returned short packet length 0 - expected 4'
&gt;
&gt;

