---
title: "Re: Easier to use Java Client"
description: ""
project: community
lastmod: 2011-03-29T02:28:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02778"
mailinglist_parent_id: "msg02777"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-03-29T02:28:52-07:00
---

On 29 Mar 2011, at 10:02, Kresten Krab Thorup wrote:

&gt; One thing, which is often missed by newcomers to Riak [I'm not saying you 
&gt; missed it], is the importance of managing client IDs, and passing the right 
&gt; vector clocks back to the server. 
&gt; 
&gt; { Basho'ers ... please corret me if I'm wrong }

Not wrong, very right.

&gt; 
&gt; The above two things (1.a and 1.b) are so difficult to understand for 
&gt; newcomers, and a bit tricky to get right, so IMHO a new Java client should 
&gt; provide some way to avoid doing these mistakes as the default behavior.
&gt; 
&gt; - So, it should choose a good client ID fo you if you don't.
&gt; - And it should make it so that you can't do UPDATE/PUT without having first 
&gt; GOT'en the riak object. 
&gt; 
&gt; 
&gt; I.e. NOT EXPOSE constructors for the implementors of RiakObject. The only 
&gt; way to get an UpdateableRiakObject is to call RiakClient.get, or as the 
&gt; result of calling update/create; you can't just allocate one. Also calling 
&gt; update/create should "invalidate" the original object so that it cannot 
&gt; accidentally be used again. 
&gt; 
&gt; I really think we need to have a way to enforce the linear nature of these 
&gt; things. Otherwise people get fooled.
&gt; 

I'm working on this now, thanks to some ideas from Coda Hale at Yammer. The 
concept is that a store \\*requires\\* a ConflictResolver and a Mutation. Any PUT 
is in fact 

 get
 [convert to domain representation]
 resolve conflicts
 mutate
 [convert]
 put
 [return new object]

Hence 2 APIs, a low level for the transport business of talking to riak 
(REST/protocol buffers/etc) and a high level one for dealing with riak's 
implications. I am getting there and hope to have an example to show very soon.

&gt; 
&gt; 
&gt; Kresten
&gt; 
&gt; 
&gt; 
&gt; 

