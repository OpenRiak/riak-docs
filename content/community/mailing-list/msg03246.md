---
title: "Re: C++ Riak client?"
description: ""
project: community
lastmod: 2011-05-05T15:02:29-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03246"
mailinglist_parent_id: "msg02951"
author_name: "David Leimbach"
project_section: "mailinglistitem"
sent_date: 2011-05-05T15:02:29-07:00
---


I haven't completely abandoned mine yet either, but I've been finding that
some of the I wanted to use with streambufs aren't going to pan out due to
the nature of a socket backed stream and the way protocol buffers expects it
to work. Protocol Buffers expects the stream to be terminated when done
receiving a message \\*THEN\\* parse it rather than building the parsing in (I
think that's what happened anyway... I really need to check my notes I took
when I ran into this). This does appear to make a simple socket fd backed
streambuf way to plug into any protocol buffers stream a bit more difficult
than I was hoping.

Then again, I may just not be overriding a particular member function that I
should be either.

Might get some time on the weekend to poke at this some more.

On the plus side I definitely had some Riak RPC binary protocol bits
working. I was encoding/decoding Ping/Pong just fine (and they don't need
any Protocol Buffer anything to work).

Dave

On Sat, Apr 9, 2011 at 8:47 AM, Sean Cribbs  wrote:

&gt; I didn't permanently abandon it, but it was much more fiddly than doing the
&gt; same thing in pure Ruby. I have plans to deliver separate "native" Protocol
&gt; Buffers libraries for MRI and JRuby (at least) in 1.0 of the Ruby client.
&gt;
&gt; Because it's being confused in this conversation, I think it merits
&gt; clarification -- the "protocol" that is used to talk to Riak and Google's
&gt; Protocol Buffers are NOT the same thing. Riak uses a simple length- and
&gt; message-code-prefixed binary protocol, in which the complex messages (ones
&gt; that have bodies and not just the message code) are serialized via Google's
&gt; Protocol Buffers. So, while we don't use the RPC facilities in Google's
&gt; library, the \\*serialization format\\* DOES use Protocol Buffers.
&gt;
&gt; Sorry for the confusion, we'll work to make that clearer in the wiki.
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; On Apr 8, 2011, at 9:17 PM, Scott Gonyea wrote:
&gt;
&gt; They are the same and you can actually see me plugging into the C++ code
&gt; here:
&gt;
&gt; https://github.com/sgonyea/pabst/tree/master/ext
&gt;
&gt; But as part of an Objective-C library (called ObjFW). So, the code is
&gt; actually an Objective-C++ wrapper around the C++ PB code, that exchanges
&gt; messages with Objective-C code (that hooks into Ruby).
&gt;
&gt; I believe Sean Cribbs has some initial C++-wrapper code in his Ripple
&gt; repo... Though he eventually abandoned it after C++ left him permanently
&gt; cross-eyed (I think that's why).
&gt;
&gt; Scott
&gt;
&gt; On Apr 8, 2011, at 5:20 PM, Mike Oxford wrote:
&gt;
&gt; Be careful here..
&gt;
&gt; I do not thing Riak's "protocol buffers" are the same as Google's protocol
&gt; buffers.
&gt; Google's does bit-level packing and some other tricks that Riak does not
&gt; do, even though they both use the ".proto" file extension and very very
&gt; similar proto semantics.
&gt;
&gt; That said, if they ARE the same, then you can take the .proto files and
&gt; generate C++ classes, and use the secondary library "protobuf-c" to generate
&gt; C structs for the wire format.
&gt;
&gt; -mox
&gt;
&gt; On Fri, Apr 8, 2011 at 4:43 PM, David Leimbach  wrote:
&gt;
&gt;&gt; Spent a little time poking at this today... Kind of surprised that there
&gt;&gt; was no message defined for PingReq or for listing buckets.
&gt;&gt;
&gt;&gt; I realize these messages really have no usable payload, and just sort of
&gt;&gt; have a tag and length, but for completeness it kind of feels like they
&gt;&gt; should be there.
&gt;&gt;
&gt;&gt; Of course I'm not a Protocol Buffers expert in any sense, so I can't say
&gt;&gt; whether this is a normal kind of choice or not.
&gt;&gt;
&gt;&gt; Dave
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Apr 8, 2011 at 2:49 PM, Scott Gonyea  wrote:
&gt;&gt;
&gt;&gt;&gt; If we had this then a C-wrapper would be that much more attainable. So,
&gt;&gt;&gt; the author of such a lib would be a superstar in my book :).
&gt;&gt;&gt;
&gt;&gt;&gt; Sent from my iPhone
&gt;&gt;&gt;
&gt;&gt;&gt; On Apr 8, 2011, at 1:46 PM, David Leimbach  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; &gt; I've been writing a bit of code in Haskell to push data to Riak, and
&gt;&gt;&gt; the bindings are pretty easy to use (Thanks Brian!), but getting penetration
&gt;&gt;&gt; at my company for Haskell is going to take a little time.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; As such I'm just wondering if anyone knows of anyone working on a
&gt;&gt;&gt; protocol buffers version of a Riak client in C++, or if this is going to be
&gt;&gt;&gt; something I'll have to take on.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; I've found a few generic looking C++ projects that use Boost's
&gt;&gt;&gt; asynchronous IO stuff with protocol buffers to make an RPC system, but I'm
&gt;&gt;&gt; not sure if any of those are implicitly compatible.
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Guess I'm just looking for a pointer...
&gt;&gt;&gt; &gt;
&gt;&gt;&gt; &gt; Dave
&gt;&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

