---
title: "Re: Backing up riak"
description: ""
project: community
lastmod: 2012-04-25T10:31:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07319"
mailinglist_parent_id: "msg07305"
author_name: "Mark Phillips"
project_section: "mailinglistitem"
sent_date: 2012-04-25T10:31:40-07:00
---


Hi Austin,

On Tue, Apr 24, 2012 at 9:31 AM, Swinney, Austin  wrote:

&gt; Hi,
&gt;
&gt; I'm using leveldb on a 5 node ec2 cluster. I've read about the basic tar
&gt; zipping of leveldb and ring files per node. Also, I read about riak-admin
&gt; backup all.
&gt;
&gt; I'm curious about a couple things.
&gt;
&gt; 1) is the `riak-admin backup all` command non-blocking?
&gt;

Assuming you mean, "Will the cluster continue to work when I use this
command?", then "Yes". :)


&gt; 2) is it a consistent backup or is consistency old fashioned thinking?
&gt;

The backup will be complete up to the point at which it was taken. You'll
get a dump of all the keys in the order in which they were listed. Updates
that happened during the backup may or may not be captured. (I would have
to verify exactly how you would know which made it and which didn't.)


&gt; 3) if you use the tar'ing up of leveldb + ring files per node, you lose
&gt; one node, then you restore it from this tar file that is hours or days old,
&gt; how does riak deal with bringing its data up to date?
&gt;
&gt;
After you restored the node, it would gradually sync its replicas with
those on the other nodes via read/repair. That said, doing a complete
restore of the node would probably not be needed. When the node
disappears, Riak will compensate for it by sending its writes/reads to
fallback nodes. When it comes back online, hinted handoff and read
repair will make sure it gets all the replicas it was supposed to have
and that those replicas were up to date. (You will have to force Read
Repar on the replicas on that node which can be done via a list keys
or using an existing snippet of code [1] for doing this but be warned
that it'll put some load on that node. We're working on making the
Read Repair process less reactive in future releases, but this is the
best way to do it right now.) To be clear, I'm in no way advocating
not backing-up your data. You just might not need to use them in this
situation.

Another thing worth noting - the 'riak-admin backup' command is not
known to be the speediest. If you have any non-trivial amount of data
that needs backing up, you're probably best to do a FS snapshot of
Level on each node. Unfortunately doing a live snapshot of Level is
less than bulletproof at the moment, so you're advised to stop the
node, snapshot level, and restart. You'll have to take the node
offline for this but with five Riak nodes, your cluster should Just
Keep Crankingâ„¢.

Hope that helps.

Mark

[1] Fair warning: I'm not sure the last time this was tested -
http://contrib.basho.com/bucket\\_inspector.html


Thanks Riakers!
&gt;
&gt; Austin
&gt;

