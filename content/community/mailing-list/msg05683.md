---
title: "Re: Social network data / Graph properties of Riak"
description: ""
project: community
lastmod: 2011-11-19T12:30:00-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05683"
mailinglist_parent_id: "msg05671"
author_name: "Jeroen van Dijk"
project_section: "mailinglistitem"
sent_date: 2011-11-19T12:30:00-08:00
---


On Fri, Nov 18, 2011 at 9:28 PM, Aphyr  wrote:

&gt; On 11/18/2011 11:50 AM, Jeroen van Dijk wrote:
&gt;
&gt;&gt; And I also didn't include the riak user list for this reply:
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Nov 18, 2011 at 7:04 PM, Aphyr &gt; &gt; wrote:
&gt;&gt;
&gt;&gt; Depending on whether you think it will be more efficient to store
&gt;&gt; the graph or its dual, consider each node a vertex and write the
&gt;&gt; adjacency list as a part of its data. You can store whatever
&gt;&gt; weights, etc. you need on the edges there.
&gt;&gt;
&gt;&gt; Don't use links; they're just a thin layer on top of mapreduce, so
&gt;&gt; there's really not much advantage to using them. Links are subject
&gt;&gt; to the HTTP header lengths too, so storing more than a thousand on
&gt;&gt; any node is likely to break down.
&gt;&gt;
&gt;&gt;
&gt;&gt; Thank you for this suggestion. Also thanks for the warning on not using
&gt;&gt; links for what I want. So you are saying each vertex will have a list of
&gt;&gt; the other vertices that it is connected to? And save each edge as
&gt;&gt; key/value pair? Or are you saying each vertex should embed the adjacent
&gt;&gt; edges, meaning duplicated edges?
&gt;&gt;
&gt;
&gt; Depends on whether you want to store the graph or its dual. If you're
&gt; dealing with a sparse DAG where the input keys are likely to be vertex
&gt; names, the natural choice is to store each vertex as an object in riak and
&gt; each outbound edge from it as a property of that vertex.
&gt;
&gt; /users/user1:
&gt; owns: [item1, ...]
&gt; follows: [user2, ...]
&gt;
&gt; Of course, this method doesn't work well when you need to follow edges in
&gt; reverse, so you may need to store the reciprocal relationship on target
&gt; nodes:
&gt;
&gt; /items/item1:
&gt; owner: user1,
&gt;
&gt; /users/user2:
&gt; followed-by: [user1, ...]
&gt;
&gt; and so forth. That requires two writes and potentially lossy conflict
&gt; resolution strategies, e.g. a follows b but b is not followed by a. We use
&gt; processes which walk the graph continuously and enforce relationship
&gt; integrity as they go. We have a social graph of several hundred million
&gt; objects stored this way in Riak, and it works reasonably well.
&gt;
&gt; Naturally, you'll want to choose an encoding which is fast and
&gt; space-efficient for a large dataset. Depending on your needs, JSON,
&gt; protocol buffers, or fixed-length record entries might be work well.
&gt;
&gt; Also consider the depth of traversals you'll need to perform. It may be
&gt; best to use a graph database like neo4j for deep traversals. You could
&gt; store your primary dataset in Riak and replicate only the important graph
&gt; information to a graph DB via post-commit hooks. That would solve the
&gt; reciprocal consistency problem (at the cost of replication lag), and could
&gt; reduce the amount of data you need to put into the graph DB.
&gt;
&gt; Given that Linkedin has this problem, you might look into their tools as
&gt; well.
&gt;
&gt;
Thanks for your detailed reply. I'm very happy to hear that you are using
Riak for a similar use case. My dataset will be of a similar magnitude. It
will be a graph where edges have properties (e.g. user 1 rates item x with
2 stars), but I think saving these edges as separate objects will work.
I'll use post-commit hooks to get all this data in a graph database
(probably Neo4j) and use this for graph traversing.

A side question Kyle, how do you make sure the graph database is always
(eventually) consistent with Riak? E.g. how do you correct potential errors
during the post-commit hooks for instance? And say this database gets
corrupt how do you recover this graph database and get it in sync again
with Riak?

Cheers,
Jeroen

&gt; --Kyle
&gt;
&gt; I'm guessing you mean the former, because that makes sense to me. So you
&gt;&gt; would save a graph assuming users and items like the following key/value
&gt;&gt; pairs:
&gt;&gt;
&gt;&gt; //Vertices
&gt;&gt; user1: properties
&gt;&gt; user2: properties
&gt;&gt; item1: properties
&gt;&gt;
&gt;&gt; //Edges
&gt;&gt; user1-owns-item1: properties
&gt;&gt; user1-follows-user2: properties
&gt;&gt; user2-follows-user1: properties
&gt;&gt;
&gt;&gt; To be able to find the available edges, each vertices would need to
&gt;&gt; reference the keys of the edges. Is this what you mean?
&gt;&gt;
&gt;&gt; If so, one more question about a possible problem. Say I have an item
&gt;&gt; with many many outgoing edges, so it needs to embed these references.
&gt;&gt; This would make it really costly to fetch this item from Riak I assume,
&gt;&gt; even if you are only interested in normal properties. Wouldn't that mean
&gt;&gt; you will have to save the properties seperately from the edges
&gt;&gt; references to it feasible?
&gt;&gt;
&gt;&gt; Did I grasp what you were proposing Kyle?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Jeroen
&gt;&gt;
&gt;&gt; --Kyle
&gt;&gt;
&gt;&gt;
&gt;&gt; On 11/18/2011 07:38 AM, Jeroen van Dijk wrote:
&gt;&gt;
&gt;&gt; Hi all,
&gt;&gt;
&gt;&gt; I'm currently evaluating whether Riak would fit as the main
&gt;&gt; storage of
&gt;&gt; my current project, a social network. The reason I am attracted
&gt;&gt; to Riak
&gt;&gt; and less to a Graph database as main storage is that I want the
&gt;&gt; easy
&gt;&gt; horizontal scalability and multi-site replication that Riak
&gt;&gt; provides.
&gt;&gt; The only thing I doubt is whether the key-value/link model of
&gt;&gt; Riak is
&gt;&gt; flexible enough to be able to store a property graph
&gt;&gt; (http://arxiv.org/abs/1006.\\_\\_\\*\\*2361
&gt;&gt; &gt;).
&gt;&gt; I am not asking whether the
&gt;&gt;
&gt;&gt; querying/graph traversing will be easy; I'm probably going to use a
&gt;&gt; graph database or a Pregel like platform (e.g.
&gt;&gt; http://www.goldenorbos.org/) for that problem. I guess my main
&gt;&gt; question
&gt;&gt; is whether it would be easy/feasible to import and export a
&gt;&gt; property
&gt;&gt; graph in and from Riak? Has someone done this before?
&gt;&gt;
&gt;&gt; I realize the above might be too specific, so here are two more
&gt;&gt; questions that I think are relevant:
&gt;&gt;
&gt;&gt; - Is there a known upper limit of links that can be stored (I
&gt;&gt; don't want
&gt;&gt; to add them all at once so 1000 per request is fine,
&gt;&gt; http://lists.basho.com/\\_\\_\\*\\*pipermail/riak-users\\_lists.\\_\\_\\*\\*
&gt;&gt; basho.com/2010-March/000786.\\_\\_\\*\\*html
&gt;&gt; &gt; basho.com/2010-March/000786.\\*\\*html
&gt;&gt; &gt;)
&gt;&gt;
&gt;&gt; - Is there a way to add meta data to links (edges)? E.g. weigths
&gt;&gt; and
&gt;&gt; other attributes.
&gt;&gt;
&gt;&gt; Any other ideas or advise are also highly appreciated.
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt;
&gt;&gt; Jeroen
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com 
&gt;&gt; 
&gt;&gt; &gt;
&gt;&gt; http://lists.basho.com/\\_\\_\\*\\*mailman/listinfo/riak-users\\_\\_\\_\\*\\*
&gt;&gt; lists.basho.com
&gt;&gt; &gt; lists.basho.com
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/\\*\\*mailman/listinfo/riak-users\\_\\*\\*lists.basho.com
&gt;&gt;
&gt;
