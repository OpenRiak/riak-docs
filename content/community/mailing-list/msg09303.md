---
title: "Re: Quick Q re: error"
description: ""
project: community
lastmod: 2012-11-13T07:57:46-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09303"
mailinglist_parent_id: "msg09298"
author_name: "Martin Streicher"
project_section: "mailinglistitem"
sent_date: 2012-11-13T07:57:46-08:00
---



I'd guess it's just simple riak.yml support, albeit with an ability to define 
multiple nodes for the client. We'd also have to add support for Rails: 
riak.yml would be in one location for Rails apps and another for Ruby apps. 


On Nov 13, 2012, at 10:40 AM, Sean Cribbs wrote:

&gt; Glad you figured it out, Martin.
&gt; 
&gt; As you may have noticed, while Ripple provides the tight Rails
&gt; integration with initializers and such, the basic client does not. If
&gt; people think that's a valuable feature, I'd be happy to accept
&gt; pull-requests. :D
&gt; 
&gt; On Tue, Nov 13, 2012 at 9:30 AM, Martin Streicher
&gt;  wrote:
&gt;&gt; 
&gt;&gt; The issue was inconsistent configuration. There was a call to 
&gt;&gt; Riak::Client.new in config/initializers/riak.rb and two more calls in a 
&gt;&gt; method to do searches. I expected Riak::Client.new to perhaps pick up 
&gt;&gt; settings from a YML file each time, but I think I was wrong. I changed the 
&gt;&gt; code to create one connection in the initializers file, pointing to the node 
&gt;&gt; defined in the YML file, and then reuse that connection.
&gt;&gt; 
&gt;&gt; Martin
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On Nov 10, 2012, at 12:05 PM, Sean Cribbs wrote:
&gt;&gt; 
&gt;&gt;&gt; Can you ping the node? i.e. Riak::Client.ping
&gt;&gt;&gt; 
&gt;&gt;&gt; On Fri, Nov 9, 2012 at 9:17 AM, Martin Streicher
&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Locally, everything runs fine when on 127.0.0.1.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; If I change to 192.168.0.2 and change the vm.args and app.config and 
&gt;&gt;&gt;&gt; remove the data/rings, I fail to connect when trying to enable search.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I can get further if I do
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; client = Riak::Client.new(nodes: [{host: '192.168.0.2'}])
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; and then enable search using that client variable.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I think I am misunderstanding something about the nodes and which nodes 
&gt;&gt;&gt;&gt; the operations are going to.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; On Nov 9, 2012, at 12:10 PM, Sean Cribbs wrote:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Well, it's pretty obvious that it simply can't connect, especially
&gt;&gt;&gt;&gt;&gt; since your configuration is the default -- which means HTTP pointed to
&gt;&gt;&gt;&gt;&gt; 127.0.0.1:8098. Is your Riak node running and on that port? Can you
&gt;&gt;&gt;&gt;&gt; hit it from curl on the command line?
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; On Fri, Nov 9, 2012 at 7:36 AM, Martin Streicher
&gt;&gt;&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; I'm not doing anything special in Riak::Client.
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; How can I narrow what the RuntimeError is?
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; On Nov 9, 2012, at 10:21 AM, Sean Cribbs wrote:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Martin,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; How is your Riak::Client object configured? That looks like one of two
&gt;&gt;&gt;&gt;&gt;&gt;&gt; possibilities: first, the request failed 3 times in a row; second, one
&gt;&gt;&gt;&gt;&gt;&gt;&gt; of the backends is raising an exception that seems network related but
&gt;&gt;&gt;&gt;&gt;&gt;&gt; isn't one of the standard network errors (i.e it's a RuntimeError, but
&gt;&gt;&gt;&gt;&gt;&gt;&gt; it should be a SystemError with econnrefused errno!).
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Fri, Nov 9, 2012 at 7:12 AM, Martin Streicher
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I get a connection refused error when I try to enable search from my 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; code.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/shared/bundle/ruby/1.9.1/gems/riak-client-1.0.5/lib/riak/client.rb:450:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `rescue in recover\\_from': Connection refused - connect(2) 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; (RuntimeError)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; from 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/shared/bundle/ruby/1.9.1/gems/riak-client-1.0.5/lib/riak/client.rb:422:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `recover\\_from'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; from 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/shared/bundle/ruby/1.9.1/gems/riak-client-1.0.5/lib/riak/client.rb:284:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `http'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; from 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/shared/bundle/ruby/1.9.1/gems/riak-client-1.0.5/lib/riak/client.rb:129:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `backend'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; from 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/shared/bundle/ruby/1.9.1/gems/riak-client-1.0.5/lib/riak/client.rb:246:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `get\\_bucket\\_props'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; from 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/shared/bundle/ruby/1.9.1/gems/riak-client-1.0.5/lib/riak/bucket.rb:77:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `props'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; from 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/shared/bundle/ruby/1.9.1/gems/riak-client-1.0.5/lib/riak/bucket.rb:68:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `props='
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; from 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /var/www/zutron/releases/20121108191450/lib/classes/riak\\_search.rb:6:in
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; `enable\\_search'
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; enable\\_search is:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; def self.enable\\_search(bucket\\_name, client = Riak::Client.new)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; bucket = client.bucket bucket\\_name
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; bucket.props = {search: true}
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; end
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Any ideas why it's failing? Search is enabled on the machine.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt; Software Engineer
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; http://basho.com/
&gt;&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

