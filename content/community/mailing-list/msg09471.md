---
title: "Re: Odd question"
description: ""
project: community
lastmod: 2012-12-07T06:49:29-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09471"
mailinglist_parent_id: "msg09470"
author_name: "Martin Streicher"
project_section: "mailinglistitem"
sent_date: 2012-12-07T06:49:29-08:00
---



Duh. (Probably.)

Since email is the unique key for Identity, I suppose changing the key 
generates a new record rather than changing the old one. 

Thus, what I want to do is likely delete the old ones, those where the key has 
essentially been deprecated. 

Or is there a way to change a key?


On Dec 7, 2012, at 9:35 AM, Martin Streicher wrote:

&gt; I have a test case that demonstrates the issue now...
&gt; 
&gt; describe 'Copy Integrity' do
&gt; it 'remains unique' do
&gt; z = create :zid
&gt; i = create :identity, zid\\_id: z.key
&gt; Identity.find\\_by\\_index('zid\\_id', z.key).count.should eq(1)
&gt; 
&gt; i.email = 'uni...@unique.com'
&gt; i.save
&gt; Identity.find\\_by\\_index('zid\\_id', z.key).count.should eq(1)
&gt; end
&gt; end
&gt; 
&gt; The answer at bottom is 2, not 1. 
&gt; 
&gt; 
&gt; On Dec 7, 2012, at 9:19 AM, Martin Streicher wrote:
&gt; 
&gt;&gt; 
&gt;&gt; Thanks for the help earlier this week. I have an odd question...
&gt;&gt; 
&gt;&gt; I have an Identity model being used with Omniauth::Identity. All is well -- 
&gt;&gt; when someone registers, the credentials (email and encrypted password) are 
&gt;&gt; saved in Riak. 
&gt;&gt; 
&gt;&gt; However, if in some other code, I retrieve an Identity record by an indexed 
&gt;&gt; field and save it, a copy of the record seems to crop up with the new email 
&gt;&gt; field value.
&gt;&gt; 
&gt;&gt; @identity = Identity.find\\_by\\_index('zid\\_id', @zid.key).first
&gt;&gt; @identity.email = params[:profile][:email]
&gt;&gt; @identity.save
&gt;&gt; 
&gt;&gt; In other words, if I start with record A, I get A and now B, where B's email 
&gt;&gt; field is different. 
&gt;&gt; 
&gt;&gt; Ideas?
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

