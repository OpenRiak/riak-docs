---
title: "Riak Search on KV data in erlang terms"
description: ""
project: community
lastmod: 2013-01-22T07:16:34-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09869"
author_name: "Takeshi Matsumura"
project_section: "mailinglistitem"
sent_date: 2013-01-22T07:16:34-08:00
---


Hi,

I tried to store erlang data and query them by using the Riak Search without 
success so far, and thus would like to ask if I'm doing the right thing. Riak 
Search was enabled in the app.config file and the server was restarted. The 
pre-commit hook was installed from the command line.

bin/search-cmd install mybucket

The erlang data that I uploaded is a proplists with a single pair of key and 
value.

[{"name", "bob"}]

It was uploaded by using the curl command with Content-Type 
"application/x-erlang". (hoge.erl.txt contains the above erlang terms).

curl -v -d @hoge.erl.txt -X PUT -H "content-type: application/x-erlang" 
"http://localhost:8098/riak/mybucket/bob"

I could get the document by issuing curl command to "/riak/mybucket/bob". The 
HTTP response header contained the correct Content-Type, "application/x-erlang".

Then I run the Riak Search from the command line.

bin/search-cmd search mybucket "name:bob"

Unfortunately, the result said "Found 0 results".

As I wondered if this is a problem related to the erlang terms, I tried the 
same with a JSON data that is found in the "Indexing and Querying KV Data" page 
but setting "application/json" to the Content-type.

{
 "name":"Alyssa P. Hacker",
 "bio":"I'm an engineer, making awesome things.",
 "favorites":{
 "book":"The Moon is a Harsh Mistress",
 "album":"Magical Mystery Tour"
 }
}

Then the Riak Search could find this document with the query "name:Alyssa\\*".

According to the "Indexing and Querying KV Data" page of the Riak document, 
erlang terms can be queried by using the Riak Search. However, it is unclear to 
me if it is enabled by default because the page says XML, JSON, and plain-text 
encodings are supported out of the box but it doesn't mention the erlang terms.

I followed the "Other Data Encodings" section and set the 
"riak\\_search\\_kv\\_erlang\\_extractor" module, but it didm't change the situation.

curl -XPUT -H 'content-type: application/json' \\
 http://localhost:8098/riak/mybucket \\
 -d '{"props":{"search\\_extractor":{"mod":"riak\\_search\\_kv\\_erlang\\_extractor", 
"fun":"extract", "arg":"my\\_arg"}}}'

I changed the data as follows and uploaded but it didn't help either.

[{&lt;&lt;"name"&gt;&gt;, &lt;&lt;"bob"&gt;&gt;}]

I appreciate any hints for me to go forward. Thank you in advance.

Best regards,
 Takeshi
