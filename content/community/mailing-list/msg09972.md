---
title: "Parameter Planning (eleveldb)"
description: ""
project: community
lastmod: 2013-02-03T12:45:14-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09972"
author_name: "Simon Effenberg"
project_section: "mailinglistitem"
sent_date: 2013-02-03T12:45:14-08:00
---


Hi,

I'm not sure if I understand this all well to calculate the memory
usage per file and other stuff.

The webpage tells me some steps but I'm completly unsure if I understand all 
parameters.

"Step 1: Calculate Available Working Memory"

taking the example:

leveldb\\_working\\_memory = 32G \\* (1 - .50) = 16G

"Step 2: Calculate Working Memory per vnode"

vnode\\_working\\_memory = leveldb\\_working\\_memory / vnode\\_count

vnode\\_count = 256

=&gt; vnode\\_working\\_memory = 16G / 256 = 64MB/vnode

also easy

"Step 3: Estimate Memory Used by Open Files"

open\\_file\\_memory =
 (max\\_open\\_files-10) \\* (
 184 + (average\\_sst\\_filesize/2048) \\*
 (8 + ((average\\_key\\_size+average\\_value\\_size)/2048 +1) \\*
 0.6
 )

so how do I know the average\\_sst\\_filesize (and what is this value exactly)
(and is 2048 for both /2048 true or 4096 in riak 1.2?) and how do I know
the max\\_open\\_files?


average\\_key\\_size could be 16byte (I have to ask someone but taking it for now)
average\\_value\\_size will be 14kbyte 

so for now

open\\_file\\_memory =
 (max\\_open\\_files-10) \\* (
 184 + (average\\_sst\\_filesize/2048) \\*
 (8 + ((16+14336)/2048 +1) \\*
 0.6
 )

(side question: should I increase the block\\_size because of the big average 
value size?
and also should I leave the cache\\_size at the default value like it was 
recommended?)

"Step 4: Calculate Average Write Buffer"

should I increase these values or not? If only two are held in memory and I 
have, as an
example, 32GB or RAM like in this scenario, shouldn't I increase it to 
something else?

"Step 5: Calculate vnode Memory Used"

memory/vnode = average\\_write\\_buffer\\_size + cache\\_size + open\\_file\\_memory + 20 MB

So for now I miss almost all 3 values :(.

To get an Idea:

- 3 buckets
- overall ~ 343347732 keys (but only 2/3 have 14kbyte in average)


Thx for help!
Simon

