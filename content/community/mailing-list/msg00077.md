---
title: "Using protobuf client in Java"
description: ""
project: community
lastmod: 2010-04-19T14:34:20-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00077"
author_name: "Matthew Pflueger"
project_section: "mailinglistitem"
sent_date: 2010-04-19T14:34:20-07:00
---


Hi,

I’m having issues using the protobuf stuff. Writing/reading bytes
directly to/from the socket works but using the protoc generated Java
message builders either gives me nothing useful back or throws invalid
protocol exceptions. I’ve never used the protobuf stuff before so
maybe I’m doing something stupid...

First I modified the riakclient.proto file inserting a package
declaration: option java\\_package = "";

 protoc -I=. --java\\_out=./src riakclient.proto

 //ping
 out.writeRawBytes(new byte[] {0, 0, 0, 1, 1});
 out.flush();

 //pong {0, 0, 0, 1, 2}
 byte[] bytes = in.readRawBytes(5);
 assert bytes[4] == 2;

 //get server info
 out.writeRawBytes(new byte[] {0, 0, 0, 1, 7});
 out.flush();

 RpbGetServerInfoResp serverInfoResp =
RpbGetServerInfoResp.parseDelimitedFrom(socket.getInputStream());
 System.out.println("Connected to: " +
serverInfoResp.getNode().toStringUtf8());//toString());

parseDelimitedFrom doesn't throw an error but I get nothing back...
Using parseFrom I get an error... Any help would be appreciated...

--Matthew

