---
title: "Re: Upgrading from 1.1.2 to 1.2.0"
description: ""
project: community
lastmod: 2012-09-17T10:13:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08576"
mailinglist_parent_id: "msg08575"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2012-09-17T10:13:51-07:00
---

On Sep 17, 2012, at 1:00 PM, Kresten Krab Thorup  wrote:

&gt; It looks like your m/r request is missing a Content-Type header (probably 
&gt; should be application/json). Perhaps it is a new requirement/validator in 
&gt; 1.2, perhaps the old client library is not passing it along. 

Kresten is correct. Riak 1.1.4 and 1.2 require that you use the 
application/json content-type.
As far as I know, the official clients all respect this.

Colin, which client are you using?

Reid

&gt; 
&gt; Kresten
&gt; Trifork
&gt; 
&gt; On 17/09/2012, at 18.25, "Colin Alston"  
&gt; wrote:
&gt; 
&gt;&gt; Hi
&gt;&gt; 
&gt;&gt; I'm having serious issues trying to upgrade Riak from 1.1.2 to 1.2.0\\_1
&gt;&gt; on Ubuntu.
&gt;&gt; 
&gt;&gt; To upgrade I stop a cluster node, purge the old package and install
&gt;&gt; 1.2.0\\_1 but MapReduce fails on 1.2.
&gt;&gt; 
&gt;&gt; Exception: Error running MapReduce operation. Status: 500 :
&gt;&gt; 500 Internal Server
&gt;&gt; ErrorInternal Server Error
=====================

The server
&gt;&gt; encountered an error while processing this
&gt;&gt; request:  

```
{error,function_clause,
&gt;&gt;      [{string,tokens1,[undefined,";",[]],[{file,"string.erl"},{line,202}]},
&gt;&gt;       {mochiweb_util,parse_header,1,
&gt;&gt;                      [{file,"src/mochiweb_util.erl"},{line,367}]},
&gt;&gt;       {riak_kv_wm_mapred,base_type,1,
&gt;&gt;                          [{file,"src/riak_kv_wm_mapred.erl"},{line,110}]},
&gt;&gt;       {riak_kv_wm_mapred,ctype_ok,1,
&gt;&gt;                          [{file,"src/riak_kv_wm_mapred.erl"},{line,99}]},
&gt;&gt;       {riak_kv_wm_mapred,known_content_type,2,
&gt;&gt;                          [{file,"src/riak_kv_wm_mapred.erl"},{line,62}]},
&gt;&gt;       {webmachine_resource,resource_call,3,
&gt;&gt;                            [{file,"src/webmachine_resource.erl"},
&gt;&gt;                             {line,169}]},
&gt;&gt;       {webmachine_resource,do,3,
&gt;&gt;                            [{file,"src/webmachine_resource.erl"},
&gt;&gt;                             {line,128}]},
&gt;&gt;       {webmachine_decision_core,resource_call,1,
&gt;&gt;                                 [{file,"src/webmachine_decision_core.erl"},
&gt;&gt; 
&gt;&gt; {line,48}]}]}
```


---

mochiweb+webmachine web
&gt;&gt; server


&gt;&gt; 
&gt;&gt; What is the real upgrade procedure supposed to be? Do I need to kill
&gt;&gt; the Riak store directories as well (/var/lib/riak) and let them
&gt;&gt; re-replicate one at a time? A fresh install of 1.2 elsewhere does
&gt;&gt; work, with a totally new store, but spouts failures with a 1.1.2
&gt;&gt; store.
&gt;&gt; 
&gt; 
