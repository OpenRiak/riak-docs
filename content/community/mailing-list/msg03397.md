---
title: "Re: General Memory/Performance Tuning Guidelines"
description: ""
project: community
lastmod: 2011-05-24T14:32:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03397"
mailinglist_parent_id: "msg03388"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2011-05-24T14:32:16-07:00
---


Hi Gordon,

I have limited knowledge of configuring Innostore but can help answer some
of your merge\\_index questions.

The most important merge\\_index setting in terms of memory usage is
'buffer\\_rollover\\_size'. This affects how large the buffer is allowed to
grow, in bytes, before getting converted to an on-disk segment. Each
partition maintains a separate buffer, so any increases to this number will
be multiplied by the number of partitions in your system. The higher this
number, the less frequently merge\\_index will need to perform compactions.

The second most important settings for memory usage are a combination of
'segment\\_full\\_read\\_size' and 'max\\_compact\\_segments'. During compaction, the
system will completely page any segments smaller than the
'segment\\_full\\_read\\_size' value into memory. This should generally be as
large or larger than the 'buffer\\_rollover\\_size'. The higher this number, the
quicker each compaction will be. 'max\\_compact\\_segments' is the maximum
number of segments to compact at one time. The higher this number, the more
segments merge\\_index can involve in each compaction. In the worst case, a
compaction could take ('segment\\_full\\_read\\_size' \\* 'max\\_compact\\_segments')
bytes of RAM.

The rest of the settings have a much smaller impact on performance and
memory usage, and exist mainly for tweaking and special cases.

This is a completely unscientific estimate based on observing other Riak
Search applications, but I'd set buffer\\_rollover\\_size so that (# Partitions
\\* buffer\\_rollover\\_size) is about one-half the memory you wish for
merge\\_index to consume, hopefully somewhere between 1M and 10M. The rest of
the memory will be used by in-memory offset tables, compaction processes,
and during query operations.

Hope that helps.

Best,
Rusty


On Mon, May 23, 2011 at 2:05 PM, Gordon Tillman  wrote:

&gt; Greetings!
&gt;
&gt; We are working with a riaksearch cluster that uses innostore as the primary
&gt; backend in tandem with merge\\_index that is required by search. From reading
&gt; the Basho wiki it looks like the following are the most important factors
&gt; affecting memory and performance:
&gt;
&gt; • innostore
&gt; • put data\\_home\\_dir and log\\_group\\_home\\_dir on different
&gt; spindles
&gt; • noatime
&gt; • buffer\\_pool\\_size
&gt; • flush\\_method
&gt; • merge\\_index
&gt; • data\\_root
&gt; • buffer\\_rollover\\_size
&gt; • max\\_compact\\_segments
&gt; • segment\\_file\\_buffer\\_size
&gt; • segment\\_full\\_read\\_size
&gt; • segment\\_block\\_size
&gt;
&gt; Ideally, data\\_home\\_dir, log\\_group\\_home\\_dir, and data\\_root would all be on
&gt; different spindles, but if you had just 2 disks available what would you
&gt; recommend? Would it be best to have data\\_home\\_dir and data\\_root on one and
&gt; then log\\_group\\_home\\_dir on the other?
&gt;
&gt; in calculating the proper setting for buffer\\_pool\\_size you are directed to
&gt; allocate 60-80 percent of available RAM. So lets assume you want to take
&gt; the remaining 20-40% of available RAM and split it up between innostore and
&gt; merge\\_index?
&gt;
&gt; Would it be best to give each of them half of that value?
&gt;
&gt; Determining the approximate memory requirements for merge\\_index isn't (to
&gt; me) real obvious. I looks like the following all have an effect:
&gt;
&gt; \\* buffer\\_rollover\\_size
&gt; \\* buffer\\_delayed\\_write\\_size
&gt; \\* max\\_compact\\_segments
&gt; \\* segment\\_query\\_read\\_ahead\\_size
&gt; \\* segment\\_compaction\\_read\\_ahead\\_size
&gt; \\* segment\\_full\\_read\\_size
&gt; \\* segment\\_block\\_size
&gt; \\* segment\\_values\\_staging\\_size
&gt;
&gt; Is there a formula for determining the (approximate) proper values to use
&gt; given a certain amount of available RAM?
&gt;
&gt; Thanks in advance for any advice. Sorry for all the questions!
&gt;
&gt; --gordon
&gt;
&gt;
&gt;

