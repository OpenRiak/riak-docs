---
title: "Re: Riak Java client questions"
description: ""
project: community
lastmod: 2012-08-02T10:46:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08167"
mailinglist_parent_id: "msg08166"
author_name: "Brian Roach"
project_section: "mailinglistitem"
sent_date: 2012-08-02T10:46:58-07:00
---


Hi Oved - replies inlined below.


On Aug 2, 2012, at 11:04 AM, Oved Machlev wrote:

&gt; Hi,
&gt; 
&gt; I have been working with Riak in past 3 weeks, using the java client.
&gt; I have encountered a few issues, and could not find solutions so far.
&gt; This is the first time I write an email to this mailing list - Would be great 
&gt; if it reaches the right destination J
&gt; 
&gt; 1. Riak supports auto generated keys when storing an object - 
&gt; http://wiki.basho.com/Basic-Riak-API-Operations.html:
&gt; Store a new object and assign random key #
&gt; 
&gt; If your application would rather leave key-generation up to Riak, issue a 
&gt; POST request to the bucket URL instead of a PUT to a bucket/key pair: POST 
&gt; /riak/bucket If you don’t pass Riak a “key” name after the bucket, it will 
&gt; know to create one for you.
&gt; 
&gt; Is it possible to do the same when using the java client? it seems that key 
&gt; must be provided when storing an object.
&gt; 

Right now the Java client doesn't support this. These is an issue open for this 
on github and I agree it needs to be added. 

After the 1.0.6 release (along with Riak 1.2) I hope to work on this and get it 
added. 

&gt; 2. I have a POJO which I store. It contains a set of objects which I do 
&gt; not wish to persist, I mark it as transient:
&gt; 
&gt; transient private Set services;
&gt; but still, this set is being persisted – when I fetch my POJO (curl and java) 
&gt; I can see this:
&gt; 
&gt; 
&gt; {"name":"oved","lastUpdate":"1343923201735","data":null,"services":[]}
&gt; 
&gt; Is there something else I need to do to tell Riak to ignore it?
&gt; 

The default Converter used if you do not specify your own is the 
JSONConverter. This uses the Jackson JSON library. 

To exclude a field from serialization you would need to use the 
(org.codehaus.jackson.annotate) @JsonIgnore annotation. 

&gt; 3. This is more basic question – I keep on thinking that my stored 
&gt; objects should implement the IRIAKObject, but I avoided doing that so far, 
&gt; because in all the examples in the cookbook, it is never being done. So in 
&gt; theoretical level – should the objects that are stored in riak database 
&gt; implement this interface or not? Is there any value in doing that?
&gt; 

Not particularly. That's what the Converter is doing behind the scenes; 
converting back and forth between your POJO and a IRiakObject


&gt; 4. MapReduce – If I perform the following without the line in bold 
&gt; (link) I get the collection of ServiceProviders without the Services that are 
&gt; linked.
&gt; When adding the LinkPhase, I am getting a JsonMappingException (see below). 
&gt; Any idea what is causing that? What am I missing? Both objects (service and 
&gt; serviceProvider) are stored as JsonObjects.
&gt; 
&gt; public Collection getAllServiceProvider() throws 
&gt; Exception{
&gt; 
&gt; BucketMapReduce m = riakClient.mapReduce("SERVICE\\_PROVIDER");
&gt; m.addMapPhase(new NamedJSFunction("Riak.mapValuesJson"), true);
&gt; m.addLinkPhase("SERVICE", "\\_");
&gt; MapReduceResult result = m.execute(); 
&gt; return result.getResult(ServiceProvider.class);
&gt; }
&gt; 
&gt; 
&gt; The exception:
&gt; com.basho.riak.client.convert.ConversionException: 
&gt; org.codehaus.jackson.map.JsonMappingException: Can not deserialize instance 
&gt; of com.att.cso.omss.datastore.riak.entities.ServiceProvider out of 
&gt; START\\_ARRAY token
&gt; at [Source: java.io.StringReader@31958905; line: 1, column: 2]
&gt; at 
&gt; com.basho.riak.client.raw.http.ConversionUtil$1.getResult(ConversionUtil.java:601)
&gt; 
&gt; 

Jackson is having some issue trying to map the JSON returned to your 
ServiceProvider class. Can you check the JSON stored in Riak and make sure it's 
what you think it is? If I could see the class and the JSON I might be able to 
offer more insight.


&gt; Sorry for the long email, and thanks in advance…

No Worries!

Thanks,
Brian Roach
