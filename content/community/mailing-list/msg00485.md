---
title: "Re: 400 on idle connection"
description: ""
project: community
lastmod: 2010-06-01T19:16:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00485"
mailinglist_parent_id: "msg00484"
author_name: "Jonathan Lee"
project_section: "mailinglistitem"
sent_date: 2010-06-01T19:16:33-07:00
---


Ah, I missed that. Thanks for the quick response! I just re-cloned riak
and ran make, and the mochiweb pulled contains that changeset. However, it
is not checked out for me:

[~/riak]&gt; cd deps/mochiweb
[~/riak/deps/mochiweb]&gt; hg parents
changeset: 115:5ccf25b213fc
user: Bryan Fink 
date: Thu Apr 08 16:33:24 2010 -0400
summary: copy riak/apps/mochiweb to external mochiweb repo

Running hg up and rebuilding fixes this. Is this a config issue?

- Jonathan

On Tue, Jun 1, 2010 at 10:00 PM, Sean Cribbs  wrote:

&gt; Jonathan,
&gt;
&gt; This has already been fixed on tip and should be released with 0.11. See:
&gt; http://hg.basho.com/mochiweb/changeset/6cc943959128
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; On Jun 1, 2010, at 9:57 PM, Jonathan Lee wrote:
&gt;
&gt; &gt; Here's a question regarding idle connection handling. Riak (actually,
&gt; mochiweb:request/2) automatically resets idle connections after 30 seconds.
&gt; But, before closing the connection, it sends a 400 response. For example:
&gt; &gt;
&gt; &gt; &gt; time telnet 127.0.0.1 8091
&gt; &gt; Trying 127.0.0.1...
&gt; &gt; Connected to localhost.
&gt; &gt; Escape character is '^]'.
&gt; &gt; HTTP/1.1 400 Bad Request
&gt; &gt; Server: MochiWeb/1.0 (Any of you quaids got a smint?)
&gt; &gt; Date: Wed, 02 Jun 2010 01:39:41 GMT
&gt; &gt; Content-Length: 0
&gt; &gt;
&gt; &gt; Connection closed by foreign host.
&gt; &gt;
&gt; &gt; real 0m30.010s
&gt; &gt; user 0m0.002s
&gt; &gt; sys 0m0.004s
&gt; &gt;
&gt; &gt; Is this expected behavior? At first glance, I don't see anything in the
&gt; HTTP RFC that requires or recommends this. Is there a specific reason for
&gt; sending the 400?
&gt; &gt;
&gt; &gt; My reason for asking this question is that the Java client misinterprets
&gt; this final 400 and returns it for the wrong request! This can be fixed by
&gt; having a separate thread actively evict idle connections, but if this is
&gt; unexpected behavior on the server side, it'd make more sense to change it
&gt; there.
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt; Jonathan
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

