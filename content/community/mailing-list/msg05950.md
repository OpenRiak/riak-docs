---
title: "Re: some really weird stuff with python client's delete..."
description: ""
project: community
lastmod: 2011-12-15T06:41:32-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05950"
mailinglist_parent_id: "msg05947"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-12-15T06:41:32-08:00
---


Hi Shuhau,

Do you intentionally try and delete all of the keys from the users bucket?
 The keys list is built from the keys in the blog and the users bucket.
 Would changing the code to list the blog bucket, delete then verify before
moving on to the users bucket do what you want?

Jon

On Wed, Dec 14, 2011 at 7:54 PM, Shuhao Wu  wrote:

&gt; I'm trying to delete all the keys i've created after running some
&gt; doctests. (I know i should be using the test server.. but it appears that i
&gt; need to be root to run that...)
&gt;
&gt; Here's the script:
&gt;
&gt; #!/usr/bin/python
&gt; if \\_\\_name\\_\\_ == "\\_\\_main\\_\\_":
&gt; import doctest
&gt; print "Running tests...."
&gt; #doctest.testfile("README.md") # I commented this out because my cleanup
&gt; is not deleting...
&gt; print "If nothing happened, success.. otherwise.. DEBUG HOUR!"
&gt;
&gt; # Clean up
&gt; import riak
&gt; print "Clean up time!"
&gt; client = riak.RiakClient()
&gt; bucket = client.bucket("blog")
&gt; keys = bucket.get\\_keys()
&gt; bucket = client.bucket("users")
&gt; keys.extend(bucket.get\\_keys())
&gt; print "Keys to be cleaned: " + str(keys)
&gt;
&gt; for key in keys:
&gt; print ("Deleting %s..." % key), not bucket.get(key).delete().exists()
&gt;
&gt; for key in keys:
&gt; print "Verifying %s deleted: %s" % (key, not bucket.get(key).exists())
&gt;
&gt; print "Deleted %d keys!" % len(keys)
&gt;
&gt;
&gt; Here's the output:
&gt;
&gt; Running tests....
&gt; If nothing happened, success.. otherwise.. DEBUG HOUR!
&gt; Clean up time!
&gt; Keys to be cleaned: [u'534c8cda268b11e1b1b68ca982440b40',
&gt; u'b8eb84e8268a11e195748ca982440b40', u'6fa5b678268a11e1bf8d8ca982440b40',
&gt; u'dada10a6268a11e1a0888ca982440b40', u'549e0e2a268a11e1be1e8ca982440b40',
&gt; u'4957347e268a11e196e68ca982440b40', u'c03e2df8268b11e1ae5e8ca982440b40',
&gt; u'ddadfe28268a11e1ad0b8ca982440b40', u'7d54bb7a268a11e187718ca982440b40']
&gt; Deleting 534c8cda268b11e1b1b68ca982440b40... True
&gt; Deleting b8eb84e8268a11e195748ca982440b40... True
&gt; Deleting 6fa5b678268a11e1bf8d8ca982440b40... True
&gt; Deleting dada10a6268a11e1a0888ca982440b40... True
&gt; Deleting 549e0e2a268a11e1be1e8ca982440b40... True
&gt; Deleting 4957347e268a11e196e68ca982440b40... True
&gt; Deleting c03e2df8268b11e1ae5e8ca982440b40... True
&gt; Deleting ddadfe28268a11e1ad0b8ca982440b40... True
&gt; Deleting 7d54bb7a268a11e187718ca982440b40... True
&gt; Verifying 534c8cda268b11e1b1b68ca982440b40 deleted: True
&gt; Verifying b8eb84e8268a11e195748ca982440b40 deleted: True
&gt; Verifying 6fa5b678268a11e1bf8d8ca982440b40 deleted: True
&gt; Verifying dada10a6268a11e1a0888ca982440b40 deleted: True
&gt; Verifying 549e0e2a268a11e1be1e8ca982440b40 deleted: True
&gt; Verifying 4957347e268a11e196e68ca982440b40 deleted: True
&gt; Verifying c03e2df8268b11e1ae5e8ca982440b40 deleted: True
&gt; Verifying ddadfe28268a11e1ad0b8ca982440b40 deleted: True
&gt; Verifying 7d54bb7a268a11e187718ca982440b40 deleted: True
&gt; Deleted 9 keys!
&gt;
&gt; I can run this multiple times and it doesn't delete it and always show the
&gt; exact same output... but if i open a separate python console and delete one
&gt; of these keys via the same method (create a client, get a bucket, get the
&gt; object via key, delete the object...), this will go down to 9 keys...
&gt;
&gt; What's wrong? I'm so confused by this thing..
&gt;
&gt; Shuhao
&gt;

-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
