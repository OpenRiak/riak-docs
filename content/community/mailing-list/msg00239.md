---
title: "Re: keys=stream"
description: ""
project: community
lastmod: 2010-05-04T06:30:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00239"
mailinglist_parent_id: "msg00238"
author_name: "Adam Hunter"
project_section: "mailinglistitem"
sent_date: 2010-05-04T06:30:11-07:00
---


Just curb, I couldn't get net/http to work when doing chunked (something about 
read\\_body being called twice).


On May 4, 2010, at 9:28 AM, Sean Cribbs wrote:

&gt; Are you using curb or net/http?
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On May 4, 2010, at 9:26 AM, Adam Hunter wrote:
&gt; 
&gt;&gt; The problem I was running into was some of the chunks were only part of the 
&gt;&gt; json object. Decoded it would be something like this:
&gt;&gt; 
&gt;&gt; chunk 1: {'keys':[1,2,3,4
&gt;&gt; chunk 2: 5,6,7,8,9]}
&gt;&gt; 
&gt;&gt; I was running this on a bucket with about 11k keys. Using ripple I could 
&gt;&gt; only get about 150 keys back this way because all the other chunks were not 
&gt;&gt; valid json. I hacked around this for now by checking to see if the chunk 
&gt;&gt; ends in ]}, otherwise I accumulate chunks until I have a full json object.
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Adam
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On May 4, 2010, at 9:22 AM, Sean Cribbs wrote:
&gt;&gt; 
&gt;&gt;&gt; This behavior is unchanged since its implementation in 0.8 or 0.9. To 
&gt;&gt;&gt; better demonstrate what that statement means, here's the joined output of a 
&gt;&gt;&gt; streamed keys response:
&gt;&gt;&gt; 
&gt;&gt;&gt; {"props":{"name":"foo","n\\_val":3,"allow\\_mult":false,"precommit":[],"postcommit":[],"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"old\\_vclock":86400,"young\\_vclock":20,"big\\_vclock":50,"small\\_vclock":10}}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}{"keys":[]}
&gt;&gt;&gt; 
&gt;&gt;&gt; If your client library supports per-chunk processing, each of those 
&gt;&gt;&gt; {"keys":[]} objects will be an encoded chunk. The Ruby client and most of 
&gt;&gt;&gt; the other clients support this.
&gt;&gt;&gt; 
&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt; 
&gt;&gt;&gt; On May 3, 2010, at 9:28 PM, Adam Hunter wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Hi All,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I apologize if this has been covered already.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; In the wiki it says "If keys=stream, the response will be transferred 
&gt;&gt;&gt;&gt; using chunked-encoding, where each chunk is a JSON object" (on 
&gt;&gt;&gt;&gt; http://wiki.basho.com/display/RIAK/REST+API)
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; This doesn't seem to be the case, sometimes a json object is broken into 
&gt;&gt;&gt;&gt; several chunks. Is this behavior correct?
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Adam
