---
title: "Re: high 99.9% latencies with leveldb backend"
description: ""
project: community
lastmod: 2012-10-30T12:44:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09088"
mailinglist_parent_id: "msg09087"
author_name: "Matthew Von-Maszewski"
project_section: "mailinglistitem"
sent_date: 2012-10-30T12:44:36-07:00
---


D,

Go here: http://basho.com/blog/technical/2012/10/30/leveldb-in-riak-1p2/

leveldb has code that will explicitly stall write operations if it gets too far 
behind in compaction. 3 to 4 seconds is nothing. 1.1 can stall into the 
minutes range if you push it hard enough.

You either need to throttle the input rate or update to 1.2.1. That is the 
best hope I can offer.

Matthew

On Oct 30, 2012, at 3:31 PM, Dietrich Featherston wrote:

&gt; Seeing 99th percentile put latencies at around 30-40 ms with 99.9th 
&gt; percentile jumping all the way up to 3-4s. This is riak 1.1 with the eleveldb 
&gt; backend on a 9-node cluster, N = 2, W = 1. Lots of free iops, but CPU is 
&gt; consistently burning 30-40% across all 8 cores.
&gt; 
&gt; Wondering if this could be caused by leveldb compactions which, to my 
&gt; knowledge, will wedge the scheduler for the duration of the compaction in 
&gt; riak 1.1.
&gt; 
&gt; Any other thoughts for troubleshooting? Not a platform or erlang version with 
&gt; dtrace support so that's out.
&gt; 
&gt; Thanks,
&gt; D
&gt; 

