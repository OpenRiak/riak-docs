---
title: "Re: Specified w/dw/pw values invalid for bucket n value of 1"
description: ""
project: community
lastmod: 2012-09-24T06:07:13-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08666"
mailinglist_parent_id: "msg08592"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2012-09-24T06:07:13-07:00
---



On 24 Sep 2012, at 13:38, Ingo Rockel wrote:

&gt; Hi,
&gt; 
&gt; I finally found the reason for this message: Although the bucket was 
&gt; initialized with r=1, the java client silently appended a "r=2" to all 
&gt; fetches which caused this message.

I've found the code that does this. It is deep in the legacy client code, but 
it is a bug. Very sorry about this and thanks for finding the issue.

https://github.com/basho/riak-java-client/blob/master/src/main/java/com/basho/riak/client/http/util/ClientHelper.java#L231

&gt; 
&gt; The combination of two things really cost me a lot of time to find the reason 
&gt; for this:
&gt; \\* the error message from riak complains about wrong write parameters but in 
&gt; fact the read parameter was wrong.

This is also a bug, in Riak, in the riak\\_kv\\_wm\\_object module, and I've opened 
an issue for this, too.

&gt; \\* the java client library silently attaches a "r=2" to all read queries and I 
&gt; didn't find anything in the documentation about this. Is this intended or a 
&gt; bug?

It looks like it is was \\_intended\\_ by the initial author, but it is a bad idea, 
and therefore a bug.

Again, thanks for finding those, and sorry for the time/effort lost.

I opened the following two issues

https://github.com/basho/riak-java-client/issues/167
https://github.com/basho/riak\\_kv/issues/398

Cheers

Russell

&gt; 
&gt; Setting the used apache http client into trace really helped a lot, maybe you 
&gt; should add something about this into the java client documentation.
&gt; 
&gt; Ingo
&gt; 
&gt; Am 19.09.2012 16:10, schrieb Ingo Rockel:
&gt;&gt; Hi Russell,
&gt;&gt; 
&gt;&gt; I'm using riak 1.2 and the client version is version 1.0.5 and
&gt;&gt; concerning HTTP and PB, I tried both.
&gt;&gt; 
&gt;&gt; Ingo
&gt;&gt; 
&gt;&gt; Am 19.09.2012 16:04, schrieb Russell Brown:
&gt;&gt;&gt; 
&gt;&gt;&gt; On 19 Sep 2012, at 14:54, Ingo Rockel wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Hi Mark,
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; thanks for looking into this.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I'm using the riak-java-client for accessing riak,
&gt;&gt;&gt; 
&gt;&gt;&gt; Are you using HTTP or PB, please? And can you let me know the version,
&gt;&gt;&gt; too?
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks
&gt;&gt;&gt; 
&gt;&gt;&gt; Russell
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; the bucket is created with the following code:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; msgBucket = riakClient.createBucket(MSG\\_BUCKET\\_ID).
&gt;&gt;&gt;&gt; nVal(1).w(1).dw(1).pw(1).
&gt;&gt;&gt;&gt; execute();
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; and the write operation is:
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; msgBucket.store("Mailbox|" + messageDto.getReceptor(),
&gt;&gt;&gt;&gt; createMailbox(messageDto)).execute();
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; without doing any modification of w/dw/pw for the single write.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Ingo
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Am 19.09.2012 07:56, schrieb Mark Phillips:
&gt;&gt;&gt;&gt;&gt; Hi Ingo
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; I just built a single node Riak 1.2 from source on my laptop, cranked
&gt;&gt;&gt;&gt;&gt; the n, w, dw, and pw values down to "1", and was able to write
&gt;&gt;&gt;&gt;&gt; successfully via curl. For the sake of completeness, I attempted to
&gt;&gt;&gt;&gt;&gt; write with "w=2" and was able to throw the "Specified w/dw/pw values
&gt;&gt;&gt;&gt;&gt; invalid for bucket n value of 1" error that you reported.
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Any chance you have some app code that's changing the W value? Can you
&gt;&gt;&gt;&gt;&gt; share the specifics of the request that's failing?
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; Mark
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt; On Tue, Sep 18, 2012 at 9:33 AM, Ingo Rockel
&gt;&gt;&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt;&gt;&gt; Hi Mark,
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; yes, I'm running 1.2.
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; Ingo
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; Am 18.09.2012 02:11, schrieb Mark Phillips:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi Ingo,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Sorry for the holdup here.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Riak shouldn't be throwing this error if all your R and W values are
&gt;&gt;&gt;&gt;&gt;&gt;&gt; set to "1". Are you running Riak 1.2?
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Mark
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Mon, Sep 17, 2012 at 3:10 AM, Ingo Rockel
&gt;&gt;&gt;&gt;&gt;&gt;&gt;  wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Anyone?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Am 30.08.2012 18:34, schrieb Ingo Rockel:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi List,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I'm trying to set the n-val to 1 for my single-node test server
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; but do
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; always fail with the following error:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Specified w/dw/pw values invalid for bucket n value of 1
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; This is my bucket configuration:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; {"props":{"allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dw":1,"last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":1,"name":"messages","notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":1,"precommit":[],"pw":1,"r":1,"rw":1,"small\\_vclock":50,"w":1,"young\\_vclock":20}}
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I can't see what's wrong with it, maybe someone can shed a light.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Regards,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Ingo
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt; Software Architect
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; Blue Lion mobile GmbH
&gt;&gt;&gt;&gt;&gt;&gt; Tel. +49 (0) 221 788 797 14
&gt;&gt;&gt;&gt;&gt;&gt; Fax. +49 (0) 221 788 797 19
&gt;&gt;&gt;&gt;&gt;&gt; Mob. +49 (0) 176 24 87 30 89
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; ingo.roc...@bluelionmobile.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; qeep: Hefferwolf
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; www.bluelionmobile.com
&gt;&gt;&gt;&gt;&gt;&gt; www.qeep.net
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Software Architect
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Blue Lion mobile GmbH
&gt;&gt;&gt;&gt; Tel. +49 (0) 221 788 797 14
&gt;&gt;&gt;&gt; Fax. +49 (0) 221 788 797 19
&gt;&gt;&gt;&gt; Mob. +49 (0) 176 24 87 30 89
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; ingo.roc...@bluelionmobile.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt; qeep: Hefferwolf
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; www.bluelionmobile.com
&gt;&gt;&gt;&gt; www.qeep.net
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Software Architect
&gt; 
&gt; Blue Lion mobile GmbH
&gt; Tel. +49 (0) 221 788 797 14
&gt; Fax. +49 (0) 221 788 797 19
&gt; Mob. +49 (0) 176 24 87 30 89
&gt; 
&gt; ingo.roc...@bluelionmobile.com
&gt; &gt;&gt;&gt; qeep: Hefferwolf
&gt; 
&gt; www.bluelionmobile.com
&gt; www.qeep.net
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

