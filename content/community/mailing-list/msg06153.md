---
title: "Weird (?) error while using riak erlang pb client's mapreduce"
description: ""
project: community
lastmod: 2012-01-06T07:18:49-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06153"
author_name: "Alin Popa"
project_section: "mailinglistitem"
sent_date: 2012-01-06T07:18:49-08:00
---


Hi guys,

I've start using the mapreduce functionality from riak erlang's client
(riak-erlang-client) on a riak node (not being part of a cluster) and I
keep getting the follwing error in the crash.log file:

2012-01-06 16:43:17 =ERROR REPORT====
\\*\\* State machine &lt;0.1619.0&gt; terminating
\\*\\* Last event in was
{input,{{ok,{r\\_object,&lt;&lt;"small-bucket"&gt;&gt;,&lt;&lt;"some-magnific-key-15"&gt;&gt;,[{r\\_content,{dict,3,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;"X-Riak-VTag"&gt;&gt;,53,55,79,110,74,85,80,68,102,70,111,78,107,103,111,52,120,109,100,121,82,74]],[[&lt;&lt;"index"&gt;&gt;]],[],[[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|{1325,860978,730558}]],[],[]}}},&lt;&lt;"1970-01-01
05:27:00"&gt;&gt;}],[{&lt;&lt;35,9,254,249,79,7,8,5&gt;&gt;,{1,63493080178}}],{dict,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[[clean|true]],[]}}},undefined},undefined},[{936274486415109681974235595958868809467081785344,'
riak@127.0.0.1'}]}}
\\*\\* When State == wait\\_for\\_input
\\*\\* Data ==
{state,936274486415109681974235595958868809467081785344,{fitting\\_details,{fitting,&lt;0.1583.0&gt;,#Ref&lt;0.0.0.4840&gt;,follow,1},0,riak\\_kv\\_mrc\\_map,{{qfun,#Fun},none},{fitting,&lt;0.1581.0&gt;,#Ref&lt;0.0.0.4840&gt;,sink,undefined},[{sink,{fitting,&lt;0.1581.0&gt;,#Ref&lt;0.0.0.4840&gt;,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64},&lt;0.351.0&gt;,{state,936274486415109681974235595958868809467081785344,{fitting\\_details,{fitting,&lt;0.1583.0&gt;,#Ref&lt;0.0.0.4840&gt;,follow,1},0,riak\\_kv\\_mrc\\_map,{{qfun,#Fun},none},{fitting,&lt;0.1581.0&gt;,#Ref&lt;0.0.0.4840&gt;,sink,undefined},[{sink,{fitting,&lt;0.1581.0&gt;,#Ref&lt;0.0.0.4840&gt;,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64},{qfun,#Fun},none}}
\\*\\* Reason for termination =
\\*\\* processing\\_error
2012-01-06 16:43:17 =CRASH REPORT====
 crasher:
 initial call: riak\\_pipe\\_vnode\\_worker:init/1
 pid: &lt;0.1619.0&gt;
 registered\\_name: []
 exception exit: processing\\_error
 in function gen\\_fsm:terminate/7
 in call from proc\\_lib:init\\_p\\_do\\_apply/3
 ancestors:
[&lt;0.352.0&gt;,&lt;0.351.0&gt;,riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.75.0&gt;]
 messages: []
 links: [&lt;0.352.0&gt;,&lt;0.351.0&gt;]
 dictionary:
[{eunit,[{module,riak\\_pipe\\_vnode\\_worker},{partition,936274486415109681974235595958868809467081785344},{&lt;0.351.0&gt;,&lt;0.351.0&gt;},{details,{fitting\\_details,{fitting,&lt;0.1583.0&gt;,#Ref&lt;0.0.0.4840&gt;,follow,1},0,riak\\_kv\\_mrc\\_map,{{qfun,#Fun},none},{fitting,&lt;0.1581.0&gt;,#Ref&lt;0.0.0.4840&gt;,sink,undefined},[{sink,{fitting,&lt;0.1581.0&gt;,#Ref&lt;0.0.0.4840&gt;,sink,undefined}},{log,sink},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}],64}}]}]
 trap\\_exit: false
 status: running
 heap\\_size: 1597
 stack\\_size: 24
 reductions: 621
 neighbours:
2012-01-06 16:43:17 =SUPERVISOR REPORT====
 Supervisor: {&lt;0.352.0&gt;,riak\\_pipe\\_vnode\\_worker\\_sup}
 Context: child\\_terminated
 Reason: processing\\_error
 Offender:
[{pid,&lt;0.1619.0&gt;},{name,undefined},{mfargs,{riak\\_pipe\\_vnode\\_worker,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,2000},{child\\_type,worker}]

and this is the code that I'm using for this:

\\*-module(simple\\_mapreduce).\\*
\\*
\\*
\\*-compile(export\\_all).\\*
\\*
\\*
\\*main(Pid) -&gt;\\*
\\* {ok, Pid} = riakc\\_pb\\_socket:start\\_link("127.0.0.1", 8087),\\*
\\* Fun = fun(Object, \\_KeyData, none) -&gt; [Object] end,\\*
\\* riakc\\_pb\\_socket:mapred(Pid, {&lt;&lt;"small-bucket"&gt;&gt;,[]}, [{map, {qfun,
Count}, none, true}]).\\*


It's a very simple usage, and according to the documentation, I haven't
missed anything here (I know I can use the modfun instead of qfun for
exactly this functionality, but it's just an example which throws).

Also, for the master version of riak, I'm getting error as return value of
calling mapred function on riakc\\_pb\\_socket:

\\*
{error,&lt;&lt;"{\\"phase\\":0,\\"error\\":\\"undef\\",\\"input\\":\\"{ok,{r\\_object,&lt;&lt;\\\\\\"small-bucket\\\\\\"&gt;&gt;,&lt;&lt;\\\\\\"some-magnific-key-44\\\\\\"&gt;&gt;,[{r\\_cont"...&gt;&gt;}
\\*
\\*
\\*
Is there a way that I can understand what these logs means ? It's all
erlang information there, but the problem is that it's related to a lot of
internals which I don't know.
Is it something very obvious that escapes my attention here ?

Thanks,
Alin
