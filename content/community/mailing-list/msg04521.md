---
title: "Re: Speed of linkwalking"
description: ""
project: community
lastmod: 2011-08-30T12:01:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04521"
mailinglist_parent_id: "msg04519"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-08-30T12:01:27-07:00
---


Good catch Kev.

Mark, If you run the same operation with map removed, what is the
performance at that point?\\*

 
 Jonathan Langevin
Systems Administrator
Loom Inc.
Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
www.loomlearning.com - Skype: intel352
\\*


On Tue, Aug 30, 2011 at 2:45 PM, Kev Burns  wrote:

&gt; Mark,
&gt;
&gt; That's not just a link walk, you're also performing a map operation there.
&gt;
&gt; $client-&gt;add($bucketname, 'linkkey1')-&gt;
&gt; link()-&gt;
&gt; map(array("riak\\_kv\\_mapreduce", "map\\_object\\_value")) -&gt;
&gt; run();
&gt;
&gt;
&gt; If the expected number of returned objects is small, performing the map
&gt; phase in PHP may be faster.
&gt;
&gt; - Kev
&gt; c: +001 (650) 521-7791
&gt;
&gt;
&gt; On Tue, Aug 30, 2011 at 7:31 AM, Mark Steele wrote:
&gt;
&gt;&gt; Hi folks,
&gt;&gt;
&gt;&gt; Just want to know if I'm doing something obviously dumb here.
&gt;&gt;
&gt;&gt; First the (PHP) code (Sorry of the API is different from the official API,
&gt;&gt; we're using a heavily modified version):
&gt;&gt;
&gt;&gt; 
&gt;&gt; $obj1 = $bucket-&gt;newObject('linkkey1', array('link1'));
&gt;&gt; $obj2 = $bucket-&gt;newObject('linkkey2', 'dataforlinkkey2');
&gt;&gt; $obj1-&gt;addLink($obj2);
&gt;&gt; $obj2-&gt;addLink($obj1);
&gt;&gt; $obj1-&gt;store();
&gt;&gt; $obj2-&gt;store();
&gt;&gt;
&gt;&gt; $start = microtime(true);
&gt;&gt; $blargh = $bucket-&gt;get('linkkey2');
&gt;&gt; $end = microtime(true);
&gt;&gt; printf("Took : %04f\\n",$end - $start);
&gt;&gt;
&gt;&gt; $start = microtime(true);
&gt;&gt; $result =
&gt;&gt; $client-&gt;add($bucketname, 'linkkey1')-&gt;
&gt;&gt; link()-&gt;
&gt;&gt; map(array("riak\\_kv\\_mapreduce", "map\\_object\\_value")) -&gt;
&gt;&gt; run();
&gt;&gt; foreach ($result as $data) {
&gt;&gt; //var\\_dump($data);
&gt;&gt; }
&gt;&gt; $end = microtime(true);
&gt;&gt; printf("Took : %04f\\n",$end - $start);
&gt;&gt; 
&gt;&gt;
&gt;&gt; So here's what I'm seeing:
&gt;&gt;
&gt;&gt; The simple key fetch takes 0.000661 seconds to execute, whereas the
&gt;&gt; link-walk takes 0.042043. Ouch. Quite a bit slower. Any ways to speed
&gt;&gt; this up?
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt;
&gt;&gt; Mark Steele
&gt;&gt; Bering Media Inc.
&gt;&gt;
&gt;

