---
title: "Re: preflist_exhausted error"
description: ""
project: community
lastmod: 2012-04-24T17:12:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07315"
mailinglist_parent_id: "msg07310"
author_name: "Matthew Tovbin"
project_section: "mailinglistitem"
sent_date: 2012-04-24T17:12:11-07:00
---


Sati,

Check, if you see the following error in your log file:
crasher:
 initial call: riak\\_kv\\_js\\_vm:init/1
 pid: &lt;0.404.0&gt;
 registered\\_name: []
 exception exit: {{badmatch,{error
,enoent}},[{riak\\_kv\\_js\\_vm,load\\_mapred\\_builtins,1},{js\\_driver,new,3},{riak\\_kv\\_js\\_vm,init,1},{gen\\_server,init\\_it,6},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
 in function gen\\_server:init\\_it/6
 in call from proc\\_lib:init\\_p\\_do\\_apply/3
 ancestors: [riak\\_kv\\_js\\_sup,riak\\_kv\\_sup,&lt;0.286.0&gt;]
 messages: []
 links: [&lt;0.353.0&gt;,#Port&lt;0.4849&gt;]
 dictionary: []
 trap\\_exit: false
 status: running
 heap\\_size: 610
 stack\\_size: 24
 reductions: 678
 neighbours:
2012-04-04 09:09:42 =SUPERVISOR REPORT====
 Supervisor: {local,riak\\_kv\\_js\\_sup}
 Context: child\\_terminated
 Reason: {{badmatch,{error
,enoent}},[{riak\\_kv\\_js\\_vm,load\\_mapred\\_builtins,1},{js\\_driver,new,3},{riak\\_kv\\_js\\_vm,init,1},{gen\\_server,init\\_it,6},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
 Offender: [{pid,&lt;0.404.0&gt;},{name,undefined},{mfargs,{riak\\_kv\\_
js\\_vm,start\\_link,undefined}},{restart\\_type,temporary},{
shutdown,2000},{child\\_type,worker}]


It means that all js\\_vm crash on start. I had similar problem with 1.1.1,
it is because
'mapred\\_builtins.js' is missing in '/lib/riak\\_kv-1.1.1/priv/'
folder.
Copy it there from "
https://raw.github.com/basho/riak\\_kv/master/priv/mapred\\_builtins.js".

Alternatively you can update to 1.1.2 (
https://github.com/basho/riak/zipball/riak-1.1.2).
It's solved there.


-Matthew

On Tue, Apr 24, 2012 at 11:58, Sean Cribbs  wrote:

&gt; Mohit,
&gt;
&gt; Be aware that key filters are just a thin layer on top of full-bucket key
&gt; listings. You'd be better off storing the field you want to filter in a
&gt; secondary index, which more efficiently supports range queries (note that
&gt; only the LevelDB storage engine currently supports secondary indexes).
&gt; Barring that, you could use the special "$key" index for a range query on
&gt; the key.
&gt;
&gt; On Tue, Apr 24, 2012 at 1:07 PM, Sati, Mohit  wrote:
&gt;
&gt;&gt; Hello All,
&gt;&gt;
&gt;&gt; I'm getting the below error in my queries. I'm using riak 1.1.1
&gt;&gt;
&gt;&gt; Riak Version:
&gt;&gt; ============
&gt;&gt; $rpm -qa | grep riak
&gt;&gt; riak-1.1.1-1.el6.x86\\_64
&gt;&gt;
&gt;&gt; Riak Error:
&gt;&gt; ========
&gt;&gt; HTTP/1.1 100 Continue
&gt;&gt; HTTP/1.1 500 Internal Server Error
&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt;&gt; Date: Tue, 24 Apr 2012 16:58:53 GMT
&gt;&gt; Content-Type: application/json
&gt;&gt; Content-Length: 625
&gt;&gt; {"phase":0,"error":"[preflist\\_exhausted]"
&gt;&gt;
&gt;&gt; Query:
&gt;&gt; ==========
&gt;&gt; My query is doing a range scan. I can only get data for 1 day. For 2 or
&gt;&gt; more days it is throwing the error posted above.
&gt;&gt;
&gt;&gt; {"inputs":{ "bucket":"tagg\\_dsquery",
&gt;&gt; "key\\_filters":[["and",
&gt;&gt; [["starts\\_with", "dsquery-us\\_prm"]],
&gt;&gt; [["and",
&gt;&gt; [["tokenize", "-", 5], ["greater\\_than\\_eq",
&gt;&gt; "20120312"]],
&gt;&gt; [["tokenize", "-", 5], ["less\\_than\\_eq", "20120314"]]
&gt;&gt; ]]
&gt;&gt; ]]},
&gt;&gt; ...
&gt;&gt; ...
&gt;&gt;
&gt;&gt;
&gt;&gt; app.config changes:
&gt;&gt; =============
&gt;&gt; map\\_js\\_vm\\_count - increased to 32,64,128 and 256 but not helping
&gt;&gt; js\\_max\\_vm\\_mem - increased to 32,64,128,256,512 and 1024.
&gt;&gt; js\\_thread\\_stack - increased to 64,128,256,512,1024 and 2048 (cannot go
&gt;&gt; beyond) - riak would not start
&gt;&gt;
&gt;&gt; Can anyone help me to debug this issue. My queries cannot go beyond 1 day
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt; Mohit
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt;

