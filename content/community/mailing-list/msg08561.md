---
title: "Re: Error--Cloning into 'leveldb'...ERROR: Command ['get-deps']	failed!make: *** [deps] Error 1"
description: ""
project: community
lastmod: 2012-09-16T20:43:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08561"
mailinglist_parent_id: "msg08560"
author_name: "sxin"
project_section: "mailinglistitem"
sent_date: 2012-09-16T20:43:40-07:00
---


riak-1.2.0rc6 
step1:
linux@bogon:/opt$ tar zxvf riak-1.2.0rc6.tar.gz 
step2:
make rel 
then the error happied


the makefile :
##################################
REPO ?= riak

.PHONY: rel stagedevrel deps

all: deps compile

compile:
 ./rebar compile

deps:
 ./rebar get-deps

clean: testclean
 ./rebar clean

distclean: clean devclean relclean ballclean
 ./rebar delete-deps


TEST\\_LOG\\_FILE := eunit.log
testclean:
 @rm -f $(TEST\\_LOG\\_FILE)

# Test each dependency individually in its own VM
test: deps compile testclean
 @$(foreach dep, \\
 $(wildcard deps/\\*), \\
 ./rebar eunit app=$(notdir $(dep)) \\
 || echo "Eunit: $(notdir $(dep)) FAILED" &gt;&gt;
$(TEST\\_LOG\\_FILE);)
 ./rebar eunit skip\\_deps=true
 @if test -s $(TEST\\_LOG\\_FILE) ; then \\
 cat $(TEST\\_LOG\\_FILE) && \\
 exit `wc -l &lt; $(TEST\\_LOG\\_FILE)`; \\
 fi

##
## Release targets
##
rel: deps
 ./rebar compile generate

relclean:
 rm -rf rel/riak

##
## Developer targets
##
stagedevrel: dev1 dev2 dev3 dev4
 $(foreach dev,$^,\\
 $(foreach dep,$(wildcard deps/\\*), rm -rf dev/$(dev)/lib/$(shell 
basename
$(dep))-\\* && ln -sf $(abspath $(dep)) dev/$(dev)/lib;))

devrel: dev1 dev2 dev3 dev4

dev1 dev2 dev3 dev4:
 mkdir -p dev
 (cd rel && ../rebar generate target\\_dir=../dev/$@
overlay\\_vars=vars/$@\\_vars.config)

devclean: clean
 rm -rf dev

stage : rel
 $(foreach dep,$(wildcard deps/\\*), rm -rf rel/riak/lib/$(shell basename
$(dep))-\\* && ln -sf $(abspath $(dep)) rel/riak/lib;)

##
## Doc targets
##
docs:
 ./rebar skip\\_deps=true doc
 @cp -R apps/luke/doc doc/luke
 @cp -R apps/riak\\_core/doc doc/riak\\_core
 @cp -R apps/riak\\_kv/doc doc/riak\\_kv

orgs: orgs-doc orgs-README

orgs-doc:
 @emacs -l orgbatch.el -batch --eval="(riak-export-doc-dir \\"doc\\" 
'html)"

orgs-README:
 @emacs -l orgbatch.el -batch --eval="(riak-export-doc-file 
\\"README.org\\"
'ascii)"
 @mv README.txt README

APPS = kernel stdlib sasl erts ssl tools os\\_mon runtime\\_tools crypto inets \\
 xmerl webtool snmp public\\_key mnesia eunit syntax\\_tools compiler
COMBO\\_PLT = $(HOME)/.$(REPO)\\_combo\\_dialyzer\\_plt

check\\_plt: compile
 dialyzer --check\\_plt --plt $(COMBO\\_PLT) --apps $(APPS) \\
 deps/\\*/ebin

build\\_plt: compile
 dialyzer --build\\_plt --output\\_plt $(COMBO\\_PLT) --apps $(APPS) \\
 deps/\\*/ebin

dialyzer: compile
 @echo
 @echo Use "'make check\\_plt'" to check PLT prior to using this target.
 @echo Use "'make build\\_plt'" to build PLT prior to using this target.
 @echo
 @sleep 1
 dialyzer -Wno\\_return --plt $(COMBO\\_PLT) deps/\\*/ebin | \\
 fgrep -v -f ./dialyzer.ignore-warnings

cleanplt:
 @echo
 @echo "Are you sure? It takes about 1/2 hour to re-build."
 @echo Deleting $(COMBO\\_PLT) in 5 seconds.
 @echo
 sleep 5
 rm $(COMBO\\_PLT)

##
## Version and naming variables for distribution and packaging
##

# Tag from git with style
--
# Ex: When on a tag: riak-1.0.3 (no commits since tag)
# For most normal Commits: riak-1.1.0pre1-27-g1170096
# Last tag: riak-1.1.0pre1
# Commits since tag: 27
# Hash of commit: g1170096
REPO\\_TAG := $(shell git describe --tags)

# Split off repo name
# Changes to 1.0.3 or 1.1.0pre1-27-g1170096 from example above
REVISION ?= $(shell echo $(REPO\\_TAG) | sed -e 's/^$(REPO)-//')

# Primary version identifier, strip off commmit information
# Changes to 1.0.3 or 1.1.0pre1 from example above
MAJOR\\_VERSION ?= $(shell echo $(REVISION) | sed -e 's/\\([0-9.]\\*\\)-.\\*/\\1/')


##
## Release tarball creation
## Generates a tarball that includes all the deps sources so no checkouts
are necessary
##

# Use git archive to copy a repository at a current revision to a new
directory
archive\\_git = git archive --format=tar --prefix=$(1)/ HEAD | (cd $(2) && tar
xf -)

# Checkout tag, fetch deps (so we don't have to do it multiple times) and
collect
# the version of all the dependencies into the MANIFEST\\_FILE
CLONEDIR ?= riak-clone
MANIFEST\\_FILE ?= dependency\\_manifest.git
get\\_dist\\_deps = mkdir distdir && \\
 git clone . distdir/$(CLONEDIR) && \\
 cd distdir/$(CLONEDIR) && \\
 git checkout $(REPO\\_TAG) && \\
 $(MAKE) deps && \\
 echo "- Dependencies and their tags at build time of $(REPO)
at $(REPO\\_TAG)" &gt; $(MANIFEST\\_FILE) && \\
 for dep in deps/\\*; do \\
 cd $${dep} && \\
 printf "$${dep} version `git describe --long --tags
2&gt;/dev/null || git rev-parse HEAD`\\n" &gt;&gt; ../../$(MANIFEST\\_FILE) && \\
 cd ../..; done && \\
 LC\\_ALL=POSIX && export LC\\_ALL && sort $(MANIFEST\\_FILE) &gt;
$(MANIFEST\\_FILE).tmp && mv $(MANIFEST\\_FILE).tmp $(MANIFEST\\_FILE);


# Name resulting directory & tar file based on current status of the git tag
# If it is a tagged release (REVISION == MAJOR\\_VERSION), use the toplevel
# tag as the package name, otherwise generate a unique hash of all the
# dependencies revisions to make the package name unique.
# This enables the toplevel repository package to change names
# when underlying dependencies change.
NAME\\_HASH = $(shell git hash-object distdir/$(CLONEDIR)/$(MANIFEST\\_FILE)
2&gt;/dev/null | cut -c 1-8)
ifeq ($(REVISION), $(MAJOR\\_VERSION))
DISTNAME := $(REPO\\_TAG)
else
DISTNAME = $(REPO)-$(MAJOR\\_VERSION)-$(NAME\\_HASH)
endif

# To ensure a clean build, copy the CLONEDIR at a specific tag to a new
directory
# which will be the basis of the src tar file (and packages)
# The vsn.git file is required by rebar to be able to build from the
resulting
# tar file
build\\_clean\\_dir = cd distdir/$(CLONEDIR) && \\
 $(call archive\\_git,$(DISTNAME),..) && \\
 cp $(MANIFEST\\_FILE) ../$(DISTNAME)/ && \\
 mkdir ../$(DISTNAME)/deps && \\
 for dep in deps/\\*; do \\
 cd $${dep} && \\
 $(call archive\\_git,$${dep},../../../$(DISTNAME)) && \\
 mkdir -p ../../../$(DISTNAME)/$${dep}/priv && \\
 printf "`git describe --long --tags 2&gt;/dev/null || git
rev-parse HEAD`" &gt; ../../../$(DISTNAME)/$${dep}/priv/vsn.git && \\
 cd ../..; done


distdir/$(CLONEDIR)/$(MANIFEST\\_FILE):
 $(if $(REPO\\_TAG), $(call get\\_dist\\_deps), $(error "You can't generate a
release tarball from a non-tagged revision. Run 'git checkout ', then
'make dist'"))

distdir/$(DISTNAME): distdir/$(CLONEDIR)/$(MANIFEST\\_FILE)
 $(call build\\_clean\\_dir)

dist $(DISTNAME).tar.gz: distdir/$(DISTNAME)
 cd distdir && \\
 tar czf ../$(DISTNAME).tar.gz $(DISTNAME)

ballclean:
 rm -rf $(DISTNAME).tar.gz distdir


##
## Packaging targets reside in package directory
##

# Strip off repo name for packaging
PKG\\_VERSION = $(shell echo $(DISTNAME) | sed -e 's/^$(REPO)-//')


package: dist
 $(MAKE) -C package package

pkgclean: distclean
 $(MAKE) -C package pkgclean

.PHONY: package
export PKG\\_VERSION REPO DISTNAME
#################################

--
View this message in context: 
http://riak-users.197444.n3.nabble.com/Error-Cloning-into-leveldb-ERROR-Command-get-deps-failed-make-deps-Error-1-tp4025277p4025280.html
Sent from the Riak Users mailing list archive at Nabble.com.

