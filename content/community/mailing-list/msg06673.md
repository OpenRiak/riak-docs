---
title: "Re: Curator: New Ruby ORM for Riak"
description: ""
project: community
lastmod: 2012-02-21T14:59:41-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06673"
mailinglist_parent_id: "msg06672"
author_name: "David Dawson"
project_section: "mailinglistitem"
sent_date: 2012-02-21T14:59:41-08:00
---


Paul, 

Thanks for the reply, I found this in the basho doc's..

Maybe the Basho guys can shed some light on the performance trade offs

Lookup Performance #
Secondary Indexes uses document-based partitioning, which means that the 
indexes for an object are stored on the same partition as the object itself. 
This has implications on query-time performance. When issuing a query, the 
system must read from what we call a "covering" set of partitions. The system 
looks at how many replicas of our data are stored and determines the minimum 
number of partitions that it must examine to retrieve a full set of results, 
accounting for any offline nodes.
By default, Riak is configured to store 3 replicas of all objects, so the 
system can generate a full result set if it reads from one-third of the 
system's partitions, as long as it chooses the right set of partitions. The 
query is then broadcast to the selected partitions, which read the index data, 
generate a list of keys, and send them back to the requesting node.

So am I correct in thinking as you increase the number of nodes whilst keeping 
N constant you will see a decrease in query performance? or have I got a stick 
which I am holding the wrong end of :-)

Dave


On 21 Feb 2012, at 22:09, Paul Gross wrote:

&gt; I can't speak to the performance differences, but my understanding is that 
&gt; secondary indexes perform very well.
&gt; 
&gt; Personally, I prefer one document with multiple secondary indexes instead of 
&gt; extra documents. I think it's cleaner conceptually, and it's a simpler 
&gt; implementation.
&gt; 
&gt; On 2/21/12 2:46 PM, David Dawson wrote:
&gt;&gt; 
&gt;&gt; This looks great
&gt;&gt; 
&gt;&gt; Although I am still not clear when to use index's and when not to, for 
&gt;&gt; instance if I wanted to build a high speed backend system where you could 
&gt;&gt; look up a user either by their email address or their mobile number I see 2 
&gt;&gt; ways to do this:
&gt;&gt; 
&gt;&gt; 1 .Create a user document, followed by a user\\_email\\_index / 
&gt;&gt; user\\_msisdn\\_index document which points back to the user document
&gt;&gt; 2. Create a user document and add a index called email and msisdn.
&gt;&gt; 
&gt;&gt; My concern with options 2. is the performance characteristics and other 
&gt;&gt; tradeoffs ? e.g. is it quicker to do the lookup against a key, rather than a 
&gt;&gt; secondary index? 
&gt;&gt; 
&gt;&gt; Dave
&gt;&gt; 
&gt;&gt; 
&gt;&gt; On 21 Feb 2012, at 15:29, Paul Gross wrote:
&gt;&gt; 
&gt;&gt;&gt; We at Braintree (http://www.braintreepayments.com/) open sourced our Riak 
&gt;&gt;&gt; ORM for Ruby called Curator. It follows a repository pattern rather than an 
&gt;&gt;&gt; ActiveRecord or Ripple pattern.
&gt;&gt;&gt; 
&gt;&gt;&gt; You can check out the code on github:
&gt;&gt;&gt; https://github.com/braintree/curator
&gt;&gt;&gt; 
&gt;&gt;&gt; We also released a blog post that explains our pattern:
&gt;&gt;&gt; http://www.braintreepayments.com/devblog/untangle-domain-and-persistence-logic-with-curator
&gt;&gt;&gt; 
&gt;&gt;&gt; Comments welcome.
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Paul
&gt;&gt;&gt; 
&gt;&gt; 

