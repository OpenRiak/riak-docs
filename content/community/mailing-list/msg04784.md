---
title: "Re: Precommit Hook Difficulties"
description: ""
project: community
lastmod: 2011-09-19T12:53:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04784"
mailinglist_parent_id: "msg04783"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-09-19T12:53:16-07:00
---


I had a quick play with this. Mochijson2:encode returns an erlang I/O list.
 You can convert back to a proper binary with iolist\\_to\\_binary().

precommit\\_json\\_identity(Obj) -&gt;
 Values = riak\\_object:get\\_values(Obj),
 {struct, TermList} = mochijson2:decode(hd(Values)),
 riak\\_object:apply\\_updates(
 riak\\_object:update\\_value(Obj,
 iolist\\_to\\_binary(mochijson2:encode({struct,
TermList})))).

Cheers, Jon

On Mon, Sep 19, 2011 at 1:50 PM, David Smith  wrote:

&gt; On Sat, Sep 17, 2011 at 5:11 PM, Greg Pascale  wrote:
&gt; &gt; Hi,
&gt; &gt; I'm trying to write a simple precommit hook to modify a JSON object by
&gt; &gt; removing certain fields. The simplest way to do this, I figure, is to
&gt; decode
&gt; &gt; the object's value with mochijson2, remove the fields I don't want,
&gt; &gt; re-encode it, and update the value.
&gt; &gt; What happens, though, is my object ends up somehow mangled. When I
&gt; inspect
&gt; &gt; it via curl, it sort of looks like JSON, but characters like "{" and ":"
&gt; &gt; seem to be replaced with garbage.
&gt; &gt; For example, what should read "hostname":"www.google.com" looks
&gt; &gt; like hostnamea"ja:la"mwww.google.coma"j
&gt;
&gt; If I had to guess, I would say that you are seeing some sort of weird
&gt; unicode encoding of the double-quote character; maybe the data stored
&gt; was UTF-16 encoded? I.e. is there some unicode character that would
&gt; display a " but actually be stored as [a, "]?
&gt;
&gt; D.
&gt;
&gt; --
&gt; Dave Smith
&gt; Director, Engineering
&gt; Basho Technologies, Inc.
&gt; diz...@basho.com
&gt;

