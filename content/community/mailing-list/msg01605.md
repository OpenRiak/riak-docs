---
title: "Re: riak / riaksearch fails and returns with \"badarg,	universaltime_to_localtime\" on any mapreduce function"
description: ""
project: community
lastmod: 2010-11-23T02:42:54-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01605"
mailinglist_parent_id: "msg01600"
author_name: "A. Sebastian Dietzel"
project_section: "mailinglistitem"
sent_date: 2010-11-23T02:42:54-08:00
---

Hi Dan,

the error I've been trying to fix for the past week wasn't riak's fault 
it's a bug in Erlang R13B04.
Sean helped me yesterday via IRC to get riak-search working on R14B 
which fixed it for me.


You can read more about that erlang bug on the erlang-bugs mailing list:
http://www.erlang.org/pipermail/erlang-bugs/2008-November/001077.html

Thanks guys.


Dan Reverri wrote:
It looks like Riak is hitting this error when trying to jsonify the 
metadata, specifically the "X-Riak-Last-Modified" header. The 
timestamp in the header works out to be "Sun, 21 Nov 2010 07:28:05 
GMT". Your system seems to be translating it to a date before 1970.


Can you run the following Erlang code while attached to a running Riak 
node?

calendar:now\\_to\\_local\\_time({1290,324485,31243}).


It should output something like:

{{2010,11,20},{23,28,5}}


Thanks,
Dan


Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com 


On Sun, Nov 21, 2010 at 2:10 AM, A. Sebastian Dietzel 
&gt; wrote:


 Hi,

 I've trouble getting the mapreduce functions to work in riak and
 riaksearch.
 It fails with some sort of timestamp error, unfortunately I'm not
 good enough in
 Erlang to fix it, but I've attached the error logs and
 riaksearch-admin status output - hope that helps.

 So far, I've tried it on my local dev machine (osx -
 riak/riaksearch source installation, tarball and github master
 branch),
 on centos 5.3 (github master) and on ubuntu,
 the .deb packaged version on ubuntu works and doesn't fail in my
 test cases.

 The attached test is written in python based on the test cases in
 the library
 and utilizes the http client from the python library for riak.
 But that shouldn't matter, it also fails via the pbc-python client
 (I've attached logs for that as well),
 as well as in ruby (using the official client) and via curl too.
 I didn't attach any logs for ruby or curl, as they're similar to
 the http based python client.

 Since no one else is having these issues, I presume I'm doing
 something wrong
 but I don't know what exactly.

 I'm running riak/riaksearch from the console like this:
 ulimit -n 1024
 $PATH\\_TO\\_RIAKS\\_SRC/rel/bin/riaksearch start

 or for regular riak:
 $PATH\\_TO\\_RIAK\\_SRC/rel/bin/riak start

 This works and starts riak / riaksearch, but as soon as I start
 doing anything mapreduce with the servers they fail with:

 ...
 
{badarg,[{erlang,universaltime\\_to\\_localtime,[{{1969,12,31},{23,59,59}}]},{calendar,local\\_time\\_to\\_universal\\_time\\_dst,1}
 ...

 I'm using Erlang R13B04.

 Please let me know if I can provide anything else to help solving
 this issue.

 Thank you in advance,
 Sebastian
 -- 
 A. Sebastian Dietzel (el mariachi)

 sebast...@dubizzle.com 

--
A. Sebastian Dietzel (el mariachi)
sebast...@dubizzle.com

