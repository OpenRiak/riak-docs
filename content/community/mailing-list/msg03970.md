---
title: "Re: riak-0.14.2 memory crash"
description: ""
project: community
lastmod: 2011-07-08T17:03:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03970"
mailinglist_parent_id: "msg03969"
author_name: "Sylvain Niles"
project_section: "mailinglistitem"
sent_date: 2011-07-08T17:03:46-07:00
---


Thanks Dan, very useful tool. Here's the big offender:

Pid Name/Spawned as State Reductions Stack+heap MsgQ 
Length
&lt;0.163.0&gt; riak\\_kv\\_map\\_master Garbing (limited info) 23815122240 
182452560 3


So it looks like there was a huge amount of data in the process queue
for the riak\\_kv\\_map\\_master. The pid info for that process shows there
were only 3 messages in its queue. Any tricks for figuring out what
those messages looked like?

-Sylvain


On Fri, Jul 8, 2011 at 4:42 PM, Daniel Reverri  wrote:
&gt; Can you check if an erl\\_crash.dump file was created? The crash dump should 
&gt; give some indication of which processes were taking up memory.
&gt;
&gt; The crashdump\\_viewer built into Erlang is very useful for reviewing crash 
&gt; dumps.
&gt;
&gt; Thanks
&gt; Dan
&gt;
&gt; Sent from my iPhone
&gt;
&gt; On Jul 8, 2011, at 4:18 PM, Sylvain Niles  wrote:
&gt;
&gt;&gt; Our system had been humming along fine for a week and crashed today
&gt;&gt; with almost no load. This is the only thing in the erlang.log:
&gt;&gt;
&gt;&gt;
&gt;&gt; =INFO REPORT==== 8-Jul-2011::16:46:14 ===
&gt;&gt; [{alarm\\_handler,{clear,system\\_memory\\_high\\_watermark}}]
&gt;&gt; =INFO REPORT==== 8-Jul-2011::16:50:14 ===
&gt;&gt; [{alarm\\_handler,{set,{system\\_memory\\_high\\_watermark,[]}}}]
&gt;&gt; =INFO REPORT==== 8-Jul-2011::16:51:14 ===
&gt;&gt; [{alarm\\_handler,{clear,system\\_memory\\_high\\_watermark}}]/usr/local/src/riak-0.14.2/rel/riak/lib/os\\_mon-2.2.5/priv/bin/memsup:
&gt;&gt; Erlang has closed.
&gt;&gt; Erlang has closed
&gt;&gt;
&gt;&gt; Crash dump was written to: erl\\_crash.dump
&gt;&gt; eheap\\_alloc: Cannot allocate 1824525600 bytes of memory (of type "heap").
&gt;&gt;
&gt;&gt;
&gt;&gt; Looking in the sasl-error log I see that an erlang function I wrote
&gt;&gt; was crashing in some cases:
&gt;&gt;
&gt;&gt; \\*\\* Reason for termination = \\*\\* {error,       {phase\\_error,
&gt;&gt; {error,               {error,undef,
&gt;&gt; [{get\\_erl,past\\_events,                        [{r\\_object,&lt;&lt;"events"&gt;&gt;,
&gt;&gt;                            &lt;&lt;"LRs2PibmMZknPm44IMzoZflCHUP"&gt;&gt;,
&gt;&gt;                             [{r\\_content,
&gt;&gt; ...ETC
&gt;&gt;
&gt;&gt;
&gt;&gt; So I definitely need to fix my code, but I'm wondering if this is
&gt;&gt; expected behavior that this would cause a memory leak that eventually
&gt;&gt; brings down riak? I thought if the process running my module crashed
&gt;&gt; everything would just be garbage collected and that'd be the end of
&gt;&gt; it. Any advice on the right way to approach this would be great,
&gt;&gt; thanks!
&gt;&gt;
&gt;&gt; -Sylvain
&gt;

