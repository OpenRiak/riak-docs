---
title: "Re: Strange Exception in java-client"
description: ""
project: community
lastmod: 2013-01-30T13:43:27-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09926"
mailinglist_parent_id: "msg09925"
author_name: "Brian Roach"
project_section: "mailinglistitem"
sent_date: 2013-01-30T13:43:27-08:00
---


Ingo -

Riak is returning an object with no contents (which ends up being an
empty String passed to Jackson).

Unless you've somehow mangled the data yourself (which sounds unlikely
given the bit about the 404 from the command line; more on that in a
bit) what's happening is that you're encountering a tombstone; an
object that has been deleted via a delete operation but hasn't been
removed yet. This causes an "empty" object to be returned (the
tombstone) and causes Jackson to puke (HTTP will actually return this
as a 404 but if you look there's still a X-Riak-Vclock: header with a
vclock).

Probably the best description of how this works in Riak is a post by
Jon Meredith which can be found here:
http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-October/006048.html

Unfortunately this is something the Java client doesn't know what to
do with when using the default JSONConverter and your own POJOs. And
it's not as simple as "just return null" because of a case where a
tombstone could actually be a sibling and the client then needs to
resolve the conflict which is the next step in the process. It's
something I'm going to have to think about.

As you've discovered, when the tombstone isn't a sibling simply
retrying will often work because by then the delete has fully
completed and the tombstones have been removed from the Riak nodes.

Is there a reason you're rapidly doing a delete then a store (which
triggers that fetch)?

Thanks,
Brian Roach

On Wed, Jan 30, 2013 at 9:06 AM, Ingo Rockel
 wrote:
&gt; Hi Dmitri,
&gt;
&gt; it doesn't happen in my code and it does happen while the riak-client tries
&gt; to deserialize a fetched object from riak in a "fetch-before-store" (see the
&gt; stack), I also get this error randomly while trying just to fetch an object
&gt; from the database.
&gt;
&gt; And if I try to fetch the object from the cmdline I just get a 404. So I
&gt; would expect the java-client just returns a null-result for this fetch and
&gt; not to throw an exception.
&gt;
&gt; All my objects are stored using the riak-java-client and the
&gt; json-serializer.
&gt;
&gt; Ahh, just tested: if I retry it sometimes works, although most of the time
&gt; still fails (haven't tried with a sleep so far).
&gt;
&gt; Ingo
&gt;
&gt; Am 30.01.2013 16:57, schrieb Dmitri Zagidulin:
&gt;&gt;
&gt;&gt; Hi Ingo.
&gt;&gt;
&gt;&gt; It's difficult to diagnose the exact reason without looking at your code.
&gt;&gt; But that error is a JSON parser error. It gets thrown whenever the code
&gt;&gt; tries to parse an empty string as a json object.
&gt;&gt; The general-case solution is to validate your strings or input streams
&gt;&gt; that you're turning into JSON objects, or to catch an exception when
&gt;&gt; creating that object and deal with it accordingly.
&gt;&gt;
&gt;&gt; But again, it's hard to say why it's happening exactly, in your case --
&gt;&gt; try to determine where in your code that's happening and think of ways
&gt;&gt; some input or result is empty, and check for that.
&gt;&gt;
&gt;&gt; Dmitri
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Jan 30, 2013 at 10:44 AM, Ingo Rockel
&gt;&gt; &gt;
&gt;&gt;
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I wrote a java tool to convert part of our data from a
&gt;&gt; mysql-database into riak. As this tool is running while our system
&gt;&gt; is still up, it needs to replay all modifications done in the mysql
&gt;&gt; database, during these modifications I sometimes get this exception
&gt;&gt; from the riak client:
&gt;&gt;
&gt;&gt; com.basho.riak.client.convert.\\_\\_ConversionException:
&gt;&gt;
&gt;&gt; java.io.EOFException: No content to map to Object due to end of input
&gt;&gt; com.basho.riak.client.convert.\\_\\_ConversionException:
&gt;&gt;
&gt;&gt; java.io.EOFException: No content to map to Object due to end of input
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.basho.riak.client.convert.\\_\\_JSONConverter.toDomain(\\_\\_JSONConverter.java:167)
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.basho.riak.client.\\_\\_operations.FetchObject.\\_\\_execute(FetchObject.java:110)
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.basho.riak.client.\\_\\_operations.StoreObject.\\_\\_execute(StoreObject.java:112)
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.bluelionmobile.qeep.\\_\\_messaging.db.impl.\\_\\_MessageKVImpl.\\_\\_storeUniqueMessageDto(\\_\\_MessageKVImpl.java:264)
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.bluelionmobile.qeep.\\_\\_messaging.db.impl.\\_\\_MessageKVImpl.\\_\\_createDataFromDTO(\\_\\_MessageKVImpl.java:138)
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.bluelionmobile.qeep.\\_\\_messaging.db.impl.\\_\\_MessageKVImpl.\\_\\_updateDataFromDTO(\\_\\_MessageKVImpl.java:205)
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.bluelionmobile.qeep.\\_\\_messaging.db.utils.Replay$\\_\\_ReplayRunner.run(Replay.java:\\_\\_243)
&gt;&gt; at java.lang.Thread.run(Thread.\\_\\_java:722)
&gt;&gt;
&gt;&gt; Caused by: java.io.EOFException: No content to map to Object due to
&gt;&gt; end of input
&gt;&gt; at
&gt;&gt;
&gt;&gt; org.codehaus.jackson.map.\\_\\_ObjectMapper.\\_initForReading(\\_\\_ObjectMapper.java:2775)
&gt;&gt; at
&gt;&gt;
&gt;&gt; org.codehaus.jackson.map.\\_\\_ObjectMapper.\\_readMapAndClose(\\_\\_ObjectMapper.java:2718)
&gt;&gt; at
&gt;&gt;
&gt;&gt; org.codehaus.jackson.map.\\_\\_ObjectMapper.readValue(\\_\\_ObjectMapper.java:1863)
&gt;&gt; at
&gt;&gt;
&gt;&gt; com.basho.riak.client.convert.\\_\\_JSONConverter.toDomain(\\_\\_JSONConverter.java:156)
&gt;&gt;
&gt;&gt; ... 7 more
&gt;&gt;
&gt;&gt; it only happens once every few thousand updates and if I check the
&gt;&gt; object from the cmdline I only get a 404.
&gt;&gt;
&gt;&gt; Any ideas what might cause this and how to fix/workaround it?
&gt;&gt;
&gt;&gt; Ingo
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com 
&gt;&gt; http://lists.basho.com/\\_\\_mailman/listinfo/riak-users\\_\\_\\_lists.basho.com
&gt;&gt; 
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Software Architect
&gt;
&gt; Blue Lion mobile GmbH
&gt; Tel. +49 (0) 221 788 797 14
&gt; Fax. +49 (0) 221 788 797 19
&gt; Mob. +49 (0) 176 24 87 30 89
&gt;
&gt; ingo.roc...@bluelionmobile.com
&gt;&gt;&gt;&gt; qeep: Hefferwolf
&gt;
&gt; www.bluelionmobile.com
&gt; www.qeep.net
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

