---
title: "Re: Riak search performance FUD"
description: ""
project: community
lastmod: 2011-12-01T04:02:35-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05832"
mailinglist_parent_id: "msg05798"
author_name: "Jeroen van Dijk"
project_section: "mailinglistitem"
sent_date: 2011-12-01T04:02:35-08:00
---


FYI I got this reaction from Elias (this is a forward it to the list so it
will be archived correctly. Thank you Elias btw)

On Wed, Nov 30, 2011 at 5:45 PM, Elias Levy wrote:

&gt; On Wed, Nov 30, 2011 at 6:01 AM, wrote:
&gt;
&gt;&gt; From: Jeroen van Dijk 
&gt;&gt;
&gt;&gt; The use case I'm talking about is when you are looking for a term that is
&gt;&gt; very common and thus will yield many results. My understanding of the
&gt;&gt; implementation of Riak [citation needed] is that the search is divided
&gt;&gt; into
&gt;&gt; a few phases. The first one is collecting results for each term. After
&gt;&gt; that
&gt;&gt; comes merging, sorting and limiting the result set. So for this particular
&gt;&gt; case collecting all results would be infeasible and would kill
&gt;&gt; performance.
&gt;&gt; Even when a limit is set because limiting comes in a phase after
&gt;&gt; collecting
&gt;&gt; and the merging of results.
&gt;&gt;
&gt;
&gt; That's correct. We have similar issues. We've resorted to creating the
&gt; equivalent of multicolumn indexes by joining certain fields together and
&gt; indexing those. That is only possible because most of the data we want to
&gt; index is structured or semi-structured. You'd have to determine whether
&gt; such an approach is feasible for your purposes.
&gt;
&gt; We also found 2i to be faster than Search, at the expense of requiring our
&gt; app to perform tokenization for some of the fields we want to index, but
&gt; we've stuck with Search as we need composable queries, which 2i does not
&gt; yet provide.
&gt;
&gt; I've read here [1] that one can use search\\_fold to interrupt the collecting
&gt;&gt; phase when enough results are fetched. I would like to know if this a
&gt;&gt; best/official practice and if it really solves the issue?
&gt;&gt;
&gt;
&gt; Search\\_fold will only be useful if you plan on developing in Erlang and,
&gt; if my understanding is correct, if you don't care about the order of the
&gt; results (i.e. no scoring or field sorting). Actually, the results may be
&gt; partially ordered, as the merge\\_index backend may store the postings sorted
&gt; by the inverse of time.
&gt;
