---
title: "Re: 'not found' after join"
description: ""
project: community
lastmod: 2011-05-02T20:36:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03196"
mailinglist_parent_id: "msg03195"
author_name: "Greg Nelson"
project_section: "mailinglistitem"
sent_date: 2011-05-02T20:36:34-07:00
---


Ok, thank you Ryan. I'm glad that what I'm seeing is expected behavior, 
although it is a little surprising.

As Kyle asked in a parallel reply on this thread: is it possible for the client 
to distinguish between these different scenarios where a notfound can be 
returned? My initial thought is that when a node is being added, clients can do 
reads with r=1 and retry GETs that 404...?
On Monday, May 2, 2011 at 8:14 PM, Ryan Zezeski wrote: 
&gt; Greg,
&gt; 
&gt; Your expectations are fair, just because you added a node doesn't mean Riak 
&gt; should return notfounds. Unfortunately, we aren't quite there yet. This is a 
&gt; side effect of how Riak currently implements handoff in that it immediately 
&gt; updates/gossips the ring causing many partitions to handoff immediately. If a 
&gt; request comes in that relies on these partitions then it will get a notfound 
&gt; and perform read repair. You're situation is multiplied by the fact that you 
&gt; are going from 3 nodes to 4. More vnode shuffling occurs because of the small 
&gt; cluster size. 
&gt; 
&gt; We're well aware of this and have it on our radar for improvement in a future 
&gt; release.
&gt; 
&gt; All this said, you data will be eventually consistent. That is, all your data 
&gt; will eventually be handed off and things will work as normal. It's only 
&gt; during the handoff that you \\_may\\_ encounter notfounds. In this case it would 
&gt; be best to add a new node to your cluster at lowest load times and if you can 
&gt; spare additional hardware a few more nodes to start with is an even easier 
&gt; option. 
&gt; 
&gt; -Ryan
&gt; 
&gt; On Mon, May 2, 2011 at 9:48 PM, Greg Nelson  wrote:
&gt; &gt; Hello riak users! 
&gt; &gt; 
&gt; &gt; I have a 4 node cluster that started out as 3 nodes. ring\\_creation\\_size = 
&gt; &gt; 2048, target\\_n\\_val is default (4), and all buckets have n\\_val = 3. 
&gt; &gt; 
&gt; &gt; When I joined the 4th node, for a few minutes some GETs were returning 'not 
&gt; &gt; found' for data that was already in riak. Eventually the data was returned, 
&gt; &gt; due to read repair I would assume. Is this expected? It seems that 'not 
&gt; &gt; found' and read repairs should only happen when something goes wrong, like 
&gt; &gt; a node goes down. Not when adding a node to the cluster, which is supposed 
&gt; &gt; to be part of normal operation! 
&gt; &gt; 
&gt; &gt; Any help or insight is appreciated!
&gt; &gt; 
&gt; &gt; Greg 
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; 
&gt; 
&gt; 
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

