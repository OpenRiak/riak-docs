---
title: "Adding a new machine to a three node cluster cause partition handoff	problems"
description: ""
project: community
lastmod: 2012-01-10T08:13:19-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06206"
author_name: "Ivaylo Panitchkov"
project_section: "mailinglistitem"
sent_date: 2012-01-10T08:13:19-08:00
---


Hello All,

We have a cluster of three machines (Debian 6.0, 4GB RAM, 
riak\\_1.0.2-1\\_amd64.deb, n\\_val: 3) that serves an application for a 
while. As we go to production soon added a fourth machine to the cluster 
(exactly the same as the first three) yesterday. The partition handoff 
began in the late afternoon and I had an impression that the transition 
will not take too long as there are only few hundred IMPORTANT records 
in the storage for the moment. Today in the morning checked the 
situation again and realized the partition handoff still runs (or get 
stuck). The Ownership Handoff is still the same since yesterday (at 
least 19 hours till now). Any suggestions to fix the problem are welcome :-)


REMARK: Replaced the IP addresses for security sake


# riak-admin ringready
Attempting to restart script through sudo -u riak
TRUE All nodes agree on the ring 
['r...@yyy.yyy.yyy.yyy','r...@xxx.xxx.xxx.xxx','r...@aaa.aaa.aaa.aaa','r...@bbb.bbb.bbb.bbb']

# riak-admin transfers
Attempting to restart script through sudo -u riak
'r...@bbb.bbb.bbb.bbb' waiting to handoff 2 partitions
'r...@aaa.aaa.aaa.aaa' waiting to handoff 2 partitions
'r...@yyy.yyy.yyy.yyy' waiting to handoff 2 partitions


# riak-admin ring\\_status
Attempting to restart script through sudo -u riak
================================== Claimant 
===================================

Claimant: 'r...@xxx.xxx.xxx.xxx'
Status: up
Ring Ready: true

============================== Ownership Handoff 
==============================

Owner: r...@xxx.xxx.xxx.xxx
Next Owner: r...@yyy.yyy.yyy.yyy

Index: 548063113999088594326381812268606132370974703616
Waiting on: [riak\\_kv\\_vnode]
Complete: [riak\\_pipe\\_vnode]

Index: 1370157784997721485815954530671515330927436759040
Waiting on: [riak\\_kv\\_vnode]
Complete: [riak\\_pipe\\_vnode]

-------------------------------------------------------------------------------

============================== Unreachable Nodes 
==============================

All nodes are up and reachable


# riak-admin member\\_status
Attempting to restart script through sudo -u riak
================================= Membership 
==================================

Status Ring Pending Node
-------------------------------------------------------------------------------
valid 21.9% 25.0% 'r...@yyy.yyy.yyy.yyy'
valid 28.1% 25.0% 'r...@xxx.xxx.xxx.xxx'
valid 25.0% 25.0% 'r...@aaa.aaa.aaa.aaa'
valid 25.0% 25.0% 'r...@bbb.bbb.bbb.bbb'
-------------------------------------------------------------------------------
Valid:4 / Leaving:0 / Exiting:0 / Joining:0 / Down:0


--
Ivaylo Panitchkov
Software developer
Hibernum Creations Inc.

Ce courriel est confidentiel et peut aussi être protégé par la loi.Si vous avez 
reçu ce courriel par erreur, veuillez nous en aviser immédiatement en y 
répondant, puis supprimer ce message de votre système. Veuillez ne pas le 
copier, l’utiliser pour quelque raison que ce soit ni divulguer son contenu à 
quiconque.
This email is confidential and may also be legally privileged. If you have 
received this email in error, please notify us immediately by reply email and 
then delete this message from your system. Please do not copy it or use it for 
any purpose or disclose its content.
