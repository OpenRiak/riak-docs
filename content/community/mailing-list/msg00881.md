---
title: "Re: to escape or not to escape?"
description: ""
project: community
lastmod: 2010-08-13T06:17:19-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00881"
mailinglist_parent_id: "msg00875"
author_name: "francisco treacy"
project_section: "mailinglistitem"
sent_date: 2010-08-13T06:17:19-07:00
---


2010/8/12 Bryan Fink :
&gt; Hi, Francisco.  I've run into this myself in developing a recent
&gt; application.  I've been loathe to change the Riak behavior, for
&gt; worries of breaking existing client expectations.  The original
&gt; escaping was put in to deal with objects that had been created by the
&gt; native Erlang client, and therefore might have non-url-safe keys.  I'm
&gt; fairly certain I now agree that Riak should never mess with escaping,
&gt; though (and that non-url-safe keys should be treated as errors for the
&gt; HTTP interface).

Yes, we agree Riak should never mess with escaping \\*and\\* non-url-safe
keys should be treated as errors for the HTTP interface (or for all,
what if you save a document via Erlang or the protobuf interface and
then you want to retrieve it with HTTP GET?).

I think not only it's important to fix
https://issues.basho.com/show\\_bug.cgi?id=617 , but also to clearly
state how client lib implementors should deal with this (basically,
that they should take care of all escaping in a uniform manner).

&gt; In the meantime, a good workaround is to base64-encode keys used over
&gt; HTTP.  As long as you use alternate characters for + and / (like - and
&gt; \\_, called "base64url" on http://en.wikipedia.org/wiki/Base64), you end
&gt; up with urlencode(base64encode(Key)) == urldecode(base64encode(Key))
&gt; == base64encode(Key).

If I understand correctly this would involve changing my keys and atm
it's not really feasible in our app. As a workaround until this is
fixed, I patched Ripple so that it doesn't escape:
http://github.com/frank06/ripple/commit/baa326f0f6041f9ab2401e0606cd35533e878cf0
(works ok so far).

Thanks,
Francisco

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

