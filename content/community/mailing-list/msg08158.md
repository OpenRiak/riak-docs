---
title: "Re: several 2i in the query"
description: ""
project: community
lastmod: 2012-08-02T07:12:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08158"
mailinglist_parent_id: "msg08140"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-08-02T07:12:48-07:00
---


Hi Boris,

My comments are inline.

On Wed, Aug 1, 2012 at 9:01 AM, Ilyushonak Barys  wrote:

&gt; Hi, riak users
&gt;
&gt; I have object with two different secondary indexes - status and type. For
&gt; example, I would like to query all keys with status=new AND type=gloves.
&gt; As wiki says "In version 1.0 of Riak, index queries are only supported on
&gt; one index field at a time." (
&gt; http://wiki.basho.com/Secondary-Indexes---Configuration-and-Examples.html)
&gt; I would like to know: if anything changed in this field since 1.0?


Nothing has changed in regards to querying multiple indexes. I.e. only one
index can be queried.


&gt;


&gt; I have found the following solutions for this task:
&gt; 1. Create separate index value for specified pair status and type, for
&gt; example {&lt;&lt;"index"&gt;&gt;, [{&lt;&lt;"status\\_and\\_type\\_bin "&gt;&gt;, term\\_to\\_binary({new,
&gt; gloves})}]}
&gt;

Do you really want to use term\\_to\\_binary here? Perhaps you could get away
with a binary with a known separator like &lt;&lt;"new\\_gloves"&gt;&gt; or
&lt;&lt;"new|gloves"&gt;&gt; etc. It should save a few bytes per object over external
term format.

2. Use the query result by only one index as map-reduce input pipe and
&gt; filter values in MR.
&gt;

If you go this route make sure to query on the more limiting index so MR
can process the least amount of objects. Each object needed by MR is
random access.


&gt; 3. Maybe I think too relational and should use other object structure?


Perhaps, that all depends on your problem. The data model, how often data
is updated, the types of queries you need to perform, how much data you
have, what kind of latency requirements you have, etc. Feel free to
elaborate more.

-Z
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

