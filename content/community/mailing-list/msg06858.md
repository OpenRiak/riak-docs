---
title: "Re: True HA for RiakClient"
description: ""
project: community
lastmod: 2012-03-03T11:57:51-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06858"
mailinglist_parent_id: "msg06857"
author_name: "Dietrich Featherston"
project_section: "mailinglistitem"
sent_date: 2012-03-03T11:57:51-08:00
---


The haproxy approach tends to work well so long as haproxy it is located on
the machine from which the riak client is establishing connections to the
riak cluster. This way the client always talks over localhost and haproxy
is unlikely to be a failure point. So in your service tier, each machine
running a particular service requiring access to riak would also require a
running haproxy. I believe haproxy does a reasonable job of evicting downed
riak nodes but it must be configured to know the cluster membership ahead
of time (by way of chef for example).

We know that writes can be sent to any node in a riak cluster. That node
must, however, act as a coordinator for the write and make sure the data
arrives at the physical nodes with the partitions into which that key
falls. Some have posited the existence of a "fat client" which participates
as a member of the cluster in some capacity. This way the client can make
an informed decision about where to send a write thus reducing the
coordination overhead of the write arriving at a random node. This could be
important for applications with write volume sufficiently high that the
level of cross talk generated by random-writes (or reads for that matter)
becomes a problem. Unclear how widely available general solutions to this
problem have become, but I'd be curious to see how others have approached
it.

Thanks,
D


On Sat, Mar 3, 2012 at 10:23 AM, Michael Clemmons
wrote:

&gt; Phil,
&gt; Its a pretty well known issue. If you don't mind an older version of the
&gt; riak client there is a folk on github that does support this
&gt; https://github.com/bretthoerner/riak-python-client/branches.
&gt; Your other option is to manage it in your app or subclass the transport
&gt; object.
&gt; Some people use haproxy. I'm not a fan of this approach in production,
&gt; since the load balancer is now the point of failure.
&gt;
&gt;
&gt; On Sat, Mar 3, 2012 at 10:08 AM, Philip  wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I've just created my first 3 node riak cluster and must admit that I'm
&gt;&gt; stunned! However, it seems like the RiakClient is missing a really
&gt;&gt; important functionality for HA software. AFAIK you can only specify a
&gt;&gt; single server. I want to host a large riak cluster and a frontend
&gt;&gt; cluster separately. Using a single server for connecting would be a
&gt;&gt; huge single point of failure.
&gt;&gt;
&gt;&gt; Am I missing something?
&gt;&gt;
&gt;&gt; It would be nice if it would be possible to specify multiple servers
&gt;&gt; and the clients automatically chooses a random server that's available
&gt;&gt; from this list.
&gt;&gt;
&gt;&gt; Best Regards
&gt;&gt; Philip

&gt;
&gt;
&gt;
&gt; --
&gt; -Michael
&gt;
&gt;

