---
title: "Re: eleveldb make test failure"
description: ""
project: community
lastmod: 2011-11-01T06:30:57-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05407"
mailinglist_parent_id: "msg05400"
author_name: "Jared Morrow"
project_section: "mailinglistitem"
sent_date: 2011-11-01T06:30:57-07:00
---


When we pulled in LevelDB in the effort to use it as a backend for Riak,
changes needed to be made to make sure it worked across platforms. In
fact, many of these changes were eventually accepted by the LevelDB team at
Google. Snappy was one of the features which we didn't get a chance to
fully check out if it worked properly on some of our platforms, most
notably Solaris. This is not to say it won't eventually be used, but in
an effort to provide LevelDB as a backend while still providing a stable
product, some things were cut from it.

Thanks,
Jared


On Mon, Oct 31, 2011 at 8:07 PM, Phil Sorber  wrote:

&gt; Jared,
&gt;
&gt; Can I ask why you guys don't use Snappy? Have you had problems with it?
&gt; Did it not perform well in tests?
&gt;
&gt; Thanks.
&gt;
&gt; On Fri, Oct 28, 2011 at 10:47 PM, Jared Morrow  wrote:
&gt;
&gt;&gt; Phil,
&gt;&gt;
&gt;&gt; I tried reproducing the issue on OSX, Ubuntu 11, and Fedora 13 with no
&gt;&gt; luck. The curiosity I have is the following
&gt;&gt;
&gt;&gt;&gt; undefined symbol: \\_ZN6snappy13RawUncompressEPKcmPc'"}}
&gt;&gt;&gt; \\*\\*\\* test module not found \\*\\*\\*
&gt;&gt;&gt;
&gt;&gt; You have -DSNAPPY being passed into the compiler, and it appears that is
&gt;&gt; where the 'undefined symbol' error is coming from. We don't compile with
&gt;&gt; snappy installed, so I'm not too familiar with its versions. So if I was
&gt;&gt; you, I'd either double check if your snappy install is up to date, or
&gt;&gt; simply disable its use. To do that, it seems like if you make a simple
&gt;&gt; change to: c\\_src/leveldb/Makefile
&gt;&gt;
&gt;&gt; Simply comment out the following section
&gt;&gt;
&gt;&gt; # If Snappy is installed, add compilation and linker flags
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; # (see http://code.google.com/p/snappy/)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; ifeq ($(SNAPPY), 1)
&gt;&gt;&gt;
&gt;&gt;&gt; SNAPPY\\_CFLAGS=-DSNAPPY
&gt;&gt;&gt;
&gt;&gt;&gt; SNAPPY\\_LDFLAGS=-lsnappy
&gt;&gt;&gt;
&gt;&gt;&gt; else
&gt;&gt;&gt;
&gt;&gt;&gt; SNAPPY\\_CFLAGS=
&gt;&gt;&gt;
&gt;&gt;&gt; SNAPPY\\_LDFLAGS=
&gt;&gt;&gt;
&gt;&gt;&gt; endif
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Then try a 'make clean' and 'make test' again.
&gt;&gt;
&gt;&gt; If you are still having issues after that, please let me know.
&gt;&gt;
&gt;&gt; -Jared
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Fri, Oct 28, 2011 at 1:09 PM, Phil Sorber  wrote:
&gt;&gt;
&gt;&gt;&gt; I am trying to do some benchmarking with eleveldb but even getting the
&gt;&gt;&gt; basic 'make test' going is failing. Am I doing something obviously
&gt;&gt;&gt; wrong here?
&gt;&gt;&gt;
&gt;&gt;&gt; Also, I tried to put the eleveldb driver into basho bench, but not
&gt;&gt;&gt; sure if that is the intent there.
&gt;&gt;&gt;
&gt;&gt;&gt; $ make test
&gt;&gt;&gt; ./rebar compile
&gt;&gt;&gt; ==&gt; eleveldb (compile)
&gt;&gt;&gt; make[1]: Entering directory `/home/phil/git/basho/eleveldb/c\\_src/leveldb'
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/builder.cc -o db/builder.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/c.cc -o db/c.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/db\\_impl.cc -o db/db\\_impl.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/db\\_iter.cc -o db/db\\_iter.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/filename.cc -o db/filename.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/dbformat.cc -o db/dbformat.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/log\\_reader.cc -o db/log\\_reader.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/log\\_writer.cc -o db/log\\_writer.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/memtable.cc -o db/memtable.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/repair.cc -o db/repair.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/table\\_cache.cc -o db/table\\_cache.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/version\\_edit.cc -o db/version\\_edit.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/version\\_set.cc -o db/version\\_set.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY db/write\\_batch.cc -o db/write\\_batch.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY port/port\\_posix.cc -o port/port\\_posix.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/block.cc -o table/block.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/block\\_builder.cc -o table/block\\_builder.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/format.cc -o table/format.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/iterator.cc -o table/iterator.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/merger.cc -o table/merger.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/table.cc -o table/table.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/table\\_builder.cc -o table/table\\_builder.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY table/two\\_level\\_iterator.cc -o table/two\\_level\\_iterator.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/arena.cc -o util/arena.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/cache.cc -o util/cache.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/coding.cc -o util/coding.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/comparator.cc -o util/comparator.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/crc32c.cc -o util/crc32c.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/env.cc -o util/env.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/env\\_posix.cc -o util/env\\_posix.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/hash.cc -o util/hash.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/histogram.cc -o util/histogram.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/logging.cc -o util/logging.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/options.cc -o util/options.o
&gt;&gt;&gt; g++ -fPIC -c -I. -I./include -fno-builtin-memcmp
&gt;&gt;&gt; -DLEVELDB\\_PLATFORM\\_POSIX -pthread -DOS\\_LINUX -O2 -DNDEBUG
&gt;&gt;&gt; -DSNAPPY util/status.cc -o util/status.o
&gt;&gt;&gt; rm -f libleveldb.a
&gt;&gt;&gt; ar -rs libleveldb.a ./db/builder.o ./db/c.o ./db/db\\_impl.o
&gt;&gt;&gt; ./db/db\\_iter.o ./db/filename.o ./db/dbformat.o ./db/log\\_reader.o
&gt;&gt;&gt; ./db/log\\_writer.o ./db/memtable.o ./db/repair.o ./db/table\\_cache.o
&gt;&gt;&gt; ./db/version\\_edit.o ./db/version\\_set.o ./db/write\\_batch.o
&gt;&gt;&gt; ./port/port\\_posix.o ./table/block.o ./table/block\\_builder.o
&gt;&gt;&gt; ./table/format.o ./table/iterator.o ./table/merger.o ./table/table.o
&gt;&gt;&gt; ./table/table\\_builder.o ./table/two\\_level\\_iterator.o ./util/arena.o
&gt;&gt;&gt; ./util/cache.o ./util/coding.o ./util/comparator.o ./util/crc32c.o
&gt;&gt;&gt; ./util/env.o ./util/env\\_posix.o ./util/hash.o ./util/histogram.o
&gt;&gt;&gt; ./util/logging.o ./util/options.o ./util/status.o
&gt;&gt;&gt; ar: creating libleveldb.a
&gt;&gt;&gt; make[1]: Leaving directory `/home/phil/git/basho/eleveldb/c\\_src/leveldb'
&gt;&gt;&gt; Compiled src/eleveldb.erl
&gt;&gt;&gt; Compiling c\\_src/eleveldb.cc
&gt;&gt;&gt; ./rebar eunit
&gt;&gt;&gt; ==&gt; eleveldb (eunit)
&gt;&gt;&gt; Compiled test/basho\\_bench\\_driver\\_eldb.erl
&gt;&gt;&gt; Compiled src/eleveldb.erl
&gt;&gt;&gt; undefined
&gt;&gt;&gt;
&gt;&gt;&gt; =ERROR REPORT==== 28-Oct-2011::14:52:58 ===
&gt;&gt;&gt; The on\\_load function for module eleveldb returned {error,
&gt;&gt;&gt; {load\\_failed,
&gt;&gt;&gt; "Failed to load
&gt;&gt;&gt; NIF library: '/home/phil/git/basho/eleveldb/priv/eleveldb.so:
&gt;&gt;&gt; undefined symbol: \\_ZN6snappy13RawUncompressEPKcmPc'"}}
&gt;&gt;&gt; \\*\\*\\* test module not found \\*\\*\\*
&gt;&gt;&gt; ::eleveldb
&gt;&gt;&gt;
&gt;&gt;&gt; =======================================================
&gt;&gt;&gt; Failed: 0. Skipped: 0. Passed: 0.
&gt;&gt;&gt; One or more tests were cancelled.
&gt;&gt;&gt; ERROR: One or more eunit tests failed.
&gt;&gt;&gt; make: \\*\\*\\* [test] Error 1
&gt;&gt;&gt;

&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;
