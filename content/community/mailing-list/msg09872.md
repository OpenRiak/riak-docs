---
title: "Re: Riak Merge On Restarts Only"
description: ""
project: community
lastmod: 2013-01-22T13:29:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09872"
mailinglist_parent_id: "msg09871"
author_name: "Hector Castro"
project_section: "mailinglistitem"
sent_date: 2013-01-22T13:29:09-08:00
---


As I read through this thread, I came across the following FAQ entry
[0] in the Riak docs that echos a lot of what Brian mentioned.

[0] 
http://docs.basho.com/riak/1.2.1/cookbooks/faqs/developing-faq/#why-does-it-seem-that-bitcask-merging-is-only-trig

--
Hector


On Tue, Jan 22, 2013 at 1:14 PM, Brian Sparrow  wrote:
&gt; Anytime.
&gt;
&gt; --
&gt; Brian Sparrow
&gt; Developer Advocate
&gt; Basho Technologies
&gt;
&gt; Sent with Sparrow
&gt;
&gt; On Tuesday, January 22, 2013 at 1:13 PM, Ian Ha wrote:
&gt;
&gt; Thanks for all your help Brian. We will have another look at our configs and
&gt; our read write characteristics.
&gt;
&gt; --
&gt; Sent mobile
&gt;
&gt; On Tuesday, 22 January, 2013 at 12:53 PM, Brian Sparrow wrote:
&gt;
&gt; Yes Ian based on the output of vnode\\_status the 2.1GB file is still opened
&gt; and the 340MB file was created by the last merge. For your system it seems a
&gt; smaller max\\_file\\_size would work well. 1GB max\\_file\\_size(and then reduce
&gt; other thresholds and triggers which use bytes by half as well) is generally
&gt; a good size. This will sacrifice disk IO to free up extra disk space.
&gt; Depending on how frequently you update/delete objects even smaller file
&gt; size(200MB) may be warranted.
&gt;
&gt; Thanks,
&gt;
&gt; --
&gt; Brian Sparrow
&gt; Developer Advocate
&gt; Basho Technologies
&gt;
&gt; Sent with Sparrow
&gt;
&gt; On Tuesday, January 22, 2013 at 12:17 PM, Ian Ha wrote:
&gt;
&gt; There is another file in the that partition. It's at 340 MB, and has the
&gt; filename 4.bitcask.data.
&gt;
&gt; My understanding is because the other file is at 2.1G, and we have the
&gt; default at 2Gb, wouldn't that warrant the file to be closed and therefore
&gt; appear in vnode\\_status?
&gt;
&gt; Looks like after i ran the erlang code in riak attach I got the following:
&gt;
&gt; [{frag\\_merge\\_trigger,40},
&gt; {dead\\_bytes\\_merge\\_trigger,268435456},
&gt; {frag\\_threshold,40},
&gt; {included\\_applications,[]},
&gt; {data\\_root,"/var/lib/riak/bitcask"},
&gt; {open\\_timeout,4},
&gt; {require\\_hint\\_crc,false},
&gt; {dead\\_bytes\\_threshold,134217728},
&gt; {max\\_file\\_size,2147483648},
&gt; {max\\_fold\\_puts,0},
&gt; {max\\_fold\\_age,-1},
&gt; {small\\_file\\_threshold,10485760},
&gt; {sync\\_strategy,none},
&gt; {expiry\\_secs,3888000},
&gt; {merge\\_window,always}]
&gt;
&gt; So the max file size is a t 2.14 and the file is at 2.12, so I guess that's
&gt; why it didn't merge. Since I didn't set that value in the config, does that
&gt; appear to be the correct default value?
&gt;
&gt; Thanks for the log config, I will add that to our cluster.
&gt;
&gt;
&gt; On Tue, Jan 22, 2013 at 11:42 AM, Brian Sparrow  wrote:
&gt;
&gt; If the file is not reported in vnode\\_status then the file has not yet been
&gt; closed. Is there a more recent(and smaller size) .data file in that
&gt; partition? That file could just be on the edge of being closed.
&gt;
&gt; To confirm you bitcask settings, from `riak attach` on any node run
&gt; `application:get\\_all\\_env(bitcask).`
&gt;
&gt; Further, you can enable logging whenever a file passes the merge triggers
&gt; with the log\\_needs\\_merge setting in the bitcask settings in app.config. ex:
&gt; {log\\_needs\\_merge, true},
&gt;
&gt; This will log anytime a file is ready to be merged. If you do not see a
&gt; subsequent merge after the log entry then the file did not pass one of the
&gt; thresholds to allow the merge.
&gt;
&gt; -Brian
&gt;
&gt; --
&gt; Brian Sparrow
&gt; Developer Advocate
&gt; Basho Technologies
&gt;
&gt; Sent with Sparrow
&gt;
&gt; On Tuesday, January 22, 2013 at 11:18 AM, Ian Ha wrote:
&gt;
&gt; Brian, here's the dump for vnode\\_status. Interesetingly enough, the 2.1G
&gt; file at 271177061614132377401074334195404075912721858560/5.bitcask.data is
&gt; not part of this dump. Not sure why or if that is a concern?
&gt;
&gt; Vnode status information
&gt; -------------------------------------------
&gt;
&gt; VNode: 8563486156235759286349715816696970818296479744
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185800},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/8563486156235759286349715816696970818296479744/4.bitcask.data",
&gt; 5,31874309,338046717}]}]
&gt;
&gt; VNode: 19981467697883438334816003572292931909358452736
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185635},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/19981467697883438334816003572292931909358452736/4.bitcask.data",
&gt; 5,34907347,342699456}]}]
&gt;
&gt; VNode: 31399449239531117383282291327888893000420425728
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,184771},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/31399449239531117383282291327888893000420425728/4.bitcask.data",
&gt; 5,32830995,329973073}]}]
&gt;
&gt; VNode: 42817430781178796431748579083484854091482398720
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,184847},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/42817430781178796431748579083484854091482398720/7.bitcask.data",
&gt; 1,18113882,91425091},
&gt;
&gt; {"/var/lib/riak/bitcask/42817430781178796431748579083484854091482398720/4.bitcask.data",
&gt; 5,31974540,334178572}]}]
&gt;
&gt; VNode: 54235412322826475480214866839080815182544371712
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186027},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/54235412322826475480214866839080815182544371712/4.bitcask.data",
&gt; 5,31978319,338241457}]}]
&gt;
&gt; VNode: 65653393864474154528681154594676776273606344704
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185753},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/65653393864474154528681154594676776273606344704/4.bitcask.data",
&gt; 5,33745910,339735357}]}]
&gt;
&gt; VNode: 77071375406121833577147442350272737364668317696
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185840},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/77071375406121833577147442350272737364668317696/4.bitcask.data",
&gt; 5,30572735,337791556}]}]
&gt;
&gt; VNode: 88489356947769512625613730105868698455730290688
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186673},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/88489356947769512625613730105868698455730290688/4.bitcask.data",
&gt; 5,32874502,336092493}]}]
&gt;
&gt; VNode: 99907338489417191674080017861464659546792263680
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,184970},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/99907338489417191674080017861464659546792263680/4.bitcask.data",
&gt; 5,32396426,330001394}]}]
&gt;
&gt; VNode: 111325320031064870722546305617060620637854236672
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185248},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/111325320031064870722546305617060620637854236672/4.bitcask.data",
&gt; 5,34161176,335074205}]}]
&gt;
&gt; VNode: 122743301572712549771012593372656581728916209664
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185760},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/122743301572712549771012593372656581728916209664/4.bitcask.data",
&gt; 5,30889834,335031242}]}]
&gt;
&gt; VNode: 134161283114360228819478881128252542819978182656
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185590},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/134161283114360228819478881128252542819978182656/4.bitcask.data",
&gt; 5,32798615,337772144}]}]
&gt;
&gt; VNode: 145579264656007907867945168883848503911040155648
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185460},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/145579264656007907867945168883848503911040155648/4.bitcask.data",
&gt; 5,33085394,336272206}]}]
&gt;
&gt; VNode: 156997246197655586916411456639444465002102128640
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186096},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/156997246197655586916411456639444465002102128640/4.bitcask.data",
&gt; 5,34342279,336669714}]}]
&gt;
&gt; VNode: 168415227739303265964877744395040426093164101632
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185756},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/168415227739303265964877744395040426093164101632/4.bitcask.data",
&gt; 5,29834588,334221105}]}]
&gt;
&gt; VNode: 179833209280950945013344032150636387184226074624
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185663},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/179833209280950945013344032150636387184226074624/7.bitcask.data",
&gt; 1,4326604,84769249},
&gt;
&gt; {"/var/lib/riak/bitcask/179833209280950945013344032150636387184226074624/4.bitcask.data",
&gt; 5,32222921,327833678}]}]
&gt;
&gt; VNode: 191251190822598624061810319906232348275288047616
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185930},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/191251190822598624061810319906232348275288047616/4.bitcask.data",
&gt; 5,32790298,341206859}]}]
&gt;
&gt; VNode: 202669172364246303110276607661828309366350020608
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185911},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/202669172364246303110276607661828309366350020608/4.bitcask.data",
&gt; 5,30258774,334550584}]}]
&gt;
&gt; VNode: 214087153905893982158742895417424270457411993600
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185180},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/214087153905893982158742895417424270457411993600/4.bitcask.data",
&gt; 5,34331320,338067428}]}]
&gt;
&gt; VNode: 225505135447541661207209183173020231548473966592
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185486},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/225505135447541661207209183173020231548473966592/4.bitcask.data",
&gt; 5,33282502,336653351}]}]
&gt;
&gt; VNode: 236923116989189340255675470928616192639535939584
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185553},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/236923116989189340255675470928616192639535939584/4.bitcask.data",
&gt; 5,35582186,339871589}]}]
&gt;
&gt; VNode: 248341098530837019304141758684212153730597912576
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185181},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/248341098530837019304141758684212153730597912576/4.bitcask.data",
&gt; 5,33057915,343594362}]}]
&gt;
&gt; VNode: 259759080072484698352608046439808114821659885568
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185155},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/259759080072484698352608046439808114821659885568/4.bitcask.data",
&gt; 5,31763402,336956394}]}]
&gt;
&gt; VNode: 271177061614132377401074334195404075912721858560
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185760},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/271177061614132377401074334195404075912721858560/4.bitcask.data",
&gt; 5,35371762,340778827}]}]
&gt;
&gt; VNode: 282595043155780056449540621951000037003783831552
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185797},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/282595043155780056449540621951000037003783831552/4.bitcask.data",
&gt; 5,31127659,341388940}]}]
&gt;
&gt; VNode: 294013024697427735498006909706595998094845804544
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185400},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/294013024697427735498006909706595998094845804544/4.bitcask.data",
&gt; 5,33172810,335029860}]}]
&gt;
&gt; VNode: 305431006239075414546473197462191959185907777536
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185370},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/305431006239075414546473197462191959185907777536/4.bitcask.data",
&gt; 5,35447783,339131698}]}]
&gt;
&gt; VNode: 316848987780723093594939485217787920276969750528
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185306},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/316848987780723093594939485217787920276969750528/4.bitcask.data",
&gt; 5,33100563,334514005}]}]
&gt;
&gt; VNode: 328266969322370772643405772973383881368031723520
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185587},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/328266969322370772643405772973383881368031723520/4.bitcask.data",
&gt; 5,31554776,329354531}]}]
&gt;
&gt; VNode: 339684950864018451691872060728979842459093696512
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,184990},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/339684950864018451691872060728979842459093696512/7.bitcask.data",
&gt; 2,17893708,87660389},
&gt;
&gt; {"/var/lib/riak/bitcask/339684950864018451691872060728979842459093696512/4.bitcask.data",
&gt; 5,32530630,332735318}]}]
&gt;
&gt; VNode: 351102932405666130740338348484575803550155669504
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185489},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/351102932405666130740338348484575803550155669504/7.bitcask.data",
&gt; 1,16949080,90740582},
&gt;
&gt; {"/var/lib/riak/bitcask/351102932405666130740338348484575803550155669504/4.bitcask.data",
&gt; 5,31736396,336629981}]}]
&gt;
&gt; VNode: 362520913947313809788804636240171764641217642496
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185317},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/362520913947313809788804636240171764641217642496/4.bitcask.data",
&gt; 5,34728997,335644618}]}]
&gt;
&gt; VNode: 373938895488961488837270923995767725732279615488
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185189},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/373938895488961488837270923995767725732279615488/4.bitcask.data",
&gt; 5,33860427,338229690}]}]
&gt;
&gt; VNode: 385356877030609167885737211751363686823341588480
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185076},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/385356877030609167885737211751363686823341588480/4.bitcask.data",
&gt; 5,32015829,331802410}]}]
&gt;
&gt; VNode: 396774858572256846934203499506959647914403561472
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185502},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/396774858572256846934203499506959647914403561472/4.bitcask.data",
&gt; 5,34371519,338605515}]}]
&gt;
&gt; VNode: 408192840113904525982669787262555609005465534464
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186081},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/408192840113904525982669787262555609005465534464/10.bitcask.data",
&gt; 6,490500,3116567},
&gt;
&gt; {"/var/lib/riak/bitcask/408192840113904525982669787262555609005465534464/8.bitcask.data",
&gt; 5,26188498,171694974},
&gt;
&gt; {"/var/lib/riak/bitcask/408192840113904525982669787262555609005465534464/6.bitcask.data",
&gt; 17,11782388,73101186},
&gt;
&gt; {"/var/lib/riak/bitcask/408192840113904525982669787262555609005465534464/4.bitcask.data",
&gt; 13,20195069,117631531}]}]
&gt;
&gt; VNode: 419610821655552205031136075018151570096527507456
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185717},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/419610821655552205031136075018151570096527507456/4.bitcask.data",
&gt; 5,31829307,331435676}]}]
&gt;
&gt; VNode: 431028803197199884079602362773747531187589480448
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185947},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/431028803197199884079602362773747531187589480448/4.bitcask.data",
&gt; 5,32173706,338148596}]}]
&gt;
&gt; VNode: 442446784738847563128068650529343492278651453440
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185537},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/442446784738847563128068650529343492278651453440/4.bitcask.data",
&gt; 5,35813666,338837080}]}]
&gt;
&gt; VNode: 453864766280495242176534938284939453369713426432
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185746},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/453864766280495242176534938284939453369713426432/4.bitcask.data",
&gt; 5,32624042,334740185}]}]
&gt;
&gt; VNode: 465282747822142921225001226040535414460775399424
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185468},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/465282747822142921225001226040535414460775399424/7.bitcask.data",
&gt; 2,20331282,91766521},
&gt;
&gt; {"/var/lib/riak/bitcask/465282747822142921225001226040535414460775399424/4.bitcask.data",
&gt; 5,32647444,344746992}]}]
&gt;
&gt; VNode: 476700729363790600273467513796131375551837372416
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185831},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/476700729363790600273467513796131375551837372416/4.bitcask.data",
&gt; 5,32209907,332813073}]}]
&gt;
&gt; VNode: 488118710905438279321933801551727336642899345408
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186592},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/488118710905438279321933801551727336642899345408/4.bitcask.data",
&gt; 5,33320036,333898295}]}]
&gt;
&gt; VNode: 499536692447085958370400089307323297733961318400
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185629},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/499536692447085958370400089307323297733961318400/4.bitcask.data",
&gt; 5,33497617,343082792}]}]
&gt;
&gt; VNode: 510954673988733637418866377062919258825023291392
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185481},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/510954673988733637418866377062919258825023291392/4.bitcask.data",
&gt; 5,32209418,336325646}]}]
&gt;
&gt; VNode: 522372655530381316467332664818515219916085264384
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185230},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/522372655530381316467332664818515219916085264384/4.bitcask.data",
&gt; 5,34077445,337997080}]}]
&gt;
&gt; VNode: 533790637072028995515798952574111181007147237376
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186355},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/533790637072028995515798952574111181007147237376/4.bitcask.data",
&gt; 5,30786415,335334027}]}]
&gt;
&gt; VNode: 545208618613676674564265240329707142098209210368
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186271},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/545208618613676674564265240329707142098209210368/4.bitcask.data",
&gt; 5,32730917,335737716}]}]
&gt;
&gt; VNode: 556626600155324353612731528085303103189271183360
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186035},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/556626600155324353612731528085303103189271183360/7.bitcask.data",
&gt; 1,4873700,85319443},
&gt;
&gt; {"/var/lib/riak/bitcask/556626600155324353612731528085303103189271183360/4.bitcask.data",
&gt; 5,31326139,336025933}]}]
&gt;
&gt; VNode: 568044581696972032661197815840899064280333156352
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,184440},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/568044581696972032661197815840899064280333156352/4.bitcask.data",
&gt; 5,32950443,333793428}]}]
&gt;
&gt; VNode: 579462563238619711709664103596495025371395129344
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185118},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/579462563238619711709664103596495025371395129344/4.bitcask.data",
&gt; 5,31707260,338029164}]}]
&gt;
&gt; VNode: 590880544780267390758130391352090986462457102336
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185254},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/590880544780267390758130391352090986462457102336/4.bitcask.data",
&gt; 5,33033620,333558333}]}]
&gt;
&gt; VNode: 602298526321915069806596679107686947553519075328
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185817},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/602298526321915069806596679107686947553519075328/4.bitcask.data",
&gt; 5,33359523,340174269}]}]
&gt;
&gt; VNode: 613716507863562748855062966863282908644581048320
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185892},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/613716507863562748855062966863282908644581048320/4.bitcask.data",
&gt; 5,32059047,335268151}]}]
&gt;
&gt; VNode: 625134489405210427903529254618878869735643021312
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185479},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/625134489405210427903529254618878869735643021312/4.bitcask.data",
&gt; 5,31377434,333663874}]}]
&gt;
&gt; VNode: 636552470946858106951995542374474830826704994304
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186471},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/636552470946858106951995542374474830826704994304/4.bitcask.data",
&gt; 5,31637370,331456191}]}]
&gt;
&gt; VNode: 647970452488505786000461830130070791917766967296
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185696},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/647970452488505786000461830130070791917766967296/4.bitcask.data",
&gt; 5,33490059,341805230}]}]
&gt;
&gt; VNode: 659388434030153465048928117885666753008828940288
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185111},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/659388434030153465048928117885666753008828940288/4.bitcask.data",
&gt; 5,33355158,339718408}]}]
&gt;
&gt; VNode: 670806415571801144097394405641262714099890913280
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185663},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/670806415571801144097394405641262714099890913280/4.bitcask.data",
&gt; 5,33049532,339186274}]}]
&gt;
&gt; VNode: 682224397113448823145860693396858675190952886272
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185580},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/682224397113448823145860693396858675190952886272/4.bitcask.data",
&gt; 5,34273270,336960838}]}]
&gt;
&gt; VNode: 693642378655096502194326981152454636282014859264
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185571},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/693642378655096502194326981152454636282014859264/4.bitcask.data",
&gt; 5,33173397,331159169}]}]
&gt;
&gt; VNode: 705060360196744181242793268908050597373076832256
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186008},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/705060360196744181242793268908050597373076832256/4.bitcask.data",
&gt; 5,32475858,334556980}]}]
&gt;
&gt; VNode: 716478341738391860291259556663646558464138805248
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185593},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/716478341738391860291259556663646558464138805248/4.bitcask.data",
&gt; 5,33130883,341173503}]}]
&gt;
&gt; VNode: 727896323280039539339725844419242519555200778240
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185629},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/727896323280039539339725844419242519555200778240/4.bitcask.data",
&gt; 5,33103829,336311860}]}]
&gt;
&gt; VNode: 739314304821687218388192132174838480646262751232
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185624},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/739314304821687218388192132174838480646262751232/4.bitcask.data",
&gt; 5,31556811,334381544}]}]
&gt;
&gt; VNode: 750732286363334897436658419930434441737324724224
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186224},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/750732286363334897436658419930434441737324724224/4.bitcask.data",
&gt; 5,30142108,342742989}]}]
&gt;
&gt; VNode: 762150267904982576485124707686030402828386697216
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185299},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/762150267904982576485124707686030402828386697216/4.bitcask.data",
&gt; 5,32275793,339187482}]}]
&gt;
&gt; VNode: 773568249446630255533590995441626363919448670208
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185603},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/773568249446630255533590995441626363919448670208/4.bitcask.data",
&gt; 5,30237450,330464324}]}]
&gt;
&gt; VNode: 784986230988277934582057283197222325010510643200
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186145},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/784986230988277934582057283197222325010510643200/4.bitcask.data",
&gt; 5,30762226,337042253}]}]
&gt;
&gt; VNode: 796404212529925613630523570952818286101572616192
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186029},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/796404212529925613630523570952818286101572616192/4.bitcask.data",
&gt; 5,33089921,342650037}]}]
&gt;
&gt; VNode: 807822194071573292678989858708414247192634589184
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186228},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/807822194071573292678989858708414247192634589184/4.bitcask.data",
&gt; 5,31644203,336945269}]}]
&gt;
&gt; VNode: 819240175613220971727456146464010208283696562176
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185946},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/819240175613220971727456146464010208283696562176/4.bitcask.data",
&gt; 5,34478537,335108377}]}]
&gt;
&gt; VNode: 830658157154868650775922434219606169374758535168
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185938},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/830658157154868650775922434219606169374758535168/4.bitcask.data",
&gt; 5,32153080,336335603}]}]
&gt;
&gt; VNode: 842076138696516329824388721975202130465820508160
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185119},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/842076138696516329824388721975202130465820508160/4.bitcask.data",
&gt; 5,32662173,342685946}]}]
&gt;
&gt; VNode: 853494120238164008872855009730798091556882481152
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186095},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/853494120238164008872855009730798091556882481152/4.bitcask.data",
&gt; 5,31724299,338609269}]}]
&gt;
&gt; VNode: 864912101779811687921321297486394052647944454144
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185978},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/864912101779811687921321297486394052647944454144/4.bitcask.data",
&gt; 5,31688977,332396013}]}]
&gt;
&gt; VNode: 876330083321459366969787585241990013739006427136
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186038},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/876330083321459366969787585241990013739006427136/9.bitcask.data",
&gt; 1,82942,4223127},
&gt;
&gt; {"/var/lib/riak/bitcask/876330083321459366969787585241990013739006427136/8.bitcask.data",
&gt; 2,20442384,94777157},
&gt;
&gt; {"/var/lib/riak/bitcask/876330083321459366969787585241990013739006427136/5.bitcask.data",
&gt; 5,26398003,329299684}]}]
&gt;
&gt; VNode: 887748064863107046018253872997585974830068400128
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185605},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/887748064863107046018253872997585974830068400128/4.bitcask.data",
&gt; 5,32415353,335591556}]}]
&gt;
&gt; VNode: 1173197603404299022229911066887485002106617724928
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185976},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1173197603404299022229911066887485002106617724928/4.bitcask.data",
&gt; 5,32719451,334916473}]}]
&gt;
&gt; VNode: 1184615584945946701278377354643080963197679697920
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186439},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1184615584945946701278377354643080963197679697920/7.bitcask.data",
&gt; 2,20171431,87739364},
&gt;
&gt; {"/var/lib/riak/bitcask/1184615584945946701278377354643080963197679697920/4.bitcask.data",
&gt; 5,34315029,334169356}]}]
&gt;
&gt; VNode: 1196033566487594380326843642398676924288741670912
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185659},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1196033566487594380326843642398676924288741670912/4.bitcask.data",
&gt; 5,34544534,339094321}]}]
&gt;
&gt; VNode: 1207451548029242059375309930154272885379803643904
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185309},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1207451548029242059375309930154272885379803643904/4.bitcask.data",
&gt; 5,34049175,334609625}]}]
&gt;
&gt; VNode: 1218869529570889738423776217909868846470865616896
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185067},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1218869529570889738423776217909868846470865616896/9.bitcask.data",
&gt; 5,21798031,55300856},
&gt;
&gt; {"/var/lib/riak/bitcask/1218869529570889738423776217909868846470865616896/6.bitcask.data",
&gt; 7,19228418,50004789},
&gt;
&gt; {"/var/lib/riak/bitcask/1218869529570889738423776217909868846470865616896/5.bitcask.data",
&gt; 7,25130869,298276178}]}]
&gt;
&gt; VNode: 1230287511112537417472242505665464807561927589888
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185677},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1230287511112537417472242505665464807561927589888/4.bitcask.data",
&gt; 5,34162507,338171429}]}]
&gt;
&gt; VNode: 1241705492654185096520708793421060768652989562880
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185480},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1241705492654185096520708793421060768652989562880/4.bitcask.data",
&gt; 5,32122493,340603091}]}]
&gt;
&gt; VNode: 1253123474195832775569175081176656729744051535872
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186191},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1253123474195832775569175081176656729744051535872/4.bitcask.data",
&gt; 5,32683442,337318456}]}]
&gt;
&gt; VNode: 1264541455737480454617641368932252690835113508864
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185594},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1264541455737480454617641368932252690835113508864/4.bitcask.data",
&gt; 5,33864031,342388629}]}]
&gt;
&gt; VNode: 1275959437279128133666107656687848651926175481856
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185644},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1275959437279128133666107656687848651926175481856/4.bitcask.data",
&gt; 5,33250712,338253781}]}]
&gt;
&gt; VNode: 1287377418820775812714573944443444613017237454848
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185323},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1287377418820775812714573944443444613017237454848/4.bitcask.data",
&gt; 5,32485461,339612430}]}]
&gt;
&gt; VNode: 1298795400362423491763040232199040574108299427840
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185903},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1298795400362423491763040232199040574108299427840/4.bitcask.data",
&gt; 5,32102630,336913196}]}]
&gt;
&gt; VNode: 1310213381904071170811506519954636535199361400832
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185513},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1310213381904071170811506519954636535199361400832/4.bitcask.data",
&gt; 5,32704593,337827399}]}]
&gt;
&gt; VNode: 1321631363445718849859972807710232496290423373824
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185796},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1321631363445718849859972807710232496290423373824/4.bitcask.data",
&gt; 5,31667414,344554808}]}]
&gt;
&gt; VNode: 1333049344987366528908439095465828457381485346816
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,184729},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1333049344987366528908439095465828457381485346816/4.bitcask.data",
&gt; 5,31916929,331982952}]}]
&gt;
&gt; VNode: 1344467326529014207956905383221424418472547319808
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186374},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1344467326529014207956905383221424418472547319808/4.bitcask.data",
&gt; 5,32011535,336838669}]}]
&gt;
&gt; VNode: 1355885308070661887005371670977020379563609292800
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185097},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1355885308070661887005371670977020379563609292800/4.bitcask.data",
&gt; 5,31257938,327694910}]}]
&gt;
&gt; VNode: 1367303289612309566053837958732616340654671265792
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185280},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1367303289612309566053837958732616340654671265792/4.bitcask.data",
&gt; 5,33641764,341085585}]}]
&gt;
&gt; VNode: 1378721271153957245102304246488212301745733238784
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185792},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1378721271153957245102304246488212301745733238784/5.bitcask.data",
&gt; 5,32139774,336659768}]}]
&gt;
&gt; VNode: 1390139252695604924150770534243808262836795211776
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185647},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1390139252695604924150770534243808262836795211776/5.bitcask.data",
&gt; 5,31422173,335753645}]}]
&gt;
&gt; VNode: 1401557234237252603199236821999404223927857184768
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185641},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1401557234237252603199236821999404223927857184768/5.bitcask.data",
&gt; 5,32892084,335640971}]}]
&gt;
&gt; VNode: 1412975215778900282247703109755000185018919157760
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185982},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1412975215778900282247703109755000185018919157760/5.bitcask.data",
&gt; 5,32650794,337720285}]}]
&gt;
&gt; VNode: 1424393197320547961296169397510596146109981130752
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186569},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1424393197320547961296169397510596146109981130752/5.bitcask.data",
&gt; 5,31520831,340970872}]}]
&gt;
&gt; VNode: 1435811178862195640344635685266192107201043103744
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186322},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1435811178862195640344635685266192107201043103744/5.bitcask.data",
&gt; 5,32047072,337905167}]}]
&gt;
&gt; VNode: 1447229160403843319393101973021788068292105076736
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,186082},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1447229160403843319393101973021788068292105076736/5.bitcask.data",
&gt; 5,32158728,335402990}]}]
&gt;
&gt; VNode: 1458647141945490998441568260777384029383167049728
&gt; Backend: riak\\_kv\\_bitcask\\_backend
&gt; Status:
&gt; [{key\\_count,185244},
&gt;
&gt; {status,[{"/var/lib/riak/bitcask/1458647141945490998441568260777384029383167049728/7.bitcask.data",
&gt; 3,20056866,73970408},
&gt;
&gt; {"/var/lib/riak/bitcask/1458647141945490998441568260777384029383167049728/5.bitcask.data",
&gt; 5,32748739,331478355}]}]
&gt;
&gt;
&gt; On Tue, Jan 22, 2013 at 11:03 AM, Brian Sparrow  wrote:
&gt;
&gt; What is reported by riak-admin vnode\\_status?
&gt;
&gt; Thanks,
&gt; Brian
&gt;
&gt; --
&gt; Brian Sparrow
&gt; Developer Advocate
&gt; Basho Technologies
&gt;
&gt; Sent with Sparrow
&gt;
&gt; On Tuesday, January 22, 2013 at 10:49 AM, Ian Ha wrote:
&gt;
&gt; Thanks Brian. This is very helpful and informative!
&gt;
&gt; Only question is we do indeed have data files that are &gt; 2GB that haven't
&gt; merged. I have a data file at 2.1G, as of today. The last merged happened
&gt; Jan 20, which was two days ago.
&gt;
&gt; Anything we are missing here?
&gt;
&gt;
&gt; On Sat, Jan 19, 2013 at 2:01 PM, Brian Sparrow  wrote:
&gt;
&gt; Hi Ian,
&gt;
&gt; Q: Why does this happen on a restart only and not at other times, even
&gt; though we have set our merge\\_window config setting to 'always'?
&gt;
&gt; A: The merge\\_window setting defaults to always and that simply means that
&gt; bitcask will merge anytime the merge\\_triggers and thresholds set in the
&gt; app.config are satisfied on a closed bitcask file. A bitcask data file is
&gt; closed when it reaches the max\\_file\\_size threshold set in app.config(default
&gt; of 2GB) or the node is stopped. Merging is happening on restart because this
&gt; file is now closed and eligible for merge. You are not seeing merging during
&gt; normal operation because the files are not reaching the 2GB max\\_file\\_size.
&gt;
&gt; Q: I'm assuming our config values are correct as the restart considers the
&gt; thresholds met to go ahead with a merge.
&gt;
&gt; A: I do not see anything wrong with your configuration with the exception of
&gt; no max\\_file\\_size being set. If you want to merge more often, reduce the
&gt; max\\_file size to 1GB or lower(the lower the file size, the more merging). A
&gt; good way to estimate the appropriate size is to look at how large your .data
&gt; files are getting in your bitcask data directory and deciding from there
&gt; what size threshold you would like to set based on your disk usage needs.
&gt;
&gt; Q: Also: Are there any tools out there that I can run on my data directory
&gt; that will tell me the size of the dead byte ratios? Would be nice to see
&gt; what the dead byte 'state' of my data dir is in so I can tell whether indeed
&gt; merge conditions are met.
&gt;
&gt; A: The command you are looking for is riak-admin vnode\\_status. This will
&gt; list all partitions on the local node as well as the number of keys in each
&gt; partition and a list of closed bitcask data files in the format:
&gt;
&gt; {CLOSE\\_DATA\\_FILE\\_NAME, FRAG\\_PERCENTAGE, DEAD\\_BYTES, TOTAL\\_FILE\\_SIZE}
&gt;
&gt; Again, a data file must be closed(reached max\\_file\\_size or closed by node
&gt; stop) to be reported in this command.
&gt;
&gt; Hope this answers all your questions.
&gt;
&gt; Thanks!
&gt;
&gt;
&gt; --
&gt; Brian Sparrow
&gt; Customer Service Engineer
&gt; Basho Technologies
&gt;
&gt; On Friday, January 18, 2013 at 5:14 PM, Ian Ha wrote:
&gt;
&gt; Hi,
&gt;
&gt; In our production system, we notice that merges are not taking place. We
&gt; have noticed, however, that when we restart riak (via a 'riak stop' then a
&gt; 'riak start'), then the merges are triggered and our disk usage goes way day
&gt; (which is what we want). We use bitcask.
&gt;
&gt; Why does this happen on a restart only and not at other times, even though
&gt; we have set our merge\\_window config setting to 'always'?
&gt;
&gt; I'm assuming our config values are correct as the restart considers the
&gt; thresholds met to go ahead with a merge.
&gt;
&gt; Also: Are there any tools out there that I can run on my data directory that
&gt; will tell me the size of the dead byte ratios? Would be nice to see what the
&gt; dead byte 'state' of my data dir is in so I can tell whether indeed merge
&gt; conditions are met.
&gt;
&gt; Our bit cask configs are as follows in app.config:
&gt;
&gt; {bitcask, [
&gt; {data\\_root, "/var/lib/riak/bitcask"},
&gt; {dead\\_bytes\\_merge\\_trigger, 268435456},
&gt; {dead\\_bytes\\_threshold, 134217728},
&gt; {expiry\\_secs, 3888000},
&gt; {frag\\_merge\\_trigger, 40},
&gt; {frag\\_threshold, 20},
&gt; {merge\\_window, always},
&gt; {small\\_file\\_threshold, 10485760},
&gt; {sync\\_strategy, none}
&gt; ]},
&gt;
&gt;
&gt; Thanks!
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

