---
title: "Re: Load Balancing With Riak Ruby Client"
description: ""
project: community
lastmod: 2011-05-29T10:47:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03485"
mailinglist_parent_id: "msg03483"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-05-29T10:47:48-07:00
---


I think for the protocol buffers, one should probably use the "least connected" 
strategy, but PBC connections tend to be more long-lived than HTTP connections 
-- which would describe what you saw.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On May 29, 2011, at 1:35 PM, Scott M. Likens wrote:

&gt; Hey,
&gt; 
&gt; In my Chef recipes for AppCloud (Engine Yard's PaaS Product) I actually 
&gt; configured haproxy to listen on 8098 on the application instances and 
&gt; redirect to all the riak nodes in a roundrobin fashion. (Had httpchk for 
&gt; /ping to ensure the node is up)
&gt; 
&gt; In my own testing with basho\\_bench this seemed to work, I'm unsure of what 
&gt; drawbacks there would be because I could not find any other then HTTP was 
&gt; slower then PBC.
&gt; 
&gt; I did find find that Protobuffers did not roundrobin correctly with haproxy 
&gt; using tcp mode... darn :(
&gt; 
&gt; So if we're just speaking HTTP could totally use HAProxy or a Hardware Load 
&gt; balancer to spread out the load.
&gt; 
&gt; Scott
&gt; -- 
&gt; Scott M. Likens
&gt; Sent with Sparrow
&gt; On Friday, May 27, 2011 at 12:40 PM, Sean Cribbs wrote:
&gt; 
&gt;&gt; This is one thing I desperately want to refactor. The Ruby client still 
&gt;&gt; contains some things that reflect my earlier, less astute understanding of 
&gt;&gt; how a Riak client should behave and doesn't include obvious things like 
&gt;&gt; retrying requests (possibly on other nodes), conflict resolution strategies, 
&gt;&gt; and mutators.
&gt;&gt; 
&gt;&gt; In the past, I have recommended that users put a lightweight load-balancer 
&gt;&gt; (e.g. haproxy, pound) between their application and Riak, and simply have 
&gt;&gt; the app connect to the locally-running instance of the LB. I realize this is 
&gt;&gt; not a great solution, but it also avoids a little NIH for now.
&gt;&gt; 
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt;&gt; On May 27, 2011, at 3:20 PM, Keith Bennett wrote:
&gt;&gt; 
&gt;&gt;&gt; Hi, all. If I have several riak servers on a cluster, and want to 
&gt;&gt;&gt; distribute load fairly evenly, and am using the Ruby Riak client, what is 
&gt;&gt;&gt; the best way to balance load?
&gt;&gt;&gt; 
&gt;&gt;&gt; With the HTTP interface, I can randomize the choice of host for a request. 
&gt;&gt;&gt; How would I do the same with the ruby client? Would I create a Riak::Client 
&gt;&gt;&gt; for each host, and then just randomize the selection of those for a given 
&gt;&gt;&gt; call? Do the clients contain any state that would make this a bad idea? Or 
&gt;&gt;&gt; is there a better way to do this?
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Keith
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; !DSPAM:4ddffdaf202681804284693!
&gt; 

