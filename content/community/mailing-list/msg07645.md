---
title: "Re: Riak.mapValuesJson is returning a string"
description: ""
project: community
lastmod: 2012-06-08T05:50:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07645"
mailinglist_parent_id: "msg07461"
author_name: "Brad Corson"
project_section: "mailinglistitem"
sent_date: 2012-06-08T05:50:51-07:00
---


Brian,

Thanks for the response, and sorry I couldn't get back to you before this.
I had to change focus to a couple of other projects before I could come
back to my Riak project.

We've solved our problem. Basically, we had to wrap the Riak.mapValuesJson
so that the pertinent part of the map looks like this:

var dats = JSON.parse(Riak.mapValuesJson(value)[0])

I was under the assumption that Riak.mapValuesJson turned the data into a
JSON object, but that wasn't the case for us. Wrapping in a JSON.parse
gives us a JSON object, just like we had originally stored, and lets us use
dot access on the hash.

Thanks again for your response, it helped me to recognize where we went
wrong. We were getting back what LOOKED like expected results, just in a
string format instead of JSON.

Thanks,
Brad

On Wed, May 16, 2012 at 8:48 AM, Brian Shumate  wrote:

&gt; Hello,
&gt;
&gt; I am running a Riak 1.1.2 rel build from source on OS X 10.7 with Erlang
&gt; R14B04, and just tried a case like yours, but I cannot reproduce your issue:
&gt;
&gt; curl -v -d '{"name": "Brian"}' -H "Content-Type: application/json"
&gt; http://127.0.0.1:8098/riak/test/120000
&gt;
&gt; \\* About to connect() to 127.0.0.1 port 8098 (#0)
&gt; \\* Trying 127.0.0.1... connected
&gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8098 (#0)
&gt; &gt; POST /riak/test/120000 HTTP/1.1
&gt; &gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4
&gt; OpenSSL/0.9.8r zlib/1.2.5
&gt; &gt; Host: 127.0.0.1:8098
&gt; &gt; Accept: \\*/\\*
&gt; &gt; Content-Type: application/json
&gt; &gt; Content-Length: 28
&gt; &gt;
&gt; &lt; HTTP/1.1 204 No Content
&gt; &lt; Vary: Accept-Encoding
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt; &lt; Date: Sun, 13 May 2012 19:50:49 GMT
&gt; &lt; Content-Type: application/json
&gt; &lt; Content-Length: 0
&gt; &lt;
&gt; \\* Connection #0 to host 127.0.0.1 left intact
&gt; \\* Closing connection #0
&gt;
&gt; curl -i localhost:8098/riak/test/120000
&gt;
&gt; HTTP/1.1 200 OK
&gt; X-Riak-Vclock: a85hYGBgzGDKBVIcypz/fvpv4P+QwZTImMfKMLNH5SRfFgA=
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt; Link: ; rel="up"
&gt; Last-Modified: Sun, 13 May 2012 19:50:49 GMT
&gt; ETag: "hsUPQi54y1EKeXVazb3fl"
&gt; Date: Sun, 13 May 2012 19:50:56 GMT
&gt; Content-Type: application/json
&gt; Content-Length: 28
&gt;
&gt; {"name": "Brian"}%
&gt;
&gt; curl -v -d '{"inputs":[["test", "120000"]],
&gt; "query":[{"map":{"language":"javascript", "source":"function(value,
&gt; keyData, arg) { var dats = Riak.mapValuesJson(value)[0]; return [typeof
&gt; dats];}"}}]}' -H "Content-Type: application/json"
&gt; http://127.0.0.1:8098/mapred
&gt;
&gt; \\* About to connect() to 127.0.0.1 port 8098 (#0)
&gt; \\* Trying 127.0.0.1... connected
&gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8098 (#0)
&gt; &gt; POST /mapred HTTP/1.1
&gt; &gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4
&gt; OpenSSL/0.9.8r zlib/1.2.5
&gt; &gt; Host: 127.0.0.1:8098
&gt; &gt; Accept: \\*/\\*
&gt; &gt; Content-Type: application/json
&gt; &gt; Content-Length: 184
&gt; &gt;
&gt; &lt; HTTP/1.1 200 OK
&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt; &lt; Date: Sun, 13 May 2012 19:52:28 GMT
&gt; &lt; Content-Type: application/json
&gt; &lt; Content-Length: 10
&gt; &lt;
&gt; \\* Connection #0 to host 127.0.0.1 left intact
&gt; \\* Closing connection #0
&gt; ["object"]%
&gt;
&gt; As you can see above, I get the expected results.
&gt;
&gt; What version of Riak are you using? What does the full (with -v) output of
&gt; storing an object in your case look like?
&gt;
&gt; Regards,
&gt;
&gt; Brian
&gt;
&gt; On May 16, 2012, at 8:40 AM, kodeblok wrote:
&gt;
&gt; &gt; Does anyone have any thoughts on this? I'm unable to perform MapReduce
&gt; &gt; queries.
&gt; &gt;
&gt; &gt; Thanks
&gt; &gt;
&gt; &gt; --
&gt; &gt; View this message in context:
&gt; http://riak-users.197444.n3.nabble.com/Riak-mapValuesJson-is-returning-a-string-tp3942213p3996979.html
&gt; &gt; Sent from the Riak Users mailing list archive at Nabble.com.
&gt; &gt;
