---
title: "Re: setting search schema"
description: ""
project: community
lastmod: 2012-10-15T17:55:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08928"
mailinglist_parent_id: "msg08905"
author_name: "David Lowell"
project_section: "mailinglistitem"
sent_date: 2012-10-15T17:55:52-07:00
---


You know, the more I look at this piece, the more I conclude there just is 
nowhere to put a programmatic installation of the schema into riak. I can't do 
it from my application, which does not run as user 'riak', nor as user 'root'. 
So it doesn't have the needed permissions to run search-cmd and change the 
schema. The documentation strongly warns against directly manipulating the 
bucket of schemas. I could install the schema from script as a part of the 
software install process, but there is no guarantee that riak is even running 
at that time. So the only other option seems to hack the riak startup script or 
create a cronjob or some other kludgeism. 

So how are people handling this? Is everyone having their sysadmin install the 
schema by hand? Surely someone has come up with something automated! Sighâ€¦

Dave

--
Dave Lowell
d...@connectv.com

On Oct 13, 2012, at 3:40 PM, Alexander Sicular wrote:

&gt; Hi David, I'm thinking that you should write some bash-fu and use the 
&gt; search-cmd tool. You could do a search-cmd show-schema to check for a schema 
&gt; match. If you have to run search-cmd as root it stands to reason that you are 
&gt; running riak as root which I don't think is a good idea in general.
&gt; 
&gt; -Alexander Sicular
&gt; 
&gt; @siculars
&gt; 
&gt; On Oct 13, 2012, at 3:32 PM, David Lowell wrote:
&gt; 
&gt;&gt; My software needs to be able to set a custom schema in Riak for indexing 
&gt;&gt; json objects. To make deploying my software easy, what I think I'd like to 
&gt;&gt; be able to do is:
&gt;&gt; 
&gt;&gt; - on app startup, test whether the schema has been added for index already
&gt;&gt; - if not, set the schema for my index
&gt;&gt; 
&gt;&gt; It does appear that I can test whether a schema exists for my index with 
&gt;&gt; (from python):
&gt;&gt; 
&gt;&gt; client.bucket('\\_rs\\_schema').get(INDEX\\_NAME).exists()
&gt;&gt; 
&gt;&gt; However, the docs warn against writing any schemas into the \\_rs\\_schema 
&gt;&gt; bucket directly. The only other interface documented for assigning schemas 
&gt;&gt; is the "search-cmd" command line tool. I conclude there does not appear to 
&gt;&gt; be a supported way to assign schemas to indexes from code.
&gt;&gt; 
&gt;&gt; I could have my code invoke the command line tools to assign this schema, 
&gt;&gt; but then my code would have to run as root.
&gt;&gt; 
&gt;&gt; So, am I missing something? How do other people manage to manage the schemas 
&gt;&gt; for their indexes?
&gt;&gt; 
&gt;&gt; Thanks for the help,
&gt;&gt; 
&gt;&gt; Dave
&gt;&gt; 
&gt;&gt; --
&gt;&gt; Dave Lowell
&gt;&gt; d...@connectv.com
&gt;&gt; 
&gt; 

