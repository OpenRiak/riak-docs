---
title: "Re: Riak.mapValuesJson crashes on \\r\\n"
description: ""
project: community
lastmod: 2011-03-23T13:35:03-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02717"
mailinglist_parent_id: "msg02716"
author_name: "Aphyr"
project_section: "mailinglistitem"
sent_date: 2011-03-23T13:35:03-07:00
---


Newline parsing is broken in JSON2.js shipped with Riak. Drop a more 
recent version of JSON2.js in the directory referred to by js\\_source\\_dir 
in app.config's riak\\_kv section, e.g.


{js\\_source\\_dir, "/etc/riak/js/"}

and reload the node.

--Kyle

On 03/23/2011 01:31 PM, Michael Ossareh wrote:

Greets,

https://gist.github.com/883872

That stack trace is the product of calling Riak.mapValuesJson in a map
phase of a map reduce job. I checked the same parsing against Chrome and
Firefox and they both parse the string as I'd expect. The object, as a
string, that is being parsed is:

"{\\"bar\\":\\"baz\\\\r\\\\nfrob\\"}"

The setup is: Riak 0.14.0 on Mac OS X 10.6.6 and CentOS 5.5


Any advice / pointers, greatly appreciated. Also, let me know if there
is anything else I can do to help.

Cheers,

mike
