---
title: "erlang:phash2(now())"
description: ""
project: community
lastmod: 2010-10-02T07:00:53-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01181"
author_name: "Lev Walkin"
project_section: "mailinglistitem"
sent_date: 2010-10-02T07:00:53-07:00
---




In riak sources there are many references to 
erlang:phash2(erlang:now()).


Why not use idiomatic make\\_ref() or at the very least 
erlang:phash2(make\\_ref()), which is faster?


1&gt; perftest:comprehensive(100000, fun() -&gt; erlang:phash2(erlang:now()) 
end).

Sequential 100000 cycles in ~1 seconds (193510 cycles/s)
Parallel 2 100000 cycles in ~1 seconds (187282 cycles/s)
Parallel 4 100000 cycles in ~1 seconds (197310 cycles/s)
Parallel 10 100000 cycles in ~1 seconds (182890 cycles/s)
Parallel 100 100000 cycles in ~0 seconds (208671 cycles/s)
[197310,182890,208671]
2&gt; perftest:comprehensive(100000, fun() -&gt; erlang:phash2(make\\_ref()) 
end).

Sequential 100000 cycles in ~0 seconds (323952 cycles/s)
Parallel 2 100000 cycles in ~0 seconds (301875 cycles/s)
Parallel 4 100000 cycles in ~0 seconds (308568 cycles/s)
Parallel 10 100000 cycles in ~0 seconds (287875 cycles/s)
Parallel 100 100000 cycles in ~0 seconds (326416 cycles/s)
[308568,287875,326416]
3&gt; perftest:comprehensive(100000, fun() -&gt; make\\_ref() end).
Sequential 100000 cycles in ~0 seconds (1299765 cycles/s)
Parallel 2 100000 cycles in ~0 seconds (934492 cycles/s)
Parallel 4 100000 cycles in ~0 seconds (1111679 cycles/s)
Parallel 10 100000 cycles in ~0 seconds (1241434 cycles/s)
Parallel 100 100000 cycles in ~0 seconds (1264350 cycles/s)
[1111679,1241434,1264350]
4&gt;

make\\_ref is 6 times faster than erlang:phash2(make\\_ref()) which is 50% 
faster than erlang:phash2(now()).


Of course, in the grand scheme of things this might not be your 
biggest bottleneck, but why hashing now() when there exsists an 
idiomatic make\\_ref() solution? Am I missing something?


--
Lev Walkin
v...@lionet.info

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

