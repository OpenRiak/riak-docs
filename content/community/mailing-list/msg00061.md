---
title: "Re: \"bad encoding\""
description: ""
project: community
lastmod: 2010-04-16T09:31:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00061"
mailinglist_parent_id: "msg00060"
author_name: "Kevin Smith"
project_section: "mailinglistitem"
sent_date: 2010-04-16T09:31:08-07:00
---


This happens when the Erlang &lt;-&gt; Javascript machinery hits non-unicode data. 
All data needs to be encoded as utf8/unicode. If it's not, or you've got an 
incorrect unicode escape sequence, then you'll see this error.

--Kevin
On Apr 16, 2010, at 12:22 PM, Jimmy Thrasher wrote:

&gt; Hi everybody,
&gt; 
&gt; I have a document stored as application/json, and when it is present, 
&gt; map/reduce queries that operate on the JSON contents result in ["bad 
&gt; encoding"].
&gt; 
&gt; Before I go down the long path of reproducing in isolation, what should I 
&gt; know about encodings, JSON and Riak? Here's the document:
&gt; {"time":1271430844,"type":"checkin","user\\_id":131,"data":{"user\\_id":131,"name":"&$","task\\_list\\_id":"1234","address":"#%^\\*\\u00a5+\\u00a5\\u2022\\u00a3\\u20ac","latitude":"35.9024975592833","longitude":"-78.8580127860656"}}
&gt; 
&gt; In my local standalone SpiderMonkey instance, the following works just fine:
&gt; JSON.parse("{\\"time\\":1271430844,\\"points\\":2,\\"type\\":\\"checkin\\",\\"user\\_id\\":131,\\"data\\":{\\"user\\_id\\":131,\\"name\\":\\"&$\\",\\"task\\_list\\_id\\":\\"1234\\",\\"address\\":\\"#%^\\*\\\\u00a5+\\\\u00a5\\\\u2022\\\\u00a3\\\\u20ac\\",\\"latitude\\":\\"35.9024975592833\\",\\"longitude\\":\\"-78.8580127860656\\"}}")
&gt; 
&gt; But when I remove this entry from the DB everything becomes ungummed again.
&gt; 
&gt; Any ideas before I start digging deeper?
&gt; 
&gt; Jimmy
