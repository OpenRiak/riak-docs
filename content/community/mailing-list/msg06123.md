---
title: "Re: Deletion of keys in Riak doesn't decrease its RAM size"
description: ""
project: community
lastmod: 2012-01-04T05:57:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06123"
mailinglist_parent_id: "msg06122"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-01-04T05:57:20-08:00
---


Vicky,

Riak is very careful about deletes and will not completely reap existing
values until several conditions occur. So instead of deleting the value
immediately -- because in a distributed system, race-conditions can occur
and you need to determine causal ordering of events -- Riak will write a
"tombstone" for the deleted key, which is simply a dummy value that tells
it "this was deleted" the next time the key was accessed. At a later time,
that tombstone can be cleaned up. Note that this is a \\*Riak\\* tombstone, its
storage backends know nothing of the semantics of this value and will
simply store it as the latest version of the item under the same key. So
what you are likely witnessing is that the tombstones have not yet been
reaped from the backend store (probably Bitcask given the memory usage) and
so they are consuming memory in the LUT ("keydir" in Bitcask's terminology).

On Wed, Jan 4, 2012 at 8:03 AM, Vicky Khanna wrote:

&gt; Hi, \\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; I had around 100 million entries in the riak cluster of 4 which was taking
&gt; 9\\*4 = 36 GB of RAM.\\*\\*\\*\\*
&gt;
&gt; I deleted some 40 million keys from the cluster and still the size is same.
&gt; \\*\\*\\*\\*
&gt;
&gt; I restarted the cluster and still size is same.\\*\\*\\*\\*
&gt;
&gt; Can anyone please tell why riak is still retaining its original size even
&gt; after deletion.\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; Thanks in Advance\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; Vicky Khanna\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;

-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
