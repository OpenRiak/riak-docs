---
title: "Re: Riak Cluster Setup on EC2"
description: ""
project: community
lastmod: 2011-02-02T09:04:27-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02170"
mailinglist_parent_id: "msg02169"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-02-02T09:04:27-08:00
---


Hi Abhishek,

It looks like distributed erlang isn't working between the nodes so the join
fails.

You can test it by bringing the nodes up in console mode and executing

$ riak console
[some logging status messages]
Eshell V5.7.5 (abort with ^G)
(dev2@127.0.0.1)1&gt; net\\_adm:ping('dev1@127.0.0.1').
pong
(dev2@127.0.0.1)3&gt; q().
ok

Make sure you switch the node names for your own and run the test in both
directions. If the node is unreachable it will return pang instead of ping.

--Jon
Senior Software Engineer
Basho Technologies

On Wed, Feb 2, 2011 at 9:04 AM, Abhishek Kona wrote:

&gt; On 02/02/11 8:38 PM, Sean Cribbs wrote:
&gt;
&gt; Abhishek,
&gt;
&gt; First, make sure all of your nodes are in the same security group.
&gt;
&gt; Yes, both the machines are on the same security group ( which has only the
&gt; ports 8098, 8099, 8087).
&gt;
&gt; Second, check that your OS doesn't have an additional firewall installed
&gt; (iptables, for example).
&gt;
&gt; I can telnet into the Riak ports from each of the machines, so firewall
&gt; does not seem to be the issue.
&gt;
&gt; Third, you might consider doing what the Chef recipe for Riak does and
&gt; limit the ports that Erlang uses for distributed communication. Adding a
&gt; section to app.config like the below will limit the port range:
&gt;
&gt; {kernel, [
&gt; {inet\\_dist\\_listen\\_min, 6000},
&gt; {inet\\_dist\\_listen\\_max, 7999}
&gt; ]}
&gt;
&gt; You'll need to stop Riak, kill the "epmd" process, and then start Riak up
&gt; again for this change to take effect. Make sure those ports are also open
&gt; in your security group and any software firewall you have.
&gt;
&gt; Tried with these changes as well, but still get the same message. Anything
&gt; else, I can try?.
&gt; Thanks for the help.
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; On Feb 2, 2011, at 8:47 AM, Abhishek Kona wrote:
&gt;
&gt; Hi folks
&gt;
&gt; I am trying to set up a Riak cluster on EC2.
&gt; Each time I issue a command :
&gt;
&gt; $ sudo riak-admin join riak@10.130.149.253
&gt;
&gt; It fails :
&gt;
&gt; Attempting to restart script through sudo -u riak
&gt;
&gt; Node riak@10.130.149.253 is not reachable!
&gt;
&gt;
&gt; Netstat on both the machines says the ports are running fine.
&gt;
&gt; netstat -na | egrep '(8087|8098|8099)'
&gt;
&gt; tcp 0 0 0.0.0.0:8098 0.0.0.0:\\* LISTEN
&gt;
&gt;
&gt; tcp 0 0 0.0.0.0:8099 0.0.0.0:\\* LISTEN
&gt;
&gt;
&gt; tcp 0 0 0.0.0.0:8087 0.0.0.0:\\* LISTEN
&gt;
&gt;
&gt;
&gt; I can telnet to all the ports from each of the machine.
&gt; I have been pulling my hair for long but of no avail.
&gt; Can any one look and tell me what I am doing wrong.
&gt; Are there any debug logs where I can look at what is going wrong?
&gt; Is there any EC2 specific trick (like using public hostnames).
&gt;
&gt; I am attaching my app.cfg file for reference.
&gt;
&gt; Thanks
&gt; -Abhishek Kona
&gt;
