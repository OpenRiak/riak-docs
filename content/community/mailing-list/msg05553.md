---
title: "Re: Index query mapreduce error"
description: ""
project: community
lastmod: 2011-11-11T09:19:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05553"
mailinglist_parent_id: "msg05530"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-11-11T09:19:09-08:00
---


Ben,

The problem is you are using the legacy MapReduce system instead of the new 
pipe system. If you edit the riak app.config and change the mapred\\_system 
setting to pipe instead of legacy, it should resolve the issue. The app.config 
file can be found in /etc/riak if you installed from one of the prebuilt 
packages. 

Kelly


On Nov 9, 2011, at 5:26 PM, Ben Kempe wrote:

&gt; Hi everybody,
&gt; We have JSON data in a Riak 1.0/leveldb bucket with an index createdat\\_int.
&gt; 
&gt; http://localhost:8098/buckets/data/index/createdat\\_int/50000/1320883249
&gt; 
&gt; works, but
&gt; 
&gt; curl -X POST \\
&gt; -H "content-type: application/json" \\
&gt; -d @- \\
&gt; http://localhost:8098/mapred \\
&gt; &lt; {
&gt; "inputs":{
&gt; "bucket":"data",
&gt; "index":"createdat\\_int",
&gt; "start":"50000",
&gt; "end":"1320883249"
&gt; },
&gt; "query":[
&gt; {
&gt; "reduce":{
&gt; "language":"erlang",
&gt; "module":"riak\\_kv\\_mapreduce",
&gt; "function":"reduce\\_identity",
&gt; "keep":true
&gt; }
&gt; }
&gt; ]
&gt; }
&gt; EOF
&gt; 
&gt; fails with the following message:
&gt; 
&gt; {throw,
&gt; {invalid\\_inputdef,
&gt; {index,&lt;&lt;"data"&gt;&gt;,&lt;&lt;"createdat\\_int"&gt;&gt;,50000,
&gt; 1320883249}},
&gt; [{riak\\_client,mapred\\_dynamic\\_inputs\\_stream,4},
&gt; {riak\\_kv\\_wm\\_mapred,legacy\\_mapred,2},
&gt; {webmachine\\_resource,resource\\_call,3},
&gt; {webmachine\\_resource,do,3},
&gt; {webmachine\\_decision\\_core,resource\\_call,1},
&gt; {webmachine\\_decision\\_core,decision,1},
&gt; {webmachine\\_decision\\_core,handle\\_request,2},
&gt; 
&gt; {webmachine\\_mochiweb,loop,1}]}}

---

mochiweb+webmachine web 
&gt; server
&gt; 
&gt; What's the cause for this problem?
&gt; I tried to stay close to the examples in the docs.
&gt; 
&gt; Thanks, Ben
&gt; 

