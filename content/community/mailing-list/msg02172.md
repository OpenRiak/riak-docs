---
title: "Re: Riak Cluster Setup on EC2"
description: ""
project: community
lastmod: 2011-02-02T09:37:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02172"
mailinglist_parent_id: "msg02171"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2011-02-02T09:37:24-08:00
---


Hi Abhishek,

You need to add a period (".") to the end of the statements before they will
execute. Can you try the ping command again?

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Wed, Feb 2, 2011 at 9:32 AM, Abhishek Kona wrote:

&gt; Hi Jon
&gt; Thanks for the quick reply.
&gt;
&gt;
&gt; On 02/02/11 10:33 PM, Jon Meredith wrote:
&gt;
&gt; Hi Abhishek,
&gt;
&gt; It looks like distributed erlang isn't working between the nodes so the
&gt; join fails.
&gt;
&gt; You can test it by bringing the nodes up in console mode and executing
&gt;
&gt; $ riak console
&gt; [some logging status messages]
&gt; Eshell V5.7.5 (abort with ^G)
&gt; (dev2@127.0.0.1)1&gt; net\\_adm:ping('dev1@127.0.0.1').
&gt; pong
&gt; (dev2@127.0.0.1)3&gt; q().
&gt; ok
&gt;
&gt; I do not get a reply for the above :
&gt; Node1
&gt; (riak@10.136.82.27)1&gt; net\\_adm:ping('riak@10.130.149.253')
&gt; (riak@10.136.82.27)1&gt; q()
&gt; Node2
&gt; (riak@10.130.149.253)1&gt; net\\_adm:ping('riak@10.136.82.27')
&gt; (riak@10.130.149.253)1&gt; q()
&gt;
&gt; Any more suggestions.
&gt; --Abhishek Kona
&gt;
&gt;
&gt; Make sure you switch the node names for your own and run the test in both
&gt; directions. If the node is unreachable it will return pang instead of ping.
&gt;
&gt; --Jon
&gt; Senior Software Engineer
&gt; Basho Technologies
&gt;
&gt;
&gt;
&gt; On Wed, Feb 2, 2011 at 9:04 AM, Abhishek Kona wrote:
&gt;
&gt;&gt; On 02/02/11 8:38 PM, Sean Cribbs wrote:
&gt;&gt;
&gt;&gt; Abhishek,
&gt;&gt;
&gt;&gt; First, make sure all of your nodes are in the same security group.
&gt;&gt;
&gt;&gt; Yes, both the machines are on the same security group ( which has only
&gt;&gt; the ports 8098, 8099, 8087).
&gt;&gt;
&gt;&gt; Second, check that your OS doesn't have an additional firewall
&gt;&gt; installed (iptables, for example).
&gt;&gt;
&gt;&gt; I can telnet into the Riak ports from each of the machines, so firewall
&gt;&gt; does not seem to be the issue.
&gt;&gt;
&gt;&gt; Third, you might consider doing what the Chef recipe for Riak does and
&gt;&gt; limit the ports that Erlang uses for distributed communication. Adding a
&gt;&gt; section to app.config like the below will limit the port range:
&gt;&gt;
&gt;&gt; {kernel, [
&gt;&gt; {inet\\_dist\\_listen\\_min, 6000},
&gt;&gt; {inet\\_dist\\_listen\\_max, 7999}
&gt;&gt; ]}
&gt;&gt;
&gt;&gt; You'll need to stop Riak, kill the "epmd" process, and then start Riak up
&gt;&gt; again for this change to take effect. Make sure those ports are also open
&gt;&gt; in your security group and any software firewall you have.
&gt;&gt;
&gt;&gt; Tried with these changes as well, but still get the same message.
&gt;&gt; Anything else, I can try?.
&gt;&gt; Thanks for the help.
&gt;&gt;
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;&gt; On Feb 2, 2011, at 8:47 AM, Abhishek Kona wrote:
&gt;&gt;
&gt;&gt; Hi folks
&gt;&gt;
&gt;&gt; I am trying to set up a Riak cluster on EC2.
&gt;&gt; Each time I issue a command :
&gt;&gt;
&gt;&gt; $ sudo riak-admin join riak@10.130.149.253
&gt;&gt;
&gt;&gt; It fails :
&gt;&gt;
&gt;&gt; Attempting to restart script through sudo -u riak
&gt;&gt;
&gt;&gt; Node riak@10.130.149.253 is not reachable!
&gt;&gt;
&gt;&gt;
&gt;&gt; Netstat on both the machines says the ports are running fine.
&gt;&gt;
&gt;&gt; netstat -na | egrep '(8087|8098|8099)'
&gt;&gt;
&gt;&gt; tcp 0 0 0.0.0.0:8098 0.0.0.0:\\*
&gt;&gt; LISTEN
&gt;&gt;
&gt;&gt; tcp 0 0 0.0.0.0:8099 0.0.0.0:\\*
&gt;&gt; LISTEN
&gt;&gt;
&gt;&gt; tcp 0 0 0.0.0.0:8087 0.0.0.0:\\*
&gt;&gt; LISTEN
&gt;&gt;
&gt;&gt;
&gt;&gt; I can telnet to all the ports from each of the machine.
&gt;&gt; I have been pulling my hair for long but of no avail.
&gt;&gt; Can any one look and tell me what I am doing wrong.
&gt;&gt; Are there any debug logs where I can look at what is going wrong?
&gt;&gt; Is there any EC2 specific trick (like using public hostnames).
&gt;&gt;
&gt;&gt; I am attaching my app.cfg file for reference.
&gt;&gt;
&gt;&gt; Thanks
&gt;&gt; -Abhishek Kona
&gt;
&gt;

