---
title: "Re: riak java client"
description: ""
project: community
lastmod: 2011-11-16T09:23:08-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05601"
mailinglist_parent_id: "msg05600"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-11-16T09:23:08-08:00
---

On 16 Nov 2011, at 16:13, sergey wrote:

&gt; Thanks Russell,
&gt; ok,
&gt; I useDefaultRiakClient ( userName = "user1", userInfo = 
&gt; "{"email":"em...@email.com","pass":"123123"}" ):
&gt; riakObject = RiakObjectBuilder.newBuilder("users", 
&gt; userName).withContentType("application/json").withValue(userInfo).build
&gt; and store:
&gt; client.fetchBucket("users").execute.store(riakObject).execute
&gt; in result I have in store:
&gt; Content Type application/json;charset=UTF-8
&gt; but value as: 
&gt; {"value":"eyJlbWFpbCI6ImVtYWlsQGVtYWlsLmNvbSIsInBhc3MiOiIxMjMxMjMifQ==","lastModified":null,"contentType":"application/json;charset=utf-8","bucket":"users","vtag":null,"links":[],"vclock":null,"valueAsString":"{\\"email\\":\\"em...@email.com\\",\\"pass\\":\\"123123\\"}","vclockAsString":null,"meta":{}}
&gt; 
&gt; how to make value just as {"email":"em...@email.com","pass":"123123"}?

OK, long explanation below. You've uncovered a wart.

By default every store and fetch operation requires a Converter to be 
present. And, to make life easy, by default, I provide the JSONConverter, 
that converts the object it is given to JSON. This is a problem if you use the 
raw IRiakObject type since the whole thing gets serialised, rather than just 
the values. The fix, which I have, is to check the type, and if it is 
IRiakObject then don't use the converter. The longer term fix is to have a 
registry of converters mapped to types, but that is not done yet.

The problem really is that the higher level API expects you to store domain 
things, not lower level, Riak things.

I know this seems bad, but I wanted an API that gave a flexibility \\*and\\* pushed 
people towards using domain specific classes, since handling conflicts requires 
that. It does mean there is this slightly more verbose hoop to jump through 
when you want to use a plain IRiakObject from the higher level client API.

TL;DR 
Store a domain specific java object with two fields, `email` and `pass` OR 
provide a PassThroughConverter to the StoreOperation OR if you are dealing 
directly with IRiakObject, use RawClient. I'm working on a silent solution that 
detects the IRiakObject type and does not convert it.

Does it make sense?

Cheers

Russell

&gt; 
&gt; 
