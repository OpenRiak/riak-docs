---
title: "Re: loading erlang terms"
description: ""
project: community
lastmod: 2010-11-11T18:20:54-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01525"
mailinglist_parent_id: "msg01396"
author_name: "Scott Lystig Fritchie"
project_section: "mailinglistitem"
sent_date: 2010-11-11T18:20:54-08:00
---


Catching up(\\*) on a thread from the end of October (nothing like being
prompt, is there?)...

Charles Blair  wrote:

cb&gt; Thanks for spotting the "brainos". But even without those, here is a
cb&gt; repeat of the experiment.

Assuming that these code snippets demonstrate what you're trying to do,
then I have a "Doctor, it hurts when I do this" answer.

 OaiTerm = 
{oai\\_dc,"AEP-WYS97",{{2004,10,28},{17,21,25}},["aep"],"/storage/aep2003/metadata/oai\\_dc/oai\\_dc-AEP-WYS97.xml"}.
 f(C).
 {ok, C} = riak:local\\_client(). 
 C:put(riak\\_object:new(&lt;&lt;"oai\\_test"&gt;&gt;, &lt;&lt;"SLF"&gt;&gt;, &lt;&lt;"Here is a binary 
value"&gt;&gt;)).
 C:put(riak\\_object:new(&lt;&lt;"oai\\_test"&gt;&gt;, &lt;&lt;"AEP-WYS97"&gt;&gt;, OaiTerm)).
 C:get(&lt;&lt;"oai\\_test"&gt;&gt;, &lt;&lt;"SLF"&gt;&gt;). 
 C:get(&lt;&lt;"oai\\_test"&gt;&gt;, &lt;&lt;"AEP-WYS97"&gt;&gt;).

Both of the puts via the Erlang client will work, and both of the gets
work just fine.

 f(Pid).
 {ok,Pid} = riakc\\_pb\\_socket:start\\_link("localhost", 8087).
 riakc\\_pb\\_socket:get(Pid, &lt;&lt;"oai\\_test"&gt;&gt;, &lt;&lt;"SLF"&gt;&gt;).

... and that works, ...

 riakc\\_pb\\_socket:get(Pid, &lt;&lt;"oai\\_test"&gt;&gt;,&lt;&lt;"AEP-WYS97"&gt;&gt;).

... and that fails with a closed TCP connection.

The value associated with the &lt;&lt;"AEP-WYS97"&gt;&gt; key is an Erlang term,
specifially a tuple. The Protocol Buffers interface doesn't know how to
encode Erlang tuples, so it crashes the process on the server side
that's responsible for decoding & encoding traffic on the socket.

If the value that you put() is converted to a binary via
term\\_to\\_binary(), you'll have no problem retrieving it via the Protocol
Buffers interface ... but you'll have to use binary\\_to\\_term() to get
your original record back.

-Scott

(\\*) So much time has gone by that you're probably already figured this
out. I figured the list's archives ought to have an answer. And if
Charles didn't have an answer from someplace else, hopefully he returns
tomorrow from holiday in Tahiti to read this very-prompt-seeming
message.

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

