---
title: "Re: Is Riak a good solution for this problem?"
description: ""
project: community
lastmod: 2012-02-12T12:37:32-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06587"
mailinglist_parent_id: "msg06584"
author_name: "Steve Song"
project_section: "mailinglistitem"
sent_date: 2012-02-12T12:37:32-08:00
---


Hi Marco,

I'm also new to riak and in the middle researching whether riak makes sense
for a new project I'm working on.

Here are my thoughts based on what I've read so far:
 - Riak can be pretty fast, but their game is more about rock solid
stability rather than raw performance
 - you're going to want a 3-node+ cluster; you'd want multiple nodes for
any m/r setup anyway
 - Riak won't be super great for ad-hoc queries so I'm assuming that we're
talking about a canned daily report
 - your schema needs to match your query patterns; a 2i of date, query by
specific date then group by session; if you're doing this as described w/o
a 2i date filter first, you'll be going through page view data for the past
which presumably won't change after you've processed it
 - m/r using protocol buffers can be significantly faster than using HTTP
so try again with a client that uses pb
 - once you have multiple nodes set up, do\\_prereduce will split the load of
reducing across the nodes; i think this would definitely be useful if
you're data reduces well per node like: for day d, x registered user page
views, y unregistered user page views
 - updating shouldn't be a problem as long as it isn't hard for you to
resolve collisions; if there's a collision you have to decide on the
strategy for resolution; since this is log data and not something that
requires transactions, that shouldn't be a problem

Some links that I've found useful:
http://joyeur.com/2010/10/31/riak-smartmachine-benchmark-the-technical-details/
(especially the comment)
http://devblog.seomoz.org/2011/10/using-riak-for-ranking-collection/
http://inakanetworks.com/blog/2011/08/25/when-to-use-riak/

Basho Vimeo channel has a pile of informative videos where you'll find good
nuggets here and there: http://vimeo.com/17604126

Hope that helps,
Steve

On Sun, Feb 12, 2012 at 9:00 AM,  wrote:

&gt; Message: 1
&gt; Date: Sun, 12 Feb 2012 11:27:22 +0000
&gt; From: Marco Monteiro 
&gt; To: riak-users@lists.basho.com
&gt; Subject: Is Riak a good solution for this problem?
&gt;
&gt; Hello!
&gt;
&gt; I'm considering Riak for the statistics of a site that is approaching a
&gt; billion page views per month.
&gt; The plan is to log a little information about each the page view and then
&gt; to query that data.
&gt;
&gt; I'm very new to Riak. I've gone over the documentation on the wiki, and I
&gt; know about map-reduce,
&gt; secondary indexes and Riak search. I've installed Riak on a single node and
&gt; made a test with the
&gt; default configuration. The results were a little bellow what I expected.
&gt; For the test is used the following
&gt; requirement.
&gt;
&gt; We want the page view count by day for registered and unregistered users.
&gt; We are storing session
&gt; documents. Each document has a session identifier as it's key and a list of
&gt; page views as the value
&gt; (and a few additional properties we can ignore). This document structure
&gt; comes from CouchDB,
&gt; where I organised things like this to be able to more easily query the
&gt; database. I've done a basic
&gt; javascript map-reduce query for this. I just map over each session (every
&gt; k/v in a bucket) returning
&gt; the length of the page views array for either the registered or
&gt; unregistered field (the other is zero), and
&gt; the day of the request. In the reduce I collect them by hashing the day and
&gt; summing the two number
&gt; of page views. Then I have a second reduce to sort the list by day.
&gt;
&gt; This is very slow on a single machine setup with default Riak
&gt; configuration. 1.000 sessions takes
&gt; 6 seconds. 10.000 sessions takes more that 2 minutes (timeout). We want to
&gt; handle 10.000.000
&gt; sessions, at least. Is there a way, maybe with secondary indexes, to make
&gt; this go faster using only Riak?
&gt; Or must I use some kind of persistent cache to store this info as time goes
&gt; by? Or can I make Riak
&gt; run 100 times faster by tweaking the config? I don't want to have 1000
&gt; machines for making this work.
&gt;
&gt; Also, will updating the session documents be a problem for Riak? Would it
&gt; be better to store each
&gt; page hit under a new key, to not update the the session document. Because
&gt; of the "multilevel" map
&gt; reduce this ca work on Riak, where it didn't work on CouchDB, because its
&gt; view system limitation.
&gt; Unfortunately, with the update of documents the CouchDB database was
&gt; growing way too fast for it
&gt; to be a feasible solution.
&gt;
&gt;
&gt; Any advice to make Riak work for this problem is greatly appreciated.
&gt;
&gt; Thanks,
&gt; Marco
&gt; -------------- next part --------------
&gt; An HTML attachment was scrubbed...
&gt; URL: &lt;
&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/attachments/20120212/10c8fc3d/attachment-0001.html
&gt; &gt;
&gt;
&gt; ------------------------------
&gt;
 End of riak-users Digest, Vol 31, Issue 16
&gt; \\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*
&gt;

-- 
facebook: http://facebook.com/picturebookApp
twitter: http://twitter.com/maplekey
blog: http://maplekeycompany.blogspot.com/
site: http://www.maplekeycompany.com/mobile/
