---
title: "Re: Riak Bitcask merging"
description: ""
project: community
lastmod: 2011-08-22T10:19:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04405"
mailinglist_parent_id: "msg04404"
author_name: "Anthony Molinaro"
project_section: "mailinglistitem"
sent_date: 2011-08-22T10:19:11-07:00
---


While I didn't ask this time, I'll explain why I think manual
merging as an option would be great.

As far as I know specifying a merge window doesn't guarantee the
merging happens, only that it might if other thresholds are met.

With our cassandra cluster we've ended up scheduling twice weekly
full compactions (the close equivalent to merging I believe), via
cron. The days and times are specificaly chosen based on traffic
patterns, and can be changed without restarting the servers.

We don't have this convenience with riak. We can set it up to only
merge during a window, but can't guarantee everything was merged
or even that any merges will occur. If I wanted to change when I
do the merging, I have to restart the servers to pick up the new
config (at least I think I would). I have no way to stagger the
merging (have different nodes merge at different times), unless
I have slightly different config on each node.

If there were a riak-admin command called merge/compact/cleanup/expire
or something which triggered a manual merge I know we would use it.

And while I'm pining for additional command line tools, any idea if
transfers will ever work without disrupting the actual transfers?
It's sort of annoying that it's listed as one of the steps for a
rolling upgrade/restart but if you actually use it, it can cause
upgrade or startup to take longer. Also, it tends to timeout on
a highly trafficked cluster.

Anyway, sorry about hijacking someone else's question, but
figured more information from users is usually welcome?

-Anthony

On Mon, Aug 22, 2011 at 09:14:06AM -0700, Dan Reverri wrote:
&gt; There is no way to manually trigger a Bticask merge. What's the use case for
&gt; needing to manually trigger the merge? Are you concerned about the size of
&gt; the data files? Are you trying to avoid merging at a particular time?
&gt; 
&gt; Not sure if this will help but you can restrict Bitcask merging to a
&gt; specified window of time:
&gt; http://wiki.basho.com/Bitcask-Configuration.html#Merge-Window
&gt; 
&gt; Thanks,
&gt; Dan
&gt; 
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt; 
&gt; 
&gt; On Sun, Aug 21, 2011 at 11:36 PM, raghwani sohil wrote:
&gt; 
&gt; &gt;
&gt; &gt; Hi All,
&gt; &gt;
&gt; &gt; Is there any way to run bitcask merging process manually ?
&gt; &gt;
&gt; &gt; thanks ,
&gt; &gt; Sohil Raghwani .
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;

-- 
------------------------------------------------------------------------
Anthony Molinaro 

