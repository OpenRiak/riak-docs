---
title: "removing stale members from the ring was: Re: Questions about ring	state management."
description: ""
project: community
lastmod: 2010-11-01T07:01:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01433"
mailinglist_parent_id: "msg00862"
author_name: "Gernot Ullrich"
project_section: "mailinglistitem"
sent_date: 2010-11-01T07:01:05-07:00
---

I've got a similar problem:
riak\\_admin status lists some ring-members, that are no longer available 
at all. How can I get rid of those listings?
the procedure given below does not make any changes. And 'riak-admin 
leave' does not work in this case, because the nodes are no longer 
available.


Best regards
Gernot Ullrich
mylugo GmbH

Hi Mark,

The option "default\\_gossip\\_seed" is not a Riak option; at least not 
one I have seen. You are correct that it does not appear in the Riak 
source code. If this was an option it has been removed.


To form a Riak cluster you must tell a node about another node in the 
cluster using the "riak-admin join" command. A node only needs to be 
told about one other node in a cluster; Riak learns about other 
cluster nodes via gossip.The seeding process would look as follows:

riak start
riak-admin join ot...@node


Currently, removing a node must be done via Erlang. Bug 571 has been 
filed to request a "remove" command:

https://issues.basho.com/show\\_bug.cgi?id=571

Removing a node via Erlang:
1. Attach to a riak node
riak attach
2. Get a local client
{ok, C} = riak:local\\_client().

3. Remove the node
C:remove\\_from\\_cluster('n...@host').

4 Detach from the node using CTRL+D
^D

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com 


On Tue, Aug 3, 2010 at 9:58 AM, Mark Anderson &gt; wrote:


 I'm playing around with setting up and tearing down clusters and I had
 a few questions:

 Looking at the chef recipe for riak sets an option in riak\\_core
 'default\\_gossip\\_seed'; apparently this is intended to cue a newly spun
 up node where to look to join the cluster. But for the life of me I
 can't get it to work, and I can't find any mention of it in the
 source.
 What's the recommended way to seed a freshly spun up node with a
 seed machine?

 I'm also trying to figure out how to evict a node from the ring. If
 you have access to the machine, you can do 'riak-admin leave' but what
 can you do if you don't? I'm imagining a usage pattern where you are
 running a bunch of vhosted machines. One dies, and you spin up a new
 machine, with a new node name to replace it. How do you get that old
 machine out of the ring?

 The natural way to name nodes in ec2 is to do something like
 r...@ec2\\_internal\\_ip. But once an instance is terminated, there is no
 way to get that ip back. I suspect I'm doing things wrong here, so
 suggestions for better configuration patterns are very welcome.

--
Dr. Gernot Ullrich | Softwarearchitekt | mylugo GmbH |
Erdmannstr. 10-12, 22765 Hamburg |
Tel.: +49 40 41 91 26 22 | Fax: +49 40 41 91 26 23 |
Mobil: +49 162 985 1582
Mail: gernot.ullr...@mylugo.de
Web: www.mylugo.de
Handelsregistereintrag: Amtsgericht Hamburg, HRB 104 354

Disclaimer:
Internet und E-Mail sind vielen Kommunikationsformen weit überlegen.
mylugo steht auch hier für sorgfältigen Umgang mit Informationen nach
dem aktuellen Stand der Technik. Bedenken Sie aber, dass Leitungswege
und Provider weder in Ihrem, noch im Einflußbereich von mylugo stehen.
mylugo kann daher keine Haftung für die Verbindlichkeit von Inhalten,
den Schutz vor weiterer Übertragung und ungewolltem Empfang, sowie
Schäden durch Speicherung und Verwendung von Informationen übernehmen.
Der Inhalt dieser E-Mail ist vertraulich und ausschließlich für den
bezeichneten Adressaten bestimmt. Wenn Sie nicht der vorgesehene
Adressat dieser E-Mail oder dessen Vertreter sind, beachten Sie bitte,
dass jede Form der Kenntnisnahme, Veröffentlichung, Vervielfältigung
oder Weitergabe des Inhalts dieser E-Mail unzulässig ist. Wir bitten
Sie, sich in diesem Fall mit dem Absender der E-Mail in Verbindung zu
setzen.

The information in this e-mail is confidential. The contents may not be
disclosed or used by anyone other then the addressee. Access to this
e-mail by anyone else is unauthorised. If you are not the intended
recipient, please notify mylugo immediately and delete this e-mail.
mylugo cannot accept any responsibility for the accuracy or completeness
of this e-mail as it has been sent over public networks. If you have any
concerns over the content of this message or its Accuracy or Integrity,
please contact mylugo immediately.
All outgoing e-mails from mylugo are checked using regularly updated
virus scanning software but you should take whatever measures you deem
to be appropriate to ensure that this message and any attachments are
virus free.
