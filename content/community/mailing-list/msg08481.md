---
title: "Re: Strategies for testing against Riak"
description: ""
project: community
lastmod: 2012-09-08T15:42:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08481"
mailinglist_parent_id: "msg08467"
author_name: "Brad Heller"
project_section: "mailinglistitem"
sent_date: 2012-09-08T15:42:27-07:00
---


Hey Sean,

Thanks for the suggestion. I've spent a few hours trying to get this up and 
running and I'm having a bit of a hard time. Is there any documentation around 
Riak::TestServer?

What are the configuration values for :source and :root supposed to be exactly? 
As I understand it, :root should be something like /path/to/riak/bin and source 
should be something like /path/to/riak. Is that correct? Also, how does Riak:: 
TestServer#create behave exactly?

In our dev environments we have a Riak configuration that includes config files 
and binaries that our dev's can just git clone so they can get started quickly. 
It is very similar to what the following docs outline only with three nodes 
instead of one: https://wiki.basho.com/Building-a-Development-Environment.html

What I'd really like to set up is a way for Riak::TestServer to use the same 
binaries as our dev riak config, but a different configuration (app.config, 
vm.args, etc.). Is this possible? Alternatively, we could stick a copy of the 
Riak binaries directly in the repo that is using Ripple to make it a bit more 
standalone.

What is the configuration you were anticipating when you wrote the 
Riak::TestServer class?

Thanks,
Brad Heller

On Sep 7, 2012, at 5:02 AM, Sean Cribbs  wrote:

&gt; If it's only for your test suite, use a local memory-only node via the
&gt; Ripple::TestServer. If you configure it correctly (there's a bundled
&gt; Rails generator that helps), it will delete all the contents of Riak
&gt; in one fell-swoop after or before each test/example.
&gt; 
&gt; On Fri, Sep 7, 2012 at 2:49 AM, Brad Heller  wrote:
&gt;&gt; Hey all,
&gt;&gt; 
&gt;&gt; So we're rolling out Riak more and more and so far, so good. In fact we're
&gt;&gt; starting to accumulate a pretty sizable test suite of our data access layer.
&gt;&gt; To support this we've written some code that helps clean out buckets between
&gt;&gt; test runs. We're using Ruby (ripple + ruby-risk-client, obviously) so we
&gt;&gt; just monkey patch the bucket object and detect if it was used or not.
&gt;&gt; 
&gt;&gt; If it was used during a test, we iterate over all the keys and delete each
&gt;&gt; one. We're cognizant of the risks in doing this for large clusters, but in
&gt;&gt; our test enviro the number of documents per test is pretty small and the
&gt;&gt; operations themselves are quite fast.
&gt;&gt; 
&gt;&gt; The problem we're having, though, is that when we run the full suite (or a
&gt;&gt; large subset of the suite) all at once the churn in Riak seems to be so
&gt;&gt; quick that sometimes Riak isn't quite in the state that we expect it to be
&gt;&gt; in when the test runs! For instance, we have a test that checks that the
&gt;&gt; right number of linked documents are created when a given object is saved.
&gt;&gt; If we run the test by itself everything works fine--the expectation that 10
&gt;&gt; documents are created indeed checks out. If we run this test as part of a
&gt;&gt; large suite of tests, the expectation fails and sometimes 11 documents or 12
&gt;&gt; documents appear (we check by counting the keys in the linked bucket).
&gt;&gt; 
&gt;&gt; I would think that this has something to do with Riak's eventually
&gt;&gt; consistent delete operation, but wanted to tap in to the brain trust: Is
&gt;&gt; there any tuning we can do in test to prevent this?
&gt;&gt; 
&gt;&gt; Thanks,
&gt;&gt; 
&gt;&gt; Brad Heller | Engineering Lead | Cloudability.com | 541-231-1514 | Skype:
&gt;&gt; brad.heller | @bradhe | @cloudability
&gt;&gt; 
&gt;&gt; We're hiring! http://cloudability.com/jobs
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sean Cribbs 
&gt; Software Engineer
&gt; Basho Technologies, Inc.
&gt; http://basho.com/

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

