---
title: "Re: MapReduce filtering question"
description: ""
project: community
lastmod: 2010-11-20T05:38:50-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01583"
mailinglist_parent_id: "msg01582"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-11-20T05:38:50-08:00
---

On Nov 19, 2010, at 11:54 PM, Parker Thompson wrote:

&gt; Thanks, a few questions inline...
&gt; 

Responses inline.

&gt; On Fri, Nov 19, 2010 at 2:43 PM, Sean Cribbs  wrote:
&gt; 
&gt; class Riak::Alternative
&gt; include Ripple::Document
&gt; many :visitors, :class\\_name =&gt; "Riak::Visitor"
&gt; property :alternative\\_id, Integer, :presence =&gt; true
&gt; key\\_on :alternative\\_id
&gt; end
&gt; 
&gt; If I expect to be writing large numbers of visitor-&gt;alternatives links is it 
&gt; performant to be writing them all as links on one object, as opposed to 
&gt; creating many experience docs each with a link ? Na√Øvely I would assume this 
&gt; might less evenly distribute write load or degrade as the size of the Link 
&gt; data grows. Does this matter?

You either take the hit at write time or at query time. Personally, I think 
this is easier to understand and manage, but it may also depend on what other 
queries you want to run. For example, if your other queries are more focused 
on the individual visitor, it might make sense to have a list of 
alternative\\_ids in the Visitor class, instead of having something (experience 
or alternative) link to it. The key takeaway I'm trying to lead you to is that 
data types that are effectively "joins" are less efficient/useful in Riak.

&gt; 
&gt; ########
&gt; 
&gt; def visitors\\_who\\_shared
&gt; Riak::MapReduce.new(Ripple.client).
&gt; add("riak\\_alternatives", ar\\_id.to\\_s).
&gt; link(:bucket =&gt; 'riak\\_visitors').
&gt; map(link\\_to\\_events\\_forward\\_visitor).
&gt; map(map\\_share\\_events\\_to\\_visitor).
&gt; reduce(["riak\\_kv\\_mapreduce", "reduce\\_set\\_union"]).
&gt; map(map\\_identity, :keep =&gt; true).
&gt; run
&gt; end
&gt; 
&gt; Ah, I was looking for a set\\_union. Is there a full list of these functions 
&gt; hiding somewhere?
&gt; 

Our community manager has some better documentation in the oven, but there are 
a number of them in these two files:

(JS) https://github.com/basho/riak\\_kv/blob/master/priv/mapred\\_builtins.js
(Erlang) 
https://github.com/basho/riak\\_kv/blob/d4c6930d97fb109f9dcb3c73a99747ca217275c7/src/riak\\_kv\\_mapreduce.erl

Cheers,

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/
