---
title: "Re: Storing as erlang-binary/term, reading as json."
description: ""
project: community
lastmod: 2011-08-11T13:32:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04351"
mailinglist_parent_id: "msg04349"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-08-11T13:32:40-07:00
---


I believe the Accept parameter is intended only for the ability to list
riak-native data. So to get riak parameters back as json, that's when you
specify the Accept header.
Regarding objects that you store it Riak, my experience has been that it
returns the data back as you stored it. So based on the type that you
specify when posting/putting the data, is the content type that you get
back.

If I'm wrong, hopefully someone will correct me shortly :-)


\\*Jonathan Langevin
Systems Administrator
Loom Inc.
Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
www.loomlearning.com - Skype: intel352\\*

On Thu, Aug 11, 2011 at 12:03 PM, Fyodor Yarochkin wrote:

&gt; Greetings,
&gt; I am probably missing something obvious, but I've been playing with
&gt; it for a couple of days, still can't figure out the consistency and I
&gt; am still a little lost with riak source code so I thought I'd drop a
&gt; line here:
&gt;
&gt; I am experimenting with querying riak data data in different mime
&gt; formats from riak cluster. So for the tests, I am having a piece of
&gt; erlang code, which uses riak-erlang-client, writes some data into riak
&gt; as erlang-binary.
&gt;
&gt; Object = riakc\\_obj:new(&lt;&lt;"test"&gt;&gt;,
&gt; test\\_util:get\\_datekey(),{struct, [{field, Value}]}),
&gt; riakc\\_pb\\_socket:put(RiakPid, Object),
&gt;
&gt; Now I am trying to make the data to be accessible to non-erlang
&gt; clients so the node.js code (for example) would be able to read it as
&gt; json.
&gt;
&gt; My understanding is that I should be able to specify that I want
&gt; json-formatted data back by adding 'Accept: application/json' header
&gt; (per example here http://wiki.basho.com/HTTP-List-Resources.html)
&gt;
&gt; However I am getting HTTP 406 whenever I am trying to query anything
&gt; but erlang-binary:
&gt;
&gt; srv# curl -i 'http://localhost:8098/riak/test/2011811234248'
&gt; HTTP/1.1 200 OK
&gt; X-Riak-Vclock: a85hYGBgymDKBVIsLC6FEzKYEhnzWBkyincc54MIszUnMfB8v4wskQUA
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt; Link: ; rel="up"
&gt; Last-Modified: Thu, 11 Aug 2011 15:38:16 GMT
&gt; ETag: "6iDf0EKIk76L1KxlXoSB29"
&gt; Date: Thu, 11 Aug 2011 15:33:41 GMT
&gt; Content-Type: application/x-erlang-binary
&gt; Content-Length: 565
&gt;
&gt;
&gt; However, for application/json
&gt;
&gt; srv# curl -H 'Accept: application/json' -i
&gt; 'http://localhost:8098/riak/test/2011811234248'
&gt; HTTP/1.1 406 Not Acceptable
&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt; Date: Thu, 11 Aug 2011 15:34:12 GMT
&gt; Content-Length: 0
&gt;
&gt;
&gt; So, should I store the data as 'json' (json string converted to erlang
&gt; binary) in order to have some uniform data format accessible to erlang
&gt; and non-erlang clients?
&gt; also, how do map-reduce functions work in this case, do they have to
&gt; be strictly erlang in the case of having x-erlang-binary, or the data
&gt; could be converted to json for javascript?
&gt;
&gt; thanks,
&gt; -Fyodor
&gt;

