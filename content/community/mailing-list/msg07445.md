---
title: "Re: issue on riak bulk loading---taking huge time"
description: ""
project: community
lastmod: 2012-05-14T01:00:56-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07445"
mailinglist_parent_id: "msg07444"
author_name: "Mathias Meyer"
project_section: "mailinglistitem"
sent_date: 2012-05-14T01:00:56-07:00
---


Hey Sangeetha,

at first sight, what strikes me as odd about your bulk import is that it shells 
out to curl. That has a significant impact on the time it takes to load the 
data into Riak. As a first means to improve script and performance, I'd 
recommend looking into using the Riak Erlang client instead [1]. Alternatively 
you could also run the Erlang code in the context of a locally running Riak and 
use riak:local\\_client() [2].

Cheers, Mathias
http://riakhandbook.com

[1] https://github.com/basho/riak-erlang-client
[2] https://github.com/basho/riak\\_kv/blob/master/src/riak\\_client.erl

On Monday, 14. May 2012 at 07:33, sangeetha.pattabiram...@cognizant.com wrote:

&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; From: Pattabi Raman, Sangeetha (Cognizant) 
&gt; Sent: Thursday, May 10, 2012 3:25 PM
&gt; To: riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; Subject: issue on riak bulk loading---taking huge time
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Dear team,
&gt; 
&gt; 
&gt; 
&gt; 
&gt; FYI:we have a 4 quad core intel processor on each server on 2 node cluster 
&gt; with more than 1 TB of storage
&gt; 
&gt; 
&gt; I Ihave constructed the 2 node physical machine riak cluster with n\\_val 2 and 
&gt; my app.config ,vm.args are attached for your reference..
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Please tell me where the bulk inserted data onto riak db gets stored on Local 
&gt; file system…its taking huge time to load small size itself…how to tune it to 
&gt; perform to large scale since we deal wit hbigdata of in few hungred 
&gt; GB’s?????????????????
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Cmd used:time ./load\\_data1m Customercalls1m.csv
&gt; 
&gt; 
&gt; 
&gt; 
&gt; ./load\\_data100m CustomerCalls100m(got this error so changed default config of 
&gt; app.config…from 8 MB to 3072 MB
&gt; 
&gt; 
&gt; escript: exception error: no match of right hand side value {error,enoent}
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; size
&gt; 
&gt; 
&gt; 
&gt; Load time 
&gt; 
&gt; 
&gt; 
&gt; No of mappersonapp.config
&gt; 
&gt; 
&gt; 
&gt; Js-max-vm-mem on app.config
&gt; 
&gt; 
&gt; 
&gt; Js-thread-stack
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 100k(10,lakhrows)—5 MB
&gt; 
&gt; 
&gt; 
&gt; 20m39.625 seconds
&gt; 
&gt; 
&gt; 
&gt; 48
&gt; 
&gt; 
&gt; 
&gt; 3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)
&gt; 
&gt; 
&gt; 
&gt; 3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 1millionrows---54 MB 
&gt; 
&gt; 
&gt; 
&gt; 198m42.375seconds
&gt; 
&gt; 
&gt; 
&gt; 48
&gt; 
&gt; 
&gt; 
&gt; 3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)
&gt; 
&gt; 
&gt; 
&gt; 3 GB 3072MB(changedfromdefault 8MB)since i/p data is large)
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; .
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; ./load\\_data script used:
&gt; 
&gt; 
&gt; 
&gt; 
&gt; #!/usr/local/bin/escript
&gt; 
&gt; 
&gt; main([Filename]) -&gt;
&gt; 
&gt; 
&gt; {ok, Data} = file:read\\_file(Filename),
&gt; 
&gt; 
&gt; Lines = tl(re:split(Data, "\\r?\\n", [{return, binary},trim])),
&gt; 
&gt; 
&gt; lists:foreach(fun(L) -&gt; LS = re:split(L, ","), format\\_and\\_insert(LS) end, 
&gt; Lines).
&gt; 
&gt; 
&gt; 
&gt; 
&gt; format\\_and\\_insert(Line) -&gt;
&gt; 
&gt; 
&gt; JSON = 
&gt; io\\_lib:format("{\\"id\\":\\"~s\\",\\"phonenumber\\":~s,\\"callednumber\\":~s,\\"starttime\\":~s,\\"endtime\\":~s,\\"status\\":~s}",
&gt; Line),
&gt; 
&gt; 
&gt; Command = io\\_lib:format("curl -X PUT 
&gt; http://10.232.5.169:8098/riak/CustomerCalls100k/~s -d '~s' -H 'content-type: 
&gt; application/json'", [hd(Line),JSON]),
&gt; 
&gt; 
&gt; io:format("Inserting: ~s~n", [hd(Line)]),
&gt; 
&gt; 
&gt; os:cmd(Command).
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Thanks in advance!!!!!!!!!!waiting fr the reply…plz anyone help..struck u 
&gt; pwit hbulk loading…..and make me clear how riak splits the data and gets 
&gt; loaded on cluster
&gt; 
&gt; 
&gt; Thanks & regards
&gt; 
&gt; 
&gt; sangeetha
&gt; 
&gt; 
&gt; 
&gt; 
&gt; This e-mail and any files transmitted with it are for the sole use of the 
&gt; intended recipient(s) and may contain confidential and privileged 
&gt; information. If you are not the intended recipient(s), please reply to the 
&gt; sender and destroy all copies of the original message. Any unauthorized 
&gt; review, use, disclosure, dissemination, forwarding, printing or copying of 
&gt; this email, and/or any action taken in reliance on the contents of this 
&gt; e-mail is strictly prohibited and may be unlawful.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 
&gt; Attachments: 
&gt; - app.config.txt
&gt; 
&gt; - vm.args.txt
&gt; 
