---
title: "Re: riak_core questions"
description: ""
project: community
lastmod: 2011-07-28T09:22:09-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04113"
mailinglist_parent_id: "msg04109"
author_name: "Dmitry Demeshchuk"
project_section: "mailinglistitem"
sent_date: 2011-07-28T09:22:09-07:00
---


Hi, Justin.

Unfortunately, the application should behave like that, though I don't
like it myself. During any outage, we should be completely sure that
all the vnodes are up, and we cannot use any kind of replication in
our case. It is just the way to ensure that we don't access the same
resource at the same time from different nodes, while being able to
access any resource, even when some nodes are down.

And in case of any partitions, that are much less likely to happen,
we'll just shut down all the lesser partitions, while only the largest
one will remain running, until the outage is resolved manually.

By master node, I mean the one that is used when we are joining new
nodes using riak-admin (as far as I remember, only one node can be
used for this). I believe, it's the one that is is returned by
riak\\_core\\_ring:owner\\_node/1.
Maybe, I'm wrong and when we call riak\\_core\\_gossip:send\\_ring(RingNode,
node()), we can use any node from the cluster
as RingNode?

Thank you.

On Thu, Jul 28, 2011 at 5:20 PM, Justin Sheehy  wrote:
&gt; Hi, Dmitry.
&gt;
&gt; A couple of suggestions...
&gt;
&gt; The reason that you're not seeing an easy way to automatically have nodes be 
&gt; added or removed from the cluster upon going down or coming up is that we 
&gt; recommend strongly against such behavior.
&gt;
&gt; The idea is that intentional (administrative) outages are very different in 
&gt; nature from unintentional and potentially transitory outages. We have 
&gt; explicit administrative commands such as "join" and "leave" for the 
&gt; administrative cases, making it very easy to add or remove hosts to a 
&gt; cluster. When a node is unreachable, you often can't automatically tell 
&gt; whether it is a host problem or a network problem and can't automatically 
&gt; tell if it is a long-term or short-term outage. This is why mechanisms such 
&gt; as quorums and hinted handoff exist: to ensure proper operation of the 
&gt; cluster as a whole throughout such outages. Consider the case where you have 
&gt; a network problem such that several of your nodes lose visibility to each 
&gt; other for brief and distinct periods of time. If nodes are auto-added and 
&gt; auto-removed then you will have quite a bit of churn and potentially a very 
&gt; harmful feedback scenario. Instead of auto-adding and auto-removing, consider 
&gt; using things like
&gt; riak\\_core\\_node\\_watcher to decide which nodes to interact with on a 
&gt; per-operation basis.
&gt;
&gt; I'm also not sure what you mean by "if the master node goes down" since in 
&gt; most riak\\_core applications there is no master node. Of course you can create 
&gt; such a mechanism if you need it, but (e.g.) Riak KV and the accompanying 
&gt; applications do not have any notion of a master node and thus do not have any 
&gt; such concern.
&gt;
&gt; I hope that this is useful.
&gt;
&gt; Best regards,
&gt;
&gt; -Justin
&gt;
&gt;
&gt;

-- 
Best regards,
Dmitry Demeshchuk

