---
title: "Logical operators in Ripple"
description: ""
project: community
lastmod: 2011-06-05T19:47:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03562"
author_name: "Ryan Caught"
project_section: "mailinglistitem"
sent_date: 2011-06-05T19:47:11-07:00
---


Hi,
I'm having a problem with Ripple and logical operator key filters. Has
anyone managed to get "and" or "or" key filter combinations working?

When I run the following:

require 'ripple'

client = Riak::Client.new
bucket = client.bucket("test\\_bucket")

one = Riak::RObject.new(bucket, "test-123")
one.content\\_type = "application/json"
one.data = '{"name": "test-123"}'
one.store

two = Riak::RObject.new(bucket, "test-456")
two.content\\_type = "application/json"
two.data = '{"name": "test-456"}'
two.store


results\\_1 = Riak::MapReduce.new(client).
 add("visitors", [["tokenize", "-", 1], ["eq", "test"]]).
 map("Riak.mapValuesJson", :keep =&gt; true).run
# Works as expected
p results\\_1

results\\_2 = Riak::MapReduce.new(client).
 add("visitors", [["ends\\_with", "123"]]).
 map("Riak.mapValuesJson", :keep =&gt; true).run
# Works as expected
p results\\_2

results\\_3 = Riak::MapReduce.new(client).
 add("test\\_bucket", ["and", [["tokenize", "-", 1], ["eq", "test"]],
 [["ends\\_with", "123"]]
 ]).
 map("Riak.mapValuesJson", :keep =&gt; true).run
# Error
p results\\_3




This is what the error report says:

=ERROR REPORT==== 5-Jun-2011::19:42:34 ===
webmachine error: path="/mapred"
{error,{error,function\\_clause,
 [{riak\\_client,build\\_exprs,
 [[&lt;&lt;"and"&gt;&gt;,
 [[&lt;&lt;"tokenize"&gt;&gt;,&lt;&lt;"-"&gt;&gt;,1],
 [&lt;&lt;"eq"&gt;&gt;,&lt;&lt;"test"&gt;&gt;]],
 [[&lt;&lt;"ends\\_with"&gt;&gt;,&lt;&lt;"123"&gt;&gt;]]],
 [],
 {riak\\_client,'riak@127.0.0.1
',&lt;&lt;6,82,5,153&gt;&gt;}]},
 {riak\\_client,build\\_filter,2},
 {riak\\_client,stream\\_list\\_keys,6},
 {riak\\_client,mapred\\_bucket\\_stream,7},
 {riak\\_client,mapred\\_bucket,6},
 {riak\\_kv\\_wm\\_mapred,process\\_post,2},
 {webmachine\\_resource,resource\\_call,3},
 {webmachine\\_resource,do,3}]}}


Any ideas?
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

