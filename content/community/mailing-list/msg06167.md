---
title: "Re: Riak Search Performance: Ranges vs Wildcards"
description: ""
project: community
lastmod: 2012-01-07T17:00:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06167"
mailinglist_parent_id: "msg06161"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-01-07T17:00:24-08:00
---


Elias,

I'm assuming you have one composite field that looks like so:

\\_\\_

where  is ISO8601 basic format down to an hour resolution.

If this is the case then you \\_cannot\\_ perform an efficient, nor correct
(without doing extra work in your application), query on the  portion
of the field. To use that field for time range, search would have to
perform a full scan of the compound field and then you would have to
filter/sort on . This is because  is independent of
\\_ and can repeat itself. If you have queries that are strictly
time based then a range query of the time field would be most appropriate.

In general, if you make a compound field \\_, and  and  are
independent of each other (e.g. guid and time) then you can only use a
range query on . You could range on \\_ but you'll include 
values that are below/above your  range because they are still inside
the  range. Depending on how large of a range  matched this may
not be an issue and you could filter in your application. You can also
make use of inline fields which effectively allows Search to do the
filtering for you at the index level.

In your case you have to ask two questions.

1. What is the uniqueness/selectivity/cardinality of each field?

2. How you plan to query the data?

 - Is the least selective. It has high cardinality for any given
value. There may be many events for a given user over life of application
(or that's my assumption anyways). Using this field alone is a bad idea,
but is a good candidate as an inline field.

 - Is more selective because, as you stated, can be rare. It will
have outliers which makes it's less selective in some cases. Using this
field alone could prove costly but add an inline  filter and it is
probably efficient most of the time

 - This is most selective \\_on average\\_ assuming a fairly normal
distribution of events over the course of time. This shares a similar
trait with  in that you could have hours of the day that are bursty.
 This field alone should be fine most of the time and improves if used with
inline  or .

&gt;From what I can understand you have two main queries:

a. All events for range  to  - in that case I think a range
on the time field would do just fine. If you want to further refine based
on sha/guid then add them as inline fields and use a filter or even do it
in your application.

b. All events for large time period (or for life of application) for given
sha/guid combination - In this case since  is more selective you'll
want to query via  but use  and  as inline filters. You
\\_don't\\_ want to query by  because it's not selective enough and will
cause Search to perform a large scan.

I hope this makes some sense. I realize I've completely ignored your range
vs. prefix query question but that's because I don't think that's the real
issue here.

-Ryan


On Fri, Jan 6, 2012 at 8:05 PM, Elias Levy wrote:

&gt; I was wondering whether some of the Basho folk may have some wise words
&gt; about when to choose between ranges and wildcards when using Riak Search.
&gt;
&gt; I've noticed in our systems that using wildcards will often give more
&gt; performant results than using ranges, at least for our data and some of the
&gt; indexes we've defined on them. In some instances, the Solr search API will
&gt; timeout when using a range query, but return results when using a wildcard.
&gt;
&gt;
&gt; These indexes are pseudo-compound indexes. We've taken three values form
&gt; our data, and concatenated them into a single field for indexing purposes,
&gt; so as increase cardinality of the field. The first value may be a customer
&gt; guid, the second a sha, which can be fairly rare or very common, and the
&gt; last a timestamp bucketed to either the hour. We usually use ranges to
&gt; limited the time under analysis, but at some times we want large time
&gt; ranges, possibly all the data for any time for the other values, and in
&gt; those cases ranges seem to underperform a wildcard.
&gt;
&gt; Elias Levy
&gt;

