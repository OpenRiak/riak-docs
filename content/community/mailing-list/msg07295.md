---
title: "search schema caching bug?"
description: ""
project: community
lastmod: 2012-04-23T15:13:51-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07295"
author_name: "Michael Radford"
project_section: "mailinglistitem"
sent_date: 2012-04-23T15:13:51-07:00
---


In order to get case-insensitive indexing without stopwords, I'm
trying to put a new search schema in place using the method from the
Riak wiki:

search-cmd set-schema [bucket] [schema file]

This apparently succeeded, and search-cmd show-schema correctly
returns my new schema. However, I was still getting
stopword\\_not\\_allowed\\_in\\_query errors from searches. Looking at the
code, I saw that the schema for parsing queries comes from

 {ok, Schema} = riak\\_search\\_config:get\\_schema(IndexName),

and sure enough, riak\\_search\\_config:get\\_schema for my bucket returns
the old (default) schema. Looking at the source for that function, I
see the schema is cached locally in an ets table, and then when
search-cmd calls riak\\_search\\_config:put\\_raw\\_schema, it updates the
local cache, but it seems like the other nodes' caches are not
cleared. Is this a bug?

As a workaround, it seems I can call riak\\_search\\_config:clear() on all
the nodes after setting the new schema. (But if this is a bad idea for
some reason, I'd like to know before trying this on a production
system!)

Mike

