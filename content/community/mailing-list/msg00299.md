---
title: "Re: error parsing Link headers in node.js when getting a bucket"
description: ""
project: community
lastmod: 2010-05-10T08:56:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00299"
mailinglist_parent_id: "msg00294"
author_name: "Rick Olson"
project_section: "mailinglistitem"
sent_date: 2010-05-10T08:56:17-07:00
---


Ah thanks, I didn't know about the keys=false option. I eventually
found the key streaming feature an built it into my rial wrapper. The
weird problems with link headers went away.

On Monday, May 10, 2010, Sean Cribbs  wrote:
&gt; Rick,
&gt;
&gt; If you don't want to list the keys when retrieving the bucket properties, 
&gt; pass the keys=false query string.  When you have lots of keys, it's best to 
&gt; use keys=stream to retrieve them, which will prevent Riak from building a 
&gt; huge JSON object in memory. Instead, each chunk in the stream will be a JSON 
&gt; object containing a number of keys.
&gt;
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt;
&gt; On May 10, 2010, at 3:29 AM, Rick Olson wrote:
&gt;
&gt;&gt; Hey guys, I enjoyed going through the Riak Fast Track, so I wrote a
&gt;&gt; node.js library for it:
&gt;&gt;
&gt;&gt; http://techno-weenie.net/2010/5/10/rhodes-riak-on-node-js
&gt;&gt;
&gt;&gt; I ran into one problem though: node.js choked on the Link headers when
&gt;&gt; getting a bucket's properties.  I realize this is a node.js bug, but I
&gt;&gt; found it kind of odd:
&gt;&gt;
&gt;&gt;  $ curl http://127.0.0.1:8091/riak/goog -i
&gt;&gt;  HTTP/1.1 200 OK
&gt;&gt;  Vary: Accept-Encoding
&gt;&gt;  Server: MochiWeb/1.1 WebMachine/1.6 (eat around the stinger)
&gt;&gt;  Link: ; riaktag="contained",
&gt;&gt; ; riaktag="contained", ETC
&gt;&gt;
&gt;&gt; If there are 1400 links, node.js has problems.  If there are several
&gt;&gt; thousand, even curl starts having problems:
&gt;&gt;
&gt;&gt;  curl: (27) Avoided giant realloc for header (max is 102400)!
&gt;&gt;
&gt;&gt; So, if I grab the contents of a bucket to get the list of keys, it
&gt;&gt; also sends a giant Link header pointing to each key?  The Link header
&gt;&gt; ends up being much larger than the response body.  Is it really
&gt;&gt; necessary to point to each resource, when the body contains an array
&gt;&gt; of keys?
&gt;&gt;
&gt;&gt; At any rate, here's how the map reduce API looks while implementing
&gt;&gt; the sample functions from the fast track:
&gt;&gt;
&gt;&gt; http://github.com/technoweenie/rhodes/blob/master/examples/fast-track/mapred.js#L6-19
&gt;&gt;
&gt;&gt; --
&gt;&gt; Rick Olson
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

-- 
Rick Olson

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

