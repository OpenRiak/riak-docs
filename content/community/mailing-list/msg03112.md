---
title: "riak kv search problem"
description: ""
project: community
lastmod: 2011-04-21T07:57:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03112"
author_name: "alezozov"
project_section: "mailinglistitem"
sent_date: 2011-04-21T07:57:37-07:00
---


I'm trying to use auto index of bucket's objects.

First I allow Riak to do it for some bucket

\\*curl -X PUT http://192.168.1.100:8098/riak/users/
-H "Content-Type: application/json"
-d
'{"props":{"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}]}}'\\*

then putting some kv record in this bucket

curl -X PUT http://192.168.1.100:8098/riak/users/test -H "Content-Type:
text/plain" -d "here are some words"

but getting error:

\\*PUT aborted by pre-commit hook.\\*

i tried a piece of code

require\\_once 'riak.php';
$client = new Riak();
$bucket = $client-&gt;bucket('users');

$user = $bucket-&gt;newObject('alezozov3',
array('name'=&gt;'alezozov',
'mail'=&gt;'alezo...@mail.ru',
));
$user-&gt;setContentType('application/json');
$user-&gt;store();

//
//$aluser = $bucket-&gt;get('alezozov');
//if($aluser){
// if($aluser-&gt;getData()){
// print\\_r($aluser-&gt;getData());
// }
// else{
// echo '0';
// }

//}

$results = $client-&gt;search("users", "name:alezozov")-&gt;run();
if($results){
print\\_r($results);
}
else{
echo '-';
}

but getting message :

\\*Fatal error: Uncaught exception 'Exception' with message 'Expected status
200 or 201 or 300, received 403' in
/opt/lampp/htdocs/lib/php/riak\\_lib.php:1206 Stack trace: #0
/opt/lampp/htdocs/lib/php/riak\\_lib.php(1102): RiakObject-&gt;populate(Array,
Array) #1 /opt/lampp/htdocs/test/index.php(15): RiakObject-&gt;store() #2
{main} thrown in /opt/lampp/htdocs/lib/php/riak\\_lib.php on line 1206\\*

but if I don't use

\\*url -X PUT http://192.168.1.100:8098/riak/users/
-H "Content-Type: application/json"
-d
'{"props":{"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}]}}\\*'

everything ok, and I can store and get objects, with command line and php
code, but of cource can't search

what I doing wrong ? where to dig?

thanks.
