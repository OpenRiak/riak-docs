---
title: "Re: Listing keys in a bucket"
description: ""
project: community
lastmod: 2010-09-04T12:19:31-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01020"
mailinglist_parent_id: "msg01019"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-09-04T12:19:31-07:00
---


You wouldn't put 10,000 files in a single directory on your computer, so 
there's no reason you would have to in Riak either. What about representing 
your directories as objects, too? The only thing you would require would be a 
known key that's the root of the hierarchy. For example:

/riak/files/\\_\\_root, which has links to:
-&gt; "/riak/files/images" (directory)
-&gt; "/riak/files/text" (directory)
-&gt; "/riak/files/index.html" (file)

"/riak/files/images" which has links to:
-&gt; "/riak/files/images%2Ffavicon.ico" (file)
-&gt; "/riak/files/images%2Flogo.jpg" (file)

(note I escape the slashes in the key names)

With proper use of links and tags, this is not a difficult problem. If you 
just want to mount Riak like a file system, you might look at Artur Bergman's 
riakfuse project.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Sep 4, 2010, at 2:51 PM, John Axel Eriksson wrote:

&gt; Yes, I've thought of this but as I understand it there is a bit of a problem 
&gt; attaching a large amount of links to a key which
&gt; would be necessary here am I right? If I had 10 000 files in riak that would 
&gt; mean 10 000 links attached to the "listing" key.
&gt; 
&gt; 4 sep 2010 kl. 20.44 skrev Matthew Scott:
&gt; 
&gt;&gt; 
&gt;&gt; On Sat, Sep 4, 2010 at 11:31, John Axel Eriksson  wrote:
&gt;&gt; Listing keys in a bucket has been described as "bad" and something you use 
&gt;&gt; in development but
&gt;&gt; not in production. I'm just starting out on Riak so I'm a newbie...
&gt;&gt; 
&gt;&gt; I'm thinking of building an application using Riak as filestorage and 
&gt;&gt; possibly much more than that, but it would
&gt;&gt; at least store lots of files with, perhaps, metadata attached. How would I 
&gt;&gt; then list files for display in a webapp if
&gt;&gt; I don't use key listing?
&gt;&gt; 
&gt;&gt; I'm still very much a Riak newb myself, but I'll take a shot at answering 
&gt;&gt; this one by suggesting the use of links.
&gt;&gt; 
&gt;&gt; From what I understand, links some quantity limits when you attach a large 
&gt;&gt; number, but adding and removing them is an inexpensive operation. (Someone 
&gt;&gt; fact check me on that please :)
&gt;&gt; 
&gt;&gt; - Create a key called 'listing', perhaps even in its own bucket to prevent 
&gt;&gt; namespace collision.
&gt;&gt; 
&gt;&gt; - Create links from that 'listing' key to metadata keys. Remember that you 
&gt;&gt; can attach a tag to each link to differentiate different types of links, 
&gt;&gt; such as "metadata".
&gt;&gt; 
&gt;&gt; - The metadata keys' values would contain file metadata in JSON form, and in 
&gt;&gt; turn have a link to the file contents key, tagged "contents".
&gt;&gt; 
&gt;&gt; - Remember to attach the proper mime type to the key containing your file 
&gt;&gt; contents.
&gt;&gt; 
&gt;&gt; - To get a file listing, do a map/reduce starting at "listing", following 
&gt;&gt; its "metadata" links and grabbing those values, then reduce to sort by a key.
&gt;&gt; 
&gt;&gt; - To get file contents, follow the "contents" link from the metadata key.
&gt;&gt; 
&gt;&gt; --
&gt;&gt; Matthew Scott
&gt;&gt; ElevenCraft, Inc.
&gt;&gt; http://11craft.com/
&gt;&gt; +1 360 389-2512
&gt;&gt; 
&gt;&gt; 
&gt; 

