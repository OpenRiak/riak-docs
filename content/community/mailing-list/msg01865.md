---
title: "Re: riak indexing/search issue with json"
description: ""
project: community
lastmod: 2010-12-31T00:19:38-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01865"
mailinglist_parent_id: "msg01864"
author_name: "Joseph Lambert"
project_section: "mailinglistitem"
sent_date: 2010-12-31T00:19:38-08:00
---


Seems that they are. I haven't repeated over large numbers of different
tests though

example:

search:search(&lt;&lt;"test"&gt;&gt;, &lt;&lt;"users:0002619082"&gt;&gt;).

curl '
http://192.168.1.47:8098/solr/test/select?q=userData\\_viewedBy2619082\\_isDeleted%3Afalse&wt=json
'

riak\\_search&gt; s(users:0002619082).

I've got a sinking feeling it's something I am doing wrong.

- Joe Lambert

joseph.g.lamb...@gmail.com
+86 13656213284


On Fri, Dec 31, 2010 at 4:10 PM, Dan Reverri  wrote:

&gt; Hi Joseph,
&gt;
&gt; Are these results consistently reproducible? Can you provide the full
&gt; queries you are using?
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Thu, Dec 30, 2010 at 11:46 PM, Joseph Lambert &lt;
&gt; joseph.g.lamb...@gmail.com&gt; wrote:
&gt;
&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I'm having a bit of a problem with k/v indexing and json objects in Riak
&gt;&gt; Search 0.13.0. I have JSON objects of this format:
&gt;&gt;
&gt;&gt; {
&gt;&gt; "id" : 1,
&gt;&gt; "users" : [1559620, 2619082],
&gt;&gt; "userData" : {
&gt;&gt; "viewedBy1559620" : {
&gt;&gt; "isDeleted" : "false"
&gt;&gt; }
&gt;&gt; "viewedBy2619082" : {
&gt;&gt; "isDeleted" : "false"
&gt;&gt; }
&gt;&gt; }
&gt;&gt; }
&gt;&gt;
&gt;&gt; My indexing schema is (also have tried with DefaulAnalyzerFactory):
&gt;&gt;
&gt;&gt; {
&gt;&gt; schema,
&gt;&gt; [
&gt;&gt; {version, "0.0.3"},
&gt;&gt; {default\\_field, "id"},
&gt;&gt; {default\\_op, "and"},
&gt;&gt; {n\\_val, 2},
&gt;&gt; {analyzer\\_factory,
&gt;&gt; "com.basho.search.analysis.WhitespaceAnalyzerFactory"}
&gt;&gt; ],
&gt;&gt; [
&gt;&gt; {field, [
&gt;&gt; {name, "id"},
&gt;&gt; {type, integer}
&gt;&gt; ]},
&gt;&gt; {field, [
&gt;&gt; {name, "users"},
&gt;&gt; {type, integer}
&gt;&gt; ]},
&gt;&gt; {dynamic\\_field, [
&gt;&gt; {name, "userData\\*isDeleted"},
&gt;&gt; {type, string}
&gt;&gt; ]},
&gt;&gt; {dynamic\\_field, [
&gt;&gt; {name, "\\*"},
&gt;&gt; {required, false},
&gt;&gt; {skip, true}
&gt;&gt; ]}
&gt;&gt; ]
&gt;&gt; }.
&gt;&gt;
&gt;&gt;
&gt;&gt; The appropriate fields are extracted by the extractor and this is the
&gt;&gt; index created by both factories:
&gt;&gt;
&gt;&gt; {riak\\_idx\\_doc,&lt;&lt;"test"&gt;&gt;,
&gt;&gt; &lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"6e3833626637965f1df837b63cdcc34b"&gt;&gt;,[0]}]},
&gt;&gt; {&lt;&lt;"userData\\_viewedBy1559620\\_isDeleted"&gt;&gt;,&lt;&lt;"false"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"false"&gt;&gt;,[0]}]},
&gt;&gt; {&lt;&lt;"userData\\_viewedBy2619082\\_isDeleted"&gt;&gt;,&lt;&lt;"false"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"false"&gt;&gt;,[0]}]},
&gt;&gt; {&lt;&lt;"users"&gt;&gt;,&lt;&lt;"1559620 2619082"&gt;&gt;,
&gt;&gt; [{&lt;&lt;"0002619082"&gt;&gt;,[1]},{&lt;&lt;"0001559620"&gt;&gt;,[0]}]}],
&gt;&gt; [],[],true}
&gt;&gt;
&gt;&gt; The problem comes when I am searching. If I run the following searches
&gt;&gt; 1.) users:0001559620
&gt;&gt; 2.) users:0002619082
&gt;&gt; 3.) userData\\_viewedBy1559620\\_isDeleted:false
&gt;&gt; 4.) userData\\_viewedBy2619082\\_isDeleted:false
&gt;&gt;
&gt;&gt; I get these results:
&gt;&gt;
&gt;&gt; using search:search from the riak console:
&gt;&gt; 1.) works
&gt;&gt; 2.) works
&gt;&gt; 3.) does not work
&gt;&gt; 4.) works
&gt;&gt;
&gt;&gt; The same queries from http using the solr interface (properly url encoded,
&gt;&gt; I swear):
&gt;&gt; 1.) does not work
&gt;&gt; 2.) works
&gt;&gt; 3.) does not work
&gt;&gt; 4.) does not work
&gt;&gt;
&gt;&gt; Now, from the interactive shell:
&gt;&gt; 1.) does not work
&gt;&gt; 2.) works
&gt;&gt; 3.) works
&gt;&gt; 4.) does not work
&gt;&gt;
&gt;&gt;
&gt;&gt; Can anyone help explain to me where I am going wrong?
&gt;&gt;
&gt;&gt; - Joe Lambert
&gt;&gt;
&gt;&gt; joseph.g.lamb...@gmail.com
&gt;&gt; +86 13656213284
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

