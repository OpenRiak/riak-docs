---
title: "Re: Search and Erlang client"
description: ""
project: community
lastmod: 2012-03-05T03:30:57-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06874"
mailinglist_parent_id: "msg06762"
author_name: "Doug Selph"
project_section: "mailinglistitem"
sent_date: 2012-03-05T03:30:57-08:00
---


Hi Dan,

It took me several days to get back to this issue; my apologies. I was able
to track down what was happening. Bottom line is this: I was creating a new
Riak object with the desired content type. I was then updating the metadata
on the new object before saving it in order to add 2i information. The
updated metadata did not include the content type, so I was clobbering it
before saving. The resulting content type was 'application/octet-stream'

Thanks for your replies.
Doug


On Mon, Feb 27, 2012 at 5:52 PM, Dan Reverri  wrote:

&gt; Hi Doug,
&gt;
&gt; The Erlang client will use whatever content-type is set by the user. Can
&gt; you provide an example of how you are creating your objects?
&gt;
&gt; The following worked for me:
&gt; {ok, Pid} = riakc\\_pb\\_socket:start\\_link("127.0.0.1", 8087).
&gt; O = riakc\\_obj:new(&lt;&lt;"bucket"&gt;&gt;, &lt;&lt;"key"&gt;&gt;, &lt;&lt;"{\\"foo\\":\\"bar\\"}"&gt;&gt;,
&gt; &lt;&lt;"application/json"&gt;&gt;).
&gt; riakc\\_pb\\_socket:put(Pid, O).
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt; On Mon, Feb 27, 2012 at 11:17 AM, Doug Selph  wrote:
&gt;
&gt;&gt; Hi Dan,
&gt;&gt;
&gt;&gt; Well, I'm stumped. When creating the object, I pass "application/json" as
&gt;&gt; content-type, but all my objects have content-type set to
&gt;&gt; "application/octet-stream"
&gt;&gt;
&gt;&gt; Does the erlang client save everything as a binary?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Doug
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Feb 27, 2012 at 12:10 PM, Dan Reverri  wrote:
&gt;&gt;
&gt;&gt;&gt; Hi Doug,
&gt;&gt;&gt;
&gt;&gt;&gt; Can you confirm the "Content-Type" header is set to "application/json"
&gt;&gt;&gt; by reading the JSON objects you stored?
&gt;&gt;&gt;
&gt;&gt;&gt; Can you share an example JSON object as well as an example query you are
&gt;&gt;&gt; running with "search-cmd"?
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you,
&gt;&gt;&gt; Dan
&gt;&gt;&gt;
&gt;&gt;&gt; Daniel Reverri
&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; d...@basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Sun, Feb 26, 2012 at 9:01 PM, Doug Selph  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I'm having trouble with riak-search. If I use the seach-cmd command
&gt;&gt;&gt;&gt; line tool to index text files, I can search the index using both search-cmd
&gt;&gt;&gt;&gt; and the sold interface. However, when I store JSON objects via the erlang
&gt;&gt;&gt;&gt; protocol buffers client, in a bucket which has the search pre-commit
&gt;&gt;&gt;&gt; trigger installed, searches in that index always return 0 matches for
&gt;&gt;&gt;&gt; search terms which have matches in the bucket. (I have saved these objects
&gt;&gt;&gt;&gt; to the bucket after the pre-commit trigger was installed.)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Is there a trick to this? It is my understanding that there is a
&gt;&gt;&gt;&gt; default schema for JSON objects, which should be sufficient as a starting
&gt;&gt;&gt;&gt; point.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
