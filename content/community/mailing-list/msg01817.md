---
title: "Re: Secondary Indexes and You"
description: ""
project: community
lastmod: 2010-12-17T08:58:47-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01817"
mailinglist_parent_id: "msg01805"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2010-12-17T08:58:47-08:00
---

Hi Jeremiah,

Great article. Involved but I made it through. Two things. I'm writing 
this on the go, but as I recall one of your map examples towards the 
top seemed to say that the filter will keep you from reading from 
disk. I don't think that is the case. The new release, .14, will have 
certain key filtering features which will filter keys in memory. But 
in order to filter on any json val in your key you will have to read 
that val from disk first.


In general I am of the opinion that building your index in riak is 
incredibly inefficient, aka. "bad idea", and only moreso as your use 
case shifts from immutable data to frequently updated data, which you 
hinted at.


The problem is in the way riak handles data types, as in it doesn't. 
You constantly need to read an entire value from disk, make your 
changes and write the entire value back. This can only suck more as 
your index grows and needs to be updated more frequently.


To solve these mechanics I personally use redis as an intermediary 
which does all the nitty gritty value updating much better than riak, 
as in it understands data types (and even moreso still with future bit 
twiddling enhancement). Then I \\*periodically\\* flush an entire index to 
riak for long term storage. I also like this aproach for another 
reason: index history. I have a particular personal interest in how a 
set of data, like say an index, evolves over time and depending on the 
particular data it may be possible to store the entire index or it's 
deltas at certain frequencies.


Otherwise, your description of how to architect an index from a data 
massage perspective is a great introduction on how to actually 
conceptualize an index and has broader applicability. Like I said, 
great article.


-Alexander


@siculars on twitter
http://siculars.posterous.com

Sent from my iPhone

On Dec 16, 2010, at 10:23, Jeremiah Peschka 
 wrote:


I put together a write up about what it might take to implement 
secondary indexes in Riak. It was a fun thought experiment and I'd 
like to hear what other people have to say about implementing 
indexes in Riak.


Here's the link: 
http://facility9.com/2010/12/16/secondary-indexes-how-would-you-do-it

If you REALLY like it, you should up vote it on Hacker News ;) 
http://news.ycombinator.com/item?id=2012243

Jeremiah Peschka

