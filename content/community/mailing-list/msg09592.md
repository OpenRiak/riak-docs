---
title: "Re: \"Bad message code\" error from Java ProtoBuf client?"
description: ""
project: community
lastmod: 2012-12-14T19:08:21-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09592"
mailinglist_parent_id: "msg09589"
author_name: "Tim W"
project_section: "mailinglistitem"
sent_date: 2012-12-14T19:08:21-08:00
---

Brian!

In this particular case, the failing call is requesting a single key. 
And it didn't just happen once -- rather, for quite a while, every 
single one of these calls (login) would fail in this manner, 
repeatedly. Then, the next day... \\*poof\\*... working again.


Rather odd...

- Tim

On 12/14/12 3:43 PM, Brian Roach wrote:

Sorry - dyslexia acting up:

That should read that you received a "list keys" response when
expecting a "get" response.

- Roach

On Fri, Dec 14, 2012 at 3:40 PM, Brian Roach  wrote:

Tim -

That error is generated when the original, underlying protocol buffers
Riak client gets the wrong protobuf message from the socket - as in,
not the one it's expecting.

The codes are here:
http://docs.basho.com/riak/latest/references/apis/protocol-buffers/

The code numbers you list basically say that you got a "get" response
message when expecting a "list keys" response method.

I'm digging into this to see how that would happen (I have an idea)
but by any chance are you listing keys and then not iterating through
the entire set?

Thanks,
Brian Roach

On Fri, Dec 14, 2012 at 2:55 PM, Tim W  wrote:

I'm seeing the following message emitted from a query to Riak:

com.basho.riak.client.RiakRetryFailedException: java.io.IOException: bad
message code. Expected: 10 actual: 18
 at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:79)
 at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
 at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)
 at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:81)

I'm also seeing this a bit further down in the log:

Caused by: java.io.IOException: bad message code. Expected: 10 actual: 18
 at com.basho.riak.pbc.RiakConnection.receive(RiakConnection.java:126)
 at com.basho.riak.pbc.RiakClient.processFetchReply(RiakClient.java:278)
 at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:252)
 at com.basho.riak.pbc.RiakClient.fetch(RiakClient.java:241)
 at
com.basho.riak.client.raw.pbc.PBClientAdapter.fetch(PBClientAdapter.java:156)
 at
com.basho.riak.client.operations.FetchObject$1.call(FetchObject.java:102)
 at
com.basho.riak.client.operations.FetchObject$1.call(FetchObject.java:100)
 at
com.basho.riak.client.cap.DefaultRetrier.attempt(DefaultRetrier.java:72)


This crops up periodically, during different operations, and disappears just
as mysteriously.

Any hint as to what this really means? (For example, is there somewhere I
can look up these error codes?)

For the record, I'm running Riak 1.1.4 with Java client 1.0.5.

Thanks in advance!
- Tim

