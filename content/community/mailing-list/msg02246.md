---
title: "Re: Spikes in node_(get|put)_fsm_time_100"
description: ""
project: community
lastmod: 2011-02-09T09:23:05-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02246"
mailinglist_parent_id: "msg02245"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2011-02-09T09:23:05-08:00
---


not quite sure about the overall problem, but bitcask does do compaction if 
your "casks" reach a certain threshold of dead bytes. this is all configurable 
and would only be triggered if your updates or deletes pushed your dead bytes 
over that threshold.

-alexander

On Feb 9, 2011, at 12:12 PM, Anthony Molinaro wrote:

&gt; Hi,
&gt; 
&gt; Any thoughts on this? I added a timeout to my client so its not impacted
&gt; (other than missing some data, but that's okay). However, I still see large
&gt; spikes in the node\\_(get|put)\\_fsm\\_time\\_100 stats (normal operation seems to be
&gt; about 1200, and I see spikes up to 200000).
&gt; 
&gt; One thing I thought of is upping the number of async threads. I did
&gt; increase the number of partitions to 1024 and with only 4 nodes in the
&gt; ring I could be hitting some sort of locking at the bitcask layer.
&gt; 
&gt; Are there any maintenance tasks that happen with bitcask that could
&gt; cause lag? For instance in our frequency server which uses riak\\_core
&gt; with a linked in driver for a backend, we have to grow the file every
&gt; so often which lead to these sort of spikes, so maybe bitcask has some
&gt; thing similar?
&gt; 
&gt; Thanks,
&gt; 
&gt; -Anthony
&gt; 
&gt; On Tue, Feb 08, 2011 at 12:09:34PM -0800, Anthony Molinaro wrote:
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; I have a 4 node cluster using riak\\_kv\\_multi\\_backend with one backend
&gt;&gt; configured to use riak\\_kv\\_bitcask\\_backend. I'm using the multi backend
&gt;&gt; because eventually I want to also run a cache backend. I'm sampling
&gt;&gt; the statistics once per minute and viewing them in rrd and noticed
&gt;&gt; something odd. The node\\_(get|put)\\_fsm\\_time\\_100 sometimes spike to
&gt;&gt; 60 seconds while 99.99% of the time it's less than 2 milliseconds.
&gt;&gt; 
&gt;&gt; I'm going to work around by lowering the timeouts in riak-erlang-client
&gt;&gt; but this seems like it could continue to be a problem if the get/put
&gt;&gt; fsms continue to run even if the client times out.
&gt;&gt; 
&gt;&gt; Anyway, just curious if others have experienced this sort of long tail
&gt;&gt; spikiness.
&gt;&gt; 
&gt;&gt; -Anthony
&gt;&gt; 
&gt;&gt; -- 
&gt;&gt; ------------------------------------------------------------------------
&gt;&gt; Anthony Molinaro 
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; -- 
&gt; ------------------------------------------------------------------------
&gt; Anthony Molinaro 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

