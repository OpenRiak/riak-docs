---
title: "Re: riak-1.0.0pre2 segfaults"
description: ""
project: community
lastmod: 2011-09-14T14:07:15-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04714"
mailinglist_parent_id: "msg04678"
author_name: "Jeff Pollard"
project_section: "mailinglistitem"
sent_date: 2011-09-14T14:07:15-07:00
---


FWIW, we also ran in to intermittent segfaullts in erlang\\_js\\_drv.so on
Ubuntu 10.04on EC2 and ended up rewriting our M/R jobs in erlang. We saw
log lines like this:

Aug 11 16:29:08 ip-10-66-190-207 kernel: [3281113.735644] beam.smp[22173]:
&gt; segfault at 8 ip 00007fe7842a6412 sp 00007fe7877f5d40 error 4 in
&gt; erlang\\_js\\_drv.so[7fe784275000+e6000]
&gt; Aug 11 16:33:38 ip-10-66-190-207 kernel: [3281659.604561] beam.smp[25277]:
&gt; segfault at 2a9 ip 00007fe67323bef6 sp 00007fe676523d38 error 4 in
&gt; erlang\\_js\\_drv.so[7fe673209000+e6000]
&gt; Aug 11 22:31:09 ip-10-66-190-207 kernel: [3303109.375523] beam.smp[26178]:
&gt; segfault at 18 ip 00007f4a21865af2 sp 00007f4a24a46c98 error 4 in
&gt; erlang\\_js\\_drv.so[7f4a2180f000+e6000]


Not sure if it's related to your issue or not, but we were told it was
likely this bug:

https://issues.basho.com/show\\_bug.cgi?id=1151

On Mon, Sep 12, 2011 at 7:19 PM, Ryan Zezeski  wrote:

&gt; Henrik,
&gt;
&gt; I'm not familiar with riaktant but it looks like an invalid query is being
&gt; passed in. I.e. an empty query. This empty query causes and error in the
&gt; query parser and then it appears a segfault in the js driver.
&gt;
&gt; E.g. here I replicate the error at the console:
&gt;
&gt; (riak@127.0.0.1)5&gt; search:search(&lt;&lt;"bucket"&gt;&gt;, &lt;&lt;&gt;&gt;).
&gt; \\*\\* exception error: no match of right hand side value
&gt; {error,{lucene\\_parse,"syntax error before: "}}
&gt; in function riak\\_search\\_client:parse\\_query/3
&gt; in call from search:search/3
&gt;
&gt; -Ryan
&gt;
&gt; On Mon, Sep 12, 2011 at 4:09 PM, Henrik Johansen  wrote:
&gt;
&gt;&gt; Hello list,
&gt;&gt;
&gt;&gt; I have been playing with single node riak-1.0.0pre2 cluster & riaktant
&gt;&gt; today and somehow I managed to get riak to segfault every time I tried using
&gt;&gt; the MapReduce functions in riaktant.
&gt;&gt;
&gt;&gt; Riak-1.0.0pre2 was installed using the 64-bit Debian package on my
&gt;&gt; Ubuntu 11.04 laptop - riaktant was pulled form GitHub.
&gt;&gt;
&gt;&gt; I have gathered some relevant info below - if I can assist in any way
&gt;&gt; please let me know ...
&gt;&gt;
&gt;&gt; dmesg :
&gt;&gt; [10488.941750] beam.smp[1496]: segfault at 7f4d61d73ff8 ip
&gt;&gt; 00007f4d5ea7a83e sp 00007f4d61d74000 error 6 in
&gt;&gt; erlang\\_js\\_drv.so[7f4d5ea35000+\\*\\*e6000]
&gt;&gt; [10944.335495] beam.smp[4681]: segfault at 7fcda9892ff8 ip
&gt;&gt; 00007fcda386783e sp 00007fcda9893000 error 6 in
&gt;&gt; erlang\\_js\\_drv.so[7fcda3822000+\\*\\*e6000]
&gt;&gt; [11658.589251] beam.smp[6604]: segfault at 7fee7166eff8 ip
&gt;&gt; 00007fee6dc4983e sp 00007fee7166f000 error 6 in
&gt;&gt; erlang\\_js\\_drv.so[7fee6dc04000+\\*\\*e6000]
&gt;&gt;
&gt;&gt; crash.log :
&gt;&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt;&gt; Supervisor: {local,riak\\_pipe\\_builder\\_sup}
&gt;&gt; Context: child\\_terminated
&gt;&gt; Reason:
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; Offender:
&gt;&gt; [{pid,&lt;0.1556.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt;&gt; builder,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt;&gt; shutdown,brutal\\_kill},{child\\_\\*\\*type,worker}]
&gt;&gt;
&gt;&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt;&gt; Supervisor: {local,riak\\_pipe\\_fitting\\_sup}
&gt;&gt; Context: child\\_terminated
&gt;&gt; Reason:
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; Offender:
&gt;&gt; [{pid,&lt;0.1558.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt;&gt; fitting,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt;&gt; shutdown,2000},{child\\_type,\\*\\*worker}]
&gt;&gt;
&gt;&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt;&gt; Supervisor: {local,riak\\_pipe\\_fitting\\_sup}
&gt;&gt; Context: child\\_terminated
&gt;&gt; Reason:
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; Offender:
&gt;&gt; [{pid,&lt;0.1559.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt;&gt; fitting,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt;&gt; shutdown,2000},{child\\_type,\\*\\*worker}]
&gt;&gt;
&gt;&gt; 2011-09-12 21:49:03 =SUPERVISOR REPORT====
&gt;&gt; Supervisor: {local,riak\\_pipe\\_fitting\\_sup}
&gt;&gt; Context: child\\_terminated
&gt;&gt; Reason:
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; Offender:
&gt;&gt; [{pid,&lt;0.1557.0&gt;},{name,\\*\\*undefined},{mfargs,{riak\\_pipe\\_\\*\\*
&gt;&gt; fitting,start\\_link,undefined}}\\*\\*,{restart\\_type,temporary},{\\*\\*
&gt;&gt; shutdown,2000},{child\\_type,\\*\\*worker}]
&gt;&gt;
&gt;&gt; error.log :
&gt;&gt; 2011-09-12 21:49:03.025 [error] &lt;0.132.0&gt; Supervisor riak\\_pipe\\_builder\\_sup
&gt;&gt; had child at module undefined at &lt;0.1556.0&gt; exit with reason
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; in context child\\_terminated
&gt;&gt; 2011-09-12 21:49:03.028 [error] &lt;0.133.0&gt; Supervisor riak\\_pipe\\_fitting\\_sup
&gt;&gt; had child at module undefined at &lt;0.1558.0&gt; exit with reason
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; in context child\\_terminated
&gt;&gt; 2011-09-12 21:49:03.031 [error] &lt;0.133.0&gt; Supervisor riak\\_pipe\\_fitting\\_sup
&gt;&gt; had child at module undefined at &lt;0.1559.0&gt; exit with reason
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; in context child\\_terminated
&gt;&gt; 2011-09-12 21:49:03.033 [error] &lt;0.133.0&gt; Supervisor riak\\_pipe\\_fitting\\_sup
&gt;&gt; had child at module undefined at &lt;0.1557.0&gt; exit with reason
&gt;&gt; {{modfun,riak\\_search,mapred\\_\\*\\*search,[&lt;&lt;"syslog"&gt;&gt;,&lt;&lt;&gt;&gt;]},\\*\\*
&gt;&gt; error,{badmatch,{error,{\\*\\*lucene\\_parse,"syntax
&gt;&gt; error before:
&gt;&gt; "}}},[{riak\\_search\\_client,\\*\\*parse\\_query,3},{riak\\_search,\\*\\*
&gt;&gt; parse\\_query,3},{riak\\_search,\\*\\*mapred\\_search,3},{riak\\_kv\\_mrc\\_\\*\\*
&gt;&gt; pipe,send\\_inputs,3},{riak\\_kv\\_\\*\\*mrc\\_pipe,'-send\\_inputs\\_async/\\*\\*
&gt;&gt; 3-fun-0-',3}]}
&gt;&gt; in context child\\_terminated
&gt;&gt;
&gt;&gt; /HenrikJ
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/\\*\\*mailman/listinfo/riak-users\\_\\*\\*lists.basho.com
&gt;&gt;
&gt;
&gt;

