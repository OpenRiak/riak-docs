---
title: "Re: Riak timeout"
description: ""
project: community
lastmod: 2010-10-05T10:10:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01202"
mailinglist_parent_id: "msg01201"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-10-05T10:10:06-07:00
---


You might also want to check netstat to see if any of the TCP sockets linger 
unnecessarily. Also, what's the output of riak-admin status while your node is 
running?

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Oct 5, 2010, at 12:59 PM, Alex Wolfe wrote:

&gt; Hi Sean,
&gt; 
&gt; Thanks for responding. I have my ulimit set to 9000, and still have the same 
&gt; problem. And wouldn't stopping and restarting riak solve this issue, at 
&gt; least temporarily? I cannot make a single request to riak, even immediately 
&gt; after restarting the server.
&gt; 
&gt; Here's evidence of my ulimit settings:
&gt; $ ulimit -a
&gt; core file size (blocks, -c) 0
&gt; data seg size (kbytes, -d) unlimited
&gt; file size (blocks, -f) unlimited
&gt; max locked memory (kbytes, -l) unlimited
&gt; max memory size (kbytes, -m) unlimited
&gt; open files (-n) 9000
&gt; pipe size (512 bytes, -p) 1
&gt; stack size (kbytes, -s) 8192
&gt; cpu time (seconds, -t) unlimited
&gt; max user processes (-u) 266
&gt; virtual memory (kbytes, -v) unlimited
&gt; 
&gt; Alex
&gt; 
&gt; 
&gt; On Oct 5, 2010, at 11:54 AM, Sean Cribbs wrote:
&gt; 
&gt;&gt; Make sure you set ulimit -n before starting Riak. A value of 1024 or larger 
&gt;&gt; is recommended (on OS/X the default is 256). Example:
&gt;&gt; 
&gt;&gt; $ ulimit -a
&gt;&gt; core file size (blocks, -c) 0
&gt;&gt; data seg size (kbytes, -d) unlimited
&gt;&gt; file size (blocks, -f) unlimited
&gt;&gt; max locked memory (kbytes, -l) unlimited
&gt;&gt; max memory size (kbytes, -m) unlimited
&gt;&gt; open files (-n) 256
&gt;&gt; pipe size (512 bytes, -p) 1
&gt;&gt; stack size (kbytes, -s) 8192
&gt;&gt; cpu time (seconds, -t) unlimited
&gt;&gt; max user processes (-u) 266
&gt;&gt; virtual memory (kbytes, -v) unlimited
&gt;&gt; 
&gt;&gt; $ ulimit -n 1024
&gt;&gt; 
&gt;&gt; This is a common cause of timeouts and connection failures on OS/X.
&gt;&gt; 
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt;&gt; On Oct 5, 2010, at 12:43 PM, Alex Wolfe wrote:
&gt;&gt; 
&gt;&gt;&gt; I've run into a problem with Riak on my development machine, and I can't 
&gt;&gt;&gt; quite sort out what's happening. I've tried stopping the riak processes 
&gt;&gt;&gt; and restarting it back up again, but it will not service any requests.
&gt;&gt;&gt; 
&gt;&gt;&gt; Has anyone seen this before?
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; $ curl -v -X POST http://riak:8098/riak/test -d'{"foo":"bar"}' -H 
&gt;&gt;&gt; 'Content-Type:application/json'
&gt;&gt;&gt; \\* About to connect() to riak port 8098 (#0)
&gt;&gt;&gt; \\* Trying ::1... Connection refused
&gt;&gt;&gt; \\* Trying fe80::1... Connection refused
&gt;&gt;&gt; \\* Trying 127.0.0.1... connected
&gt;&gt;&gt; \\* Connected to riak (127.0.0.1) port 8098 (#0)
&gt;&gt;&gt;&gt; POST /riak/test HTTP/1.1
&gt;&gt;&gt;&gt; User-Agent: curl/7.19.7 (universal-apple-darwin10.0) libcurl/7.19.7 
&gt;&gt;&gt;&gt; OpenSSL/0.9.8l zlib/1.2.3
&gt;&gt;&gt;&gt; Host: riak:8098
&gt;&gt;&gt;&gt; Accept: \\*/\\*
&gt;&gt;&gt;&gt; Content-Type:application/json
&gt;&gt;&gt;&gt; Content-Length: 13
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; &lt; HTTP/1.1 500 Internal Server Error
&gt;&gt;&gt; &lt; Vary: Accept-Encoding
&gt;&gt;&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.7.1 (participate in the frantic)
&gt;&gt;&gt; &lt; Location: /riak/test/RmfYZCM8LtBPRu4gqZivu8pfVoh
&gt;&gt;&gt; &lt; Date: Tue, 05 Oct 2010 16:36:57 GMT
&gt;&gt;&gt; &lt; Content-Type: text/html
&gt;&gt;&gt; &lt; Content-Length: 713
&gt;&gt;&gt; &lt; 
&gt;&gt;&gt; 500 Internal Server 
&gt;&gt;&gt; ErrorInternal Server Error
=====================

The server 
&gt;&gt;&gt; encountered an error while processing this 
&gt;&gt;&gt; request:  

```
{error,{error,{case_clause,{error,timeout}},
&gt;&gt;&gt;            [{riak_kv_wm_raw,accept_doc_body,2},
&gt;&gt;&gt;             {webmachine_resource,resource_call,3},
&gt;&gt;&gt;             {webmachine_resource,do,3},
&gt;&gt;&gt;             {webmachine_decision_core,resource_call,1},
&gt;&gt;&gt;             {webmachine_decision_core,accept_helper,0},
&gt;&gt;&gt;             {webmachine_decision_core,decision,1},
&gt;&gt;&gt;             {webmachine_decision_core,handle_request,2},
&gt;&gt;&gt; * Connection #0 to host riak left intact
&gt;&gt;&gt; * Closing connection #0
&gt;&gt;&gt;             
&gt;&gt;&gt; {webmachine_mochiweb,loop,1}]}}
```


---

mochiweb+webmachine 
&gt;&gt;&gt; web server


&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 
