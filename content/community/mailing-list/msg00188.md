---
title: "Re: javascript function caching"
description: ""
project: community
lastmod: 2010-04-27T10:34:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00188"
mailinglist_parent_id: "msg00187"
author_name: "Colin Surprenant"
project_section: "mailinglistitem"
sent_date: 2010-04-27T10:34:36-07:00
---


Hi,

bin/riak-admin js\\_reload does trigger a Spidermonkey VM realod:

=INFO REPORT==== 27-Apr-2010::12:12:12 ===
Spidermonkey VM host reloaded (&lt;0.111.0&gt;)

but, the cached function does not get flushed. I still have to restart
Riak. Weird.

Also, I was wrong in my last post, it is not related to inner function
definition. Caching is on the complete anonymous function.

Now, after a few tests I noticed that Riak seems to be stuck in error
state once a javascript error is detected. I did the following:

- successfully submitted a javascript mapper, good result, no error
- modified the javascript mapper to introduce an error
- re submitted the javascript mapper, got an expected error:
&lt;&lt;"ReferenceError: find\\_categories is not defined"&gt;&gt;}
- corrected the javascript mapper
- re submitted the mapper and still getting the same error
- bin/riak-admin js\\_reload, still getting the same error
- bin/riak restart, mapper works, good result, no error

btw, I'm using Riak 0.9.1 on Erlang 5.7.5 and OSX 10.5.8.

Colin

On Tue, Apr 27, 2010 at 12:48 PM, Kevin Smith  wrote:
&gt; Colin -
&gt;
&gt; You can reload predefined JS functions on a Riak server by running 
&gt; 'riak-admin js\\_reload'. This should cause Riak to reload all predefined JS 
&gt; functions.
&gt;
&gt; --Kevin
&gt; On Apr 27, 2010, at 11:40 AM, Colin Surprenant wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; It looks like Riak is caching my named javascript functions WITHIN an
&gt;&gt; anonymous map function.
&gt;&gt;
&gt;&gt; For example my mapper is something similar to:
&gt;&gt;
&gt;&gt; function(v) {
&gt;&gt;  var innerfunction = function(arg) {
&gt;&gt;    ...
&gt;&gt;  }
&gt;&gt;  ...
&gt;&gt; }
&gt;&gt;
&gt;&gt; and modifications to my innerfunction are not picked up when executing
&gt;&gt; my mapreduce job.
&gt;&gt;
&gt;&gt; Is this a known behavior and is there a way for me to control the
&gt;&gt; javascript function caching?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Colin
&gt;
&gt;

