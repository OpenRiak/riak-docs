---
title: "Re: ssl support?"
description: ""
project: community
lastmod: 2012-07-13T13:57:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07930"
mailinglist_parent_id: "msg07929"
author_name: "Michael Johnson"
project_section: "mailinglistitem"
sent_date: 2012-07-13T13:57:05-07:00
---


Yup, they are:

[root@riak01 riak]# ls -al /etc/riak/ssl.\\*
-rw-r--r--. 1 root root 2122 Jul 12 16:49 /etc/riak/ssl.crt
-rw-r--r--. 1 root root 3272 Jul 12 16:49 /etc/riak/ssl.key

In fact, I straced the beam process to see if that would show anything
outside of what was showing up in the logs and noticed one thing that was
somewhat interesting. The process check to see if the cert and key files
are writeable (which they are not). On the off chance that that was
problematic, I changed the owner and group of the cert and key to be 'riak'
and the check for write access was succeeding, however it didn't change the
end result. Here is a snip from the strace before changing the owner and
group:

31520 stat("/etc/riak/ssl.crt", 
31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=2122, ...}) = 0
31520 access("/etc/riak/ssl.crt", R\\_OK) = 0
31520 access("/etc/riak/ssl.crt", W\\_OK) = -1 EACCES (Permission denied)
...
31520 stat("/etc/riak/ssl.key", 
31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=3272, ...}) = 0
31520 access("/etc/riak/ssl.key", R\\_OK) = 0
31520 access("/etc/riak/ssl.key", W\\_OK) = -1 EACCES (Permission denied)

And after:
31520 stat("/etc/riak/ssl.crt", 
31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=2122, ...}) = 0
31520 access("/etc/riak/ssl.crt", R\\_OK) = 0
31520 access("/etc/riak/ssl.crt", W\\_OK) = 0
...
31520 stat("/etc/riak/ssl.key", 
31520 &lt;... stat resumed&gt; {st\\_mode=S\\_IFREG|0644, st\\_size=3272, ...}) = 0
31520 access("/etc/riak/ssl.key", R\\_OK) = 0
31520 access("/etc/riak/ssl.key", W\\_OK) = 0


On Fri, Jul 13, 2012 at 1:34 PM, Dave Parfitt  wrote:

&gt; Hi Michael -
&gt;
&gt; [root@riak01 riak]# openssl verify /etc/riak/ssl.crt
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt; I see you are using root to create/verify these certs - are they readable
&gt; by the riak user?
&gt;
&gt; - Dave
&gt;
&gt;
&gt; On Jul 13, 2012, at 4:20 PM, Michael Johnson wrote:
&gt;
&gt; Nope. One key in the key file, one cert in the cert file. In fact, since
&gt; this is a cert/key I generated just for testing purposes, I'll go ahead and
&gt; post them:
&gt;
&gt; /etc/riak/ssl.key:
&gt; -----BEGIN CERTIFICATE-----
&gt; MIIF8TCCA9mgAwIBAgIJAKXZl+gEfanVMA0GCSqGSIb3DQEBBQUAMIGOMQswCQYD
&gt; VQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEUMBIGA1UEBwwLQ3VsdmVyIENp
&gt; dHkxHDAaBgNVBAoME0RlZmF1bHQgQ29tcGFueSBMdGQxFDASBgNVBAMMC2V4YW1w
&gt; bGUuY29tMSAwHgYJKoZIhvcNAQkBFhFhZG1pbkBleGFtcGxlLmNvbTAeFw0xMjA3
&gt; MTIyMzQ5NTVaFw0yMjA3MTAyMzQ5NTVaMIGOMQswCQYDVQQGEwJVUzETMBEGA1UE
&gt; CAwKQ2FsaWZvcm5pYTEUMBIGA1UEBwwLQ3VsdmVyIENpdHkxHDAaBgNVBAoME0Rl
&gt; ZmF1bHQgQ29tcGFueSBMdGQxFDASBgNVBAMMC2V4YW1wbGUuY29tMSAwHgYJKoZI
&gt; hvcNAQkBFhFhZG1pbkBleGFtcGxlLmNvbTCCAiIwDQYJKoZIhvcNAQEBBQADggIP
&gt; ADCCAgoCggIBAOamauTDKfz/aY8cB2H787C4/TzWYR9Wl28hukC/HmnkOsn8I+sE
&gt; WLKm4A4ikrhbzIHMvESjaRhxAtlDDagDz++UyxMW/0+c481b/dOSI+5pBLdFdXdA
&gt; 6b0Y7WuhKxwTBHBlt0v5fW8gF5u/4j0azUq56OUxKvKnz890nV0fgcBytyeNmRKr
&gt; 5KAK/CAvZb2q1iyX9fDluIfC5KCgrXdVrD2BpdGsqUFWa8C5rZ4sDjW1tbWs/D7c
&gt; Mi33In4Iraf300JxDfEyUgtGJK62Z8cgia2DhoFIrtBAzil6sCkd02ebPZ6z7KRc
&gt; QUwWUXUA3zkfYat7nnVCXqxKDd8RyIX/BLm5WClmsgCcGAz2FtWTcskoikAFxRx0
&gt; Tr2OzATCLH6tfRJ9kWNr7xCjLV3FXa4VcXMIUDorBWQD0rC6egZSehcGlnZCL/KL
&gt; 6zfl1zHjhWXXvd1PIPdBaFVOL+ZVTkJ6W9GQ3mXW8DDBxxvqQautS4Mykd6uDjiv
&gt; Xty5eTAwknuyOO3zDunsIbA1d/cJxq9teME/BVsTqzTXRmPSsNY54n6PYNouuqgs
&gt; lpP5jTdQYR2lySPPtaGnpmJpRWGoWa6zBMn4QhZAdBuSR173YmbKyx2LPt1fcMMu
&gt; OdAg/K8x6p8UCF2iDmMZFKBimZIzW1hWMEq2l4MX1r+tzhHYFs4fT0fpAgMBAAGj
&gt; UDBOMB0GA1UdDgQWBBTtPvZYb6P5j5MtDVHiMXb2x93hljAfBgNVHSMEGDAWgBTt
&gt; PvZYb6P5j5MtDVHiMXb2x93hljAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUA
&gt; A4ICAQCEEDH0n8unUgxrpIAiw/zFcUIPIO/A7Ha6VmOV4a9sk+RdRspeBuLLxPIq
&gt; f6imWEy9bIASBnGVCZ7XW6orltPgSoBiN8PSs8FzbyxbGkzqe0yYfzN+vV9WULtF
&gt; ZV/arROCGsiEpujcb4ldhLj0DtzSCXeBwSA8wL2PeNu/ryyx3TwqwUWYkWbhWGKq
&gt; /qxBZ0XrRyLhU2X76AU5QVeih2PX6u/suf81u14TLYWj8pIPme+LLgsAkKoW0UJy
&gt; KUjIV4ELWTt5iXAAkCdq3+7ZBaSf98OrX+mGsRWHgEA3TgjtHdKWISeFebSXdBt0
&gt; +Ytv9ZjYS9Cfa1X2BUYhvZV3SX6D0t/J6jAHhUrmsoO5zJx/kHiy4iyG7lKvI6HQ
&gt; 5tuGnDL623nSQ3fIPzC9yfie5J3ofd9HzjLik04wGprV9pEODtMnUIu2MIJc2XUc
&gt; LKC5H21uV970aRj4F1rsSNBFFNxrWEXyBYNJThHqfjmfYpB18MD1XB3ht30fzE+B
&gt; 0GVM6ueTv3fh+15DUpjT+dtmAf3xw4fy04Wj6Kny2DLqZ+kkjxcK6OLOimCJBapx
&gt; hKuPK0zfirPYaA9a1lhqoityMtrYMnNuIVT0EHVIU6j7U0Mz5kFSHGhnryVwrcVp
&gt; fFjygSx8xC2TQwhCdFDFoBUCaGFnIzis17aWeX8tINpDz3K/Vg==
&gt; -----END CERTIFICATE-----
&gt;
&gt;
&gt; /etc/riak/ssl.crt:
&gt; -----BEGIN PRIVATE KEY-----
&gt; MIIJQwIBADANBgkqhkiG9w0BAQEFAASCCS0wggkpAgEAAoICAQDmpmrkwyn8/2mP
&gt; HAdh+/OwuP081mEfVpdvIbpAvx5p5DrJ/CPrBFiypuAOIpK4W8yBzLxEo2kYcQLZ
&gt; Qw2oA8/vlMsTFv9PnOPNW/3TkiPuaQS3RXV3QOm9GO1roSscEwRwZbdL+X1vIBeb
&gt; v+I9Gs1KuejlMSryp8/PdJ1dH4HAcrcnjZkSq+SgCvwgL2W9qtYsl/Xw5biHwuSg
&gt; oK13Vaw9gaXRrKlBVmvAua2eLA41tbW1rPw+3DIt9yJ+CK2n99NCcQ3xMlILRiSu
&gt; tmfHIImtg4aBSK7QQM4perApHdNnmz2es+ykXEFMFlF1AN85H2Gre551Ql6sSg3f
&gt; EciF/wS5uVgpZrIAnBgM9hbVk3LJKIpABcUcdE69jswEwix+rX0SfZFja+8Qoy1d
&gt; xV2uFXFzCFA6KwVkA9KwunoGUnoXBpZ2Qi/yi+s35dcx44Vl173dTyD3QWhVTi/m
&gt; VU5CelvRkN5l1vAwwccb6kGrrUuDMpHerg44r17cuXkwMJJ7sjjt8w7p7CGwNXf3
&gt; CcavbXjBPwVbE6s010Zj0rDWOeJ+j2DaLrqoLJaT+Y03UGEdpckjz7Whp6ZiaUVh
&gt; qFmuswTJ+EIWQHQbkkde92Jmyssdiz7dX3DDLjnQIPyvMeqfFAhdog5jGRSgYpmS
&gt; M1tYVjBKtpeDF9a/rc4R2BbOH09H6QIDAQABAoICABtYe6/nm6DNP1yiPBXX40p+
&gt; hDekSxuGDqo0W3q1rgtr7bRo2nFQsJttwX6rhq2o5JQ3C9MvdJRbQbU0h/f1i7+h
&gt; 6nm27kooFbIRSAS/fNcVSGPaLlUXMx8iR3PNReksMAiLZrHxQHfeXC4xD8ei19gW
&gt; NpCFxcvDLZYxAz85Lw78Cs77sLxP+OkopD/EntFf4cijs5r+AWTHLIgGxMozNBqO
&gt; tnQnfmGqt1fAK99m5cBkbMi/W6CwRprAhCxhJwWVEkz8TmTcTHHdvRehtKgdKXWS
&gt; 9G17io5SQJ8WVrBpQtkzxJh+SH4sGenFc57lnZGOMOw92cmZNtRCa2aZGycX1x1c
&gt; OU7s0n0xcnuAniKI+Ee3W2shK6vtQMR8Qsu6Ax2uF+UUJAomr/2bbD8hpk7zwPhO
&gt; 5dQ6RJurWMPRxaK+/vy8+4E6BnwhJ4WsogXaf86409v8eWoy8BYGA3XiOxy7W0eK
&gt; oKcs30Uvq61nqB8Nt/AvsJrYj1flHk/gHn3qBGJor23e92G7TQiBs/DjatD4AdkH
&gt; k8E4b+zvtlI/i/WNuOMimLntKYFgDNnumi5MyZcngv0hYPqdHewvXV/9e6gTw/rn
&gt; hl8m6BMW7bvbXxz0GYGnxCADTW3PWC5Qma+y2SoGNo0unp4VQ6AHPApV5gUvAGaY
&gt; /RKs9CgzlAdphMpUjykBAoIBAQD97WGWoM4+bd9Nyrat1HAQRY+MW/vt67oaTnEV
&gt; EIicwM6TMvyUiFIv6wdmMsyGzlqFwboRGo19WbZP+pIoC46Gs6fqq6Jr8cna5Gme
&gt; n59e2zVxFY1CmCsdAXs5TaG72D4BJkNIWqIBb68jeDglYj5mKpvsDDo3Muqznx04
&gt; uS6+QXKJITR7+sPWalWqeUPIHdIrs3V1BR3/9N1ItfLy8bN/anrTFIMjI+ulZ9xy
&gt; jDitwWCxCMmIyTV0xz5oJ0RYcgnvKS7sRMoII0Q4L+ZBzosSl0U4ksRaZJuB/6ij
&gt; zFUidbMPYVHgvnUx4i5SLY048gu62gyHsntyLUl0RbZB6texAoIBAQDoiGUqGSti
&gt; FyLyPi3Rj00uCsCIeV3oexLXKIHsia+EuULtCJj2kJPFGtks+XC+acP4xEyRjdzr
&gt; JR87uxI5y0FmgjKmEpL0Kn5yBG0N0ioVbnT8YDKywvRJg2z279vm6CrsjuQ8h+ph
&gt; KVRJJEveImcCiuRbzJrBgWC2G4GWlCnLxsSLKfqrsghrCAKFmMqBvsu1hrfRFhCG
&gt; 86CSV3/Jdofd8/up0Y0qMKHB20KFAm3tWceWqlcpdI7l0BDWg4vIBaXkST90Gm4a
&gt; 0XJqfa1NqpuF1z5KZxXMlbHLd5RXqTtFCs/UpJwQSEnNiv3Po6SZI3CwGqYjUo1i
&gt; bqub4uPDgzm5AoIBADDO0QQ38oyzZ8m3Hjf5bnTiOf5bq+gGeGYYD8phvDCNKufG
&gt; VCBkt494WJq/RurefS3al94zwWCHvvBOlItX9VRU8gC8buLavdbyMo8H1YVRE0ui
&gt; Pd3ADAFuSHYyQtUtcnWcGjCtIxitk/d4YypkYOQYapILo6D6i3xtKBvAFIkDYXWU
&gt; SVdPUxdCpya2Wl37xWsa+oe8rRCGy4XvWzxxUvQ5zlQGTFKT0/aeKRRneXmEgwZk
&gt; TwCY1EqXBZrVeWCawugSfW9ypXa8+J7oLhUWE0tGgkqmg1FwpydssciSPQb7oqhh
&gt; J3DQiwxEkmy/TrbUZ4bJ5MCsgOfoZocP40F2V3ECggEBAJAz1ZjP1wmTk4ZqbPui
&gt; RJii7lcz/LqpaDup0TihAgnq4cghJsrxSdJYHgo3/mT3LiLdiSZStYfVk5L1Jg5V
&gt; MA+j+kjnB98HYzbN69tAU/zKbR39gjM9l0TnjfFtOg/uNoBQ9NVc7Eqo2K4rJilx
&gt; aDQ5cfhD4EzUMOd+E1UQOQM4Fra+p8dGNtY5N2cmI59mdOnzy5aMel9WQmO+g26q
&gt; ZQONxKnBXCun0QhpMs1NfmJM5OtYY4k/0UZPS8Hb/hli90ek7QbRRSq4bJ4BpjGd
&gt; 9aiAnQ6C8w/WXVXyqDncpvbgB5a1JlsqmSowYcocj3ywb7emLxWEok1CmIWppNmg
&gt; TXECggEBAIGhKrsG/F5hWEpw5NMU7/i0fWs0bP3uj7rQMbP7KvShl8mtQ5HLARU9
&gt; 45Mv9bQeSfpzfwdEO6BuccVpMiQ1Kw4pXQxJb5Hx4QeAkjJHYmswHaRBbBGEOZHN
&gt; lY37E2MN0Pe41IwyslSrD5p6DA1BKws00BkzkgP+voowmIKtZYuIy60lpPsPdsb1
&gt; vblLLwrqITtWZ+i/+jS2Zhc/azzI4KH985OCXQjikLp+CZ3i2E90APj7sH1M0Bga
&gt; ZoahWO2cnCWPY0Vx1gGVrz6fbDCx/nQB9EaWoNzDAOnEU0PBdKy9SnQBsO6RiEvV
&gt; ZkUzSrUoBPilDSSotFgUZeHfxERupUU=
&gt; -----END PRIVATE KEY-----
&gt;
&gt; On Fri, Jul 13, 2012 at 12:53 PM, Chris Meiklejohn 
&gt; wrote:
&gt;
&gt;&gt; Hi Michael,
&gt;&gt;
&gt;&gt; Does either your cert/key file have two keys in it by chance? If so, one
&gt;&gt; of those is most likely an intermediary cert, which should be placed in
&gt;&gt; it's own file as outlined here (see intermediate authorities, cacertfile):
&gt;&gt;
&gt;&gt; http://wiki.basho.com/Riak-Control.html
&gt;&gt;
&gt;&gt; - Chris
&gt;&gt;
&gt;&gt; Christopher Meiklejohn
&gt;&gt; Software Engineer
&gt;&gt; Basho Technologies, Inc.
&gt;&gt;
&gt;&gt; On Fri, Jul 13, 2012 at 3:45 PM, Michael Johnson wrote:
&gt;&gt;
&gt;&gt;&gt; I've also gave this a try a bit ago using a legit cert from an ssl
&gt;&gt;&gt; provider with the same result. Are you also running on centos 6 using the
&gt;&gt;&gt; binaries provided from http://downloads.basho.com/riak/CURRENT/
&gt;&gt;&gt;
&gt;&gt;&gt; If I need to build my own packages from source, I can do that, but I'd
&gt;&gt;&gt; much prefer to use the pre-built binaries.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Jul 13, 2012 at 11:41 AM, John E. Vincent &lt;
&gt;&gt;&gt; lusis.org+riak-us...@gmail.com&gt; wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; SSL is working for me (for riak-control) using self-signed
&gt;&gt;&gt;&gt; certificates. However I've not yet tried it with an external client.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Fri, Jul 13, 2012 at 2:34 PM, Michael Johnson 
&gt;&gt;&gt;&gt; wrote:
&gt;&gt;&gt;&gt; &gt; I've been having problems getting riak to function via https and have
&gt;&gt;&gt;&gt; not
&gt;&gt;&gt;&gt; &gt; been able to find anything online that seems to help so far. I am
&gt;&gt;&gt;&gt; using a
&gt;&gt;&gt;&gt; &gt; self-signed certificate (which is one I generated specifically for
&gt;&gt;&gt;&gt; this
&gt;&gt;&gt;&gt; &gt; testing, and thus could post as it will not be used for anything
&gt;&gt;&gt;&gt; else) and
&gt;&gt;&gt;&gt; &gt; have it stored as separate .crt and .key files. I've used open SSL to
&gt;&gt;&gt;&gt; &gt; verify the certificate and it appears to be all good. Here is what
&gt;&gt;&gt;&gt; the
&gt;&gt;&gt;&gt; &gt; relevant bits of my app.config look like (I can post the rest as
&gt;&gt;&gt;&gt; needed, but
&gt;&gt;&gt;&gt; &gt; I'm trying to be consise):
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; {http, [{"0.0.0.0", 8091}]},
&gt;&gt;&gt;&gt; &gt; {https, [{"0.0.0.0", 8092}]},
&gt;&gt;&gt;&gt; &gt; {ssl, [
&gt;&gt;&gt;&gt; &gt; {certfile, "/etc/riak/ssl.crt"},
&gt;&gt;&gt;&gt; &gt; {keyfile, "/etc/riak/ssl.key"}
&gt;&gt;&gt;&gt; &gt; ]},
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Starting riak does not generate any errors, and 'riak-admin test'
&gt;&gt;&gt;&gt; works:
&gt;&gt;&gt;&gt; &gt; [root@riak01 riak]# riak-admin test
&gt;&gt;&gt;&gt; &gt; Attempting to restart script through sudo -u riak
&gt;&gt;&gt;&gt; &gt; Successfully completed 1 read/write cycle to '
&gt;&gt;&gt;&gt; r...@riak01.mediatemple.net'
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Manuallly querying riak via http also works fine:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; [root@riak01 riak]# curl -k -vvv
&gt;&gt;&gt;&gt; &gt; http://127.0.0.1:8091/riak/\\_\\_riak\\_client\\_test\\_\\_
&gt;&gt;&gt;&gt; &gt; \\* About to connect() to 127.0.0.1 port 8091 (#0)
&gt;&gt;&gt;&gt; &gt; \\* Trying 127.0.0.1... connected
&gt;&gt;&gt;&gt; &gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8091 (#0)
&gt;&gt;&gt;&gt; &gt;&gt; GET /riak/\\_\\_riak\\_client\\_test\\_\\_ HTTP/1.1
&gt;&gt;&gt;&gt; &gt;&gt; User-Agent: curl/7.19.7 (x86\\_64-redhat-linux-gnu) libcurl/7.19.7
&gt;&gt;&gt;&gt; &gt;&gt; NSS/3.13.1.0 zlib/1.2.3 libidn/1.18 libssh2/1.2.2
&gt;&gt;&gt;&gt; &gt;&gt; Host: 127.0.0.1:8091
&gt;&gt;&gt;&gt; &gt;&gt; Accept: \\*/\\*
&gt;&gt;&gt;&gt; &gt;&gt;
&gt;&gt;&gt;&gt; &gt; &lt; HTTP/1.1 200 OK
&gt;&gt;&gt;&gt; &gt; &lt; Vary: Accept-Encoding
&gt;&gt;&gt;&gt; &gt; &lt; Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
&gt;&gt;&gt;&gt; &gt; &lt; Date: Fri, 13 Jul 2012 18:03:13 GMT
&gt;&gt;&gt;&gt; &gt; &lt; Content-Type: application/json
&gt;&gt;&gt;&gt; &gt; &lt; Content-Length: 410
&gt;&gt;&gt;&gt; &gt; &lt;
&gt;&gt;&gt;&gt; &gt; \\* Connection #0 to host 127.0.0.1 left intact
&gt;&gt;&gt;&gt; &gt; \\* Closing connection #0
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; {"props":{"name":"\\_\\_riak\\_client\\_test\\_\\_","allow\\_mult":false,"basic\\_quorum":false,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dw":1,"last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":1,"notfound\\_ok":true,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[],"pw":0,"r":1,"rw":1,"small\\_vclock":50,"w":1,"young\\_vclock":20}}
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; But the minute I try to connect via https I have problems:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; [root@riak01 riak]# curl -k -vvv
&gt;&gt;&gt;&gt; &gt; https://127.0.0.1:8092/riak/\\_\\_riak\\_client\\_test\\_\\_
&gt;&gt;&gt;&gt; &gt; \\* About to connect() to 127.0.0.1 port 8092 (#0)
&gt;&gt;&gt;&gt; &gt; \\* Trying 127.0.0.1... connected
&gt;&gt;&gt;&gt; &gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8092 (#0)
&gt;&gt;&gt;&gt; &gt; \\* Initializing NSS with certpath: sql:/etc/pki/nssdb
&gt;&gt;&gt;&gt; &gt; \\* warning: ignoring value of ssl.verifyhost
&gt;&gt;&gt;&gt; &gt; \\* NSS error -5938
&gt;&gt;&gt;&gt; &gt; \\* Closing connection #0
&gt;&gt;&gt;&gt; &gt; \\* SSL connect error
&gt;&gt;&gt;&gt; &gt; curl: (35) SSL connect error
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; And I see the following in the logs:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; console.log:
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52.023 [error] &lt;0.5313.0&gt; CRASH REPORT Process
&gt;&gt;&gt;&gt; &lt;0.5313.0&gt;
&gt;&gt;&gt;&gt; &gt; with 0 neighbours crashed with reason:
&gt;&gt;&gt;&gt; &gt; {ekeyfile,[{gen\\_fsm,init\\_it,6},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52.026 [error] &lt;0.134.0&gt; Supervisor
&gt;&gt;&gt;&gt; ssl\\_connection\\_sup had
&gt;&gt;&gt;&gt; &gt; child undefined started with {ssl\\_connection,start\\_link,undefined} at
&gt;&gt;&gt;&gt; &gt; &lt;0.5313.0&gt; exit with reason ekeyfile in context child\\_terminated
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52.031 [error] &lt;0.139.0&gt; application: mochiweb,
&gt;&gt;&gt;&gt; "Accept
&gt;&gt;&gt;&gt; &gt; failed error", "{error,ekeyfile}"
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52.033 [error] &lt;0.139.0&gt; CRASH REPORT Process
&gt;&gt;&gt;&gt; &lt;0.139.0&gt;
&gt;&gt;&gt;&gt; &gt; with 0 neighbours crashed with reason: {error,accept\\_failed}
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52.035 [error] &lt;0.135.0&gt;
&gt;&gt;&gt;&gt; &gt; {mochiweb\\_socket\\_server,310,{acceptor\\_error,{error,accept\\_failed}}}
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; crash.log:
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52 =ERROR REPORT====
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; [83,83,76,58,32,"1112",58,32,"error",58,"[]",32,"/etc/riak/ssl.key","\\n",32,32,[91,[[123,["ssl\\_connection",44,"init\\_private\\_key",44,"5"],125],44,10,"
&gt;&gt;&gt;&gt; &gt; ",[123,["ssl\\_connection",44,"ssl\\_init",44,"2"],125],44,10,"
&gt;&gt;&gt;&gt; &gt; ",[123,["ssl\\_connection",44,"init",44,"1"],125],44,10,"
&gt;&gt;&gt;&gt; &gt; ",[123,["gen\\_fsm",44,"init\\_it",44,"6"],125],44,10,"
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; ",[123,["proc\\_lib",44,"init\\_p\\_do\\_apply",44,"3"],125]],93],"\\n"]2012-07-13
&gt;&gt;&gt;&gt; &gt; 11:05:52 =CRASH REPORT====
&gt;&gt;&gt;&gt; &gt; crasher:
&gt;&gt;&gt;&gt; &gt; initial call: ssl\\_connection:init/1
&gt;&gt;&gt;&gt; &gt; pid: &lt;0.5313.0&gt;
&gt;&gt;&gt;&gt; &gt; registered\\_name: []
&gt;&gt;&gt;&gt; &gt; exception exit: ekeyfile
&gt;&gt;&gt;&gt; &gt; in function gen\\_fsm:init\\_it/6
&gt;&gt;&gt;&gt; &gt; in call from proc\\_lib:init\\_p\\_do\\_apply/3
&gt;&gt;&gt;&gt; &gt; ancestors: [ssl\\_connection\\_sup,ssl\\_sup,&lt;0.130.0&gt;]
&gt;&gt;&gt;&gt; &gt; messages: []
&gt;&gt;&gt;&gt; &gt; links: [&lt;0.134.0&gt;]
&gt;&gt;&gt;&gt; &gt; dictionary: []
&gt;&gt;&gt;&gt; &gt; trap\\_exit: false
&gt;&gt;&gt;&gt; &gt; status: running
&gt;&gt;&gt;&gt; &gt; heap\\_size: 1597
&gt;&gt;&gt;&gt; &gt; stack\\_size: 24
&gt;&gt;&gt;&gt; &gt; reductions: 1185
&gt;&gt;&gt;&gt; &gt; neighbours:
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52 =SUPERVISOR REPORT====
&gt;&gt;&gt;&gt; &gt; Supervisor: {local,ssl\\_connection\\_sup}
&gt;&gt;&gt;&gt; &gt; Context: child\\_terminated
&gt;&gt;&gt;&gt; &gt; Reason: ekeyfile
&gt;&gt;&gt;&gt; &gt; Offender:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; [{pid,&lt;0.5313.0&gt;},{name,undefined},{mfargs,{ssl\\_connection,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,4000},{child\\_type,worker}]
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52 =ERROR REPORT====
&gt;&gt;&gt;&gt; &gt; [{application,mochiweb},"Accept failed
&gt;&gt;&gt;&gt; error","{error,ekeyfile}"]2012-07-13
&gt;&gt;&gt;&gt; &gt; 11:05:52 =CRASH REPORT====
&gt;&gt;&gt;&gt; &gt; crasher:
&gt;&gt;&gt;&gt; &gt; initial call: mochiweb\\_acceptor:init/3
&gt;&gt;&gt;&gt; &gt; pid: &lt;0.139.0&gt;
&gt;&gt;&gt;&gt; &gt; registered\\_name: []
&gt;&gt;&gt;&gt; &gt; exception exit: {error,accept\\_failed}
&gt;&gt;&gt;&gt; &gt; in function mochiweb\\_acceptor:init/3
&gt;&gt;&gt;&gt; &gt; in call from proc\\_lib:init\\_p\\_do\\_apply/3
&gt;&gt;&gt;&gt; &gt; ancestors: ['https\\_0.0.0.0:8092',riak\\_core\\_sup,&lt;0.88.0&gt;]
&gt;&gt;&gt;&gt; &gt; messages: []
&gt;&gt;&gt;&gt; &gt; links: [&lt;0.135.0&gt;,#Port&lt;0.5661&gt;]
&gt;&gt;&gt;&gt; &gt; dictionary: []
&gt;&gt;&gt;&gt; &gt; trap\\_exit: false
&gt;&gt;&gt;&gt; &gt; status: running
&gt;&gt;&gt;&gt; &gt; heap\\_size: 233
&gt;&gt;&gt;&gt; &gt; stack\\_size: 24
&gt;&gt;&gt;&gt; &gt; reductions: 818
&gt;&gt;&gt;&gt; &gt; neighbours:
&gt;&gt;&gt;&gt; &gt; 2012-07-13 11:05:52 =ERROR REPORT====
&gt;&gt;&gt;&gt; &gt; {mochiweb\\_socket\\_server,310,{acceptor\\_error,{error,accept\\_failed}}}
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; erlang.log.1 and error.log (which are identical):
&gt;&gt;&gt;&gt; &gt; 11:05:52.018 [error] SSL: 1112: error:[] /etc/riak/ssl.key
&gt;&gt;&gt;&gt; &gt; [{ssl\\_connection,init\\_private\\_key,5},
&gt;&gt;&gt;&gt; &gt; {ssl\\_connection,ssl\\_init,2},
&gt;&gt;&gt;&gt; &gt; {ssl\\_connection,init,1},
&gt;&gt;&gt;&gt; &gt; {gen\\_fsm,init\\_it,6},
&gt;&gt;&gt;&gt; &gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; 11:05:52.023 [error] CRASH REPORT Process &lt;0.5313.0&gt; with 0 neighbours
&gt;&gt;&gt;&gt; &gt; crashed with reason:
&gt;&gt;&gt;&gt; &gt; {ekeyfile,[{gen\\_fsm,init\\_it,6},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt;&gt;&gt;&gt; &gt; 11:05:52.026 [error] Supervisor ssl\\_connection\\_sup had child undefined
&gt;&gt;&gt;&gt; &gt; started with {ssl\\_connection,start\\_link,undefined} at &lt;0.5313.0&gt; exit
&gt;&gt;&gt;&gt; with
&gt;&gt;&gt;&gt; &gt; reason ekeyfile in context child\\_terminated
&gt;&gt;&gt;&gt; &gt; 11:05:52.031 [error] application: mochiweb, "Accept failed error",
&gt;&gt;&gt;&gt; &gt; "{error,ekeyfile}"
&gt;&gt;&gt;&gt; &gt; 11:05:52.033 [error] CRASH REPORT Process &lt;0.139.0&gt; with 0 neighbours
&gt;&gt;&gt;&gt; &gt; crashed with reason: {error,accept\\_failed}
&gt;&gt;&gt;&gt; &gt; 11:05:52.035 [error]
&gt;&gt;&gt;&gt; &gt; {mochiweb\\_socket\\_server,310,{acceptor\\_error,{error,accept\\_failed}}}
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Everything I am finding says this means my key file is bad. However,
&gt;&gt;&gt;&gt; as
&gt;&gt;&gt;&gt; &gt; previously mentioned, I've verified this with openssl:
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; [root@riak01 riak]# openssl verify /etc/riak/ssl.crt
&gt;&gt;&gt;&gt; &gt; /etc/riak/ssl.crt: C = US, ST = California, L = Culver City, O =
&gt;&gt;&gt;&gt; Default
&gt;&gt;&gt;&gt; &gt; Company Ltd, CN = example.com, emailAddress = ad...@example.com
&gt;&gt;&gt;&gt; &gt; error 18 at 0 depth lookup:self signed certificate
&gt;&gt;&gt;&gt; &gt; OK
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; [root@riak01 riak]# ( openssl x509 -noout -modulus -in
&gt;&gt;&gt;&gt; /etc/riak/ssl.crt |
&gt;&gt;&gt;&gt; &gt; openssl md5; openssl rsa -noout -modulus -in /etc/riak/ssl.key |
&gt;&gt;&gt;&gt; openssl md5
&gt;&gt;&gt;&gt; &gt; ) | uniq
&gt;&gt;&gt;&gt; &gt; (stdin)= b3d4187d8472f2d0b73cf5597d5d65b8
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; I'm just really not sure what else to look at. Everything seems to
&gt;&gt;&gt;&gt; be fine
&gt;&gt;&gt;&gt; &gt; except for that fact it's not working. Does anybody have SSL working
&gt;&gt;&gt;&gt; with
&gt;&gt;&gt;&gt; &gt; self-signed certificate using the basho provided binary packages on
&gt;&gt;&gt;&gt; CentOS
&gt;&gt;&gt;&gt; &gt; 6.3? I'm beginning to thing that they might be the problem and I just
&gt;&gt;&gt;&gt; don't
&gt;&gt;&gt;&gt; &gt; know where to go from here.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; Any suggestions will be appreciated.
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;&gt; &gt; riak-users mailing list
&gt;&gt;&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt;&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

