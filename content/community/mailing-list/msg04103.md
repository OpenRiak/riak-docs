---
title: "Re: best practices on data storage?"
description: ""
project: community
lastmod: 2011-07-27T23:40:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04103"
mailinglist_parent_id: "msg04102"
author_name: "Sylvain Niles"
project_section: "mailinglistitem"
sent_date: 2011-07-27T23:40:46-07:00
---


Hi Rohman, the conversation yesterday got us to thinking and Basho confirmed
that buckets are a form of key prefix. So no matter how small the bucket it
will traverse the whole key space for a map reduce. We sat down and did some
thinking of how to work our data differently as we have a similar use case
to you and decided on nested docs using Ripple. In our case we had special
buckets for each user like you describe below. Now that bucket is a nested
JSON struct inside the user object instead of a separate bucket. In your use
case you could have all statuses as a nested struct on your user object and
display would be a matter of linkwalking all an user's friends and parsing
status content with some time/sorting.

On Wed, Jul 27, 2011 at 11:26 PM, Antonio Rohman Fernandez &lt;
roh...@mahalostudio.com&gt; wrote:

&gt; \\*\\*
&gt;
&gt; Yesterday, somebody suggested that not for having the data distributed on
&gt; smaller buckets, Riak's MapReduce operations would be faster... while nobody
&gt; at Basho confirmed that yet, i'm now wondering which is the best way for
&gt; storing data... lets imagine this simple excercise:
&gt;
&gt; 1. We have entities users, friends, statuses and comments in a web app
&gt; 2. Users can make friends with other users
&gt; 3. Users can post statuses
&gt; 4. Friends ( Users ) can comment on user's statuses
&gt;
&gt; At first i thought on having a bucket called "users" with all users and
&gt; then for friend linkage i was thinking on having personal buckets like
&gt; "rohman\\_friends", "fyodor\\_friends", etc... with the keys to the users
&gt; instead of a big "friends" bucket for easy querying... but seems i'm
&gt; wrong... so...
&gt;
&gt; How would you distribute the data on buckets? and how would you run
&gt; MapReduce jobs? Would you use a support SQL database to store relationship
&gt; between keys? is possible on an only Riak environment?
&gt; thanks
&gt;
&gt; Rohman
&gt; [image: line] [image: logo]  \\*Antonio Rohman
&gt; Fernandez\\*
&gt; CEO, Founder & Lead Engineer
&gt; roh...@mahalostudio.com \\*Projects\\*
&gt; MaruBatsu.es 
&gt; PupCloud.com 
&gt; Wedding Album  [image: line]
&gt;

