---
title: "Re: Ring Cluster and CPU idle time"
description: ""
project: community
lastmod: 2010-12-09T06:04:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01761"
mailinglist_parent_id: "msg01760"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-12-09T06:04:52-08:00
---


If you're using ETS, then yes that makes sense that the majority of the time 
would be CPU (there's no disk to wait on!). One thing - when you say 60% of 
available CPU, is that 60% of one core, or 60% of 12 cores (sometimes reported 
as 720%)? The latter seems highly unlikely.

There are some generic things you can do to tweak Erlang and Riak for multicore 
computers, many of them referenced on this page: 
http://erlang.org/doc/man/erl.html Of special note are:

+A - how many OS threads will be in the async thread pool (handles IO, some 
system calls)
+S - the number of scheduler threads to create (usually 1 thread per CPU)
+sct - specify the CPU topology (useful for NUMA processors like Nehalem)

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Dec 9, 2010, at 5:40 AM, David Dawson wrote:

&gt; Sean,
&gt; 
&gt; We have used the ETS backend, to rule out Disk IO as much as possible 
&gt; and we are pretty sure that our memory IO is fine, this leaves either Network 
&gt; IO being a factor or the erlang VM itself ( highly unlikely ). In further 
&gt; testing we also discovered that just using 1 node in the ring gave us 80% cpu 
&gt; / 0% wait / 17% idle / 3% sys, which could suggest that network chatter 
&gt; between the ring could be the factor, so we are planning to setup the RIAK 
&gt; ring so the handoff and chatter traffic is done over a separate NIC, in your 
&gt; experiences will this help? 
&gt; 
&gt; Dave
&gt; 
&gt; 
&gt; On 8 Dec 2010, at 17:57, Sean Cribbs wrote:
&gt; 
&gt;&gt; David,
&gt;&gt; 
&gt;&gt; It's expected that, especially when running basho\\_bench, your cluster will 
&gt;&gt; not use that much CPU. Riak is mostly I/O-bound, which is a good thing (vs. 
&gt;&gt; wasting CPU not delivering data to you). I would definitely expect network 
&gt;&gt; and disk (and possibly RAM) to be the primary limiting factors.
&gt;&gt; 
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt; 
&gt;&gt; On Dec 8, 2010, at 12:36 PM, David Dawson wrote:
&gt;&gt; 
&gt;&gt;&gt; We are currently running a ring of 3 machines each machine with 12 cores, 
&gt;&gt;&gt; and have noticed that we seem to only be using 60% of available CPU ( other 
&gt;&gt;&gt; 40% is spent idle ) when running basho bench against the cluster. We have 
&gt;&gt;&gt; tried changing the 'n\\_val' from 3 to 1 and also the backend from bitcask to 
&gt;&gt;&gt; ets, and it seems to make no difference. Is this expected? 
&gt;&gt;&gt; 
&gt;&gt;&gt; Also are there any suggested tuning parameters that should be used when 
&gt;&gt;&gt; running riak on machines with lots of cores? and if not what would you 
&gt;&gt;&gt; expect the bottleneck to be in a cluster? ( cpu / disk io/ memory / network 
&gt;&gt;&gt; io )
&gt;&gt;&gt; 
&gt;&gt;&gt; Dave
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

