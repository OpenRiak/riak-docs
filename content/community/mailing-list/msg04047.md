---
title: "Re: When is Vclock generated?"
description: ""
project: community
lastmod: 2011-07-22T19:02:10-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04047"
mailinglist_parent_id: "msg04046"
author_name: "siculars"
project_section: "mailinglistitem"
sent_date: 2011-07-22T19:02:10-07:00
---


That doesn't much make sense to me at all. Also, have you tried getting the 
HEAD? Vclock comes out in the meta, but it and the entire body are read off 
disk. 

Cheers,
Alexander

Sent from my Verizon Wireless BlackBerry

-----Original Message-----
From: Andrew Berman 
Sender: riak-users-boun...@lists.basho.com
Date: Fri, 22 Jul 2011 13:09:10 
To: Sean Cribbs
Cc: riak-users
Subject: Re: When is Vclock generated?

Sean,

Thanks for the reply. I am fetching before write, however, what I
want is the ability to fetch the vclock and use it as a version on the
object itself throughout my application, much how Hibernate uses a
version property. This way I am able to tell if an object is
persistent or not based on whether it has a version or if it is
undefined. So basically I created a version property on my record
which, in turn, gets stored in Riak but this version will never match
the actual vclock when looking at the data itself, since the version
is only ever updated to the previous vclock and not the one after the
object has been updated. Does that make more sense? The version I
store in Riak is pretty worthless so it's not a big deal if it doesn't
match since I update it to the current one when I load the object, but
it would certainly make things easier on me if I could always have the
version match the current vclock, so then I wouldn't have to update
the version on fetches.

--Andrew

On Fri, Jul 22, 2011 at 6:06 AM, Sean Cribbs  wrote:
&gt; Andrew,
&gt; Are you trying to store the vclock as part of the value? I'm
&gt; misunderstanding something.
&gt; Well-behaved clients should always fetch before writing, so your client
&gt; should have the most reasonably-fresh version of the object when you write.
&gt;  There's really no way to guarantee that some other actor won't write a new
&gt; version between the time that you fetch the object and store it back, or
&gt; even in the time between your client issuing the write and it actually being
&gt; written to disk.  Vector clocks and sibling values exist in part to help
&gt; disambiguate those race conditions.  If you're submitting the write without
&gt; the vclock, your write could very well be ignored, so please fetch before
&gt; storing.
&gt;
&gt; On Thu, Jul 21, 2011 at 6:13 PM, Andrew Berman  wrote:
&gt;&gt;
&gt;&gt; I'm looking to store the vclock on my object to be used for
&gt;&gt; versioning.   Currently, when I get the object from Riak I fill in the
&gt;&gt; version with the vclock from Riak (which I use to determine if the
&gt;&gt; object is persistent and for passing back to Riak when putting) and
&gt;&gt; then when the object is saved it saves the version as the previous
&gt;&gt; vclock value.  I'm wondering when the vclock is actually generated.
&gt;&gt; Can I write a pre-commit hook that fills in the version so it has the
&gt;&gt; most updated value or is there no way for me to do it.  It's not a
&gt;&gt; huge deal because the version value in the db is immediately updated
&gt;&gt; upon loading the data from Riak, but I just feel like it would make
&gt;&gt; things more consistent if I could have the version matching the
&gt;&gt; updated vclock.
&gt;&gt;
&gt;&gt; Thanks for any help!
&gt;&gt;
&gt;&gt; Andrew
&gt;&gt;
&gt;&gt;\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://www.basho.com/
&gt;
