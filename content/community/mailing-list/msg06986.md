---
title: "Re: Listing buckets causes nodes to misbehave"
description: ""
project: community
lastmod: 2012-03-16T12:48:17-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06986"
mailinglist_parent_id: "msg06972"
author_name: "Armon Dadgar"
project_section: "mailinglistitem"
sent_date: 2012-03-16T12:48:17-07:00
---


Interesting, so it's not just us. Based on the behavior,
I'm guessing that listing the buckets requires traversing the
key space?


&gt; Message: 2
&gt; Date: Thu, 15 Mar 2012 11:19:15 -0700
&gt; From: Aphyr 
&gt; To: riak-users@lists.basho.com
&gt; Subject: Re: Listing buckets causes nodes to misbehave
&gt; Message-ID: &lt;4f6232a3.5050...@aphyr.com&gt;
&gt; Content-Type: text/plain; charset=ISO-8859-1; format=flowed
&gt; 
&gt; Yup, list-keys and list-buckets does this for us too, since Riak 0.14. 
&gt; Bitcask, 6 nodes, physical hardware, 1024 partitions, 100-300 million 
&gt; keys with n\\_val 3.
&gt; 
&gt; --Kyle
&gt; 
&gt; On 03/15/2012 11:17 AM, Armon Dadgar wrote:
&gt;&gt; We are currently running Riak 1.1 in production, using LevelDB
&gt;&gt; with snappy compression and yesterday we ran into a strange
&gt;&gt; issue where listing the buckets via:
&gt;&gt; 
&gt;&gt; $ curl "http://east-riak-001:8098/riak?buckets=true"
&gt;&gt; 
&gt;&gt; Doing this caused curl to hang indefinitely, and the target node to
&gt;&gt; freak out.
&gt;&gt; Symptoms included a massive increase in system load (2-3x), FSM timings
&gt;&gt; exploding
&gt;&gt; from ~30-50 msec to 500 - 5000 msec, and most of the APIs becoming
&gt;&gt; totally unresponsive.
&gt;&gt; 
&gt;&gt; We ran this on a few nodes on the cluster, which basically brought
&gt;&gt; everything to a halt. Our solution was to just reboot all the nodes, at
&gt;&gt; which point things returned to normal.
&gt;&gt; 
&gt;&gt; Curious if anybody else has experienced this.
&gt;&gt; 
&gt;&gt; Best Regards,
&gt;&gt; 
&gt;&gt; Armon Dadgar
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
