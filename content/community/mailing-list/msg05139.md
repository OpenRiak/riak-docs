---
title: "Re: Basho Bench HTTP Inserts Causing Innostore Crashes"
description: ""
project: community
lastmod: 2011-10-12T10:51:59-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05139"
mailinglist_parent_id: "msg05137"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-10-12T10:51:59-07:00
---


Brian,

I've reproduced your problem. From the initial review, it looks like there is 
an issue with basho\\_bench and the way it assembles URLs. There also appears to 
be a small problem with Innostore and key creation. We'll be investigating 
these more and opening some bugzilla issues for them soon. I'll send an update 
with links to those issues at that time so you can track the progress on them. 
Thanks for the report!

Kelly


On Oct 12, 2011, at 9:49 AM, Brian Bickerton wrote:

&gt; Riak version: 1.0.0
&gt; Backend: InnoStore 1.0.3.1
&gt; 4-node cluster
&gt; 
&gt; I've gotten http basho bench to run successfully with the Bitcask and LevelDB 
&gt; backends, but I'm having trouble with Innostore. I get no throughput and all 
&gt; errors. The logs show children crashing due to a "bad argument in call to 
&gt; erlang:size(undefined)". Basic inserts from curl work and I was able to 
&gt; install rekon, which leads me to believe it's an issue with the bench testing 
&gt; itself. Rate and concurrency don't appear to matter. 
&gt; 
&gt; Error log snip:
&gt; 
&gt; 2011-10-12 15:28:49.060 [error] &lt;0.4751.1&gt; gen\\_fsm &lt;0.4751.1&gt; in state active 
&gt; terminated with reason: bad argument in call to erlang:size(undefined) in 
&gt; innostore:get/2
&gt; 2011-10-12 15:28:49.061 [error] &lt;0.4751.1&gt; CRASH REPORT Process &lt;0.4751.1&gt; 
&gt; with 0 neighbours crashed with reason: bad argument in call to 
&gt; erlang:size(undefined) in innostore:get/2
&gt; 2011-10-12 15:28:49.061 [error] &lt;0.95.0&gt; Supervisor riak\\_core\\_vnode\\_sup had 
&gt; child undefined started with {riak\\_core\\_vnode,start\\_link,undefined} at 
&gt; &lt;0.4751.1&gt; exit with reason bad argument in call to erlang:size(undefined) in 
&gt; innostore:get/2 in context child\\_terminated
&gt; 
&gt; Crash Log snip:
&gt; 
&gt; 2011-10-12 15:28:43 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\\_core\\_vnode:init/1
&gt; pid: &lt;0.4734.1&gt;
&gt; registered\\_name: []
&gt; exception exit: 
&gt; {badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak\\_kv\\_innostore\\_backend,get,3},{riak\\_kv\\_vnode,do\\_get\\_term,3},{riak\\_kv\\_vnode,do\\_get,4},{riak\\_core\\_vnode,vnode\\_command,3},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; in function gen\\_fsm:terminate/7
&gt; in call from proc\\_lib:init\\_p\\_do\\_apply/3
&gt; ancestors: [riak\\_core\\_vnode\\_sup,riak\\_core\\_sup,&lt;0.91.0&gt;]
&gt; messages: [{'EXIT',&lt;0.4736.1&gt;,shutdown},{'EXIT',#Port&lt;0.14591&gt;,normal}]
&gt; links: [&lt;0.95.0&gt;]
&gt; dictionary: 
&gt; [{{innostore,{store,#Port&lt;0.14591&gt;,&lt;&lt;105,0,0,0,0,0,0,0&gt;&gt;,0}},{store,#Port&lt;0.14591&gt;,&lt;&lt;105,0,0,0,0,0,0,0&gt;&gt;,0}}]
&gt; trap\\_exit: true
&gt; status: running
&gt; heap\\_size: 610
&gt; stack\\_size: 24
&gt; reductions: 3941
&gt; neighbours:
&gt; 2011-10-12 15:28:43 =SUPERVISOR REPORT====
&gt; Supervisor: {local,riak\\_core\\_vnode\\_sup}
&gt; Context: child\\_terminated
&gt; Reason: 
&gt; {badarg,[{erlang,size,[undefined]},{innostore,get,2},{riak\\_kv\\_innostore\\_backend,get,3},{riak\\_kv\\_vnode,do\\_get\\_term,3},{riak\\_kv\\_vnode,do\\_get,4},{riak\\_core\\_vnode,vnode\\_command,3},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; Offender: 
&gt; [{pid,&lt;0.4734.1&gt;},{name,undefined},{mfargs,{riak\\_core\\_vnode,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,300000},{child\\_type,worker}]
&gt; 
&gt; Basho Bench config (worked with Bitcask and LevelDB):
&gt; 
&gt; {mode, max}
&gt; {duration, 300}.
&gt; {concurrent, 1000}.
&gt; {driver, basho\\_bench\\_driver\\_http\\_raw}.
&gt; {code\\_paths, ["deps/ibrowse"]}.
&gt; {http\\_raw\\_ips, [the, four, node, addresses]}.
&gt; {key\\_generator, {partitioned\\_sequential\\_int, 500000000}}.
&gt; {value\\_generator, {fixed\\_bin, 15}}.
&gt; {http\\_raw\\_port, 8098}.
&gt; {http\\_raw\\_path, "/riak/holder"}.
&gt; {operations, [{insert, 1}]}.
&gt; 
&gt; Any help would be greatly appreciated.
&gt; 
&gt; Brian Bickerton
&gt; Web Engineer
&gt; OmniTI Computer Consulting, Inc.
&gt; 
