---
title: "Complete Riak failure."
description: ""
project: community
lastmod: 2010-08-09T06:55:21-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00853"
author_name: "Richard Heycock"
project_section: "mailinglistitem"
sent_date: 2010-08-09T06:55:21-07:00
---


I've been running riak for about a month and I'm using it as a
persistent cache. Everything has been fine until tonight that is where
it appears to have had a catastrophic failure. Basically when I make a
request using the http interface I get a failure. I cannot be more
specific than that as there is no response code back; I think it's
getting a TCP reset ...

... That was about 10 minutes ago. When I tried to find out if I was
getting a TCP reset I restarted th program and everything was fine.

Anyway most of the errors look like this:


=ERROR REPORT==== 9-Aug-2010::13:23:27 ===
{mochiweb\\_socket\\_server,256,{acceptor\\_error,{error,accept\\_failed}}}

=ERROR REPORT==== 9-Aug-2010::13:23:27 ===
 application: mochiweb
 "Accept failed error"
 "{error,emfile}"

And every so often I get:

=ERROR REPORT==== 9-Aug-2010::13:23:56 ===
\\*\\* State machine &lt;0.17333.0&gt; terminating 
\\*\\* Last event in was {riak\\_vnode\\_req\\_v1,
 182687704666362864775460604089535377456991567872,
 {fsm,undefined,&lt;0.17335.0&gt;},
 {riak\\_kv\\_put\\_req\\_v1,
 {&lt;&lt;"uris"&gt;&gt;,
 &lt;&lt;"5ea5dc023dd73b5f711efde3d50b9e91da4c5027"&gt;&gt;},
 {r\\_object,&lt;&lt;"uris"&gt;&gt;,
 &lt;&lt;"5ea5dc023dd73b5f711efde3d50b9e91da4c5027"&gt;&gt;,
 [{r\\_content,
 {dict,5,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 {{[],[],
 [[&lt;&lt;"Links"&gt;&gt;]],
 [],[],[],[],[],[],[],
 [[&lt;&lt;"content-type"&gt;&gt;,97,112,112,108,105,99,97,
 116,105,111,110,47,106,115,111,110],
 [&lt;&lt;"X-Riak-VTag"&gt;&gt;,49,102,84,99,107,121,67,100,
 81,67,83,85,102,67,102,118,68,55,80,50,82,118]],
 [],[],
 [[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|
 {1281,360236,222890}]],
 [],
 [[&lt;&lt;"X-Riak-Meta"&gt;&gt;]]}}},
 
&lt;&lt;"{\\"uri\\":\\"http://feedproxy.google.com/~r/time/politics/~3/SGIQlFYkIy8/0,8599,2006898,00.html\\",\\"download\\_date\\":\\"20100809132314\\"}"&gt;&gt;}],
 [{&lt;&lt;2,235,89,160&gt;&gt;,{1,63448579436}}],
 {dict,1,16,16,8,80,48,
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
 [[clean|true]],
 []}}},
 undefined},
 118194806,63448579436,
 [{returnbody,true}]}}
\\*\\* When State == active
\\*\\* Data == {state,182687704666362864775460604089535377456991567872,
 riak\\_kv\\_vnode,
 {state,182687704666362864775460604089535377456991567872,
 riak\\_kv\\_bitcask\\_backend,
 {#Ref&lt;0.0.0.23192&gt;,
 
"/var/lib/riak/bitcask/182687704666362864775460604089535377456991567872"},
 [],false},
 undefined,none}
\\*\\* Reason for termination = 
\\*\\* {bad\\_return\\_value,{error,{write\\_locked,emfile}}}


I've put a full log here:

 http://stuff.roughage.com.au/riak-failure.log.gz

It's nearly midnight here and I going to bed but if anyone can shed any
light on this that'd cool.

rgh

-- 
+61 (0) 410 646 369
[e]: r...@roughage.com.au
[im]: r...@jabber.org

You're worried criminals will continue to penetrate into cyberspace, and
I'm worried complexity, poor design and mismanagement will be there to meet
them - Marcus Ranum

