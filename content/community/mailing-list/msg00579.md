---
title: "Re: include mapByFields in riak by default"
description: ""
project: community
lastmod: 2010-06-12T09:22:20-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00579"
mailinglist_parent_id: "msg00578"
author_name: "francisco treacy"
project_section: "mailinglistitem"
sent_date: 2010-06-12T09:22:20-07:00
---


Great! Thanks for creating the issue.

2010/6/12 Andy Gross :
&gt;
&gt; I'm already all up in Bugzilla today, so I just
&gt; created http://issues.basho.com/show\\_bug.cgi?id=237 to track this.  I'm in
&gt; favor of adding it too.
&gt; Andy Gross 
&gt; VP, Engineering
&gt; Basho Technologies, Inc.
&gt; http://basho.com
&gt;
&gt; On Sat, Jun 12, 2010 at 9:53 AM, Sean Cribbs  wrote:
&gt;&gt;
&gt;&gt; Best thing is to open a Bugzilla issue so it can get scheduled for a
&gt;&gt; release.  I for one am in favor of it.
&gt;&gt;
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;&gt; On Jun 12, 2010, at 9:44 AM, francisco treacy wrote:
&gt;&gt;
&gt;&gt; &gt; So what do you guys think? It is a bad idea?
&gt;&gt; &gt;
&gt;&gt; &gt; 2010/6/6 francisco treacy :
&gt;&gt; &gt;&gt; I find myself using a lot this kind of functions (this one
&gt;&gt; &gt;&gt; inspired/borrowed from Sean Cribbs) - a sort of SQL's conditions
&gt;&gt; &gt;&gt; ("where").
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Riak.mapByFields = function(value, keyData, fields) {
&gt;&gt; &gt;&gt;   if(!value.not\\_found){
&gt;&gt; &gt;&gt;     var object = Riak.mapValuesJson(value)[0];
&gt;&gt; &gt;&gt;     for(field in fields) {
&gt;&gt; &gt;&gt;         if(object[field] != fields[field])
&gt;&gt; &gt;&gt;             return [];
&gt;&gt; &gt;&gt;     }
&gt;&gt; &gt;&gt;     return [object];
&gt;&gt; &gt;&gt;   } else {
&gt;&gt; &gt;&gt;     return [];
&gt;&gt; &gt;&gt;   }
&gt;&gt; &gt;&gt; }
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Usage:
&gt;&gt; &gt;&gt; {"inputs":"test",
&gt;&gt; &gt;&gt;  "query":[{"map":{"language":"javascript",
&gt;&gt; &gt;&gt;                  "name":"Riak.mapByFields",
&gt;&gt; &gt;&gt;                  "arg": { "city": "Paris" },
&gt;&gt; &gt;&gt;                  "keep":true}}]
&gt;&gt; &gt;&gt; }
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Any real-world app \\*always\\* needs to query data by fields.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Would it be a good idea to ship this by default in Riak?  I do believe
&gt;&gt; &gt;&gt; so because it is sufficiently general purpose (just as
&gt;&gt; &gt;&gt; Riak.mapValuesJson).
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; A lot of libraries (for instance devise-ripple) could build upon this
&gt;&gt; &gt;&gt; function without forcing clients/users to alter their app.config,
&gt;&gt; &gt;&gt; define a js\\_source, and include the function in all their nodes.
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; What do you think?
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; Francisco
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;

