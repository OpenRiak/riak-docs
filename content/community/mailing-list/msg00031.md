---
title: "Re: Issue with riak_client:list_keys"
description: ""
project: community
lastmod: 2010-04-13T12:56:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00031"
mailinglist_parent_id: "msg00029"
author_name: "Grant Schofield"
project_section: "mailinglistitem"
sent_date: 2010-04-13T12:56:48-07:00
---


This isn't expected behavior and I haven't been able to duplicate the behavior 
in my 0.9.1 install with an ETS backend. What version of Riak are you running 
and were there any errors in your sas-error.log? I would try restarting your 
node and seeing if the same behavior persists. If it does please send us your 
app.config and vm.args files.

Grant Schofield
Developer Advocate
Basho Technologies, Inc.


On Apr 13, 2010, at 2:08 PM, Alexander Zhuravlev wrote:

&gt; On Tue, Apr 13, 2010 at 11:03 PM, Dan Reverri  wrote:
&gt;&gt; This list\\_keys method is updated asynchronously so it may not immediately
&gt;&gt; reflect the addition or removal of keys. The list\\_keys method should
&gt;&gt; eventually reflect the deletion of the key. Can you try running list\\_keys
&gt;&gt; after a delay?
&gt; 
&gt; We have just run the following command:
&gt; 
&gt; (r...@macbook-siden)9&gt; C:list\\_keys(&lt;&lt;"aaa"&gt;&gt;).
&gt; {ok,[&lt;&lt;"key1"&gt;&gt;]}
&gt; 
&gt; it still shows the same information (it has been about 5 hours since
&gt; we run the first C:list\\_keys command).
&gt; 
&gt;&gt; On Tue, Apr 13, 2010 at 11:13 AM, Alexander Zhuravlev
&gt;&gt;  wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt; Hello,
&gt;&gt;&gt; 
&gt;&gt;&gt; We are having an issue with riak\\_client:list\\_keys function.
&gt;&gt;&gt; The thing is that the function returns information about the keys which
&gt;&gt;&gt; were successfully deleted from a bucket. For example, please check
&gt;&gt;&gt; output from our tests below:
&gt;&gt;&gt; 
&gt;&gt;&gt; (r...@macbook-siden)1&gt; {ok, C} =
&gt;&gt;&gt; riak:client\\_connect('r...@macbook-siden').
&gt;&gt;&gt; {ok,{riak\\_client,'r...@macbook-siden',&lt;&lt;7,122,127,92&gt;&gt;}}
&gt;&gt;&gt; (r...@macbook-siden)2&gt; O0 = riak\\_object:new(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;,
&gt;&gt;&gt; "val1").
&gt;&gt;&gt; {r\\_object,&lt;&lt;"aaa"&gt;&gt;,&lt;&lt;"key1"&gt;&gt;,
&gt;&gt;&gt; [{r\\_content,{dict,0,16,16,8,80,48,
&gt;&gt;&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;&gt;&gt; {{[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt;&gt;&gt; "val1"}],
&gt;&gt;&gt; [],
&gt;&gt;&gt; {dict,1,16,16,8,80,48,
&gt;&gt;&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;&gt;&gt; {{[],[],[],[],[],[],[],[],[],[],[],[],[],...}}},
&gt;&gt;&gt; undefined}
&gt;&gt;&gt; (r...@macbook-siden)3&gt; C:put(O0, 2).
&gt;&gt;&gt; ok
&gt;&gt;&gt; (r...@macbook-siden)4&gt; C:list\\_keys(&lt;&lt;"aaa"&gt;&gt;).
&gt;&gt;&gt; {ok,[&lt;&lt;"key1"&gt;&gt;]}
&gt;&gt;&gt; (r...@macbook-siden)5&gt; C:delete(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;, 2).
&gt;&gt;&gt; ok
&gt;&gt;&gt; (r...@macbook-siden)6&gt; C:get(&lt;&lt;"aaa"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;, 2).
&gt;&gt;&gt; {error,notfound}
&gt;&gt;&gt; (r...@macbook-siden)7&gt; C:list\\_keys(&lt;&lt;"aaa"&gt;&gt;).
&gt;&gt;&gt; {ok,[&lt;&lt;"key1"&gt;&gt;]}
&gt;&gt;&gt; 
&gt;&gt;&gt; backend = ets
&gt;&gt;&gt; riak 0.9.1
&gt;&gt;&gt; 
&gt;&gt;&gt; As you can see the key was successfully deleted (as it can be confirmed by
&gt;&gt;&gt; the output from riak\\_client:get call), but riak\\_client:list\\_keys still
&gt;&gt;&gt; reports that the key
&gt;&gt;&gt; exists in the bucket. Is this the intended behavior of did we hit a bug in
&gt;&gt;&gt; riak?
&gt;&gt;&gt; Please advise.
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks.
&gt;&gt;&gt; 
&gt;&gt;&gt; --
&gt;&gt;&gt; Alexander Zhuravlev
&gt;&gt;///&gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Alexander Zhuravlev
&gt; 
