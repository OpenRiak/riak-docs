---
title: "Re: riak not starting properly"
description: ""
project: community
lastmod: 2010-10-29T07:23:08-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01401"
mailinglist_parent_id: "msg01400"
author_name: "Grant Schofield"
project_section: "mailinglistitem"
sent_date: 2010-10-29T07:23:08-07:00
---


This looks like a ulimit issue, can you try increasing it with the following 
command: ulimit -n 2056 
Are you on OS X or Linux?

Grant


On Oct 28, 2010, at 11:25 PM, Richard Heycock wrote:

&gt; Hi Grant,
&gt; 
&gt; Sorry for taking so taking so long getting back to you I had to go
&gt; overseas at short notice.
&gt; 
&gt; Excerpts from Grant Schofield's message of 2010-09-18 02:13:04 +1000:
&gt;&gt; There looks like there are some strange things happening in the logs with 
&gt;&gt; the ring as well as timeouts. I would be curious how long the process takes 
&gt;&gt; to die if you were just to run a stop instead of a restart. Did you at one 
&gt;&gt; time change the name of this node? 
&gt; 
&gt; It takes about 4.5 seconds (wall time).
&gt; 
&gt; I haven't changed the name of the node and the app.config is as per the
&gt; Debian package.
&gt; 
&gt; I should also that there is only one node.
&gt; 
&gt;&gt; One thing that might be interesting to try is to stop the server, make a 
&gt;&gt; copy of your data directory, remove all the data in the data directory, and 
&gt;&gt; try to start and stop the node and see if it works more reliably.
&gt; 
&gt; I tried removing all the data from the data directory as you suggested
&gt; and for a while it worked but the problem has started again.
&gt; 
&gt; The bitcask directory is 1.5G in size and the ring directory is 24K. The
&gt; bucket properties are:
&gt; 
&gt; {
&gt; "props": {
&gt; "name": "uris",
&gt; "n\\_val": 3,
&gt; "allow\\_mult": false,
&gt; "last\\_write\\_wins": false,
&gt; "precommit": [
&gt; 
&gt; ],
&gt; "postcommit": [
&gt; 
&gt; ],
&gt; "chash\\_keyfun": {
&gt; "mod": "riak\\_core\\_util",
&gt; "fun": "chash\\_std\\_keyfun"
&gt; },
&gt; "linkfun": {
&gt; "mod": "riak\\_kv\\_wm\\_link\\_walker",
&gt; "fun": "mapreduce\\_linkfun"
&gt; },
&gt; "old\\_vclock": 86400,
&gt; "young\\_vclock": 20,
&gt; "big\\_vclock": 50,
&gt; "small\\_vclock": 10,
&gt; "r": "quorum",
&gt; "w": "quorum",
&gt; "dw": "quorum",
&gt; "rw": "quorum"
&gt; }
&gt; }
&gt; 
&gt; I also tried to get the properties with the keys=true option but after
&gt; 10 minutes of no activity (the 1, 5 and 10 minute load averages were
&gt; all zero) I killed the process. The only indication of any activity was
&gt; the following log message every minute:
&gt; 
&gt; ERROR REPORT==== 29-Oct-2010::04:19:43 ===
&gt; \\*\\* Generic server riak\\_kv\\_vnode\\_master terminating 
&gt; \\*\\* Last message in was {'$gen\\_cast',
&gt; {riak\\_vnode\\_req\\_v1,
&gt; 
&gt; 1141798154164767904846628775559596109106197299200,
&gt; ignore,
&gt; 
&gt; {riak\\_kv\\_listkeys\\_req\\_v2,&lt;&lt;"uris"&gt;&gt;,92166134,
&gt; &lt;0.2635.0&gt;}}}
&gt; \\*\\* When Server state == {state,679956,[],undefined,riak\\_kv\\_vnode,
&gt; riak\\_kv\\_legacy\\_vnode}
&gt; \\*\\* Reason for termination == 
&gt; \\*\\* {{badmatch,{error,{{badmatch,{error,emfile}},
&gt; [{bitcask,scan\\_key\\_files,3},
&gt; {bitcask,open,2},
&gt; {riak\\_kv\\_bitcask\\_backend,start,2},
&gt; {riak\\_kv\\_vnode,init,1},
&gt; {riak\\_core\\_vnode,init,1},
&gt; {gen\\_fsm,init\\_it,6},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]}}},
&gt; [{riak\\_core\\_vnode\\_master,get\\_vnode,2},
&gt; {riak\\_core\\_vnode\\_master,handle\\_cast,2},
&gt; {gen\\_server,handle\\_msg,5},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; 
&gt; 
&gt; The logs can be found here:
&gt; 
&gt; http://stuff.roughage.com.au/riak-failure-3.log.tar.gz
&gt; 
&gt; rgh
&gt; 
&gt; 
&gt;&gt; Grant Schofield
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies
&gt;&gt; 
&gt;&gt; On Sep 16, 2010, at 4:53 PM, Richard Heycock wrote:
&gt;&gt; 
&gt;&gt;&gt; Over the last few weeks I've been finding it harder and harder to start
&gt;&gt;&gt; riak which given that it's running on an auto-provisioned ec2 instance is
&gt;&gt;&gt; a bit of an issue! I can generally restart it by running
&gt;&gt;&gt; /etc/init.d/riak restart but it's got to the stage where I have to run
&gt;&gt;&gt; it four or five times. I should clarify here that when I say "harder to
&gt;&gt;&gt; start" it does start but as soon as I try to do anything it fails.
&gt;&gt;&gt; 
&gt;&gt;&gt; The contents of /var/log/riak are here:
&gt;&gt;&gt; 
&gt;&gt;&gt; http://stuff.roughage.com.au/riak-failure-2.log.tar.gz
&gt;&gt;&gt; 
&gt;&gt;&gt; rgh
&gt;&gt;&gt; -- 
&gt;&gt;&gt; Richard Heycock
&gt;&gt;&gt; 
&gt;&gt;&gt; http://topikality.com
&gt;&gt;&gt; 
&gt;&gt;&gt; +61 (0) 410 646 369
&gt;&gt;&gt; [e]: r...@topikality.com
&gt;&gt;&gt; [im]: r...@topikality.com
&gt;&gt;&gt; 
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; 
&gt; -- 
&gt; Richard Heycock
&gt; 
&gt; http://topikality.com
&gt; 
&gt; +61 (0) 410 646 369
&gt; [e]: r...@topikality.com
&gt; [im]: r...@topikality.com
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

