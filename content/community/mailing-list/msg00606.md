---
title: "Updating objects in the Erlang PBC Client"
description: ""
project: community
lastmod: 2010-06-15T12:30:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00606"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2010-06-15T12:30:07-07:00
---


I've been taking a look at how riakc\\_obj is used in the erlang PBC 
client after the issue of updating metadata was brought up by Mikl 
Kurkov a few weeks ago.


The typical use case for the library is to get some data from the 
server, and then sometimes modify it/write it back again. With the 
current riakc\\_obj you have to set both the metadata and the value for 
update or data will be lost. I've changed the library so that if there 
are no siblings, updating the value or the metadata will leave the other 
intact. If there are siblings you can base the result on one of them 
using the new riakc\\_obj:select\\_sibling/2 call. The library also throws 
descriptive atoms rather than badmatch when you try and use calls that 
only work for objects without siblings.


Here's an example of updating links under the new API (before you would 
have had to add an additional step of retrieving the value from O1 and 
re-setting it in O2).


 {ok, Pid} = start\\_link(Ip, Port),
 O0 = riakc\\_obj:new(&lt;&lt;"b"&gt;&gt;, &lt;&lt;"k"&gt;&gt;, &lt;&lt;"d"&gt;&gt;),
 {ok, O1} = riakc\\_pb\\_socket:put(Pid, O0, [return\\_body]),
 M1 = riakc\\_obj:get\\_metadata(O1),
 M2 = dict:store(?MD\\_LINKS, [{{&lt;&lt;"b"&gt;&gt;, &lt;&lt;"k1"&gt;&gt;}, 
&lt;&lt;"t1"&gt;&gt;}], M1),

 O2 = riakc\\_obj:update\\_metadata(O1, M2),
 riakc\\_pb\\_socket:put(Pid, O2)

I plan to push the changes into the main repo in a few days. To give 
people a chance to play with them ahead of time I've forked the repo here


 http://bitbucket.org/jon\\_meredith/riak-erlang-client-updobj

Let me know if anybody has concerns/feedback about the change.

--Jon.

