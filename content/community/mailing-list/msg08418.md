---
title: "Re: How to search objects using riak_search method"
description: ""
project: community
lastmod: 2012-08-31T00:14:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08418"
mailinglist_parent_id: "msg08417"
author_name: "郎咸武"
project_section: "mailinglistitem"
sent_date: 2012-08-31T00:14:47-07:00
---


Creating object like this:
 f(O),O=riakc\\_obj:new(&lt;&lt;"user"&gt;&gt;, &lt;&lt;"jason"&gt;&gt;,
list\\_to\\_binary("[{\\"name\\":\\"jason\\"},{\\"sex\\":\\"male\\"}]"),
"application/json").


72&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user2"&gt;&gt;,
list\\_to\\_binary("\\"sex\\":\\"male\\"")).
{ok,{search\\_results,[{&lt;&lt;"user2"&gt;&gt;,
 [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
 {&lt;&lt;"name"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
 {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male"&gt;&gt;}]}],
 0.35355299711227417,1}}
73&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user2"&gt;&gt;,
list\\_to\\_binary("\\"sex\\":\\"mal\\*\\"")). \\*%% But this is empty. Why?\\*
{ok,{search\\_results,[],0.0,0}}
74&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user2"&gt;&gt;,
list\\_to\\_binary("\\"sex\\":\\"male\\"")).
{ok,{search\\_results,[{&lt;&lt;"user2"&gt;&gt;,
 [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
 {&lt;&lt;"name"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},
 {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male"&gt;&gt;}]}],
 0.35355299711227417,1}}


2012/8/31 郎咸武 

&gt; anyone may reply me,thanks a lot.
&gt;
&gt; 在 2012年8月30日星期四，郎咸武 写道：
&gt;
&gt;&gt; who can give me some idea
&gt;&gt;
&gt;&gt; 在 2012年8月30日星期四，郎咸武 写道：
&gt;&gt;
&gt;&gt; Hi guys,
&gt;&gt; I need your help.
&gt;&gt;
&gt;&gt; Version:
&gt;&gt; 1)riak-erlang-client-1.3
&gt;&gt; 2)riak-1.2
&gt;&gt; 3)Erlang R14B04 (erts-5.8.5) [source] [64-bit]
&gt;&gt;
&gt;&gt; This is my bucket attributs in the following
&gt;&gt;
&gt;&gt; (riak@127.0.0.1)52&gt; {ok,C} = riak:local\\_client().
&gt;&gt;
&gt;&gt; {ok,{riak\\_client,'riak@127.0.0.1',undefined}}
&gt;&gt; (riak@127.0.0.1)53&gt; C:set\\_bucket(&lt;&lt;"user"&gt;&gt;,[{precommit,
&gt;&gt; [{struct,[{&lt;&lt;"mod"&gt;&gt;,&lt;&lt;"riak\\_search\\_kv\\_hook"&gt;&gt;},{&lt;&lt;"fun"&gt;&gt;,&lt;&lt;"precommit"&gt;&gt;}]}]}]).
&gt;&gt; ok
&gt;&gt; (riak@127.0.0.1)54&gt; C:get\\_bucket(&lt;&lt;"user"&gt;&gt;).
&gt;&gt;
&gt;&gt; [{search,true},
&gt;&gt; {allow\\_mult,false},
&gt;&gt; {basic\\_quorum,false},
&gt;&gt; {big\\_vclock,50},
&gt;&gt; {chash\\_keyfun,{riak\\_core\\_util,chash\\_std\\_keyfun}},
&gt;&gt; {dw,quorum},
&gt;&gt; {last\\_write\\_wins,false},
&gt;&gt; {linkfun,{modfun,riak\\_kv\\_wm\\_link\\_walker,mapreduce\\_linkfun}},
&gt;&gt; {n\\_val,3},
&gt;&gt; {name,&lt;&lt;"user"&gt;&gt;},
&gt;&gt; {notfound\\_ok,true},
&gt;&gt; {old\\_vclock,86400},
&gt;&gt; {postcommit,[]},
&gt;&gt; {pr,0},
&gt;&gt; \\* {precommit,[{struct,[{&lt;&lt;"mod"&gt;&gt;,&lt;&lt;"riak\\_search\\_kv\\_hook"&gt;&gt;},\\*
&gt;&gt; \\* {&lt;&lt;"fun"&gt;&gt;,&lt;&lt;"precommit"&gt;&gt;}]}]},\\*
&gt;&gt; {pw,0},
&gt;&gt; {r,quorum},
&gt;&gt; {rw,quorum},
&gt;&gt; {small\\_vclock,50},
&gt;&gt; {w,quorum},
&gt;&gt; {young\\_vclock,20}]
&gt;&gt;
&gt;&gt; \\*------------------\\*
&gt;&gt; \\*In the client\\*
&gt;&gt; \\*To new a object and search it\\*
&gt;&gt; 147&gt; f(O),O=riakc\\_obj:new(&lt;&lt;"user"&gt;&gt;, &lt;&lt;"jason"&gt;&gt;, &lt;&lt;"jasonlang"&gt;&gt;)
&gt;&gt; 147&gt; .
&gt;&gt; {riakc\\_obj,&lt;&lt;"user"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;,undefined,[],undefined,
&gt;&gt; &lt;&lt;"jasonlang"&gt;&gt;}
&gt;&gt;
&gt;&gt; 150&gt; riakc\\_pb\\_socket:put(Pid,O).
&gt;&gt; ok
&gt;&gt; 151&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user"&gt;&gt;, "jason\\*")
&gt;&gt; 151&gt; .
&gt;&gt; {ok,{search\\_results,[{&lt;&lt;"user"&gt;&gt;,
&gt;&gt;
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"jasonlang"&gt;&gt;}]}],
&gt;&gt; 0.0,1}}
&gt;&gt; 152&gt;
&gt;&gt;
&gt;&gt; \\*This search operator is ok\\*
&gt;&gt;
&gt;&gt; \\*TO new another object and search it\\*
&gt;&gt;
&gt;&gt; 152&gt; f(O),O=riakc\\_obj:new(&lt;&lt;"user"&gt;&gt;, &lt;&lt;"lang"&gt;&gt;, &lt;&lt;"langzhe"&gt;&gt;)
&gt;&gt; 152&gt; .
&gt;&gt; {riakc\\_obj,&lt;&lt;"user"&gt;&gt;,&lt;&lt;"lang"&gt;&gt;,undefined,[],undefined,
&gt;&gt; &lt;&lt;"langzhe"&gt;&gt;}
&gt;&gt; 153&gt; riakc\\_pb\\_socket:put(Pid,O).
&gt;&gt; ok
&gt;&gt; 154&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user"&gt;&gt;, "langzh\\*")
&gt;&gt; 154&gt; .
&gt;&gt; {ok,{search\\_results,[{&lt;&lt;"user"&gt;&gt;,
&gt;&gt;
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"lang"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"langzhe"&gt;&gt;}]}],
&gt;&gt; 0.0,1}}
&gt;&gt; \\*This is ok too\\*
&gt;&gt; \\*
&gt;&gt; \\*
&gt;&gt; \\*Search the objects:\\*
&gt;&gt; 157&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user"&gt;&gt;, "langzh\\*\\"\\"jason\\*")
&gt;&gt; 157&gt; .
&gt;&gt; {ok,{search\\_results,[{&lt;&lt;"user"&gt;&gt;,
&gt;&gt;
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"jasonlang"&gt;&gt;}]},
&gt;&gt; {&lt;&lt;"user"&gt;&gt;,
&gt;&gt;
&gt;&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"lang"&gt;&gt;},{&lt;&lt;"value"&gt;&gt;,&lt;&lt;"langzhe"&gt;&gt;}]}],
&gt;&gt; 0.0,2}}
&gt;&gt; 158&gt;
&gt;&gt; This is ok too.
&gt;&gt; -------------------------------------------------------------------
&gt;&gt; \\*In the above is ok.\\*
&gt;&gt;
&gt;&gt; --
&gt;&gt; 只为成功找方法，不为失败找理由
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; 只为成功找方法，不为失败找理由
&gt;

-- 
只为成功找方法，不为失败找理由
