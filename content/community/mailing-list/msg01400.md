---
title: "Re: riak not starting properly"
description: ""
project: community
lastmod: 2010-10-28T21:25:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01400"
mailinglist_parent_id: "msg01095"
author_name: "Richard Heycock"
project_section: "mailinglistitem"
sent_date: 2010-10-28T21:25:47-07:00
---


Hi Grant,

Sorry for taking so taking so long getting back to you I had to go
overseas at short notice.

Excerpts from Grant Schofield's message of 2010-09-18 02:13:04 +1000:
&gt; There looks like there are some strange things happening in the logs with the 
&gt; ring as well as timeouts. I would be curious how long the process takes to 
&gt; die if you were just to run a stop instead of a restart. Did you at one time 
&gt; change the name of this node? 

It takes about 4.5 seconds (wall time).

I haven't changed the name of the node and the app.config is as per the
Debian package.

I should also that there is only one node.

&gt; One thing that might be interesting to try is to stop the server, make a copy 
&gt; of your data directory, remove all the data in the data directory, and try to 
&gt; start and stop the node and see if it works more reliably.

I tried removing all the data from the data directory as you suggested
and for a while it worked but the problem has started again.

The bitcask directory is 1.5G in size and the ring directory is 24K. The
bucket properties are:

 {
 "props": {
 "name": "uris",
 "n\\_val": 3,
 "allow\\_mult": false,
 "last\\_write\\_wins": false,
 "precommit": [

 ],
 "postcommit": [

 ],
 "chash\\_keyfun": {
 "mod": "riak\\_core\\_util",
 "fun": "chash\\_std\\_keyfun"
 },
 "linkfun": {
 "mod": "riak\\_kv\\_wm\\_link\\_walker",
 "fun": "mapreduce\\_linkfun"
 },
 "old\\_vclock": 86400,
 "young\\_vclock": 20,
 "big\\_vclock": 50,
 "small\\_vclock": 10,
 "r": "quorum",
 "w": "quorum",
 "dw": "quorum",
 "rw": "quorum"
 }
 }

I also tried to get the properties with the keys=true option but after
10 minutes of no activity (the 1, 5 and 10 minute load averages were
all zero) I killed the process. The only indication of any activity was
the following log message every minute:

 ERROR REPORT==== 29-Oct-2010::04:19:43 ===
 \\*\\* Generic server riak\\_kv\\_vnode\\_master terminating 
 \\*\\* Last message in was {'$gen\\_cast',
 {riak\\_vnode\\_req\\_v1,
 
1141798154164767904846628775559596109106197299200,
 ignore,
 {riak\\_kv\\_listkeys\\_req\\_v2,&lt;&lt;"uris"&gt;&gt;,92166134,
 &lt;0.2635.0&gt;}}}
 \\*\\* When Server state == {state,679956,[],undefined,riak\\_kv\\_vnode,
 riak\\_kv\\_legacy\\_vnode}
 \\*\\* Reason for termination == 
 \\*\\* {{badmatch,{error,{{badmatch,{error,emfile}},
 [{bitcask,scan\\_key\\_files,3},
 {bitcask,open,2},
 {riak\\_kv\\_bitcask\\_backend,start,2},
 {riak\\_kv\\_vnode,init,1},
 {riak\\_core\\_vnode,init,1},
 {gen\\_fsm,init\\_it,6},
 {proc\\_lib,init\\_p\\_do\\_apply,3}]}}},
 [{riak\\_core\\_vnode\\_master,get\\_vnode,2},
 {riak\\_core\\_vnode\\_master,handle\\_cast,2},
 {gen\\_server,handle\\_msg,5},
 {proc\\_lib,init\\_p\\_do\\_apply,3}]}


The logs can be found here:

 http://stuff.roughage.com.au/riak-failure-3.log.tar.gz

rgh


&gt; Grant Schofield
&gt; Developer Advocate
&gt; Basho Technologies
&gt; 
&gt; On Sep 16, 2010, at 4:53 PM, Richard Heycock wrote:
&gt; 
&gt; &gt; Over the last few weeks I've been finding it harder and harder to start
&gt; &gt; riak which given that it's running on an auto-provisioned ec2 instance is
&gt; &gt; a bit of an issue! I can generally restart it by running
&gt; &gt; /etc/init.d/riak restart but it's got to the stage where I have to run
&gt; &gt; it four or five times. I should clarify here that when I say "harder to
&gt; &gt; start" it does start but as soon as I try to do anything it fails.
&gt; &gt; 
&gt; &gt; The contents of /var/log/riak are here:
&gt; &gt; 
&gt; &gt; http://stuff.roughage.com.au/riak-failure-2.log.tar.gz
&gt; &gt; 
&gt; &gt; rgh
&gt; &gt; -- 
&gt; &gt; Richard Heycock
&gt; &gt; 
&gt; &gt; http://topikality.com
&gt; &gt; 
&gt; &gt; +61 (0) 410 646 369
&gt; &gt; [e]: r...@topikality.com
&gt; &gt; [im]: r...@topikality.com
&gt; &gt; 
&gt; 
-- 
Richard Heycock

http://topikality.com

+61 (0) 410 646 369
[e]: r...@topikality.com
[im]: r...@topikality.com

