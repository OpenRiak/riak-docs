---
title: "Re: Riak Search 1.0 Bug - Inline Fields"
description: ""
project: community
lastmod: 2011-10-06T15:17:12-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05083"
mailinglist_parent_id: "msg05082"
author_name: "Greg Pascale"
project_section: "mailinglistitem"
sent_date: 2011-10-06T15:17:12-07:00
---


 Sounds good. Thanks for looking into this, Rusty.

-- 
Greg
Clipboard

On Thursday, October 6, 2011 at 2:34 PM, Rusty Klophaus wrote:

&gt; Hi Greg,
&gt; 
&gt; Did some investigation into this issue. This is indeed a bug introduced in 
&gt; 1.0. 
&gt; 
&gt; Specifically, it affects filtering on inline fields when that field is also 
&gt; used in the search query. In other words, if your main search is on field 
&gt; "ctime" and the filter is on field "foo", then this bug is not triggered. 
&gt; 
&gt; This issue is tracked here: https://issues.basho.com/1240
&gt; 
&gt; There is no easy workaround, so your special cased search logic is probably 
&gt; the best route until this is fixed. 
&gt; 
&gt; Best,
&gt; Rusty
&gt; 
&gt; 
&gt; On Thu, Oct 6, 2011 at 3:21 PM, Greg Pascale  (mailto:g...@clipboard.com)&gt; wrote:
&gt; &gt; Anybody have any ideas on this one? I was able to deploy a workaround, but 
&gt; &gt; it involved some ugly special case logic in my search code. 
&gt; &gt; 
&gt; &gt; Also, the last example should say "crashes", not "times out". It returned 
&gt; &gt; with that error immediately. 
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; Greg
&gt; &gt; Clipboard
&gt; &gt; 
&gt; &gt; On Wednesday, October 5, 2011 at 11:31 AM, Greg Pascale wrote:
&gt; &gt; 
&gt; &gt; &gt; Hi, 
&gt; &gt; &gt; 
&gt; &gt; &gt; I have uncovered what I think has to be a bug with inline field searches 
&gt; &gt; &gt; in Riak 1.0. In short, it seems that there are issues when including a 
&gt; &gt; &gt; field in both the query and filter query. I have a query in production 
&gt; &gt; &gt; that used to work with 14.2 but no longer does with 1.0. 
&gt; &gt; &gt; 
&gt; &gt; &gt; I dove into the issue a bit and was able to come up with some simpler 
&gt; &gt; &gt; examples that illustrate what I'm seeing. I ran these on my dev box which 
&gt; &gt; &gt; only has about 15 items in the clips bucket, so I'm nowhere close to the 
&gt; &gt; &gt; results limit. ctime is a field with inline set to true. 
&gt; &gt; &gt; 
&gt; &gt; &gt; Example 1: Works
&gt; &gt; &gt; 
&gt; &gt; &gt; search-cmd search clips 'ctime:([98682333448080 TO 98682333448089])'
&gt; &gt; &gt; 
&gt; &gt; &gt; :: Searching for 'ctime:([98682333448080 TO 98682333448089])' / '' in 
&gt; &gt; &gt; clips...
&gt; &gt; &gt; 
&gt; &gt; &gt; ------------------------------ 
&gt; &gt; &gt; 
&gt; &gt; &gt; index/id: clips/LR04QZTJS\\_wVDcb6
&gt; &gt; &gt; &lt;&lt;"ctime"&gt;&gt; -&gt; &lt;&lt;"98682333448084"&gt;&gt;
&gt; &gt; &gt; p -&gt; [0]
&gt; &gt; &gt; &lt;&lt;"ctime"&gt;&gt; -&gt; [&lt;&lt;"98682333448084"&gt;&gt;]
&gt; &gt; &gt; &lt;&lt;"private"&gt;&gt; -&gt; [&lt;&lt;"0"&gt;&gt;]
&gt; &gt; &gt; score -&gt; 0.0
&gt; &gt; &gt; 
&gt; &gt; &gt; ------------------------------
&gt; &gt; &gt; 
&gt; &gt; &gt; Example 2: Times out (should return 0 results) 
&gt; &gt; &gt; 
&gt; &gt; &gt; search-cmd search clips 'ctime:([98682333448080 TO 98682333448089])' 
&gt; &gt; &gt; 'ctime:(99999999999999)' :: Searching for 'ctime:([98682333448080 TO 
&gt; &gt; &gt; 98682333448089])' / 'ctime:(99999999999999)' in clips... 
&gt; &gt; &gt; ------------------------------ :: ERROR: timeout 
&gt; &gt; &gt; 
&gt; &gt; &gt; Example 3: Times out (should return 1 result)
&gt; &gt; &gt; 
&gt; &gt; &gt; search-cmd search clips 'ctime:(98682333448084)' 'ctime:(98682333448084)' 
&gt; &gt; &gt; 
&gt; &gt; &gt; :: Searching for 'ctime:(98682333448084)' / 'ctime:(98682333448084)' in 
&gt; &gt; &gt; clips...
&gt; &gt; &gt; 
&gt; &gt; &gt; ------------------------------ 
&gt; &gt; &gt; 
&gt; &gt; &gt; :: ERROR: 
&gt; &gt; &gt; {badarg,[{lists,member,[&lt;&lt;"98682333448084"&gt;&gt;,&lt;&lt;"98682333448084"&gt;&gt;]},
&gt; &gt; &gt; {riak\\_search\\_inlines,passes\\_inlines\\_1,3},
&gt; &gt; &gt; {lists,all,2},
&gt; &gt; &gt; {mi\\_server,iterate,6},
&gt; &gt; &gt; {mi\\_server,lookup,8}]}
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks
&gt; &gt; &gt; 
&gt; &gt; &gt; -- 
&gt; &gt; &gt; Greg
&gt; &gt; &gt; Clipboard
&gt; &gt; 
&gt; &gt; 
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt; 
&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Rusty Klophaus
&gt; 
&gt; Basho Technologies, Inc.
&gt; 11921 Freedom Drive, Suite 550
&gt; Reston, VA 20190
&gt; www.basho.com (http://www.basho.com/) 
&gt; 
&gt; 

