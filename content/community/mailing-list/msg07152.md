---
title: "Re: native erlang client on non-Riak node?"
description: ""
project: community
lastmod: 2012-04-05T12:30:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07152"
mailinglist_parent_id: "msg07136"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-04-05T12:30:33-07:00
---


Mike,

The native Erlang client was never designed to be used in this fashion, as
you are finding out first hand. You are correct in that some operations
assume they are running on the Riak VM, e.g. mapred\\_dynamic\\_inputs\\_stream.

Normally I would say not to establish a Erlang dist connection to the Riak
cluster but given you need a work around for the performance issue it seems
to be your only good choice ATM. You can use `rpc:call` to invoke the
mapred queries.

-Z

On Wed, Apr 4, 2012 at 2:40 PM, Michael Radford  wrote:

&gt; In case anyone else is wondering, the answer is no, the native client
&gt; isn't fully usable from a non-Riak node.
&gt;
&gt; I started a hidden node and connected to one of my Riak nodes using
&gt; riak:client\\_connect. The returned client is able to successfully
&gt; execute Client:get(Bucket, Key) (and probably other simple things like
&gt; put/delete), but it fails on mapred with a {modfun, ...} input.


&gt; The problem is that the native client tries to run the input function
&gt; on the local node, rather than the node the client points to, which of
&gt; course won't work unless the local node is participating in the Riak
&gt; cluster.
&gt;
&gt; Mike
&gt;
&gt; On Tue, Apr 3, 2012 at 9:43 AM, Michael Radford  wrote:
&gt; &gt; Is it OK to use Riak's native erlang client from an erlang node that's
&gt; &gt; connected to a Riak cluster via normal erlang distribution
&gt; &gt; (net\\_adm:ping etc.), but isn't participating in the Riak cluster? I'm
&gt; &gt; wondering if e.g. Riak makes any assumptions about nodes listed in
&gt; &gt; nodes(), or the nodes of processes running client code, that would
&gt; &gt; break if a node isn't running Riak.
&gt; &gt;
&gt; &gt; I'm trying to figure out a fallback strategy in case I can't resolve
&gt; &gt; performance issues I'm seeing with the protocol buffers client (see
&gt; &gt; other thread about slow searches). The scariest option would be to
&gt; &gt; run my application on the same nodes as Riak, which seems like it
&gt; &gt; would complicate operations too much. Or if
&gt; &gt; connected-but-not-participating nodes aren't a good idea, maybe my
&gt; &gt; application nodes could each start a slave node with -hidden, which
&gt; &gt; would then connect to Riak and act as a proxy?
&gt; &gt;
&gt; &gt; Mike
&gt;

