---
title: "Re: Storing as erlang-binary/term, reading as json."
description: ""
project: community
lastmod: 2011-08-11T13:46:48-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04353"
mailinglist_parent_id: "msg04352"
author_name: "Jonathan Langevin"
project_section: "mailinglistitem"
sent_date: 2011-08-11T13:46:48-07:00
---


Thanks for the correction there Dan. Seems I need to start responding...
much more slowly, so you guys get in the correct answer before I speak :-)

Cheers!
\\*


Jonathan Langevin
Systems Administrator
Loom Inc.
Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
www.loomlearning.com - Skype: intel352
\\*


On Thu, Aug 11, 2011 at 4:42 PM, Dan Reverri  wrote:

&gt; The Accept header indicates what content-type your client is able to
&gt; handle. When you specify "application/json" in the Accept header you are
&gt; telling Riak to return the object if it's content-type is "application/json"
&gt; otherwise return 406.
&gt; http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.7
&gt;
&gt; Thanks,
&gt; Dan
&gt;
&gt; Daniel Reverri
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; d...@basho.com
&gt;
&gt;
&gt;
&gt; On Thu, Aug 11, 2011 at 1:32 PM, Jonathan Langevin &lt;
&gt; jlange...@loomlearning.com&gt; wrote:
&gt;
&gt;&gt; I believe the Accept parameter is intended only for the ability to list
&gt;&gt; riak-native data. So to get riak parameters back as json, that's when you
&gt;&gt; specify the Accept header.
&gt;&gt; Regarding objects that you store it Riak, my experience has been that it
&gt;&gt; returns the data back as you stored it. So based on the type that you
&gt;&gt; specify when posting/putting the data, is the content type that you get
&gt;&gt; back.
&gt;&gt;
&gt;&gt; If I'm wrong, hopefully someone will correct me shortly :-)
&gt;&gt;
&gt;&gt; 
&gt;&gt; \\* Jonathan Langevin
&gt;&gt; Systems Administrator
&gt;&gt; Loom Inc.
&gt;&gt; Wilmington, NC: (910) 241-0433 - jlange...@loomlearning.com -
&gt;&gt; www.loomlearning.com - Skype: intel352 \\*
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On Thu, Aug 11, 2011 at 12:03 PM, Fyodor Yarochkin &gt; &gt; wrote:
&gt;&gt;
&gt;&gt;&gt; Greetings,
&gt;&gt;&gt; I am probably missing something obvious, but I've been playing with
&gt;&gt;&gt; it for a couple of days, still can't figure out the consistency and I
&gt;&gt;&gt; am still a little lost with riak source code so I thought I'd drop a
&gt;&gt;&gt; line here:
&gt;&gt;&gt;
&gt;&gt;&gt; I am experimenting with querying riak data data in different mime
&gt;&gt;&gt; formats from riak cluster. So for the tests, I am having a piece of
&gt;&gt;&gt; erlang code, which uses riak-erlang-client, writes some data into riak
&gt;&gt;&gt; as erlang-binary.
&gt;&gt;&gt;
&gt;&gt;&gt; Object = riakc\\_obj:new(&lt;&lt;"test"&gt;&gt;,
&gt;&gt;&gt; test\\_util:get\\_datekey(),{struct, [{field, Value}]}),
&gt;&gt;&gt; riakc\\_pb\\_socket:put(RiakPid, Object),
&gt;&gt;&gt;
&gt;&gt;&gt; Now I am trying to make the data to be accessible to non-erlang
&gt;&gt;&gt; clients so the node.js code (for example) would be able to read it as
&gt;&gt;&gt; json.
&gt;&gt;&gt;
&gt;&gt;&gt; My understanding is that I should be able to specify that I want
&gt;&gt;&gt; json-formatted data back by adding 'Accept: application/json' header
&gt;&gt;&gt; (per example here http://wiki.basho.com/HTTP-List-Resources.html)
&gt;&gt;&gt;
&gt;&gt;&gt; However I am getting HTTP 406 whenever I am trying to query anything
&gt;&gt;&gt; but erlang-binary:
&gt;&gt;&gt;
&gt;&gt;&gt; srv# curl -i 'http://localhost:8098/riak/test/2011811234248'
&gt;&gt;&gt; HTTP/1.1 200 OK
&gt;&gt;&gt; X-Riak-Vclock: a85hYGBgymDKBVIsLC6FEzKYEhnzWBkyincc54MIszUnMfB8v4wskQUA
&gt;&gt;&gt; Vary: Accept-Encoding
&gt;&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt;&gt;&gt; Link: ; rel="up"
&gt;&gt;&gt; Last-Modified: Thu, 11 Aug 2011 15:38:16 GMT
&gt;&gt;&gt; ETag: "6iDf0EKIk76L1KxlXoSB29"
&gt;&gt;&gt; Date: Thu, 11 Aug 2011 15:33:41 GMT
&gt;&gt;&gt; Content-Type: application/x-erlang-binary
&gt;&gt;&gt; Content-Length: 565
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; However, for application/json
&gt;&gt;&gt;
&gt;&gt;&gt; srv# curl -H 'Accept: application/json' -i
&gt;&gt;&gt; 'http://localhost:8098/riak/test/2011811234248'
&gt;&gt;&gt; HTTP/1.1 406 Not Acceptable
&gt;&gt;&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt;&gt;&gt; Date: Thu, 11 Aug 2011 15:34:12 GMT
&gt;&gt;&gt; Content-Length: 0
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; So, should I store the data as 'json' (json string converted to erlang
&gt;&gt;&gt; binary) in order to have some uniform data format accessible to erlang
&gt;&gt;&gt; and non-erlang clients?
&gt;&gt;&gt; also, how do map-reduce functions work in this case, do they have to
&gt;&gt;&gt; be strictly erlang in the case of having x-erlang-binary, or the data
&gt;&gt;&gt; could be converted to json for javascript?
&gt;&gt;&gt;
&gt;&gt;&gt; thanks,
&gt;&gt;&gt; -Fyodor
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

