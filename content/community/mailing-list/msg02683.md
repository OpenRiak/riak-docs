---
title: "Re: abstracted vs. opinionated, object mapping (was: Re: Riak Recap	for March 14 - 15)"
description: ""
project: community
lastmod: 2011-03-18T16:11:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02683"
mailinglist_parent_id: "msg02679"
author_name: "Mark Wolfe"
project_section: "mailinglistitem"
sent_date: 2011-03-18T16:11:37-07:00
---


Thanks for the run down on projects you have been working on.

I am very interested in your suggestion around the rest template code, I
will have a look over this as it is an area I am very interested in. I also
concur that using something like the apache http client for REST is
overkill, hence why I have been using Netty, for those not aware is more of
a protocol agnostic NIO (New IO which is the Java way of using native APIs
such as Linux epoll event notification facility) based network library.

The JPA features are also very interesting and not dissimilar to the way
ripple enables a rails developer to get up and running quickly. In my view
it makes riak a more compelling solution for entry level developers who are
just looking for a good solid distributed database to put there stuff in.

Well that said I will be reading your code, which is of course the beauty of
open source. I plan to give that REST template a thorough test and review.

I found this blog post on the REST template:

http://blog.springsource.com/2009/03/27/rest-in-spring-3-resttemplate/

For those of you who are interested this source spring is available at the
following URL, note the rest template is in the web subproject:

https://src.springframework.org/svn/spring-framework/trunk/

And just for completeness here is a link to the spring data mapping code on
github.

https://github.com/SpringSource/spring-data-mapping

Thanks again for your responses, I think is great for all involved.

On Sat, Mar 19, 2011 at 12:14 AM, Jon Brisbin  wrote:

&gt; As an aside: I'm wrapping up support for Grails GORM-style object mapping
&gt; in the MongoDB Spring Data Document support. We haven't decided how to apply
&gt; that mapping strategy to other NoSQL stores yet, but I suspect it'll only be
&gt; a matter of a month or two before I can get full mapping support in the Riak
&gt; Spring Data stuff.
&gt;
&gt; It allows you to map entities al la JPA:
&gt;
&gt; @Persistent
&gt; class Person {
&gt; @Id
&gt; private Integer ssn;
&gt; @Reference // &lt;- Externally-managed by using links, dbrefs, whatever
&gt; private List children;
&gt; }
&gt;
&gt; There's a metadata model that's responsible for reading annotations and
&gt; configuring the mapper to know how to marshall/unmarshall entities and what
&gt; to do with externally-stored relationships (in the case of MongoDB, we use
&gt; DBRefs). It also supports autowiring and bean post processors, so you can
&gt; inject resources into your entities:
&gt;
&gt; @Persistent
&gt; class Person {
&gt; ...
&gt; @Autowired
&gt; private DatastoreTemplate template;
&gt; }
&gt;
&gt;
&gt; It will be an interesting addition to the Riak support to have this same
&gt; level of rich mapping, IMHO.
&gt;
&gt; But on to the previous discussion...
&gt;
&gt;
&gt; On Mar 17, 2011, at 4:51 PM, Mark Wolfe wrote:
&gt;
&gt; ...[snip] The other was the rather convincing pitch Justin Sheehy gave a
&gt; few people while at a pub in Melbourne.
&gt;
&gt;
&gt; He has a tendency to do that. ;)
&gt;
&gt; As a frequent user of the spring framework I really appreciate the work
&gt; your doing around this framework, and indeed spring-data is something I will
&gt; use in the future, however being required to use the spring stack just get a
&gt; project connecting to riak probably wouldn't be the best idea in my view.
&gt;
&gt;
&gt; The idea behind Spring Data isn't to get a new, non-Spring project using a
&gt; NoSQL store by forcing them to pull in all of Spring just to connect to the
&gt; database. The focus has always been on extending Spring applications into
&gt; the NoSQL world in a very "Springy" way; to have first-class support of the
&gt; datastore within the Spring framework, which we assume you're already using.
&gt; :)
&gt;
&gt; When debugging the Spring Data Riak support, I delved through the innards
&gt; of RestTemplate (the core REST helper in Spring 3.0). It doesn't use any
&gt; other HTTP library, but is actually a thin wrapper around the built-in Java
&gt; IO. This means a library developer could go to the Spring Framework project,
&gt; download the source code for RestTemplate, shamelessly copy it (removing
&gt; references to Spring classes, of course, and replacing them with your own,
&gt; pure Java version) and create a thin abstraction over Java synchronous (or
&gt; asynchronous) IO instead of relying on HTTPClient, which I personally don't
&gt; like at all.
&gt;
&gt; You'd obviously be duplicating what's already been done, of course. Things
&gt; like the HttpMessageConverter in the RestTemplate are fantastic tools that a
&gt; REST developer can use. Just the Jackson-based automatic conversion to/from
&gt; application/json data is worth it in my mind. But it would be pure Java,
&gt; with no external dependencies.
&gt;
&gt;
&gt; I also think it is a good idea for the community as a whole to avoid an
&gt; overly normalized driver approach while there is so much awesome stuff going
&gt; on in the NoSQL and indeed riak space. A client which showcases this stuff
&gt; is a much better approach, albeit a duplicate in many ways of other
&gt; efforts.
&gt;
&gt;
&gt; One of the discussions we have frequently is how to balance abstraction (to
&gt; make a library easy to adapt to other NoSQL stores, given they all have
&gt; roughly equivalent high-level functionality--by that I mean they all do
&gt; CRUD, at the very least) versus exposing the benefits of that particular
&gt; datastore. We're not interested in "hiding" the functionality that makes
&gt; that datastore unique or valuable. The only question is how to expose it in
&gt; a way that doesn't force you to duplicate your efforts when you go to do the
&gt; same thing for The Other Guy's Database. :)
&gt;
&gt; If you write a driver for a specific database and don't have any plans to
&gt; do the same thing for anyone else, you have the advantage of being fully
&gt; opinionated and can be as low-level as you want. Unfortunately, we don't
&gt; have that option so we have to find a balance somewhere. I know I sometimes
&gt; personally get over-zealous in wanting to apply techniques I like to as
&gt; broad a swath of the space as possible. That does mean you take a little
&gt; "Riak-ness" or "MongoDB-ness" out of it as a side-effect of the process. I
&gt; don't think that's inherently a bad thing, as long as you're careful about
&gt; what you smooth over and that you don't take away a value proposition of the
&gt; underlying datastore because The Other Guy's Database doesn't support it.
&gt;
&gt;
&gt; This is of course just my two cents on the subject.
&gt;
&gt;
&gt; Appreciated and valuable! :)
&gt;
&gt;
&gt; Thanks!
&gt;
&gt; Jon Brisbin
&gt;
&gt; http://jbrisbin.com
&gt; Twitter: @j\\_brisbin
&gt;
&gt;
&gt;
&gt;
&gt; And lastly Abhishek I was writing an addendum to my ideas last night that
&gt; included just that idea, like other projects why would you install a load
&gt; balancer in front of a development cluster when you can make a simple load
&gt; balancer in the client. This is quite common in a lot of messaging clients
&gt; like apache activemq and hornetq ect.
&gt;
&gt; Caveats to this is:
&gt; a) You would probably stick to simple algorithms as this can get complex
&gt; fast.
&gt; b) Probably best only for a single or small pool of clients as your would
&gt; be replicating the work of load balancing on every node.
&gt;
&gt; This said I do agree it would be handy.
&gt;
&gt; So something like:
&gt;
&gt; riakClient.addHost("1.1.1.1", 8089)
&gt; riakClient.addHost("1.1.1.2", 8089)
&gt; riakClient.addHost("1.1.1.3", 8089)
&gt;
&gt; Start making calls.
&gt;
&gt; Time permitting I will hopefully add some of these to my own experimental
&gt; client to try out some of these ideas And after some consideration I agree
&gt; it would be unwise to wholesale change the riak client at this stage. The
&gt; work Russel has started is awesome and will make it easier in the future
&gt; to recognize the impact if and when some underlying changes are made.
&gt;
&gt; Anyway I have gone and written another war and peace on the subject and
&gt; hopefully not the last one.
&gt;
&gt; On Fri, Mar 18, 2011 at 12:57 AM, Abhishek Kona 
&gt; wrote:
&gt;
&gt;&gt; Yes.
&gt;&gt; Earlier query :
&gt;&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-March/003461.html
&gt;&gt;
&gt;&gt; -Abhishek Kona
&gt;&gt;
&gt;&gt;
&gt;&gt; On 17/03/11 7:17 PM, Russell Brown wrote:
&gt;&gt;
&gt;&gt;&gt; I'm sorry but I don't understand, do you want the client to load balance
&gt;&gt;&gt; across a Riak cluster rather than just speak to one node?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Regards,
&gt;
&gt; Mark Wolfe
&gt;
&gt; --
&gt; I am not young enough to know everything.
&gt; --
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;
&gt;


-- 
Regards,

Mark Wolfe

--
I am not young enough to know everything.
--
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

