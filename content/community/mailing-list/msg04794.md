---
title: "Re: Dropping a search index"
description: ""
project: community
lastmod: 2011-09-20T07:02:01-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04794"
mailinglist_parent_id: "msg04728"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2011-09-20T07:02:01-07:00
---


Elias,

Index entries are removed by the Search hook during object deletion. It
sounds like you removed the Search hook, then removed the objects, and now
you have entires in your Search index for non-existing objects. If you
don't care about losing \\*\\*all\\*\\* of your indexes then you should be able to
take the cluster down, delete all the `data/merge\\_index` dirs, and then
restart the cluster. At that point all your objects should be in tact but
the indexes should be gone. It's important that you take the cluster down
for this to work as merge\\_index keeps some data in memory that can survive.


If you know the object ids then you could delete only the necessary indexes
via a small bit of Erlang at the riak console via `search:delete\\_docs/1`.

search:delete\\_docs([{&lt;&lt;"bucket"&gt;&gt;, &lt;&lt;"key1"&gt;&gt;}, ...])

-Ryan

On Thu, Sep 15, 2011 at 1:32 AM, Elias Levy wrote:

&gt; Is there some way to drop a search index, other that forcibly removing the
&gt; merge\\_index data directory on each node?
&gt;
&gt; Change a bucket's search property to false or executing search-cmd
&gt; uninstall do not appear to have this effect. I can continue to execute
&gt; queries against the index. They appear to merely remove the search
&gt; pre-commit hook on the bucket.
&gt;
&gt; After playing around with binary keys and determining that if you use then
&gt; you really can't make use of any JavaScript functions, and that they lead to
&gt; encoding errors elsewhere, I decided to switch to string keys and switch to
&gt; the leveldb backend as its memory requirements have a less pronounced
&gt; relationship with the number and size of keys.
&gt;
&gt; Alas, I must have not removed all the data from the bitcask backend before
&gt; switching, as after switching I could query the index through the Solr API,
&gt; and although it did not return any values, it did say there were matching
&gt; rows.
&gt;
&gt; And if I execute a MR job with a JS function I get an encoding error, as
&gt; the old binary keys are being retrieved from the index, but they cannot be
&gt; passed to the JS function.
&gt;
&gt; So, is there a way to clear such an index?
&gt;
&gt; Elias Levy
&gt;

