---
title: "Re: Load average spikes during merging?"
description: ""
project: community
lastmod: 2011-08-23T12:45:29-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04432"
mailinglist_parent_id: "msg04387"
author_name: "Scott Lystig Fritchie"
project_section: "mailinglistitem"
sent_date: 2011-08-23T12:45:29-07:00
---


Jeff Pollard  wrote:

jp&gt; Overnight we do some data collection that is stored in Riak, and
jp&gt; just last night we had one of our server's load spike very high and
jp&gt; just drop back down to more acceptable levels. You can see a graph
jp&gt; of it [1]here.

Jeff, all that load average tells you is a weighted average of how many
processes are runnable: running or ready to run but no CPU is
available. Linux also seems to include processes in disk wait state,
see http://en.wikipedia.org/wiki/Load\\_(computing). I don't have any
specific knowledge of a Linux kernel's treatment of pthreads in
computing the load average, but it wouldn't surprise me each thread in
disk wait were included.

Riak will start a pool of Pthreads for I/O work, see the +A flag in
/etc/riak/vm.args (default Linux path), e.g.

 ## Enable kernel poll and a few async threads
 +K true
 +A 64

If you're interested in better measurements, "iostat -x" will give you
much more useful information about CPU & disk usage than load average
will. Intervals of 5 seconds are about the largest worth watching;
anything larger loses too much in the average. 1 second is ideal,
IMHO.

-Scott

