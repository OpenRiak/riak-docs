---
title: "luwak questions"
description: ""
project: community
lastmod: 2011-02-22T09:46:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02406"
author_name: "francisco treacy"
project_section: "mailinglistitem"
sent_date: 2011-02-22T09:46:45-08:00
---


Hi all,

We are using Luwak to store assets, ranging from 2k CSS files up to
30+ MB video files. Every key in Luwak is prefixed with an id (e.g.
e276814e96e0616eb7c07d3bb744d333-216.jpg).

In order to manage these assets, I'd like to query Luwak for keys
starting with some id. As I found the 'luwak\\_tld' bucket I tried with
two approaches: list all keys and filter out on the client, or use
key filters.

&gt; db.keys('luwak\\_tld')
GET /riak/luwak\\_tld?keys=true

Listing all keys works fine, except when there are too many. I then
tried to filter on Riak, like so:

&gt; db.add({ bucket: 'luwak\\_tld', key\\_filters: [['starts\\_with', 
&gt; 'e276814e96e0616eb7c07d3bb744d333']]}).map(function(v) { return [1] }).run()
POST /mapred
&gt; { message: 'HTTP error 500: {"error":"bad\\_json"}'
, stack: [Getter/Setter]
, statusCode: 500
, notFound: false
}

but I get "bad\\_json" errors... Any other bucket works just fine. Why
won't this work like a regular bucket?


Additionally I'm concerned about key explosion. Tens of thousands of
assets would end up stored there - would it make sense to organize
data differently?

I was thinking along the lines of one bucket per book (for instance a
bucket would be e276814e96e0616eb7c07d3bb744d333), with its assets
contained in that bucket. But I would lose the advantages of Luwak.
How would you go about this?

Thanks,
Francisco

