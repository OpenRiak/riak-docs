---
title: "Re: Socket closed during write?"
description: ""
project: community
lastmod: 2013-01-09T22:05:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09781"
mailinglist_parent_id: "msg09780"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2013-01-09T22:05:59-08:00
---


The last time I saw this particular error it was someone on a 64bit
client setting the content length value incorrectly via libcurl.
Requests would work on 64 bit nodes but fail on 32 bit nodes,
presumably because the HTTP client was handing the socket a garbage
value to read, thereby killing it.

Timeouts will generally return a different error. You might be
looking at some TCP or HTTP issue. How are you connecting? Is there
anything special about the requests that are failing?

On Wed, Jan 9, 2013 at 7:29 PM, Brad Heller  wrote:
&gt; Hey all,
&gt;
&gt; I've got a mysterious error with Riak. Certain writes seem to result in an
&gt; interesting error being raised by the coordinating node (rem, I'm assuming
&gt; it's the coordinating node):
&gt;
&gt; webmachine error: path="/buckets/my\\_bucket/keys"
&gt; {error,{error,{badmatch,{error,closed}},
&gt; [{webmachine\\_request,recv\\_unchunked\\_body,4,[{file,"src/webmachine\\_request.erl"},{line,418}]},
&gt; {webmachine\\_request,do\\_recv\\_body,2,[{file,"src/webmachine\\_request.erl"},{line,377}]},
&gt; {webmachine\\_request,call,2,[{file,"src/webmachine\\_request.erl"},{line,149}]},
&gt; {wrq,req\\_body,1,[{file,"src/wrq.erl"},{line,112}]},
&gt; {riak\\_kv\\_wm\\_object,accept\\_doc\\_body,2,[{file,"src/riak\\_kv\\_wm\\_object.erl"},{line,595}]},
&gt; {webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_resource.erl"},{line,169}]},
&gt; {webmachine\\_resource,do,3,[{file,"src/webmachine\\_resource.erl"},{line,128}]},
&gt; {webmachine\\_decision\\_core,resource\\_call,1,[{file,"src/webmachine\\_decision\\_core.erl"},{line,48}]}]}
&gt;
&gt; Web machine returns a 500 error when this happens. I saw online that this
&gt; could be the result of a socket being closed out from under the connection
&gt; [1]. Any idea how I can get to the bottom of this? Due to the nature of the
&gt; reproduction steps, I don't have access to the payload causing the crash
&gt; 'till it's actually \\*in\\* Riak. Someone in #riak on IRC suggested that this
&gt; could be the result of write timeouts. Ideas?
&gt;
&gt; Thanks,
&gt;
&gt; Brad Heller
&gt;
&gt; 1:
&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-October/006078.html
&gt;
