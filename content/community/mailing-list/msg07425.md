---
title: "How do I improve Level DB performance?"
description: ""
project: community
lastmod: 2012-05-10T13:33:28-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07425"
author_name: "Tim Haines"
project_section: "mailinglistitem"
sent_date: 2012-05-10T13:33:28-07:00
---


Hi there,

I've set up a new cluster, and have been doing pre-deployment benchmarks on
it. The benchmark I was running slowly sunk from 1000 TPS to 250 TPS over
the course of the single 8 hour benchmark doing 1 read+1 update using 1k
values. I'm wondering if anyone might have suggestions on how I can
improve this.

Here's a graph of the benchmark results: http://twitpic.com/9jh6hp/full
And the basho\\_bench config: https://gist.github.com/837239813dabb9c70c7a

This is on a cluster with 5 nodes of identical hardware, with the benchmark
running from a separate server. The nodes all have single proc quad-core
Sandy Beach CPUs, 8 GB of ram, and 600GB 15K RPM drives. They're running
Ubuntu 10.04 with the ext4 filesystem, and noop ioscheduler.

For the benchmark above, Riak itself was setup in LevelDB, with a ringsize
of 1024, and the default config settings for LevelDB.

There was about 10GB of benchmark data already in each node. While the
benchmarks are running, iowait hits about 20%, util about 80%, and each
server consumes about 4GB of ram.

Can anyone confirm this is expected performance from this kind of setup, or
offer suggestions on how to improve performance?


---
As an aside, I've since repaved the 5 nodes and adjusted it to a ring size
of 128 (I'm concerned about the scaling cap with this), and leveldb
settings like this:

 {write\\_buffer\\_size, 16777216},
 {max\\_open\\_files, 100},
 {block\\_size, 262144},
 {cache\\_size, 168430088}

I've set it running on another 8 hour benchmark to see what it turns up.


Cheers,

Tim Haines.
