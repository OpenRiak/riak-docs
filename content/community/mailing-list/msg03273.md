---
title: "Re: Link walking"
description: ""
project: community
lastmod: 2011-05-06T12:31:16-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03273"
mailinglist_parent_id: "msg03271"
author_name: "Andrew Berman"
project_section: "mailinglistitem"
sent_date: 2011-05-06T12:31:16-07:00
---


The results from one phase get passed on to the next phase, so if you want
both data sets you need to run two different map-reduce queries. If you
want the results from the link phase you need to run a link phase in
addition to a map phase (link first and then you can do the map phase with
Riak.mapValuesJson, which will give you the object that the link is pointing
to).

On Fri, May 6, 2011 at 12:14 PM, Joshua Hanson wrote:

&gt; The initial map phase is to grab the values from the input phase (.add()).
&gt; I want these values as well as the ones exposed from .link() but not sure
&gt; how to express it.
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; Joshua Hanson
&gt; e: joshua.b.han...@gmail.com
&gt;
&gt;
&gt; On Fri, May 6, 2011 at 3:01 PM, Andrew Berman  wrote:
&gt;
&gt;&gt; I don't totally understand what you're doing in your code, but it looks
&gt;&gt; like you have the map phase before the link phase which doesn't make sense
&gt;&gt; since you want the data from the link phase passed on to the map phase, not
&gt;&gt; the other way around.
&gt;&gt;
&gt;&gt; On Fri, May 6, 2011 at 9:37 AM, Joshua Hanson 
&gt;&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; In my map/reduce query I would like to keep the input data
&gt;&gt;&gt; and also data from the link-walking phase.
&gt;&gt;&gt;
&gt;&gt;&gt; Here is some sample code:
&gt;&gt;&gt;
&gt;&gt;&gt; #insert message
&gt;&gt;&gt; db.save('messages', 'josh-123', 'secret message', function(err, message)
&gt;&gt;&gt; {
&gt;&gt;&gt; #insert people object with link to message we just inserted
&gt;&gt;&gt; db.save('people', 'josh', {'profession': 'developer'},
&gt;&gt;&gt; { links: [{ bucket: 'messages', key: 'josh-123', 'tag': 'message' }]},
&gt;&gt;&gt; function(err, data) {
&gt;&gt;&gt; db.add([['people', 'josh']])
&gt;&gt;&gt; .map({ 'source': 'Riak.mapValuesJson', 'keep': true})
&gt;&gt;&gt; .link({ 'bucket': 'messages'})
&gt;&gt;&gt; .run(function(err, data) {
&gt;&gt;&gt; if (err) return console.log(err);
&gt;&gt;&gt; console.log(data);
&gt;&gt;&gt; })
&gt;&gt;&gt; }
&gt;&gt;&gt; )
&gt;&gt;&gt; })
&gt;&gt;&gt;
&gt;&gt;&gt; So, if I remove the 'link' phase I get the correct object from the map
&gt;&gt;&gt; phase
&gt;&gt;&gt; but if I instead remove the 'map' phase, I get the correct object from
&gt;&gt;&gt; link phase.
&gt;&gt;&gt;
&gt;&gt;&gt; However, having both together does not work. Is it possible to get at
&gt;&gt;&gt; both the original data and the data from link-walking in the same query?
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; Joshua Hanson
&gt;&gt;&gt; e: joshua.b.han...@gmail.com
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

