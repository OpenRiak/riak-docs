---
title: "Re: setting default bucket props"
description: ""
project: community
lastmod: 2010-04-28T09:36:25-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00200"
mailinglist_parent_id: "msg00197"
author_name: "Matthew Pflueger"
project_section: "mailinglistitem"
sent_date: 2010-04-28T09:36:25-07:00
---


Doing what Sean suggested worked (or just specifying the chash\\_fun in
the default\\_bucket\\_props). Now I'm running into weird behavior that
I'm guessing is related to the n\\_val setting. I'm running three nodes
all on separate machines joined with a ring partition size of 64
(22,21,21). On a fourth machine I'm running a load test in which a
process spawns 10 threads per node, each thread connecting to a one of
the nodes via protobuffs getting and putting random key/values in one
bucket. In my previous tests I used the default settings for the
bucket (n\\_val of 3) and everything ran smoothly for many hours. Now
I'm trying to set the default\\_bucket\\_props just changing the n\\_val to
1. No errors in the logs and all clients connect successfully.
However, pretty much all communication times-out which does not happen
with the default bucket props (changing the n\\_val back to 3 fixes the
problem).

--Matthew

On Wed, Apr 28, 2010 at 11:39, Sean Cribbs  wrote:
&gt; We used to have a function that would merge the values from app.config with
&gt; the hardcoded defaults for bucket properties.  I've opened an issue on
&gt; bugzilla for this problem (Bug 123). In the meantime, remove the stuff
&gt; you've set, start up the console, and run this in the Erlang shell:
&gt; application:get\\_all\\_env(riak\\_core).
&gt; From that output, copy the default\\_bucket\\_props and modify what you want.
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; On Apr 28, 2010, at 10:57 AM, Matthew Pflueger wrote:
&gt;
&gt; Forgot to say I'm using riak-0.10.1...
&gt;
&gt; --Matthew
&gt;
&gt;
&gt;
&gt; On Wed, Apr 28, 2010 at 10:56, Matthew Pflueger
&gt;  wrote:
&gt;
&gt; I am trying to set the default n\\_val in my app.config.  I'm not
&gt;
&gt; getting any errors on startup but when a client tries to put some data
&gt;
&gt; a process crashes eventually causing a time-out on the client side...
&gt;
&gt; app.config part:
&gt;
&gt; [
&gt;
&gt;  %% Riak Core config
&gt;
&gt;  {riak\\_core, [
&gt;
&gt;              %% Default location of ringstate
&gt;
&gt;              {ring\\_state\\_dir, "data/ring"},
&gt;
&gt;              %% Default bucket props
&gt;
&gt;              {default\\_bucket\\_props, [{n\\_val, 1}]},
&gt;
&gt;
&gt; I'm seeing the following in the logs:
&gt;
&gt; sasl-error.log:
&gt;
&gt; =CRASH REPORT==== 28-Apr-2010::15:36:22 ===
&gt;
&gt;  crasher:
&gt;
&gt;    initial call: riak\\_kv\\_put\\_fsm:init/1
&gt;
&gt;    pid: &lt;0.505.0&gt;
&gt;
&gt;    registered\\_name: []
&gt;
&gt;    exception exit: {undef,[{riak\\_core\\_bucket,defaults,[]},
&gt;
&gt;                            {riak\\_core\\_util,chash\\_key,1},
&gt;
&gt;                            {riak\\_kv\\_put\\_fsm,initialize,2},
&gt;
&gt;                            {gen\\_fsm,handle\\_msg,7},
&gt;
&gt;                            {proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt;
&gt;      in function  gen\\_fsm:terminate/7
&gt;
&gt;    ancestors: [&lt;0.504.0&gt;]
&gt;
&gt;    messages: []
&gt;
&gt;    links: []
&gt;
&gt;    dictionary: []
&gt;
&gt;    trap\\_exit: false
&gt;
&gt;    status: running
&gt;
&gt;    heap\\_size: 1597
&gt;
&gt;    stack\\_size: 24
&gt;
&gt;    reductions: 475
&gt;
&gt;  neighbours:
&gt;
&gt; erlang.log.1
&gt;
&gt; =ERROR REPORT==== 28-Apr-2010::15:36:22 ===
&gt;
&gt; \\*\\* State machine &lt;0.503.0&gt; terminating
&gt;
&gt; \\*\\* Last event in was timeout
&gt;
&gt; \\*\\* When State == initialize
&gt;
&gt; \\*\\*      Data  == {state,
&gt;
&gt;                     {r\\_object,&lt;&lt;"profiles"&gt;&gt;,&lt;&lt;"DymvhHkDplIEmpowMdQ35Q"&gt;&gt;,
&gt;
&gt;                         [{r\\_content,
&gt;
&gt;                              {dict,0,16,16,8,80,48,
&gt;
&gt;                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
&gt;
&gt;                                   [],[]},
&gt;
&gt;
&gt;  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
&gt;
&gt;                                    [],[]}}},
&gt;
&gt;                              &lt;&lt;&gt;&gt;}],
&gt;
&gt;                         [{&lt;&lt;31,41,45,38&gt;&gt;,{1,63439684582}}],
&gt;
&gt;                         {dict,1,16,16,8,80,48,
&gt;
&gt;
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
&gt;
&gt;                             {{[],[],[],[],[],[],[],[],[],[],
&gt;
&gt;                               [[&lt;&lt;"content-type"&gt;&gt;,97,112,112,108,105,99,97,
&gt;
&gt;
&gt; 116,105,111,110,47,111,99,116,101,116,45,115,
&gt;
&gt;                                 116,114,101,97,109]],
&gt;
&gt;                               [],[],[],[],[]}}},
&gt;
&gt;                         &lt;&lt;4,155,69,121,249,86,125,168,81,201,133,2,65,248,
&gt;
&gt;                           238,53,23,1,40,242,226,220,30,37,113,164,204,34,
&gt;
&gt;
&gt; 199,41,155,198,77,100,101,234,83,233,181,96,207,10,
&gt;
&gt;                           ...lots more data...
&gt;
&gt; \\*\\* Reason for termination =
&gt;
&gt; \\*\\* {'function not exported',[{riak\\_core\\_bucket,defaults,[]},
&gt;
&gt;                             {riak\\_core\\_util,chash\\_key,1},
&gt;
&gt;                             {riak\\_kv\\_put\\_fsm,initialize,2},
&gt;
&gt;                             {gen\\_fsm,handle\\_msg,7},
&gt;
&gt;                             {proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt;
&gt;
&gt;
&gt; --Matthew
&gt;
&gt;
