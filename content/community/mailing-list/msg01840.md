---
title: "Re: timeouts while rebalancing"
description: ""
project: community
lastmod: 2010-12-22T21:04:53-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01840"
mailinglist_parent_id: "msg01837"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-12-22T21:04:53-08:00
---


Hi Colin,

For clusters smaller than 5 nodes a certain amount of vnode shuffling has
been observed. The behavior you've observed seems to match bug 946:
https://issues.basho.com/show\\_bug.cgi?id=946

I'm not sure how much additional disk space per node would be necessary. The
example provided in the bug report for the 3-&gt;4 transition shows that each
node received ~10 new vnodes while giving up ~15 vnodes. The worst case
scenario for any particular node would be receiving all 10 new vnodes before
giving up anything. For a 64 partition system, 10 vnodes would be ~15% of
the stored data set. For example, if you have a 100GB data set with N=3, the
stored data set would be 300GB. %15 of 300GB would be 45GB which means a
single node would need at least 145GB to account for a worst case vnode
churn scenario.

Regarding bitcask versus innostore, both are good backends and production
worthy.

Your plan to migrate to a Riak 0.13 cluster is a good one.

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Tue, Dec 21, 2010 at 7:30 PM, Colin Surprenant &lt;
colin.surpren...@gmail.com&gt; wrote:

&gt; Hi,
&gt;
&gt; My bucket is using the default N=3. When writing, I am using W=1 and
&gt; when reading N=1.
&gt;
&gt; My cluster has settled down now. After the addition of the 4th node,
&gt; one of the node started to use diskspace at a very rapid pace, heading
&gt; quickly toward 100% usage so I had to remove the 4th node. It took a
&gt; few hours for the cluster to settle down. I am back at square one. I
&gt; think at this point it will be easier to lease my 0.10.1 cluster
&gt; as-is, create a new cluster using the latest 0.13 and extract and
&gt; refeed the data into the new cluster without letting it grow out of
&gt; proportion on each node.
&gt;
&gt; What would be a reasonable single node data size to be able to cope
&gt; "seamlessly" with node additions?
&gt; Should I consider using bitcask over innostore, making sure each node
&gt; can hold its keyspace in memory?
&gt;
&gt; Thanks.
&gt; Colin
&gt;
&gt; On Tue, Dec 21, 2010 at 1:08 PM, Dan Reverri  wrote:
&gt; &gt; Hi Collin,
&gt; &gt; I would not expect keys to return not found even during handoff. An
&gt; &gt; individual vnode may return not found if the requested data has not been
&gt; &gt; transferred but the other replicas should be able to satisfy the quorum.
&gt; &gt; What values of N, R, and W are you using?
&gt; &gt; Thanks,
&gt; &gt; Dan
&gt; &gt; Daniel Reverri
&gt; &gt; Developer Advocate
&gt; &gt; Basho Technologies, Inc.
&gt; &gt; d...@basho.com
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon, Dec 20, 2010 at 5:18 PM, Colin Surprenant
&gt; &gt;  wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Yup, same version.
&gt; &gt;&gt;
&gt; &gt;&gt; On Mon, Dec 20, 2010 at 7:58 PM, Alexander Sicular 
&gt; &gt;&gt; wrote:
&gt; &gt;&gt; &gt; Did you add the same version of riak to your 0.10.1 cluster? I
&gt; wouldn't
&gt; &gt;&gt; &gt; mismatch...
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; On Dec 20, 2010, at 3:46 PM, Colin Surprenant wrote:
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;&gt; Hi,
&gt; &gt;&gt; &gt;&gt;
&gt; &gt;&gt; &gt;&gt; Actually, they're not timeout error but Not Found errors for a bunch
&gt; &gt;&gt; &gt;&gt; of keys that have been stored without error while the cluster is
&gt; &gt;&gt; &gt;&gt; rebalancing.
&gt; &gt;&gt; &gt;&gt;
&gt; &gt;&gt; &gt;&gt; Is it "normal" to see Not Found errors while the cluster is
&gt; &gt;&gt; &gt;&gt; rebalancing? If not, what is my problem here? Is it a problem to
&gt; &gt;&gt; &gt;&gt; insert new keys while the cluster is rebalancing?
&gt; &gt;&gt; &gt;&gt;
&gt; &gt;&gt; &gt;&gt; Again, I cannot find any error report other that riak-admin failing
&gt; &gt;&gt; &gt;&gt; with a timeout as described below.
&gt; &gt;&gt; &gt;&gt;
&gt; &gt;&gt; &gt;&gt; Any help/hints approciated, thanks!
&gt; &gt;&gt; &gt;&gt;
&gt; &gt;&gt; &gt;&gt; Colin
&gt; &gt;&gt; &gt;&gt;
&gt; &gt;&gt; &gt;&gt; On Mon, Dec 20, 2010 at 2:50 PM, Colin Surprenant
&gt; &gt;&gt; &gt;&gt;  wrote:
&gt; &gt;&gt; &gt;&gt;&gt; Hi,
&gt; &gt;&gt; &gt;&gt;&gt;
&gt; &gt;&gt; &gt;&gt;&gt; I just added a 4th node in my 0.10.1 + innostore cluster and I am
&gt; &gt;&gt; &gt;&gt;&gt; seeing all kind of timeouts both for retrieving objects and trying
&gt; to
&gt; &gt;&gt; &gt;&gt;&gt; execute riak-admin status which gives me:
&gt; &gt;&gt; &gt;&gt;&gt;
&gt; &gt;&gt; &gt;&gt;&gt; RPC to 'r...@x.x.x' failed: {'EXIT',
&gt; &gt;&gt; &gt;&gt;&gt; {timeout,
&gt; &gt;&gt; &gt;&gt;&gt; {gen\\_server2,call,
&gt; &gt;&gt; &gt;&gt;&gt; [riak\\_kv\\_stat,get\\_stats]}}}
&gt; &gt;&gt; &gt;&gt;&gt;
&gt; &gt;&gt; &gt;&gt;&gt;
&gt; &gt;&gt; &gt;&gt;&gt; Also, the CPU load has seriously increased on the original 3 nodes.
&gt; &gt;&gt; &gt;&gt;&gt; The data rebalancing is quite slow.
&gt; &gt;&gt; &gt;&gt;&gt; I am not seeing anything wrong in the log files.
&gt; &gt;&gt; &gt;&gt;&gt;
&gt; &gt;&gt; &gt;&gt;&gt; Is this an indication that something is going wrong?
&gt; &gt;&gt; &gt;&gt;&gt;
&gt; &gt;&gt; &gt;&gt;&gt; Thanks,
&gt; &gt;&gt; &gt;&gt;&gt; Colin
&gt; &gt;&gt; &gt;&gt;&gt;
&gt; &gt;&gt; &gt;&gt;
&gt; &gt;&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt;
&gt; &gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt;&gt; riak-users mailing list
&gt; &gt;&gt; riak-users@lists.basho.com
&gt; &gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; &gt;
&gt; &gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

