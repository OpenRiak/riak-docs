---
title: "Re: Bug on riak-client 1.0.6 - Riak index property not serialized"
description: ""
project: community
lastmod: 2012-09-26T22:59:04-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08723"
mailinglist_parent_id: "msg08700"
author_name: "Deepak Balasubramanyam"
project_section: "mailinglistitem"
sent_date: 2012-09-26T22:59:04-07:00
---


Guido,

I guess that is the other side of the coin. Thank for the tip.

Deepak Bala

On Wed, Sep 26, 2012 at 1:51 PM, Guido Medina wrote:

&gt; Deepak,
&gt;
&gt; That's why in our company we have index annotations at method level, for
&gt; us we agreed that an index is not really a POJO property but a
&gt; pseudo/computed property, it was a waste for us to add a field just because
&gt; an index, so we have our own branch of the Riak java client where the
&gt; methods can be annotated as index, I requested this change before but
&gt; something stopped it, I do believe indexes are kind of special and could go
&gt; on method without need to wait for other annotations to behave the same:
&gt;
&gt; Then you would just need:
&gt;
&gt; \\*@RiakIndex(name="something")\\*\\*
&gt; \\*\\*@JsonIgnore \\*// Optional if you want this index to behave like a pseudo
&gt; property and not be serialized at all\\*
&gt; \\*public int getSomething(){
&gt; return someCalculatedInteger;
&gt; }
&gt;
&gt; Here is a link to our branch:
&gt;
&gt; \\*git clone https://github.com/guidomedina/riak-java-client.git\\*\\*
&gt; \\*\\*git checkout temetra-riak-java-client\\*
&gt; \\*mvn clean install\\*
&gt;
&gt; Then on target you will see riak-java-client-1.0.6t.jar
&gt;
&gt; Best regards,
&gt;
&gt; Guido
&gt;
&gt;
&gt; On 26/09/12 07:10, Deepak Balasubramanyam wrote:
&gt;
&gt; I see. All index annotations will need the @JsonProperty annotation to
&gt; survive serialization then. I guess another side effect which will break
&gt; backward compatibility will be experienced by map-reduce queries on any
&gt; entity that contains these indexes. They will not return the indexed value
&gt; either since the json value will no longer contain them. Unless of course
&gt; you use @JsonProperty.
&gt;
&gt; Thanks for letting me know about the change.
&gt;
&gt; Deepak Bala
&gt;
&gt; On Tue, Sep 25, 2012 at 9:04 PM, Brian Roach  wrote:
&gt;
&gt;&gt; This is not a bug, it's a feature ;) The fact that the index values
&gt;&gt; were were being serialized was actually not consistant with our other
&gt;&gt; annotated fields, so I made the decision to bring it in line and not
&gt;&gt; do so.
&gt;&gt;
&gt;&gt; I actually highlighted the change in the CHANGELOG:
&gt;&gt;
&gt;&gt; af12b6c - The default JSONConverter now supports multiple values via a
&gt;&gt; @RiakIndex annotated Set&lt;&gt; (Integer or String). Note this also brings
&gt;&gt; serialization/deserialization in line with our other annotaded fields
&gt;&gt; in that these values will not be present in the resulting JSON. To
&gt;&gt; override this behavior the Jackson @JsonProperty annotation can be
&gt;&gt; supplied
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Brian Roach
&gt;&gt;
&gt;&gt; On Tue, Sep 25, 2012 at 1:01 AM, Deepak Balasubramanyam
&gt;&gt;  wrote:
&gt;&gt; &gt; I switched to the java riak-client 1.0.6 to take it for a spin, and
&gt;&gt; several
&gt;&gt; &gt; test cases of mine failed. Upon further investigation I found that any
&gt;&gt; &gt; member variable that contains the @RiakIndex annotation does not
&gt;&gt; serialize
&gt;&gt; &gt; into Riak anymore. You can reproduce the problem with the following type
&gt;&gt; &gt;
&gt;&gt; &gt; @JsonSerialize(include=JsonSerialize.Inclusion.NON\\_NULL)
&gt;&gt; &gt; public class MyType
&gt;&gt; &gt; {
&gt;&gt; &gt; public static final String SOME\\_NAME\\_STR\\_REFERENCE = "blah";
&gt;&gt; &gt; @RiakKey
&gt;&gt; &gt; private String myKey;
&gt;&gt; &gt; @RiakIndex(name=SOME\\_NAME\\_STR\\_REFERENCE)
&gt;&gt; &gt; private String indexedProp;
&gt;&gt; &gt; // Getters and setters go here
&gt;&gt; &gt; }
&gt;&gt; &gt;
&gt;&gt; &gt; Make a call to bucket.store(typeRef).execute() followed by a GET to
&gt;&gt; &gt; /riak/myBucket/myKey. The indexedProp element will be missing in the
&gt;&gt; json
&gt;&gt; &gt; for calls made on riak-client version 1.0.6 but will be available when
&gt;&gt; the
&gt;&gt; &gt; call is made from riak-client version 1.0.5.
&gt;&gt; &gt;
&gt;&gt; &gt; Thanks
&gt;&gt; &gt; Deepak Bala
&gt;&gt; &gt;
&gt;&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; &gt; riak-users mailing list
&gt;&gt; &gt; riak-users@lists.basho.com
&gt;&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt; &gt;
&gt;&gt;
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing 
&gt; listriak-users@lists.basho.comhttp://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt;

