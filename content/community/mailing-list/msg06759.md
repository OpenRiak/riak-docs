---
title: "Re: Adding a fourth node makes cluster slower in basho bench"
description: ""
project: community
lastmod: 2012-02-27T12:32:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06759"
mailinglist_parent_id: "msg06721"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-02-27T12:32:36-08:00
---


John-Paul,

Do you mind posting your config files to go with each run? Some questions
that come to mind:

1. Did you start fresh for each run? (i.e. no data)

2. After adding the 4th node did you add it's IP to the bench config?

3. Do you have any iostat numbers to go with these runs? (both for good and
bad would be useful)

4. Do you see any differences in the Riak logs between the good/bad runs?
 E.g. maybe errors or merge activity?

-Ryan

On Thu, Feb 23, 2012 at 4:56 PM, John-Paul Bader
wrote:

&gt; Hey,
&gt;
&gt;
&gt; so I'm currently benchmarking riak on a bare metal cluster (2xquadcore
&gt; xeon 2.2GHz, 24GB RAM, 120GB SSD, gigabit ethernet between nodes)
&gt;
&gt; I wrote some custom benchmarks in basho bench which connected to all three
&gt; nodes and I filled up the cluster consisting of 3 nodes with about 68GB of
&gt; Data (50mio objects in one bucket and 35mio objects in another). Storage
&gt; backend is leveldb and caching is tuned according to the wiki guide.
&gt;
&gt; Now with those three nodes i could get up to a constant 30k ops/s - see
&gt; http://smyck.org/fast.png for example.
&gt;
&gt; I ran basho bench with a concurrency of 80 workers from another node next
&gt; to the three riak nodes. Empirical tests proved that my benchmarks peaked
&gt; at 80 workers in terms of ops/s. Above that it just wasn't getting faster
&gt; and latency increased.
&gt;
&gt; Then I wanted to add another node to see the cluster scale up in
&gt; throughput. What I saw with the same settings except for adding th 4th node
&gt; to the basho bench config was this:
&gt;
&gt; http://smyck.org/slow.png
&gt;
&gt; So while it kicked off a lot faster, the performance decreased quickly. I
&gt; even increased the leveldb cache further but the result was the same. Then
&gt; I reduced the concurrency to 70 and I got a constant 35k ops/s again. See
&gt; http://smyck.org/35concurrent.\\*\\*png 
&gt;
&gt; Now I did kind of a binary search for the sweet spot and it turned out i
&gt; could set the concurrency setting up to 74 - everything above 74 showed the
&gt; behavior from http://smyck.org/slow.png
&gt;
&gt; Now - any ideas on that? Is running basho bench from one node the problem?
&gt; The machine running basho bench is at around 45% cpu load. Should it be
&gt; running like tsung - from multiple nodes?
&gt;
&gt; Any ideas? As I'm fairly new to riak it is also quite likely that I missed
&gt; something - so I'd be happy if you'd point me to common mistakes in
&gt; scenarios like these.
&gt;
&gt;
&gt; ~ John
&gt;
&gt; --
&gt; John-Paul Bader | Software Development
&gt;
&gt; www.wooga.com
&gt; wooga GmbH | Saarbruecker Str. 38 | D-10405 Berlin
&gt; Sitz der Gesellschaft: Berlin; HRB 117846 B
&gt; Registergericht Berlin-Charlottenburg
&gt; Geschaeftsfuehrung: Jens Begemann, Philipp Moeser
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\\*\\*mailman/listinfo/riak-users\\_\\*\\*lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

