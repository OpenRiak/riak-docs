---
title: "Question about the source code: riak_get_fsm"
description: ""
project: community
lastmod: 2010-04-13T06:00:41-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00019"
author_name: "Marc Worrell"
project_section: "mailinglistitem"
sent_date: 2010-04-13T06:00:41-07:00
---


Hi,

I was reading the source code of riak\\_get\\_fsm to see how failure is handled.
I stumbled on a construction that I don't understand.

In waiting\\_vnode\\_r/2 I see that:
1. on receiving an ok: there is a check if there are R ok replies
2. on receiving notfound: there is a check of there are R (ok + notfound) 
replies

Now suppose I have R = N = 3.
And I get back from the nodes the sequence: [notfound, ok, ok]
Then #state.replied\\_r = 2, and #state.replied\\_notfound = 1.
This will let "waiting\\_vnode\\_r({r, {ok, RObj}, ...)" stay in the state 
"waiting\\_vnode\\_r".
Though we know we got an answer from all R (N) nodes, only a timeout will move 
the fsm further. 

Could this be handled differently or am I missing something?

- Marc
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

