---
title: "Re: Small patch to fix bin/riak stop on OS X"
description: ""
project: community
lastmod: 2010-07-03T17:52:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00676"
mailinglist_parent_id: "msg00675"
author_name: "Andrew Tunnell-Jones"
project_section: "mailinglistitem"
sent_date: 2010-07-03T17:52:40-07:00
---


Hi Seth,

That option is supported by OS X however it is only enabled if COMMAND\\_MODE is 
set as unix2003. This is set by default in Apple's Terminal application but not 
in iTerm:

Last login: Sun Jul 4 00:40:36 on ttys002
~
$ ps -f
ps: illegal option -- f
usage: ps [-AaCcEefhjlMmrSTvwXx] [-O fmt | -o fmt] [-G gid[,gid...]]
 [-u]
 [-p pid[,pid...]] [-t tty[,tty...]] [-U user[,user...]]
 ps [-L]
~
$ env COMMAND\\_MODE=unix2003 ps -f
 UID PID PPID C STIME TTY TIME CMD
 501 753 751 0 0:00.07 ttys000 0:00.13 -bash
 501 1161 1160 0 0:00.04 ttys001 0:00.08 -bash
 501 1311 1310 0 0:00.03 ttys002 0:00.07 -bash


â€” Andrew
http://andrew.tj.id.au/


On 04/07/2010, at 5:52 AM, Seth Falcon wrote:

&gt; Hi all,
&gt; 
&gt; While going through the fast track, I noticed the following output
&gt; when stopping my local nodes via "dev?/bin/riak stop":
&gt; 
&gt; ps: illegal option -- f
&gt; usage: ps [-AaCcEefhjlMmrSTvwXx] [-O fmt | -o fmt] [-G gid[,gid...]]
&gt; [-u]
&gt; [-p pid[,pid...]] [-t tty[,tty...]] [-U user[,user...]]
&gt; ps [-L]
&gt; ok
&gt; 
&gt; It seems that ps -f is not supported (indeed illegal!) on OS X. The
&gt; following change works for me and I believe will work just as well on
&gt; Linux.
&gt; 
&gt; commit 82c6d30085ef38fcd97abc5e5293f9f4644f3092
&gt; Author: Seth Falcon 
&gt; Date: Thu Jul 1 20:09:57 2010 -0700
&gt; 
&gt; Fix ps command in riak stop for OS X
&gt; 
&gt; OS X's ps command does not support -f, might as well
&gt; pull out just the fields needed using -o
&gt; 
&gt; diff --git a/rel/files/riak b/rel/files/riak
&gt; index d425550..a4291fa 100755
&gt; --- a/rel/files/riak
&gt; +++ b/rel/files/riak
&gt; @@ -70,7 +70,7 @@ case "$1" in
&gt; 
&gt; stop)
&gt; # Wait for the node to completely stop...
&gt; - PID=`ps -ef|grep "$RUNNER\\_BASE\\_DIR/.\\*/[b]eam.smp|awk '{print $2}'"`
&gt; + PID=`ps -Ao pid,comm|grep "$RUNNER\\_BASE\\_DIR/.\\*/[b]eam.smp|awk
&gt; '{print $1}'"`
&gt; $NODETOOL stop
&gt; while `kill -0 $PID 2&gt;/dev/null`;
&gt; do
&gt; 
&gt; 
&gt; + seth
&gt; 
&gt; I've also attempted to attach the patch in case whitespace is
&gt; destroyed via email.
&gt; 
&gt; -- 
&gt; Seth Falcon | @sfalcon | http://userprimary.net/
&gt; &lt;0001-Fix-ps-command-in-riak-stop-for-OS-X.patch