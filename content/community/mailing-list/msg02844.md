---
title: "Re: update objects in precommit hooks"
description: ""
project: community
lastmod: 2011-04-01T10:21:05-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02844"
mailinglist_parent_id: "msg02828"
author_name: "Damian Dobroczyński"
project_section: "mailinglistitem"
sent_date: 2011-04-01T10:21:05-07:00
---


W dniu 01.04.2011 15:23, Jon Meredith pisze:
&gt; Hi Damian,
&gt; 
&gt; The put FSM is being overhauled at the moment. The current 0.14.1 code
&gt; does not apply the updated values in precommit hooks. In my testing it
&gt; worked ok, but I think that is probably because there were already
&gt; values present in Riak and the changes were included at the vnode level.
&gt; 
&gt; You could try building from source on github, the branch the put FSM was
&gt; refactored on has been pulled in now. There is a QuickCheck test that
&gt; executes code that looks very similar to yours.
&gt; 
&gt; MD = riak\\_object:get\\_metadata(Obj),
&gt; UpdMD = dict:store(?MD\\_USERMETA, [{"X-Riak-Meta-PrecommitHook","was
&gt; here"}], MD),
&gt; riak\\_object:update\\_metadata(Obj, UpdMD).
&gt; 
&gt; I'd be very interested to hear if it resolves your problem.
&gt; 
&gt; BR, Jon.
&gt; Basho Technologies.
&gt; 

Well, I have not applied this patch yet, but in meanwhile I looked into
the riak\\_object source code and found apply\\_updates/1. I simply called
this one as the last step in my hook function and it worked. Probably
this is not the correct way of solving this problem, is it?

-- D.


&gt; 2011/4/1 Damian Dobroczyński &gt;
&gt; 
&gt; Hi, list!
&gt; 
&gt; I'm trying to update object metadata dictionary within my precommit hook
&gt; (in Erlang) using `riak\\_object:update\\_metadata/2' like this:
&gt; 
&gt; Old = riak\\_object:get\\_metadata(O),
&gt; New = dict:store(&lt;&lt;"X-my-metadata-name"&gt;&gt;, Value, Old),
&gt; NewObject = riak\\_object:update\\_metadata(O, New),
&gt; 
&gt; Unfortunately, the retrieved object does not contain the new keys. Where
&gt; can be the problem?
&gt; 
&gt; -- D.
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com 
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 
&gt; 

0x0CAE3AEB.asc
Description: application/pgp-keys

signature.asc
Description: OpenPGP digital signature
