---
title: "Re: Riak Search."
description: ""
project: community
lastmod: 2011-12-18T04:25:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05980"
mailinglist_parent_id: "msg05971"
author_name: "cookchr...@gmail.com"
project_section: "mailinglistitem"
sent_date: 2011-12-18T04:25:09-08:00
---


Thank you for that, we managed to work around using a precommit hook and making 
a call directly to the riak search module! But I will be pulling that down and 
taking a look at doing that as well. Many thanks and keep up the great work on 
riak! 

Chris. 
Sent from my BlackBerryÂ® wireless device

-----Original Message-----
From: Ryan Zezeski 
Date: Thu, 15 Dec 2011 21:44:38 
To: Chris Cook
Cc: 
Subject: Re: Riak Search.

Hi Chris,

Sorry it took so long to respond. I'm going to take a guess that you are
using a 1.0.x version of Riak? The problem you're facing is that in 1.0 we
changed some things with regard to bucket properties. You are trying to
set the Search commit hook manually but that won't work anymore. There are
two ways to install the Search hook outside of the client:

1) at the terminal run `search-cmd install my\\_books`

2) curl -X PUT -H 'Content-Type: application/json'
http://localhost:8091/riak/foo -d '{"props": {"search": true} }'

I just submitted a PR that will allow you to enable the search hook via
riak-erlang-http-client as well.

https://github.com/basho/riak-erlang-http-client/pull/6

It allows you to set the hook like so: `rhc:set\\_bucket(C, "foo2", [{search,
true}]).`

-Ryan

On Thu, Dec 1, 2011 at 6:29 AM, Chris Cook  wrote:

&gt; Hi,
&gt;
&gt; Sorry, but I've done a lot of googling and haven't been to work out where
&gt; this is going wrong, could someone please point out where I may be going
&gt; wrong with it. I have riak search enabled and set to true and riak clusters
&gt; all restarted. I go through the following steps below using
&gt; riak-erlang-http-client, but whenever I do a search I get {ok, []} back.
&gt;
&gt; Erlang R14B02 (erts-5.8.3) [source] [rq:1] [async-threads:0]
&gt; [kernel-poll:false]
&gt;
&gt; Eshell V5.8.3 (abort with ^G)
&gt; 1&gt; [ ok = application:start(A) || A &lt;- [sasl, ibrowse] ],
&gt; 1&gt; IP = "127.0.0.1",
&gt; 1&gt; Port = 8098,
&gt; 1&gt; Prefix = "riak",
&gt; 1&gt; Options = [],
&gt; 1&gt; C = rhc:create(IP, Port, Prefix, Options).
&gt;
&gt; ---- Snipped Progress Reports from here, everything start with ok ----
&gt;
&gt; {rhc,"127.0.0.1",8098,"riak",[{client\\_id,"At5+Yg=="}]}
&gt; 2&gt; rhc:set\\_bucket(C, "my\\_books", [{&lt;&lt;"precommit"&gt;&gt;, [{struct, [{&lt;&lt;"mod"&gt;&gt;,
&gt; &lt;&lt;"riak\\_search\\_kv\\_hook"&gt;&gt;}, {&lt;&lt;"fun"&gt;&gt;,&lt;&lt;"precommit"&gt;&gt;}]}]}]).
&gt;
&gt; =PROGRESS REPORT==== 1-Dec-2011::11:13:43 ===
&gt; supervisor: {local,inet\\_gethost\\_native\\_sup}
&gt; started:
&gt; [{pid,&lt;0.53.0&gt;},{mfa,{inet\\_gethost\\_native,init,[[]]}}]
&gt;
&gt; =PROGRESS REPORT==== 1-Dec-2011::11:13:43 ===
&gt; supervisor: {local,kernel\\_safe\\_sup}
&gt; started: [{pid,&lt;0.52.0&gt;},
&gt; {name,inet\\_gethost\\_native\\_sup},
&gt; {mfargs,{inet\\_gethost\\_native,start\\_link,[]}},
&gt; {restart\\_type,temporary},
&gt; {shutdown,1000},
&gt; {child\\_type,worker}]
&gt; ok
&gt; 3&gt; PropList = [{&lt;&lt;"id"&gt;&gt;, &lt;&lt;"123456789"&gt;&gt;},{&lt;&lt;"title"&gt;&gt;, &lt;&lt;"The Title"&gt;&gt;},
&gt; {&lt;&lt;"content"&gt;&gt;, &lt;&lt;"The Content"&gt;&gt;}].
&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"123456789"&gt;&gt;},
&gt; {&lt;&lt;"title"&gt;&gt;,&lt;&lt;"The Title"&gt;&gt;},
&gt; {&lt;&lt;"content"&gt;&gt;,&lt;&lt;"The Content"&gt;&gt;}]
&gt; 4&gt; Obj = riakc\\_obj:new("my\\_books", &lt;&lt;"123456789"&gt;&gt;, PropList,
&gt; list\\_to\\_binary("application/x-erlang-term")).
&gt; {riakc\\_obj,"my\\_books",&lt;&lt;"123456789"&gt;&gt;,undefined,[],
&gt; {dict,1,16,16,8,80,48,
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;
&gt; {{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;...&gt;&gt;|...]],[],[],...}}},
&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"123456789"&gt;&gt;},
&gt; {&lt;&lt;"title"&gt;&gt;,&lt;&lt;"The Title"&gt;&gt;},
&gt; {&lt;&lt;"content"&gt;&gt;,&lt;&lt;"The Content"&gt;&gt;}]}
&gt; 5&gt; rhc:put(C, Obj).
&gt; ok
&gt; 6&gt; rhc:search(C, "my\\_books", &lt;&lt;"content:The Content"&gt;&gt;).
&gt; {ok,[]}
&gt; 7&gt; rhc:search(C, &lt;&lt;"my\\_books"&gt;&gt;, &lt;&lt;"content:The Content"&gt;&gt;).
&gt; {ok,[]}
&gt; 8&gt; {ok, Obj0} = rhc:get(C, &lt;&lt;"123456789"&gt;&gt;).
&gt; \\*\\* exception error: undefined function rhc:get/2
&gt; 9&gt; {ok, Obj0} = rhc:get(C, "my\\_books", &lt;&lt;"123456789"&gt;&gt;).
&gt; {ok,{riakc\\_obj,"my\\_books",&lt;&lt;"123456789"&gt;&gt;,
&gt; &lt;&lt;107,206,97,96,96,96,204,96,202,5,82,28,202,156,255,126,
&gt; 250,45,186,178,45,131,41,...&gt;&gt;,
&gt; [{{dict,3,16,16,8,80,48,
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt; {{[],[],[],[],[],[],[],[],[],[],...}}},
&gt; &lt;&lt;131,108,0,0,0,3,104,2,109,0,0,0,2,105,100,109,0,0,0,
&gt; ...&gt;&gt;}],
&gt; undefined,undefined}}
&gt; 10&gt;
&gt;
&gt; It's probably something to do with the content type, but I'm really
&gt; unsure, many thanks in advance Chris.
&gt;
&gt;
&gt;
&gt;
