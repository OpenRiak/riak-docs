---
title: "Re: 2i query, weird null results, java pbclient"
description: ""
project: community
lastmod: 2011-10-24T14:12:04-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05283"
mailinglist_parent_id: "msg05282"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-10-24T14:12:04-07:00
---

On 24 Oct 2011, at 21:56, Alexander Robbins wrote:

&gt; Hey, sorry for the delay. I'm having trouble switching to the HTTP client. 
&gt; I'm getting this error whenever I try to use it: (Using riak java client 
&gt; version 1.0.1)
&gt; 
&gt; 
&gt; org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager: method ()V 
&gt; not found
&gt; 
&gt; Caused by:
&gt; 
&gt; java.lang.NoSuchMethodError: 
&gt; org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager: method ()V 
&gt; not found
&gt; at 
&gt; com.basho.riak.client.http.util.ClientUtils.newHttpClient(ClientUtils.java:77)
&gt; at 
&gt; com.basho.riak.client.http.util.ClientHelper.(ClientHelper.java:71)
&gt; at com.basho.riak.client.http.RiakClient.(RiakClient.java:62)
&gt; at com.basho.riak.client.http.RiakClient.(RiakClient.java:58)
&gt; at 
&gt; com.basho.riak.client.raw.http.HTTPRiakClientFactory.newClient(HTTPRiakClientFactory.java:75)
&gt; ...
&gt; 
&gt; This is the setup code I'm using for the HTTP client:
&gt; client = HTTPRiakClientFactory.getInstance().newClient(
&gt; new HTTPClientConfig.Builder().withHost("192.168.1.92").build())

You can shorten this to 

RiakFactory.newClient( new 
HTTPClientConfig.Builder().withHost("192.168.1.92").build())

i.e. you don't need to use the specific factory directly, RiakFactory will 
select the correct factory for the type of config it is given.

&gt; 
&gt; I don't see how I could be causing that error. Any ideas?

Classpath issue. You have an older HTTP Client jar on your class path, 4.0.x. 
The 4.1.1 Apache HTTP Client that the RJC depends on has a no-arg TSCM 
constructor, the 4.0.x release did not.

&gt; 
&gt; Alex
&gt; 
&gt; On Mon, Oct 24, 2011 at 3:02 PM, Russell Brown  wrote:
&gt; 
&gt; On 24 Oct 2011, at 20:21, Alexander Robbins wrote:
&gt; 
&gt; &gt; Using a new Riak 1.0 cluster.
&gt; &gt;
&gt; &gt; We added data in with a secondary index. When getting the data back out the 
&gt; &gt; results list is odd.
&gt; &gt;
&gt; &gt; [null, null, null, null, null, null, null, null, null, null, null, null, 
&gt; &gt; null, null, null, null, null, null, null, null, a, c, 9, d, 9, 1, d, d, 0, 
&gt; &gt; e, 5, 5, 6, 8, c, 6, d, 4, 8, f, 
&gt; &gt; e1b865342e2d81fac6b99dfa157dd8550ecc0b68caad2fb55c12e9fa5b1532c2, 
&gt; &gt; 85dca536068b8ead86c14c009c8a919457d2326419c16e0cd7f3b23a8776e2c8, 
&gt; &gt; be2f346c56827912cc4e21b765bd28d520a46833d08b8207ca6b49c8da2351d2, 
&gt; &gt; 1907d031c88b8df2fc5128114615133d4184cedaea55964c3cee0ef9fe566f13, 
&gt; &gt; 1bb5ce4aba0bf240698876530948c807d50e6f04a7358b7514c756dd295775ae, 
&gt; &gt; 1f5f8f78951c6842ad6bcc96e3839ca8240b71372d2ab4826411fdfc84fedeb1, 
&gt; &gt; 330856dabfa3a1c5b9ca8051686d8d7f387a23c795493a4e8f33d84861756d4f, 
&gt; &gt; 338fffb9740b2f0c50b2da52a73b4861be318868082db3748eb95a47654981bd, 
&gt; &gt; 5eef2b9cd6f7faf34548c9700069527287574690ab3dabf4c4f186753ffc5417, 
&gt; &gt; 7ec9217a7a87c9e43a94170bb1ab8c13566233823ef6f77ef9c455a289c4bdf8, 
&gt; &gt; a588d7f0fb413d52a895a5d7e7fcfc966e9a56c42456e7821d2e5fa93b5671ba, 
&gt; &gt; 767655d6443a337b2d3d89c0d1c38c3bac62398b74e0deef572508c54a2ad8b1, 
&gt; &gt; 7ca77aa38e44942d769ab8b08753b008ad65fe5d0d8c6438b67849381300aa9f, 
&gt; &gt; ab0a791a5a82345c5adce2c0d0d9013bab176e430d335228355781aa23a87f3e, 
&gt; &gt; b42af37baa18e715ca64a7145783cd3fd0defa9b2dc18368ec4c647cbe710132, 
&gt; &gt; c4d9c7b2cd837294cca10a581976a3f6d93d74cb2d30cac48384c64fc0bb6e2c, 
&gt; &gt; c7c10ad62091e3c7ba304d8a58f02c180c76f47d8d1d4addb21b9a88da277e75, 
&gt; &gt; 127f5b7255d61fcf0477a53d242c248cca824d9e60dafffc244d8e9df2bf7cbf, 
&gt; &gt; 23636fa4ef8af2a1d26335a3c8daca24ec5cd7978ee2429615e2b60538d6c9e9, 
&gt; &gt; 385d59cc404d3c7f097b2ae9e0e82768ac980c9ba157f6ea77d91ad49e812469, [, 
&gt; &gt; mentions, 50c2c9983e2ea3806c6d5e34a19ed526844945d0a06c70557695dfaa15b70ba3]
&gt; &gt;
&gt; &gt; The 64 character strings are good. They exist in riak and can be loaded. 
&gt; &gt; The other results make less sense. null, a, c, 9, [, and "mentions" aren't 
&gt; &gt; valid keys. Any ideas what might have happened that the results from a 
&gt; &gt; fetchIndex would have invalid keys? There are always 20 null responses and 
&gt; &gt; 20 single character responses. The single character responses vary from 
&gt; &gt; request to request. The "[" and "mentions" keys show up every time too. I'm 
&gt; &gt; confused here, because I don't think this could be me adding bad data. This 
&gt; &gt; list should be valid keys, as determined by riak, right?
&gt; 
&gt; They should be valid keys, yes. To help narrow the issue down, could you run 
&gt; the same query using the Java HTTP Client, please? The HTTP Client uses the 
&gt; HTTP 2i endpoint, whereas the PB client uses map/reduce behind the scenes.
&gt; 
&gt; Cheers
&gt; 
&gt; Russell
&gt; 
&gt; &gt;
&gt; &gt; There is a possibility that another bucket has index values with multibyte 
&gt; &gt; characters. Could that be breaking results in a separate bucket.
&gt; &gt;
&gt; &gt; Thanks in advance,
&gt; &gt; Alex
&gt; 
&gt; 

