---
title: "Re: error parsing Link headers in node.js when getting a bucket"
description: ""
project: community
lastmod: 2010-05-10T05:02:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00294"
mailinglist_parent_id: "msg00292"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-05-10T05:02:37-07:00
---


Rick,

If you don't want to list the keys when retrieving the bucket properties, pass 
the keys=false query string. When you have lots of keys, it's best to use 
keys=stream to retrieve them, which will prevent Riak from building a huge JSON 
object in memory. Instead, each chunk in the stream will be a JSON object 
containing a number of keys.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On May 10, 2010, at 3:29 AM, Rick Olson wrote:

&gt; Hey guys, I enjoyed going through the Riak Fast Track, so I wrote a
&gt; node.js library for it:
&gt; 
&gt; http://techno-weenie.net/2010/5/10/rhodes-riak-on-node-js
&gt; 
&gt; I ran into one problem though: node.js choked on the Link headers when
&gt; getting a bucket's properties. I realize this is a node.js bug, but I
&gt; found it kind of odd:
&gt; 
&gt; $ curl http://127.0.0.1:8091/riak/goog -i
&gt; HTTP/1.1 200 OK
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.6 (eat around the stinger)
&gt; Link: ; riaktag="contained",
&gt; ; riaktag="contained", ETC
&gt; 
&gt; If there are 1400 links, node.js has problems. If there are several
&gt; thousand, even curl starts having problems:
&gt; 
&gt; curl: (27) Avoided giant realloc for header (max is 102400)!
&gt; 
&gt; So, if I grab the contents of a bucket to get the list of keys, it
&gt; also sends a giant Link header pointing to each key? The Link header
&gt; ends up being much larger than the response body. Is it really
&gt; necessary to point to each resource, when the body contains an array
&gt; of keys?
&gt; 
&gt; At any rate, here's how the map reduce API looks while implementing
&gt; the sample functions from the fast track:
&gt; 
&gt; http://github.com/technoweenie/rhodes/blob/master/examples/fast-track/mapred.js#L6-19
&gt; 
&gt; -- 
&gt; Rick Olson
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

