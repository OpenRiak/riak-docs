---
title: "Re: multiple map phases"
description: ""
project: community
lastmod: 2010-06-10T16:27:34-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00550"
mailinglist_parent_id: "msg00549"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-06-10T16:27:34-07:00
---


Hi Thomas,

Map phases expect a list of bucket/key pairs. The input to the second map
phase would be the JSON values returned by the first map phase which is
invalid.

On Thu, Jun 10, 2010 at 3:33 PM, Thomas Heller  wrote:

&gt; Howdy folks,
&gt;
&gt; still trying to wrap my head arround riak and map/reduce, so I decided
&gt; to follow the fast-track and play arround with some of the examples.
&gt; Its easy enough and the examples work just like advertised. However, I
&gt; seem to be missing a critical part of knowledge about the map reduce
&gt; phases since I cannot explain this error.
&gt;
&gt; I loaded the goog.csv into riak and try to run this job:
&gt;
&gt; {
&gt; "inputs": [
&gt; ["goog", "2008-10-10"]
&gt; ],
&gt; "query": [
&gt; {"map":{"language":"javascript", "name":"Riak.mapValuesJson"}},
&gt; {"map":{"language":"javascript", "name":"Riak.mapValuesJson"}}
&gt; ]
&gt; }
&gt;
&gt; I know its pointless, but afaict I should end up with
&gt;
&gt; "[{"Date":"2008-10-10","Open":313.16,"High":341.89,"Low":310.3,"Close":332,"Volume":10597800,"Adj.
&gt; Close":332}]", which is what I get when I run with only ONE map phase.
&gt;
&gt; However I get a 500 with:
&gt;
&gt; The server encountered an error while processing this request:
&gt; {error,{error,{case\\_clause,{bad\\_return\\_value,{error,bad\\_input}}},
&gt; [{riak\\_kv\\_wm\\_mapred,process\\_post,2},
&gt; {webmachine\\_resource,resource\\_call,3},
&gt; {webmachine\\_resource,do,3},
&gt; {webmachine\\_decision\\_core,resource\\_call,1},
&gt; {webmachine\\_decision\\_core,decision,1},
&gt; {webmachine\\_decision\\_core,handle\\_request,2},
&gt; {webmachine\\_mochiweb,loop,1},
&gt; {mochiweb\\_http,headers,5}]}}
&gt;
&gt; I thought I can chain multiple map phases together?
&gt;
&gt; Cheers,
&gt; /thomas
&gt;
&gt; PS: this is on the riak-0.11.0-osx-x86\\_64.tar.gz release binary btw
&gt;

