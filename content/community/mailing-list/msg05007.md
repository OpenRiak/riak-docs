---
title: "Re: script erlang contrib function"
description: ""
project: community
lastmod: 2011-10-03T14:21:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05007"
mailinglist_parent_id: "msg05005"
author_name: "francisco treacy"
project_section: "mailinglistitem"
sent_date: 2011-10-03T14:21:39-07:00
---


Woah! cool, thanks!


2011/10/3 Russell Brown 

&gt;
&gt; On 3 Oct 2011, at 21:58, francisco treacy wrote:
&gt;
&gt; I was giving the bucket\\_inspector example because I happen to need it now.
&gt; I know I can write it in another lang in one minute, but since I'll be using
&gt; other Erlang contrib I wanted (and still want) to see how that would work;
&gt; but well, nevermind if it's not that straightforward.
&gt;
&gt;
&gt; There might be a more straight forward way, but I made a quick example
&gt; here https://github.com/russelldb/bad\\_bucket\\_inspector
&gt;
&gt; It is a bit overkill since it downloads and compiles riak\\_kv (and all its
&gt; dependancies), but still, there it is, if it helps. Basically it uses rebar
&gt; to escriptize a wrapper around the bucket\\_inspector module.
&gt;
&gt; Cheers
&gt;
&gt; Russell
&gt;
&gt;
&gt; Francisco
&gt;
&gt;
&gt; 2011/10/3 Russell Brown 
&gt;
&gt;&gt;
&gt;&gt; On 3 Oct 2011, at 20:43, francisco treacy wrote:
&gt;&gt;
&gt;&gt; Hi Greg
&gt;&gt;
&gt;&gt; Thanks, but what I'm really after is executing a script (non-interactive)
&gt;&gt;
&gt;&gt; This is what i've got:
&gt;&gt;
&gt;&gt; #!/usr/bin/env escript
&gt;&gt; %% -\\*- erlang -\\*-
&gt;&gt; %%! -name riakinspect -setcookie riak
&gt;&gt;
&gt;&gt; main([]) -&gt;
&gt;&gt; %{ok, Client} = riak:client\\_connect('riaksearch@127.0.0.1'),
&gt;&gt; % i have the module compiled in /tmp
&gt;&gt; code:add\\_path("/tmp"),
&gt;&gt; bucket\\_inspector:inspect(&lt;&lt;"bucket"&gt;&gt;, 'riaksearch@127.0.0.1').
&gt;&gt;
&gt;&gt;
&gt;&gt; Outputs:
&gt;&gt;
&gt;&gt; escript: exception error: undefined function riak:client\\_connect/1
&gt;&gt; in function bucket\\_inspector:inspect/2
&gt;&gt; in call from erl\\_eval:local\\_func/5
&gt;&gt; in call from escript:interpret/4
&gt;&gt; in call from escript:start/1
&gt;&gt; in call from init:start\\_it/1
&gt;&gt; in call from init:start\\_em/1
&gt;&gt;
&gt;&gt; Looks like it can't find riak in its path. I could pass-in a client, but
&gt;&gt; have no clue how.
&gt;&gt;
&gt;&gt; tl;dr I want to do something like this:
&gt;&gt; http://contrib.basho.com/usage.html but on a script.
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Why not just script the remote client of your choice in the language you
&gt;&gt; \\_are\\_ comfortable with to do the same thing? Say if you're a pythonista use
&gt;&gt; the python client to list keys and fetch each key. That is all the contrib
&gt;&gt; does, or am I missing something?
&gt;&gt;
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Francisco
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; 2011/10/3 Greg Pascale 
&gt;&gt;
&gt;&gt;&gt; Hey Francisco,
&gt;&gt;&gt;
&gt;&gt;&gt; If what you're looking to do is connect to Riak in Erlang without having
&gt;&gt;&gt; to run 'riak attach', try this little bit of magic.
&gt;&gt;&gt;
&gt;&gt;&gt; http://www.clipboard.com/clip/LR04fvr5rXWvT\\_\\_G
&gt;&gt;&gt;
&gt;&gt;&gt; The value for "cookie" will be "riak" unless you've changed it.
&gt;&gt;&gt;
&gt;&gt;&gt; --
&gt;&gt;&gt; Greg
&gt;&gt;&gt; Clipboard
&gt;&gt;&gt;
&gt;&gt;&gt; On Monday, October 3, 2011 at 6:20 AM, francisco treacy wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Please? at least a pointer!
&gt;&gt;&gt;
&gt;&gt;&gt; 2011/9/29 francisco treacy 
&gt;&gt;&gt;
&gt;&gt;&gt; I'm wanting to use the `bucket\\_inspector` contrib function (but have zero
&gt;&gt;&gt; Erlang experience).
&gt;&gt;&gt;
&gt;&gt;&gt; Following the "usage" page, I do the following:
&gt;&gt;&gt;
&gt;&gt;&gt; $ /opt/riak/erts-5.7.5/bin/erlc -o /tmp /tmp/bucket\\_inspector.erl$ riak 
&gt;&gt;&gt; attach(riak@127.0.0.1)1&gt; code:add\\_path("/tmp").(riak@127.0.0.1)2&gt; 
&gt;&gt;&gt; m(bucket\\_inspector).(riak@127.0.0.1)3&gt; 
&gt;&gt;&gt; bucket\\_inspector:inspect(&lt;&lt;"bucket"&gt;&gt;, 'riaksearch@127.0.0.1').
&gt;&gt;&gt;
&gt;&gt;&gt; And it works.
&gt;&gt;&gt;
&gt;&gt;&gt; Now, if I want to run that non-interactively, as a script, how should I
&gt;&gt;&gt; proceed?
&gt;&gt;&gt;
&gt;&gt;&gt; I played around with escript but I can't seem to load the Riak path (so
&gt;&gt;&gt; the script will fail at `code` et al)
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;
&gt;&gt;&gt; Francisco
&gt;&gt;&gt;
&gt;&gt;&gt;

&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;

