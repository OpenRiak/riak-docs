---
title: "Re: With Ruby Client, How to Test for Server Availability or Clear	All Data?"
description: ""
project: community
lastmod: 2011-07-01T06:34:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03900"
mailinglist_parent_id: "msg03899"
author_name: "Keith Bennett"
project_section: "mailinglistitem"
sent_date: 2011-07-01T06:34:23-07:00
---


Awesome, Sean! Thanks!!!

- Keith


On Fri, Jul 1, 2011 at 9:05 AM, Sean Cribbs  wrote:
&gt; Keith,
&gt; If this is just testing (e.g. Test::Unit or RSpec), I encourage you to use
&gt; the Riak::TestServer instead (which you can also use from irb if you like).
&gt; It will create a "phantom" node that uses the same code/runtime as your
&gt; existing Riak installation, but exists completely separately and uses an
&gt; in-memory backend so that it is trivial to wipe its data.  The docs for it
&gt; are here (although they could use some
&gt; improvement): http://seancribbs.github.com/ripple/Riak/TestServer.html
&gt; In IRB I might do this to get it started:
&gt; require 'riak/test\\_server'
&gt; server = Riak::TestServer.new(:bin\\_dir =&gt; "/opt/local/riak/bin", :temp\\_dir
&gt; =&gt; "~/riaktest")
&gt; server.prepare!
&gt; server.start
&gt; Then when you want to wipe the data:
&gt; server.recycle
&gt; If you're using Ripple in a Rails 3 project, `rails generate ripple` will
&gt; generate all of this for you and add it to your chosen testing framework.
&gt;
&gt; On Thu, Jun 30, 2011 at 6:43 PM, Keith Bennett
&gt;  wrote:
&gt;&gt;
&gt;&gt; All -
&gt;&gt;
&gt;&gt; I have some test procedures that require that I start with an empty data
&gt;&gt; store and end with the data exactly as it was before the test.
&gt;&gt;
&gt;&gt; The brute force approach I'm taking now is to:
&gt;&gt;
&gt;&gt; \\* shut down riak
&gt;&gt; \\* rename the data/bitcask directory
&gt;&gt; \\* start riak
&gt;&gt; \\* run my test and validate the results in riak
&gt;&gt; \\* shut down riak
&gt;&gt; \\* move the saved bitcask-xyz dir to bitcask again
&gt;&gt; \\* start riak
&gt;&gt;
&gt;&gt; As you can see, I \\*really\\* want to start with no data, and end with no
&gt;&gt; changes to the existing data.  Of course, if other users were accessing
&gt;&gt; riak, this wouldn't work, but this is a test environment over which I have
&gt;&gt; control.
&gt;&gt;
&gt;&gt; My problem is that it takes a little time after running riak start or stop
&gt;&gt; for the operation to complete, and so I have to insert a sleep afterwards so
&gt;&gt; that the next step in the code is not performed prematurely.  Is there a way
&gt;&gt; using the Ruby Riak client to know for sure whether or not riak is ready for
&gt;&gt; action? I could loop every fraction of a second, or, if there were a
&gt;&gt; blocking call, that would be even better.
&gt;&gt;
&gt;&gt; That said, the shutting down and restarting is pretty drastic action.  Is
&gt;&gt; there a faster/easier/better way to accomplish what I want to do?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Keith
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://www.basho.com/
&gt;

