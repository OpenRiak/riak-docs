---
title: "Re: Map function in erlang that takes entire bucket as input?"
description: ""
project: community
lastmod: 2013-01-10T07:40:21-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09787"
mailinglist_parent_id: "msg09783"
author_name: "Christian Dahlqvist"
project_section: "mailinglistitem"
sent_date: 2013-01-10T07:40:21-08:00
---


Hi Shaan,

The riakc\\_pb\\_socket:mapred function can take several different types of input: 
a bucket name, a list of bucket/key pairs or a secondary index query 
specification. 

If you wanted to run the example in the tutorial based on all keys in the 
groceries bucket instead of having to specify the keys individually, you could 
set input to the bucket name &lt;&lt;"groceries"&gt;&gt; as shown below:

{ok, [{1, [R]}]} = riakc\\_pb\\_socket:mapred(
 Client,
 [&lt;&lt;"groceries"&gt;&gt;,
 [{map, {qfun, Count}, none, false},
 {reduce, {qfun, Merge}, none, true}]).

The specification for what inputs you can specify is available in the riakc.hrl 
file 
(https://github.com/basho/riak-erlang-client/blob/master/include/riakc.hrl) and 
looks like this:

-type mapred\\_inputs() :: [{bucket(), key()} | {{bucket(), key()}, term()}] |
 {modfun, Module::atom(), Function::atom(), [term()]} |
 bucket() |
 {index, bucket(), Index::binary(), key()} |
 {index, bucket(), Index::binary(), StartKey::key(), 
EndKey::key()}.

Best regards,

Christian

On 10 Jan 2013, at 06:56, Shaan Sapra  wrote:

&gt; Hi all,
&gt; 
&gt; I'm exploring the erlang-riak-client and trying to write MapReduce functions 
&gt; to mimic the ones I've written in Javascript and in the riak-ruby-client.
&gt; 
&gt; Following the tutorial here, I have successfully run the query. I have now 
&gt; loaded a bucket with 10000 keys into Riak and now I want to write a simple 
&gt; map function that queries the bucket and returns all of the objects back to 
&gt; me.
&gt; 
&gt; I noticed that the input is specified as {&lt;&lt;"groceries"&gt;&gt;, &lt;&lt;"mine"&gt;&gt;}. Is 
&gt; there is a way to specify just the bucket in its entirety? If I wanted to 
&gt; query my bucket, would I have to list all 10000 keys in a list?
&gt; 
&gt; In the riak-ruby-client, it was possible to add the entire bucket. 
&gt; 
&gt; Thanks for any help! I'm sure this is a silly question, but I've been hard 
&gt; pressed to find good documentation for a novice like me.
&gt; 
&gt; Shaan

