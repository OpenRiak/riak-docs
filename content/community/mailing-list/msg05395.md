---
title: "Re: Riak 1.0.1 w/search nodes crashing"
description: ""
project: community
lastmod: 2011-10-31T13:47:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05395"
mailinglist_parent_id: "msg05348"
author_name: "Kelly McLaughlin"
project_section: "mailinglistitem"
sent_date: 2011-10-31T13:47:40-07:00
---


Hi Gordon,

I'm looking at the info you provided about the problem and I suspect that it is 
related to your use of 90 as the ring creation size. We generally recommend the 
value to be a power of 2, though we do not explicitly enforce that in the code. 
If this is a development cluster the simplest path may be to wipe out all of 
the cluster data and ring information, change the ring\\_creation\\_size to 128 
(for example) on each node, reform the cluster and reinsert the data. 

Another path to resolution is to use the riak-admin backup option to backup 
your data, change the ring\\_creation\\_size to 128, remove the existing ring data 
(i.e. the data/ring/ subdirectory where your riak data lives). Do this for each 
node in the cluster. Then restore the data on each node with riak-admin restore 
and rejoin the nodes to form a cluster again. Unfortuately, search data is not 
handled by the current backup and restore functionality so you will need to 
remove the search data from data/merge-index and then you will have to reindex 
your documents. Support for backup and restore of search data is coming, but it 
is just not there yet. Hope this helps.

Kelly

On Oct 28, 2011, at 12:46 PM, Gordon Tillman wrote:

&gt; Howdy Gang,
&gt; 
&gt; We have a 3 node Riak 1.0.1 with search enabled and are seeing the following 
&gt; errors in the Riak log file:
&gt; 
&gt; ==&gt; /var/log/riak/console.log &lt;==
&gt; 2011-10-28 11:04:21.900 [error] &lt;0.993.0&gt; gen\\_fsm &lt;0.993.0&gt; in state 
&gt; initialize terminated with reason: bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2
&gt; 2011-10-28 11:04:21.906 [error] &lt;0.993.0&gt; CRASH REPORT Process &lt;0.993.0&gt; with 
&gt; 0 neighbours crashed with reason: bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2
&gt; 2011-10-28 11:04:21.930 [error] &lt;0.257.0&gt; Supervisor riak\\_kv\\_keys\\_fsm\\_sup had 
&gt; child undefined started with {riak\\_core\\_coverage\\_fsm,start\\_link,undefined} at 
&gt; &lt;0.993.0&gt; exit with reason bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2 in context child\\_terminated
&gt; 
&gt; ==&gt; /var/log/riak/crash.log &lt;==
&gt; 2011-10-28 11:04:21 =ERROR REPORT====
&gt; \\*\\* State machine &lt;0.993.0&gt; terminating 
&gt; \\*\\* Last event in was timeout
&gt; \\*\\* When State == initialize
&gt; \\*\\* Data == 
&gt; {state,undefined,riak\\_kv\\_keys\\_fsm,{state,plain,{raw,60225046,&lt;0.465.0&gt;}},3,riak\\_kv,all,1,{'riak\\_kv\\_listkeys\\_req\\_v3',&lt;&lt;"queue"&gt;&gt;,none},60225046,undefined,0,60000,riak\\_kv\\_vnode\\_master}
&gt; \\*\\* Reason for termination = 
&gt; \\*\\* 
&gt; {badarg,[{erlang,hd,[[]]},{riak\\_core\\_ring,index\\_owner,2},{riak\\_core\\_coverage\\_plan,'-create\\_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak\\_core\\_coverage\\_fsm,initialize,2},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; 2011-10-28 11:04:21 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\\_core\\_coverage\\_fsm:init/1
&gt; pid: &lt;0.993.0&gt;
&gt; registered\\_name: []
&gt; exception exit: 
&gt; {badarg,[{erlang,hd,[[]]},{riak\\_core\\_ring,index\\_owner,2},{riak\\_core\\_coverage\\_plan,'-create\\_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak\\_core\\_coverage\\_fsm,initialize,2},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; in function gen\\_fsm:terminate/7
&gt; in call from proc\\_lib:init\\_p\\_do\\_apply/3
&gt; ancestors: [riak\\_kv\\_keys\\_fsm\\_sup,riak\\_kv\\_sup,&lt;0.177.0&gt;]
&gt; messages: []
&gt; links: [&lt;0.257.0&gt;]
&gt; dictionary: []
&gt; trap\\_exit: false
&gt; status: running
&gt; heap\\_size: 4181
&gt; stack\\_size: 24
&gt; reductions: 86192
&gt; neighbours:
&gt; 2011-10-28 11:04:21 =SUPERVISOR REPORT====
&gt; Supervisor: {local,riak\\_kv\\_keys\\_fsm\\_sup}
&gt; Context: child\\_terminated
&gt; Reason: 
&gt; {badarg,[{erlang,hd,[[]]},{riak\\_core\\_ring,index\\_owner,2},{riak\\_core\\_coverage\\_plan,'-create\\_plan/5-fun-0-',6},{lists,mapfoldl,3},{riak\\_core\\_coverage\\_fsm,initialize,2},{gen\\_fsm,handle\\_msg,7},{proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; Offender: 
&gt; [{pid,&lt;0.993.0&gt;},{name,undefined},{mfargs,{riak\\_core\\_coverage\\_fsm,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,5000},{child\\_type,worker}]
&gt; 
&gt; 
&gt; ==&gt; /var/log/riak/erlang.log.3 &lt;==
&gt; 11:04:21.900 [error] gen\\_fsm &lt;0.993.0&gt; in state initialize terminated with 
&gt; reason: bad argument in call to erlang:hd([]) in riak\\_core\\_ring:index\\_owner/2
&gt; 11:04:21.906 [error] CRASH REPORT Process &lt;0.993.0&gt; with 0 neighbours crashed 
&gt; with reason: bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2 
&gt; 11:04:21.930 [error] Supervisor riak\\_kv\\_keys\\_fsm\\_sup had child undefined 
&gt; started with {riak\\_core\\_coverage\\_fsm,start\\_link,undefined} at &lt;0.993.0&gt; exit 
&gt; with reason bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2 in context child\\_terminated
&gt; 
&gt; ==&gt; /var/log/riak/error.log &lt;==
&gt; 2011-10-28 11:04:21.900 [error] &lt;0.993.0&gt; gen\\_fsm &lt;0.993.0&gt; in state 
&gt; initialize terminated with reason: bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2
&gt; 2011-10-28 11:04:21.906 [error] &lt;0.993.0&gt; CRASH REPORT Process &lt;0.993.0&gt; with 
&gt; 0 neighbours crashed with reason: bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2
&gt; 2011-10-28 11:04:21.930 [error] &lt;0.257.0&gt; Supervisor riak\\_kv\\_keys\\_fsm\\_sup had 
&gt; child undefined started with {riak\\_core\\_coverage\\_fsm,start\\_link,undefined} at 
&gt; &lt;0.993.0&gt; exit with reason bad argument in call to erlang:hd([]) in 
&gt; riak\\_core\\_ring:index\\_owner/2 in context child\\_terminated
&gt; 
&gt; Would anyone be able to clue me in as to the cause? I have the log snippet, 
&gt; status, and cluster info all available online.
&gt; 
&gt; LOG:
&gt; https://gist.github.com/1322665
&gt; 
&gt; STATUS:
&gt; https://gist.github.com/1322680
&gt; 
&gt; CLUSTER INFO:
&gt; 
&gt; This was to big to fit in a gist (1.7MB):
&gt; 
&gt; https://eval.mezeo.net/v2/files/A725C464-0194-11E1-9D55-0030485F2412/content/inline/cluster\\_info.txt
&gt; 
&gt; Thanks a bunch!
&gt; 
&gt; --gordon
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

