---
title: "Re: Locking"
description: ""
project: community
lastmod: 2011-08-02T07:40:43-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04175"
mailinglist_parent_id: "msg04160"
author_name: "Jeffrey Kesselman"
project_section: "mailinglistitem"
sent_date: 2011-08-02T07:40:43-07:00
---


jon gave a much better and more detailed description, but fundamentally no
true lock is possible without an atomic test and set operation.

So far, of all the No Sql DBs I've looked at, only Mongo has that
capability.



On Sun, Jul 31, 2011 at 4:55 PM, Soren Hansen  wrote:

&gt; I've seen a couple of posts here and there on the subject of a locking
&gt; mechanism for Riak, most notably:
&gt;
&gt; http://riak-users.197444.n3.nabble.com/Riak-and-Locks-td1866960.html
&gt;
&gt; While it would only serve as an advisory locking mechanism, wouldn't a
&gt; bucket with a reasonably high n, w and dw set equal to n, a
&gt; deterministic naming scheme for the object being locked, and a locking
&gt; algorithm such as:
&gt;
&gt; 1. PUT /locks/object\\_id
&gt; If-None-Match: \\*
&gt; Body: 
&gt;
&gt; 1a. If this fails, wait for a while, then try again.
&gt; 1b. If it succeeds, proceed to 2.
&gt;
&gt; 2. The doc for If-None-Match says "this does not prevent concurrent
&gt; writes; it is possible for the condition to evaluate to true for
&gt; multiple requests if the requests occur at the same time." I'm not
&gt; completely sure if n=w=dw protects me from concurrent writes (I'm not
&gt; familiar with the locking semantics of a single riak instance).
&gt; Anyway, if I'm in fact not protected, the next step is to read the
&gt; value back to make sure we're actually the ones holding the key. If
&gt; not, go back to step 1. If yes, proceed as planned.
&gt;
&gt; 3. Once you're done with the lock, just DELETE it.
&gt;
&gt; If this were really that simple, someone would have suggested it. So,
&gt; what is this Riak rookie (i.e. I) missing?
&gt;
&gt;
&gt; --
&gt; Soren Hansen | http://linux2go.dk/
&gt; Ubuntu Developer | http://www.ubuntu.com/
&gt; OpenStack Developer | http://www.openstack.org/
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

