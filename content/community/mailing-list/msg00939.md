---
title: "Re: list_keys is less bad"
description: ""
project: community
lastmod: 2010-08-23T19:06:07-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00939"
mailinglist_parent_id: "msg00938"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2010-08-23T19:06:07-07:00
---


Three cheers!

Git clone && make all && make rel

- stat!

On 2010-08-23, Justin Sheehy  wrote:
&gt; Riak Users,
&gt;
&gt; One aspect of Riak's interface that has often been discouraged in the
&gt; past is the listing of all keys in a bucket. This has been for two
&gt; reasons: the first is that it is necessarily an operation that is more
&gt; heavyweight than any of the more targeted get/put/delete sorts of
&gt; things, but the second is that due to the priorities of the first many
&gt; users of Riak we hadn't really put much optimization into that area.
&gt; As a result, anything that required getting all keys from a bucket was
&gt; fairly slow and also fairly heavy in terms of memory consumption.
&gt;
&gt; We have put some effort into this recently and seen marked
&gt; improvement. The changes can be summed up as:
&gt;
&gt; 1- bitcask has a new fold\\_keys operation, which performs far less I/O
&gt; in most cases than the previous mechanism underlying list\\_keys.
&gt;
&gt; 2- the Riak backend interface to bitcask uses the new fold\\_keys operation.
&gt;
&gt; 3- the mechanism underlying the cluster-wide list\\_keys operation has
&gt; changed to require far less total memory in proportion to the list.
&gt;
&gt; Due to these three changes, there are two effective results:
&gt;
&gt; 1- In nearly all cases, the list\\_keys operator is much faster than
&gt; before. In some common cases it is 10 times faster.
&gt;
&gt; 2- In cases of very large buckets, memory allocation will not spike
&gt; during key listing. (though of course if you ask Riak to build the
&gt; whole list for you instead of streaming it out, then at least that
&gt; much must be used to accommodate)
&gt;
&gt; Note that since map/reduce uses the streaming list\\_keys under the hood
&gt; when performing map/reduce over a whole bucket, these changes affect
&gt; that interface's performance as well.
&gt;
&gt; The described changes are now in the trunks of the relevant
&gt; repositories, and will be included in the next release.
&gt;
&gt; -Justin
&gt;


-- 
Sent from my mobile device

