---
title: "Re: preflist_exhausted with map-reduce and riak-js"
description: ""
project: community
lastmod: 2012-04-03T14:03:58-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07124"
mailinglist_parent_id: "msg07106"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2012-04-03T14:03:58-07:00
---


Hi Matthew,

Thanks for the logs. Do you know how many map/reduce jobs you run
concurrently? Is this a load-based issue or do you run into problems?

Running this from the erlang console should give an idea of how many pipes,
fittings and JS VMs you are running concurrently ('riak attach' to start,
^D to exit)

 rpc:multicall(supervisor, count\\_children, [riak\\_pipe\\_builder\\_sup]).
 rpc:multicall(supervisor, count\\_children, [riak\\_pipe\\_fitting\\_sup]).
 rpc:multicall(riak\\_kv\\_js\\_manager,pool\\_size,[riak\\_kv\\_js\\_map]).
 rpc:multicall(riak\\_kv\\_js\\_manager,pool\\_size,[riak\\_kv\\_js\\_reduce]).

For the two supervisors, add up the active counts, for the two managers,
that gives how many JS VMs are running per-node.

If the number of concurrent requests is low, maybe we can find a higher
bandwidth way of investigating.

Jon

On Mon, Apr 2, 2012 at 4:21 PM, Matthew Tovbin  wrote:

&gt; Unfortunately, yes, Jon.
&gt;
&gt; Here are my log files after setting 128/128 for 'map\\_js\\_vm\\_count' and
&gt; 'reduce\\_js\\_vm\\_count' accordingly and restarting all the nodes (see
&gt; attached app.config).
&gt;
&gt; If you need any other information provided or tests performed please let
&gt; me know.
&gt;
&gt; \\*-Console.log:\\*
&gt; 2012-04-02 15:16:56.848 [notice]
&gt; &lt;0.22138.162&gt;@riak\\_kv\\_js\\_manager:blocking\\_dispatch:247 JS call failed: All
&gt; VMs are busy.
&gt; 2012-04-02 15:16:56.853 [error] &lt;0.22121.162&gt; gen\\_fsm &lt;0.22121.162&gt; in
&gt; state wait\\_pipeline\\_shutdown terminated with reason: {sink\\_died,shutdown}
&gt; 2012-04-02 15:16:56.860 [error] &lt;0.22121.162&gt; CRASH REPORT Process
&gt; &lt;0.22121.162&gt; with 0 neighbours crashed with reason: {sink\\_died,shutdown}
&gt; 2012-04-02 15:16:56.862 [error] &lt;0.1451.0&gt; Supervisor
&gt; riak\\_pipe\\_builder\\_sup had child undefined started with
&gt; {riak\\_pipe\\_builder,start\\_link,undefined} at &lt;0.22121.162&gt; exit with reason
&gt; {sink\\_died,shutdown} in context child\\_terminated
&gt;
&gt; \\*-Error.log:\\*
&gt; \\*\\* State machine &lt;0.22121.162&gt; terminating
&gt; \\*\\* Last message in was
&gt; {'DOWN',#Ref&lt;0.0.33.48784&gt;,process,&lt;0.22119.162&gt;,shutdown}
&gt; \\*\\* When State == wait\\_pipeline\\_shutdown
&gt; \\*\\* Data ==
&gt; {state,[{sink,{fitting,&lt;0.22119.162&gt;,#Ref&lt;0.0.33.48768&gt;,{riak\\_kv\\_pipe\\_get,bkey\\_chash},{riak\\_kv\\_pipe\\_get,bkey\\_nval}}},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},{log,{sink,{fitting,&lt;0.21554.162&gt;,#Ref&lt;0.0.33.48768&gt;,sink,undefined}}}],{pipe,&lt;0.22121.162&gt;,[{listkeys,{fitting,&lt;0.22122.162&gt;,#Ref&lt;0.0.33.48768&gt;,{chash,key\\_of},1}}],{fitting,&lt;0.22119.162&gt;,#Ref&lt;0.0.33.48768&gt;,{riak\\_kv\\_pipe\\_get,bkey\\_chash},{riak\\_kv\\_pipe\\_get,bkey\\_nval}}},[{{fitting,&lt;0.22122.162&gt;,#Ref&lt;0.0.33.48768&gt;,{chash,key\\_of},1},#Ref&lt;0.0.33.48787&gt;}],#Ref&lt;0.0.33.48784&gt;}
&gt; \\*\\* Reason for termination =
&gt; \\*\\* {sink\\_died,shutdown}
&gt; 2012-04-02 15:16:56 =CRASH REPORT====
&gt; crasher:
&gt; initial call: riak\\_pipe\\_builder:init/1
&gt; pid: &lt;0.22121.162&gt;
&gt; registered\\_name: []
&gt; exception exit: {sink\\_died,shutdown}
&gt; in function gen\\_fsm:terminate/7
&gt; in call from proc\\_lib:init\\_p\\_do\\_apply/3
&gt; ancestors: [riak\\_pipe\\_builder\\_sup,riak\\_pipe\\_sup,&lt;0.1448.0&gt;]
&gt; messages: [{'DOWN',#Ref&lt;0.0.33.48787&gt;,process,&lt;0.22122.162&gt;,shutdown}]
&gt; links: [&lt;0.1451.0&gt;]
&gt; dictionary:
&gt; [{eunit,[{module,riak\\_pipe\\_builder},{ref,#Ref&lt;0.0.33.48768&gt;},{spec,[{fitting\\_spec,listkeys,riak\\_kv\\_pipe\\_listkeys,undefined,{chash,key\\_of},1,64}]},{options,[{sink,{fitting,&lt;0.22119.162&gt;,#Ref&lt;0.0.33.48768&gt;,{riak\\_kv\\_pipe\\_get,bkey\\_chash},{riak\\_kv\\_pipe\\_get,bkey\\_nval}}},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},{log,{sink,{fitting,&lt;0.21554.162&gt;,#Ref&lt;0.0.33.48768&gt;,sink,undefined}}}]},{fittings,[{{fitting,&lt;0.22122.162&gt;,#Ref&lt;0.0.33.48768&gt;,{chash,key\\_of},1},#Ref&lt;0.0.33.48787&gt;}]}]}]
&gt; trap\\_exit: false
&gt; status: running
&gt; heap\\_size: 987
&gt; stack\\_size: 24
&gt; reductions: 251
&gt; neighbours:
&gt; 2012-04-02 15:16:56 =SUPERVISOR REPORT====
&gt; Supervisor: {local,riak\\_pipe\\_builder\\_sup}
&gt; Context: child\\_terminated
&gt; Reason: {sink\\_died,shutdown}
&gt; Offender:
&gt; [{pid,&lt;0.22121.162&gt;},{name,undefined},{mfargs,{riak\\_pipe\\_builder,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,brutal\\_kill},{child\\_type,worker}]
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; -Matthew
&gt;
&gt;
&gt;
&gt; On Mon, Apr 2, 2012 at 12:27, Jon Meredith  wrote:
&gt;
&gt;&gt; Very strange.
&gt;&gt;
&gt;&gt; Are you seeing the
&gt;&gt;
&gt;&gt; 16:40:50.037 [notice] JS call failed: All VMs are busy.
&gt;&gt;
&gt;&gt; message in your console.log files on any of the nodes in your cluster?
&gt;&gt;
&gt;&gt; Jon
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Apr 2, 2012 at 11:48 AM, Matthew Tovbin wrote:
&gt;&gt;
&gt;&gt;&gt; Jon,
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for the reply. I tried increasing the 'map\\_js\\_vm\\_count' and
&gt;&gt;&gt; 'reduce\\_js\\_vm\\_count' on the cluster to the values you suggested 24/18
&gt;&gt;&gt; and even larger ones 32/24 and 128/128, but with no success - I still get
&gt;&gt;&gt; the same error in the console log of the node.
&gt;&gt;&gt;
&gt;&gt;&gt; What are we missing?!
&gt;&gt;&gt;
&gt;&gt;&gt; -Matthew
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Fri, Mar 30, 2012 at 16:19, Jon Meredith  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Hi list,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I spend some time looking at this issue today. I suspect it is due to
&gt;&gt;&gt;&gt; all the Javascript VMs being busy inside Riak due to many parallel
&gt;&gt;&gt;&gt; MapReduce jobs.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If you're seeing this issue please check for this message in the
&gt;&gt;&gt;&gt; console.log file
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 16:40:50.037 [notice] JS call failed: All VMs are busy.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I've filed https://github.com/basho/riak\\_pipe/issues/44 to track
&gt;&gt;&gt;&gt; improvements to error reporting.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If you are seeing the log message, the number of VMs allocated for map
&gt;&gt;&gt;&gt; and reduce tasks can be configured in the app.config - defaults are 8 for
&gt;&gt;&gt;&gt; map and 6 for reduce, increasing them will use more memory but should
&gt;&gt;&gt;&gt; reduce the incidence of the error message.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; {riak\\_kv, [
&gt;&gt;&gt;&gt; ...
&gt;&gt;&gt;&gt; {map\\_js\\_vm\\_count, 24 },
&gt;&gt;&gt;&gt; {reduce\\_js\\_vm\\_count, 18 },
&gt;&gt;&gt;&gt; ...]
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; If you were affected by it and changing this does not resolve your
&gt;&gt;&gt;&gt; issue, I'll keep digging.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Cheers, Jon.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Thu, Mar 29, 2012 at 10:29 AM, Matthew Tovbin wrote:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Guys,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Any updates on the issue?!
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; -Matthew
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Tue, Mar 13, 2012 at 18:29, Matthew Tovbin wrote:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Here is a log from one of the servers:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; ==&gt; /mnt/dataraid/log/crash.log &lt;==
&gt;&gt;&gt;&gt;&gt;&gt; 2012-03-13 18:24:44 =CRASH REPORT====
&gt;&gt;&gt;&gt;&gt;&gt; crasher:
&gt;&gt;&gt;&gt;&gt;&gt; initial call: riak\\_pipe\\_builder:init/1
&gt;&gt;&gt;&gt;&gt;&gt; pid: &lt;0.20949.24&gt;
&gt;&gt;&gt;&gt;&gt;&gt; registered\\_name: []
&gt;&gt;&gt;&gt;&gt;&gt; exception exit: {sink\\_died,shutdown}
&gt;&gt;&gt;&gt;&gt;&gt; in function gen\\_fsm:terminate/7
&gt;&gt;&gt;&gt;&gt;&gt; in call from proc\\_lib:init\\_p\\_do\\_apply/3
&gt;&gt;&gt;&gt;&gt;&gt; ancestors: [riak\\_pipe\\_builder\\_sup,riak\\_pipe\\_sup,&lt;0.172.0&gt;]
&gt;&gt;&gt;&gt;&gt;&gt; messages:
&gt;&gt;&gt;&gt;&gt;&gt; [{'DOWN',#Ref&lt;0.0.5.38339&gt;,process,&lt;0.20950.24&gt;,shutdown}]
&gt;&gt;&gt;&gt;&gt;&gt; links: [&lt;0.175.0&gt;]
&gt;&gt;&gt;&gt;&gt;&gt; dictionary:
&gt;&gt;&gt;&gt;&gt;&gt; [{eunit,[{module,riak\\_pipe\\_builder},{ref,#Ref&lt;0.0.5.38318&gt;},{spec,[{fitting\\_spec,listkeys,riak\\_kv\\_pipe\\_listkeys,undefined,{chash,key\\_of},1,64}]},{options,[{sink,{fitting,&lt;0.20947.24&gt;,#Ref&lt;0.0.5.38318&gt;,{riak\\_kv\\_pipe\\_get,bkey\\_chash},{riak\\_kv\\_pipe\\_get,bkey\\_nval}}},{trace,{set,1,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[error],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},{log,{sink,{fitting,&lt;0.20060.24&gt;,#Ref&lt;0.0.5.38318&gt;,sink,undefined}}}]},{fittings,[{{fitting,&lt;0.20950.24&gt;,#Ref&lt;0.0.5.38318&gt;,{chash,key\\_of},1},#Ref&lt;0.0.5.38339&gt;}]}]}]
&gt;&gt;&gt;&gt;&gt;&gt; trap\\_exit: false
&gt;&gt;&gt;&gt;&gt;&gt; status: running
&gt;&gt;&gt;&gt;&gt;&gt; heap\\_size: 987
&gt;&gt;&gt;&gt;&gt;&gt; stack\\_size: 24
&gt;&gt;&gt;&gt;&gt;&gt; reductions: 251
&gt;&gt;&gt;&gt;&gt;&gt; neighbours:
&gt;&gt;&gt;&gt;&gt;&gt; 2012-03-13 18:24:44 =SUPERVISOR REPORT====
&gt;&gt;&gt;&gt;&gt;&gt; Supervisor: {local,riak\\_pipe\\_builder\\_sup}
&gt;&gt;&gt;&gt;&gt;&gt; Context: child\\_terminated
&gt;&gt;&gt;&gt;&gt;&gt; Reason: {sink\\_died,shutdown}
&gt;&gt;&gt;&gt;&gt;&gt; Offender:
&gt;&gt;&gt;&gt;&gt;&gt; [{pid,&lt;0.20949.24&gt;},{name,undefined},{mfargs,{riak\\_pipe\\_builder,start\\_link,undefined}},{restart\\_type,temporary},{shutdown,brutal\\_kill},{child\\_type,worker}]
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; ==&gt; /mnt/dataraid/log/console.log &lt;==
&gt;&gt;&gt;&gt;&gt;&gt; 2012-03-13 18:24:44.645 [error] &lt;0.20949.24&gt; CRASH REPORT Process
&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.20949.24&gt; with 0 neighbours crashed with reason: {sink\\_died,shutdown}
&gt;&gt;&gt;&gt;&gt;&gt; 2012-03-13 18:24:44.652 [error] &lt;0.175.0&gt; Supervisor
&gt;&gt;&gt;&gt;&gt;&gt; riak\\_pipe\\_builder\\_sup had child undefined started with
&gt;&gt;&gt;&gt;&gt;&gt; {riak\\_pipe\\_builder,start\\_link,undefined} at &lt;0.20949.24&gt; exit with reason
&gt;&gt;&gt;&gt;&gt;&gt; {sink\\_died,shutdown} in context child\\_terminated
&gt;&gt;&gt;&gt;&gt;&gt; 2012-03-13 18:24:56.420 [info]
&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.71.0&gt;@riak\\_core\\_sysmon\\_handler:handle\\_event:85 monitor long\\_gc
&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.32603.24&gt;
&gt;&gt;&gt;&gt;&gt;&gt; [{initial\\_call,{mochiweb\\_acceptor,init,3}},{almost\\_current\\_function,{gen,do\\_call,4}},{message\\_queue\\_len,0}]
&gt;&gt;&gt;&gt;&gt;&gt; [{timeout,120},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,4181},{mbuf\\_size,0},{stack\\_size,40},{old\\_heap\\_size,0},{heap\\_size,1955}]
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; ==&gt; /mnt/dataraid/log/erlang.log.1 &lt;==
&gt;&gt;&gt;&gt;&gt;&gt; 18:24:44.634 [error] gen\\_fsm &lt;0.20949.24&gt; in state
&gt;&gt;&gt;&gt;&gt;&gt; wait\\_pipeline\\_shutdown terminated with reason: {sink\\_died,shutdown}
&gt;&gt;&gt;&gt;&gt;&gt; (riak@1)1&gt; 18:24:44.641 [error] Pipe worker startup failed:fitting
&gt;&gt;&gt;&gt;&gt;&gt; was gone before startup
&gt;&gt;&gt;&gt;&gt;&gt; (riak@1)1&gt;
&gt;&gt;&gt;&gt;&gt;&gt; 18:24:44.645 [error] CRASH REPORT Process &lt;0.20949.24&gt; with 0
&gt;&gt;&gt;&gt;&gt;&gt; neighbours crashed with reason: {sink\\_died,shutdown}
&gt;&gt;&gt;&gt;&gt;&gt; (riak@1)1&gt; 18:24:44.652 [error] Supervisor riak\\_pipe\\_builder\\_sup had
&gt;&gt;&gt;&gt;&gt;&gt; child undefined started with {riak\\_pipe\\_builder,start\\_link,undefined} at
&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.20949.24&gt; exit with reason {sink\\_died,shutdown} in context
&gt;&gt;&gt;&gt;&gt;&gt; child\\_terminated
&gt;&gt;&gt;&gt;&gt;&gt; (riak@1)1&gt; 18:24:56.420 [info] monitor long\\_gc &lt;0.32603.24&gt;
&gt;&gt;&gt;&gt;&gt;&gt; [{initial\\_call,{mochiweb\\_acceptor,init,3}},{almost\\_current\\_function,{gen,do\\_call,4}},{message\\_queue\\_len,0}]
&gt;&gt;&gt;&gt;&gt;&gt; [{timeout,120},{old\\_heap\\_block\\_size,0},{heap\\_block\\_size,4181},{mbuf\\_size,0},{stack\\_size,40},{old\\_heap\\_size,0},{heap\\_size,1955}]
&gt;&gt;&gt;&gt;&gt;&gt; (riak@1)1&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; ==&gt; /mnt/dataraid/log/error.log &lt;==
&gt;&gt;&gt;&gt;&gt;&gt; 2012-03-13 18:24:44.645 [error] &lt;0.20949.24&gt; CRASH REPORT Process
&gt;&gt;&gt;&gt;&gt;&gt; &lt;0.20949.24&gt; with 0 neighbours crashed with reason: {sink\\_died,shutdown}
&gt;&gt;&gt;&gt;&gt;&gt; 2012-03-13 18:24:44.652 [error] &lt;0.175.0&gt; Supervisor
&gt;&gt;&gt;&gt;&gt;&gt; riak\\_pipe\\_builder\\_sup had child undefined started with
&gt;&gt;&gt;&gt;&gt;&gt; {riak\\_pipe\\_builder,start\\_link,undefined} at &lt;0.20949.24&gt; exit with reason
&gt;&gt;&gt;&gt;&gt;&gt; {sink\\_died,shutdown} in context child\\_terminated
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; -Matthew
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; On Tue, Mar 13, 2012 at 18:17, Matthew Tovbin wrote:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I got the same problem today on 1.1.0.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; As suggested, I updated all the nodes to 1.1.1. The error remains
&gt;&gt;&gt;&gt;&gt;&gt;&gt; the same:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; { stack: [Getter/Setter],
&gt;&gt;&gt;&gt;&gt;&gt;&gt; arguments: undefined,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; type: undefined,
&gt;&gt;&gt;&gt;&gt;&gt;&gt; message: 'HTTP error 500:
&gt;&gt;&gt;&gt;&gt;&gt;&gt; {"phase":0,"error":"[preflist\\_exhausted]","input":"{ok,{r\\_object 
&gt;&gt;&gt;&gt;&gt;&gt;&gt; ....."}}}
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; -Matthew
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Tue, Mar 13, 2012 at 06:48, Jon Meredith wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hi Arne,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Could you try with 1.1.1 please. We've fixed a number of bugs with
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; how MapReduce handles errors that could explain some of what you are 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; seeing.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Jon
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Tue, Mar 13, 2012 at 12:55 AM, Arne Claassen &lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; arne+r...@claassen.net&gt; wrote:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I'm running 1.1.0 built from source on Centos 6. I set up two
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; nodes on localhost following the instructions on the basho site for 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; testing
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; and everything was going fine until i needed to fetch all items in a 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; bucket.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; For this i was using node.js with riak-js and it's db.getAll
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; call,which from the debug logs looks like it uses /mapred
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; The bucket only has about 1200 items in it, each a json payload of
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; about 3KB. Initially, it'd keep getting inconsistent results, 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; sometimes the
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; data would come back, sometimes data would be undefined. So i kept 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; running
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; it, trying to see if there was a pattern, adding more debugging code, 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; etc.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; But still it would be about a request every couple of seconds. Then 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; it just
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; stopped working altogether and now i always get:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; { [Error: HTTP error 500:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; {"phase":0,"error":"[preflist\\_exhausted]","input":"{ok,{r\\_object,&lt;&lt;\\"tweets\\_15368536\\"&gt;&gt;,&lt;&lt;\\"178528155714330620\\"&gt;&gt;,[{r\\_content,{dict,6,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[[&lt;&lt;\\"Links\\"&gt;&gt;]],[],[],[],[],[],[],[],[[&lt;&lt;\\"content-type\\"&gt;&gt;,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110],[&lt;&lt;\\"X-Riak-VTag\\"&gt;&gt;,49,76,115,54,70,75,74,71,119,65,111,70,88,73,117,84,98,88,79,69,52,116]],[[&lt;&lt;\\"index\\"&gt;&gt;]],[],[[&lt;&lt;\\"X-Riak-Last-Modified\\"&gt;&gt;|{1331,487523,218968}]],[],[[&lt;&lt;\\"X-Riak-Meta\\"&gt;&gt;]]}}},&lt;&lt;\\"{\\"coordinates\\":null,\\"create...\\"&gt;&gt;}],...},...}","type":"forward\\_preflist","stack":"[]"}]
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; statusCode: 500 }
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; in the console. I haven't tried restarting riak, just because i'd
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; rather find out what's happening than it going away and coming back 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; later
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; when i don't expect it.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Any suggestions on how to troubleshoot this? I can still access
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; items individually and i can even list the keys via ?keys=true, it's 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; just
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; he map reduce that seems to be busted.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; cheers,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; arne
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Jon Meredith
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Platform Engineering Manager
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; jmered...@basho.com
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; Jon Meredith
&gt;&gt;&gt;&gt; Platform Engineering Manager
&gt;&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt;&gt; jmered...@basho.com
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Jon Meredith
&gt;&gt; Platform Engineering Manager
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; jmered...@basho.com
&gt;&gt;
&gt;&gt;
&gt;


-- 
Jon Meredith
Platform Engineering Manager
Basho Technologies, Inc.
jmered...@basho.com
