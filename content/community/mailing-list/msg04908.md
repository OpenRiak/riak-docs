---
title: "Re: What is the best way to model relationships in Riak from 1.0	forward?"
description: ""
project: community
lastmod: 2011-09-28T11:39:31-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04908"
mailinglist_parent_id: "msg04905"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-09-28T11:39:31-07:00
---


If you want to perform some kind of ad hoc querying, your only real option is 
Map Reduce. Fun fact: you can perform Riak Search queries through Map Reduce.

You can also do this with HTPP requests for Riak Search or indexes (either HTTP 
or Protocol Buffers), but you'll probably end up doing something that looks 
like this:

Query objects from Riak Search
Collect relationship IDs from Riak Search results
Query objects from Riak or Riak Search by ID
Repeat

Depending on your application patterns, it's possible to save the complete 
object graph in Riak. Riak is ill-suited to ad hoc querying patterns like you 
can perform on an RDBMS.

A good pattern for this comes from orders. In an RDBMS you might have tables to 
define OrderHeaders, LineItems, Customers, and Addresses. With riak you could 
easily save this as an object graph that looks like this:

{ order\\_header: { blah blah blah },
 line\\_items: [],
 customer: { blah blah blah },
 shipping\\_address: { blah blah blah },
 billing\\_address: { blah blah blah }
}

Data modeling in Riak typically requires that you flatten your data model when 
you save it: optimize for reads, not writes. 

If you have a predictable key name format, you can use key filters to perform 
an in-memory query on key names before performing your MR queries on the 
results of the key filter. 

Without knowing more about what you're actually trying to accomplish, it's not 
possible to provide you with an accurate and detailed answer; I can only give 
you generalities and hand waving. It may be that you aren't able to give that 
info out on a mailing list, and I completely understand that.

---
Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
Microsoft SQL Server MVP

On Sep 28, 2011, at 2:29 PM, Harshal Dhir wrote:

&gt; 
&gt; Hi Jeremiah,
&gt; 
&gt; Thanks for your quick response. But, we also want to do a query on the
&gt; bucket, so yes implementing links if you want to pull one object makes
&gt; sense, but if you want to do query. Only way to do this to use MapReduce.
&gt; 
&gt; Please correct me if I am wrong.
&gt; 
&gt; 
&gt; Harshal Dhir | Technical Architect
&gt; 
&gt; solutionset
&gt; 
&gt; P: 510-214-3519 Twitter: @harshaldhir
&gt; 
&gt; 85 Second Street, San Francisco, CA 94105
&gt; 
&gt; Twitter: @harshaldhir MSN: hars...@solutionset.com Jabber:
&gt; harshal.d...@gmail.com
&gt; www.solutionset.com 
&gt; 
&gt; This message is intended for the addressee(s) only and may contain
&gt; confidential or privileged
&gt; information. Any use of this information by persons other than
&gt; addressee(s) is prohibited. If you
&gt; have received this message in error, please reply to the sender and delete
&gt; or destroy all copies.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On 9/28/11 11:17 AM, "Jeremiah Peschka"  wrote:
&gt; 
&gt;&gt; You can link walk without MapReduce - the RpbContent object returned by
&gt;&gt; the ProtocolBuffers API should include the immediate level of links.
&gt;&gt; Otherwise, many clients support using HTTP requests to perform link walks
&gt;&gt; of arbitrary depths.
&gt;&gt; 
&gt;&gt; The bigger question is: what are you trying to accomplish?
&gt;&gt; 
&gt;&gt; ---
&gt;&gt; Jeremiah Peschka - Founder, Brent Ozar PLF, LLC
&gt;&gt; Microsoft SQL Server MVP
&gt;&gt; 
&gt;&gt; On Sep 28, 2011, at 2:08 PM, Harshal Dhir wrote:
&gt;&gt; 
&gt;&gt;&gt; Hi folks,
&gt;&gt;&gt; 
&gt;&gt;&gt; We were just wondering what is the best possible way to model 1 Â­ N
&gt;&gt;&gt; relationships in Riak. We know that there are links but the mapreduce is
&gt;&gt;&gt; too slow. So, we moved towards using RiakSearch but it seems that
&gt;&gt;&gt; modeling relationships and having lists in riak search KV object doesn't
&gt;&gt;&gt; quiet do the job.
&gt;&gt;&gt; 
&gt;&gt;&gt; So, we were looking for some guidance on this front.
&gt;&gt;&gt; 
&gt;&gt;&gt; Thanks
&gt;&gt;&gt; Harshal
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 
