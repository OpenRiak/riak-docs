---
title: "Re: Riak crashed and crashed again when recovering"
description: ""
project: community
lastmod: 2010-05-05T05:05:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00257"
mailinglist_parent_id: "msg00256"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-05-05T05:05:45-07:00
---


Germain,

It looks like you're filling up the dets tables -- which have a 2GB limit per 
file, although Riak uses multiple files, one per vnode. Have you tried the 
innostore backend? Also if you continue to use dets, try increasing the number 
of partitions, which will make more, smaller files.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On May 5, 2010, at 7:55 AM, Germain Maurice wrote:

&gt; I got other informations when I launched "riak console" on the both nodes, as 
&gt; you can see here.
&gt; I hope this will be useful for you and then for me :)
&gt; 
&gt; 10.0.0.40:$ riak console
&gt; [...]
&gt; =INFO REPORT==== 5-May-2010::13:04:48 ===
&gt; Starting handoff of partition 
&gt; 479555224749202520035584085735030365824602865664 to 'r...@10.0.0.41'
&gt; dets: file 
&gt; "/reiser/riak/dets/639406966332270026714112114313373821099470487552" not 
&gt; properly closed, repairing ...
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:05:48 ===
&gt; Dropping partition 479555224749202520035584085735030365824602865664
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:08:47 ===
&gt; alarm\\_handler: {set,{system\\_memory\\_high\\_watermark,[]}}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; "dets:open\\_file failed"
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:19:32 ===
&gt; \\*\\* Generic server riak\\_kv\\_vnode\\_master terminating
&gt; \\*\\* Last message in was {'$gen\\_cast',
&gt; {start\\_vnode,
&gt; 
&gt; 639406966332270026714112114313373821099470487552}}
&gt; \\*\\* When Server state == {state,12307,[]}
&gt; \\*\\* Reason for termination ==
&gt; \\*\\* {{badmatch,
&gt; {error,
&gt; {{badmatch,
&gt; {error,
&gt; {no\\_more\\_space\\_on\\_file,
&gt; 
&gt; "/reiser/riak/dets/639406966332270026714112114313373821099470487552.TMP"}}},
&gt; [{riak\\_kv\\_vnode,init,1},
&gt; {gen\\_fsm,init\\_it,6},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]}}},
&gt; [{riak\\_kv\\_vnode\\_master,get\\_vnode,2},
&gt; {riak\\_kv\\_vnode\\_master,handle\\_cast,2},
&gt; {gen\\_server,handle\\_msg,5},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.117.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.115.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.119.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.112.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; Spidermonkey VM host stopping (&lt;0.114.0&gt;)
&gt; Erlang has closed
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:19:32 ===
&gt; alarm\\_handler: {clear,system\\_memory\\_high\\_watermark}
&gt; /usr/lib/riak/lib/os\\_mon-2.2.5/priv/bin/memsup: Erlang has closed.
&gt; 
&gt; 
&gt; 
&gt; ==========================================================
&gt; 
&gt; 10.0.0.41:$ riak console
&gt; [...]
&gt; =INFO REPORT==== 5-May-2010::13:03:41 ===
&gt; Spidermonkey VM host starting (&lt;0.120.0&gt;)
&gt; Eshell V5.7.5 (abort with ^G)
&gt; (r...@10.0.0.41)1&gt; dets: file 
&gt; "/reiser/riak/dets/616571003248974668617179538802181898917346541568" not 
&gt; properly closed, repairing ...
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:04:48 ===
&gt; Receiving handoff data for partition 
&gt; 479555224749202520035584085735030365824602865664
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:05:48 ===
&gt; \\*\\* Generic server &lt;0.189.0&gt; terminating
&gt; \\*\\* Last message in was {tcp,#Port&lt;0.2936&gt;,
&gt; [0|&lt;&lt;84,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0&gt;&gt;]}
&gt; \\*\\* When Server state == {state,#Port&lt;0.2936&gt;,undefined,undefined,0}
&gt; \\*\\* Reason for termination ==
&gt; \\*\\* {timeout,{gen\\_server2,call,
&gt; [riak\\_kv\\_vnode\\_master,
&gt; 
&gt; {get\\_vnode,479555224749202520035584085735030365824602865664},
&gt; 60000]}}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:06:41 ===
&gt; alarm\\_handler: {set,{system\\_memory\\_high\\_watermark,[]}}
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:07:41 ===
&gt; webmachine error: 
&gt; path="/riak/blog\\_content\\_temp/1714432724f7f975610be47146fec6c7e74bf4bbccdbeea5208ac6e3540e6f4b"
&gt; [{webmachine\\_decision\\_core,'-decision/1-lc$^1/1-1-',
&gt; [{error,
&gt; {error,
&gt; {case\\_clause,{error,timeout}},
&gt; [{riak\\_kv\\_wm\\_raw,content\\_types\\_provided,2},
&gt; {webmachine\\_resource,resource\\_call,3},
&gt; {webmachine\\_resource,do,3},
&gt; {webmachine\\_decision\\_core,resource\\_call,1},
&gt; {webmachine\\_decision\\_core,decision,1},
&gt; {webmachine\\_decision\\_core,handle\\_request,2},
&gt; {webmachine\\_mochiweb,loop,1},
&gt; {mochiweb\\_http,headers,5}]}}]},
&gt; {webmachine\\_decision\\_core,decision,1},
&gt; {webmachine\\_decision\\_core,handle\\_request,2},
&gt; {webmachine\\_mochiweb,loop,1},
&gt; {mochiweb\\_http,headers,5},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; "dets:open\\_file failed"
&gt; 
&gt; =ERROR REPORT==== 5-May-2010::13:16:54 ===
&gt; \\*\\* Generic server riak\\_kv\\_vnode\\_master terminating
&gt; \\*\\* Last message in was {'$gen\\_cast',
&gt; {start\\_vnode,
&gt; 
&gt; 616571003248974668617179538802181898917346541568}}
&gt; \\*\\* When Server state == {state,12307,[]}
&gt; \\*\\* Reason for termination ==
&gt; \\*\\* {{badmatch,
&gt; {error,
&gt; {{badmatch,
&gt; {error,
&gt; {no\\_more\\_space\\_on\\_file,
&gt; 
&gt; "/reiser/riak/dets/616571003248974668617179538802181898917346541568.TMP"}}},
&gt; [{riak\\_kv\\_vnode,init,1},
&gt; {gen\\_fsm,init\\_it,6},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]}}},
&gt; [{riak\\_kv\\_vnode\\_master,get\\_vnode,2},
&gt; {riak\\_kv\\_vnode\\_master,handle\\_cast,2},
&gt; {gen\\_server,handle\\_msg,5},
&gt; {proc\\_lib,init\\_p\\_do\\_apply,3}]}
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.113.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.115.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.114.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.117.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.119.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.118.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.116.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; Spidermonkey VM host stopping (&lt;0.120.0&gt;)
&gt; 
&gt; =INFO REPORT==== 5-May-2010::13:16:54 ===
&gt; alarm\\_handler: {clear,system\\_memory\\_high\\_watermark}
&gt; /usr/lib/riak/lib/os\\_mon-2.2.5/priv/bin/memsup: Erlang has closed.
&gt; Erlang has 
&gt; closed
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Le 05/05/10 11:35, Germain Maurice a écrit :
&gt;&gt; Hi all,
&gt;&gt; I am testing Riak for my document base and i got a problem when i was 
&gt;&gt; migrating documents from my previous
&gt;&gt; system to Riak.
&gt;&gt; I have two nodes and one bucket for the beginning.
&gt;&gt; There are more than 480 000 documents in the bucket and the documents are 
&gt;&gt; html pages.
&gt;&gt; 
&gt;&gt; In the following you'll find all the files and informations after a node was 
&gt;&gt; restarted.
&gt;&gt; After a while, riak crashed again for the two nodes I restarted ... :(
&gt;&gt; 
&gt;&gt; [...]
&gt; 
&gt; 
&gt; -- 
&gt; Germain Maurice
&gt; Administrateur Système/Réseau
&gt; Tel : +33.(0)1.42.43.54.33
&gt; 
&gt; http://www.linkfluence.net
&gt; 
&gt; 
