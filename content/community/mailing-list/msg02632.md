---
title: "Re: Putting Specific Bucket/Key Combination Gives Timeout"
description: ""
project: community
lastmod: 2011-03-14T05:53:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02632"
mailinglist_parent_id: "msg02631"
author_name: "Russell Brown"
project_section: "mailinglistitem"
sent_date: 2011-03-14T05:53:24-07:00
---


Another approach is to generate a "random" bucket name at the start of your 
test and use that throughout the test , you can still delete the contents at 
the end of the test but the race condition isn't a problem for the next run 
(unless your random bucket name isn't very random). I use an UUID in the Java 
client integration tests.
On 14 Mar 2011, at 12:45, Sean Cribbs wrote:

&gt; We are aware of some race-conditions caused by repeatedly accessing a key 
&gt; around DELETE requests. Here's one bug:
&gt; 
&gt; https://issues.basho.com/show\\_bug.cgi?id=555
&gt; 
&gt; If you need to clear the data after a test run, I would suggest using the 
&gt; 'riak\\_kv\\_test\\_backend' from the Ripple project, or simply shut down Riak and 
&gt; delete the contents of the bitcask directory.
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On Mar 14, 2011, at 8:27 AM, Runar Jordahl wrote:
&gt; 
&gt;&gt; I am running unit tests against my single-node Riak database installed
&gt;&gt; on Ubuntu 10.10 64 bit. The tests write a few objects (key/value) to
&gt;&gt; the database, and then end by deleting all keys in the test bucket.
&gt;&gt; The test bucket is named “epigenttest”, the key I use is “test”.
&gt;&gt; 
&gt;&gt; Today the database entered a state where my default bucket/key used
&gt;&gt; for tests failed: If I tried doing a PUT using the following URL, I
&gt;&gt; got a timeout:
&gt;&gt; http://riaktest:8098/riak/epigenttest/test
&gt;&gt; 
&gt;&gt; However, if I modified the bucket or the key, the operation worked.
&gt;&gt; 
&gt;&gt; I could always reproduce the problem using bucket/key
&gt;&gt; epigenttest/test. I suspect that the database had corrupt data, which
&gt;&gt; prevented me from putting epigenttest/test.
&gt;&gt; 
&gt;&gt; Before running the unit test, Riak reported that the database was empty:
&gt;&gt; http://riaktest:8098/riak?buckets=true
&gt;&gt; {"buckets":[]}
&gt;&gt; 
&gt;&gt; I managed to get out of the problem by running “riak reboot”. I cannot
&gt;&gt; reproduce the problem again.
&gt;&gt; 
&gt;&gt; Could there be a bug in Riak when adding/deleting/putting the same
&gt;&gt; key? Below I include the result of running Riak Stats.
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Kind regards
&gt;&gt; Runar Jordahl
&gt;&gt; 
&gt;&gt; 
&gt;&gt; 
&gt;&gt; http://riaktest:8098/stats
&gt;&gt; {
&gt;&gt; "vnode\\_gets": 3,
&gt;&gt; "vnode\\_puts": 0,
&gt;&gt; "read\\_repairs": 0,
&gt;&gt; "vnode\\_gets\\_total": 1277,
&gt;&gt; "vnode\\_puts\\_total": 511,
&gt;&gt; "node\\_gets": 1,
&gt;&gt; "node\\_gets\\_total": 427,
&gt;&gt; "node\\_get\\_fsm\\_time\\_mean": 25691.0,
&gt;&gt; "node\\_get\\_fsm\\_time\\_median": 25691,
&gt;&gt; "node\\_get\\_fsm\\_time\\_95": 25691,
&gt;&gt; "node\\_get\\_fsm\\_time\\_99": 25691,
&gt;&gt; "node\\_get\\_fsm\\_time\\_100": 25691,
&gt;&gt; "node\\_puts": 1,
&gt;&gt; "node\\_puts\\_total": 201,
&gt;&gt; "node\\_put\\_fsm\\_time\\_mean": 60000872.0,
&gt;&gt; "node\\_put\\_fsm\\_time\\_median": 60000872,
&gt;&gt; "node\\_put\\_fsm\\_time\\_95": 60000872,
&gt;&gt; "node\\_put\\_fsm\\_time\\_99": 60000872,
&gt;&gt; "node\\_put\\_fsm\\_time\\_100": 60000872,
&gt;&gt; "read\\_repairs\\_total": 5,
&gt;&gt; "cpu\\_nprocs": 292,
&gt;&gt; "cpu\\_avg1": 56,
&gt;&gt; "cpu\\_avg5": 61,
&gt;&gt; "cpu\\_avg15": 64,
&gt;&gt; "mem\\_total": 1050324992,
&gt;&gt; "mem\\_allocated": 521408512,
&gt;&gt; "nodename": "riak@127.0.0.1",
&gt;&gt; "connected\\_nodes": [
&gt;&gt; 
&gt;&gt; ],
&gt;&gt; "sys\\_driver\\_version": "1.5",
&gt;&gt; "sys\\_global\\_heaps\\_size": 0,
&gt;&gt; "sys\\_heap\\_type": "private",
&gt;&gt; "sys\\_logical\\_processors": 1,
&gt;&gt; "sys\\_otp\\_release": "R13B04",
&gt;&gt; "sys\\_process\\_count": 212,
&gt;&gt; "sys\\_smp\\_support": false,
&gt;&gt; "sys\\_system\\_version": "Erlang R13B04 (erts-5.7.5) [source] [rq:1]
&gt;&gt; [async-threads:64] [kernel-poll:true]",
&gt;&gt; "sys\\_system\\_architecture": "i486-pc-linux-gnu",
&gt;&gt; "sys\\_threads\\_enabled": true,
&gt;&gt; "sys\\_thread\\_pool\\_size": 64,
&gt;&gt; "sys\\_wordsize": 4,
&gt;&gt; "ring\\_members": [
&gt;&gt; "riak@127.0.0.1"
&gt;&gt; ],
&gt;&gt; "ring\\_num\\_partitions": 64,
&gt;&gt; "ring\\_ownership": "[{'riak@127.0.0.1',64}]",
&gt;&gt; "ring\\_creation\\_size": 64,
&gt;&gt; "storage\\_backend": "riak\\_kv\\_bitcask\\_backend",
&gt;&gt; "pbc\\_connects\\_total": 0,
&gt;&gt; "pbc\\_connects": 0,
&gt;&gt; "pbc\\_active": 0,
&gt;&gt; "cluster\\_info\\_version": "1.0.0",
&gt;&gt; "luwak\\_version": "1.0.0",
&gt;&gt; "skerl\\_version": "1.0.0",
&gt;&gt; "riak\\_kv\\_version": "0.14.0",
&gt;&gt; "riak\\_core\\_version": "0.14.0",
&gt;&gt; "bitcask\\_version": "1.1.5",
&gt;&gt; "luke\\_version": "0.2.3",
&gt;&gt; "webmachine\\_version": "1.8.0",
&gt;&gt; "mochiweb\\_version": "1.7.1",
&gt;&gt; "erlang\\_js\\_version": "0.5.0",
&gt;&gt; "runtime\\_tools\\_version": "1.8.3",
&gt;&gt; "crypto\\_version": "1.6.4",
&gt;&gt; "os\\_mon\\_version": "2.2.5",
&gt;&gt; "riak\\_err\\_version": "1.0.0",
&gt;&gt; "sasl\\_version": "2.1.9",
&gt;&gt; "stdlib\\_version": "1.16.5",
&gt;&gt; "kernel\\_version": "2.13.5",
&gt;&gt; "executing\\_mappers": 0
&gt;&gt; }
&gt;&gt; 
&gt; 
&gt; 

