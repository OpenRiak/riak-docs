---
title: "Re: if_not_modified"
description: ""
project: community
lastmod: 2012-11-06T19:34:52-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09217"
mailinglist_parent_id: "msg09206"
author_name: "Reid Draper"
project_section: "mailinglistitem"
sent_date: 2012-11-06T19:34:52-08:00
---


Elias,

There's quite a few questions in here, but hopefully I'll answer the meat of 
what you're
trying to find out. Using `if\\_not\\_modified` is \\_not\\_ equivalent to a 
distributed atomic
compare-and-swap (CAS). As you've correctly identified, concurrent writers
on different coordinators can all succeed in writing different values, while
still meeting the prerequisite for `if\\_not\\_modified`.

Reid

On Nov 6, 2012, at 2:06 PM, Elias Levy  wrote:

&gt; The description of if\\_not\\_modified is lacking in the documentation. What 
&gt; guarantees if\\_not\\_modified provides is a question that has been asked in the 
&gt; list a few times, but for which no satisfactory answer has been given. Its 
&gt; something I've been wanted answered as well, so I did a bit of digging into 
&gt; the code.
&gt; 
&gt; I gather from reading the code that whatever node receives the INM request 
&gt; perform an internal get to retrieve the object to get its vclock to compare 
&gt; to the incoming object. The get appears to use the R value that is the 
&gt; default for the bucket. The default value of R for a bucket is "quorum", 
&gt; unless changed, although the default for PR is 0. Thus, INM can strongly 
&gt; guarantee no stale writes, but only if no primary replica nodes have failed 
&gt; or have become partitioned. That also assumes that you are using at least an 
&gt; W of "quorum", and ideally a PR of the same.
&gt; 
&gt; Correct me if I am wrong, but there appears no way to set the R and PR values 
&gt; to be used by the internal get during a INM put request, except for changing 
&gt; the bucket default R and PR values.
&gt; 
&gt; The INM only guarantees no stale writes, and only does so when R, PR, W, and 
&gt; WR are such to to guarantee strong consistency. It does not guard against 
&gt; concurrent writes. Multiple writers can succeed even when using INM if they 
&gt; write at the same time.
&gt; 
&gt; If you have allow\\_mult set to true in the bucket, that means the client must 
&gt; handle sibling resolution. If allow\\_mult is set to false and last\\_write\\_wins 
&gt; is set to true, concurrent writes will succeed, but the value with the latest 
&gt; timestamp will win. If last\\_write\\_wins is set to false while allow\\_multi is 
&gt; also false, Riak will keep siblings internally, but use vector clocks to only 
&gt; return a single value. 
&gt; 
&gt; Its unclear from the documentation what it does in the case of conflicts to 
&gt; resolve the siblings into the single value. The docs say you'll receive the 
&gt; "latest" value, but does not say how latest is determined in the case of a 
&gt; conflict.
&gt; 
&gt; Elias Levy
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

