---
title: "filter by secondary index, sort and limit - best practice?"
description: ""
project: community
lastmod: 2012-05-10T09:03:02-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07420"
author_name: "Alexey Loshkarev"
project_section: "mailinglistitem"
sent_date: 2012-05-10T09:03:02-07:00
---


I have bucket with nginx access logs (parsed to json).
Each document has it secondary index (date)

I want to retrieve last record for some hour (python):

riak.mapreduce.RiakMapReduce(client).index('logs.api', 'date\\_bin',
'2012051017', '2012051018').map("""function(doc) { return [[doc.key,
JSON.parse(doc.values[0].data)]]; }""").reduce\\_limit(100).run()

It takes about 8 seconds to complete.

Than I want to sort results before returning (as I see, results at
map() are not sorted).

riak.mapreduce.RiakMapReduce(client).index('logs.api', 'date\\_bin',
'2012051017', '2012051018').map("""function(doc) { return [[doc.key,
JSON.parse(doc.values[0].data)]];
}""").reduce('Riak.reduceSort').reduce\\_limit(100).run()

This query hangs forever (i have tired to wait to finish).

But this index filter leaves about 5000 records. Why it is so slow?
What I missed?

-- 
----------------
Best regards
Alexey Loshkarev
mailto:elf2...@gmail.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

