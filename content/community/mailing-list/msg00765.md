---
title: "Re: Expected vs Actual Bucket Behavior"
description: ""
project: community
lastmod: 2010-07-21T07:17:50-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00765"
mailinglist_parent_id: "msg00764"
author_name: "John D. Rowell"
project_section: "mailinglistitem"
sent_date: 2010-07-21T07:17:50-07:00
---


Justin, I think we could address both 1) and 2) in another way. The "real
world" need seems to be restricting the scope of costly operations like
walking a huge list of keys. Either having distinct buckets or reliable
lists of keys could solve the problem.

But simply looking up the (Dynamo) heritage for Riak shows that this is a
solved problem in other platforms. For instance Amazon's S3 service does
actual separation of keys per bucket (which is what improving Bitcask in the
way you described will achieve) but also has a more subtle, and
complementary solution: prefixes. When you search inside a bucket you can
specify a key prefix that will serve as a filter.

While I have no idea if their internal implementation of prefixes is
efficient, I see no reason why we can't have the same functionality in Riak
and guarantee it is efficient even in distributed cases. If keys are limited
to some manageable length (say 255 char strings) they could be indexed into
a distributed (only eventually consistent of course) ordered list or btree
that could be efficiently queried for ranges. Then to the application writer
it's just a matter of providing sane keys that will allows for scoping
searchs in several ways (e.g. per year, per year+month, per lot, etc.)

The suggestion above would not solve all indexing needs but would surely
allow for the current ones to be refactored into cases that would be
efficiently solvable.

-jd

2010/7/21 Justin Sheehy 

&gt; I think that we are all (myself included) getting two different issues
&gt; a bit mixed up in this discussion:
&gt;
&gt; 1: storing an implicit index of keys in the Riak key/value store
&gt;
&gt; 2: making buckets separate in that a per-bucket operation's
&gt; performance would not be affected by the content of other buckets
&gt;
&gt; The thread started out with a request for #2, but included a
&gt; suggestion to do #1. These are actually two different topics.
&gt;
&gt; The first issue, implicitly storing a big index of keys, is
&gt; impractical in a distributed key/value storage system that has Riak's
&gt; availability goals. We are very unlikely to implement this as
&gt; described in the near future. However, we very much recognize that
&gt; there are many different ways that people would like to find their
&gt; data. In that light, we are working on multiple different efforts
&gt; that will use the Riak core to provide data storage with more than
&gt; just "simple" key/value access.
&gt;
&gt; The second issue, of isolating buckets, is a much simpler design
&gt; choice and is also a per-backend implementation detail. We can create
&gt; and provide an alternative bitcask adapter that does this. It will be
&gt; a real tradeoff: in exchange for buckets not impacting each other as
&gt; much, the system will consume more filehandles, be a bit less
&gt; efficient at rebalancing, and will generally make buckets no longer
&gt; "free". This is a reasonable tradeoff in either direction for various
&gt; applications, and I support making it available as a choice. I have
&gt; created a bugzilla entry to track it:
&gt; https://issues.basho.com/show\\_bug.cgi?id=480
&gt;
&gt; I hope that this helps to clarify the issue.
&gt;
&gt; -Justin
&gt;

