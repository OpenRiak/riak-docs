---
title: "Re: riak-users Digest, Vol 42, Issue 11"
description: ""
project: community
lastmod: 2013-01-09T16:34:43-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09777"
author_name: "Julio Cesar RÃ­os Gutierrez"
project_section: "mailinglistitem"
sent_date: 2013-01-09T16:34:43-08:00
---


I have some trouble with processing "post"


 1. -module(rptPedidos\\_resource).
 2. -export([init/1, allowed\\_methods/2, process\\_post/2]).
 3. -export([content\\_types\\_provided/2,to\\_pdf/2]).
 4.
 5. -record ( context, {root, name\\_file } ).
 6.
 7. -include\\_lib("webmachine/include/webmachine.hrl").
 8.
 9. %%init([]) -&gt; {ok, undefined}.
 10. init(Config)-&gt;
 11. %%{{trace, "/tmp"}, Config}.
 12. %%{{trace,"/tmp"},
 #context{root=proplists:get\\_value(root,Config),name\\_file=""}}.
 13. {ok, #context{root=proplists:get\\_value(root,Config),name\\_file
 =""}}.
 14.
 15.
 16. allowed\\_methods ( RD, Ctx )-&gt; {['POST','GET','HEAD'], RD, Ctx}.
 17.
 18. content\\_types\\_provided ( RD, Ctx )-&gt; {[{"application/pdf",to\\_pdf}],
 RD, Ctx }.
 19.
 20. to\\_pdf ( RD, #context { root = Root, name\\_file = Name\\_File } = Ctx )
 -&gt;
 Ruta = string:concat("/root/sicap-rpt/reports/", Name\\_File),
 Ruta1 = string:concat ( Ruta, ".pdf" ),
 21.
 22. %%{ok, Body} =
 file:read\\_file("/root/sicap-rpt/reports/"++Name\\_File++".pdf" ),
 23. %%{ok, Body} = file:read\\_file
 ("/root/sicap-rpt/reports/tttt.pdf"),
 24.
 25. {ok, Body} = file:read\\_file ( Ruta1 ),
 26.
 27. {Body, RD, Ctx}.

 28. process\\_post ( RD, Ctx )-&gt;
 Data = mochiweb\\_util:parse\\_qs ( wrq:req\\_body ( RD ) ),
 29. Struct = mochijson2:decode ( proplists:get\\_value("json", Data
 ) ),
 30. Struct2 = proplists:get\\_value ( "json", Data ),
 31. {struct, [{ &lt;&lt;"nombre"&gt;&gt;, Nombre }]} = Struct,
 32.
 33. RD1 = wrq:set\\_resp\\_header ( "Content-Disposition",
 "application/pdf", RD ),
 print\\_pdf:print(binary\\_to\\_list(Nombre)),
 34.
 35. Ctx2 = Ctx#context{name\\_file = binary\\_to\\_list(Nombre)},
 36. %%{true, RD1, Ctx#context{name\\_file=Nombre}}.
 37. {true, RD1, Ctx2}.
