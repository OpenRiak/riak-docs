---
title: "Re: rik loading taking huge time?any suggestion for betterment"
description: ""
project: community
lastmod: 2012-08-28T10:56:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08384"
mailinglist_parent_id: "msg08372"
author_name: "Mike Oxford"
project_section: "mailinglistitem"
sent_date: 2012-08-28T10:56:47-07:00
---


Use the https://github.com/basho/riak-erlang-client directly, instead of
calling os:cmd and pushing through CURL.
You can also parallelize it at that time, because right now you're doing
25million os:cmd calls and making 25million curl calls. Open up a pool of
connections (or even just N and round-robin them) and keep them open.

A 2-node cluster will have 1/3 of the set on one machine, and 2/3 on the
other. You may consider moving to N=2 on the bucket, which will put one
copy on each machine (eg, dual-master.)

Beyond that, you have not provided enough information as to where the
bottleneck may be, though I'm sure the Basho crew will have some better
better answers. :)

-mox


On Mon, Aug 27, 2012 at 8:26 PM, wrote:

&gt; Dear team,
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; I am trying to load 25 million dataset (1.3 Gb) of sample call data onto
&gt; riak..its a 4-quad core ---1.5 TB storage 2-node raik cluster…takes
&gt; real 5671m12.812s.please suggest the solutions for the betterment of
&gt; the same…5671m12.812s is quite huge…we deal with bigdata and I need to
&gt; store and test 165 GB on the riak..if so I may take years for loading I
&gt; guess with the present scenario…loaded 165 GB on to mongodb and got the
&gt; results..for \\*comparative performance study of mongodb and riak db\\* …please 
&gt; do assist me with the same .
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; \\*using the following code for loading :\\*
&gt;
&gt;
&gt;
&gt; #!/usr/local/bin/escript
&gt;
&gt; main([Filename]) -&gt;
&gt;
&gt; {ok, Data} = file:read\\_file(Filename),
&gt;
&gt; Lines = tl(re:split(Data, "\\r?\\n", [{return, binary},trim])),
&gt;
&gt; lists:foreach(fun(L) -&gt; LS = re:split(L, ","), format\\_and\\_insert(LS)
&gt; end, Lines).
&gt;
&gt;
&gt;
&gt; format\\_and\\_insert(Line) -&gt;
&gt;
&gt; JSON =
&gt; io\\_lib:format("{\\"id\\":\\"~s\\",\\"phonenumber\\":~s,\\"callednumber\\":~s,\\"starttime\\":~s,\\"endtime\\":~s,\\"status\\":~s}",
&gt; Line),
&gt;
&gt; Command = io\\_lib:format("curl -X PUT
&gt; http://10.232.5.169:8098/riak/CustCalls25m/~s -d '~s' -H 'content-type:
&gt; application/json'", [hd(Line),JSON]),
&gt;
&gt; io:format("Inserting: ~s~n", [hd(Line)]),
&gt;
&gt; os:cmd(Command).
&gt;
&gt;
&gt;
&gt; \\*[hadoop@CTSINGMRGTO data]$ time ./load\\_data25m CustCalls25m.csv &gt;&gt;
&gt; 25m.txt &\\*
&gt;
&gt; [3] 32354
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; [hadoop@CTSINGMRGTO data]$
&gt;
&gt; \\*real 5671m12.812s\\*
&gt;
&gt; user 1725m31.862s
&gt;
&gt; sys 3074m42.135s
&gt;
&gt; [hadoop@CTSINGMRGTO data]$
&gt;
&gt;
&gt;
&gt; [hadoop@CTSINGMRGTO data]$ tail -4 25m.txt
&gt;
&gt; Inserting: 24999997
&gt;
&gt; Inserting: 24999998
&gt;
&gt; Inserting: 24999999
&gt;
&gt; \\*Inserting: 25000000\\*
&gt;
&gt; [hadoop@CTSINGMRGTO data]$
&gt;
&gt;
&gt; This e-mail and any files transmitted with it are for the sole use of the
&gt; intended recipient(s) and may contain confidential and privileged
&gt; information. If you are not the intended recipient(s), please reply to the
&gt; sender and destroy all copies of the original message. Any unauthorized
&gt; review, use, disclosure, dissemination, forwarding, printing or copying of
&gt; this email, and/or any action taken in reliance on the contents of this
&gt; e-mail is strictly prohibited and may be unlawful.
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

