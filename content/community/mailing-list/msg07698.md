---
title: "Re: riak_core nodes on Heroku?"
description: ""
project: community
lastmod: 2012-06-17T04:47:14-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07698"
mailinglist_parent_id: "msg07689"
author_name: "Ciprian Dorin Craciun"
project_section: "mailinglistitem"
sent_date: 2012-06-17T04:47:14-07:00
---


On Thu, Jun 14, 2012 at 4:37 PM, Samuel Elliott  wrote:
&gt; It's actually very much not possible.
&gt;
&gt; Erlang nodes need to listen on one port for the EPMD, and then another
&gt; for HTTP (and maybe more for other coordination). Heroku only lets you
&gt; listen on a single node per process, and you can't guarantee scaled
&gt; processes occur on the same dyno or even machine to another, so you
&gt; can't explicitly run epmd separately.

 Although not strictly related to Heroku's dyno's (for which I
don't have too much "in-depth" knowledge), in a project I'm currently
working, that provides a similar environment with Heroku, a major
problem in running distributed Erlang nodes (epecially Riak), is the
EPMD process. (From my point of view this is quite a serious
limitation for Erlang and the OTP...)

 The problem is as follows (I make one assertion presented below,
but which I'm certain is FALSE, thus this paragraph is solely for
"theoretical" purposes):
 \\* all the Erlang nodes in a distributed application must use the
same EPMD port (as specified by using `ERL\\_EPMD\\_PORT`);
 \\* now if Heroku provides you with an unique IP per dyno then this
is no problem, as each Erlang node dyno could run his own `epmd`
process;
 \\* if Heroku doesn't provide an uinque IP per dyno then "game
over"; (although it could seem it works, but if two dynos of your own
run on the same machine, then when one dies, the other remains
"invisible" from further discoveries;)

 The assertion I've made is that Heroku doesn't firewall
communication on private IP's between arbitrary dyno's. WHICH I DON'T
THINK IS THE CASE, as I would be an important security issue...


&gt; Yes, distribution via other means seems sensible.

 As Sam said, you could however solve these issues by:
 \\* providing your own implementation of an `erl\\_epmd` solver;
 \\* and your own implementation of an `inet\\_tcp\\_dist`;
 \\* both using as communication an HTTP module (like `mochiweb` or
`misultin`) multiplexing between the two;

 But this road is very hard... If interested you could read one of
my posts to the Erlang list exactly about this topic, but which
remained unanswered...
 http://erlang.org/pipermail/erlang-questions/2011-October/062004.html

 (One ideea: use ZeroMQ for communication, but again all this goes
if the previous assertion is true.)

 (Another one: use RabbitMQ, to provide transport for such modules.
You could use direct exchanges for `inet\\_amqp\\_dist` and you wouldn't
need anymore the `erl\\_epmd` resolver.)


&gt; As for the routing mesh issues, they seem to have support for
&gt; websockets etc in the proxy, so presumably it is possible somehow to
&gt; route TCP messages through.

 I have the feeling that Heroku (on their Cedar) stack use the
`mochiweb` Erlang web-server to provide the routing... As such you
could try to find "undocumented" ways to fool mochiweb into routing
requests to the respective dyno.

 Hope this helps,
 Ciprian.

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

