---
title: "riak-erlang-client issue with Riak EE 1.2"
description: ""
project: community
lastmod: 2012-08-16T15:51:42-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08307"
author_name: "Julian"
project_section: "mailinglistitem"
sent_date: 2012-08-16T15:51:42-07:00
---


Hi,

Recently, we upgraded our Riak cluster to 1.2. I hear that one of our
buckets has been wiped and reloaded, but our index (Riak search is enabled)
may not be in a consistent state. This has led to an error in code using
riak-erlang-client 1.2, shown below.

One of the intriguing things I find is that the exception is listed as
occuring in one of my own processes that is doing json decoding, however I
have checked the json by saving it to a file and it does not contain the
data shown inside the 'struct' in the exception. The only explanation I can
come up with is that the badmatch is occurring within riakc\\_pb socket and
was triggered by my call to riakc\\_pb\\_socket:search/6, and the process link
is somehow influencing the crash report.

1. Is there a newer version of riak-erlang-client that might fix the issue?
I noticed that though labeled v1.2, it came out in April; has there been a
client code update for EE 1.2?
2. Would it help make my code more robust if I tried to filter out these
not\\_found's so it wouldn't reach the client? As in \\*
http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2012-January/007075.html
\\*


(module names edited slightly)

=CRASH REPORT==== 16-Aug-2012::21:44:52 ===
 crasher:
 initial call: xx\\_acl\\_query:init/1
 pid: &lt;0.159.0&gt;
 registered\\_name: []
 exception exit: {{badmatch,
 {not\\_found,

{&lt;&lt;"a65796222ea26bb7b355bf140dbd5b72e81efee1"&gt;&gt;,
 &lt;&lt;"000018e5-accf-fff1-8123-1efee1"&gt;&gt;},
 {struct,
 [{p,[0]},
 {&lt;&lt;"account\\_id"&gt;&gt;,[&lt;&lt;"0000005427"&gt;&gt;]},
 {&lt;&lt;"account\\_type\\_id"&gt;&gt;,[&lt;&lt;"3"&gt;&gt;]},
 {&lt;&lt;"id"&gt;&gt;,[&lt;&lt;"6373"&gt;&gt;]},
 {&lt;&lt;"status"&gt;&gt;,[&lt;&lt;"Deleted"&gt;&gt;]},
 {&lt;&lt;"type"&gt;&gt;,[&lt;&lt;"account"&gt;&gt;]},
 {score,[1.0]}]}}},
 [{mochijson2,tokenize,2},
 {mochijson2,decode1,2},
 {mochijson2,json\\_decode,2},
 {lists,map,2},
 {lists,map,2},
 {xx\\_acl\\_tree,from\\_json,2},
 {xx\\_acl\\_query,load\\_instance\\_,2},
 {xx\\_acl\\_query,bootstrap\\_accounts,1}]}
 in function gen\\_server:init\\_it/6
 ancestors: [xx\\_cache\\_sup,xx\\_acl\\_sup,&lt;0.108.0&gt;]
 messages: []
 links: [&lt;0.132.0&gt;]
 dictionary: []
 trap\\_exit: true
 status: running
 heap\\_size: 832040
 stack\\_size: 24
 reductions: 30690459
 neighbours:


Cheers,
Julian Pellico
