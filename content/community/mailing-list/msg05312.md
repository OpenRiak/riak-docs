---
title: "Re: 2i query, weird null results, java pbclient"
description: ""
project: community
lastmod: 2011-10-25T12:32:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05312"
mailinglist_parent_id: "msg05300"
author_name: "Alexander Robbins"
project_section: "mailinglistitem"
sent_date: 2011-10-25T12:32:36-07:00
---


Those methods both work with the RawClient and give good results. Thanks for
the help!

Alex

On Tue, Oct 25, 2011 at 1:03 PM, Russell Brown  wrote:

&gt;
&gt; On 25 Oct 2011, at 18:48, Alexander Robbins wrote:
&gt;
&gt; &gt; That code snippet isn't working because I've got a RawClient instance and
&gt; its mapReduce method wants a MapReduceSpec. I ran into this problem while
&gt; trying to use search also. I ended up making a search object and then
&gt; serializing it to json and providing it to the MapReduceSpec constructor,
&gt; then passing the resulting MapReduceSpec into the mapReduce method on
&gt; RawClient. Is there a better way? I considered just using String.format to
&gt; put the variables into a handwritten json string and using that to
&gt; instantiate the MapReduceSpec.
&gt; &gt;
&gt; &gt; Thanks!
&gt; &gt; Alex
&gt; &gt;
&gt; &gt; My gross method of making a MapReduceSpec:
&gt; &gt; final Map mapReduceObject = new HashMap Object&gt;();
&gt; &gt; final Map inputs = new HashMap();
&gt; &gt; final List query = new ArrayList();
&gt; &gt; final List searchTerms = new ArrayList();
&gt; &gt; searchTerms.add(bucket);
&gt; &gt; searchTerms.add(terms);
&gt; &gt; inputs.put("module", "riak\\_search");
&gt; &gt; inputs.put("function", "mapred\\_search");
&gt; &gt; inputs.put("arg", searchTerms);
&gt; &gt; final Map reduce = new HashMap();
&gt; &gt; reduce.put("language", "erlang");
&gt; &gt; reduce.put("module", "riak\\_kv\\_mapreduce");
&gt; &gt; reduce.put("function", "reduce\\_identity");
&gt; &gt; final Map&gt; map1 = new
&gt; HashMap&gt;();
&gt; &gt; map1.put("reduce", reduce);
&gt; &gt; query.add(map1);
&gt; &gt; mapReduceObject.put("inputs", inputs);
&gt; &gt; mapReduceObject.put("query", query);
&gt; &gt; final MapReduceSpec spec = new MapReduceSpec(new
&gt; Gson().toJson(mapReduceObject));
&gt;
&gt; OK. So the high-level libraries are there to help, even if you have a
&gt; RawClient, try this:
&gt;
&gt; IndexQuery q = new BinValueQuery(BinIndex.named("docUID"),
&gt; "mentions",
&gt; "5b9d1a6250dbd3e77ff004a12d06958745ee32844ad4aa668001bbe69b5efcf8");
&gt; MapReduce mr = new IndexMapReduce(YOUR\\_RAW\\_CLIENT\\_INSTANCE,
&gt; indexQuery);
&gt;
&gt; mr.addReducePhase(NamedErlangFunction.REDUCE\\_IDENTITY,
&gt; "{reduce\\_phase\\_only\\_1, true}");
&gt; MapReduceResult result = mr.execute();
&gt; Collection r = result.getResult(String[].class);
&gt;
&gt; You can do the same thing with the search map reduce
&gt;
&gt; MapReduce mr = new SearchMapReduce(YOUR\\_RAW\\_CLIENT, "bucket", "your
&gt; search query");
&gt;
&gt; And then use the MapReduce methods to add phases and execute as before.
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

