---
title: "Re: to escape or not to escape?"
description: ""
project: community
lastmod: 2010-08-12T09:06:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00872"
mailinglist_parent_id: "msg00870"
author_name: "Dan Reverri"
project_section: "mailinglistitem"
sent_date: 2010-08-12T09:06:38-07:00
---


Hi Francisco,

You are correct; Riak is URL decoding Link headers in
riak\\_kv\\_wm\\_raw:get\\_link\\_heads/2.
I've opened bug 617 to address this issue:
https://issues.basho.com/show\\_bug.cgi?id=617

Thanks,
Dan

Daniel Reverri
Developer Advocate
Basho Technologies, Inc.
d...@basho.com


On Wed, Aug 11, 2010 at 12:31 PM, francisco treacy &lt;
francisco.tre...@gmail.com&gt; wrote:

&gt; I have a doubt regarding links and URI-escaping in Riak.
&gt;
&gt; Say I create document 'test/first' with two links (notice %40 is
&gt; character @ uri-escaped):
&gt; =&gt; 'test/second%40basho.com'
&gt; =&gt; 'test/th...@basho.com'
&gt;
&gt; $&gt; curl -X PUT -H "content-type:text/plain" \\
&gt; -H "Link: ; riaktag=\\"foo\\",
&gt; ; riaktag=\\"bar\\"" \\
&gt; http://localhost:8098/riak/test/first --data "first"
&gt;
&gt; $&gt; curl -X PUT -H "content-type:text/plain"
&gt; http://localhost:8098/riak/test/second%40basho.com --data "second"
&gt;
&gt; $&gt; curl -X PUT -H "content-type:text/plain"
&gt; http://localhost:8098/riak/test/th...@basho.com --data "third"
&gt;
&gt; When I walk first's links, I only obtain 'test/th...@basho.com', not
&gt; 'test/second%40basho.com'.
&gt;
&gt; $&gt; curl http://localhost:8098/riak/test/first/\\_,\\_,\\_
&gt;
&gt; --IgVE1zwvyzEQq9FQ1HtOaFS8EBN
&gt; Content-Type: multipart/mixed; boundary=WOfmvASHvjIAAXdVoDNMnLViS2B
&gt;
&gt; --WOfmvASHvjIAAXdVoDNMnLViS2B
&gt; X-Riak-Vclock: a85hYGBgzGDKBVIsTJsW1mcwJTLmsTJUZ10/ypcFAA==
&gt; Location: /riak/test/third%40basho.com
&gt; Content-Type: text/plain
&gt; Link: ; rel="up"
&gt; Etag: 4gw3mCKxcnuyMAzLYMpJbl
&gt; Last-Modified: Wed, 11 Aug 2010 18:39:55 GMT
&gt;
&gt; third
&gt; --WOfmvASHvjIAAXdVoDNMnLViS2B--
&gt;
&gt; --IgVE1zwvyzEQq9FQ1HtOaFS8EBN--
&gt;
&gt;
&gt; If I update first's links, now with third being 'test/third%40basho.com':
&gt;
&gt; $&gt; curl -X PUT -H "content-type:text/plain" \\
&gt; -H "Link: ; riaktag=\\"foo\\",
&gt; ; riaktag=\\"bar\\"" \\
&gt; http://localhost:8098/riak/test/first --data "first"
&gt;
&gt; I get the same results when I do the link-walking.
&gt; 'test/second%40basho.com' is never retrieved. Doing an equivalent
&gt; map/reduce returns a {not\\_found: { 'test/sec...@basho.com' }}
&gt;
&gt; This shows that in the process of escaping/unescaping there are cases
&gt; in which link-walking (and map/reduce for that matter) don't work.
&gt; Riak should probably never unescape, and assume all keys are already
&gt; escaped.
&gt;
&gt; I've seen some work on Ripple in this direction, and that's the reason
&gt; my code is breaking after I updated. I'm also wondering how to deal
&gt; with this in riak-js.
&gt;
&gt; Thanks,
&gt; Francisco
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

