---
title: "Re: Large ring_creation_size"
description: ""
project: community
lastmod: 2011-04-14T06:37:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03024"
mailinglist_parent_id: "msg03023"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-04-14T06:37:39-07:00
---


Good points, Dave.

Also, it's worth mentioning that we've seen that many customers and open-source 
users think they will need many more nodes than they actually do. Many are able 
to start with 5 nodes and are happy for quite a while. The only way to tell 
what you actually need is to start with a baseline configuration and simulate 
some percentage above your current load. Once you've figured out what size 
that initial cluster is, start with (number of nodes) \\* 50 as the 
ring\\_creation\\_size (rounded to the nearest power of 2 of course). This gives 
you a growth factor of about 5 before you need to consider changing.

As well, there's some ops "common sense" that says the lifetime of any single 
architecture is 18 months or less. That doesn't necessarily mean that you'll 
be building a new cluster with a larger ring size in 18 months, but just that 
your needs will be different at that time and are hard to predict. Plan for 
now, worry about the 1000 node cluster when you actually need it.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Apr 14, 2011, at 9:09 AM, Dave Barnes wrote:

&gt; Sorry I feel compelled to chime in.
&gt; 
&gt; Maybe you could assess your physical node limits and start with a small 
&gt; configuration, then increase it and increase it until you hit a limit.
&gt; 
&gt; Work small to large.
&gt; 
&gt; Once you find the pain point, lets us know what resource ran out.
&gt; 
&gt; You will learn a lot along the way on how your servers behave and we'll 
&gt; discover a lot when you share the results.
&gt; 
&gt; Thanks for digging in,
&gt; 
&gt; Dave
&gt; 
&gt; On Wed, Apr 13, 2011 at 5:11 PM, Greg Nelson  wrote:
&gt; Ok, how about in this case I described? It runs out of memory with a single 
&gt; pair of nodes...
&gt; 
&gt; (Or did you mean there's a connection between each pair of vnodes?)
&gt; On Wednesday, April 13, 2011 at 1:56 PM, Jon Meredith wrote:
&gt; 
&gt;&gt; Hi Greg et al,
&gt;&gt; 
&gt;&gt; As you say largest known is not largest possible. Internally within Basho, 
&gt;&gt; the largest cluster we've experimented with so far had 50 nodes.
&gt;&gt; 
&gt;&gt; Going beyond that it's speculation from me about pain points.
&gt;&gt; 
&gt;&gt; 1) It is true that you need enough file descriptors to start up all 
&gt;&gt; partitions when a node restarts - Riak checks if there is any handoff data 
&gt;&gt; pending for each partition. We have work scheduled to address that in the 
&gt;&gt; medium term. The plan is to only spin up partitions the node owns and any 
&gt;&gt; that have been started as fallbacks that handoff has not completed for. 
&gt;&gt; Until that work is done you will need a high ulimit with large ring sizes.
&gt;&gt; 
&gt;&gt; 2) It is also true that Erlang runs a fully connected network, so there will 
&gt;&gt; be connections between each node pair in the cluster. We haven't determined 
&gt;&gt; the point at which it becomes a problem.
&gt;&gt; 
&gt;&gt; So it looks like you'll be pushing the known limits. Basho will do our very 
&gt;&gt; best to help overcome any obstacles as you encounter them.
&gt;&gt; 
&gt;&gt; Jon Meredith
&gt;&gt; Basho Technologies.
&gt;&gt; 
&gt;&gt; On Wed, Apr 13, 2011 at 1:41 PM, Greg Nelson  wrote:
&gt;&gt;&gt; The largest known riak cluster != the largest possible riak cluster. ;-)
&gt;&gt;&gt; 
&gt;&gt;&gt; The inter node communication of the cluster depends on the data set and 
&gt;&gt;&gt; usage pattern, doesn't it? Or is there some constant overhead that tops 
&gt;&gt;&gt; out at a few hundred nodes? I should point out that we'll have big data, 
&gt;&gt;&gt; but not a huge number of keys.
&gt;&gt;&gt; 
&gt;&gt;&gt; The number of vnodes in the cluster should be equal to the 
&gt;&gt;&gt; ring\\_creation\\_size under normal circumstances, shouldn't it? So when I 
&gt;&gt;&gt; have a one node cluster, that node is running ring\\_creation\\_size vnodes... 
&gt;&gt;&gt; File descriptors probably isn't a problem -- these machines won't be doing 
&gt;&gt;&gt; anything else, and the limits are set to 65536.
&gt;&gt;&gt; 
&gt;&gt;&gt; Thinking about the internode communication you mentioned, that's probably 
&gt;&gt;&gt; where the resource hog is.. socket buffers, etc.
&gt;&gt;&gt; 
&gt;&gt;&gt; Anyway, I'd also love to hear more from basho. :)
&gt;&gt;&gt; On Wednesday, April 13, 2011 at 12:33 PM, sicul...@gmail.com wrote:
&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Ill just chime in and say that this is not practical for a few reasons. 
&gt;&gt;&gt;&gt; The largest known riak cluster has like 50 or 60 nodes. Afaik, inter node 
&gt;&gt;&gt;&gt; communication of erlang clusters top out at a few hundred nodes. I'm also 
&gt;&gt;&gt;&gt; under the impression that each physical node has to have enough file 
&gt;&gt;&gt;&gt; descriptors to accommodate every virtual node in the cluster. 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I'd love to hear more from basho. 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; -alexander 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; Sent from my Verizon Wireless BlackBerry
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; -----Original Message-----
&gt;&gt;&gt;&gt; From: Greg Nelson 
&gt;&gt;&gt;&gt; Sender: riak-users-boun...@lists.basho.com
&gt;&gt;&gt;&gt; Date: Wed, 13 Apr 2011 12:13:34 
&gt;&gt;&gt;&gt; To: 
&gt;&gt;&gt;&gt; Subject: Large ring\\_creation\\_size
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt;&gt; 
&gt;&gt; 
&gt; 
&gt; 
 
&gt; 

