---
title: "Re: I like Riak! (but /test is slooooowww -- probably my fault)"
description: ""
project: community
lastmod: 2010-04-13T14:52:53-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00033"
mailinglist_parent_id: "msg00030"
author_name: "Grant Schofield"
project_section: "mailinglistitem"
sent_date: 2010-04-13T14:52:53-07:00
---


This is probably being caused the the single core you have on the EC2 node. You 
will need to enable your Erlang to be smp capable to make innostore work. Add 
the following to your /etc/riak/vm.args file (anywhere will do):
-smp enable

This is something we are going to add to the vm.args we distribute to work 
around the issue. Give the above a try and report back with any issues you 
have.

Grant Schofield
Developer Advocate
Basho Technologies, Inc.

On Apr 13, 2010, at 3:09 PM, Tyler Smart wrote:

&gt; hi Grant, I am running innostore 8, as downloaded from here, the 32bit deb
&gt; 
&gt; http://downloads.basho.com/riak/riak-0.9/
&gt; 
&gt; Here is the erland log file, the last 100 lines of it, but I did not see a 
&gt; SASS log file in the /var/log directory.
&gt; Erlang File:
&gt; 
&gt; 
&gt; =====
&gt; Exec: /usr/lib/riak/erts-5.7.4/bin/erlexec -boot 
&gt; /usr/lib/riak/releases/0.9.1/riak -embedded -config /etc/riak/app.config 
&gt; -args\\_file /etc/riak/vm.args -- console
&gt; Root: /usr/lib/riak
&gt; Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:5] 
&gt; [kernel-poll:true]
&gt; 
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.104.0&gt;)
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.105.0&gt;)
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.106.0&gt;)
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.107.0&gt;)
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.108.0&gt;)
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.109.0&gt;)
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.110.0&gt;)
&gt; 
&gt; =INFO REPORT==== 13-Apr-2010::15:18:38 ===
&gt; Spidermonkey VM host starting (&lt;0.111.0&gt;)
&gt; 
&gt; =ERROR REPORT==== 13-Apr-2010::15:18:38 ===
&gt; No ring file available.
&gt; Eshell V5.7.4 (abort with ^G)
&gt; (r...@127.0.0.1)1&gt; 
&gt; =ERROR REPORT==== 13-Apr-2010::15:19:22 ===
&gt; Skipping config setting included\\_applications; unknown option.
&gt; InnoDB: Mutexes and rw\\_locks use GCC atomic builtins
&gt; InnoDB: The first specified data file /riak/data/ibdata1 did not exist:
&gt; InnoDB: a new database to be created!
&gt; 100413 15:19:31 InnoDB: Setting file /riak/data/ibdata1 size to 32 MB
&gt; InnoDB: Database physically writes the file full: wait...
&gt; 100413 15:19:32 InnoDB: Log file /riak/logs/ib\\_logfile0 did not exist: new 
&gt; to be created
&gt; InnoDB: Setting log file /riak/logs/ib\\_logfile0 size to 16 MB
&gt; InnoDB: Database physically writes the file full: wait...
&gt; 100413 15:19:33 InnoDB: Log file /riak/logs/ib\\_logfile1 did not exist: new 
&gt; to be created
&gt; InnoDB: Setting log file /riak/logs/ib\\_logfile1 size to 16 MB
&gt; InnoDB: Database physically writes the file full: wait...
&gt; InnoDB: Doublewrite buffer not found: creating new
&gt; InnoDB: Doublewrite buffer created
&gt; InnoDB: Creating foreign key constraint system tables
&gt; InnoDB: Foreign key constraint system tables created
&gt; 100413 15:19:33 Embedded InnoDB 1.0.6.6750 started; log sequence number 0
&gt; 
&gt; ===== ALIVE Tue Apr 13 15:34:33 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 15:49:34 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 16:04:34 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 16:19:34 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 16:34:34 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 16:49:34 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 17:04:34 UTC 2010
&gt; 
&gt; ===== Tue Apr 13 17:18:31 UTC 2010
&gt; 
&gt; =ERROR REPORT==== 13-Apr-2010::17:18:31 ===
&gt; \\*\\* State machine &lt;0.566.0&gt; terminating 
&gt; \\*\\* Last message in was flow\\_timeout
&gt; \\*\\* When State == executing
&gt; \\*\\* Data == {state,50096623,
&gt; [&lt;0.568.0&gt;,&lt;0.567.0&gt;],
&gt; &lt;0.560.0&gt;,66000,
&gt; {1271179111446655,#Ref&lt;0.0.0.1123&gt;},
&gt; []}
&gt; \\*\\* Reason for termination = 
&gt; \\*\\* flow\\_timeout
&gt; 
&gt; ===== ALIVE Tue Apr 13 17:33:31 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 17:48:31 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 18:03:31 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 18:18:31 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 18:33:32 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 18:48:32 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 19:03:32 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 19:18:32 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 19:33:32 UTC 2010
&gt; 
&gt; ===== ALIVE Tue Apr 13 19:48:32 UTC 2010
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Tue, Apr 13, 2010 at 3:22 PM, Grant Schofield  wrote:
&gt; What version of Riak and Innostore are you running? Also providing both your 
&gt; erlang.log.1 as well as your sasl-error.log files from the log directory 
&gt; would help us diagnose the issue you're experiencing.
&gt; 
&gt; Thanks,
&gt; Grant Schofield
&gt; Developer Advocate 
&gt; Basho Technologies, Inc.
&gt; 
&gt; 
&gt; On Apr 13, 2010, at 12:55 PM, Tyler Smart wrote:
&gt; 
&gt;&gt; {riak, [
&gt;&gt; %% storage\\_backend specifies the Erlang module defining the storage 
&gt;&gt; mechanism
&gt;&gt; %% that will be used on this node.
&gt;&gt; %% {storage\\_backend, riak\\_dets\\_backend},
&gt;&gt; {storage\\_backend, innostore\\_riak},
&gt;&gt; 
&gt;&gt; %% Different storage backends can use other configuration 
&gt;&gt; variables. For
&gt;&gt; %% instance, riak\\_dets\\_backend\\_root determines the directory under 
&gt;&gt; which
&gt;&gt; %% dets files will be placed.
&gt;&gt; {riak\\_dets\\_backend\\_root, "/riak/backendroot"},
&gt;&gt; 
&gt;&gt; %% Default location of ringstate
&gt;&gt; {ring\\_state\\_dir, "/riak/ringstate"},
&gt;&gt; 
&gt;&gt; %% riak\\_web\\_ip is the IP address that Riak's HTTP interface will 
&gt;&gt; bind to.
&gt;&gt; %% If this is undefined, the HTTP interface will not run.
&gt;&gt; {riak\\_web\\_ip, "127.0.0.1"},
&gt;&gt; 
&gt;&gt; %% riak\\_web\\_port is the TCP port that Riak's HTTP interface will 
&gt;&gt; bind to.
&gt;&gt; {riak\\_web\\_port, 8098},
&gt;&gt; 
&gt;&gt; %% riak\\_handoff\\_port is the TCP port that Riak uses for 
&gt;&gt; intra-cluster
&gt;&gt; %% data handoff.
&gt;&gt; {riak\\_handoff\\_port, 8099},
&gt;&gt; 
&gt;&gt; %% mapred\\_name is URL used to submit map/reduce requests to Riak.
&gt;&gt; {mapred\\_name, "mapred"},
&gt;&gt; 
&gt;&gt; %% js\\_vm\\_count is the number of Javascript VMs to start per Riak 
&gt;&gt; node.
&gt;&gt; %% 8 is a good default for smaller installations. A larger number 
&gt;&gt; like
&gt;&gt; %% 12 or 16 is appropriate for installations handling lots of 
&gt;&gt; map/reduce
&gt;&gt; %% processing.
&gt;&gt; {js\\_vm\\_count, 8},
&gt;&gt; 
&gt;&gt; %% js\\_source\\_dir should point to a directory containing Javascript 
&gt;&gt; source
&gt;&gt; %% files which will be loaded by Riak when it initializes 
&gt;&gt; Javascript VMs.
&gt;&gt; %{js\\_source\\_dir, "/tmp/js\\_source"}
&gt;&gt; 
&gt;&gt; 
&gt;&gt; %% riak\\_stat enables the use of the "riak-admin status" command to
&gt;&gt; %% retrieve information the Riak node for performance and debugging 
&gt;&gt; needs
&gt;&gt; {riak\\_stat, true}
&gt;&gt; ]},
&gt;&gt; 
&gt;&gt; %% SASL config
&gt;&gt; {sasl, [
&gt;&gt; {sasl\\_error\\_logger, {file, "log/sasl-error.log"}},
&gt;&gt; {errlog\\_type, error},
&gt;&gt; {error\\_logger\\_mf\\_dir, "log/sasl"}, % Log directory
&gt;&gt; {error\\_logger\\_mf\\_maxbytes, 10485760}, % 10 MB max file 
&gt;&gt; size
&gt;&gt; {error\\_logger\\_mf\\_maxfiles, 5} % 5 files max
&gt;&gt; ]},
&gt;&gt; 
&gt;&gt; {innostore, [
&gt;&gt; {data\\_home\\_dir, "/riak/data"}, %% Where data files go
&gt;&gt; {log\\_group\\_home\\_dir, "/riak/logs"}, %% Where log files go, 
&gt;&gt; ideally the logs and data are on separate drives for performance...maybe 
&gt;&gt; later
&gt;&gt; {buffer\\_pool\\_size, 268435456} %% 256MB in-memory buffer in bytes
&gt;&gt; ]}
&gt;&gt; ].
&gt;&gt; 
&gt;&gt; 
&gt;&gt; Sorry for the confusion, that is the config file, I hope it helps.
&gt;&gt; 
&gt;&gt; Sincerely,
&gt;&gt; Tyler
&gt;&gt; 
&gt;&gt; On Tue, Apr 13, 2010 at 1:27 PM, Tyler Smart  wrote:
&gt;&gt; Hi all! 
&gt;&gt; 
&gt;&gt; I have installed Riak on an Ubuntu 8.04 EC-2 instance and it stores all of 
&gt;&gt; its' data on an EBS block (10GB). The machine is 32 bit (small). It will 
&gt;&gt; accept information in a bucket easily with a curl request like this:
&gt;&gt; 
&gt;&gt; curl -X PUT -H "content-type: text/plain" 
&gt;&gt; https://127.0.0.1/riak/example/foo --data "I have a document."
&gt;&gt; 
&gt;&gt; If I query the data like this:
&gt;&gt; 
&gt;&gt; curl -i -k https://127.0.0.1/riak/example/foo
&gt;&gt; 
&gt;&gt; I get back the data, it works perfectly. (It sits behind nginx as a reverse 
&gt;&gt; proxy that adds SSL).
&gt;&gt; 
&gt;&gt; However, if I perform this query:
&gt;&gt; 
&gt;&gt; https://127.0.0.1/riak/example
&gt;&gt; 
&gt;&gt; it never finishes executing, nor if I try https://127.0.0.1/riak/test
&gt;&gt; 
&gt;&gt; I have attached the conf file, if it will help, and I appreciate any time 
&gt;&gt; you guys have! 
&gt;&gt; 
&gt;&gt; Sincerely,
&gt;&gt; Tyler
&gt;&gt; 
&gt;&gt; 
&gt;&gt; The problem I am having is that I can 
&gt;&gt; 
&gt; 
&gt; 

