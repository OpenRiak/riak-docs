---
title: "Re: riak mapreduce failure"
description: ""
project: community
lastmod: 2011-07-07T05:33:37-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03955"
mailinglist_parent_id: "msg03950"
author_name: "Mathias Meyer"
project_section: "mailinglistitem"
sent_date: 2011-07-07T05:33:37-07:00
---


Matt,

in your JS function, you return value, where instead you must return a list of 
values, so changing it to

return [value];

fixes the problem.

Mathias Meyer
Developer Advocate, Basho Technologies


On Donnerstag, 7. Juli 2011 at 05:53, Matt Graham wrote:

&gt; Hi,
&gt; I'm trying to test out riak's mapreduce for just a simple case but I
&gt; can't get it to work. Maybe someone can help with what I'm doing
&gt; wrong. I have the latest build of Riak available for Ubuntu
&gt; installed.
&gt; 
&gt; I add an object to riak, that works. I can then fetch it. Then I try
&gt; to run a mapreduce on that bucket and it fails.
&gt; 
&gt; mdg@maple:~/tmp$ curl -i -d 6 http://127.0.0.1:8098/riak/test/2
&gt; HTTP/1.1 204 No Content
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt; Date: Thu, 07 Jul 2011 03:47:00 GMT
&gt; Content-Type: application/x-www-form-urlencoded
&gt; Content-Length: 0
&gt; 
&gt; mdg@maple:~/tmp$ curl -i http://127.0.0.1:8098/riak/test/2
&gt; HTTP/1.1 200 OK
&gt; X-Riak-Vclock: a85hYGBgzGDKBVIs7JvMrDOYEhnzWBlMVnQe58sCAA==
&gt; Vary: Accept-Encoding
&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt; Link: ; rel="up"
&gt; Last-Modified: Tue, 05 Jul 2011 09:33:16 GMT
&gt; ETag: "4fhdlMvPAPNw4SegwaTNMv"
&gt; Date: Thu, 07 Jul 2011 03:47:09 GMT
&gt; Content-Type: application/x-www-form-urlencoded
&gt; Content-Length: 1
&gt; 
&gt; 6
&gt; mdg@maple:~/tmp$curl -i -d
&gt; '{"inputs":"test","query":[{"map":{"language":"javascript","source":"function(value)
&gt; { return value; }","keep":true}}]}' -H "Content-Type:
&gt; application/json" http://127.0.0.1:8098/mapred
&gt; HTTP/1.1 500 Internal Server Error
&gt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt; Date: Thu, 07 Jul 2011 03:47:22 GMT
&gt; Content-Type: text/html
&gt; Content-Length: 692
&gt; 
&gt; 500 Internal Server
&gt; ErrorInternal Server Error
=====================

The server
&gt; encountered an error while processing this
&gt; request:  

```
{error,{exit,{json_encode,{bad_term,{&lt;&lt;"bucket"&gt;&gt;,&lt;&lt;"test"&gt;&gt;}}},
&gt;  [{mochijson2,json_encode,2},
&gt;  {mochijson2,'-json_encode_array/2-fun-0-',3},
&gt;  {lists,foldl,3},
&gt;  {mochijson2,json_encode_array,2},
&gt;  {riak_kv_wm_mapred,process_post,2},
&gt;  {webmachine_resource,resource_call,3},
&gt;  {webmachine_resource,do,3},
&gt;  
&gt; {webmachine_decision_core,resource_call,1}]}}
```


---

mochiweb+webmachine
&gt; web server


&gt; 
&gt; 
&gt; I get that json\\_encode error every time. Any ideas on how to not get
&gt; that or how to work around it?
&gt; 
&gt; Thanks,
&gt; Matt
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

