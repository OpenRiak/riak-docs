---
title: "Riak Client Resources,	Deleting a Key Doesn't Remove it from bucket.keys"
description: ""
project: community
lastmod: 2011-05-26T07:29:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03421"
author_name: "Keith Bennett"
project_section: "mailinglistitem"
sent_date: 2011-05-26T07:29:33-07:00
---


All -

I just started working with Riak, and am using the riak-client Ruby gem.

When I delete a key from a bucket, and try to fetch the value associated with 
that key, I get a 404 error (which is reasonable). However, it remains in the 
bucket's list of keys (i.e. the value returned by bucket.keys(). Why is the 
key still reported to exist in the bucket? Is bucket.keys cached, and therefore 
unaware of the deletion? Here's a riak-client Ruby script and its output in irb 
that illustrates this:

ree-1.8.7-2010.02 :001 &gt; require 'riak'
 =&gt; true 
ree-1.8.7-2010.02 :002 &gt; 
ree-1.8.7-2010.02 :003 &gt; client = Riak::Client.new
 =&gt; # 
ree-1.8.7-2010.02 :004 &gt; bucket = client['links']
 =&gt; # 
ree-1.8.7-2010.02 :005 &gt; key = bucket.keys.first
 =&gt; "4000-17.xml" 
ree-1.8.7-2010.02 :006 &gt; object = bucket[key]
 =&gt; # 
ree-1.8.7-2010.02 :007 &gt; object.delete
 =&gt; # 
ree-1.8.7-2010.02 :008 &gt; bucket.keys.first
 =&gt; "4000-17.xml" 
ree-1.8.7-2010.02 :009 &gt; object = bucket[key]
Riak::HTTPFailedRequest: Expected [200, 300] from Riak but received 404. not 
found

 from 
/Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\\_http\\_backend.rb:55:in
 `perform'
 from 
/Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1054:in 
`request'
 from 
/Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:2142:in 
`reading\\_body'
 from 
/Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1053:in 
`request'
 from 
/Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1037:in 
`request'
 from 
/Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:543:in 
`start'
 from 
/Users/kbennett/.rvm/rubies/ree-1.8.7-2010.02/lib/ruby/1.8/net/http.rb:1035:in 
`request'
 from 
/Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\\_http\\_backend.rb:47:in
 `perform'
 from 
/Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\\_http\\_backend.rb:46:in
 `tap'
 from 
/Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/net\\_http\\_backend.rb:46:in
 `perform'
 from 
/Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/http\\_backend/transport\\_methods.rb:59:in
 `get'
 from 
/Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/client/http\\_backend.rb:72:in
 `fetch\\_object'
 from 
/Users/kbennett/.rvm/gems/ree-1.8.7-2010.02/gems/riak-client-0.9.4/lib/riak/bucket.rb:101:in
 `[]'
 from riak-delete-failure.rb:9

Thanks,
Keith

