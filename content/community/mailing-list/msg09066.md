---
title: "Re: How to search objects using riak_search method"
description: ""
project: community
lastmod: 2012-10-28T11:20:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09066"
mailinglist_parent_id: "msg08843"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2012-10-28T11:20:33-07:00
---


On Tue, Oct 9, 2012 at 7:49 AM, 郎咸武  wrote:
&gt;
&gt;
&gt; ((ejabberd@meta)19&gt; f(O),O=riakc\\_obj:new(&lt;&lt;"user1"&gt;&gt;, &lt;&lt;"jason3"&gt;&gt;,
&gt; list\\_to\\_binary("[{\\"name\\":\\"\\\\u00e9\\\\u0083\\\\u008e\\\\u00e5\\\\u0093\\\\u00b2\\"},{\\"sex\\":\\"male1\\"}]"),
&gt; "application/json").
&gt; {riakc\\_obj,&lt;&lt;"user1"&gt;&gt;,&lt;&lt;"jason3"&gt;&gt;,undefined,[],
&gt; {dict,1,16,16,8,80,48,
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],...},
&gt;
&gt; {{[],[],[],[],[],[],[],[],[],[],[[&lt;&lt;...&gt;&gt;|...]],[],[],...}}},
&gt;
&gt; 
&gt; &lt;&lt;"[{\\"name\\":\\"\\\\u00e9\\\\u0083\\\\u008e\\\\u00e5\\\\u0093\\\\u00b2\\"},{\\"sex\\":\\"male1\\"}]"&gt;&gt;}
&gt;
&gt; (ejabberd@meta)20&gt; riakc\\_pb\\_socket:put(Pid, O).
&gt; ok
&gt;
&gt; (ejabberd@meta)28&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;,
&gt; list\\_to\\_binary("\\"sex\\":male1\\*")). \\* The operation is ok.\\*
&gt; {ok,{search\\_results,[{&lt;&lt;"user1"&gt;&gt;,
&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason3"&gt;&gt;},
&gt; {&lt;&lt;"name"&gt;&gt;,
&gt;
&gt; &lt;&lt;195,169,194,131,194,142,195,165,194,147,194,178&gt;&gt;},
&gt; {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male1"&gt;&gt;}]}],
&gt; 0.0,1}}
&gt;


Notice the value of the name field in the result here. It has been
properly converted to a UTF-8 sequence. That is, at some point Riak Search
took your ASCII string of unicode escapes and converted it to a proper
unicode byte sequence.

&gt; (ejabberd@meta)29&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;,
&gt; list\\_to\\_binary("\\"name\\":\\\\u00e9\\\\u0083\\\\u008e\\\\u00e5\\\\u0093\\\\u00b2")).
&gt;
&gt; {ok,{search\\_results,[],0.0,0}} \\*%% But there is empty. Why?\\*
&gt;


First off, you are adding additional quotes around the name field.

11&gt; list\\_to\\_binary("\\"name\\":\\\\u00e9\\\\u0083\\\\u008e\\\\u00e5\\\\u0093\\\\u00b2").
&lt;&lt;"\\"name\\":\\\\u00e9\\\\u0083\\\\u008e\\\\u00e5\\\\u0093\\\\u00b2"&gt;&gt;

Second, you are searching for the ASCII string
"\\\\u00e9\\\\u0083\\\\u008e\\\\u00e5\\\\u0093\\\\u00b2". At no point is this string
converted to a unicode sequence for you. This is the correct behavior
because you might have ASCII documents containing unicode escapes. You
need to query using a proper unicode binary.

19&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;,
&lt;&lt;"name:",195,169,194,131,194,142,195,165,194,147,194,178&gt;&gt;).
{ok,{search\\_results,[{&lt;&lt;"user1"&gt;&gt;,
 [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason3"&gt;&gt;},
 {&lt;&lt;"name"&gt;&gt;,

&lt;&lt;195,169,194,131,194,142,195,165,194,147,194,178&gt;&gt;},
 {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male1"&gt;&gt;}]}],
 0.35355299711227417,1}}


(ejabberd@meta)30&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;,
&gt; list\\_to\\_binary("\\"name\\":\\\\u00e9\\\\u0083\\\\u008e\\\\u00e5\\\\u0093\\\\u00b2\\*")).
&gt;
&gt; {ok,{search\\_results,[],0.0,0}} \\*%% There is empty,too. Why?\\*
&gt;
&gt;
20&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"user1"&gt;&gt;, &lt;&lt;"name:",195,169,"\\*"&gt;&gt;).

{ok,{search\\_results,[{&lt;&lt;"user1"&gt;&gt;,
 [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"jason3"&gt;&gt;},
 {&lt;&lt;"name"&gt;&gt;,

&lt;&lt;195,169,194,131,194,142,195,165,194,147,194,178&gt;&gt;},
 {&lt;&lt;"sex"&gt;&gt;,&lt;&lt;"male1"&gt;&gt;}]}],
 0.0,1}}

-Z
