---
title: "Re: Ruby client - problem listing bucket keys"
description: ""
project: community
lastmod: 2010-10-24T09:03:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01355"
mailinglist_parent_id: "msg01354"
author_name: "Ted Behling"
project_section: "mailinglistitem"
sent_date: 2010-10-24T09:03:49-07:00
---


Thanks for the reply, Sean! And on a Sunday no less.

I took your advice and installed the "yajl-ruby" gem. My broken one-liner, 
below, now works if changed to the following. Merely installing "yajl-ruby" 
didn't work; I also had to add the " require 'yajl' " line.

Also, this one-liner succeeded without the "parse\\_json\\_times = false" line, but 
I added that per your advice, since it sounds like a good idea anyway. I feel 
a lot safer parsing my own dates when needed.

ruby -e "
require 'rubygems';
require 'yajl';
require 'riak';
ActiveSupport.parse\\_json\\_times = false;
puts Riak::Client.new.bucket('broken').keys"

Thanks again,

Ted

On Oct 24, 2010, at 11:15 AM, Sean Cribbs wrote:

&gt; Ted,
&gt; 
&gt; There is a simple fix for this (which I believed was in there already). 
&gt; First of all, install the json or yajl-ruby gems (the default parsing from 
&gt; ActiveSupport is bad). Then add this to your script:
&gt; 
&gt; ActiveSupport.parse\\_json\\_times = false
&gt; 
&gt; ActiveSupport tries to be smart about parsing strings that look like dates or 
&gt; times into Date/Time objects. I've found it to be a nuisance, especially in 
&gt; use-cases like the one you have.
&gt; 
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://basho.com/
&gt; 
&gt; On Oct 23, 2010, at 6:51 PM, Ted Behling wrote:
&gt; 
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; I am new to Riak but am starting to get familiar with it. I've been going 
&gt;&gt; through the "Riak Fast Track" tutorial, and am using the riak-client Ruby 
&gt;&gt; gem. Sadly, I think I have found some broken behavior in the Ruby client. 
&gt;&gt; I'm hoping maybe the maintainer of the riak-client gem can help?
&gt;&gt; 
&gt;&gt; The issue is that if my Riak keys look like "dates", such as "2010-01-01", 
&gt;&gt; then if I invoke the "keys" method on a Riak::Bucket object, I get an error. 
&gt;&gt; Non-date-looking keys work fine.
&gt;&gt; 
&gt;&gt; Here are some commands that reproduce the problem, from an OS X command line:
&gt;&gt; 
&gt;&gt; ---------
&gt;&gt; # This successfully creates a new bucket called "broken" and assigns a value 
&gt;&gt; to the key "2010-01-01"
&gt;&gt; $ curl -X PUT -d '{"bar":"baz"}' -H "Content-Type: application/json" 
&gt;&gt; http://127.0.0.1:8098/riak/broken/2010-01-01
&gt;&gt; 
&gt;&gt; # I can successfully retrieve the specific key using a Ruby one-liner
&gt;&gt; $ ruby -e "require 'rubygems'; require 'riak'; puts 
&gt;&gt; Riak::Client.new.bucket('broken')['2010-01-01'].data.inspect"
&gt;&gt; curb library not found! Please `gem install curb` for better performance.
&gt;&gt; {"bar"=&gt;"baz"}
&gt;&gt; 
&gt;&gt; # A Ruby exception results when I list the keys. Note where it's trying to 
&gt;&gt; invoke "tr" on a Date object, shown here formatted as a different string 
&gt;&gt; than the Riak key
&gt;&gt; $ ruby -e "require 'rubygems'; require 'riak'; puts 
&gt;&gt; Riak::Client.new.bucket('broken').keys"
&gt;&gt; curb library not found! Please `gem install curb` for better performance.
&gt;&gt; /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/cgi.rb:352:in
&gt;&gt; `unescape': undefined method `tr' for Fri, 01 Jan 2010:Date (NoMethodError)
&gt;&gt; from 
&gt;&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:48:in `load'
&gt;&gt; from 
&gt;&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:48:in `map'
&gt;&gt; from 
&gt;&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:48:in `load'
&gt;&gt; from 
&gt;&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:69:in `keys'
&gt;&gt; from -e:1
&gt;&gt; ---------
&gt;&gt; 
&gt;&gt; Clearly, something here is trying to be "helpful" by translating the string 
&gt;&gt; "2010-01-01" to a Date object. This is the wrong behavior, because Riak 
&gt;&gt; keys are strings and should always be strings. Correct behavior would be to 
&gt;&gt; not interpret "date-looking" or other "special appearance" strings, and just 
&gt;&gt; treat all key strings literally.
&gt;&gt; 
&gt;&gt; Here are the relevant software versions I am running:
&gt;&gt; Mac OS X 10.6
&gt;&gt; riak-0.13.0-osx-i386 (downloaded from Basho)
&gt;&gt; ruby 1.8.7 (2009-06-12 patchlevel 174) [universal-darwin10.0]
&gt;&gt; Rubygems version 1.3.7
&gt;&gt; riak-client gem, 0.8.2, installed with "gem install riak-client"
&gt;&gt; activesupport gem, 2.3.8
&gt;&gt; 
&gt;&gt; I hope someone can fix this issue. If I can contribute a patch, or you 
&gt;&gt; would like me to help test a patch, please let me know what's needed.
&gt;&gt; 
&gt;&gt; Best regards,
&gt;&gt; 
&gt;&gt; Ted Behling
&gt;&gt; RHCE, Network+
&gt;&gt; t...@tedb.us
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt; 


\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

