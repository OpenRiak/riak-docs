---
title: "Re: Possibility of a CAS API"
description: ""
project: community
lastmod: 2012-02-25T17:46:15-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06749"
mailinglist_parent_id: "msg06747"
author_name: "Armon Dadgar"
project_section: "mailinglistitem"
sent_date: 2012-02-25T17:46:15-08:00
---


On Feb 25, 2012, at 5:38 PM, Reid Draper wrote:

&gt; On Feb 25, 2012, at 8:29 PM, Armon Dadgar wrote:
&gt; 
&gt;&gt; On Feb 25, 2012, at 5:24 PM, Reid Draper wrote:
&gt;&gt;&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt;&gt;&gt; I'm not convinced that a CAS operation is inevitably subject to data 
&gt;&gt;&gt;&gt;&gt;&gt; races.
&gt;&gt;&gt;&gt;&gt;&gt; There are proven techniques for avoiding races at the cost of latency,
&gt;&gt;&gt;&gt;&gt;&gt; which is acceptable in certain situations.
&gt;&gt;&gt;&gt;&gt; Correct, but as far as I know, there is no way to build a CAS system
&gt;&gt;&gt;&gt;&gt; on top of the primitives provided by the Riak public API. You need
&gt;&gt;&gt;&gt;&gt; a point of serialization amongst all of the replicas (for a particular 
&gt;&gt;&gt;&gt;&gt; key),
&gt;&gt;&gt;&gt;&gt; which Riak does not provide, for availability reasons.
&gt;&gt;&gt;&gt; 
&gt;&gt;&gt;&gt; I think a point of serialization is not needed here. It should be 
&gt;&gt;&gt;&gt; sufficient
&gt;&gt;&gt;&gt; to add a new internal API for nodes to handle a two-phase commit, and
&gt;&gt;&gt;&gt; then the transaction coordinator (running on whatever node you make
&gt;&gt;&gt;&gt; the request to) can contain the logic to carry out the transaction.
&gt;&gt;&gt; If I understand you correctly, the "transaction coordinator" would
&gt;&gt;&gt; be a point of serialization.
&gt;&gt; 
&gt;&gt; Not a global point of serialization, other transactions would be unaffected.
&gt;&gt; It is my understanding that there is a new transaction coordinator for
&gt;&gt; each client request. So it is already always "serial" in a sense.
&gt; 
&gt; What I'm suggesting you need is a point of serialization for
&gt; at least a quorum of the replicas for a particular key. It doesn't
&gt; have to be global across the key-space.

Yes, that sounds correct. I think we are saying the same thing.
It certainly wouldn't be as performant as doing a non-CAS operation,
but for situations where you are willing to make that trade off, it would be 
nice to have support.

&gt; It might be possible to do CAS with replicas without a synchronization
&gt; point, but I imagine such a discovery would be publication-worthy.

Haha, indeed that would be.




\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

