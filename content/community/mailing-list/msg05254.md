---
title: "Re: Key Filter Timeout"
description: ""
project: community
lastmod: 2011-10-23T16:40:33-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05254"
author_name: "Jim Adler"
project_section: "mailinglistitem"
sent_date: 2011-10-23T16:40:33-07:00
---


A little context on my use-case here. I've got about 8M keys in this 3 node
cluster. I need to clean out some bad keys and some bad data. So, I'm
using the key filter and search functionality to accomplish this (I tend to
use the riak python client). But, to be honest, I'm having a helluva time
getting these basic tasks accomplished before I ramp to hundreds of millions
of keys.

Thanks for any help.

Jim

From: Kelly McLaughlin 
Date: Sun, 23 Oct 2011 14:13:09 -0600
To: Jim Adler 
Cc: "riak-users@lists.basho.com" 
Subject: Re: Key Filter Timeout

Jim,

Looks like you are possibly using both the legacy key listing option and the
legacy map reduce. Assuming all your nodes are on Riak 1.0, check your
app.config files on all nodes and make sure mapred\\_system is set to pipe and
legacy\\_keylisting is set to false. If that's not already the case you should
see better performance. If you are still getting the same or similar errors
with those setting in place, please respond with what they are so we can
look into it more. Thanks.

Kelly

On Oct 23, 2011, at 12:38 PM, Jim Adler wrote:

&gt; I'm trying to run a very simplified key filter that's timing out. I've got
&gt; about 8M keys in a 3-node cluster, 15 GB memory, num\\_partitions=256, LevelDB
&gt; backend.
&gt; 
&gt; I'm thinking this should be pretty quick. What am I doing wrong?
&gt; 
&gt; Jim
&gt; 
&gt; Here's the query:
&gt; 
&gt; curl -v -d 
&gt; '{"inputs":{"bucket":"nodes","key\\_filters":[["eq","user\\_id-xxxxxxx-info"]]},"q
&gt; uery":[{"reduce":{"language":"erlang","module":"riak\\_kv\\_mapreduce","function":
&gt; "reduce\\_identity"}}]}' -H "Content-Type: application/json"
&gt; http://xx.xx.xx.xx:8098/mapred
&gt; 
&gt; Here's the log:
&gt; 
&gt; 18:25:08.892 [error] gen\\_fsm &lt;0.20795.0&gt; in state executing terminated with
&gt; reason: {error,flow\\_timeout}
&gt; 18:25:08.961 [error] CRASH REPORT Process &lt;0.20795.0&gt; with 2 neighbours
&gt; crashed with reason: {error,flow\\_timeout}
&gt; 18:25:08.963 [error] Supervisor luke\\_flow\\_sup had child undefined started with
&gt; {luke\\_flow,start\\_link,undefined} at &lt;0.20795.0&gt; exit with reason
&gt; {error,flow\\_timeout} in context child\\_terminated
&gt; 18:25:08.966 [error] gen\\_fsm &lt;0.20798.0&gt; in state waiting\\_kl terminated with
&gt; reason: {error,flow\\_timeout}
&gt; 18:25:08.971 [error] CRASH REPORT Process &lt;0.20798.0&gt; with 0 neighbours
&gt; crashed with reason: {error,flow\\_timeout}
&gt; 18:25:08.980 [error] Supervisor riak\\_kv\\_keys\\_fsm\\_legacy\\_sup had child
&gt; undefined started with {riak\\_kv\\_keys\\_fsm\\_legacy,start\\_link,undefined} at
&gt; &lt;0.20798.0&gt; exit with reason {error,flow\\_timeout} in context child\\_terminated
&gt; 18:25:08.983 [error] Supervisor luke\\_phase\\_sup had child undefined started
&gt; with {luke\\_phase,start\\_link,undefined} at &lt;0.20797.0&gt; exit with reason
&gt; {error,flow\\_timeout} in context child\\_terminated
&gt; 18:25:08.996 [error] Supervisor luke\\_phase\\_sup had child undefined started
&gt; with {luke\\_phase,start\\_link,undefined} at &lt;0.20796.0&gt; exit with reason
&gt; {error,flow\\_timeout} in context child\\_terminated
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com



\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

