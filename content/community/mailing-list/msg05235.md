---
title: "Re: Link walking and keep field"
description: ""
project: community
lastmod: 2011-10-21T12:15:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05235"
mailinglist_parent_id: "msg05234"
author_name: "Anton Podviaznikov"
project_section: "mailinglistitem"
sent_date: 2011-10-21T12:15:49-07:00
---


Hi,

Thank you for your response. Ok, so I'll use URL-syntax for link walking.
Another problem here. I'm using riak-js as client library. And in this
library for link walking (method "walk") M/R style used internally:
https://github.com/frank06/riak-js/blob/master/src/http\\_client.coffee#L79

What should I do in such situation? Should I implemented another walk method
and send pull request to Francisco Treacy?

P.S. Could you please put this information in the official documentation (at
least I didn't find it there)? Because it's confusing since 'keep' flag
exists in both URL-syntax and M/R link phase and behavior is different. The
only difference that was mentioned - multipart response for link walking
using URL-syntax.

Best regards,
Anton Podviaznikov

On 21 October 2011 20:37, Sean Cribbs  wrote:

&gt; Anton,
&gt;
&gt; Sorry for the delay. Yes you can use MapReduce link-phases in a similar
&gt; way, but unlike the link-walking resource, the objects pointed to in each
&gt; phase will not be returned. The way link-walking does its work is to split
&gt; the URL into segments for each phase that has keep=true (1), then issue a
&gt; MapReduce request for the traversal up to the first keep, then take the
&gt; results of that and feed it to another that goes up to the next keep, and so
&gt; on. So your link-walking query is actually more like:
&gt;
&gt; [users/userid] -&gt; link(projects, \\_, 1) -&gt; map\\_value
&gt; (results from previous) -&gt; link(parts, \\_, 1) -&gt; map\\_value
&gt; (results from previous) -&gt; link(units, \\_, 1) -&gt; map\\_value
&gt;
&gt;
&gt; On Mon, Oct 17, 2011 at 2:21 PM, Anton Podviaznikov &lt;
&gt; podviazni...@gmail.com&gt; wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt;
&gt;&gt; I had question about Link walking.
&gt;&gt; I need to walk links in few levels and keep results from previous steps.
&gt;&gt; I managed to achieve this using URL syntax
&gt;&gt; /users/userid/projects,\\*,1/parts,\\*,1/units,\\*,\\*
&gt;&gt; Here I find all user's projects than parts and finally units.
&gt;&gt;
&gt;&gt; However I couldn't achieve the same results using map-reduce and link
&gt;&gt; phases.
&gt;&gt;
&gt;&gt; curl -X POST -H "content-type: application/json"
&gt;&gt; http://localhost:8098/mapred --data @-&lt;&lt;\\EOF
&gt;&gt; {"inputs":[["users","userid"]],"query":[{"link":{"bucket":"projects","keep":true}},{"link":{"bucket":"parts","keep":true}},{"link":{"bucket":"units"}},{"map":{"language":"javascript","source":"function(v)
&gt;&gt; { return [v]; }"}}]}
&gt;&gt; EOF
&gt;&gt;
&gt;&gt;
&gt;&gt; I got full documents from last step but for projects and parts I got only
&gt;&gt; bucket, key and tag (there was no document body and metadata).
&gt;&gt;
&gt;&gt; Is it some problem in map function? Any hints, advises?
&gt;&gt;
&gt;&gt; Best regards,
&gt;&gt; Anton Podviaznikov
&gt;&gt;
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt; --
&gt; Sean Cribbs 
&gt; Developer Advocate
&gt; Basho Technologies, Inc.
&gt; http://www.basho.com/
&gt;
&gt;


-- 
Best regards,

Anton Podviaznikov
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

