---
title: "Re: Python client: three issues"
description: ""
project: community
lastmod: 2011-09-05T03:29:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04573"
mailinglist_parent_id: "msg04571"
author_name: "Greg Stein"
project_section: "mailinglistitem"
sent_date: 2011-09-05T03:29:40-07:00
---


On Sun, Sep 4, 2011 at 22:12, Brett Hoerner  wrote:
&gt; On Sun, Sep 4, 2011 at 7:05 PM, Greg Stein  wrote:
&gt;&gt; 1. I'd like Riak to generate keys for some of my objects, and I'm
&gt;&gt; using the HTTP API. Pretty simple: do a POST, and the Location: header
&gt;&gt; will tell me the key. However, looking at the code... it doesn't
&gt;&gt; appear that object.store() actually reads and returns that key. Am I
&gt;&gt; missing something here? Maybe there is a Proper Way to do this?
&gt;
&gt; You're right, it looks like this functionality was added without the
&gt; logic to pull the key back out of the response. It definitely should.

Okay. Just wanted to make sure that I wasn't missing something. I'll
craft up a patch.

&gt;...
&gt;&gt; 2. The HTTP transport code doesn't use httplib properly at all. When I
&gt;&gt; wrote the httplib library, my primary design point was to enable
&gt;&gt; persistent, HTTP/1.1 connections. That was the whole idea behind
&gt;&gt; HTTPConnection. The transport library opens a \\*new\\* connection for
&gt;&gt; every request. I'm not surprised that the performance suffers, since a
&gt;&gt; TCP setup handshake needs to occur on every request. ... So: are there
&gt;&gt; any plans to rebuild the HTTP support to use persistent connections?
&gt;
&gt; I believe I've read that Riak itself doesn't support keep-alive.
&gt; Someone else would have to comment for sure here. Regardless, this
&gt; feature would be handy because many people use Riak over HTTP through
&gt; a reverse proxy.

It looks like Riak supports persistent connections, according to this post:
 
http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2010-March/000744.html

I'd like to understand if there is a roadmap for the HTTP client, and if

&gt;&gt; 3. The Luwak support reads the \\*entire\\* "file" into memory. My
&gt;&gt; understanding is that Luwak is for "large" files. If those files are
&gt;&gt; (say) a gigabyte, then the current code is going to impact clients in
&gt;&gt; a \\*very\\* bad way. I can see that the code wants to read the response,
&gt;&gt; then return the connection back to the pool... but that just isn't
&gt;&gt; workable. A connection needs to be held by the reader, which then
&gt;&gt; streams it to completion (or close), and only then should the
&gt;&gt; connection be returned. Now, if Luwak is defined for files less than
&gt;&gt; (say) 10 megabytes, then maybe this approach isn't wrong, but I
&gt;&gt; haven't seen any documentation about size limitations. Any thoughts on
&gt;&gt; this?
&gt;
&gt; You're 100% right that it should spool to disk, Luwak is meant for
&gt; very large files.

I see no reason to spool to disk. Just keep the socket open, and let
the application read as necessary. That said, thanks for validating my
understanding of Luwak files.

&gt; The Python client has been pretty quiet in my experience (though I
&gt; only started messing with it about a month ago). I'm sure patches for
&gt; any/all of the above are welcome. I'm hoping the Basho guys have
&gt; someone on it to review pull requests and such sooner than later.

Can do. I've already submitted a pull request to allow the client to
work with older versions of Python (e.g the Python 2.5 installed on my
Mac OS Leopard laptop).

Cheers,
-g

