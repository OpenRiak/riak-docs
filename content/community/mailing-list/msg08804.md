---
title: "Re: riak search and basic write operations"
description: ""
project: community
lastmod: 2012-10-03T15:24:52-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08804"
mailinglist_parent_id: "msg08797"
author_name: "kamiseq"
project_section: "mailinglistitem"
sent_date: 2012-10-03T15:24:52-07:00
---


I found out why I couldn't read objects via rest client. my key
contained # and it was probably mapped to different char by pbclient,
when replaced # with \\_ everything works fine.

how can I force charset using pbclient, what is the default?

pozdrawiam
Paweł Kamiński

kami...@gmail.com
pkaminski....@gmail.com
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_


On 3 October 2012 18:24, kamiseq  wrote:
&gt; ok,
&gt; I admit that somehow I didn't catch at first that example shows second
&gt; index usage - so thanks for pointing this out.
&gt;
&gt; what about questions 1,4,5??
&gt;
&gt; pozdrawiam
&gt; Paweł Kamiński
&gt;
&gt; kami...@gmail.com
&gt; pkaminski....@gmail.com
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;
&gt;
&gt; On 3 October 2012 00:24, Brian Roach  wrote:
&gt;&gt; Greetings!
&gt;&gt;
&gt;&gt; First and foremost, search and secondary indexes (2i) are not the same thing.
&gt;&gt;
&gt;&gt; You need to enable 2i and use the ELevelDB backend as described here:
&gt;&gt; http://wiki.basho.com/Secondary-Indexes---Configuration-and-Examples.html
&gt;&gt;
&gt;&gt; Secondly, the default Converter (JSONConverter) in the Java client
&gt;&gt; does support serializing/deserializing of secondary indexes. The page
&gt;&gt; you link to in the cookbook is demonstrating how to write your own
&gt;&gt; custom converter (for something other than JSON), and its first
&gt;&gt; example does not support them.
&gt;&gt;
&gt;&gt; Enable 2i in Riak, annotate your POJO as you have, and use the default
&gt;&gt; Converter and you should be fine; nothing else is needed.
&gt;&gt;
&gt;&gt; On Tue, Oct 2, 2012 at 4:03 PM, kamiseq  wrote:
&gt;&gt;&gt; hej I am a bit confused about search functionality and basic
&gt;&gt;&gt; read/write operations.
&gt;&gt;&gt;
&gt;&gt;&gt; Im using recent (1.0.6) java client and pb cluster riak client. just
&gt;&gt;&gt; for testing Im only using two local machines joined into one cluster.
&gt;&gt;&gt; storing and reading objects works fine with key(let say I have users
&gt;&gt;&gt; bucket and I generate id from timestamp).
&gt;&gt;&gt;
&gt;&gt;&gt; but
&gt;&gt;&gt; 1. I cannot fetch objects using rest client in firefox after I store
&gt;&gt;&gt; objects using java client (I ll check with curl) but I can query for
&gt;&gt;&gt; keys in bucket 
&gt;&gt;&gt; (http://192.168.0.121:8098/riak/users/?keys=true&props=false).
&gt;&gt;&gt; 2. I followed 
&gt;&gt;&gt; https://github.com/basho/riak-java-client/wiki/Using-a-custom-Converter
&gt;&gt;&gt; and I annotated one of the field with @RiakIndex(name = "user\\_email")
&gt;&gt;&gt; and now I tried to look-up this object with email but I got
&gt;&gt;&gt; Caused by: com.basho.riak.client.RiakException: java.io.IOException:
&gt;&gt;&gt; {"phase":"index","error":"{indexes\\_not\\_supported,riak\\_kv\\_bitcask\\_backend}","input":"{cover,[{1370157784997721485815954530671515330927436759040,[1370157784997721485815954530671515330927436759040]}],{&lt;&lt;\\"users\\"&gt;&gt;,{eq,&lt;&lt;\\"user\\_email\\_bin\\"&gt;&gt;,&lt;&lt;\\"js@gm.com1\\"&gt;&gt;}}}","type":"result","stack":"[]"}
&gt;&gt;&gt; at com.basho.riak.client.query.MapReduce.execute(MapReduce.java:80)
&gt;&gt;&gt; at 
&gt;&gt;&gt; com.basho.riak.client.raw.pbc.PBClientAdapter.fetchIndex(PBClientAdapter.java:436)
&gt;&gt;&gt;
&gt;&gt;&gt; I ve google a bit and all I could find was this
&gt;&gt;&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-September/005749.html
&gt;&gt;&gt; post a year old now. which points out that search needs to be enabled
&gt;&gt;&gt; in app.config file. I changed settings and restarted both machines.
&gt;&gt;&gt; but I keep getting same exception every time.
&gt;&gt;&gt; 3. in same 
&gt;&gt;&gt; https://github.com/basho/riak-java-client/wiki/Using-a-custom-Converter
&gt;&gt;&gt; tutorial I read that default converter is not marshalling indexes,
&gt;&gt;&gt; links and metadata and it shows how to get and restore those
&gt;&gt;&gt; information back but looking into code for default converter
&gt;&gt;&gt; implementation I could find the same lines of code as in the article
&gt;&gt;&gt;
&gt;&gt;&gt; Map usermetaData =
&gt;&gt;&gt; usermetaConverter.getUsermetaData(domainObject);
&gt;&gt;&gt; RiakIndexes indexes = riakIndexConverter.getIndexes(domainObject);
&gt;&gt;&gt; Collection links = 
&gt;&gt;&gt; riakLinksConverter.getLinks(domainObject);
&gt;&gt;&gt;
&gt;&gt;&gt; return RiakObjectBuilder.newBuilder(bucket, key)
&gt;&gt;&gt; .withValue(value)
&gt;&gt;&gt; .withVClock(vclock)
&gt;&gt;&gt; .withUsermeta(usermetaData)
&gt;&gt;&gt; .withIndexes(indexes)
&gt;&gt;&gt; .withLinks(links)
&gt;&gt;&gt; .withContentType(Constants.CTYPE\\_OCTET\\_STREAM)
&gt;&gt;&gt; .build();
&gt;&gt;&gt; 4. can I specify data encoding it seems that it is not UTF-8
&gt;&gt;&gt; 5. I also saw in app.config that vnode\\_vclocks is set to true, so
&gt;&gt;&gt; should I still set clientId on riak client?? I read it will be skipped
&gt;&gt;&gt; anyway now.
&gt;&gt;&gt;
&gt;&gt;&gt; thanks for any comments
&gt;&gt;&gt;
&gt;&gt;&gt; pozdrawiam
&gt;&gt;&gt; Paweł Kamiński
&gt;&gt;&gt;
&gt;&gt;&gt; kami...@gmail.com
&gt;&gt;&gt; pkaminski....@gmail.com
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt;
