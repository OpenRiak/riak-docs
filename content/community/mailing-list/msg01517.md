---
title: "Ripple associations problem"
description: ""
project: community
lastmod: 2010-11-10T10:52:43-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01517"
author_name: "Antonio Fern√°ndez Vara"
project_section: "mailinglistitem"
sent_date: 2010-11-10T10:52:43-08:00
---


Hi all,

I hope you can help me with this problem. I'm new to ripple/riak and Im
trying a bit of code on rails. I'm trying a little application with Devise
just to see how it works.

Just trying a few things I found this problem:


-----
class User
 include Ripple::Document

 devise :database\\_authenticatable, :confirmable,
 :rememberable, :registerable, :trackable, :timeoutable,
:validatable,
 :token\\_authenticatable

 property :email, String, :presence =&gt; true
 property :password, String
 property :password\\_confirmation, String

 timestamps!

 key\\_on :email

 one :profile

 def id
 email
 end

end


class Profile
 include Ripple::Document

 property :first\\_name, String
 property :last\\_name, String

 property :username, String, :presence =&gt; true

 timestamps!

 key\\_on :username

 one :user

 def id
 username
 end

end



----
\\*In the console.\\*

 &gt;&gt; u = User.create(:email =&gt; 'antoniofernandezv...@gmail.com',
:password =&gt; '123456', :password\\_confirmation =&gt; '123456')
=&gt; 
encrypted\\_password="$2a$10$cQVKORpRIf3TGi2Z8SBXFOy6bEsnLAdbtNRTLLn4t0yKq1X37jsd2"
created\\_at=Wed Nov 10 18:40:43 UTC 2010 updated\\_at=Wed Nov 10 18:40:43 UTC
2010 confirmation\\_sent\\_at=Wed Nov 10 18:40:43 UTC 2010
password\\_confirmation=nil last\\_sign\\_in\\_ip=nil last\\_sign\\_in\\_at=nil
sign\\_in\\_count=nil password\\_salt="$2a$10$cQVKORpRIf3TGi2Z8SBXFO"
current\\_sign\\_in\\_ip=nil authentication\\_token=nil remember\\_token=nil
current\\_sign\\_in\\_at=nil confirmation\\_token="GsVcI\\_YJKir5lB8nljG5"
remember\\_created\\_at=nil password=nil email="antoniofernandezv...@gmail.com"
confirmed\\_at=nil&gt;
&gt;&gt; p = Profile.create(:username =&gt; 'fernandezvara', :first\\_name =&gt;
'Antonio', :last\\_name =&gt; 'Fernndez Vara')
=&gt; 
&gt;&gt; u.profile = p
=&gt; 
&gt;&gt; u.save
=&gt; true
&gt;&gt; p.user = u
=&gt; 
encrypted\\_password="$2a$10$cQVKORpRIf3TGi2Z8SBXFOy6bEsnLAdbtNRTLLn4t0yKq1X37jsd2"
created\\_at=Wed Nov 10 18:40:43 UTC 2010 updated\\_at=Wed Nov 10 18:41:14 UTC
2010 confirmation\\_sent\\_at=Wed Nov 10 18:40:43 UTC 2010
password\\_confirmation=nil last\\_sign\\_in\\_ip=nil last\\_sign\\_in\\_at=nil
sign\\_in\\_count=nil password\\_salt="$2a$10$cQVKORpRIf3TGi2Z8SBXFO"
current\\_sign\\_in\\_ip=nil authentication\\_token=nil remember\\_token=nil
current\\_sign\\_in\\_at=nil confirmation\\_token="GsVcI\\_YJKir5lB8nljG5"
remember\\_created\\_at=nil password=nil email="antoniofernandezv...@gmail.com"
confirmed\\_at=nil&gt;
&gt;&gt; p.save
=&gt; true


\\*--- Creation and associations work correctly. (at least it appears)\\*
\\*
\\*
\\*---------- First, query for the profile of the user (Works!)\\*

?&gt; uu = User.find('antoniofernandezv...@gmail.com')
=&gt; 
encrypted\\_password="$2a$10$cQVKORpRIf3TGi2Z8SBXFOy6bEsnLAdbtNRTLLn4t0yKq1X37jsd2"
created\\_at=Wed Nov 10 18:40:43 UTC 2010 updated\\_at=Wed Nov 10 18:41:14 UTC
2010 confirmation\\_sent\\_at="Wed, 10 Nov 2010 18:40:43 -0000"
password\\_confirmation=nil last\\_sign\\_in\\_ip=nil last\\_sign\\_in\\_at=nil
sign\\_in\\_count=nil password\\_salt="$2a$10$cQVKORpRIf3TGi2Z8SBXFO"
current\\_sign\\_in\\_ip=nil authentication\\_token=nil remember\\_token=nil
current\\_sign\\_in\\_at=nil confirmation\\_token="GsVcI\\_YJKir5lB8nljG5"
remember\\_created\\_at=nil password=nil email="antoniofernandezv...@gmail.com"
confirmed\\_at=nil&gt;
&gt;&gt; uu.profile
=&gt; 


\\*----------- Second, query for the user referenced by the profile (Error!)\\*

?&gt; pp = Profile.find('fernandezvara')
=&gt; 
&gt;&gt; pp.user
NoMethodError: undefined method `key' for nil:NilClass
from
/Library/Ruby/Gems/1.8/gems/activesupport-3.0.1/lib/active\\_support/whiny\\_nil.rb:48:in
`method\\_missing'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/document/finders.rb:121:in
`instantiate'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/one\\_linked\\_proxy.rb:25:in
`send'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/one\\_linked\\_proxy.rb:25:in
`find\\_target'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/proxy.rb:113:in
`load\\_target'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/proxy.rb:41:in
`inspect'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:302:in
`output\\_value'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:151:in
`eval\\_input'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:263:in
`signal\\_status'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:147:in
`eval\\_input'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:146:in
`eval\\_input'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:70:in
`start'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:69:in
`catch'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:69:in
`start'
from
/Library/Ruby/Gems/1.8/gems/railties-3.0.1/lib/rails/commands/console.rb:44:in
`start'
from
/Library/Ruby/Gems/1.8/gems/railties-3.0.1/lib/rails/commands/console.rb:8:in
`start'
from /Library/Ruby/Gems/1.8/gems/railties-3.0.1/lib/rails/commands.rb:23
from script/rails:6:in `require'
from script/rails:6&gt;&gt;


Can someone point me what i'm doing wrong? I'm so lost.

Thanks in advance.
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

