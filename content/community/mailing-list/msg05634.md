---
title: "Re: Lager and Scribe"
description: ""
project: community
lastmod: 2011-11-17T08:08:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05634"
mailinglist_parent_id: "msg05631"
author_name: "Andrew Thompson"
project_section: "mailinglistitem"
sent_date: 2011-11-17T08:08:45-08:00
---


On Thu, Nov 17, 2011 at 04:52:58PM +0100, Bip Thelin wrote:
&gt; Hi,
&gt; 
&gt; I've been thinking about using lager to push logs to our Big Data Hadoop 
&gt; backend for later analysis using Scribe. Looking at the lager\\_syslog backend 
&gt; it looks fairly simple to create such a backend. But thrift works kind of 
&gt; different and some implementation questions occur when going through the 
&gt; lager code.
&gt; 
&gt; The way thrift works is that you create a connection:
&gt; {ok, Client} = thrift\\_client\\_util:new()
&gt; 
&gt; then you can use the Client to do subsequent calls like
&gt; {Client2, \\_Result} = thrift\\_client:call(Client, ...)
&gt; {Client3, \\_Result} = thrift\\_client:call(Client2, ...)
&gt; [...]
&gt; 
&gt; The problem is that you get a new Client descriptor every time and as I've 
&gt; understood it you shouldn't use the same Client twice but instead use the new 
&gt; one with each call. One could of course create a client and do the call 
&gt; within each handle\\_event() and pay that penalty hit but there must be a 
&gt; smarter way. I was going through the lager\\_file\\_backend and saw that you use 
&gt; a FD that get's passed around, is that a good approach to use something 
&gt; similar for a Scribe backend?
&gt; 
It should be fine to create the client and just store the current
descriptor in the backend's state. Creating a whole new client on every
message seems like a bad idea.

Andrew

