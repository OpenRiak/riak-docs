---
title: "Re: Riak 0.14 nodes crashing under light load"
description: ""
project: community
lastmod: 2011-02-01T16:34:36-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02165"
mailinglist_parent_id: "msg02164"
author_name: "Anthony Molinaro"
project_section: "mailinglistitem"
sent_date: 2011-02-01T16:34:36-08:00
---


Hi Mark,

Yeah, you know I thought about this as soon as I got on my bicycle to ride
home. And remembered that while I did bump the limit on my QA setup I did
not on the production setup. Oops, I'm sure that's it. I'll write back
if that doesn't solve it.

Thanks for the quick response.

-Anthony

On Tue, Feb 01, 2011 at 04:22:34PM -0800, Mark Phillips wrote:
&gt; Hey Anthony,
&gt; 
&gt; At first glance, it looks like you may have run into an open file
&gt; handle problem. Try increasing the ulimit to at least 1024. There is
&gt; more info on the wiki here:
&gt; 
&gt; http://wiki.basho.com/Open-Files-Limit.html
&gt; 
&gt; Give that a shot and let us know if the problem persists.
&gt; 
&gt; Mark
&gt; 
&gt; On Tue, Feb 1, 2011 at 4:08 PM, Anthony Molinaro
&gt;  wrote:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt;  I just set up a 4 node cluster mostly vanilla config with the exception
&gt; &gt; that I specified 1024 partitions, and I'm using a multi-backend with one
&gt; &gt; entry for bitcask and the default as bitcask (I plan to deploy a cache
&gt; &gt; backend at some point).  I have one bucket which stores a pretty small
&gt; &gt; payload (key is 36 bytes, value is 36 bytes).
&gt; &gt;
&gt; &gt; Things ran fine under light load (~400 get, ~30 puts according to riak-admin
&gt; &gt; status, so I think that's per minute).  Suddenly several nodes (3/4) all
&gt; &gt; shutdown within a few minutes of each other.  They all seem to have
&gt; &gt; errors like this
&gt; &gt;
&gt; &gt; =ERROR REPORT==== 1-Feb-2011::23:50:35 ===^M
&gt; &gt; Failed to open lock file 
&gt; &gt; /var/lib/riak/bitcask/1156070631091827503657211635254091060470024765440/bitcask.write.lock:
&gt; &gt; emfile
&gt; &gt;
&gt; &gt; then a state machine termination stacktrace.
&gt; &gt;
&gt; &gt; I had run cluster\\_info for all of them a few minutes before and the only
&gt; &gt; machine which didn't crash was the one I ran cluster\\_info on.
&gt; &gt;
&gt; &gt; Not sure if that was the cause or not.  Any ideas what could cause these
&gt; &gt; errors?
&gt; &gt;
&gt; &gt; I can send more info if it would help, but wanted to get the conversation
&gt; &gt; started before I head home.
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt;
&gt; &gt; -Anthony
&gt; &gt;
&gt; &gt; --
&gt; &gt; ------------------------------------------------------------------------
&gt; &gt; Anthony Molinaro                           
&gt; &gt;
&gt; &gt;

-- 
------------------------------------------------------------------------
Anthony Molinaro 

