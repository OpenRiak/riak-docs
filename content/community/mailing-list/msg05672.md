---
title: "Re: Random but frequent crashes"
description: ""
project: community
lastmod: 2011-11-18T13:01:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05672"
mailinglist_parent_id: "msg05651"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-11-18T13:01:59-08:00
---


Michael,

The first thing that jumps out to me is the line that says: alarm\\_handler:
{set,{system\\_memory\\_high\\_watermark,[]}}, followed by a lot of "long\\_gc"
messages. My guess is that you have too much memory pressure (which can be
a problem with Bitcask when you have lots of keys) and so the Erlang VM
exits when it reaches OOM. On your next node startup, monitor the VSZ of
the "beam.smp" process by using the ps command and make sure it doesn't
reach the maximum RAM in your system.

Hope that helps,

On Fri, Nov 18, 2011 at 3:36 PM, Michael Jakl
wrote:

&gt; So, after a few hours we've got another crash (around 20 o'clock).
&gt; I could not find anything in the logfiles, but I've attached them
&gt; anyways. error.log and crash.log were empty, though.
&gt; Has anyone got an idea how I could possibly get rid of these crashes?
&gt; Cheers,
&gt; Michael
&gt;
&gt; On Fri, Nov 18, 2011 at 12:27 PM, Michael Jakl
&gt;  wrote:
&gt; &gt; Hi,
&gt; &gt; I'm testdriving Riak (1.0.1) using Bitcask and a lot of data
&gt; &gt; (currently ~25 million documents). I've deployed Riak on three
&gt; &gt; machines with a n\\_val of 3 (acutally, I left it at the default).
&gt; &gt;
&gt; &gt; Soon after I started an import process, Riak crashed about every 6
&gt; &gt; million documents (sometimes more frequently) leaving no obvious cause
&gt; &gt; in the logfiles. I've opened a ticket (Bug 1282 [1]), but maybe it's
&gt; &gt; better to discuss it here since I'm not having much information on
&gt; &gt; this. The only node that crashes is the one I'm adding the data to,
&gt; &gt; the other two nodes didn't crash yet. The importer and the (crashing)
&gt; &gt; Riak node are on the same machine and I'm currently using the HTTP
&gt; &gt; Java client (before that, I was using the PBC Java client).
&gt; &gt;
&gt; &gt; It seems that the crashes occur after a long running gc alert in the
&gt; &gt; logfiles, yet that may be unrelated (the memory usage on my machine
&gt; &gt; does not go up).
&gt; &gt;
&gt; &gt; I'm running Riak on machines with 24GB of RAM, the bucket-name is
&gt; &gt; about 10 chars long and the keys 20 chars. I expect about 200 million
&gt; &gt; documents with roughly 20k of data, but currently I've only imported
&gt; &gt; only 24 million. The first crash happened after 6 million documents.
&gt; &gt;
&gt; &gt; The nofile limit for Riak is 32000 on Linux Debian 6 with all updates
&gt; &gt; installed. The capacity planning page tells me that I've enough RAM
&gt; &gt; (recommendation: 3 nodes with 14GB of RAM). The bitcask directory has
&gt; &gt; about 180GB of data and contains 344 files.
&gt; &gt;
&gt; &gt; I've tried switching to eleveldb thinking it might be a memory issue,
&gt; &gt; but that used up more disk space than I have available. My migration
&gt; &gt; plan was to install Riak on another machine, setup leveldb and tried
&gt; &gt; to join the node running bitcask, disk consumption went from 200G to
&gt; &gt; over a terrabyte during the process.
&gt; &gt;
&gt; &gt; I've upgraded to Riak 1.0.2, but the changelog does not mention
&gt; &gt; anything related to that.
&gt; &gt;
&gt; &gt; What could I do to identify the problem? Are there any debugging
&gt; &gt; switches I could turn on (I've recently activated the
&gt; &gt; sasl\\_error\\_logger)? I'm thinking of activating the Heartbeat
&gt; &gt; management in vm.args, but that wouldn't fix the root cause... . I've
&gt; &gt; just restarted Riak using 1.0.2 and cleaned all logfiles. Up until
&gt; &gt; now, crashes were frequent enough that I should be able to provide a
&gt; &gt; set of logfiles on monday, but are there any obvious things I might
&gt; &gt; have forgotten?
&gt; &gt;
&gt; &gt; Cheers,
&gt; &gt; Michael
&gt; &gt;
&gt; &gt; 1: https://issues.basho.com/show\\_bug.cgi?id=1282
&gt; &gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;


-- 
Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://www.basho.com/
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

