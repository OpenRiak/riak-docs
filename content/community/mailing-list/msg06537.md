---
title: "Re: No message in sasl-error.log for wrong post commit erlang hook"
description: ""
project: community
lastmod: 2012-02-03T13:44:59-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06537"
mailinglist_parent_id: "msg06532"
author_name: "Alin Popa"
project_section: "mailinglistitem"
sent_date: 2012-02-03T13:44:59-08:00
---


Ryan,

I would say that having those informations into the log files, especially
the reason why it failed, is very useful, so, would you say it would be
helpful if I'm going to open a pull request which will increase the log
level usage from debug to error for pre/post commit hooks execution errors
(as it seems to be pretty straight forward) ?

Thanks,
Alin

On Fri, Feb 3, 2012 at 7:26 PM, Ryan Zezeski  wrote:

&gt; Alin,
&gt;
&gt; Sorry for your troubles, you are hitting a bug. If a post-commit hook
&gt; fails the exception is caught and silently dropped on the floor. That is,
&gt; it is not logged anywhere at any time and therefore you have no way to know
&gt; if it failed or not.
&gt;
&gt; Just recently a patch was merged for this in the master branch that will
&gt; be included in the next release. However, it's worth noting that the patch
&gt; also doesn't log anything by default (well it does, but to the debug level
&gt; which is not enabled by default). Rather it increments a new stat
&gt; (accessible via `riak-admin status`) named `postcommit\\_fail`. While I was
&gt; making this patch I also went ahead and did the same for pre-commit hooks.
&gt;
&gt; So while developing you can run with debug level and then in production
&gt; you can run the following to determine if something failed:
&gt;
&gt; $ ./rel/riak/bin/riak-admin status | grep commit
&gt; precommit\\_fail : 0
&gt; postcommit\\_fail : 0
&gt;
&gt; -Ryan
&gt;
&gt; On Fri, Feb 3, 2012 at 5:37 AM, Alin Popa  wrote:
&gt;
&gt;&gt; Hi guys,
&gt;&gt;
&gt;&gt; I've worked a bit with the Riak's post commit hooks:
&gt;&gt;
&gt;&gt; 1. Create a post commit module/function:
&gt;&gt;
&gt;&gt; \\*-module(post\\_commit\\_hooks).\\*
&gt;&gt; \\*
&gt;&gt; \\*
&gt;&gt; \\*-export([log/1]).\\*
&gt;&gt; \\*
&gt;&gt; \\*
&gt;&gt; \\*log(Object) -&gt;\\*
&gt;&gt; \\* error\\_logger:info\\_msg("OBJECT: ~p~n",[Object]).\\*
&gt;&gt;
&gt;&gt; 2. Updated the app.conf file in order to pick it up
&gt;&gt; 3. Compiled the file using the erts that's embedded into the riak
&gt;&gt; distribution (which is 1.0.3 btw)
&gt;&gt; 4. Started the riak node
&gt;&gt; 5. Done some simple operations (get and save of objects) and I was able
&gt;&gt; to see the object being dumped to the console.log file.
&gt;&gt;
&gt;&gt; For the failing scenario:
&gt;&gt; 1. Changed the function a bit in order to call an inexistent function
&gt;&gt;
&gt;&gt; \\*-module(post\\_commit\\_hooks).\\*
&gt;&gt; \\*
&gt;&gt; \\*
&gt;&gt; \\*-export([log/1]).\\*
&gt;&gt; \\*
&gt;&gt; \\*
&gt;&gt; \\*log(Object) -&gt;\\*
&gt;&gt; \\* error\\_loggerrrrr:info\\_msg("OBJECT: ~p~n",[Object]).\\*
&gt;&gt;
&gt;&gt; 2. Stop riak
&gt;&gt; 3. Enabled sasl logging {sasl,[{error\\_logger\\_mf\\_maxfiles,
&gt;&gt; 5},{sasl\\_error\\_logger, {file,
&gt;&gt; "/Users/alin/riak/log/sasl-error.log"}},{error\\_logger\\_mf\\_maxbytes,
&gt;&gt; 10485760},{errorlog\\_type, error},{error\\_logger\\_mf\\_dir,
&gt;&gt; "/Users/alin/riak/log"}]}
&gt;&gt; 4. Recompile the file, using the same erts version
&gt;&gt; 5. Start riak
&gt;&gt; 6. Read and save of the riak objects, but this time, can't see any error
&gt;&gt; to the log files (especially sasl-error.log, as basho's wiki is suggesting
&gt;&gt; [1], even though I can see different kind of messages to sasl-error.log
&gt;&gt; that are not related to the failing execution).
&gt;&gt;
&gt;&gt; Is it something that I'm missing, or is this a bug ?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; Alin
&gt;&gt;
&gt;&gt; [1] http://wiki.basho.com/Commit-Hooks.html
&gt;
