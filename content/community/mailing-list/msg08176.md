---
title: "Re: riak-erlang-client search changes"
description: ""
project: community
lastmod: 2012-08-03T08:18:04-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08176"
mailinglist_parent_id: "msg08170"
author_name: "Dave Parfitt"
project_section: "mailinglistitem"
sent_date: 2012-08-03T08:18:04-07:00
---


Hello -
 
Instead of returning a tuple for Riak Search results, we'll return a record 
instead:

-record(search\\_results, {
 docs :: [search\\_doc()], %% Result documents
 max\\_score :: float(), %% Maximum score
 num\\_found :: non\\_neg\\_integer() %% Number of results
 }).

Cheers -
Dave

On Aug 2, 2012, at 11:08 PM, Andrew Berman wrote:

&gt; The more fields the better. I like this change.
&gt; 
&gt; Andrew
&gt; 
&gt; On Aug 2, 2012 8:17 AM, "Dave Parfitt"  wrote:
&gt; Hello -
&gt; We're considering some changes to the Riak Search functionality in 
&gt; riak-erlang-client for the upcoming Riak 1.2 release. The current behavior of 
&gt; the riakc\\_pb\\_socket:search/\\* functions return a list in the form: [[Index, 
&gt; Id],[Index2,Id2],...]
&gt; 
&gt; With the new Riak Search protobuffs messages, we have the ability to also 
&gt; return fields from the search doc in the results (as additional values in the 
&gt; tuple). Also, it's possible to return the search results "max score", and 
&gt; "number found". Does anyone have any objections to returning additional 
&gt; fields? To maintain semi-compatible behavior, it's possible to use the fl 
&gt; (field limit) search option to just return the id.
&gt; 
&gt; Current behavior:
&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"phrases\\_custom"&gt;&gt;, &lt;&lt;"phrase:fox"&gt;&gt;). 
&gt; 
&gt; {ok,[[&lt;&lt;"phrases\\_custom"&gt;&gt;,&lt;&lt;"5"&gt;&gt;],
&gt; [&lt;&lt;"phrases\\_custom"&gt;&gt;,&lt;&lt;"1"&gt;&gt;]]}
&gt; 
&gt; Proposed behavior:
&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"phrases\\_custom"&gt;&gt;, &lt;&lt;"phrase:fox"&gt;&gt;).
&gt; {ok,[{&lt;&lt;"phrases\\_custom"&gt;&gt;,
&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"1"&gt;&gt;}, 
&gt; {&lt;&lt;"phrase"&gt;&gt;,&lt;&lt;"The quick brown fox jumps over the lazy dog"&gt;&gt;}],
&gt; {&lt;&lt;"phrases\\_custom"&gt;&gt;,
&gt; [{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"5"&gt;&gt;},
&gt; {&lt;&lt;"phrase"&gt;&gt;,&lt;&lt;"The quick brown fox jumps over the lazy dog"&gt;&gt;}],
&gt; 0.0,2}
&gt; %% Note the last two fields of the result are Max Score and Number Found.
&gt; 
&gt; Semi-compatible behavior by specifying the fl (with the exception of max 
&gt; score and number found):
&gt; riakc\\_pb\\_socket:search(Pid, &lt;&lt;"phrases\\_custom"&gt;&gt;, &lt;&lt;"phrase:fox"&gt;&gt;, 
&gt; [{fl,[&lt;&lt;"id"&gt;&gt;]}], 5000, 5000).
&gt; {ok,[{&lt;&lt;"phrases\\_custom"&gt;&gt;,[{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"1"&gt;&gt;}]},
&gt; {&lt;&lt;"phrases\\_custom"&gt;&gt;,[{&lt;&lt;"id"&gt;&gt;,&lt;&lt;"5"&gt;&gt;}]},
&gt; 0.0,2}
&gt; 
&gt; Cheers -
&gt; Dave
&gt; 
&gt; 
&gt; 
 

