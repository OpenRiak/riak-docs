---
title: "Erlang MR bulk fetch"
description: ""
project: community
lastmod: 2012-12-02T17:27:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09417"
author_name: "Elias Levy"
project_section: "mailinglistitem"
sent_date: 2012-12-02T17:27:20-08:00
---


While processing a request I am finding that I am spending most of my time
fetching data from Riak. As I am using the Ruby client I can't
parallelisethem, as it does not support non-blocking IO and I don't
want to spawn many
threads.

For these requests I am willing to accept an R of 1, so I can use a MR job
as a bulk fetch, but I would prefer to avoid the JS VM, as its rather slow
and I don't want to worry about running out of VMs at the wrong time.

I can easily fetch the values using only Erlang MR by adding the keys to my
MR object and doing

 map(["riak\\_kv\\_mapreduce", "map\\_object\\_value"], :arg =&gt; [ true ], :keep
=&gt; true).

but this gives me an array of values. I need to to know the which values
are associated with what key, and my values do not include the key or
otherwise allow me to map them.

&gt;From looking at the Riak code there does not seem to exist an exported
Erlang map function that will return a value with its key.

Did I miss one? Is such a function somewhere in the source? If not,
anyone have one handy they'd like to share?
