---
title: "Re: Riak Search on KV data in erlang terms"
description: ""
project: community
lastmod: 2013-01-22T21:21:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09874"
mailinglist_parent_id: "msg09869"
author_name: "Ryan Zezeski"
project_section: "mailinglistitem"
sent_date: 2013-01-22T21:21:37-08:00
---


Takeshi,

The erlang extractors don't work when writing the data via HTTP as they
store the data as a binary. I.e. [{"name", "bob"}] becomes &lt;&lt;"[{\\"name\\",
\\"bob\\"}]"&gt;&gt; instead of the proplist you expect. This is because the
extractor assumes the object data is already properly decoded. It is
possible to write erlang terms via the erlang client, but I wouldn't
recommend it as it is not the common case and I feel like there are other
issues lurking in Riak if you do this. If there a particular reason you
are trying to store erlang terms? Are you worried about space? I would
just stick with JSON or XML if that is acceptable.

-Z


On Tue, Jan 22, 2013 at 10:15 AM, Takeshi Matsumura
wrote:

&gt; Hi,
&gt;
&gt; I tried to store erlang data and query them by using the Riak Search
&gt; without success so far, and thus would like to ask if I'm doing the right
&gt; thing. Riak Search was enabled in the app.config file and the server was
&gt; restarted. The pre-commit hook was installed from the command line.
&gt;
&gt; bin/search-cmd install mybucket
&gt;
&gt; The erlang data that I uploaded is a proplists with a single pair of key
&gt; and value.
&gt;
&gt; [{"name", "bob"}]
&gt;
&gt; It was uploaded by using the curl command with Content-Type
&gt; "application/x-erlang". (hoge.erl.txt contains the above erlang terms).
&gt;
&gt; curl -v -d @hoge.erl.txt -X PUT -H "content-type: application/x-erlang" "
&gt; http://localhost:8098/riak/mybucket/bob"
&gt;
&gt; I could get the document by issuing curl command to
&gt; "/riak/mybucket/bob". The HTTP response header contained the correct
&gt; Content-Type, "application/x-erlang".
&gt;
&gt; Then I run the Riak Search from the command line.
&gt;
&gt; bin/search-cmd search mybucket "name:bob"
&gt;
&gt; Unfortunately, the result said "Found 0 results".
&gt;
&gt; As I wondered if this is a problem related to the erlang terms, I tried
&gt; the same with a JSON data that is found in the "Indexing and Querying KV
&gt; Data" page but setting "application/json" to the Content-type.
&gt;
&gt; {
&gt; "name":"Alyssa P. Hacker",
&gt; "bio":"I'm an engineer, making awesome things.",
&gt; "favorites":{
&gt; "book":"The Moon is a Harsh Mistress",
&gt; "album":"Magical Mystery Tour"
&gt; }
&gt; }
&gt;
&gt;
&gt; Then the Riak Search could find this document with the query
&gt; "name:Alyssa\\*".
&gt;
&gt; According to the "Indexing and Querying KV Data" page of the Riak
&gt; document, erlang terms can be queried by using the Riak Search. However, it
&gt; is unclear to me if it is enabled by default because the page says XML,
&gt; JSON, and plain-text encodings are supported out of the box but it doesn't
&gt; mention the erlang terms.
&gt;
&gt; I followed the "Other Data Encodings" section and set the
&gt; "riak\\_search\\_kv\\_erlang\\_extractor" module, but it didm't change the
&gt; situation.
&gt;
&gt; curl -XPUT -H 'content-type: application/json' \\
&gt; http://localhost:8098/riak/mybucket \\
&gt; -d 
&gt; '{"props":{"search\\_extractor":{"mod":"riak\\_search\\_kv\\_erlang\\_extractor", 
&gt; "fun":"extract", "arg":"my\\_arg"}}}'
&gt;
&gt;
&gt; I changed the data as follows and uploaded but it didn't help either.
&gt;
&gt; [{&lt;&lt;"name"&gt;&gt;, &lt;&lt;"bob"&gt;&gt;}]
&gt;
&gt; I appreciate any hints for me to go forward. Thank you in advance.
&gt;
&gt; Best regards,
&gt; Takeshi
&gt;
&gt;
&gt;

