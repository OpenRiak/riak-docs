---
title: "Re: tuning riak for 100s of concurrent connections"
description: ""
project: community
lastmod: 2011-02-25T11:59:37-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02475"
author_name: "Wilson MacGyver"
project_section: "mailinglistitem"
sent_date: 2011-02-25T11:59:37-08:00
---


was this over http GET or protocol buffer?

idid you per chance run the test using apachebench also?

On Fri, Feb 25, 2011 at 2:43 PM, Nico Meyer  wrote:
&gt; Just out of curiosity I did some tests myself on one of our production
&gt; machines. We normally only use the ProtocolBuffers interface and a
&gt; thrift interface that we wrote ourselves.
&gt;
&gt; If I fetch a small key (~250 bytes), the riak server becomes CPU bound
&gt; with about 20 concurrent requests, at which point the latency naturally
&gt; becomes larger. At this point one riak server is handling over 6000
&gt; requests/s. This is on an 8 core system (Dual Intel Xeon E5506
&gt; @2.13GHz), and all cores are at nearly 100%. No tuning was done on
&gt; either riak or the OS.
&gt;
&gt; Also 99% of the requests still took less then 20ms, while with 10
&gt; concurrent requests its more like 2ms.
&gt;
&gt;
&gt; Am Freitag, den 25.02.2011, 13:54 -0500 schrieb Wilson MacGyver:
&gt;&gt; SO\\_REUSEADDR is also something you set at the socket API as I recall.
&gt;&gt; So I don't think it's something you can just set on the TCP/IP itself
&gt;&gt; as a global setting.
&gt;&gt;
&gt;&gt; On Fri, Feb 25, 2011 at 1:41 PM, Les Mikesell  wrote:
&gt;&gt; &gt; Those settings shouldn't make a big difference in how the number of
&gt;&gt; &gt; connections scale up, though.  There is a theoretical maximum rate limit 
&gt;&gt; &gt; for
&gt;&gt; &gt; creating new connections as each socket is supposed to sit in TIME\\_WAIT for
&gt;&gt; &gt; a packet round-trip time to ensure that nothing outstanding will collide
&gt;&gt; &gt; with that socket number when it is reused for the same IP address.  Maybe
&gt;&gt; &gt; your test is hitting that limit.  Can you set SO\\_REUSEADDR?
&gt;&gt;
&gt;&gt;
&gt;
&gt;
&gt;



-- 
Omnem crede diem tibi diluxisse supremum.

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

