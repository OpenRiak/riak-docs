---
title: "Re: PBS: Better understanding latency vs. consistency trade-offs in	Riak"
description: ""
project: community
lastmod: 2012-01-30T12:36:53-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06464"
mailinglist_parent_id: "msg06460"
author_name: "Peter Bailis"
project_section: "mailinglistitem"
sent_date: 2012-01-30T12:36:53-08:00
---


Dave,

Thanks for the follow-up!

For PBS, we need four latency distributions.

For writes:
--Time from write coordinator to replica plus replica write processing time
(W): How long does it take from the time the coordinator sends out a write
request to the time the replica starts serving that write?
--Time from replica to write coordinator (A): How long do write
acknowledgements take to be delivered to the coordinator?

For reads:
--Time from read coordinator to replica and time for replica to read
corresponding value from its local store (R)
--Time from replica to read coordinator (S): How long do a read responses
take to be delivered?

W and R are a function of network delay and local processing time, while A
and S should be mostly network delay. It's best to know these
distributions for each of the N ordered responses (e.g., {the first, the
second, ..., the nth} for each of {W,A,R,S}), but it's not strictly
necessary. Does that make sense?

Once you have (empirical) distributions, it's easy to calculate the
probability of staleness (see a simple implementation, calc\\_prob\\_fresh @
https://github.com/pbailis/cassandra-pbs/blob/trunk/pbs/pbs\\_utils.py).

Thanks!
Peter

On Mon, Jan 30, 2012 at 10:29 AM, David Smith  wrote:

&gt; Hi Peter,
&gt;
&gt; Thanks for the email re: PBS -- it's quite interesting stuff.
&gt;
&gt; On Thu, Jan 19, 2012 at 6:03 PM, Peter Bailis 
&gt; wrote:
&gt; &gt;
&gt; &gt; Thus far, in addition to general Dynamo-style replication analysis, we've
&gt; &gt; developed a patch for Cassandra that performs the required latency
&gt; profiling
&gt; &gt; and are interested in potentially working to integrate PBS analysis into
&gt; &gt; additional data stores like Riak, which can also benefit from PBS
&gt; analysis
&gt;
&gt; Can you describe the class of changes you had to make to Cassandra to
&gt; gather the information? We already track a fair bit of latency
&gt; information across percentiles -- are there any other inputs you need?
&gt;
&gt; Thanks,
&gt;
&gt; D.
&gt;
&gt; --
&gt; Dave Smith
&gt; Director, Engineering
&gt; Basho Technologies, Inc.
&gt; diz...@basho.com
&gt;
