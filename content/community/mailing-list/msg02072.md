---
title: "Re: Getting all the Keys"
description: ""
project: community
lastmod: 2011-01-22T19:17:20-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02072"
mailinglist_parent_id: "msg02065"
author_name: "Jeremiah Peschka"
project_section: "mailinglistitem"
sent_date: 2011-01-22T19:17:20-08:00
---


If you ever want to think about putting indexes in Riak, I played a little
thought game and wrote it out on my blog:
http://facility9.com/2010/12/16/secondary-indexes-how-would-you-do-it


Otherwise - reverse indexes/roll you own b-tree. As an aside, thanks for
asking your questions, it prompted me to think and go look at some code to
see if I could figure out the answers before someone else came up with them.
I failed, but it was fun. :)

Jeremiah Peschka


On Sat, Jan 22, 2011 at 9:46 PM, Thomas Burdick  wrote:

&gt; I mistakenly didn't send a reply to the whole list, but given what everyone
&gt; is saying I think I "get it" now and the reasoning.
&gt;
&gt; Given all of that it seems pretty clear that if I wanted to do what I'm
&gt; talking about purely in the context of riak using links might work or a
&gt; bucket containing keys and values that represent a data structure like a
&gt; list or btree might work. But either way I guess its up to me if I want to
&gt; make a index/faster method of traversal of keys. Thats fine, I accept thats
&gt; the cost of using a dynamo database for now :-)
&gt;
&gt; Thanks for all the insights and comments.
&gt;
&gt; Cheers,
&gt; Tom Burdick
&gt;
&gt;
&gt; On Sat, Jan 22, 2011 at 7:22 PM, Sean Cribbs  wrote:
&gt;
&gt;&gt; On Jan 22, 2011, at 4:15 PM, Thomas Burdick wrote:
&gt;&gt;
&gt;&gt; &gt; \\* Why is key listing so slow?
&gt;&gt;
&gt;&gt; It is slow because, even if the keys are in RAM, you have to scan roughly
&gt;&gt; all of the keys in the cluster to get a listing for a single bucket. As a
&gt;&gt; certain person is fond of saying, "full table scan is full table scan".
&gt;&gt; There are ways to improve this, but without single-arbiters of state (and
&gt;&gt; points of failure) it is very costly.
&gt;&gt;
&gt;&gt; &gt; \\* What do people do in the context of purely using riak to do what I
&gt;&gt; want, have a big set of keys to iterate over?
&gt;&gt;
&gt;&gt; As others have said so eloquently, they don't, they use something else. Or
&gt;&gt; they try to minimize how frequently they do it. Part of the current
&gt;&gt; revolution in data storage is about realizing that no one tool is going to
&gt;&gt; completely fit your needs, and that that's good and right. Anyone who tells
&gt;&gt; you otherwise is selling you a bill of goods.
&gt;&gt;
&gt;&gt; To understand why listing keys is difficult, you have to understand Riak's
&gt;&gt; (and Dynamo's) original design motivations:
&gt;&gt;
&gt;&gt; \\* To be basically available at all times for reads and writes, which in
&gt;&gt; turn means to be tolerant of machine and network failures.
&gt;&gt; \\* To provide low-latency random access to large data sets. (Note I didn't
&gt;&gt; say an entire data set.)
&gt;&gt; \\* To scale linearly with minimal operational complexity.
&gt;&gt;
&gt;&gt; Everything has tradeoffs - these are the ones we chose with Riak. Now, we
&gt;&gt; (Basho) are actively trying to create ways to make discovering your data
&gt;&gt; easier (key-filters are one of them, as Justin mentioned we're discussing
&gt;&gt; counters and indices), but the majority of people who use Riak have ways of
&gt;&gt; discovering or knowing keys ahead of time. If that's not your case, you
&gt;&gt; should look into other solutions; some good ones have been mentioned in this
&gt;&gt; thread. That said, we hear your pain and are working hard to improve
&gt;&gt; usability while maintaining the properties discussed above.
&gt;&gt;
&gt;&gt; Cheers,
&gt;&gt;
&gt;&gt; Sean Cribbs 
&gt;&gt; Developer Advocate
&gt;&gt; Basho Technologies, Inc.
&gt;&gt; http://basho.com/
&gt;&gt;
&gt;&gt;
&gt;

