---
title: "Riak Search pre-commit hook"
description: ""
project: community
lastmod: 2012-08-08T11:56:11-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08229"
author_name: "Mark Volkmann"
project_section: "mailinglistitem"
sent_date: 2012-08-08T11:56:11-07:00
---


I'm trying to learn how to configure Riak Search to automatically index
documents added to a given bucket. I have four nodes in my cluster. Here is
what I tried:

\\* modified etc/app.config for each node to set {enabled, true} in the
riak\\_search section
\\* stopped and restarted the cluster
\\* cd'ed to the bin directory of the first node in the cluster and entered
"./search-cmd install users"
\\* entered "curl http://localhost:8091/riak/users" to verify that the
pre-commit hook was added
I see this in the middle of the output:
"precommit": [
 {
 "mod": "riak\\_search\\_kv\\_hook",
 "fun": "precommit"
 }
 ],
\\* added a document to the users bucket with this command:
curl -XPUT http://localhost:8091/buckets/users/keys/1234 -H 'Content-type:
application/json' -d '{name: "Joe", address: {street: "123 Some Street",
zip: 12345}}'

The output is below. Notice the "hook\\_crashed" part.

500 Internal Server
ErrorInternal Server Error
=====================

The server
encountered an error while processing this request:  

```
{error,
    {error,badarg,
        [{erlang,iolist_to_binary,
             [{hook_crashed,
                  {riak_search_kv_hook,precommit,error,function_clause}}],
             []},
         {wrq,append_to_response_body,2,[{file,"src/wrq.erl"},{line,204}]},
         {riak_kv_wm_object,handle_common_error,3,
             [{file,"src/riak_kv_wm_object.erl"},{line,974}]},
         {webmachine_resource,resource_call,3,
             [{file,"src/webmachine_resource.erl"},{line,169}]},
         {webmachine_resource,do,3,
             [{file,"src/webmachine_resource.erl"},{line,128}]},
         {webmachine_decision_core,resource_call,1,
             [{file,"src/webmachine_decision_core.erl"},{line,48}]},
         {webmachine_decision_core,accept_helper,0,
             [{file,"src/webmachine_decision_core.erl"},{line,583}]},
         {webmachine_decision_core,decision,1,

 
[{file,"src/webmachine_decision_core.erl"},{line,554}]}]}}
```


---

mochiweb+webmachine
web server

What am I doing wrong?

-- 
R. Mark Volkmann
Object Computing, Inc.
