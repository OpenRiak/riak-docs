---
title: "Re: Evolving data model"
description: ""
project: community
lastmod: 2012-09-19T14:44:53-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08600"
mailinglist_parent_id: "msg08589"
author_name: "Bip Thelin"
project_section: "mailinglistitem"
sent_date: 2012-09-19T14:44:53-07:00
---


We use a technique that works well for our use case:
We store everything as JSON and use the erlang-client, for every object we 
store we add an opaque schema\\_version tag to the JSON and then in our model 
encode/decode routine we parse this schema\\_version and if the version is not 
the latest according to the model we recurse and upgrade the payload all the 
way up to the current version and then return the new object to the client and 
spawn an async process that saves the new object back.

So for instance an object is at schema\\_version 1 when it get's read. The model 
is now on version 5 there will be five functions, i.e:
upgrade\\_version(2, Payload) -&gt;
 do\\_something();
upgrade\\_version(3, Payload) -&gt;
 etc...

every function knows how to upgrade itself from it's former version so fast 
forwarding through version is easy and every object will get upgraded 
eventually (if the get read).

--
Bip Thelin
 
KIVRA | Lugnets All√© 1 | 120 33 Stockholm
Tel 08-533 335 37 | Mob 0735-18 18 90
www.kivra.com


On 19 sep 2012, at 00:55, Allen Johnson  wrote:

&gt; Hey everyone,
&gt; 
&gt; I'm beginning to experiment with Riak and I'm trying to better
&gt; understand how to model my data. One question I have at the moment is
&gt; how to evolve my data with a data store such as Riak? I know that
&gt; it's schema-less and that I can add new fields as needed but I'm
&gt; thinking more about the existing documents.
&gt; 
&gt; For example, say hypothetically, that I have a fairly successful
&gt; riak-based app. As the application code continues to evolve over
&gt; several versions I begin to find a "better" way to model my data. By
&gt; this time I have already stored many, many documents. What is the
&gt; appropriate path here? Do I version my documents with metadata and
&gt; rely on my application code to continue to deal with old-style
&gt; documents -- or do I perform some sort of bulk transformation on these
&gt; existing documents?
&gt; 
&gt; Thanks,
&gt; Allen
&gt; 

