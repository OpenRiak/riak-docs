---
title: "Re: Python transports"
description: ""
project: community
lastmod: 2011-09-08T10:47:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04629"
mailinglist_parent_id: "msg04620"
author_name: "Brett Hoerner"
project_section: "mailinglistitem"
sent_date: 2011-09-08T10:47:46-07:00
---


I own the pull request that adds (very basic) pooling logic to the
Riak client. I left Transports alone (each is a single connection) and
decided to have pools be another class you pick just like transport.
This allows you instantly use any pooling logic (never remove down
servers, delete down servers, round robin, whatever) with \\*any\\*
transport class: Http, Http keep-alive, PBC, CachedPBC, etc.

I've added pooling and timeouts and use both in production because I'm
honestly not sure how you use Riak in a highly available way without
them... so we need to make sure they both work well/easily under this
new scheme.

Do your changes make anything new possible or are they just about cleanup?

On Thu, Sep 8, 2011 at 5:17 AM, Greg Stein  wrote:
&gt; Yup, agreed. I can certainly see use-cases where a client may have
&gt; particular knowledge about data/server locality, and wants to open
&gt; connections to \\*just\\* those servers. The transports that I am
&gt; advocating open connections to servers described by one layer higher.
&gt; That layer could say "all Riak servers in the cluster", or it could
&gt; say "these three servers holding copies of  data".
&gt;
&gt; An auto-discovery layer (to add and remove) in-between the client and
&gt; the transport would be handy. I can envision that, and my proposed
&gt; code makes it possible, but (at my current stage) I don't have a use
&gt; for it. I'd hope that others can build on my connection pooling work
&gt; to see that through.
&gt;
&gt; Cheers,
&gt; -g
&gt;
&gt; On Thu, Sep 8, 2011 at 07:49, Phil Stanhope  wrote:
&gt;&gt; I like the idea of RiakTransport as you describe it. It opens the door to
&gt;&gt; other potential underlying transports and isolating a client from knowledge
&gt;&gt; of those (websockets, tcp, zeromq messaging come to mind). I'm not
&gt;&gt; suggesting that RIAK will ever support these transports by this comment,
&gt;&gt; however.
&gt;&gt; I also agree with the need to have RiakRingAwareTransport as an additional
&gt;&gt; layer that \\*might\\* be used by a client. There may be valid reasons why a
&gt;&gt; client might want to force particular traffic onto a subset of the ring
&gt;&gt; (e.g. M/R config, Search Config, forcing read/write traffic onto different
&gt;&gt; nodes, etc). Again, I'm not suggesting that using a subset of the ring for
&gt;&gt; particular operations is the best practice. But it may be necessary to do so
&gt;&gt; in order to validate and do certain types of testing to prove or disprove
&gt;&gt; certain access patterns.
&gt;&gt; -phil
&gt;&gt;
&gt;&gt; On Thu, Sep 8, 2011 at 7:31 AM, Greg Stein  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hey, all...
&gt;&gt;&gt;
&gt;&gt;&gt; After a couple comments on my recent work, and some archaeology on the
&gt;&gt;&gt; Python/Riak work over the past month... I've realized that I might
&gt;&gt;&gt; have a very different view of RiakTransport compared to what I'm
&gt;&gt;&gt; seeing in the current work. I figured it best to bring that to the
&gt;&gt;&gt; forefront and discuss:
&gt;&gt;&gt;
&gt;&gt;&gt; In my view, RiakTransport is used by RiakClient (and others) to "talk
&gt;&gt;&gt; to the Riak server".
&gt;&gt;&gt;
&gt;&gt;&gt; Some of the current work, and some proposed pull requests, seem to
&gt;&gt;&gt; take the position that a RiakTransport is "one connection to a server,
&gt;&gt;&gt; and the client should manage those".
&gt;&gt;&gt;
&gt;&gt;&gt; Needless to say, I'm in favor of my own position :-) ... I think it is
&gt;&gt;&gt; best to transfer \\*all\\* responsibility for talking to the server(s) to
&gt;&gt;&gt; the transport layer. I really don't think the client/bucket/object
&gt;&gt;&gt; layers should know anything about talking to the server(s). I'd like
&gt;&gt;&gt; to see the transport layer be told about all server(s) available, and
&gt;&gt;&gt; then it Just Works.
&gt;&gt;&gt;
&gt;&gt;&gt; I'm still a newbie with all this code, and need to keep plugging away
&gt;&gt;&gt; at the higher levels of functionality and compensation for problems.
&gt;&gt;&gt; I'd like to build up some code that contacts \\*one\\* given server, asks
&gt;&gt;&gt; for all of the ring servers, and then opens connections to those
&gt;&gt;&gt; servers. And then, it should (automatically) maintain client
&gt;&gt;&gt; connections based on what is happening with the Riak cluster. The
&gt;&gt;&gt; current (proposed) code manages connections to N servers, but has no
&gt;&gt;&gt; automatic add/remove based on changes in the cluster status. I think
&gt;&gt;&gt; this happens at a layer \\*just\\* above the actual transport. ie.
&gt;&gt;&gt; something tracks the changes in the ring status and its servers, and
&gt;&gt;&gt; transmits those changes into the transport layer, which alters its
&gt;&gt;&gt; communication with that cluster (regardless of whether that
&gt;&gt;&gt; communication is via HTTP or protobuf).
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Okee doke. That's the end of my brain dump and future thoughts on the
&gt;&gt;&gt; transport and communication layer. I'd really like some feedback,
&gt;&gt;&gt; review, and thoughts.
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks!
&gt;&gt;&gt; -g
&gt;&gt;&gt;

&gt;&gt;
&gt;&gt;
&gt;
