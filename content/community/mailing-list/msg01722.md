---
title: "Re: Problem with fast track"
description: ""
project: community
lastmod: 2010-12-05T07:44:06-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01722"
mailinglist_parent_id: "msg01721"
author_name: "David Smith"
project_section: "mailinglistitem"
sent_date: 2010-12-05T07:44:06-08:00
---


The specific bug was introduced here (line 298 or so):

https://github.com/basho/riak\\_kv/commit/016c62efade1ec5cd663ff01ef6ec0e92e31b1d9

I inadvertently changed a literal while reworking the patch. The Right
Fix (tm) should have been to use the constants in riak\\_kv\\_wm\\_raw.hrl
to avoid this specific type of bug. I'll open a bug later today and
correct this problem.

My apologies for the inconvenience.

D.

On Sun, Dec 5, 2010 at 8:31 AM, David Smith  wrote:
&gt; This bug appears to be related to some recently landed enhancements to
&gt; ETags generation in webmachine. I'll take a closer look later today.
&gt;
&gt; Thanks,
&gt;
&gt; D.
&gt;
&gt; On Sat, Dec 4, 2010 at 10:18 PM, Bryan Nagle
&gt;  wrote:
&gt;&gt; I re-did my installation from the tarball instead of git, and your right,
&gt;&gt; its now working perfectly.  Thank you for the quick response.
&gt;&gt; Bryan Nagle
&gt;&gt; Liquid Analytics
&gt;&gt; bryan.na...@liquidanalytics.com
&gt;&gt;
&gt;&gt;
&gt;&gt; On Sat, Dec 4, 2010 at 11:55 PM, Sean Cribbs  wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; This is a bug that was introduced recently. Try using the source tarball
&gt;&gt;&gt; for now ( http://downloads.basho.com/riak/riak-0.13/riak-0.13.0.tar.gz ),
&gt;&gt;&gt; we'll fix this before 0.14 is released.
&gt;&gt;&gt;
&gt;&gt;&gt; Sean Cribbs 
&gt;&gt;&gt; Developer Advocate
&gt;&gt;&gt; Basho Technologies, Inc.
&gt;&gt;&gt; http://basho.com/
&gt;&gt;&gt; On Dec 4, 2010, at 11:41 PM, Bryan Nagle wrote:
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt; I am new to Riak, and am trying to go through the fast track
&gt;&gt;&gt; get familiar with it.  However, I am running into a specific problem that I
&gt;&gt;&gt; have not been able to find a solution for.  I am trying this on two separate
&gt;&gt;&gt; machines, both running ubuntu 10.04 64, and am having the exact same issue
&gt;&gt;&gt; on both.  I am following the fast track to the letter, and I have started
&gt;&gt;&gt; over from scratch on my riak checkout (stop nodes, rm -rf riak, git clone)
&gt;&gt;&gt; multiple times.  I am currently stuck on this page:
&gt;&gt;&gt;  https://wiki.basho.com/display/RIAK/Building+a+Development+Environment
&gt;&gt;&gt; From the stats:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; "ring\\_ownership":
&gt;&gt;&gt;&gt; "[{'d...@127.0.0.1',21},{'d...@127.0.0.1',21},{'d...@127.0.0.1',22}]"
&gt;&gt;&gt;
&gt;&gt;&gt; First I run:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ curl -v -X PUT HTTP://127.0.0.1:8091/riak/images/1.jpg -H
&gt;&gt;&gt;&gt; "Content-type: image/jpeg" --data-binary @temp.jpg
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\* About to connect() to 127.0.0.1 port 8091 (#0)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\*   Trying 127.0.0.1... connected
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\* Connected to 127.0.0.1 (127.0.0.1) port 8091 (#0)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; PUT /riak/images/1.jpg HTTP/1.1
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; User-Agent: curl/7.19.7 (x86\\_64-pc-linux-gnu) libcurl/7.19.7
&gt;&gt;&gt;&gt; &gt; OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; Host: 127.0.0.1:8091
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; Accept: \\*/\\*
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; Content-type: image/jpeg
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; Content-Length: 5389
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt; Expect: 100-continue
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt; HTTP/1.1 100 Continue
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt; HTTP/1.1 204 No Content
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt; Vary: Accept-Encoding
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt; Server: MochiWeb/1.1 WebMachine/1.7.3 (participate in the frantic)
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt; Date: Sun, 05 Dec 2010 04:32:58 GMT
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt; Content-Type: image/jpeg
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt; Content-Length: 0
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; &lt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\* Connection #0 to host 127.0.0.1 left intact
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; \\* Closing connection #0
&gt;&gt;&gt;
&gt;&gt;&gt; This does not return any errors, so I am assuming it is succeeding.
&gt;&gt;&gt; I then attempt to get this image back - either from a web browser, or from
&gt;&gt;&gt; curl, and I'm getting:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; $ curl HTTP://127.0.0.1:8091/riak/images/1.jpg
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; 500 Internal Server
&gt;&gt;&gt;&gt; ErrorInternal Server Error
=====================

The server
&gt;&gt;&gt;&gt; encountered an error while processing this
&gt;&gt;&gt;&gt; request:  

```
[{webmachine_util,escape_quotes,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;      [{error,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;           {error,badarg,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;               [{dict,fetch,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                    [&lt;&lt;"X-Riak-VTag"&gt;&gt;,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                     {dict,5,16,16,8,80,48,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                         {{[],[],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                           [[&lt;&lt;"Links"&gt;&gt;]],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                           [],[],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  [[&lt;&lt;"X-Riak-Tag"&gt;&gt;,50,100,74,65,99,120,88,114,71,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  119,69,51,55,115,102,56,55,82,82,66,101,109]],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                           [],[],[],[],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  [[&lt;&lt;"content-type"&gt;&gt;,105,109,97,103,101,47,106,112,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                             101,103]],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                           [],[],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  [[&lt;&lt;"X-Riak-Last-Modified"&gt;&gt;|{1291,523577,973790}]],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                           [],
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                           [[&lt;&lt;"X-Riak-Meta"&gt;&gt;]]}}}]},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                {riak_kv_wm_raw,generate_etag,2},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                {webmachine_resource,resource_call,3},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                {webmachine_resource,do,3},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                {webmachine_decision_core,resource_call,1},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                {webmachine_decision_core,decision,1},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                {webmachine_decision_core,handle_request,2},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;                {webmachine_mochiweb,loop,1}]}},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;       "\\""]},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  {webmachine_decision_core,decision,1},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  {webmachine_decision_core,handle_request,2},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  {webmachine_mochiweb,loop,1},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  {mochiweb_http,headers,5},
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;  {proc_lib,init_p_do_apply,3}]
```


---

mochiweb+webmachine
&gt;&gt;&gt;&gt; web server


&gt;&gt;&gt;
&gt;&gt;&gt; I have also tried uploading json.  If I add "returnbody=true" to the url,
&gt;&gt;&gt; I see the json body displayed at the end of the curl put command. However,
&gt;&gt;&gt; when I try to access it afterwards, I get the exact same error as above.  If
&gt;&gt;&gt; anyone has any ideas about what is going on, I would greatly appreciate it.
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt; Bryan Nagle
&gt;&gt;&gt; Liquid Analytics
&gt;&gt;&gt; bryan.na...@liquidanalytics.com

&gt;&gt;&gt;
&gt;&gt;
&gt;

