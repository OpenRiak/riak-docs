---
title: "Re: Riak MR returns JSON Object on occasion"
description: ""
project: community
lastmod: 2012-12-19T12:04:09-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09635"
mailinglist_parent_id: "msg09634"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2012-12-19T12:04:09-08:00
---


It looks like mochijson2 has an assumption that anything that looks
like a proplist (a list of 2-tuples) gets turned into a hash.

7&gt; list\\_to\\_binary(mochijson2:encode([{a , b}, {foo, bar}])).
&lt;&lt;"{\\"a\\":\\"b\\",\\"foo\\":\\"bar\\"}"&gt;&gt;

This is likely something that should be documented, but it doesn't
seem fixable, at least on the MR side, as JSON has no 'tuple' notion.
A workaround for the time being would be to use a list of length-2
lists.

Clients should probably not explode on seeing this.

On Wed, Dec 19, 2012 at 2:36 PM, Elias Levy  wrote:
&gt; Resending as I did not get a response from Basho folks.
&gt;
&gt; Is this expected behavior?
&gt;
&gt;
&gt;
&gt; On Fri, Dec 14, 2012 at 5:08 PM, Elias Levy 
&gt; wrote:
&gt;&gt;
&gt;&gt; It appears that the Riak MR API can on occasions return a JSON Object,
&gt;&gt; rather than an Array. This blows up the Ruby client, and I am guessing
&gt;&gt; probably some other ones. I've opened an issue for the Ruby client. See
&gt;&gt; https://github.com/basho/riak-ruby-client/issues/67.
&gt;&gt;
&gt;&gt; I came across the issue while writing an Erlang map phase function to bulk
&gt;&gt; fetch values while returning their key. The function is:
&gt;&gt;
&gt;&gt; map\\_object\\_key\\_value({error, notfound}, \\_, \\_) -&gt; [];
&gt;&gt; map\\_object\\_key\\_value(RiakObject, \\_, \\_) -&gt;
&gt;&gt; [{ riak\\_object:key(RiakObject), riak\\_object:get\\_value(RiakObject) }].
&gt;&gt;
&gt;&gt; It appears that Riak (or mochijson2?) will convert an array of 2 tuples
&gt;&gt; into a JSON hash when returning the data.
&gt;&gt;
&gt;&gt; This is actually quite nice, at least for this application, as its exactly
&gt;&gt; what I want, but it seems is either undocumented or a bug, since clients do
&gt;&gt; not respond well to it.
&gt;&gt;
&gt;&gt; Thoughts?
&gt;&gt;
&gt;&gt; Elias Levy
&gt;
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

