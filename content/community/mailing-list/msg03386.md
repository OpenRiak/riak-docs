---
title: "Re: Error when trying to use a javascript custom extractor in	Riaksearch"
description: ""
project: community
lastmod: 2011-05-22T14:54:06-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03386"
mailinglist_parent_id: "msg03385"
author_name: "Greg Pascale"
project_section: "mailinglistitem"
sent_date: 2011-05-22T14:54:06-07:00
---


Yes that's the reference I've been using. I went with the {struct,
JsonProplist} option because it can be set via the HTTP API.

-Greg

On Sat, May 21, 2011 at 11:48 PM, Andrew Berman  wrote:

&gt; I'll preface this by saying I've never used this feature....
&gt;
&gt; rs\\_extractfun should be set to one of the values defined in the Other
&gt; Encodings section (
&gt; http://wiki.basho.com/Riak-Search---Indexing-and-Querying-Riak-KV-Data.html).
&gt; In your case, {jsanon, "function(a,b){return{\\"user\\":\\"gpascale\\",
&gt; \\"name\\":\\"greg\\"};}"}
&gt;
&gt; Hope that helps,
&gt;
&gt; Andrew
&gt;
&gt; On Sat, May 21, 2011 at 7:48 PM, Greg Pascale  wrote:
&gt;
&gt;&gt; I've been banging my head against the wall trying to get a javascript
&gt;&gt; custom extractor working. Here is the simplest example I could come up with
&gt;&gt; to reproduce the error.
&gt;&gt;
&gt;&gt; \\*curl -v -X PUT -H "Content-Type: application/json"
&gt;&gt; http://localhost:8098/riak/test -d @data\\*
&gt;&gt;
&gt;&gt; where \\*@data\\* is a file that looks like
&gt;&gt;
&gt;&gt; \\*{"props":\\*
&gt;&gt; \\* {"rs\\_extractfun":\\*
&gt;&gt; \\* {"language" : "javascript", \\*
&gt;&gt; \\* "source" : "function(a,b){return{\\"user\\":\\"gpascale\\",
&gt;&gt; \\"name\\":\\"greg\\"};}"\\*
&gt;&gt; \\* }\\*
&gt;&gt; \\* }\\*
&gt;&gt; \\*}\\*
&gt;&gt; \\*
&gt;&gt; \\*
&gt;&gt; This completes successfully, and I can verify it by looking at the
&gt;&gt; properties of the "test" bucket.
&gt;&gt;
&gt;&gt; \\*{"props":{"allow\\_mult":true,"basic\\_quorum":true,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"name":"test","notfound\\_ok":false,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}],"pw":0,"r":"quorum","rs\\_extractfun":{"language":"javascript","source":"function(a,b){return{\\"user\\":\\"gpascale\\",
&gt;&gt; \\"name\\":\\"greg\\"};}"},"rw":"quorum","small\\_vclock":10,"w":"quorum","young\\_vclock":20}}
&gt;&gt; \\*
&gt;&gt;
&gt;&gt; However, when I try to insert something into the bucket, I get an error
&gt;&gt;
&gt;&gt; \\*curl -X PUT http://localhost:8098/riak/test/test1 -d "Hello, world!"\\*
&gt;&gt;
&gt;&gt; \\*{error,badarg,\\*
&gt;&gt; \\* [{erlang,iolist\\_to\\_binary,\\*
&gt;&gt; \\* [{hook\\_crashed,\\*
&gt;&gt; \\* {riak\\_search\\_kv\\_hook,precommit,exit,\\*
&gt;&gt; \\* {noproc,\\*
&gt;&gt; \\* {gen\\_server,call,\\*
&gt;&gt; \\* [riak\\_search\\_js\\_extract,reserve\\_vm,\\*
&gt;&gt; \\* infinity]}}}}]},\\*
&gt;&gt; \\* {wrq,append\\_to\\_response\\_body,2},\\*
&gt;&gt; \\* {riak\\_kv\\_wm\\_raw,accept\\_doc\\_body,2},\\*
&gt;&gt; \\* {webmachine\\_resource,resource\\_call,3},\\*
&gt;&gt; \\* {webmachine\\_resource,do,3},\\*
&gt;&gt; \\* {webmachine\\_decision\\_core,resource\\_call,1},\\*
&gt;&gt; \\* {webmachine\\_decision\\_core,accept\\_helper,0},\\*
&gt;&gt; \\* {webmachine\\_decision\\_core,decision,1}]}}\\*
&gt;&gt; \\*
&gt;&gt; \\*
&gt;&gt; It doesn't matter if the thing I insert is a string, as above, or real
&gt;&gt; json object that matches my schema - the error is the same. Any ideas what
&gt;&gt; might be going on here?
&gt;&gt;
&gt;&gt; Thanks,
&gt;&gt; -Greg
&gt;
