---
title: "Re: With Ruby Client, How to Test for Server Availability or Clear	All Data?"
description: ""
project: community
lastmod: 2011-07-01T06:05:45-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03899"
mailinglist_parent_id: "msg03891"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2011-07-01T06:05:45-07:00
---


Keith,

If this is just testing (e.g. Test::Unit or RSpec), I encourage you to use
the Riak::TestServer instead (which you can also use from irb if you like).
It will create a "phantom" node that uses the same code/runtime as your
existing Riak installation, but exists completely separately and uses an
in-memory backend so that it is trivial to wipe its data. The docs for it
are here (although they could use some improvement):
http://seancribbs.github.com/ripple/Riak/TestServer.html

In IRB I might do this to get it started:

require 'riak/test\\_server'
server = Riak::TestServer.new(:bin\\_dir =&gt; "/opt/local/riak/bin", :temp\\_dir
=&gt; "~/riaktest")
server.prepare!
server.start

Then when you want to wipe the data:

server.recycle

If you're using Ripple in a Rails 3 project, `rails generate ripple` will
generate all of this for you and add it to your chosen testing framework.

On Thu, Jun 30, 2011 at 6:43 PM, Keith Bennett &lt;
keith.benn...@lmnsolutions.com&gt; wrote:

&gt; All -
&gt;
&gt; I have some test procedures that require that I start with an empty data
&gt; store and end with the data exactly as it was before the test.
&gt;
&gt; The brute force approach I'm taking now is to:
&gt;
&gt; \\* shut down riak
&gt; \\* rename the data/bitcask directory
&gt; \\* start riak
&gt; \\* run my test and validate the results in riak
&gt; \\* shut down riak
&gt; \\* move the saved bitcask-xyz dir to bitcask again
&gt; \\* start riak
&gt;
&gt; As you can see, I \\*really\\* want to start with no data, and end with no
&gt; changes to the existing data. Of course, if other users were accessing
&gt; riak, this wouldn't work, but this is a test environment over which I have
&gt; control.
&gt;
&gt; My problem is that it takes a little time after running riak start or stop
&gt; for the operation to complete, and so I have to insert a sleep afterwards so
&gt; that the next step in the code is not performed prematurely. Is there a way
&gt; using the Ruby Riak client to know for sure whether or not riak is ready for
&gt; action? I could loop every fraction of a second, or, if there were a
&gt; blocking call, that would be even better.
&gt;
&gt; That said, the shutting down and restarting is pretty drastic action. Is
&gt; there a faster/easier/better way to accomplish what I want to do?
&gt;
&gt; Thanks,
&gt; Keith
&gt;
&gt;
&gt;


-- 
Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://www.basho.com/
