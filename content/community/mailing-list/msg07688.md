---
title: "Re: Map Reduce with Python"
description: ""
project: community
lastmod: 2012-06-14T06:11:27-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg07688"
mailinglist_parent_id: "msg07687"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-06-14T06:11:27-07:00
---


Matt,

Add {'keep':true} to your final reduce phase.

On Wed, Jun 13, 2012 at 12:04 AM, Matt Black wrote:

&gt; Hello list,
&gt;
&gt; In an M/R query, I'd like to be able to merge objects from two different
&gt; buckets in my output. So my process is a map phase for each bucket, with a
&gt; link phase in the middle, and a reduce phase to do a bit of merge
&gt; processing at the end.
&gt;
&gt; client = riak.RiakClient(RIAK\\_HOST, RIAK\\_PORT)
&gt; query = client.add("carts")
&gt; query.map("function(v) { return [[ v.bucket, v.key,
&gt; Riak.mapValuesJson(v)[0] ]]; }", {'keep': False})
&gt; query.link("cart-products", "cart-products", False)
&gt; query.link("products", "product", False)
&gt; query.map("function(v) { return [ Riak.mapValuesJson(v)[0] ]; }", {'keep':
&gt; False})
&gt; query.reduce("function(values) { return values; }")
&gt;
&gt; This query will return only objects from the "products" bucket.
&gt;
&gt; I tried using the "keep" flags on each map phase, but in this case the I
&gt; get output from each map phase and the reduce phase appears to be ignored -
&gt; which is somewhat unexpected.
&gt;
&gt; Please advise on changes or things I could try.
&gt;
&gt; Thanks
&gt;

-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
