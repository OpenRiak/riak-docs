---
title: "Re: Issues with MapReduce in Riak 1.1.0"
description: ""
project: community
lastmod: 2012-02-24T17:03:53-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06735"
mailinglist_parent_id: "msg06734"
author_name: "Michael Clemmons"
project_section: "mailinglistitem"
sent_date: 2012-02-24T17:03:53-08:00
---


I think I know the answer to this but would using a mix of 1.0.X and 1.1.0
together cause the same MapReduce issue?

On Fri, Feb 24, 2012 at 4:56 PM, Jon Meredith  wrote:

&gt; Issues have been reported by users and customers with the MapReduce
&gt; subsystem in Riak 1.1.0.
&gt;
&gt; 1) MapReduce fails in clusters that contain both 1.1.0 and older nodes
&gt; 2) Javascript MapReduce jobs leak Javascript VMs under some failure
&gt; conditions.
&gt; 3) Keylisting continues after bucket MapReduce is cancelled/timeout
&gt;
&gt; We are actively investigating these issues to be resolved in an
&gt; upcoming point release. We will update the individual issue
&gt; trackers as we make progress.
&gt;
&gt; = Issue: MapReduce fails in clusters that contain both 1.1.0 and older
&gt; nodes =
&gt;
&gt; Description:
&gt;
&gt; The 1.1.0 release has enhancements to the way requests are
&gt; routed between nodes. It includes a legacy mode for use while
&gt; clusters are being upgraded, using the original routing used in
&gt; the 1.0 series and before. Code required to support legacy
&gt; routing for MapReduce requests was omitted.
&gt;
&gt; What version of Riak is affected?
&gt;
&gt; Open Source and Enterprise versions of Riak 1.1.0 are affected.
&gt;
&gt; Are all users affected?
&gt;
&gt; This issue only arises during a rolling upgrade. Users will be
&gt; unable to issue MapReduce jobs while there remains 1.0.x or
&gt; 0.14.x nodes in the cluster.
&gt;
&gt; Users that are not using MapReduce, or who have clusters
&gt; containing only 1.1.0 nodes are unaffected.
&gt;
&gt; Can I safely upgrade to 1.1.0 if I am not using MapReduce?
&gt;
&gt; Yes
&gt;
&gt; Issue Tracker:
&gt;
&gt; https://github.com/basho/riak\\_core/issues/144
&gt;
&gt; = Issue: Javascript MapReduce jobs leak Javascript VMs under some failure
&gt; conditions =
&gt;
&gt; Description:
&gt;
&gt; Javascript MapReduce uses a pool of Javascript virtual machines
&gt; inside Riak. There are some edge cases where MapReduce jobs are
&gt; cancelled (due to timeouts/dropped connections) where the VMs
&gt; are not returned to the pool. Eventually all Javascript VMs in
&gt; the pool can become exhausted so that no further Javascript
&gt; MapReduce jobs can run until the node is restarted.
&gt;
&gt; What version of Riak is affected?
&gt;
&gt; Open Source and Enterprise versions of Riak 1.0.x and 1.1.0 are
&gt; affected.
&gt;
&gt; Are all users affected?
&gt;
&gt; Only users using Javascript MapReduce are affected.
&gt;
&gt; Can I safely upgrade to 1.1.0 if I am not using Javascript MapReduce?
&gt;
&gt; Yes.
&gt;
&gt; Issue Tracker:
&gt;
&gt; https://github.com/basho/riak\\_kv/issues/287
&gt;
&gt; = Issue: Keylisting continues after bucket MapReduce is cancelled/timeout =
&gt;
&gt; Description:
&gt;
&gt; If MapReduce against a bucket is cancelled (timeout or dropped
&gt; client connection) the listkeys feeding the objects from the
&gt; bucket continues to run and generates a large number of error
&gt; messages:
&gt;
&gt; "Pipe worker startup failed:fitting was gone before startup"
&gt;
&gt; Additionally, these running listkey jobs continue to tie up
&gt; resources that would otherwise be capable of running other
&gt; MapReduce queries. If enough listkey jobs end up in this state,
&gt; subsequent MapReduce queries will be unable to complete and
&gt; will timeout. In the worst case, all MapReduce queries
&gt; submitted will timeout until the running listkeys eventually
&gt; terminate and the cluster recovers.
&gt;
&gt; What version of Riak is affected?
&gt;
&gt; Riak 1.0.x and 1.1.0 are both affected. The listkeys
&gt; back-pressure mechanism added in 1.1.0 has increased the
&gt; recovery time from the issue.
&gt;
&gt; Are all users affected?
&gt;
&gt; This affects users that are seeing frequent timeouts with
&gt; bucket MapReduce.
&gt;
&gt; Can I safely upgrade to 1.1.0 if I am not using MapReduce?
&gt;
&gt; Yes.
&gt;
&gt; Issue Tracker
&gt;
&gt; https://github.com/basho/riak\\_kv/issues/293
&gt;
&gt; --
&gt; Jon Meredith
&gt; Platform Engineering Manager
&gt; Basho Technologies, Inc.
&gt; jmered...@basho.com
&gt;
&gt;

-- 
-Michael
