---
title: "Re: Ruby client - problem listing bucket keys"
description: ""
project: community
lastmod: 2010-10-24T08:15:46-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01354"
mailinglist_parent_id: "msg01353"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2010-10-24T08:15:46-07:00
---


Ted,

There is a simple fix for this (which I believed was in there already). First 
of all, install the json or yajl-ruby gems (the default parsing from 
ActiveSupport is bad). Then add this to your script:

ActiveSupport.parse\\_json\\_times = false

ActiveSupport tries to be smart about parsing strings that look like dates or 
times into Date/Time objects. I've found it to be a nuisance, especially in 
use-cases like the one you have.

Sean Cribbs 
Developer Advocate
Basho Technologies, Inc.
http://basho.com/

On Oct 23, 2010, at 6:51 PM, Ted Behling wrote:

&gt; Hi,
&gt; 
&gt; I am new to Riak but am starting to get familiar with it. I've been going 
&gt; through the "Riak Fast Track" tutorial, and am using the riak-client Ruby 
&gt; gem. Sadly, I think I have found some broken behavior in the Ruby client. 
&gt; I'm hoping maybe the maintainer of the riak-client gem can help?
&gt; 
&gt; The issue is that if my Riak keys look like "dates", such as "2010-01-01", 
&gt; then if I invoke the "keys" method on a Riak::Bucket object, I get an error. 
&gt; Non-date-looking keys work fine.
&gt; 
&gt; Here are some commands that reproduce the problem, from an OS X command line:
&gt; 
&gt; ---------
&gt; # This successfully creates a new bucket called "broken" and assigns a value 
&gt; to the key "2010-01-01"
&gt; $ curl -X PUT -d '{"bar":"baz"}' -H "Content-Type: application/json" 
&gt; http://127.0.0.1:8098/riak/broken/2010-01-01
&gt; 
&gt; # I can successfully retrieve the specific key using a Ruby one-liner
&gt; $ ruby -e "require 'rubygems'; require 'riak'; puts 
&gt; Riak::Client.new.bucket('broken')['2010-01-01'].data.inspect"
&gt; curb library not found! Please `gem install curb` for better performance.
&gt; {"bar"=&gt;"baz"}
&gt; 
&gt; # A Ruby exception results when I list the keys. Note where it's trying to 
&gt; invoke "tr" on a Date object, shown here formatted as a different string than 
&gt; the Riak key
&gt; $ ruby -e "require 'rubygems'; require 'riak'; puts 
&gt; Riak::Client.new.bucket('broken').keys"
&gt; curb library not found! Please `gem install curb` for better performance.
&gt; /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/cgi.rb:352:in
&gt; `unescape': undefined method `tr' for Fri, 01 Jan 2010:Date (NoMethodError)
&gt; from 
&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:48:in `load'
&gt; from 
&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:48:in `map'
&gt; from 
&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:48:in `load'
&gt; from 
&gt; /Library/Ruby/Gems/1.8/gems/riak-client-0.8.2/lib/riak/bucket.rb:69:in `keys'
&gt; from -e:1
&gt; ---------
&gt; 
&gt; Clearly, something here is trying to be "helpful" by translating the string 
&gt; "2010-01-01" to a Date object. This is the wrong behavior, because Riak keys 
&gt; are strings and should always be strings. Correct behavior would be to not 
&gt; interpret "date-looking" or other "special appearance" strings, and just 
&gt; treat all key strings literally.
&gt; 
&gt; Here are the relevant software versions I am running:
&gt; Mac OS X 10.6
&gt; riak-0.13.0-osx-i386 (downloaded from Basho)
&gt; ruby 1.8.7 (2009-06-12 patchlevel 174) [universal-darwin10.0]
&gt; Rubygems version 1.3.7
&gt; riak-client gem, 0.8.2, installed with "gem install riak-client"
&gt; activesupport gem, 2.3.8
&gt; 
&gt; I hope someone can fix this issue. If I can contribute a patch, or you would 
&gt; like me to help test a patch, please let me know what's needed.
&gt; 
&gt; Best regards,
&gt; 
&gt; Ted Behling
&gt; RHCE, Network+
&gt; t...@tedb.us
