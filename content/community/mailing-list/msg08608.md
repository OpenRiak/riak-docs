---
title: "Re: [Help]Riak concurrency problem"
description: ""
project: community
lastmod: 2012-09-20T07:42:38-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08608"
mailinglist_parent_id: "msg08607"
author_name: "Eric Moritz"
project_section: "mailinglistitem"
sent_date: 2012-09-20T07:42:38-07:00
---


You may want to put a timestamp secondary index on the objects and
then you can do a range query of between 0 and now() - 5 minutes.

Here's the docs on 2i,
http://wiki.basho.com/Secondary-Indexes---Configuration-and-Examples.html

On Thu, Sep 20, 2012 at 9:26 AM, Douglas Muth  wrote:
&gt; On Thu, Sep 20, 2012 at 1:06 AM, Hải Lưu Tuấn  wrote:
&gt;&gt;
&gt;&gt; If there are 2 (or more) threads use this function at a same time, it will
&gt;&gt; cause error. Assume that both thread A and thread B have retrieved the keys
&gt;&gt; list (use bucket.get\\_keys()), and thread A deleted all of the old passwords
&gt;&gt; in the bucket, then when thread B tried to execute:
&gt;&gt;
&gt; [snip]
&gt;
&gt; It sounds like if you do it this way, you're going to run into
&gt; scalability issues down the road. (what happens when say, 10 users use
&gt; this function at the same time?)
&gt;
&gt; Why not have a crontab (or a script daemonized with daemontools) run
&gt; this code every 5 minutes instead? It will completely sidestep the
&gt; current issue you're seeing, and should scale much better.
&gt;
&gt; -- Doug
&gt;
&gt; --
&gt; http://twitter.com/dmuth
&gt;

