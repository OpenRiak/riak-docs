---
title: "python map reduce and secondary indexes"
description: ""
project: community
lastmod: 2012-12-07T23:12:30-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09483"
author_name: "David Montgomery"
project_section: "mailinglistitem"
sent_date: 2012-12-07T23:12:30-08:00
---


Hi,

Given that map reduce is the primary way of getting data out of riak, and i
use python api, I am hard pressed to find any simple examples. Not even on
the officially supported riak python api.

Below is how I add a record to riak:

 id = """%s:%s:%s:%s:%s""" %
(str(uuid4()),campaign\\_id,aid,da,country)
 worker\\_bucket = impression\\_bucket.new(id, data=qs)
 worker\\_bucket.add\\_index('field1\\_bin', campaign\\_id)
 worker\\_bucket.add\\_index('field2\\_bin', aid)
 worker\\_bucket.add\\_index('field3\\_bin', country)
 worker\\_bucket.add\\_index('field4\\_bin', da)

So....

If I want to get all records and sum up by country and date is in a date
range then how? I am ok with the reduce portion but not clear on the map
portion. How do I add a index for country=US and da&gt;201207 and da&lt;201212?

client = riak.RiakClient(host='103.4.112.103')
 query = client.add('impressions')
 query.map('''
 function(value, keyData, arg) {
 var data = Riak.mapValuesJson(value)[0];
 var alt\\_key = data['hw'] + '\\_' + data['ssp'];
 var obj = {};
 obj[alt\\_key] = 1;
 return [ obj ];

 }''')

Thanks
