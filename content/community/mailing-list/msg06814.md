---
title: "Re: riak-erlang-client serverside clarification"
description: ""
project: community
lastmod: 2012-03-01T08:53:42-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06814"
mailinglist_parent_id: "msg06793"
author_name: "Sean Cribbs"
project_section: "mailinglistitem"
sent_date: 2012-03-01T08:53:42-08:00
---


Hi Senthilkumar,

Because the PB client is connecting to a language-agnostic interface, it
makes sense that it will only store binary data as the value. In general,
it's better not to rely on the fact that your value is Erlang terms, but to
assume Riak will treat the value opaquely, as a binary. Calling
binary\\_to\\_term in your MapReduce (of course, making a guard or check for
existing values that are terms) should not be too onerous. e.g.

ensure\\_terms(Bin) when is\\_binary(Bin) -&gt;
 binary\\_to\\_term(Bin);
ensure\\_terms(T) -&gt; T.

Then as the first part of each map function you could do

Value = ensure\\_terms(riak\\_object:get\\_value(Obj)),

I hope that helps!

On Wed, Feb 29, 2012 at 11:23 PM, Senthilkumar Peelikkampatti &lt;
senthilkumar.peelikkampa...@gmail.com&gt; wrote:

&gt; I am using currently erlang native client and it is working beautifully so
&gt; far. I wanted to move it to pb client due to
&gt; 1. it is kind of pain to update relevant binaries
&gt; 2. bidirectional network connection with riak nodes and my application
&gt; nodes and associated load etc to the system
&gt; 3. dependency of config like erl riak cookie etc
&gt;
&gt; But In my preliminary study, found that,
&gt;
&gt; a) PB client always sends value as binary
&gt; b) PB server always stores the value as such no matter what kind of
&gt; content type set ex. "application/x-erlang-term"
&gt;
&gt; And item (b) is problem for me because my entire app has may MR queries
&gt; and other object retrieval which directly consumes erlang terms. So I need
&gt; to go everywhere (though, It is just one DB module and another module with
&gt; many M-R functions) to change the binary to term or should I tweek
&gt; riakc\\_pb:erlify\\_rpbcontent to convert binary to term and store it -- may be
&gt; based on Content-Type? This sounds ugly but I just need to change it only
&gt; once without affecting my entire code base. If I do so, wherever I get the
&gt; object from Riak, I no need to convert it, it saves unnecessary decoding
&gt; also.
&gt;
&gt; PB binaries stored in riak also affect the riak:local client retrieval
&gt; where we can get the object and see it in plain without doing
&gt; binary\\_to\\_term.
&gt;
&gt;
&gt; My app is webmachine erlang web app.
&gt;
&gt; Thoughts?
&gt;
&gt; Thanks,
&gt; --Senthilkumar Peelikkampatti.
&gt;
&gt;
&gt;
&gt;

-- 
Sean Cribbs 
Software Engineer
Basho Technologies, Inc.
http://basho.com/
