---
title: "Re: Re: Cluster basics: N-val and distribution between nodes"
description: ""
project: community
lastmod: 2010-04-18T09:30:53-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg00073"
mailinglist_parent_id: "msg00069"
author_name: "wde"
project_section: "mailinglistitem"
sent_date: 2010-04-18T09:30:53-07:00
---


&gt;I have the same question. According to the comments in riak\\_claim.erl, the
&gt;claims will be arranged so that partition sequences of length at most
&gt;target\\_n\\_val will have no repeated nodes, if possible, but that there will
&gt;be cases where there may be repeats. Is the sequence of N partitions taken
&gt;verbatim as the replica list, or is there some logic to ensure that we
&gt;actually get N distinct nodes?
&gt;
&gt;I think in the original Dynamo paper, they said they had some extra logic to
&gt;make sure the N virtual nodes they chose for replication actually
&gt;corresponded to N distinct physical nodes.

Yes, I think they add an additional layer to ensure (if needed) that replicas 
will be on differents
physical nodes. Virtualization is (sometimes) good, but when the customer don't 
know where are physically the replicas (dude, where's my data ?), it could be 
problem. For example if you want to ensure that at least 2 replicas are hosted 
in two datacenters to ensure that you respect the SLA and the site disaster 
clause.


 

&gt;
&gt;Curtis
&gt;
&gt;
&gt;On Mon, Mar 8, 2010 at 10:20 AM, Victor Martinez wrote:
&gt;
&gt;&gt; I'm sorry if I'm adding more confusion to a question that seemed closed.
&gt;&gt;
&gt;&gt; Is this true even if the number of virtual nodes is not a multiple of N?
&gt;&gt;
&gt;&gt; So for example ( I know it is a very degenerate case ) if the size of the
&gt;&gt; ring is 4, and there are 3 riak instances and N is set to 3 for a given
&gt;&gt; bucket, a given entry could end up not being stored on the three nodes.
&gt;&gt;
&gt;&gt; The way I understand it, this could happen for any size of the ring which
&gt;&gt; is not a multiple of N, not only in a ring with 4 partitions.
&gt;&gt;
&gt;&gt; I'm basing this on the comments in riak\\_claim.erl
&gt;&gt;
&gt;&gt; Is this correct?
