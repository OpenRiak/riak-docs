---
title: "Re: MapReduce - sorting via the Java client"
description: ""
project: community
lastmod: 2012-09-11T10:16:49-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08496"
mailinglist_parent_id: "msg08391"
author_name: "Deepak Balasubramanyam"
project_section: "mailinglistitem"
sent_date: 2012-09-11T10:16:49-07:00
---


I was researching the same question and found the answer after some
tinkering around. You need a JS source function. You must write the JS
source code for the sort algorithm too.

JSSourceFunction phaseFunction = new JSSourceFunction(
 "function(v) {" +
 "return v.sort(function(a, b) {" +
 "return a.field - b.field ;" +
 "}" +
 ");" +
 "}");
IndexQuery iq = new BinValueQuery(BinIndex.named("indx\\_name"),"bucket",
"value"); // get an index
MapReduceResult execute = client.mapReduce(iq).addMapPhase(new
NamedJSFunction("Riak.mapValuesJson"),
false).addReducePhase(phaseFunction).execute();
String resultRaw = execute.getResultRaw(); // Raw data
Collection result = execute.getResult(YourType .class); //
serialized to a domain object

The result of this operation will depend on what you return in your
reduce() function. The result may be a YourType or YourType[] etc. I wanted
to mention that since Jackson can complain about serialization issues if
you return the wrong values.

Anyone know how to get this into a wiki ?

Thanks
Deepak Bala

On Wed, Aug 29, 2012 at 5:09 PM, Oved Machlev wrote:

&gt; Hi,\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; How can I use the sorting functions over 'real' fields in the stored
&gt; objects? How can I set the field on which I want to sort by?\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; It seems that the following refers to the key, in my case it's a UUID, and
&gt; therefore useless to sort by:\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; MapReduceResult result = riakClient.\\*\\*\\*\\*
&gt;
&gt; mapReduce("some\\_bucket").\\*\\*\\*\\*
&gt;
&gt; addMapPhase(\\*new\\* NamedJSFunction(
&gt; "Riak.mapValuesJson"), \\*false\\*).\\*\\*\\*\\*
&gt;
&gt; \\*addReducePhase(new NamedErlangFunction(
&gt; "riak\\_kv\\_mapreduce", "reduce\\_sort"), true).\\*\\*\\*\\*\\*
&gt;
&gt; execute();\\*\\*\\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; \\*\\* \\*\\*
&gt;
&gt; thanks,\\*\\*\\*\\*
&gt;
&gt; Oved.\\*\\*\\*\\*
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

