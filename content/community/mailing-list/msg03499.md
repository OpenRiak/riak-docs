---
title: "Re: haproxy and protobuffers working example?"
description: ""
project: community
lastmod: 2011-05-30T21:10:47-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03499"
mailinglist_parent_id: "msg03498"
author_name: "Scott M. Likens"
project_section: "mailinglistitem"
sent_date: 2011-05-30T21:10:47-07:00
---


Difference is good and after taking a whirl it seems to have fixed it so thank 
you very much :)

-- 
Scott M. Likens
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)

On Monday, May 30, 2011 at 4:55 PM, Bob Feldbauer wrote:

&gt; Your haproxy.cfg looks fine, but since you asked, here's the my 
&gt; haproxy.cfg for Riak use:
&gt; 
&gt; global
&gt; user haproxy
&gt; group haproxy
&gt; daemon
&gt; maxconn 100000
&gt; 
&gt; defaults
&gt; log global
&gt; mode tcp
&gt; option tcplog
&gt; option dontlognull
&gt; balance leastconn
&gt; clitimeout 60000
&gt; srvtimeout 60000
&gt; contimeout 5000
&gt; retries 3
&gt; option redispatch
&gt; option contstats
&gt; stats enable
&gt; 
&gt; listen riak 192.168.1.1:8087
&gt; server riak1 riak1:8087 weight 1 maxconn 1000
&gt; server riak2 riak2:8087 weight 1 maxconn 1000
&gt; server riak3 riak3:8087 weight 1 maxconn 1000
&gt; 
&gt; 
&gt; Good luck!
&gt; 
&gt; - Bob Feldbauer
&gt; 
&gt; On 5/30/2011 7:11 PM, Scott M. Likens wrote:
&gt; &gt; Hey,
&gt; &gt; 
&gt; &gt; So I thought I had a working haproxy configuration with protobuffers (It 
&gt; &gt; worked once upon a time, but no longer) so I was wondering if anyone had 
&gt; &gt; any working examples?
&gt; &gt; 
&gt; &gt; 
&gt; &gt; irb(main):001:0&gt; client = Riak::Client.new(:protocol =&gt; "pbc")
&gt; &gt; =&gt; #
&gt; &gt; irb(main):002:0&gt; client.ping
&gt; &gt; Riak::ProtobuffsFailedRequest: Expected success from Riak but received 
&gt; &gt; server\\_error. Unexpected EOF on PBC socket
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; irb(main):008:0&gt; client2=Riak::Client.new(:protocol =&gt; "pbc", :host =&gt; 
&gt; &gt; "10.170.121.116")
&gt; &gt; =&gt; #
&gt; &gt; irb(main):009:0&gt; client2.ping
&gt; &gt; =&gt; true
&gt; &gt; 
&gt; &gt; 
&gt; &gt; If I remove all the servers except for 1 connects but still doesn't really 
&gt; &gt; work, below is my haproxy configuration I hope it helps.
&gt; &gt; 
&gt; &gt; listen riak\\_pbc :8087
&gt; &gt; mode tcp
&gt; &gt; server app-0 ip-10-170-121-116.us-west-1.compute.internal:8087 check inter 
&gt; &gt; 5000 fastinter 1000 fall 1 weight 50
&gt; &gt; server app-1 ip-10-171-43-226.us-west-1.compute.internal:8087 check inter 
&gt; &gt; 5000 fastinter 1000 fall 1 weight 50
&gt; &gt; server app-2 ip-10-170-142-202.us-west-1.compute.internal:8087 check inter 
&gt; &gt; 5000 fastinter 1000 fall 1 weight 50
&gt; &gt; 
&gt; &gt; Actual full haproxy erb chef template can be found here 
&gt; &gt; https://github.com/damm/ey-riak/blob/master/templates/default/haproxy.cfg.erb
&gt; &gt; (if you see anything I should turn off for http please let me know and be 
&gt; &gt; gentle)
&gt; 
&gt; !DSPAM:4de42eb0180691550818619!

