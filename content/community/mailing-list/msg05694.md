---
title: "Re: slow 2 node cluster"
description: ""
project: community
lastmod: 2011-11-20T13:34:24-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05694"
mailinglist_parent_id: "msg05692"
author_name: "Catalin Constantin"
project_section: "mailinglistitem"
sent_date: 2011-11-20T13:34:24-08:00
---


To make it simple. No more networking. Just one node (with n = 1) and local
tests.

The producing of data is a simple CSV file read (ruled out too cause this
is fast).
Switched to bitcask:
{storage\\_backend, riak\\_kv\\_bitcask\\_backend},

Removed the index from the RiakObject (so now we have simple k/v).
Created a new bucket (just to be "clean").
And rerun the test.

Now it's better:
~450 inserts / second

I still think it's slow.

Hardware is pretty good:

Intel® Core™ i7-920 Quadcore incl. Hyper-Threading Technology

RAM: 8GB DDR3

HDD: 2 x 750 GB SATA 2 (RAID1)


What insert rate should i expect on a normal Debian 6.0 64 bit installation
(no tweaks) ?

I can only compare it with other DBs i have tested on the same machine:
ex: mongodb, kyototycoon

On Sun, Nov 20, 2011 at 10:56 PM, Aphyr  wrote:

&gt; On 11/20/2011 12:14 PM, Catalin Constantin wrote:
&gt;
&gt;&gt; I am 100% sure the transfer rate is 10MBytes / second. This is not the
&gt;&gt; problem.
&gt;&gt;
&gt;
&gt; In ten years of network administration I have never encountered an
&gt; ethernet device with a wire rate of 10 MBps. I have, however, encountered
&gt; frequent confusion over units. Perhaps you understand my suspicion here. :)
&gt;
&gt;
&gt; IOWAIT is also pretty low. iostat shows: iowait 4.69%
&gt;&gt;
&gt;
&gt; If you read my email, I suggested that even values as low as 2.6% may
&gt; suggest contention. It depends on your CPU arch and utilization. I would
&gt; investigate your disks more closely. Are they spinning or solid-state?
&gt; Median seek time? 95/99 seek times? Disk cache? Does the riak process spend
&gt; disproportionate time in IO\\_WAIT relative to USER? Filesystem
&gt; atime/relatime/noatime? FS block size properly aligned for your disk?
&gt; Insufficient filesystem or leveldb cache? hdparm options? Is riak on an
&gt; independent disk or competing with other processes, i.e. syslog, file
&gt; servers, etc? Does strace show an unusual amount of time spent in certain
&gt; system calls?
&gt;
&gt; It might just be leveldb, too. I only have experience with bitcask in
&gt; production.
&gt;
&gt;
&gt; I have retried the test with one node, a new bucket newly created where
&gt;&gt; i have set: n to 1.
&gt;&gt; bucket.set\\_n\\_val(1)
&gt;&gt;
&gt;&gt; Results are the same. Less than 300 inserts / second.
&gt;&gt;
&gt;
&gt; This is good; it rules out replication.
&gt;
&gt;
&gt; Any idea why riak is so slow on inserting data ?
&gt;&gt;
&gt;
&gt; Disk, disk disk disk, disk disk? Disk!
&gt;
&gt; You could also look at the client. Are you writing to a local node or a
&gt; remote one? Is your client's threading model getting in the way? Can you
&gt; actually produce data fast enough to insert it? Is your client fighting for
&gt; the same resources as the riak process? Presuming you've ruled these out,
&gt; it's almost certainly network or disk.
&gt;
&gt; --Kyle
&gt;

-- 
Catalin Constantin
Dazoot Software
http://www.dazoot.eu/
