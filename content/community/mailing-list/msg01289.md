---
title: "Re: File descriptor leaks?"
description: ""
project: community
lastmod: 2010-10-14T04:53:50-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01289"
mailinglist_parent_id: "msg01288"
author_name: "Dmitry Demeshchuk"
project_section: "mailinglistitem"
sent_date: 2010-10-14T04:53:50-07:00
---


A small update. I've just encountered the same problem. Just about 3-4
hours have passed.

lsof | wc -l showed only about 2k descriptors for all users. That's
even more weird as the 32k descriptors limit is per user. So, we
haven't reached the limit so far.

On Thu, Oct 14, 2010 at 3:48 PM, Dmitry Demeshchuk  wrote:
&gt; Greetings.
&gt;
&gt; We have recently started to get the emfile errors. ulimit -n is 32767.
&gt; Restarting Riak helps for several hours and then we run out of
&gt; descriptors again.
&gt;
&gt; Some time later after restart I performed lsof and found the following
&gt; descriptors:
&gt;
&gt; kondemand   154       root  cwd   unknown
&gt; /proc/154/cwd (readlink: Permission denied)
&gt; kondemand   154       root  rtd   unknown
&gt; /proc/154/root (readlink: Permission denied)
&gt; kondemand   154       root  txt   unknown
&gt; /proc/154/exe (readlink: Permission denied)
&gt; kondemand   154       root NOFD
&gt; /proc/154/fd (opendir: Permission denied)
&gt; kondemand   155       root  cwd   unknown
&gt; /proc/155/cwd (readlink: Permission denied)
&gt; kondemand   154       root  cwd   unknown
&gt; /proc/154/cwd (readlink: Permission denied)
&gt; kondemand   154       root  rtd   unknown
&gt; /proc/154/root (readlink: Permission denied)
&gt; kondemand   154       root  txt   unknown
&gt; /proc/154/exe (readlink: Permission denied)
&gt; kondemand   154       root NOFD
&gt; /proc/154/fd (opendir: Permission denied)
&gt; kondemand   155       root  cwd   unknown
&gt; /proc/155/cwd (readlink: Permission denied)
&gt; kondemand   155       root  rtd   unknown
&gt; /proc/155/root (readlink: Permission denied)
&gt; kondemand   155       root  txt   unknown
&gt; /proc/155/exe (readlink: Permission denied)
&gt; kondemand   155       root NOFD
&gt; /proc/155/fd (opendir: Permission denied)
&gt; kondemand   156       root  cwd   unknown
&gt; /proc/156/cwd (readlink: Permission denied)
&gt; kondemand   156       root  rtd   unknown
&gt; /proc/156/root (readlink: Permission denied)
&gt; kondemand   156       root  txt   unknown
&gt; /proc/156/exe (readlink: Permission denied)
&gt; kondemand   156       root NOFD
&gt; /proc/156/fd (opendir: Permission denied)
&gt; kondemand   157       root  cwd   unknown
&gt; /proc/157/cwd (readlink: Permission denied)
&gt; kondemand   157       root  rtd   unknown
&gt; /proc/157/root (readlink: Permission denied)
&gt; kondemand   157       root  txt   unknown
&gt; /proc/157/exe (readlink: Permission denied)
&gt; kondemand   157       root NOFD
&gt; /proc/157/fd (opendir: Permission denied)
&gt; kondemand   158       root  cwd   unknown
&gt; /proc/158/cwd (readlink: Permission denied)
&gt; kondemand   158       root  rtd   unknown
&gt; /proc/158/root (readlink: Permission denied)
&gt; kondemand   158       root  txt   unknown
&gt; /proc/158/exe (readlink: Permission denied)
&gt;
&gt; Also, the following couple of descriptors is opened several times at
&gt; the same time:
&gt;
&gt; bash      20176        dem  mem       REG     252,0   256316   1179925
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_CTYPE
&gt; bash      20176        dem  mem       REG     252,0       54   1179926
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_NUMERIC
&gt; bash      20176        dem  mem       REG     252,0     2454   1179927
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_TIME
&gt; bash      20176        dem  mem       REG     252,0   966938   1179928
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_COLLATE
&gt; bash      20176        dem  mem       REG     252,0      286   1179929
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_MONETARY
&gt; bash      20176        dem  mem       REG     252,0       52   1179930
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_MESSAGES/SYS\\_LC\\_MESSAGES
&gt; bash      20176        dem  mem       REG     252,0       34   1179931
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_PAPER
&gt; bash      20176        dem  mem       REG     252,0       77   1179932
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_NAME
&gt; bash      20176        dem  mem       REG     252,0      155   1179933
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_ADDRESS
&gt; bash      20176        dem  mem       REG     252,0       59   1179934
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_TELEPHONE
&gt; bash      20176        dem  mem       REG     252,0       23   1179935
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_MEASUREMENT
&gt; bash      20176        dem  mem       REG     252,0    26048    917676
&gt; /usr/lib/gconv/gconv-modules.cache
&gt; bash      20176        dem  mem       REG     252,0      373   1179936
&gt; /usr/lib/locale/en\\_US.utf8/LC\\_IDENTIFICATION
&gt;
&gt; Version of Riak is 0.12.1. There was a similar problem once and the
&gt; user was advised to make sure to use 0.12.1
&gt;
&gt; Any ideas?
&gt;
&gt; --
&gt; Best regards,
&gt; Dmitry Demeshchuk
&gt;

-- 
Best regards,
Dmitry Demeshchuk

