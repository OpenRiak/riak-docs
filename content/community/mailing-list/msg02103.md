---
title: "Re: Memory Requirements for Riak Search index (merge_index)"
description: ""
project: community
lastmod: 2011-01-24T13:45:55-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg02103"
mailinglist_parent_id: "msg02056"
author_name: "Rusty Klophaus"
project_section: "mailinglistitem"
sent_date: 2011-01-24T13:45:55-08:00
---


Hi Alexander and Gordon,

merge\\_index is inspired by bitcask, but it's not a strict derivative. It
does \\*not\\* keep the keydir structure in memory, however it keeps some hints
in memory. The memory usage does grow with the number of terms, albeit
slowly, since it is mostly keeping signatures and offset information, and
the hints are compressed.

To get into the details, merge\\_index maintains one in-memory offset entry
for (approximately) every 64kb block of index. The offset entry consists of:

- A few bytes for bookkeeping.
- 200 bytes of fixed overhead for a bloom filter.
- A short entry for each term header in the block consisting of:
 - Offset and count information for that term.
 - Two highly compressible signatures.

Then the whole structure is compressed. In practice, memory usage has not
been a problem even for large vocabularies.

Best,
Rusty


On Sat, Jan 22, 2011 at 11:36 AM, Alexander Sicular wrote:

&gt; Without knowing exactly, I'm gonna go with yes. I happen to be under the
&gt; impression that the merge\\_index\\_backend is a bitcask derivative. But I would
&gt; love to hear otherwise from someone @basho.
&gt;
&gt; -Alexander Sicular
&gt;
&gt; @siculars
&gt;
&gt; On Jan 22, 2011, at 9:50 AM, Gordon Tillman wrote:
&gt;
&gt; &gt; Greetings All,
&gt; &gt;
&gt; &gt; It is my understanding the only backend that is compatible with Riak
&gt; Search indexes is the merge\\_index\\_backend.
&gt; &gt;
&gt; &gt; I am wondering if merge\\_index backend has a similar memory footprint as
&gt; bitcask; i.e., must the keydir structure for merge\\_index fit entirely in RAM
&gt; as is the case with bitcask?
&gt; &gt;
&gt; &gt; Many thanks!
&gt; &gt;
&gt; &gt; --gordon
&gt; &gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; &gt; riak-users mailing list
&gt; &gt; riak-users@lists.basho.com
&gt; &gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

