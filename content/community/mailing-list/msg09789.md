---
title: "Re: Socket closed during write?"
description: ""
project: community
lastmod: 2013-01-10T09:57:45-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09789"
mailinglist_parent_id: "msg09784"
author_name: "Evan Vigil-McClanahan"
project_section: "mailinglistitem"
sent_date: 2013-01-10T09:57:45-08:00
---


Does this happen on all of the nodes, or just one? One client, or all
of them? A particular type of request, or just at random?

On Thu, Jan 10, 2013 at 1:29 AM, Brad Heller  wrote:
&gt; I'm using regular ol' ruby-riak client to write to the bucket. It's all 
&gt; pretty much out of the box. There is an ELB in front of the ring with SSL on 
&gt; the ELB and on passed through to the ring, if that's significant.
&gt;
&gt; Nothing special that I can identify. I can attempt to instrument our code 
&gt; further...
&gt;
&gt; On Jan 9, 2013, at 10:05 PM, Evan Vigil-McClanahan  
&gt; wrote:
&gt;
&gt;&gt; The last time I saw this particular error it was someone on a 64bit
&gt;&gt; client setting the content length value incorrectly via libcurl.
&gt;&gt; Requests would work on 64 bit nodes but fail on 32 bit nodes,
&gt;&gt; presumably because the HTTP client was handing the socket a garbage
&gt;&gt; value to read, thereby killing it.
&gt;&gt;
&gt;&gt; Timeouts will generally return a different error. You might be
&gt;&gt; looking at some TCP or HTTP issue. How are you connecting? Is there
&gt;&gt; anything special about the requests that are failing?
&gt;&gt;
&gt;&gt; On Wed, Jan 9, 2013 at 7:29 PM, Brad Heller  wrote:
&gt;&gt;&gt; Hey all,
&gt;&gt;&gt;
&gt;&gt;&gt; I've got a mysterious error with Riak. Certain writes seem to result in an
&gt;&gt;&gt; interesting error being raised by the coordinating node (rem, I'm assuming
&gt;&gt;&gt; it's the coordinating node):
&gt;&gt;&gt;
&gt;&gt;&gt; webmachine error: path="/buckets/my\\_bucket/keys"
&gt;&gt;&gt; {error,{error,{badmatch,{error,closed}},
&gt;&gt;&gt; [{webmachine\\_request,recv\\_unchunked\\_body,4,[{file,"src/webmachine\\_request.erl"},{line,418}]},
&gt;&gt;&gt; {webmachine\\_request,do\\_recv\\_body,2,[{file,"src/webmachine\\_request.erl"},{line,377}]},
&gt;&gt;&gt; {webmachine\\_request,call,2,[{file,"src/webmachine\\_request.erl"},{line,149}]},
&gt;&gt;&gt; {wrq,req\\_body,1,[{file,"src/wrq.erl"},{line,112}]},
&gt;&gt;&gt; {riak\\_kv\\_wm\\_object,accept\\_doc\\_body,2,[{file,"src/riak\\_kv\\_wm\\_object.erl"},{line,595}]},
&gt;&gt;&gt; {webmachine\\_resource,resource\\_call,3,[{file,"src/webmachine\\_resource.erl"},{line,169}]},
&gt;&gt;&gt; {webmachine\\_resource,do,3,[{file,"src/webmachine\\_resource.erl"},{line,128}]},
&gt;&gt;&gt; {webmachine\\_decision\\_core,resource\\_call,1,[{file,"src/webmachine\\_decision\\_core.erl"},{line,48}]}]}
&gt;&gt;&gt;
&gt;&gt;&gt; Web machine returns a 500 error when this happens. I saw online that this
&gt;&gt;&gt; could be the result of a socket being closed out from under the connection
&gt;&gt;&gt; [1]. Any idea how I can get to the bottom of this? Due to the nature of the
&gt;&gt;&gt; reproduction steps, I don't have access to the payload causing the crash
&gt;&gt;&gt; 'till it's actually \\*in\\* Riak. Someone in #riak on IRC suggested that this
&gt;&gt;&gt; could be the result of write timeouts. Ideas?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks,
&gt;&gt;&gt;
&gt;&gt;&gt; Brad Heller
&gt;&gt;&gt;
&gt;&gt;&gt; 1:
&gt;&gt;&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2011-October/006078.html
&gt;&gt;&gt;
&gt;&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt;&gt; riak-users mailing list
&gt;&gt;&gt; riak-users@lists.basho.com
&gt;&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;&gt;&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

