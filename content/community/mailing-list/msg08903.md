---
title: "Re: map reduce time outs"
description: ""
project: community
lastmod: 2012-10-13T06:08:23-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08903"
mailinglist_parent_id: "msg08902"
author_name: "Adam Lindsay"
project_section: "mailinglistitem"
sent_date: 2012-10-13T06:08:23-07:00
---


Hi David,

This one is actually documented:
 
http://basho.github.com/riak-python-client/mapreduce.html#riak.mapreduce.RiakMapReduce.run

results = query.run(timeout=300000) #milliseconds = 5 minutes

adam
(mobile)

On 13 Oct 2012, at 08:40, David Montgomery  wrote:

&gt; Hi,
&gt; 
&gt; I am trying to run this map reduce job. I get a time out. Logic
&gt; would dictate that I add a time out to the RiakClient but that flag is
&gt; not there. How do I deal with timeouts with the python api? I have
&gt; data...I just cant get it out.
&gt; 
&gt; ile 
&gt; "/usr/local/lib/python2.7/dist-packages/riak-1.5.0-py2.7.egg/riak/transports/http.py",
&gt; line 321, in mapred
&gt; (repr(response[0]), repr(response[1])))
&gt; Exception: Error running MapReduce operation. Headers: {'date': 'Sat,
&gt; 13 Oct 2012 07:26:31 GMT', 'content-length': '19', 'content-type':
&gt; 'application/json', 'http\\_code': 500, 'server': 'MochiWeb/1.1
&gt; WebMachine/1.9.0 (someone had painted it blue)'} Body:
&gt; '{"error":"timeout"}'
&gt; 
&gt; client = riak.RiakClient(host='111.111.111.111',port=8087,
&gt; transport\\_class=riak.RiakPbcTransport)
&gt; query = client.add('impressions')
&gt; query.map('''
&gt; function(value, keyData, arg) {
&gt; var data = Riak.mapValuesJson(value)[0];
&gt; 
&gt; if(data['adx']=='gdn'){
&gt; var alt\\_key = data['hw'] + '\\_' + data['adx'];
&gt; var obj = {};
&gt; obj[alt\\_key] = 1;
&gt; return [ obj ];
&gt; }else{
&gt; return [];
&gt; }
&gt; 
&gt; 
&gt; }''')
&gt; 
&gt; query.reduce('''
&gt; function(values, arg){
&gt; return [ values.reduce( function(acc, item) {
&gt; for (var state in item) {
&gt; if (acc[state])
&gt; acc[state] += item[state];
&gt; else
&gt; acc[state] = item[state];
&gt; }
&gt; return acc;
&gt; })];
&gt; }
&gt; ''')
&gt; 
&gt; for result in query.run():
&gt; print result
&gt; 
