---
title: "Re: Error when trying to use a javascript custom extractor in	Riaksearch"
description: ""
project: community
lastmod: 2011-05-21T23:48:24-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg03385"
mailinglist_parent_id: "msg03383"
author_name: "Andrew Berman"
project_section: "mailinglistitem"
sent_date: 2011-05-21T23:48:24-07:00
---


I'll preface this by saying I've never used this feature....

rs\\_extractfun should be set to one of the values defined in the Other
Encodings section (
http://wiki.basho.com/Riak-Search---Indexing-and-Querying-Riak-KV-Data.html).
In your case, {jsanon, "function(a,b){return{\\"user\\":\\"gpascale\\",
\\"name\\":\\"greg\\"};}"}

Hope that helps,

Andrew

On Sat, May 21, 2011 at 7:48 PM, Greg Pascale  wrote:

&gt; I've been banging my head against the wall trying to get a javascript
&gt; custom extractor working. Here is the simplest example I could come up with
&gt; to reproduce the error.
&gt;
&gt; \\*curl -v -X PUT -H "Content-Type: application/json"
&gt; http://localhost:8098/riak/test -d @data\\*
&gt;
&gt; where \\*@data\\* is a file that looks like
&gt;
&gt; \\*{"props":\\*
&gt; \\* {"rs\\_extractfun":\\*
&gt; \\* {"language" : "javascript", \\*
&gt; \\* "source" : "function(a,b){return{\\"user\\":\\"gpascale\\",
&gt; \\"name\\":\\"greg\\"};}"\\*
&gt; \\* }\\*
&gt; \\* }\\*
&gt; \\*}\\*
&gt; \\*
&gt; \\*
&gt; This completes successfully, and I can verify it by looking at the
&gt; properties of the "test" bucket.
&gt;
&gt; \\*{"props":{"allow\\_mult":true,"basic\\_quorum":true,"big\\_vclock":50,"chash\\_keyfun":{"mod":"riak\\_core\\_util","fun":"chash\\_std\\_keyfun"},"dw":"quorum","last\\_write\\_wins":false,"linkfun":{"mod":"riak\\_kv\\_wm\\_link\\_walker","fun":"mapreduce\\_linkfun"},"n\\_val":3,"name":"test","notfound\\_ok":false,"old\\_vclock":86400,"postcommit":[],"pr":0,"precommit":[{"mod":"riak\\_search\\_kv\\_hook","fun":"precommit"}],"pw":0,"r":"quorum","rs\\_extractfun":{"language":"javascript","source":"function(a,b){return{\\"user\\":\\"gpascale\\",
&gt; \\"name\\":\\"greg\\"};}"},"rw":"quorum","small\\_vclock":10,"w":"quorum","young\\_vclock":20}}
&gt; \\*
&gt;
&gt; However, when I try to insert something into the bucket, I get an error
&gt;
&gt; \\*curl -X PUT http://localhost:8098/riak/test/test1 -d "Hello, world!"\\*
&gt;
&gt; \\*{error,badarg,\\*
&gt; \\* [{erlang,iolist\\_to\\_binary,\\*
&gt; \\* [{hook\\_crashed,\\*
&gt; \\* {riak\\_search\\_kv\\_hook,precommit,exit,\\*
&gt; \\* {noproc,\\*
&gt; \\* {gen\\_server,call,\\*
&gt; \\* [riak\\_search\\_js\\_extract,reserve\\_vm,\\*
&gt; \\* infinity]}}}}]},\\*
&gt; \\* {wrq,append\\_to\\_response\\_body,2},\\*
&gt; \\* {riak\\_kv\\_wm\\_raw,accept\\_doc\\_body,2},\\*
&gt; \\* {webmachine\\_resource,resource\\_call,3},\\*
&gt; \\* {webmachine\\_resource,do,3},\\*
&gt; \\* {webmachine\\_decision\\_core,resource\\_call,1},\\*
&gt; \\* {webmachine\\_decision\\_core,accept\\_helper,0},\\*
&gt; \\* {webmachine\\_decision\\_core,decision,1}]}}\\*
&gt; \\*
&gt; \\*
&gt; It doesn't matter if the thing I insert is a string, as above, or real json
&gt; object that matches my schema - the error is the same. Any ideas what might
&gt; be going on here?
&gt;
&gt; Thanks,
&gt; -Greg
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

