---
title: "Re: luwak backend and misc."
description: ""
project: community
lastmod: 2011-08-23T14:33:22-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04433"
mailinglist_parent_id: "msg04262"
author_name: "Drew Whitehouse"
project_section: "mailinglistitem"
sent_date: 2011-08-23T14:33:22-07:00
---


It would seem that a new file is readable (sort of) before the tree is
flushed, no ?

 https://gist.github.com/1160026

-Drew


...deleted...

&gt; The simple answer is \\*new\\* Luwak files cannot be read while being
&gt;&gt; written. This has to do with the fact that the HTTP interface does
&gt;&gt; not expose a way to flush the file's tree to Riak before finishing the
&gt;&gt; upload. The data for the file is being persisted, but the root
&gt;&gt; pointer is not modified until the end.
&gt;&gt;
&gt;&gt; This also means that \\*existing\\* Luwak file \\*can\\* be read while being
&gt;&gt; modified, but modifications made after the root pointer is found will
&gt;&gt; be invisible.
&gt;&gt;
&gt;&gt; 4) Are there any latency numbers available, I am specifically looking at
&gt;&gt;&gt; the
&gt;&gt;&gt; time difference between the first byte read and the last byte write for
&gt;&gt;&gt; an
&gt;&gt;&gt; object.
&gt;&gt;&gt;
&gt;&gt; I'm interpreting this question as, "After I finish writing, how long
&gt;&gt; will it be before I can begin reading what I just wrote?" because of
&gt;&gt; the tree-flushing behavior I described above.
&gt;&gt;
&gt;&gt; The answer depends on the backlog to the Luwak writer process (on the
&gt;&gt; Riak/server side), and the depth of the resulting file tree. Once the
&gt;&gt; writer has written the final block to an object, it must then flush
&gt;&gt; the tree pointing to that object. Flushing the tree requires writing,
&gt;&gt; at least, the root node and the "tld" object (where the metadata about
&gt;&gt; the file is stored). The block\\_size and tree\\_order parameters
&gt;&gt; (1,000,000 bytes and 250, by default) determine how many other nodes
&gt;&gt; must be written between the root and the block. Each node is an
&gt;&gt; additional Riak object write.
&gt;&gt;
&gt;&gt; I hope that helps,
&gt;&gt; Bryan
&gt;&gt;
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\*\\*\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/\\*\\*mailman/listinfo/riak-users\\_\\*\\*lists.basho.com
&gt;

-- 
Drew Whitehouse
ANU Supercomputer Facility Vizlab
