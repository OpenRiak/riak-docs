---
title: "Re: AW: Pipe worker startup failed:fitting was gone before startup"
description: ""
project: community
lastmod: 2012-11-21T11:20:03-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg09366"
mailinglist_parent_id: "msg09364"
author_name: "Alexander Sicular"
project_section: "mailinglistitem"
sent_date: 2012-11-21T11:20:03-08:00
---


Ring size = vnodes. 

Vnodes are evenly divided between participating nodes. 

Vnodes are where each of your replicas live. 


@siculars
http://siculars.posterous.com

Sent from my iRotaryPhone

On Nov 21, 2012, at 14:10, "Cornelius Schmale"  wrote:

&gt; Hi Bryan, 
&gt; 
&gt; thanks for your excellent answer, it helped a lot for a deeper knowledge of 
&gt; riak. 
&gt; 
&gt; You are right, I am using the default-one-node development cluster. After 
&gt; decreasing the ring size to 8 as mentioned by you, everything works fine.
&gt; 
&gt; I will post your answer unter my question at Stackoverflow, if it is ok for 
&gt; you?
&gt; 
&gt; Thanks a lot,
&gt; Cornelius
&gt; 
&gt; --
&gt; Cornelius Schmale
&gt; FH Wedel Gemeinnützige Schulgesellschaft mbH Feldstraße 143, 22880 Wedel
&gt; Tel.: +49 4103 8048-736
&gt; E-Mail: s...@fh-wedel.de
&gt; Web: http://www.fh-wedel.de/
&gt; 
&gt; Sitz der Gesellschaft: Wedel
&gt; Registergericht: Amtsgericht Pinneberg HRB 1578
&gt; Geschäftsführung: Prof. Dr. Eike Harms
&gt; 
&gt; 
&gt; -----Ursprüngliche Nachricht-----
&gt; Von: Bryan Fink [mailto:br...@basho.com] 
&gt; Gesendet: Montag, 19. November 2012 16:07
&gt; An: Cornelius Schmale
&gt; Cc: riak-users@lists.basho.com
&gt; Betreff: Re: Pipe worker startup failed:fitting was gone before startup
&gt; 
&gt; On Mon, Nov 12, 2012 at 12:04 PM, Cornelius Schmale  wrote:
&gt;&gt; I have some problems using riak and mapreduce queries. I’ve described 
&gt;&gt; the hole problem at
&gt;&gt; 
&gt;&gt; http://stackoverflow.com/questions/13345448/riak-fails-at-mapreduce-qu
&gt;&gt; eries-which-configuration-to-use
&gt; 
&gt; Hi, Cornelius. Could you describe a bit, your Riak configuration?
&gt; Specifically, how many nodes are in your cluster, and what is the 
&gt; ring\\_creation\\_size from you app.config?
&gt; 
&gt; If, for example, you're using a default setup {ring\\_creation\\_size, 64} on a 
&gt; one-node development cluster, this behavior is quite likely.
&gt; 155,000 items is enough to get all 64 vnodes working.
&gt; 
&gt; In the first case, before raising map\\_js\\_vm\\_count, those 64 vnodes are 
&gt; fighting over just 8 Javascript VMs, and so some are likely to be starved 
&gt; long enough to time out, which will cause the "All VMs are busy" log message.
&gt; 
&gt; In the second case, after raising map\\_js\\_vm\\_count, it's likely that those 36 
&gt; Javascript VMs just aren't able to process all 155,000 items before the query 
&gt; timeout arrives. The "fitting was gone before startup" log message is saying 
&gt; that pipe running the query shut down while there were still inputs arriving 
&gt; at vnodes.
&gt; 
&gt; You're not seeing either of these behaviors in the simple case with no map 
&gt; function because no interaction with Javascript VMs is required.
&gt; In addition, for that case, objects are not even read off of disk, further 
&gt; alleviating resource contention.
&gt; 
&gt; The two configuration solutions I expect will help the most are lowering 
&gt; ring\\_creation\\_size, and raising the query timeout. Lowering 
&gt; ring\\_creation\\_size to 16, or even 8 on a single-node cluster will cause less 
&gt; contention for Javascript VMs because there will be less attempted 
&gt; parallelism in the map function processing. Raising the query timeout (should 
&gt; be an argument to the 'run' function, or similar, but I'm not familiar with 
&gt; the riak-js client), will give the query more time to finish before shutting 
&gt; down, which may be necessary to overcome slow processing.
&gt; 
&gt; Rewriting your map function in Erlang should also help, since it will be 
&gt; faster, and will not have the same sort of VM contention. But, I understand, 
&gt; that's not as easy to using in early-stage development.
&gt; 
&gt; HTH,
&gt; Bryan
&gt; 
&gt; 
&gt; 
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

