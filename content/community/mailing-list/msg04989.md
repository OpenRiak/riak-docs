---
title: "Re: Delete takes 5 seconds in riak 1.0 ???"
description: ""
project: community
lastmod: 2011-10-03T08:02:36-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg04989"
mailinglist_parent_id: "msg04986"
author_name: "Jon Meredith"
project_section: "mailinglistitem"
sent_date: 2011-10-03T08:02:36-07:00
---


Hi Roland,

Riak deletes by first writing a tombstone and then when all replicas are in
sync removing the object from the underlying key/value store. We have made
some changes in 1.0.0 to increase the length of time the tombstones are
around when all nodes are up (in the Delete Changes section of the release
notes here
https://github.com/basho/riak/blob/1.0/RELEASE-NOTES.org ).

If you just want to make sure the object is deleted, you could use the
deletedvclock option on the get request. You will get a 3-tuple {error,
notfound, VClock} until the tombstone is removed, then a 2-tuple of {error,
notfound} when it has gone.

If you wish to rewrite the key, you can use the returned vclock on a new
object
 O = riakc\\_obj:set\\_vclock(riakc\\_obj:new(&lt;&lt;"b"&gt;&gt;,&lt;&lt;&lt;"k"&gt;&gt;,&lt;,"v"&gt;&gt;), VClock)

and it will overwrite the tombstone for you.

Best Regards,

Jon Meredith
Basho Technologies

On Mon, Oct 3, 2011 at 6:49 AM, Roland Karlsson &lt;
roland.karls...@erlang-solutions.com&gt; wrote:

&gt; Hi Basho,
&gt;
&gt; I had written some simple tests using riakc client library.
&gt;
&gt; The tests are attached to this mail.
&gt;
&gt; In particular I made this call in the tests at the start of
&gt; of each test in order to get a clean DB.
&gt;
&gt; riakc\\_pb\\_socket:delete(Pid, Bucket, Key),
&gt;
&gt; In 0.14 that worked just fine. But ... in 1.0 it did not work.
&gt; The tests failed and complained about siblings.
&gt;
&gt; But ... after some time of experimenting I found that if I
&gt; added a sleep of 5 seconds after the delete ... then the tests
&gt; were OK again.
&gt;
&gt; Is this correct? Does delete take 5 seconds?
&gt;
&gt; NOTE that the attached file assumes inits is started.
&gt;
&gt; /Roland
&gt;
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;
\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

