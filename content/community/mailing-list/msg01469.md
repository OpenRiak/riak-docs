---
title: "Re: riak search and solr/lucene"
description: ""
project: community
lastmod: 2010-11-04T17:03:40-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg01469"
mailinglist_parent_id: "msg01468"
author_name: "Joseph Lambert"
project_section: "mailinglistitem"
sent_date: 2010-11-04T17:03:40-07:00
---


Disregard that last message. What I meant was, in a Solr query, all the
results are returned and then it sorts and then takes the chunk that is
requested by the start and count parameters. Why not instead make the
results of the search() function the input of a MapReduce job, and if the
user adds sorting and then start and count parameters, add two reduce jobs,
one a sort and one a slice. Would that not improve the Solr search results?
Or do I not understand correctly?


- Joe Lambert

joseph.g.lamb...@gmail.com
+86 13656213284


On Fri, Nov 5, 2010 at 7:34 AM, Joseph Lambert
wrote:

&gt; Rusty,
&gt;
&gt; Sorry, I meant Lucene search. Solr can be passed start and count, Lucene
&gt; search can't be, but they share functions in the Erlang code.
&gt;
&gt; - Joe Lambert
&gt;
&gt; joseph.g.lamb...@gmail.com
&gt; +86 13656213284
&gt;
&gt;
&gt; On Fri, Nov 5, 2010 at 2:15 AM, Rusty Klophaus  wrote:
&gt;
&gt;&gt; Hi Joseph,
&gt;&gt;
&gt;&gt; Answers inline below.
&gt;&gt;
&gt;&gt; On Thu, Nov 4, 2010 at 12:49 AM, Joseph Lambert &lt;
&gt;&gt; joseph.g.lamb...@gmail.com&gt; wrote:
&gt;&gt;
&gt;&gt;&gt; I am using the PHP library for a project and was looking through the code
&gt;&gt;&gt; to see what differentiates the Solr HTTP interface query versus the Lucene
&gt;&gt;&gt; search (besides the syntax and the interface, etc) as paging is very useful
&gt;&gt;&gt; for my code. From the PHP library with lucene I can do a search with lucene,
&gt;&gt;&gt; then a reduce job to sort, then another reduce to slice the results. With
&gt;&gt;&gt; Solr, we can just do a cURL with the parameters to do the same thing.
&gt;&gt;&gt;
&gt;&gt;&gt; I scanned the Erlang code, and in the end, both call stream\\_search(), but
&gt;&gt;&gt; the Lucene query will pass the results back to luke for possibly another MR
&gt;&gt;&gt; phase, and the Solr query simply sorts and truncates the list. So:
&gt;&gt;&gt;
&gt;&gt;&gt; 1. Does anyone have a general idea at what point the Solr query will
&gt;&gt;&gt; start to get really slow as far as number of keys in a bucket and other
&gt;&gt;&gt; factors? I know this is dependent on many things, just looking for a rough
&gt;&gt;&gt; idea of when it's a bad idea to use the Solr interface.
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; The Solr interface works by running the query to find your list of keys
&gt;&gt; (limited based on the "start" and "rows" parameters) and then looking up the
&gt;&gt; keys in Riak KV. So if you execute a Solr request with "rows=100", your
&gt;&gt; request will take a certain amount of time to execute the query, plus
&gt;&gt; however long it takes to retrieve 100 objects in your cluster.
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; 2. Also, I see that Riak will cache the map phase of a map reduce, so
&gt;&gt;&gt; will it cache the initial search? Or does it use some other mechanism I'm
&gt;&gt;&gt; not seeing to cache search results?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; The system does not cache Search results, though the operating system's
&gt;&gt; disk caching does make repeated search results execute more quickly.
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt; 3. Finally, for the Solr query, why not automatically add a sort and/or
&gt;&gt;&gt; slice phase if the user passes in sort, start or count parameters in the
&gt;&gt;&gt; Solr query?
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; Not sure I understand the question here, can you clarify/elaborate? The
&gt;&gt; system does support sort and slice parameters. (
&gt;&gt; https://wiki.basho.com/display/RIAK/Riak+Search+-+Querying)
&gt;&gt;
&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Please correct me if any of the assumptions I made are wrong, as usually
&gt;&gt;&gt; when I ask these questions I end up with my foot in my mouth.
&gt;&gt;&gt;
&gt;&gt;&gt; - Joe Lambert
&gt;&gt;&gt;
&gt;&gt;&gt; joseph.g.lamb...@gmail.com
&gt;&gt;&gt; +86 13656213284
&gt;&gt;&gt;

&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;
&gt;
