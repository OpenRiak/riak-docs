---
title: "Re: riak sizing considerations"
description: ""
project: community
lastmod: 2012-01-26T03:59:16-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg06423"
mailinglist_parent_id: "msg06417"
author_name: "Sebastian Gerlach"
project_section: "mailinglistitem"
sent_date: 2012-01-26T03:59:16-08:00
---


Hi Ian,

thanks for your reply. First, thank's a lot for explain the read process
in riak. It helps a lot.

For the benchmarks i use 4 Server:

 CPU: 1x Intel(R) Xeon(R) CPU X5670 @ 2.93GHz
 RAM: 16 GB
 NET: 1 GBit interface

I believe that a cluster can perform over 500 requests per second
depending on the key/value size and the N\\_VAL.

In my case i have an N\\_VAL=3 with the default configuration of riak. I
only play around with the r and w property of the bucket.

I use curl as client and the HTTP-API of riak. I run different
benchmarks. Like one client make the requests to one node or 4 clients
request all 4 nodes.

In all tests the CPU and RAM wasn't the limit. Also i/o dons't seem to
be a problem. The bottleneck at this time is my network.

With a value size of 648 KB and a 1 GBit interface you have a physical
limitation.

In theory an 1 GBit interface can serve 128 MByte/sec. My Images have a
size of 648 KByte. If i use an Apache or Squid to serve them i can
theoretically get 128 MByte / 648 KByte = 200 Images/sec. With riak the
calculation looks like the following: 128 MByte / ( 4 \\* 648 KByte) = 50
Images/sec. The "4 \\*" result from N\\_VAL=3. The coordinator has to read 3
copys and send one.

In theory i can serve the requests parallel or in a row. The limiting
factor should be the bandwidth. In my calculations i use only 50% of the
available bandwidth.

Best regards
Sebastian

On 01/25/2012 11:23 PM, Ian Plosker wrote:
&gt; Sebastian,
&gt; 
&gt; With all requests, Riak will attempt to read or write to all replicas 
&gt; regardless of the specified r or w value. The r and w values affect how many 
&gt; reads from or writes to partitions must be completed before the operation is 
&gt; considered successful.
&gt; 
&gt; As a result, the get (read) and put (write) handlers outlive the client 
&gt; request. They will continue to wait for either all vnodes 
&gt; (replicas/partitions) to respond or for the 60 timeout to elapse. As such, 
&gt; network traffic after a large number of reads with r=1 shouldn't be 
&gt; surprising, the request handlers are continuing to await responses from 
&gt; vnodes who are working through their request queues.
&gt; 
&gt; On modest hardware, I've seen Riak clusters perform multiples of 500 ops per 
&gt; second. I'm curious, what are you using to perform your benchmark? Does it 
&gt; perform requests in parallel? Are requests being made to all nodes in the 
&gt; cluster or just one? To find your maximum throughput, you should experiment 
&gt; with various ratios of parallel request per node.
&gt; 
&gt; Hope that helps. 
&gt; 
&gt; -- 
&gt; Ian Plosker 
&gt; Developer Advocate
&gt; Basho Technologies
&gt; 
&gt; 
&gt; On Tuesday, January 24, 2012 at 5:21 AM, Sebastian Gerlach wrote:
&gt; 
&gt;&gt; Dear Riak-Users,
&gt;&gt; 
&gt;&gt; we consider to save a large amount (50000000) of binary Data (Images) in
&gt;&gt; a riak cluster. Each image has a size of 648 KB. We want to store 3
&gt;&gt; copy's of each image.
&gt;&gt; 
&gt;&gt; In this case i need to store 50000000 \\* 648 KB \\* 3 = 90.5 TB Data. This
&gt;&gt; calculation didn't include any overhead for reorganisation and other stuff.
&gt;&gt; 
&gt;&gt; On the other hand is the network. I run some benchmarks on a 4 node
&gt;&gt; cluster. Each with a 1 Gbps interface. In addition to the benchmarks
&gt;&gt; I've made some calculations.
&gt;&gt; 
&gt;&gt; Some information for the benchmark:
&gt;&gt; - I use the same interface for clustercommunication and benchmarking.
&gt;&gt; - I use the riak http api interface
&gt;&gt; - time curl -s
&gt;&gt; HTTP://interface:8098/buckets/test-01/keys/[10001-20000].jpg &gt; /dev/null
&gt;&gt; 
&gt;&gt; In theory, a 1 Gbps interface provides 125 MB per second. In my
&gt;&gt; calculation i only use 50 percent of the theoretically available
&gt;&gt; bandwidth. This fit very well to my benchmarks.
&gt;&gt; 
&gt;&gt; I try a while with the '{"props":{"r":X}}'.
&gt;&gt; 
&gt;&gt; Calculation “r=2”
&gt;&gt; available bandwidth = 62.5 MB per second / (3\\*648 KB) = 33 requests per
&gt;&gt; second per node = 132 requests per second over the cluster.
&gt;&gt; 
&gt;&gt; Calculation “r=1”
&gt;&gt; available bandwidth = 62.5 MB per second / (2\\*648 KB) = 50 requests per
&gt;&gt; second per node = 200 requests per second over the cluster.
&gt;&gt; 
&gt;&gt; In this second case i see some strange effects in the network. My send
&gt;&gt; and received queues grow verry fast. And after finishing the benchmark
&gt;&gt; there is a while a lot of traffic between the riak nodes.
&gt;&gt; 
&gt;&gt; Does anyone have experience with these data sets and can give a few
&gt;&gt; hints at a possible setup? The goal is to processed at least 500
&gt;&gt; requests per second.
&gt;&gt; 
&gt;&gt; Some other points in my considerations are the time required for a
&gt;&gt; reorganization after a new node are added to the cluster or a node has
&gt;&gt; been replaced.
&gt;&gt; 
&gt;&gt; Many thanks for your reply and your attention.
&gt;&gt; 
&gt;&gt; Kind regards
&gt;&gt; Sebastian
&gt;&gt; 
&gt;&gt; 
&gt;&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt;&gt; riak-users mailing list
&gt;&gt; riak-users@lists.basho.com (mailto:riak-users@lists.basho.com)
&gt;&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

