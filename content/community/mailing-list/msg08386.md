---
title: "Re: riak-erlang-client issue with Riak EE 1.2"
description: ""
project: community
lastmod: 2012-08-28T12:06:39-07:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg08386"
mailinglist_parent_id: "msg08310"
author_name: "Julian"
project_section: "mailinglistitem"
sent_date: 2012-08-28T12:06:39-07:00
---


Hi Dave,

I don't see documentation up on basho.github.com for client 1.3.0, and
I don't see some of those include files referenced from riak\\_pb (ex
riak\\_search\\_pb.hrl) in your repo, so I'll assume those are meant to be
internal. But how am I supposed to know how to migrate to the new
parameters? I was using mapreduce in the prior version to return
portions of the stored objects rather than the bucket/key. I was using
this anonymous js function:

function(v, keyData, arg) {
 var o = JSON.parse(v.values[0].data);
 var p = {id:o.id, account\\_id:o.account\\_id,
account\\_type\\_id:o.account\\_type\\_id, deleted:o.deleted, status:o.status,
hidden:o.hidden, currency:o.currency};
 return [JSON.stringify(p)]
}

On Fri, Aug 17, 2012 at 6:22 AM, Dave Parfitt  wrote:
&gt;
&gt; Hello Julian -
&gt;
&gt; A new version of the riak-erlang-client [1] was recently released that 
&gt; changes riakc\\_pb\\_socket:search/\\* to use protobuffs instead of map/reduce. 
&gt; Give that a shot first and let us know if it works for you.
&gt;
&gt; Cheers -
&gt; Dave
&gt;
&gt; [1] https://github.com/basho/riak-erlang-client/
&gt;
&gt;
&gt; On Aug 16, 2012, at 6:51 PM, Julian wrote:
&gt;
&gt; Hi,
&gt;
&gt; Recently, we upgraded our Riak cluster to 1.2. I hear that one of our buckets 
&gt; has been wiped and reloaded, but our index (Riak search is enabled) may not 
&gt; be in a consistent state. This has led to an error in code using 
&gt; riak-erlang-client 1.2, shown below.
&gt;
&gt; One of the intriguing things I find is that the exception is listed as 
&gt; occuring in one of my own processes that is doing json decoding, however I 
&gt; have checked the json by saving it to a file and it does not contain the data 
&gt; shown inside the 'struct' in the exception. The only explanation I can come 
&gt; up with is that the badmatch is occurring within riakc\\_pb socket and was 
&gt; triggered by my call to riakc\\_pb\\_socket:search/6, and the process link is 
&gt; somehow influencing the crash report.
&gt;
&gt; 1. Is there a newer version of riak-erlang-client that might fix the issue? I 
&gt; noticed that though labeled v1.2, it came out in April; has there been a 
&gt; client code update for EE 1.2?
&gt; 2. Would it help make my code more robust if I tried to filter out these 
&gt; not\\_found's so it wouldn't reach the client? As in 
&gt; http://lists.basho.com/pipermail/riak-users\\_lists.basho.com/2012-January/007075.html
&gt;
&gt;
&gt; (module names edited slightly)
&gt;
&gt; =CRASH REPORT==== 16-Aug-2012::21:44:52 ===
&gt; crasher:
&gt; initial call: xx\\_acl\\_query:init/1
&gt; pid: &lt;0.159.0&gt;
&gt; registered\\_name: []
&gt; exception exit: {{badmatch,
&gt; {not\\_found,
&gt; {&lt;&lt;"a65796222ea26bb7b355bf140dbd5b72e81efee1"&gt;&gt;,
&gt; &lt;&lt;"000018e5-accf-fff1-8123-1efee1"&gt;&gt;},
&gt; {struct,
&gt; [{p,[0]},
&gt; {&lt;&lt;"account\\_id"&gt;&gt;,[&lt;&lt;"0000005427"&gt;&gt;]},
&gt; {&lt;&lt;"account\\_type\\_id"&gt;&gt;,[&lt;&lt;"3"&gt;&gt;]},
&gt; {&lt;&lt;"id"&gt;&gt;,[&lt;&lt;"6373"&gt;&gt;]},
&gt; {&lt;&lt;"status"&gt;&gt;,[&lt;&lt;"Deleted"&gt;&gt;]},
&gt; {&lt;&lt;"type"&gt;&gt;,[&lt;&lt;"account"&gt;&gt;]},
&gt; {score,[1.0]}]}}},
&gt; [{mochijson2,tokenize,2},
&gt; {mochijson2,decode1,2},
&gt; {mochijson2,json\\_decode,2},
&gt; {lists,map,2},
&gt; {lists,map,2},
&gt; {xx\\_acl\\_tree,from\\_json,2},
&gt; {xx\\_acl\\_query,load\\_instance\\_,2},
&gt; {xx\\_acl\\_query,bootstrap\\_accounts,1}]}
&gt; in function gen\\_server:init\\_it/6
&gt; ancestors: [xx\\_cache\\_sup,xx\\_acl\\_sup,&lt;0.108.0&gt;]
&gt; messages: []
&gt; links: [&lt;0.132.0&gt;]
&gt; dictionary: []
&gt; trap\\_exit: true
&gt; status: running
&gt; heap\\_size: 832040
&gt; stack\\_size: 24
&gt; reductions: 30690459
&gt; neighbours:
&gt;
&gt;
&gt; Cheers,
&gt; Julian Pellico
&gt; \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
&gt; riak-users mailing list
&gt; riak-users@lists.basho.com
&gt; http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com
&gt;
&gt;

\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_
riak-users mailing list
riak-users@lists.basho.com
http://lists.basho.com/mailman/listinfo/riak-users\\_lists.basho.com

