---
title: "Re: Secondary Indexes - Feedback?"
description: ""
project: community
lastmod: 2011-12-01T16:22:12-08:00
sitemap:
  priority: 0.2
layout: mailinglistitem
mailinglist_id: "msg05843"
mailinglist_parent_id: "msg05813"
author_name: "Mike Oxford"
project_section: "mailinglistitem"
sent_date: 2011-12-01T16:22:12-08:00
---


I am putting in 2i right now.

Obvious first thoughts:

1) Why is there a "bucket" as well as index-&gt;value? Why are indexes
not "global?" Since getting all keys for a bucket requires a keyspace
walk, why do we need to pass a bucket parameter? What is the
relationship here?

2) No ordering of results : can be done via custom MR, so not the
biggest deal in the world but you end up with a potentially massive
result set if you only want a range. (First 100, last 100, etc.)

3) No multi-index checking. This is a huge lacking feature.

4) Having &gt;75% (WAG) of the examples in more-limiting HTTP/cURL
syntax really really really annoys me, but I'm probably in the
minority here. :)

I think you guys are on to something, because the 2i concept is great
but it needs some flushing out to really be useful. I'm looking
forward to the day when I can say "this index between these two date
ranges, and a max result of 100 items ordered by date." Yes, I can do
that right now via MR, but I have to suck in the whole result set and
filter/sort by hand in the reduce phase. (Yes, it would be nice for
you to do more work so I do not have to! But your work would be more
portable and reusable for the userbase than mine is. :)


-mox

On Wed, Nov 30, 2011 at 10:09 AM, Greg Pascale  wrote:
&gt; Here at Clipboard, we make very heavy use of Riak Search and a couple of
&gt; manual indices here and there. I've wanted to use 2i a few times but have
&gt; decided against it for a few reasons:
&gt;
&gt; 1) Apprehension about the coverage set query, as Matt articulated.
&gt;
&gt; 2) Lack of ordering of returned results. Generally I just want the top 10 or
&gt; so, and the ordering information is in the primary key. I can accomplish
&gt; this with search via the presort parameter.
&gt;
&gt; To me, the implementations of search and 2I are backwards. Search has
&gt; scalability issues because term-based partitioning optimizes for single-term
&gt; queries, but creates huge hotspots making many AND queries prohibitively
&gt; expensive.Â 2I's document-based partitioning makes single-term queries more
&gt; expensive (coverage set) but should allow AND queries to scale. But 2i only
&gt; supports single-term queries!
&gt;
&gt; --
&gt; Greg
&gt; Clipboard
&gt;
&gt; On Monday, November 21, 2011 at 10:18 PM, Fyodor Yarochkin wrote:
&gt;
&gt; Have you tried Secondary Indexes?
&gt; Does the feature help solve your problems? If not, why not? Any concerns?
&gt; What is your wish list for the future of Secondary Indexes?
&gt;
&gt;
&gt; yup. I think secondary indexes is probably one of the most-wanted
&gt; options for this release. It does impact how you are able to model
&gt; your data alot. We discussed the data modeling patterns internally
&gt; here, and the cool thing with secondary indexes is that it is not only
&gt; queries are possible but also the secondary index name could be
&gt; throught of as dynamic variable. Thus, as long as you can predict the
&gt; secondary index name, you can pretty much use it as indexed field in
&gt; SQL data model. One thing we have not tested yet though: if there is
&gt; a limit on number of secondary indexes for a single object, and how
&gt; the system would behave if the number of secondary indexes for a
&gt; particular object is huge.
&gt;
&gt; Another limitation (or wouldbegoodtohave :-)) thing that we have
&gt; noticed is that there is no straight-forward way to query data by
&gt; multiple secondary indexes at once. You can either do key filtering,
&gt; or do one query, feed it to map job, and then reduce by removing
&gt; entries that do not much 2nd criteria, but not query by
&gt; secondaryAval\\_int/2 and secondaryBval\\_int/4. This said, I haven't
&gt; really looked into inner workings of secondary indexes implementation,
&gt; so I am simply commenting on this from a user perspective.
&gt;
&gt; Other than this would be interesting to hear some comparisons on
&gt; performance of secondary index queries vs. SOLR indexes (riak\\_search),
&gt; in our experience secondary indexes perform way faster on large volume
&gt; of data but this could could be just my impression.
&gt;
&gt; cheers,
&gt; -Fyodor
&gt;

